<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[JSä¸­å¯¹è±¡æ˜¯æ€ä¹ˆè¿ç®—çš„å‘¢]]></title>    <link>https://juejin.cn/post/7592789801708339241</link>    <guid>https://juejin.cn/post/7592789801708339241</guid>    <pubDate>2026-01-08T07:56:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592789801708339241" data-draft-id="7592572266754195519" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JSä¸­å¯¹è±¡æ˜¯æ€ä¹ˆè¿ç®—çš„å‘¢"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2026-01-08T07:56:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘çš„å†™æ³•æœ‰ç‚¹æ½®"/> <meta itemprop="url" content="https://juejin.cn/user/1643143620204234"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JSä¸­å¯¹è±¡æ˜¯æ€ä¹ˆè¿ç®—çš„å‘¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1643143620204234/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘çš„å†™æ³•æœ‰ç‚¹æ½®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:56:31.000Z" title="Thu Jan 08 2026 07:56:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript å¯¹è±¡è½¬åŸºæœ¬ç±»å‹çš„éšå¼è§„åˆ™ï¼Œä¸€æ¬¡è®²æ¸…</h2>
<p>åœ¨ JavaScript ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸€äº›**â€œçœ‹èµ·æ¥ä¸åˆç†ï¼Œä½†å®é™…ä¸Šå®Œå…¨ç¬¦åˆè§„èŒƒâ€**çš„è¡Œä¸ºï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">{} + 1
<span class="hljs-section">[]</span> == 0
<span class="hljs-attr">obj</span> == <span class="hljs-number">1</span>
</code></pre>
<p>è¿™äº›ç°è±¡çš„èƒŒåï¼Œéƒ½ç»•ä¸å¼€ä¸€ä¸ªæ ¸å¿ƒæœºåˆ¶ï¼š</p>
<blockquote>
<p><strong>å¯¹è±¡åœ¨å‚ä¸è¿ç®—æˆ–æ¯”è¾ƒæ—¶ï¼Œå¿…é¡»å…ˆè¢«è½¬æ¢ä¸ºåŸºæœ¬ç±»å‹å€¼ï¼ˆPrimitiveï¼‰</strong></p>
</blockquote>
<p>è€Œè¿™ä¸ªè½¬æ¢è¿‡ç¨‹ï¼Œå¹¶ä¸æ˜¯éšæ„çš„ã€‚</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€å¯¹è±¡å¦‚ä½•è¢«è½¬æ¢æˆåŸºæœ¬ç±»å‹ï¼Ÿ</h3>
<p>å½“ JavaScript éœ€è¦æŠŠä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆåŸºæœ¬ç±»å‹æ—¶ï¼Œä¼šæŒ‰<strong>å›ºå®šé¡ºåº</strong>å°è¯•è°ƒç”¨å¯¹è±¡ä¸Šçš„ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<ol>
<li><code>@@toPrimitive</code>ï¼ˆä¹Ÿå°±æ˜¯ <code>Symbol.toPrimitive</code>ï¼‰</li>
<li><code>valueOf</code></li>
<li><code>toString</code></li>
</ol>
<h4 data-id="heading-2">åŸºæœ¬æµç¨‹å¯ä»¥æ€»ç»“ä¸ºï¼š</h4>
<blockquote>
<p><strong>è°å…ˆè¿”å›â€œåŸºæœ¬ç±»å‹â€ï¼Œè°å°±èƒœå‡º</strong></p>
</blockquote>
<p>å¦‚æœæŸä¸ªæ–¹æ³•è¿”å›çš„ä¸æ˜¯åŸºæœ¬ç±»å‹ï¼ˆstring / number / boolean / symbol / bigint / null / undefinedï¼‰ï¼Œ<br/>
é‚£ä¹ˆ JS ä¼š<strong>å¿½ç•¥è¿™ä¸ªç»“æœï¼Œç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªæ–¹æ³•</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-3">äºŒã€å®Œæ•´çš„è½¬æ¢æ­¥éª¤ï¼ˆè§„èŒƒçº§ï¼‰</h3>
<p>å½“å¯¹è±¡éœ€è¦è¢«è½¬æ¢ä¸ºåŸºæœ¬ç±»å‹æ—¶ï¼ŒJavaScript ä¼šæŒ‰ä»¥ä¸‹é€»è¾‘æ‰§è¡Œï¼š</p>
<ol>
<li>
<p><strong>å¦‚æœå¯¹è±¡å­˜åœ¨ <code>Symbol.toPrimitive</code> æ–¹æ³•</strong></p>
<ul>
<li>è°ƒç”¨å®ƒ</li>
<li>å¦‚æœè¿”å›çš„æ˜¯åŸºæœ¬ç±»å‹ï¼Œç›´æ¥ä½¿ç”¨</li>
<li>å¦åˆ™æŠ›å‡º <code>TypeError</code></li>
</ul>
</li>
<li>
<p><strong>å¦åˆ™ï¼Œæ ¹æ®ç›®æ ‡ç±»å‹ï¼ˆPreferredTypeï¼‰å†³å®šè°ƒç”¨é¡ºåº</strong></p>
<ul>
<li>å…ˆå°è¯• <code>valueOf</code></li>
<li>å¦‚æœä¸æ˜¯åŸºæœ¬ç±»å‹ï¼Œå†å°è¯• <code>toString</code></li>
</ul>
</li>
<li>
<p><strong>å¦‚æœéƒ½æ²¡è¿”å›åŸºæœ¬ç±»å‹</strong></p>
<ul>
<li>æŠ›å‡º <code>TypeError</code></li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-4">ä¸‰ã€PreferredType æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>PreferredType å¯ä»¥ç†è§£ä¸ºï¼š</p>
<blockquote>
<p><strong>â€œå½“å‰ä¸Šä¸‹æ–‡æ›´å¸Œæœ›å¾—åˆ°ä»€ä¹ˆç±»å‹çš„å€¼â€</strong></p>
</blockquote>
<p>å®ƒç›´æ¥å½±å“ <code>valueOf</code> å’Œ <code>toString</code> çš„ä¼˜å…ˆçº§ã€‚</p>
<h4 data-id="heading-5">ä¸åŒåœºæ™¯ä¸‹çš„ PreferredType</h4>

























<table><thead><tr><th>åœºæ™¯</th><th>PreferredType</th><th>ä¼˜å…ˆé¡ºåº</th></tr></thead><tbody><tr><td>æ•°å­¦è¿ç®—ï¼ˆ<code>+ - * /</code>ï¼‰</td><td>Number</td><td>valueOf â†’ toString</td></tr><tr><td>æ˜¾å¼å­—ç¬¦ä¸²è½¬æ¢</td><td>String</td><td>toString â†’ valueOf</td></tr><tr><td><code>==</code> æ¯”è¾ƒ</td><td>Default</td><td>valueOf â†’ toString</td></tr></tbody></table>
<p>ğŸ“Œ <strong>æ³¨æ„</strong>ï¼šDefault å¹¶ä¸ç­‰äº Stringï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹å®ƒæ›´åå‘ Numberã€‚</p>
<hr/>
<h3 data-id="heading-6">å››ã€ä¸€ä¸ªå¯æ§é¡ºåºçš„ç¤ºä¾‹</h3>
<p>æ¥çœ‹ä¸€ä¸ªå…¸å‹ä¾‹å­ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>

<span class="hljs-keyword">const</span> obj = {
  <span class="hljs-title function_">valueOf</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> i++
  },
  <span class="hljs-title function_">toString</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> i++
  },
  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">toPrimitive</span>]() {
    <span class="hljs-keyword">return</span> i++
  }
}
</code></pre>
<h4 data-id="heading-7">åœºæ™¯ 1ï¼šéšå¼æ•°å€¼è½¬æ¢</h4>
<pre><code class="hljs">obj + 1
</code></pre>
<p>æ‰§è¡Œé¡ºåºï¼š</p>
<ol>
<li>è°ƒç”¨ <code>Symbol.toPrimitive</code></li>
<li>è¿”å› <code>0</code></li>
<li>è¡¨è¾¾å¼å˜æˆ <code>0 + 1</code></li>
</ol>
<p>ç»“æœæ˜¯ï¼š</p>
<pre><code class="hljs">1
</code></pre>
<hr/>
<h4 data-id="heading-8">åœºæ™¯ 2ï¼šåˆ é™¤ <code>Symbol.toPrimitive</code></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">delete</span> obj[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">toPrimitive</span>]
obj + <span class="hljs-number">1</span>
</code></pre>
<p>PreferredType æ˜¯ <code>Number</code>ï¼Œäºæ˜¯ï¼š</p>
<ol>
<li>è°ƒç”¨ <code>valueOf</code> â†’ è¿”å› <code>0</code></li>
<li>ä¸å†è°ƒç”¨ <code>toString</code></li>
</ol>
<hr/>
<h4 data-id="heading-9">åœºæ™¯ 3ï¼šå­—ç¬¦ä¸²ä¸Šä¸‹æ–‡</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">String</span>(obj)
</code></pre>
<p>PreferredType æ˜¯ <code>String</code>ï¼š</p>
<ol>
<li>å…ˆè°ƒç”¨ <code>toString</code></li>
<li>ä¸å…³å¿ƒ <code>valueOf</code></li>
</ol>
<hr/>
<h3 data-id="heading-10">äº”ã€å¯¹è±¡æ¯”è¾ƒæ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h3>
<p>å½“ä½¿ç”¨ <code>==</code> è¿›è¡Œæ¯”è¾ƒæ—¶ï¼Œå¦‚æœä¸¤ä¸ªæ“ä½œæ•°ç±»å‹ä¸åŒï¼ŒJS ä¼šå°è¯•è¿›è¡Œ<strong>ç±»å‹å¯¹é½</strong>ã€‚</p>
<h4 data-id="heading-11">æ ¸å¿ƒè§„åˆ™ä¹‹ä¸€ï¼š</h4>
<blockquote>
<p><strong>å¯¹è±¡åœ¨å‚ä¸ <code>==</code> æ¯”è¾ƒæ—¶ï¼Œä¸€å®šä¼šå…ˆè¢«è½¬æ¢ä¸ºåŸºæœ¬ç±»å‹</strong></p>
</blockquote>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">obj</span> == <span class="hljs-number">1</span>
</code></pre>
<p>å®é™…å‘ç”Ÿçš„æ˜¯ï¼š</p>
<ol>
<li><code>obj</code> â†’ è§¦å‘å¯¹è±¡è½¬åŸºæœ¬ç±»å‹</li>
<li>å¾—åˆ°ä¸€ä¸ª primitive</li>
<li>å†ä¸ <code>1</code> åšæ¯”è¾ƒ</li>
</ol>
<p>ğŸ“Œ æ‰€ä»¥å¾ˆå¤šâ€œå¥‡æ€ªçš„ç›¸ç­‰ç»“æœâ€ï¼Œæœ¬è´¨éƒ½æ˜¯<strong>éšå¼ç±»å‹è½¬æ¢çš„å‰¯ä½œç”¨</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-12">å…­ã€ä¸ºä»€ä¹ˆè®¾è®¡æˆè¿™æ ·ï¼Ÿ</h3>
<p>è¿™å¥—è§„åˆ™çš„ç›®æ ‡åªæœ‰ä¸€ä¸ªï¼š</p>
<blockquote>
<p><strong>è®©å¯¹è±¡åœ¨â€œå¿…é¡»å‚ä¸è¿ç®—â€çš„åœºæ™¯ä¸‹ï¼Œæœ‰æœºä¼šè¡¨è¾¾è‡ªå·±çš„å€¼è¯­ä¹‰</strong></p>
</blockquote>
<p>ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>Date</code> æ›´åå‘å­—ç¬¦ä¸²</li>
<li><code>Number</code> åŒ…è£…å¯¹è±¡æ›´åå‘æ•°å€¼</li>
<li>è‡ªå®šä¹‰å¯¹è±¡å¯ä»¥é€šè¿‡ <code>Symbol.toPrimitive</code> ç²¾å‡†æ§åˆ¶è¡Œä¸º</li>
</ul>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() + <span class="hljs-number">1</span>
</code></pre>
<p>è¡¨ç°å¾—æ›´åƒå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè€Œä¸æ˜¯æ•°å­¦è¿ç®—ã€‚</p>
<hr/>
<h3 data-id="heading-13">ä¸ƒã€å®è·µå»ºè®®ï¼ˆéå¸¸é‡è¦ï¼‰</h3>
<h4 data-id="heading-14">âœ… èƒ½ä¸ç”¨éšå¼è½¬æ¢ï¼Œå°±ä¸ç”¨</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">Number</span>(obj)
<span class="hljs-built_in">String</span>(obj)
</code></pre>
<h4 data-id="heading-15">âœ… è‡ªå®šä¹‰å¯¹è±¡æ—¶ï¼Œä¼˜å…ˆå®ç° <code>Symbol.toPrimitive</code></h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[Symbol.toPrimitive]</span>(hint) {
  return <span class="hljs-attr">hint</span> === <span class="hljs-string">'string'</span> ? <span class="hljs-string">'xxx'</span> : <span class="hljs-number">123</span>
}
</code></pre>
<h4 data-id="heading-16">âŒ ä¸è¦ä¾èµ– <code>valueOf / toString</code> çš„â€œè°ƒç”¨é¡ºåºå‰¯ä½œç”¨â€</h4>
<p>é‚£æ˜¯ç»™è§„èŒƒå’Œå¼•æ“ç”¨çš„ï¼Œä¸æ˜¯ç»™ä¸šåŠ¡é€»è¾‘ç”¨çš„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UniApp + Pinia æ•°æ®æŒä¹…åŒ–]]></title>    <link>https://juejin.cn/post/7592555965792911366</link>    <guid>https://juejin.cn/post/7592555965792911366</guid>    <pubDate>2026-01-08T07:58:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592555965792911366" data-draft-id="7592789801708322857" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UniApp + Pinia æ•°æ®æŒä¹…åŒ–"/> <meta itemprop="keywords" content="å‰ç«¯,uni-app,æ•°æ®åº“"/> <meta itemprop="datePublished" content="2026-01-08T07:58:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€å£¶çº±"/> <meta itemprop="url" content="https://juejin.cn/user/897635786437944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UniApp + Pinia æ•°æ®æŒä¹…åŒ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/897635786437944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€å£¶çº±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:58:25.000Z" title="Thu Jan 08 2026 07:58:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">UniApp + Pinia æ•°æ®æŒä¹…åŒ–ï¼šä¸€ä¸ªé«˜æ€§èƒ½çš„è¯»å†™åˆ†ç¦»æ–¹æ¡ˆ</h2>
<p>åœ¨ UniApp å¼€å‘ä¸­ï¼Œä½¿ç”¨ <strong>Pinia</strong> è¿›è¡ŒçŠ¶æ€ç®¡ç†å·²ç»éå¸¸æ™®åŠã€‚éšç€ App å¤æ‚åº¦å¢åŠ ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æŠŠä¸€äº›å…³é”®æ•°æ®ï¼ˆå¦‚ Tokenã€ç”¨æˆ·ä¿¡æ¯ã€è®¾ç½®é¡¹ï¼‰å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä»¥ä¾¿ä¸‹æ¬¡æ‰“å¼€ App æ—¶èƒ½ç›´æ¥æ¢å¤ã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨ UniAppï¼ˆç‰¹åˆ«æ˜¯å°ç¨‹åºï¼‰ç¯å¢ƒä¸‹åšæŒä¹…åŒ–ï¼Œå¾€å¾€ä¼šé‡åˆ°å‡ ä¸ªæ£˜æ‰‹çš„é—®é¢˜ï¼š</p>
<ul>
<li><strong>å¯åŠ¨ä½“éªŒå·®</strong>ï¼šå¦‚æœå¼‚æ­¥è¯»å–æ•°æ®ï¼ŒApp å¯åŠ¨æ—¶ç•Œé¢ä¼šå…ˆæ˜¾ç¤ºâ€œåˆå§‹å€¼â€ï¼ˆæ¯”å¦‚ç©ºç™½æˆ–æœªç™»å½•çŠ¶æ€ï¼‰ï¼Œè¿‡å‡ ç™¾æ¯«ç§’åæ‰é—ªå˜ä¸ºâ€œçœŸå®æ•°æ®â€ã€‚</li>
<li><strong>æ“ä½œå¡é¡¿</strong>ï¼šå¦‚æœåœ¨ä¸»çº¿ç¨‹åŒæ­¥å†™å…¥å¤§é‡æ•°æ®ï¼Œç”¨æˆ·æ»‘åŠ¨é¡µé¢æ—¶å¯èƒ½ä¼šæ„Ÿè§‰åˆ°æ‰å¸§ã€‚</li>
<li><strong>æ•°æ®ç±»å‹é™åˆ¶</strong>ï¼š<code>JSON.stringify</code> åŸç”Ÿä¸æ”¯æŒ <code>Date</code>ã€<code>BigInt</code> ç­‰ç±»å‹ï¼Œå­˜è¿›å»å–å‡ºæ¥è¿˜å¾—æ‰‹åŠ¨è½¬æ¢ã€‚</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘å¼€å‘äº†ä¸€ä¸ªè½»é‡çº§çš„æ’ä»¶ï¼š<code>pinia-plugin-uni-persist-next</code>ã€‚å®ƒä¸“æ³¨äºè§£å†³ UniApp ç¯å¢ƒä¸‹çš„ç‰¹æ®Šåœºæ™¯ï¼Œæä¾›æ›´æµç•…çš„å¼€å‘ä½“éªŒã€‚</p>
<hr/>
<h3 data-id="heading-1">ğŸŒŸ æ ¸å¿ƒç‰¹æ€§</h3>
<p>è¿™ä¸ªæ’ä»¶çš„è®¾è®¡æ€è·¯ä¸»è¦å›´ç»•ç€ <strong>â€œæ€§èƒ½â€</strong> å’Œ <strong>â€œæ˜“ç”¨æ€§â€</strong> å±•å¼€ï¼š</p>
<ol>
<li>
<p><strong>âš¡ è¯»å†™åˆ†ç¦»ç­–ç•¥</strong></p>
<ul>
<li><strong>åˆå§‹æ¢å¤ï¼ˆåŒæ­¥è¯»ï¼‰</strong>ï¼šæ’ä»¶ä½¿ç”¨ <code>uni.getStorageSync</code> åŒæ­¥è¯»å–æ•°æ®ã€‚è¿™ä¿è¯äº†åœ¨ç»„ä»¶æŒ‚è½½å‰ï¼ŒStore çš„çŠ¶æ€å·²ç»æ˜¯æœ€ç»ˆç»“æœï¼Œ<strong>é¿å…äº†ç•Œé¢é—ªçƒ</strong>ã€‚</li>
<li><strong>çŠ¶æ€ä¿å­˜ï¼ˆå¼‚æ­¥å†™ï¼‰</strong>ï¼šå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ’ä»¶é»˜è®¤ä½¿ç”¨ <code>uni.setStorage</code> å¼‚æ­¥ä¿å­˜ï¼Œå¹¶åˆ©ç”¨ <code>post</code> æ¨¡å¼å»¶è¿Ÿæ‰§è¡Œï¼Œ<strong>é¿å…é¢‘ç¹ IO é˜»å¡ä¸»çº¿ç¨‹</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>ğŸ›¡ï¸ å¢å¼ºçš„åºåˆ—åŒ–æ”¯æŒ</strong></p>
<ul>
<li>å¼€å‘ä¸­éš¾å…ä¼šç”¨åˆ°ç‰¹æ®Šç±»å‹ã€‚æœ¬æ’ä»¶å†…ç½®äº†è‡ªå®šä¹‰åºåˆ—åŒ–æ–¹æ³•ï¼Œæ”¯æŒä»¥ä¸‹ç±»å‹çš„è‡ªåŠ¨è½¬æ¢ï¼š
<ul>
<li><strong>Date</strong>ï¼šè‡ªåŠ¨è¿˜åŸä¸ºæ—¥æœŸå¯¹è±¡ã€‚</li>
<li><strong>BigInt</strong>ï¼šè‡ªåŠ¨è½¬å­˜ï¼Œä¸æŠ¥é”™ã€‚</li>
<li><strong>å¾ªç¯å¼•ç”¨</strong>ï¼šèƒ½å®‰å…¨å¤„ç†å¯¹è±¡é—´çš„å¾ªç¯å¼•ç”¨ï¼Œé˜²æ­¢ç¨‹åºå´©æºƒã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>âš–ï¸ å­˜å‚¨ä½“ç§¯ç›‘æµ‹</strong></p>
<ul>
<li>è€ƒè™‘åˆ°å°ç¨‹åºå•æ¡ç¼“å­˜é€šå¸¸é™åˆ¶ä¸º 1MBï¼Œæ’ä»¶ä¼šåœ¨éç”Ÿäº§ç¯å¢ƒä¸‹ç›‘æµ‹å­˜å‚¨å¤§å°ã€‚å¦‚æœå•æ¡æ•°æ®è¶…è¿‡ <strong>3.5MB</strong>ï¼Œä¼šåœ¨æ§åˆ¶å°è¾“å‡ºè­¦å‘Šï¼Œå¸®åŠ©å¼€å‘è€…åŠæ—©å‘ç°éšæ‚£ã€‚</li>
</ul>
</li>
<li>
<p><strong>ğŸ§© çµæ´»é…ç½®</strong></p>
<ul>
<li>æ”¯æŒæŒ‰éœ€æŒä¹…åŒ–ï¼ˆ<code>paths</code> è¿‡æ»¤ï¼‰ã€‚</li>
<li>æ”¯æŒè‡ªå®šä¹‰å­˜å‚¨ Key å’Œå‰ç¼€ã€‚</li>
<li>æ”¯æŒ TypeScript ç±»å‹æç¤ºã€‚</li>
</ul>
</li>
</ol>
<hr/>
<hr/>
<h3 data-id="heading-2">ğŸ“¦ å®‰è£…</h3>
<p>æ¨èä½¿ç”¨ pnpmï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add pinia-plugin-uni-persist-next
</code></pre>
<p>æˆ–è€… yarn/npmï¼š</p>
<pre><code class="hljs language-bash" lang="bash">yarn add pinia-plugin-uni-persist-next
<span class="hljs-comment"># npm install pinia-plugin-uni-persist-next</span>
</code></pre>
<hr/>
<h3 data-id="heading-3">ğŸ› ï¸ å¿«é€Ÿä¸Šæ‰‹</h3>
<h4 data-id="heading-4">1. æ³¨å†Œæ’ä»¶</h4>
<p>åœ¨ä½ çš„ <code>main.ts</code> æˆ– <code>index.ts</code> ä¸­å¼•å…¥å¹¶å®‰è£…æ’ä»¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createSSRApp } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia"</span>;
<span class="hljs-keyword">import</span> { createUniPersistPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia-plugin-uni-persist-next"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./App.vue"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createApp</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createSSRApp</span>(<span class="hljs-title class_">App</span>);
  <span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>();

  <span class="hljs-comment">// 1. åˆ›å»ºæ’ä»¶å®ä¾‹</span>
  <span class="hljs-keyword">const</span> uniPersist = <span class="hljs-title function_">createUniPersistPlugin</span>({
    <span class="hljs-attr">keyPrefix</span>: <span class="hljs-string">"my_app_"</span>, <span class="hljs-comment">// å¯é€‰ï¼šç»™æ‰€æœ‰ key åŠ ä¸Šç»Ÿä¸€å‰ç¼€</span>
  });

  <span class="hljs-comment">// 1. æ³¨å†Œåˆ° pinia</span>
  pinia.<span class="hljs-title function_">use</span>(uniPersist);

  app.<span class="hljs-title function_">use</span>(pinia);
  <span class="hljs-keyword">return</span> { app, <span class="hljs-title class_">Pinia</span>: pinia };
}
</code></pre>
<h4 data-id="heading-5">2. åœ¨ Store ä¸­å¼€å¯</h4>
<p>å°±åƒæŒ‰å¼€å…³ä¸€æ ·ç®€å•ï¼Œåœ¨ Store é‡ŒåŠ è¿™å‡ è¡Œä»£ç å°±è¡Œï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">"user"</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">token</span>: <span class="hljs-string">""</span>,
    <span class="hljs-attr">userInfo</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">"æµ·ç»µå®å®"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">10</span> },
    <span class="hljs-attr">loginTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), <span class="hljs-comment">// ç›´æ¥å­˜ Date ç±»å‹ï¼</span>
  }),
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">setToken</span>(<span class="hljs-params">token: <span class="hljs-built_in">string</span></span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = token;
    },
  },
  <span class="hljs-comment">// âœ¨ æ­¤å¤„å¼€å¯æŒä¹…åŒ–</span>
  <span class="hljs-attr">persist</span>: {
    <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
  },
});
</code></pre>
<p>æå®šï¼ç°åœ¨å°±ç®—ä½ åˆ·æ–°é¡µé¢ï¼Œæˆ–è€…æ€æ‰ App é‡å¯ï¼Œ<code>token</code> ä¾ç„¶åœ¨ï¼Œè€Œä¸” <code>loginTime</code> å–å‡ºæ¥è¿˜æ˜¯ <code>Date</code> å¯¹è±¡ï¼Œä¸ç”¨ä½ è‡ªå·±è½¬ã€‚</p>
<hr/>
<h3 data-id="heading-6">âš™ï¸ è¿›é˜¶ç”¨æ³•ï¼ˆæ»¡è¶³ä½ çš„æ§åˆ¶æ¬²ï¼‰</h3>
<h4 data-id="heading-7">åœºæ™¯ä¸€ï¼šæ•°æ®å¤ªå¤šï¼Œæˆ‘åªæƒ³å­˜ä¸€éƒ¨åˆ†</h4>
<p>æ¯”å¦‚ <code>userInfo</code> å¾ˆé•¿ï¼Œæˆ‘åªæƒ³å­˜ä¸ª <code>token</code>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">persist</span>: {
  <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">strategies</span>: [
    {
      <span class="hljs-attr">paths</span>: [<span class="hljs-string">'token'</span>], <span class="hljs-comment">// æŒ‡å®šåå•ï¼šåªå­˜ token</span>
    },
  ],
}
</code></pre>
<h4 data-id="heading-8">åœºæ™¯äºŒï¼šæˆ‘æƒ³æ¢ä¸ªå­˜å‚¨ Key</h4>
<p>é»˜è®¤ Key æ˜¯ Store çš„ IDï¼ˆæ¯”å¦‚ä¸Šé¢çš„ <code>user</code>ï¼‰ï¼Œæ€•è·Ÿåˆ«äººçš„ key æ’è½¦ï¼Ÿæ”¹å®ƒï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">persist</span>: {
  <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">strategies</span>: [
    {
      <span class="hljs-attr">key</span>: <span class="hljs-string">'my_auth_cache'</span>, <span class="hljs-comment">// æœ€ç»ˆåœ¨ Storage é‡Œå°±æ˜¯ "my_auth_cache"</span>
      <span class="hljs-attr">paths</span>: [<span class="hljs-string">'token'</span>],
    },
  ],
}
</code></pre>
<h3 data-id="heading-9">ğŸ” æŠ€æœ¯åŸç†ï¼ˆç»™å¥½å¥‡å®å®ï¼‰</h3>
<h4 data-id="heading-10">ä¸ºä»€ä¹ˆè¯´å®ƒâ€œè¯»å†™åˆ†ç¦»â€ä½“éªŒæœ€å¥½ï¼Ÿ</h4>
<p>æˆ‘ä»¬çœ‹ä¸ªä¼ªä»£ç å¯¹æ¯”ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ğŸ”µ å¯åŠ¨ APP æ—¶ï¼ˆè¯»ï¼‰ï¼šå¿…é¡»åŒæ­¥ï¼</span>
<span class="hljs-comment">// å¦‚æœè¿™é‡Œç”¨å¼‚æ­¥ï¼Œé¡µé¢å…ˆæ˜¾ç¤º"æœªç™»å½•"ï¼Œ0.1ç§’åå˜æˆ"å·²ç™»å½•"ï¼Œç”¨æˆ·ä¼šçœ‹åˆ°ç•Œé¢é—ªçƒã€‚</span>
<span class="hljs-comment">// æ‰€ä»¥æ’ä»¶å¼ºåˆ¶ä½¿ç”¨ getStorageSyncï¼Œä¿è¯é¡µé¢æ¸²æŸ“å‰æ•°æ®å°±åˆ°ä½äº†ã€‚</span>
<span class="hljs-keyword">const</span> data = uni.<span class="hljs-title function_">getStorageSync</span>(key);
store.$patch(data);

<span class="hljs-comment">// ğŸŸ  è¿è¡Œæ—¶ï¼ˆå†™ï¼‰ï¼šå¿…é¡»å¼‚æ­¥ï¼</span>
<span class="hljs-comment">// æ¯”å¦‚ç”¨æˆ·åœ¨æ»‘åŠ¨åˆ—è¡¨æ—¶è§¦å‘äº†çŠ¶æ€æ›´æ–°ï¼Œå¦‚æœè¿™æ—¶å€™åŒæ­¥å†™ç£ç›˜ï¼Œ</span>
<span class="hljs-comment">// JS çº¿ç¨‹å¡ä½ç­‰å¾… IOï¼Œç”¨æˆ·å°±ä¼šæ„Ÿè§‰æ»‘åŠ¨â€œæ‰å¸§â€å¡é¡¿ã€‚</span>
<span class="hljs-comment">// æ‰€ä»¥æ’ä»¶é»˜è®¤ä½¿ç”¨ setStorageï¼ˆå¼‚æ­¥ï¼‰ï¼Œå¹¶åœ¨åå°æ‚„æ‚„ä¿å­˜ã€‚</span>
store.$subscribe(<span class="hljs-function">() =&gt;</span> {
  uni.<span class="hljs-title function_">setStorage</span>({ key, data });
});
</code></pre>
<h4 data-id="heading-11">ä¸ºä»€ä¹ˆå®ƒæ¯” JSON.stringify æ›´å¼ºï¼Ÿ</h4>
<p>åŸç”Ÿçš„ <code>JSON.stringify</code> å¾ˆå‚»ï¼Œé‡åˆ° <code>Date</code> å˜æˆå­—ç¬¦ä¸²ï¼Œé‡åˆ° <code>BigInt</code> æŠ¥é”™ï¼Œé‡åˆ°å¾ªç¯å¼•ç”¨ç›´æ¥å´©ã€‚</p>
<p>æœ¬æ’ä»¶å†…éƒ¨å°è£…äº†ä¸€å¥— <code>safeStringify</code>ï¼š</p>
<ul>
<li>é‡åˆ° <strong>Date</strong> -&gt; æ ‡è®°ä¸ºæ—¥æœŸ -&gt; è¯»å–æ—¶è‡ªåŠ¨å˜å› Date</li>
<li>é‡åˆ° <strong>BigInt</strong> -&gt; è½¬å­—ç¬¦ä¸²å­˜ -&gt; ä¿è¯ä¸æŠ¥é”™</li>
<li>é‡åˆ° <strong>å¾ªç¯å¼•ç”¨</strong> -&gt; è‡ªåŠ¨åˆ‡æ–­ -&gt; ä¿è¯ä¸å´©æºƒ</li>
</ul>
<p>è¿™æ„å‘³ç€ï¼š<strong>ä½ å¯ä»¥æ”¾å¿ƒåœ°æŠŠä»»ä½•æ•°æ®å¾€ Pinia é‡Œä¸¢ï¼Œå‰©ä¸‹çš„äº¤ç»™æ’ä»¶ã€‚</strong></p>
<hr/>
<h3 data-id="heading-12">ğŸ“ æ€»ç»“</h3>
<p><code>pinia-plugin-uni-persist-next</code> å°±åƒæ˜¯ç»™ä½ çš„ UniApp åŠ ä¸Šäº†ä¸€ä¸ª<strong>ç¨³å›ºçš„åå‹¤è¡¥ç»™ç«™</strong>ã€‚</p>
<ul>
<li>å®ƒ<strong>å¾ˆè½»</strong>ï¼šä¸å ä»€ä¹ˆåŒ…ä½“ç§¯ã€‚</li>
<li>å®ƒ<strong>å¾ˆå¼º</strong>ï¼šDateã€BigIntã€å¾ªç¯å¼•ç”¨ç»Ÿç»Ÿæå®šã€‚</li>
<li>å®ƒ<strong>å¾ˆæ»‘</strong>ï¼šè¯»å†™åˆ†ç¦»è®¾è®¡ï¼Œç»ä¸æ‹–æ…¢ UI çº¿ç¨‹ã€‚</li>
</ul>
<p>å¦‚æœä½ è¿˜åœ¨ä¸º UniApp çš„æ•°æ®æŒä¹…åŒ–å¤´ç–¼ï¼Œæˆ–è€…å¿å—ç€æ—§æ–¹æ¡ˆçš„å¡é¡¿ï¼Œä¸å¦¨è¯•è¯•è¿™ä¸ªæ–°æ–¹æ¡ˆï¼</p>
<blockquote>
<p><strong>ğŸ”— GitHub åœ°å€</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHollelihanqi%2Fpinia-plugin-uni-persist-next" target="_blank" title="https://github.com/Hollelihanqi/pinia-plugin-uni-persist-next" ref="nofollow noopener noreferrer">github.com/Hollelihanqâ€¦</a><br/>
è§‰å¾—å¥½ç”¨çš„è¯ï¼Œæ±‚ä¸ª Star â­ï¸ï¼ä½ çš„æ”¯æŒæ˜¯æˆ‘æ›´æ–°çš„åŠ¨åŠ›ï¼</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æŠŠ Git æäº¤å˜æˆâ€œå¯æ‰§è¡Œè§„èŒƒâ€ï¼šCommit è§„èŒƒä½“ç³»ä¸ Husky/Commitlint/Commitizen/Lint-staged å…¨é“¾è·¯ä»‹ç»]]></title>    <link>https://juejin.cn/post/7592789801708273705</link>    <guid>https://juejin.cn/post/7592789801708273705</guid>    <pubDate>2026-01-08T07:41:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592789801708273705" data-draft-id="7592540388298997823" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" æŠŠ Git æäº¤å˜æˆâ€œå¯æ‰§è¡Œè§„èŒƒâ€ï¼šCommit è§„èŒƒä½“ç³»ä¸ Husky/Commitlint/Commitizen/Lint-staged å…¨é“¾è·¯ä»‹ç»"/> <meta itemprop="keywords" content="å‰ç«¯,ä»£ç è§„èŒƒ"/> <meta itemprop="datePublished" content="2026-01-08T07:41:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="paradeå²æœˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3773179639113831"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             æŠŠ Git æäº¤å˜æˆâ€œå¯æ‰§è¡Œè§„èŒƒâ€ï¼šCommit è§„èŒƒä½“ç³»ä¸ Husky/Commitlint/Commitizen/Lint-staged å…¨é“¾è·¯ä»‹ç»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3773179639113831/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    paradeå²æœˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:41:01.000Z" title="Thu Jan 08 2026 07:41:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬è§„èŒƒåŸºäº <code>Conventional Commits</code> æ€æƒ³ï¼Œé…åˆ <code>husky + commitlint + commitizen/cz-* + lint-staged</code> å·¥å…·é“¾ï¼Œåœ¨å›¢é˜Ÿå†…ç»Ÿä¸€æäº¤å†å²çš„å¯è¯»æ€§ä¸å¯ç»´æŠ¤æ€§ã€‚</p>
<ul>
<li>è§„èŒƒå®šä¹‰ï¼šæäº¤ä¿¡æ¯æ€ä¹ˆå†™ï¼ˆæ‰€æœ‰äººéƒ½éµå®ˆï¼‰</li>
<li>å·¥å…·ä¿éšœï¼šæœ¬åœ°æäº¤æ—¶è‡ªåŠ¨æ ¡éªŒï¼ˆå°½é‡å°‘é â€œè®°ä½è§„åˆ™â€ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-0">0. æ¦‚å¿µä¸å·¥å…·ç®€ä»‹</h2>
<p>è¿™ä¸€èŠ‚ç”¨äºå¿«é€Ÿç†è§£â€œä¸ºä»€ä¹ˆè¦åšè¿™äº›çº¦æŸâ€ä»¥åŠâ€œæ¯ä¸ªå·¥å…·å„è‡ªè´Ÿè´£ä»€ä¹ˆâ€ã€‚</p>
<h3 data-id="heading-1">0.1 Conventional Commitsï¼ˆæäº¤è§„èŒƒæ€æƒ³ï¼‰</h3>
<p><code>Conventional Commits</code> æ˜¯ä¸€å¥—çº¦å®šå¼çš„æäº¤ä¿¡æ¯æ ¼å¼ï¼Œç”¨ç»“æ„åŒ–çš„ <code>&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;</code> æ¥è¡¨è¾¾å˜æ›´æ„å›¾ï¼Œå¸¦æ¥çš„æ”¶ç›ŠåŒ…æ‹¬ï¼š</p>
<ul>
<li>æäº¤å†å²æ›´å¯è¯»ï¼Œä»£ç å®¡æŸ¥æ›´é«˜æ•ˆ</li>
<li>ä¾¿äºæŒ‰ç±»å‹ç”Ÿæˆå˜æ›´æ—¥å¿—ï¼ˆChangelogï¼‰</li>
<li>ä¾¿äºè‡ªåŠ¨åŒ–æµç¨‹ï¼ˆå‘å¸ƒã€ç‰ˆæœ¬å·ã€å›æ»šå®šä½ï¼‰</li>
</ul>
<h3 data-id="heading-2">0.2 Git Hookï¼ˆGit é’©å­ï¼‰</h3>
<p>Git Hook æ˜¯ Git åœ¨å…³é”®åŠ¨ä½œå‘ç”Ÿæ—¶è§¦å‘è„šæœ¬çš„æœºåˆ¶ã€‚è¿™é‡Œé‡ç‚¹å…³æ³¨å®¢æˆ·ç«¯é’©å­ï¼š</p>
<ul>
<li><code>pre-commit</code>ï¼šåœ¨å†™å…¥ commit ä¹‹å‰æ‰§è¡Œï¼Œå¸¸ç”¨äºä»£ç æ£€æŸ¥/æ ¼å¼åŒ–/æµ‹è¯•</li>
<li><code>commit-msg</code>ï¼šåœ¨å†™å…¥ commit message ä¹‹åã€æœ€ç»ˆè½åº“ä¹‹å‰æ‰§è¡Œï¼Œå¸¸ç”¨äºæ ¡éªŒæäº¤ä¿¡æ¯æ ¼å¼</li>
</ul>
<h3 data-id="heading-3">0.3 Huskyï¼ˆHook ç®¡ç†ï¼‰</h3>
<p><code>husky</code> ç”¨æ¥æŠŠ hook ä»¥å¯ç»´æŠ¤çš„æ–¹å¼æ”¾è¿›ä»“åº“ï¼ˆé€šå¸¸åœ¨ <code>.husky/</code> ç›®å½•ï¼‰ï¼Œè®©å›¢é˜Ÿæˆå‘˜åœ¨æœ¬åœ° <code>git commit</code> æ—¶è‡ªåŠ¨è§¦å‘åŒä¸€å¥—è„šæœ¬ã€‚</p>
<h3 data-id="heading-4">0.4 Commitlintï¼ˆæäº¤ä¿¡æ¯æ ¡éªŒï¼‰</h3>
<p><code>commitlint</code> ç”¨æ¥æ ¡éªŒ commit message æ˜¯å¦æ»¡è¶³è§„åˆ™ï¼ˆä¾‹å¦‚ type æ˜¯å¦åœ¨å…è®¸åˆ—è¡¨ã€header é•¿åº¦é™åˆ¶ç­‰ï¼‰ã€‚å®ƒé€šå¸¸æŒ‚åœ¨ <code>commit-msg</code> hook ä¸Šï¼Œä¸é€šè¿‡å°±ä¸­æ­¢æäº¤ã€‚</p>
<h3 data-id="heading-5">0.5 Commitizen ä¸é€‚é…å™¨ï¼ˆäº¤äº’å¼ç”Ÿæˆï¼‰</h3>
<p><code>commitizen</code> æä¾›äº¤äº’å¼é—®ç­”æ¥ç”Ÿæˆ commit messageï¼Œé™ä½â€œé è®°å¿†æ‰‹å†™è§„èŒƒâ€çš„æˆæœ¬ã€‚</p>
<ul>
<li><code>commitizen</code> æœ¬èº«æ˜¯å¹³å°ï¼Œéœ€è¦é…ç½®ä¸€ä¸ªé€‚é…å™¨ï¼ˆadapterï¼‰</li>
<li>å¸¸è§é€‚é…å™¨ï¼š<code>cz-conventional-changelog</code>ï¼ˆç»å…¸ã€æœ€å°ä¾èµ–ï¼‰ã€<code>cz-git</code>ï¼ˆæ›´çµæ´»ï¼Œå¯æ‰©å±•ä¸­æ–‡/emoji ç­‰ï¼‰</li>
<li>å‘½ä»¤ï¼š<code>git-cz</code>ï¼ˆä»¥åŠç­‰ä»·çš„ <code>cz</code>ï¼‰</li>
</ul>
<h3 data-id="heading-6">0.6 Lint-stagedï¼ˆåªæ£€æŸ¥æš‚å­˜åŒºæ–‡ä»¶ï¼‰</h3>
<p><code>lint-staged</code> ä¼šè‡ªåŠ¨è·å– Git æš‚å­˜åŒºï¼ˆstagedï¼‰çš„æ–‡ä»¶åˆ—è¡¨ï¼Œå¹¶åªå¯¹è¿™äº›æ–‡ä»¶è¿è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œé¿å…æ¯æ¬¡æäº¤éƒ½å…¨é‡ lintã€‚</p>
<h3 data-id="heading-7">0.7 å®ƒä»¬å¦‚ä½•åä½œï¼ˆä¸€æ¬¡æäº¤çš„æ‰§è¡Œé¡ºåºï¼‰</h3>
<p>å½“ä½ æ‰§è¡Œ <code>git commit</code> æ—¶ï¼Œé€šå¸¸ä¼šæŒ‰ä»¥ä¸‹é¡ºåºå‘ç”Ÿï¼š</p>
<ol start="0">
<li><code>pre-commit</code>ï¼šè¿è¡Œ <code>lint-staged</code>ï¼ˆå¯¹æš‚å­˜åŒºæ–‡ä»¶åšæ ¡éªŒ/æ ¼å¼åŒ–ï¼‰</li>
<li>ç¼–è¾‘/ç”Ÿæˆ commit messageï¼šæ‰‹å†™æˆ–ä½¿ç”¨ <code>commitizen</code></li>
<li><code>commit-msg</code>ï¼šè¿è¡Œ <code>commitlint</code>ï¼ˆæ ¡éªŒ commit messageï¼‰</li>
<li>é€šè¿‡åæäº¤è½åº“</li>
</ol>
<hr/>
<h2 data-id="heading-8">1. Commit Message ç»Ÿä¸€æ ¼å¼ï¼ˆå¿…é¡»ï¼‰</h2>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>(<span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>)!: <span class="hljs-tag">&lt;<span class="hljs-name">subject</span>&gt;</span>
â€‹
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
â€‹
<span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span>
</code></pre>
<ul>
<li><code>&lt;type&gt;</code>ï¼šå˜æ›´ç±»å‹ï¼ˆå¿…å¡«ï¼Œå°å†™ï¼‰</li>
<li><code>(&lt;scope&gt;)</code>ï¼šå½±å“èŒƒå›´ï¼ˆå¯é€‰ï¼Œå»ºè®®å¡«ï¼‰</li>
<li><code>!</code>ï¼šç ´åæ€§å˜æ›´ï¼ˆBreaking Changeï¼Œå¯é€‰ï¼‰</li>
<li><code>&lt;subject&gt;</code>ï¼šä¸€å¥è¯æ¦‚æ‹¬å˜æ›´ï¼ˆå¿…å¡«ï¼‰</li>
<li><code>&lt;body&gt;</code>ï¼šä¸ºä»€ä¹ˆæ”¹ã€æ€ä¹ˆæ”¹ã€å½±å“ç‚¹ï¼ˆå¯é€‰ï¼Œä½†æ¨èåœ¨å¤æ‚æäº¤ä¸­å¡«å†™ï¼‰</li>
<li><code>&lt;footer&gt;</code>ï¼šå…³è” Issue/PRã€Breaking Change è¯´æ˜ï¼ˆå¯é€‰ï¼‰</li>
</ul>
<h3 data-id="heading-9">1.1 subjectï¼ˆå¿…é¡»ï¼‰</h3>
<ul>
<li>ç”¨ç¥ˆä½¿å¥/åŠ¨è¯å¼€å¤´ï¼ˆä¸­æ–‡ä¹Ÿç­‰ä»·ï¼‰ï¼šä¾‹å¦‚â€œæ–°å¢â€¦/ä¿®å¤â€¦/è°ƒæ•´â€¦â€</li>
<li>ç®€çŸ­ã€å…·ä½“ã€å¯è¯»ï¼šä¼˜å…ˆè¯´æ˜â€œåšäº†ä»€ä¹ˆâ€ï¼Œè€Œä¸æ˜¯â€œæ”¹äº†ä»€ä¹ˆæ–‡ä»¶â€</li>
<li>ä¸è¦ä»¥å¥å·ç»“å°¾ï¼›ä¸è¦å†™æ— æ„ä¹‰æè¿°ï¼ˆå¦‚â€œupdateâ€ã€â€œfix bugâ€ï¼‰</li>
<li>å»ºè®®æ§åˆ¶åœ¨ 100 å­—ç¬¦å†…ï¼ˆä¸ <code>commitlint</code> çš„ <code>header-max-length</code> ä¿æŒä¸€è‡´ï¼‰</li>
</ul>
<h3 data-id="heading-10">1.2 bodyï¼ˆæ¨èï¼‰</h3>
<p>å½“å˜æ›´ä¸æ­¢ä¸€å¤„ã€å­˜åœ¨æƒè¡¡æˆ–å½±å“é¢è¾ƒå¤§æ—¶ï¼Œå»ºè®®å†™ bodyï¼š</p>
<ul>
<li>èƒŒæ™¯/åŸå› ï¼šä¸ºä»€ä¹ˆè¦æ”¹</li>
<li>æ–¹æ¡ˆ/å®ç°ï¼šæ€ä¹ˆæ”¹çš„</li>
<li>å½±å“/é£é™©ï¼šæœ‰å“ªäº›å…¼å®¹æ€§æˆ–ä¸Šçº¿æ³¨æ„ç‚¹</li>
</ul>
<h3 data-id="heading-11">1.3 footerï¼ˆæŒ‰éœ€ï¼‰</h3>
<ul>
<li>
<p>å…³è” Issue/ä»»åŠ¡ï¼š<code>Closes #123</code>ã€<code>Refs #123</code></p>
</li>
<li>
<p>ç ´åæ€§å˜æ›´ï¼ˆä¸¤ç§å†™æ³•äºŒé€‰ä¸€ï¼‰ï¼š</p>
<ul>
<li>åœ¨ header é‡Œä½¿ç”¨ <code>!</code></li>
<li>æˆ–åœ¨ footer å†™ï¼š<code>BREAKING CHANGE: xxx</code></li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-12">2. type ä¸ scope çº¦å®šï¼ˆå¿…é¡»ç»Ÿä¸€ï¼‰</h2>
<h3 data-id="heading-13">2.1 æ¨è type åˆ—è¡¨ï¼ˆå»ºè®®ä¸ commitlint é…ç½®ä¿æŒä¸€è‡´ï¼‰</h3>






































































<table><thead><tr><th>type</th><th>ç”¨é€”</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>feat</td><td>æ–°å¢åŠŸèƒ½</td><td><code>feat(auth): æ”¯æŒçŸ­ä¿¡ç™»å½•</code></td></tr><tr><td>fix</td><td>ä¿®å¤ç¼ºé™·</td><td><code>fix(router): ä¿®å¤é‡å®šå‘æ­»å¾ªç¯</code></td></tr><tr><td>docs</td><td>æ–‡æ¡£å˜æ›´</td><td><code>docs: æ›´æ–°å®‰è£…è¯´æ˜</code></td></tr><tr><td>style</td><td>ä»…æ ¼å¼/æ ·å¼ï¼ˆä¸å½±å“é€»è¾‘ï¼‰</td><td><code>style: æ ¼å¼åŒ–ä»£ç </code></td></tr><tr><td>refactor</td><td>é‡æ„ï¼ˆé feat/fixï¼‰</td><td><code>refactor(core): æ‹†åˆ†æ ¡éªŒé€»è¾‘</code></td></tr><tr><td>perf</td><td>æ€§èƒ½ä¼˜åŒ–</td><td><code>perf(list): ä¼˜åŒ–é¦–å±æ¸²æŸ“</code></td></tr><tr><td>test</td><td>æµ‹è¯•ç›¸å…³</td><td><code>test: è¡¥å……ç™»å½•å•æµ‹</code></td></tr><tr><td>build</td><td>æ„å»º/ä¾èµ–/æ‰“åŒ…</td><td><code>build: å‡çº§ pnpm ç‰ˆæœ¬</code></td></tr><tr><td>ci</td><td>CI é…ç½®ä¸è„šæœ¬</td><td><code>ci: æ·»åŠ å‘å¸ƒæµæ°´çº¿</code></td></tr><tr><td>chore</td><td>æ‚é¡¹ï¼ˆä¸å½±å“ä¸šåŠ¡/åŠŸèƒ½ï¼‰</td><td><code>chore: æ›´æ–°ä¾èµ–ä¸è„šæ‰‹æ¶é…ç½®</code></td></tr><tr><td>revert</td><td>å›æ»šæäº¤</td><td><code>revert: feat(auth): æ”¯æŒçŸ­ä¿¡ç™»å½•</code></td></tr><tr><td>wip</td><td>å¼€å‘ä¸­ä¸´æ—¶æäº¤ï¼ˆæ…ç”¨ï¼‰</td><td><code>wip: è°ƒè¯•ç™»å½•æ€</code></td></tr></tbody></table>
<p>å»ºè®®ï¼š<code>wip</code> ä»…ç”¨äºä¸ªäººåˆ†æ”¯ï¼›åˆå¹¶åˆ°ä¸»åˆ†æ”¯å‰åº”é€šè¿‡ <code>rebase/squash</code> æ¸…ç†æˆæœ‰æ„ä¹‰çš„æäº¤ã€‚</p>
<h3 data-id="heading-14">2.2 scope å–å€¼å»ºè®®ï¼ˆå¯é€‰ä½†æ¨èï¼‰</h3>
<p>scope ç”¨æ¥è¯´æ˜å½±å“èŒƒå›´ï¼Œå»ºè®®ä½¿ç”¨â€œæ¨¡å—/é¢†åŸŸ/ç›®å½•åâ€ï¼Œä¿æŒçŸ­ä¸”ç¨³å®šï¼š</p>
<ul>
<li>ä¸šåŠ¡åŸŸï¼š<code>auth</code>ã€<code>user</code>ã€<code>order</code></li>
<li>åŸºç¡€è®¾æ–½ï¼š<code>router</code>ã€<code>store</code>ã€<code>api</code></li>
<li>å·¥ç¨‹åŒ–ï¼š<code>build</code>ã€<code>ci</code>ã€<code>deps</code></li>
<li>æ–‡æ¡£/é…ç½®ï¼š<code>readme</code>ã€<code>eslint</code>ã€<code>prettier</code></li>
</ul>
<hr/>
<h2 data-id="heading-15">3. ç¤ºä¾‹ï¼ˆç›´æ¥ç…§æŠ„å³å¯ï¼‰</h2>
<ul>
<li>æ™®é€šæäº¤ï¼š<code>feat: æ–°å¢å¯¼å‡ºåŠŸèƒ½</code></li>
<li>å¸¦ scopeï¼š<code>fix(auth): ä¿®å¤ token åˆ·æ–°å¤±è´¥</code></li>
<li>ç ´åæ€§å˜æ›´ï¼š<code>feat(api)!: è°ƒæ•´ç”¨æˆ·æ¥å£è¿”å›ç»“æ„</code></li>
</ul>
<p>å¸¦ body/footerï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">feat</span>(user): æ–°å¢ä¸ªäººèµ„æ–™ç¼–è¾‘
â€‹
- æ”¯æŒå¤´åƒä¸Šä¼ ä¸è£å‰ª
- å¢åŠ è¾“å…¥æ ¡éªŒä¸é”™è¯¯æç¤º
â€‹
Closes <span class="hljs-number">#123</span>
</code></pre>
<hr/>
<h2 data-id="heading-16">4. å·¥å…·é“¾è½åœ°ï¼ˆä¸€ï¼‰ï¼šæäº¤ä¿¡æ¯è§„èŒƒï¼ˆcommitlint + commitizenï¼‰</h2>
<p>ç›®æ ‡ï¼šåœ¨æœ¬åœ°æ‹¦æˆªä¸åˆè§„çš„ commit messageï¼Œå¹¶æä¾›ä½æˆæœ¬çš„è§„èŒƒåŒ–æäº¤æ–¹å¼ã€‚</p>
<h3 data-id="heading-17">4.1 å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-sql" lang="sql">pnpm <span class="hljs-keyword">add</span> <span class="hljs-operator">-</span>D husky <span class="hljs-variable">@commitlint</span><span class="hljs-operator">/</span>cli <span class="hljs-variable">@commitlint</span><span class="hljs-operator">/</span>config<span class="hljs-operator">-</span>conventional commitizen
</code></pre>
<h3 data-id="heading-18">4.2 åˆå§‹åŒ– Husky</h3>
<pre><code class="hljs language-bash" lang="bash">pnpm <span class="hljs-built_in">exec</span> husky init
</code></pre>
<p>åˆå§‹åŒ–åé€šå¸¸ä¼šå‘ç”Ÿè¿™äº›å˜åŒ–ï¼ˆä»¥ Husky 9+ ä¸ºä¾‹ï¼‰ï¼š</p>
<ul>
<li>æ–°å¢ <code>.husky/</code> ç›®å½•ï¼ˆç”¨äºå­˜æ”¾ hooksï¼‰</li>
<li>ç”Ÿæˆ <code>.husky/pre-commit</code>ï¼ˆHusky åˆå§‹åŒ–ä¼šæ”¾ä¸€ä¸ªé»˜è®¤ç¤ºä¾‹ï¼Œå¸¸è§é»˜è®¤å†…å®¹æ˜¯ <code>pnpm test</code>ï¼Œå¯æŒ‰é¡¹ç›®éœ€è¦æ”¹æˆ <code>lint-staged</code>ï¼‰</li>
<li>åœ¨ <code>package.json</code> å†™å…¥/æ›´æ–° <code>prepare</code> è„šæœ¬ï¼Œç¡®ä¿å®‰è£…ä¾èµ–åä¼šè‡ªåŠ¨å¯ç”¨ hooks</li>
</ul>
<p>ç¡®ä¿ <code>package.json</code> è‡³å°‘åŒ…å«ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"prepare"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"husky"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-19">4.3 ç¬¬ä¸€æ­¥ï¼šåªé…ç½® commitlintï¼ˆå…ˆæ ¡éªŒï¼Œå†å¼•å¯¼ï¼‰</h3>
<ol start="0">
<li>åˆ›å»º <code>commitlint.config.ts</code>ï¼š</li>
</ol>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
 Â <span class="hljs-keyword">extends</span>: [<span class="hljs-string">'@commitlint/config-conventional'</span>],
}
</code></pre>
<blockquote>
<p>åç»­æ ¹æ®éœ€æ±‚å¯ä¸°å¯Œé…ç½®</p>
</blockquote>
<ol start="2">
<li>é…ç½® <code>.husky/commit-msg</code>ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pnpm <span class="hljs-built_in">exec</span> commitlint --edit <span class="hljs-variable">$1</span>
</code></pre>
<p>å…³äº <code>pnpm exec</code> ä¸ <code>pnpm dlx</code>ï¼š</p>
<ul>
<li><code>pnpm exec</code>ï¼šæ‰§è¡Œ<strong>å½“å‰é¡¹ç›®å·²å®‰è£…</strong>çš„ä¾èµ–ï¼ˆä» <code>node_modules/.bin</code> è§£æå¯æ‰§è¡Œæ–‡ä»¶ï¼‰ï¼›å›¢é˜Ÿåä½œä¸‹æ›´ç¨³å®šã€ç‰ˆæœ¬å¯æ§ï¼ˆæ¨èï¼‰</li>
<li><code>pnpm dlx</code>ï¼šä¸´æ—¶ä¸‹è½½å¹¶æ‰§è¡ŒæŸä¸ªåŒ…ï¼ˆä¸€æ¬¡æ€§è¿è¡Œå·¥å…·æ—¶æ–¹ä¾¿ï¼‰ï¼Œä½†ç‰ˆæœ¬å¯èƒ½éšæ—¶é—´å˜åŒ–ï¼Œä¸é€‚åˆä½œä¸ºä»“åº“é•¿æœŸ hooks ä¾èµ–</li>
</ul>
<p><code>pnpm exec commitlint --edit $1</code> çš„å·¥ä½œæµç¨‹ï¼ˆç®€è¿°ï¼‰ï¼š</p>
<ol start="0">
<li><code>git commit</code> è§¦å‘ <code>commit-msg</code> hook</li>
<li>Husky æ‰§è¡Œ <code>.husky/commit-msg</code></li>
<li><code>pnpm exec</code> åœ¨å½“å‰é¡¹ç›®ä¸­è§£æåˆ° <code>commitlint</code> å¯æ‰§è¡Œæ–‡ä»¶</li>
<li><code>commitlint</code> è¯»å– <code>commitlint.config.*</code> ç­‰é…ç½®</li>
<li><code>commitlint</code> è¯»å– <code>$1</code> æŒ‡å‘çš„ commit message ä¸´æ—¶æ–‡ä»¶å¹¶æ ¡éªŒ</li>
<li>æ ¡éªŒå¤±è´¥è¿”å›é 0ï¼ŒGit ä¸­æ­¢æäº¤ï¼›æ ¡éªŒé€šè¿‡åˆ™ç»§ç»­æäº¤</li>
</ol>
<h4 data-id="heading-20">é˜¶æ®µæ€»ç»“</h4>
<ul>
<li>ç°åœ¨ä½¿ç”¨ <code>git commit -m "..."</code> æäº¤æ—¶ï¼Œå¦‚æœ message ä¸ç¬¦åˆè§„èŒƒï¼Œä¼šè¢«ç›´æ¥æ‹¦æˆª</li>
<li>ä½†è¿™ä¸€æ­¥ä»ä¾èµ–â€œæ‰‹å†™ messageâ€ï¼Œå¯¹æ–°äººæˆ–é«˜é¢‘æäº¤åœºæ™¯ä¸å¤Ÿå‹å¥½</li>
</ul>
<h3 data-id="heading-21">4.4 ç¬¬äºŒæ­¥ï¼šé…ç½® commitizenï¼ˆäº¤äº’å¼ç”Ÿæˆ commit messageï¼‰</h3>
<p>å½“ä½ å®‰è£… <code>commitizen</code> åï¼Œä¼šè·å¾—ä¸¤ä¸ªç­‰ä»·å‘½ä»¤ï¼š</p>
<ul>
<li><code>git-cz</code>ï¼šå®Œæ•´å‘½ä»¤åï¼Œæ›´ç›´è§‚ï¼ˆæ¨èï¼‰</li>
<li><code>cz</code>ï¼šç®€å†™åˆ«åï¼Œè¾“å…¥æ›´çŸ­</li>
</ul>
<p>å®ƒä»¬éƒ½ç”¨äºå¯åŠ¨äº¤äº’å¼æäº¤æµç¨‹ï¼Œå·®åˆ«ä»…åœ¨å‘½ä»¤åã€‚</p>
<ol start="0">
<li>é€‰æ‹©ä¸€ä¸ªé€‚é…å™¨ï¼ˆäºŒé€‰ä¸€å®‰è£…ï¼‰ï¼š</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp">pnpm <span class="hljs-keyword">add</span> -D cz-conventional-changelog
<span class="hljs-meta"># æˆ–</span>
pnpm <span class="hljs-keyword">add</span> -D cz-git
</code></pre>
<ol start="2">
<li>åœ¨ <code>package.json</code> ä¸­é…ç½®é€‚é…å™¨ï¼š</li>
</ol>
<ul>
<li>ä½¿ç”¨ <code>cz-conventional-changelog</code>ï¼š</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"commitizen"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cz-conventional-changelog"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>ä½¿ç”¨ <code>cz-git</code>ï¼š</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"commitizen"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cz-git"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<ol start="3">
<li>å¢åŠ ç»Ÿä¸€å…¥å£è„šæœ¬ï¼ˆæ¨èï¼‰ï¼š</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span> <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"commit"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"git-cz"</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
</code></pre>
<p>æäº¤æ–¹å¼ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">git <span class="hljs-keyword">add</span> <span class="hljs-operator">-</span>A
pnpm <span class="hljs-keyword">commit</span>
</code></pre>
<h4 data-id="heading-22">é˜¶æ®µæ€»ç»“</h4>
<ul>
<li>ç°åœ¨å›¢é˜Ÿå¯ä»¥é€šè¿‡äº¤äº’å¼æ–¹å¼ç”Ÿæˆè§„èŒƒ messageï¼Œå‡ºé”™ç‡æ˜¾è‘—é™ä½</li>
<li><code>commitlint</code> ä»ç„¶ä¿ç•™ï¼šå³ä½¿æœ‰äººç»•è¿‡äº¤äº’æ‰‹å†™ messageï¼Œä¹Ÿä¼šè¢«æ ¡éªŒå…œåº•</li>
</ul>
<hr/>
<h2 data-id="heading-23">5. å·¥å…·é“¾è½åœ°ï¼ˆäºŒï¼‰ï¼špre-commit æ ¡éªŒï¼ˆlint-stagedï¼‰</h2>
<p>ç›®æ ‡ï¼šåœ¨æäº¤å‰åªå¯¹â€œæš‚å­˜åŒºæ–‡ä»¶â€æ‰§è¡Œæ ¡éªŒ/æ ¼å¼åŒ–ï¼Œé¿å…æŠŠä¸åˆè§„ä»£ç å¸¦è¿›ä»“åº“ã€‚</p>
<h3 data-id="heading-24">5.1 å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs language-csharp" lang="csharp">pnpm <span class="hljs-keyword">add</span> -D lint-staged
</code></pre>
<p>è¯´æ˜ï¼š<code>lint-staged</code> åªè´Ÿè´£â€œæŒ‘é€‰æš‚å­˜åŒºæ–‡ä»¶å¹¶è¿è¡Œå‘½ä»¤â€ï¼Œå¹¶ä¸è‡ªå¸¦è§„åˆ™ï¼›ä½ éœ€è¦è‡ªè¡Œé€‰æ‹©å¹¶é…ç½® <code>eslint/prettier/stylelint</code> ç­‰å·¥å…·ã€‚</p>
<h3 data-id="heading-25">5.2 é…ç½® lint-stagedï¼ˆç¤ºä¾‹ï¼‰</h3>
<p>åˆ›å»º <code>.lintstagedrc.json</code>ï¼š</p>
<pre><code class="hljs language-less" lang="less">{
 Â "*.{<span class="hljs-selector-tag">js</span>,<span class="hljs-selector-tag">jsx</span>,<span class="hljs-selector-tag">ts</span>,<span class="hljs-selector-tag">tsx</span>,<span class="hljs-selector-tag">vue</span>}": <span class="hljs-selector-attr">[<span class="hljs-string">"eslint --fix --cache"</span>]</span>,
 Â "*.{<span class="hljs-selector-tag">css</span>,<span class="hljs-selector-tag">scss</span>,<span class="hljs-selector-tag">sass</span>,<span class="hljs-selector-tag">less</span>,<span class="hljs-selector-tag">vue</span>}": <span class="hljs-selector-attr">[<span class="hljs-string">"stylelint --fix"</span>]</span>,
 Â "*.{<span class="hljs-selector-tag">js</span>,<span class="hljs-selector-tag">jsx</span>,<span class="hljs-selector-tag">ts</span>,<span class="hljs-selector-tag">tsx</span>,<span class="hljs-selector-tag">vue</span>,<span class="hljs-selector-tag">css</span>,<span class="hljs-selector-tag">scss</span>,<span class="hljs-selector-tag">sass</span>,<span class="hljs-selector-tag">less</span>,<span class="hljs-selector-tag">json</span>,<span class="hljs-selector-tag">md</span>,<span class="hljs-selector-tag">html</span>}": <span class="hljs-selector-attr">[<span class="hljs-string">"prettier --write"</span>]</span>
}
</code></pre>
<h3 data-id="heading-26">5.3 é…ç½® pre-commit hook</h3>
<p>ç¼–è¾‘ <code>.husky/pre-commit</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pnpm <span class="hljs-built_in">exec</span> lint-staged
</code></pre>
<h4 data-id="heading-27">é˜¶æ®µæ€»ç»“</h4>
<ul>
<li>ç°åœ¨æ¯æ¬¡æäº¤éƒ½ä¼šè‡ªåŠ¨å¯¹æš‚å­˜åŒºæ–‡ä»¶åšæ ¡éªŒ/æ ¼å¼åŒ–</li>
<li>ä¸é€šè¿‡åˆ™æäº¤å¤±è´¥ï¼Œä»æºå¤´å‡å°‘â€œæäº¤åæ‰å‘ç° lint æŠ¥é”™/æ ¼å¼ä¸ç»Ÿä¸€â€çš„æˆæœ¬</li>
</ul>
<hr/>
<h2 data-id="heading-28">6. è·¨å¹³å°ä¸€è‡´æ€§ï¼ˆå¼ºçƒˆå»ºè®®ï¼‰</h2>
<p>ç›®æ ‡ï¼šé¿å… Windows/macOS/Linux æ¢è¡Œç¬¦å·®å¼‚å¯¼è‡´çš„â€œæ— æ„ä¹‰ diffâ€ã€‚</p>
<h3 data-id="heading-29">6.1 <code>.editorconfig</code>ï¼ˆç¼–è¾‘å™¨å±‚ï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">root</span> = <span class="hljs-literal">true</span>
â€‹
<span class="hljs-section">[*]</span>
<span class="hljs-attr">charset</span> = utf-<span class="hljs-number">8</span>
<span class="hljs-attr">indent_style</span> = space
<span class="hljs-attr">indent_size</span> = <span class="hljs-number">2</span>
<span class="hljs-attr">end_of_line</span> = lf
<span class="hljs-attr">insert_final_newline</span> = <span class="hljs-literal">true</span>
<span class="hljs-attr">trim_trailing_whitespace</span> = <span class="hljs-literal">true</span>
â€‹
<span class="hljs-section">[*.md]</span>
<span class="hljs-attr">trim_trailing_whitespace</span> = <span class="hljs-literal">false</span>
</code></pre>
<h3 data-id="heading-30">6.2 <code>.gitattributes</code>ï¼ˆGit å±‚ï¼‰</h3>
<pre><code class="hljs language-vbnet" lang="vbnet">* <span class="hljs-keyword">text</span>=<span class="hljs-keyword">auto</span> eol=lf
â€‹
*.png  <span class="hljs-keyword">binary</span>
*.jpg  <span class="hljs-keyword">binary</span>
*.jpeg <span class="hljs-keyword">binary</span>
*.gif  <span class="hljs-keyword">binary</span>
*.pdf  <span class="hljs-keyword">binary</span>
</code></pre>
<h3 data-id="heading-31">6.3 <code>.editorconfig</code> vs <code>.gitattributes</code>ï¼ˆåŒºåˆ«ä¸é…åˆï¼‰</h3>
<p>ä¸¤è€…ç»å¸¸ä¸€èµ·ç”¨ï¼Œä½†å…³æ³¨ç‚¹ä¸åŒï¼š</p>
<ul>
<li>ç”Ÿæ•ˆå±‚çº§ä¸åŒï¼š<code>.editorconfig</code> å½±å“â€œç¼–è¾‘å™¨/æ ¼å¼åŒ–å™¨åœ¨ä¿å­˜æ—¶æ€ä¹ˆå†™æ–‡ä»¶â€ï¼Œ<code>.gitattributes</code> å½±å“â€œGit åœ¨æ£€å‡º/æäº¤æ—¶æ€ä¹ˆè§„èŒƒåŒ–æ–‡ä»¶â€</li>
<li>è§£å†³é—®é¢˜ä¸åŒï¼š<code>.editorconfig</code> ç»Ÿä¸€ç¼©è¿›ã€ç¼–ç ã€è¡Œå°¾ç©ºç™½ã€æ˜¯å¦ä¿ç•™æœ«å°¾æ¢è¡Œï¼›<code>.gitattributes</code> ç»Ÿä¸€æ¢è¡Œç¬¦ã€æ ‡è®°äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆé¿å… diff ä¹±ç ï¼‰ã€ä»¥åŠ diff/merge ç­–ç•¥ç­‰</li>
<li>æœ€ä½³å®è·µï¼šä¸¤è€…é…åˆä½¿ç”¨ï¼Œæ—¢çº¦æŸå¼€å‘æ—¶çš„å†™å…¥è¡Œä¸ºï¼Œä¹Ÿä¿è¯ä»“åº“å±‚é¢çš„è·¨å¹³å°ä¸€è‡´æ€§</li>
</ul>
<hr/>
<h2 data-id="heading-32">7. å¸¸è§é—®é¢˜ï¼ˆæ’éšœé€ŸæŸ¥ï¼‰</h2>
<ul>
<li>Husky ä¸ç”Ÿæ•ˆï¼šç¡®è®¤æ‰§è¡Œè¿‡ <code>pnpm install</code> ä¸” <code>prepare</code> è„šæœ¬å·²è¿è¡Œï¼›å¿…è¦æ—¶æ£€æŸ¥ <code>git config core.hooksPath</code> æ˜¯å¦æŒ‡å‘ <code>.husky</code></li>
<li>ç´§æ€¥ç»•è¿‡æ ¡éªŒï¼š<code>git commit --no-verify</code>ï¼ˆä»…é™ç´§æ€¥æƒ…å†µï¼Œåç»­éœ€è¡¥è§„èŒƒæäº¤ï¼‰</li>
<li>Windows ä¸‹äº¤äº’æäº¤ä½“éªŒä¸ä½³ï¼šä¼˜å…ˆä½¿ç”¨ <code>pnpm commit</code>ï¼Œä¸è¦å¼ºåˆ¶åœ¨ hook ä¸­è¿›å…¥äº¤äº’å¼ç•Œé¢</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NV12 è½¬ RGB å®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7592515924701724707</link>    <guid>https://juejin.cn/post/7592515924701724707</guid>    <pubDate>2026-01-08T07:48:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592515924701724707" data-draft-id="7592622563545956387" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NV12 è½¬ RGB å®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-01-08T07:48:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‚ å“‰æ‘¸é±¼å¤§ç‹"/> <meta itemprop="url" content="https://juejin.cn/user/3606845069731848"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NV12 è½¬ RGB å®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3606845069731848/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‚ å“‰æ‘¸é±¼å¤§ç‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:48:15.000Z" title="Thu Jan 08 2026 07:48:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ç”±äºæµè§ˆå™¨æ— æ³•ç›´æ¥æ˜¾ç¤º NV12 æ ¼å¼ï¼Œéœ€è¦è½¬æ¢ä¸º RGB æ‰èƒ½åœ¨ Canvas æˆ– Image ä¸­æ˜¾ç¤ºã€‚</p>
<h2 data-id="heading-1">åŸºç¡€æ¦‚å¿µ</h2>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯ YUVï¼Ÿ</h3>
<p>YUV æ˜¯ä¸€ç§é¢œè‰²ç¼–ç ç³»ç»Ÿï¼Œä¸ RGB ä¸åŒï¼š</p>
<ul>
<li><strong>Yï¼ˆäº®åº¦ï¼‰</strong> ï¼šè¡¨ç¤ºå›¾åƒçš„æ˜æš—ç¨‹åº¦ï¼Œäººçœ¼å¯¹äº®åº¦æœ€æ•æ„Ÿ</li>
<li><strong>Uï¼ˆè‰²åº¦ï¼‰</strong> ï¼šè¡¨ç¤ºè“è‰²ä¸äº®åº¦çš„å·®å€¼</li>
<li><strong>Vï¼ˆè‰²åº¦ï¼‰</strong> ï¼šè¡¨ç¤ºçº¢è‰²ä¸äº®åº¦çš„å·®å€¼</li>
</ul>
<h3 data-id="heading-3">ä»€ä¹ˆæ˜¯ NV12ï¼Ÿ</h3>
<p>NV12 æ˜¯ YUV æ ¼å¼çš„ä¸€ç§ï¼Œé‡‡ç”¨ <strong>4:2:0 é‡‡æ ·</strong>ï¼š</p>
<ul>
<li><strong>4:2:0</strong> è¡¨ç¤ºï¼šæ¯ 4 ä¸ª Y åƒç´ å…±äº« 1 ä¸ª UV åƒç´ å¯¹</li>
<li><strong>å­˜å‚¨æ–¹å¼</strong>ï¼šY å¹³é¢å®Œæ•´å­˜å‚¨ï¼ŒUV å¹³é¢äº¤é”™å­˜å‚¨ï¼ˆUã€Vã€Uã€V...ï¼‰</li>
<li><strong>æ•°æ®å¤§å°</strong>ï¼š<code>width Ã— height Ã— 1.5</code> å­—èŠ‚</li>
</ul>
<h3 data-id="heading-4">RGB vs YUV vs NV12</h3>





























<table><thead><tr><th>æ ¼å¼</th><th>æ•°æ®å¤§å°</th><th>ç”¨é€”</th><th>æµè§ˆå™¨æ”¯æŒ</th></tr></thead><tbody><tr><td>RGB</td><td><code>width Ã— height Ã— 3</code></td><td>æ˜¾ç¤ºã€ç¼–è¾‘</td><td>âœ… åŸç”Ÿæ”¯æŒ</td></tr><tr><td>YUV</td><td>å¤šç§å˜ä½“</td><td>è§†é¢‘ç¼–ç </td><td>âŒ éœ€è¦è½¬æ¢</td></tr><tr><td>NV12</td><td><code>width Ã— height Ã— 1.5</code></td><td>è§†é¢‘å¤„ç†</td><td>âŒ éœ€è¦è½¬æ¢</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">NV12 æ ¼å¼è¯¦è§£</h2>
<h3 data-id="heading-6">æ•°æ®å¸ƒå±€</h3>
<p>NV12 æ•°æ®ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Y å¹³é¢ï¼ˆäº®åº¦ï¼‰ Â  Â  Â  Â  Â  Â  Â  Â   â”‚
â”‚  å¤§å°ï¼šwidth Ã— height å­—èŠ‚ Â  Â  Â  â”‚
â”‚  æ¯ä¸ªåƒç´  <span class="hljs-number">1</span> å­—èŠ‚ Â  Â  Â  Â  Â  Â  Â  Â  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  UV å¹³é¢ï¼ˆè‰²åº¦ï¼Œäº¤é”™å­˜å‚¨ï¼‰ Â  Â  Â  â”‚
â”‚  å¤§å°ï¼šwidth Ã— height / <span class="hljs-number">2</span> å­—èŠ‚ Â  â”‚
â”‚  æ ¼å¼ï¼šU V U V U V ... Â  Â  Â  Â   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â€‹
æ€»å¤§å° = width Ã— height Ã— <span class="hljs-number">1.5</span> å­—èŠ‚
</code></pre>
<h3 data-id="heading-7">ç¤ºä¾‹ï¼š1920Ã—1080 å›¾åƒ</h3>
<pre><code class="hljs language-ini" lang="ini">Y å¹³é¢ï¼š1920 Ã— <span class="hljs-attr">1080</span> = <span class="hljs-number">2</span>,<span class="hljs-number">073</span>,<span class="hljs-number">600</span> å­—èŠ‚
UV å¹³é¢ï¼š1920 Ã— 1080 / <span class="hljs-attr">2</span> = <span class="hljs-number">1</span>,<span class="hljs-number">036</span>,<span class="hljs-number">800</span> å­—èŠ‚
æ€»å¤§å°ï¼š3,110,400 å­—èŠ‚
â€‹
æ•°æ®æ’åˆ—ï¼š
<span class="hljs-section">[Y Y Y Y ... Y]</span> <span class="hljs-section">[U V U V U V ... U V]</span>
 â†‘ 2,073,600 å­—èŠ‚  â†‘ 1,036,800 å­—èŠ‚
</code></pre>
<h3 data-id="heading-8">4:2:0 é‡‡æ ·è¯´æ˜</h3>
<pre><code class="hljs language-csharp" lang="csharp">åƒç´ å¸ƒå±€ï¼ˆ<span class="hljs-number">2</span>Ã—<span class="hljs-number">2</span> åƒç´ å—ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ Yâ‚  â”‚ Yâ‚‚  â”‚  â† <span class="hljs-number">4</span> ä¸ª Y å€¼
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ Yâ‚ƒ  â”‚ Yâ‚„  â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
 Â  Â  â†“
  å…±äº« <span class="hljs-number">1</span> ä¸ª UV å¯¹
 Â  Â  â†“
 Â  [<span class="hljs-meta">U, V</span>]
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ</strong></p>
<ul>
<li>äººçœ¼å¯¹äº®åº¦ï¼ˆYï¼‰æ›´æ•æ„Ÿï¼Œå¯¹è‰²åº¦ï¼ˆUVï¼‰ä¸æ•æ„Ÿ</li>
<li>å‡å°‘è‰²åº¦æ•°æ®å¯ä»¥èŠ‚çœ 50% å­˜å‚¨ç©ºé—´</li>
<li>è§†é¢‘ç¼–ç æ ‡å‡†ï¼ˆH.264/H.265ï¼‰åŸºäºæ­¤åŸç†</li>
</ul>
<hr/>
<h2 data-id="heading-9">ä½¿ç”¨åœºæ™¯</h2>
<h3 data-id="heading-10">1. è§†é¢‘ç¼–ç /è§£ç </h3>
<p>è§†é¢‘ç¼–è§£ç å™¨ï¼ˆH.264ã€H.265/HEVCã€VP8ã€VP9ï¼‰çš„ä¸­é—´æ ¼å¼ï¼š</p>
<pre><code class="hljs">è§†é¢‘æ–‡ä»¶ â†’ è§£ç å™¨ â†’ NV12 æ ¼å¼å¸§ â†’ è½¬æ¢ä¸º RGB â†’ æ˜¾ç¤º
</code></pre>
<h3 data-id="heading-11">2. æ‘„åƒå¤´/è§†é¢‘æµ</h3>
<p>æ‘„åƒå¤´é‡‡é›†çš„åŸå§‹æ•°æ®é€šå¸¸æ˜¯ YUVï¼ˆNV12 æ˜¯å…¶ä¸­ä¸€ç§ï¼‰ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// WebRTC ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> stream = <span class="hljs-keyword">await</span> navigator.mediaDevices.getUserMedia({ video: <span class="hljs-literal">true</span> })
<span class="hljs-keyword">const</span> videoTrack = stream.getVideoTracks()[<span class="hljs-number">0</span>]
<span class="hljs-keyword">const</span> imageCapture = <span class="hljs-keyword">new</span> ImageCapture(videoTrack)
<span class="hljs-comment">// æŸäº› API å¯èƒ½è¿”å› NV12 æ ¼å¼çš„åŸå§‹æ•°æ®</span>
</code></pre>
<h3 data-id="heading-12">3. WebRTC è§†é¢‘å¤„ç†</h3>
<ul>
<li>WebRTC çš„ <code>VideoFrame</code> API å¯èƒ½æä¾› NV12 æ ¼å¼</li>
<li>è§†é¢‘ä¼šè®®ã€ç›´æ’­ç­‰åœºæ™¯ä¸­çš„åŸå§‹å¸§æ•°æ®</li>
</ul>
<h3 data-id="heading-13">4. ç§»åŠ¨ç«¯å¼€å‘</h3>
<ul>
<li><strong>Android</strong>ï¼šCamera2 API è¾“å‡ºçš„æ ¼å¼ä¹‹ä¸€ï¼ˆ<code>ImageFormat.YUV_420_888</code>ï¼‰</li>
<li><strong>iOS</strong>ï¼šVideoToolbox å¯èƒ½è¾“å‡º NV12</li>
<li>ç§»åŠ¨ç«¯è§†é¢‘å¤„ç†åº“çš„å¸¸è§è¾“å‡ºæ ¼å¼</li>
</ul>
<h3 data-id="heading-14">5. FFmpeg/è§†é¢‘å¤„ç†åº“</h3>
<pre><code class="hljs language-css" lang="css"># FFmpeg å¤„ç†è§†é¢‘æ—¶ç»å¸¸ä½¿ç”¨ NV12
ffmpeg -<span class="hljs-selector-tag">i</span> <span class="hljs-selector-tag">input</span><span class="hljs-selector-class">.mp4</span> -pix_fmt nv12 output<span class="hljs-selector-class">.nv12</span>
</code></pre>
<h3 data-id="heading-15">6. ç¡¬ä»¶åŠ é€Ÿ</h3>
<ul>
<li>GPU è§†é¢‘è§£ç å™¨ï¼ˆNVIDIA NVENCã€Intel Quick Syncï¼‰çš„è¾“å‡º</li>
<li>ç¡¬ä»¶ç¼–ç å™¨é€šå¸¸ä½¿ç”¨ NV12 ä½œä¸ºè¾“å…¥/è¾“å‡ºæ ¼å¼</li>
</ul>
<hr/>
<h2 data-id="heading-16">ä¸ºä»€ä¹ˆé€‰æ‹© NV12</h2>
<h3 data-id="heading-17">1. å­˜å‚¨æ•ˆç‡</h3>
<p><strong>å¯¹æ¯”ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">1920 Ã— 1080 å›¾åƒï¼š
â€‹
RGBï¼š1920 Ã— 1080 Ã— <span class="hljs-attr">3</span> = <span class="hljs-number">6</span>,<span class="hljs-number">220</span>,<span class="hljs-number">800</span> å­—èŠ‚
NV12ï¼š1920 Ã— 1080 Ã— <span class="hljs-attr">1.5</span> = <span class="hljs-number">3</span>,<span class="hljs-number">110</span>,<span class="hljs-number">400</span> å­—èŠ‚
â€‹
èŠ‚çœï¼š50% å­˜å‚¨ç©ºé—´
</code></pre>
<h3 data-id="heading-18">2. ç¡¬ä»¶æ”¯æŒ</h3>
<ul>
<li>å¤§å¤šæ•°ç¡¬ä»¶ç¼–ç å™¨åŸç”Ÿæ”¯æŒ NV12</li>
<li>è½¬æ¢æˆæœ¬ä½ï¼Œæ€§èƒ½å¥½</li>
</ul>
<h3 data-id="heading-19">3. è§†é¢‘ç¼–ç æ ‡å‡†</h3>
<ul>
<li>ä¸»æµè§†é¢‘ç¼–ç æ ‡å‡†ï¼ˆH.264ã€H.265ï¼‰åŸºäº YUV</li>
<li>NV12 æ˜¯å¸¸è§çš„ YUV æ ¼å¼ï¼Œå…¼å®¹æ€§å¥½</li>
</ul>
<h3 data-id="heading-20">4. äººçœ¼ç‰¹æ€§</h3>
<ul>
<li>äººçœ¼å¯¹äº®åº¦ï¼ˆYï¼‰æ•æ„Ÿï¼Œå¯¹è‰²åº¦ï¼ˆUVï¼‰ä¸æ•æ„Ÿ</li>
<li>4:2:0 é‡‡æ ·ç¬¦åˆäººçœ¼ç‰¹æ€§ï¼Œåœ¨è§†è§‰è´¨é‡æŸå¤±å¾ˆå°çš„æƒ…å†µä¸‹å¤§å¹…å‡å°‘æ•°æ®é‡</li>
</ul>
<hr/>
<h2 data-id="heading-21">è½¬æ¢åŸç†</h2>
<h3 data-id="heading-22">YUV â†’ RGB è½¬æ¢å…¬å¼</h3>
<p>æˆ‘ä»¬ä½¿ç”¨ <strong>ITU-R BT.601</strong> æ ‡å‡†çš„è½¬æ¢å…¬å¼ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// æ ‡å‡†å…¬å¼ï¼ˆæµ®ç‚¹ï¼‰
<span class="hljs-attr">R</span> = Y + <span class="hljs-number">1.402</span> Ã— (V - <span class="hljs-number">128</span>)
<span class="hljs-attr">G</span> = Y - <span class="hljs-number">0.344</span> Ã— (U - <span class="hljs-number">128</span>) - <span class="hljs-number">0.714</span> Ã— (V - <span class="hljs-number">128</span>)
<span class="hljs-attr">B</span> = Y + <span class="hljs-number">1.772</span> Ã— (U - <span class="hljs-number">128</span>)
â€‹
// ä¼˜åŒ–åçš„æ•´æ•°è¿ç®—ï¼ˆä»£ç ä¸­ä½¿ç”¨ï¼‰
let <span class="hljs-attr">r</span> = y + ((<span class="hljs-number">359</span> * v + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>) Â  Â  Â // <span class="hljs-number">1.402</span> â‰ˆ <span class="hljs-number">359</span>/<span class="hljs-number">256</span>
let <span class="hljs-attr">g</span> = y - ((<span class="hljs-number">88</span> * u + <span class="hljs-number">183</span> * v + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>) Â // <span class="hljs-number">0.344</span>â‰ˆ<span class="hljs-number">88</span>/<span class="hljs-number">256</span>, <span class="hljs-number">0.714</span>â‰ˆ<span class="hljs-number">183</span>/<span class="hljs-number">256</span>
let <span class="hljs-attr">b</span> = y + ((<span class="hljs-number">454</span> * u + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>) Â  Â  Â // <span class="hljs-number">1.772</span> â‰ˆ <span class="hljs-number">454</span>/<span class="hljs-number">256</span>
â€‹
// é™åˆ¶å€¼åœ¨ 0-255 èŒƒå›´å†…
<span class="hljs-attr">r</span> = r &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : r &gt; <span class="hljs-number">255</span> ? <span class="hljs-number">255</span> : r
<span class="hljs-attr">g</span> = g &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : g &gt; <span class="hljs-number">255</span> ? <span class="hljs-number">255</span> : g
<span class="hljs-attr">b</span> = b &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : b &gt; <span class="hljs-number">255</span> ? <span class="hljs-number">255</span> : b
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä½¿ç”¨æ•´æ•°è¿ç®—ï¼Ÿ</strong></p>
<ul>
<li><code>&gt;&gt; 8</code> ç›¸å½“äºé™¤ä»¥ 256ï¼Œæ¯”æµ®ç‚¹è¿ç®—å¿«</li>
<li>é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜</li>
<li>æ€§èƒ½æ›´å¥½</li>
</ul>
<h3 data-id="heading-23">è½¬æ¢æµç¨‹</h3>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NV12 åŸå§‹æ•°æ®  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Â  Â  Â  Â  â”‚
 Â  Â  Â  Â  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æå– Y å¹³é¢ Â   â”‚  â† width Ã— height å­—èŠ‚
â”‚  ï¼ˆäº®åº¦ä¿¡æ¯ï¼‰ Â   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Â  Â  Â  Â  â”‚
 Â  Â  Â  Â  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æå– UV å¹³é¢ Â  â”‚  â† width Ã— height / <span class="hljs-number">2</span> å­—èŠ‚
â”‚  ï¼ˆè‰²åº¦ï¼Œäº¤é”™ï¼‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Â  Â  Â  Â  â”‚
 Â  Â  Â  Â  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹æ¯ä¸ªåƒç´ ï¼š Â   â”‚
â”‚  <span class="hljs-number">1.</span> è®¡ç®— UV ç´¢å¼•â”‚  â† <span class="hljs-number">4</span>:<span class="hljs-number">2</span>:<span class="hljs-number">0</span> é‡‡æ ·æ˜ å°„
â”‚  <span class="hljs-number">2.</span> åº”ç”¨è½¬æ¢å…¬å¼â”‚  â† YUV â†’ RGB
â”‚  <span class="hljs-number">3.</span> é™åˆ¶å€¼èŒƒå›´  â”‚  â† <span class="hljs-number">0</span><span class="hljs-number">-255</span> clamp
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Â  Â  Â  Â  â”‚
 Â  Â  Â  Â  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”Ÿæˆ RGBA æ•°æ® â”‚  â† width Ã— height Ã— <span class="hljs-number">4</span> å­—èŠ‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 Â  Â  Â  Â  â”‚
 Â  Â  Â  Â  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»˜åˆ¶åˆ° Canvas  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-24">UV ç´¢å¼•è®¡ç®—è¯¦è§£</h3>
<p>è¿™æ˜¯è½¬æ¢ä¸­æœ€å…³é”®çš„éƒ¨åˆ†ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// å¯¹äºåƒç´ ä½ç½® (x, y)ï¼Œè®¡ç®—å…¶åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•</span>
<span class="hljs-type">const</span> i = y * width + x
â€‹
<span class="hljs-comment">// è®¡ç®—å¯¹åº”çš„ UV è¡Œï¼ˆ4:2:0 é‡‡æ ·ï¼ŒUV è¡Œæ˜¯ Y è¡Œçš„ä¸€åŠï¼‰</span>
<span class="hljs-type">const</span> uvRow = (i / width | <span class="hljs-number">0</span>) &gt;&gt; <span class="hljs-number">1</span> Â <span class="hljs-comment">// ç­‰ä»·äº Math.floor(y / 2)</span>
â€‹
<span class="hljs-comment">// è®¡ç®—å¯¹åº”çš„ UV åˆ—ï¼ˆå¿…é¡»æ˜¯å¶æ•°ï¼‰</span>
<span class="hljs-type">const</span> uvCol = (i % width) &amp; ~<span class="hljs-number">1</span> Â  Â  Â  <span class="hljs-comment">// ç­‰ä»·äº Math.floor(x / 2) * 2</span>
â€‹
<span class="hljs-comment">// è®¡ç®— UV åœ¨æ•°ç»„ä¸­çš„ç´¢å¼•</span>
<span class="hljs-type">const</span> uvIndex = uvRow * width + uvCol
â€‹
<span class="hljs-comment">// è·å– U å’Œ V å€¼</span>
<span class="hljs-type">const</span> u = uv[uvIndex] - <span class="hljs-number">128</span> Â  Â  Â <span class="hljs-comment">// U å€¼ï¼ˆåç§» 128ï¼‰</span>
<span class="hljs-type">const</span> v = uv[uvIndex + <span class="hljs-number">1</span>] - <span class="hljs-number">128</span> Â <span class="hljs-comment">// V å€¼ï¼ˆåç§» 128ï¼‰</span>
</code></pre>
<p><strong>ç¤ºä¾‹ï¼šåƒç´  (100, 50) åœ¨ 1920Ã—1080 å›¾åƒä¸­</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">i</span> = <span class="hljs-number">50</span> * <span class="hljs-number">1920</span> + <span class="hljs-number">100</span> = <span class="hljs-number">96</span>,<span class="hljs-number">100</span>
<span class="hljs-attr">uvRow</span> = (<span class="hljs-number">96</span>,<span class="hljs-number">100</span> / <span class="hljs-number">1920</span>) &gt;&gt; <span class="hljs-number">1</span> = <span class="hljs-number">25</span>
<span class="hljs-attr">uvCol</span> = (<span class="hljs-number">96</span>,<span class="hljs-number">100</span> % <span class="hljs-number">1920</span>) &amp; ~<span class="hljs-number">1</span> = <span class="hljs-number">100</span>
<span class="hljs-attr">uvIndex</span> = <span class="hljs-number">25</span> * <span class="hljs-number">1920</span> + <span class="hljs-number">100</span> = <span class="hljs-number">48</span>,<span class="hljs-number">100</span>
â€‹
// è¯»å– UV å€¼
<span class="hljs-attr">u</span> = uv[<span class="hljs-number">48</span>,<span class="hljs-number">100</span>] - <span class="hljs-number">128</span>
<span class="hljs-attr">v</span> = uv[<span class="hljs-number">48</span>,<span class="hljs-number">101</span>] - <span class="hljs-number">128</span>
</code></pre>
<hr/>
<h2 data-id="heading-25">å®ç°ç»†èŠ‚</h2>
<h3 data-id="heading-26">ä¸ºä»€ä¹ˆä½¿ç”¨ Web Workerï¼Ÿ</h3>
<p>è½¬æ¢æ˜¯ <strong>CPU å¯†é›†å‹æ“ä½œ</strong>ï¼š</p>
<pre><code class="hljs language-diff" lang="diff">1920 Ã— 1080 å›¾åƒ = 2,073,600 åƒç´ 
â€‹
æ¯ä¸ªåƒç´ éœ€è¦ï¼š
<span class="hljs-deletion">- 1 æ¬¡ Y å€¼è¯»å–</span>
<span class="hljs-deletion">- 1 æ¬¡ UV ç´¢å¼•è®¡ç®—</span>
<span class="hljs-deletion">- 1 æ¬¡ UV å€¼è¯»å–</span>
<span class="hljs-deletion">- 3 æ¬¡ä¹˜æ³•è¿ç®—</span>
<span class="hljs-deletion">- 3 æ¬¡åŠ æ³•è¿ç®—</span>
<span class="hljs-deletion">- 3 æ¬¡ clamp æ“ä½œ</span>
â€‹
æ€»è®¡ï¼šçº¦ 2,000 ä¸‡æ¬¡è¿ç®—
</code></pre>
<p><strong>åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œçš„é—®é¢˜ï¼š</strong></p>
<ul>
<li>âŒ é˜»å¡ UIï¼Œé¡µé¢å¡é¡¿</li>
<li>âŒ ç”¨æˆ·ä½“éªŒå·®</li>
<li>âŒ æ— æ³•åˆ©ç”¨å¤šæ ¸ CPU</li>
</ul>
<p><strong>ä½¿ç”¨ Web Worker çš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>âœ… åå°å¤„ç†ï¼Œä¸é˜»å¡ UI</li>
<li>âœ… åˆ©ç”¨å¤šæ ¸ CPU</li>
<li>âœ… æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ</li>
</ul>
<h3 data-id="heading-27">ä¸ºä»€ä¹ˆéœ€è¦æå‰çŸ¥é“å›¾ç‰‡çš„å®½é«˜ï¼Ÿ</h3>
<h4 data-id="heading-28">1. æ²¡æœ‰æ–‡ä»¶å¤´/å…ƒæ•°æ®</h4>
<p>NV12 æ–‡ä»¶æ˜¯çº¯åƒç´ æ•°æ®ï¼Œä¸åƒå¸¸è§å›¾ç‰‡æ ¼å¼åŒ…å«å…ƒæ•°æ®ï¼š</p>
<pre><code class="hljs">PNG/JPEG æ–‡ä»¶ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡ä»¶å¤´ Â  Â  â”‚ â† åŒ…å«å®½é«˜ã€æ ¼å¼ç­‰ä¿¡æ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å…ƒæ•°æ® Â  Â  â”‚ â† é¢œè‰²ç©ºé—´ã€å‹ç¼©å‚æ•°ç­‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åƒç´ æ•°æ® Â  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â€‹
NV12 æ–‡ä»¶ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åƒç´ æ•°æ® Â  â”‚ â† åªæœ‰åŸå§‹å­—èŠ‚ï¼Œæ²¡æœ‰ä»»ä½•å…ƒæ•°æ®ï¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-29">2. éœ€è¦å®½é«˜æ¥è®¡ç®—æ•°æ®å¸ƒå±€</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// nv12Worker.ts</span>
<span class="hljs-type">const</span> { nv12, width, height } = e.data
<span class="hljs-type">const</span> yLen = width * height
<span class="hljs-type">const</span> uv = nv12.<span class="hljs-built_in">subarray</span>(yLen) Â <span class="hljs-comment">// éœ€è¦çŸ¥é“ yLen æ‰èƒ½åˆ†å‰²æ•°æ®</span>
</code></pre>
<h4 data-id="heading-30">3. éœ€è¦å®½é«˜æ¥éªŒè¯æ–‡ä»¶å¤§å°</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> expectedSize = width * height * <span class="hljs-number">1.5</span>
<span class="hljs-keyword">if</span> (file.size !== expectedSize) {
 Â message.<span class="hljs-built_in">error</span>(
 Â  Â `æ–‡ä»¶å¤§å°ä¸åŒ¹é…ï¼æœŸæœ›: ${expectedSize} å­—èŠ‚ï¼Œå®é™…: ${file.size} å­—èŠ‚`
  )
 Â <span class="hljs-keyword">return</span>
}
</code></pre>
<h4 data-id="heading-31">4. éœ€è¦å®½é«˜æ¥æ­£ç¡®è§£æ UV æ•°æ®</h4>
<p>UV æ•°æ®çš„ç´¢å¼•è®¡ç®—å®Œå…¨ä¾èµ–å®½é«˜ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> uvRow = (i / width | <span class="hljs-number">0</span>) &gt;&gt; <span class="hljs-number">1</span> Â <span class="hljs-comment">// éœ€è¦ width</span>
<span class="hljs-type">const</span> uvCol = (i % width) &amp; ~<span class="hljs-number">1</span> Â  Â  Â  <span class="hljs-comment">// éœ€è¦ width</span>
<span class="hljs-type">const</span> uvIndex = uvRow * width + uvCol Â <span class="hljs-comment">// éœ€è¦ width</span>
</code></pre>
<p><strong>å¦‚æœå®½é«˜é”™è¯¯ä¼šæ€æ ·ï¼Ÿ</strong></p>






























<table><thead><tr><th>é”™è¯¯ç±»å‹</th><th>åæœ</th><th>ä¸¥é‡ç¨‹åº¦</th></tr></thead><tbody><tr><td>æ–‡ä»¶å¤§å°ä¸åŒ¹é…</td><td>éªŒè¯å¤±è´¥ï¼Œæ— æ³•å¤„ç†</td><td>â­â­â­</td></tr><tr><td>Y/UV åˆ†å‰²é”™è¯¯</td><td>è¯»å–é”™è¯¯çš„æ•°æ®æ®µ</td><td>â­â­â­â­â­</td></tr><tr><td>UV ç´¢å¼•é”™è¯¯</td><td>é¢œè‰²å®Œå…¨é”™ä¹±</td><td>â­â­â­â­â­</td></tr><tr><td>æ•°ç»„è¶Šç•Œ</td><td>ç¨‹åºå´©æºƒ</td><td>â­â­â­â­â­</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-32">å¸¸è§é—®é¢˜</h2>
<h3 data-id="heading-33">Q1: å¦‚ä½•è·å– NV12 æ–‡ä»¶çš„å®½é«˜ï¼Ÿ</h3>
<p><strong>æ–¹æ³• 1ï¼šä»è§†é¢‘å…ƒæ•°æ®è·å–</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> videoTrack = stream.<span class="hljs-built_in">getVideoTracks</span>()[<span class="hljs-number">0</span>]
<span class="hljs-type">const</span> settings = videoTrack.<span class="hljs-built_in">getSettings</span>()
<span class="hljs-type">const</span> width = settings.width Â  <span class="hljs-comment">// 1920</span>
<span class="hljs-type">const</span> height = settings.height <span class="hljs-comment">// 1080</span>
</code></pre>
<p><strong>æ–¹æ³• 2ï¼šä»æ–‡ä»¶åè§£æ</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ä¾‹å¦‚ï¼šframe_1920x1080.nv12</span>
const match = filename<span class="hljs-selector-class">.match</span>(/(\d+)<span class="hljs-built_in">x</span>(\d+)/)
const <span class="hljs-attribute">width</span> = <span class="hljs-built_in">parseInt</span>(match[<span class="hljs-number">1</span>])
const <span class="hljs-attribute">height</span> = <span class="hljs-built_in">parseInt</span>(match[<span class="hljs-number">2</span>])
</code></pre>
<p><strong>æ–¹æ³• 3ï¼šä»é…ç½®æ–‡ä»¶/API</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> response = await <span class="hljs-built_in">fetch</span>(<span class="hljs-string">'/api/video-frame'</span>)
<span class="hljs-type">const</span> { width, height, data } = await response.<span class="hljs-built_in">json</span>()
<span class="hljs-comment">// data æ˜¯ NV12 æ ¼å¼çš„äºŒè¿›åˆ¶æ•°æ®</span>
</code></pre>
<h3 data-id="heading-34">Q2: å¦‚æœå®½é«˜è®¾ç½®é”™è¯¯ä¼šæ€æ ·ï¼Ÿ</h3>
<ul>
<li><strong>æ–‡ä»¶å¤§å°éªŒè¯å¤±è´¥</strong>ï¼šç¨‹åºæ‹’ç»å¤„ç†</li>
<li><strong>æ•°æ®åˆ†å‰²é”™è¯¯</strong>ï¼šY å’Œ UV æ•°æ®è¯»å–ä½ç½®é”™è¯¯</li>
<li><strong>UV ç´¢å¼•é”™è¯¯</strong>ï¼šæ‰€æœ‰é¢œè‰²é”™ä½ï¼Œå›¾åƒå®Œå…¨é”™ä¹±</li>
<li><strong>æ•°ç»„è¶Šç•Œ</strong>ï¼šå¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒ</li>
</ul>
<h3 data-id="heading-35">Q3: ä¸ºä»€ä¹ˆ UV æ•°æ®è¦åç§» 128ï¼Ÿ</h3>
<p>YUV æ ¼å¼ä¸­ï¼ŒU å’Œ V çš„å€¼èŒƒå›´æ˜¯ 0-255ï¼Œä½†å®é™…è¡¨ç¤ºçš„æ˜¯ -128 åˆ° +127ï¼š</p>
<ul>
<li>0 è¡¨ç¤º -128ï¼ˆæœ€è“/æœ€ç»¿ï¼‰</li>
<li>128 è¡¨ç¤º 0ï¼ˆä¸­æ€§ï¼‰</li>
<li>255 è¡¨ç¤º +127ï¼ˆæœ€çº¢/æœ€é»„ï¼‰</li>
</ul>
<p>æ‰€ä»¥åœ¨è½¬æ¢æ—¶éœ€è¦å‡å» 128 æ¥æ¢å¤çœŸå®å€¼ã€‚</p>
<h3 data-id="heading-36">Q4: å¯ä»¥å¤„ç†å…¶ä»– YUV æ ¼å¼å—ï¼Ÿ</h3>
<p>NV12 æ˜¯ YUV 4:2:0 çš„ä¸€ç§ã€‚å…¶ä»–å¸¸è§æ ¼å¼ï¼š</p>
<ul>
<li><strong>NV21</strong>ï¼šUV é¡ºåºç›¸åï¼ˆVã€Uã€Vã€U...ï¼‰</li>
<li><strong>I420</strong>ï¼šYã€Uã€V åˆ†åˆ«å­˜å‚¨</li>
<li><strong>YV12</strong>ï¼šYã€Vã€U åˆ†åˆ«å­˜å‚¨</li>
</ul>
<p>éœ€è¦ä¿®æ”¹ä»£ç æ¥é€‚é…ä¸åŒçš„æ ¼å¼ã€‚</p>
<h3 data-id="heading-37">Q5: æ€§èƒ½å¦‚ä½•ï¼Ÿ</h3>
<p><strong>æµ‹è¯•ç»“æœï¼ˆ1920Ã—1080 å›¾åƒï¼‰ï¼š</strong></p>
<ul>
<li>è½¬æ¢æ—¶é—´ï¼šçº¦ 20-50msï¼ˆå–å†³äº CPUï¼‰</li>
<li>å†…å­˜å ç”¨ï¼šçº¦ 12MBï¼ˆè¾“å…¥ 3MB + è¾“å‡º 8MBï¼‰</li>
<li>å¸§ç‡ï¼šå¯ä»¥å¤„ç† 20-50 FPS</li>
</ul>
<hr/>
<h2 data-id="heading-38">æ€§èƒ½ä¼˜åŒ–</h2>
<h3 data-id="heading-39">1. ä½¿ç”¨ Web Worker</h3>
<p>å°† CPU å¯†é›†å‹æ“ä½œç§»åˆ°åå°çº¿ç¨‹ï¼Œé¿å…é˜»å¡ UIã€‚</p>
<h3 data-id="heading-40">2. æ•´æ•°è¿ç®—ä¼˜åŒ–</h3>
<p>ä½¿ç”¨ä½è¿ç®—ä»£æ›¿æµ®ç‚¹è¿ç®—ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// æ…¢
<span class="hljs-attr">r</span> = y + <span class="hljs-number">1.402</span> * (v - <span class="hljs-number">128</span>)
â€‹
// å¿«
<span class="hljs-attr">r</span> = y + ((<span class="hljs-number">359</span> * v + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>)
</code></pre>
<h3 data-id="heading-41">3. æ‰‹åŠ¨ Clamp</h3>
<p>é¿å…ä½¿ç”¨ <code>Math.min/max</code>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// æ…¢
<span class="hljs-attr">r</span> = Math.max(<span class="hljs-number">0</span>, Math.min(<span class="hljs-number">255</span>, r))
â€‹
// å¿«
<span class="hljs-attr">r</span> = r &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : r &gt; <span class="hljs-number">255</span> ? <span class="hljs-number">255</span> : r
</code></pre>
<h3 data-id="heading-42">4. å‡å°‘å‡½æ•°è°ƒç”¨</h3>
<p>åœ¨å¾ªç¯ä¸­å†…è”ä»£ç ï¼Œå‡å°‘å‡½æ•°è°ƒç”¨å¼€é”€ã€‚</p>
<h3 data-id="heading-43">5. ä½¿ç”¨ Transferable Objects</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ä¼ é€’ ArrayBufferï¼Œé¿å…å¤åˆ¶</span>
worker.<span class="hljs-built_in">postMessage</span>({ nv12, width, height }, [nv12.buffer])
</code></pre>
<hr/>
<h2 data-id="heading-44">æ€»ç»“</h2>
<p>NV12 è½¬ RGB çš„æ ¸å¿ƒè¦ç‚¹ï¼š</p>
<ol start="0">
<li><strong>NV12 æ˜¯ YUV 4:2:0 æ ¼å¼</strong>ï¼Œæ•°æ®å¤§å°æ˜¯ RGB çš„ä¸€åŠ</li>
<li><strong>éœ€è¦æå‰çŸ¥é“å®½é«˜</strong>ï¼Œå› ä¸ºæ–‡ä»¶æ²¡æœ‰å…ƒæ•°æ®</li>
<li><strong>ä½¿ç”¨ Web Worker</strong> è¿›è¡Œåå°è½¬æ¢ï¼Œé¿å…é˜»å¡ UI</li>
<li><strong>UV ç´¢å¼•è®¡ç®—æ˜¯å…³é”®</strong>ï¼Œéœ€è¦æ­£ç¡®æ˜ å°„ 4:2:0 é‡‡æ ·</li>
<li><strong>æ•´æ•°è¿ç®—ä¼˜åŒ–</strong>å¯ä»¥æå‡æ€§èƒ½</li>
</ol>
<p>è¿™ä¸ªè½¬æ¢åœ¨è§†é¢‘å¤„ç†ã€å›¾åƒå¤„ç†ã€è°ƒè¯•ç­‰åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ä¸JVMå†…å­˜åŒºåŸŸå®Œæ•´è¯¦è§£]]></title>    <link>https://juejin.cn/post/7592540388299440191</link>    <guid>https://juejin.cn/post/7592540388299440191</guid>    <pubDate>2026-01-08T07:19:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592540388299440191" data-draft-id="7592508079306702867" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ä¸JVMå†…å­˜åŒºåŸŸå®Œæ•´è¯¦è§£"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,Android"/> <meta itemprop="datePublished" content="2026-01-08T07:19:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é’è²843"/> <meta itemprop="url" content="https://juejin.cn/user/541408646929991"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaå†…å­˜æ¨¡å‹ï¼ˆJMMï¼‰ä¸JVMå†…å­˜åŒºåŸŸå®Œæ•´è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/541408646929991/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é’è²843
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:19:58.000Z" title="Thu Jan 08 2026 07:19:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1å°æ—¶+
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">âš ï¸ é‡è¦è¯´æ˜</h2>
<p>æœ¬ç¯‡æ–‡ç« ä»¥JVMå†…å­˜åŒºåŸŸçš„å®é™…å®ç°ä¸ºä¸»ï¼ŒJMMä½œä¸ºç†è®ºåŸºç¡€ç®€è¦ä»‹ç»ã€‚é‡ç‚¹è®²è§£JVMå†…å­˜åŒºåŸŸçš„ç‰©ç†ç»“æ„ã€å¯¹è±¡åˆ›å»ºã€å†…å­˜å¸ƒå±€ç­‰å®é™…å†…å®¹ã€‚</p>
<p><strong>JMMï¼ˆç†è®ºåŸºç¡€ï¼‰</strong>ï¼šç®€è¦ä»‹ç»æŠ½è±¡çš„å†…å­˜è®¿é—®è§„èŒƒ<br/>
<strong>JVMå†…å­˜åŒºåŸŸï¼ˆé‡ç‚¹ï¼‰</strong>ï¼šè¯¦ç»†è®²è§£ç‰©ç†çš„å†…å­˜åˆ’åˆ†å’Œå®é™…å®ç°<br/>
<strong>Androidç›¸å…³</strong>ï¼šè¯´æ˜Androidï¼ˆARTï¼‰ä¸JVMçš„åŒºåˆ«</p>
<hr/>
<h2 data-id="heading-1">ç¬¬ä¸€éƒ¨åˆ†ï¼šJMMåŸºç¡€ç†è®ºï¼ˆç®€è¦ï¼‰</h2>
<h3 data-id="heading-2">1. JMMåŸºæœ¬æ¦‚å¿µ</h3>
<h4 data-id="heading-3">1.1 ä»€ä¹ˆæ˜¯Javaå†…å­˜æ¨¡å‹</h4>
<p><strong>JMMçš„å®šä¹‰ï¼š</strong></p>
<p>Javaå†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰æ˜¯Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„ä¸€ç§è§„èŒƒï¼Œç”¨äºå±è”½ä¸åŒç¡¬ä»¶å¹³å°å’Œæ“ä½œç³»ç»Ÿçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä½¿å¾—Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸Šéƒ½èƒ½æ­£ç¡®åœ°è¿è¡Œã€‚</p>
<p><strong>JMMçš„ä½œç”¨ï¼š</strong></p>
<ol>
<li><strong>è§£å†³å¯è§æ€§é—®é¢˜</strong>ï¼šä¿è¯ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹èƒ½å¤Ÿè¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°</li>
<li><strong>è§£å†³æœ‰åºæ€§é—®é¢˜</strong>ï¼šä¿è¯ç¨‹åºçš„æ‰§è¡Œé¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œ</li>
<li><strong>è§£å†³åŸå­æ€§é—®é¢˜</strong>ï¼šé…åˆå…¶ä»–æœºåˆ¶ä¿è¯æ“ä½œçš„åŸå­æ€§</li>
</ol>
<p><strong>JMMä¸JVMå†…å­˜åŒºåŸŸçš„å…³ç³»ï¼š</strong></p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>JMM</th><th>JVMå†…å­˜åŒºåŸŸ</th></tr></thead><tbody><tr><td><strong>æ€§è´¨</strong></td><td>æŠ½è±¡çš„é€»è¾‘æ¦‚å¿µ</td><td>ç‰©ç†çš„å†…å­˜åˆ’åˆ†</td></tr><tr><td><strong>å…³æ³¨ç‚¹</strong></td><td>å¤šçº¿ç¨‹å¹¶å‘è®¿é—®å…±äº«å˜é‡</td><td>ç¨‹åºè¿è¡Œæ—¶æ•°æ®å­˜å‚¨ä½ç½®</td></tr><tr><td><strong>ä¸»è¦å†…å®¹</strong></td><td>ä¸»å†…å­˜ã€å·¥ä½œå†…å­˜</td><td>å †ã€æ ˆã€æ–¹æ³•åŒºç­‰</td></tr><tr><td><strong>è§£å†³é—®é¢˜</strong></td><td>å¯è§æ€§ã€æœ‰åºæ€§ã€åŸå­æ€§</td><td>æ•°æ®å­˜å‚¨å’Œç®¡ç†</td></tr></tbody></table>
<p><strong>å¯¹åº”å…³ç³»ï¼š</strong></p>
<ul>
<li>JMMä¸­çš„"ä¸»å†…å­˜"ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„"å †"ï¼ˆå­˜æ”¾å¯¹è±¡å®ä¾‹ï¼‰</li>
<li>JMMä¸­çš„"å·¥ä½œå†…å­˜"ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„"è™šæ‹Ÿæœºæ ˆå±€éƒ¨å˜é‡è¡¨"å’Œ"ç¨‹åºè®¡æ•°å™¨"</li>
</ul>
<p><strong>ç¤ºä¾‹è¯´æ˜ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JMMExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// å­˜å‚¨åœ¨å †ä¸­ï¼ˆJVMå†…å­˜åŒºåŸŸï¼‰</span>
                           <span class="hljs-comment">// å¯¹åº”JMMçš„ä¸»å†…å­˜</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> count;  <span class="hljs-comment">// ä»ä¸»å†…å­˜è¯»å–åˆ°å·¥ä½œå†…å­˜ï¼ˆæ ˆçš„å±€éƒ¨å˜é‡è¡¨ï¼‰</span>
        local = local + <span class="hljs-number">1</span>;  <span class="hljs-comment">// åœ¨å·¥ä½œå†…å­˜ä¸­è®¡ç®—</span>
        count = local;      <span class="hljs-comment">// å†™å›ä¸»å†…å­˜ï¼ˆå †ï¼‰</span>
    }
}
</code></pre>
<h4 data-id="heading-4">1.2 ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜ï¼ˆç®€è¦ï¼‰</h4>
<p><strong>ä¸»å†…å­˜ï¼ˆMain Memoryï¼‰ï¼š</strong></p>
<p>ä¸»å†…å­˜æ˜¯JMMä¸­çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå®ƒå­˜å‚¨æ‰€æœ‰å…±äº«å˜é‡ã€‚åœ¨ç‰©ç†ä¸Šï¼Œä¸»å†…å­˜ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„å †ã€‚</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æ‰€æœ‰çº¿ç¨‹å…±äº«ä¸»å†…å­˜</li>
<li>å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­</li>
<li>ä¸»å†…å­˜æ˜¯çº¿ç¨‹ä¹‹é—´é€šä¿¡çš„åª’ä»‹</li>
</ul>
<p><strong>å·¥ä½œå†…å­˜ï¼ˆWorking Memoryï¼‰ï¼š</strong></p>
<p>å·¥ä½œå†…å­˜æ˜¯JMMä¸­çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ã€‚åœ¨ç‰©ç†ä¸Šï¼Œå·¥ä½œå†…å­˜ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„è™šæ‹Ÿæœºæ ˆå±€éƒ¨å˜é‡è¡¨ã€‚</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹çš„å·¥ä½œå†…å­˜</li>
<li>å·¥ä½œå†…å­˜å­˜å‚¨è¯¥çº¿ç¨‹ä½¿ç”¨çš„å˜é‡çš„å‰¯æœ¬</li>
<li>çº¿ç¨‹ä¸èƒ½ç›´æ¥è®¿é—®ä¸»å†…å­˜ï¼Œåªèƒ½é€šè¿‡å·¥ä½œå†…å­˜è®¿é—®</li>
</ul>
<p><strong>ä¸»å†…å­˜ä¸å·¥ä½œå†…å­˜çš„å…³ç³»ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸»å†…å­˜      â”‚ â† å­˜å‚¨æ‰€æœ‰å…±äº«å˜é‡ï¼ˆå¯¹åº”å †ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ è¯»å–/å†™å…¥
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å·¥ä½œå†…å­˜<span class="hljs-number">1</span>    â”‚    â”‚ å·¥ä½œå†…å­˜<span class="hljs-number">2</span>    â”‚    â”‚ å·¥ä½œå†…å­˜<span class="hljs-number">3</span>    â”‚
â”‚ (çº¿ç¨‹<span class="hljs-number">1</span>)      â”‚    â”‚ (çº¿ç¨‹<span class="hljs-number">2</span>)      â”‚    â”‚ (çº¿ç¨‹<span class="hljs-number">3</span>)      â”‚
â”‚ (å¯¹åº”æ ˆ)     â”‚    â”‚ (å¯¹åº”æ ˆ)     â”‚    â”‚ (å¯¹åº”æ ˆ)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å†…å­˜å¯è§æ€§é—®é¢˜çš„äº§ç”Ÿï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VisibilityProblem</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ä¸»å†…å­˜ï¼ˆå †ï¼‰ä¸­çš„å…±äº«å˜é‡</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// çº¿ç¨‹1ï¼šä¿®æ”¹flag</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            flag = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// ä¿®æ”¹å·¥ä½œå†…å­˜ä¸­çš„å‰¯æœ¬ï¼Œå¯èƒ½è¿˜æ²¡å†™å›ä¸»å†…å­˜</span>
            System.out.println(<span class="hljs-string">"çº¿ç¨‹1ï¼šflagå·²è®¾ç½®ä¸ºtrue"</span>);
        });
        
        <span class="hljs-comment">// çº¿ç¨‹2ï¼šè¯»å–flag</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">while</span> (!flag) {
                <span class="hljs-comment">// ä»å·¥ä½œå†…å­˜è¯»å–ï¼Œå¯èƒ½çœ‹ä¸åˆ°çº¿ç¨‹1çš„ä¿®æ”¹</span>
                <span class="hljs-comment">// å¯¼è‡´æ— é™å¾ªç¯ï¼</span>
            }
            System.out.println(<span class="hljs-string">"çº¿ç¨‹2ï¼šæ£€æµ‹åˆ°flagä¸ºtrue"</span>);
        });
        
        thread2.start();
        thread1.start();
    }
}
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨volatile</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// volatileä¿è¯å¯è§æ€§</span>
</code></pre>
<h4 data-id="heading-5">1.3 happens-beforeè§„åˆ™ï¼ˆç®€è¦ï¼‰</h4>
<p><strong>happens-beforeå…³ç³»çš„å«ä¹‰ï¼š</strong></p>
<p>happens-beforeæ˜¯JMMä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œç”¨äºæè¿°ä¸¤ä¸ªæ“ä½œä¹‹é—´çš„ååºå…³ç³»ã€‚å¦‚æœæ“ä½œA happens-beforeæ“ä½œBï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li>æ“ä½œAçš„ç»“æœå¯¹æ“ä½œBå¯è§</li>
<li>æ“ä½œAåœ¨æ“ä½œBä¹‹å‰æ‰§è¡Œ</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong> happens-beforeä¸ç­‰äºæ—¶é—´å…ˆåé¡ºåºï¼Œä½†å¦‚æœæœ‰happens-beforeå…³ç³»ï¼Œåˆ™ä¿è¯å¯è§æ€§ã€‚</p>
<p><strong>ä¸»è¦çš„happens-beforeè§„åˆ™ï¼š</strong></p>
<ol>
<li><strong>ç¨‹åºé¡ºåºè§„åˆ™</strong>ï¼šåŒä¸€çº¿ç¨‹å†…ï¼Œå‰é¢çš„æ“ä½œhappens-beforeåé¢çš„æ“ä½œ</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;      <span class="hljs-comment">// æ“ä½œ1</span>
<span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> x + <span class="hljs-number">1</span>;  <span class="hljs-comment">// æ“ä½œ2ï¼šæ“ä½œ1 happens-before æ“ä½œ2</span>
</code></pre>
<ol start="2">
<li><strong>ç›‘è§†å™¨é”è§„åˆ™</strong>ï¼šè§£é”æ“ä½œhappens-beforeåŠ é”æ“ä½œ</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">synchronized</span> (lock) {
    x = <span class="hljs-number">1</span>;  <span class="hljs-comment">// æ“ä½œ1</span>
}  <span class="hljs-comment">// è§£é”</span>

<span class="hljs-keyword">synchronized</span> (lock) {  <span class="hljs-comment">// åŠ é”ï¼šè§£é” happens-before åŠ é”</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">y</span> <span class="hljs-operator">=</span> x;  <span class="hljs-comment">// èƒ½çœ‹åˆ°x=1</span>
}
</code></pre>
<ol start="3">
<li><strong>volatileå˜é‡è§„åˆ™</strong>ï¼švolatileå†™æ“ä½œhappens-before volatileè¯»æ“ä½œ</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

<span class="hljs-comment">// çº¿ç¨‹1</span>
flag = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// å†™æ“ä½œ</span>

<span class="hljs-comment">// çº¿ç¨‹2</span>
<span class="hljs-keyword">if</span> (flag) {  <span class="hljs-comment">// è¯»æ“ä½œï¼šå†™ happens-before è¯»</span>
    <span class="hljs-comment">// èƒ½ç«‹å³çœ‹åˆ°flag=true</span>
}
</code></pre>
<ol start="4">
<li><strong>ä¼ é€’æ€§è§„åˆ™</strong>ï¼šå¦‚æœA happens-before Bï¼ŒB happens-before Cï¼Œåˆ™A happens-before C</li>
</ol>
<h4 data-id="heading-6">1.4 volatileå…³é”®å­—ï¼ˆç®€è¦ï¼‰</h4>
<p><strong>volatileçš„ç‰¹æ€§ï¼š</strong></p>
<ol>
<li><strong>ä¿è¯å¯è§æ€§</strong>ï¼švolatileå˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹ç«‹å³å¯è§</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;  <span class="hljs-comment">// ä¿è¯å¯è§æ€§</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFlag</span><span class="hljs-params">()</span> {
    flag = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// ä¿®æ”¹åç«‹å³å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">getFlag</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> flag;  <span class="hljs-comment">// èƒ½ç«‹å³çœ‹åˆ°æœ€æ–°å€¼</span>
}
</code></pre>
<ol start="2">
<li><strong>ç¦æ­¢æŒ‡ä»¤é‡æ’åº</strong>ï¼švolatileå˜é‡çš„è¯»å†™æ“ä½œä¸ä¼šè¢«é‡æ’åº</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">ready</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">()</span> {
    value = <span class="hljs-number">42</span>;    <span class="hljs-comment">// æ“ä½œ1</span>
    ready = <span class="hljs-literal">true</span>;  <span class="hljs-comment">// æ“ä½œ2ï¼šä¸ä¼šè¢«é‡æ’åºåˆ°æ“ä½œ1ä¹‹å‰</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">read</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (ready) {           <span class="hljs-comment">// æ“ä½œ3</span>
        System.out.println(value);  <span class="hljs-comment">// èƒ½ä¿è¯çœ‹åˆ°value=42</span>
    }
}
</code></pre>
<ol start="3">
<li><strong>ä¸ä¿è¯åŸå­æ€§</strong>ï¼švolatileä¸èƒ½ä¿è¯å¤åˆæ“ä½œçš„åŸå­æ€§</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count++;  <span class="hljs-comment">// è¿™ä¸æ˜¯åŸå­æ“ä½œï¼</span>
    <span class="hljs-comment">// ç›¸å½“äºï¼š</span>
    <span class="hljs-comment">// int temp = count;</span>
    <span class="hljs-comment">// temp = temp + 1;</span>
    <span class="hljs-comment">// count = temp;</span>
    <span class="hljs-comment">// è¿™ä¸‰ä¸ªæ“ä½œä¹‹é—´å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­</span>
}
</code></pre>
<p><strong>æ­£ç¡®åšæ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨synchronized</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count++;  <span class="hljs-comment">// ä¿è¯åŸå­æ€§</span>
}

<span class="hljs-comment">// æˆ–ä½¿ç”¨AtomicInteger</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    count.incrementAndGet();  <span class="hljs-comment">// åŸå­æ“ä½œ</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-7">ç¬¬äºŒéƒ¨åˆ†ï¼šJVMå†…å­˜åŒºåŸŸæ•´ä½“æ¶æ„ï¼ˆå›¾è¡¨+è¯¦è§£ï¼‰</h2>
<h3 data-id="heading-8">2. JVMå†…å­˜åŒºåŸŸæ•´ä½“æ¶æ„å›¾</h3>
<h4 data-id="heading-9">2.1 æ•´ä½“æ¶æ„å›¾ï¼ˆé‡ç‚¹ï¼‰</h4>
<pre><code class="hljs language-scss" lang="scss">JVMå†…å­˜åŒºåŸŸæ•´ä½“æ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¨‹åºè®¡æ•°å™¨ (ç§æœ‰)   â”‚
â”‚  è™šæ‹Ÿæœºæ ˆ (ç§æœ‰)     â”‚
â”‚  æœ¬åœ°æ–¹æ³•æ ˆ (ç§æœ‰)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Javaå † (å…±äº«)     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚æ–°ç”Ÿä»£â”‚  â”‚è€å¹´ä»£â”‚  â”‚
â”‚  â”‚ Eden â”‚  â”‚     â”‚  â”‚
â”‚  â”‚ S0S1 â”‚  â”‚     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ–¹æ³•åŒº (å…±äº«)      â”‚
â”‚  è¿è¡Œæ—¶å¸¸é‡æ±         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç›´æ¥å†…å­˜ (å †å¤–)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æ¶æ„è¯´æ˜ï¼š</strong></p>
<p>JVMå†…å­˜åŒºåŸŸåˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ol>
<li>
<p><strong>çº¿ç¨‹ç§æœ‰åŒºåŸŸ</strong>ï¼ˆæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹ï¼‰ï¼š</p>
<ul>
<li>ç¨‹åºè®¡æ•°å™¨</li>
<li>è™šæ‹Ÿæœºæ ˆ</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆ</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹å…±äº«åŒºåŸŸ</strong>ï¼ˆæ‰€æœ‰çº¿ç¨‹å…±äº«ï¼‰ï¼š</p>
<ul>
<li>Javaå †</li>
<li>æ–¹æ³•åŒº</li>
</ul>
</li>
<li>
<p><strong>ç›´æ¥å†…å­˜</strong>ï¼ˆå †å¤–å†…å­˜ï¼‰ï¼š</p>
<ul>
<li>NIOä½¿ç”¨ï¼Œä¸å±äºJVMè¿è¡Œæ—¶æ•°æ®åŒº</li>
</ul>
</li>
</ol>
<h4 data-id="heading-10">2.2 å†…å­˜åŒºåŸŸåˆ†ç±»è¯´æ˜</h4>
<p><strong>çº¿ç¨‹ç§æœ‰åŒºåŸŸï¼š</strong></p>
<p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ç§æœ‰åŒºåŸŸï¼Œç§æœ‰åŒºåŸŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„é”€æ¯è€Œé”€æ¯ã€‚</p>
<ul>
<li><strong>ç¨‹åºè®¡æ•°å™¨</strong>ï¼šè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€</li>
<li><strong>è™šæ‹Ÿæœºæ ˆ</strong>ï¼šå­˜å‚¨å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ç­‰</li>
<li><strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ï¼šä¸ºNativeæ–¹æ³•æœåŠ¡</li>
</ul>
<p><strong>çº¿ç¨‹å…±äº«åŒºåŸŸï¼š</strong></p>
<p>æ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€å—å†…å­˜åŒºåŸŸï¼Œå…±äº«åŒºåŸŸåœ¨JVMå¯åŠ¨æ—¶åˆ›å»ºï¼ŒJVMå…³é—­æ—¶é”€æ¯ã€‚</p>
<ul>
<li><strong>Javaå †</strong>ï¼šå­˜å‚¨å¯¹è±¡å®ä¾‹å’Œæ•°ç»„</li>
<li><strong>æ–¹æ³•åŒº</strong>ï¼šå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰</li>
</ul>
<h4 data-id="heading-11">2.3 çº¿ç¨‹ç§æœ‰åŒºåŸŸä¸å…±äº«åŒºåŸŸçš„åŒºåˆ«å’Œä½œç”¨</h4>
<h5 data-id="heading-12">2.3.1 çº¿ç¨‹ç§æœ‰åŒºåŸŸ</h5>
<p><strong>å®šä¹‰ï¼š</strong></p>
<p>çº¿ç¨‹ç§æœ‰åŒºåŸŸæ˜¯æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹æ‹¥æœ‰çš„å†…å­˜åŒºåŸŸï¼Œçº¿ç¨‹ä¹‹é—´æ— æ³•è®¿é—®å¯¹æ–¹çš„ç§æœ‰åŒºåŸŸã€‚ç§æœ‰åŒºåŸŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„é”€æ¯è€Œé”€æ¯ã€‚</p>
<p><strong>åŒ…å«çš„åŒºåŸŸï¼š</strong></p>
<ul>
<li>ç¨‹åºè®¡æ•°å™¨</li>
<li>Javaè™šæ‹Ÿæœºæ ˆ</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆ</li>
</ul>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ol>
<li>
<p><strong>å­˜å‚¨çº¿ç¨‹ç§æœ‰çš„æ•°æ®</strong></p>
<ul>
<li>å±€éƒ¨å˜é‡ï¼šæ–¹æ³•å†…éƒ¨çš„å˜é‡</li>
<li>æ–¹æ³•å‚æ•°ï¼šæ–¹æ³•çš„å‚æ•°</li>
<li>è¿”å›å€¼ï¼šæ–¹æ³•çš„è¿”å›å€¼</li>
<li>ä¸­é—´ç»“æœï¼šè®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸´æ—¶æ•°æ®</li>
</ul>
</li>
<li>
<p><strong>è®°å½•çº¿ç¨‹çš„æ‰§è¡ŒçŠ¶æ€</strong></p>
<ul>
<li>å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤ä½ç½®ï¼ˆç¨‹åºè®¡æ•°å™¨ï¼‰</li>
<li>æ–¹æ³•è°ƒç”¨æ ˆï¼ˆè™šæ‹Ÿæœºæ ˆï¼‰</li>
<li>å¼‚å¸¸å¤„ç†ä¿¡æ¯</li>
</ul>
</li>
<li>
<p><strong>ä¿è¯çº¿ç¨‹å®‰å…¨</strong></p>
<ul>
<li>çº¿ç¨‹ç§æœ‰ï¼Œæ— éœ€åŒæ­¥</li>
<li>å¤©ç„¶çº¿ç¨‹å®‰å…¨</li>
<li>é¿å…æ•°æ®ç«äº‰</li>
</ul>
</li>
</ol>
<p><strong>å·¥ä½œæœºåˆ¶ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">çº¿ç¨‹ç§æœ‰åŒºåŸŸï¼š

çº¿ç¨‹1: <span class="hljs-section">[ç¨‹åºè®¡æ•°å™¨]</span> <span class="hljs-section">[è™šæ‹Ÿæœºæ ˆ]</span> <span class="hljs-section">[æœ¬åœ°æ–¹æ³•æ ˆ]</span>
çº¿ç¨‹2: <span class="hljs-section">[ç¨‹åºè®¡æ•°å™¨]</span> <span class="hljs-section">[è™šæ‹Ÿæœºæ ˆ]</span> <span class="hljs-section">[æœ¬åœ°æ–¹æ³•æ ˆ]</span>
çº¿ç¨‹3: <span class="hljs-section">[ç¨‹åºè®¡æ•°å™¨]</span> <span class="hljs-section">[è™šæ‹Ÿæœºæ ˆ]</span> <span class="hljs-section">[æœ¬åœ°æ–¹æ³•æ ˆ]</span>

æ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰åŒºåŸŸå®Œå…¨ç‹¬ç«‹
</code></pre>
<p><strong>å®é™…ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrivateAreaExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å±€éƒ¨å˜é‡å­˜å‚¨åœ¨ç§æœ‰åŒºåŸŸï¼ˆè™šæ‹Ÿæœºæ ˆï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">localVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;  <span class="hljs-comment">// æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„localVarå‰¯æœ¬</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-string">"test"</span>;  <span class="hljs-comment">// å¯¹è±¡å¼•ç”¨åœ¨æ ˆä¸­ï¼Œå¯¹è±¡æœ¬èº«åœ¨å †ä¸­</span>
    }
}

<span class="hljs-comment">// å¤šçº¿ç¨‹æ‰§è¡Œ</span>
<span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-type">PrivateAreaExample</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrivateAreaExample</span>();
    obj.method();  <span class="hljs-comment">// çº¿ç¨‹1æœ‰è‡ªå·±çš„æ ˆï¼Œå­˜å‚¨è‡ªå·±çš„localVar</span>
});

<span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    <span class="hljs-type">PrivateAreaExample</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrivateAreaExample</span>();
    obj.method();  <span class="hljs-comment">// çº¿ç¨‹2æœ‰è‡ªå·±çš„æ ˆï¼Œå­˜å‚¨è‡ªå·±çš„localVar</span>
});

<span class="hljs-comment">// ä¸¤ä¸ªçº¿ç¨‹çš„localVarå®Œå…¨ç‹¬ç«‹ï¼Œäº’ä¸å½±å“</span>
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li><strong>çº¿ç¨‹é—´éš”ç¦»</strong>ï¼šæ¯ä¸ªçº¿ç¨‹çš„ç§æœ‰åŒºåŸŸå®Œå…¨ç‹¬ç«‹ï¼Œäº’ä¸å½±å“</li>
<li><strong>è®¿é—®é€Ÿåº¦å¿«</strong>ï¼šæ— éœ€åŒæ­¥æœºåˆ¶ï¼Œç›´æ¥è®¿é—®ï¼Œé€Ÿåº¦å¿«</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šå†…å­˜å ç”¨ä¸çº¿ç¨‹æ•°æˆæ­£æ¯”ï¼ˆæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆï¼‰</li>
</ol>
<h5 data-id="heading-13">2.3.2 çº¿ç¨‹å…±äº«åŒºåŸŸ</h5>
<p><strong>å®šä¹‰ï¼š</strong></p>
<p>çº¿ç¨‹å…±äº«åŒºåŸŸæ˜¯æ‰€æœ‰çº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œå…±äº«åŒºåŸŸåœ¨JVMå¯åŠ¨æ—¶åˆ›å»ºï¼ŒJVMå…³é—­æ—¶é”€æ¯ã€‚æ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å…±äº«åŒºåŸŸã€‚</p>
<p><strong>åŒ…å«çš„åŒºåŸŸï¼š</strong></p>
<ul>
<li>Javaå †ï¼šå­˜å‚¨å¯¹è±¡å®ä¾‹å’Œæ•°ç»„</li>
<li>æ–¹æ³•åŒºï¼šå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰ï¼ˆåŒ…æ‹¬è¿è¡Œæ—¶å¸¸é‡æ± ï¼‰</li>
</ul>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ol>
<li>
<p><strong>å­˜å‚¨å…±äº«æ•°æ®</strong></p>
<ul>
<li>å¯¹è±¡å®ä¾‹ï¼šæ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®çš„å¯¹è±¡</li>
<li>ç±»ä¿¡æ¯ï¼šç±»çš„å…ƒæ•°æ®ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«</li>
<li>å¸¸é‡ï¼šå­—ç¬¦ä¸²å¸¸é‡ç­‰</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹é—´é€šä¿¡</strong></p>
<ul>
<li>çº¿ç¨‹é€šè¿‡å…±äº«åŒºåŸŸè¿›è¡Œæ•°æ®äº¤æ¢</li>
<li>ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºçš„å¯¹è±¡ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥é€šè¿‡å¼•ç”¨è®¿é—®</li>
</ul>
</li>
<li>
<p><strong>èµ„æºå…±äº«</strong></p>
<ul>
<li>å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªå¯¹è±¡</li>
<li>å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªç±»ä¿¡æ¯</li>
<li>æé«˜å†…å­˜åˆ©ç”¨ç‡</li>
</ul>
</li>
</ol>
<p><strong>å·¥ä½œæœºåˆ¶ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">çº¿ç¨‹å…±äº«åŒºåŸŸï¼š

     <span class="hljs-selector-attr">[Javaå †]</span> <span class="hljs-selector-attr">[æ–¹æ³•åŒº]</span>
        â†‘      â†‘
        â”‚      â”‚
   â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”
   â”‚    â”‚      â”‚  â”‚
çº¿ç¨‹<span class="hljs-number">1</span>  çº¿ç¨‹<span class="hljs-number">2</span>  çº¿ç¨‹<span class="hljs-number">3</span>

æ‰€æœ‰çº¿ç¨‹å…±äº«å †å’Œæ–¹æ³•åŒº
</code></pre>
<p><strong>å®é™…ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SharedAreaExample</span> {
    <span class="hljs-comment">// é™æ€å˜é‡å­˜å‚¨åœ¨æ–¹æ³•åŒºï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">sharedCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// æ‰€æœ‰çº¿ç¨‹å…±äº«</span>
    
    <span class="hljs-comment">// å®ä¾‹å˜é‡å­˜å‚¨åœ¨å †ä¸­ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">instanceCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// å¯¹è±¡åœ¨å †ä¸­ï¼Œæ‰€æœ‰çº¿ç¨‹å¯ä»¥é€šè¿‡å¼•ç”¨è®¿é—®</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è®¿é—®å…±äº«å˜é‡ï¼Œéœ€è¦åŒæ­¥</span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            sharedCount++;  <span class="hljs-comment">// æ‰€æœ‰çº¿ç¨‹å…±äº«åŒä¸€ä¸ªsharedCount</span>
            instanceCount++;
        }
    }
}

<span class="hljs-comment">// å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªå¯¹è±¡</span>
<span class="hljs-type">SharedAreaExample</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SharedAreaExample</span>();  <span class="hljs-comment">// å¯¹è±¡åœ¨å †ä¸­ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>

<span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    shared.increment();  <span class="hljs-comment">// çº¿ç¨‹1è®¿é—®å †ä¸­çš„å¯¹è±¡</span>
});

<span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
    shared.increment();  <span class="hljs-comment">// çº¿ç¨‹2ä¹Ÿè®¿é—®åŒä¸€ä¸ªå¯¹è±¡</span>
});

<span class="hljs-comment">// ä¸¤ä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªsharedå¯¹è±¡ï¼Œéœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</span>
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li><strong>çº¿ç¨‹é—´å…±äº«</strong>ï¼šæ‰€æœ‰çº¿ç¨‹å¯ä»¥è®¿é—®åŒä¸€ä¸ªå…±äº«åŒºåŸŸ</li>
<li><strong>éœ€è¦åŒæ­¥æœºåˆ¶</strong>ï¼šå¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«æ•°æ®æ—¶ï¼Œéœ€è¦ä½¿ç”¨synchronizedã€volatileç­‰æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šå†…å­˜å ç”¨ä¸å¯¹è±¡æ•°é‡ç›¸å…³ï¼Œä¸çº¿ç¨‹æ•°æ— å…³</li>
<li><strong>GCçš„ä¸»è¦åŒºåŸŸ</strong>ï¼šå…±äº«åŒºåŸŸæ˜¯åƒåœ¾å›æ”¶çš„ä¸»è¦åŒºåŸŸ</li>
</ol>
<h5 data-id="heading-14">2.3.3 ä¸¤è€…çš„åŒºåˆ«å¯¹æ¯”</h5>


















































<table><thead><tr><th>ç‰¹æ€§</th><th>çº¿ç¨‹ç§æœ‰åŒºåŸŸ</th><th>çº¿ç¨‹å…±äº«åŒºåŸŸ</th></tr></thead><tbody><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>ä¸çº¿ç¨‹ç›¸åŒï¼Œçº¿ç¨‹åˆ›å»ºæ—¶åˆ›å»ºï¼Œçº¿ç¨‹é”€æ¯æ—¶é”€æ¯</td><td>ä¸JVMç›¸åŒï¼ŒJVMå¯åŠ¨æ—¶åˆ›å»ºï¼ŒJVMå…³é—­æ—¶é”€æ¯</td></tr><tr><td><strong>è®¿é—®æ–¹å¼</strong></td><td>çº¿ç¨‹ç‹¬ç«‹è®¿é—®ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„åŒºåŸŸ</td><td>æ‰€æœ‰çº¿ç¨‹å…±äº«è®¿é—®åŒä¸€ä¸ªåŒºåŸŸ</td></tr><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>å¤©ç„¶çº¿ç¨‹å®‰å…¨ï¼Œæ— éœ€åŒæ­¥æœºåˆ¶</td><td>éœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</td></tr><tr><td><strong>å­˜å‚¨å†…å®¹</strong></td><td>å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ç­‰</td><td>å¯¹è±¡å®ä¾‹ã€ç±»ä¿¡æ¯ã€å¸¸é‡ç­‰</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>ä¸çº¿ç¨‹æ•°æˆæ­£æ¯”ï¼ˆæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰æ ˆï¼‰</td><td>ä¸å¯¹è±¡æ•°ç›¸å…³ï¼Œä¸çº¿ç¨‹æ•°æ— å…³</td></tr><tr><td><strong>GCå½±å“</strong></td><td>ä¸æ¶‰åŠGCï¼Œçº¿ç¨‹é”€æ¯æ—¶è‡ªåŠ¨å›æ”¶</td><td>GCçš„ä¸»è¦åŒºåŸŸï¼Œéœ€è¦åƒåœ¾å›æ”¶</td></tr><tr><td><strong>è®¿é—®é€Ÿåº¦</strong></td><td>å¿«é€Ÿï¼Œæ— éœ€åŒæ­¥ï¼Œç›´æ¥è®¿é—®</td><td>éœ€è¦åŒæ­¥ï¼Œå¯èƒ½è¾ƒæ…¢</td></tr><tr><td><strong>æ•°æ®éš”ç¦»</strong></td><td>çº¿ç¨‹é—´å®Œå…¨éš”ç¦»ï¼Œäº’ä¸å½±å“</td><td>çº¿ç¨‹é—´å¯ä»¥å…±äº«æ•°æ®</td></tr></tbody></table>
<p><strong>å®é™…åº”ç”¨åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryAreaExample</span> {
    <span class="hljs-comment">// é™æ€å˜é‡ â†’ æ–¹æ³•åŒºï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">classVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å±€éƒ¨å˜é‡ â†’ è™šæ‹Ÿæœºæ ˆï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">localVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
        
        <span class="hljs-comment">// å¯¹è±¡åˆ›å»º â†’ å †ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
        <span class="hljs-comment">// å¯¹è±¡å¼•ç”¨ â†’ è™šæ‹Ÿæœºæ ˆï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// objå¼•ç”¨åœ¨æ ˆä¸­ï¼ŒObjectå¯¹è±¡åœ¨å †ä¸­</span>
        
        <span class="hljs-comment">// é™æ€å˜é‡è®¿é—® â†’ éœ€è¦åŒæ­¥ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
        <span class="hljs-keyword">synchronized</span> (MemoryAreaExample.class) {
            classVar++;
        }
        
        <span class="hljs-comment">// å±€éƒ¨å˜é‡è®¿é—® â†’ æ— éœ€åŒæ­¥ï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
        localVar++;
    }
}
</code></pre>
<h5 data-id="heading-15">2.3.4 æ•°æ®å¦‚ä½•åœ¨ç§æœ‰åŒºåŸŸå’Œå…±äº«åŒºåŸŸä¹‹é—´æµè½¬</h5>
<p><strong>æ•°æ®æµè½¬çš„å®Œæ•´è¿‡ç¨‹ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">æ­¥éª¤1ï¼šçº¿ç¨‹ä»å…±äº«åŒºåŸŸè¯»å–å¯¹è±¡å¼•ç”¨åˆ°ç§æœ‰åŒºåŸŸ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…±äº«åŒºåŸŸï¼ˆå †ï¼‰     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  å¯¹è±¡å®ä¾‹    â”‚ â”‚
â”‚  â”‚  <span class="hljs-attr">value</span> = <span class="hljs-number">42</span>  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ è¯»å–å¼•ç”¨
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  objå¼•ç”¨     â”‚ â”‚ â† å¼•ç”¨å­˜å‚¨åœ¨æ ˆä¸­
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤2ï¼šçº¿ç¨‹åœ¨ç§æœ‰åŒºåŸŸä¸­æ“ä½œå¯¹è±¡å¼•ç”¨

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  objå¼•ç”¨     â”‚ â”‚ â† å¼•ç”¨åœ¨æ ˆä¸­
â”‚  â”‚  localVar    â”‚ â”‚ â† å±€éƒ¨å˜é‡ä¹Ÿåœ¨æ ˆä¸­
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤3ï¼šçº¿ç¨‹é€šè¿‡å¼•ç”¨è®¿é—®å…±äº«åŒºåŸŸä¸­çš„å¯¹è±¡

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     é€šè¿‡å¼•ç”¨è®¿é—®      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt; â”‚  å…±äº«åŒºåŸŸï¼ˆå †ï¼‰     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  objå¼•ç”¨     â”‚ â”‚                     â”‚  â”‚  å¯¹è±¡å®ä¾‹    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚  â”‚  <span class="hljs-attr">value</span> = <span class="hljs-number">42</span>  â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤4ï¼šä¿®æ”¹å…±äº«åŒºåŸŸä¸­çš„å¯¹è±¡ï¼ˆéœ€è¦åŒæ­¥ï¼‰

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     ä¿®æ”¹å¯¹è±¡         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt; â”‚  å…±äº«åŒºåŸŸï¼ˆå †ï¼‰     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    (éœ€è¦åŒæ­¥)      â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  objå¼•ç”¨     â”‚ â”‚                     â”‚  â”‚  å¯¹è±¡å®ä¾‹    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚  â”‚  <span class="hljs-attr">value</span> = <span class="hljs-number">43</span>  â”‚ â”‚ â† è¢«ä¿®æ”¹
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å®é™…ç¤ºä¾‹ä»£ç ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataFlowExample</span> {
    <span class="hljs-comment">// å…±äº«å˜é‡ï¼šå­˜å‚¨åœ¨å †ä¸­ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">sharedValue</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processData</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. å±€éƒ¨å˜é‡å­˜å‚¨åœ¨ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">localVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;  <span class="hljs-comment">// å­˜å‚¨åœ¨æ ˆçš„å±€éƒ¨å˜é‡è¡¨</span>
        
        <span class="hljs-comment">// 2. å¯¹è±¡å­˜å‚¨åœ¨å…±äº«åŒºåŸŸï¼ˆå †ï¼‰ï¼Œå¼•ç”¨å­˜å‚¨åœ¨ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰</span>
        <span class="hljs-type">DataFlowExample</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataFlowExample</span>();  <span class="hljs-comment">// å¯¹è±¡åœ¨å †ä¸­ï¼Œobjå¼•ç”¨åœ¨æ ˆä¸­</span>
        
        <span class="hljs-comment">// 3. é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> obj.sharedValue;  <span class="hljs-comment">// é€šè¿‡æ ˆä¸­çš„å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</span>
        
        <span class="hljs-comment">// 4. ä¿®æ”¹å †ä¸­çš„å¯¹è±¡ï¼ˆéœ€è¦åŒæ­¥ï¼Œå› ä¸ºæ˜¯å…±äº«åŒºåŸŸï¼‰</span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            obj.sharedValue = <span class="hljs-number">100</span>;  <span class="hljs-comment">// ä¿®æ”¹å †ä¸­çš„å…±äº«å˜é‡ï¼Œéœ€è¦åŒæ­¥</span>
        }
        
        <span class="hljs-comment">// 5. å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ªå¯¹è±¡</span>
        <span class="hljs-comment">// å¦‚æœå¤šä¸ªçº¿ç¨‹æŒæœ‰åŒä¸€ä¸ªobjçš„å¼•ç”¨ï¼Œå®ƒä»¬éƒ½å¯ä»¥è®¿é—®å †ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡</span>
    }
}
</code></pre>
<p><strong>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ•°æ®æµè½¬ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiThreadDataFlow</span> {
    <span class="hljs-comment">// å…±äº«å¯¹è±¡ï¼šå­˜å‚¨åœ¨å †ä¸­ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">SharedObject</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SharedObject</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// çº¿ç¨‹1</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// ä»å…±äº«åŒºåŸŸè¯»å–å¼•ç”¨ï¼ˆæ ˆä¸­çš„å¼•ç”¨æŒ‡å‘å †ä¸­çš„å¯¹è±¡ï¼‰</span>
            <span class="hljs-type">SharedObject</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> shared;  <span class="hljs-comment">// objå¼•ç”¨åœ¨æ ˆ1ä¸­ï¼ŒæŒ‡å‘å †ä¸­çš„sharedå¯¹è±¡</span>
            
            <span class="hljs-comment">// é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</span>
            obj.setValue(<span class="hljs-number">1</span>);  <span class="hljs-comment">// ä¿®æ”¹å †ä¸­çš„å¯¹è±¡</span>
        });
        
        <span class="hljs-comment">// çº¿ç¨‹2</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// ä»å…±äº«åŒºåŸŸè¯»å–å¼•ç”¨ï¼ˆæ ˆä¸­çš„å¼•ç”¨æŒ‡å‘å †ä¸­çš„å¯¹è±¡ï¼‰</span>
            <span class="hljs-type">SharedObject</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> shared;  <span class="hljs-comment">// objå¼•ç”¨åœ¨æ ˆ2ä¸­ï¼ŒæŒ‡å‘åŒä¸€ä¸ªsharedå¯¹è±¡</span>
            
            <span class="hljs-comment">// é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</span>
            obj.setValue(<span class="hljs-number">2</span>);  <span class="hljs-comment">// ä¿®æ”¹åŒä¸€ä¸ªå¯¹è±¡ï¼Œéœ€è¦åŒæ­¥</span>
        });
        
        thread1.start();
        thread2.start();
        
        <span class="hljs-comment">// ä¸¤ä¸ªçº¿ç¨‹çš„æ ˆæ˜¯ç‹¬ç«‹çš„ï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
        <span class="hljs-comment">// ä½†éƒ½é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
        <span class="hljs-comment">// éœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</span>
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SharedObject</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setValue</span><span class="hljs-params">(<span class="hljs-type">int</span> v)</span> {
        <span class="hljs-built_in">this</span>.value = v;
    }
}
</code></pre>
<h5 data-id="heading-16">2.3.5 ä¸ºä»€ä¹ˆéœ€è¦åŒºåˆ†ç§æœ‰åŒºåŸŸå’Œå…±äº«åŒºåŸŸ</h5>
<p><strong>è®¾è®¡åŸå› ï¼š</strong></p>
<ol>
<li>
<p><strong>æ€§èƒ½è€ƒè™‘</strong></p>
<ul>
<li><strong>ç§æœ‰åŒºåŸŸ</strong>ï¼šè®¿é—®å¿«é€Ÿï¼Œæ— éœ€åŒæ­¥æœºåˆ¶ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡</li>
<li><strong>å…±äº«åŒºåŸŸ</strong>ï¼šç»Ÿä¸€ç®¡ç†ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹å®‰å…¨</strong></p>
<ul>
<li><strong>ç§æœ‰åŒºåŸŸ</strong>ï¼šå¤©ç„¶çº¿ç¨‹å®‰å…¨ï¼Œé¿å…æ•°æ®ç«äº‰ï¼Œç®€åŒ–ç¼–ç¨‹</li>
<li><strong>å…±äº«åŒºåŸŸ</strong>ï¼šéœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†å…è®¸çº¿ç¨‹é—´é€šä¿¡</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜ç®¡ç†</strong></p>
<ul>
<li><strong>ç§æœ‰åŒºåŸŸ</strong>ï¼šéšçº¿ç¨‹é”€æ¯è‡ªåŠ¨å›æ”¶ï¼Œç®¡ç†ç®€å•</li>
<li><strong>å…±äº«åŒºåŸŸ</strong>ï¼šéœ€è¦GCç»Ÿä¸€ç®¡ç†ï¼Œç”Ÿå‘½å‘¨æœŸé•¿</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®éš”ç¦»</strong></p>
<ul>
<li><strong>ç§æœ‰åŒºåŸŸ</strong>ï¼šçº¿ç¨‹é—´æ•°æ®éš”ç¦»ï¼Œé¿å…ç›¸äº’å¹²æ‰°</li>
<li><strong>å…±äº«åŒºåŸŸ</strong>ï¼šå…è®¸çº¿ç¨‹é—´æ•°æ®å…±äº«å’Œé€šä¿¡ï¼Œå®ç°åä½œ</li>
</ul>
</li>
</ol>
<p><strong>å®é™…å¥½å¤„ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BenefitsExample</span> {
    <span class="hljs-comment">// å±€éƒ¨å˜é‡ï¼ˆç§æœ‰åŒºåŸŸï¼‰ï¼šæ— éœ€åŒæ­¥ï¼Œæ€§èƒ½å¥½</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// å­˜å‚¨åœ¨æ ˆä¸­ï¼Œçº¿ç¨‹ç§æœ‰ï¼Œæ— éœ€åŒæ­¥</span>
        local++;  <span class="hljs-comment">// å¿«é€Ÿï¼Œæ— éœ€åŠ é”</span>
    }
    
    <span class="hljs-comment">// å…±äº«å˜é‡ï¼ˆå…±äº«åŒºåŸŸï¼‰ï¼šéœ€è¦åŒæ­¥ï¼Œä½†å…è®¸çº¿ç¨‹é—´é€šä¿¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// å­˜å‚¨åœ¨å †ä¸­ï¼Œçº¿ç¨‹å…±äº«</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        shared++;  <span class="hljs-comment">// éœ€è¦åŒæ­¥ï¼Œä½†å…è®¸å¤šä¸ªçº¿ç¨‹åä½œ</span>
    }
}
</code></pre>
<h5 data-id="heading-17">2.3.6 å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å·¥ä½œæµç¨‹</h5>
<p><strong>å¤šçº¿ç¨‹è®¿é—®å…±äº«å¯¹è±¡çš„å®Œæ•´æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">åœºæ™¯ï¼šä¸‰ä¸ªçº¿ç¨‹è®¿é—®å †ä¸­çš„ä¸¤ä¸ªå…±äº«å¯¹è±¡

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å…±äº«åŒºåŸŸï¼ˆå †ï¼‰                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         Javaå †                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚   å¯¹è±¡<span class="hljs-selector-tag">A</span>    â”‚  â”‚   å¯¹è±¡<span class="hljs-selector-tag">B</span>    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ value = <span class="hljs-number">1</span>  â”‚  â”‚ value = <span class="hljs-number">2</span>  â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚               â”‚
            â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                               â”‚
    â†“                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç§æœ‰åŒºåŸŸ â”‚                     â”‚ ç§æœ‰åŒºåŸŸ â”‚
â”‚ (æ ˆ<span class="hljs-number">1</span>)   â”‚                     â”‚ (æ ˆ<span class="hljs-number">2</span>)   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚                     â”‚ â”Œâ”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚objA â”‚ â”‚                     â”‚ â”‚objB â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚ â””â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†‘                               â†‘
    â”‚                               â”‚
    â”‚                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çº¿ç¨‹<span class="hljs-number">1</span>   â”‚                     â”‚ çº¿ç¨‹<span class="hljs-number">2</span>   â”‚
â”‚ è®¿é—®<span class="hljs-selector-tag">A</span>   â”‚                     â”‚ è®¿é—®<span class="hljs-selector-tag">B</span>   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â”‚
            â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ç§æœ‰åŒºåŸŸ      â”‚
    â”‚  (æ ˆ<span class="hljs-number">3</span>)        â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚objAå¼•ç”¨ â”‚  â”‚ â† ä¹ŸæŒ‡å‘å¯¹è±¡<span class="hljs-selector-tag">A</span>
    â”‚  â”‚objBå¼•ç”¨ â”‚  â”‚ â† ä¹ŸæŒ‡å‘å¯¹è±¡<span class="hljs-selector-tag">B</span>
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†‘
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çº¿ç¨‹<span class="hljs-number">3</span>   â”‚
â”‚ è®¿é—®<span class="hljs-selector-tag">A</span>å’Œ<span class="hljs-selector-tag">B</span>â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å·¥ä½œæµç¨‹ï¼š
<span class="hljs-number">1</span>. æ¯ä¸ªçº¿ç¨‹çš„æ ˆæ˜¯ç‹¬ç«‹çš„ï¼ˆç§æœ‰åŒºåŸŸï¼‰
<span class="hljs-number">2</span>. å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«å †ä¸­çš„å¯¹è±¡ï¼ˆå…±äº«åŒºåŸŸï¼‰
<span class="hljs-number">3</span>. çº¿ç¨‹é€šè¿‡æ ˆä¸­çš„å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡
<span class="hljs-number">4</span>. è®¿é—®å…±äº«å¯¹è±¡éœ€è¦åŒæ­¥æœºåˆ¶ï¼ˆsynchronizedã€volatileç­‰ï¼‰
</code></pre>
<p><strong>å®é™…ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiThreadWorkflow</span> {
    <span class="hljs-comment">// å…±äº«å¯¹è±¡ï¼šå­˜å‚¨åœ¨å †ä¸­ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">SharedResource</span> <span class="hljs-variable">resource1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SharedResource</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">SharedResource</span> <span class="hljs-variable">resource2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SharedResource</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// çº¿ç¨‹1ï¼šè®¿é—®resource1</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// obj1å¼•ç”¨å­˜å‚¨åœ¨æ ˆ1ä¸­ï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
            <span class="hljs-type">SharedResource</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> resource1;  <span class="hljs-comment">// å¼•ç”¨æŒ‡å‘å †ä¸­çš„resource1</span>
            
            <span class="hljs-comment">// é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
            <span class="hljs-keyword">synchronized</span> (obj1) {
                obj1.doWork();
            }
        });
        
        <span class="hljs-comment">// çº¿ç¨‹2ï¼šè®¿é—®resource2</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// obj2å¼•ç”¨å­˜å‚¨åœ¨æ ˆ2ä¸­ï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
            <span class="hljs-type">SharedResource</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> resource2;  <span class="hljs-comment">// å¼•ç”¨æŒ‡å‘å †ä¸­çš„resource2</span>
            
            <span class="hljs-comment">// é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
            <span class="hljs-keyword">synchronized</span> (obj2) {
                obj2.doWork();
            }
        });
        
        <span class="hljs-comment">// çº¿ç¨‹3ï¼šåŒæ—¶è®¿é—®resource1å’Œresource2</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">thread3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// obj1å’Œobj2å¼•ç”¨å­˜å‚¨åœ¨æ ˆ3ä¸­ï¼ˆç§æœ‰åŒºåŸŸï¼‰</span>
            <span class="hljs-type">SharedResource</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> resource1;  <span class="hljs-comment">// å¼•ç”¨æŒ‡å‘å †ä¸­çš„resource1</span>
            <span class="hljs-type">SharedResource</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> resource2;  <span class="hljs-comment">// å¼•ç”¨æŒ‡å‘å †ä¸­çš„resource2</span>
            
            <span class="hljs-comment">// é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
            <span class="hljs-keyword">synchronized</span> (obj1) {
                obj1.doWork();
            }
            <span class="hljs-keyword">synchronized</span> (obj2) {
                obj2.doWork();
            }
        });
        
        thread1.start();
        thread2.start();
        thread3.start();
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SharedResource</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å·¥ä½œä»£ç </span>
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹æ€»ç»“ï¼š</strong></p>
<ol>
<li><strong>ç§æœ‰åŒºåŸŸï¼ˆæ ˆï¼‰å­˜å‚¨å¼•ç”¨</strong>ï¼šå¯¹è±¡å¼•ç”¨å­˜å‚¨åœ¨æ ˆä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„æ ˆ</li>
<li><strong>å…±äº«åŒºåŸŸï¼ˆå †ï¼‰å­˜å‚¨å¯¹è±¡</strong>ï¼šå¯¹è±¡æœ¬èº«å­˜å‚¨åœ¨å †ä¸­ï¼Œæ‰€æœ‰çº¿ç¨‹å¯ä»¥å…±äº«</li>
<li><strong>é€šè¿‡å¼•ç”¨è®¿é—®å¯¹è±¡</strong>ï¼šçº¿ç¨‹é€šè¿‡æ ˆä¸­çš„å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</li>
<li><strong>éœ€è¦åŒæ­¥æœºåˆ¶</strong>ï¼šå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå…±äº«å¯¹è±¡æ—¶ï¼Œéœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</li>
</ol>
<h4 data-id="heading-18">2.4 å†…å­˜åŒºåŸŸå¤§å°å…³ç³»å›¾</h4>
<pre><code class="hljs language-scss" lang="scss">å†…å­˜å¤§å°å…³ç³»ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Javaå †(æœ€å¤§)â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   æ–¹æ³•åŒº    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è™šæ‹Ÿæœºæ ˆ   â”‚ (æ¯ä¸ªçº¿ç¨‹)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¨‹åºè®¡æ•°å™¨  â”‚ (å¾ˆå°)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç›´æ¥å†…å­˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å¤§å°å…³ç³»è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>Javaå †</strong>ï¼šæœ€å¤§ï¼Œé€šå¸¸å JVMå†…å­˜çš„å¤§éƒ¨åˆ†ï¼ˆå¦‚-Xmxè®¾ç½®çš„å †å¤§å°ï¼‰</li>
<li><strong>æ–¹æ³•åŒº</strong>ï¼šä¸­ç­‰ï¼Œå­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ç­‰ï¼ˆé€šå¸¸å‡ åMBåˆ°å‡ ç™¾MBï¼‰</li>
<li><strong>è™šæ‹Ÿæœºæ ˆ</strong>ï¼šè¾ƒå°ï¼Œæ¯ä¸ªçº¿ç¨‹çº¦1MBï¼ˆçº¿ç¨‹æ•° Ã— 1MBï¼‰</li>
<li><strong>ç¨‹åºè®¡æ•°å™¨</strong>ï¼šå¾ˆå°ï¼Œå¯ä»¥å¿½ç•¥</li>
<li><strong>ç›´æ¥å†…å­˜</strong>ï¼šå¤§å°å–å†³äºä½¿ç”¨æƒ…å†µ</li>
</ol>
<h4 data-id="heading-19">2.5 å¯¹è±¡åœ¨å†…å­˜ä¸­çš„æµè½¬å›¾</h4>
<pre><code class="hljs language-markdown" lang="markdown">å¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼š

åˆ›å»º â†’ EdenåŒº â†’ Minor GC â†’ SurvivoråŒº â†’ å¹´é¾„å¢é•¿ â†’ è€å¹´ä»£ â†’ Full GC â†’ å›æ”¶

è¯¦ç»†æµç¨‹ï¼š
<span class="hljs-bullet">1.</span> åˆ›å»ºå¯¹è±¡ â†’ EdenåŒº
<span class="hljs-bullet">2.</span> EdenåŒºæ»¡ â†’ Minor GC â†’ å­˜æ´»å¯¹è±¡ â†’ SurvivoråŒº
<span class="hljs-bullet">3.</span> å¤šæ¬¡GCå â†’ å¹´é¾„è¾¾åˆ°é˜ˆå€¼ â†’ è€å¹´ä»£
<span class="hljs-bullet">4.</span> è€å¹´ä»£æ»¡ â†’ Full GC â†’ å¯¹è±¡å›æ”¶
</code></pre>
<p><strong>æµè½¬è¿‡ç¨‹è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>å¯¹è±¡åˆ›å»º</strong>ï¼šæ–°å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨EdenåŒº</li>
<li><strong>Minor GC</strong>ï¼šå½“EdenåŒºæ»¡æ—¶ï¼Œè§¦å‘Minor GCï¼Œå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°SurvivoråŒº</li>
<li><strong>SurvivoråŒºå¤åˆ¶</strong>ï¼šå¯¹è±¡åœ¨SurvivoråŒºçš„Fromå’ŒToä¹‹é—´æ¥å›å¤åˆ¶ï¼Œæ¯ç»å†ä¸€æ¬¡GCï¼Œå¹´é¾„+1</li>
<li><strong>æ™‹å‡è€å¹´ä»£</strong>ï¼šå¯¹è±¡å¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼ˆé»˜è®¤15ï¼‰åï¼Œæ™‹å‡åˆ°è€å¹´ä»£</li>
<li><strong>Full GC</strong>ï¼šè€å¹´ä»£æ»¡æ—¶ï¼Œè§¦å‘Full GCï¼Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡</li>
</ol>
<p><strong>å®é™…ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectLifecycle</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createObjects</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. åˆ›å»ºå¯¹è±¡ â†’ åˆ†é…åœ¨EdenåŒº</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// æ–°å¯¹è±¡åœ¨EdenåŒº</span>
        
        <span class="hljs-comment">// 2. å¦‚æœEdenåŒºæ»¡äº†ï¼Œè§¦å‘Minor GC</span>
        <span class="hljs-comment">// å­˜æ´»çš„å¯¹è±¡ä¼šè¢«å¤åˆ¶åˆ°SurvivoråŒº</span>
        
        <span class="hljs-comment">// 3. å¯¹è±¡åœ¨SurvivoråŒºä¹‹é—´å¤åˆ¶</span>
        <span class="hljs-comment">// æ¯æ¬¡GCï¼Œå¯¹è±¡å¹´é¾„+1</span>
        
        <span class="hljs-comment">// 4. å¹´é¾„è¾¾åˆ°é˜ˆå€¼ â†’ æ™‹å‡åˆ°è€å¹´ä»£</span>
        <span class="hljs-comment">// é»˜è®¤å¹´é¾„é˜ˆå€¼æ˜¯15</span>
        
        <span class="hljs-comment">// 5. è€å¹´ä»£æ»¡æ—¶ â†’ è§¦å‘Full GC</span>
        <span class="hljs-comment">// å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-20">ç¬¬ä¸‰éƒ¨åˆ†ï¼šå„å†…å­˜åŒºåŸŸè¯¦è§£</h2>
<h3 data-id="heading-21">3. ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰</h3>
<h4 data-id="heading-22">3.1 ä½œç”¨</h4>
<p>ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—å¾ˆå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚</p>
<p><strong>å…·ä½“ä½œç”¨ï¼š</strong></p>
<ul>
<li>è®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€</li>
<li>çº¿ç¨‹ç§æœ‰ï¼Œæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹</li>
<li>åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰éƒ½éœ€è¦ä¾èµ–ç¨‹åºè®¡æ•°å™¨æ¥å®Œæˆ</li>
</ul>
<p><strong>å·¥ä½œç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;      <span class="hljs-comment">// ç¨‹åºè®¡æ•°å™¨æŒ‡å‘è¿™æ¡æŒ‡ä»¤</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;      <span class="hljs-comment">// ç¨‹åºè®¡æ•°å™¨ç§»åŠ¨åˆ°ä¸‹ä¸€æ¡æŒ‡ä»¤</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> a + b;  <span class="hljs-comment">// ç¨‹åºè®¡æ•°å™¨ç»§ç»­ç§»åŠ¨</span>
}
</code></pre>
<h4 data-id="heading-23">3.2 ç‰¹ç‚¹</h4>
<ol>
<li>
<p><strong>å”¯ä¸€ä¸ä¼šå‘ç”ŸOutOfMemoryErrorçš„åŒºåŸŸ</strong></p>
<ul>
<li>ç¨‹åºè®¡æ•°å™¨å ç”¨çš„å†…å­˜å¾ˆå°ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥</li>
<li>ä¸ä¼šå› ä¸ºç¨‹åºè®¡æ•°å™¨çš„åŸå› å¯¼è‡´å†…å­˜æº¢å‡º</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹ç§æœ‰</strong></p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨</li>
<li>çº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“</li>
</ul>
</li>
<li>
<p><strong>æ‰§è¡ŒNativeæ–¹æ³•æ—¶å€¼ä¸ºç©º</strong></p>
<ul>
<li>å½“çº¿ç¨‹æ‰§è¡ŒJavaæ–¹æ³•æ—¶ï¼Œç¨‹åºè®¡æ•°å™¨è®°å½•çš„æ˜¯æ­£åœ¨æ‰§è¡Œçš„è™šæ‹Ÿæœºå­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€</li>
<li>å½“çº¿ç¨‹æ‰§è¡ŒNativeæ–¹æ³•ï¼ˆæœ¬åœ°æ–¹æ³•ï¼‰æ—¶ï¼Œç¨‹åºè®¡æ•°å™¨çš„å€¼ä¸ºç©ºï¼ˆundefinedï¼‰</li>
</ul>
</li>
</ol>
<p><strong>ç¤ºæ„å›¾ï¼š</strong></p>
<pre><code class="hljs">çº¿ç¨‹1ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¨‹åºè®¡æ•°å™¨   â”‚
â”‚ åœ°å€ï¼š0x100  â”‚ â† æŒ‡å‘å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çº¿ç¨‹2ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¨‹åºè®¡æ•°å™¨   â”‚
â”‚ åœ°å€ï¼š0x200  â”‚ â† æŒ‡å‘å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤ï¼ˆç‹¬ç«‹ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çº¿ç¨‹3ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¨‹åºè®¡æ•°å™¨   â”‚
â”‚ åœ°å€ï¼š0x300  â”‚ â† æŒ‡å‘å½“å‰æ‰§è¡Œçš„æŒ‡ä»¤ï¼ˆç‹¬ç«‹ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-24">3.3 å®é™…åº”ç”¨</h4>
<p><strong>1. çº¿ç¨‹åˆ‡æ¢æ—¶ä¿å­˜å’Œæ¢å¤æ‰§è¡Œä½ç½®</strong></p>
<p>å½“CPUä»ä¸€ä¸ªçº¿ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œéœ€è¦ï¼š</p>
<ul>
<li>ä¿å­˜å½“å‰çº¿ç¨‹çš„ç¨‹åºè®¡æ•°å™¨å€¼</li>
<li>æ¢å¤ä¸‹ä¸€ä¸ªçº¿ç¨‹çš„ç¨‹åºè®¡æ•°å™¨å€¼</li>
<li>è¿™æ ·çº¿ç¨‹æ¢å¤æ—¶æ‰èƒ½ä»ä¸Šæ¬¡æ‰§è¡Œçš„ä½ç½®ç»§ç»­æ‰§è¡Œ</li>
</ul>
<p><strong>2. åˆ†æ”¯ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ç­‰æ§åˆ¶æµçš„åŸºç¡€</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    <span class="hljs-keyword">if</span> (x &gt; <span class="hljs-number">5</span>) {        <span class="hljs-comment">// ç¨‹åºè®¡æ•°å™¨è®°å½•ifåˆ¤æ–­çš„æŒ‡ä»¤åœ°å€</span>
        x = <span class="hljs-number">20</span>;         <span class="hljs-comment">// å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œè·³è½¬åˆ°è¿™é‡Œ</span>
    } <span class="hljs-keyword">else</span> {
        x = <span class="hljs-number">0</span>;          <span class="hljs-comment">// å¦‚æœæ¡ä»¶ä¸ºå‡ï¼Œè·³è½¬åˆ°è¿™é‡Œ</span>
    }
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {  <span class="hljs-comment">// ç¨‹åºè®¡æ•°å™¨è®°å½•å¾ªç¯çš„æŒ‡ä»¤åœ°å€</span>
        <span class="hljs-comment">// å¾ªç¯ä½“</span>
    }
}
</code></pre>
<h3 data-id="heading-25">4. Javaè™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stackï¼‰</h3>
<h4 data-id="heading-26">4.1 ä½œç”¨</h4>
<p>Javaè™šæ‹Ÿæœºæ ˆæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚è™šæ‹Ÿæœºæ ˆæè¿°çš„æ˜¯Javaæ–¹æ³•æ‰§è¡Œçš„å†…å­˜æ¨¡å‹ã€‚</p>
<p><strong>ä¸»è¦ä½œç”¨ï¼š</strong></p>
<ul>
<li>å­˜å‚¨å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€ä¸­é—´ç»“æœç­‰</li>
<li>æ¯ä¸ªæ–¹æ³•åœ¨æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼ˆStack Frameï¼‰ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯</li>
<li>æ¯ä¸ªæ–¹æ³•ä»è°ƒç”¨åˆ°æ‰§è¡Œå®Œæˆçš„è¿‡ç¨‹ï¼Œå°±å¯¹åº”ç€ä¸€ä¸ªæ ˆå¸§åœ¨è™šæ‹Ÿæœºæ ˆä¸­ä»å…¥æ ˆåˆ°å‡ºæ ˆçš„è¿‡ç¨‹</li>
</ul>
<p><strong>å®é™…ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodA</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;        <span class="hljs-comment">// å±€éƒ¨å˜é‡ï¼Œå­˜å‚¨åœ¨methodAçš„æ ˆå¸§ä¸­</span>
    methodB();        <span class="hljs-comment">// è°ƒç”¨methodBï¼Œåˆ›å»ºmethodBçš„æ ˆå¸§</span>
    <span class="hljs-comment">// methodBæ‰§è¡Œå®Œåï¼ŒmethodBçš„æ ˆå¸§å‡ºæ ˆ</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodB</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;        <span class="hljs-comment">// å±€éƒ¨å˜é‡ï¼Œå­˜å‚¨åœ¨methodBçš„æ ˆå¸§ä¸­</span>
    methodC();        <span class="hljs-comment">// è°ƒç”¨methodCï¼Œåˆ›å»ºmethodCçš„æ ˆå¸§</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">methodC</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;        <span class="hljs-comment">// å±€éƒ¨å˜é‡ï¼Œå­˜å‚¨åœ¨methodCçš„æ ˆå¸§ä¸­</span>
}

<span class="hljs-comment">// æ ˆå¸§ç»“æ„ï¼š</span>
<span class="hljs-comment">// â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-comment">// â”‚ methodCæ ˆå¸§ â”‚ â† æ ˆé¡¶ï¼ˆå½“å‰æ‰§è¡Œçš„æ–¹æ³•ï¼‰</span>
<span class="hljs-comment">// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="hljs-comment">// â”‚ methodBæ ˆå¸§ â”‚</span>
<span class="hljs-comment">// â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="hljs-comment">// â”‚ methodAæ ˆå¸§ â”‚</span>
<span class="hljs-comment">// â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre>
<h4 data-id="heading-27">4.2 æ ˆå¸§ç»“æ„å›¾</h4>
<pre><code class="hljs">æ ˆå¸§ç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å±€éƒ¨å˜é‡è¡¨   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ“ä½œæ•°æ ˆ     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŠ¨æ€é“¾æ¥     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–¹æ³•è¿”å›åœ°å€ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-28">4.3 æ ˆå¸§å„éƒ¨åˆ†è¯¦è§£</h4>
<p><strong>1. å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variablesï¼‰</strong></p>
<p>å±€éƒ¨å˜é‡è¡¨æ˜¯ä¸€ç»„å˜é‡å€¼å­˜å‚¨ç©ºé—´ï¼Œç”¨äºå­˜æ”¾æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…éƒ¨å®šä¹‰çš„å±€éƒ¨å˜é‡ã€‚</p>
<p><strong>å­˜å‚¨å†…å®¹ï¼š</strong></p>
<ul>
<li>æ–¹æ³•å‚æ•°ï¼šä¼ å…¥æ–¹æ³•çš„å‚æ•°</li>
<li>å±€éƒ¨å˜é‡ï¼šæ–¹æ³•å†…éƒ¨å®šä¹‰çš„å˜é‡</li>
<li>å¯¹è±¡å¼•ç”¨ï¼šå¯¹è±¡çš„å¼•ç”¨ï¼ˆå¯¹è±¡æœ¬èº«åœ¨å †ä¸­ï¼‰</li>
</ul>
<p><strong>æ§½ï¼ˆSlotï¼‰çš„æ¦‚å¿µï¼š</strong></p>
<ul>
<li>å±€éƒ¨å˜é‡è¡¨ä»¥å˜é‡æ§½ï¼ˆSlotï¼‰ä¸ºæœ€å°å•ä½</li>
<li>32ä½æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€referenceï¼‰å ç”¨1ä¸ªSlot</li>
<li>64ä½æ•°æ®ç±»å‹ï¼ˆlongã€doubleï¼‰å ç”¨2ä¸ªSlot</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">(<span class="hljs-type">int</span> param1, <span class="hljs-type">long</span> param2)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">local1</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;      <span class="hljs-comment">// å ç”¨1ä¸ªSlot</span>
    <span class="hljs-type">long</span> <span class="hljs-variable">local2</span> <span class="hljs-operator">=</span> <span class="hljs-number">20L</span>;    <span class="hljs-comment">// å ç”¨2ä¸ªSlot</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¼•ç”¨å ç”¨1ä¸ªSlotï¼Œå¯¹è±¡åœ¨å †ä¸­</span>
}
</code></pre>
<p><strong>2. æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰</strong></p>
<p>æ“ä½œæ•°æ ˆæ˜¯ä¸€ä¸ªåè¿›å…ˆå‡ºï¼ˆLIFOï¼‰çš„æ ˆï¼Œç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸­é—´ç»“æœã€‚</p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>ä¿å­˜è®¡ç®—è¿‡ç¨‹ä¸­çš„ä¸´æ—¶ç»“æœ</li>
<li>ä¸ºå…¶ä»–æŒ‡ä»¤æä¾›æ“ä½œæ•°</li>
<li>å­˜æ”¾æ–¹æ³•è°ƒç”¨çš„å‚æ•°å’Œè¿”å›å€¼</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">calculate</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;      <span class="hljs-comment">// æ“ä½œæ•°æ ˆï¼špush 10</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;      <span class="hljs-comment">// æ“ä½œæ•°æ ˆï¼špush 20</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> a + b;   <span class="hljs-comment">// æ“ä½œæ•°æ ˆï¼špop 20, pop 10, push 30</span>
    <span class="hljs-keyword">return</span> c;        <span class="hljs-comment">// æ“ä½œæ•°æ ˆï¼špop 30ä½œä¸ºè¿”å›å€¼</span>
}
</code></pre>
<p><strong>3. åŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰</strong></p>
<p>åŠ¨æ€é“¾æ¥æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± ä¸­è¯¥æ ˆå¸§æ‰€å±æ–¹æ³•çš„å¼•ç”¨ã€‚</p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>åœ¨æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå°†ç¬¦å·å¼•ç”¨è½¬æ¢ä¸ºç›´æ¥å¼•ç”¨</li>
<li>æ”¯æŒå¤šæ€ï¼šåœ¨è¿è¡Œæ—¶ç¡®å®šå®é™…è°ƒç”¨çš„æ–¹æ³•</li>
</ul>
<p><strong>4. æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn Addressï¼‰</strong></p>
<p>æ–¹æ³•è¿”å›åœ°å€å­˜å‚¨æ–¹æ³•é€€å‡ºåè¿”å›åˆ°å“ªæ¡æŒ‡ä»¤ç»§ç»­æ‰§è¡Œã€‚</p>
<p><strong>ä¸¤ç§æƒ…å†µï¼š</strong></p>
<ul>
<li><strong>æ­£å¸¸è¿”å›</strong>ï¼šæ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›åˆ°è°ƒç”¨è€…çš„ä¸‹ä¸€æ¡æŒ‡ä»¤</li>
<li><strong>å¼‚å¸¸è¿”å›</strong>ï¼šæ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œé€šè¿‡å¼‚å¸¸å¤„ç†è¡¨ç¡®å®šè¿”å›åœ°å€</li>
</ul>
<h4 data-id="heading-29">4.4 æ ˆçš„å¼‚å¸¸</h4>
<p><strong>1. StackOverflowErrorï¼ˆæ ˆæº¢å‡ºé”™è¯¯ï¼‰</strong></p>
<p>å½“çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦è¶…è¿‡è™šæ‹Ÿæœºå…è®¸çš„æœ€å¤§æ·±åº¦æ—¶ï¼Œä¼šæŠ›å‡ºStackOverflowErrorã€‚</p>
<p><strong>äº§ç”ŸåŸå› ï¼š</strong></p>
<ul>
<li>é€’å½’è°ƒç”¨è¿‡æ·±</li>
<li>å±€éƒ¨å˜é‡è¿‡å¤š</li>
<li>æ–¹æ³•è°ƒç”¨é“¾è¿‡é•¿</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StackOverflow</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recursive</span><span class="hljs-params">()</span> {
        count++;  <span class="hljs-comment">// æ¯æ¬¡é€’å½’ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ ˆå¸§</span>
        recursive();  <span class="hljs-comment">// æ— é™é€’å½’ï¼Œæ ˆå¸§ä¸æ–­å…¥æ ˆï¼Œæœ€ç»ˆæ ˆæº¢å‡º</span>
    }
}
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>ä¼˜åŒ–é€’å½’ç®—æ³•ï¼Œæ”¹ä¸ºè¿­ä»£</li>
<li>å‡å°‘å±€éƒ¨å˜é‡</li>
<li>å¢åŠ æ ˆå¤§å°ï¼ˆ-Xsså‚æ•°ï¼‰</li>
</ul>
<p><strong>2. OutOfMemoryErrorï¼ˆå†…å­˜æº¢å‡ºé”™è¯¯ï¼‰</strong></p>
<p>å¦‚æœè™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œå½“æ‰©å±•æ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜æ—¶ï¼Œä¼šæŠ›å‡ºOutOfMemoryErrorã€‚</p>
<p><strong>äº§ç”ŸåŸå› ï¼š</strong></p>
<ul>
<li>åˆ›å»ºçº¿ç¨‹è¿‡å¤šï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦æ ˆç©ºé—´</li>
<li>æ ˆè®¾ç½®è¿‡å¤§ï¼Œå¯¼è‡´æ€»å†…å­˜ä¸è¶³</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StackOOM</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                    <span class="hljs-comment">// çº¿ç¨‹ä¸é€€å‡ºï¼Œæ ˆç©ºé—´ä¸é‡Šæ”¾</span>
                }
            }).start();  <span class="hljs-comment">// åˆ›å»ºè¿‡å¤šçº¿ç¨‹ï¼Œå¯¼è‡´OOM</span>
        }
    }
}
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>å‡å°‘çº¿ç¨‹æ•°</li>
<li>å‡å°æ ˆå¤§å°</li>
<li>ä¼˜åŒ–çº¿ç¨‹ä½¿ç”¨æ–¹å¼</li>
</ul>
<h4 data-id="heading-30">4.5 æ ˆå¤§å°è®¾ç½®</h4>
<p><strong>-Xsså‚æ•°ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">-Xss1m  <span class="hljs-comment">// è®¾ç½®æ ˆå¤§å°ä¸º1MB</span>
-Xss2m  <span class="hljs-comment">// è®¾ç½®æ ˆå¤§å°ä¸º2MB</span>
</code></pre>
<p><strong>é»˜è®¤å€¼ï¼š</strong></p>
<ul>
<li>ä¸åŒå¹³å°å’ŒJVMç‰ˆæœ¬ä¸åŒ</li>
<li>é€šå¸¸ä¸º1MBå·¦å³ï¼ˆLinux/x86ï¼š1024KBï¼ŒWindowsï¼šé»˜è®¤ä¾èµ–äºè™šæ‹Ÿå†…å­˜ï¼‰</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li>æ ˆå¤§å°è®¾ç½®è¿‡å°ï¼šå¯èƒ½å¯¼è‡´StackOverflowError</li>
<li>æ ˆå¤§å°è®¾ç½®è¿‡å¤§ï¼šå¯èƒ½æµªè´¹å†…å­˜ï¼Œæˆ–å¯¼è‡´å¯åˆ›å»ºçš„çº¿ç¨‹æ•°å‡å°‘</li>
</ul>
<h4 data-id="heading-31">4.6 ä¸JMMå·¥ä½œå†…å­˜çš„å…³ç³»</h4>
<p><strong>å¯¹åº”å…³ç³»ï¼š</strong></p>
<ul>
<li>JMMä¸­çš„"å·¥ä½œå†…å­˜"ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„"è™šæ‹Ÿæœºæ ˆå±€éƒ¨å˜é‡è¡¨"</li>
<li>å±€éƒ¨å˜é‡è¡¨ä¸­å­˜å‚¨çš„å˜é‡å‰¯æœ¬å°±æ˜¯JMMå·¥ä½œå†…å­˜çš„å†…å®¹</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JMMRelation</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// ä¸»å†…å­˜ï¼ˆå †ï¼‰</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> shared;  <span class="hljs-comment">// ä»ä¸»å†…å­˜è¯»å–åˆ°å·¥ä½œå†…å­˜ï¼ˆå±€éƒ¨å˜é‡è¡¨ï¼‰</span>
        local = local + <span class="hljs-number">1</span>;   <span class="hljs-comment">// åœ¨å·¥ä½œå†…å­˜ä¸­è®¡ç®—</span>
        shared = local;      <span class="hljs-comment">// å†™å›ä¸»å†…å­˜ï¼ˆå †ï¼‰</span>
    }
}
</code></pre>
<h3 data-id="heading-32">5. æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</h3>
<h4 data-id="heading-33">5.1 ä½œç”¨</h4>
<p>æœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ ˆçš„ä½œç”¨éå¸¸ç›¸ä¼¼ï¼ŒåŒºåˆ«åœ¨äºï¼š</p>
<ul>
<li>è™šæ‹Ÿæœºæ ˆä¸ºJavaæ–¹æ³•æœåŠ¡</li>
<li>æœ¬åœ°æ–¹æ³•æ ˆä¸ºNativeæ–¹æ³•ï¼ˆæœ¬åœ°æ–¹æ³•ï¼‰æœåŠ¡</li>
</ul>
<p><strong>Nativeæ–¹æ³•ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨nativeå…³é”®å­—å£°æ˜çš„æ–¹æ³•</li>
<li>é€šå¸¸ç”¨C/C++ç­‰è¯­è¨€å®ç°</li>
<li>é€šè¿‡JNIï¼ˆJava Native Interfaceï¼‰è°ƒç”¨</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NativeExample</span> {
    <span class="hljs-comment">// Nativeæ–¹æ³•å£°æ˜</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">nativeMethod</span><span class="hljs-params">()</span>;
    
    <span class="hljs-keyword">static</span> {
        <span class="hljs-comment">// åŠ è½½æœ¬åœ°åº“</span>
        System.loadLibrary(<span class="hljs-string">"nativeLib"</span>);
    }
}
</code></pre>
<h4 data-id="heading-34">5.2 ä¸è™šæ‹Ÿæœºæ ˆçš„åŒºåˆ«</h4>






























<table><thead><tr><th>ç‰¹æ€§</th><th>è™šæ‹Ÿæœºæ ˆ</th><th>æœ¬åœ°æ–¹æ³•æ ˆ</th></tr></thead><tbody><tr><td><strong>æœåŠ¡å¯¹è±¡</strong></td><td>Javaæ–¹æ³•</td><td>Nativeæ–¹æ³•</td></tr><tr><td><strong>å­˜å‚¨å†…å®¹</strong></td><td>Javaæ–¹æ³•çš„å±€éƒ¨å˜é‡ã€å‚æ•°ç­‰</td><td>Nativeæ–¹æ³•çš„å±€éƒ¨å˜é‡ã€å‚æ•°ç­‰</td></tr><tr><td><strong>è¯­è¨€</strong></td><td>Javaå­—èŠ‚ç </td><td>C/C++ç­‰æœ¬åœ°ä»£ç </td></tr><tr><td><strong>å®ç°</strong></td><td>JVMå®ç°</td><td>å¯èƒ½ç”±JVMæˆ–æ“ä½œç³»ç»Ÿå®ç°</td></tr></tbody></table>
<p><strong>æ³¨æ„ï¼š</strong> æœ‰äº›JVMå®ç°ï¼ˆå¦‚HotSpotï¼‰å°†è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆåˆäºŒä¸ºä¸€ã€‚</p>
<h4 data-id="heading-35">5.3 å¼‚å¸¸æƒ…å†µ</h4>
<p>æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šå‘ç”ŸStackOverflowErrorå’ŒOutOfMemoryErrorï¼ŒåŸå› å’Œè™šæ‹Ÿæœºæ ˆç±»ä¼¼ã€‚</p>
<h3 data-id="heading-36">6. Javaå †ï¼ˆJava Heapï¼‰- é‡ç‚¹</h3>
<h4 data-id="heading-37">6.1 å †çš„ç»“æ„å›¾ï¼ˆè¯¦ç»†ï¼‰</h4>
<pre><code class="hljs language-scss" lang="scss">Javaå †ç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ–°ç”Ÿä»£(<span class="hljs-number">1</span>/<span class="hljs-number">3</span>)   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  <span class="hljs-built_in">Eden</span>(<span class="hljs-number">80%</span>)â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ <span class="hljs-built_in">S0</span>(<span class="hljs-number">10%</span>)S1 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è€å¹´ä»£(<span class="hljs-number">2</span>/<span class="hljs-number">3</span>)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-38">6.2 å †çš„ä½œç”¨</h4>
<p><strong>ä¸»è¦ä½œç”¨ï¼š</strong></p>
<ol>
<li><strong>å­˜å‚¨å¯¹è±¡å®ä¾‹</strong>ï¼šæ‰€æœ‰é€šè¿‡newåˆ›å»ºçš„å¯¹è±¡éƒ½å­˜å‚¨åœ¨å †ä¸­</li>
<li><strong>å­˜å‚¨æ•°ç»„</strong>ï¼šæ•°ç»„å¯¹è±¡ä¹Ÿå­˜å‚¨åœ¨å †ä¸­</li>
<li><strong>çº¿ç¨‹å…±äº«</strong>ï¼šæ‰€æœ‰çº¿ç¨‹å…±äº«å †å†…å­˜ï¼Œçº¿ç¨‹é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeapExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createObjects</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å¯¹è±¡å­˜å‚¨åœ¨å †ä¸­</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¯¹è±¡åœ¨å †ä¸­ï¼Œobj1å¼•ç”¨åœ¨æ ˆä¸­</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¯¹è±¡åœ¨å †ä¸­ï¼Œobj2å¼•ç”¨åœ¨æ ˆä¸­</span>
        
        <span class="hljs-comment">// æ•°ç»„ä¹Ÿå­˜å‚¨åœ¨å †ä¸­</span>
        <span class="hljs-type">int</span>[] array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>];   <span class="hljs-comment">// æ•°ç»„å¯¹è±¡åœ¨å †ä¸­ï¼Œarrayå¼•ç”¨åœ¨æ ˆä¸­</span>
        
        <span class="hljs-comment">// å­—ç¬¦ä¸²å¯¹è±¡ä¹Ÿåœ¨å †ä¸­ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ä¹Ÿåœ¨å †ä¸­ï¼ŒJDK 8ä¹‹åï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Hello"</span>);  <span class="hljs-comment">// å­—ç¬¦ä¸²å¯¹è±¡åœ¨å †ä¸­</span>
    }
}
</code></pre>
<h4 data-id="heading-39">6.3 æ–°ç”Ÿä»£è¯¦è§£</h4>
<p><strong>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰çš„ä½œç”¨ï¼š</strong></p>
<p>æ–°ç”Ÿä»£æ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚å¤§éƒ¨åˆ†å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­åˆ›å»ºï¼Œå¹¶ä¸”å¾ˆå¿«å°±ä¼šè¢«å›æ”¶ã€‚</p>
<p><strong>æ–°ç”Ÿä»£çš„ç»“æ„ï¼š</strong></p>
<ol>
<li>
<p><strong>EdenåŒºï¼ˆä¼Šç”¸å›­ï¼‰</strong></p>
<ul>
<li>æ–°å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨EdenåŒº</li>
<li>çº¦å æ–°ç”Ÿä»£çš„80%</li>
<li>å¤§éƒ¨åˆ†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼Œåœ¨EdenåŒºå°±è¢«å›æ”¶</li>
</ul>
</li>
<li>
<p><strong>SurvivoråŒºï¼ˆå­˜æ´»åŒºï¼‰</strong></p>
<ul>
<li>åˆ†ä¸ºFrom Survivorå’ŒTo Survivorä¸¤ä¸ªåŒºåŸŸ</li>
<li>æ¯ä¸ªçº¦å æ–°ç”Ÿä»£çš„10%</li>
<li>ç”¨äºå­˜æ”¾Minor GCåå­˜æ´»çš„å¯¹è±¡</li>
</ul>
</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦SurvivoråŒºï¼Ÿ</strong></p>
<p>å¦‚æœæ²¡æœ‰SurvivoråŒºï¼ŒMinor GCåå­˜æ´»çš„å¯¹è±¡ä¼šç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œå¯¼è‡´ï¼š</p>
<ul>
<li>è€å¹´ä»£å¾ˆå¿«è¢«å¡«æ»¡</li>
<li>é¢‘ç¹è§¦å‘Full GC</li>
<li>å½±å“æ€§èƒ½</li>
</ul>
<p>æœ‰äº†SurvivoråŒºï¼Œå¯ä»¥ï¼š</p>
<ul>
<li>è®©å¯¹è±¡åœ¨æ–°ç”Ÿä»£å¤šå­˜æ´»å‡ æ¬¡</li>
<li>åªæœ‰çœŸæ­£é•¿æœŸå­˜æ´»çš„å¯¹è±¡æ‰è¿›å…¥è€å¹´ä»£</li>
<li>å‡å°‘Full GCçš„é¢‘ç‡</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªSurvivoråŒºï¼Ÿ</strong></p>
<p>ä½¿ç”¨ä¸¤ä¸ªSurvivoråŒºå¯ä»¥å®ç°å¤åˆ¶ç®—æ³•ï¼š</p>
<ul>
<li>Minor GCæ—¶ï¼Œå°†EdenåŒºå’ŒFrom Survivorä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°To Survivor</li>
<li>æ¸…ç©ºEdenåŒºå’ŒFrom Survivor</li>
<li>From Survivorå’ŒTo Survivorè§’è‰²äº’æ¢</li>
</ul>
<p>è¿™æ ·å¯ä»¥ï¼š</p>
<ul>
<li>ä¿è¯æ–°ç”Ÿä»£å§‹ç»ˆæœ‰ä¸€ä¸ªSurvivoråŒºæ˜¯ç©ºçš„</li>
<li>å®ç°é«˜æ•ˆçš„å¤åˆ¶ç®—æ³•</li>
<li>é¿å…å†…å­˜ç¢ç‰‡</li>
</ul>
<p><strong>å¯¹è±¡åœ¨æ–°ç”Ÿä»£ä¸­çš„æµè½¬ï¼š</strong></p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-number">1</span>. å¯¹è±¡åˆ›å»º â†’ EdenåŒº
   <span class="hljs-built_in">new</span> <span class="hljs-type">Object</span>() â†’ EdenåŒº

<span class="hljs-number">2</span>. EdenåŒºæ»¡ â†’ è§¦å‘Minor GC
   EdenåŒºæ»¡ â†’ Minor GCå¼€å§‹

<span class="hljs-number">3</span>. å­˜æ´»å¯¹è±¡ â†’ SurvivoråŒº
   EdenåŒºå­˜æ´»å¯¹è±¡ â†’ å¤åˆ¶åˆ°SurvivoråŒºï¼ˆ<span class="hljs-keyword">To</span>ï¼‰
   æ¸…ç©ºEdenåŒº

<span class="hljs-number">4</span>. å¯¹è±¡åœ¨SurvivoråŒºä¹‹é—´å¤åˆ¶
   Minor GC â†’ <span class="hljs-keyword">From</span> Survivorå­˜æ´»å¯¹è±¡ â†’ å¤åˆ¶åˆ°<span class="hljs-keyword">To</span> Survivor
   å¯¹è±¡å¹´é¾„+<span class="hljs-number">1</span>
   <span class="hljs-keyword">From</span>å’Œ<span class="hljs-keyword">To</span>è§’è‰²äº’æ¢

<span class="hljs-number">5</span>. å¹´é¾„è¾¾åˆ°é˜ˆå€¼ â†’ æ™‹å‡è€å¹´ä»£
   å¯¹è±¡å¹´é¾„è¾¾åˆ°<span class="hljs-number">15</span>ï¼ˆé»˜è®¤ï¼‰â†’ æ™‹å‡åˆ°è€å¹´ä»£
</code></pre>
<p><strong>ç¤ºä¾‹ä»£ç ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YoungGeneration</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createObjects</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ–°å¯¹è±¡åœ¨EdenåŒº</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
            <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶</span>
        }
        
        <span class="hljs-comment">// é•¿æœŸå­˜æ´»çš„å¯¹è±¡ä¼šç»å†å¤šæ¬¡GCåè¿›å…¥è€å¹´ä»£</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">longLived</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¦‚æœå¤šæ¬¡GCåä»å­˜æ´»ï¼Œä¼šè¿›å…¥è€å¹´ä»£</span>
    }
}
</code></pre>
<h4 data-id="heading-40">6.4 è€å¹´ä»£è¯¦è§£</h4>
<p><strong>è€å¹´ä»£ï¼ˆOld Generationï¼‰çš„ä½œç”¨ï¼š</strong></p>
<p>è€å¹´ä»£ç”¨äºå­˜æ”¾é•¿æœŸå­˜æ´»çš„å¯¹è±¡ã€‚ç»è¿‡å¤šæ¬¡Minor GCä»ç„¶å­˜æ´»çš„å¯¹è±¡ä¼šæ™‹å‡åˆ°è€å¹´ä»£ã€‚</p>
<p><strong>è€å¹´ä»£çš„ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li><strong>å¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿</strong>ï¼šå­˜å‚¨çš„å¯¹è±¡é€šå¸¸ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿</li>
<li><strong>GCé¢‘ç‡ä½</strong>ï¼šè€å¹´ä»£çš„GCï¼ˆFull GCï¼‰é¢‘ç‡è¾ƒä½</li>
<li><strong>GCè€—æ—¶é•¿</strong>ï¼šFull GCé€šå¸¸æ¯”Minor GCè€—æ—¶æ›´é•¿</li>
<li><strong>å ç”¨ç©ºé—´å¤§</strong>ï¼šé€šå¸¸å å †å†…å­˜çš„2/3</li>
</ol>
<p><strong>å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„æ¡ä»¶ï¼š</strong></p>
<ol>
<li><strong>å¹´é¾„è¾¾åˆ°é˜ˆå€¼</strong>ï¼šå¯¹è±¡åœ¨SurvivoråŒºä¸­ç»å†GCçš„æ¬¡æ•°è¾¾åˆ°é˜ˆå€¼ï¼ˆé»˜è®¤15æ¬¡ï¼‰</li>
<li><strong>å¤§å¯¹è±¡</strong>ï¼šè¶…è¿‡-XX:PretenureSizeThresholdè®¾ç½®çš„å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</li>
<li><strong>åŠ¨æ€å¹´é¾„åˆ¤å®š</strong>ï¼šSurvivoråŒºä¸­ç›¸åŒå¹´é¾„çš„å¯¹è±¡å¤§å°è¶…è¿‡SurvivoråŒºçš„ä¸€åŠï¼Œå¤§äºç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OldGeneration</span> {
    <span class="hljs-comment">// é•¿æœŸå­˜æ´»çš„å¯¹è±¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Object&gt; longLivedObjects = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createLongLivedObjects</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è¿™äº›å¯¹è±¡ç»è¿‡å¤šæ¬¡GCåä»å­˜æ´»ï¼Œä¼šè¿›å…¥è€å¹´ä»£</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
            <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
            longLivedObjects.add(obj);  <span class="hljs-comment">// å¯¹è±¡è¢«å¼•ç”¨ï¼Œä¸ä¼šè¢«å›æ”¶</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-41">6.5 å †çš„å¤§å°è®¾ç½®ï¼ˆç®€è¦ï¼‰</h4>
<p><strong>å¸¸ç”¨å‚æ•°ï¼š</strong></p>
<ul>
<li>
<p><strong>-Xms</strong>ï¼šåˆå§‹å †å¤§å°</p>
<ul>
<li>ä¾‹å¦‚ï¼š-Xms256mï¼ˆåˆå§‹å †256MBï¼‰</li>
</ul>
</li>
<li>
<p><strong>-Xmx</strong>ï¼šæœ€å¤§å †å¤§å°</p>
<ul>
<li>ä¾‹å¦‚ï¼š-Xmx1024mï¼ˆæœ€å¤§å †1GBï¼‰</li>
</ul>
</li>
<li>
<p><strong>-Xmn</strong>ï¼šæ–°ç”Ÿä»£å¤§å°</p>
<ul>
<li>ä¾‹å¦‚ï¼š-Xmn256mï¼ˆæ–°ç”Ÿä»£256MBï¼‰</li>
</ul>
</li>
<li>
<p><strong>-XX:NewRatio</strong>ï¼šæ–°ç”Ÿä»£ä¸è€å¹´ä»£çš„æ¯”ä¾‹</p>
<ul>
<li>ä¾‹å¦‚ï¼š-XX:NewRatio=2ï¼ˆæ–°ç”Ÿä»£:è€å¹´ä»£=1:2ï¼‰</li>
</ul>
</li>
<li>
<p><strong>-XX:SurvivorRatio</strong>ï¼šEdenä¸Survivorçš„æ¯”ä¾‹</p>
<ul>
<li>ä¾‹å¦‚ï¼š-XX:SurvivorRatio=8ï¼ˆEden:Survivor=8:1ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>è®¾ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash">java -Xms512m -Xmx1024m -Xmn256m -XX:NewRatio=2 -XX:SurvivorRatio=8 MyApp
</code></pre>
<h4 data-id="heading-42">6.6 å †çš„å¼‚å¸¸</h4>
<p><strong>OutOfMemoryError: Java heap space</strong></p>
<p>å½“å †å†…å­˜ä¸è¶³ä»¥åˆ†é…æ–°å¯¹è±¡æ—¶ï¼Œä¼šæŠ›å‡ºOutOfMemoryError: Java heap spaceã€‚</p>
<p><strong>äº§ç”ŸåŸå› ï¼š</strong></p>
<ol>
<li>å †å†…å­˜è®¾ç½®å¤ªå°</li>
<li>åˆ›å»ºçš„å¯¹è±¡å¤ªå¤š</li>
<li>å†…å­˜æ³„æ¼ï¼šå¯¹è±¡è¢«å¼•ç”¨æ— æ³•å›æ”¶</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeapOOM</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());  <span class="hljs-comment">// ä¸æ–­åˆ›å»ºå¯¹è±¡ï¼Œæœ€ç»ˆå †å†…å­˜æº¢å‡º</span>
        }
    }
}
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li>å¢åŠ å †å¤§å°ï¼š-Xmxå‚æ•°</li>
<li>ä¼˜åŒ–ä»£ç ï¼šå‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>æ’æŸ¥å†…å­˜æ³„æ¼ï¼šæ‰¾å‡ºæ— æ³•å›æ”¶çš„å¯¹è±¡</li>
</ol>
<h4 data-id="heading-43">6.7 ä¸JMMä¸»å†…å­˜çš„å…³ç³»</h4>
<p><strong>å¯¹åº”å…³ç³»ï¼š</strong></p>
<ul>
<li>JMMä¸­çš„"ä¸»å†…å­˜"ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„"å †"</li>
<li>å…±äº«å˜é‡å­˜å‚¨åœ¨å †ä¸­</li>
<li>å †æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œå¯¹åº”ä¸»å†…å­˜çš„å…±äº«ç‰¹æ€§</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeapAndJMM</span> {
    <span class="hljs-comment">// å…±äº«å˜é‡å­˜å‚¨åœ¨å †ä¸­ï¼ˆä¸»å†…å­˜ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// åœ¨å †ä¸­</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">thread1</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä»ä¸»å†…å­˜ï¼ˆå †ï¼‰è¯»å–</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> shared;  <span class="hljs-comment">// ä»å †è¯»å–åˆ°æ ˆ</span>
        local++;             <span class="hljs-comment">// åœ¨æ ˆä¸­è®¡ç®—</span>
        shared = local;      <span class="hljs-comment">// å†™å›ä¸»å†…å­˜ï¼ˆå †ï¼‰</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">thread2</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä¹Ÿä»ä¸»å†…å­˜ï¼ˆå †ï¼‰è¯»å–</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> shared;  <span class="hljs-comment">// ä»å †è¯»å–åˆ°æ ˆ</span>
        <span class="hljs-comment">// å¦‚æœthread1çš„ä¿®æ”¹è¿˜æ²¡å†™å›ï¼Œthread2å¯èƒ½çœ‹ä¸åˆ°æœ€æ–°çš„å€¼</span>
        <span class="hljs-comment">// è¿™å°±æ˜¯å¯è§æ€§é—®é¢˜</span>
    }
}
</code></pre>
<h3 data-id="heading-44">7. æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰</h3>
<h4 data-id="heading-45">7.1 æ–¹æ³•åŒºç»“æ„å›¾</h4>
<pre><code class="hljs">æ–¹æ³•åŒºç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç±»ä¿¡æ¯     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å¸¸é‡æ±      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é™æ€å˜é‡    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ JITç¼–è¯‘ä»£ç   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-46">7.2 ä½œç”¨</h4>
<p>æ–¹æ³•åŒºç”¨äºå­˜å‚¨ï¼š</p>
<ul>
<li><strong>ç±»ä¿¡æ¯</strong>ï¼šç±»çš„å…ƒæ•°æ®ã€æ–¹æ³•ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ç­‰</li>
<li><strong>å¸¸é‡</strong>ï¼šå­—ç¬¦ä¸²å¸¸é‡ã€æ•°å­—å¸¸é‡ç­‰ï¼ˆè¿è¡Œæ—¶å¸¸é‡æ± ï¼‰</li>
<li><strong>é™æ€å˜é‡</strong>ï¼šç±»å˜é‡ï¼ˆstaticä¿®é¥°çš„å˜é‡ï¼‰</li>
<li><strong>JITç¼–è¯‘åçš„ä»£ç </strong>ï¼šè¢«JITç¼–è¯‘å™¨ç¼–è¯‘åçš„æœºå™¨ç </li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MethodAreaExample</span> {
    <span class="hljs-comment">// é™æ€å˜é‡ â†’ æ–¹æ³•åŒº</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">staticVar</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;
    
    <span class="hljs-comment">// ç±»ä¿¡æ¯ â†’ æ–¹æ³•åŒº</span>
    <span class="hljs-comment">// - ç±»çš„åç§°ã€çˆ¶ç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ä¿¡æ¯éƒ½å­˜å‚¨åœ¨æ–¹æ³•åŒº</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å­—ç¬¦ä¸²å¸¸é‡ â†’ æ–¹æ³•åŒºï¼ˆè¿è¡Œæ—¶å¸¸é‡æ± ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;  <span class="hljs-comment">// "Hello"å­—ç¬¦ä¸²åœ¨æ–¹æ³•åŒºçš„å¸¸é‡æ± ä¸­</span>
    }
}
</code></pre>
<h4 data-id="heading-47">7.3 JDK 8ä¹‹å‰ï¼šæ°¸ä¹…ä»£ï¼ˆPermGenï¼‰</h4>
<p><strong>æ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>å †çš„ä¸€éƒ¨åˆ†ï¼Œä½¿ç”¨å †å†…å­˜</li>
<li>å¤§å°å›ºå®šï¼Œéœ€è¦é¢„å…ˆè®¾ç½®</li>
<li>å®¹æ˜“å‘ç”Ÿå†…å­˜æº¢å‡º</li>
</ul>
<p><strong>å¤§å°è®¾ç½®ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">-XX:<span class="hljs-attr">PermSize</span>=<span class="hljs-number">64</span>m        // åˆå§‹æ°¸ä¹…ä»£å¤§å°
-XX:<span class="hljs-attr">MaxPermSize</span>=<span class="hljs-number">256</span>m    // æœ€å¤§æ°¸ä¹…ä»£å¤§å°
</code></pre>
<p><strong>å¼‚å¸¸ï¼š</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">OutOfMemoryError: PermGen space</span>
</code></pre>
<p><strong>äº§ç”ŸåŸå› ï¼š</strong></p>
<ol>
<li>ç±»åŠ è½½è¿‡å¤š</li>
<li>å­—ç¬¦ä¸²å¸¸é‡è¿‡å¤šï¼ˆString.intern()ï¼‰</li>
<li>æ°¸ä¹…ä»£å¤§å°è®¾ç½®è¿‡å°</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PermGenOOM</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// ä¸æ–­åŠ è½½ç±»ï¼Œå¯èƒ½å¯¼è‡´æ°¸ä¹…ä»£æº¢å‡º</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100000</span>; i++) {
            <span class="hljs-comment">// åŠ¨æ€åŠ è½½ç±»</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-48">7.4 JDK 8åŠä¹‹åï¼šå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</h4>
<p><strong>å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼ˆNative Memoryï¼‰ï¼Œä¸åœ¨å †ä¸­</li>
<li>å¤§å°åŠ¨æ€è°ƒæ•´</li>
<li>ä¸å†å—JVMå †å†…å­˜é™åˆ¶</li>
<li>åªæœ‰è¾¾åˆ°MaxMetaspaceSizeæ—¶æ‰ä¼šæŠ›å‡ºå¼‚å¸¸</li>
</ul>
<p><strong>å¤§å°è®¾ç½®ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">-XX:<span class="hljs-attr">MetaspaceSize</span>=<span class="hljs-number">64</span>m        // åˆå§‹å…ƒç©ºé—´å¤§å°
-XX:<span class="hljs-attr">MaxMetaspaceSize</span>=<span class="hljs-number">256</span>m    // æœ€å¤§å…ƒç©ºé—´å¤§å°ï¼ˆé»˜è®¤æ— é™åˆ¶ï¼‰
</code></pre>
<p><strong>å¼‚å¸¸ï¼š</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">OutOfMemoryError: Metaspace</span>
</code></pre>
<p><strong>äº§ç”ŸåŸå› ï¼š</strong></p>
<ol>
<li>ç±»åŠ è½½è¿‡å¤š</li>
<li>å…ƒæ•°æ®è¿‡å¤š</li>
<li>MaxMetaspaceSizeè®¾ç½®è¿‡å°</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MetaspaceOOM</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// ä¸æ–­ç”ŸæˆåŠ¨æ€ç±»ï¼Œå¯èƒ½å¯¼è‡´å…ƒç©ºé—´æº¢å‡º</span>
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// åŠ¨æ€åˆ›å»ºç±»</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-49">7.5 æ°¸ä¹…ä»£ä¸å…ƒç©ºé—´çš„åŒºåˆ«</h4>








































<table><thead><tr><th>ç‰¹æ€§</th><th>æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰</th><th>å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</th></tr></thead><tbody><tr><td><strong>å­˜å‚¨ä½ç½®</strong></td><td>å †å†…å­˜ä¸­</td><td>æœ¬åœ°å†…å­˜ï¼ˆNative Memoryï¼‰</td></tr><tr><td><strong>å¤§å°é™åˆ¶</strong></td><td>å›ºå®šå¤§å°ï¼Œéœ€è¦é¢„å…ˆè®¾ç½®</td><td>åŠ¨æ€è°ƒæ•´ï¼Œé»˜è®¤æ— é™åˆ¶</td></tr><tr><td><strong>å†…å­˜ç®¡ç†</strong></td><td>å—JVMå †å†…å­˜é™åˆ¶</td><td>ä¸å—JVMå †å†…å­˜é™åˆ¶</td></tr><tr><td><strong>GCå½±å“</strong></td><td>GCæ•ˆç‡è¾ƒä½</td><td>GCæ•ˆç‡è¾ƒé«˜</td></tr><tr><td><strong>æº¢å‡ºé—®é¢˜</strong></td><td>å®¹æ˜“æº¢å‡º</td><td>ç›¸å¯¹ä¸å®¹æ˜“æº¢å‡º</td></tr><tr><td><strong>é€‚ç”¨ç‰ˆæœ¬</strong></td><td>JDK 8ä¹‹å‰</td><td>JDK 8åŠä¹‹å</td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆæ”¹ç”¨å…ƒç©ºé—´ï¼Ÿ</strong></p>
<ol>
<li><strong>æé«˜GCæ•ˆç‡</strong>ï¼šæ°¸ä¹…ä»£çš„GCæ•ˆç‡è¾ƒä½ï¼Œå…ƒç©ºé—´çš„GCæ•ˆç‡æ›´é«˜</li>
<li><strong>é¿å…æº¢å‡º</strong>ï¼šæ°¸ä¹…ä»£å›ºå®šå¤§å°å®¹æ˜“æº¢å‡ºï¼Œå…ƒç©ºé—´åŠ¨æ€è°ƒæ•´</li>
<li><strong>æ›´å¥½çš„å†…å­˜ç®¡ç†</strong>ï¼šå…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œç®¡ç†æ›´çµæ´»</li>
<li><strong>ä¸HotSpotåˆ†ç¦»</strong>ï¼šå…ƒç©ºé—´çš„å®ç°ä¸HotSpotåˆ†ç¦»ï¼Œæ›´å®¹æ˜“ä¼˜åŒ–</li>
</ol>
<h4 data-id="heading-50">7.6 æ–¹æ³•åŒºçš„å›æ”¶</h4>
<p><strong>æ–¹æ³•åŒºçš„å›æ”¶ä¸»è¦åŒ…æ‹¬ï¼š</strong></p>
<ol>
<li>
<p><strong>å¸¸é‡æ± çš„å›æ”¶</strong></p>
<ul>
<li>å¸¸é‡æ± ä¸­çš„å¸¸é‡å¦‚æœæ²¡æœ‰è¢«å¼•ç”¨ï¼Œå¯ä»¥è¢«å›æ”¶</li>
<li>å­—ç¬¦ä¸²å¸¸é‡çš„å›æ”¶</li>
</ul>
</li>
<li>
<p><strong>ç±»å‹çš„å¸è½½</strong></p>
<ul>
<li>æ¡ä»¶éå¸¸è‹›åˆ»</li>
<li>éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š
<ul>
<li>è¯¥ç±»çš„æ‰€æœ‰å®ä¾‹éƒ½å·²è¢«å›æ”¶</li>
<li>åŠ è½½è¯¥ç±»çš„ClassLoaderå·²è¢«å›æ”¶</li>
<li>è¯¥ç±»å¯¹åº”çš„java.lang.Classå¯¹è±¡æ²¡æœ‰è¢«å¼•ç”¨</li>
</ul>
</li>
</ul>
</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MethodAreaGC</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å­—ç¬¦ä¸²å¸¸é‡å¯èƒ½è¢«å›æ”¶ï¼ˆå¦‚æœæ²¡æœ‰è¢«å¼•ç”¨ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">str1</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;  <span class="hljs-comment">// åœ¨å¸¸é‡æ± ä¸­</span>
        <span class="hljs-comment">// å¦‚æœstr1ä¸å†è¢«å¼•ç”¨ï¼Œå¸¸é‡"Hello"å¯èƒ½è¢«å›æ”¶</span>
    }
}
</code></pre>
<h3 data-id="heading-51">8. è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰</h3>
<h4 data-id="heading-52">8.1 ä½œç”¨</h4>
<p>è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨ç¼–è¯‘æœŸç”Ÿæˆçš„å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚</p>
<p><strong>å­˜å‚¨å†…å®¹ï¼š</strong></p>
<ul>
<li><strong>å­—é¢é‡</strong>ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ç­‰å¸¸é‡å€¼</li>
<li><strong>ç¬¦å·å¼•ç”¨</strong>ï¼šç±»åã€æ–¹æ³•åã€å­—æ®µåç­‰ç¬¦å·</li>
<li><strong>ç›´æ¥å¼•ç”¨</strong>ï¼šç±»åŠ è½½åï¼Œç¬¦å·å¼•ç”¨è¢«è§£æä¸ºç›´æ¥å¼•ç”¨</li>
</ul>
<h4 data-id="heading-53">8.2 å¸¸é‡æ± çš„å†…å®¹</h4>
<p><strong>1. å­—é¢é‡</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConstantPool</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;    <span class="hljs-comment">// å­—é¢é‡"Hello"åœ¨å¸¸é‡æ± ä¸­</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;           <span class="hljs-comment">// æ•°å­—å­—é¢é‡</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;     <span class="hljs-comment">// å¸ƒå°”å­—é¢é‡</span>
    }
}
</code></pre>
<p><strong>2. ç¬¦å·å¼•ç”¨</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¬¦å·å¼•ç”¨ï¼šç±»åã€æ–¹æ³•åã€å­—æ®µåç­‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SymbolReference</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ç¬¦å·å¼•ç”¨ï¼šç±»åã€æ–¹æ³•å</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// Objectæ˜¯ç¬¦å·å¼•ç”¨ï¼Œç±»åŠ è½½åè§£æä¸ºç›´æ¥å¼•ç”¨</span>
        obj.toString();             <span class="hljs-comment">// toStringæ˜¯ç¬¦å·å¼•ç”¨ï¼Œè§£æä¸ºç›´æ¥å¼•ç”¨</span>
    }
}
</code></pre>
<p><strong>3. ç›´æ¥å¼•ç”¨</strong></p>
<p>ç±»åŠ è½½åï¼Œç¬¦å·å¼•ç”¨è¢«è§£æä¸ºç›´æ¥å¼•ç”¨ï¼ˆæŒ‡å‘å®é™…çš„å†…å­˜åœ°å€ï¼‰ã€‚</p>
<h4 data-id="heading-54">8.3 ä¸æ–¹æ³•åŒºçš„å…³ç³»</h4>
<p><strong>JDKç‰ˆæœ¬å·®å¼‚ï¼š</strong></p>
<ul>
<li><strong>JDK 8ä¹‹å‰</strong>ï¼šè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºï¼ˆæ°¸ä¹…ä»£ï¼‰çš„ä¸€éƒ¨åˆ†</li>
<li><strong>JDK 8åŠä¹‹å</strong>ï¼šè¿è¡Œæ—¶å¸¸é‡æ± æ˜¯å †çš„ä¸€éƒ¨åˆ†ï¼ˆå­—ç¬¦ä¸²å¸¸é‡æ± ç§»åˆ°å †ä¸­ï¼‰</li>
</ul>
<p><strong>å˜åŒ–è¯´æ˜ï¼š</strong></p>
<p>JDK 8å°†å­—ç¬¦ä¸²å¸¸é‡æ± ä»æ°¸ä¹…ä»£ç§»åˆ°äº†å †ä¸­ï¼Œè¿™æ ·ï¼š</p>
<ul>
<li>å­—ç¬¦ä¸²å¯ä»¥è¢«GCå›æ”¶</li>
<li>å‡å°‘æ°¸ä¹…ä»£/å…ƒç©ºé—´çš„å‹åŠ›</li>
<li>æé«˜GCæ•ˆç‡</li>
</ul>
<h4 data-id="heading-55">8.4 å¸¸é‡æ± çš„å›æ”¶</h4>
<p><strong>å¸¸é‡æ± ä¸­çš„å¸¸é‡å¯ä»¥è¢«å›æ”¶ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConstantPoolGC</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">str1</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;  <span class="hljs-comment">// "Hello"åœ¨å¸¸é‡æ± ä¸­</span>
        str1 = <span class="hljs-literal">null</span>;            <span class="hljs-comment">// str1ä¸å†å¼•ç”¨"Hello"</span>
        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰å…¶ä»–åœ°æ–¹å¼•ç”¨"Hello"ï¼Œå®ƒå¯èƒ½è¢«GCå›æ”¶</span>
    }
}
</code></pre>
<p><strong>String.intern()æ–¹æ³•ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StringIntern</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">str1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Hello"</span>);  <span class="hljs-comment">// å¯¹è±¡åœ¨å †ä¸­</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">str2</span> <span class="hljs-operator">=</span> str1.intern();        <span class="hljs-comment">// å°†å­—ç¬¦ä¸²æ”¾å…¥å¸¸é‡æ± </span>
        
        <span class="hljs-type">String</span> <span class="hljs-variable">str3</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;              <span class="hljs-comment">// ä»å¸¸é‡æ± è·å–</span>
        System.out.println(str2 == str3);   <span class="hljs-comment">// trueï¼ŒåŒä¸€ä¸ªå¯¹è±¡</span>
    }
}
</code></pre>
<h3 data-id="heading-56">9. ç›´æ¥å†…å­˜ï¼ˆDirect Memoryï¼‰</h3>
<h4 data-id="heading-57">9.1 ä½œç”¨</h4>
<p>ç›´æ¥å†…å­˜æ˜¯å †å¤–å†…å­˜ï¼Œä¸å±äºJVMè¿è¡Œæ—¶æ•°æ®åŒºï¼Œä¹Ÿä¸å—JVMå †å†…å­˜é™åˆ¶ã€‚</p>
<p><strong>ä¸»è¦ç”¨é€”ï¼š</strong></p>
<ul>
<li>NIOï¼ˆNew I/Oï¼‰ä½¿ç”¨</li>
<li>æé«˜I/Oæ€§èƒ½</li>
<li>é¿å…Javaå †å’ŒNativeå †ä¹‹é—´çš„æ•°æ®å¤åˆ¶</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦ç›´æ¥å†…å­˜ï¼Ÿ</strong></p>
<p>ä¼ ç»ŸI/Oéœ€è¦å°†æ•°æ®ä»å†…æ ¸ç©ºé—´å¤åˆ¶åˆ°ç”¨æˆ·ç©ºé—´ï¼ˆJavaå †ï¼‰ï¼Œç„¶åJavaç¨‹åºæ‰èƒ½è®¿é—®ã€‚ä½¿ç”¨ç›´æ¥å†…å­˜å¯ä»¥ï¼š</p>
<ul>
<li>ç›´æ¥åœ¨å †å¤–å†…å­˜ä¸­æ“ä½œæ•°æ®</li>
<li>å‡å°‘æ•°æ®å¤åˆ¶æ¬¡æ•°</li>
<li>æé«˜I/Oæ€§èƒ½</li>
</ul>
<h4 data-id="heading-58">9.2 ç›´æ¥å†…å­˜çš„ç‰¹ç‚¹</h4>
<ol>
<li><strong>ä¸å—JVMå †å†…å­˜é™åˆ¶</strong>ï¼šç›´æ¥å†…å­˜ä¸åœ¨å †ä¸­ï¼Œä¸å—-Xmxé™åˆ¶</li>
<li><strong>å—æ“ä½œç³»ç»Ÿå†…å­˜é™åˆ¶</strong>ï¼šå—ç‰©ç†å†…å­˜å’Œæ“ä½œç³»ç»Ÿé™åˆ¶</li>
<li><strong>åˆ†é…å’Œå›æ”¶æˆæœ¬è¾ƒé«˜</strong>ï¼šåˆ†é…å’Œå›æ”¶éœ€è¦è°ƒç”¨ç³»ç»Ÿå‡½æ•°</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.nio.ByteBuffer;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DirectMemoryExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">useDirectMemory</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// åˆ†é…ç›´æ¥å†…å­˜</span>
        <span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocateDirect(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);  <span class="hljs-comment">// 1MBç›´æ¥å†…å­˜</span>
        
        <span class="hljs-comment">// ä½¿ç”¨ç›´æ¥å†…å­˜è¿›è¡ŒI/Oæ“ä½œ</span>
        <span class="hljs-comment">// ... I/Oæ“ä½œ ...</span>
        
        <span class="hljs-comment">// ç›´æ¥å†…å­˜ç”±Full GCæˆ–System.gc()å›æ”¶</span>
    }
}
</code></pre>
<h4 data-id="heading-59">9.3 ç›´æ¥å†…å­˜çš„åˆ†é…</h4>
<p><strong>åˆ†é…æ–¹å¼ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ–¹å¼1ï¼šé€šè¿‡ByteBufferåˆ†é…</span>
<span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> ByteBuffer.allocateDirect(<span class="hljs-number">1024</span>);

<span class="hljs-comment">// æ–¹å¼2ï¼šåº•å±‚è°ƒç”¨Unsafe.allocateMemory()</span>
<span class="hljs-comment">// Unsafe.allocateMemory(size);</span>
</code></pre>
<p><strong>åº•å±‚å®ç°ï¼š</strong></p>
<ul>
<li>ç›´æ¥å†…å­˜çš„åˆ†é…é€šè¿‡è°ƒç”¨Unsafe.allocateMemory()å®ç°</li>
<li>è¿™æ˜¯æœ¬åœ°æ–¹æ³•ï¼Œç›´æ¥æ“ä½œæ“ä½œç³»ç»Ÿå†…å­˜</li>
</ul>
<h4 data-id="heading-60">9.4 ç›´æ¥å†…å­˜çš„å›æ”¶</h4>
<p><strong>å›æ”¶æœºåˆ¶ï¼š</strong></p>
<ol>
<li><strong>Full GCæ—¶å›æ”¶</strong>ï¼šFull GCä¼šå›æ”¶ç›´æ¥å†…å­˜</li>
<li><strong>System.gc()è§¦å‘å›æ”¶</strong>ï¼šè°ƒç”¨System.gc()å¯èƒ½è§¦å‘ç›´æ¥å†…å­˜å›æ”¶</li>
<li><strong>Cleaneræœºåˆ¶</strong>ï¼šJDK 9ä¹‹åä½¿ç”¨Cleaneræœºåˆ¶è‡ªåŠ¨å›æ”¶</li>
</ol>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>ç›´æ¥å†…å­˜çš„å›æ”¶ä¸å®Œå…¨å—JVMæ§åˆ¶</li>
<li>å»ºè®®ä½¿ç”¨-XX:MaxDirectMemorySizeé™åˆ¶å¤§å°</li>
</ul>
<h4 data-id="heading-61">9.5 å¼‚å¸¸</h4>
<p><strong>OutOfMemoryError: Direct buffer memory</strong></p>
<p>å½“ç›´æ¥å†…å­˜ä¸è¶³æ—¶ï¼Œä¼šæŠ›å‡ºOutOfMemoryError: Direct buffer memoryã€‚</p>
<p><strong>äº§ç”ŸåŸå› ï¼š</strong></p>
<ol>
<li>ç›´æ¥å†…å­˜ä½¿ç”¨è¿‡å¤š</li>
<li>ç›´æ¥å†…å­˜æ²¡æœ‰åŠæ—¶å›æ”¶</li>
<li>-XX:MaxDirectMemorySizeè®¾ç½®è¿‡å°</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ol>
<li>å¢åŠ -XX:MaxDirectMemorySize</li>
<li>å‡å°‘ç›´æ¥å†…å­˜çš„ä½¿ç”¨</li>
<li>åŠæ—¶é‡Šæ”¾ç›´æ¥å†…å­˜</li>
</ol>
<hr/>
<h2 data-id="heading-62">ç¬¬å››éƒ¨åˆ†ï¼šå¯¹è±¡çš„åˆ›å»ºä¸å†…å­˜å¸ƒå±€ï¼ˆé‡ç‚¹ï¼‰</h2>
<h3 data-id="heading-63">10. å¯¹è±¡åˆ›å»ºçš„å®Œæ•´æµç¨‹</h3>
<h4 data-id="heading-64">10.1 å¯¹è±¡åˆ›å»ºæµç¨‹å›¾</h4>
<pre><code class="hljs language-markdown" lang="markdown">å¯¹è±¡åˆ›å»ºæµç¨‹ï¼š

<span class="hljs-bullet">1.</span> ç±»åŠ è½½æ£€æŸ¥
   â†“
<span class="hljs-bullet">2.</span> åˆ†é…å†…å­˜ (æŒ‡é’ˆç¢°æ’/ç©ºé—²åˆ—è¡¨/TLAB)
   â†“
<span class="hljs-bullet">3.</span> åˆå§‹åŒ–é›¶å€¼
   â†“
<span class="hljs-bullet">4.</span> è®¾ç½®å¯¹è±¡å¤´ (Mark Word/ç±»å‹æŒ‡é’ˆ)
   â†“
<span class="hljs-bullet">5.</span> æ‰§è¡Œæ„é€ å‡½æ•°
</code></pre>
<h4 data-id="heading-65">10.2 ç±»åŠ è½½æ£€æŸ¥</h4>
<p><strong>æ£€æŸ¥è¿‡ç¨‹ï¼š</strong></p>
<p>å½“é‡åˆ°newæŒ‡ä»¤æ—¶ï¼ŒJVMé¦–å…ˆæ£€æŸ¥ï¼š</p>
<ol>
<li>æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°ç±»çš„ç¬¦å·å¼•ç”¨</li>
<li>æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½ã€è§£æå’Œåˆå§‹åŒ–</li>
</ol>
<p><strong>å¦‚æœæ²¡æœ‰åŠ è½½ï¼š</strong></p>
<p>å¦‚æœæ²¡æœ‰åŠ è½½ï¼Œåˆ™æ‰§è¡Œç±»åŠ è½½è¿‡ç¨‹ï¼ˆåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ï¼‰ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectCreation</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">create</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// é‡åˆ°newæŒ‡ä»¤æ—¶ï¼Œå…ˆæ£€æŸ¥MyClassæ˜¯å¦å·²åŠ è½½</span>
        <span class="hljs-type">MyClass</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyClass</span>();  <span class="hljs-comment">// å¦‚æœMyClassæœªåŠ è½½ï¼Œå…ˆæ‰§è¡Œç±»åŠ è½½</span>
    }
}
</code></pre>
<h4 data-id="heading-66">10.3 åˆ†é…å†…å­˜</h4>
<p><strong>å†…å­˜åˆ†é…çš„æ–¹å¼ï¼š</strong></p>
<p><strong>1. æŒ‡é’ˆç¢°æ’ï¼ˆBump the Pointerï¼‰</strong></p>
<p>é€‚ç”¨åœºæ™¯ï¼šå †å†…å­˜è§„æ•´ï¼ˆä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ï¼‰</p>
<pre><code class="hljs language-css" lang="css">æŒ‡é’ˆç¢°æ’ï¼š

<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[ç©ºé—²]</span>
                 â†‘æŒ‡é’ˆ

åˆ†é…åï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[æ–°å¯¹è±¡]</span><span class="hljs-selector-attr">[ç©ºé—²]</span>
                         â†‘æŒ‡é’ˆåç§»
</code></pre>
<p><strong>2. ç©ºé—²åˆ—è¡¨ï¼ˆFree Listï¼‰</strong></p>
<p>é€‚ç”¨åœºæ™¯ï¼šå †å†…å­˜ä¸è§„æ•´ï¼ˆä½¿ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼‰</p>
<pre><code class="hljs language-ini" lang="ini">ç©ºé—²åˆ—è¡¨ï¼š

å †çŠ¶æ€: <span class="hljs-section">[å¯¹è±¡1]</span><span class="hljs-section">[ç©º]</span><span class="hljs-section">[å¯¹è±¡2]</span><span class="hljs-section">[ç©º]</span><span class="hljs-section">[å¯¹è±¡3]</span>
ç©ºé—²åˆ—è¡¨: <span class="hljs-section">[ä½ç½®1, ä½ç½®3]</span>

åˆ†é…: ä»ç©ºé—²åˆ—è¡¨ä¸­é€‰æ‹©åˆé€‚ä½ç½®

é€‚ç”¨äºå †å†…å­˜ä¸è§„æ•´
</code></pre>
<p><strong>å†…å­˜åˆ†é…å¹¶å‘é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p><strong>é—®é¢˜ï¼š</strong> å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ†é…å†…å­˜æ—¶ï¼Œå¯èƒ½å‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ1ï¼šCAS + å¤±è´¥é‡è¯•</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼ªä»£ç </span>
<span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">if</span> (CAS(æŒ‡é’ˆä½ç½®, é¢„æœŸå€¼, æ–°å€¼)) {
        <span class="hljs-comment">// åˆ†é…æˆåŠŸ</span>
        <span class="hljs-keyword">break</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// åˆ†é…å¤±è´¥ï¼Œé‡è¯•</span>
        <span class="hljs-keyword">continue</span>;
    }
}
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ2ï¼šTLABï¼ˆThread Local Allocation Bufferï¼‰</strong></p>
<p>TLABæ˜¯æ¯ä¸ªçº¿ç¨‹åœ¨EdenåŒºä¸­ç‹¬ç«‹çš„å†…å­˜åˆ†é…åŒºåŸŸã€‚</p>
<pre><code class="hljs language-ini" lang="ini">TLABï¼š

EdenåŒº: <span class="hljs-section">[TLAB1]</span> <span class="hljs-section">[TLAB2]</span> <span class="hljs-section">[TLAB3]</span> <span class="hljs-section">[å…±äº«åŒº]</span>
        çº¿ç¨‹1   çº¿ç¨‹2   çº¿ç¨‹3

æ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹çš„TLABï¼Œä¼˜å…ˆåœ¨æ­¤åˆ†é…ï¼Œå‡å°‘ç«äº‰
</code></pre>
<p><strong>TLABçš„ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>é¿å…å¤šçº¿ç¨‹åˆ†é…å†…å­˜æ—¶çš„ç«äº‰</li>
<li>æé«˜å†…å­˜åˆ†é…æ•ˆç‡</li>
<li>å‡å°‘åŒæ­¥å¼€é”€</li>
</ul>
<h4 data-id="heading-67">10.4 åˆå§‹åŒ–é›¶å€¼</h4>
<p><strong>åˆå§‹åŒ–è¿‡ç¨‹ï¼š</strong></p>
<p>å†…å­˜åˆ†é…å®Œæˆåï¼ŒJVMå°†åˆ†é…çš„å†…å­˜ç©ºé—´åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰ã€‚</p>
<p><strong>åˆå§‹åŒ–çš„å€¼ï¼š</strong></p>
<ul>
<li>åŸºæœ¬ç±»å‹ï¼š0ã€falseã€0.0ç­‰</li>
<li>å¼•ç”¨ç±»å‹ï¼šnull</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦åˆå§‹åŒ–é›¶å€¼ï¼Ÿ</strong></p>
<p>ä¿è¯å¯¹è±¡çš„å®ä¾‹å­—æ®µå¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ZeroInit</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> value;      <span class="hljs-comment">// è‡ªåŠ¨åˆå§‹åŒ–ä¸º0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> flag;   <span class="hljs-comment">// è‡ªåŠ¨åˆå§‹åŒ–ä¸ºfalse</span>
    <span class="hljs-keyword">private</span> Object obj;     <span class="hljs-comment">// è‡ªåŠ¨åˆå§‹åŒ–ä¸ºnull</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦å…ˆèµ‹å€¼</span>
        System.out.println(value);  <span class="hljs-comment">// è¾“å‡º0</span>
        System.out.println(flag);   <span class="hljs-comment">// è¾“å‡ºfalse</span>
        System.out.println(obj);    <span class="hljs-comment">// è¾“å‡ºnull</span>
    }
}
</code></pre>
<h4 data-id="heading-68">10.5 è®¾ç½®å¯¹è±¡å¤´</h4>
<p>å¯¹è±¡å¤´åŒ…å«ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼š</p>
<p><strong>1. Mark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰</strong></p>
<p>å­˜å‚¨å¯¹è±¡çš„è¿è¡Œæ—¶æ•°æ®ï¼š</p>
<ul>
<li>å¯¹è±¡çš„hashCode</li>
<li>GCåˆ†ä»£å¹´é¾„</li>
<li>é”çŠ¶æ€æ ‡å¿—</li>
<li>çº¿ç¨‹æŒæœ‰çš„é”</li>
<li>åå‘çº¿ç¨‹ID</li>
<li>åå‘æ—¶é—´æˆ³</li>
</ul>
<p><strong>2. ç±»å‹æŒ‡é’ˆï¼ˆClass Pointerï¼‰</strong></p>
<p>æŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»å…ƒæ•°æ®ï¼ˆæ–¹æ³•åŒºä¸­çš„ç±»ä¿¡æ¯ï¼‰ã€‚</p>
<p><strong>3. æ•°ç»„é•¿åº¦ï¼ˆå¦‚æœæ˜¯æ•°ç»„ï¼‰</strong></p>
<p>å¦‚æœæ˜¯æ•°ç»„å¯¹è±¡ï¼Œå¯¹è±¡å¤´è¿˜åŒ…å«æ•°ç»„é•¿åº¦ã€‚</p>
<h4 data-id="heading-69">10.6 æ‰§è¡Œæ–¹æ³•</h4>
<p><strong>æ–¹æ³•çš„ä½œç”¨ï¼š</strong></p>
<p>æ–¹æ³•æ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œåœ¨å¯¹è±¡åˆ›å»ºçš„æœ€åä¸€æ­¥æ‰§è¡Œã€‚</p>
<p><strong>æ‰§è¡Œå†…å®¹ï¼š</strong></p>
<ol>
<li>æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿åˆå§‹åŒ–å¯¹è±¡</li>
<li>æ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç </li>
<li>æŒ‰ç…§å£°æ˜é¡ºåºåˆå§‹åŒ–å®ä¾‹å˜é‡</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InitExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> value;
    <span class="hljs-keyword">private</span> String name;
    
    <span class="hljs-comment">// æ„é€ å‡½æ•°</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">InitExample</span><span class="hljs-params">(<span class="hljs-type">int</span> v, String n)</span> {
        <span class="hljs-built_in">this</span>.value = v;  <span class="hljs-comment">// æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿åˆå§‹åŒ–</span>
        <span class="hljs-built_in">this</span>.name = n;
    }
}

<span class="hljs-comment">// å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ï¼š</span>
<span class="hljs-comment">// 1. ç±»åŠ è½½æ£€æŸ¥</span>
<span class="hljs-comment">// 2. åˆ†é…å†…å­˜</span>
<span class="hljs-comment">// 3. åˆå§‹åŒ–é›¶å€¼ï¼ˆvalue=0, name=nullï¼‰</span>
<span class="hljs-comment">// 4. è®¾ç½®å¯¹è±¡å¤´</span>
<span class="hljs-comment">// 5. æ‰§è¡Œæ„é€ å‡½æ•°ï¼ˆvalue=10, name="test"ï¼‰</span>
<span class="hljs-type">InitExample</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InitExample</span>(<span class="hljs-number">10</span>, <span class="hljs-string">"test"</span>);
</code></pre>
<h3 data-id="heading-70">11. å¯¹è±¡çš„å†…å­˜å¸ƒå±€</h3>
<h4 data-id="heading-71">11.1 å¯¹è±¡å†…å­˜å¸ƒå±€å›¾</h4>
<pre><code class="hljs language-scss" lang="scss">å¯¹è±¡å†…å­˜å¸ƒå±€ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹è±¡å¤´      â”‚ (Mark Word + ç±»å‹æŒ‡é’ˆ + æ•°ç»„é•¿åº¦)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®ä¾‹æ•°æ®    â”‚ (å­—æ®µå€¼)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯¹é½å¡«å……    â”‚ (ä¿è¯<span class="hljs-number">8</span>å­—èŠ‚å¯¹é½)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-72">11.2 å¯¹è±¡å¤´è¯¦è§£</h4>
<p><strong>1. Mark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰</strong></p>
<p>Mark Wordæ˜¯å¯¹è±¡å¤´çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨å¯¹è±¡çš„è¿è¡Œæ—¶æ•°æ®ã€‚</p>
<p><strong>å­˜å‚¨å†…å®¹ï¼š</strong></p>





























<table><thead><tr><th>å†…å®¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>hashCode</strong></td><td>å¯¹è±¡çš„å“ˆå¸Œç </td></tr><tr><td><strong>GCå¹´é¾„</strong></td><td>å¯¹è±¡ç»å†çš„GCæ¬¡æ•°</td></tr><tr><td><strong>é”çŠ¶æ€</strong></td><td>åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ç­‰</td></tr><tr><td><strong>åå‘çº¿ç¨‹ID</strong></td><td>åå‘é”çš„çº¿ç¨‹ID</td></tr><tr><td><strong>åå‘æ—¶é—´æˆ³</strong></td><td>åå‘é”çš„æ—¶é—´æˆ³</td></tr></tbody></table>
<p><strong>Mark Wordçš„ç»“æ„ï¼ˆ64ä½JVMï¼‰ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         <span class="hljs-selector-tag">Mark</span> Word (<span class="hljs-number">64</span>ä½)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é”çŠ¶æ€  â”‚  å…¶ä»–ä¿¡æ¯                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ— é”    â”‚ <span class="hljs-built_in">hashCode</span>(<span class="hljs-number">31</span>ä½) + GCå¹´é¾„(<span class="hljs-number">4</span>ä½) + ...â”‚
â”‚ åå‘é”  â”‚ çº¿ç¨‹<span class="hljs-built_in">ID</span>(<span class="hljs-number">54</span>ä½) + <span class="hljs-built_in">Epoch</span>(<span class="hljs-number">2</span>ä½) + ...â”‚
â”‚ è½»é‡çº§é”â”‚ æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ(<span class="hljs-number">62</span>ä½) + ...â”‚
â”‚ é‡é‡çº§é”â”‚ æŒ‡å‘monitorçš„æŒ‡é’ˆ(<span class="hljs-number">62</span>ä½) + ...â”‚
â”‚ GCæ ‡è®°  â”‚ ç©º(ä¸éœ€è¦è®°å½•ä¿¡æ¯)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MarkWordExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> value;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
        
        <span class="hljs-comment">// Mark Wordå­˜å‚¨ï¼š</span>
        <span class="hljs-comment">// - objçš„hashCode</span>
        <span class="hljs-comment">// - GCå¹´é¾„ï¼ˆåˆå§‹ä¸º0ï¼‰</span>
        <span class="hljs-comment">// - é”çŠ¶æ€ï¼ˆåˆå§‹ä¸ºæ— é”ï¼‰</span>
        
        <span class="hljs-comment">// è°ƒç”¨hashCode()æ—¶ï¼Œå¦‚æœhashCodeä¸º0ï¼Œä¼šè®¡ç®—å¹¶å†™å…¥Mark Word</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> obj.hashCode();
        
        <span class="hljs-comment">// ç»å†GCåï¼ŒGCå¹´é¾„å¢åŠ </span>
        <span class="hljs-comment">// åŠ é”æ—¶ï¼Œé”çŠ¶æ€æ”¹å˜</span>
    }
}
</code></pre>
<p><strong>2. ç±»å‹æŒ‡é’ˆï¼ˆClass Pointerï¼‰</strong></p>
<p>ç±»å‹æŒ‡é’ˆæŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»å…ƒæ•°æ®ï¼ˆæ–¹æ³•åŒºä¸­çš„ç±»ä¿¡æ¯ï¼‰ã€‚</p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>JVMé€šè¿‡ç±»å‹æŒ‡é’ˆç¡®å®šå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹</li>
<li>æ”¯æŒinstanceofæ“ä½œ</li>
<li>æ”¯æŒè™šæ–¹æ³•åˆ†æ´¾</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassPointerExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Hello"</span>);
        
        <span class="hljs-comment">// é€šè¿‡ç±»å‹æŒ‡é’ˆï¼ŒJVMçŸ¥é“objå®é™…ä¸Šæ˜¯Stringç±»å‹</span>
        <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> String) {  <span class="hljs-comment">// æ£€æŸ¥ç±»å‹æŒ‡é’ˆ</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> (String) obj;  <span class="hljs-comment">// ç±»å‹è½¬æ¢</span>
        }
    }
}
</code></pre>
<p><strong>3. æ•°ç»„é•¿åº¦ï¼ˆArray Lengthï¼‰</strong></p>
<p>ä»…å½“å¯¹è±¡æ˜¯æ•°ç»„æ—¶ï¼Œå¯¹è±¡å¤´æ‰åŒ…å«æ•°ç»„é•¿åº¦ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayLength</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">int</span>[] array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>];  <span class="hljs-comment">// æ•°ç»„å¯¹è±¡ï¼Œå¯¹è±¡å¤´åŒ…å«æ•°ç»„é•¿åº¦10</span>
        
        <span class="hljs-comment">// å¯¹è±¡å¤´ç»“æ„ï¼š</span>
        <span class="hljs-comment">// - Mark Word</span>
        <span class="hljs-comment">// - ç±»å‹æŒ‡é’ˆï¼ˆæŒ‡å‘int[]ç±»ï¼‰</span>
        <span class="hljs-comment">// - æ•°ç»„é•¿åº¦ï¼ˆ10ï¼‰</span>
        <span class="hljs-comment">// - å®ä¾‹æ•°æ®ï¼ˆ10ä¸ªintå€¼ï¼‰</span>
    }
}
</code></pre>
<h4 data-id="heading-73">11.3 å®ä¾‹æ•°æ®</h4>
<p><strong>å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰å­˜å‚¨ï¼š</strong></p>
<p>å¯¹è±¡çš„å®ä¾‹æ•°æ®å­˜å‚¨å¯¹è±¡çš„å®é™…å­—æ®µå€¼ã€‚</p>
<p><strong>å­˜å‚¨é¡ºåºï¼š</strong></p>
<ol>
<li><strong>çˆ¶ç±»å­—æ®µåœ¨å‰</strong>ï¼šçˆ¶ç±»ç»§æ‰¿çš„å­—æ®µåœ¨å­ç±»å­—æ®µä¹‹å‰</li>
<li><strong>ç›¸åŒå®½åº¦çš„å­—æ®µåˆ†é…åœ¨ä¸€èµ·</strong>ï¼šlong/doubleã€int/floatã€short/charã€byte/boolean</li>
<li><strong>å­ç±»å­—æ®µåœ¨å</strong>ï¼šå­ç±»å®šä¹‰çš„å­—æ®µåœ¨çˆ¶ç±»å­—æ®µä¹‹å</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-type">int</span> parentInt;      <span class="hljs-comment">// 4å­—èŠ‚</span>
    <span class="hljs-type">long</span> parentLong;    <span class="hljs-comment">// 8å­—èŠ‚</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Parent</span> {
    <span class="hljs-type">int</span> childInt;       <span class="hljs-comment">// 4å­—èŠ‚</span>
    <span class="hljs-type">long</span> childLong;     <span class="hljs-comment">// 8å­—èŠ‚</span>
}

<span class="hljs-comment">// å¯¹è±¡å¸ƒå±€ï¼ˆå®ä¾‹æ•°æ®éƒ¨åˆ†ï¼‰ï¼š</span>
<span class="hljs-comment">// 1. parentInt (4å­—èŠ‚)</span>
<span class="hljs-comment">// 2. childInt (4å­—èŠ‚) - ç›¸åŒå®½åº¦æ”¾åœ¨ä¸€èµ·</span>
<span class="hljs-comment">// 3. parentLong (8å­—èŠ‚)</span>
<span class="hljs-comment">// 4. childLong (8å­—èŠ‚)</span>
</code></pre>
<h4 data-id="heading-74">11.4 å¯¹é½å¡«å……</h4>
<p><strong>å¯¹é½å¡«å……çš„ä½œç”¨ï¼š</strong></p>
<p>å¯¹è±¡å¤§å°å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œå¯¹é½å¡«å……ç”¨äºæ»¡è¶³è¿™ä¸ªè¦æ±‚ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å¯¹é½ï¼Ÿ</strong></p>
<ol>
<li><strong>æé«˜è®¿é—®æ•ˆç‡</strong>ï¼šå¯¹é½åçš„å†…å­˜è®¿é—®é€Ÿåº¦æ›´å¿«</li>
<li><strong>ç¡¬ä»¶è¦æ±‚</strong>ï¼šæŸäº›CPUè¦æ±‚æ•°æ®å¯¹é½</li>
<li><strong>å‡å°‘å†…å­˜ç¢ç‰‡</strong>ï¼šå¯¹é½å¯ä»¥å‡å°‘å†…å­˜ç¢ç‰‡</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaddingExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span> b;     <span class="hljs-comment">// 1å­—èŠ‚</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> i;      <span class="hljs-comment">// 4å­—èŠ‚</span>
    
    <span class="hljs-comment">// å¯¹è±¡å¤§å°è®¡ç®—ï¼š</span>
    <span class="hljs-comment">// å¯¹è±¡å¤´ï¼š12å­—èŠ‚ï¼ˆå‡è®¾å‹ç¼©åï¼‰</span>
    <span class="hljs-comment">// bï¼š1å­—èŠ‚</span>
    <span class="hljs-comment">// å¡«å……ï¼š3å­—èŠ‚ï¼ˆä¸ºäº†å¯¹é½ï¼‰</span>
    <span class="hljs-comment">// iï¼š4å­—èŠ‚</span>
    <span class="hljs-comment">// æ€»å¤§å°ï¼š12 + 1 + 3 + 4 = 20å­—èŠ‚</span>
    
    <span class="hljs-comment">// ä½†å¯¹è±¡å¤§å°å¿…é¡»æ˜¯8çš„å€æ•°ï¼Œæ‰€ä»¥ï¼š</span>
    <span class="hljs-comment">// å®é™…å¤§å°ï¼š24å­—èŠ‚ï¼ˆ20 + 4å­—èŠ‚å¯¹é½å¡«å……ï¼‰</span>
}
</code></pre>
<h4 data-id="heading-75">11.5 å¯¹è±¡å¤§å°çš„è®¡ç®—</h4>
<p><strong>è®¡ç®—å…¬å¼ï¼š</strong></p>
<pre><code class="hljs">å¯¹è±¡å¤§å° = å¯¹è±¡å¤´ + å®ä¾‹æ•°æ® + å¯¹é½å¡«å……
</code></pre>
<p><strong>å®é™…è®¡ç®—ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SizeCalculation</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">byte</span> b;      <span class="hljs-comment">// 1å­—èŠ‚</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> i;       <span class="hljs-comment">// 4å­—èŠ‚</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> l;      <span class="hljs-comment">// 8å­—èŠ‚</span>
    <span class="hljs-keyword">private</span> Object ref;  <span class="hljs-comment">// å¼•ç”¨4å­—èŠ‚ï¼ˆå‹ç¼©åï¼‰æˆ–8å­—èŠ‚ï¼ˆæœªå‹ç¼©ï¼‰</span>
    
    <span class="hljs-comment">// 64ä½JVMï¼Œå¼€å¯æŒ‡é’ˆå‹ç¼©ï¼š</span>
    <span class="hljs-comment">// å¯¹è±¡å¤´ï¼š12å­—èŠ‚ï¼ˆMark Word 8å­—èŠ‚ + ç±»å‹æŒ‡é’ˆ 4å­—èŠ‚ï¼‰</span>
    <span class="hljs-comment">// bï¼š1å­—èŠ‚</span>
    <span class="hljs-comment">// å¡«å……ï¼š3å­—èŠ‚</span>
    <span class="hljs-comment">// iï¼š4å­—èŠ‚</span>
    <span class="hljs-comment">// lï¼š8å­—èŠ‚</span>
    <span class="hljs-comment">// refï¼š4å­—èŠ‚</span>
    <span class="hljs-comment">// å¯¹é½å¡«å……ï¼š0å­—èŠ‚ï¼ˆå·²ç»æ˜¯8çš„å€æ•°ï¼‰</span>
    <span class="hljs-comment">// æ€»å¤§å°ï¼š12 + 1 + 3 + 4 + 8 + 4 = 32å­—èŠ‚</span>
}
</code></pre>
<h3 data-id="heading-76">12. å¯¹è±¡çš„è®¿é—®å®šä½</h3>
<h4 data-id="heading-77">12.1 å¥æŸ„è®¿é—®æ–¹å¼å›¾</h4>
<pre><code class="hljs language-markdown" lang="markdown">å¥æŸ„è®¿é—®ï¼š

æ ˆå¼•ç”¨ â†’ å¥æŸ„æ±  â†’ å¯¹è±¡å®ä¾‹æ•°æ®
<span class="hljs-code">              â†’ ç±»å‹æ•°æ®
</span>
éœ€è¦ä¸¤æ¬¡è®¿é—®
</code></pre>
<p><strong>å¥æŸ„è®¿é—®çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>å¼•ç”¨ç¨³å®šï¼šå¯¹è±¡ç§»åŠ¨æ—¶åªéœ€æ›´æ–°å¥æŸ„ä¸­çš„æŒ‡é’ˆ</li>
<li>GCæ•ˆç‡é«˜ï¼šGCæ—¶åªéœ€ç§»åŠ¨å¯¹è±¡ï¼Œä¸éœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨</li>
</ul>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>éœ€è¦ä¸¤æ¬¡è®¿é—®ï¼šå…ˆè®¿é—®å¥æŸ„ï¼Œå†è®¿é—®å¯¹è±¡</li>
<li>æ•ˆç‡è¾ƒä½ï¼šå¤šä¸€æ¬¡é—´æ¥è®¿é—®</li>
</ul>
</li>
</ul>
<h4 data-id="heading-78">12.2 ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼å›¾ï¼ˆHotSpotä½¿ç”¨ï¼‰</h4>
<pre><code class="hljs">ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼ˆHotSpotï¼‰ï¼š

æ ˆå¼•ç”¨ â†’ å¯¹è±¡å®ä¾‹æ•°æ® â†’ ç±»å‹æ•°æ®ï¼ˆé€šè¿‡å¯¹è±¡å¤´ä¸­ç±»å‹æŒ‡é’ˆï¼‰

åªéœ€ä¸€æ¬¡è®¿é—®
</code></pre>
<p><strong>ç›´æ¥æŒ‡é’ˆè®¿é—®çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>è®¿é—®é€Ÿåº¦å¿«ï¼šåªéœ€ä¸€æ¬¡è®¿é—®</li>
<li>æ•ˆç‡é«˜ï¼šå‡å°‘é—´æ¥è®¿é—®çš„å¼€é”€</li>
</ul>
</li>
<li>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>å¯¹è±¡ç§»åŠ¨æ—¶éœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨</li>
<li>GCæ—¶å¼€é”€è¾ƒå¤§ï¼šéœ€è¦æ›´æ–°æ‰€æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„å¼•ç”¨</li>
</ul>
</li>
</ul>
<h4 data-id="heading-79">12.3 ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”</h4>



































<table><thead><tr><th>ç‰¹æ€§</th><th>å¥æŸ„è®¿é—®</th><th>ç›´æ¥æŒ‡é’ˆè®¿é—®</th></tr></thead><tbody><tr><td><strong>è®¿é—®æ¬¡æ•°</strong></td><td>ä¸¤æ¬¡ï¼ˆå…ˆè®¿é—®å¥æŸ„ï¼Œå†è®¿é—®å¯¹è±¡ï¼‰</td><td>ä¸€æ¬¡ï¼ˆç›´æ¥è®¿é—®å¯¹è±¡ï¼‰</td></tr><tr><td><strong>è®¿é—®é€Ÿåº¦</strong></td><td>è¾ƒæ…¢</td><td>è¾ƒå¿«</td></tr><tr><td><strong>å¼•ç”¨ç¨³å®šæ€§</strong></td><td>å¼•ç”¨ä¸å˜ï¼Œå¯¹è±¡ç§»åŠ¨åªéœ€æ›´æ–°å¥æŸ„</td><td>å¼•ç”¨ç›´æ¥æŒ‡å‘å¯¹è±¡</td></tr><tr><td><strong>GCå¼€é”€</strong></td><td>è¾ƒå°ï¼ˆåªéœ€ç§»åŠ¨å¯¹è±¡ï¼Œæ›´æ–°å¥æŸ„ï¼‰</td><td>è¾ƒå¤§ï¼ˆéœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨ï¼‰</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>è¾ƒå¤§ï¼ˆéœ€è¦é¢å¤–çš„å¥æŸ„æ± ï¼‰</td><td>è¾ƒå°ï¼ˆä¸éœ€è¦å¥æŸ„æ± ï¼‰</td></tr></tbody></table>
<p><strong>HotSpotä¸ºä»€ä¹ˆä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Ÿ</strong></p>
<p>HotSpotè™šæ‹Ÿæœºä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Œä¸»è¦åŸå› ï¼š</p>
<ol>
<li><strong>æ€§èƒ½ä¼˜å…ˆ</strong>ï¼šç›´æ¥è®¿é—®é€Ÿåº¦å¿«ï¼Œå‡å°‘é—´æ¥è®¿é—®å¼€é”€</li>
<li><strong>å¯¹è±¡ç§»åŠ¨è¾ƒå°‘</strong>ï¼šç°ä»£GCç®—æ³•ï¼ˆå¦‚G1ï¼‰å¯ä»¥æ›´å¥½åœ°å¤„ç†å¯¹è±¡ç§»åŠ¨</li>
<li><strong>ç®€å•é«˜æ•ˆ</strong>ï¼šå®ç°ç®€å•ï¼Œè®¿é—®æ•ˆç‡é«˜</li>
</ol>
<p><strong>å®é™…åº”ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AccessExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">example</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
        
        <span class="hljs-comment">// HotSpotä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼š</span>
        <span class="hljs-comment">// 1. objå¼•ç”¨ç›´æ¥æŒ‡å‘å †ä¸­çš„å¯¹è±¡</span>
        <span class="hljs-comment">// 2. é€šè¿‡å¯¹è±¡å¤´ä¸­çš„ç±»å‹æŒ‡é’ˆæ‰¾åˆ°ç±»ä¿¡æ¯</span>
        <span class="hljs-comment">// 3. è®¿é—®å¯¹è±¡æ—¶åªéœ€è¦ä¸€æ¬¡å†…å­˜è®¿é—®</span>
        
        obj.toString();  <span class="hljs-comment">// ç›´æ¥é€šè¿‡å¼•ç”¨è®¿é—®å¯¹è±¡ï¼Œæ•ˆç‡é«˜</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-80">ç¬¬äº”éƒ¨åˆ†ï¼šAndroidè¯´æ˜ï¼ˆç®€è¦ï¼‰</h2>
<h3 data-id="heading-81">13. Androidä¸JVMçš„åŒºåˆ«è¯´æ˜</h3>
<h4 data-id="heading-82">13.1 é‡è¦è¯´æ˜</h4>
<p><strong>Androidå¼€å‘è¯­è¨€ï¼š</strong></p>
<ul>
<li>Androidå¼€å‘ä½¿ç”¨Javaè¯­è¨€ï¼ˆæˆ–Kotlinè¯­è¨€ï¼‰</li>
<li>è¯­æ³•å’ŒJavaç›¸åŒ</li>
</ul>
<p><strong>Androidè¿è¡Œæ—¶ï¼š</strong></p>
<ul>
<li>Androidè¿è¡Œåœ¨ARTï¼ˆAndroid Runtimeï¼‰ä¸Šï¼Œ<strong>ä¸æ˜¯JVM</strong></li>
<li>ARTä¸JVMæ˜¯ä¸¤ä¸ªä¸åŒçš„è¿è¡Œæ—¶ç¯å¢ƒ</li>
</ul>
<p><strong>å…³é”®åŒºåˆ«ï¼š</strong></p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>JVM</th><th>ART</th></tr></thead><tbody><tr><td><strong>ç¼–è¯‘æ–¹å¼</strong></td><td>è§£é‡Šæ‰§è¡Œ + JITç¼–è¯‘</td><td>AOTç¼–è¯‘ + JITç¼–è¯‘ï¼ˆAndroid 7.0+ï¼‰</td></tr><tr><td><strong>å†…å­˜ç®¡ç†</strong></td><td>JVMå†…å­˜åŒºåŸŸï¼ˆå †ã€æ ˆç­‰ï¼‰</td><td>ARTæœ‰è‡ªå·±çš„å†…å­˜ç®¡ç†æœºåˆ¶</td></tr><tr><td><strong>åƒåœ¾å›æ”¶</strong></td><td>JVMçš„GCç®—æ³•</td><td>ARTçš„GCç®—æ³•</td></tr><tr><td><strong>å‚æ•°è°ƒä¼˜</strong></td><td>JVMå‚æ•°ï¼ˆ-Xmxç­‰ï¼‰</td><td>ARTå‚æ•°ï¼ˆä¸åŒçš„å‚æ•°ï¼‰</td></tr></tbody></table>
<p><strong>é‡è¦ç»“è®ºï¼š</strong></p>
<ul>
<li>JVMå†…å­˜å‚æ•°è°ƒä¼˜<strong>ä¸é€‚ç”¨äºAndroidå¼€å‘</strong></li>
<li>Androidå¼€å‘éœ€è¦äº†è§£ARTçš„å†…å­˜ç®¡ç†æœºåˆ¶</li>
<li>è™½ç„¶è¯­æ³•ç›¸åŒï¼Œä½†è¿è¡Œæ—¶ç¯å¢ƒå®Œå…¨ä¸åŒ</li>
</ul>
<h4 data-id="heading-83">13.2 ARTä¸JVMçš„ä¸»è¦åŒºåˆ«ï¼ˆç®€è¦ï¼‰</h4>
<p><strong>1. ç¼–è¯‘æ–¹å¼ä¸åŒï¼š</strong></p>
<ul>
<li><strong>JVM</strong>ï¼šè§£é‡Šæ‰§è¡Œå­—èŠ‚ç  + JITç¼–è¯‘çƒ­ç‚¹ä»£ç </li>
<li><strong>ART</strong>ï¼šAOTï¼ˆAhead-Of-Timeï¼‰ç¼–è¯‘ï¼Œå®‰è£…æ—¶ç¼–è¯‘ä¸ºæœºå™¨ç </li>
</ul>
<p><strong>2. å†…å­˜ç®¡ç†ä¸åŒï¼š</strong></p>
<ul>
<li><strong>JVM</strong>ï¼šä½¿ç”¨æœ¬æ–‡ä»‹ç»çš„JVMå†…å­˜åŒºåŸŸæ¨¡å‹</li>
<li><strong>ART</strong>ï¼šæœ‰è‡ªå·±çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œä¸å®Œå…¨ç­‰åŒäºJVM</li>
</ul>
<p><strong>3. åƒåœ¾å›æ”¶ä¸åŒï¼š</strong></p>
<ul>
<li><strong>JVM</strong>ï¼šå¤šç§GCç®—æ³•å’Œæ”¶é›†å™¨ï¼ˆSerialã€Parallelã€CMSã€G1ç­‰ï¼‰</li>
<li><strong>ART</strong>ï¼šä½¿ç”¨è‡ªå·±çš„GCç®—æ³•ï¼ˆå¹¶å‘æ ‡è®°æ¸…é™¤ç­‰ï¼‰</li>
</ul>
<h4 data-id="heading-84">13.3 ä¸ºä»€ä¹ˆéœ€è¦äº†è§£è¿™ä¸ªåŒºåˆ«</h4>
<p><strong>å­¦ä¹ ç›®çš„ï¼š</strong></p>
<ol>
<li><strong>ç†è§£Androidå’Œä¼ ç»ŸJavaåº”ç”¨çš„åŒºåˆ«</strong></li>
<li><strong>çŸ¥é“JVMå†…å­˜æ¨¡å‹ä¸»è¦é€‚ç”¨äºä¼ ç»ŸJavaåº”ç”¨</strong></li>
<li><strong>Androidå¼€å‘éœ€è¦äº†è§£ARTçš„å†…å­˜ç®¡ç†ï¼Œè€Œä¸æ˜¯JVM</strong></li>
</ol>
<p><strong>å®é™…åº”ç”¨ï¼š</strong></p>
<ul>
<li>å¦‚æœæ˜¯ä¼ ç»ŸJavaåº”ç”¨å¼€å‘ï¼Œå­¦ä¹ JVMå†…å­˜æ¨¡å‹</li>
<li>å¦‚æœæ˜¯Androidå¼€å‘ï¼Œéœ€è¦å­¦ä¹ ARTçš„å†…å­˜ç®¡ç†æœºåˆ¶</li>
<li>ä¸¤è€…è™½ç„¶æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†æ˜¯ä¸åŒçš„æŠ€æœ¯æ ˆ</li>
</ul>
<hr/>
<h2 data-id="heading-85">ç¬¬å…­éƒ¨åˆ†ï¼šé¢è¯•é¢˜</h2>
<h3 data-id="heading-86">14. JVMå†…å­˜åŒºåŸŸé¢è¯•é¢˜</h3>
<h4 data-id="heading-87">14.1 åŸºç¡€æ¦‚å¿µé¢˜</h4>
<p><strong>1. JVMå†…å­˜åŒºåŸŸæœ‰å“ªäº›ï¼Ÿè¯·ç”»å‡ºæ•´ä½“æ¶æ„å›¾</strong></p>
<p>JVMå†…å­˜åŒºåŸŸåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>çº¿ç¨‹ç§æœ‰åŒºåŸŸ</strong>ï¼šç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ</li>
<li><strong>çº¿ç¨‹å…±äº«åŒºåŸŸ</strong>ï¼šJavaå †ã€æ–¹æ³•åŒº</li>
<li><strong>ç›´æ¥å†…å­˜</strong>ï¼šå †å¤–å†…å­˜ï¼ŒNIOä½¿ç”¨</li>
</ul>
<p>æ•´ä½“æ¶æ„å›¾ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">JVMå†…å­˜åŒºåŸŸæ•´ä½“æ¶æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¨‹åºè®¡æ•°å™¨ (ç§æœ‰)   â”‚
â”‚  è™šæ‹Ÿæœºæ ˆ (ç§æœ‰)     â”‚
â”‚  æœ¬åœ°æ–¹æ³•æ ˆ (ç§æœ‰)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Javaå † (å…±äº«)     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚æ–°ç”Ÿä»£â”‚  â”‚è€å¹´ä»£â”‚  â”‚
â”‚  â”‚ Eden â”‚  â”‚     â”‚  â”‚
â”‚  â”‚ S0S1 â”‚  â”‚     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ–¹æ³•åŒº (å…±äº«)      â”‚
â”‚  è¿è¡Œæ—¶å¸¸é‡æ±         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç›´æ¥å†…å­˜ (å †å¤–)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>2. å“ªäº›åŒºåŸŸæ˜¯çº¿ç¨‹å…±äº«çš„ï¼Ÿå“ªäº›æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Ÿ</strong></p>
<ul>
<li><strong>çº¿ç¨‹ç§æœ‰åŒºåŸŸ</strong>ï¼šç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆ</li>
<li><strong>çº¿ç¨‹å…±äº«åŒºåŸŸ</strong>ï¼šJavaå †ã€æ–¹æ³•åŒº</li>
</ul>
<p><strong>3. çº¿ç¨‹ç§æœ‰åŒºåŸŸå’Œå…±äº«åŒºåŸŸçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p>ä¸»è¦åŒºåˆ«ï¼š</p>













































<table><thead><tr><th>ç‰¹æ€§</th><th>çº¿ç¨‹ç§æœ‰åŒºåŸŸ</th><th>çº¿ç¨‹å…±äº«åŒºåŸŸ</th></tr></thead><tbody><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>ä¸çº¿ç¨‹ç›¸åŒï¼Œçº¿ç¨‹åˆ›å»ºæ—¶åˆ›å»ºï¼Œçº¿ç¨‹é”€æ¯æ—¶é”€æ¯</td><td>ä¸JVMç›¸åŒï¼ŒJVMå¯åŠ¨æ—¶åˆ›å»ºï¼ŒJVMå…³é—­æ—¶é”€æ¯</td></tr><tr><td><strong>è®¿é—®æ–¹å¼</strong></td><td>çº¿ç¨‹ç‹¬ç«‹è®¿é—®ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„åŒºåŸŸ</td><td>æ‰€æœ‰çº¿ç¨‹å…±äº«è®¿é—®åŒä¸€ä¸ªåŒºåŸŸ</td></tr><tr><td><strong>çº¿ç¨‹å®‰å…¨</strong></td><td>å¤©ç„¶çº¿ç¨‹å®‰å…¨ï¼Œæ— éœ€åŒæ­¥æœºåˆ¶</td><td>éœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</td></tr><tr><td><strong>å­˜å‚¨å†…å®¹</strong></td><td>å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ç­‰</td><td>å¯¹è±¡å®ä¾‹ã€ç±»ä¿¡æ¯ã€å¸¸é‡ç­‰</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>ä¸çº¿ç¨‹æ•°æˆæ­£æ¯”ï¼ˆæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰æ ˆï¼‰</td><td>ä¸å¯¹è±¡æ•°ç›¸å…³ï¼Œä¸çº¿ç¨‹æ•°æ— å…³</td></tr><tr><td><strong>GCå½±å“</strong></td><td>ä¸æ¶‰åŠGCï¼Œçº¿ç¨‹é”€æ¯æ—¶è‡ªåŠ¨å›æ”¶</td><td>GCçš„ä¸»è¦åŒºåŸŸï¼Œéœ€è¦åƒåœ¾å›æ”¶</td></tr><tr><td><strong>è®¿é—®é€Ÿåº¦</strong></td><td>å¿«é€Ÿï¼Œæ— éœ€åŒæ­¥ï¼Œç›´æ¥è®¿é—®</td><td>éœ€è¦åŒæ­¥ï¼Œå¯èƒ½è¾ƒæ…¢</td></tr></tbody></table>
<p><strong>å…³é”®åŒºåˆ«æ€»ç»“ï¼š</strong></p>
<ol>
<li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šç§æœ‰åŒºåŸŸéšçº¿ç¨‹ï¼Œå…±äº«åŒºåŸŸéšJVM</li>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šç§æœ‰åŒºåŸŸå¤©ç„¶å®‰å…¨ï¼Œå…±äº«åŒºåŸŸéœ€è¦åŒæ­¥</li>
<li><strong>GCå½±å“</strong>ï¼šç§æœ‰åŒºåŸŸä¸æ¶‰åŠGCï¼Œå…±äº«åŒºåŸŸæ˜¯GCçš„ä¸»è¦åŒºåŸŸ</li>
<li><strong>è®¿é—®é€Ÿåº¦</strong>ï¼šç§æœ‰åŒºåŸŸå¿«é€Ÿï¼Œå…±äº«åŒºåŸŸéœ€è¦åŒæ­¥</li>
</ol>
<p><strong>4. ä¸ºä»€ä¹ˆéœ€è¦åŒºåˆ†çº¿ç¨‹ç§æœ‰åŒºåŸŸå’Œå…±äº«åŒºåŸŸï¼Ÿ</strong></p>
<p>ä¸»è¦è®¾è®¡åŸå› ï¼š</p>
<ol>
<li>
<p><strong>æ€§èƒ½è€ƒè™‘</strong></p>
<ul>
<li>ç§æœ‰åŒºåŸŸï¼šè®¿é—®å¿«é€Ÿï¼Œæ— éœ€åŒæ­¥æœºåˆ¶ï¼Œæé«˜æ‰§è¡Œæ•ˆç‡</li>
<li>å…±äº«åŒºåŸŸï¼šç»Ÿä¸€ç®¡ç†ï¼Œå‡å°‘å†…å­˜å ç”¨ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹å®‰å…¨</strong></p>
<ul>
<li>ç§æœ‰åŒºåŸŸï¼šå¤©ç„¶çº¿ç¨‹å®‰å…¨ï¼Œé¿å…æ•°æ®ç«äº‰ï¼Œç®€åŒ–ç¼–ç¨‹</li>
<li>å…±äº«åŒºåŸŸï¼šéœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œä½†å…è®¸çº¿ç¨‹é—´é€šä¿¡</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜ç®¡ç†</strong></p>
<ul>
<li>ç§æœ‰åŒºåŸŸï¼šéšçº¿ç¨‹é”€æ¯è‡ªåŠ¨å›æ”¶ï¼Œç®¡ç†ç®€å•</li>
<li>å…±äº«åŒºåŸŸï¼šéœ€è¦GCç»Ÿä¸€ç®¡ç†ï¼Œç”Ÿå‘½å‘¨æœŸé•¿</li>
</ul>
</li>
<li>
<p><strong>æ•°æ®éš”ç¦»</strong></p>
<ul>
<li>ç§æœ‰åŒºåŸŸï¼šçº¿ç¨‹é—´æ•°æ®éš”ç¦»ï¼Œé¿å…ç›¸äº’å¹²æ‰°</li>
<li>å…±äº«åŒºåŸŸï¼šå…è®¸çº¿ç¨‹é—´æ•°æ®å…±äº«å’Œé€šä¿¡ï¼Œå®ç°åä½œ</li>
</ul>
</li>
</ol>
<p><strong>å®é™…å¥½å¤„ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç§æœ‰åŒºåŸŸï¼šæ— éœ€åŒæ­¥ï¼Œæ€§èƒ½å¥½</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// åœ¨æ ˆä¸­ï¼Œçº¿ç¨‹ç§æœ‰ï¼Œæ— éœ€åŒæ­¥</span>
    local++;  <span class="hljs-comment">// å¿«é€Ÿï¼Œæ— éœ€åŠ é”</span>
}

<span class="hljs-comment">// å…±äº«åŒºåŸŸï¼šéœ€è¦åŒæ­¥ï¼Œä½†å…è®¸çº¿ç¨‹é—´é€šä¿¡</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// åœ¨å †ä¸­ï¼Œçº¿ç¨‹å…±äº«</span>

<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
    shared++;  <span class="hljs-comment">// éœ€è¦åŒæ­¥ï¼Œä½†å…è®¸å¤šä¸ªçº¿ç¨‹åä½œ</span>
}
</code></pre>
<p><strong>5. çº¿ç¨‹ç§æœ‰åŒºåŸŸå’Œå…±äº«åŒºåŸŸå„è‡ªçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<ul>
<li><strong>ç§æœ‰åŒºåŸŸçš„ä½œç”¨</strong>ï¼šå­˜å‚¨çº¿ç¨‹ç§æœ‰æ•°æ®ã€è®°å½•æ‰§è¡ŒçŠ¶æ€ã€ä¿è¯çº¿ç¨‹å®‰å…¨</li>
<li><strong>å…±äº«åŒºåŸŸçš„ä½œç”¨</strong>ï¼šå­˜å‚¨å…±äº«æ•°æ®ã€çº¿ç¨‹é—´é€šä¿¡ã€èµ„æºå…±äº«</li>
</ul>
<p><strong>6. æ•°æ®æ˜¯å¦‚ä½•åœ¨ç§æœ‰åŒºåŸŸå’Œå…±äº«åŒºåŸŸä¹‹é—´æµè½¬çš„ï¼Ÿ</strong></p>
<p>æ•°æ®æµè½¬çš„å®Œæ•´è¿‡ç¨‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> è¯»å–å¼•ç”¨ï¼šå †(å…±äº«) â†’ æ ˆ(ç§æœ‰)
   çº¿ç¨‹ä»å †ä¸­è¯»å–å¯¹è±¡å¼•ç”¨ï¼Œå­˜å‚¨åˆ°æ ˆçš„å±€éƒ¨å˜é‡è¡¨ä¸­

<span class="hljs-bullet">2.</span> æ“ä½œå¼•ç”¨ï¼šåœ¨æ ˆä¸­æ“ä½œå¯¹è±¡å¼•ç”¨
   çº¿ç¨‹åœ¨æ ˆä¸­å¯¹å¼•ç”¨è¿›è¡Œæ“ä½œï¼ˆèµ‹å€¼ã€ä¼ é€’ç­‰ï¼‰

<span class="hljs-bullet">3.</span> è®¿é—®å¯¹è±¡ï¼šæ ˆ(ç§æœ‰) â†’ å †(å…±äº«)
   çº¿ç¨‹é€šè¿‡æ ˆä¸­çš„å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡

<span class="hljs-bullet">4.</span> ä¿®æ”¹å¯¹è±¡ï¼šä¿®æ”¹å †ä¸­çš„å¯¹è±¡ï¼ˆéœ€è¦åŒæ­¥ï¼‰
   å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªå¯¹è±¡æ—¶éœ€è¦åŒæ­¥æœºåˆ¶
</code></pre>
<p><strong>å®é™…ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataFlow</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">shared</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">// åœ¨å †ä¸­ï¼ˆå…±äº«åŒºåŸŸï¼‰</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ­¥éª¤1ï¼šä»å †è¯»å–å¼•ç”¨åˆ°æ ˆ</span>
        <span class="hljs-type">DataFlow</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>;  <span class="hljs-comment">// objå¼•ç”¨åœ¨æ ˆä¸­ï¼ŒæŒ‡å‘å †ä¸­çš„å¯¹è±¡</span>
        
        <span class="hljs-comment">// æ­¥éª¤2ï¼šåœ¨æ ˆä¸­æ“ä½œå¼•ç”¨</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">local</span> <span class="hljs-operator">=</span> obj.shared;  <span class="hljs-comment">// é€šè¿‡å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</span>
        
        <span class="hljs-comment">// æ­¥éª¤3ï¼šä¿®æ”¹å †ä¸­çš„å¯¹è±¡ï¼ˆéœ€è¦åŒæ­¥ï¼‰</span>
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            obj.shared = <span class="hljs-number">100</span>;  <span class="hljs-comment">// ä¿®æ”¹å †ä¸­çš„å…±äº«å˜é‡</span>
        }
    }
}
</code></pre>
<p><strong>7. ç¨‹åºè®¡æ•°å™¨çš„ä½œç”¨å’Œç‰¹ç‚¹ï¼Ÿ</strong></p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>è®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤åœ°å€</li>
<li>çº¿ç¨‹ç§æœ‰ï¼Œæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹</li>
<li>åˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰éƒ½éœ€è¦ä¾èµ–ç¨‹åºè®¡æ•°å™¨</li>
</ul>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ol>
<li>
<p><strong>å”¯ä¸€ä¸ä¼šå‘ç”ŸOutOfMemoryErrorçš„åŒºåŸŸ</strong></p>
<ul>
<li>ç¨‹åºè®¡æ•°å™¨å ç”¨çš„å†…å­˜å¾ˆå°ï¼Œå‡ ä¹å¯ä»¥å¿½ç•¥</li>
<li>ä¸ä¼šå› ä¸ºç¨‹åºè®¡æ•°å™¨çš„åŸå› å¯¼è‡´å†…å­˜æº¢å‡º</li>
</ul>
</li>
<li>
<p><strong>çº¿ç¨‹ç§æœ‰</strong></p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨</li>
<li>çº¿ç¨‹ä¹‹é—´äº’ä¸å½±å“</li>
</ul>
</li>
<li>
<p><strong>æ‰§è¡ŒNativeæ–¹æ³•æ—¶å€¼ä¸ºç©º</strong></p>
<ul>
<li>æ‰§è¡ŒJavaæ–¹æ³•æ—¶ï¼Œè®°å½•å­—èŠ‚ç æŒ‡ä»¤åœ°å€</li>
<li>æ‰§è¡ŒNativeæ–¹æ³•æ—¶ï¼Œå€¼ä¸ºç©ºï¼ˆundefinedï¼‰</li>
</ul>
</li>
</ol>
<p><strong>å®é™…åº”ç”¨ï¼š</strong></p>
<ul>
<li>çº¿ç¨‹åˆ‡æ¢æ—¶ä¿å­˜å’Œæ¢å¤æ‰§è¡Œä½ç½®</li>
<li>åˆ†æ”¯ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ç­‰æ§åˆ¶æµçš„åŸºç¡€</li>
</ul>
<p><strong>8. Javaè™šæ‹Ÿæœºæ ˆçš„ä½œç”¨å’Œç»“æ„ï¼Ÿè¯·ç”»å‡ºæ ˆå¸§ç»“æ„å›¾</strong></p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>å­˜å‚¨å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€ä¸­é—´ç»“æœç­‰</li>
<li>æ¯ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªæ ˆå¸§</li>
<li>çº¿ç¨‹ç§æœ‰</li>
</ul>
<p><strong>æ ˆå¸§ç»“æ„å›¾ï¼š</strong></p>
<pre><code class="hljs">æ ˆå¸§ç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å±€éƒ¨å˜é‡è¡¨   â”‚ - å­˜å‚¨æ–¹æ³•å‚æ•°å’Œå±€éƒ¨å˜é‡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ“ä½œæ•°æ ˆ     â”‚ - ç”¨äºè®¡ç®—å’Œä¸´æ—¶å­˜å‚¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŠ¨æ€é“¾æ¥     â”‚ - æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ–¹æ³•è¿”å›åœ°å€ â”‚ - æ–¹æ³•æ­£å¸¸è¿”å›æˆ–å¼‚å¸¸è¿”å›çš„åœ°å€
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æ ˆå¸§å„éƒ¨åˆ†è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>å±€éƒ¨å˜é‡è¡¨</strong>ï¼šå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå±€éƒ¨å˜é‡ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡å¼•ç”¨ï¼‰</li>
<li><strong>æ“ä½œæ•°æ ˆ</strong>ï¼šç”¨äºè®¡ç®—å’Œä¸´æ—¶å­˜å‚¨ï¼ŒLIFOç»“æ„</li>
<li><strong>åŠ¨æ€é“¾æ¥</strong>ï¼šæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨ï¼Œæ”¯æŒå¤šæ€</li>
<li><strong>æ–¹æ³•è¿”å›åœ°å€</strong>ï¼šæ–¹æ³•é€€å‡ºåè¿”å›åˆ°å“ªæ¡æŒ‡ä»¤ç»§ç»­æ‰§è¡Œ</li>
</ol>
<p><strong>9. æ ˆå¸§åŒ…å«å“ªäº›éƒ¨åˆ†ï¼Ÿ</strong></p>
<ul>
<li>å±€éƒ¨å˜é‡è¡¨</li>
<li>æ“ä½œæ•°æ ˆ</li>
<li>åŠ¨æ€é“¾æ¥</li>
<li>æ–¹æ³•è¿”å›åœ°å€</li>
</ul>
<p><strong>10. å±€éƒ¨å˜é‡è¡¨çš„ä½œç”¨ï¼Ÿ</strong></p>
<p>å­˜å‚¨æ–¹æ³•å‚æ•°å’Œå±€éƒ¨å˜é‡ï¼ŒåŒ…æ‹¬åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡å¼•ç”¨ã€‚</p>
<p><strong>11. æ“ä½œæ•°æ ˆçš„ä½œç”¨ï¼Ÿ</strong></p>
<p>ç”¨äºè®¡ç®—å’Œä¸´æ—¶å­˜å‚¨ï¼ŒLIFOç»“æ„ã€‚</p>
<p><strong>12. æœ¬åœ°æ–¹æ³•æ ˆçš„ä½œç”¨ï¼Ÿ</strong></p>
<p>ä¸ºNativeæ–¹æ³•æœåŠ¡ï¼Œä¸è™šæ‹Ÿæœºæ ˆç±»ä¼¼ä½†æœåŠ¡äºæœ¬åœ°æ–¹æ³•ã€‚</p>
<p><strong>13. Javaå †çš„ä½œç”¨å’Œç»“æ„ï¼Ÿè¯·ç”»å‡ºå †çš„ç»“æ„å›¾</strong></p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ul>
<li>å­˜å‚¨å¯¹è±¡å®ä¾‹å’Œæ•°ç»„</li>
<li>æ‰€æœ‰çº¿ç¨‹å…±äº«</li>
<li>JVMç®¡ç†çš„æœ€å¤§ä¸€å—å†…å­˜åŒºåŸŸ</li>
</ul>
<p><strong>å †çš„ç»“æ„å›¾ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">Javaå †ç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æ–°ç”Ÿä»£(<span class="hljs-number">1</span>/<span class="hljs-number">3</span>)   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  <span class="hljs-built_in">Eden</span>(<span class="hljs-number">80%</span>)â”‚  â”‚ - æ–°å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨è¿™é‡Œ
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ <span class="hljs-built_in">S0</span>(<span class="hljs-number">10%</span>)S1 â”‚  â”‚ - Minor GCåå­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°è¿™é‡Œ
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   è€å¹´ä»£(<span class="hljs-number">2</span>/<span class="hljs-number">3</span>)    â”‚ - é•¿æœŸå­˜æ´»çš„å¯¹è±¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ¯”ä¾‹ï¼ˆé»˜è®¤ï¼‰ï¼š
æ–°ç”Ÿä»£ : è€å¹´ä»£ = <span class="hljs-number">1</span> : <span class="hljs-number">2</span>
Eden : Survivor0 : Survivor1 = <span class="hljs-number">8</span> : <span class="hljs-number">1</span> : <span class="hljs-number">1</span>
</code></pre>
<p><strong>å„éƒ¨åˆ†è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>EdenåŒº</strong>ï¼šæ–°å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨è¿™é‡Œï¼Œçº¦å æ–°ç”Ÿä»£çš„80%</li>
<li><strong>SurvivoråŒº</strong>ï¼šåˆ†ä¸ºS0å’ŒS1ï¼Œç”¨äºMinor GCåå­˜æ´»å¯¹è±¡çš„æš‚å­˜ï¼Œå„çº¦å æ–°ç”Ÿä»£çš„10%</li>
<li><strong>è€å¹´ä»£</strong>ï¼šå­˜å‚¨é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œçº¦å å †çš„2/3</li>
</ul>
<p><strong>14. æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„åŒºåˆ«ï¼Ÿ</strong></p>
<ul>
<li><strong>æ–°ç”Ÿä»£</strong>ï¼šå¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼ŒGCé¢‘ç¹ï¼Œå å †çš„1/3</li>
<li><strong>è€å¹´ä»£</strong>ï¼šå¯¹è±¡ç”Ÿå‘½å‘¨æœŸé•¿ï¼ŒGCé¢‘ç‡ä½ä½†è€—æ—¶é•¿ï¼Œå å †çš„2/3</li>
</ul>
<p><strong>15. ä¸ºä»€ä¹ˆè¦æœ‰SurvivoråŒºï¼Ÿ</strong></p>
<p>è®©å¯¹è±¡åœ¨æ–°ç”Ÿä»£å¤šå­˜æ´»å‡ æ¬¡ï¼Œåªæœ‰çœŸæ­£é•¿æœŸå­˜æ´»çš„å¯¹è±¡æ‰è¿›å…¥è€å¹´ä»£ï¼Œå‡å°‘Full GCçš„é¢‘ç‡ã€‚</p>
<p><strong>16. ä¸ºä»€ä¹ˆè¦æœ‰ä¸¤ä¸ªSurvivoråŒºï¼Ÿ</strong></p>
<p>å®ç°å¤åˆ¶ç®—æ³•ï¼Œä¿è¯æ–°ç”Ÿä»£å§‹ç»ˆæœ‰ä¸€ä¸ªSurvivoråŒºæ˜¯ç©ºçš„ï¼Œé¿å…å†…å­˜ç¢ç‰‡ã€‚</p>
<p><strong>17. æ–¹æ³•åŒºçš„ä½œç”¨ï¼Ÿ</strong></p>
<p>å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€JITç¼–è¯‘åçš„ä»£ç ã€‚</p>
<p><strong>18. æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´çš„åŒºåˆ«ï¼Ÿ</strong></p>
<p>ä¸»è¦åŒºåˆ«ï¼š</p>








































<table><thead><tr><th>ç‰¹æ€§</th><th>æ°¸ä¹…ä»£ï¼ˆPermGenï¼‰</th><th>å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</th></tr></thead><tbody><tr><td><strong>å­˜å‚¨ä½ç½®</strong></td><td>å †å†…å­˜ä¸­</td><td>æœ¬åœ°å†…å­˜ï¼ˆNative Memoryï¼‰</td></tr><tr><td><strong>å¤§å°é™åˆ¶</strong></td><td>å›ºå®šå¤§å°ï¼Œéœ€è¦é¢„å…ˆè®¾ç½®</td><td>åŠ¨æ€è°ƒæ•´ï¼Œé»˜è®¤æ— é™åˆ¶</td></tr><tr><td><strong>å†…å­˜ç®¡ç†</strong></td><td>å—JVMå †å†…å­˜é™åˆ¶</td><td>ä¸å—JVMå †å†…å­˜é™åˆ¶</td></tr><tr><td><strong>GCå½±å“</strong></td><td>GCæ•ˆç‡è¾ƒä½</td><td>GCæ•ˆç‡è¾ƒé«˜</td></tr><tr><td><strong>æº¢å‡ºé—®é¢˜</strong></td><td>å®¹æ˜“æº¢å‡ºï¼ˆPermGen spaceï¼‰</td><td>ç›¸å¯¹ä¸å®¹æ˜“æº¢å‡ºï¼ˆMetaspaceï¼‰</td></tr><tr><td><strong>é€‚ç”¨ç‰ˆæœ¬</strong></td><td>JDK 8ä¹‹å‰</td><td>JDK 8åŠä¹‹å</td></tr></tbody></table>
<p><strong>ä¸ºä»€ä¹ˆæ”¹ç”¨å…ƒç©ºé—´ï¼Ÿ</strong></p>
<ul>
<li>æé«˜GCæ•ˆç‡ï¼šå…ƒç©ºé—´çš„GCæ•ˆç‡æ¯”æ°¸ä¹…ä»£é«˜</li>
<li>é¿å…æº¢å‡ºï¼šæ°¸ä¹…ä»£å›ºå®šå¤§å°å®¹æ˜“æº¢å‡ºï¼Œå…ƒç©ºé—´åŠ¨æ€è°ƒæ•´</li>
<li>æ›´å¥½çš„å†…å­˜ç®¡ç†ï¼šå…ƒç©ºé—´ä½¿ç”¨æœ¬åœ°å†…å­˜ï¼Œç®¡ç†æ›´çµæ´»</li>
</ul>
<p><strong>19. ä¸ºä»€ä¹ˆæ°¸ä¹…ä»£è¢«å…ƒç©ºé—´æ›¿ä»£ï¼Ÿ</strong></p>
<p>æé«˜GCæ•ˆç‡ã€é¿å…æº¢å‡ºã€æ›´å¥½çš„å†…å­˜ç®¡ç†ã€ä¸HotSpotåˆ†ç¦»ã€‚</p>
<p><strong>20. è¿è¡Œæ—¶å¸¸é‡æ± çš„ä½œç”¨ï¼Ÿ</strong></p>
<p>å­˜å‚¨ç¼–è¯‘æœŸç”Ÿæˆçš„å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ã€‚</p>
<p><strong>21. ç›´æ¥å†…å­˜çš„ä½œç”¨ï¼Ÿ</strong></p>
<p>NIOä½¿ç”¨ï¼Œå †å¤–å†…å­˜ï¼Œæé«˜I/Oæ€§èƒ½ã€‚</p>
<h4 data-id="heading-88">14.2 æ·±å…¥ç†è§£é¢˜</h4>
<p><strong>1. å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹ï¼Ÿè¯·ç”»å‡ºæµç¨‹å›¾</strong></p>
<p>å¯¹è±¡åˆ›å»ºçš„å®Œæ•´æµç¨‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">å¯¹è±¡åˆ›å»ºæµç¨‹ï¼š

<span class="hljs-bullet">1.</span> ç±»åŠ è½½æ£€æŸ¥
<span class="hljs-bullet">   -</span> æ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½
<span class="hljs-bullet">   -</span> å¦‚æœæ²¡æœ‰ï¼Œæ‰§è¡Œç±»åŠ è½½è¿‡ç¨‹
   â†“
<span class="hljs-bullet">2.</span> åˆ†é…å†…å­˜
<span class="hljs-bullet">   -</span> æŒ‡é’ˆç¢°æ’ï¼ˆå †å†…å­˜è§„æ•´ï¼‰
<span class="hljs-bullet">   -</span> ç©ºé—²åˆ—è¡¨ï¼ˆå †å†…å­˜ä¸è§„æ•´ï¼‰
<span class="hljs-bullet">   -</span> TLABï¼ˆæ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹çš„åˆ†é…åŒºåŸŸï¼‰
   â†“
<span class="hljs-bullet">3.</span> åˆå§‹åŒ–é›¶å€¼
<span class="hljs-bullet">   -</span> å°†å†…å­˜ç©ºé—´åˆå§‹åŒ–ä¸ºé›¶å€¼
<span class="hljs-bullet">   -</span> åŸºæœ¬ç±»å‹ï¼š0ã€falseã€0.0
<span class="hljs-bullet">   -</span> å¼•ç”¨ç±»å‹ï¼šnull
   â†“
<span class="hljs-bullet">4.</span> è®¾ç½®å¯¹è±¡å¤´
<span class="hljs-bullet">   -</span> Mark Wordï¼ˆhashCodeã€GCå¹´é¾„ã€é”çŠ¶æ€ç­‰ï¼‰
<span class="hljs-bullet">   -</span> ç±»å‹æŒ‡é’ˆï¼ˆæŒ‡å‘ç±»å…ƒæ•°æ®ï¼‰
<span class="hljs-bullet">   -</span> æ•°ç»„é•¿åº¦ï¼ˆå¦‚æœæ˜¯æ•°ç»„ï¼‰
   â†“
<span class="hljs-bullet">5.</span> æ‰§è¡Œæ„é€ å‡½æ•°
<span class="hljs-bullet">   -</span> æ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç 
<span class="hljs-bullet">   -</span> æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿åˆå§‹åŒ–å¯¹è±¡
</code></pre>
<p><strong>è¯¦ç»†è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>ç±»åŠ è½½æ£€æŸ¥</strong>ï¼šé‡åˆ°newæŒ‡ä»¤æ—¶ï¼Œæ£€æŸ¥ç±»æ˜¯å¦å·²åŠ è½½</li>
<li><strong>åˆ†é…å†…å­˜</strong>ï¼šåœ¨å †ä¸­åˆ†é…å†…å­˜ç©ºé—´ï¼ˆä¼˜å…ˆåœ¨EdenåŒºï¼‰</li>
<li><strong>åˆå§‹åŒ–é›¶å€¼</strong>ï¼šå°†åˆ†é…çš„å†…å­˜åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼Œä¿è¯å­—æ®µå¯ä»¥ä¸èµ‹å€¼å°±ä½¿ç”¨</li>
<li><strong>è®¾ç½®å¯¹è±¡å¤´</strong>ï¼šè®¾ç½®Mark Wordå’Œç±»å‹æŒ‡é’ˆç­‰å…ƒæ•°æ®</li>
<li><strong>æ‰§è¡Œæ„é€ å‡½æ•°</strong>ï¼šæŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿åˆå§‹åŒ–å¯¹è±¡</li>
</ol>
<p><strong>2. å¯¹è±¡çš„å†…å­˜å¸ƒå±€ï¼Ÿè¯·ç”»å‡ºå¸ƒå±€å›¾</strong></p>
<p>å¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">å¯¹è±¡å†…å­˜å¸ƒå±€ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹è±¡å¤´      â”‚ 
â”‚  - <span class="hljs-selector-tag">Mark</span> Wordâ”‚ (hashCodeã€GCå¹´é¾„ã€é”çŠ¶æ€)
â”‚  - ç±»å‹æŒ‡é’ˆ  â”‚ (æŒ‡å‘ç±»å…ƒæ•°æ®)
â”‚  - æ•°ç»„é•¿åº¦  â”‚ (ä»…æ•°ç»„å¯¹è±¡æœ‰)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®ä¾‹æ•°æ®    â”‚ (å­—æ®µçš„å®é™…å€¼)
â”‚  - çˆ¶ç±»å­—æ®µ  â”‚
â”‚  - å­ç±»å­—æ®µ  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯¹é½å¡«å……    â”‚ (ä¿è¯<span class="hljs-number">8</span>å­—èŠ‚å¯¹é½)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¯¹è±¡å¤§å° = å¯¹è±¡å¤´ + å®ä¾‹æ•°æ® + å¯¹é½å¡«å……
</code></pre>
<p><strong>å„éƒ¨åˆ†è¯´æ˜ï¼š</strong></p>
<ol>
<li>
<p><strong>å¯¹è±¡å¤´ï¼ˆHeaderï¼‰</strong></p>
<ul>
<li>Mark Wordï¼šå­˜å‚¨å¯¹è±¡çš„hashCodeã€GCå¹´é¾„ã€é”çŠ¶æ€ç­‰</li>
<li>ç±»å‹æŒ‡é’ˆï¼šæŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»å…ƒæ•°æ®</li>
<li>æ•°ç»„é•¿åº¦ï¼šä»…æ•°ç»„å¯¹è±¡æœ‰</li>
</ul>
</li>
<li>
<p><strong>å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰</strong></p>
<ul>
<li>å­˜å‚¨å¯¹è±¡çš„å®é™…å­—æ®µå€¼</li>
<li>çˆ¶ç±»å­—æ®µåœ¨å‰ï¼Œå­ç±»å­—æ®µåœ¨å</li>
<li>ç›¸åŒå®½åº¦çš„å­—æ®µåˆ†é…åœ¨ä¸€èµ·</li>
</ul>
</li>
<li>
<p><strong>å¯¹é½å¡«å……ï¼ˆPaddingï¼‰</strong></p>
<ul>
<li>ä¿è¯å¯¹è±¡å¤§å°æ˜¯8å­—èŠ‚çš„å€æ•°</li>
<li>æé«˜å†…å­˜è®¿é—®æ•ˆç‡</li>
</ul>
</li>
</ol>
<p><strong>3. å¯¹è±¡å¤´åŒ…å«å“ªäº›ä¿¡æ¯ï¼Ÿ</strong></p>
<ul>
<li>Mark Wordï¼šhashCodeã€GCå¹´é¾„ã€é”çŠ¶æ€ç­‰</li>
<li>ç±»å‹æŒ‡é’ˆï¼šæŒ‡å‘ç±»å…ƒæ•°æ®</li>
<li>æ•°ç»„é•¿åº¦ï¼šä»…æ•°ç»„å¯¹è±¡æœ‰</li>
</ul>
<p><strong>4. Mark Wordçš„ä½œç”¨å’Œç»“æ„ï¼Ÿ</strong></p>
<p><strong>Mark Wordçš„ä½œç”¨ï¼š</strong></p>
<p>Mark Wordæ˜¯å¯¹è±¡å¤´çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨å¯¹è±¡çš„è¿è¡Œæ—¶æ•°æ®ã€‚</p>
<p><strong>å­˜å‚¨å†…å®¹ï¼š</strong></p>
<ul>
<li><strong>hashCode</strong>ï¼šå¯¹è±¡çš„å“ˆå¸Œç </li>
<li><strong>GCå¹´é¾„</strong>ï¼šå¯¹è±¡ç»å†çš„GCæ¬¡æ•°ï¼ˆ4ä½ï¼Œæœ€å¤§15ï¼‰</li>
<li><strong>é”çŠ¶æ€</strong>ï¼šåå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ç­‰</li>
<li><strong>åå‘çº¿ç¨‹ID</strong>ï¼šåå‘é”çš„çº¿ç¨‹ID</li>
<li><strong>åå‘æ—¶é—´æˆ³</strong>ï¼šåå‘é”çš„æ—¶é—´æˆ³</li>
</ul>
<p><strong>Mark Wordçš„ç»“æ„ï¼ˆ64ä½JVMï¼‰ï¼š</strong></p>





























<table><thead><tr><th>é”çŠ¶æ€</th><th>Mark Wordï¼ˆ64ä½ï¼‰</th></tr></thead><tbody><tr><td><strong>æ— é”</strong></td><td>hashCode(31ä½) + GCå¹´é¾„(4ä½) + ...</td></tr><tr><td><strong>åå‘é”</strong></td><td>çº¿ç¨‹ID(54ä½) + Epoch(2ä½) + ...</td></tr><tr><td><strong>è½»é‡çº§é”</strong></td><td>æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ(62ä½) + ...</td></tr><tr><td><strong>é‡é‡çº§é”</strong></td><td>æŒ‡å‘monitorçš„æŒ‡é’ˆ(62ä½) + ...</td></tr><tr><td><strong>GCæ ‡è®°</strong></td><td>ç©ºï¼ˆä¸éœ€è¦è®°å½•ä¿¡æ¯ï¼‰</td></tr></tbody></table>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>Mark Wordåœ¨ä¸åŒé”çŠ¶æ€ä¸‹å­˜å‚¨ä¸åŒçš„ä¿¡æ¯</li>
<li>32ä½JVMï¼š32ä½ï¼Œ64ä½JVMï¼š64ä½</li>
<li>è¿™æ˜¯synchronizedé”å‡çº§çš„åŸºç¡€</li>
</ul>
<p><strong>5. ç±»å‹æŒ‡é’ˆçš„ä½œç”¨ï¼Ÿ</strong></p>
<p>æŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»å…ƒæ•°æ®ï¼Œç”¨äºç¡®å®šå¯¹è±¡ç±»å‹ã€æ”¯æŒinstanceofç­‰ã€‚</p>
<p><strong>6. å¯¹è±¡çš„è®¿é—®å®šä½æ–¹å¼æœ‰å“ªäº›ï¼Ÿè¯·ç”»å‡ºä¸¤ç§æ–¹å¼çš„å¯¹æ¯”å›¾</strong></p>
<p>å¯¹è±¡çš„è®¿é—®å®šä½æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<p><strong>æ–¹å¼1ï¼šå¥æŸ„è®¿é—®</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">å¥æŸ„è®¿é—®ï¼š

æ ˆå¼•ç”¨ â†’ å¥æŸ„æ±  â†’ å¯¹è±¡å®ä¾‹æ•°æ®
<span class="hljs-code">              â†’ ç±»å‹æ•°æ®
</span>
è®¿é—®è¿‡ç¨‹ï¼šéœ€è¦ä¸¤æ¬¡è®¿é—®ï¼ˆå…ˆè®¿é—®å¥æŸ„ï¼Œå†è®¿é—®å¯¹è±¡ï¼‰
</code></pre>
<p><strong>æ–¹å¼2ï¼šç›´æ¥æŒ‡é’ˆè®¿é—®ï¼ˆHotSpotä½¿ç”¨ï¼‰</strong></p>
<pre><code class="hljs">ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼ˆHotSpotï¼‰ï¼š

æ ˆå¼•ç”¨ â†’ å¯¹è±¡å®ä¾‹æ•°æ® â†’ ç±»å‹æ•°æ®ï¼ˆé€šè¿‡å¯¹è±¡å¤´ä¸­ç±»å‹æŒ‡é’ˆï¼‰

è®¿é—®è¿‡ç¨‹ï¼šåªéœ€ä¸€æ¬¡è®¿é—®ï¼ˆç›´æ¥è®¿é—®å¯¹è±¡ï¼‰
</code></pre>
<p><strong>ä¸¤ç§æ–¹å¼çš„å¯¹æ¯”ï¼š</strong></p>



































<table><thead><tr><th>ç‰¹æ€§</th><th>å¥æŸ„è®¿é—®</th><th>ç›´æ¥æŒ‡é’ˆè®¿é—®</th></tr></thead><tbody><tr><td><strong>è®¿é—®æ¬¡æ•°</strong></td><td>ä¸¤æ¬¡ï¼ˆå…ˆè®¿é—®å¥æŸ„ï¼Œå†è®¿é—®å¯¹è±¡ï¼‰</td><td>ä¸€æ¬¡ï¼ˆç›´æ¥è®¿é—®å¯¹è±¡ï¼‰</td></tr><tr><td><strong>è®¿é—®é€Ÿåº¦</strong></td><td>è¾ƒæ…¢</td><td>è¾ƒå¿«</td></tr><tr><td><strong>å¼•ç”¨ç¨³å®šæ€§</strong></td><td>å¼•ç”¨ä¸å˜ï¼Œå¯¹è±¡ç§»åŠ¨åªéœ€æ›´æ–°å¥æŸ„</td><td>å¼•ç”¨ç›´æ¥æŒ‡å‘å¯¹è±¡</td></tr><tr><td><strong>GCå¼€é”€</strong></td><td>è¾ƒå°ï¼ˆåªéœ€ç§»åŠ¨å¯¹è±¡ï¼Œæ›´æ–°å¥æŸ„ï¼‰</td><td>è¾ƒå¤§ï¼ˆéœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨ï¼‰</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>è¾ƒå¤§ï¼ˆéœ€è¦é¢å¤–çš„å¥æŸ„æ± ï¼‰</td><td>è¾ƒå°ï¼ˆä¸éœ€è¦å¥æŸ„æ± ï¼‰</td></tr></tbody></table>
<p><strong>HotSpotä¸ºä»€ä¹ˆä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Ÿ</strong></p>
<ul>
<li>æ€§èƒ½ä¼˜å…ˆï¼šè®¿é—®é€Ÿåº¦å¿«ï¼Œå‡å°‘é—´æ¥è®¿é—®å¼€é”€</li>
<li>å¯¹è±¡ç§»åŠ¨è¾ƒå°‘ï¼šç°ä»£GCç®—æ³•å¯ä»¥æ›´å¥½åœ°å¤„ç†å¯¹è±¡ç§»åŠ¨</li>
</ul>
<p><strong>7. å¥æŸ„è®¿é—®å’Œç›´æ¥æŒ‡é’ˆè®¿é—®çš„åŒºåˆ«ï¼Ÿ</strong></p>
<p>ä¸»è¦åŒºåˆ«ï¼š</p>








































<table><thead><tr><th>ç‰¹æ€§</th><th>å¥æŸ„è®¿é—®</th><th>ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼ˆHotSpotï¼‰</th></tr></thead><tbody><tr><td><strong>è®¿é—®æ¬¡æ•°</strong></td><td>ä¸¤æ¬¡ï¼ˆå…ˆè®¿é—®å¥æŸ„ï¼Œå†è®¿é—®å¯¹è±¡ï¼‰</td><td>ä¸€æ¬¡ï¼ˆç›´æ¥è®¿é—®å¯¹è±¡ï¼‰</td></tr><tr><td><strong>è®¿é—®é€Ÿåº¦</strong></td><td>è¾ƒæ…¢</td><td>è¾ƒå¿«</td></tr><tr><td><strong>å¼•ç”¨ç¨³å®šæ€§</strong></td><td>å¼•ç”¨ä¸å˜ï¼Œå¯¹è±¡ç§»åŠ¨åªéœ€æ›´æ–°å¥æŸ„</td><td>å¼•ç”¨ç›´æ¥æŒ‡å‘å¯¹è±¡</td></tr><tr><td><strong>GCå¼€é”€</strong></td><td>è¾ƒå°ï¼ˆåªéœ€ç§»åŠ¨å¯¹è±¡ï¼Œæ›´æ–°å¥æŸ„ï¼‰</td><td>è¾ƒå¤§ï¼ˆéœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨ï¼‰</td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>è¾ƒå¤§ï¼ˆéœ€è¦é¢å¤–çš„å¥æŸ„æ± ï¼‰</td><td>è¾ƒå°ï¼ˆä¸éœ€è¦å¥æŸ„æ± ï¼‰</td></tr><tr><td><strong>å®ç°å¤æ‚åº¦</strong></td><td>è¾ƒé«˜ï¼ˆéœ€è¦ç»´æŠ¤å¥æŸ„æ± ï¼‰</td><td>è¾ƒä½</td></tr></tbody></table>
<p><strong>HotSpotä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®çš„åŸå› ï¼š</strong></p>
<ul>
<li>è®¿é—®é€Ÿåº¦å¿«ï¼Œåªéœ€ä¸€æ¬¡å†…å­˜è®¿é—®</li>
<li>å¯¹è±¡ç§»åŠ¨é¢‘ç‡ä½ï¼Œç°ä»£GCç®—æ³•ä¼˜åŒ–äº†å¯¹è±¡ç§»åŠ¨</li>
<li>å®ç°ç®€å•ï¼Œä¸éœ€è¦ç»´æŠ¤å¥æŸ„æ± </li>
</ul>
<p><strong>8. HotSpotä¸ºä»€ä¹ˆä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®ï¼Ÿ</strong></p>
<p>æ€§èƒ½ä¼˜å…ˆï¼Œè®¿é—®é€Ÿåº¦å¿«ï¼Œå‡å°‘é—´æ¥è®¿é—®å¼€é”€ã€‚</p>
<p><strong>9. TLABæ˜¯ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></p>
<p>Thread Local Allocation Bufferï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨EdenåŒºæœ‰ç‹¬ç«‹çš„åˆ†é…åŒºåŸŸï¼Œé¿å…å¤šçº¿ç¨‹åˆ†é…å†…å­˜æ—¶çš„ç«äº‰ï¼Œæé«˜åˆ†é…æ•ˆç‡ã€‚</p>
<p><strong>10. æŒ‡é’ˆç¢°æ’å’Œç©ºé—²åˆ—è¡¨çš„åŒºåˆ«ï¼Ÿ</strong></p>
<ul>
<li><strong>æŒ‡é’ˆç¢°æ’</strong>ï¼šé€‚ç”¨äºå †å†…å­˜è§„æ•´ï¼Œç§»åŠ¨æŒ‡é’ˆåˆ†é…è¿ç»­å†…å­˜</li>
<li><strong>ç©ºé—²åˆ—è¡¨</strong>ï¼šé€‚ç”¨äºå †å†…å­˜ä¸è§„æ•´ï¼Œä»ç©ºé—²åˆ—è¡¨åˆ†é…</li>
</ul>
<p><strong>11. å¯¹è±¡å¤§å°å¦‚ä½•è®¡ç®—ï¼Ÿ</strong></p>
<p>å¯¹è±¡å¤´å¤§å° + å®ä¾‹æ•°æ®å¤§å° + å¯¹é½å¡«å……</p>
<p><strong>12. å¯¹é½å¡«å……çš„ä½œç”¨ï¼Ÿ</strong></p>
<p>ä¿è¯å¯¹è±¡å¤§å°æ˜¯8å­—èŠ‚çš„å€æ•°ï¼Œæé«˜å†…å­˜è®¿é—®æ•ˆç‡ã€‚</p>
<h3 data-id="heading-89">15. ç»¼åˆé¢è¯•é¢˜</h3>
<h4 data-id="heading-90">15.1 ç»¼åˆç†è§£é¢˜</h4>
<p><strong>1. JMMä¸»å†…å­˜ä¸JVMå †çš„å…³ç³»ï¼Ÿ</strong></p>
<p>JMMä¸­çš„"ä¸»å†…å­˜"ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„"å †"ã€‚å…±äº«å˜é‡å­˜å‚¨åœ¨å †ä¸­ï¼Œå †æ˜¯çº¿ç¨‹å…±äº«çš„ã€‚</p>
<p><strong>2. JMMå·¥ä½œå†…å­˜ä¸JVMè™šæ‹Ÿæœºæ ˆçš„å…³ç³»ï¼Ÿ</strong></p>
<p>JMMä¸­çš„"å·¥ä½œå†…å­˜"ä¸»è¦å¯¹åº”JVMå†…å­˜åŒºåŸŸä¸­çš„"è™šæ‹Ÿæœºæ ˆå±€éƒ¨å˜é‡è¡¨"ã€‚å˜é‡å‰¯æœ¬å­˜å‚¨åœ¨å±€éƒ¨å˜é‡è¡¨ä¸­ã€‚</p>
<p><strong>3. å¯¹è±¡åœ¨å †ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Ÿè¯·ç”»å‡ºå­˜å‚¨ç»“æ„</strong></p>
<p>å¯¹è±¡åœ¨å †ä¸­çš„å­˜å‚¨ç»“æ„ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">å¯¹è±¡åœ¨å †ä¸­çš„å¸ƒå±€ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¹è±¡å¤´      â”‚ 
â”‚  - <span class="hljs-selector-tag">Mark</span> Wordâ”‚ (<span class="hljs-number">64</span>ä½æˆ–<span class="hljs-number">32</span>ä½)
â”‚  - ç±»å‹æŒ‡é’ˆ  â”‚ (<span class="hljs-number">32</span>ä½æˆ–<span class="hljs-number">64</span>ä½ï¼Œå¯èƒ½å‹ç¼©)
â”‚  - æ•°ç»„é•¿åº¦  â”‚ (ä»…æ•°ç»„ï¼Œ<span class="hljs-number">32</span>ä½)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®ä¾‹æ•°æ®    â”‚ 
â”‚  - å­—æ®µå€¼    â”‚ (æŒ‰é¡ºåºå­˜å‚¨)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¯¹é½å¡«å……    â”‚ (ä¿è¯<span class="hljs-number">8</span>å­—èŠ‚å¯¹é½)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å­˜å‚¨è¯´æ˜ï¼š</strong></p>
<ol>
<li><strong>å¯¹è±¡å¤´</strong>ï¼šåŒ…å«Mark Wordå’Œç±»å‹æŒ‡é’ˆï¼Œç”¨äºæ ‡è¯†å¯¹è±¡å’ŒæŒ‡å‘ç±»ä¿¡æ¯</li>
<li><strong>å®ä¾‹æ•°æ®</strong>ï¼šå­˜å‚¨å¯¹è±¡çš„å®é™…å­—æ®µå€¼ï¼ŒæŒ‰ç…§æŸç§ç­–ç•¥æ’åº</li>
<li><strong>å¯¹é½å¡«å……</strong>ï¼šä¿è¯å¯¹è±¡å¤§å°æ˜¯8å­—èŠ‚çš„å€æ•°ï¼Œæé«˜è®¿é—®æ•ˆç‡</li>
</ol>
<p><strong>å†…å­˜åˆ†é…ä½ç½®ï¼š</strong></p>
<ul>
<li>æ–°å¯¹è±¡é¦–å…ˆåˆ†é…åœ¨EdenåŒº</li>
<li>é•¿æœŸå­˜æ´»çš„å¯¹è±¡ä¼šè¿›å…¥è€å¹´ä»£</li>
</ul>
<p><strong>4. å¤šçº¿ç¨‹å¦‚ä½•è®¿é—®å †ä¸­çš„å…±äº«å¯¹è±¡ï¼Ÿ</strong></p>
<ol>
<li>çº¿ç¨‹é€šè¿‡æ ˆä¸­çš„å¼•ç”¨è®¿é—®å †ä¸­çš„å¯¹è±¡</li>
<li>å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ªå¯¹è±¡</li>
<li>è®¿é—®å…±äº«å¯¹è±¡éœ€è¦åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</li>
</ol>
<p><strong>5. ä¸ºä»€ä¹ˆéœ€è¦JMMï¼ŸJVMå†…å­˜åŒºåŸŸä¸å¤Ÿå—ï¼Ÿ</strong></p>
<p>JVMå†…å­˜åŒºåŸŸåªå®šä¹‰äº†æ•°æ®å­˜å‚¨åœ¨å“ªé‡Œï¼Œä½†æ²¡æœ‰å®šä¹‰å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¦‚ä½•ä¿è¯å†…å­˜çš„å¯è§æ€§å’Œæœ‰åºæ€§ã€‚JMMæä¾›äº†å†…å­˜è®¿é—®è§„èŒƒï¼Œè§£å†³å¤šçº¿ç¨‹å¹¶å‘è®¿é—®çš„é—®é¢˜ã€‚</p>
<h3 data-id="heading-91">16. é«˜çº§é¢è¯•é¢˜</h3>
<h4 data-id="heading-92">16.1 æ·±å…¥åŸç†é¢˜</h4>
<p><strong>1. å¯¹è±¡åœ¨å †ä¸­çš„åˆ†é…è¿‡ç¨‹ï¼Ÿè¯·ç”»å‡ºè¯¦ç»†æµç¨‹å›¾</strong></p>
<p>å¯¹è±¡åœ¨å †ä¸­çš„åˆ†é…è¿‡ç¨‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">åˆ†é…è¿‡ç¨‹ï¼š

<span class="hljs-bullet">1.</span> ç±»åŠ è½½æ£€æŸ¥
   â†“
<span class="hljs-bullet">2.</span> é€‰æ‹©åˆ†é…æ–¹å¼
   â”œâ”€ æŒ‡é’ˆç¢°æ’ï¼ˆå †è§„æ•´ï¼‰
   â”œâ”€ ç©ºé—²åˆ—è¡¨ï¼ˆå †ä¸è§„æ•´ï¼‰
   â””â”€ TLABï¼ˆçº¿ç¨‹æœ¬åœ°åˆ†é…ç¼“å†²ï¼‰
   â†“
<span class="hljs-bullet">3.</span> åœ¨EdenåŒºåˆ†é…
   â””â”€ ä¼˜å…ˆåœ¨TLABä¸­åˆ†é…
   â””â”€ TLABç”¨å®Œååœ¨EdenåŒºå…±äº«åŒºåˆ†é…
   â†“
<span class="hljs-bullet">4.</span> å¦‚æœEdenåŒºæ»¡ â†’ Minor GC
   â†“
<span class="hljs-bullet">5.</span> å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°SurvivoråŒº
   â†“
<span class="hljs-bullet">6.</span> å¤šæ¬¡GCåæ™‹å‡åˆ°è€å¹´ä»£
</code></pre>
<p><strong>åˆ†é…æ–¹å¼è¯´æ˜ï¼š</strong></p>
<ul>
<li><strong>æŒ‡é’ˆç¢°æ’</strong>ï¼šé€‚ç”¨äºå †å†…å­˜è§„æ•´ï¼Œç§»åŠ¨æŒ‡é’ˆåˆ†é…è¿ç»­å†…å­˜</li>
<li><strong>ç©ºé—²åˆ—è¡¨</strong>ï¼šé€‚ç”¨äºå †å†…å­˜ä¸è§„æ•´ï¼Œä»ç©ºé—²åˆ—è¡¨åˆ†é…</li>
<li><strong>TLAB</strong>ï¼šæ¯ä¸ªçº¿ç¨‹åœ¨EdenåŒºæœ‰ç‹¬ç«‹çš„åˆ†é…åŒºåŸŸï¼Œå‡å°‘ç«äº‰</li>
</ul>
<p><strong>2. Mark Wordçš„è¯¦ç»†ç»“æ„ï¼Ÿ</strong></p>
<p><strong>Mark Wordç»“æ„ï¼ˆ64ä½JVMï¼‰ï¼š</strong></p>
<p>Mark Wordåœ¨64ä½JVMä¸­å 8å­—èŠ‚ï¼ˆ64ä½ï¼‰ï¼Œåœ¨ä¸åŒé”çŠ¶æ€ä¸‹å­˜å‚¨ä¸åŒçš„ä¿¡æ¯ï¼š</p>



































<table><thead><tr><th>é”çŠ¶æ€</th><th>Mark Wordï¼ˆ64ä½ï¼‰</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ— é”</strong></td><td>25ä½æœªä½¿ç”¨ + 31ä½hashCode + 1ä½æœªä½¿ç”¨ + 4ä½GCå¹´é¾„ + 1ä½åå‘é”æ ‡å¿—(0) + 2ä½é”æ ‡å¿—(01)</td><td>æ­£å¸¸çŠ¶æ€</td></tr><tr><td><strong>åå‘é”</strong></td><td>54ä½çº¿ç¨‹ID + 2ä½Epoch + 1ä½æœªä½¿ç”¨ + 4ä½GCå¹´é¾„ + 1ä½åå‘é”æ ‡å¿—(1) + 2ä½é”æ ‡å¿—(01)</td><td>åå‘é”çŠ¶æ€</td></tr><tr><td><strong>è½»é‡çº§é”</strong></td><td>62ä½æŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆ + 2ä½é”æ ‡å¿—(00)</td><td>è½»é‡çº§é”çŠ¶æ€</td></tr><tr><td><strong>é‡é‡çº§é”</strong></td><td>62ä½æŒ‡å‘monitorçš„æŒ‡é’ˆ + 2ä½é”æ ‡å¿—(10)</td><td>é‡é‡çº§é”çŠ¶æ€</td></tr><tr><td><strong>GCæ ‡è®°</strong></td><td>ç©ºï¼ˆä¸éœ€è¦è®°å½•ä¿¡æ¯ï¼‰ + 2ä½é”æ ‡å¿—(11)</td><td>GCæ ‡è®°çŠ¶æ€</td></tr></tbody></table>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li>Mark Wordåœ¨ä¸åŒé”çŠ¶æ€ä¸‹å¤ç”¨ï¼Œå­˜å‚¨ä¸åŒçš„ä¿¡æ¯</li>
<li>é”æ ‡å¿—ä½ï¼ˆæœ€å2ä½ï¼‰ç”¨äºæ ‡è¯†é”çŠ¶æ€</li>
<li>è¿™æ˜¯synchronizedé”å‡çº§æœºåˆ¶çš„åŸºç¡€</li>
</ul>
<p><strong>3. å¯¹è±¡å¤´çš„å®Œæ•´ç»“æ„ï¼Ÿ</strong></p>
<p>å¯¹è±¡å¤´çš„å®Œæ•´ç»“æ„ï¼š</p>
<p><strong>å¯¹è±¡å¤´ï¼ˆObject Headerï¼‰ï¼š</strong></p>
<ol>
<li>
<p><strong>Mark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰</strong></p>
<ul>
<li><strong>å¤§å°</strong>ï¼š32ä½JVMå 32ä½ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œ64ä½JVMå 64ä½ï¼ˆ8å­—èŠ‚ï¼‰</li>
<li><strong>å†…å®¹</strong>ï¼šhashCodeã€GCå¹´é¾„ã€é”çŠ¶æ€ã€åå‘çº¿ç¨‹IDç­‰</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šåœ¨ä¸åŒé”çŠ¶æ€ä¸‹å­˜å‚¨ä¸åŒçš„ä¿¡æ¯</li>
</ul>
</li>
<li>
<p><strong>ç±»å‹æŒ‡é’ˆï¼ˆClass Pointerï¼‰</strong></p>
<ul>
<li><strong>å¤§å°</strong>ï¼š32ä½JVMå 32ä½ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œ64ä½JVMå 64ä½ï¼ˆ8å­—èŠ‚ï¼Œå¯èƒ½å‹ç¼©ä¸º32ä½ï¼‰</li>
<li><strong>å†…å®¹</strong>ï¼šæŒ‡å‘å¯¹è±¡æ‰€å±çš„ç±»å…ƒæ•°æ®ï¼ˆæ–¹æ³•åŒºä¸­çš„ç±»ä¿¡æ¯ï¼‰</li>
<li><strong>ä½œç”¨</strong>ï¼šJVMé€šè¿‡è¿™ä¸ªæŒ‡é’ˆç¡®å®šå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹</li>
</ul>
</li>
<li>
<p><strong>æ•°ç»„é•¿åº¦ï¼ˆArray Lengthï¼‰</strong></p>
<ul>
<li><strong>å¤§å°</strong>ï¼š32ä½æ•´æ•°ï¼ˆ4å­—èŠ‚ï¼‰</li>
<li><strong>å­˜åœ¨æ¡ä»¶</strong>ï¼šä»…å½“å¯¹è±¡æ˜¯æ•°ç»„æ—¶æ‰æœ‰</li>
<li><strong>å†…å®¹</strong>ï¼šæ•°ç»„çš„é•¿åº¦</li>
</ul>
</li>
</ol>
<p><strong>å®Œæ•´ç»“æ„å›¾ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">å¯¹è±¡å¤´ç»“æ„ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-selector-tag">Mark</span> Word      â”‚ <span class="hljs-number">8</span>å­—èŠ‚ï¼ˆ<span class="hljs-number">64</span>ä½ï¼‰æˆ–<span class="hljs-number">4</span>å­—èŠ‚ï¼ˆ<span class="hljs-number">32</span>ä½ï¼‰
â”‚  (é”çŠ¶æ€ä¿¡æ¯)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç±»å‹æŒ‡é’ˆ        â”‚ <span class="hljs-number">8</span>å­—èŠ‚æˆ–<span class="hljs-number">4</span>å­—èŠ‚ï¼ˆå¯èƒ½å‹ç¼©ï¼‰
â”‚  (æŒ‡å‘ç±»ä¿¡æ¯)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°ç»„é•¿åº¦        â”‚ <span class="hljs-number">4</span>å­—èŠ‚ï¼ˆä»…æ•°ç»„å¯¹è±¡ï¼‰
â”‚  (æ•°ç»„é•¿åº¦)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>4. TLABçš„å·¥ä½œåŸç†ï¼Ÿ</strong></p>
<p>æ¯ä¸ªçº¿ç¨‹åœ¨EdenåŒºæœ‰ç‹¬ç«‹çš„TLABï¼Œå¯¹è±¡ä¼˜å…ˆåœ¨TLABä¸­åˆ†é…ï¼ŒTLABç”¨å®Œååœ¨å…±äº«åŒºåˆ†é…ï¼ˆéœ€è¦åŒæ­¥ï¼‰ã€‚</p>
<p><strong>5. æŒ‡é’ˆç¢°æ’å’Œç©ºé—²åˆ—è¡¨çš„å®ç°ï¼Ÿ</strong></p>
<p><strong>1. æŒ‡é’ˆç¢°æ’ï¼ˆBump the Pointerï¼‰å®ç°ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">æŒ‡é’ˆç¢°æ’ï¼š

<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span>
                 â†‘æŒ‡é’ˆ â†’ åç§» â†’ <span class="hljs-selector-attr">[æ–°å¯¹è±¡]</span>
</code></pre>
<p><strong>2. ç©ºé—²åˆ—è¡¨ï¼ˆFree Listï¼‰å®ç°ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">ç©ºé—²åˆ—è¡¨ï¼š

<span class="hljs-section">[å¯¹è±¡1]</span><span class="hljs-section">[ç©º]</span><span class="hljs-section">[å¯¹è±¡2]</span><span class="hljs-section">[ç©º]</span><span class="hljs-section">[å¯¹è±¡3]</span>
ç©ºé—²åˆ—è¡¨: <span class="hljs-section">[ä½ç½®1, ä½ç½®3]</span> â†’ é€‰æ‹©ä½ç½®åˆ†é…æ–°å¯¹è±¡
</code></pre>
<p><strong>å¯¹æ¯”ï¼š</strong></p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>æŒ‡é’ˆç¢°æ’</th><th>ç©ºé—²åˆ—è¡¨</th></tr></thead><tbody><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å †å†…å­˜è§„æ•´</td><td>å †å†…å­˜ä¸è§„æ•´</td></tr><tr><td><strong>åˆ†é…é€Ÿåº¦</strong></td><td>å¿«ï¼ˆåªéœ€ç§»åŠ¨æŒ‡é’ˆï¼‰</td><td>è¾ƒæ…¢ï¼ˆéœ€è¦æŸ¥æ‰¾ç©ºé—²åˆ—è¡¨ï¼‰</td></tr><tr><td><strong>å†…å­˜ç¢ç‰‡</strong></td><td>æ— ç¢ç‰‡</td><td>å¯èƒ½æœ‰ç¢ç‰‡</td></tr><tr><td><strong>å®ç°å¤æ‚åº¦</strong></td><td>ç®€å•</td><td>è¾ƒå¤æ‚</td></tr></tbody></table>
<p><strong>6. å¯¹è±¡è®¿é—®å®šä½çš„åº•å±‚å®ç°ï¼Ÿ</strong></p>
<p><strong>HotSpotä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®çš„åº•å±‚å®ç°ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss">ç›´æ¥æŒ‡é’ˆè®¿é—®å®ç°ï¼š

æ ˆå¼•ç”¨(åœ°å€) â†’ å †ä¸­çš„å¯¹è±¡ â†’ å¯¹è±¡å¤´ä¸­ç±»å‹æŒ‡é’ˆ â†’ æ–¹æ³•åŒºä¸­çš„ç±»ä¿¡æ¯

åªéœ€ä¸€æ¬¡å†…å­˜è®¿é—®ï¼Œç›´æ¥è®¿é—®å¯¹è±¡
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>è®¿é—®é€Ÿåº¦å¿«ï¼šåªéœ€ä¸€æ¬¡å†…å­˜è®¿é—®</li>
<li>å®ç°ç®€å•ï¼šå¼•ç”¨ç›´æ¥æŒ‡å‘å¯¹è±¡</li>
<li>å†…å­˜å ç”¨å°ï¼šä¸éœ€è¦é¢å¤–çš„å¥æŸ„æ± </li>
</ul>
<p><strong>ä»£ä»·ï¼š</strong></p>
<ul>
<li>GCæ—¶éœ€è¦æ›´æ–°æ‰€æœ‰å¼•ç”¨ï¼šå¯¹è±¡ç§»åŠ¨æ—¶éœ€è¦æ›´æ–°æ‰€æœ‰æŒ‡å‘è¯¥å¯¹è±¡çš„å¼•ç”¨</li>
<li>HotSpoté€šè¿‡ä¼˜åŒ–GCç®—æ³•æ¥å‡å°‘å¯¹è±¡ç§»åŠ¨ï¼Œé™ä½è¿™ä¸ªå¼€é”€</li>
</ul>
<h4 data-id="heading-93">16.2 æ–°æŠ€æœ¯é¢˜</h4>
<p><strong>1. å…ƒç©ºé—´ç›¸æ¯”æ°¸ä¹…ä»£çš„ä¼˜åŠ¿ï¼Ÿ</strong></p>
<p>å…ƒç©ºé—´ç›¸æ¯”æ°¸ä¹…ä»£çš„ä¸»è¦ä¼˜åŠ¿ï¼š</p>
<ol>
<li>
<p><strong>æé«˜GCæ•ˆç‡</strong></p>
<ul>
<li>æ°¸ä¹…ä»£GCæ•ˆç‡è¾ƒä½ï¼Œå®¹æ˜“å¯¼è‡´Full GC</li>
<li>å…ƒç©ºé—´GCæ•ˆç‡æ›´é«˜ï¼Œå¯ä»¥æ›´åŠæ—¶åœ°å›æ”¶ç±»å…ƒæ•°æ®</li>
</ul>
</li>
<li>
<p><strong>é¿å…å†…å­˜æº¢å‡º</strong></p>
<ul>
<li>æ°¸ä¹…ä»£å¤§å°å›ºå®šï¼Œå®¹æ˜“å‘ç”ŸOutOfMemoryError: PermGen space</li>
<li>å…ƒç©ºé—´å¤§å°åŠ¨æ€è°ƒæ•´ï¼Œä¸å®¹æ˜“æº¢å‡ºï¼ˆé™¤éè¾¾åˆ°MaxMetaspaceSizeï¼‰</li>
</ul>
</li>
<li>
<p><strong>æ›´å¥½çš„å†…å­˜ç®¡ç†</strong></p>
<ul>
<li>æ°¸ä¹…ä»£åœ¨å †ä¸­ï¼Œå—å †å†…å­˜é™åˆ¶</li>
<li>å…ƒç©ºé—´åœ¨æœ¬åœ°å†…å­˜ï¼Œä¸å—å †å†…å­˜é™åˆ¶ï¼Œç®¡ç†æ›´çµæ´»</li>
</ul>
</li>
<li>
<p><strong>ä¸HotSpotåˆ†ç¦»</strong></p>
<ul>
<li>æ°¸ä¹…ä»£çš„å®ç°ä¸HotSpotè€¦åˆ</li>
<li>å…ƒç©ºé—´çš„å®ç°ä¸HotSpotåˆ†ç¦»ï¼Œæ›´å®¹æ˜“ä¼˜åŒ–</li>
</ul>
</li>
</ol>
<p><strong>å®é™…å¥½å¤„ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ°¸ä¹…ä»£ï¼šå›ºå®šå¤§å°ï¼Œå®¹æ˜“æº¢å‡º</span>
-XX:PermSize=64m
-XX:MaxPermSize=256m
<span class="hljs-comment">// å¦‚æœç±»åŠ è½½è¿‡å¤šï¼Œå¯èƒ½æº¢å‡º</span>

<span class="hljs-comment">// å…ƒç©ºé—´ï¼šåŠ¨æ€è°ƒæ•´ï¼Œä¸å®¹æ˜“æº¢å‡º</span>
-XX:MetaspaceSize=64m
-XX:MaxMetaspaceSize=256m
<span class="hljs-comment">// ä¼šæ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µåŠ¨æ€è°ƒæ•´</span>
</code></pre>
<p><strong>2. ç°ä»£JVMçš„å†…å­˜ç®¡ç†ä¼˜åŒ–ï¼Ÿ</strong></p>
<ul>
<li>æŒ‡é’ˆå‹ç¼©</li>
<li>å¯¹è±¡å¯¹é½ä¼˜åŒ–</li>
<li>TLABä¼˜åŒ–</li>
<li>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</li>
</ul>
<p><strong>3. å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„æœºåˆ¶ï¼Ÿ</strong></p>
<p>è¶…è¿‡-XX:PretenureSizeThresholdè®¾ç½®çš„å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œé¿å…åœ¨EdenåŒºå’ŒSurvivoråŒºä¹‹é—´å¤åˆ¶ã€‚</p>
<p><strong>4. åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®šçš„åŸç†ï¼Ÿ</strong></p>
<p>SurvivoråŒºä¸­ç›¸åŒå¹´é¾„çš„å¯¹è±¡å¤§å°è¶…è¿‡SurvivoråŒºçš„ä¸€åŠæ—¶ï¼Œå¤§äºç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€è½¦è½½Androidã€‘ã€Œåœºæ™¯å¼•æ“ã€è®¾è®¡æ€è·¯åˆ†äº«]]></title>    <link>https://juejin.cn/post/7592593491860946944</link>    <guid>https://juejin.cn/post/7592593491860946944</guid>    <pubDate>2026-01-08T07:21:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592593491860946944" data-draft-id="7592119218029969442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€è½¦è½½Androidã€‘ã€Œåœºæ™¯å¼•æ“ã€è®¾è®¡æ€è·¯åˆ†äº«"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-08T07:21:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ—æ ©link"/> <meta itemprop="url" content="https://juejin.cn/user/870468939434039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€è½¦è½½Androidã€‘ã€Œåœºæ™¯å¼•æ“ã€è®¾è®¡æ€è·¯åˆ†äº«
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/870468939434039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ—æ ©link
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:21:15.000Z" title="Thu Jan 08 2026 07:21:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{font-family:-apple-system,BlinkMacSystemFont,PingFang SC,Helvetica Neue,Helvetica,Arial,sans-serif;word-break:break-word;line-height:1.75;font-weight:200;font-size:16px;overflow-x:hidden;color:#666;letter-spacing:.5px}.markdown-body a{text-decoration:none;color:#0064c8;position:relative}.markdown-body a:after{content:"";position:absolute;bottom:-2px;left:0;width:100%;height:1px;background-color:rgba(0,100,200,.7);transform:scale(0);transition:all .4s ease-in-out}.markdown-body a:link:hover:after{transform:scale(1)}.markdown-body code{padding:2px 4px;font-size:.9em;font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px;background-color:rgba(0,46,70,.0431);color:#39f}.markdown-body strong{font-weight:400}.markdown-body em{color:#ff6a00}.markdown-body del,.markdown-body s{color:#bbb}.markdown-body small{font-size:.8em;color:#bbb}.markdown-body kbd{margin:0 .1em;padding:5px 8px 3px;border:1px solid #d1d5d9;border-radius:3px;box-shadow:0 1px 0 0 #e3e4e6,inset 0 0 0 2px #fff;background-color:#eee;font-weight:600;font-size:.8em;font-family:Arial,Helvetica Neue,Helvetica,sans-serif;white-space:nowrap;color:#666}.markdown-body kbd:first-child{margin-left:0}.markdown-body kbd:last-child{margin-right:0}.markdown-body img{display:block;border:0;max-width:calc(100% - 20px);min-width:20px;min-height:20px;margin:0 10px;box-shadow:0 2px 8px 2px rgba(0,0,0,.2);transition:all .25s ease-in-out}.markdown-body img:hover{transform:translateY(-4px)}.markdown-body blockquote,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{line-height:inherit;font-size:inherit;color:inherit}.markdown-body blockquote:first-child,.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child,.markdown-body ol:first-child,.markdown-body p:first-child,.markdown-body pre:first-child,.markdown-body table:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body blockquote:last-child,.markdown-body h1:last-child,.markdown-body h2:last-child,.markdown-body h3:last-child,.markdown-body h4:last-child,.markdown-body h5:last-child,.markdown-body h6:last-child,.markdown-body ol:last-child,.markdown-body p:last-child,.markdown-body pre:last-child,.markdown-body table:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:1.6em 0 .6em;color:#333;font-weight:400;position:relative}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{position:absolute;left:-2em}.markdown-body h1{font-size:1.75em}.markdown-body h1:before{content:"#"}.markdown-body h1:first-child{margin-top:0}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.35em}.markdown-body h4{font-size:1.2em}.markdown-body h5{font-size:1.1em}.markdown-body h6{font-size:1em}.markdown-body blockquote,.markdown-body ol,.markdown-body pre,.markdown-body table,.markdown-body ul{margin:1em 0}.markdown-body p{margin:.7em 0;word-break:break-word}.markdown-body pre{padding:8px 12px;color:#666;background-color:rgba(0,46,70,.0431);border:1px solid #ebebeb;tab-size:4;white-space:pre-wrap;line-height:1.4}.markdown-body pre code{color:inherit;background-color:transparent;padding:0}.markdown-body ol,.markdown-body ul{margin:1em 0 1em 2em;padding:0;line-height:1.5!important;font-size:inherit;color:inherit}.markdown-body ol:first-child,.markdown-body ul:first-child{margin-top:0}.markdown-body ol:last-child,.markdown-body ul:last-child{margin-bottom:0}.markdown-body ol li,.markdown-body ul li{margin:.5em 0;list-style:inherit}.markdown-body ul{list-style:disc outside}.markdown-body ul ul{list-style-type:circle}.markdown-body ul ul ul{list-style-type:square}.markdown-body ol{list-style:decimal outside}.markdown-body ol ol{list-style-type:lower-alpha}.markdown-body ol ol ol{list-style-type:lower-roman}.markdown-body blockquote{font-size:.9em;padding:8px 20px 8px 15px;color:#666;border-left:5px solid rgba(0,100,200,.7);background-color:rgba(0,100,200,.1)}.markdown-body table{border-collapse:collapse;border-spacing:0;max-width:100%;min-width:50%;word-wrap:break-word;color:inherit}.markdown-body table thead tr{background-color:#f4f6f7}.markdown-body table td,.markdown-body table th{padding:4px 16px;font-size:.95em;text-align:left;color:inherit;border:0;min-width:72px}.markdown-body table td[align=center],.markdown-body table th[align=center]{text-align:center}.markdown-body table td[align=right],.markdown-body table th[align=right]{text-align:right}.markdown-body table th{border-bottom:2px solid #e3e4e6;color:#333;font-weight:400;white-space:nowrap}.markdown-body table td{border-bottom:1px solid #ebebeb}.markdown-body hr{margin:1.5em 0;padding:0;border:0;background:linear-gradient(90deg,rgba(0,46,70,.0431),#ebebeb 50%,rgba(0,46,70,.0431));height:1px}.markdown-body br{content:"";display:block}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>åœ¨æ™ºèƒ½æ±½è½¦å¿«é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œè½¦è½½ç³»ç»Ÿæ—©å·²ä¸å†æ˜¯ç®€å•çš„å¨±ä¹æˆ–å¯¼èˆªå·¥å…·ï¼Œè€Œæ˜¯é›†æˆäº†æ„ŸçŸ¥ã€å†³ç­–ä¸æœåŠ¡äºä¸€ä½“çš„æ™ºèƒ½äº¤äº’å¹³å°ã€‚å…¶ä¸­ï¼Œâ€œ<strong>åœºæ™¯å¼•æ“</strong>â€ï¼ˆåˆç§°â€œ<strong>æ™ºèƒ½åœºæ™¯</strong>â€ï¼‰ä½œä¸ºæå‡ç”¨æˆ·ä½“éªŒã€å®ç°ä¸ªæ€§åŒ–æœåŠ¡çš„æ ¸å¿ƒèƒ½åŠ›ï¼Œæ­£è¢«è¶Šæ¥è¶Šå¤šçš„ä¸­é«˜ç«¯æ™ºèƒ½æ±½è½¦æ‰€é‡‡ç”¨ã€‚</p>
<p>æœ¬æ–‡å°†ç»“åˆç¬”è€…åœ¨å®é™…é¡¹ç›®ä¸­çš„å·¥ä½œç»éªŒï¼Œæ·±å…¥åˆ†æè½¦è½½â€œåœºæ™¯å¼•æ“â€çš„æ ¸å¿ƒéœ€æ±‚ï¼Œå¹¶æ¢è®¨å…¶é«˜æ•ˆè®¾è®¡æ–¹æ³•ã€‚å‡ºäºä¼ä¸šä¿å¯†è¦æ±‚ï¼Œæ–‡ä¸­æ‰€å‘ˆç°çš„åœºæ™¯å¼•æ“ä¸ºä¸€ä¸ªç®€åŒ–ç‰ˆçš„åŸå‹ï¼Œä»…ç”¨äºæŠ€æœ¯åŸç†çš„é˜è¿°ä¸äº¤æµã€‚</p>
<blockquote>
<p>æœ¬æ–‡æºç è·¯å¾„ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flinxu-link%2FVehicleSceneEngine" target="_blank" title="https://github.com/linxu-link/VehicleSceneEngine" ref="nofollow noopener noreferrer">github.com/linxu-link/â€¦</a></p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯â€œåœºæ™¯å¼•æ“â€ï¼Ÿ</h2>
<p>ç®€å•æ¥è¯´ï¼Œåœºæ™¯å¼•æ“æ˜¯ä¸€ä¸ª<strong>åŸºäºå¤šç»´ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„è‡ªåŠ¨åŒ–å†³ç­–ä¸æ‰§è¡Œæ¡†æ¶</strong>ã€‚å®ƒèƒ½å¤Ÿå®æ—¶é‡‡é›†è½¦è¾†çŠ¶æ€ã€ç”¨æˆ·è¡Œä¸ºã€ç¯å¢ƒä¿¡æ¯ç­‰æ•°æ®ï¼Œåœ¨æ»¡è¶³é¢„è®¾æ¡ä»¶æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ä¸€ç³»åˆ—æœåŠ¡ç»„åˆï¼ˆå¦‚è°ƒèŠ‚ç©ºè°ƒã€åˆ‡æ¢åª’ä½“ã€å‘é€é€šçŸ¥ç­‰ï¼‰ã€‚</p>
<p>è™½ç„¶åº”ç”¨åœºæ™¯ä¸åŒï¼Œä½†å…¶åº•å±‚é€»è¾‘ä¸ Android ä¸­çš„â€œè§„åˆ™å¼•æ“â€â€œè‡ªåŠ¨åŒ–ä»»åŠ¡â€æˆ–â€œæƒ…å¢ƒæ„ŸçŸ¥åŠŸèƒ½â€ï¼ˆå¦‚ Do Not Disturbã€è‡ªé€‚åº”äº®åº¦ï¼‰éå¸¸ç›¸ä¼¼ã€‚</p>
<h3 data-id="heading-1">1. æ ¸å¿ƒéœ€æ±‚åˆ†æ</h3>
<p>ä¸€ä¸ªé«˜æ•ˆçš„åœºæ™¯å¼•æ“ï¼Œé¦–å…ˆä¾èµ–äºå¯¹<strong>å¤šæºä¸Šä¸‹æ–‡</strong>çš„å®æ—¶é‡‡é›†ä¸èåˆã€‚è¿™äº›ä¸Šä¸‹æ–‡å¯å½’çº³ä¸ºä»¥ä¸‹å››ç±»ï¼š</p>
<ul>
<li><strong>è®¾å¤‡/è½¦è¾†çŠ¶æ€</strong> å¦‚è½¦é€Ÿã€æ¡£ä½ã€ç”µé‡ã€è½¦é—¨/è½¦çª—çŠ¶æ€ã€ADASï¼ˆé«˜çº§é©¾é©¶è¾…åŠ©ç³»ç»Ÿï¼‰æ˜¯å¦å¯ç”¨ç­‰ã€‚</li>
<li><strong>ç”¨æˆ·çŠ¶æ€</strong> é€šè¿‡ FaceID æˆ–è´¦å·è¯†åˆ«é©¾é©¶å‘˜èº«ä»½ï¼Œç»“åˆ DMSï¼ˆé©¾é©¶å‘˜ç›‘æ§ç³»ç»Ÿï¼‰åˆ¤æ–­ç–²åŠ³åº¦ã€æ³¨æ„åŠ›ç­‰ã€‚</li>
<li><strong>ç¯å¢ƒä¿¡æ¯</strong> åŒ…æ‹¬ GPS ä½ç½®ã€å½“å‰æ—¶é—´ã€å¤©æ°”ã€è·¯å†µã€å®¤å†…å¤–æ¸©åº¦ç­‰ã€‚</li>
<li><strong>å¤–è®¾ä¸åº”ç”¨çŠ¶æ€</strong> æ‰‹æœºæ˜¯å¦è¿æ¥ã€è“ç‰™è€³æœºæ˜¯å¦é…å¯¹ã€åº§æ¤…ä½ç½®ã€ç©ºè°ƒè®¾ç½®ã€å½“å‰æ’­æ”¾çš„åª’ä½“ç­‰ã€‚</li>
</ul>
<p>è¿™äº›æ•°æ®å…±åŒæ„æˆäº†â€œä¸Šä¸‹æ–‡æ„ŸçŸ¥â€çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯è§¦å‘æ™ºèƒ½åœºæ™¯çš„å‰æã€‚</p>
<h3 data-id="heading-2">2. åœºæ™¯å®šä¹‰ä¸ç®¡ç†</h3>
<p>ä»…ä»…èƒ½æ„ŸçŸ¥è¿˜ä¸å¤Ÿï¼Œç³»ç»Ÿè¿˜éœ€æ”¯æŒ<strong>çµæ´»çš„åœºæ™¯ç¼–æ’</strong>ä¸<strong>å¯é çš„æ‰§è¡Œæœºåˆ¶</strong>ï¼š</p>
<ol>
<li>å¯è§†åŒ–è§„åˆ™ç¼–æ’</li>
</ol>
<ul>
<li>æ”¯æŒâ€œå¦‚æœâ€¦é‚£ä¹ˆâ€¦â€ï¼ˆIf-Thenï¼‰é€»è¾‘ï¼Œå…è®¸ OEM å‚å•†æˆ–ç»ˆç«¯ç”¨æˆ·è‡ªå®šä¹‰åœºæ™¯ã€‚</li>
</ul>
<blockquote>
<ul>
<li>ç¤ºä¾‹ï¼š<code>IF è½¦é€Ÿ &gt; 60km/h AND æ—¶é—´åœ¨ 22:00â€“6:00 â†’ è‡ªåŠ¨è°ƒæš—å±å¹• + å…³é—­é€šçŸ¥éŸ³</code></li>
</ul>
</blockquote>
<ul>
<li>æ”¯æŒå¤æ‚æ¡ä»¶ç»„åˆï¼ˆAND/OR/NOTï¼‰ã€æ—¶é—´çª—å£é™åˆ¶ã€çŠ¶æ€æŒç»­åˆ¤æ–­ï¼ˆå¦‚â€œè¿ç»­5åˆ†é’Ÿæœªæ“ä½œâ€ï¼‰ã€‚</li>
</ul>
<ol start="2">
<li>åœºæ™¯ä¼˜å…ˆçº§ä¸å†²çªå¤„ç†</li>
</ol>
<ul>
<li>å½“å¤šä¸ªåœºæ™¯åŒæ—¶æ»¡è¶³æ—¶ï¼Œéœ€æŒ‰<strong>å®‰å…¨ç­‰çº§</strong>æˆ–<strong>ç”¨æˆ·åå¥½</strong>è¿›è¡Œæ’åºï¼Œé¿å…æŒ‡ä»¤å†²çªã€‚</li>
<li>ä¾‹å¦‚ï¼šâ€œé©¾é©¶æ¨¡å¼â€åº”ä¼˜å…ˆäºâ€œè§‚å½±æ¨¡å¼â€ã€‚</li>
</ul>
<ol start="3">
<li>é¢„ç½® + è‡ªå­¦ä¹ åŒæ¨¡å¼</li>
</ol>
<ul>
<li>
<p><strong>å‡ºå‚é¢„ç½®é«˜é¢‘åœºæ™¯</strong>ï¼šå¦‚â€œå›å®¶æ¨¡å¼â€â€œéœ²è¥æ¨¡å¼â€â€œå„¿ç«¥æ¨¡å¼â€ï¼Œé™ä½ç”¨æˆ·ä½¿ç”¨é—¨æ§›ã€‚</p>
</li>
<li>
<p><strong>è¡Œä¸ºå­¦ä¹ ä¸æ¨è</strong>ï¼šéšç€å¤§æ¨¡å‹ä¸Šè½¦ï¼Œé€šè¿‡ AI å¤§æ¨¡å‹åˆ†æç”¨æˆ·ä¹ æƒ¯ï¼ˆå¦‚æ¯å¤© 18:00 è¿æ¥è“ç‰™ã€å‘¨äº”å¼€å¯åº§æ¤…åŠ çƒ­ï¼‰ï¼Œè‡ªåŠ¨ç”Ÿæˆå»ºè®®åœºæ™¯ï¼Œä¹Ÿå˜å¾—éå¸¸å¸¸è§ã€‚</p>
</li>
</ul>
<h3 data-id="heading-3">3. æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼šäº‹ä»¶é©±åŠ¨ä¸è§„åˆ™åŒ¹é…</h3>
<p>åœºæ™¯å¼•æ“çš„æœ¬è´¨ï¼Œæ˜¯ä¸€ä¸ª<strong>è½»é‡çº§è§„åˆ™å¼•æ“</strong>ï¼Œå…¶æ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>äº‹ä»¶é©±åŠ¨</strong>ï¼šä»»ä½•ä¸Šä¸‹æ–‡ä¿¡å·çš„å˜åŒ–ï¼ˆå¦‚è½¦é€Ÿæ›´æ–°ã€æ—¶é—´è·³è½¬ï¼‰éƒ½ä½œä¸ºäº‹ä»¶è¾“å…¥ã€‚</li>
<li><strong>è§„åˆ™åŒ¹é…</strong>ï¼šæ¯ä¸ªåœºæ™¯å¯¹åº”ä¸€ç»„æ¡ä»¶è§„åˆ™ï¼Œå½“æ‰€æœ‰æ¡ä»¶æ»¡è¶³æ—¶ï¼Œè¯¥åœºæ™¯è¢«æ¿€æ´»ã€‚</li>
<li><strong>è§£è€¦ä¸å¯é…ç½®</strong>ï¼šè§„åˆ™åº”ä»¥ JSON/YAML æˆ–æ•°æ®åº“å½¢å¼å¤–éƒ¨åŒ–ï¼Œä¾¿äº OTA æ›´æ–°æˆ– A/B æµ‹è¯•ã€‚</li>
<li><strong>é«˜æ•ˆè¯„ä¼°</strong>ï¼šé¿å…æ¯æ¬¡å…¨é‡éå†æ‰€æœ‰è§„åˆ™ï¼Œé‡‡ç”¨å¢é‡æ›´æ–°ã€ç¼“å­˜æœºåˆ¶æˆ–åå‘ç´¢å¼•ä¼˜åŒ–æ€§èƒ½ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-4">äºŒã€æŠ€æœ¯å®ç°</h2>
<p>ä¸ºæ”¯æ’‘â€œ<strong>æ„ŸçŸ¥-å†³ç­–-æ‰§è¡Œ</strong>â€é—­ç¯ï¼ŒåŸºäº Kotlin åç¨‹ä¸å“åº”å¼æ€æƒ³ï¼Œæ„å»ºäº†ä¸€å¥—è½»é‡çº§ã€çº¿ç¨‹å®‰å…¨çš„åœºæ™¯å¼•æ“å®ç°ã€‚æ•´ä½“æ¶æ„éµå¾ª <strong>ä¿¡å·é©±åŠ¨ + è§„åˆ™åŒ¹é… + åŠ¨ä½œå›è°ƒ</strong> ï¼Œæ ¸å¿ƒæ¨¡å—å¦‚ä¸‹ï¼š</p>
<h3 data-id="heading-5">1. æ ¸å¿ƒæ•°æ®æ¨¡å‹</h3>
<ul>
<li><code>Signal</code>ï¼šä»£è¡¨ä¸Šä¸‹æ–‡ä¸­çš„ä¸€ä¸ªåŸå­çŠ¶æ€å˜åŒ–ï¼ˆå¦‚ <code>speed=90</code>ï¼‰ï¼Œç”± <code>SignalManager</code> ç»Ÿä¸€ç®¡ç†ã€‚</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Signal</span>(
    <span class="hljs-keyword">val</span> key: String,
    <span class="hljs-keyword">val</span> value: Any
)
</code></pre>
<ul>
<li><code>Condition</code>ï¼šå®šä¹‰è§¦å‘æ¡ä»¶ï¼Œé‡‡ç”¨å¯†å°ç±»ï¼ˆ<code>sealed interface</code>ï¼‰æ”¯æŒå¤šç§åˆ¤æ–­é€»è¾‘ï¼ˆç­‰äºã€å¤§äºã€åœ¨é›†åˆä¸­ç­‰ï¼‰ï¼Œå¹¶å†…å»º <code>durationMs</code> å­—æ®µä»¥æ”¯æŒâ€œæŒç»­æ»¡è¶³ N ç§’æ‰è§¦å‘â€çš„è¯­ä¹‰ã€‚</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Condition</span> {
    <span class="hljs-keyword">val</span> signalKey: String
    <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span>

    <span class="hljs-comment">/**
* è§¦å‘æ¡ä»¶ï¼šç›¸ç­‰
* keyï¼šä¿¡å·é”®
* expectedï¼šæœŸæœ›çš„å€¼
* durationï¼šæŒç»­æ—¶é—´ï¼Œå•ä½æ¯«ç§’
*/</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Equals</span>(<span class="hljs-keyword">val</span> key: String, <span class="hljs-keyword">val</span> expected: Any, <span class="hljs-keyword">val</span> duration: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>) : Condition {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = key
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = duration
    }

    <span class="hljs-comment">/**
* è§¦å‘æ¡ä»¶ï¼šå¤§äº
* keyï¼šä¿¡å·é”®
* thresholdï¼šé˜ˆå€¼
* durationï¼šæŒç»­æ—¶é—´ï¼Œå•ä½æ¯«ç§’
*/</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GreaterThan</span>(<span class="hljs-keyword">val</span> key: String, <span class="hljs-keyword">val</span> threshold: Number, <span class="hljs-keyword">val</span> duration: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>) :
        Condition {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = key
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = duration
    }

    <span class="hljs-comment">/**
* è§¦å‘æ¡ä»¶ï¼šå°äº
* keyï¼šä¿¡å·é”®
* thresholdï¼šé˜ˆå€¼
* durationï¼šæŒç»­æ—¶é—´ï¼Œå•ä½æ¯«ç§’
*/</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LessThan</span>(<span class="hljs-keyword">val</span> key: String, <span class="hljs-keyword">val</span> threshold: Number, <span class="hljs-keyword">val</span> duration: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>) :
        Condition {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = key
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = duration
    }


    <span class="hljs-comment">/**
* è§¦å‘æ¡ä»¶ï¼šåŒ…å«
* keyï¼šä¿¡å·é”®
* valueï¼šåŒ…å«çš„å€¼
* durationï¼šæŒç»­æ—¶é—´ï¼Œå•ä½æ¯«ç§’
*/</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Contains</span>(<span class="hljs-keyword">val</span> key: String, <span class="hljs-keyword">val</span> value: Any, <span class="hljs-keyword">val</span> duration: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>) : Condition {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = key
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = duration
    }

    <span class="hljs-comment">/**
* è§¦å‘æ¡ä»¶ï¼šåœ¨èŒƒå›´å†…
* keyï¼šä¿¡å·é”®
* startï¼šå¼€å§‹å€¼
* endï¼šç»“æŸå€¼
* durationï¼šæŒç»­æ—¶é—´ï¼Œå•ä½æ¯«ç§’
*/</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Between</span>(
        <span class="hljs-keyword">val</span> key: String,
        <span class="hljs-keyword">val</span> start: Number,
        <span class="hljs-keyword">val</span> end: Number,
        <span class="hljs-keyword">val</span> duration: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>
    ) : Condition {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = key
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = duration
    }

    <span class="hljs-comment">/***
* è§¦å‘æ¡ä»¶ï¼šåœ¨é›†åˆä¸­
* keyï¼šä¿¡å·é”®
* allowedValuesï¼šå…è®¸çš„å€¼
* durationï¼šæŒç»­æ—¶é—´ï¼Œå•ä½æ¯«ç§’
*/</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InSet</span>(<span class="hljs-keyword">val</span> key: String, <span class="hljs-keyword">val</span> allowedValues: Set&lt;Any&gt;, <span class="hljs-keyword">val</span> duration: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>) :
        Condition {
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = key
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = duration
    }

}
</code></pre>
<ul>
<li><code>Action</code>ï¼šæè¿°è¦æ‰§è¡Œçš„æ“ä½œï¼ˆå¦‚ <code>enable_eco_mode</code>ï¼‰ï¼Œæºå¸¦å‚æ•°å­—å…¸ï¼Œä¾¿äºå¤–éƒ¨ç³»ç»Ÿè§£ææ‰§è¡Œã€‚</li>
</ul>
<blockquote>
<p>æ­¤å¤„å·²ç»é«˜åº¦ç®€åŒ–ï¼Œå®é™…é¡¹ç›®ä¸­è¯·æ ¹æ®äº§å“éœ€æ±‚è¿›è¡Œæ‰©å±•ã€‚</p>
</blockquote>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Action</span>(
    val <span class="hljs-attr">name</span>: <span class="hljs-title class_">String</span>,
    val <span class="hljs-attr">params</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Any</span>&gt; = <span class="hljs-title function_">emptyMap</span>()
)
</code></pre>
<ul>
<li><code>Scene</code>ï¼šåœºæ™¯çš„æ ¸å¿ƒè½½ä½“ï¼ŒåŒ…å«è¿›å…¥/é€€å‡ºæ¡ä»¶åˆ—è¡¨ã€è¿›å…¥/é€€å‡ºåŠ¨ä½œåˆ—è¡¨ï¼Œä»¥åŠå¯è®¢é˜…çš„ <code>onEnter</code>/<code>onExit</code> å›è°ƒã€‚ä½¿ç”¨ <code>AtomicReference</code> ç®¡ç†ç›‘å¬å™¨åˆ—è¡¨ï¼Œä¿è¯çº¿ç¨‹å®‰å…¨ä¸‹çš„åŠ¨æ€æ‰©å±•èƒ½åŠ›ã€‚</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">typealias</span> SceneAction = (List&lt;Action&gt;) -&gt; <span class="hljs-built_in">Unit</span>

<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Scene</span>(
    <span class="hljs-keyword">val</span> id: String,
    <span class="hljs-keyword">val</span> name: String,
    <span class="hljs-keyword">val</span> enterConditions: List&lt;Condition&gt;,
    <span class="hljs-keyword">val</span> exitConditions: List&lt;Condition&gt;,
    <span class="hljs-keyword">val</span> enterActions: List&lt;Action&gt;,
    <span class="hljs-keyword">val</span> exitActions: List&lt;Action&gt;,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _onEnterListeners: AtomicReference&lt;List&lt;SceneAction&gt;&gt;,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _onExitListeners: AtomicReference&lt;List&lt;SceneAction&gt;&gt;
) {
    <span class="hljs-comment">// å¯¹å¤–æš´éœ²çš„ onEnter / onExit</span>
    <span class="hljs-keyword">val</span> onEnter: SceneAction = { actions -&gt;
_onEnterListeners.<span class="hljs-keyword">get</span>().forEach {
it(actions)
        }
}

<span class="hljs-keyword">val</span> onExit: SceneAction = { actions -&gt;
 synchronized(_onExitListeners) {
_onExitListeners.<span class="hljs-keyword">get</span>().forEach {
it(actions)
            }
}
}

 <span class="hljs-comment">/**
* å¿½ç•¥è§¦å‘æ¡ä»¶ï¼Œç›´æ¥æ‰§è¡Œåœºæ™¯
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">enter</span><span class="hljs-params">()</span></span> {
        onEnter(enterActions)
    }

    <span class="hljs-comment">/**
* å¿½ç•¥é€€å‡ºæ¡ä»¶ï¼Œç›´æ¥é€€å‡ºåœºæ™¯
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">exit</span><span class="hljs-params">()</span></span> {
        onExit(exitActions)
    }

    <span class="hljs-comment">/**
* è®¢é˜…æ–°çš„è¿›å…¥/é€€å‡ºå›è°ƒ
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(onEnter: <span class="hljs-type">SceneAction</span>, onExit: <span class="hljs-type">SceneAction</span>)</span></span> {
        _onEnterListeners.updateAndGet { list -&gt; list + onEnter }
        _onExitListeners.updateAndGet { list -&gt; list + onExit }
}

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">create</span><span class="hljs-params">(
            id: <span class="hljs-type">String</span>,
            name: <span class="hljs-type">String</span>,
            enterConditions: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Condition</span>&gt; = emptyList()</span></span>,
            exitConditions: List&lt;Condition&gt; = emptyList(),
            enterActions: List&lt;Action&gt; = emptyList(),
            exitActions: List&lt;Action&gt; = emptyList(),
            onEnter: SceneAction = {} ,
            onExit: SceneAction = {}
): Scene {
            <span class="hljs-keyword">return</span> Scene(
                id = id,
                name = name,
                enterConditions = enterConditions,
                exitConditions = exitConditions,
                enterActions = enterActions,
                exitActions = exitActions,
                _onEnterListeners = AtomicReference(listOf(onEnter)),
                _onExitListeners = AtomicReference(listOf(onExit))
            )
        }
    }
}
</code></pre>
<h3 data-id="heading-6">2. ä¿¡å·ä¸­æ¢ï¼š<code>SignalManager</code></h3>
<p>ä½œä¸ºå…¨å±€å•ä¾‹ï¼Œ<code>SignalManager</code> è´Ÿè´£ï¼š</p>
<ul>
<li>ç»´æŠ¤å½“å‰æ‰€æœ‰ä¿¡å·çš„æœ€æ–°å€¼å¿«ç…§ï¼ˆ<code>currentSignals</code>ï¼‰ï¼›</li>
<li>æä¾› <code>updateSignal()</code> æ¥å£ä¾›<code>CarService</code>æˆ–ç³»ç»ŸæœåŠ¡æ¨é€çŠ¶æ€å˜æ›´ï¼›</li>
<li>æ”¯æŒå¤šè§‚å¯Ÿè€…è®¢é˜…ï¼ˆ<code>subscribe</code>ï¼‰ï¼Œå½“ä»»ä¸€ä¿¡å·æ›´æ–°æ—¶ï¼Œå¹¿æ’­ç»™æ‰€æœ‰ç›‘å¬è€…ã€‚</li>
</ul>
<p>è®¾è®¡ä¸Šæ•°æ®æºä¸æ¶ˆè´¹é€»è¾‘çš„è§£è€¦ï¼Œä»»ä½•æ¨¡å—åªéœ€ç›‘å¬ä¿¡å·å˜åŒ–å³å¯å‚ä¸åœºæ™¯è¯„ä¼°ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"> <span class="hljs-comment">/**
* ä¿¡å·ç®¡ç†å™¨ï¼Œç”¨äºç®¡ç†æ‰€æœ‰ä¿¡å·çš„å˜åŒ–å’Œè®¢é˜…
* è½¦è½½åº”ç”¨ä¸­ï¼Œä¼šå¯¹æ¥CarServiceå’Œå…¶ä»–ä¼ æ„Ÿå™¨ï¼Œå¹¶åœ¨åº”ç”¨å¯åŠ¨åç«‹å³å°†æ‰€æœ‰ä¿¡å·æ›´æ–°åˆ°ä¿¡å·ç®¡ç†å™¨ä¸­
*/</span>
<span class="hljs-keyword">object</span> SignalManager {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> currentSignals = mutableMapOf&lt;String, Any&gt;()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> listeners = mutableListOf&lt;SignalListener&gt;()

    <span class="hljs-comment">/**
* æ›´æ–°ä¿¡å·å€¼ï¼Œå¹¶é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateSignal</span><span class="hljs-params">(signal: <span class="hljs-type">Signal</span>)</span></span> {
        println(<span class="hljs-string">"[updateSignal]: <span class="hljs-variable">$signal</span>"</span>)
        currentSignals[signal.key] = signal.value
        listeners.forEach { it(signal) }
}

    <span class="hljs-comment">/**
* è·å–å½“å‰ä¿¡å·å€¼
* <span class="hljs-doctag">@param</span> key ä¿¡å·é”®å€¼
* <span class="hljs-doctag">@return</span> å½“å‰ä¿¡å·å€¼ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›null
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getCurrentValue</span><span class="hljs-params">(key: <span class="hljs-type">String</span>)</span></span>: Any? = currentSignals[key]

    <span class="hljs-comment">/**
* è®¢é˜…ä¿¡å·å˜åŒ–ï¼Œå¹¶æ³¨å†Œç›‘å¬å™¨
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">subscribe</span><span class="hljs-params">(listener: (<span class="hljs-type">Signal</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        listeners.add(listener)
    }

    <span class="hljs-comment">/**
* å–æ¶ˆè®¢é˜…ï¼Œç§»é™¤ç›‘å¬å™¨
*/</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">unsubscribe</span><span class="hljs-params">(listener: (<span class="hljs-type">Signal</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        listeners.remove(listener)
    }
}
</code></pre>
<h3 data-id="heading-7">3. è§„åˆ™å¼•æ“ï¼š<code>RuleEngine</code></h3>
<p><code>RuleEngine</code> æ˜¯æ•´ä¸ªç³»ç»Ÿçš„è°ƒåº¦æ ¸å¿ƒï¼Œå…¶å…³é”®è®¾è®¡åŒ…æ‹¬ï¼š</p>
<ul>
<li>åå‘ç´¢å¼•ä¼˜åŒ–ï¼šæ„å»º <code>signalKey â†’ [sceneId]</code> çš„æ˜ å°„ï¼ˆåˆ†ä¸ºè¿›å…¥/é€€å‡ºä¸¤å¥—ï¼‰ï¼Œä½¿å¾—æ¯æ¬¡ä¿¡å·æ›´æ–°ä»…éœ€è¯„ä¼°å¯èƒ½å—å½±å“çš„åœºæ™¯ï¼Œé¿å…å…¨é‡æ‰«æï¼Œæ˜¾è‘—æå‡æ€§èƒ½ã€‚</li>
<li>çŠ¶æ€æŒä¹…åŒ–ï¼šä½¿ç”¨ <code>enterStates</code> / <code>exitStates</code> è®°å½•æ¯ä¸ªæ¡ä»¶çš„é¦–æ¬¡æ»¡è¶³æ—¶é—´æˆ³ï¼Œç”¨äºè®¡ç®—æ˜¯å¦è¾¾åˆ° <code>duration</code> è¦æ±‚ã€‚</li>
<li>åç¨‹è°ƒåº¦ï¼šåˆ©ç”¨ <code>kotlinx.coroutines</code> å®ç°å»¶è¿Ÿé‡è¯„ã€‚å½“æ¡ä»¶æ»¡è¶³ä½†æœªè¾¾æŒç»­æ—¶é—´æ—¶ï¼Œè‡ªåŠ¨è°ƒåº¦ä¸€ä¸ªå»¶è¿Ÿä»»åŠ¡ï¼Œåœ¨ç²¾ç¡®æ—¶åˆ»é‡æ–°è¯„ä¼°ï¼Œé¿å…è½®è¯¢å¼€é”€ã€‚</li>
<li>åºåˆ—è¿½è¸ªï¼šé€šè¿‡ <code>sequenceProgress</code> å’Œ <code>lastStepTimestamp</code> ä¸¤ä¸ªå¹¶å‘å®‰å…¨çš„ Mapï¼Œè®°å½•æ¯ä¸ªåœºæ™¯åœ¨åºåˆ—åŒ¹é…ä¸­çš„å½“å‰è¿›åº¦ä¸ä¸Šä¸€æ­¥å®Œæˆæ—¶é—´ï¼Œç¡®ä¿æ—¶åºé€»è¾‘æ­£ç¡®ã€‚</li>
</ul>
<p>ä»£ç å¤ªé•¿ï¼Œå®Œæ•´ä»£ç è¯·å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flinxu-link%2FVehicleSceneEngine%2Fblob%2Fmaster%2Fapp%2Fsrc%2Fmain%2Fjava%2Fcom%2Fwj%2Fsceneengine%2Fengine%2FRuleEngine.kt" target="_blank" title="https://github.com/linxu-link/VehicleSceneEngine/blob/master/app/src/main/java/com/wj/sceneengine/engine/RuleEngine.kt" ref="nofollow noopener noreferrer">github.com/linxu-link/â€¦</a></p>
<hr/>
<h2 data-id="heading-8">ä¸‰ã€è¿›é˜¶éœ€æ±‚åˆ†æ</h2>
<p>åœ¨åŸºç¡€è§„åˆ™åŒ¹é…ä¹‹ä¸Šï¼ŒçœŸå®è½¦è½½åœºæ™¯å¸¸æ¶‰åŠæ›´å¤æ‚çš„æ—¶ç©ºé€»è¾‘ã€‚å¼•æ“é€šè¿‡ä¸¤ç§æœºåˆ¶åº”å¯¹å…¸å‹è¿›é˜¶éœ€æ±‚ï¼š</p>
<h3 data-id="heading-9">1. æŒç»­æ»¡è¶³ N ç§’æ‰è§¦å‘</h3>
<p>éœ€æ±‚èƒŒæ™¯ï¼šç¬æ—¶ä¿¡å·æ³¢åŠ¨ï¼ˆå¦‚é›·è¾¾è¯¯æŠ¥ã€GPSè·³å˜ï¼‰ä¸åº”å¯¼è‡´åœºæ™¯é¢‘ç¹åˆ‡æ¢ã€‚ å®ç°æ–¹æ¡ˆï¼š</p>
<ul>
<li>åœ¨ <code>Condition</code> ä¸­å¢åŠ  <code>durationMs</code> å­—æ®µã€‚</li>
<li><code>RuleEngine</code> åœ¨é¦–æ¬¡æ»¡è¶³æ¡ä»¶æ—¶è®°å½•æ—¶é—´æˆ³ï¼Œåç»­æ¯æ¬¡è¯„ä¼°æ£€æŸ¥ <code>(now - startTime) &gt;= durationMs</code>ã€‚</li>
<li>è‹¥æ¡ä»¶ä¸­é€”ä¸æ»¡è¶³ï¼Œåˆ™ç«‹å³æ¸…é™¤è®¡æ—¶çŠ¶æ€ã€‚</li>
<li>åˆ©ç”¨åç¨‹ <code>delay()</code> ç²¾ç¡®è°ƒåº¦é‡è¯„ä»»åŠ¡ï¼Œè€Œéä½æ•ˆè½®è¯¢ã€‚</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ¡ä»¶çŠ¶æ€è®°å½•</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> enterStates = ConcurrentHashMap&lt;String, MutableMap&lt;Condition, <span class="hljs-built_in">Long</span>&gt;&gt;()
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> exitStates = ConcurrentHashMap&lt;String, MutableMap&lt;Condition, <span class="hljs-built_in">Long</span>&gt;&gt;()
<span class="hljs-comment">// åç¨‹ä¸ä»»åŠ¡ç®¡ç†</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> enterJobs = ConcurrentHashMap&lt;String, Job&gt;()
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> exitJobs = ConcurrentHashMap&lt;String, Job&gt;()
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mutex = Mutex()
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> scope = CoroutineScope(Dispatchers.Default + SupervisorJob())

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processEnterLogic</span><span class="hljs-params">(scene: <span class="hljs-type">Scene</span>, now: <span class="hljs-type">Long</span>, triggerSignal: <span class="hljs-type">Signal</span>?)</span></span> {
    <span class="hljs-keyword">val</span> enterState = enterStates.getOrPut(scene.id) { ConcurrentHashMap() }

<span class="hljs-comment">// 1. å¤„ç†åºåˆ—æ¡ä»¶ (å¦‚æœæœ‰)</span>
    <span class="hljs-keyword">val</span> seqCond = scene.enterConditions.filterIsInstance&lt;SequenceCondition&gt;().firstOrNull()
    <span class="hljs-keyword">val</span> seqSatisfied = <span class="hljs-keyword">if</span> (seqCond != <span class="hljs-literal">null</span>) {
        updateAndCheckSequence(scene.id, seqCond, triggerSignal, now)
    } <span class="hljs-keyword">else</span> <span class="hljs-literal">true</span>

    <span class="hljs-comment">// 2. å¤„ç†æ™®é€šæ¡ä»¶ (Duration é€»è¾‘)</span>
    <span class="hljs-keyword">val</span> normalConds = scene.enterConditions.filter { it !<span class="hljs-keyword">is</span> SequenceCondition }
<span class="hljs-keyword">var</span> allNormalSatisfied = <span class="hljs-literal">true</span>

    normalConds.forEach { cond -&gt;
<span class="hljs-keyword">if</span> (evaluateCondition(cond)) {
            enterState.putIfAbsent(cond, now) <span class="hljs-comment">// è®°å½•é¦–æ¬¡æ»¡è¶³çš„æ—¶é—´æˆ³</span>
        } <span class="hljs-keyword">else</span> {
            enterState.remove(cond) <span class="hljs-comment">// ä¸€æ—¦ä¸æ»¡è¶³ç«‹å³æ¸…é™¤è®¡æ—¶</span>
            allNormalSatisfied = <span class="hljs-literal">false</span>
        }
    }

<span class="hljs-comment">// 3. ç»¼åˆåˆ¤å®š</span>
    <span class="hljs-keyword">if</span> (allNormalSatisfied &amp;&amp; seqSatisfied &amp;&amp; scene.enterConditions.isNotEmpty()) {
        <span class="hljs-keyword">val</span> allDurationMet = normalConds.all { cond -&gt;
<span class="hljs-keyword">val</span> startTime = enterState[cond] ?: now
            (now - startTime) &gt;= cond.durationMs
        }

<span class="hljs-keyword">if</span> (allDurationMet) {
            enterJobs[scene.id]?.cancel()
            scene.enter()
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// è®¡ç®—è¿˜éœ€è¦ç­‰å¾…å¤šä¹…</span>
            <span class="hljs-keyword">val</span> remainingWait = normalConds.maxOf { cond -&gt;
<span class="hljs-keyword">val</span> elapsed = now - (enterState[cond] ?: now)
                (cond.durationMs - elapsed).coerceAtLeast(<span class="hljs-number">0L</span>)
            }
scheduleReEvaluation(scene, remainingWait, <span class="hljs-literal">true</span>)
        }
    } <span class="hljs-keyword">else</span> {
        enterJobs[scene.id]?.cancel()
    }
}
</code></pre>
<h3 data-id="heading-10">2. æ—¶åºæ•æ„Ÿå‹åœºæ™¯</h3>
<p>éœ€æ±‚èƒŒæ™¯ï¼šæŸäº›åœºæ™¯çš„è§¦å‘éœ€ä¸¥æ ¼æŒ‰é¡ºåºæ‰§è¡Œï¼ˆå¦‚â€œè¸©åˆ¹è½¦ â†’ æŒ‰å¯åŠ¨é”®â€ï¼‰ã€‚ å®ç°æ–¹æ¡ˆï¼š</p>
<ul>
<li>
<p>å¼•å…¥ <code>SequenceCondition</code>ï¼Œå°†å¤šæ­¥æ“ä½œå°è£…ä¸ºä¸€ä¸ªå¤åˆæ¡ä»¶ã€‚</p>
</li>
<li>
<p>å¼•æ“å†…éƒ¨ç»´æŠ¤æ¯ä¸ªåœºæ™¯çš„åºåˆ—è¿›åº¦ï¼ˆ<code>sequenceProgress</code>ï¼‰å’Œæ­¥éª¤é—´çš„æ—¶é—´çª—å£ï¼ˆ<code>timeoutMs</code>ï¼‰ã€‚</p>
</li>
<li>
<p>æ¯æ¬¡ä¿¡å·æ›´æ–°æ—¶ï¼š</p>
<ul>
<li>æ£€æŸ¥å‰ç½®æ­¥éª¤æ˜¯å¦ä»æœ‰æ•ˆï¼ˆé˜²æ­¢çŠ¶æ€å›é€€å¯¼è‡´é€»è¾‘é”™è¯¯ï¼‰ï¼›</li>
<li>è‹¥å½“å‰ä¿¡å·åŒ¹é…ä¸‹ä¸€æ­¥æ¡ä»¶ä¸”æœªè¶…æ—¶ï¼Œåˆ™æ¨è¿›è¿›åº¦ï¼›</li>
<li>è‹¥åºåˆ—å®Œæ•´åŒ¹é…ï¼Œåˆ™è§†ä¸ºæ¡ä»¶æ»¡è¶³ã€‚</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SequenceCondition</span>(
    <span class="hljs-keyword">val</span> steps: List&lt;SequenceStep&gt;
) : Condition {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> signalKey: String = steps.firstOrNull()?.condition?.signalKey ?: <span class="hljs-string">""</span>
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> durationMs: <span class="hljs-built_in">Long</span> = <span class="hljs-number">0L</span>
}

<span class="hljs-comment">// åºåˆ—è¿›åº¦è¿½è¸ªï¼šsceneId -&gt; å½“å‰åŒ¹é…åˆ°çš„æ­¥éª¤ç´¢å¼•</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> sequenceProgress = ConcurrentHashMap&lt;String, <span class="hljs-built_in">Int</span>&gt;()
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> lastStepTimestamp = ConcurrentHashMap&lt;String, <span class="hljs-built_in">Long</span>&gt;()

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">updateAndCheckSequence</span><span class="hljs-params">(sceneId: <span class="hljs-type">String</span>, seq: <span class="hljs-type">SequenceCondition</span>, signal: <span class="hljs-type">Signal</span>?, now: <span class="hljs-type">Long</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">val</span> currentIndex = sequenceProgress.getOrDefault(sceneId, <span class="hljs-number">0</span>)
    <span class="hljs-keyword">if</span> (currentIndex == <span class="hljs-number">0</span> &amp;&amp; signal == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

    <span class="hljs-comment">// è·å–å½“å‰æ­£åœ¨ç­‰å¾…åŒ¹é…çš„æ­¥éª¤</span>
    <span class="hljs-keyword">val</span> currentStep = seq.steps[currentIndex]

    <span class="hljs-comment">// ç­–ç•¥ï¼šæ£€æŸ¥å·²ç»åŒ¹é…æˆåŠŸçš„é‚£äº›æ­¥éª¤æ˜¯å¦ä¾ç„¶æœ‰æ•ˆ</span>
    <span class="hljs-comment">// å¦‚æœåºåˆ—è¦æ±‚ A -&gt; Bï¼Œå½“å‰åœ¨ç­‰ Bï¼Œä½† A çªç„¶ä¸æ»¡è¶³äº†ï¼Œåºåˆ—åº”é‡ç½®</span>
    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until currentIndex) {
        <span class="hljs-keyword">if</span> (!evaluateCondition(seq.steps[i].condition)) {
            sequenceProgress[sceneId] = <span class="hljs-number">0</span> <span class="hljs-comment">// å‰ç½®æ­¥éª¤å¤±æ•ˆï¼Œé‡ç½®</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
        }
    }

    <span class="hljs-comment">// æ£€æŸ¥æ­¥éª¤é—´æ˜¯å¦è¶…æ—¶</span>
    <span class="hljs-keyword">val</span> lastTime = lastStepTimestamp.getOrDefault(sceneId, <span class="hljs-number">0L</span>)
    <span class="hljs-keyword">if</span> (currentIndex &gt; <span class="hljs-number">0</span> &amp;&amp; (now - lastTime) &gt; currentStep.timeoutMs) {
        sequenceProgress[sceneId] = <span class="hljs-number">0</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
    }

    <span class="hljs-comment">// å¤„ç†å½“å‰ä¿¡å·è§¦å‘çš„è¿›åº¦æ¨è¿›</span>
    <span class="hljs-keyword">if</span> (signal != <span class="hljs-literal">null</span> &amp;&amp; signal.key == currentStep.condition.signalKey) {
        <span class="hljs-keyword">if</span> (evaluateCondition(currentStep.condition)) {
            <span class="hljs-keyword">val</span> nextIndex = currentIndex + <span class="hljs-number">1</span>
            <span class="hljs-keyword">if</span> (nextIndex &gt;= seq.steps.size) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-comment">// åºåˆ—å…¨åŒ¹é…</span>
            } <span class="hljs-keyword">else</span> {
                sequenceProgress[sceneId] = nextIndex
                lastStepTimestamp[sceneId] = now
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (currentIndex &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// å¦‚æœæ˜¯å½“å‰æ­¥éª¤çš„ä¿¡å·å‘ç”Ÿäº†å˜åŒ–ä¸”å˜å¾—ä¸æ»¡è¶³ï¼Œé‡ç½®</span>
            sequenceProgress[sceneId] = <span class="hljs-number">0</span>
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}
</code></pre>
<h2 data-id="heading-11">å››ã€ä½¿ç”¨æ–¹å¼</h2>
<h3 data-id="heading-12">1. æ»¡è¶³æ¡ä»¶å³å¯è‡ªåŠ¨è§¦å‘çš„åœºæ™¯</h3>
<p>è§„åˆ™ï¼šè½¦è¾†ç”µé‡ä½äº 20% æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ ECO æ¨¡å¼ï¼Œç”µé‡é«˜äº60ï¼… æ—¶ï¼Œè‡ªåŠ¨é€€å‡º ECO æ¨¡å¼</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 1. è‡ªåŠ¨è§¦å‘ECOæ¨¡å¼</span>
<span class="hljs-comment">// è§„åˆ™ï¼šè½¦è¾†ç”µé‡ä½äº 20% æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ ECO æ¨¡å¼ï¼Œç”µé‡é«˜äº60ï¼… æ—¶ï¼Œè‡ªåŠ¨é€€å‡º ECO æ¨¡å¼</span>
<span class="hljs-selector-tag">val</span> <span class="hljs-selector-tag">ecoScene</span> = <span class="hljs-selector-tag">Scene</span><span class="hljs-selector-class">.create</span>(
    id = <span class="hljs-string">"eco_mode"</span>,
    name = <span class="hljs-string">"ECO æ¨¡å¼"</span>,
    enterActions = <span class="hljs-built_in">listOf</span>(<span class="hljs-built_in">Action</span>(<span class="hljs-string">"enable_eco_mode"</span>, <span class="hljs-built_in">mapOf</span>(<span class="hljs-string">"mode"</span> to <span class="hljs-string">"eco"</span>))),
    exitActions = <span class="hljs-built_in">listOf</span>(<span class="hljs-built_in">Action</span>(<span class="hljs-string">"disable_eco_mode"</span>, <span class="hljs-built_in">mapOf</span>(<span class="hljs-string">"mode"</span> to <span class="hljs-string">"eco"</span>))),
    enterConditions = <span class="hljs-built_in">listOf</span>(
        Condition.<span class="hljs-built_in">LessThan</span>(<span class="hljs-string">"battery_level"</span>, <span class="hljs-number">20</span>)
    ),
    exitConditions = <span class="hljs-built_in">listOf</span>(
        Condition.<span class="hljs-built_in">GreaterThan</span>(<span class="hljs-string">"battery_level"</span>, <span class="hljs-number">60</span>)
    ),
    onEnter = { <span class="hljs-selector-tag">actions</span> <span class="hljs-selector-tag">-</span>&gt;
 <span class="hljs-selector-tag">println</span>(<span class="hljs-string">"ğŸŸ¢ [åœºæ™¯æ¿€æ´»] å·²è¿›å…¥ ECO æ¨¡å¼ï¼šå¼€å¯èŠ‚èƒ½æ¨¡å¼\n"</span>)
        <span class="hljs-comment">// è§£æ actions æ‰§è¡Œå…¶ä»–æ“ä½œ</span>
    } ,
    <span class="hljs-selector-tag">onExit</span> = { <span class="hljs-selector-tag">actions</span> <span class="hljs-selector-tag">-</span>&gt;
 <span class="hljs-selector-tag">println</span>(<span class="hljs-string">"ğŸ”´ [åœºæ™¯é€€å‡º] å·²é€€å‡º ECO æ¨¡å¼ï¼šå…³é—­èŠ‚èƒ½æ¨¡å¼\n"</span>)
    } ,
)
<span class="hljs-selector-tag">engine</span><span class="hljs-selector-class">.addScene</span>(ecoScene)

<span class="hljs-comment">// --- æµ‹è¯• 1: åºåˆ—äº‹ä»¶éªŒè¯ ---</span>
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"--- æµ‹è¯• 1: æµ‹è¯•åœºæ™¯å¼•æ“ï¼ˆè‡ªåŠ¨è§¦å‘ECOæ¨¡å¼ï¼‰ ---"</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"battery_level"</span>, <span class="hljs-number">10</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"battery_level"</span>, <span class="hljs-number">30</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"battery_level"</span>, <span class="hljs-number">50</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"battery_level"</span>, <span class="hljs-number">70</span>))
</code></pre>
<p>æ‰§è¡Œç»“æœï¼š</p>
<ul>
<li>å½“å¼•æ“æ¥æ”¶åˆ°ç”µé‡=10æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ã€Ecoæ¨¡å¼ã€‘</li>
<li>å½“å¼•æ“æ¥æ”¶åˆ°ç”µé‡=70æ—¶ï¼Œè‡ªåŠ¨é€€å‡ºã€Ecoæ¨¡å¼ã€‘</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">--- æµ‹è¯• 1: æµ‹è¯•åœºæ™¯å¼•æ“ï¼ˆè‡ªåŠ¨è§¦å‘ECOæ¨¡å¼ï¼‰ ---
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=battery_level, value=<span class="hljs-number">10</span>)
ğŸŸ¢ <span class="hljs-section">[åœºæ™¯æ¿€æ´»]</span> å·²è¿›å…¥ ECO æ¨¡å¼ï¼šå¼€å¯èŠ‚èƒ½æ¨¡å¼

<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=battery_level, value=<span class="hljs-number">30</span>)
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=battery_level, value=<span class="hljs-number">50</span>)
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=battery_level, value=<span class="hljs-number">70</span>)
ğŸ”´ <span class="hljs-section">[åœºæ™¯é€€å‡º]</span> å·²é€€å‡º ECO æ¨¡å¼ï¼šå…³é—­èŠ‚èƒ½æ¨¡å¼
</code></pre>
<h3 data-id="heading-13">2. æŒç»­æ»¡è¶³è§„å®šçš„æ—¶é—´æ‰å¯è§¦å‘çš„åœºæ™¯</h3>
<p>è§„åˆ™ï¼šè½¦é€Ÿå¿…é¡»å¤§äº 80 km/hï¼Œä¸”æŒç»­ 5 ç§’æ‰èƒ½è§¦å‘ï¼ˆé˜²æ­¢å› ç¬é—´åŠ é€Ÿè¯¯è§¦å‘ï¼‰ã€‚</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 2. å®šä¹‰å¸¦æŒç»­æ—¶é—´çš„åœºæ™¯ï¼šé«˜é€Ÿå·¡èˆªæ¨¡å¼</span>
<span class="hljs-comment">// è§„åˆ™ï¼šè½¦é€Ÿå¿…é¡»å¤§äº 80 km/hï¼Œä¸”æŒç»­ 5 ç§’ï¼Œé˜²æ­¢å› ç¬é—´åŠ é€Ÿè¯¯è§¦å‘</span>
val highSpeedScene = Scene<span class="hljs-selector-class">.create</span>(
    id = "high_speed_cruise",
    name = "é«˜é€Ÿå·¡èˆªæ¨¡å¼",
    enterConditions = listOf(
        Condition.GreaterThan("speed", <span class="hljs-number">80</span>, duration = <span class="hljs-number">5000</span>) <span class="hljs-comment">// å¿…é¡»æŒç»­ 5s</span>
    ),
    exitConditions = <span class="hljs-built_in">listOf</span>(
        Condition.LessThan("speed", <span class="hljs-number">70</span>) <span class="hljs-comment">// é€€å‡ºåˆ™ä¸éœ€è¦æŒç»­æ—¶é—´</span>
    ),
    onEnter = { actions -&gt;
 <span class="hljs-built_in">println</span>("ğŸŸ¢ [åœºæ™¯æ¿€æ´»] å·²è¿›å…¥é«˜é€Ÿå·¡èˆªæ¨¡å¼ï¼šå±•å¼€å°¾ç¿¼\n")
        <span class="hljs-comment">// è§£æ actions æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œå¦‚è°ƒæ•´å‘åŠ¨æœºæ€§èƒ½</span>
    } ,
    onExit = { actions -&gt;
 <span class="hljs-built_in">println</span>("ğŸ”´ [åœºæ™¯é€€å‡º] é€€å‡ºé«˜é€Ÿå·¡èˆªæ¨¡å¼ï¼šå…³é—­å°¾ç¿¼\n")
    }
)
engine<span class="hljs-selector-class">.addScene</span>(highSpeedScene)

<span class="hljs-comment">// --- æµ‹è¯• 2: æŒç»­æ—¶é—´éªŒè¯ ---</span>
<span class="hljs-built_in">println</span>("--- æµ‹è¯• <span class="hljs-number">2</span>: å¼€å§‹æŒç»­æ—¶é—´éªŒè¯ (Speed &gt; <span class="hljs-number">80</span> for <span class="hljs-number">5s</span>) ---")
SignalManager<span class="hljs-selector-class">.updateSignal</span>(Signal("speed", <span class="hljs-number">100</span>))
<span class="hljs-built_in">println</span>("å½“å‰è½¦é€Ÿ <span class="hljs-number">100</span>ï¼Œç­‰å¾…å¼•æ“è®¡æ—¶...")
<span class="hljs-comment">// æ¨¡æ‹Ÿ 3 ç§’åæŸ¥çœ‹çŠ¶æ€ï¼ˆæ­¤æ—¶ä¸åº”æ¿€æ´»ï¼Œå› ä¸ºæœªæ»¡ 5sï¼‰</span>
<span class="hljs-built_in">delay</span>(<span class="hljs-number">3000</span>)
<span class="hljs-built_in">println</span>("è®¡æ—¶ <span class="hljs-number">3s</span> æ—¶ï¼Œé«˜é€Ÿå·¡èˆªåœºæ™¯æ˜¯å¦æ¿€æ´»: ${engine.isSceneActive(highSpeedScene.id)}")
<span class="hljs-comment">// å†ç­‰ 3 ç§’ï¼ˆæ€»è®¡ 6sï¼‰ï¼Œåº”è¯¥æ¿€æ´»</span>
<span class="hljs-built_in">delay</span>(<span class="hljs-number">3000</span>)
<span class="hljs-built_in">println</span>("è®¡æ—¶ <span class="hljs-number">6s</span> æ—¶ï¼Œé«˜é€Ÿå·¡èˆªåœºæ™¯æ˜¯å¦æ¿€æ´»: ${engine.isSceneActive(highSpeedScene.id)}")
SignalManager<span class="hljs-selector-class">.updateSignal</span>(Signal("speed", <span class="hljs-number">67</span>))
<span class="hljs-built_in">delay</span>(<span class="hljs-number">1000</span>)

<span class="hljs-comment">// --- æµ‹è¯• 3: ä¿¡å·æŠ–åŠ¨æ‹¦æˆª ---</span>
<span class="hljs-built_in">println</span>("--- æµ‹è¯• <span class="hljs-number">3</span>: æµ‹è¯•ä¿¡å·æŠ–åŠ¨æ˜¯å¦ä¼šé‡ç½®è®¡æ—¶ ---")
SignalManager<span class="hljs-selector-class">.updateSignal</span>(Signal("speed", <span class="hljs-number">60</span>)) <span class="hljs-comment">// å…ˆé™é€Ÿ</span>
<span class="hljs-built_in">delay</span>(<span class="hljs-number">500</span>)
SignalManager<span class="hljs-selector-class">.updateSignal</span>(Signal("speed", <span class="hljs-number">120</span>)) <span class="hljs-comment">// é‡æ–°æé€Ÿ</span>
<span class="hljs-built_in">delay</span>(<span class="hljs-number">3000</span>)
SignalManager<span class="hljs-selector-class">.updateSignal</span>(Signal("speed", <span class="hljs-number">50</span>)) <span class="hljs-comment">// åœ¨ 5s åˆ°è¾¾å‰çªç„¶é™é€Ÿ</span>
<span class="hljs-built_in">delay</span>(<span class="hljs-number">3000</span>)
<span class="hljs-built_in">println</span>(
    "ä¿¡å·æŠ–åŠ¨åï¼ˆæœªæ»¡<span class="hljs-number">5s</span>å³ä¸­æ–­ï¼‰ï¼Œé«˜é€Ÿå·¡èˆªåœºæ™¯æ˜¯å¦æ¿€æ´»: ${
        engine.isSceneActive(
            highSpeedScene.id
        )
    }"
)
</code></pre>
<p>æ‰§è¡Œç»“æœï¼š</p>
<ul>
<li>è½¦é€Ÿ=100æ—¶ï¼Œã€é«˜é€Ÿå·¡èˆªæ¨¡å¼ã€‘æ²¡æœ‰ç«‹å³æ¿€æ´»</li>
<li>æŒç»­5såï¼Œè‡ªåŠ¨è§¦å‘ã€é«˜é€Ÿå·¡èˆªæ¨¡å¼ã€‘</li>
<li>è½¦é€Ÿ=67æ—¶ï¼Œè‡ªåŠ¨é€€å‡ºã€é«˜é€Ÿå·¡èˆªæ¨¡å¼ã€‘</li>
<li>å½“è½¦é€Ÿå…ˆé€’å¢è‡³120ï¼Œå†ä¸‹é™è‡³50ï¼Œä¸ä¼šè§¦å‘ã€é«˜é€Ÿå·¡èˆªæ¨¡å¼ã€‘</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">--- æµ‹è¯• 2: å¼€å§‹æŒç»­æ—¶é—´éªŒè¯ (Speed &gt; 80 for 5s) ---
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=speed, value=<span class="hljs-number">100</span>)
å½“å‰è½¦é€Ÿ 100ï¼Œç­‰å¾…å¼•æ“è®¡æ—¶...
è®¡æ—¶ 3s æ—¶ï¼Œé«˜é€Ÿå·¡èˆªåœºæ™¯æ˜¯å¦æ¿€æ´»: false
ğŸŸ¢ <span class="hljs-section">[åœºæ™¯æ¿€æ´»]</span> å·²è¿›å…¥é«˜é€Ÿå·¡èˆªæ¨¡å¼ï¼šå±•å¼€å°¾ç¿¼

è®¡æ—¶ 6s æ—¶ï¼Œé«˜é€Ÿå·¡èˆªåœºæ™¯æ˜¯å¦æ¿€æ´»: true
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=speed, value=<span class="hljs-number">67</span>)
ğŸ”´ <span class="hljs-section">[åœºæ™¯é€€å‡º]</span> é€€å‡ºé«˜é€Ÿå·¡èˆªæ¨¡å¼ï¼šå…³é—­å°¾ç¿¼

--- æµ‹è¯• 3: æµ‹è¯•ä¿¡å·æŠ–åŠ¨æ˜¯å¦ä¼šé‡ç½®è®¡æ—¶ ---
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=speed, value=<span class="hljs-number">60</span>)
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=speed, value=<span class="hljs-number">120</span>)
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=speed, value=<span class="hljs-number">50</span>)
ä¿¡å·æŠ–åŠ¨åï¼ˆæœªæ»¡5så³ä¸­æ–­ï¼‰ï¼Œé«˜é€Ÿå·¡èˆªåœºæ™¯æ˜¯å¦æ¿€æ´»: false
</code></pre>
<h3 data-id="heading-14">3. æ»¡è¶³è§„å®šçš„åºåˆ—æ‰å¯è§¦å‘çš„åœºæ™¯</h3>
<p>è§„åˆ™ï¼šå¿…é¡»å…ˆâ€œè¸©ä¸‹åˆ¹è½¦â€ï¼Œç„¶ååœ¨ 3 ç§’å†…â€œæŒ‰ä¸‹å¯åŠ¨é”®â€ï¼Œæ‰èƒ½æ¿€æ´»â€œåŠ¨åŠ›ç³»ç»Ÿâ€ã€‚</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 3. å¸¦åºåˆ—çš„å®‰å…¨å¯åŠ¨æ ¡éªŒåœºæ™¯</span>
<span class="hljs-comment">// è§„åˆ™ï¼šå¿…é¡»å…ˆâ€œè¸©ä¸‹åˆ¹è½¦â€ï¼Œç„¶ååœ¨ 3 ç§’å†…â€œæŒ‰ä¸‹å¯åŠ¨é”®â€ï¼Œæ‰èƒ½æ¿€æ´»â€œåŠ¨åŠ›ç³»ç»Ÿâ€</span>
<span class="hljs-selector-tag">val</span> <span class="hljs-selector-tag">securitySequenceScene</span> = <span class="hljs-selector-tag">Scene</span><span class="hljs-selector-class">.create</span>(
    id = <span class="hljs-string">"security_start"</span>,
    name = <span class="hljs-string">"å®‰å…¨å¯åŠ¨æ¨¡å¼"</span>,
    enterConditions = <span class="hljs-built_in">listOf</span>(
        <span class="hljs-built_in">SequenceCondition</span>(
            steps = <span class="hljs-built_in">listOf</span>(
                <span class="hljs-built_in">SequenceStep</span>(
                    Condition.<span class="hljs-built_in">Equals</span>(<span class="hljs-string">"brake_pedal"</span>, <span class="hljs-string">"pressed"</span>), timeoutMs = <span class="hljs-number">0</span>
                ),
                <span class="hljs-built_in">SequenceStep</span>(
                    Condition.<span class="hljs-built_in">Equals</span>(<span class="hljs-string">"start_button"</span>, <span class="hljs-string">"clicked"</span>), timeoutMs = <span class="hljs-number">3000</span>
                )
            )
        )
    ),
    enterActions = <span class="hljs-built_in">listOf</span>(<span class="hljs-built_in">Action</span>(<span class="hljs-string">"enable_motor"</span>, <span class="hljs-built_in">mapOf</span>(<span class="hljs-string">"power"</span> to <span class="hljs-number">100</span>))),
    onEnter = { <span class="hljs-selector-tag">println</span>(<span class="hljs-string">"ğŸŸ¢ [åœºæ™¯æ¿€æ´»] å®‰å…¨æ ¡éªŒé€šè¿‡ï¼šåŠ¨åŠ›ç³»ç»Ÿå·²å°±ç»ªï¼\n"</span>) }
)
<span class="hljs-selector-tag">engine</span><span class="hljs-selector-class">.addScene</span>(securitySequenceScene)

<span class="hljs-comment">// --- æµ‹è¯• 4: åºåˆ—äº‹ä»¶éªŒè¯ ---</span>
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"--- æµ‹è¯• 4: å¼€å§‹å®‰å…¨å¯åŠ¨åºåˆ—æµ‹è¯• ---"</span>)
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"å…ˆè¸©ä¸‹åˆ¶åŠ¨è¸æ¿"</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"brake_pedal"</span>, <span class="hljs-string">"pressed"</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"æ¾å¼€åˆ¶åŠ¨è¸æ¿"</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"brake_pedal"</span>, <span class="hljs-string">"unpressed"</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"ç­‰å¾… 1 ç§’åæŒ‰ä¸‹å¯åŠ¨é”®"</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"start_button"</span>, <span class="hljs-string">"clicked"</span>))
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"å®‰å…¨å¯åŠ¨åœºæ™¯æ˜¯å¦æ¿€æ´»: ${engine.isSceneActive(securitySequenceScene.id)}"</span>)
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"å†æ¬¡åˆ¶åŠ¨è¸æ¿"</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"brake_pedal"</span>, <span class="hljs-string">"pressed"</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">2000</span>)
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">"ç­‰å¾… 1 ç§’åæŒ‰ä¸‹å¯åŠ¨é”®"</span>)
<span class="hljs-selector-tag">SignalManager</span><span class="hljs-selector-class">.updateSignal</span>(<span class="hljs-built_in">Signal</span>(<span class="hljs-string">"start_button"</span>, <span class="hljs-string">"clicked"</span>))
<span class="hljs-selector-tag">delay</span>(<span class="hljs-number">1000</span>)
<span class="hljs-selector-tag">println</span>(<span class="hljs-string">" ============= æµ‹è¯•åœºæ™¯å¼•æ“ end ============"</span>)
</code></pre>
<p>æ‰§è¡Œç»“æœï¼š</p>
<ul>
<li>å…ˆè¸©ä¸‹åˆ¶åŠ¨è¸æ¿ï¼Œç´§æ¥ç€æ¾å¼€åˆ¶åŠ¨è¸æ¿</li>
<li>ç­‰å¾… 1 ç§’åæŒ‰ä¸‹å¯åŠ¨é”®ï¼Œã€å®‰å…¨å¯åŠ¨æ¨¡å¼ã€‘æœªæ¿€æ´»</li>
<li>å†æ¬¡è¸©ä¸‹åˆ¶åŠ¨è¸æ¿</li>
<li>ç­‰å¾… 1 ç§’åæŒ‰ä¸‹å¯åŠ¨é”®ï¼Œè‡ªåŠ¨è¿›å…¥ã€å®‰å…¨å¯åŠ¨æ¨¡å¼ã€‘</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">--- æµ‹è¯• 4: å¼€å§‹å®‰å…¨å¯åŠ¨åºåˆ—æµ‹è¯• ---
å…ˆè¸©ä¸‹åˆ¶åŠ¨è¸æ¿
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=brake_pedal, value=pressed)
æ¾å¼€åˆ¶åŠ¨è¸æ¿
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=brake_pedal, value=unpressed)
ç­‰å¾… 1 ç§’åæŒ‰ä¸‹å¯åŠ¨é”®
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=start_button, value=clicked)
å®‰å…¨å¯åŠ¨åœºæ™¯æ˜¯å¦æ¿€æ´»: false
å†æ¬¡åˆ¶åŠ¨è¸æ¿
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=brake_pedal, value=pressed)
ç­‰å¾… 1 ç§’åæŒ‰ä¸‹å¯åŠ¨é”®
<span class="hljs-section">[updateSignal]</span>: Signal(<span class="hljs-attr">key</span>=start_button, value=clicked)
ğŸŸ¢ <span class="hljs-section">[åœºæ™¯æ¿€æ´»]</span> å®‰å…¨æ ¡éªŒé€šè¿‡ï¼šåŠ¨åŠ›ç³»ç»Ÿå·²å°±ç»ªï¼
</code></pre>
<h2 data-id="heading-15">äº”ã€æ€»ç»“</h2>
<p>å›é¡¾ä¸€ä¸‹ï¼Œâ€œåœºæ™¯å¼•æ“â€è¿™ä¸ªæ¦‚å¿µå¬èµ·æ¥é¢‡ä¸ºé«˜ç«¯ï¼Œä½†æ‹†å¼€æ¥çœ‹ï¼Œå®ƒçš„æ ¸å¿ƒå…¶å®å°±æ˜¯ä¸€ä¸ªè§„åˆ™å¼•æ“ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å½“å‰çš„å®ç°ä»…ä»…æ˜¯ä¸€ä¸ªå¼€ç«¯ï¼Œéšç€å¤§æ¨¡å‹çš„é›†æˆå’Œç”¨æˆ·è¡Œä¸ºæ•°æ®çš„æŒç»­ç§¯ç´¯ï¼Œåœºæ™¯å¼•æ“æœ‰æœ›ä»è¢«åŠ¨å“åº”è§„åˆ™æ¼”è¿›åˆ°ä¸»åŠ¨é¢„æµ‹ç”¨æˆ·æ„å›¾ã€‚å¸Œæœ›è¿™ç¯‡åˆ†äº«èƒ½ä¸ºä½ æä¾›ä¸€äº›çµæ„Ÿå’Œæ€è€ƒã€‚</p>
<p>æœ¬æ–‡æºç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flinxu-link%2FVehicleSceneEngine" target="_blank" title="https://github.com/linxu-link/VehicleSceneEngine" ref="nofollow noopener noreferrer">github.com/linxu-link/â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaå†…å­˜å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰å®Œæ•´è¯¦è§£]]></title>    <link>https://juejin.cn/post/7592805973119991814</link>    <guid>https://juejin.cn/post/7592805973119991814</guid>    <pubDate>2026-01-08T08:17:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592805973119991814" data-draft-id="7592759140037804073" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaå†…å­˜å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰å®Œæ•´è¯¦è§£"/> <meta itemprop="keywords" content="å‰ç«¯,é¢è¯•,Java"/> <meta itemprop="datePublished" content="2026-01-08T08:17:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é’è²843"/> <meta itemprop="url" content="https://juejin.cn/user/541408646929991"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaå†…å­˜å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰å®Œæ•´è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/541408646929991/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é’è²843
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:17:56.000Z" title="Thu Jan 08 2026 08:17:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1å°æ—¶+
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç¬¬ä¸€éƒ¨åˆ†ï¼šåƒåœ¾å›æ”¶åŸºç¡€</h2>
<h3 data-id="heading-1">1. åƒåœ¾å›æ”¶åŸºç¡€</h3>
<h4 data-id="heading-2">1.1 ä»€ä¹ˆæ˜¯åƒåœ¾å›æ”¶</h4>
<p><strong>å®šä¹‰ï¼š</strong></p>
<p>åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼ŒGCï¼‰æ˜¯è‡ªåŠ¨ç®¡ç†å†…å­˜çš„æœºåˆ¶ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å’Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé‡Šæ”¾å®ƒä»¬å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p>
<p><strong>ä½œç”¨ï¼š</strong></p>
<ol>
<li><strong>è‡ªåŠ¨é‡Šæ”¾å†…å­˜</strong>ï¼šä¸éœ€è¦å¼€å‘è€…æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ï¼Œé¿å…å¿˜è®°é‡Šæ”¾å¯¼è‡´çš„å†…å­˜æ³„æ¼</li>
<li><strong>é¿å…å†…å­˜æ³„æ¼</strong>ï¼šè‡ªåŠ¨å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé˜²æ­¢å†…å­˜é€æ¸è¢«å ç”¨</li>
<li><strong>ç®€åŒ–å†…å­˜ç®¡ç†</strong>ï¼šå¼€å‘è€…åªéœ€è¦å…³æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä¸éœ€è¦å…³å¿ƒå†…å­˜é‡Šæ”¾</li>
<li><strong>æé«˜å¼€å‘æ•ˆç‡</strong>ï¼šå‡å°‘å†…å­˜ç®¡ç†ç›¸å…³çš„bug</li>
</ol>
<p><strong>Androidä¸­çš„é‡è¦æ€§ï¼š</strong></p>
<ol>
<li><strong>å†…å­˜æœ‰é™</strong>ï¼šAndroidè®¾å¤‡å†…å­˜æœ‰é™ï¼Œå¿…é¡»åˆç†ä½¿ç”¨</li>
<li><strong>æ€§èƒ½å½±å“</strong>ï¼šGCæ€§èƒ½ç›´æ¥å½±å“åº”ç”¨æµç•…åº¦</li>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šé¢‘ç¹GCä¼šå¯¼è‡´å¡é¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ</li>
<li><strong>ç³»ç»Ÿç¨³å®šæ€§</strong>ï¼šå†…å­˜ä¸è¶³å¯èƒ½å¯¼è‡´åº”ç”¨è¢«ç³»ç»Ÿæ€æ­»</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GarbageCollectionExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createObjects</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// åˆ›å»ºå¯¹è±¡</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
        
        <span class="hljs-comment">// obj1å’Œobj2ä¸å†è¢«å¼•ç”¨åï¼ŒGCä¼šè‡ªåŠ¨å›æ”¶å®ƒä»¬å ç”¨çš„å†…å­˜</span>
        <span class="hljs-comment">// å¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾</span>
    }
}
</code></pre>
<h4 data-id="heading-3">1.2 å¦‚ä½•åˆ¤æ–­å¯¹è±¡å·²æ­»ï¼ˆå“ªäº›å¯¹è±¡å¯ä»¥è¢«å›æ”¶ï¼‰</h4>
<p><strong>æ ¸å¿ƒé—®é¢˜ï¼š</strong> GCéœ€è¦çŸ¥é“å“ªäº›å¯¹è±¡æ˜¯"åƒåœ¾"ï¼ˆä¸å†ä½¿ç”¨ï¼‰ï¼Œå“ªäº›å¯¹è±¡è¿˜åœ¨ä½¿ç”¨ã€‚</p>
<h5 data-id="heading-4">1.2.1 å¼•ç”¨è®¡æ•°ç®—æ³•ï¼ˆAndroidä¸ä½¿ç”¨ï¼Œäº†è§£å³å¯ï¼‰</h5>
<p><strong>åŸç†ï¼š</strong></p>
<p>æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œå½“å¯¹è±¡è¢«å¼•ç”¨æ—¶è®¡æ•°å™¨+1ï¼Œå–æ¶ˆå¼•ç”¨æ—¶è®¡æ•°å™¨-1ã€‚å½“è®¡æ•°å™¨ä¸º0æ—¶ï¼Œå¯¹è±¡å¯ä»¥è¢«å›æ”¶ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¼•ç”¨è®¡æ•° = 1</span>
<span class="hljs-type">Object</span> <span class="hljs-variable">ref</span> <span class="hljs-operator">=</span> obj;           <span class="hljs-comment">// å¼•ç”¨è®¡æ•° = 2</span>
obj = <span class="hljs-literal">null</span>;                 <span class="hljs-comment">// å¼•ç”¨è®¡æ•° = 1</span>
ref = <span class="hljs-literal">null</span>;                 <span class="hljs-comment">// å¼•ç”¨è®¡æ•° = 0ï¼Œå¯¹è±¡å¯ä»¥è¢«å›æ”¶</span>
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>å®ç°ç®€å•</li>
<li>å›æ”¶åŠæ—¶ï¼Œå¯¹è±¡ä¸å†è¢«å¼•ç”¨æ—¶ç«‹å³å›æ”¶</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨</strong>ï¼šä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œå¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¸º0ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>å¾ªç¯å¼•ç”¨ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    Node next;
}

<span class="hljs-type">Node</span> <span class="hljs-variable">node1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
<span class="hljs-type">Node</span> <span class="hljs-variable">node2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
node1.next = node2;  <span class="hljs-comment">// node1å¼•ç”¨node2</span>
node2.next = node1;  <span class="hljs-comment">// node2å¼•ç”¨node1</span>

<span class="hljs-comment">// å³ä½¿node1å’Œnode2éƒ½ä¸å†è¢«å¤–éƒ¨å¼•ç”¨</span>
<span class="hljs-comment">// å®ƒä»¬çš„å¼•ç”¨è®¡æ•°éƒ½æ˜¯1ï¼ˆç›¸äº’å¼•ç”¨ï¼‰ï¼Œæ— æ³•è¢«å›æ”¶</span>
<span class="hljs-comment">// è¿™å°±æ˜¯å†…å­˜æ³„æ¼</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆAndroidä¸ç”¨ï¼š</strong></p>
<p>Androidä¸ä½¿ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Œå› ä¸ºæ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨ï¼Œä¼šå¯¼è‡´å†…å­˜æ³„æ¼ã€‚Androidä½¿ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•ã€‚</p>
<h5 data-id="heading-5">1.2.2 å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆAndroidä½¿ç”¨è¿™ä¸ªï¼‰</h5>
<p><strong>åŸç†ï¼š</strong></p>
<p>ä»ä¸€ç»„ç§°ä¸º"GC Roots"çš„å¯¹è±¡å¼€å§‹ï¼Œå‘ä¸‹æœç´¢ï¼Œæ‰€æœ‰èƒ½å¤Ÿä»GC Rootsåˆ°è¾¾çš„å¯¹è±¡éƒ½æ˜¯"å­˜æ´»"çš„ï¼Œæ— æ³•åˆ°è¾¾çš„å¯¹è±¡å°±æ˜¯"åƒåœ¾"ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚</p>
<p><strong>ç®—æ³•æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ä»GC Rootså¼€å§‹
<span class="hljs-bullet">2.</span> æ ‡è®°æ‰€æœ‰èƒ½åˆ°è¾¾çš„å¯¹è±¡ï¼ˆå­˜æ´»å¯¹è±¡ï¼‰
<span class="hljs-bullet">3.</span> æœªæ ‡è®°çš„å¯¹è±¡å°±æ˜¯åƒåœ¾ï¼Œå¯ä»¥è¢«å›æ”¶
</code></pre>
<p><strong>GC Rootså¯¹è±¡æœ‰å“ªäº›ï¼ˆAndroidåœºæ™¯ï¼‰ï¼š</strong></p>
<ol>
<li><strong>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</strong>
<ul>
<li>å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°</li>
<li>ç¤ºä¾‹ï¼šæ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">method</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// objåœ¨æ ˆä¸­ï¼Œå¼•ç”¨çš„å¯¹è±¡æ˜¯GC Root</span>
    <span class="hljs-comment">// objå¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶</span>
}
</code></pre>
<ol start="2">
<li><strong>æ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</strong>
<ul>
<li>staticå˜é‡</li>
<li>ç¤ºä¾‹ï¼šç±»çš„é™æ€å˜é‡</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Object</span> <span class="hljs-variable">staticObj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// staticObjæ˜¯GC Root</span>
    <span class="hljs-comment">// staticObjå¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶</span>
}
</code></pre>
<ol start="3">
<li><strong>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</strong>
<ul>
<li>å¸¸é‡</li>
<li>ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²å¸¸é‡</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CONSTANT</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;  <span class="hljs-comment">// CONSTANTæ˜¯GC Root</span>
}
</code></pre>
<ol start="4">
<li>
<p><strong>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</strong></p>
<ul>
<li>Nativeæ–¹æ³•ä¸­çš„å¼•ç”¨</li>
<li>ç¤ºä¾‹ï¼šJNIè°ƒç”¨ä¸­çš„å¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡</strong></p>
<ul>
<li>synchronizedæŒæœ‰çš„å¯¹è±¡</li>
<li>ç¤ºä¾‹ï¼šé”å¯¹è±¡</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
<span class="hljs-keyword">synchronized</span> (lock) {
    <span class="hljs-comment">// lockæ˜¯GC Rootï¼Œä¸ä¼šè¢«å›æ”¶</span>
}
</code></pre>
<ol start="6">
<li><strong>å†…éƒ¨å¼•ç”¨</strong>
<ul>
<li>Classå¯¹è±¡ã€å¼‚å¸¸å¯¹è±¡ç­‰</li>
<li>ç¤ºä¾‹ï¼šç±»çš„Classå¯¹è±¡</li>
</ul>
</li>
</ol>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>èƒ½å¤„ç†å¾ªç¯å¼•ç”¨ï¼Œå‡†ç¡®åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯å›æ”¶</li>
<li>ä¸ä¼šå› ä¸ºå¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>éœ€è¦æš‚åœåº”ç”¨ï¼ˆSTW - Stop The Worldï¼‰ï¼Œä½†Androidä¼˜åŒ–äº†è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨å¹¶å‘å›æ”¶å‡å°‘æš‚åœæ—¶é—´</li>
</ul>
<p><strong>å¾ªç¯å¼•ç”¨ç¤ºä¾‹ï¼ˆå¯è¾¾æ€§åˆ†æå¯ä»¥å¤„ç†ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    Node next;
}

<span class="hljs-type">Node</span> <span class="hljs-variable">node1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
<span class="hljs-type">Node</span> <span class="hljs-variable">node2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
node1.next = node2;
node2.next = node1;

<span class="hljs-comment">// å¦‚æœnode1å’Œnode2éƒ½ä¸å†è¢«GC Rootså¼•ç”¨</span>
<span class="hljs-comment">// å³ä½¿å®ƒä»¬ç›¸äº’å¼•ç”¨ï¼Œä¹Ÿæ— æ³•ä»GC Rootsåˆ°è¾¾</span>
<span class="hljs-comment">// æ‰€ä»¥å®ƒä»¬éƒ½æ˜¯åƒåœ¾ï¼Œå¯ä»¥è¢«å›æ”¶</span>
</code></pre>
<h5 data-id="heading-6">1.2.3 å¼•ç”¨ç±»å‹ï¼ˆAndroidå¼€å‘ä¸­å¸¸ç”¨ï¼‰</h5>
<p><strong>1. å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰</strong></p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æœ€å¸¸è§çš„å¼•ç”¨ç±»å‹</li>
<li>åªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«GCå›æ”¶</li>
<li>å³ä½¿å†…å­˜ä¸è¶³ï¼Œä¹Ÿä¸ä¼šå›æ”¶</li>
</ul>
<p><strong>Androidä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>æ™®é€šå¯¹è±¡å¼•ç”¨</li>
<li>Activityå¼•ç”¨</li>
<li>å¤§éƒ¨åˆ†å¯¹è±¡éƒ½æ˜¯å¼ºå¼•ç”¨</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¼ºå¼•ç”¨</span>
<span class="hljs-comment">// objå¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ï¼Œé™¤éobj = null</span>
</code></pre>
<p><strong>2. è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰</strong></p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>å†…å­˜ä¸è¶³æ—¶æ‰å›æ”¶</li>
<li>é€‚åˆç¼“å­˜åœºæ™¯</li>
<li>å¯ä»¥é…åˆå¼•ç”¨é˜Ÿåˆ—ä½¿ç”¨</li>
</ul>
<p><strong>Androidä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>Androidä¸æ¨èä½¿ç”¨è½¯å¼•ç”¨</li>
<li>å› ä¸ºAndroidè®¾å¤‡å†…å­˜æœ‰é™ï¼Œè½¯å¼•ç”¨å¯èƒ½å¾ˆå¿«è¢«å›æ”¶</li>
<li>å»ºè®®ä½¿ç”¨LruCacheç­‰æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">SoftReference&lt;Bitmap&gt; softRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SoftReference</span>&lt;&gt;(bitmap);
<span class="hljs-type">Bitmap</span> <span class="hljs-variable">bitmap</span> <span class="hljs-operator">=</span> softRef.get();  <span class="hljs-comment">// å¯èƒ½è¿”å›nullï¼ˆå¦‚æœè¢«å›æ”¶äº†ï¼‰</span>
</code></pre>
<p><strong>3. å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</strong></p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>åªè¦GCå°±ä¼šå›æ”¶ï¼Œä¸ä¼šé˜»æ­¢å¯¹è±¡è¢«å›æ”¶</li>
<li>é€‚åˆé¿å…å†…å­˜æ³„æ¼çš„åœºæ™¯</li>
</ul>
<p><strong>Androidä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é¿å…å†…å­˜æ³„æ¼ï¼ˆHandlerã€é™æ€å˜é‡æŒæœ‰å¯¹è±¡æ—¶ï¼‰</li>
<li>ç¼“å­˜åœºæ™¯ï¼ˆWeakHashMapï¼‰</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é¿å…Handlerå†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> {
    <span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
    
    MyHandler(Activity activity) {
        activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> {
        <span class="hljs-type">Activity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> activityRef.get();
        <span class="hljs-keyword">if</span> (activity != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// ä½¿ç”¨activity</span>
        }
    }
}
</code></pre>
<p><strong>4. è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰</strong></p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æœ€å¼±çš„å¼•ç”¨ç±»å‹</li>
<li>ä¸»è¦ç”¨äºå¯¹è±¡å›æ”¶å‰çš„æ¸…ç†å·¥ä½œ</li>
<li>æ— æ³•é€šè¿‡è™šå¼•ç”¨è·å–å¯¹è±¡</li>
</ul>
<p><strong>Androidä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å¾ˆå°‘ä½¿ç”¨</li>
<li>ä¸»è¦ç”¨äºç‰¹æ®Šåœºæ™¯ï¼ˆå¦‚ç›´æ¥å†…å­˜çš„æ¸…ç†ï¼‰</li>
</ul>
<h4 data-id="heading-7">1.3 Androidä¸­çš„å¯¹è±¡å›æ”¶</h4>
<p><strong>å †å†…å­˜å›æ”¶ï¼š</strong></p>
<ul>
<li>ä¸»è¦å›æ”¶åŒºåŸŸ</li>
<li>å›æ”¶å¯¹è±¡å®ä¾‹ï¼ˆé€šè¿‡newåˆ›å»ºçš„å¯¹è±¡ï¼‰</li>
<li>è¿™æ˜¯GCçš„ä¸»è¦å·¥ä½œ</li>
</ul>
<p><strong>æ–¹æ³•åŒºå›æ”¶ï¼š</strong></p>
<ul>
<li>å›æ”¶ç±»ä¿¡æ¯ã€å¸¸é‡ç­‰</li>
<li>Androidä¸­è¾ƒå°‘ï¼Œå› ä¸ºç±»ä¿¡æ¯é€šå¸¸ä¸ä¼šé¢‘ç¹å˜åŒ–</li>
</ul>
<p><strong>å›æ”¶æ—¶æœºï¼š</strong></p>
<ul>
<li>ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­ï¼Œå¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨è§¦å‘</li>
<li>ä¸å»ºè®®è°ƒç”¨System.gc()ï¼Œå› ä¸ºä¼šå¼ºåˆ¶è§¦å‘Full GCï¼Œå¯èƒ½å¯¼è‡´å¡é¡¿</li>
</ul>
<hr/>
<h2 data-id="heading-8">ç¬¬äºŒéƒ¨åˆ†ï¼šåƒåœ¾å›æ”¶ç®—æ³•ï¼ˆAndroid ARTä½¿ç”¨çš„ç®—æ³•ï¼‰</h2>
<p><strong>è¯´æ˜ï¼šè¿™éƒ¨åˆ†ä»‹ç»GCç®—æ³•çš„åŸºæœ¬åŸç†ï¼ŒAndroid ARTä¸»è¦ä½¿ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•</strong></p>
<h3 data-id="heading-9">2. åƒåœ¾å›æ”¶ç®—æ³•</h3>
<h4 data-id="heading-10">2.1 æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰</h4>
<p><strong>ç®—æ³•åŸç†ï¼š</strong></p>
<p>åˆ†ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>æ ‡è®°é˜¶æ®µ</strong>ï¼šä»GC Rootså¼€å§‹ï¼Œæ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡</li>
<li><strong>æ¸…é™¤é˜¶æ®µ</strong>ï¼šæ¸…é™¤æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡</li>
</ol>
<p><strong>ç®—æ³•æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ä»GC Rootså¼€å§‹éå†
<span class="hljs-bullet">2.</span> æ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡ï¼ˆå­˜æ´»å¯¹è±¡ï¼‰
<span class="hljs-bullet">3.</span> æ¸…é™¤æ‰€æœ‰æœªæ ‡è®°çš„å¯¹è±¡ï¼ˆåƒåœ¾å¯¹è±¡ï¼‰
</code></pre>
<p><strong>å›¾ç¤ºï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">æ ‡è®°å‰ï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[å¯¹è±¡4]</span><span class="hljs-selector-attr">[å¯¹è±¡5]</span>
  âœ“      âœ—      âœ“      âœ—      âœ“
 å­˜æ´»   åƒåœ¾    å­˜æ´»   åƒåœ¾    å­˜æ´»

æ¸…é™¤åï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡5]</span>
  âœ“            âœ“            âœ“
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>å®ç°ç®€å•</li>
<li>ä¸éœ€è¦ç§»åŠ¨å¯¹è±¡</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><strong>äº§ç”Ÿå†…å­˜ç¢ç‰‡</strong>ï¼šæ¸…é™¤åç•™ä¸‹ä¸è¿ç»­çš„å†…å­˜ç©ºé—´</li>
<li>æ•ˆç‡è¾ƒä½ï¼šéœ€è¦ä¸¤æ¬¡éå†ï¼ˆæ ‡è®°å’Œæ¸…é™¤ï¼‰</li>
</ul>
<p><strong>Androidä¸­çš„ä½¿ç”¨ï¼š</strong></p>
<ul>
<li>Androidä¸ä¸»è¦ä½¿ç”¨è¿™ä¸ªç®—æ³•</li>
<li>å› ä¸ºä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå½±å“åç»­å†…å­˜åˆ†é…æ•ˆç‡</li>
</ul>
<h4 data-id="heading-11">2.2 æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼ˆMark-Copyï¼‰- <strong>Androidä¸»è¦ä½¿ç”¨è¿™ä¸ª</strong></h4>
<p><strong>ç®—æ³•åŸç†ï¼š</strong></p>
<p>å°†å†…å­˜åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨ä¸€å—ã€‚å›æ”¶æ—¶ï¼Œå°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ï¼Œç„¶åæ¸…ç©ºå½“å‰å—ã€‚</p>
<p><strong>ç®—æ³•æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-number">1</span>. å°†å†…å­˜åˆ†ä¸º<span class="hljs-selector-tag">From</span>åŒºå’Œ<span class="hljs-selector-tag">To</span>åŒº
<span class="hljs-number">2</span>. å¯¹è±¡åˆ†é…åœ¨<span class="hljs-selector-tag">From</span>åŒº
<span class="hljs-number">3</span>. å›æ”¶æ—¶ï¼š
   - æ ‡è®°<span class="hljs-selector-tag">From</span>åŒºä¸­çš„å­˜æ´»å¯¹è±¡
   - å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°<span class="hljs-selector-tag">To</span>åŒº
   - æ¸…ç©º<span class="hljs-selector-tag">From</span>åŒº
<span class="hljs-number">4</span>. <span class="hljs-selector-tag">From</span>åŒºå’Œ<span class="hljs-selector-tag">To</span>åŒºè§’è‰²äº’æ¢
</code></pre>
<p><strong>å›¾ç¤ºï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">å›æ”¶å‰ï¼š
FromåŒº: <span class="hljs-section">[å¯¹è±¡1]</span><span class="hljs-section">[å¯¹è±¡2]</span><span class="hljs-section">[å¯¹è±¡3]</span><span class="hljs-section">[å¯¹è±¡4]</span>
        å­˜æ´»   åƒåœ¾   å­˜æ´»   åƒåœ¾
ToåŒº:   <span class="hljs-section">[ç©ºé—²]</span><span class="hljs-section">[ç©ºé—²]</span><span class="hljs-section">[ç©ºé—²]</span><span class="hljs-section">[ç©ºé—²]</span>

å›æ”¶åï¼š
FromåŒº: <span class="hljs-section">[ç©ºé—²]</span><span class="hljs-section">[ç©ºé—²]</span><span class="hljs-section">[ç©ºé—²]</span><span class="hljs-section">[ç©ºé—²]</span>
ToåŒº:   <span class="hljs-section">[å¯¹è±¡1]</span><span class="hljs-section">[å¯¹è±¡3]</span>
        å­˜æ´»   å­˜æ´»
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ²¡æœ‰å†…å­˜ç¢ç‰‡</strong>ï¼šå¤åˆ¶åå†…å­˜è¿ç»­</li>
<li>å›æ”¶æ•ˆç‡é«˜ï¼šåªéœ€è¦å¤åˆ¶å­˜æ´»å¯¹è±¡</li>
<li>é€‚åˆå¹´è½»ä»£ï¼šå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼Œå­˜æ´»å¯¹è±¡å°‘</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>æµªè´¹ä¸€åŠå†…å­˜ï¼šéœ€è¦ä¸¤å—å†…å­˜ï¼Œä½†åªä½¿ç”¨ä¸€å—</li>
<li>å¯¹è±¡å­˜æ´»ç‡é«˜æ—¶æ•ˆç‡ä½ï¼šéœ€è¦å¤åˆ¶å¾ˆå¤šå¯¹è±¡</li>
</ul>
<p><strong>Androidä¸­çš„ä½¿ç”¨ï¼š</strong></p>
<ul>
<li><strong>Android ARTä¸»è¦ä½¿ç”¨è¿™ä¸ªç®—æ³•</strong></li>
<li>é€‚åˆå¹´è½»ä»£å›æ”¶ï¼ˆå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼‰</li>
<li>é€šè¿‡ä¼˜åŒ–ï¼Œåªæµªè´¹10%çš„å†…å­˜ï¼ˆè€Œä¸æ˜¯50%ï¼‰</li>
</ul>
<p><strong>æ”¹è¿›ç®—æ³•ï¼ˆAppelå¼å›æ”¶ï¼‰ï¼š</strong></p>
<p>å°†å†…å­˜åˆ†ä¸ºEdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºï¼š</p>
<ul>
<li>EdenåŒºï¼šæ–°å¯¹è±¡åˆ†é…åœ¨è¿™é‡Œ</li>
<li>Survivor0å’ŒSurvivor1ï¼šç”¨äºå­˜æ”¾å­˜æ´»å¯¹è±¡</li>
</ul>
<p><strong>é»˜è®¤æ¯”ä¾‹ï¼š</strong></p>
<ul>
<li>Eden : Survivor0 : Survivor1 = 8 : 1 : 1</li>
<li>åªæµªè´¹10%çš„å†…å­˜ï¼Œè€Œä¸æ˜¯50%</li>
</ul>
<p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ–°å¯¹è±¡åˆ†é…åœ¨EdenåŒº
<span class="hljs-bullet">2.</span> EdenåŒºæ»¡æ—¶ï¼Œè§¦å‘Minor GC
<span class="hljs-bullet">3.</span> å°†EdenåŒºå’ŒSurvivor0ä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°Survivor1
<span class="hljs-bullet">4.</span> æ¸…ç©ºEdenåŒºå’ŒSurvivor0
<span class="hljs-bullet">5.</span> Survivor0å’ŒSurvivor1è§’è‰²äº’æ¢
</code></pre>
<h4 data-id="heading-12">2.3 æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆMark-Compactï¼‰</h4>
<p><strong>ç®—æ³•åŸç†ï¼š</strong></p>
<p>åˆ†ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>æ ‡è®°é˜¶æ®µ</strong>ï¼šæ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡</li>
<li><strong>æ•´ç†é˜¶æ®µ</strong>ï¼šå°†å­˜æ´»å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨</li>
<li><strong>æ¸…é™¤é˜¶æ®µ</strong>ï¼šæ¸…ç†è¾¹ç•Œå¤–çš„å†…å­˜</li>
</ol>
<p><strong>ç®—æ³•æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ ‡è®°æ‰€æœ‰å­˜æ´»å¯¹è±¡
<span class="hljs-bullet">2.</span> å°†å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°ä¸€ç«¯ï¼ˆæ•´ç†ï¼‰
<span class="hljs-bullet">3.</span> æ¸…ç†è¾¹ç•Œå¤–çš„å†…å­˜
</code></pre>
<p><strong>å›¾ç¤ºï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">æ•´ç†å‰ï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span>
  âœ“            âœ“            âœ“

æ•´ç†åï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[ç©ºé—²]</span>
  âœ“      âœ“      âœ“
</code></pre>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ²¡æœ‰å†…å­˜ç¢ç‰‡</strong>ï¼šæ•´ç†åå†…å­˜è¿ç»­</li>
<li><strong>ä¸æµªè´¹å†…å­˜</strong>ï¼šä¸éœ€è¦ä¸¤å—å†…å­˜</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>æ•ˆç‡è¾ƒä½ï¼šéœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œæ›´æ–°æ‰€æœ‰å¼•ç”¨</li>
<li>é€‚åˆè€å¹´ä»£ï¼šå¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œç§»åŠ¨æˆæœ¬ç›¸å¯¹è¾ƒä½</li>
</ul>
<p><strong>Androidä¸­çš„ä½¿ç”¨ï¼š</strong></p>
<ul>
<li>Androidåœ¨æŸäº›åœºæ™¯ä¸‹ä½¿ç”¨</li>
<li>ä¸»è¦ç”¨äºè€å¹´ä»£å›æ”¶ï¼ˆé¿å…å†…å­˜ç¢ç‰‡ï¼‰</li>
</ul>
<h4 data-id="heading-13">2.4 åˆ†ä»£æ”¶é›†ç®—æ³•ï¼ˆAndroidä½¿ç”¨è¿™ä¸ªç­–ç•¥ï¼‰</h4>
<p><strong>ç†è®ºåŸºç¡€ï¼š</strong></p>
<p>æ ¹æ®å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸åŒï¼Œå°†å†…å­˜åˆ†ä¸ºä¸åŒçš„ä»£ï¼š</p>
<ul>
<li><strong>å¤§éƒ¨åˆ†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­</strong>ï¼šåˆ›å»ºåå¾ˆå¿«è¢«å›æ”¶</li>
<li><strong>å°‘æ•°å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¾ˆé•¿</strong>ï¼šé•¿æœŸå­˜æ´»</li>
</ul>
<p><strong>åˆ†ä»£ç­–ç•¥ï¼š</strong></p>
<p><strong>å¹´è½»ä»£ï¼ˆYoung Generationï¼‰ï¼š</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œç”Ÿå‘½å‘¨æœŸçŸ­</li>
<li><strong>å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-å¤åˆ¶ç®—æ³•ï¼ˆå¿«é€Ÿé«˜æ•ˆï¼‰</li>
<li><strong>å›æ”¶é¢‘ç‡</strong>ï¼šé«˜ï¼ˆé¢‘ç¹å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶ç±»å‹</strong>ï¼šPartial GCï¼ˆéƒ¨åˆ†å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶æ—¶é—´</strong>ï¼šçŸ­ï¼ˆå‡ æ¯«ç§’ï¼‰</li>
</ul>
<p><strong>è€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼š</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå­˜æ”¾é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œç”Ÿå‘½å‘¨æœŸé•¿</li>
<li><strong>å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆé¿å…ç¢ç‰‡ï¼‰</li>
<li><strong>å›æ”¶é¢‘ç‡</strong>ï¼šä½ï¼ˆå¶å°”å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶ç±»å‹</strong>ï¼šFull GCï¼ˆå®Œå…¨å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶æ—¶é—´</strong>ï¼šé•¿ï¼ˆå¯èƒ½å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼‰</li>
</ul>
<p><strong>Androidä¸­çš„åˆ†ä»£æ”¶é›†ï¼š</strong></p>
<ol>
<li>
<p><strong>å¹´è½»ä»£ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•</strong></p>
<ul>
<li>å¿«é€Ÿå›æ”¶ï¼Œé€‚åˆé¢‘ç¹å›æ”¶</li>
<li>å¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼Œå¤åˆ¶æˆæœ¬ä½</li>
</ul>
</li>
<li>
<p><strong>è€å¹´ä»£ç”¨æ ‡è®°-æ•´ç†ç®—æ³•</strong></p>
<ul>
<li>é¿å…å†…å­˜ç¢ç‰‡</li>
<li>å¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œç§»åŠ¨æˆæœ¬ç›¸å¯¹è¾ƒä½</li>
</ul>
</li>
<li>
<p><strong>è¿™æ ·è®¾è®¡çš„å¥½å¤„ï¼š</strong></p>
<ul>
<li>æé«˜GCæ•ˆç‡</li>
<li>å‡å°‘GCæš‚åœæ—¶é—´</li>
<li>å‡å°‘å†…å­˜ç¢ç‰‡</li>
</ul>
</li>
</ol>
<p><strong>å¯¹è±¡æ™‹å‡è¿‡ç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ–°å¯¹è±¡ â†’ å¹´è½»ä»£ï¼ˆEdenåŒºï¼‰
<span class="hljs-bullet">2.</span> å¹´è½»ä»£GC â†’ å­˜æ´»å¯¹è±¡ â†’ SurvivoråŒº
<span class="hljs-bullet">3.</span> å¤šæ¬¡GCåä»å­˜æ´» â†’ æ™‹å‡åˆ°è€å¹´ä»£
<span class="hljs-bullet">4.</span> è€å¹´ä»£GC â†’ å›æ”¶é•¿æœŸå­˜æ´»çš„å¯¹è±¡
</code></pre>
<hr/>
<h2 data-id="heading-14">ç¬¬ä¸‰éƒ¨åˆ†ï¼šAndroid ARTåƒåœ¾å›æ”¶å™¨</h2>
<h3 data-id="heading-15">3. Android ARTåƒåœ¾å›æ”¶å™¨ï¼ˆGarbage Collectorï¼‰</h3>
<p><strong>æ ¸å¿ƒè¯´æ˜ï¼šAndroid ARTåªæœ‰ä¸€ç§åƒåœ¾å›æ”¶å™¨ï¼Œå«åš"å¹¶å‘å¤åˆ¶æ”¶é›†å™¨"</strong></p>
<h4 data-id="heading-16">3.1 ARTä¸JVMçš„åŒºåˆ«</h4>
<p><strong>ARTï¼ˆAndroid Runtimeï¼‰ä¸æ˜¯JVMï¼š</strong></p>
<ol>
<li>
<p><strong>ç¼–è¯‘æ–¹å¼ä¸åŒ</strong>ï¼š</p>
<ul>
<li>ARTï¼šAOTç¼–è¯‘ï¼ˆAhead-Of-Timeï¼‰ï¼Œå®‰è£…æ—¶ç¼–è¯‘</li>
<li>JVMï¼šJITç¼–è¯‘ï¼ˆJust-In-Timeï¼‰ï¼Œè¿è¡Œæ—¶ç¼–è¯‘</li>
</ul>
</li>
<li>
<p><strong>GCæœºåˆ¶ä¸åŒ</strong>ï¼š</p>
<ul>
<li>ARTï¼šåªæœ‰ä¸€ç§æ”¶é›†å™¨ï¼ˆå¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼‰</li>
<li>JVMï¼šæœ‰å¤šç§æ”¶é›†å™¨å¯é€‰ï¼ˆSerialã€Parallelã€CMSã€G1ã€ZGCç­‰ï¼‰</li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŒ–æ–¹å‘ä¸åŒ</strong>ï¼š</p>
<ul>
<li>ARTï¼šé’ˆå¯¹ä½å»¶è¿Ÿä¼˜åŒ–ï¼Œé€‚åˆäº¤äº’å¼åº”ç”¨</li>
<li>JVMï¼šæœ‰å¤šç§ä¼˜åŒ–æ–¹å‘ï¼ˆååé‡ã€å»¶è¿Ÿç­‰ï¼‰</li>
</ul>
</li>
</ol>
<p><strong>ARTçš„GCä¸“é—¨ä¸ºAndroidåº”ç”¨ä¼˜åŒ–ï¼š</strong></p>
<ul>
<li>å‡å°‘å¡é¡¿ï¼šä½å»¶è¿Ÿè®¾è®¡</li>
<li>æå‡æµç•…åº¦ï¼šå¹¶å‘å›æ”¶ï¼Œå‡å°‘æš‚åœæ—¶é—´</li>
<li>é€‚åˆäº¤äº’å¼åº”ç”¨ï¼šä¼˜åŒ–ç”¨æˆ·æ»‘åŠ¨ã€ç‚¹å‡»ç­‰æ“ä½œ</li>
</ul>
<h4 data-id="heading-17">3.2 Androidçš„åƒåœ¾å›æ”¶å™¨æ˜¯ä»€ä¹ˆ</h4>
<p><strong>åªæœ‰ä¸€ä¸ªä¸»è¦çš„åƒåœ¾å›æ”¶å™¨ï¼šå¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼ˆConcurrent Copyingï¼Œç®€ç§°CCï¼‰</strong></p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>Androidåªæœ‰è¿™ä¸€ç§æ”¶é›†å™¨</li>
<li>æ²¡æœ‰å¤šç§æ”¶é›†å™¨å¯é€‰ï¼ˆä¸åƒJVMæœ‰Serialã€Parallelã€CMSã€G1ã€ZGCç­‰ï¼‰</li>
<li>Androidå¼€å‘è€…ä¸éœ€è¦é€‰æ‹©æ”¶é›†å™¨ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨è¿™ä¸ªæ”¶é›†å™¨</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆåªæœ‰ä¸€ä¸ªï¼š</strong></p>
<ul>
<li>é’ˆå¯¹Androidåœºæ™¯ä¼˜åŒ–ï¼šä½å»¶è¿Ÿã€äº¤äº’å¼åº”ç”¨</li>
<li>ä¸éœ€è¦å¼€å‘è€…é€‰æ‹©ï¼šç³»ç»Ÿè‡ªåŠ¨ç®¡ç†</li>
<li>ç®€åŒ–å¼€å‘ï¼šå¼€å‘è€…ä¸éœ€è¦äº†è§£å¤šç§æ”¶é›†å™¨çš„åŒºåˆ«</li>
</ul>
<h4 data-id="heading-18">3.3 è¿™ä¸ªåƒåœ¾å›æ”¶å™¨æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼ˆéƒ½æ˜¯åŒä¸€ä¸ªæ”¶é›†å™¨çš„ç‰¹æ€§ï¼Œä¸æ˜¯æ­¥éª¤ï¼Œä¹Ÿä¸æ˜¯ä¸åŒçš„å›æ”¶æ–¹å¼ï¼‰</h4>
<p><strong>è¯´æ˜ï¼šè¿™äº›éƒ½æ˜¯"å¹¶å‘å¤åˆ¶æ”¶é›†å™¨"çš„ç‰¹æ€§ï¼Œå®ƒä»¬åŒæ—¶å‘æŒ¥ä½œç”¨ï¼Œè®©å›æ”¶æ›´é«˜æ•ˆã€æ›´å°‘å¡é¡¿</strong></p>
<h5 data-id="heading-19">3.3.1 åˆ†ä»£å›æ”¶ç­–ç•¥ï¼ˆå›æ”¶ç­–ç•¥ï¼‰</h5>
<p><strong>å†…å­˜åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</strong></p>
<ol>
<li><strong>å¹´è½»ä»£</strong>ï¼šå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼ˆç”Ÿå‘½å‘¨æœŸçŸ­ï¼‰</li>
<li><strong>è€å¹´ä»£</strong>ï¼šå­˜æ”¾é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼ˆç”Ÿå‘½å‘¨æœŸé•¿ï¼‰</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆåˆ†ä»£ï¼Ÿ</strong></p>
<p>å› ä¸ºå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«å°±ä¼šè¢«å›æ”¶ï¼Œåˆ†å¼€å¤„ç†æ›´é«˜æ•ˆï¼š</p>
<ul>
<li>å¹´è½»ä»£ï¼šé¢‘ç¹å›æ”¶ï¼Œç”¨å¿«é€Ÿç®—æ³•ï¼ˆæ ‡è®°-å¤åˆ¶ï¼‰</li>
<li>è€å¹´ä»£ï¼šå¶å°”å›æ”¶ï¼Œç”¨é¿å…ç¢ç‰‡çš„ç®—æ³•ï¼ˆæ ‡è®°-æ•´ç†ï¼‰</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createObjects</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// è¿™äº›å¯¹è±¡åœ¨å¹´è½»ä»£</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
        <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¤§éƒ¨åˆ†å¾ˆå¿«è¢«å›æ”¶</span>
    }
    
    <span class="hljs-comment">// è¿™ä¸ªå¯¹è±¡å¯èƒ½æ™‹å‡åˆ°è€å¹´ä»£</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">longLived</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-comment">// å¦‚æœå¤šæ¬¡GCåä»å­˜æ´»ï¼Œä¼šè¿›å…¥è€å¹´ä»£</span>
}
</code></pre>
<h5 data-id="heading-20">3.3.2 å¹¶å‘å›æ”¶ï¼ˆæ‰§è¡Œæ–¹å¼ï¼‰</h5>
<p><strong>åœ¨åå°çº¿ç¨‹æ‰§è¡Œåƒåœ¾å›æ”¶ï¼š</strong></p>
<ul>
<li>å°½é‡ä¸æš‚åœä¸»çº¿ç¨‹ï¼ˆåº”ç”¨ç»§ç»­è¿è¡Œï¼‰</li>
<li>è¿™æ ·å¯ä»¥å‡å°‘å¡é¡¿</li>
</ul>
<p><strong>å¹¶å‘å›æ”¶çš„ä¼˜åŠ¿ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">ä¼ ç»Ÿå›æ”¶ï¼ˆä¸²è¡Œï¼‰ï¼š
ä¸»çº¿ç¨‹: <span class="hljs-section">[è¿è¡Œ]</span><span class="hljs-section">[æš‚åœGC]</span><span class="hljs-section">[è¿è¡Œ]</span><span class="hljs-section">[æš‚åœGC]</span><span class="hljs-section">[è¿è¡Œ]</span>
         â†“      â†“      â†“      â†“      â†“
        å¡é¡¿   å¡é¡¿   å¡é¡¿   å¡é¡¿   å¡é¡¿

å¹¶å‘å›æ”¶ï¼ˆARTï¼‰ï¼š
ä¸»çº¿ç¨‹: <span class="hljs-section">[è¿è¡Œ]</span><span class="hljs-section">[è¿è¡Œ]</span><span class="hljs-section">[è¿è¡Œ]</span><span class="hljs-section">[è¿è¡Œ]</span><span class="hljs-section">[è¿è¡Œ]</span>
         â†“
        ä¸å¡é¡¿
GCçº¿ç¨‹: <span class="hljs-section">[GC]</span><span class="hljs-section">[GC]</span><span class="hljs-section">[GC]</span>
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·æ»‘åŠ¨åˆ—è¡¨æ—¶</span>
recyclerView.setOnScrollListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RecyclerView</span>.OnScrollListener() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onScrolled</span><span class="hljs-params">(RecyclerView recyclerView, <span class="hljs-type">int</span> dx, <span class="hljs-type">int</span> dy)</span> {
        <span class="hljs-comment">// å³ä½¿æ­¤æ—¶è§¦å‘GCï¼Œä¹Ÿä¸ä¼šå¡é¡¿</span>
        <span class="hljs-comment">// å› ä¸ºGCåœ¨åå°çº¿ç¨‹æ‰§è¡Œ</span>
    }
});
</code></pre>
<h5 data-id="heading-21">3.3.3 å¤åˆ¶ç®—æ³•ï¼ˆå›æ”¶ç®—æ³•ï¼‰</h5>
<p><strong>å›æ”¶æ—¶ï¼šæŠŠå­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°æ–°ä½ç½®</strong>
<strong>ç„¶åï¼šç›´æ¥æ¸…ç©ºæ—§ä½ç½®</strong></p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>ç®€å•é«˜æ•ˆ</li>
<li>æ²¡æœ‰å†…å­˜ç¢ç‰‡</li>
</ul>
<p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ ‡è®°å­˜æ´»å¯¹è±¡
<span class="hljs-bullet">2.</span> å¤åˆ¶åˆ°æ–°ä½ç½®
<span class="hljs-bullet">3.</span> æ¸…ç©ºæ—§ä½ç½®
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">å›æ”¶å‰ï¼ˆ<span class="hljs-selector-tag">From</span>åŒºï¼‰ï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[å¯¹è±¡4]</span>
 å­˜æ´»   åƒåœ¾   å­˜æ´»   åƒåœ¾

å›æ”¶åï¼ˆ<span class="hljs-selector-tag">To</span>åŒºï¼‰ï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span>
 å­˜æ´»   å­˜æ´»
</code></pre>
<h5 data-id="heading-22">3.3.4 å¢é‡å›æ”¶ï¼ˆä¼˜åŒ–ç‰¹æ€§ï¼‰</h5>
<p><strong>æŠŠå¤§é‡çš„å›æ”¶å·¥ä½œåˆ†æˆå°ä»½</strong>
<strong>åˆ†æ‰¹æ‰§è¡Œï¼Œæ¯æ¬¡åªåšä¸€ç‚¹ç‚¹</strong>
<strong>é¿å…ä¸€æ¬¡æ€§å¡é¡¿å¤ªä¹…</strong></p>
<p><strong>å¢é‡å›æ”¶çš„ä¼˜åŠ¿ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">ä¼ ç»Ÿå›æ”¶ï¼š
<span class="hljs-selector-attr">[ä¸€æ¬¡æ€§å›æ”¶æ‰€æœ‰å¯¹è±¡]</span>
æš‚åœæ—¶é—´ï¼š<span class="hljs-number">50ms</span>
ç”¨æˆ·æ„Ÿè§‰ï¼šæ˜æ˜¾å¡é¡¿

å¢é‡å›æ”¶ï¼š
<span class="hljs-selector-attr">[å›æ”¶ä¸€ç‚¹]</span><span class="hljs-selector-attr">[å›æ”¶ä¸€ç‚¹]</span><span class="hljs-selector-attr">[å›æ”¶ä¸€ç‚¹]</span>
æ¯æ¬¡æš‚åœï¼š<span class="hljs-number">5ms</span>
ç”¨æˆ·æ„Ÿè§‰ï¼šå‡ ä¹æ„Ÿè§‰ä¸åˆ°
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·æ“ä½œæ—¶ï¼ŒGCä¸ä¼šä¸€æ¬¡æ€§æš‚åœå¤ªä¹…</span>
<span class="hljs-comment">// è€Œæ˜¯åˆ†æˆå¤šæ¬¡ï¼Œæ¯æ¬¡æš‚åœå¾ˆçŸ­æ—¶é—´</span>
button.setOnClickListener(v -&gt; {
    <span class="hljs-comment">// å³ä½¿æ­¤æ—¶GCï¼Œä¹Ÿä¸ä¼šæ˜æ˜¾å¡é¡¿</span>
    <span class="hljs-comment">// å› ä¸ºGCæ˜¯å¢é‡æ‰§è¡Œçš„</span>
});
</code></pre>
<h5 data-id="heading-23">3.3.5 å‹ç¼©å›æ”¶ï¼ˆä¼˜åŒ–ç‰¹æ€§ï¼‰</h5>
<p><strong>å›æ”¶åæ•´ç†å†…å­˜</strong>
<strong>æŠŠåˆ†æ•£çš„å†…å­˜ç¢ç‰‡åˆå¹¶æˆè¿ç»­ç©ºé—´</strong>
<strong>é¿å…å†…å­˜æµªè´¹ï¼Œæ–¹ä¾¿åç»­åˆ†é…</strong></p>
<p><strong>å‹ç¼©å›æ”¶çš„ä¼˜åŠ¿ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">å‹ç¼©å‰ï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span>
å†…å­˜ç¢ç‰‡å¤šï¼Œåˆ†é…æ•ˆç‡ä½

å‹ç¼©åï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[ç©ºé—²]</span>
å†…å­˜è¿ç»­ï¼Œåˆ†é…æ•ˆç‡é«˜
</code></pre>
<p><strong>æ€»ç»“ï¼šè¿™äº›éƒ½æ˜¯"å¹¶å‘å¤åˆ¶æ”¶é›†å™¨"çš„ç‰¹æ€§ï¼Œå®ƒä»¬åŒæ—¶å‘æŒ¥ä½œç”¨ï¼Œè®©å›æ”¶æ›´é«˜æ•ˆã€æ›´å°‘å¡é¡¿</strong></p>
<h4 data-id="heading-24">3.4 Android GCçš„è®¾è®¡ç›®æ ‡</h4>
<p><strong>ä½å»¶è¿Ÿ</strong>ï¼šå°½é‡å‡å°‘GCå¯¼è‡´çš„å¡é¡¿
<strong>å¹¶å‘å¤„ç†</strong>ï¼šå°½é‡åœ¨åå°æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹
<strong>é€‚åˆäº¤äº’å¼åº”ç”¨</strong>ï¼šä¼˜åŒ–ç”¨æˆ·æ»‘åŠ¨ã€ç‚¹å‡»ç­‰æ“ä½œçš„æµç•…åº¦</p>
<h4 data-id="heading-25">3.4 ART GCçš„è§¦å‘æ¡ä»¶ï¼ˆä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘åƒåœ¾å›æ”¶ï¼‰</h4>
<p><strong>è¯´æ˜ï¼šè§¦å‘æ¡ä»¶å°±æ˜¯"ä»€ä¹ˆæƒ…å†µä¸‹ç³»ç»Ÿä¼šè‡ªåŠ¨å¼€å§‹æ¸…ç†åƒåœ¾"</strong></p>
<h4 data-id="heading-26">3.4.1 Partial GCï¼ˆéƒ¨åˆ†å›æ”¶ï¼‰çš„è§¦å‘æ¡ä»¶</h4>
<p><strong>ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼šå¹´è½»ä»£ç©ºé—´æ»¡äº†</strong></p>
<p><strong>å…·ä½“åœºæ™¯ï¼š</strong></p>
<ul>
<li>ä½ åˆ›å»ºäº†å¾ˆå¤šæ–°å¯¹è±¡ï¼Œå¹´è½»ä»£å†…å­˜å¿«ç”¨å®Œäº†</li>
<li>ç³»ç»Ÿæ£€æµ‹åˆ°å¹´è½»ä»£ç©ºé—´ä¸è¶³ï¼Œè‡ªåŠ¨è§¦å‘Partial GC</li>
<li>åªæ¸…ç†å¹´è½»ä»£ï¼Œä¸æ¸…ç†è€å¹´ä»£</li>
</ul>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>è§¦å‘å¿«ï¼Œæ‰§è¡Œå¿«</li>
<li>æš‚åœæ—¶é—´çŸ­ï¼ˆå‡ æ¯«ç§’ï¼‰</li>
<li>å¯¹åº”ç”¨å½±å“å°ï¼Œç”¨æˆ·åŸºæœ¬æ„Ÿè§‰ä¸åˆ°</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createManyObjects</span><span class="hljs-params">()</span> {
    List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
        list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());  <span class="hljs-comment">// åˆ›å»ºå¤§é‡å¯¹è±¡</span>
        <span class="hljs-comment">// å½“å¹´è½»ä»£å¿«æ»¡æ—¶ï¼Œè§¦å‘Partial GC</span>
    }
}
</code></pre>
<h4 data-id="heading-27">3.4.2 Full GCï¼ˆå®Œå…¨å›æ”¶ï¼‰çš„è§¦å‘æ¡ä»¶</h4>
<p><strong>ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼šæ•´ä¸ªå †å†…å­˜ä¸è¶³</strong></p>
<p><strong>å…·ä½“åœºæ™¯ï¼š</strong></p>
<ul>
<li>è€å¹´ä»£ç©ºé—´æ»¡äº†</li>
<li>å †å†…å­˜æ•´ä½“ä¸è¶³ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡</li>
<li>æ˜¾å¼è°ƒç”¨System.gc()ï¼ˆAndroidä¸æ¨èï¼Œå› ä¸ºä¼šå¼ºåˆ¶è§¦å‘Full GCï¼‰</li>
</ul>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æ‰§è¡Œæ…¢ï¼Œæš‚åœæ—¶é—´é•¿ï¼ˆå¯èƒ½å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼‰</li>
<li>ä¼šæ¸…ç†æ•´ä¸ªå †ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰</li>
<li>å¯èƒ½å¯¼è‡´åº”ç”¨å¡é¡¿ï¼Œç”¨æˆ·èƒ½æ„Ÿè§‰åˆ°</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸æ¨èï¼šä¼šå¼ºåˆ¶è§¦å‘Full GC</span>
System.gc();  <span class="hljs-comment">// Androidä¸æ¨èä½¿ç”¨</span>

<span class="hljs-comment">// åº”è¯¥è®©ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†</span>
<span class="hljs-comment">// é€šè¿‡ä¼˜åŒ–ä»£ç ï¼Œå‡å°‘Full GCçš„è§¦å‘</span>
</code></pre>
<h4 data-id="heading-28">3.4.3 Sticky GCï¼ˆç²˜æ€§å›æ”¶ï¼‰çš„è§¦å‘æ¡ä»¶</h4>
<p><strong>ä»€ä¹ˆæ—¶å€™è§¦å‘ï¼šé¢‘ç¹åˆ›å»ºçŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡æ—¶</strong></p>
<p><strong>å…·ä½“åœºæ™¯ï¼š</strong></p>
<ul>
<li>åˆ—è¡¨å¿«é€Ÿæ»‘åŠ¨æ—¶ï¼ˆRecyclerViewæ»šåŠ¨ï¼‰</li>
<li>åŠ¨ç”»æ’­æ”¾æ—¶ï¼ˆä¸æ–­åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼‰</li>
<li>UIæ¸²æŸ“æ—¶ï¼ˆé¢‘ç¹åˆ›å»ºViewç›¸å…³å¯¹è±¡ï¼‰</li>
</ul>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>åªæ¸…ç†åˆšåˆšåˆ›å»ºçš„æ–°å¯¹è±¡</li>
<li>éå¸¸å¿«é€Ÿï¼Œå‡ ä¹æ„Ÿè§‰ä¸åˆ°</li>
<li>ä¸“é—¨ä¼˜åŒ–é¢‘ç¹åˆ†é…å¯¹è±¡çš„åœºæ™¯</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">recyclerView.addOnScrollListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RecyclerView</span>.OnScrollListener() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onScrolled</span><span class="hljs-params">(RecyclerView recyclerView, <span class="hljs-type">int</span> dx, <span class="hljs-type">int</span> dy)</span> {
        <span class="hljs-comment">// æ»‘åŠ¨æ—¶é¢‘ç¹åˆ›å»ºå¯¹è±¡</span>
        <span class="hljs-comment">// è§¦å‘Sticky GCï¼Œå¿«é€Ÿæ¸…ç†</span>
    }
});
</code></pre>
<h4 data-id="heading-29">3.4.4 å¦‚ä½•æŸ¥çœ‹å’Œé¢„é˜²GC</h4>
<p><strong>æŸ¥çœ‹GCæ—¥å¿—ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨logcatæŸ¥çœ‹GCäº‹ä»¶</li>
<li>ä½¿ç”¨Android Studio Profilerç›‘æ§GC</li>
<li>ä½¿ç”¨Systraceåˆ†æGCå¯¹æ€§èƒ½çš„å½±å“</li>
</ul>
<p><strong>é¢„é˜²é¢‘ç¹GCï¼š</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ†é…ï¼ˆå¤ç”¨å¯¹è±¡ã€ä½¿ç”¨å¯¹è±¡æ± ï¼‰</li>
<li>åˆç†ä½¿ç”¨ç¼“å­˜ï¼ˆåŠæ—¶æ¸…ç†ä¸éœ€è¦çš„ç¼“å­˜ï¼‰</li>
<li>é¿å…å†…å­˜æ³„æ¼ï¼ˆæ­£ç¡®é‡Šæ”¾èµ„æºï¼‰</li>
</ul>
<h4 data-id="heading-30">3.5 ARTå†…å­˜åˆ†é…ç­–ç•¥ï¼ˆå¯¹è±¡åœ¨å†…å­˜ä¸­æ˜¯æ€ä¹ˆåˆ†é…çš„ï¼‰</h4>
<p><strong>è¯´æ˜ï¼šåˆ†é…ç­–ç•¥å°±æ˜¯"æ–°åˆ›å»ºçš„å¯¹è±¡æ”¾åœ¨å†…å­˜çš„å“ªä¸ªä½ç½®"</strong></p>
<h4 data-id="heading-31">3.5.1 æ–°å¯¹è±¡ä¼˜å…ˆåœ¨å¹´è½»ä»£åˆ†é…</h4>
<p><strong>åˆ†é…è§„åˆ™ï¼šæ–°åˆ›å»ºçš„å¯¹è±¡å…ˆæ”¾åœ¨å¹´è½»ä»£</strong></p>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼š</strong></p>
<ul>
<li>å¤§éƒ¨åˆ†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­ï¼Œå¾ˆå¿«å°±ä¼šè¢«å›æ”¶</li>
<li>æ”¾åœ¨å¹´è½»ä»£ï¼Œå›æ”¶å¿«ï¼Œæ•ˆç‡é«˜</li>
</ul>
<p><strong>å…·ä½“æµç¨‹ï¼š</strong></p>
<ul>
<li>ä½ å†™ä»£ç ï¼š<code>Object obj = new Object()</code></li>
<li>ç³»ç»Ÿåˆ†é…ï¼šå¯¹è±¡æ”¾åœ¨å¹´è½»ä»£</li>
<li>å¦‚æœå¹´è½»ä»£æ»¡äº†ï¼šè§¦å‘Partial GCï¼Œæ¸…ç†åå†åˆ†é…</li>
</ul>
<p><strong>åˆ†é…å¤±è´¥æ€ä¹ˆåŠï¼š</strong></p>
<ul>
<li>å¦‚æœå¹´è½»ä»£æ»¡äº†ï¼Œå…ˆè§¦å‘Partial GC</li>
<li>GCåå¦‚æœè¿˜æ˜¯ä¸å¤Ÿï¼Œå¯èƒ½è§¦å‘Full GC</li>
<li>å¦‚æœFull GCåè¿˜æ˜¯ä¸å¤Ÿï¼Œå¯èƒ½æŠ›å‡ºOutOfMemoryError</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">allocateObjects</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// æ–°å¯¹è±¡åˆ†é…åœ¨å¹´è½»ä»£</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¹´è½»ä»£</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¹´è½»ä»£</span>
    
    <span class="hljs-comment">// å¦‚æœå¹´è½»ä»£æ»¡äº†ï¼Œè§¦å‘Partial GC</span>
    <span class="hljs-comment">// GCåç»§ç»­åˆ†é…</span>
}
</code></pre>
<h4 data-id="heading-32">3.5.2 å¤§å¯¹è±¡çš„å¤„ç†</h4>
<p><strong>ä»€ä¹ˆæ˜¯å¤§å¯¹è±¡ï¼š</strong></p>
<ul>
<li>å ç”¨å†…å­˜å¾ˆå¤§çš„å¯¹è±¡ï¼ˆæ¯”å¦‚å¤§å›¾ç‰‡ã€å¤§æ•°ç»„ï¼‰</li>
<li>Androidåœºæ™¯ï¼šBitmapã€å¤§æ•°ç»„ç­‰</li>
</ul>
<p><strong>å¤§å¯¹è±¡æ€ä¹ˆåˆ†é…ï¼š</strong></p>
<ul>
<li>å¦‚æœå¯¹è±¡å¤ªå¤§ï¼Œå¯èƒ½ç›´æ¥æ”¾åœ¨è€å¹´ä»£</li>
<li>é¿å…åœ¨å¹´è½»ä»£ä¹‹é—´å¤åˆ¶å¤§å¯¹è±¡ï¼ˆå¤åˆ¶æˆæœ¬é«˜ï¼‰</li>
</ul>
<p><strong>å¤§å¯¹è±¡å¯¹GCçš„å½±å“ï¼š</strong></p>
<ul>
<li>å¤§å¯¹è±¡å ç”¨å†…å­˜å¤šï¼Œå®¹æ˜“å¯¼è‡´å†…å­˜ä¸è¶³</li>
<li>å¤§å¯¹è±¡å›æ”¶æ…¢ï¼Œå¯èƒ½å½±å“GCæ€§èƒ½</li>
<li>å»ºè®®ï¼šåŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡ï¼Œé¿å…å†…å­˜å‹åŠ›</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¤§å¯¹è±¡å¯èƒ½ç›´æ¥è¿›å…¥è€å¹´ä»£</span>
<span class="hljs-type">Bitmap</span> <span class="hljs-variable">largeBitmap</span> <span class="hljs-operator">=</span> Bitmap.createBitmap(<span class="hljs-number">4000</span>, <span class="hljs-number">4000</span>, Bitmap.Config.ARGB_8888);
<span class="hljs-comment">// è¿™ä¸ªBitmapå¾ˆå¤§ï¼Œå¯èƒ½ç›´æ¥æ”¾åœ¨è€å¹´ä»£</span>

<span class="hljs-comment">// å»ºè®®ï¼šåŠæ—¶é‡Šæ”¾</span>
largeBitmap.recycle();
largeBitmap = <span class="hljs-literal">null</span>;
</code></pre>
<h4 data-id="heading-33">3.5.3 é•¿æœŸå­˜æ´»çš„å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£</h4>
<p><strong>æ™‹å‡è§„åˆ™ï¼šå¯¹è±¡åœ¨å¹´è½»ä»£å­˜æ´»è¶³å¤Ÿä¹…ï¼Œå°±ç§»åˆ°è€å¹´ä»£</strong></p>
<p><strong>å¹´é¾„è®¡æ•°æœºåˆ¶ï¼š</strong></p>
<ul>
<li>æ¯æ¬¡Partial GCåï¼Œå­˜æ´»çš„å¯¹è±¡å¹´é¾„+1</li>
<li>å¹´é¾„è¾¾åˆ°é˜ˆå€¼ï¼ˆæ¯”å¦‚15æ¬¡ï¼‰ï¼Œå°±æ™‹å‡åˆ°è€å¹´ä»£</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦æ™‹å‡ï¼š</strong></p>
<ul>
<li>é•¿æœŸå­˜æ´»çš„å¯¹è±¡æ”¾åœ¨å¹´è½»ä»£ï¼Œæ¯æ¬¡GCéƒ½è¦æ£€æŸ¥ï¼Œæµªè´¹æ•ˆç‡</li>
<li>ç§»åˆ°è€å¹´ä»£ï¼Œå‡å°‘æ£€æŸ¥æ¬¡æ•°ï¼Œæé«˜æ•ˆç‡</li>
</ul>
<p><strong>æ™‹å‡æ—¶æœºï¼š</strong></p>
<ul>
<li>å¯¹è±¡åœ¨å¹´è½»ä»£ç»å†å¤šæ¬¡GCåä»å­˜æ´»</li>
<li>å¹´é¾„è¾¾åˆ°é˜ˆå€¼æ—¶è‡ªåŠ¨æ™‹å‡</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongLivedObject</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addToCache</span><span class="hljs-params">(Object obj)</span> {
        cache.add(obj);  <span class="hljs-comment">// è¿™ä¸ªå¯¹è±¡è¢«cacheå¼•ç”¨ï¼Œé•¿æœŸå­˜æ´»</span>
        <span class="hljs-comment">// ç»è¿‡å¤šæ¬¡GCåï¼Œä¼šæ™‹å‡åˆ°è€å¹´ä»£</span>
    }
}
</code></pre>
<h4 data-id="heading-34">3.5.4 Androidå†…å­˜é™åˆ¶</h4>
<p><strong>ä¸åŒè®¾å¤‡çš„å †å†…å­˜é™åˆ¶ï¼š</strong></p>
<ul>
<li>ä¸åŒAndroidè®¾å¤‡æœ‰ä¸åŒçš„å †å†…å­˜ä¸Šé™</li>
<li>ä½ç«¯è®¾å¤‡å¯èƒ½åªæœ‰å‡ åMB</li>
<li>é«˜ç«¯è®¾å¤‡å¯èƒ½æœ‰å‡ ç™¾MBåˆ°å‡ GB</li>
</ul>
<p><strong>ä½å†…å­˜è®¾å¤‡çš„å¤„ç†ï¼š</strong></p>
<ul>
<li>ç³»ç»Ÿä¼šé™åˆ¶æ¯ä¸ªåº”ç”¨çš„å†…å­˜ä½¿ç”¨</li>
<li>å†…å­˜ä¸è¶³æ—¶ï¼Œç³»ç»Ÿå¯èƒ½æ€æ­»åå°åº”ç”¨</li>
<li>ä½ çš„åº”ç”¨å¯èƒ½æ”¶åˆ°onLowMemory()å›è°ƒ</li>
</ul>
<p><strong>å†…å­˜ä¼˜åŒ–çš„é‡è¦æ€§ï¼š</strong></p>
<ul>
<li>Androidè®¾å¤‡å†…å­˜æœ‰é™ï¼Œå¿…é¡»åˆç†ä½¿ç”¨</li>
<li>å†…å­˜å ç”¨è¿‡é«˜ï¼Œå¯èƒ½å¯¼è‡´åº”ç”¨è¢«ç³»ç»Ÿæ€æ­»</li>
<li>ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œæå‡åº”ç”¨æ€§èƒ½å’Œç¨³å®šæ€§</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLowMemory</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>.onLowMemory();
        <span class="hljs-comment">// ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶è°ƒç”¨</span>
        <span class="hljs-comment">// åº”è¯¥é‡Šæ”¾ä¸å¿…è¦çš„èµ„æº</span>
        clearCache();
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clearCache</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¸…ç†ç¼“å­˜ï¼Œé‡Šæ”¾å†…å­˜</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-35">ç¬¬å››éƒ¨åˆ†ï¼šAndroid GCä¼˜åŒ–ä¸å®è·µ</h2>
<h3 data-id="heading-36">4. Android GCä¼˜åŒ–ï¼ˆå¦‚ä½•å‡å°‘GCï¼Œæå‡æ€§èƒ½ï¼‰</h3>
<h4 data-id="heading-37">4.1 Android GCä¼˜åŒ–çš„ç›®æ ‡</h4>
<p><strong>é™ä½GCæš‚åœæ—¶é—´</strong>ï¼šæœ€é‡è¦ï¼Œå‡å°‘å¡é¡¿
<strong>å‡å°‘å†…å­˜å ç”¨</strong>ï¼šé™ä½å†…å­˜å‹åŠ›
<strong>æå‡åº”ç”¨æµç•…åº¦</strong>ï¼šä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
<strong>é¿å…ANR</strong>ï¼šé˜²æ­¢åº”ç”¨æ— å“åº”</p>
<h4 data-id="heading-38">4.2 Androidå¼€å‘ä¸­çš„GCä¼˜åŒ–ç­–ç•¥</h4>
<h5 data-id="heading-39">4.2.1 å‡å°‘å¯¹è±¡åˆ†é…</h5>
<p><strong>å¯¹è±¡å¤ç”¨ï¼ˆä½¿ç”¨å¯¹è±¡æ± ï¼Œé¿å…é¢‘ç¹åˆ›å»ºï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šé¢‘ç¹åˆ›å»ºå¯¹è±¡</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Hello"</span>);  <span class="hljs-comment">// æ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šå¤ç”¨å¯¹è±¡</span>
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    <span class="hljs-comment">// å¤ç”¨åŒä¸€ä¸ªå¯¹è±¡</span>
}
</code></pre>
<p><strong>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå­—ç¬¦ä¸²æ‹¼æ¥</span>
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
    result += i;  <span class="hljs-comment">// æ¯æ¬¡éƒ½åˆ›å»ºæ–°Stringå¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨StringBuilder</span>
<span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
    sb.append(i);  <span class="hljs-comment">// å¤ç”¨StringBuilder</span>
}
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> sb.toString();
</code></pre>
<p><strong>ä½¿ç”¨åŸºæœ¬ç±»å‹æ›¿ä»£åŒ…è£…ç±»å‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šä½¿ç”¨åŒ…è£…ç±»å‹</span>
List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(i));  <span class="hljs-comment">// åˆ›å»ºIntegerå¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨åŸºæœ¬ç±»å‹æ•°ç»„</span>
<span class="hljs-type">int</span>[] array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">1000</span>];
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    array[i] = i;  <span class="hljs-comment">// ä¸åˆ›å»ºå¯¹è±¡</span>
}
</code></pre>
<h5 data-id="heading-40">4.2.2 åˆç†ä½¿ç”¨ç¼“å­˜</h5>
<p><strong>é¿å…å†…å­˜æ³„æ¼ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šæ— é™åˆ¶ç¼“å­˜</span>
<span class="hljs-keyword">private</span> Map&lt;String, Bitmap&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addToCache</span><span class="hljs-params">(String key, Bitmap bitmap)</span> {
    cache.put(key, bitmap);  <span class="hljs-comment">// å¯èƒ½æ— é™å¢é•¿</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨LruCache</span>
<span class="hljs-keyword">private</span> LruCache&lt;String, Bitmap&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LruCache</span>&lt;&gt;(<span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addToCache</span><span class="hljs-params">(String key, Bitmap bitmap)</span> {
    cache.put(key, bitmap);  <span class="hljs-comment">// è‡ªåŠ¨é™åˆ¶å¤§å°</span>
}
</code></pre>
<p><strong>åŠæ—¶æ¸…ç†ä¸å†ä½¿ç”¨çš„ç¼“å­˜ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-comment">// æ¸…ç†ç¼“å­˜</span>
    cache.clear();
}
</code></pre>
<h5 data-id="heading-41">4.2.3 ä¼˜åŒ–æ•°æ®ç»“æ„</h5>
<p><strong>é€‰æ‹©åˆé€‚çš„é›†åˆç±»ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¦‚æœéœ€è¦éšæœºè®¿é—®ï¼Œç”¨ArrayList</span>
List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();  <span class="hljs-comment">// éšæœºè®¿é—®å¿«</span>

<span class="hljs-comment">// å¦‚æœéœ€è¦é¢‘ç¹æ’å…¥åˆ é™¤ï¼Œç”¨LinkedList</span>
List&lt;String&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();  <span class="hljs-comment">// æ’å…¥åˆ é™¤å¿«</span>
</code></pre>
<p><strong>é¿å…å†…å­˜æµªè´¹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šä¸æ¸…ç†é›†åˆ</span>
List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-comment">// ... ä½¿ç”¨list</span>
<span class="hljs-comment">// listä¸å†ä½¿ç”¨ï¼Œä½†æ²¡æœ‰æ¸…ç†</span>

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåŠæ—¶æ¸…ç†</span>
list.clear();
list = <span class="hljs-literal">null</span>;
</code></pre>
<h5 data-id="heading-42">4.2.4 é¿å…å†…å­˜æ³„æ¼</h5>
<p><strong>æ­£ç¡®å¤„ç†ç”Ÿå‘½å‘¨æœŸï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> Handler handler;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        handler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyHandler</span>(<span class="hljs-built_in">this</span>);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">super</span>.onDestroy();
        <span class="hljs-comment">// æ¸…ç†Handlerï¼Œé¿å…å†…å­˜æ³„æ¼</span>
        handler.removeCallbacksAndMessages(<span class="hljs-literal">null</span>);
        handler = <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>é¿å…æŒæœ‰Activity/Contextçš„å¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šé™æ€å˜é‡æŒæœ‰Activity</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Activity activity;  <span class="hljs-comment">// å¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼</span>

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨Application Context</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Context appContext;  <span class="hljs-comment">// ä½¿ç”¨Application Context</span>
</code></pre>
<p><strong>ä½¿ç”¨å¼±å¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨å¼±å¼•ç”¨é¿å…å†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> {
    <span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
    
    MyHandler(Activity activity) {
        activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);
    }
}
</code></pre>
<h4 data-id="heading-43">4.3 GCä¼˜åŒ–å®è·µåœºæ™¯</h4>
<h5 data-id="heading-44">4.3.1 åˆ—è¡¨æ»‘åŠ¨ä¼˜åŒ–</h5>
<p><strong>RecyclerViewçš„ViewHolderå¤ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecyclerView</span>.Adapter&lt;MyAdapter.ViewHolder&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ViewHolder <span class="hljs-title function_">onCreateViewHolder</span><span class="hljs-params">(ViewGroup parent, <span class="hljs-type">int</span> viewType)</span> {
        <span class="hljs-comment">// ViewHolderå¤ç”¨ï¼Œé¿å…é¢‘ç¹åˆ›å»º</span>
        <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> LayoutInflater.from(parent.getContext())
            .inflate(R.layout.item, parent, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewHolder</span>(view);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
        <span class="hljs-comment">// é¿å…åœ¨è¿™é‡Œåˆ›å»ºæ–°å¯¹è±¡</span>
        <span class="hljs-comment">// å¤ç”¨ViewHolderä¸­çš„View</span>
    }
}
</code></pre>
<p><strong>é¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºæ–°å¯¹è±¡ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
    holder.textView.setText(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Item "</span> + position));  <span class="hljs-comment">// åˆ›å»ºæ–°å¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
    holder.textView.setText(<span class="hljs-string">"Item "</span> + position);  <span class="hljs-comment">// å¤ç”¨å­—ç¬¦ä¸²</span>
}
</code></pre>
<h5 data-id="heading-45">4.3.2 åŠ¨ç”»æ€§èƒ½ä¼˜åŒ–</h5>
<p><strong>å¤ç”¨åŠ¨ç”»å¯¹è±¡ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šæ¯æ¬¡åˆ›å»ºæ–°åŠ¨ç”»</span>
button.setOnClickListener(v -&gt; {
    <span class="hljs-type">ObjectAnimator</span> <span class="hljs-variable">animator</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectAnimator</span>();  <span class="hljs-comment">// æ¯æ¬¡éƒ½åˆ›å»º</span>
    animator.start();
});

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šå¤ç”¨åŠ¨ç”»å¯¹è±¡</span>
<span class="hljs-keyword">private</span> ObjectAnimator animator;

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
    <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
    animator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectAnimator</span>();
}

button.setOnClickListener(v -&gt; {
    animator.start();  <span class="hljs-comment">// å¤ç”¨</span>
});
</code></pre>
<h5 data-id="heading-46">4.3.3 å›¾ç‰‡åŠ è½½ä¼˜åŒ–</h5>
<p><strong>ä½¿ç”¨å›¾ç‰‡ç¼“å­˜ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨Glideç­‰åº“ï¼Œè‡ªåŠ¨ç¼“å­˜</span>
Glide.with(context)
    .load(url)
    .into(imageView);
</code></pre>
<p><strong>åŠæ—¶é‡Šæ”¾ä¸ç”¨çš„Bitmapï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-keyword">if</span> (bitmap != <span class="hljs-literal">null</span>) {
        bitmap.recycle();
        bitmap = <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>é¿å…åŠ è½½è¿‡å¤§çš„å›¾ç‰‡ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åŠ è½½æ—¶å‹ç¼©å›¾ç‰‡</span>
BitmapFactory.<span class="hljs-type">Options</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BitmapFactory</span>.Options();
options.inSampleSize = <span class="hljs-number">2</span>;  <span class="hljs-comment">// å‹ç¼©2å€</span>
<span class="hljs-type">Bitmap</span> <span class="hljs-variable">bitmap</span> <span class="hljs-operator">=</span> BitmapFactory.decodeFile(path, options);
</code></pre>
<h5 data-id="heading-47">4.3.4 å¤§å¯¹è±¡å¤„ç†ä¼˜åŒ–</h5>
<p><strong>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> Bitmap largeBitmap;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadImage</span><span class="hljs-params">()</span> {
    largeBitmap = loadLargeBitmap();
    <span class="hljs-comment">// ä½¿ç”¨å®ŒååŠæ—¶é‡Šæ”¾</span>
    <span class="hljs-keyword">if</span> (largeBitmap != <span class="hljs-literal">null</span>) {
        largeBitmap.recycle();
        largeBitmap = <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h4 data-id="heading-48">4.2 å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰</h4>
<h4 data-id="heading-49">4.2.1 ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼</h4>
<p><strong>å®šä¹‰ï¼š</strong> å¯¹è±¡å·²ç»ä¸å†ä½¿ç”¨ï¼Œä½†å› ä¸ºè¢«å¼•ç”¨æ— æ³•è¢«GCå›æ”¶ï¼Œå¯¼è‡´å†…å­˜æµªè´¹</p>
<p><strong>ä¸å†…å­˜æº¢å‡ºçš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šå¯¹è±¡æ— æ³•å›æ”¶ï¼Œå†…å­˜é€æ¸è¢«å ç”¨</li>
<li><strong>å†…å­˜æº¢å‡º</strong>ï¼šå†…å­˜çœŸçš„ä¸å¤Ÿç”¨äº†ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡</li>
</ul>
<p><strong>å±å®³ï¼š</strong></p>
<ul>
<li>å†…å­˜é€æ¸è¢«å ç”¨ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´OOM</li>
<li>åº”ç”¨å˜æ…¢ï¼Œå¯èƒ½è¢«ç³»ç»Ÿæ€æ­»</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å†…å­˜æ³„æ¼ç¤ºä¾‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryLeak</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addToCache</span><span class="hljs-params">(Object obj)</span> {
        cache.add(obj);  <span class="hljs-comment">// å¯¹è±¡è¢«cacheå¼•ç”¨ï¼Œæ— æ³•å›æ”¶</span>
        <span class="hljs-comment">// å³ä½¿objä¸å†ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•è¢«GCå›æ”¶</span>
    }
}
</code></pre>
<h4 data-id="heading-50">4.2.2 Androidä¸­å¸¸è§çš„å†…å­˜æ³„æ¼åœºæ™¯</h4>
<h5 data-id="heading-51">4.2.2.1 Activity/Contextæ³„æ¼</h5>
<p><strong>é™æ€å˜é‡æŒæœ‰Activityå¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Activity activity;  <span class="hljs-comment">// é™æ€å˜é‡æŒæœ‰Activity</span>
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        activity = <span class="hljs-built_in">this</span>;  <span class="hljs-comment">// Activityæ— æ³•è¢«å›æ”¶</span>
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨å¼±å¼•ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> WeakReference&lt;Activity&gt; activityRef;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(<span class="hljs-built_in">this</span>);
    }
}
</code></pre>
<p><strong>å•ä¾‹æŒæœ‰Contextå¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šæŒæœ‰Activity Context</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySingleton</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MySingleton instance;
    <span class="hljs-keyword">private</span> Context context;
    
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">MySingleton</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">this</span>.context = context;  <span class="hljs-comment">// å¦‚æœæ˜¯Activity Contextï¼Œä¼šæ³„æ¼</span>
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> MySingleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
            instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySingleton</span>(context);
        }
        <span class="hljs-keyword">return</span> instance;
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨Application Context</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySingleton</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MySingleton instance;
    <span class="hljs-keyword">private</span> Context context;
    
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">MySingleton</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">this</span>.context = context.getApplicationContext();  <span class="hljs-comment">// ä½¿ç”¨Application Context</span>
    }
}
</code></pre>
<p><strong>å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šHandlerå†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> {
            <span class="hljs-comment">// HandleræŒæœ‰Activityå¼•ç”¨</span>
        }
    };
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨é™æ€å†…éƒ¨ç±»+å¼±å¼•ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> {
        <span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
        
        MyHandler(Activity activity) {
            activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> {
            <span class="hljs-type">Activity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> activityRef.get();
            <span class="hljs-keyword">if</span> (activity != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// ä½¿ç”¨activity</span>
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-52">4.2.2.2 ç›‘å¬å™¨æ³„æ¼</h5>
<p><strong>EventBusæœªå–æ¶ˆæ³¨å†Œï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå¿˜è®°å–æ¶ˆæ³¨å†Œ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        EventBus.getDefault().register(<span class="hljs-built_in">this</span>);  <span class="hljs-comment">// æ³¨å†Œ</span>
        <span class="hljs-comment">// å¿˜è®°å–æ¶ˆæ³¨å†Œï¼ŒEventBusæŒæœ‰Activityå¼•ç”¨ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</span>
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåœ¨onDestroyä¸­å–æ¶ˆæ³¨å†Œ</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    EventBus.getDefault().unregister(<span class="hljs-built_in">this</span>);  <span class="hljs-comment">// å–æ¶ˆæ³¨å†Œ</span>
}
</code></pre>
<p><strong>å¹¿æ’­æ¥æ”¶å™¨æœªå–æ¶ˆæ³¨å†Œï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå¿˜è®°å–æ¶ˆæ³¨å†Œ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">BroadcastReceiver</span> <span class="hljs-variable">receiver</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BroadcastReceiver</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onReceive</span><span class="hljs-params">(Context context, Intent intent)</span> {
            <span class="hljs-comment">// å¤„ç†å¹¿æ’­</span>
        }
    };
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        registerReceiver(receiver, <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntentFilter</span>(<span class="hljs-string">"ACTION"</span>));  <span class="hljs-comment">// æ³¨å†Œ</span>
        <span class="hljs-comment">// å¿˜è®°å–æ¶ˆæ³¨å†Œï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</span>
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåœ¨onDestroyä¸­å–æ¶ˆæ³¨å†Œ</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-keyword">if</span> (receiver != <span class="hljs-literal">null</span>) {
        unregisterReceiver(receiver);  <span class="hljs-comment">// å–æ¶ˆæ³¨å†Œ</span>
    }
}
</code></pre>
<p><strong>å…¶ä»–ç›‘å¬å™¨æœªå–æ¶ˆæ³¨å†Œï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå¿˜è®°å–æ¶ˆæ³¨å†Œç›‘å¬å™¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        someView.setOnClickListener(listener);  <span class="hljs-comment">// æ³¨å†Œ</span>
        someObject.setOnDataChangedListener(listener);  <span class="hljs-comment">// æ³¨å†Œ</span>
        <span class="hljs-comment">// å¦‚æœè¿™äº›ç›‘å¬å™¨æŒæœ‰Activityå¼•ç”¨ï¼Œå¿˜è®°å–æ¶ˆæ³¨å†Œä¼šå¯¼è‡´æ³„æ¼</span>
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåœ¨onDestroyä¸­å–æ¶ˆæ³¨å†Œ</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    someView.setOnClickListener(<span class="hljs-literal">null</span>);  <span class="hljs-comment">// å–æ¶ˆæ³¨å†Œ</span>
    someObject.setOnDataChangedListener(<span class="hljs-literal">null</span>);  <span class="hljs-comment">// å–æ¶ˆæ³¨å†Œ</span>
}
</code></pre>
<h5 data-id="heading-53">4.2.2.3 é›†åˆç±»æ³„æ¼</h5>
<p><strong>é›†åˆä¸­ä¿å­˜äº†å¯¹è±¡ï¼Œä½†å¿˜è®°æ¸…ç†ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šé›†åˆæ³„æ¼</span>
<span class="hljs-keyword">private</span> List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addObject</span><span class="hljs-params">(Object obj)</span> {
    list.add(obj);  <span class="hljs-comment">// å¯¹è±¡è¢«listå¼•ç”¨</span>
    <span class="hljs-comment">// å³ä½¿objä¸å†ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•è¢«å›æ”¶</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåŠæ—¶æ¸…ç†</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeObject</span><span class="hljs-params">(Object obj)</span> {
    list.remove(obj);
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    list.clear();  <span class="hljs-comment">// æ¸…ç†é›†åˆ</span>
}
</code></pre>
<h5 data-id="heading-54">4.2.2.4 çº¿ç¨‹æ³„æ¼</h5>
<p><strong>çº¿ç¨‹æŒæœ‰å¯¹è±¡å¼•ç”¨ï¼Œçº¿ç¨‹ä¸ç»“æŸï¼Œå¯¹è±¡æ— æ³•å›æ”¶ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šçº¿ç¨‹æ³„æ¼</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> Thread thread;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        thread = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-comment">// çº¿ç¨‹æŒæœ‰Activityå¼•ç”¨</span>
            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
                <span class="hljs-comment">// æ— é™å¾ªç¯ï¼Œçº¿ç¨‹ä¸ç»“æŸ</span>
            }
        });
        thread.start();
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šæ­£ç¡®ç®¡ç†çº¿ç¨‹</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-keyword">if</span> (thread != <span class="hljs-literal">null</span>) {
        thread.interrupt();  <span class="hljs-comment">// ä¸­æ–­çº¿ç¨‹</span>
    }
}
</code></pre>
<h5 data-id="heading-55">4.2.2.5 èµ„æºæœªå…³é—­</h5>
<p><strong>æ–‡ä»¶æµæœªå…³é—­ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šæ–‡ä»¶æµæœªå…³é—­</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFile</span><span class="hljs-params">()</span> {
    <span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"file.txt"</span>);
    <span class="hljs-comment">// ä½¿ç”¨fis</span>
    <span class="hljs-comment">// å¿˜è®°å…³é—­ï¼Œå¯¼è‡´èµ„æºæ³„æ¼</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨try-with-resources</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readFile</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> (<span class="hljs-type">FileInputStream</span> <span class="hljs-variable">fis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(<span class="hljs-string">"file.txt"</span>)) {
        <span class="hljs-comment">// ä½¿ç”¨fis</span>
        <span class="hljs-comment">// è‡ªåŠ¨å…³é—­</span>
    } <span class="hljs-keyword">catch</span> (IOException e) {
        e.printStackTrace();
    }
}
</code></pre>
<p><strong>æ•°æ®åº“è¿æ¥æœªå…³é—­ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šæ•°æ®åº“è¿æ¥æœªå…³é—­</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryDatabase</span><span class="hljs-params">()</span> {
    <span class="hljs-type">SQLiteDatabase</span> <span class="hljs-variable">db</span> <span class="hljs-operator">=</span> getWritableDatabase();
    <span class="hljs-type">Cursor</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> db.query(<span class="hljs-string">"table"</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
    <span class="hljs-comment">// ä½¿ç”¨cursor</span>
    <span class="hljs-comment">// å¿˜è®°å…³é—­cursorå’Œdbï¼Œå¯¼è‡´èµ„æºæ³„æ¼</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåŠæ—¶å…³é—­</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">queryDatabase</span><span class="hljs-params">()</span> {
    <span class="hljs-type">SQLiteDatabase</span> <span class="hljs-variable">db</span> <span class="hljs-operator">=</span> getWritableDatabase();
    <span class="hljs-keyword">try</span> (<span class="hljs-type">Cursor</span> <span class="hljs-variable">cursor</span> <span class="hljs-operator">=</span> db.query(<span class="hljs-string">"table"</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>)) {
        <span class="hljs-comment">// ä½¿ç”¨cursor</span>
        <span class="hljs-comment">// è‡ªåŠ¨å…³é—­cursor</span>
    } <span class="hljs-keyword">finally</span> {
        db.close();  <span class="hljs-comment">// å…³é—­æ•°æ®åº“è¿æ¥</span>
    }
}
</code></pre>
<p><strong>ç½‘ç»œè¿æ¥æœªå…³é—­ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šç½‘ç»œè¿æ¥æœªå…³é—­</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">downloadFile</span><span class="hljs-params">()</span> {
    <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> (HttpURLConnection) url.openConnection();
    <span class="hljs-comment">// ä½¿ç”¨connection</span>
    <span class="hljs-comment">// å¿˜è®°å…³é—­ï¼Œå¯¼è‡´èµ„æºæ³„æ¼</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåŠæ—¶å…³é—­</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">downloadFile</span><span class="hljs-params">()</span> {
    <span class="hljs-type">HttpURLConnection</span> <span class="hljs-variable">connection</span> <span class="hljs-operator">=</span> (HttpURLConnection) url.openConnection();
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// ä½¿ç”¨connection</span>
    } <span class="hljs-keyword">finally</span> {
        connection.disconnect();  <span class="hljs-comment">// å…³é—­è¿æ¥</span>
    }
}
</code></pre>
<p><strong>Bitmapæœªé‡Šæ”¾ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šBitmapæœªé‡Šæ”¾</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">loadImage</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Bitmap</span> <span class="hljs-variable">bitmap</span> <span class="hljs-operator">=</span> BitmapFactory.decodeFile(<span class="hljs-string">"image.jpg"</span>);
    imageView.setImageBitmap(bitmap);
    <span class="hljs-comment">// å¿˜è®°é‡Šæ”¾bitmapï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šåŠæ—¶é‡Šæ”¾</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-keyword">if</span> (bitmap != <span class="hljs-literal">null</span> &amp;&amp; !bitmap.isRecycled()) {
        bitmap.recycle();  <span class="hljs-comment">// é‡Šæ”¾Bitmap</span>
        bitmap = <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>AsyncTaskæ³„æ¼ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šAsyncTaskæŒæœ‰Activityå¼•ç”¨</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyAsyncTask</span>().execute();  <span class="hljs-comment">// AsyncTaskæŒæœ‰Activityå¼•ç”¨</span>
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAsyncTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AsyncTask</span>&lt;Void, Void, Void&gt; {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> Void <span class="hljs-title function_">doInBackground</span><span class="hljs-params">(Void... params)</span> {
            <span class="hljs-comment">// é•¿æ—¶é—´è¿è¡Œ</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨é™æ€å†…éƒ¨ç±»+å¼±å¼•ç”¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAsyncTask</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AsyncTask</span>&lt;Void, Void, Void&gt; {
    <span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
    
    MyAsyncTask(Activity activity) {
        activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Void <span class="hljs-title function_">doInBackground</span><span class="hljs-params">(Void... params)</span> {
        <span class="hljs-type">Activity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> activityRef.get();
        <span class="hljs-keyword">if</span> (activity != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// ä½¿ç”¨activity</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<h4 data-id="heading-56">4.2.3 å¦‚ä½•é¿å…å†…å­˜æ³„æ¼</h4>
<p><strong>æ­£ç¡®å¤„ç†ç”Ÿå‘½å‘¨æœŸï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-comment">// æ¸…ç†èµ„æº</span>
    handler.removeCallbacksAndMessages(<span class="hljs-literal">null</span>);
    EventBus.getDefault().unregister(<span class="hljs-built_in">this</span>);
    cache.clear();
}
</code></pre>
<p><strong>ä½¿ç”¨å¼±å¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¯¹äºå¯èƒ½æ³„æ¼çš„å¼•ç”¨ï¼Œä½¿ç”¨WeakReference</span>
<span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
</code></pre>
<p><strong>é¿å…å¾ªç¯å¼•ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ³¨æ„å¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨</span>
<span class="hljs-comment">// åŠæ—¶æ–­å¼€ä¸éœ€è¦çš„å¼•ç”¨</span>
</code></pre>
<p><strong>åˆç†ä½¿ç”¨ç¼“å­˜ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä½¿ç”¨æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜ï¼ˆLruCacheï¼‰</span>
<span class="hljs-keyword">private</span> LruCache&lt;String, Bitmap&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LruCache</span>&lt;&gt;(<span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);
</code></pre>
<h4 data-id="heading-57">4.3 å†…å­˜æº¢å‡ºï¼ˆOOM - OutOfMemoryErrorï¼‰</h4>
<h4 data-id="heading-58">4.3.1 ä»€ä¹ˆæ˜¯å†…å­˜æº¢å‡º</h4>
<p><strong>å®šä¹‰ï¼š</strong> åº”ç”¨éœ€è¦çš„å†…å­˜è¶…è¿‡äº†ç³»ç»Ÿåˆ†é…çš„é™åˆ¶ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡</p>
<p><strong>Androidå †å†…å­˜æº¢å‡ºï¼š</strong> æœ€å¸¸è§ï¼Œå †å†…å­˜ä¸è¶³</p>
<p><strong>å±å®³ï¼š</strong> åº”ç”¨å´©æºƒï¼Œç”¨æˆ·ä½“éªŒå·®</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OOMExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createTooManyObjects</span><span class="hljs-params">()</span> {
        List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());  <span class="hljs-comment">// æœ€ç»ˆå¯¼è‡´OOM</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-59">4.3.2 å†…å­˜æº¢å‡ºçš„åŸå› </h4>
<p><strong>å†…å­˜æ³„æ¼å¯¼è‡´ï¼š</strong></p>
<ul>
<li>å¯¹è±¡æ— æ³•å›æ”¶ï¼Œå†…å­˜é€æ¸è¢«å ç”¨</li>
<li>æœ€ç»ˆå¯¼è‡´å†…å­˜ä¸è¶³</li>
</ul>
<p><strong>åˆ›å»ºäº†å¤ªå¤šå¯¹è±¡ï¼š</strong></p>
<ul>
<li>ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®</li>
<li>å¾ªç¯ä¸­åˆ›å»ºå¤§é‡å¯¹è±¡</li>
</ul>
<p><strong>å¤§å¯¹è±¡å ç”¨è¿‡å¤šå†…å­˜ï¼š</strong></p>
<ul>
<li>åŠ è½½è¿‡å¤§çš„å›¾ç‰‡</li>
<li>åˆ›å»ºè¿‡å¤§çš„æ•°ç»„</li>
</ul>
<p><strong>Androidè®¾å¤‡å†…å­˜é™åˆ¶ï¼š</strong></p>
<ul>
<li>ä¸åŒè®¾å¤‡æœ‰ä¸åŒçš„å †å†…å­˜ä¸Šé™</li>
<li>ä½ç«¯è®¾å¤‡å†…å­˜æ›´å°</li>
</ul>
<h4 data-id="heading-60">4.3.3 å¦‚ä½•è§£å†³å†…å­˜æº¢å‡º</h4>
<p><strong>æ’æŸ¥å†…å­˜æ³„æ¼ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹</li>
<li>ä½¿ç”¨MATåˆ†æå †è½¬å‚¨</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼é—®é¢˜</li>
</ul>
<p><strong>ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼š</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡</li>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
</ul>
<p><strong>å¤„ç†å¤§å¯¹è±¡ï¼š</strong></p>
<ul>
<li>å‹ç¼©å›¾ç‰‡å¤§å°</li>
<li>åˆ†æ‰¹åŠ è½½æ•°æ®</li>
<li>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡</li>
</ul>
<p><strong>å¢åŠ å†…å­˜é™åˆ¶ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰ï¼š</strong></p>
<ul>
<li>åœ¨AndroidManifest.xmlä¸­è®¾ç½®largeHeap="true"</li>
<li>ä½†è¿™ä¸æ˜¯æ ¹æœ¬è§£å†³æ–¹æ¡ˆï¼Œè¿˜æ˜¯è¦ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
</ul>
<hr/>
<h2 data-id="heading-61">ç¬¬äº”éƒ¨åˆ†ï¼šAndroid GCæ£€æµ‹ä¸è¯Šæ–­ï¼ˆå·¥å…·å’Œæ–¹æ³•ï¼‰</h2>
<h4 data-id="heading-62">5.1 Android GCæ£€æµ‹å·¥å…·å’Œæ–¹æ³•</h4>
<p><strong>è¯´æ˜ï¼šè¿™éƒ¨åˆ†éƒ½æ˜¯ç”¨æ¥æ£€æµ‹ã€åˆ†æã€è¯Šæ–­GCå’Œå†…å­˜é—®é¢˜çš„å·¥å…·å’Œæ–¹æ³•</strong></p>
<h4 data-id="heading-63">5.1.1 Android Studio Profilerï¼ˆæœ€å¸¸ç”¨çš„å·¥å…·ï¼‰</h4>
<p><strong>ä½œç”¨ï¼š</strong> å®æ—¶ç›‘æ§åº”ç”¨çš„å†…å­˜ã€CPUã€ç½‘ç»œç­‰æ€§èƒ½æ•°æ®</p>
<p><strong>Memory Profilerï¼ˆå†…å­˜åˆ†æå™¨ï¼‰åŠŸèƒ½ï¼š</strong></p>
<ol>
<li>
<p><strong>å®æ—¶æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</strong></p>
<ul>
<li>æ˜¾ç¤ºå†…å­˜ä½¿ç”¨æ›²çº¿å›¾</li>
<li>å¯ä»¥çœ‹åˆ°å†…å­˜éšæ—¶é—´çš„å˜åŒ–è¶‹åŠ¿</li>
<li>è¯†åˆ«å†…å­˜æ³„æ¼ï¼ˆå†…å­˜æŒç»­å¢é•¿ï¼‰</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹GCäº‹ä»¶</strong></p>
<ul>
<li>GCäº‹ä»¶ä¼šåœ¨å†…å­˜æ›²çº¿ä¸Šæ˜¾ç¤ºä¸ºå°å›¾æ ‡</li>
<li>ç‚¹å‡»GCäº‹ä»¶å¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼š
<ul>
<li>GCç±»å‹ï¼ˆPartial GCã€Full GCã€Sticky GCï¼‰</li>
<li>GCè€—æ—¶ï¼ˆæš‚åœæ—¶é—´ï¼‰</li>
<li>å›æ”¶å‰åçš„å†…å­˜å¤§å°</li>
<li>å›æ”¶äº†å¤šå°‘å†…å­˜</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>ç”Ÿæˆå †è½¬å‚¨ï¼ˆHeap Dumpï¼‰</strong></p>
<ul>
<li>ç‚¹å‡»"Heap Dump"æŒ‰é’®ç”Ÿæˆå †è½¬å‚¨</li>
<li>å¯ä»¥æŸ¥çœ‹å½“å‰æ‰€æœ‰å¯¹è±¡çš„å†…å­˜å ç”¨</li>
<li>å¯ä»¥å¯¼å‡ºä¸ºhprofæ–‡ä»¶ï¼Œç”¨MATåˆ†æ</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹å¯¹è±¡åˆ†é…æƒ…å†µ</strong></p>
<ul>
<li>ä½¿ç”¨"Allocation Tracking"åŠŸèƒ½</li>
<li>è®°å½•ä¸€æ®µæ—¶é—´å†…çš„å¯¹è±¡åˆ†é…</li>
<li>å¯ä»¥çœ‹åˆ°å“ªäº›å¯¹è±¡è¢«åˆ†é…ï¼Œåœ¨å“ªé‡Œåˆ†é…ï¼ˆè°ƒç”¨æ ˆï¼‰</li>
</ul>
</li>
</ol>
<p><strong>CPU Profilerï¼ˆCPUåˆ†æå™¨ï¼‰åŠŸèƒ½ï¼š</strong></p>
<ul>
<li>æŸ¥çœ‹GCå ç”¨çš„CPUæ—¶é—´</li>
<li>åˆ†æGCå¯¹æ€§èƒ½çš„å½±å“</li>
<li>æŸ¥çœ‹GCçº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µ</li>
</ul>
<p><strong>è¯¦ç»†ä½¿ç”¨æ­¥éª¤ï¼š</strong></p>
<ol>
<li>
<p><strong>æ‰“å¼€Profilerçª—å£</strong></p>
<ul>
<li>åœ¨Android Studioä¸­ï¼Œç‚¹å‡»åº•éƒ¨çš„"Profiler"æ ‡ç­¾</li>
<li>æˆ–é€šè¿‡èœå•ï¼šView â†’ Tool Windows â†’ Profiler</li>
</ul>
</li>
<li>
<p><strong>é€‰æ‹©è¦åˆ†æçš„åº”ç”¨è¿›ç¨‹</strong></p>
<ul>
<li>åœ¨Profilerçª—å£ä¸­é€‰æ‹©è¦åˆ†æçš„åº”ç”¨è¿›ç¨‹</li>
<li>ç¡®ä¿åº”ç”¨æ­£åœ¨è¿è¡Œï¼ˆdebugæ¨¡å¼ï¼‰</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</strong></p>
<ul>
<li>ç‚¹å‡»"Memory"æ ‡ç­¾</li>
<li>æŸ¥çœ‹å†…å­˜ä½¿ç”¨æ›²çº¿</li>
<li>è§‚å¯Ÿå†…å­˜æ˜¯å¦æŒç»­å¢é•¿ï¼ˆå¯èƒ½çš„å†…å­˜æ³„æ¼ï¼‰</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹GCäº‹ä»¶</strong></p>
<ul>
<li>åœ¨å†…å­˜æ›²çº¿ä¸­ï¼ŒGCäº‹ä»¶ä¼šæ˜¾ç¤ºä¸ºå°å›¾æ ‡</li>
<li>ç‚¹å‡»GCäº‹ä»¶ï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
<li>åˆ†æGCé¢‘ç‡å’Œè€—æ—¶</li>
</ul>
</li>
<li>
<p><strong>ç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>ç‚¹å‡»"Heap Dump"æŒ‰é’®</li>
<li>ç­‰å¾…ç”Ÿæˆå®Œæˆ</li>
<li>å¯ä»¥æŸ¥çœ‹å¯¹è±¡åˆ—è¡¨ã€å†…å­˜å ç”¨ç­‰</li>
<li>å¯ä»¥å¯¼å‡ºä¸ºhprofæ–‡ä»¶</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹å¯¹è±¡åˆ†é…æƒ…å†µ</strong></p>
<ul>
<li>ç‚¹å‡»"Record allocations"æŒ‰é’®å¼€å§‹è®°å½•</li>
<li>æ“ä½œåº”ç”¨ï¼ˆæ¯”å¦‚æ»‘åŠ¨åˆ—è¡¨ï¼‰</li>
<li>ç‚¹å‡»"Stop recording"åœæ­¢è®°å½•</li>
<li>æŸ¥çœ‹å“ªäº›å¯¹è±¡è¢«åˆ†é…ï¼Œåœ¨å“ªé‡Œåˆ†é…</li>
</ul>
</li>
</ol>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>æ—¥å¸¸å¼€å‘æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨</li>
<li>åˆ†æå†…å­˜æ³„æ¼</li>
<li>åˆ†æGCæ€§èƒ½</li>
<li>ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
</ul>
<h4 data-id="heading-64">5.1.2 logcatï¼ˆæŸ¥çœ‹GCæ—¥å¿—ï¼‰</h4>
<p><strong>ä½œç”¨ï¼š</strong> æŸ¥çœ‹GCçš„æ—¥å¿—ä¿¡æ¯ï¼Œäº†è§£GCçš„æ‰§è¡Œæƒ…å†µ</p>
<p><strong>GCæ—¥å¿—çš„ä½œç”¨ï¼š</strong></p>
<ul>
<li>äº†è§£GCä½•æ—¶è§¦å‘</li>
<li>äº†è§£GCçš„ç±»å‹å’Œè€—æ—¶</li>
<li>åˆ†æGCé¢‘ç‡æ˜¯å¦è¿‡é«˜</li>
<li>åˆ†æGCå¯¹æ€§èƒ½çš„å½±å“</li>
</ul>
<p><strong>å¦‚ä½•ä½¿ç”¨ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šä½¿ç”¨adb logcatï¼ˆå‘½ä»¤è¡Œï¼‰</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰GCæ—¥å¿—</span>
adb logcat | grep GC

<span class="hljs-comment"># æŸ¥çœ‹ç‰¹å®šåº”ç”¨çš„GCæ—¥å¿—</span>
adb logcat | grep -E <span class="hljs-string">"GC|dalvikvm|art"</span>
</code></pre>
<p><strong>æ–¹æ³•2ï¼šåœ¨Android Studioçš„Logcatçª—å£ä¸­æŸ¥çœ‹</strong></p>
<ul>
<li>æ‰“å¼€Logcatçª—å£ï¼ˆåº•éƒ¨æ ‡ç­¾ï¼‰</li>
<li>åœ¨è¿‡æ»¤æ¡†ä¸­è¾“å…¥"GC"æˆ–"dalvikvm"æˆ–"art"</li>
<li>æŸ¥çœ‹GCç›¸å…³çš„æ—¥å¿—</li>
</ul>
<p><strong>GCæ—¥å¿—æ ¼å¼ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-c" lang="c">GC: AllocSpace concurrent mark sweep freed 
    <span class="hljs-number">12345</span>(<span class="hljs-number">456</span>KB) AllocSpace bytes, 
    <span class="hljs-number">12</span>(<span class="hljs-number">234</span>KB) LOS objects, 
    <span class="hljs-number">50</span>% <span class="hljs-built_in">free</span>, <span class="hljs-number">5</span>MB/<span class="hljs-number">10</span>MB, 
    paused <span class="hljs-number">2.3</span>ms total <span class="hljs-number">15.6</span>ms
</code></pre>
<p><strong>GCæ—¥å¿—åŒ…å«çš„ä¿¡æ¯ï¼š</strong></p>
<ul>
<li><strong>GCç±»å‹</strong>ï¼šPartial GCã€Full GCã€Sticky GC</li>
<li><strong>GCè€—æ—¶</strong>ï¼špausedï¼ˆæš‚åœæ—¶é—´ï¼‰ã€totalï¼ˆæ€»è€—æ—¶ï¼‰</li>
<li><strong>å›æ”¶å‰åçš„å†…å­˜å¤§å°</strong>ï¼šfreedï¼ˆé‡Šæ”¾äº†å¤šå°‘å†…å­˜ï¼‰</li>
<li><strong>å†…å­˜ä½¿ç”¨æƒ…å†µ</strong>ï¼šfreeï¼ˆç©ºé—²å†…å­˜ï¼‰ã€totalï¼ˆæ€»å†…å­˜ï¼‰</li>
<li><strong>GCé¢‘ç‡</strong>ï¼šå¤šä¹…è§¦å‘ä¸€æ¬¡GC</li>
</ul>
<p><strong>å¦‚ä½•åˆ†æGCæ—¥å¿—ï¼š</strong></p>
<ol>
<li>
<p><strong>æŸ¥çœ‹GCé¢‘ç‡</strong></p>
<ul>
<li>ç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…GCçš„æ¬¡æ•°</li>
<li>å¦‚æœGCè¿‡äºé¢‘ç¹ï¼ˆæ¯”å¦‚æ¯ç§’å¤šæ¬¡ï¼‰ï¼Œè¯´æ˜æœ‰é—®é¢˜</li>
<li>å¯èƒ½åŸå› ï¼šé¢‘ç¹åˆ›å»ºå¯¹è±¡ã€å†…å­˜æ³„æ¼</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹GCè€—æ—¶</strong></p>
<ul>
<li>å…³æ³¨pausedæ—¶é—´ï¼ˆæš‚åœæ—¶é—´ï¼‰</li>
<li>å¦‚æœæš‚åœæ—¶é—´è¿‡é•¿ï¼ˆæ¯”å¦‚&gt;50msï¼‰ï¼Œä¼šå¯¼è‡´å¡é¡¿</li>
<li>Full GCçš„æš‚åœæ—¶é—´é€šå¸¸æ¯”Partial GCé•¿</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹GCç±»å‹</strong></p>
<ul>
<li>Partial GCï¼šæ­£å¸¸ï¼Œå¿«é€Ÿ</li>
<li>Full GCï¼šéœ€è¦å…³æ³¨ï¼Œå¯èƒ½å¯¼è‡´å¡é¡¿</li>
<li>Sticky GCï¼šæ­£å¸¸ï¼Œå‡ ä¹æ„Ÿè§‰ä¸åˆ°</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹å†…å­˜å›æ”¶æƒ…å†µ</strong></p>
<ul>
<li>freedï¼šé‡Šæ”¾äº†å¤šå°‘å†…å­˜</li>
<li>å¦‚æœé‡Šæ”¾çš„å†…å­˜å¾ˆå°‘ï¼Œè¯´æ˜å¤§éƒ¨åˆ†å¯¹è±¡è¿˜åœ¨ä½¿ç”¨</li>
<li>å¦‚æœé‡Šæ”¾çš„å†…å­˜å¾ˆå¤šï¼Œè¯´æ˜æœ‰å¾ˆå¤šåƒåœ¾å¯¹è±¡</li>
</ul>
</li>
</ol>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>å¿«é€ŸæŸ¥çœ‹GCæƒ…å†µ</li>
<li>åˆ†æGCé¢‘ç‡å’Œè€—æ—¶</li>
<li>æ’æŸ¥GCå¯¼è‡´çš„æ€§èƒ½é—®é¢˜</li>
</ul>
<h4 data-id="heading-65">5.1.3 Systraceï¼ˆåˆ†æGCå¯¹æ€§èƒ½çš„å½±å“ï¼‰</h4>
<p><strong>ä½œç”¨ï¼š</strong> åˆ†æGCå¯¹æ€§èƒ½çš„å½±å“ï¼Œæ‰¾å‡ºGCå¯¼è‡´çš„å¡é¡¿é—®é¢˜</p>
<p><strong>Systraceæ˜¯ä»€ä¹ˆï¼š</strong></p>
<ul>
<li>Androidç³»ç»Ÿæä¾›çš„æ€§èƒ½åˆ†æå·¥å…·</li>
<li>å¯ä»¥è®°å½•ç³»ç»Ÿå„ä¸ªçº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µ</li>
<li>å¯ä»¥çœ‹åˆ°GCåœ¨ä¸»çº¿ç¨‹ä¸Šçš„æ‰§è¡Œæ—¶é—´</li>
</ul>
<p><strong>å¦‚ä½•ä½¿ç”¨ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šä½¿ç”¨Android Studioçš„Systraceå·¥å…·</strong></p>
<ol>
<li>åœ¨Android Studioä¸­ï¼Œç‚¹å‡»"Tools" â†’ "Android" â†’ "Device Monitor"</li>
<li>é€‰æ‹©è¦åˆ†æçš„åº”ç”¨</li>
<li>ç‚¹å‡»"Systrace"æŒ‰é’®</li>
<li>è®¾ç½®è®°å½•æ—¶é—´ï¼ˆæ¯”å¦‚10ç§’ï¼‰</li>
<li>æ“ä½œåº”ç”¨ï¼ˆæ¯”å¦‚æ»‘åŠ¨åˆ—è¡¨ï¼‰</li>
<li>åœæ­¢è®°å½•ï¼ŒæŸ¥çœ‹ç»“æœ</li>
</ol>
<p><strong>æ–¹æ³•2ï¼šä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¼€å§‹è®°å½•</span>
python systrace.py -t 10 -o trace.html <span class="hljs-built_in">sched</span> freq idle am wm gfx view binder_driver hal dalvik camera input res

<span class="hljs-comment"># åœ¨è®¾å¤‡ä¸Šæ“ä½œåº”ç”¨</span>
<span class="hljs-comment"># åœæ­¢è®°å½•åï¼Œç”¨æµè§ˆå™¨æ‰“å¼€trace.htmlæŸ¥çœ‹</span>
</code></pre>
<p><strong>Systraceèƒ½åˆ†æä»€ä¹ˆï¼š</strong></p>
<ol>
<li>
<p><strong>GCæš‚åœæ—¶é—´</strong></p>
<ul>
<li>å¯ä»¥çœ‹åˆ°GCåœ¨ä¸»çº¿ç¨‹ä¸Šçš„æ‰§è¡Œæ—¶é—´</li>
<li>å¯ä»¥çœ‹åˆ°GCæš‚åœäº†å¤šä¹…</li>
<li>å¯ä»¥åˆ¤æ–­GCæ˜¯å¦å¯¼è‡´å¡é¡¿</li>
</ul>
</li>
<li>
<p><strong>GCå¯¹ä¸»çº¿ç¨‹çš„å½±å“</strong></p>
<ul>
<li>å¯ä»¥çœ‹åˆ°ä¸»çº¿ç¨‹åœ¨GCæœŸé—´è¢«é˜»å¡</li>
<li>å¯ä»¥çœ‹åˆ°GCå¯¼è‡´çš„å¸§ç‡ä¸‹é™</li>
<li>å¯ä»¥åˆ†æGCå¯¹ç”¨æˆ·ä½“éªŒçš„å½±å“</li>
</ul>
</li>
<li>
<p><strong>åº”ç”¨å¡é¡¿çš„åŸå› </strong></p>
<ul>
<li>å¯ä»¥çœ‹åˆ°å¡é¡¿æ˜¯å¦ç”±GCå¼•èµ·</li>
<li>å¯ä»¥çœ‹åˆ°GCå’Œå…¶ä»–æ“ä½œçš„æ—¶åºå…³ç³»</li>
<li>å¯ä»¥æ‰¾å‡ºæ€§èƒ½ç“¶é¢ˆ</li>
</ul>
</li>
</ol>
<p><strong>å¦‚ä½•æŸ¥çœ‹Systraceç»“æœï¼š</strong></p>
<ol>
<li>
<p><strong>æŸ¥çœ‹ä¸»çº¿ç¨‹</strong></p>
<ul>
<li>æ‰¾åˆ°"main"çº¿ç¨‹</li>
<li>æŸ¥çœ‹æ˜¯å¦æœ‰çº¢è‰²çš„å¸§ï¼ˆè¡¨ç¤ºæ‰å¸§ï¼‰</li>
<li>æŸ¥çœ‹æ˜¯å¦æœ‰GCäº‹ä»¶</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹GCäº‹ä»¶</strong></p>
<ul>
<li>æ‰¾åˆ°"GC"ç›¸å…³çš„äº‹ä»¶</li>
<li>æŸ¥çœ‹GCçš„æŒç»­æ—¶é—´</li>
<li>æŸ¥çœ‹GCæ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</li>
</ul>
</li>
<li>
<p><strong>åˆ†æå¡é¡¿åŸå› </strong></p>
<ul>
<li>å¦‚æœå¡é¡¿æ—¶é—´ä¸GCæ—¶é—´å¯¹åº”ï¼Œè¯´æ˜GCå¯¼è‡´å¡é¡¿</li>
<li>å¦‚æœGCé¢‘ç¹ï¼Œéœ€è¦ä¼˜åŒ–ä»£ç å‡å°‘GC</li>
<li>å¦‚æœGCæš‚åœæ—¶é—´é•¿ï¼Œéœ€è¦é¿å…Full GC</li>
</ul>
</li>
</ol>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>åˆ†æåº”ç”¨å¡é¡¿é—®é¢˜</li>
<li>åˆ†æGCå¯¹æ€§èƒ½çš„å½±å“</li>
<li>ä¼˜åŒ–GCæ€§èƒ½</li>
</ul>
<h4 data-id="heading-66">5.1.4 MATï¼ˆMemory Analyzer Toolï¼Œåˆ†æå †è½¬å‚¨ï¼‰</h4>
<p><strong>ä½œç”¨ï¼š</strong> åˆ†æå †è½¬å‚¨æ–‡ä»¶ï¼Œè¯¦ç»†åˆ†æå†…å­˜é—®é¢˜ï¼Œæ‰¾å‡ºå†…å­˜æ³„æ¼å’Œå¤§å¯¹è±¡</p>
<p><strong>MATæ˜¯ä»€ä¹ˆï¼š</strong></p>
<ul>
<li>Eclipse Memory Analyzer Tool</li>
<li>ä¸“é—¨ç”¨äºåˆ†æJavaå †è½¬å‚¨æ–‡ä»¶çš„å·¥å…·</li>
<li>å¯ä»¥è¯¦ç»†åˆ†æå¯¹è±¡çš„å†…å­˜å ç”¨å’Œå¼•ç”¨å…³ç³»</li>
</ul>
<p><strong>MATä¸‹è½½å’Œå®‰è£…ï¼š</strong></p>
<p><strong>1. ä¸‹è½½MAT</strong></p>
<ul>
<li>è®¿é—®Eclipseå®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.eclipse.org%2Fmat%2F" target="_blank" title="https://www.eclipse.org/mat/" ref="nofollow noopener noreferrer">www.eclipse.org/mat/</a></li>
<li>ä¸‹è½½MATå®‰è£…åŒ…ï¼ˆWindows/Mac/Linuxï¼‰</li>
<li>æˆ–è€…ä¸‹è½½ç‹¬ç«‹ç‰ˆæœ¬ï¼ˆä¸éœ€è¦Eclipseï¼‰</li>
</ul>
<p><strong>2. å®‰è£…MAT</strong></p>
<ul>
<li>Windowsï¼šè§£å‹ä¸‹è½½çš„æ–‡ä»¶ï¼Œè¿è¡ŒMemoryAnalyzer.exe</li>
<li>Mac/Linuxï¼šè§£å‹ä¸‹è½½çš„æ–‡ä»¶ï¼Œè¿è¡ŒMemoryAnalyzerå¯æ‰§è¡Œæ–‡ä»¶</li>
<li>ç¡®ä¿å·²å®‰è£…Javaï¼ˆMATéœ€è¦Javaè¿è¡Œç¯å¢ƒï¼‰</li>
</ul>
<p><strong>Android Studioç”Ÿæˆå †è½¬å‚¨çš„è¯¦ç»†æ­¥éª¤ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šä½¿ç”¨Android Studio Profilerï¼ˆæ¨èï¼‰</strong></p>
<p><strong>æ­¥éª¤1ï¼šæ‰“å¼€Profiler</strong></p>
<ul>
<li>åœ¨Android Studioä¸­ï¼Œç‚¹å‡»åº•éƒ¨å·¥å…·æ çš„"Profiler"æ ‡ç­¾</li>
<li>æˆ–é€šè¿‡èœå•ï¼šView â†’ Tool Windows â†’ Profiler</li>
<li>ç¡®ä¿åº”ç”¨æ­£åœ¨è¿è¡Œï¼ˆdebugæ¨¡å¼ï¼‰</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šé€‰æ‹©åº”ç”¨è¿›ç¨‹</strong></p>
<ul>
<li>åœ¨Profilerçª—å£ä¸­ï¼Œé€‰æ‹©è¦åˆ†æçš„åº”ç”¨è¿›ç¨‹</li>
<li>ç¡®ä¿åº”ç”¨æ­£åœ¨è¿è¡Œ</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šæ‰“å¼€Memory Profiler</strong></p>
<ul>
<li>ç‚¹å‡»"Memory"æ ‡ç­¾</li>
<li>æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>ç‚¹å‡»å†…å­˜æ›²çº¿å›¾ä¸‹æ–¹çš„"Heap Dump"æŒ‰é’®ï¼ˆåƒåœ¾æ¡¶å›¾æ ‡ï¼‰</li>
<li>ç­‰å¾…ç”Ÿæˆå®Œæˆï¼ˆå¯èƒ½éœ€è¦å‡ ç§’åˆ°å‡ åç§’ï¼Œå–å†³äºå †å¤§å°ï¼‰</li>
<li>ç”Ÿæˆå®Œæˆåï¼Œä¼šåœ¨ä¸‹æ–¹æ˜¾ç¤ºå †è½¬å‚¨ä¿¡æ¯</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šå¯¼å‡ºhprofæ–‡ä»¶</strong></p>
<ul>
<li>åœ¨å †è½¬å‚¨ä¿¡æ¯åŒºåŸŸï¼Œç‚¹å‡»"Export heap dump"æŒ‰é’®</li>
<li>é€‰æ‹©ä¿å­˜ä½ç½®ï¼Œä¿å­˜ä¸º.hprofæ–‡ä»¶</li>
<li>æ¯”å¦‚ï¼š<code>heap.hprof</code></li>
</ul>
<p><strong>æ–¹æ³•2ï¼šä½¿ç”¨å‘½ä»¤è¡Œç”Ÿæˆå †è½¬å‚¨</strong></p>
<p><strong>æ­¥éª¤1ï¼šæ‰¾åˆ°åº”ç”¨è¿›ç¨‹ID</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰åº”ç”¨è¿›ç¨‹</span>
adb shell ps | grep ä½ çš„åº”ç”¨åŒ…å

<span class="hljs-comment"># æˆ–è€…</span>
adb shell ps -A | grep ä½ çš„åº”ç”¨åŒ…å
</code></pre>
<p><strong>æ­¥éª¤2ï¼šç”Ÿæˆå †è½¬å‚¨</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ–¹æ³•1ï¼šä½¿ç”¨amå‘½ä»¤ï¼ˆéœ€è¦rootæƒé™æˆ–debugç‰ˆæœ¬ï¼‰</span>
adb shell am dumpheap &lt;pid&gt; /data/local/tmp/heap.hprof

<span class="hljs-comment"># æ–¹æ³•2ï¼šä½¿ç”¨killå‘½ä»¤ï¼ˆå‘é€ä¿¡å·ï¼‰</span>
adb shell <span class="hljs-built_in">kill</span> -10 &lt;pid&gt;

<span class="hljs-comment"># æ–¹æ³•3ï¼šåœ¨ä»£ç ä¸­ç”Ÿæˆï¼ˆå¼€å‘æ—¶ï¼‰</span>
Debug.dumpHprofData(<span class="hljs-string">"/data/local/tmp/heap.hprof"</span>);
</code></pre>
<p><strong>æ­¥éª¤3ï¼šä»è®¾å¤‡æ‹‰å–hprofæ–‡ä»¶</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä»è®¾å¤‡æ‹‰å–åˆ°æœ¬åœ°</span>
adb pull /data/local/tmp/heap.hprof ./
</code></pre>
<p><strong>è½¬æ¢hprofæ–‡ä»¶æ ¼å¼çš„è¯¦ç»†æ­¥éª¤ï¼š</strong></p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦è½¬æ¢ï¼š</strong></p>
<ul>
<li>Androidçš„hprofæ–‡ä»¶æ ¼å¼ä¸æ ‡å‡†Javaä¸åŒ</li>
<li>MATæ— æ³•ç›´æ¥æ‰“å¼€Androidçš„hprofæ–‡ä»¶</li>
<li>éœ€è¦ä½¿ç”¨Android SDKçš„hprof-convå·¥å…·è½¬æ¢</li>
</ul>
<p><strong>æ­¥éª¤1ï¼šæ‰¾åˆ°hprof-convå·¥å…·</strong></p>
<ul>
<li>hprof-convå·¥å…·ä½äºAndroid SDKçš„platform-toolsç›®å½•</li>
<li>Windowsï¼š<code>%LOCALAPPDATA%\Android\Sdk\platform-tools\hprof-conv.exe</code></li>
<li>Mac/Linuxï¼š<code>~/Library/Android/sdk/platform-tools/hprof-conv</code></li>
</ul>
<p><strong>æ­¥éª¤2ï¼šè½¬æ¢hprofæ–‡ä»¶</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Windows</span>
hprof-conv.exe heap.hprof heap-converted.hprof

<span class="hljs-comment"># Mac/Linux</span>
./hprof-conv heap.hprof heap-converted.hprof

<span class="hljs-comment"># æˆ–è€…ä½¿ç”¨å®Œæ•´è·¯å¾„</span>
C:\Users\ä½ çš„ç”¨æˆ·å\AppData\Local\Android\Sdk\platform-tools\hprof-conv.exe heap.hprof heap-converted.hprof
</code></pre>
<p><strong>æ­¥éª¤3ï¼šéªŒè¯è½¬æ¢ç»“æœ</strong></p>
<ul>
<li>è½¬æ¢å®Œæˆåï¼Œä¼šç”Ÿæˆheap-converted.hprofæ–‡ä»¶</li>
<li>æ–‡ä»¶å¤§å°åº”è¯¥ä¸åŸå§‹æ–‡ä»¶ç›¸ä¼¼</li>
<li>ç°åœ¨å¯ä»¥ç”¨MATæ‰“å¼€äº†</li>
</ul>
<p><strong>MATæ‰“å¼€å’Œåˆ†æçš„è¯¦ç»†æ­¥éª¤ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šæ‰“å¼€MAT</strong></p>
<ul>
<li>è¿è¡ŒMATï¼ˆMemoryAnalyzer.exeæˆ–MemoryAnalyzerï¼‰</li>
<li>ç­‰å¾…MATå¯åŠ¨å®Œæˆ</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šæ‰“å¼€hprofæ–‡ä»¶</strong></p>
<ul>
<li>ç‚¹å‡»"File" â†’ "Open Heap Dump"</li>
<li>æˆ–è€…ç›´æ¥æ‹–æ‹½hprofæ–‡ä»¶åˆ°MATçª—å£</li>
<li>é€‰æ‹©è½¬æ¢åçš„hprofæ–‡ä»¶ï¼ˆheap-converted.hprofï¼‰</li>
<li>ç‚¹å‡»"Open"</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šç­‰å¾…MATåˆ†æ</strong></p>
<ul>
<li>MATä¼šè‡ªåŠ¨åˆ†æå †è½¬å‚¨æ–‡ä»¶</li>
<li>åˆ†ææ—¶é—´å–å†³äºå †å¤§å°ï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰</li>
<li>åˆ†æå®Œæˆåï¼Œä¼šæ˜¾ç¤ºåˆ†æç»“æœ</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šæŸ¥çœ‹Leak Suspectsï¼ˆæ³„æ¼å«Œç–‘ï¼‰</strong></p>
<ul>
<li>MATä¼šè‡ªåŠ¨æ£€æµ‹å¯èƒ½çš„å†…å­˜æ³„æ¼</li>
<li>ç‚¹å‡»"Leak Suspects"æ ‡ç­¾</li>
<li>æŸ¥çœ‹MATè‡ªåŠ¨ç”Ÿæˆçš„æ³„æ¼æŠ¥å‘Š</li>
<li>æŠ¥å‘Šä¼šæ˜¾ç¤ºå¯ç–‘çš„æ³„æ¼å¯¹è±¡å’Œå¼•ç”¨é“¾</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šä½¿ç”¨Histogramï¼ˆç›´æ–¹å›¾ï¼‰åˆ†æ</strong></p>
<ul>
<li>ç‚¹å‡»"Histogram"æ ‡ç­¾</li>
<li>æŸ¥çœ‹æ‰€æœ‰ç±»çš„å®ä¾‹æ•°é‡å’Œå†…å­˜å ç”¨</li>
<li><strong>æŒ‰å†…å­˜å ç”¨æ’åº</strong>ï¼š
<ul>
<li>ç‚¹å‡»"Retained Heap"åˆ—æ ‡é¢˜ï¼ŒæŒ‰å†…å­˜å ç”¨æ’åº</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
</ul>
</li>
<li><strong>æŸ¥çœ‹ç±»çš„å®ä¾‹</strong>ï¼š
<ul>
<li>åŒå‡»æŸä¸ªç±»ï¼ŒæŸ¥çœ‹è¿™ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹</li>
<li>å¯ä»¥çœ‹åˆ°æ¯ä¸ªå®ä¾‹å ç”¨çš„å†…å­˜</li>
</ul>
</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šä½¿ç”¨Dominator Treeï¼ˆæ”¯é…æ ‘ï¼‰åˆ†æ</strong></p>
<ul>
<li>ç‚¹å‡»"Dominator Tree"æ ‡ç­¾</li>
<li>æŸ¥çœ‹å¯¹è±¡çš„å¼•ç”¨å…³ç³»æ ‘</li>
<li><strong>æŒ‰å†…å­˜å ç”¨æ’åº</strong>ï¼š
<ul>
<li>ç‚¹å‡»"Retained Heap"åˆ—æ ‡é¢˜ï¼ŒæŒ‰å†…å­˜å ç”¨æ’åº</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ul>
</li>
<li><strong>æŸ¥çœ‹å¯¹è±¡çš„å¼•ç”¨å…³ç³»</strong>ï¼š
<ul>
<li>å±•å¼€å¯¹è±¡ï¼Œå¯ä»¥çœ‹åˆ°å®ƒå¼•ç”¨çš„å…¶ä»–å¯¹è±¡</li>
<li>å¯ä»¥æ‰¾åˆ°å“ªäº›å¯¹è±¡æŒæœ‰å¤§é‡å†…å­˜</li>
</ul>
</li>
</ul>
<p><strong>æ­¥éª¤7ï¼šä½¿ç”¨Path to GC Rootsï¼ˆåˆ°GC Rootsçš„è·¯å¾„ï¼‰åˆ†æå¼•ç”¨é“¾</strong></p>
<ul>
<li><strong>é€‰æ‹©å¯¹è±¡</strong>ï¼š
<ul>
<li>åœ¨Histogramæˆ–Dominator Treeä¸­ï¼Œå³é”®ç‚¹å‡»å¯ç–‘å¯¹è±¡</li>
<li>é€‰æ‹©"Path to GC Roots" â†’ "exclude weak references"ï¼ˆæ’é™¤å¼±å¼•ç”¨ï¼‰</li>
</ul>
</li>
<li><strong>æŸ¥çœ‹å¼•ç”¨é“¾</strong>ï¼š
<ul>
<li>MATä¼šæ˜¾ç¤ºå¯¹è±¡åˆ°GC Rootsçš„å®Œæ•´å¼•ç”¨é“¾</li>
<li>å¯ä»¥çœ‹åˆ°æ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
<li>æ‰¾å‡ºæ³„æ¼çš„åŸå› </li>
</ul>
</li>
</ul>
<p><strong>MATåˆ†æå†…å­˜æ³„æ¼çš„å®é™…æ“ä½œç¤ºä¾‹ï¼š</strong></p>
<p><strong>åœºæ™¯ï¼šActivityæ³„æ¼</strong></p>
<p><strong>æ­¥éª¤1ï¼šç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>åœ¨Android Studio Profilerä¸­ç”Ÿæˆå †è½¬å‚¨</li>
<li>å¯¼å‡ºä¸ºheap.hprof</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šè½¬æ¢æ–‡ä»¶</strong></p>
<pre><code class="hljs language-bash" lang="bash">hprof-conv heap.hprof heap-converted.hprof
</code></pre>
<p><strong>æ­¥éª¤3ï¼šç”¨MATæ‰“å¼€</strong></p>
<ul>
<li>ç”¨MATæ‰“å¼€heap-converted.hprof</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šæŸ¥æ‰¾æ³„æ¼çš„Activity</strong></p>
<ul>
<li>æ‰“å¼€Histogram</li>
<li>åœ¨æœç´¢æ¡†è¾“å…¥"Activity"</li>
<li>æ‰¾åˆ°MyActivityç±»</li>
<li>æŸ¥çœ‹å®ä¾‹æ•°é‡ï¼ˆå¦‚æœæœ‰å¤šä¸ªå®ä¾‹ï¼Œå¯èƒ½æœ‰æ³„æ¼ï¼‰</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šåˆ†æå¼•ç”¨é“¾</strong></p>
<ul>
<li>å³é”®ç‚¹å‡»MyActivityå®ä¾‹</li>
<li>é€‰æ‹©"Path to GC Roots" â†’ "exclude weak references"</li>
<li>æŸ¥çœ‹å¼•ç”¨é“¾ï¼Œæ¯”å¦‚ï¼š
<pre><code class="hljs language-scss" lang="scss">MyActivityå®ä¾‹
  â†‘ (è¢«å¼•ç”¨)
static MyActivity<span class="hljs-selector-class">.activity</span> (é™æ€å˜é‡)
  â†‘ (GC Root)
</code></pre>
</li>
<li>æ‰¾å‡ºæ˜¯é™æ€å˜é‡æŒæœ‰Activityå¼•ç”¨</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šå®šä½ä»£ç </strong></p>
<ul>
<li>æ ¹æ®å¼•ç”¨é“¾ï¼Œå®šä½åˆ°ä»£ç ä¸­çš„é™æ€å˜é‡</li>
<li>ä¿®å¤ä»£ç ï¼ˆä½¿ç”¨å¼±å¼•ç”¨æˆ–åŠæ—¶æ¸…ç†ï¼‰</li>
</ul>
<p><strong>MATçš„ä¸»è¦åŠŸèƒ½è¯¦ç»†è¯´æ˜ï¼š</strong></p>
<p><strong>1. Histogramï¼ˆç›´æ–¹å›¾ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæ˜¾ç¤ºæ‰€æœ‰ç±»çš„å®ä¾‹æ•°é‡å’Œå†…å­˜å ç”¨</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"Histogram"è§†å›¾</li>
<li>åœ¨æœç´¢æ¡†è¾“å…¥ç±»åï¼ŒæŸ¥æ‰¾ç‰¹å®šç±»</li>
<li>ç‚¹å‡»åˆ—æ ‡é¢˜æ’åºï¼ˆæ¯”å¦‚æŒ‰"Retained Heap"æ’åºï¼‰</li>
<li>åŒå‡»ç±»åï¼ŒæŸ¥çœ‹è¿™ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹</li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
</ul>
<p><strong>2. Dominator Treeï¼ˆæ”¯é…æ ‘ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæ˜¾ç¤ºå¯¹è±¡çš„å¼•ç”¨å…³ç³»æ ‘ï¼Œæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"Dominator Tree"è§†å›¾</li>
<li>ç‚¹å‡»"Retained Heap"åˆ—æ ‡é¢˜ï¼ŒæŒ‰å†…å­˜å ç”¨æ’åº</li>
<li>å±•å¼€å¯¹è±¡ï¼ŒæŸ¥çœ‹å¼•ç”¨å…³ç³»</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ul>
<p><strong>3. Path to GC Rootsï¼ˆåˆ°GC Rootsçš„è·¯å¾„ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæ˜¾ç¤ºå¯¹è±¡åˆ°GC Rootsçš„å¼•ç”¨é“¾ï¼Œæ‰¾å‡ºä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>å³é”®ç‚¹å‡»å¯ç–‘å¯¹è±¡</li>
<li>é€‰æ‹©"Path to GC Roots"</li>
<li>é€‰æ‹©"exclude weak references"ï¼ˆæ’é™¤å¼±å¼•ç”¨ï¼‰</li>
<li>æŸ¥çœ‹å¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ³„æ¼åŸå› </li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåˆ†æå†…å­˜æ³„æ¼çš„åŸå› </li>
</ul>
<p><strong>4. Leak Suspectsï¼ˆæ³„æ¼å«Œç–‘ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šMATè‡ªåŠ¨æ£€æµ‹å¯èƒ½çš„å†…å­˜æ³„æ¼ï¼Œç”Ÿæˆæ³„æ¼æŠ¥å‘Š</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"Leak Suspects"è§†å›¾</li>
<li>æŸ¥çœ‹MATè‡ªåŠ¨æ£€æµ‹çš„æ³„æ¼æŠ¥å‘Š</li>
<li>æ ¹æ®æŠ¥å‘Šåˆ†ææ³„æ¼åŸå› </li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¿«é€Ÿå®šä½å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>5. OQLï¼ˆObject Query Languageï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šä½¿ç”¨ç±»ä¼¼SQLçš„æŸ¥è¯¢è¯­è¨€æŸ¥è¯¢å¯¹è±¡</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"OQL"è§†å›¾</li>
<li>è¾“å…¥æŸ¥è¯¢è¯­å¥ï¼Œæ¯”å¦‚ï¼š
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> java.lang.String <span class="hljs-keyword">WHERE</span> this.value.length <span class="hljs-operator">&gt;</span> <span class="hljs-number">100</span>
</code></pre>
</li>
<li>æ‰§è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥çœ‹ç»“æœ</li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæŸ¥æ‰¾ç‰¹å®šæ¡ä»¶çš„å¯¹è±¡</li>
</ul>
<p><strong>MATåˆ†ææŠ€å·§ï¼š</strong></p>
<p><strong>1. å¯¹æ¯”å¤šä¸ªå †è½¬å‚¨</strong></p>
<ul>
<li>ç”Ÿæˆå¤šä¸ªæ—¶é—´ç‚¹çš„å †è½¬å‚¨</li>
<li>å¯¹æ¯”åˆ†æï¼Œæ‰¾å‡ºå†…å­˜å¢é•¿çš„åŸå› </li>
<li>å¯ä»¥çœ‹åˆ°å“ªäº›å¯¹è±¡åœ¨å¢é•¿</li>
</ul>
<p><strong>2. ä½¿ç”¨OQLæŸ¥è¯¢</strong></p>
<ul>
<li>ä½¿ç”¨OQLæŸ¥è¯¢ç‰¹å®šå¯¹è±¡</li>
<li>æ¯”å¦‚ï¼šæŸ¥è¯¢æ‰€æœ‰Activityå®ä¾‹</li>
<li>åˆ†æè¿™äº›å¯¹è±¡æ˜¯å¦åº”è¯¥å­˜åœ¨</li>
</ul>
<p><strong>3. å…³æ³¨Retained Heap</strong></p>
<ul>
<li>Retained Heapè¡¨ç¤ºå¯¹è±¡åŠå…¶å¼•ç”¨çš„å¯¹è±¡å ç”¨çš„æ€»å†…å­˜</li>
<li>å…³æ³¨Retained Heapå¤§çš„å¯¹è±¡</li>
<li>è¿™äº›å¯¹è±¡å¯èƒ½æ˜¯å†…å­˜æ³„æ¼çš„æ ¹æº</li>
</ul>
<p><strong>4. æ’é™¤å¼±å¼•ç”¨</strong></p>
<ul>
<li>åœ¨Path to GC Rootsæ—¶ï¼Œé€‰æ‹©"exclude weak references"</li>
<li>å¼±å¼•ç”¨ä¸ä¼šé˜»æ­¢å¯¹è±¡è¢«å›æ”¶ï¼Œå¯ä»¥æ’é™¤</li>
<li>åªå…³æ³¨å¼ºå¼•ç”¨ï¼Œæ‰¾å‡ºçœŸæ­£çš„æ³„æ¼åŸå› </li>
</ul>
<p><strong>å¸¸è§é—®é¢˜ï¼š</strong></p>
<p><strong>1. MATæ— æ³•æ‰“å¼€hprofæ–‡ä»¶</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šAndroidçš„hprofæ ¼å¼ä¸æ ‡å‡†Javaä¸åŒ</li>
<li><strong>è§£å†³</strong>ï¼šä½¿ç”¨hprof-convå·¥å…·è½¬æ¢åå†æ‰“å¼€</li>
</ul>
<p><strong>2. MATåˆ†æå¾ˆæ…¢</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šå †è½¬å‚¨æ–‡ä»¶å¾ˆå¤§</li>
<li><strong>è§£å†³</strong>ï¼šç­‰å¾…åˆ†æå®Œæˆï¼Œæˆ–è€…å‡å°å †è½¬å‚¨å¤§å°</li>
</ul>
<p><strong>3. æ‰¾ä¸åˆ°æ³„æ¼å¯¹è±¡</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šæ³„æ¼å¯¹è±¡å¯èƒ½ä¸åœ¨å½“å‰å †è½¬å‚¨ä¸­</li>
<li><strong>è§£å†³</strong>ï¼šåœ¨åˆé€‚çš„æ—¶æœºç”Ÿæˆå †è½¬å‚¨ï¼Œæˆ–è€…ä½¿ç”¨LeakCanary</li>
</ul>
<p><strong>4. å¼•ç”¨é“¾å¤ªå¤æ‚</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šå¯¹è±¡å¼•ç”¨å…³ç³»å¤æ‚</li>
<li><strong>è§£å†³</strong>ï¼šä»æœ€å¯ç–‘çš„å¯¹è±¡å¼€å§‹åˆ†æï¼Œé€æ­¥ç¼©å°èŒƒå›´</li>
</ul>
<p><strong>MATçš„ä¸»è¦åŠŸèƒ½è¯¦ç»†è¯´æ˜ï¼š</strong></p>
<p><strong>1. Histogramï¼ˆç›´æ–¹å›¾ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæ˜¾ç¤ºæ‰€æœ‰ç±»çš„å®ä¾‹æ•°é‡å’Œå†…å­˜å ç”¨</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"Histogram"è§†å›¾</li>
<li>åœ¨æœç´¢æ¡†è¾“å…¥ç±»åï¼ŒæŸ¥æ‰¾ç‰¹å®šç±»</li>
<li>ç‚¹å‡»åˆ—æ ‡é¢˜æ’åºï¼ˆæ¯”å¦‚æŒ‰"Retained Heap"æ’åºï¼‰</li>
<li>åŒå‡»ç±»åï¼ŒæŸ¥çœ‹è¿™ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹</li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
</ul>
<p><strong>2. Dominator Treeï¼ˆæ”¯é…æ ‘ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæ˜¾ç¤ºå¯¹è±¡çš„å¼•ç”¨å…³ç³»æ ‘ï¼Œæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"Dominator Tree"è§†å›¾</li>
<li>ç‚¹å‡»"Retained Heap"åˆ—æ ‡é¢˜ï¼ŒæŒ‰å†…å­˜å ç”¨æ’åº</li>
<li>å±•å¼€å¯¹è±¡ï¼ŒæŸ¥çœ‹å¼•ç”¨å…³ç³»</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ul>
<p><strong>3. Path to GC Rootsï¼ˆåˆ°GC Rootsçš„è·¯å¾„ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šæ˜¾ç¤ºå¯¹è±¡åˆ°GC Rootsçš„å¼•ç”¨é“¾ï¼Œæ‰¾å‡ºä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>å³é”®ç‚¹å‡»å¯ç–‘å¯¹è±¡</li>
<li>é€‰æ‹©"Path to GC Roots"</li>
<li>é€‰æ‹©"exclude weak references"ï¼ˆæ’é™¤å¼±å¼•ç”¨ï¼‰</li>
<li>æŸ¥çœ‹å¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ³„æ¼åŸå› </li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåˆ†æå†…å­˜æ³„æ¼çš„åŸå› </li>
</ul>
<p><strong>4. Leak Suspectsï¼ˆæ³„æ¼å«Œç–‘ï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šMATè‡ªåŠ¨æ£€æµ‹å¯èƒ½çš„å†…å­˜æ³„æ¼ï¼Œç”Ÿæˆæ³„æ¼æŠ¥å‘Š</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"Leak Suspects"è§†å›¾</li>
<li>æŸ¥çœ‹MATè‡ªåŠ¨æ£€æµ‹çš„æ³„æ¼æŠ¥å‘Š</li>
<li>æ ¹æ®æŠ¥å‘Šåˆ†ææ³„æ¼åŸå› </li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¿«é€Ÿå®šä½å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>5. OQLï¼ˆObject Query Languageï¼‰</strong></p>
<ul>
<li><strong>ä½œç”¨</strong>ï¼šä½¿ç”¨ç±»ä¼¼SQLçš„æŸ¥è¯¢è¯­è¨€æŸ¥è¯¢å¯¹è±¡</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼š
<ol>
<li>æ‰“å¼€"OQL"è§†å›¾</li>
<li>è¾“å…¥æŸ¥è¯¢è¯­å¥ï¼Œæ¯”å¦‚ï¼š
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> java.lang.String <span class="hljs-keyword">WHERE</span> this.value.length <span class="hljs-operator">&gt;</span> <span class="hljs-number">100</span>
</code></pre>
</li>
<li>æ‰§è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥çœ‹ç»“æœ</li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæŸ¥æ‰¾ç‰¹å®šæ¡ä»¶çš„å¯¹è±¡</li>
</ul>
<p><strong>MATåˆ†æå†…å­˜æ³„æ¼çš„è¯¦ç»†æ­¥éª¤ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šæ‰“å¼€å †è½¬å‚¨æ–‡ä»¶</strong></p>
<ul>
<li>ç”¨MATæ‰“å¼€è½¬æ¢åçš„hprofæ–‡ä»¶</li>
<li>ç­‰å¾…MATåˆ†æå®Œæˆï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šæŸ¥çœ‹Leak Suspectsï¼ˆæ¨èå…ˆçœ‹è¿™ä¸ªï¼‰</strong></p>
<ul>
<li>æ‰“å¼€"Leak Suspects"æ ‡ç­¾</li>
<li>æŸ¥çœ‹MATè‡ªåŠ¨æ£€æµ‹çš„æ³„æ¼æŠ¥å‘Š</li>
<li>æŠ¥å‘Šä¼šæ˜¾ç¤ºå¯ç–‘çš„æ³„æ¼å¯¹è±¡å’Œå¼•ç”¨é“¾</li>
<li>æ ¹æ®æŠ¥å‘Šå¿«é€Ÿå®šä½é—®é¢˜</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šä½¿ç”¨Histogramæ‰¾å‡ºå¤§å¯¹è±¡</strong></p>
<ul>
<li>æ‰“å¼€"Histogram"è§†å›¾</li>
<li>ç‚¹å‡»"Retained Heap"åˆ—æ ‡é¢˜ï¼ŒæŒ‰å†…å­˜å ç”¨æ’åº</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li>åŒå‡»ç±»åï¼ŒæŸ¥çœ‹è¿™ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šä½¿ç”¨Dominator Treeåˆ†æå¯¹è±¡å…³ç³»</strong></p>
<ul>
<li>æ‰“å¼€"Dominator Tree"è§†å›¾</li>
<li>ç‚¹å‡»"Retained Heap"åˆ—æ ‡é¢˜ï¼ŒæŒ‰å†…å­˜å ç”¨æ’åº</li>
<li>æŸ¥çœ‹å ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li>å±•å¼€å¯¹è±¡ï¼ŒæŸ¥çœ‹å¼•ç”¨å…³ç³»</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šä½¿ç”¨Path to GC Rootsåˆ†æå¼•ç”¨é“¾</strong></p>
<ul>
<li>åœ¨Histogramæˆ–Dominator Treeä¸­ï¼Œå³é”®ç‚¹å‡»å¯ç–‘å¯¹è±¡</li>
<li>é€‰æ‹©"Path to GC Roots" â†’ "exclude weak references"</li>
<li>æŸ¥çœ‹å¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
<li>åˆ†æä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šåˆ†ææ³„æ¼åŸå› </strong></p>
<ul>
<li>æ ¹æ®å¼•ç”¨é“¾æ‰¾å‡ºæ³„æ¼åŸå› </li>
<li>å¸¸è§åŸå› ï¼š
<ul>
<li>é™æ€å˜é‡æŒæœ‰</li>
<li>ç›‘å¬å™¨æœªå–æ¶ˆæ³¨å†Œ</li>
<li>é›†åˆç±»æ³„æ¼</li>
<li>å…¶ä»–åŸå› </li>
</ul>
</li>
</ul>
<p><strong>æ­¥éª¤7ï¼šå®šä½ä»£ç å¹¶ä¿®å¤</strong></p>
<ul>
<li>æ ¹æ®å¼•ç”¨é“¾ï¼Œå®šä½åˆ°ä»£ç ä¸­çš„é—®é¢˜</li>
<li>ä¿®å¤ä»£ç ï¼ˆä½¿ç”¨å¼±å¼•ç”¨ã€åŠæ—¶æ¸…ç†ç­‰ï¼‰</li>
</ul>
<p><strong>MATåˆ†ææŠ€å·§ï¼š</strong></p>
<p><strong>1. å¯¹æ¯”å¤šä¸ªå †è½¬å‚¨</strong></p>
<ul>
<li>ç”Ÿæˆå¤šä¸ªæ—¶é—´ç‚¹çš„å †è½¬å‚¨</li>
<li>å¯¹æ¯”åˆ†æï¼Œæ‰¾å‡ºå†…å­˜å¢é•¿çš„åŸå› </li>
<li>å¯ä»¥çœ‹åˆ°å“ªäº›å¯¹è±¡åœ¨å¢é•¿</li>
</ul>
<p><strong>2. ä½¿ç”¨OQLæŸ¥è¯¢</strong></p>
<ul>
<li>ä½¿ç”¨OQLæŸ¥è¯¢ç‰¹å®šå¯¹è±¡</li>
<li>æ¯”å¦‚ï¼šæŸ¥è¯¢æ‰€æœ‰Activityå®ä¾‹</li>
<li>åˆ†æè¿™äº›å¯¹è±¡æ˜¯å¦åº”è¯¥å­˜åœ¨</li>
</ul>
<p><strong>3. å…³æ³¨Retained Heap</strong></p>
<ul>
<li>Retained Heapè¡¨ç¤ºå¯¹è±¡åŠå…¶å¼•ç”¨çš„å¯¹è±¡å ç”¨çš„æ€»å†…å­˜</li>
<li>å…³æ³¨Retained Heapå¤§çš„å¯¹è±¡</li>
<li>è¿™äº›å¯¹è±¡å¯èƒ½æ˜¯å†…å­˜æ³„æ¼çš„æ ¹æº</li>
</ul>
<p><strong>4. æ’é™¤å¼±å¼•ç”¨</strong></p>
<ul>
<li>åœ¨Path to GC Rootsæ—¶ï¼Œé€‰æ‹©"exclude weak references"</li>
<li>å¼±å¼•ç”¨ä¸ä¼šé˜»æ­¢å¯¹è±¡è¢«å›æ”¶ï¼Œå¯ä»¥æ’é™¤</li>
<li>åªå…³æ³¨å¼ºå¼•ç”¨ï¼Œæ‰¾å‡ºçœŸæ­£çš„æ³„æ¼åŸå› </li>
</ul>
<p><strong>MATå®é™…æ“ä½œç¤ºä¾‹ï¼š</strong></p>
<p><strong>åœºæ™¯ï¼šåˆ†æActivityæ³„æ¼</strong></p>
<p><strong>æ­¥éª¤1ï¼šåœ¨Android Studioä¸­ç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>æ‰“å¼€Profiler</li>
<li>é€‰æ‹©åº”ç”¨è¿›ç¨‹</li>
<li>ç‚¹å‡»"Heap Dump"æŒ‰é’®</li>
<li>ç­‰å¾…ç”Ÿæˆå®Œæˆ</li>
<li>ç‚¹å‡»"Export heap dump"å¯¼å‡ºä¸ºheap.hprof</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šè½¬æ¢hprofæ–‡ä»¶</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ‰¾åˆ°hprof-convå·¥å…·ï¼ˆåœ¨Android SDKçš„platform-toolsç›®å½•ï¼‰</span>
<span class="hljs-comment"># Windows</span>
C:\Users\ä½ çš„ç”¨æˆ·å\AppData\Local\Android\Sdk\platform-tools\hprof-conv.exe heap.hprof heap-converted.hprof

<span class="hljs-comment"># Mac/Linux</span>
~/Library/Android/sdk/platform-tools/hprof-conv heap.hprof heap-converted.hprof
</code></pre>
<p><strong>æ­¥éª¤3ï¼šç”¨MATæ‰“å¼€</strong></p>
<ul>
<li>æ‰“å¼€MAT</li>
<li>ç‚¹å‡»"File" â†’ "Open Heap Dump"</li>
<li>é€‰æ‹©heap-converted.hprof</li>
<li>ç­‰å¾…åˆ†æå®Œæˆ</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šæŸ¥æ‰¾æ³„æ¼çš„Activity</strong></p>
<ul>
<li>æ‰“å¼€"Histogram"è§†å›¾</li>
<li>åœ¨æœç´¢æ¡†è¾“å…¥"Activity"</li>
<li>æ‰¾åˆ°MyActivityç±»</li>
<li>æŸ¥çœ‹å®ä¾‹æ•°é‡ï¼ˆæ­£å¸¸åº”è¯¥æ˜¯0æˆ–1ï¼Œå¦‚æœæœ‰å¤šä¸ªï¼Œå¯èƒ½æœ‰æ³„æ¼ï¼‰</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šåˆ†æå¼•ç”¨é“¾</strong></p>
<ul>
<li>å³é”®ç‚¹å‡»MyActivityå®ä¾‹</li>
<li>é€‰æ‹©"Path to GC Roots" â†’ "exclude weak references"</li>
<li>æŸ¥çœ‹å¼•ç”¨é“¾ï¼š
<pre><code class="hljs language-scss" lang="scss">MyActivityå®ä¾‹
  â†‘ (è¢«å¼•ç”¨)
static MyActivity<span class="hljs-selector-class">.activity</span> (é™æ€å˜é‡)
  â†‘ (GC Root)
</code></pre>
</li>
<li>æ‰¾å‡ºæ˜¯é™æ€å˜é‡æŒæœ‰Activityå¼•ç”¨</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šå®šä½ä»£ç </strong></p>
<ul>
<li>æ ¹æ®å¼•ç”¨é“¾ï¼Œå®šä½åˆ°ä»£ç ä¸­çš„é™æ€å˜é‡</li>
<li>ä¿®å¤ä»£ç ï¼š
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Activity activity;

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨å¼±å¼•ç”¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> WeakReference&lt;Activity&gt; activityRef;
</code></pre>
</li>
</ul>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>è¯¦ç»†åˆ†æå†…å­˜æ³„æ¼</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li>åˆ†æå¯¹è±¡å¼•ç”¨å…³ç³»</li>
<li>æ’æŸ¥OOMé—®é¢˜</li>
<li>ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
</ul>
<h4 data-id="heading-67">5.1.5 LeakCanaryï¼ˆè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼ï¼‰</h4>
<p><strong>ä½œç”¨ï¼š</strong> è‡ªåŠ¨æ£€æµ‹åº”ç”¨ä¸­çš„å†…å­˜æ³„æ¼ï¼Œæ— éœ€æ‰‹åŠ¨åˆ†æ</p>
<p><strong>LeakCanaryæ˜¯ä»€ä¹ˆï¼š</strong></p>
<ul>
<li>Squareå…¬å¸å¼€å‘çš„å†…å­˜æ³„æ¼æ£€æµ‹åº“</li>
<li>ä¸“é—¨ç”¨äºAndroidåº”ç”¨çš„å†…å­˜æ³„æ¼æ£€æµ‹</li>
<li>åœ¨å¼€å‘é˜¶æ®µè‡ªåŠ¨æ£€æµ‹ï¼Œå‘ç°æ³„æ¼æ—¶æ˜¾ç¤ºé€šçŸ¥</li>
</ul>
<p><strong>æ ¸å¿ƒæ£€æµ‹åŸç†ï¼ˆè¯¦ç»†è¯´æ˜ï¼‰ï¼š</strong></p>
<p>LeakCanaryçš„æ£€æµ‹åŸç†åŸºäº**WeakReferenceï¼ˆå¼±å¼•ç”¨ï¼‰å’ŒReferenceQueueï¼ˆå¼•ç”¨é˜Ÿåˆ—ï¼‰**çš„æœºåˆ¶ã€‚</p>
<p><strong>1. WeakReferenceï¼ˆå¼±å¼•ç”¨ï¼‰çš„å·¥ä½œåŸç†</strong></p>
<p><strong>ä»€ä¹ˆæ˜¯WeakReferenceï¼š</strong></p>
<ul>
<li>WeakReferenceæ˜¯Javaä¸­çš„ä¸€ç§å¼•ç”¨ç±»å‹</li>
<li>å¼±å¼•ç”¨ä¸ä¼šé˜»æ­¢å¯¹è±¡è¢«GCå›æ”¶</li>
<li>å½“å¯¹è±¡åªæœ‰å¼±å¼•ç”¨æ—¶ï¼ŒGCä¼šå›æ”¶è¿™ä¸ªå¯¹è±¡</li>
</ul>
<p><strong>WeakReferenceçš„ç‰¹ç‚¹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆ›å»ºå¼±å¼•ç”¨</span>
WeakReference&lt;Activity&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);

<span class="hljs-comment">// è·å–å¯¹è±¡ï¼ˆå¯èƒ½è¿”å›nullï¼Œå¦‚æœå¯¹è±¡å·²è¢«å›æ”¶ï¼‰</span>
<span class="hljs-type">Activity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> ref.get();

<span class="hljs-comment">// å¦‚æœactivityè¢«GCå›æ”¶ï¼Œref.get()ä¼šè¿”å›null</span>
</code></pre>
<p><strong>2. ReferenceQueueï¼ˆå¼•ç”¨é˜Ÿåˆ—ï¼‰çš„å·¥ä½œåŸç†</strong></p>
<p><strong>ä»€ä¹ˆæ˜¯ReferenceQueueï¼š</strong></p>
<ul>
<li>ReferenceQueueæ˜¯Javaä¸­çš„å¼•ç”¨é˜Ÿåˆ—</li>
<li>å½“WeakReferenceå¼•ç”¨çš„å¯¹è±¡è¢«GCå›æ”¶æ—¶ï¼ŒWeakReferenceä¼šè¢«æ”¾å…¥ReferenceQueue</li>
<li>é€šè¿‡æ£€æŸ¥ReferenceQueueï¼Œå¯ä»¥çŸ¥é“å¯¹è±¡æ˜¯å¦è¢«å›æ”¶</li>
</ul>
<p><strong>ReferenceQueueçš„å·¥ä½œæµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-number">1.</span> åˆ›å»ºWeakReferenceæ—¶ï¼Œå¯ä»¥æŒ‡å®šReferenceQueue
   WeakReference&lt;Activity&gt; ref = <span class="hljs-keyword">new</span> WeakReference&lt;&gt;(activity, queue);

<span class="hljs-number">2.</span> å½“activityè¢«GCå›æ”¶æ—¶ï¼Œrefä¼šè¢«è‡ªåŠ¨æ”¾å…¥queue

<span class="hljs-number">3.</span> æ£€æŸ¥queueï¼Œå¦‚æœrefåœ¨queueä¸­ï¼Œè¯´æ˜activityå·²è¢«å›æ”¶
   Reference&lt;?&gt; polled = queue.<span class="hljs-built_in">poll</span>();
   <span class="hljs-keyword">if</span> (polled != null) {
       <span class="hljs-comment">// å¯¹è±¡å·²è¢«å›æ”¶</span>
   }
</code></pre>
<p><strong>3. LeakCanaryçš„å®Œæ•´æ£€æµ‹æµç¨‹</strong></p>
<p><strong>ç¬¬ä¸€æ­¥ï¼šç›‘æ§å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ</strong></p>
<ul>
<li>LeakCanaryé€šè¿‡Application.ActivityLifecycleCallbacksç›‘æ§Activityçš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>å½“Activityçš„onDestroy()è¢«è°ƒç”¨æ—¶ï¼ŒLeakCanaryå¼€å§‹æ£€æµ‹</li>
</ul>
<p><strong>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºå¼±å¼•ç”¨å’Œå¼•ç”¨é˜Ÿåˆ—</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// LeakCanaryå†…éƒ¨å®ç°ï¼ˆç®€åŒ–ï¼‰</span>
ReferenceQueue&lt;Activity&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceQueue</span>&lt;&gt;();
WeakReference&lt;Activity&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity, queue);
</code></pre>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šç­‰å¾…GC</strong></p>
<ul>
<li>LeakCanaryç­‰å¾…5ç§’ï¼ˆç»™GCæ—¶é—´ï¼‰</li>
<li>ç„¶åè§¦å‘ä¸€æ¬¡GCï¼ˆSystem.gc()ï¼‰</li>
<li>å†ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè®©GCå®Œæˆ</li>
</ul>
<p><strong>ç¬¬å››æ­¥ï¼šæ£€æŸ¥å¯¹è±¡æ˜¯å¦è¢«å›æ”¶</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ£€æŸ¥ReferenceQueue</span>
Reference&lt;?&gt; polled = queue.poll();
<span class="hljs-keyword">if</span> (polled != <span class="hljs-literal">null</span>) {
    <span class="hljs-comment">// å¯¹è±¡å·²è¢«å›æ”¶ï¼Œæ²¡æœ‰å†…å­˜æ³„æ¼</span>
} <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// å¯¹è±¡æ²¡æœ‰è¢«å›æ”¶ï¼Œå¯èƒ½æœ‰å†…å­˜æ³„æ¼</span>
    <span class="hljs-comment">// éœ€è¦è¿›ä¸€æ­¥ç¡®è®¤</span>
}
</code></pre>
<p><strong>ç¬¬äº”æ­¥ï¼šç¡®è®¤å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>å¦‚æœå¯¹è±¡æ²¡æœ‰è¢«å›æ”¶ï¼ŒLeakCanaryä¼šå†æ¬¡è§¦å‘GC</li>
<li>å¦‚æœå¤šæ¬¡GCåå¯¹è±¡ä»ç„¶æ²¡æœ‰è¢«å›æ”¶ï¼Œç¡®è®¤æœ‰å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>ç¬¬å…­æ­¥ï¼šç”Ÿæˆå †è½¬å‚¨å¹¶åˆ†æ</strong></p>
<ul>
<li>å¦‚æœç¡®è®¤æœ‰å†…å­˜æ³„æ¼ï¼ŒLeakCanaryä¼šç”Ÿæˆå †è½¬å‚¨</li>
<li>åˆ†æå¯¹è±¡çš„å¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
<li>æ˜¾ç¤ºæ³„æ¼è·¯å¾„ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®šä½é—®é¢˜</li>
</ul>
<p><strong>å®Œæ•´æ£€æµ‹æµç¨‹ï¼ˆæ—¶é—´çº¿ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">æ—¶é—´ç‚¹<span class="hljs-number">0</span>ï¼šActivity.<span class="hljs-built_in">onDestroy</span>()è¢«è°ƒç”¨
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">1</span>ï¼šLeakCanaryåˆ›å»ºWeakReferenceæŒ‡å‘Activity
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">2</span>ï¼šç­‰å¾…<span class="hljs-number">5</span>ç§’ï¼ˆç»™GCæ—¶é—´ï¼‰
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">3</span>ï¼šè§¦å‘GCï¼ˆSystem.<span class="hljs-built_in">gc</span>()ï¼‰
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">4</span>ï¼šç­‰å¾…GCå®Œæˆ
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">5</span>ï¼šæ£€æŸ¥ReferenceQueue
         â†“
         â”œâ”€ å¦‚æœrefåœ¨queueä¸­ â†’ Activityå·²è¢«å›æ”¶ â†’ æ²¡æœ‰æ³„æ¼
         â””â”€ å¦‚æœrefä¸åœ¨queueä¸­ â†’ Activityæ²¡æœ‰è¢«å›æ”¶ â†’ å¯èƒ½æœ‰æ³„æ¼
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">6</span>ï¼šå¦‚æœå¯èƒ½æœ‰æ³„æ¼ï¼Œå†æ¬¡è§¦å‘GCç¡®è®¤
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">7</span>ï¼šå¦‚æœç¡®è®¤æ³„æ¼ï¼Œç”Ÿæˆå †è½¬å‚¨å¹¶åˆ†æ
         â†“
æ—¶é—´ç‚¹<span class="hljs-number">8</span>ï¼šæ˜¾ç¤ºæ³„æ¼é€šçŸ¥å’Œæ³„æ¼è·¯å¾„
</code></pre>
<p><strong>æ ¸å¿ƒä»£ç åŸç†ï¼ˆè¯¦ç»†ç‰ˆï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// LeakCanaryçš„æ ¸å¿ƒåŸç†ï¼ˆè¯¦ç»†ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeakCanary</span> {
    <span class="hljs-keyword">private</span> ReferenceQueue&lt;Object&gt; queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReferenceQueue</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">watch</span><span class="hljs-params">(Object object)</span> {
        <span class="hljs-comment">// 1. åˆ›å»ºå¼±å¼•ç”¨ï¼ŒæŒ‡å®šå¼•ç”¨é˜Ÿåˆ—</span>
        WeakReference&lt;Object&gt; ref = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(object, queue);
        
        <span class="hljs-comment">// 2. ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç»™GCæ—¶é—´</span>
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">5000</span>);  <span class="hljs-comment">// ç­‰å¾…5ç§’</span>
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        
        <span class="hljs-comment">// 3. è§¦å‘GC</span>
        System.gc();
        
        <span class="hljs-comment">// 4. å†ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè®©GCå®Œæˆ</span>
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">1000</span>);  <span class="hljs-comment">// ç­‰å¾…1ç§’</span>
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        
        <span class="hljs-comment">// 5. æ£€æŸ¥ReferenceQueue</span>
        Reference&lt;?&gt; polled = queue.poll();
        <span class="hljs-keyword">if</span> (polled != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å¯¹è±¡å·²è¢«å›æ”¶ï¼Œæ²¡æœ‰å†…å­˜æ³„æ¼</span>
            <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-comment">// 6. å¦‚æœå¯¹è±¡æ²¡æœ‰è¢«å›æ”¶ï¼Œå†æ¬¡ç¡®è®¤</span>
        <span class="hljs-keyword">if</span> (ref.get() != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å¯¹è±¡æ²¡æœ‰è¢«å›æ”¶ï¼Œç¡®è®¤æœ‰å†…å­˜æ³„æ¼</span>
            <span class="hljs-comment">// ç”Ÿæˆå †è½¬å‚¨å¹¶åˆ†æ</span>
            analyzeLeak(object);
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">analyzeLeak</span><span class="hljs-params">(Object object)</span> {
        <span class="hljs-comment">// ç”Ÿæˆå †è½¬å‚¨</span>
        <span class="hljs-type">HeapDump</span> <span class="hljs-variable">heapDump</span> <span class="hljs-operator">=</span> generateHeapDump();
        
        <span class="hljs-comment">// åˆ†æå¼•ç”¨é“¾</span>
        <span class="hljs-type">LeakTrace</span> <span class="hljs-variable">leakTrace</span> <span class="hljs-operator">=</span> findLeakTrace(heapDump, object);
        
        <span class="hljs-comment">// æ˜¾ç¤ºæ³„æ¼é€šçŸ¥</span>
        showLeakNotification(leakTrace);
    }
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆWeakReferenceèƒ½æ£€æµ‹å†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<p><strong>åŸç†è¯´æ˜ï¼š</strong></p>
<ol>
<li>
<p><strong>æ­£å¸¸æƒ…å†µï¼ˆæ²¡æœ‰æ³„æ¼ï¼‰</strong>ï¼š</p>
<ul>
<li>Activity.onDestroy()åï¼ŒActivityåº”è¯¥ä¸å†è¢«å¼•ç”¨</li>
<li>GCæ—¶ï¼ŒActivityä¼šè¢«å›æ”¶</li>
<li>WeakReferenceä¼šè¢«æ”¾å…¥ReferenceQueue</li>
<li>æ£€æŸ¥ReferenceQueueï¼Œå‘ç°refåœ¨queueä¸­ï¼Œè¯´æ˜Activityå·²è¢«å›æ”¶</li>
</ul>
</li>
<li>
<p><strong>å¼‚å¸¸æƒ…å†µï¼ˆæœ‰æ³„æ¼ï¼‰</strong>ï¼š</p>
<ul>
<li>Activity.onDestroy()åï¼ŒActivityä»ç„¶è¢«æŸä¸ªå¯¹è±¡å¼•ç”¨ï¼ˆæ¯”å¦‚é™æ€å˜é‡ï¼‰</li>
<li>GCæ—¶ï¼ŒActivityå› ä¸ºæœ‰å¼ºå¼•ç”¨ï¼Œä¸ä¼šè¢«å›æ”¶</li>
<li>WeakReferenceä¸ä¼šè¢«æ”¾å…¥ReferenceQueue</li>
<li>æ£€æŸ¥ReferenceQueueï¼Œå‘ç°refä¸åœ¨queueä¸­ï¼Œè¯´æ˜Activityæ²¡æœ‰è¢«å›æ”¶</li>
<li>ç¡®è®¤æœ‰å†…å­˜æ³„æ¼</li>
</ul>
</li>
</ol>
<p><strong>å¼•ç”¨é“¾åˆ†æåŸç†ï¼š</strong></p>
<p>å½“LeakCanaryç¡®è®¤æœ‰å†…å­˜æ³„æ¼åï¼Œä¼šï¼š</p>
<ol>
<li><strong>ç”Ÿæˆå †è½¬å‚¨</strong>ï¼šä¿å­˜å½“å‰æ‰€æœ‰å¯¹è±¡çš„å†…å­˜å¿«ç…§</li>
<li><strong>åˆ†æå¼•ç”¨é“¾</strong>ï¼šä»æ³„æ¼å¯¹è±¡å¼€å§‹ï¼Œå‘ä¸ŠæŸ¥æ‰¾å¼•ç”¨é“¾</li>
<li><strong>æ‰¾å‡ºæ³„æ¼è·¯å¾„</strong>ï¼šæ‰¾å‡ºæ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å†…å­˜æ³„æ¼ç¤ºä¾‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Activity</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Activity activity;  <span class="hljs-comment">// é™æ€å˜é‡æŒæœ‰Activity</span>
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
        activity = <span class="hljs-built_in">this</span>;  <span class="hljs-comment">// å†…å­˜æ³„æ¼</span>
    }
}

<span class="hljs-comment">// LeakCanaryåˆ†æçš„å¼•ç”¨é“¾ï¼š</span>
<span class="hljs-comment">// MyActivityå®ä¾‹</span>
<span class="hljs-comment">//   â†‘ (è¢«å¼•ç”¨)</span>
<span class="hljs-comment">// static MyActivity.activity (é™æ€å˜é‡)</span>
<span class="hljs-comment">//   â†‘ (GC Root)</span>
<span class="hljs-comment">// </span>
<span class="hljs-comment">// æ³„æ¼è·¯å¾„ï¼šstatic MyActivity.activity -&gt; MyActivityå®ä¾‹</span>
</code></pre>
<p><strong>å¦‚ä½•ä½¿ç”¨ï¼š</strong></p>
<p><strong>1. æ·»åŠ ä¾èµ–</strong></p>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    debugImplementation 'com.squareup.leakcanary:leakcanary-android:2.12'
}
</code></pre>
<p><strong>2. è¿è¡Œåº”ç”¨</strong></p>
<ul>
<li>LeakCanaryä¼šè‡ªåŠ¨é›†æˆåˆ°åº”ç”¨ä¸­</li>
<li>ä¸éœ€è¦é¢å¤–é…ç½®</li>
<li>ä¼šè‡ªåŠ¨ç›‘æ§Activityå’ŒFragment</li>
</ul>
<p><strong>3. è‡ªåŠ¨æ£€æµ‹</strong></p>
<ul>
<li>LeakCanaryä¼šè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>å‘ç°æ³„æ¼æ—¶ä¼šæ˜¾ç¤ºé€šçŸ¥</li>
<li>ç‚¹å‡»é€šçŸ¥å¯ä»¥æŸ¥çœ‹æ³„æ¼è·¯å¾„</li>
</ul>
<p><strong>4. æŸ¥çœ‹æ³„æ¼æŠ¥å‘Š</strong></p>
<ul>
<li>LeakCanaryä¼šæ˜¾ç¤ºæ³„æ¼è·¯å¾„</li>
<li>å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°æ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
<li>æ ¹æ®æ³„æ¼è·¯å¾„å¿«é€Ÿå®šä½é—®é¢˜</li>
</ul>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>è‡ªåŠ¨æ£€æµ‹</strong>ï¼šä¸éœ€è¦æ‰‹åŠ¨åˆ†æï¼Œè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼</li>
<li><strong>å¿«é€Ÿå‘ç°</strong>ï¼šèƒ½å¿«é€Ÿå‘ç°å†…å­˜æ³„æ¼ï¼Œæé«˜å¼€å‘æ•ˆç‡</li>
<li><strong>è¯¦ç»†è·¯å¾„</strong>ï¼šæ˜¾ç¤ºæ³„æ¼è·¯å¾„ï¼Œæ–¹ä¾¿å®šä½é—®é¢˜</li>
<li><strong>é€‚åˆå¼€å‘é˜¶æ®µ</strong>ï¼šåœ¨å¼€å‘é˜¶æ®µä½¿ç”¨ï¼ŒåŠæ—¶å‘ç°é—®é¢˜</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p>
<ul>
<li>LeakCanaryåªåœ¨debugç‰ˆæœ¬ä¸­ä½¿ç”¨</li>
<li>ä¸è¦åœ¨ç”Ÿäº§ç‰ˆæœ¬ä¸­ä½¿ç”¨ï¼ˆä¼šå½±å“æ€§èƒ½ï¼‰</li>
<li>LeakCanaryä¼šæ¶ˆè€—ä¸€å®šçš„å†…å­˜å’ŒCPUèµ„æº</li>
</ul>
<h4 data-id="heading-68">5.2 GCé—®é¢˜æ’æŸ¥æ–¹æ³•</h4>
<p><strong>è¯´æ˜ï¼šè¿™éƒ¨åˆ†ä»‹ç»å¦‚ä½•æ’æŸ¥å¸¸è§çš„GCé—®é¢˜ï¼ŒåŒ…æ‹¬è¯†åˆ«ã€åŸå› åˆ†æã€æ’æŸ¥æ­¥éª¤å’Œè§£å†³æ–¹æ¡ˆ</strong></p>
<h4 data-id="heading-69">5.2.1 GCé¢‘ç¹é—®é¢˜æ’æŸ¥</h4>
<p><strong>é—®é¢˜æè¿°ï¼š</strong> GCè§¦å‘è¿‡äºé¢‘ç¹ï¼Œå½±å“åº”ç”¨æ€§èƒ½</p>
<p><strong>å¦‚ä½•è¯†åˆ«ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šé€šè¿‡logcatæŸ¥çœ‹GCæ—¥å¿—</strong></p>
<ul>
<li>ä½¿ç”¨<code>adb logcat | grep GC</code>æŸ¥çœ‹GCæ—¥å¿—</li>
<li>ç»Ÿè®¡ä¸€æ®µæ—¶é—´å†…GCçš„æ¬¡æ•°</li>
<li>å¦‚æœGCè¿‡äºé¢‘ç¹ï¼ˆæ¯”å¦‚æ¯ç§’å¤šæ¬¡ï¼‰ï¼Œè¯´æ˜æœ‰é—®é¢˜</li>
</ul>
<p><strong>æ–¹æ³•2ï¼šé€šè¿‡ProfileræŸ¥çœ‹GCäº‹ä»¶</strong></p>
<ul>
<li>åœ¨Android Studio Profilerä¸­æŸ¥çœ‹å†…å­˜æ›²çº¿</li>
<li>è§‚å¯ŸGCäº‹ä»¶çš„é¢‘ç‡</li>
<li>å¦‚æœGCäº‹ä»¶å¯†é›†ï¼Œè¯´æ˜GCé¢‘ç¹</li>
</ul>
<p><strong>åˆ¤æ–­æ ‡å‡†ï¼š</strong></p>
<ul>
<li><strong>æ­£å¸¸æƒ…å†µ</strong>ï¼šGCé¢‘ç‡è¾ƒä½ï¼ˆæ¯”å¦‚å‡ ç§’ä¸€æ¬¡ï¼‰</li>
<li><strong>å¼‚å¸¸æƒ…å†µ</strong>ï¼šGCé¢‘ç‡å¾ˆé«˜ï¼ˆæ¯”å¦‚æ¯ç§’å¤šæ¬¡ï¼‰</li>
<li><strong>ä¸¥é‡æƒ…å†µ</strong>ï¼šGCå‡ ä¹ä¸é—´æ–­ï¼Œä¸¥é‡å½±å“æ€§èƒ½</li>
</ul>
<p><strong>å¯èƒ½çš„åŸå› ï¼š</strong></p>
<p><strong>1. é¢‘ç¹åˆ›å»ºå¯¹è±¡</strong></p>
<ul>
<li>ä»£ç ä¸­é¢‘ç¹åˆ›å»ºå¯¹è±¡</li>
<li>æ¯”å¦‚ï¼šå¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡ã€åˆ—è¡¨æ»‘åŠ¨æ—¶åˆ›å»ºå¯¹è±¡</li>
<li>å¯¼è‡´å¹´è½»ä»£å¿«é€Ÿå¡«æ»¡ï¼Œé¢‘ç¹è§¦å‘Partial GC</li>
</ul>
<p><strong>2. å†…å­˜æ³„æ¼å¯¼è‡´å†…å­˜ä¸è¶³</strong></p>
<ul>
<li>å†…å­˜æ³„æ¼å¯¼è‡´å†…å­˜é€æ¸è¢«å ç”¨</li>
<li>å†…å­˜ä¸è¶³æ—¶ï¼Œç³»ç»Ÿé¢‘ç¹è§¦å‘GCå°è¯•å›æ”¶å†…å­˜</li>
<li>ä½†æ³„æ¼çš„å¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼ŒGCæ— æ•ˆ</li>
</ul>
<p><strong>3. å¹´è½»ä»£è®¾ç½®å¤ªå°ï¼ˆç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼Œé€šå¸¸ä¸æ˜¯é—®é¢˜ï¼‰</strong></p>
<ul>
<li>å¹´è½»ä»£å¤ªå°ï¼Œå®¹æ˜“å¡«æ»¡</li>
<li>å¡«æ»¡åé¢‘ç¹è§¦å‘Partial GC</li>
</ul>
<p><strong>4. å¤§å¯¹è±¡é¢‘ç¹åˆ†é…</strong></p>
<ul>
<li>é¢‘ç¹åˆ›å»ºå¤§å¯¹è±¡ï¼ˆæ¯”å¦‚å¤§å›¾ç‰‡ï¼‰</li>
<li>å¤§å¯¹è±¡å¯èƒ½ç›´æ¥è¿›å…¥è€å¹´ä»£</li>
<li>å¯¼è‡´è€å¹´ä»£å¿«é€Ÿå¡«æ»¡ï¼Œé¢‘ç¹è§¦å‘Full GC</li>
</ul>
<p><strong>è¯¦ç»†æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šæŸ¥çœ‹GCæ—¥å¿—ï¼Œç¡®è®¤GCé¢‘ç‡</strong></p>
<ul>
<li>ä½¿ç”¨logcatæŸ¥çœ‹GCæ—¥å¿—</li>
<li>ç»Ÿè®¡GCé¢‘ç‡ï¼ˆæ¯”å¦‚ï¼š10ç§’å†…è§¦å‘äº†å‡ æ¬¡GCï¼‰</li>
<li>è®°å½•GCç±»å‹ï¼ˆPartial GCè¿˜æ˜¯Full GCï¼‰</li>
<li>è®°å½•GCè€—æ—¶</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šä½¿ç”¨ProfileræŸ¥çœ‹å¯¹è±¡åˆ†é…æƒ…å†µ</strong></p>
<ul>
<li>ä½¿ç”¨Profilerçš„"Allocation Tracking"åŠŸèƒ½</li>
<li>è®°å½•ä¸€æ®µæ—¶é—´å†…çš„å¯¹è±¡åˆ†é…</li>
<li>æŸ¥çœ‹å“ªäº›å¯¹è±¡è¢«é¢‘ç¹åˆ†é…</li>
<li>æŸ¥çœ‹å¯¹è±¡åˆ†é…çš„è°ƒç”¨æ ˆ</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šæ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹</strong></p>
<ul>
<li>æ ¹æ®Profilerçš„åˆ†é…è®°å½•ï¼Œæ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„ä»£ç ä½ç½®</li>
<li>å¸¸è§åœºæ™¯ï¼š
<ul>
<li>å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡</li>
<li>åˆ—è¡¨æ»‘åŠ¨æ—¶åˆ›å»ºå¯¹è±¡ï¼ˆonBindViewHolderï¼‰</li>
<li>åŠ¨ç”»æ’­æ”¾æ—¶åˆ›å»ºå¯¹è±¡</li>
<li>ç½‘ç»œè¯·æ±‚æ—¶åˆ›å»ºå¯¹è±¡</li>
</ul>
</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šåˆ†æä»£ç ï¼Œæ‰¾å‡ºåŸå› </strong></p>
<ul>
<li>åˆ†æä»£ç ï¼Œæ‰¾å‡ºä¸ºä»€ä¹ˆé¢‘ç¹åˆ›å»ºå¯¹è±¡</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šä¼˜åŒ–ä»£ç ï¼Œå‡å°‘å¯¹è±¡åˆ›å»º</strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¼˜åŒ–ä»£ç </li>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p>
<p><strong>1. ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</strong></p>
<ul>
<li>å¯¹äºé¢‘ç¹åˆ›å»ºçš„å¯¹è±¡ï¼Œä½¿ç”¨å¯¹è±¡æ± </li>
<li>ç¤ºä¾‹ï¼šRecyclerViewçš„ViewHolderæ± ã€è‡ªå®šä¹‰å¯¹è±¡æ± </li>
</ul>
<p><strong>2. å‡å°‘ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</strong></p>
<ul>
<li>ä½¿ç”¨StringBuilderè€Œä¸æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥</li>
<li>é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡</li>
<li>å¤ç”¨å­—ç¬¦ä¸²ã€é¿å…åˆ›å»ºä¸´æ—¶å¯¹è±¡</li>
</ul>
<p><strong>3. ä¿®å¤å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼ï¼Œé‡Šæ”¾è¢«å ç”¨çš„å†…å­˜</li>
</ul>
<p><strong>4. ä¼˜åŒ–æ•°æ®ç»“æ„</strong></p>
<ul>
<li>é€‰æ‹©åˆé€‚çš„é›†åˆç±»</li>
<li>åŠæ—¶æ¸…ç†é›†åˆï¼Œé¿å…é›†åˆæ³„æ¼</li>
</ul>
<p><strong>5. ä¼˜åŒ–å¤§å¯¹è±¡</strong></p>
<ul>
<li>é¿å…é¢‘ç¹åˆ›å»ºå¤§å¯¹è±¡</li>
<li>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡</li>
<li>ä½¿ç”¨å¯¹è±¡æ± ç®¡ç†å¤§å¯¹è±¡</li>
</ul>
<h4 data-id="heading-70">5.2.2 GCæš‚åœæ—¶é—´é•¿é—®é¢˜æ’æŸ¥</h4>
<p><strong>é—®é¢˜æè¿°ï¼š</strong> GCæš‚åœæ—¶é—´è¿‡é•¿ï¼Œå¯¼è‡´åº”ç”¨å¡é¡¿</p>
<p><strong>å¦‚ä½•è¯†åˆ«ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šé€šè¿‡Systraceåˆ†æ</strong></p>
<ul>
<li>ä½¿ç”¨Systraceè®°å½•åº”ç”¨è¿è¡Œæƒ…å†µ</li>
<li>æŸ¥çœ‹ä¸»çº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µ</li>
<li>å¦‚æœä¸»çº¿ç¨‹åœ¨GCæœŸé—´è¢«é˜»å¡ï¼Œè¯´æ˜GCæš‚åœæ—¶é—´é•¿</li>
<li>æŸ¥çœ‹GCçš„æŒç»­æ—¶é—´</li>
</ul>
<p><strong>æ–¹æ³•2ï¼šé€šè¿‡ProfileræŸ¥çœ‹GCè€—æ—¶</strong></p>
<ul>
<li>åœ¨Profilerä¸­æŸ¥çœ‹GCäº‹ä»¶</li>
<li>ç‚¹å‡»GCäº‹ä»¶ï¼ŒæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</li>
<li>æŸ¥çœ‹GCçš„æš‚åœæ—¶é—´ï¼ˆpaused timeï¼‰</li>
</ul>
<p><strong>æ–¹æ³•3ï¼šé€šè¿‡logcatæŸ¥çœ‹GCæ—¥å¿—</strong></p>
<ul>
<li>æŸ¥çœ‹GCæ—¥å¿—ä¸­çš„pausedæ—¶é—´</li>
<li>å¦‚æœpausedæ—¶é—´è¿‡é•¿ï¼ˆæ¯”å¦‚&gt;50msï¼‰ï¼Œä¼šå¯¼è‡´å¡é¡¿</li>
</ul>
<p><strong>åˆ¤æ–­æ ‡å‡†ï¼š</strong></p>
<ul>
<li><strong>Partial GC</strong>ï¼šæš‚åœæ—¶é—´é€šå¸¸å‡ æ¯«ç§’ï¼Œç”¨æˆ·åŸºæœ¬æ„Ÿè§‰ä¸åˆ°</li>
<li><strong>Full GC</strong>ï¼šæš‚åœæ—¶é—´å¯èƒ½å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼Œç”¨æˆ·èƒ½æ„Ÿè§‰åˆ°å¡é¡¿</li>
<li><strong>ä¸¥é‡æƒ…å†µ</strong>ï¼šæš‚åœæ—¶é—´&gt;100msï¼Œæ˜æ˜¾å¡é¡¿</li>
</ul>
<p><strong>å¯èƒ½çš„åŸå› ï¼š</strong></p>
<p><strong>1. Full GCé¢‘ç¹è§¦å‘</strong></p>
<ul>
<li>Full GCçš„æš‚åœæ—¶é—´æ¯”Partial GCé•¿å¾—å¤š</li>
<li>å¦‚æœFull GCé¢‘ç¹è§¦å‘ï¼Œä¼šå¯¼è‡´é¢‘ç¹å¡é¡¿</li>
<li>åŸå› ï¼šå†…å­˜æ³„æ¼ã€è€å¹´ä»£å¯¹è±¡å¤ªå¤š</li>
</ul>
<p><strong>2. å †å†…å­˜å¤ªå¤§ï¼Œå›æ”¶æ—¶é—´é•¿</strong></p>
<ul>
<li>å †å†…å­˜è¶Šå¤§ï¼ŒGCéœ€è¦å¤„ç†çš„å¯¹è±¡è¶Šå¤š</li>
<li>å›æ”¶æ—¶é—´è¶Šé•¿ï¼Œæš‚åœæ—¶é—´è¶Šé•¿</li>
</ul>
<p><strong>3. è€å¹´ä»£å¯¹è±¡å¤ªå¤š</strong></p>
<ul>
<li>è€å¹´ä»£å¯¹è±¡å¤šï¼ŒFull GCæ—¶éœ€è¦å¤„ç†çš„å¯¹è±¡å¤š</li>
<li>å›æ”¶æ—¶é—´é•¿ï¼Œæš‚åœæ—¶é—´é•¿</li>
</ul>
<p><strong>4. å¤§å¯¹è±¡å¤ªå¤š</strong></p>
<ul>
<li>å¤§å¯¹è±¡å ç”¨å†…å­˜å¤šï¼Œå›æ”¶æ…¢</li>
<li>å½±å“GCæ€§èƒ½ï¼Œå¯¼è‡´æš‚åœæ—¶é—´é•¿</li>
</ul>
<p><strong>è¯¦ç»†æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šæŸ¥çœ‹GCæ—¥å¿—ï¼Œç¡®è®¤GCç±»å‹</strong></p>
<ul>
<li>æŸ¥çœ‹GCæ—¥å¿—ï¼Œç¡®è®¤æ˜¯Partial GCè¿˜æ˜¯Full GC</li>
<li>Partial GCæš‚åœæ—¶é—´çŸ­ï¼ŒFull GCæš‚åœæ—¶é—´é•¿</li>
<li>å¦‚æœFull GCé¢‘ç¹ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šåˆ†æGCè€—æ—¶</strong></p>
<ul>
<li>æŸ¥çœ‹GCæ—¥å¿—ä¸­çš„pausedæ—¶é—´</li>
<li>å¦‚æœpausedæ—¶é—´è¿‡é•¿ï¼Œåˆ†æåŸå› </li>
<li>è®°å½•GCè€—æ—¶ï¼Œåˆ†æè¶‹åŠ¿</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šä½¿ç”¨Systraceåˆ†æGCå¯¹ä¸»çº¿ç¨‹çš„å½±å“</strong></p>
<ul>
<li>ä½¿ç”¨Systraceè®°å½•åº”ç”¨è¿è¡Œæƒ…å†µ</li>
<li>æŸ¥çœ‹ä¸»çº¿ç¨‹åœ¨GCæœŸé—´çš„æ‰§è¡Œæƒ…å†µ</li>
<li>æŸ¥çœ‹GCæ˜¯å¦å¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡</li>
<li>æŸ¥çœ‹GCæ˜¯å¦å¯¼è‡´å¸§ç‡ä¸‹é™</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šæ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>å†…å­˜æ³„æ¼ä¼šå¯¼è‡´è€å¹´ä»£æ»¡ï¼Œé¢‘ç¹è§¦å‘Full GC</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼å¯ä»¥å‡å°‘Full GC</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šåˆ†æè€å¹´ä»£å¯¹è±¡</strong></p>
<ul>
<li>ä½¿ç”¨Profilerç”Ÿæˆå †è½¬å‚¨</li>
<li>åˆ†æè€å¹´ä»£ä¸­çš„å¯¹è±¡</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li>åˆ†æä¸ºä»€ä¹ˆè¿™äº›å¯¹è±¡åœ¨è€å¹´ä»£</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šä¼˜åŒ–å†…å­˜ä½¿ç”¨</strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
<li>å‡å°‘è€å¹´ä»£å¯¹è±¡</li>
<li>åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p>
<p><strong>1. é¿å…è§¦å‘Full GCï¼ˆæœ€é‡è¦ï¼‰</strong></p>
<ul>
<li>Full GCæš‚åœæ—¶é—´é•¿ï¼Œåº”è¯¥å°½é‡é¿å…</li>
<li>æ–¹æ³•ï¼š
<ul>
<li>é¿å…å†…å­˜æ³„æ¼ï¼ˆå†…å­˜æ³„æ¼ä¼šå¯¼è‡´è€å¹´ä»£æ»¡ï¼‰</li>
<li>å‡å°‘è€å¹´ä»£å¯¹è±¡</li>
<li>ä¸è¦æ˜¾å¼è°ƒç”¨System.gc()</li>
</ul>
</li>
</ul>
<p><strong>2. å‡å°‘è€å¹´ä»£å¯¹è±¡</strong></p>
<ul>
<li>å‡å°‘é•¿æœŸå­˜æ´»çš„å¯¹è±¡</li>
<li>åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡</li>
<li>é¿å…å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</li>
</ul>
<p><strong>3. ä¿®å¤å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼ï¼Œé‡Šæ”¾è¢«å ç”¨çš„å†…å­˜</li>
<li>å‡å°‘Full GCçš„è§¦å‘</li>
</ul>
<p><strong>4. ä¼˜åŒ–å¤§å¯¹è±¡</strong></p>
<ul>
<li>é¿å…é¢‘ç¹åˆ›å»ºå¤§å¯¹è±¡</li>
<li>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡</li>
<li>ä½¿ç”¨å¯¹è±¡æ± ç®¡ç†å¤§å¯¹è±¡</li>
</ul>
<p><strong>5. ä¼˜åŒ–GCæ€§èƒ½</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»ºï¼Œå‡å°‘GCé¢‘ç‡</li>
<li>è®©Partial GCæ›´é«˜æ•ˆ</li>
<li>é¿å…Full GC</li>
</ul>
<h4 data-id="heading-71">5.2.3 å†…å­˜æ³„æ¼é—®é¢˜æ’æŸ¥</h4>
<p><strong>é—®é¢˜æè¿°ï¼š</strong> å†…å­˜æŒç»­å¢é•¿ï¼ŒGCæ— æ³•å›æ”¶ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´OOM</p>
<p><strong>å¦‚ä½•è¯†åˆ«ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šé€šè¿‡Profilerè§‚å¯Ÿå†…å­˜æ›²çº¿</strong></p>
<ul>
<li>åœ¨Profilerä¸­æŸ¥çœ‹å†…å­˜ä½¿ç”¨æ›²çº¿</li>
<li>å¦‚æœå†…å­˜æŒç»­å¢é•¿ï¼Œä¸ä¸‹é™ï¼Œå¯èƒ½æœ‰å†…å­˜æ³„æ¼</li>
<li>æ­£å¸¸æƒ…å†µï¼šå†…å­˜ä¼šå‘¨æœŸæ€§ä¸Šå‡å’Œä¸‹é™ï¼ˆGCå›æ”¶ï¼‰</li>
<li>å¼‚å¸¸æƒ…å†µï¼šå†…å­˜æŒç»­ä¸Šå‡ï¼Œä¸ä¸‹é™</li>
</ul>
<p><strong>æ–¹æ³•2ï¼šä½¿ç”¨LeakCanaryè‡ªåŠ¨æ£€æµ‹</strong></p>
<ul>
<li>LeakCanaryä¼šè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>å‘ç°æ³„æ¼æ—¶ä¼šæ˜¾ç¤ºé€šçŸ¥</li>
<li>è¿™æ˜¯æœ€ç›´æ¥çš„æ–¹æ³•</li>
</ul>
<p><strong>æ–¹æ³•3ï¼šé€šè¿‡GCæ—¥å¿—åˆ†æ</strong></p>
<ul>
<li>æŸ¥çœ‹GCæ—¥å¿—ï¼Œå¦‚æœGCé¢‘ç¹ä½†å†…å­˜ä¸ä¸‹é™</li>
<li>è¯´æ˜GCæ— æ³•å›æ”¶å¯¹è±¡ï¼Œå¯èƒ½æœ‰å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>åˆ¤æ–­æ ‡å‡†ï¼š</strong></p>
<ul>
<li><strong>æ­£å¸¸æƒ…å†µ</strong>ï¼šå†…å­˜ä¼šå‘¨æœŸæ€§ä¸Šå‡å’Œä¸‹é™</li>
<li><strong>å¼‚å¸¸æƒ…å†µ</strong>ï¼šå†…å­˜æŒç»­å¢é•¿ï¼Œä¸ä¸‹é™</li>
<li><strong>ä¸¥é‡æƒ…å†µ</strong>ï¼šå†…å­˜æŒç»­å¢é•¿ï¼Œæœ€ç»ˆOOM</li>
</ul>
<p><strong>è¯¦ç»†æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šä½¿ç”¨LeakCanaryè‡ªåŠ¨æ£€æµ‹ï¼ˆæ¨èï¼‰</strong></p>
<ul>
<li>åœ¨å¼€å‘é˜¶æ®µï¼ŒLeakCanaryä¼šè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>å¦‚æœå‘ç°æ³„æ¼ï¼Œä¼šæ˜¾ç¤ºé€šçŸ¥å’Œæ³„æ¼è·¯å¾„</li>
<li>æ ¹æ®æ³„æ¼è·¯å¾„ï¼Œå¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šè‡ªåŠ¨æ£€æµ‹ï¼Œå¿«é€Ÿå‘ç°ï¼Œæ˜¾ç¤ºæ³„æ¼è·¯å¾„</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šä½¿ç”¨Profilerè§‚å¯Ÿå†…å­˜è¶‹åŠ¿</strong></p>
<ul>
<li>åœ¨Profilerä¸­è§‚å¯Ÿå†…å­˜ä½¿ç”¨æ›²çº¿</li>
<li>å¦‚æœå†…å­˜æŒç»­å¢é•¿ï¼Œè®°å½•å†…å­˜å¢é•¿çš„æ—¶é—´ç‚¹</li>
<li>åˆ†æåœ¨ä»€ä¹ˆæ“ä½œåå†…å­˜å¼€å§‹å¢é•¿</li>
<li>æ‰¾å‡ºå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼çš„æ“ä½œ</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>åœ¨å†…å­˜å¢é•¿åï¼Œç”Ÿæˆå †è½¬å‚¨</li>
<li>å¯ä»¥ç”Ÿæˆå¤šä¸ªå †è½¬å‚¨ï¼Œå¯¹æ¯”åˆ†æ</li>
<li>å¯¼å‡ºä¸ºhprofæ–‡ä»¶</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šä½¿ç”¨MATåˆ†æå †è½¬å‚¨</strong></p>
<ul>
<li>ç”¨MATæ‰“å¼€å †è½¬å‚¨æ–‡ä»¶</li>
<li>ä½¿ç”¨"Histogram"æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li>ä½¿ç”¨"Dominator Tree"æŸ¥çœ‹å¯¹è±¡å¼•ç”¨å…³ç³»</li>
<li>ä½¿ç”¨"Path to GC Roots"æ‰¾å‡ºå¼•ç”¨é“¾</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šæ‰¾å‡ºæ— æ³•å›æ”¶çš„å¯¹è±¡</strong></p>
<ul>
<li>æ ¹æ®MATçš„åˆ†æç»“æœï¼Œæ‰¾å‡ºæ— æ³•å›æ”¶çš„å¯¹è±¡</li>
<li>åˆ†æè¿™äº›å¯¹è±¡ä¸ºä»€ä¹ˆæ— æ³•è¢«å›æ”¶</li>
<li>æ‰¾å‡ºæ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰è¿™äº›å¯¹è±¡çš„å¼•ç”¨</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šåˆ†æå¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ³„æ¼åŸå› </strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Path to GC Roots"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li>æ‰¾å‡ºæ³„æ¼çš„åŸå› ï¼š
<ul>
<li>é™æ€å˜é‡æŒæœ‰ï¼Ÿ</li>
<li>ç›‘å¬å™¨æœªå–æ¶ˆæ³¨å†Œï¼Ÿ</li>
<li>é›†åˆç±»æ³„æ¼ï¼Ÿ</li>
<li>å…¶ä»–åŸå› ï¼Ÿ</li>
</ul>
</li>
</ul>
<p><strong>æ­¥éª¤7ï¼šä¿®å¤ä»£ç </strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¿®å¤ä»£ç </li>
<li>å¸¸è§ä¿®å¤æ–¹æ³•ï¼š
<ul>
<li>ä½¿ç”¨å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</li>
<li>åŠæ—¶æ¸…ç†èµ„æºï¼ˆonDestroyä¸­æ¸…ç†ï¼‰</li>
<li>å–æ¶ˆæ³¨å†Œç›‘å¬å™¨</li>
<li>æ¸…ç†é›†åˆ</li>
</ul>
</li>
</ul>
<p><strong>å¸¸è§æ³„æ¼åœºæ™¯ï¼š</strong></p>
<p><strong>1. Activity/Contextæ³„æ¼</strong></p>
<ul>
<li>é™æ€å˜é‡æŒæœ‰Activityå¼•ç”¨</li>
<li>å•ä¾‹æŒæœ‰Activity Contextå¼•ç”¨</li>
<li>HandleræŒæœ‰Activityå¼•ç”¨</li>
</ul>
<p><strong>2. ç›‘å¬å™¨æœªå–æ¶ˆæ³¨å†Œ</strong></p>
<ul>
<li>EventBusæœªå–æ¶ˆæ³¨å†Œ</li>
<li>å¹¿æ’­æ¥æ”¶å™¨æœªå–æ¶ˆæ³¨å†Œ</li>
<li>å…¶ä»–ç›‘å¬å™¨æœªå–æ¶ˆæ³¨å†Œ</li>
</ul>
<p><strong>3. é›†åˆç±»æ³„æ¼</strong></p>
<ul>
<li>Listã€Mapä¸­ä¿å­˜äº†ä¸å†ä½¿ç”¨çš„å¯¹è±¡</li>
<li>é›†åˆæŒæœ‰å¯¹è±¡å¼•ç”¨ï¼Œå¯¹è±¡æ— æ³•è¢«å›æ”¶</li>
</ul>
<p><strong>4. çº¿ç¨‹æ³„æ¼</strong></p>
<ul>
<li>çº¿ç¨‹æŒæœ‰å¯¹è±¡å¼•ç”¨ï¼Œçº¿ç¨‹ä¸ç»“æŸï¼Œå¯¹è±¡æ— æ³•å›æ”¶</li>
<li>AsyncTaskã€HandlerThreadç­‰</li>
</ul>
<p><strong>5. èµ„æºæœªå…³é—­</strong></p>
<ul>
<li>æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥ç­‰æœªå…³é—­</li>
<li>å¯¼è‡´èµ„æºæ³„æ¼</li>
</ul>
<p><strong>æ’æŸ¥å·¥å…·ï¼š</strong></p>
<ul>
<li><strong>LeakCanary</strong>ï¼šè‡ªåŠ¨æ£€æµ‹ï¼Œå¿«é€Ÿå‘ç°æ³„æ¼</li>
<li><strong>MAT</strong>ï¼šè¯¦ç»†åˆ†æï¼Œæ‰¾å‡ºæ³„æ¼åŸå› </li>
<li><strong>Android Studio Profiler</strong>ï¼šå®æ—¶ç›‘æ§ï¼Œè§‚å¯Ÿå†…å­˜è¶‹åŠ¿</li>
</ul>
<h4 data-id="heading-72">5.2.4 å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰é—®é¢˜æ’æŸ¥</h4>
<p><strong>é—®é¢˜æè¿°ï¼š</strong> åº”ç”¨å´©æºƒï¼Œæ—¥å¿—æ˜¾ç¤ºOutOfMemoryError</p>
<p><strong>å¦‚ä½•è¯†åˆ«ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šåº”ç”¨å´©æºƒï¼ŒæŸ¥çœ‹æ—¥å¿—</strong></p>
<ul>
<li>åº”ç”¨å´©æºƒæ—¶ï¼ŒæŸ¥çœ‹logcatæ—¥å¿—</li>
<li>å¦‚æœçœ‹åˆ°OutOfMemoryErrorï¼Œè¯´æ˜å‘ç”Ÿäº†OOM</li>
<li>æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œäº†è§£OOMçš„ç±»å‹</li>
</ul>
<p><strong>æ–¹æ³•2ï¼šé€šè¿‡Profilerè§‚å¯Ÿå†…å­˜</strong></p>
<ul>
<li>åœ¨Profilerä¸­è§‚å¯Ÿå†…å­˜ä½¿ç”¨æƒ…å†µ</li>
<li>å¦‚æœå†…å­˜æŒç»­å¢é•¿ï¼Œæ¥è¿‘å†…å­˜ä¸Šé™ï¼Œå¯èƒ½å‘ç”ŸOOM</li>
<li>åœ¨OOMå‰ç”Ÿæˆå †è½¬å‚¨ï¼Œåˆ†æåŸå› </li>
</ul>
<p><strong>OOMçš„ç±»å‹ï¼š</strong></p>
<ul>
<li><strong>Java heap space</strong>ï¼šå †å†…å­˜æº¢å‡ºï¼ˆæœ€å¸¸è§ï¼‰</li>
<li><strong>PermGen space</strong>ï¼šæ–¹æ³•åŒºæº¢å‡ºï¼ˆAndroidä¸ä½¿ç”¨ï¼‰</li>
<li><strong>Direct buffer memory</strong>ï¼šç›´æ¥å†…å­˜æº¢å‡ºï¼ˆè¾ƒå°‘è§ï¼‰</li>
</ul>
<p><strong>è¯¦ç»†æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li><strong>åœ¨OOMæ—¶</strong>ï¼šç³»ç»Ÿå¯èƒ½è‡ªåŠ¨ç”Ÿæˆå †è½¬å‚¨ï¼ˆå¦‚æœé…ç½®äº†ï¼‰</li>
<li><strong>åœ¨OOMå‰</strong>ï¼šå¦‚æœå‘ç°å†…å­˜æŒç»­å¢é•¿ï¼Œæå‰ç”Ÿæˆå †è½¬å‚¨</li>
<li><strong>æ‰‹åŠ¨ç”Ÿæˆ</strong>ï¼šä½¿ç”¨Profileræ‰‹åŠ¨ç”Ÿæˆå †è½¬å‚¨</li>
<li>å¯¼å‡ºä¸ºhprofæ–‡ä»¶</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šä½¿ç”¨MATåˆ†æå †è½¬å‚¨</strong></p>
<ul>
<li>ç”¨MATæ‰“å¼€hprofæ–‡ä»¶</li>
<li>ç­‰å¾…MATåˆ†æå®Œæˆ</li>
<li>æŸ¥çœ‹MATçš„"Leak Suspects"æŠ¥å‘Šï¼ˆå¦‚æœæœ‰ï¼‰</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Histogram"åŠŸèƒ½</li>
<li>æŒ‰"Retained Heap"æ’åº</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li>åˆ†æè¿™äº›ç±»ä¸ºä»€ä¹ˆå ç”¨è¿™ä¹ˆå¤šå†…å­˜</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šåˆ†æå¯¹è±¡å¼•ç”¨å…³ç³»</strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Dominator Tree"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å¯¹è±¡çš„å¼•ç”¨å…³ç³»</li>
<li>æ‰¾å‡ºå“ªäº›å¯¹è±¡æŒæœ‰å¤§é‡å†…å­˜</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šåˆ†æå¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ— æ³•å›æ”¶çš„åŸå› </strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Path to GC Roots"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li>åˆ†æä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼š
<ul>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šå¯¹è±¡è¢«å¼•ç”¨ï¼Œæ— æ³•å›æ”¶</li>
<li><strong>å¤§å¯¹è±¡</strong>ï¼šå¯¹è±¡æœ¬èº«å¾ˆå¤§</li>
<li><strong>å¯¹è±¡å¤ªå¤š</strong>ï¼šåˆ›å»ºäº†å¤ªå¤šå¯¹è±¡</li>
</ul>
</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šä¿®å¤é—®é¢˜</strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¿®å¤é—®é¢˜ï¼š
<ul>
<li><strong>å¦‚æœæ˜¯å†…å­˜æ³„æ¼</strong>ï¼šä¿®å¤æ³„æ¼ï¼ˆä½¿ç”¨å¼±å¼•ç”¨ã€åŠæ—¶æ¸…ç†ï¼‰</li>
<li><strong>å¦‚æœæ˜¯å¤§å¯¹è±¡</strong>ï¼šä¼˜åŒ–å¤§å¯¹è±¡ï¼ˆå‹ç¼©ã€åŠæ—¶é‡Šæ”¾ï¼‰</li>
<li><strong>å¦‚æœæ˜¯å¯¹è±¡å¤ªå¤š</strong>ï¼šå‡å°‘å¯¹è±¡åˆ›å»ºï¼ˆä½¿ç”¨å¯¹è±¡æ± ã€åˆ†æ‰¹åŠ è½½ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼š</strong></p>
<p><strong>1. å†…å­˜æ³„æ¼ï¼ˆæœ€å¸¸è§ï¼‰</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šå¯¹è±¡æ— æ³•å›æ”¶ï¼Œå†…å­˜é€æ¸è¢«å ç”¨</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>ä½¿ç”¨MATåˆ†æå †è½¬å‚¨ï¼Œæ‰¾å‡ºæ³„æ¼å¯¹è±¡</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼ï¼ˆä½¿ç”¨å¼±å¼•ç”¨ã€åŠæ—¶æ¸…ç†ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>2. ä¸€æ¬¡æ€§åŠ è½½å¤ªå¤šæ•°æ®</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®åˆ°å†…å­˜</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>åˆ†æ‰¹åŠ è½½æ•°æ®</li>
<li>ä½¿ç”¨åˆ†é¡µåŠ è½½</li>
<li>åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„æ•°æ®</li>
</ul>
</li>
</ul>
<p><strong>3. å¤§å¯¹è±¡å ç”¨è¿‡å¤šå†…å­˜</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šåŠ è½½è¿‡å¤§çš„å›¾ç‰‡ã€åˆ›å»ºè¿‡å¤§çš„æ•°ç»„</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>å‹ç¼©å›¾ç‰‡å¤§å°</li>
<li>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡</li>
<li>ä½¿ç”¨å¯¹è±¡æ± ç®¡ç†å¤§å¯¹è±¡</li>
</ul>
</li>
</ul>
<p><strong>4. é¢‘ç¹åˆ›å»ºå¯¹è±¡</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šä»£ç ä¸­é¢‘ç¹åˆ›å»ºå¯¹è±¡</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä¼˜åŒ–ä»£ç ï¼Œå‡å°‘å¯¹è±¡åˆ›å»º</li>
</ul>
</li>
</ul>
<p><strong>5. Androidè®¾å¤‡å†…å­˜é™åˆ¶</strong></p>
<ul>
<li><strong>åŸå› </strong>ï¼šä¸åŒè®¾å¤‡æœ‰ä¸åŒçš„å †å†…å­˜ä¸Šé™</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š
<ul>
<li>ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
<li>é¿å…å†…å­˜æ³„æ¼</li>
<li>åˆç†ä½¿ç”¨ç¼“å­˜</li>
<li>åœ¨AndroidManifest.xmlä¸­è®¾ç½®largeHeap="true"ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰</li>
</ul>
</li>
</ul>
<p><strong>æ’æŸ¥å·¥å…·ï¼š</strong></p>
<ul>
<li><strong>MAT</strong>ï¼šåˆ†æå †è½¬å‚¨ï¼Œæ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li><strong>LeakCanary</strong>ï¼šæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li><strong>Android Studio Profiler</strong>ï¼šå®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨</li>
</ul>
<h4 data-id="heading-73">5.2.5 åº”ç”¨å¡é¡¿é—®é¢˜æ’æŸ¥</h4>
<p><strong>é—®é¢˜æè¿°ï¼š</strong> åº”ç”¨è¿è¡Œå¡é¡¿ï¼Œç”¨æˆ·ä½“éªŒå·®</p>
<p><strong>å¦‚ä½•è¯†åˆ«ï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šç”¨æˆ·åé¦ˆ</strong></p>
<ul>
<li>ç”¨æˆ·åé¦ˆåº”ç”¨å¡é¡¿</li>
<li>è§‚å¯Ÿåº”ç”¨è¿è¡Œæƒ…å†µï¼Œå‘ç°å¡é¡¿</li>
</ul>
<p><strong>æ–¹æ³•2ï¼šé€šè¿‡Systraceåˆ†æ</strong></p>
<ul>
<li>ä½¿ç”¨Systraceè®°å½•åº”ç”¨è¿è¡Œæƒ…å†µ</li>
<li>æŸ¥çœ‹ä¸»çº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µ</li>
<li>å¦‚æœä¸»çº¿ç¨‹æœ‰çº¢è‰²å¸§ï¼ˆæ‰å¸§ï¼‰ï¼Œè¯´æ˜æœ‰å¡é¡¿</li>
<li>æŸ¥çœ‹å¡é¡¿çš„æ—¶é—´æ®µ</li>
</ul>
<p><strong>æ–¹æ³•3ï¼šé€šè¿‡Profilerè§‚å¯Ÿ</strong></p>
<ul>
<li>åœ¨Profilerä¸­è§‚å¯ŸCPUä½¿ç”¨æƒ…å†µ</li>
<li>å¦‚æœCPUä½¿ç”¨ç‡çªç„¶ä¸‹é™ï¼Œå¯èƒ½æœ‰å¡é¡¿</li>
<li>æŸ¥çœ‹GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</li>
</ul>
<p><strong>åˆ¤æ–­æ ‡å‡†ï¼š</strong></p>
<ul>
<li><strong>æ­£å¸¸æƒ…å†µ</strong>ï¼šåº”ç”¨è¿è¡Œæµç•…ï¼Œå¸§ç‡ç¨³å®š</li>
<li><strong>å¼‚å¸¸æƒ…å†µ</strong>ï¼šåº”ç”¨å¶å°”å¡é¡¿ï¼Œç”¨æˆ·èƒ½æ„Ÿè§‰åˆ°</li>
<li><strong>ä¸¥é‡æƒ…å†µ</strong>ï¼šåº”ç”¨é¢‘ç¹å¡é¡¿ï¼Œä¸¥é‡å½±å“ç”¨æˆ·ä½“éªŒ</li>
</ul>
<p><strong>å¡é¡¿çš„å¯èƒ½åŸå› ï¼š</strong></p>
<p><strong>1. GCå¯¼è‡´çš„å¡é¡¿ï¼ˆå¸¸è§ï¼‰</strong></p>
<ul>
<li>GCæš‚åœä¸»çº¿ç¨‹ï¼Œå¯¼è‡´å¡é¡¿</li>
<li>Full GCæš‚åœæ—¶é—´é•¿ï¼Œæ›´å®¹æ˜“å¯¼è‡´å¡é¡¿</li>
<li>GCé¢‘ç¹è§¦å‘ï¼Œå¯¼è‡´é¢‘ç¹å¡é¡¿</li>
</ul>
<p><strong>2. ä¸»çº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œ</strong></p>
<ul>
<li>ä¸»çº¿ç¨‹æ‰§è¡Œè€—æ—¶æ“ä½œï¼ˆæ¯”å¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶IOï¼‰</li>
<li>å¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡ï¼Œåº”ç”¨å¡é¡¿</li>
</ul>
<p><strong>3. å¸ƒå±€å¤æ‚</strong></p>
<ul>
<li>å¸ƒå±€å±‚çº§å¤ªæ·±ï¼Œæ¸²æŸ“è€—æ—¶</li>
<li>å¯¼è‡´UIæ¸²æŸ“æ…¢ï¼Œåº”ç”¨å¡é¡¿</li>
</ul>
<p><strong>4. å…¶ä»–åŸå› </strong></p>
<ul>
<li>åŠ¨ç”»æ€§èƒ½é—®é¢˜</li>
<li>å›¾ç‰‡åŠ è½½é—®é¢˜</li>
<li>å…¶ä»–æ€§èƒ½é—®é¢˜</li>
</ul>
<p><strong>è¯¦ç»†æ’æŸ¥æ­¥éª¤ï¼ˆé’ˆå¯¹GCå¯¼è‡´çš„å¡é¡¿ï¼‰ï¼š</strong></p>
<p><strong>æ­¥éª¤1ï¼šä½¿ç”¨Systraceåˆ†æå¡é¡¿</strong></p>
<ul>
<li>ä½¿ç”¨Systraceè®°å½•åº”ç”¨è¿è¡Œæƒ…å†µ</li>
<li>æ“ä½œåº”ç”¨ï¼Œè§¦å‘å¡é¡¿</li>
<li>åœæ­¢è®°å½•ï¼ŒæŸ¥çœ‹ç»“æœ</li>
</ul>
<p><strong>æ­¥éª¤2ï¼šæŸ¥çœ‹ä¸»çº¿ç¨‹æ‰§è¡Œæƒ…å†µ</strong></p>
<ul>
<li>åœ¨Systraceä¸­æ‰¾åˆ°"main"çº¿ç¨‹</li>
<li>æŸ¥çœ‹ä¸»çº¿ç¨‹çš„æ‰§è¡Œæƒ…å†µ</li>
<li>æŸ¥çœ‹æ˜¯å¦æœ‰çº¢è‰²å¸§ï¼ˆæ‰å¸§ï¼‰</li>
<li>æŸ¥çœ‹å¡é¡¿çš„æ—¶é—´æ®µ</li>
</ul>
<p><strong>æ­¥éª¤3ï¼šæŸ¥çœ‹GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</strong></p>
<ul>
<li>åœ¨Systraceä¸­æŸ¥æ‰¾GCäº‹ä»¶</li>
<li>æŸ¥çœ‹GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</li>
<li>å¦‚æœå¯¹åº”ï¼Œè¯´æ˜GCå¯¼è‡´äº†å¡é¡¿</li>
</ul>
<p><strong>æ­¥éª¤4ï¼šåˆ†æGCåŸå› </strong></p>
<ul>
<li>æŸ¥çœ‹GCç±»å‹ï¼šæ˜¯Partial GCè¿˜æ˜¯Full GC</li>
<li>æŸ¥çœ‹GCè€—æ—¶ï¼šGCæš‚åœæ—¶é—´æ˜¯å¦è¿‡é•¿</li>
<li>æŸ¥çœ‹GCé¢‘ç‡ï¼šGCæ˜¯å¦è¿‡äºé¢‘ç¹</li>
<li>åˆ†æGCåŸå› ï¼šä¸ºä»€ä¹ˆè§¦å‘GC</li>
</ul>
<p><strong>æ­¥éª¤5ï¼šä½¿ç”¨Profilerè¿›ä¸€æ­¥åˆ†æ</strong></p>
<ul>
<li>ä½¿ç”¨ProfileræŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
<li>æŸ¥çœ‹GCäº‹ä»¶å’Œå†…å­˜æ›²çº¿</li>
<li>åˆ†æå†…å­˜ä½¿ç”¨æ˜¯å¦æ­£å¸¸</li>
<li>æ£€æŸ¥æ˜¯å¦æœ‰å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>æ­¥éª¤6ï¼šä¼˜åŒ–ä»£ç ï¼Œå‡å°‘GC</strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¼˜åŒ–ä»£ç ï¼š
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>é¿å…è§¦å‘Full GC</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼</li>
<li>ä¼˜åŒ–åˆ—è¡¨æ»‘åŠ¨ã€åŠ¨ç”»ç­‰åœºæ™¯</li>
</ul>
</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p>
<p><strong>1. å‡å°‘å¯¹è±¡åˆ›å»ºï¼ˆæœ€é‡è¦ï¼‰</strong></p>
<ul>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä½¿ç”¨åŸºæœ¬ç±»å‹æ›¿ä»£åŒ…è£…ç±»å‹</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šåˆ—è¡¨æ»‘åŠ¨æ—¶ï¼Œé¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</li>
</ul>
<p><strong>2. é¿å…è§¦å‘Full GC</strong></p>
<ul>
<li>Full GCæš‚åœæ—¶é—´é•¿ï¼Œåº”è¯¥å°½é‡é¿å…</li>
<li>æ–¹æ³•ï¼š
<ul>
<li>é¿å…å†…å­˜æ³„æ¼</li>
<li>å‡å°‘è€å¹´ä»£å¯¹è±¡</li>
<li>ä¸è¦æ˜¾å¼è°ƒç”¨System.gc()</li>
</ul>
</li>
</ul>
<p><strong>3. ä¼˜åŒ–åˆ—è¡¨æ»‘åŠ¨</strong></p>
<ul>
<li>ViewHolderå¤ç”¨</li>
<li>é¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</li>
<li>ä½¿ç”¨å¯¹è±¡æ± </li>
<li>å‡å°‘GCé¢‘ç‡</li>
</ul>
<p><strong>4. ä¼˜åŒ–åŠ¨ç”»</strong></p>
<ul>
<li>å¤ç”¨åŠ¨ç”»å¯¹è±¡</li>
<li>é¿å…é¢‘ç¹åˆ›å»ºåŠ¨ç”»å¯¹è±¡</li>
<li>å‡å°‘GCé¢‘ç‡</li>
</ul>
<p><strong>5. ä¿®å¤å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼ï¼Œå‡å°‘Full GC</li>
</ul>
<p><strong>æ’æŸ¥å·¥å…·ï¼š</strong></p>
<ul>
<li><strong>Systrace</strong>ï¼šåˆ†æå¡é¡¿ï¼ŒæŸ¥çœ‹GCå¯¹ä¸»çº¿ç¨‹çš„å½±å“</li>
<li><strong>Android Studio Profiler</strong>ï¼šå®æ—¶ç›‘æ§å†…å­˜å’ŒGC</li>
<li><strong>logcat</strong>ï¼šæŸ¥çœ‹GCæ—¥å¿—ï¼Œåˆ†æGCé¢‘ç‡å’Œè€—æ—¶</li>
</ul>
<hr/>
<h2 data-id="heading-74">ç¬¬å…­éƒ¨åˆ†ï¼šé¢è¯•é¢˜</h2>
<h4 data-id="heading-75">6.1 åŸºç¡€æ¦‚å¿µé¢˜ï¼ˆå¿…è€ƒï¼‰</h4>
<h4 data-id="heading-76">6.1.1 GCåŸºç¡€æ¦‚å¿µ</h4>
<p><strong>1. ä»€ä¹ˆæ˜¯åƒåœ¾å›æ”¶ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼ŒGCï¼‰æ˜¯è‡ªåŠ¨ç®¡ç†å†…å­˜çš„æœºåˆ¶ï¼Œèƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å’Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œé‡Šæ”¾å®ƒä»¬å ç”¨çš„å†…å­˜ç©ºé—´ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>è‡ªåŠ¨ç®¡ç†</strong>ï¼šä¸éœ€è¦å¼€å‘è€…æ‰‹åŠ¨é‡Šæ”¾å†…å­˜ï¼Œé¿å…å¿˜è®°é‡Šæ”¾å¯¼è‡´çš„å†…å­˜æ³„æ¼</li>
<li><strong>è‡ªåŠ¨è¯†åˆ«</strong>ï¼šç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­å“ªäº›å¯¹è±¡æ˜¯"åƒåœ¾"ï¼ˆä¸å†ä½¿ç”¨ï¼‰</li>
<li><strong>è‡ªåŠ¨å›æ”¶</strong>ï¼šè‡ªåŠ¨é‡Šæ”¾åƒåœ¾å¯¹è±¡å ç”¨çš„å†…å­˜ç©ºé—´</li>
</ul>
<p><strong>åœ¨Androidä¸­çš„é‡è¦æ€§ï¼š</strong></p>
<ul>
<li>Androidè®¾å¤‡å†…å­˜æœ‰é™ï¼Œå¿…é¡»åˆç†ä½¿ç”¨</li>
<li>GCæ€§èƒ½ç›´æ¥å½±å“åº”ç”¨æµç•…åº¦</li>
<li>é¢‘ç¹GCä¼šå¯¼è‡´å¡é¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ</li>
<li>å†…å­˜ä¸è¶³å¯èƒ½å¯¼è‡´åº”ç”¨è¢«ç³»ç»Ÿæ€æ­»</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createObjects</span><span class="hljs-params">()</span> {
    <span class="hljs-type">Object</span> <span class="hljs-variable">obj1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-type">Object</span> <span class="hljs-variable">obj2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-comment">// obj1å’Œobj2ä¸å†è¢«å¼•ç”¨åï¼ŒGCä¼šè‡ªåŠ¨å›æ”¶å®ƒä»¬å ç”¨çš„å†…å­˜</span>
    <span class="hljs-comment">// å¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨é‡Šæ”¾</span>
}
</code></pre>
<p><strong>2. Androidä½¿ç”¨çš„æ˜¯ä»€ä¹ˆè¿è¡Œæ—¶ï¼Ÿä¸JVMçš„åŒºåˆ«ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>Androidä½¿ç”¨çš„æ˜¯<strong>ARTï¼ˆAndroid Runtimeï¼‰</strong>ï¼Œä¸æ˜¯JVMã€‚</p>
<p><strong>ä¸»è¦åŒºåˆ«ï¼š</strong></p>
<ol>
<li>
<p><strong>ç¼–è¯‘æ–¹å¼ä¸åŒ</strong>ï¼š</p>
<ul>
<li><strong>ART</strong>ï¼šAOTç¼–è¯‘ï¼ˆAhead-Of-Timeï¼‰ï¼Œåº”ç”¨å®‰è£…æ—¶ç¼–è¯‘ä¸ºæœºå™¨ç </li>
<li><strong>JVM</strong>ï¼šJITç¼–è¯‘ï¼ˆJust-In-Timeï¼‰ï¼Œè¿è¡Œæ—¶ç¼–è¯‘ä¸ºæœºå™¨ç </li>
</ul>
</li>
<li>
<p><strong>GCæœºåˆ¶ä¸åŒ</strong>ï¼š</p>
<ul>
<li><strong>ART</strong>ï¼šåªæœ‰ä¸€ç§æ”¶é›†å™¨ï¼ˆå¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼‰ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨</li>
<li><strong>JVM</strong>ï¼šæœ‰å¤šç§æ”¶é›†å™¨å¯é€‰ï¼ˆSerialã€Parallelã€CMSã€G1ã€ZGCç­‰ï¼‰ï¼Œå¼€å‘è€…éœ€è¦é€‰æ‹©</li>
</ul>
</li>
<li>
<p><strong>ä¼˜åŒ–æ–¹å‘ä¸åŒ</strong>ï¼š</p>
<ul>
<li><strong>ART</strong>ï¼šé’ˆå¯¹ä½å»¶è¿Ÿä¼˜åŒ–ï¼Œé€‚åˆäº¤äº’å¼åº”ç”¨ï¼ˆå‡å°‘å¡é¡¿ï¼‰</li>
<li><strong>JVM</strong>ï¼šæœ‰å¤šç§ä¼˜åŒ–æ–¹å‘ï¼ˆååé‡ã€å»¶è¿Ÿã€å†…å­˜å ç”¨ç­‰ï¼‰</li>
</ul>
</li>
<li>
<p><strong>å†…å­˜ç®¡ç†ä¸åŒ</strong>ï¼š</p>
<ul>
<li><strong>ART</strong>ï¼šé’ˆå¯¹Androidè®¾å¤‡å†…å­˜æœ‰é™çš„ç‰¹ç‚¹ä¼˜åŒ–</li>
<li><strong>JVM</strong>ï¼šé€šå¸¸è¿è¡Œåœ¨æœåŠ¡å™¨ä¸Šï¼Œå†…å­˜ç›¸å¯¹å……è¶³</li>
</ul>
</li>
</ol>
<p><strong>3. ARTçš„GCä¸JVMçš„GCæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ARTçš„GCç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>åªæœ‰ä¸€ç§æ”¶é›†å™¨</strong>ï¼šå¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼ˆConcurrent Copyingï¼ŒCCï¼‰</li>
<li><strong>ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨</strong>ï¼šå¼€å‘è€…ä¸éœ€è¦é€‰æ‹©ï¼Œç³»ç»Ÿè‡ªåŠ¨ç®¡ç†</li>
<li><strong>ä½å»¶è¿Ÿè®¾è®¡</strong>ï¼šé’ˆå¯¹äº¤äº’å¼åº”ç”¨ä¼˜åŒ–ï¼Œå‡å°‘å¡é¡¿</li>
<li><strong>å¹¶å‘å›æ”¶</strong>ï¼šåœ¨åå°çº¿ç¨‹æ‰§è¡Œï¼Œå°½é‡ä¸æš‚åœä¸»çº¿ç¨‹</li>
<li><strong>å¢é‡å›æ”¶</strong>ï¼šæŠŠå¤§é‡å›æ”¶å·¥ä½œåˆ†æˆå°ä»½ï¼Œé¿å…ä¸€æ¬¡æ€§å¡é¡¿å¤ªä¹…</li>
</ul>
<p><strong>JVMçš„GCç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>å¤šç§æ”¶é›†å™¨å¯é€‰</strong>ï¼šSerialã€Parallelã€CMSã€G1ã€ZGCã€Shenandoahç­‰</li>
<li><strong>éœ€è¦å¼€å‘è€…é€‰æ‹©</strong>ï¼šæ ¹æ®åº”ç”¨ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„æ”¶é›†å™¨</li>
<li><strong>å¤šç§ä¼˜åŒ–æ–¹å‘</strong>ï¼šååé‡ä¼˜å…ˆã€å»¶è¿Ÿä¼˜å…ˆã€å†…å­˜å ç”¨ä¼˜å…ˆç­‰</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆARTåªæœ‰ä¸€ç§æ”¶é›†å™¨ï¼Ÿ</strong></p>
<ul>
<li>é’ˆå¯¹Androidåœºæ™¯ä¼˜åŒ–ï¼ˆä½å»¶è¿Ÿã€äº¤äº’å¼åº”ç”¨ï¼‰</li>
<li>ä¸éœ€è¦å¼€å‘è€…é€‰æ‹©ï¼Œç®€åŒ–å¼€å‘</li>
<li>ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼Œæé«˜æ•ˆç‡</li>
</ul>
<p><strong>4. å¦‚ä½•åˆ¤æ–­å¯¹è±¡å·²æ­»ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>Androidä½¿ç”¨<strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong>æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²æ­»ã€‚</p>
<p><strong>ç®—æ³•åŸç†ï¼š</strong></p>
<ol>
<li>ä»ä¸€ç»„ç§°ä¸º"GC Roots"çš„å¯¹è±¡å¼€å§‹</li>
<li>å‘ä¸‹æœç´¢ï¼Œæ ‡è®°æ‰€æœ‰èƒ½å¤Ÿä»GC Rootsåˆ°è¾¾çš„å¯¹è±¡ï¼ˆå­˜æ´»å¯¹è±¡ï¼‰</li>
<li>æ— æ³•ä»GC Rootsåˆ°è¾¾çš„å¯¹è±¡å°±æ˜¯"åƒåœ¾"ï¼Œå¯ä»¥è¢«å›æ”¶</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆä¸ç”¨å¼•ç”¨è®¡æ•°ç®—æ³•ï¼Ÿ</strong></p>
<ul>
<li>å¼•ç”¨è®¡æ•°ç®—æ³•æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨</li>
<li>ä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨æ—¶ï¼Œå¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¸º0ï¼Œå¯¼è‡´å†…å­˜æ³„æ¼</li>
<li>å¯è¾¾æ€§åˆ†æç®—æ³•å¯ä»¥å¤„ç†å¾ªç¯å¼•ç”¨ï¼Œå‡†ç¡®åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯å›æ”¶</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¯è¾¾æ€§åˆ†æå¯ä»¥å¤„ç†å¾ªç¯å¼•ç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> {
    Node next;
}

<span class="hljs-type">Node</span> <span class="hljs-variable">node1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
<span class="hljs-type">Node</span> <span class="hljs-variable">node2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>();
node1.next = node2;
node2.next = node1;  <span class="hljs-comment">// å¾ªç¯å¼•ç”¨</span>

<span class="hljs-comment">// å¦‚æœnode1å’Œnode2éƒ½ä¸å†è¢«GC Rootså¼•ç”¨</span>
<span class="hljs-comment">// å³ä½¿å®ƒä»¬ç›¸äº’å¼•ç”¨ï¼Œä¹Ÿæ— æ³•ä»GC Rootsåˆ°è¾¾</span>
<span class="hljs-comment">// æ‰€ä»¥å®ƒä»¬éƒ½æ˜¯åƒåœ¾ï¼Œå¯ä»¥è¢«å›æ”¶</span>
</code></pre>
<p><strong>5. GC Rootså¯¹è±¡æœ‰å“ªäº›ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>GC Rootsæ˜¯å¯è¾¾æ€§åˆ†æç®—æ³•çš„èµ·ç‚¹ï¼Œä»¥ä¸‹å¯¹è±¡å¯ä»¥ä½œä¸ºGC Rootsï¼š</p>
<ol>
<li>
<p><strong>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</strong></p>
<ul>
<li>å±€éƒ¨å˜é‡ã€æ–¹æ³•å‚æ•°</li>
<li>ç¤ºä¾‹ï¼šæ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>æ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</strong></p>
<ul>
<li>staticå˜é‡</li>
<li>ç¤ºä¾‹ï¼šç±»çš„é™æ€å˜é‡</li>
</ul>
</li>
<li>
<p><strong>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</strong></p>
<ul>
<li>å¸¸é‡</li>
<li>ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²å¸¸é‡</li>
</ul>
</li>
<li>
<p><strong>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</strong></p>
<ul>
<li>Nativeæ–¹æ³•ä¸­çš„å¼•ç”¨</li>
<li>ç¤ºä¾‹ï¼šJNIè°ƒç”¨ä¸­çš„å¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡</strong></p>
<ul>
<li>synchronizedæŒæœ‰çš„å¯¹è±¡</li>
<li>ç¤ºä¾‹ï¼šé”å¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>å†…éƒ¨å¼•ç”¨</strong></p>
<ul>
<li>Classå¯¹è±¡ã€å¼‚å¸¸å¯¹è±¡ç­‰</li>
<li>ç¤ºä¾‹ï¼šç±»çš„Classå¯¹è±¡</li>
</ul>
</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆè¿™äº›æ˜¯GC Rootsï¼Ÿ</strong></p>
<ul>
<li>è¿™äº›å¯¹è±¡æ˜¯ç¨‹åºè¿è¡Œçš„åŸºç¡€ï¼Œä¸èƒ½è¢«å›æ”¶</li>
<li>ä»è¿™äº›å¯¹è±¡å¼€å§‹ï¼Œå¯ä»¥æ‰¾åˆ°æ‰€æœ‰æ­£åœ¨ä½¿ç”¨çš„å¯¹è±¡</li>
<li>æ— æ³•ä»GC Rootsåˆ°è¾¾çš„å¯¹è±¡ï¼Œè¯´æ˜ç¨‹åºä¸å†ä½¿ç”¨ï¼Œå¯ä»¥å›æ”¶</li>
</ul>
<p><strong>6. å¼•ç”¨ç±»å‹æœ‰å“ªäº›ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>Javaä¸­æœ‰å››ç§å¼•ç”¨ç±»å‹ï¼Œå¼ºåº¦ä»å¼ºåˆ°å¼±ï¼š</p>
<p><strong>1. å¼ºå¼•ç”¨ï¼ˆStrong Referenceï¼‰</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæœ€å¸¸è§çš„å¼•ç”¨ç±»å‹ï¼Œåªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œå¯¹è±¡å°±ä¸ä¼šè¢«GCå›æ”¶</li>
<li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šæ™®é€šå¯¹è±¡å¼•ç”¨ã€Activityå¼•ç”¨ç­‰</li>
<li><strong>ç¤ºä¾‹</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();  <span class="hljs-comment">// å¼ºå¼•ç”¨</span>
<span class="hljs-comment">// objå¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«å›æ”¶ï¼Œé™¤éobj = null</span>
</code></pre>
<p><strong>2. è½¯å¼•ç”¨ï¼ˆSoft Referenceï¼‰</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå†…å­˜ä¸è¶³æ—¶æ‰å›æ”¶ï¼Œé€‚åˆç¼“å­˜åœºæ™¯</li>
<li><strong>Androidä½¿ç”¨</strong>ï¼šAndroidä¸æ¨èä½¿ç”¨ï¼Œå› ä¸ºè®¾å¤‡å†…å­˜æœ‰é™ï¼Œè½¯å¼•ç”¨å¯èƒ½å¾ˆå¿«è¢«å›æ”¶</li>
<li><strong>å»ºè®®</strong>ï¼šä½¿ç”¨LruCacheç­‰æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜</li>
<li><strong>ç¤ºä¾‹</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-java" lang="java">SoftReference&lt;Bitmap&gt; softRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SoftReference</span>&lt;&gt;(bitmap);
<span class="hljs-type">Bitmap</span> <span class="hljs-variable">bitmap</span> <span class="hljs-operator">=</span> softRef.get();  <span class="hljs-comment">// å¯èƒ½è¿”å›nullï¼ˆå¦‚æœè¢«å›æ”¶äº†ï¼‰</span>
</code></pre>
<p><strong>3. å¼±å¼•ç”¨ï¼ˆWeak Referenceï¼‰</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šåªè¦GCå°±ä¼šå›æ”¶ï¼Œä¸ä¼šé˜»æ­¢å¯¹è±¡è¢«å›æ”¶</li>
<li><strong>Androidä½¿ç”¨åœºæ™¯</strong>ï¼šé¿å…å†…å­˜æ³„æ¼ï¼ˆHandlerã€é™æ€å˜é‡æŒæœ‰å¯¹è±¡æ—¶ï¼‰</li>
<li><strong>ç¤ºä¾‹</strong>ï¼š</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é¿å…Handlerå†…å­˜æ³„æ¼</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> {
    <span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
    
    MyHandler(Activity activity) {
        activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);
    }
}
</code></pre>
<p><strong>4. è™šå¼•ç”¨ï¼ˆPhantom Referenceï¼‰</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæœ€å¼±çš„å¼•ç”¨ç±»å‹ï¼Œä¸»è¦ç”¨äºå¯¹è±¡å›æ”¶å‰çš„æ¸…ç†å·¥ä½œ</li>
<li><strong>Androidä½¿ç”¨åœºæ™¯</strong>ï¼šå¾ˆå°‘ä½¿ç”¨ï¼Œä¸»è¦ç”¨äºç‰¹æ®Šåœºæ™¯</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæ— æ³•é€šè¿‡è™šå¼•ç”¨è·å–å¯¹è±¡</li>
</ul>
<p><strong>å¼•ç”¨å¼ºåº¦å¯¹æ¯”ï¼š</strong>
å¼ºå¼•ç”¨ &gt; è½¯å¼•ç”¨ &gt; å¼±å¼•ç”¨ &gt; è™šå¼•ç”¨</p>
<h4 data-id="heading-77">6.1.2 åƒåœ¾å›æ”¶ç®—æ³•</h4>
<p><strong>1. åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>åƒåœ¾å›æ”¶ç®—æ³•ä¸»è¦æœ‰å››ç§ï¼š</p>
<p><strong>1. æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼ˆMark-Sweepï¼‰</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šå…ˆæ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œç„¶åæ¸…é™¤</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡</li>
<li><strong>Androidä½¿ç”¨</strong>ï¼šä¸ä¸»è¦ä½¿ç”¨</li>
</ul>
<p><strong>2. æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼ˆMark-Copyï¼‰</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šå°†å†…å­˜åˆ†ä¸ºä¸¤å—ï¼Œå›æ”¶æ—¶å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæ²¡æœ‰å†…å­˜ç¢ç‰‡ï¼Œä½†æµªè´¹å†…å­˜</li>
<li><strong>Androidä½¿ç”¨</strong>ï¼š<strong>ä¸»è¦ä½¿ç”¨è¿™ä¸ªç®—æ³•</strong>ï¼Œé€‚åˆå¹´è½»ä»£</li>
</ul>
<p><strong>3. æ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆMark-Compactï¼‰</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šæ ‡è®°åï¼Œå°†å­˜æ´»å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åæ¸…ç†è¾¹ç•Œå¤–çš„å†…å­˜</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæ²¡æœ‰å†…å­˜ç¢ç‰‡ä¸”ä¸æµªè´¹å†…å­˜ï¼Œä½†æ•ˆç‡è¾ƒä½</li>
<li><strong>Androidä½¿ç”¨</strong>ï¼šåœ¨æŸäº›åœºæ™¯ä½¿ç”¨ï¼Œç”¨äºè€å¹´ä»£</li>
</ul>
<p><strong>4. åˆ†ä»£æ”¶é›†ç®—æ³•ï¼ˆGenerational Collectionï¼‰</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šæ ¹æ®å¯¹è±¡ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºå¹´è½»ä»£å’Œè€å¹´ä»£ï¼Œä¸åŒä»£ç”¨ä¸åŒç®—æ³•</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šç»“åˆå¤šç§ç®—æ³•çš„ä¼˜ç‚¹</li>
<li><strong>Androidä½¿ç”¨</strong>ï¼šä½¿ç”¨è¿™ä¸ªç­–ç•¥</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆAndroidä¸»è¦ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Ÿ</strong></p>
<ul>
<li>é€‚åˆå¹´è½»ä»£ï¼šå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼Œå­˜æ´»å¯¹è±¡å°‘ï¼Œå¤åˆ¶æˆæœ¬ä½</li>
<li>æ²¡æœ‰å†…å­˜ç¢ç‰‡ï¼šå¤åˆ¶åå†…å­˜è¿ç»­ï¼Œåˆ†é…æ•ˆç‡é«˜</li>
<li>é€šè¿‡ä¼˜åŒ–ï¼ˆAppelå¼å›æ”¶ï¼‰ï¼Œåªæµªè´¹10%çš„å†…å­˜ï¼Œè€Œä¸æ˜¯50%</li>
</ul>
<p><strong>2. æ ‡è®°-æ¸…é™¤ç®—æ³•çš„ä¼˜ç¼ºç‚¹ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ç®—æ³•åŸç†ï¼š</strong>
åˆ†ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>æ ‡è®°é˜¶æ®µ</strong>ï¼šä»GC Rootså¼€å§‹ï¼Œæ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡</li>
<li><strong>æ¸…é™¤é˜¶æ®µ</strong>ï¼šæ¸…é™¤æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡</li>
</ol>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>å®ç°ç®€å•</li>
<li>ä¸éœ€è¦ç§»åŠ¨å¯¹è±¡</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li><strong>äº§ç”Ÿå†…å­˜ç¢ç‰‡</strong>ï¼šæ¸…é™¤åç•™ä¸‹ä¸è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå½±å“åç»­å†…å­˜åˆ†é…æ•ˆç‡</li>
<li>æ•ˆç‡è¾ƒä½ï¼šéœ€è¦ä¸¤æ¬¡éå†ï¼ˆæ ‡è®°å’Œæ¸…é™¤ï¼‰</li>
</ul>
<p><strong>Androidä¸­çš„ä½¿ç”¨ï¼š</strong></p>
<ul>
<li>Androidä¸ä¸»è¦ä½¿ç”¨è¿™ä¸ªç®—æ³•</li>
<li>å› ä¸ºä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå½±å“åç»­å†…å­˜åˆ†é…æ•ˆç‡</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">æ ‡è®°å‰ï¼š<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[å¯¹è±¡4]</span><span class="hljs-selector-attr">[å¯¹è±¡5]</span>
        å­˜æ´»   åƒåœ¾   å­˜æ´»   åƒåœ¾   å­˜æ´»

æ¸…é™¤åï¼š<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡5]</span>
        ç¢ç‰‡å¤šï¼Œåˆ†é…æ•ˆç‡ä½
</code></pre>
<p><strong>3. æ ‡è®°-å¤åˆ¶ç®—æ³•çš„ä¼˜ç¼ºç‚¹ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ç®—æ³•åŸç†ï¼š</strong>
å°†å†…å­˜åˆ†ä¸ºä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨ä¸€å—ã€‚å›æ”¶æ—¶ï¼Œå°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ï¼Œç„¶åæ¸…ç©ºå½“å‰å—ã€‚</p>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ²¡æœ‰å†…å­˜ç¢ç‰‡</strong>ï¼šå¤åˆ¶åå†…å­˜è¿ç»­ï¼Œåˆ†é…æ•ˆç‡é«˜</li>
<li><strong>å›æ”¶æ•ˆç‡é«˜</strong>ï¼šåªéœ€è¦å¤åˆ¶å­˜æ´»å¯¹è±¡ï¼Œå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼Œå¤åˆ¶æˆæœ¬ä½</li>
<li><strong>é€‚åˆå¹´è½»ä»£</strong>ï¼šå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼Œå­˜æ´»å¯¹è±¡å°‘</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>æµªè´¹å†…å­˜ï¼šéœ€è¦ä¸¤å—å†…å­˜ï¼Œä½†åªä½¿ç”¨ä¸€å—</li>
<li>å¯¹è±¡å­˜æ´»ç‡é«˜æ—¶æ•ˆç‡ä½ï¼šéœ€è¦å¤åˆ¶å¾ˆå¤šå¯¹è±¡</li>
</ul>
<p><strong>Androidä¸­çš„ä½¿ç”¨ï¼š</strong></p>
<ul>
<li><strong>Android ARTä¸»è¦ä½¿ç”¨è¿™ä¸ªç®—æ³•</strong></li>
<li>é€‚åˆå¹´è½»ä»£å›æ”¶ï¼ˆå¤§éƒ¨åˆ†å¯¹è±¡å¾ˆå¿«è¢«å›æ”¶ï¼‰</li>
<li>é€šè¿‡ä¼˜åŒ–ï¼ˆAppelå¼å›æ”¶ï¼‰ï¼Œåªæµªè´¹10%çš„å†…å­˜ï¼ˆè€Œä¸æ˜¯50%ï¼‰</li>
</ul>
<p><strong>æ”¹è¿›ç®—æ³•ï¼ˆAppelå¼å›æ”¶ï¼‰ï¼š</strong></p>
<ul>
<li>å°†å†…å­˜åˆ†ä¸ºEdenåŒºå’Œä¸¤ä¸ªSurvivoråŒº</li>
<li>é»˜è®¤æ¯”ä¾‹ï¼šEden : Survivor0 : Survivor1 = 8 : 1 : 1</li>
<li>åªæµªè´¹10%çš„å†…å­˜ï¼Œè€Œä¸æ˜¯50%</li>
</ul>
<p><strong>4. æ ‡è®°-æ•´ç†ç®—æ³•çš„ä¼˜ç¼ºç‚¹ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ç®—æ³•åŸç†ï¼š</strong>
åˆ†ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li><strong>æ ‡è®°é˜¶æ®µ</strong>ï¼šæ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡</li>
<li><strong>æ•´ç†é˜¶æ®µ</strong>ï¼šå°†å­˜æ´»å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨</li>
<li><strong>æ¸…é™¤é˜¶æ®µ</strong>ï¼šæ¸…ç†è¾¹ç•Œå¤–çš„å†…å­˜</li>
</ol>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ²¡æœ‰å†…å­˜ç¢ç‰‡</strong>ï¼šæ•´ç†åå†…å­˜è¿ç»­</li>
<li><strong>ä¸æµªè´¹å†…å­˜</strong>ï¼šä¸éœ€è¦ä¸¤å—å†…å­˜</li>
</ul>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ul>
<li>æ•ˆç‡è¾ƒä½ï¼šéœ€è¦ç§»åŠ¨å¯¹è±¡ï¼Œæ›´æ–°æ‰€æœ‰å¼•ç”¨</li>
<li>é€‚åˆè€å¹´ä»£ï¼šå¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œç§»åŠ¨æˆæœ¬ç›¸å¯¹è¾ƒä½</li>
</ul>
<p><strong>Androidä¸­çš„ä½¿ç”¨ï¼š</strong></p>
<ul>
<li>Androidåœ¨æŸäº›åœºæ™¯ä¸‹ä½¿ç”¨</li>
<li>ä¸»è¦ç”¨äºè€å¹´ä»£å›æ”¶ï¼ˆé¿å…å†…å­˜ç¢ç‰‡ï¼‰</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆè€å¹´ä»£ç”¨æ ‡è®°-æ•´ç†ï¼Ÿ</strong></p>
<ul>
<li>è€å¹´ä»£å¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œç§»åŠ¨æˆæœ¬ç›¸å¯¹è¾ƒä½</li>
<li>é¿å…å†…å­˜ç¢ç‰‡ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡</li>
<li>ä¸æµªè´¹å†…å­˜ï¼ˆä¸åƒæ ‡è®°-å¤åˆ¶éœ€è¦ä¸¤å—å†…å­˜ï¼‰</li>
</ul>
<p><strong>5. åˆ†ä»£æ”¶é›†ç®—æ³•çš„åŸç†ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ç†è®ºåŸºç¡€ï¼š</strong>
æ ¹æ®å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸åŒï¼Œå°†å†…å­˜åˆ†ä¸ºä¸åŒçš„ä»£ï¼š</p>
<ul>
<li><strong>å¤§éƒ¨åˆ†å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­</strong>ï¼šåˆ›å»ºåå¾ˆå¿«è¢«å›æ”¶</li>
<li><strong>å°‘æ•°å¯¹è±¡ç”Ÿå‘½å‘¨æœŸå¾ˆé•¿</strong>ï¼šé•¿æœŸå­˜æ´»</li>
</ul>
<p><strong>åˆ†ä»£ç­–ç•¥ï¼š</strong></p>
<p><strong>å¹´è½»ä»£ï¼ˆYoung Generationï¼‰ï¼š</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œç”Ÿå‘½å‘¨æœŸçŸ­</li>
<li><strong>å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-å¤åˆ¶ç®—æ³•ï¼ˆå¿«é€Ÿé«˜æ•ˆï¼‰</li>
<li><strong>å›æ”¶é¢‘ç‡</strong>ï¼šé«˜ï¼ˆé¢‘ç¹å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶ç±»å‹</strong>ï¼šPartial GCï¼ˆéƒ¨åˆ†å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶æ—¶é—´</strong>ï¼šçŸ­ï¼ˆå‡ æ¯«ç§’ï¼‰</li>
</ul>
<p><strong>è€å¹´ä»£ï¼ˆOld Generationï¼‰ï¼š</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šå­˜æ”¾é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œç”Ÿå‘½å‘¨æœŸé•¿</li>
<li><strong>å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆé¿å…ç¢ç‰‡ï¼‰</li>
<li><strong>å›æ”¶é¢‘ç‡</strong>ï¼šä½ï¼ˆå¶å°”å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶ç±»å‹</strong>ï¼šFull GCï¼ˆå®Œå…¨å›æ”¶ï¼‰</li>
<li><strong>å›æ”¶æ—¶é—´</strong>ï¼šé•¿ï¼ˆå¯èƒ½å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼‰</li>
</ul>
<p><strong>Androidä¸­çš„åˆ†ä»£æ”¶é›†ï¼š</strong></p>
<ol>
<li><strong>å¹´è½»ä»£ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•</strong>ï¼šå¿«é€Ÿå›æ”¶ï¼Œé€‚åˆé¢‘ç¹å›æ”¶</li>
<li><strong>è€å¹´ä»£ç”¨æ ‡è®°-æ•´ç†ç®—æ³•</strong>ï¼šé¿å…å†…å­˜ç¢ç‰‡</li>
<li><strong>è¿™æ ·è®¾è®¡çš„å¥½å¤„</strong>ï¼šæé«˜GCæ•ˆç‡ï¼Œå‡å°‘GCæš‚åœæ—¶é—´ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡</li>
</ol>
<p><strong>å¯¹è±¡æ™‹å‡è¿‡ç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ–°å¯¹è±¡ â†’ å¹´è½»ä»£ï¼ˆEdenåŒºï¼‰
<span class="hljs-bullet">2.</span> å¹´è½»ä»£GC â†’ å­˜æ´»å¯¹è±¡ â†’ SurvivoråŒº
<span class="hljs-bullet">3.</span> å¤šæ¬¡GCåä»å­˜æ´» â†’ æ™‹å‡åˆ°è€å¹´ä»£
<span class="hljs-bullet">4.</span> è€å¹´ä»£GC â†’ å›æ”¶é•¿æœŸå­˜æ´»çš„å¯¹è±¡
</code></pre>
<h4 data-id="heading-78">6.1.3 Android GCåŸºç¡€</h4>
<p><strong>1. Androidä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>Androidä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨æ˜¯<strong>å¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼ˆConcurrent Copyingï¼Œç®€ç§°CCï¼‰</strong>ã€‚</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>åªæœ‰ä¸€ä¸ªæ”¶é›†å™¨</strong>ï¼šAndroidåªæœ‰è¿™ä¸€ç§æ”¶é›†å™¨</li>
<li><strong>ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨</strong>ï¼šå¼€å‘è€…ä¸éœ€è¦é€‰æ‹©ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨è¿™ä¸ªæ”¶é›†å™¨</li>
<li><strong>æ²¡æœ‰å¤šç§å¯é€‰</strong>ï¼šä¸åƒJVMæœ‰Serialã€Parallelã€CMSã€G1ã€ZGCç­‰å¤šç§å¯é€‰</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆåªæœ‰ä¸€ä¸ªï¼Ÿ</strong></p>
<ul>
<li>é’ˆå¯¹Androidåœºæ™¯ä¼˜åŒ–ï¼šä½å»¶è¿Ÿã€äº¤äº’å¼åº”ç”¨</li>
<li>ä¸éœ€è¦å¼€å‘è€…é€‰æ‹©ï¼šç³»ç»Ÿè‡ªåŠ¨ç®¡ç†</li>
<li>ç®€åŒ–å¼€å‘ï¼šå¼€å‘è€…ä¸éœ€è¦äº†è§£å¤šç§æ”¶é›†å™¨çš„åŒºåˆ«</li>
</ul>
<p><strong>æ”¶é›†å™¨çš„ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>åˆ†ä»£å›æ”¶ï¼šå¹´è½»ä»£å’Œè€å¹´ä»£</li>
<li>å¹¶å‘å›æ”¶ï¼šåœ¨åå°çº¿ç¨‹æ‰§è¡Œï¼Œå‡å°‘ä¸»çº¿ç¨‹æš‚åœ</li>
<li>å¤åˆ¶ç®—æ³•ï¼šé€‚åˆå¹´è½»ä»£ï¼Œæ²¡æœ‰å†…å­˜ç¢ç‰‡</li>
<li>å¢é‡å›æ”¶ï¼šæŠŠå¤§é‡å›æ”¶å·¥ä½œåˆ†æˆå°ä»½ï¼Œé¿å…ä¸€æ¬¡æ€§å¡é¡¿å¤ªä¹…</li>
<li>å‹ç¼©å›æ”¶ï¼šå›æ”¶åæ•´ç†å†…å­˜ï¼Œé¿å…å†…å­˜ç¢ç‰‡</li>
</ul>
<p><strong>2. Androidæœ‰å‡ ç§åƒåœ¾å›æ”¶å™¨å¯é€‰ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>Androidæ²¡æœ‰å¤šç§æ”¶é›†å™¨å¯é€‰ï¼Œåªæœ‰ä¸€ç§ã€‚</strong></p>
<ul>
<li><strong>åªæœ‰ä¸€ç§</strong>ï¼šå¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼ˆConcurrent Copyingï¼ŒCCï¼‰</li>
<li><strong>ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨</strong>ï¼šå¼€å‘è€…ä¸éœ€è¦é€‰æ‹©ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨</li>
<li><strong>ä¸éœ€è¦é…ç½®</strong>ï¼šä¸åƒJVMéœ€è¦é…ç½®-XX:+UseXXXå‚æ•°</li>
</ul>
<p><strong>ä¸JVMçš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li><strong>JVM</strong>ï¼šæœ‰å¤šç§æ”¶é›†å™¨å¯é€‰ï¼ˆSerialã€Parallelã€CMSã€G1ã€ZGCã€Shenandoahç­‰ï¼‰ï¼Œéœ€è¦å¼€å‘è€…æ ¹æ®åº”ç”¨ç‰¹ç‚¹é€‰æ‹©</li>
<li><strong>Android</strong>ï¼šåªæœ‰ä¸€ç§ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨ï¼Œé’ˆå¯¹Androidåœºæ™¯ä¼˜åŒ–</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆä¸éœ€è¦å¤šç§å¯é€‰ï¼Ÿ</strong></p>
<ul>
<li>Androidåº”ç”¨çš„ç‰¹ç‚¹ç›¸ä¼¼ï¼šéƒ½æ˜¯äº¤äº’å¼åº”ç”¨ï¼Œéœ€è¦ä½å»¶è¿Ÿ</li>
<li>ç³»ç»Ÿè‡ªåŠ¨ä¼˜åŒ–ï¼šé’ˆå¯¹Androidåœºæ™¯å·²ç»ä¼˜åŒ–å¥½äº†</li>
<li>ç®€åŒ–å¼€å‘ï¼šå¼€å‘è€…ä¸éœ€è¦äº†è§£å¤šç§æ”¶é›†å™¨çš„åŒºåˆ«å’Œé€‰æ‹©</li>
</ul>
<p><strong>3. Partial GCå’ŒFull GCçš„åŒºåˆ«ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>Partial GCï¼ˆéƒ¨åˆ†å›æ”¶ï¼‰ï¼š</strong></p>
<ul>
<li><strong>å›æ”¶èŒƒå›´</strong>ï¼šåªå›æ”¶å¹´è½»ä»£</li>
<li><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå¹´è½»ä»£ç©ºé—´æ»¡äº†</li>
<li><strong>å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-å¤åˆ¶ç®—æ³•</li>
<li><strong>å›æ”¶æ—¶é—´</strong>ï¼šçŸ­ï¼ˆå‡ æ¯«ç§’ï¼‰</li>
<li><strong>å¯¹åº”ç”¨å½±å“</strong>ï¼šå°ï¼Œç”¨æˆ·åŸºæœ¬æ„Ÿè§‰ä¸åˆ°</li>
<li><strong>é¢‘ç‡</strong>ï¼šé«˜ï¼ˆé¢‘ç¹è§¦å‘ï¼‰</li>
</ul>
<p><strong>Full GCï¼ˆå®Œå…¨å›æ”¶ï¼‰ï¼š</strong></p>
<ul>
<li><strong>å›æ”¶èŒƒå›´</strong>ï¼šå›æ”¶æ•´ä¸ªå †ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰</li>
<li><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå †å†…å­˜ä¸è¶³ã€è€å¹´ä»£æ»¡äº†ã€æ˜¾å¼è°ƒç”¨System.gc()</li>
<li><strong>å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-æ•´ç†ç®—æ³•ï¼ˆè€å¹´ä»£ï¼‰</li>
<li><strong>å›æ”¶æ—¶é—´</strong>ï¼šé•¿ï¼ˆå¯èƒ½å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼‰</li>
<li><strong>å¯¹åº”ç”¨å½±å“</strong>ï¼šå¤§ï¼Œå¯èƒ½å¯¼è‡´åº”ç”¨å¡é¡¿ï¼Œç”¨æˆ·èƒ½æ„Ÿè§‰åˆ°</li>
<li><strong>é¢‘ç‡</strong>ï¼šä½ï¼ˆå¶å°”è§¦å‘ï¼‰</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦åŒºåˆ†Partial GCå’ŒFull GCï¼Ÿ</strong></p>
<ul>
<li>å¤§éƒ¨åˆ†å¯¹è±¡åœ¨å¹´è½»ä»£ï¼ŒPartial GCå¿«é€Ÿé«˜æ•ˆ</li>
<li>Full GCå›æ”¶æ•´ä¸ªå †ï¼Œè€—æ—¶é•¿ï¼Œåº”è¯¥å°½é‡é¿å…</li>
<li>åŒºåˆ†åå¯ä»¥ä¼˜åŒ–GCç­–ç•¥ï¼Œå‡å°‘Full GCçš„é¢‘ç‡</li>
</ul>
<p><strong>4. ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘Partial GCï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>è§¦å‘æ¡ä»¶ï¼šå¹´è½»ä»£ç©ºé—´æ»¡äº†</strong></p>
<p><strong>å…·ä½“åœºæ™¯ï¼š</strong></p>
<ul>
<li>åˆ›å»ºäº†å¾ˆå¤šæ–°å¯¹è±¡ï¼Œå¹´è½»ä»£å†…å­˜å¿«ç”¨å®Œäº†</li>
<li>åˆ†é…æ–°å¯¹è±¡æ—¶ï¼Œå¹´è½»ä»£ç©ºé—´ä¸å¤Ÿ</li>
<li>ç³»ç»Ÿæ£€æµ‹åˆ°å¹´è½»ä»£ç©ºé—´ä¸è¶³ï¼Œè‡ªåŠ¨è§¦å‘Partial GC</li>
</ul>
<p><strong>è§¦å‘æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ–°å¯¹è±¡åˆ†é…åœ¨å¹´è½»ä»£
<span class="hljs-bullet">2.</span> å¹´è½»ä»£ç©ºé—´é€æ¸è¢«å ç”¨
<span class="hljs-bullet">3.</span> å¹´è½»ä»£å¿«æ»¡æ—¶ï¼Œç³»ç»Ÿæ£€æµ‹åˆ°ç©ºé—´ä¸è¶³
<span class="hljs-bullet">4.</span> è‡ªåŠ¨è§¦å‘Partial GC
<span class="hljs-bullet">5.</span> åªæ¸…ç†å¹´è½»ä»£ï¼Œä¸æ¸…ç†è€å¹´ä»£
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>è§¦å‘å¿«ï¼Œæ‰§è¡Œå¿«</li>
<li>æš‚åœæ—¶é—´çŸ­ï¼ˆå‡ æ¯«ç§’ï¼‰</li>
<li>å¯¹åº”ç”¨å½±å“å°ï¼Œç”¨æˆ·åŸºæœ¬æ„Ÿè§‰ä¸åˆ°</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createManyObjects</span><span class="hljs-params">()</span> {
    List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10000</span>; i++) {
        list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());  <span class="hljs-comment">// åˆ›å»ºå¤§é‡å¯¹è±¡</span>
        <span class="hljs-comment">// å½“å¹´è½»ä»£å¿«æ»¡æ—¶ï¼Œè§¦å‘Partial GC</span>
    }
}
</code></pre>
<p><strong>5. ä»€ä¹ˆæ—¶å€™ä¼šè§¦å‘Full GCï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>è§¦å‘æ¡ä»¶ï¼šæ•´ä¸ªå †å†…å­˜ä¸è¶³</strong></p>
<p><strong>å…·ä½“åœºæ™¯ï¼š</strong></p>
<ol>
<li>
<p><strong>è€å¹´ä»£ç©ºé—´æ»¡äº†</strong></p>
<ul>
<li>é•¿æœŸå­˜æ´»çš„å¯¹è±¡å æ»¡äº†è€å¹´ä»£</li>
<li>æ— æ³•ç»§ç»­åˆ†é…æ–°å¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>å †å†…å­˜æ•´ä½“ä¸è¶³</strong></p>
<ul>
<li>å¹´è½»ä»£å’Œè€å¹´ä»£éƒ½æ»¡äº†</li>
<li>æ— æ³•åˆ†é…æ–°å¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>æ˜¾å¼è°ƒç”¨System.gc()</strong></p>
<ul>
<li>Androidä¸æ¨èä½¿ç”¨</li>
<li>ä¼šå¼ºåˆ¶è§¦å‘Full GCï¼Œå¯èƒ½å¯¼è‡´å¡é¡¿</li>
</ul>
</li>
</ol>
<p><strong>è§¦å‘æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> å †å†…å­˜ä¸è¶³ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡
<span class="hljs-bullet">2.</span> ç³»ç»Ÿæ£€æµ‹åˆ°å†…å­˜ä¸è¶³
<span class="hljs-bullet">3.</span> è§¦å‘Full GC
<span class="hljs-bullet">4.</span> å›æ”¶æ•´ä¸ªå †ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰
<span class="hljs-bullet">5.</span> å¦‚æœGCåè¿˜æ˜¯ä¸å¤Ÿï¼Œå¯èƒ½æŠ›å‡ºOutOfMemoryError
</code></pre>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æ‰§è¡Œæ…¢ï¼Œæš‚åœæ—¶é—´é•¿ï¼ˆå¯èƒ½å‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼‰</li>
<li>ä¼šæ¸…ç†æ•´ä¸ªå †ï¼ˆå¹´è½»ä»£+è€å¹´ä»£ï¼‰</li>
<li>å¯èƒ½å¯¼è‡´åº”ç”¨å¡é¡¿ï¼Œç”¨æˆ·èƒ½æ„Ÿè§‰åˆ°</li>
</ul>
<p><strong>å¦‚ä½•é¿å…Full GCï¼Ÿ</strong></p>
<ul>
<li>é¿å…å†…å­˜æ³„æ¼</li>
<li>å‡å°‘è€å¹´ä»£å¯¹è±¡</li>
<li>ä¸è¦æ˜¾å¼è°ƒç”¨System.gc()</li>
<li>ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
</ul>
<p><strong>6. Sticky GCæ˜¯ä»€ä¹ˆï¼Ÿé€‚ç”¨åœºæ™¯ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>**Sticky GCï¼ˆç²˜æ€§å›æ”¶ï¼‰**æ˜¯ä¸€ç§å¿«é€Ÿæ¸…ç†æ–°åˆ†é…çš„çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„GCç±»å‹ã€‚</p>
<p><strong>ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li><strong>åªæ¸…ç†æ–°å¯¹è±¡</strong>ï¼šåªæ¸…ç†åˆšåˆšåˆ›å»ºçš„æ–°å¯¹è±¡</li>
<li><strong>éå¸¸å¿«é€Ÿ</strong>ï¼šå‡ ä¹æ„Ÿè§‰ä¸åˆ°</li>
<li><strong>æš‚åœæ—¶é—´æçŸ­</strong>ï¼šå‡ æ¯«ç§’ç”šè‡³æ›´çŸ­</li>
<li><strong>ä¸“é—¨ä¼˜åŒ–é¢‘ç¹åˆ†é…å¯¹è±¡çš„åœºæ™¯</strong></li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<ol>
<li>
<p><strong>åˆ—è¡¨å¿«é€Ÿæ»‘åŠ¨æ—¶</strong></p>
<ul>
<li>RecyclerViewæ»šåŠ¨æ—¶é¢‘ç¹åˆ›å»ºViewHolderã€ä¸´æ—¶å¯¹è±¡</li>
<li>Sticky GCå¿«é€Ÿæ¸…ç†è¿™äº›çŸ­ç”Ÿå‘½å‘¨æœŸå¯¹è±¡</li>
</ul>
</li>
<li>
<p><strong>åŠ¨ç”»æ’­æ”¾æ—¶</strong></p>
<ul>
<li>åŠ¨ç”»è¿‡ç¨‹ä¸­ä¸æ–­åˆ›å»ºä¸´æ—¶å¯¹è±¡</li>
<li>Sticky GCå¿«é€Ÿæ¸…ç†</li>
</ul>
</li>
<li>
<p><strong>UIæ¸²æŸ“æ—¶</strong></p>
<ul>
<li>UIæ¸²æŸ“æ—¶é¢‘ç¹åˆ›å»ºViewç›¸å…³å¯¹è±¡</li>
<li>Sticky GCå¿«é€Ÿæ¸…ç†</li>
</ul>
</li>
</ol>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> åº”ç”¨è¿è¡ŒæœŸé—´é¢‘ç¹åˆ›å»ºå¯¹è±¡
<span class="hljs-bullet">2.</span> ç³»ç»Ÿæ£€æµ‹åˆ°é¢‘ç¹åˆ†é…
<span class="hljs-bullet">3.</span> è§¦å‘Sticky GC
<span class="hljs-bullet">4.</span> åªæ¸…ç†åˆšåˆšåˆ›å»ºçš„æ–°å¯¹è±¡ï¼ˆçŸ­ç”Ÿå‘½å‘¨æœŸï¼‰
<span class="hljs-bullet">5.</span> å¿«é€Ÿå®Œæˆï¼Œå‡ ä¹ä¸å½±å“åº”ç”¨
</code></pre>
<p><strong>ä¸å…¶ä»–GCç±»å‹çš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li><strong>Partial GC</strong>ï¼šæ¸…ç†æ•´ä¸ªå¹´è½»ä»£ï¼Œæš‚åœæ—¶é—´å‡ æ¯«ç§’</li>
<li><strong>Full GC</strong>ï¼šæ¸…ç†æ•´ä¸ªå †ï¼Œæš‚åœæ—¶é—´å‡ ååˆ°å‡ ç™¾æ¯«ç§’</li>
<li><strong>Sticky GC</strong>ï¼šåªæ¸…ç†æ–°å¯¹è±¡ï¼Œæš‚åœæ—¶é—´æçŸ­ï¼Œå‡ ä¹æ„Ÿè§‰ä¸åˆ°</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java">recyclerView.addOnScrollListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RecyclerView</span>.OnScrollListener() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onScrolled</span><span class="hljs-params">(RecyclerView recyclerView, <span class="hljs-type">int</span> dx, <span class="hljs-type">int</span> dy)</span> {
        <span class="hljs-comment">// æ»‘åŠ¨æ—¶é¢‘ç¹åˆ›å»ºå¯¹è±¡</span>
        <span class="hljs-comment">// è§¦å‘Sticky GCï¼Œå¿«é€Ÿæ¸…ç†</span>
        <span class="hljs-comment">// å‡ ä¹æ„Ÿè§‰ä¸åˆ°å¡é¡¿</span>
    }
});
</code></pre>
<h4 data-id="heading-79">6.2 Android GCå®è·µé¢˜ï¼ˆé‡ç‚¹ï¼‰</h4>
<h4 data-id="heading-80">6.2.1 GCä¼˜åŒ–</h4>
<p><strong>1. Android GCä¼˜åŒ–çš„ç›®æ ‡æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>Android GCä¼˜åŒ–çš„ä¸»è¦ç›®æ ‡æœ‰å››ä¸ªï¼š</p>
<p><strong>1. é™ä½GCæš‚åœæ—¶é—´ï¼ˆæœ€é‡è¦ï¼‰</strong></p>
<ul>
<li>GCæš‚åœä¼šå¯¼è‡´åº”ç”¨å¡é¡¿ï¼Œå½±å“ç”¨æˆ·ä½“éªŒ</li>
<li>ç›®æ ‡ï¼šå°½é‡å‡å°‘GCæš‚åœæ—¶é—´ï¼Œç‰¹åˆ«æ˜¯Full GC</li>
<li>æ–¹æ³•ï¼šé¿å…è§¦å‘Full GCï¼Œå‡å°‘å¯¹è±¡åˆ›å»º</li>
</ul>
<p><strong>2. å‡å°‘å†…å­˜å ç”¨</strong></p>
<ul>
<li>Androidè®¾å¤‡å†…å­˜æœ‰é™ï¼Œå¿…é¡»åˆç†ä½¿ç”¨</li>
<li>ç›®æ ‡ï¼šå‡å°‘å†…å­˜å ç”¨ï¼Œé™ä½å†…å­˜å‹åŠ›</li>
<li>æ–¹æ³•ï¼šåŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡ï¼Œé¿å…å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>3. æå‡åº”ç”¨æµç•…åº¦</strong></p>
<ul>
<li>GCä¼šå½±å“åº”ç”¨æ€§èƒ½ï¼Œå¯¼è‡´å¡é¡¿</li>
<li>ç›®æ ‡ï¼šæå‡åº”ç”¨æµç•…åº¦ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</li>
<li>æ–¹æ³•ï¼šå‡å°‘GCé¢‘ç‡ï¼Œä¼˜åŒ–GCæ€§èƒ½</li>
</ul>
<p><strong>4. é¿å…ANRï¼ˆApplication Not Respondingï¼‰</strong></p>
<ul>
<li>é•¿æ—¶é—´GCå¯èƒ½å¯¼è‡´ANR</li>
<li>ç›®æ ‡ï¼šé¿å…ANRï¼Œä¿è¯åº”ç”¨å“åº”</li>
<li>æ–¹æ³•ï¼šå‡å°‘Full GCï¼Œä¼˜åŒ–GCæ€§èƒ½</li>
</ul>
<p><strong>ä¼˜åŒ–ä¼˜å…ˆçº§ï¼š</strong>
é™ä½GCæš‚åœæ—¶é—´ &gt; å‡å°‘å†…å­˜å ç”¨ &gt; æå‡æµç•…åº¦ &gt; é¿å…ANR</p>
<p><strong>2. å¦‚ä½•å‡å°‘GCé¢‘ç‡ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å‡å°‘GCé¢‘ç‡çš„æ ¸å¿ƒæ˜¯<strong>å‡å°‘å¯¹è±¡åˆ†é…</strong>ã€‚</p>
<p><strong>1. å¯¹è±¡å¤ç”¨ï¼ˆä½¿ç”¨å¯¹è±¡æ± ï¼‰</strong></p>
<ul>
<li>å¤ç”¨å¯¹è±¡ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯</li>
<li>ç¤ºä¾‹ï¼šRecyclerViewçš„ViewHolderæ± ã€è‡ªå®šä¹‰å¯¹è±¡æ± </li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šé¢‘ç¹åˆ›å»ºå¯¹è±¡</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Hello"</span>);  <span class="hljs-comment">// æ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šå¤ç”¨å¯¹è±¡</span>
<span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Hello"</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    <span class="hljs-comment">// å¤ç”¨åŒä¸€ä¸ªå¯¹è±¡</span>
}
</code></pre>
<p><strong>2. é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</strong></p>
<ul>
<li>ä½¿ç”¨StringBuilderè€Œä¸æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥</li>
<li>é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡</li>
<li>ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²æ‹¼æ¥ã€ä¸´æ—¶å¯¹è±¡</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå­—ç¬¦ä¸²æ‹¼æ¥</span>
<span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
    result += i;  <span class="hljs-comment">// æ¯æ¬¡éƒ½åˆ›å»ºæ–°Stringå¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨StringBuilder</span>
<span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
    sb.append(i);  <span class="hljs-comment">// å¤ç”¨StringBuilder</span>
}
</code></pre>
<p><strong>3. ä½¿ç”¨åŸºæœ¬ç±»å‹æ›¿ä»£åŒ…è£…ç±»å‹</strong></p>
<ul>
<li>åŸºæœ¬ç±»å‹ä¸åˆ›å»ºå¯¹è±¡ï¼ŒåŒ…è£…ç±»å‹ä¼šåˆ›å»ºå¯¹è±¡</li>
<li>ç¤ºä¾‹ï¼šintè€Œä¸æ˜¯Integerï¼Œbooleanè€Œä¸æ˜¯Boolean</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šä½¿ç”¨åŒ…è£…ç±»å‹</span>
List&lt;Integer&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Integer</span>(i));  <span class="hljs-comment">// åˆ›å»ºIntegerå¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šä½¿ç”¨åŸºæœ¬ç±»å‹æ•°ç»„</span>
<span class="hljs-type">int</span>[] array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">1000</span>];
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    array[i] = i;  <span class="hljs-comment">// ä¸åˆ›å»ºå¯¹è±¡</span>
}
</code></pre>
<p><strong>4. ä¼˜åŒ–æ•°æ®ç»“æ„</strong></p>
<ul>
<li>é€‰æ‹©åˆé€‚çš„é›†åˆç±»</li>
<li>åŠæ—¶æ¸…ç†é›†åˆï¼Œé¿å…é›†åˆæ³„æ¼</li>
</ul>
<p><strong>3. å¦‚ä½•å‡å°‘GCåœé¡¿æ—¶é—´ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å‡å°‘GCåœé¡¿æ—¶é—´çš„æ ¸å¿ƒæ˜¯<strong>é¿å…Full GC</strong>ã€‚</p>
<p><strong>1. é¿å…è§¦å‘Full GC</strong></p>
<ul>
<li>Full GCæš‚åœæ—¶é—´é•¿ï¼ˆå‡ ååˆ°å‡ ç™¾æ¯«ç§’ï¼‰ï¼Œä¼šå¯¼è‡´æ˜æ˜¾å¡é¡¿</li>
<li>æ–¹æ³•ï¼š
<ul>
<li>é¿å…å†…å­˜æ³„æ¼ï¼ˆå†…å­˜æ³„æ¼ä¼šå¯¼è‡´è€å¹´ä»£æ»¡ï¼Œè§¦å‘Full GCï¼‰</li>
<li>å‡å°‘è€å¹´ä»£å¯¹è±¡ï¼ˆå‡å°‘Full GCçš„è§¦å‘ï¼‰</li>
<li>ä¸è¦æ˜¾å¼è°ƒç”¨System.gc()ï¼ˆä¼šå¼ºåˆ¶è§¦å‘Full GCï¼‰</li>
</ul>
</li>
</ul>
<p><strong>2. å‡å°‘å¯¹è±¡åˆ›å»º</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»ºå¯ä»¥å‡å°‘GCé¢‘ç‡</li>
<li>æ–¹æ³•ï¼šå¯¹è±¡å¤ç”¨ã€ä½¿ç”¨å¯¹è±¡æ± ã€é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
</ul>
<p><strong>3. ä¿®å¤å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>å†…å­˜æ³„æ¼ä¼šå¯¼è‡´å†…å­˜é€æ¸è¢«å ç”¨ï¼Œæœ€ç»ˆè§¦å‘Full GC</li>
<li>æ–¹æ³•ï¼šä½¿ç”¨LeakCanaryæ£€æµ‹ï¼Œä¿®å¤å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>4. ä¼˜åŒ–GCæ€§èƒ½</strong></p>
<ul>
<li>è®©Partial GCæ›´é«˜æ•ˆ</li>
<li>æ–¹æ³•ï¼šå‡å°‘å¹´è½»ä»£å¯¹è±¡ï¼Œè®©Partial GCå¿«é€Ÿå®Œæˆ</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå¯èƒ½å¯¼è‡´Full GC</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();  <span class="hljs-comment">// å†…å­˜æ³„æ¼</span>

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šé¿å…Full GC</span>
<span class="hljs-keyword">private</span> LruCache&lt;String, Bitmap&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LruCache</span>&lt;&gt;(<span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);  <span class="hljs-comment">// æœ‰å¤§å°é™åˆ¶</span>
</code></pre>
<p><strong>4. å¦‚ä½•ä¼˜åŒ–åˆ—è¡¨æ»‘åŠ¨æ€§èƒ½ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>åˆ—è¡¨æ»‘åŠ¨æ—¶é¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œå®¹æ˜“è§¦å‘GCï¼Œå¯¼è‡´å¡é¡¿ã€‚</p>
<p><strong>1. ViewHolderå¤ç”¨</strong></p>
<ul>
<li>RecyclerViewçš„ViewHolderä¼šè‡ªåŠ¨å¤ç”¨ï¼Œé¿å…é¢‘ç¹åˆ›å»º</li>
<li>ç¡®ä¿ViewHolderæ­£ç¡®å¤ç”¨ï¼Œä¸è¦æ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecyclerView</span>.Adapter&lt;MyAdapter.ViewHolder&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ViewHolder <span class="hljs-title function_">onCreateViewHolder</span><span class="hljs-params">(ViewGroup parent, <span class="hljs-type">int</span> viewType)</span> {
        <span class="hljs-comment">// ViewHolderå¤ç”¨ï¼Œé¿å…é¢‘ç¹åˆ›å»º</span>
        <span class="hljs-type">View</span> <span class="hljs-variable">view</span> <span class="hljs-operator">=</span> LayoutInflater.from(parent.getContext())
            .inflate(R.layout.item, parent, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ViewHolder</span>(view);
    }
}
</code></pre>
<p><strong>2. é¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</strong></p>
<ul>
<li>onBindViewHolderåœ¨æ»‘åŠ¨æ—¶é¢‘ç¹è°ƒç”¨ï¼Œä¸è¦åœ¨è¿™é‡Œåˆ›å»ºå¯¹è±¡</li>
<li>å¤ç”¨å­—ç¬¦ä¸²ã€é¿å…åˆ›å»ºä¸´æ—¶å¯¹è±¡</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
    holder.textView.setText(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Item "</span> + position));  <span class="hljs-comment">// åˆ›å»ºæ–°å¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
    holder.textView.setText(<span class="hljs-string">"Item "</span> + position);  <span class="hljs-comment">// å¤ç”¨å­—ç¬¦ä¸²</span>
}
</code></pre>
<p><strong>3. ä½¿ç”¨å¯¹è±¡æ± </strong></p>
<ul>
<li>å¯¹äºéœ€è¦é¢‘ç¹åˆ›å»ºçš„å¯¹è±¡ï¼Œä½¿ç”¨å¯¹è±¡æ± </li>
<li>ç¤ºä¾‹ï¼šè‡ªå®šä¹‰å¯¹è±¡æ± ç®¡ç†å¯¹è±¡å¤ç”¨</li>
</ul>
<p><strong>4. å‡å°‘GC</strong></p>
<ul>
<li>é€šè¿‡ä»¥ä¸Šæ–¹æ³•å‡å°‘å¯¹è±¡åˆ›å»ºï¼Œå‡å°‘GCé¢‘ç‡</li>
<li>è®©åˆ—è¡¨æ»‘åŠ¨æ›´æµç•…</li>
</ul>
<p><strong>5. å¦‚ä½•ä½¿ç”¨å¯¹è±¡æ± å‡å°‘å¯¹è±¡åˆ†é…ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å¯¹è±¡æ± çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>å¤ç”¨å¯¹è±¡</strong>ï¼Œé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯ã€‚</p>
<p><strong>åŸç†ï¼š</strong></p>
<ol>
<li>é¢„å…ˆåˆ›å»ºä¸€äº›å¯¹è±¡ï¼Œæ”¾åœ¨æ± ä¸­</li>
<li>éœ€è¦æ—¶ä»æ± ä¸­è·å–ï¼Œä½¿ç”¨å®Œåå½’è¿˜åˆ°æ± ä¸­</li>
<li>é¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯å¯¹è±¡</li>
</ol>
<p><strong>å®ç°æ–¹å¼ï¼š</strong></p>
<p><strong>1. RecyclerViewçš„ViewHolderæ± ï¼ˆç³»ç»Ÿè‡ªå¸¦ï¼‰</strong></p>
<ul>
<li>RecyclerViewè‡ªåŠ¨ç®¡ç†ViewHolderæ± </li>
<li>å¼€å‘è€…åªéœ€è¦æ­£ç¡®å®ç°Adapter</li>
</ul>
<p><strong>2. è‡ªå®šä¹‰å¯¹è±¡æ± </strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectPool</span>&lt;T&gt; {
    <span class="hljs-keyword">private</span> Queue&lt;T&gt; pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> maxSize;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ObjectPool</span><span class="hljs-params">(<span class="hljs-type">int</span> maxSize)</span> {
        <span class="hljs-built_in">this</span>.maxSize = maxSize;
    }
    
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">acquire</span><span class="hljs-params">()</span> {
        <span class="hljs-type">T</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> pool.poll();
        <span class="hljs-keyword">if</span> (obj == <span class="hljs-literal">null</span>) {
            obj = createObject();  <span class="hljs-comment">// æ± ä¸ºç©ºæ—¶åˆ›å»ºæ–°å¯¹è±¡</span>
        }
        <span class="hljs-keyword">return</span> obj;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">release</span><span class="hljs-params">(T obj)</span> {
        <span class="hljs-keyword">if</span> (pool.size() &lt; maxSize) {
            resetObject(obj);  <span class="hljs-comment">// é‡ç½®å¯¹è±¡çŠ¶æ€</span>
            pool.offer(obj);   <span class="hljs-comment">// å½’è¿˜åˆ°æ± ä¸­</span>
        }
    }
}
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é¢‘ç¹åˆ›å»ºçš„å¯¹è±¡ï¼ˆå¦‚åŠ¨ç”»å¯¹è±¡ã€ä¸´æ—¶å¯¹è±¡ï¼‰</li>
<li>åˆ›å»ºæˆæœ¬é«˜çš„å¯¹è±¡ï¼ˆå¦‚Bitmapã€å¤§å¯¹è±¡ï¼‰</li>
</ul>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»ºï¼Œå‡å°‘GCé¢‘ç‡</li>
<li>æé«˜æ€§èƒ½ï¼Œå‡å°‘å†…å­˜åˆ†é…å¼€é”€</li>
</ul>
<p><strong>6. å¦‚ä½•é¿å…Full GCï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>Full GCæš‚åœæ—¶é—´é•¿ï¼Œåº”è¯¥å°½é‡é¿å…ã€‚</p>
<p><strong>1. é¿å…å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>å†…å­˜æ³„æ¼ä¼šå¯¼è‡´å¯¹è±¡æ— æ³•å›æ”¶ï¼Œå†…å­˜é€æ¸è¢«å ç”¨</li>
<li>æœ€ç»ˆå¯¼è‡´è€å¹´ä»£æ»¡ï¼Œè§¦å‘Full GC</li>
<li>æ–¹æ³•ï¼šä½¿ç”¨LeakCanaryæ£€æµ‹ï¼Œä¿®å¤å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>2. å‡å°‘è€å¹´ä»£å¯¹è±¡</strong></p>
<ul>
<li>è€å¹´ä»£å¯¹è±¡å¤šï¼Œå®¹æ˜“è§¦å‘Full GC</li>
<li>æ–¹æ³•ï¼š
<ul>
<li>å‡å°‘é•¿æœŸå­˜æ´»çš„å¯¹è±¡</li>
<li>åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡</li>
<li>é¿å…å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</li>
</ul>
</li>
</ul>
<p><strong>3. ä¸è¦æ˜¾å¼è°ƒç”¨System.gc()</strong></p>
<ul>
<li>System.gc()ä¼šå¼ºåˆ¶è§¦å‘Full GC</li>
<li>Androidä¸æ¨èä½¿ç”¨</li>
<li>åº”è¯¥è®©ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†GC</li>
</ul>
<p><strong>4. ä¼˜åŒ–å†…å­˜ä½¿ç”¨</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„å¯¹è±¡</li>
<li>åˆç†ä½¿ç”¨ç¼“å­˜ï¼ˆLruCacheï¼‰</li>
</ul>
<p><strong>5. ç›‘æ§å’Œè°ƒä¼˜</strong></p>
<ul>
<li>ä½¿ç”¨Profilerç›‘æ§GC</li>
<li>æŸ¥çœ‹GCæ—¥å¿—ï¼Œåˆ†æFull GCçš„åŸå› </li>
<li>æ ¹æ®å®é™…æƒ…å†µä¼˜åŒ–</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå¯èƒ½å¯¼è‡´Full GC</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();  <span class="hljs-comment">// æ— é™åˆ¶ç¼“å­˜ï¼Œå†…å­˜æ³„æ¼</span>

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šé¿å…Full GC</span>
<span class="hljs-keyword">private</span> LruCache&lt;String, Bitmap&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LruCache</span>&lt;&gt;(<span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);  <span class="hljs-comment">// æœ‰å¤§å°é™åˆ¶</span>
</code></pre>
<h4 data-id="heading-81">6.2.2 å†…å­˜æ³„æ¼</h4>
<p><strong>1. ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>å®šä¹‰ï¼š</strong>
å†…å­˜æ³„æ¼æ˜¯æŒ‡å¯¹è±¡å·²ç»ä¸å†ä½¿ç”¨ï¼Œä½†å› ä¸ºè¢«å¼•ç”¨æ— æ³•è¢«GCå›æ”¶ï¼Œå¯¼è‡´å†…å­˜é€æ¸è¢«å ç”¨ã€‚</p>
<p><strong>ä¸å†…å­˜æº¢å‡ºçš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šå¯¹è±¡æ— æ³•å›æ”¶ï¼Œå†…å­˜é€æ¸è¢«å ç”¨ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´OOM</li>
<li><strong>å†…å­˜æº¢å‡º</strong>ï¼šå†…å­˜çœŸçš„ä¸å¤Ÿç”¨äº†ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡ï¼Œç«‹å³æŠ›å‡ºOutOfMemoryError</li>
</ul>
<p><strong>å±å®³ï¼š</strong></p>
<ul>
<li>å†…å­˜é€æ¸è¢«å ç”¨ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´OOM</li>
<li>åº”ç”¨å˜æ…¢ï¼Œå¯èƒ½è¢«ç³»ç»Ÿæ€æ­»</li>
<li>é¢‘ç¹è§¦å‘Full GCï¼Œå¯¼è‡´å¡é¡¿</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å†…å­˜æ³„æ¼ç¤ºä¾‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryLeak</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addToCache</span><span class="hljs-params">(Object obj)</span> {
        cache.add(obj);  <span class="hljs-comment">// å¯¹è±¡è¢«cacheå¼•ç”¨ï¼Œæ— æ³•å›æ”¶</span>
        <span class="hljs-comment">// å³ä½¿objä¸å†ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•è¢«GCå›æ”¶</span>
        <span class="hljs-comment">// å†…å­˜é€æ¸è¢«å ç”¨ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´OOM</span>
    }
}
</code></pre>
<p><strong>2. Androidä¸­å¸¸è§çš„å†…å­˜æ³„æ¼åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. Activity/Contextæ³„æ¼</strong></p>
<ul>
<li><strong>é™æ€å˜é‡æŒæœ‰Activityå¼•ç”¨</strong>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Activity activity;  <span class="hljs-comment">// é™æ€å˜é‡æŒæœ‰Activityï¼Œå¯¼è‡´æ³„æ¼</span>
</code></pre>
</li>
<li><strong>å•ä¾‹æŒæœ‰Contextå¼•ç”¨</strong>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å•ä¾‹æŒæœ‰Activity Contextï¼Œå¯¼è‡´æ³„æ¼</span>
<span class="hljs-keyword">private</span> Context context;  <span class="hljs-comment">// å¦‚æœæ˜¯Activity Contextï¼Œä¼šæ³„æ¼</span>
</code></pre>
</li>
<li><strong>å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨</strong>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// HandleræŒæœ‰Activityå¼•ç”¨</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">Handler</span> <span class="hljs-variable">handler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Handler</span>() {
    <span class="hljs-comment">// HandleræŒæœ‰Activityå¼•ç”¨ï¼Œå¯¼è‡´æ³„æ¼</span>
};
</code></pre>
</li>
</ul>
<p><strong>2. å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨</strong></p>
<ul>
<li><strong>Handlerå†…å­˜æ³„æ¼</strong>ï¼šHandleræŒæœ‰Activityå¼•ç”¨</li>
<li><strong>åŒ¿åç±»æ³„æ¼</strong>ï¼šåŒ¿åå†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šHandlerã€Runnableã€ç›‘å¬å™¨ç­‰</li>
</ul>
<p><strong>3. ç›‘å¬å™¨æœªå–æ¶ˆæ³¨å†Œ</strong></p>
<ul>
<li><strong>EventBusæœªå–æ¶ˆæ³¨å†Œ</strong>ï¼šæ³¨å†Œäº†ä½†å¿˜è®°å–æ¶ˆæ³¨å†Œ</li>
<li><strong>å¹¿æ’­æ¥æ”¶å™¨æœªå–æ¶ˆæ³¨å†Œ</strong>ï¼šæ³¨å†Œäº†ä½†å¿˜è®°å–æ¶ˆæ³¨å†Œ</li>
<li><strong>å…¶ä»–ç›‘å¬å™¨</strong>ï¼šæ³¨å†Œäº†ä½†å¿˜è®°å–æ¶ˆæ³¨å†Œ</li>
</ul>
<p><strong>4. é›†åˆç±»æ³„æ¼</strong></p>
<ul>
<li><strong>Listã€Mapä¸­ä¿å­˜äº†ä¸å†ä½¿ç”¨çš„å¯¹è±¡</strong></li>
<li>é›†åˆæŒæœ‰å¯¹è±¡å¼•ç”¨ï¼Œå¯¹è±¡æ— æ³•è¢«å›æ”¶</li>
<li>ç¤ºä¾‹ï¼šç¼“å­˜ã€é›†åˆç­‰</li>
</ul>
<p><strong>5. çº¿ç¨‹æ³„æ¼</strong></p>
<ul>
<li>çº¿ç¨‹æŒæœ‰å¯¹è±¡å¼•ç”¨ï¼Œçº¿ç¨‹ä¸ç»“æŸï¼Œå¯¹è±¡æ— æ³•å›æ”¶</li>
<li>ç¤ºä¾‹ï¼šAsyncTaskã€HandlerThreadç­‰</li>
</ul>
<p><strong>6. èµ„æºæœªå…³é—­</strong></p>
<ul>
<li>æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ã€ç½‘ç»œè¿æ¥ç­‰æœªå…³é—­</li>
<li>å¯¼è‡´èµ„æºæ³„æ¼</li>
</ul>
<p><strong>3. å¦‚ä½•æ£€æµ‹å†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. LeakCanaryè‡ªåŠ¨æ£€æµ‹ï¼ˆæ¨èï¼‰</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šä½¿ç”¨WeakReferenceå’ŒReferenceQueueï¼Œç›‘æ§å¯¹è±¡æ˜¯å¦è¢«å›æ”¶</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šè‡ªåŠ¨æ£€æµ‹ï¼Œä¸éœ€è¦æ‰‹åŠ¨åˆ†æï¼Œèƒ½å¿«é€Ÿå‘ç°å†…å­˜æ³„æ¼</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼šæ·»åŠ ä¾èµ–ï¼Œè¿è¡Œåº”ç”¨ï¼Œè‡ªåŠ¨æ£€æµ‹</li>
</ul>
<p><strong>2. MATåˆ†æå †è½¬å‚¨</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šåˆ†æå †è½¬å‚¨æ–‡ä»¶ï¼Œæ‰¾å‡ºæ— æ³•å›æ”¶çš„å¯¹è±¡å’Œå¼•ç”¨é“¾</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šèƒ½è¯¦ç»†åˆ†æå†…å­˜æ³„æ¼çš„åŸå› </li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼šç”Ÿæˆå †è½¬å‚¨ï¼Œå¯¼å‡ºhprofæ–‡ä»¶ï¼Œç”¨MATæ‰“å¼€åˆ†æ</li>
</ul>
<p><strong>3. Android Studio Profiler</strong></p>
<ul>
<li><strong>åŸç†</strong>ï¼šå®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨ï¼ŒæŸ¥çœ‹å¯¹è±¡åˆ†é…æƒ…å†µ</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå®æ—¶ç›‘æ§ï¼Œæ–¹ä¾¿æŸ¥çœ‹å†…å­˜å˜åŒ–</li>
<li><strong>ä½¿ç”¨æ–¹æ³•</strong>ï¼šæ‰“å¼€Profilerçª—å£ï¼ŒæŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</li>
</ul>
<p><strong>æ£€æµ‹æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ä½¿ç”¨LeakCanaryè‡ªåŠ¨æ£€æµ‹ï¼ˆå¼€å‘é˜¶æ®µï¼‰
<span class="hljs-bullet">2.</span> å¦‚æœå‘ç°æ³„æ¼ï¼Œä½¿ç”¨MATåˆ†æå †è½¬å‚¨
<span class="hljs-bullet">3.</span> æ‰¾å‡ºæ³„æ¼å¯¹è±¡å’Œå¼•ç”¨é“¾
<span class="hljs-bullet">4.</span> ä¿®å¤ä»£ç 
</code></pre>
<p><strong>4. å¦‚ä½•é¿å…å†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. æ­£ç¡®å¤„ç†ç”Ÿå‘½å‘¨æœŸ</strong></p>
<ul>
<li>åœ¨onDestroyä¸­æ¸…ç†èµ„æº</li>
<li>å–æ¶ˆæ³¨å†Œç›‘å¬å™¨</li>
<li>å…³é—­æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onDestroy</span><span class="hljs-params">()</span> {
    <span class="hljs-built_in">super</span>.onDestroy();
    <span class="hljs-comment">// æ¸…ç†èµ„æº</span>
    handler.removeCallbacksAndMessages(<span class="hljs-literal">null</span>);
    EventBus.getDefault().unregister(<span class="hljs-built_in">this</span>);
    cache.clear();
}
</code></pre>
<p><strong>2. åŠæ—¶å–æ¶ˆæ³¨å†Œç›‘å¬å™¨</strong></p>
<ul>
<li>æ³¨å†Œçš„ç›‘å¬å™¨è¦åœ¨onDestroyä¸­å–æ¶ˆæ³¨å†Œ</li>
<li>ç¤ºä¾‹ï¼šEventBusã€å¹¿æ’­æ¥æ”¶å™¨ç­‰</li>
</ul>
<p><strong>3. ä½¿ç”¨å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</strong></p>
<ul>
<li>å¯¹äºå¯èƒ½æ³„æ¼çš„å¼•ç”¨ï¼Œä½¿ç”¨WeakReference</li>
<li>ç¤ºä¾‹ï¼šHandlerã€é™æ€å˜é‡æŒæœ‰å¯¹è±¡æ—¶</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyHandler</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Handler</span> {
    <span class="hljs-keyword">private</span> WeakReference&lt;Activity&gt; activityRef;
    
    MyHandler(Activity activity) {
        activityRef = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakReference</span>&lt;&gt;(activity);
    }
}
</code></pre>
<p><strong>4. é¿å…å¾ªç¯å¼•ç”¨</strong></p>
<ul>
<li>æ³¨æ„å¯¹è±¡ä¹‹é—´çš„ç›¸äº’å¼•ç”¨</li>
<li>åŠæ—¶æ–­å¼€ä¸éœ€è¦çš„å¼•ç”¨</li>
</ul>
<p><strong>5. åˆç†ä½¿ç”¨ç¼“å­˜</strong></p>
<ul>
<li>ä½¿ç”¨æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜ï¼ˆLruCacheï¼‰</li>
<li>åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„ç¼“å­˜</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> LruCache&lt;String, Bitmap&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LruCache</span>&lt;&gt;(<span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);
</code></pre>
<h4 data-id="heading-82">6.2.3 å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰</h4>
<p><strong>1. ä»€ä¹ˆæ˜¯å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>å®šä¹‰ï¼š</strong>
å†…å­˜æº¢å‡ºï¼ˆOutOfMemoryErrorï¼ŒOOMï¼‰æ˜¯æŒ‡åº”ç”¨éœ€è¦çš„å†…å­˜è¶…è¿‡äº†ç³»ç»Ÿåˆ†é…çš„é™åˆ¶ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡ã€‚</p>
<p><strong>Androidå †å†…å­˜æº¢å‡ºï¼š</strong></p>
<ul>
<li>æœ€å¸¸è§çš„æ˜¯å †å†…å­˜æº¢å‡ºï¼ˆOutOfMemoryError: Java heap spaceï¼‰</li>
<li>å †å†…å­˜ä¸è¶³ï¼Œæ— æ³•åˆ†é…æ–°å¯¹è±¡</li>
</ul>
<p><strong>å±å®³ï¼š</strong></p>
<ul>
<li>åº”ç”¨å´©æºƒï¼Œç”¨æˆ·ä½“éªŒå·®</li>
<li>å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OOMExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createTooManyObjects</span><span class="hljs-params">()</span> {
        List&lt;Object&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>());  <span class="hljs-comment">// æœ€ç»ˆå¯¼è‡´OOM</span>
        }
    }
}
</code></pre>
<p><strong>2. Androidå †å†…å­˜æº¢å‡ºå¦‚ä½•è§£å†³ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. æ’æŸ¥å†…å­˜æ³„æ¼</strong></p>
<ul>
<li>å†…å­˜æ³„æ¼æ˜¯å¯¼è‡´OOMçš„ä¸»è¦åŸå› </li>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>ä½¿ç”¨MATåˆ†æå †è½¬å‚¨ï¼Œæ‰¾å‡ºæ³„æ¼å¯¹è±¡</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼é—®é¢˜</li>
</ul>
<p><strong>2. å‡å°‘å¯¹è±¡åˆ›å»º</strong></p>
<ul>
<li>å‡å°‘ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¤§é‡å¯¹è±¡</li>
</ul>
<p><strong>3. ä¼˜åŒ–å¤§å¯¹è±¡</strong></p>
<ul>
<li>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡ï¼ˆå¤§å›¾ç‰‡ã€å¤§æ•°ç»„ï¼‰</li>
<li>å‹ç¼©å›¾ç‰‡å¤§å°</li>
<li>é¿å…åŠ è½½è¿‡å¤§çš„å›¾ç‰‡</li>
</ul>
<p><strong>4. åŠæ—¶é‡Šæ”¾èµ„æº</strong></p>
<ul>
<li>åœ¨onDestroyä¸­é‡Šæ”¾èµ„æº</li>
<li>å…³é—­æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥</li>
<li>æ¸…ç†ç¼“å­˜</li>
</ul>
<p><strong>5. åˆ†æ‰¹åŠ è½½æ•°æ®</strong></p>
<ul>
<li>ä¸è¦ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®</li>
<li>åˆ†æ‰¹åŠ è½½ï¼Œå‡å°‘å†…å­˜å‹åŠ›</li>
</ul>
<p><strong>6. å¢åŠ å†…å­˜é™åˆ¶ï¼ˆæ²»æ ‡ä¸æ²»æœ¬ï¼‰</strong></p>
<ul>
<li>åœ¨AndroidManifest.xmlä¸­è®¾ç½®largeHeap="true"</li>
<li>ä½†è¿™ä¸æ˜¯æ ¹æœ¬è§£å†³æ–¹æ¡ˆï¼Œè¿˜æ˜¯è¦ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
</ul>
<p><strong>è§£å†³æµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ç”Ÿæˆå †è½¬å‚¨ï¼ˆOOMæ—¶è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨ç”Ÿæˆï¼‰
<span class="hljs-bullet">2.</span> ä½¿ç”¨MATåˆ†æå †è½¬å‚¨
<span class="hljs-bullet">3.</span> æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡
<span class="hljs-bullet">4.</span> åˆ†æä¸ºä»€ä¹ˆè¿™äº›å¯¹è±¡æ— æ³•å›æ”¶ï¼ˆå†…å­˜æ³„æ¼ï¼Ÿï¼‰
<span class="hljs-bullet">5.</span> ä¿®å¤é—®é¢˜ï¼ˆä¿®å¤å†…å­˜æ³„æ¼ã€ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼‰
</code></pre>
<p><strong>3. å¦‚ä½•æ’æŸ¥å†…å­˜æº¢å‡ºé—®é¢˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>1. ç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>åœ¨OOMæ—¶è‡ªåŠ¨ç”Ÿæˆå †è½¬å‚¨</li>
<li>æˆ–ä½¿ç”¨Android Studio Profileræ‰‹åŠ¨ç”Ÿæˆ</li>
<li>å¯¼å‡ºä¸ºhprofæ–‡ä»¶</li>
</ul>
<p><strong>2. ä½¿ç”¨MATåˆ†æå †è½¬å‚¨</strong></p>
<ul>
<li>ç”¨MATæ‰“å¼€hprofæ–‡ä»¶</li>
<li>æŸ¥çœ‹å ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
<li>åˆ†æå¯¹è±¡çš„å¼•ç”¨é“¾</li>
</ul>
<p><strong>3. æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Histogram"åŠŸèƒ½</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li>åˆ†æè¿™äº›å¯¹è±¡ä¸ºä»€ä¹ˆå ç”¨è¿™ä¹ˆå¤šå†…å­˜</li>
</ul>
<p><strong>4. åˆ†æå¼•ç”¨é“¾ï¼Œæ‰¾å‡ºæ— æ³•å›æ”¶çš„åŸå› </strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Path to GC Roots"åŠŸèƒ½</li>
<li>æ‰¾å‡ºå¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li>åˆ†æä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼ˆå†…å­˜æ³„æ¼ï¼Ÿï¼‰</li>
</ul>
<p><strong>5. ä¿®å¤é—®é¢˜</strong></p>
<ul>
<li>å¦‚æœæ˜¯å†…å­˜æ³„æ¼ï¼Œä¿®å¤æ³„æ¼</li>
<li>å¦‚æœæ˜¯å¤§å¯¹è±¡ï¼Œä¼˜åŒ–å¤§å¯¹è±¡</li>
<li>å¦‚æœæ˜¯å¯¹è±¡å¤ªå¤šï¼Œå‡å°‘å¯¹è±¡åˆ›å»º</li>
</ul>
<p><strong>å¸¸è§åŸå› ï¼š</strong></p>
<ul>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šå¯¹è±¡æ— æ³•å›æ”¶ï¼Œå†…å­˜é€æ¸è¢«å ç”¨</li>
<li><strong>ä¸€æ¬¡æ€§åŠ è½½å¤ªå¤šæ•°æ®</strong>ï¼šä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®åˆ°å†…å­˜</li>
<li><strong>å¤§å¯¹è±¡å ç”¨è¿‡å¤šå†…å­˜</strong>ï¼šåŠ è½½è¿‡å¤§çš„å›¾ç‰‡ã€åˆ›å»ºè¿‡å¤§çš„æ•°ç»„</li>
</ul>
<p><strong>4. Androidå†…å­˜é™åˆ¶æ˜¯å¤šå°‘ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ä¸åŒè®¾å¤‡æœ‰ä¸åŒçš„å †å†…å­˜ä¸Šé™ï¼š</strong></p>
<p><strong>ä½ç«¯è®¾å¤‡ï¼š</strong></p>
<ul>
<li>å¯èƒ½åªæœ‰å‡ åMBï¼ˆå¦‚32MBã€48MBã€64MBï¼‰</li>
<li>å†…å­˜éå¸¸æœ‰é™ï¼Œå¿…é¡»åˆç†ä½¿ç”¨</li>
</ul>
<p><strong>ä¸­ç«¯è®¾å¤‡ï¼š</strong></p>
<ul>
<li>é€šå¸¸æœ‰128MBã€192MBã€256MBç­‰</li>
<li>å†…å­˜ç›¸å¯¹å……è¶³ï¼Œä½†ä»éœ€åˆç†ä½¿ç”¨</li>
</ul>
<p><strong>é«˜ç«¯è®¾å¤‡ï¼š</strong></p>
<ul>
<li>å¯èƒ½æœ‰512MBã€1GBã€2GBç”šè‡³æ›´å¤š</li>
<li>å†…å­˜ç›¸å¯¹å……è¶³ï¼Œä½†ä»éœ€ä¼˜åŒ–</li>
</ul>
<p><strong>å¦‚ä½•æŸ¥çœ‹åº”ç”¨çš„å†…å­˜é™åˆ¶ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ActivityManager</span> <span class="hljs-variable">activityManager</span> <span class="hljs-operator">=</span> (ActivityManager) getSystemService(Context.ACTIVITY_SERVICE);
ActivityManager.<span class="hljs-type">MemoryInfo</span> <span class="hljs-variable">memoryInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ActivityManager</span>.MemoryInfo();
activityManager.getMemoryInfo(memoryInfo);
<span class="hljs-type">long</span> <span class="hljs-variable">maxMemory</span> <span class="hljs-operator">=</span> memoryInfo.totalMem;  <span class="hljs-comment">// æ€»å†…å­˜</span>
<span class="hljs-type">long</span> <span class="hljs-variable">availableMemory</span> <span class="hljs-operator">=</span> memoryInfo.availMem;  <span class="hljs-comment">// å¯ç”¨å†…å­˜</span>
</code></pre>
<p><strong>å†…å­˜é™åˆ¶çš„å½±å“ï¼š</strong></p>
<ul>
<li>å†…å­˜æœ‰é™ï¼Œå¿…é¡»åˆç†ä½¿ç”¨</li>
<li>GCæ›´é¢‘ç¹ï¼ˆå†…å­˜ä¸è¶³æ—¶ï¼‰</li>
<li>éœ€è¦ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œé¿å…OOM</li>
</ul>
<h4 data-id="heading-83">6.2.4 GCæ£€æµ‹ä¸è¯Šæ–­</h4>
<p><strong>1. å¸¸ç”¨çš„Androidå†…å­˜ç›‘æ§å·¥å…·æœ‰å“ªäº›ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. Android Studio Profilerï¼ˆæœ€å¸¸ç”¨ï¼‰</strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šå®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨ã€æŸ¥çœ‹GCäº‹ä»¶ã€ç”Ÿæˆå †è½¬å‚¨</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šé›†æˆåœ¨Android Studioä¸­ï¼Œä½¿ç”¨æ–¹ä¾¿</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ—¥å¸¸å¼€å‘ã€æ€§èƒ½åˆ†æ</li>
</ul>
<p><strong>2. logcatï¼ˆæŸ¥çœ‹GCæ—¥å¿—ï¼‰</strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šæŸ¥çœ‹GCçš„æ—¥å¿—ä¿¡æ¯</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šç®€å•ç›´æ¥ï¼Œå¯ä»¥å®æ—¶æŸ¥çœ‹</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæŸ¥çœ‹GCé¢‘ç‡ã€GCè€—æ—¶</li>
</ul>
<p><strong>3. Systraceï¼ˆåˆ†æGCå¯¹æ€§èƒ½çš„å½±å“ï¼‰</strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šåˆ†æGCå¯¼è‡´çš„å¡é¡¿é—®é¢˜</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šèƒ½è¯¦ç»†åˆ†æGCå¯¹ä¸»çº¿ç¨‹çš„å½±å“</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåˆ†æå¡é¡¿é—®é¢˜</li>
</ul>
<p><strong>4. MATï¼ˆMemory Analyzer Toolï¼‰</strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šåˆ†æå †è½¬å‚¨æ–‡ä»¶ï¼Œæ‰¾å‡ºå†…å­˜é—®é¢˜</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šåŠŸèƒ½å¼ºå¤§ï¼Œèƒ½è¯¦ç»†åˆ†æå†…å­˜æ³„æ¼</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šåˆ†æå†…å­˜æ³„æ¼ã€OOMé—®é¢˜</li>
</ul>
<p><strong>5. LeakCanaryï¼ˆè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼ï¼‰</strong></p>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè‡ªåŠ¨æ£€æµ‹åº”ç”¨ä¸­çš„å†…å­˜æ³„æ¼</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šè‡ªåŠ¨æ£€æµ‹ï¼Œä¸éœ€è¦æ‰‹åŠ¨åˆ†æ</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¼€å‘é˜¶æ®µè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>2. å¦‚ä½•ä½¿ç”¨Android Studio Profilerï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ä½¿ç”¨æ­¥éª¤ï¼š</strong></p>
<p><strong>1. æ‰“å¼€Profilerçª—å£</strong></p>
<ul>
<li>åœ¨Android Studioä¸­ï¼Œç‚¹å‡»åº•éƒ¨çš„"Profiler"æ ‡ç­¾</li>
<li>æˆ–é€šè¿‡èœå•ï¼šView â†’ Tool Windows â†’ Profiler</li>
</ul>
<p><strong>2. é€‰æ‹©è¦åˆ†æçš„åº”ç”¨è¿›ç¨‹</strong></p>
<ul>
<li>åœ¨Profilerçª—å£ä¸­é€‰æ‹©è¦åˆ†æçš„åº”ç”¨è¿›ç¨‹</li>
<li>ç¡®ä¿åº”ç”¨æ­£åœ¨è¿è¡Œ</li>
</ul>
<p><strong>3. æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</strong></p>
<ul>
<li>ç‚¹å‡»"Memory"æ ‡ç­¾</li>
<li>æŸ¥çœ‹å†…å­˜ä½¿ç”¨æ›²çº¿</li>
<li>æŸ¥çœ‹GCäº‹ä»¶ï¼ˆä»€ä¹ˆæ—¶å€™è§¦å‘GCï¼‰</li>
</ul>
<p><strong>4. æŸ¥çœ‹GCäº‹ä»¶</strong></p>
<ul>
<li>åœ¨å†…å­˜æ›²çº¿ä¸­ï¼ŒGCäº‹ä»¶ä¼šæ˜¾ç¤ºä¸ºå°å›¾æ ‡</li>
<li>ç‚¹å‡»GCäº‹ä»¶ï¼Œå¯ä»¥æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ï¼ˆGCç±»å‹ã€è€—æ—¶ç­‰ï¼‰</li>
</ul>
<p><strong>5. ç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>ç‚¹å‡»"Heap Dump"æŒ‰é’®</li>
<li>ç”Ÿæˆå †è½¬å‚¨æ–‡ä»¶</li>
<li>å¯ä»¥å¯¼å‡ºä¸ºhprofæ–‡ä»¶ï¼Œç”¨MATåˆ†æ</li>
</ul>
<p><strong>6. æŸ¥çœ‹å¯¹è±¡åˆ†é…æƒ…å†µ</strong></p>
<ul>
<li>ä½¿ç”¨"Allocation Tracking"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å“ªäº›å¯¹è±¡è¢«åˆ†é…ï¼Œåœ¨å“ªé‡Œåˆ†é…</li>
</ul>
<p><strong>3. å¦‚ä½•æŸ¥çœ‹Android GCæ—¥å¿—ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ–¹æ³•1ï¼šä½¿ç”¨adb logcat</strong></p>
<pre><code class="hljs language-bash" lang="bash">adb logcat | grep GC
</code></pre>
<ul>
<li>ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·æŸ¥çœ‹GCæ—¥å¿—</li>
<li>å¯ä»¥è¿‡æ»¤GCç›¸å…³çš„æ—¥å¿—</li>
</ul>
<p><strong>æ–¹æ³•2ï¼šåœ¨Android Studioçš„Logcatçª—å£ä¸­æŸ¥çœ‹</strong></p>
<ul>
<li>æ‰“å¼€Logcatçª—å£</li>
<li>è¿‡æ»¤GCç›¸å…³çš„æ—¥å¿—</li>
<li>æŸ¥çœ‹GCç±»å‹å’Œè€—æ—¶</li>
</ul>
<p><strong>GCæ—¥å¿—åŒ…å«ä»€ä¹ˆï¼š</strong></p>
<ul>
<li><strong>GCç±»å‹</strong>ï¼šPartial GCã€Full GCã€Sticky GC</li>
<li><strong>GCè€—æ—¶</strong>ï¼šGCæ‰§è¡Œçš„æ—¶é—´</li>
<li><strong>å›æ”¶å‰åçš„å†…å­˜å¤§å°</strong>ï¼šå›æ”¶äº†å¤šå°‘å†…å­˜</li>
<li><strong>GCé¢‘ç‡</strong>ï¼šå¤šä¹…è§¦å‘ä¸€æ¬¡GC</li>
</ul>
<p><strong>å¦‚ä½•åˆ†æGCæ—¥å¿—ï¼š</strong></p>
<ul>
<li>æŸ¥çœ‹GCé¢‘ç‡ï¼šæ˜¯å¦é¢‘ç¹è§¦å‘GC</li>
<li>æŸ¥çœ‹GCè€—æ—¶ï¼šæ˜¯å¦æš‚åœæ—¶é—´è¿‡é•¿</li>
<li>æŸ¥çœ‹GCç±»å‹ï¼šæ˜¯Partial GCè¿˜æ˜¯Full GC</li>
<li>å¦‚æœFull GCé¢‘ç¹ï¼Œéœ€è¦ä¼˜åŒ–</li>
</ul>
<p><strong>4. å¦‚ä½•ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ä½¿ç”¨æ­¥éª¤ï¼š</strong></p>
<p><strong>1. æ·»åŠ ä¾èµ–</strong></p>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    debugImplementation 'com.squareup.leakcanary:leakcanary-android:2.12'
}
</code></pre>
<p><strong>2. è¿è¡Œåº”ç”¨</strong></p>
<ul>
<li>LeakCanaryä¼šè‡ªåŠ¨é›†æˆåˆ°åº”ç”¨ä¸­</li>
<li>ä¸éœ€è¦é¢å¤–é…ç½®</li>
</ul>
<p><strong>3. è‡ªåŠ¨æ£€æµ‹</strong></p>
<ul>
<li>LeakCanaryä¼šç›‘æ§Activityã€Fragmentç­‰å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>å½“å¯¹è±¡åº”è¯¥è¢«å›æ”¶æ—¶ï¼ŒLeakCanaryä¼šæ£€æŸ¥å¯¹è±¡æ˜¯å¦çœŸçš„è¢«å›æ”¶</li>
</ul>
<p><strong>4. å‘ç°æ³„æ¼æ—¶æ˜¾ç¤ºé€šçŸ¥</strong></p>
<ul>
<li>å¦‚æœå‘ç°å†…å­˜æ³„æ¼ï¼ŒLeakCanaryä¼šæ˜¾ç¤ºé€šçŸ¥</li>
<li>ç‚¹å‡»é€šçŸ¥ï¼Œå¯ä»¥æŸ¥çœ‹æ³„æ¼è·¯å¾„</li>
<li>æ³„æ¼è·¯å¾„ä¼šæ˜¾ç¤ºæ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
</ul>
<p><strong>æ£€æµ‹åŸç†ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨WeakReferenceå’ŒReferenceQueue</li>
<li>å½“å¯¹è±¡è¢«GCå›æ”¶æ—¶ï¼ŒWeakReferenceä¼šè¢«æ”¾å…¥ReferenceQueue</li>
<li>å¦‚æœå¯¹è±¡åº”è¯¥è¢«å›æ”¶ä½†æ²¡æœ‰è¿›å…¥ReferenceQueueï¼Œè¯´æ˜æœ‰å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>5. å¦‚ä½•ä½¿ç”¨MATåˆ†æå†…å­˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>ä½¿ç”¨æ­¥éª¤ï¼š</strong></p>
<p><strong>1. ç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>åœ¨Android Studio Profilerä¸­ç”Ÿæˆå †è½¬å‚¨</li>
<li>æˆ–ä½¿ç”¨jmapå‘½ä»¤ç”Ÿæˆï¼ˆAndroidä¸å¸¸ç”¨ï¼‰</li>
</ul>
<p><strong>2. å¯¼å‡ºhprofæ–‡ä»¶</strong></p>
<ul>
<li>åœ¨Profilerä¸­ï¼Œç‚¹å‡»"Export heap dump"</li>
<li>å¯¼å‡ºä¸ºhprofæ–‡ä»¶</li>
</ul>
<p><strong>3. ç”¨MATæ‰“å¼€</strong></p>
<ul>
<li>ä¸‹è½½å¹¶å®‰è£…MATï¼ˆMemory Analyzer Toolï¼‰</li>
<li>ç”¨MATæ‰“å¼€hprofæ–‡ä»¶</li>
</ul>
<p><strong>4. åˆ†æå¤§å¯¹è±¡</strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Histogram"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ul>
<p><strong>5. åˆ†æå¼•ç”¨é“¾</strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Path to GC Roots"åŠŸèƒ½</li>
<li>æ‰¾å‡ºå¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li>åˆ†æä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼ˆå†…å­˜æ³„æ¼ï¼Ÿï¼‰</li>
</ul>
<p><strong>MATçš„ä¸»è¦åŠŸèƒ½ï¼š</strong></p>
<ul>
<li><strong>Histogram</strong>ï¼šæŸ¥çœ‹å ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li><strong>Dominator Tree</strong>ï¼šæŸ¥çœ‹å¯¹è±¡å¼•ç”¨å…³ç³»</li>
<li><strong>Path to GC Roots</strong>ï¼šæŸ¥çœ‹å¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li><strong>Leak Suspects</strong>ï¼šè‡ªåŠ¨æ£€æµ‹å¯èƒ½çš„å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>6. å¦‚ä½•æ’æŸ¥GCé¢‘ç¹é—®é¢˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>1. æŸ¥çœ‹GCæ—¥å¿—ç¡®è®¤é¢‘ç‡</strong></p>
<ul>
<li>ä½¿ç”¨logcatæŸ¥çœ‹GCæ—¥å¿—</li>
<li>ç»Ÿè®¡GCé¢‘ç‡ï¼ˆå¤šä¹…è§¦å‘ä¸€æ¬¡GCï¼‰</li>
<li>å¦‚æœGCè¿‡äºé¢‘ç¹ï¼ˆæ¯”å¦‚æ¯ç§’å¤šæ¬¡ï¼‰ï¼Œè¯´æ˜æœ‰é—®é¢˜</li>
</ul>
<p><strong>2. ä½¿ç”¨ProfileræŸ¥çœ‹å¯¹è±¡åˆ†é…æƒ…å†µ</strong></p>
<ul>
<li>ä½¿ç”¨Profilerçš„"Allocation Tracking"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å“ªäº›å¯¹è±¡è¢«é¢‘ç¹åˆ†é…</li>
<li>æ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹</li>
</ul>
<p><strong>3. æ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹</strong></p>
<ul>
<li>åˆ†æä»£ç ï¼Œæ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹</li>
<li>å¸¸è§åœºæ™¯ï¼šå¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡ã€åˆ—è¡¨æ»‘åŠ¨æ—¶åˆ›å»ºå¯¹è±¡</li>
</ul>
<p><strong>4. ä¼˜åŒ–ä»£ç ï¼Œå‡å°‘å¯¹è±¡åˆ›å»º</strong></p>
<ul>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä½¿ç”¨åŸºæœ¬ç±»å‹æ›¿ä»£åŒ…è£…ç±»å‹</li>
</ul>
<p><strong>å¯èƒ½çš„åŸå› ï¼š</strong></p>
<ul>
<li><strong>é¢‘ç¹åˆ›å»ºå¯¹è±¡</strong>ï¼šä»£ç ä¸­é¢‘ç¹åˆ›å»ºå¯¹è±¡</li>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šå†…å­˜æ³„æ¼å¯¼è‡´å†…å­˜ä¸è¶³ï¼Œé¢‘ç¹è§¦å‘GC</li>
<li><strong>å¹´è½»ä»£è®¾ç½®å¤ªå°</strong>ï¼šå¹´è½»ä»£å¤ªå°ï¼Œå®¹æ˜“æ»¡ï¼Œé¢‘ç¹è§¦å‘GC</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>å‡å°‘ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>7. å¦‚ä½•æ’æŸ¥åº”ç”¨å¡é¡¿é—®é¢˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æ­¥éª¤ï¼š</strong></p>
<p><strong>1. ä½¿ç”¨Systraceåˆ†æå¡é¡¿</strong></p>
<ul>
<li>ä½¿ç”¨Android Studioçš„Systraceå·¥å…·</li>
<li>æˆ–ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·</li>
<li>åˆ†æå¡é¡¿çš„æ—¶é—´æ®µ</li>
</ul>
<p><strong>2. æŸ¥çœ‹GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</strong></p>
<ul>
<li>åœ¨Systraceä¸­æŸ¥çœ‹GCäº‹ä»¶</li>
<li>æ£€æŸ¥GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</li>
<li>å¦‚æœå¯¹åº”ï¼Œè¯´æ˜GCå¯¼è‡´äº†å¡é¡¿</li>
</ul>
<p><strong>3. å¦‚æœæ˜¯GCå¯¼è‡´çš„ï¼Œåˆ†æGCåŸå› </strong></p>
<ul>
<li>æŸ¥çœ‹GCç±»å‹ï¼šæ˜¯Partial GCè¿˜æ˜¯Full GC</li>
<li>æŸ¥çœ‹GCè€—æ—¶ï¼šGCæš‚åœæ—¶é—´æ˜¯å¦è¿‡é•¿</li>
<li>åˆ†æGCåŸå› ï¼šä¸ºä»€ä¹ˆè§¦å‘GC</li>
</ul>
<p><strong>4. ä¼˜åŒ–ä»£ç ï¼Œå‡å°‘GC</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>é¿å…è§¦å‘Full GC</li>
<li>ä¼˜åŒ–åˆ—è¡¨æ»‘åŠ¨ã€åŠ¨ç”»ç­‰åœºæ™¯</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><strong>å‡å°‘å¯¹è±¡åˆ›å»º</strong>ï¼šä½¿ç”¨å¯¹è±¡æ± ã€é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li><strong>é¿å…è§¦å‘Full GC</strong>ï¼šé¿å…å†…å­˜æ³„æ¼ã€å‡å°‘è€å¹´ä»£å¯¹è±¡</li>
<li><strong>ä¼˜åŒ–åˆ—è¡¨æ»‘åŠ¨</strong>ï¼šViewHolderå¤ç”¨ã€é¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</li>
<li><strong>ä¼˜åŒ–åŠ¨ç”»</strong>ï¼šå¤ç”¨åŠ¨ç”»å¯¹è±¡ã€é¿å…é¢‘ç¹åˆ›å»ºå¯¹è±¡</li>
</ul>
<h4 data-id="heading-84">6.3 ç»¼åˆåº”ç”¨é¢˜ï¼ˆé«˜çº§ï¼‰</h4>
<h4 data-id="heading-85">6.3.1 åœºæ™¯åˆ†æé¢˜</h4>
<p><strong>1. å¦‚ä½•ä¼˜åŒ–Androidåº”ç”¨çš„GCæ€§èƒ½ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>ä¼˜åŒ–GCæ€§èƒ½éœ€è¦ä»å¤šä¸ªæ–¹é¢å…¥æ‰‹ï¼š</p>
<p><strong>1. å‡å°‘å¯¹è±¡åˆ†é…ï¼ˆæœ€é‡è¦ï¼‰</strong></p>
<ul>
<li><strong>å¯¹è±¡å¤ç”¨</strong>ï¼šä½¿ç”¨å¯¹è±¡æ± ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯</li>
<li><strong>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</strong>ï¼šä½¿ç”¨StringBuilderã€é¿å…åœ¨å¾ªç¯ä¸­åˆ›å»ºå¯¹è±¡</li>
<li><strong>ä½¿ç”¨åŸºæœ¬ç±»å‹</strong>ï¼šä½¿ç”¨intè€Œä¸æ˜¯Integerï¼Œbooleanè€Œä¸æ˜¯Boolean</li>
</ul>
<p><strong>2. é¿å…å†…å­˜æ³„æ¼</strong></p>
<ul>
<li><strong>æ­£ç¡®å¤„ç†ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šåœ¨onDestroyä¸­æ¸…ç†èµ„æº</li>
<li><strong>åŠæ—¶å–æ¶ˆæ³¨å†Œ</strong>ï¼šå–æ¶ˆæ³¨å†Œç›‘å¬å™¨ï¼ˆEventBusã€å¹¿æ’­æ¥æ”¶å™¨ï¼‰</li>
<li><strong>ä½¿ç”¨å¼±å¼•ç”¨</strong>ï¼šå¯¹äºå¯èƒ½æ³„æ¼çš„å¼•ç”¨ï¼Œä½¿ç”¨WeakReference</li>
</ul>
<p><strong>3. ä¼˜åŒ–åˆ—è¡¨å’ŒåŠ¨ç”»</strong></p>
<ul>
<li><strong>ViewHolderå¤ç”¨</strong>ï¼šç¡®ä¿RecyclerViewçš„ViewHolderæ­£ç¡®å¤ç”¨</li>
<li><strong>é¿å…é¢‘ç¹åˆ›å»ºå¯¹è±¡</strong>ï¼šé¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</li>
<li><strong>å¤ç”¨åŠ¨ç”»å¯¹è±¡</strong>ï¼šä¸è¦æ¯æ¬¡åˆ›å»ºæ–°çš„åŠ¨ç”»å¯¹è±¡</li>
</ul>
<p><strong>4. åˆç†ä½¿ç”¨ç¼“å­˜</strong></p>
<ul>
<li><strong>ä½¿ç”¨LruCache</strong>ï¼šä½¿ç”¨æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜</li>
<li><strong>åŠæ—¶æ¸…ç†</strong>ï¼šåŠæ—¶æ¸…ç†ä¸éœ€è¦çš„ç¼“å­˜</li>
<li><strong>é¿å…æ— é™åˆ¶ç¼“å­˜</strong>ï¼šä¸è¦æ— é™åˆ¶åœ°ç¼“å­˜æ•°æ®</li>
</ul>
<p><strong>5. ä¼˜åŒ–å¤§å¯¹è±¡</strong></p>
<ul>
<li><strong>åŠæ—¶é‡Šæ”¾</strong>ï¼šåŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡ï¼ˆå¤§å›¾ç‰‡ã€å¤§æ•°ç»„ï¼‰</li>
<li><strong>å‹ç¼©å›¾ç‰‡</strong>ï¼šåŠ è½½æ—¶å‹ç¼©å›¾ç‰‡å¤§å°</li>
<li><strong>åˆ†æ‰¹åŠ è½½</strong>ï¼šä¸è¦ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®</li>
</ul>
<p><strong>ä¼˜åŒ–æ•ˆæœï¼š</strong></p>
<ul>
<li>å‡å°‘GCé¢‘ç‡ï¼šå‡å°‘å¯¹è±¡åˆ›å»ºï¼Œå‡å°‘GCè§¦å‘</li>
<li>é™ä½GCæš‚åœæ—¶é—´ï¼šé¿å…Full GCï¼Œå‡å°‘GCæš‚åœæ—¶é—´</li>
<li>æå‡åº”ç”¨æµç•…åº¦ï¼šå‡å°‘GCï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li>
</ul>
<p><strong>2. å¦‚ä½•æ’æŸ¥Androidå†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æµç¨‹ï¼š</strong></p>
<p><strong>1. ä½¿ç”¨LeakCanaryè‡ªåŠ¨æ£€æµ‹ï¼ˆç¬¬ä¸€æ­¥ï¼‰</strong></p>
<ul>
<li>åœ¨å¼€å‘é˜¶æ®µï¼ŒLeakCanaryä¼šè‡ªåŠ¨æ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>å¦‚æœå‘ç°æ³„æ¼ï¼Œä¼šæ˜¾ç¤ºé€šçŸ¥å’Œæ³„æ¼è·¯å¾„</li>
<li>æ ¹æ®æ³„æ¼è·¯å¾„ï¼Œå¯ä»¥å¿«é€Ÿå®šä½é—®é¢˜</li>
</ul>
<p><strong>2. ç”Ÿæˆå †è½¬å‚¨ç”¨MATåˆ†æï¼ˆè¯¦ç»†åˆ†æï¼‰</strong></p>
<ul>
<li>å¦‚æœLeakCanaryå‘ç°æ³„æ¼ï¼Œæˆ–éœ€è¦è¯¦ç»†åˆ†æ</li>
<li>åœ¨Android Studio Profilerä¸­ç”Ÿæˆå †è½¬å‚¨</li>
<li>å¯¼å‡ºä¸ºhprofæ–‡ä»¶ï¼Œç”¨MATæ‰“å¼€åˆ†æ</li>
</ul>
<p><strong>3. æ‰¾å‡ºæ³„æ¼å¯¹è±¡å’Œå¼•ç”¨é“¾</strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Path to GC Roots"åŠŸèƒ½</li>
<li>æ‰¾å‡ºæ³„æ¼å¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li>åˆ†ææ˜¯å“ªä¸ªå¯¹è±¡æŒæœ‰æ³„æ¼å¯¹è±¡çš„å¼•ç”¨</li>
</ul>
<p><strong>4. ä¿®å¤ä»£ç </strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¿®å¤ä»£ç </li>
<li>å¸¸è§ä¿®å¤æ–¹æ³•ï¼š
<ul>
<li>ä½¿ç”¨å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</li>
<li>åŠæ—¶æ¸…ç†èµ„æºï¼ˆonDestroyä¸­æ¸…ç†ï¼‰</li>
<li>å–æ¶ˆæ³¨å†Œç›‘å¬å™¨</li>
<li>æ¸…ç†é›†åˆ</li>
</ul>
</li>
</ul>
<p><strong>æ’æŸ¥å·¥å…·ï¼š</strong></p>
<ul>
<li><strong>LeakCanary</strong>ï¼šè‡ªåŠ¨æ£€æµ‹ï¼Œå¿«é€Ÿå‘ç°æ³„æ¼</li>
<li><strong>MAT</strong>ï¼šè¯¦ç»†åˆ†æï¼Œæ‰¾å‡ºæ³„æ¼åŸå› </li>
<li><strong>Android Studio Profiler</strong>ï¼šå®æ—¶ç›‘æ§ï¼ŒæŸ¥çœ‹å†…å­˜å˜åŒ–</li>
</ul>
<p><strong>3. å¦‚ä½•æ’æŸ¥Android OOMé—®é¢˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æµç¨‹ï¼š</strong></p>
<p><strong>1. ç”Ÿæˆå †è½¬å‚¨</strong></p>
<ul>
<li>åœ¨OOMæ—¶ï¼Œç³»ç»Ÿå¯èƒ½è‡ªåŠ¨ç”Ÿæˆå †è½¬å‚¨</li>
<li>æˆ–ä½¿ç”¨Android Studio Profileræ‰‹åŠ¨ç”Ÿæˆå †è½¬å‚¨</li>
<li>å¯¼å‡ºä¸ºhprofæ–‡ä»¶</li>
</ul>
<p><strong>2. åˆ†æå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</strong></p>
<ul>
<li>ä½¿ç”¨MATæ‰“å¼€hprofæ–‡ä»¶</li>
<li>ä½¿ç”¨MATçš„"Histogram"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å ç”¨å†…å­˜æœ€å¤šçš„ç±»</li>
<li>æ‰¾å‡ºå ç”¨å†…å­˜æœ€å¤šçš„å¯¹è±¡</li>
</ul>
<p><strong>3. æ‰¾å‡ºæ— æ³•å›æ”¶çš„åŸå› </strong></p>
<ul>
<li>ä½¿ç”¨MATçš„"Path to GC Roots"åŠŸèƒ½</li>
<li>åˆ†æå¯¹è±¡çš„å¼•ç”¨é“¾</li>
<li>æ‰¾å‡ºä¸ºä»€ä¹ˆå¯¹è±¡æ— æ³•è¢«å›æ”¶ï¼š
<ul>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šå¯¹è±¡è¢«å¼•ç”¨ï¼Œæ— æ³•å›æ”¶</li>
<li><strong>å¤§å¯¹è±¡</strong>ï¼šå¯¹è±¡æœ¬èº«å¾ˆå¤§</li>
<li><strong>å¯¹è±¡å¤ªå¤š</strong>ï¼šåˆ›å»ºäº†å¤ªå¤šå¯¹è±¡</li>
</ul>
</li>
</ul>
<p><strong>4. ä¼˜åŒ–å†…å­˜ä½¿ç”¨</strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼š
<ul>
<li>å¦‚æœæ˜¯å†…å­˜æ³„æ¼ï¼Œä¿®å¤æ³„æ¼</li>
<li>å¦‚æœæ˜¯å¤§å¯¹è±¡ï¼Œä¼˜åŒ–å¤§å¯¹è±¡ï¼ˆå‹ç¼©ã€åŠæ—¶é‡Šæ”¾ï¼‰</li>
<li>å¦‚æœæ˜¯å¯¹è±¡å¤ªå¤šï¼Œå‡å°‘å¯¹è±¡åˆ›å»º</li>
</ul>
</li>
</ul>
<p><strong>å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><strong>å†…å­˜æ³„æ¼</strong>ï¼šä½¿ç”¨LeakCanaryæ£€æµ‹ï¼Œä¿®å¤æ³„æ¼</li>
<li><strong>ä¸€æ¬¡æ€§åŠ è½½å¤ªå¤šæ•°æ®</strong>ï¼šåˆ†æ‰¹åŠ è½½æ•°æ®</li>
<li><strong>å¤§å¯¹è±¡å ç”¨è¿‡å¤šå†…å­˜</strong>ï¼šå‹ç¼©å›¾ç‰‡ã€åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡</li>
</ul>
<p><strong>4. å¦‚ä½•æ’æŸ¥GCé¢‘ç¹å¯¼è‡´çš„å¡é¡¿é—®é¢˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æµç¨‹ï¼š</strong></p>
<p><strong>1. æŸ¥çœ‹GCæ—¥å¿—</strong></p>
<ul>
<li>ä½¿ç”¨logcatæŸ¥çœ‹GCæ—¥å¿—</li>
<li>ç»Ÿè®¡GCé¢‘ç‡ï¼ˆå¤šä¹…è§¦å‘ä¸€æ¬¡GCï¼‰</li>
<li>å¦‚æœGCè¿‡äºé¢‘ç¹ï¼ˆæ¯”å¦‚æ¯ç§’å¤šæ¬¡ï¼‰ï¼Œè¯´æ˜æœ‰é—®é¢˜</li>
</ul>
<p><strong>2. ä½¿ç”¨Systraceåˆ†æ</strong></p>
<ul>
<li>ä½¿ç”¨Systraceåˆ†æå¡é¡¿</li>
<li>æŸ¥çœ‹GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿æ—¶é—´å¯¹åº”</li>
<li>å¦‚æœå¯¹åº”ï¼Œè¯´æ˜GCå¯¼è‡´äº†å¡é¡¿</li>
</ul>
<p><strong>3. æ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹</strong></p>
<ul>
<li>ä½¿ç”¨Profilerçš„"Allocation Tracking"åŠŸèƒ½</li>
<li>æŸ¥çœ‹å“ªäº›å¯¹è±¡è¢«é¢‘ç¹åˆ†é…</li>
<li>åˆ†æä»£ç ï¼Œæ‰¾å‡ºé¢‘ç¹åˆ›å»ºå¯¹è±¡çš„åœ°æ–¹</li>
</ul>
<p><strong>4. ä¼˜åŒ–ä»£ç å‡å°‘GC</strong></p>
<ul>
<li>æ ¹æ®åˆ†æç»“æœï¼Œä¼˜åŒ–ä»£ç ï¼š
<ul>
<li>ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡</li>
<li>é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li>ä½¿ç”¨åŸºæœ¬ç±»å‹æ›¿ä»£åŒ…è£…ç±»å‹</li>
<li>ä¿®å¤å†…å­˜æ³„æ¼</li>
</ul>
</li>
</ul>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li><strong>å‡å°‘å¯¹è±¡åˆ›å»º</strong>ï¼šä½¿ç”¨å¯¹è±¡æ± ã€é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li><strong>é¿å…è§¦å‘Full GC</strong>ï¼šé¿å…å†…å­˜æ³„æ¼ã€å‡å°‘è€å¹´ä»£å¯¹è±¡</li>
<li><strong>ä¼˜åŒ–åˆ—è¡¨æ»‘åŠ¨</strong>ï¼šViewHolderå¤ç”¨ã€é¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</li>
</ul>
<p><strong>5. å¦‚ä½•æ’æŸ¥åˆ—è¡¨æ»‘åŠ¨å¡é¡¿é—®é¢˜ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>æ’æŸ¥æµç¨‹ï¼š</strong></p>
<p><strong>1. æ£€æŸ¥ViewHolderå¤ç”¨</strong></p>
<ul>
<li>ç¡®ä¿RecyclerViewçš„ViewHolderæ­£ç¡®å¤ç”¨</li>
<li>æ£€æŸ¥Adapterçš„å®ç°æ˜¯å¦æ­£ç¡®</li>
<li>ç¡®ä¿ViewHolderä¸ä¼šè¢«é¢‘ç¹åˆ›å»º</li>
</ul>
<p><strong>2. é¿å…åœ¨onBindViewHolderä¸­åˆ›å»ºå¯¹è±¡</strong></p>
<ul>
<li>onBindViewHolderåœ¨æ»‘åŠ¨æ—¶é¢‘ç¹è°ƒç”¨</li>
<li>ä¸è¦åœ¨è¿™é‡Œåˆ›å»ºæ–°å¯¹è±¡</li>
<li>å¤ç”¨å­—ç¬¦ä¸²ã€é¿å…åˆ›å»ºä¸´æ—¶å¯¹è±¡</li>
</ul>
<p><strong>3. ä½¿ç”¨å¯¹è±¡æ± </strong></p>
<ul>
<li>å¯¹äºéœ€è¦é¢‘ç¹åˆ›å»ºçš„å¯¹è±¡ï¼Œä½¿ç”¨å¯¹è±¡æ± </li>
<li>ç¤ºä¾‹ï¼šè‡ªå®šä¹‰å¯¹è±¡æ± ç®¡ç†å¯¹è±¡å¤ç”¨</li>
</ul>
<p><strong>4. å‡å°‘GC</strong></p>
<ul>
<li>é€šè¿‡ä»¥ä¸Šæ–¹æ³•å‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>å‡å°‘GCé¢‘ç‡ï¼Œè®©åˆ—è¡¨æ»‘åŠ¨æ›´æµç•…</li>
</ul>
<p><strong>5. ä½¿ç”¨Systraceåˆ†æ</strong></p>
<ul>
<li>ä½¿ç”¨Systraceåˆ†æå¡é¡¿</li>
<li>æŸ¥çœ‹GCäº‹ä»¶æ˜¯å¦ä¸å¡é¡¿å¯¹åº”</li>
<li>å¦‚æœå¯¹åº”ï¼Œä¼˜åŒ–GC</li>
</ul>
<p><strong>ä¼˜åŒ–ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸å¥½çš„åšæ³•ï¼šå¯¼è‡´å¡é¡¿</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
    holder.textView.setText(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">"Item "</span> + position));  <span class="hljs-comment">// åˆ›å»ºæ–°å¯¹è±¡</span>
    holder.imageView.setImageBitmap(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Bitmap</span>());  <span class="hljs-comment">// åˆ›å»ºæ–°å¯¹è±¡</span>
}

<span class="hljs-comment">// å¥½çš„åšæ³•ï¼šé¿å…å¡é¡¿</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(ViewHolder holder, <span class="hljs-type">int</span> position)</span> {
    holder.textView.setText(<span class="hljs-string">"Item "</span> + position);  <span class="hljs-comment">// å¤ç”¨å­—ç¬¦ä¸²</span>
    <span class="hljs-comment">// ä½¿ç”¨å›¾ç‰‡ç¼“å­˜ï¼Œé¿å…é¢‘ç¹åˆ›å»ºBitmap</span>
    Glide.with(context).load(url).into(holder.imageView);
}
</code></pre>
<h4 data-id="heading-86">6.3.2 è®¾è®¡é¢˜</h4>
<p><strong>1. å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¯¹è±¡æ± ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å¯¹è±¡æ± çš„æ ¸å¿ƒæ˜¯<strong>å¤ç”¨å¯¹è±¡</strong>ï¼Œé¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯ã€‚</p>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<p><strong>1. å®šä¹‰å¯¹è±¡æ± æ¥å£</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ObjectPool</span>&lt;T&gt; {
    T <span class="hljs-title function_">acquire</span><span class="hljs-params">()</span>;        <span class="hljs-comment">// è·å–å¯¹è±¡</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">release</span><span class="hljs-params">(T obj)</span>; <span class="hljs-comment">// å½’è¿˜å¯¹è±¡</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span>;       <span class="hljs-comment">// æ¸…ç©ºæ± </span>
}
</code></pre>
<p><strong>2. å®ç°å¯¹è±¡å¤ç”¨é€»è¾‘</strong></p>
<ul>
<li>ä½¿ç”¨é˜Ÿåˆ—ï¼ˆQueueï¼‰å­˜å‚¨å¯å¤ç”¨çš„å¯¹è±¡</li>
<li>è·å–æ—¶ä»é˜Ÿåˆ—ä¸­å–å‡ºï¼Œå½’è¿˜æ—¶æ”¾å›é˜Ÿåˆ—</li>
<li>å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ›å»ºæ–°å¯¹è±¡</li>
</ul>
<p><strong>3. è®¾ç½®æ± å¤§å°é™åˆ¶</strong></p>
<ul>
<li>é¿å…æ± æ— é™å¢é•¿</li>
<li>è®¾ç½®æœ€å¤§æ± å¤§å°</li>
<li>è¶…è¿‡å¤§å°æ—¶ï¼Œä¸å†å½’è¿˜å¯¹è±¡</li>
</ul>
<p><strong>4. æä¾›è·å–å’Œå½’è¿˜æ–¹æ³•</strong></p>
<ul>
<li>acquire()ï¼šä»æ± ä¸­è·å–å¯¹è±¡ï¼Œå¦‚æœæ± ä¸ºç©ºåˆ™åˆ›å»ºæ–°å¯¹è±¡</li>
<li>release()ï¼šå½’è¿˜å¯¹è±¡åˆ°æ± ä¸­ï¼Œå¦‚æœæ± å·²æ»¡åˆ™ä¸å½’è¿˜</li>
<li>clear()ï¼šæ¸…ç©ºæ± ï¼Œé‡Šæ”¾æ‰€æœ‰å¯¹è±¡</li>
</ul>
<p><strong>å®Œæ•´å®ç°ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleObjectPool</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ObjectPool</span>&lt;T&gt; {
    <span class="hljs-keyword">private</span> Queue&lt;T&gt; pool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> maxSize;
    <span class="hljs-keyword">private</span> Supplier&lt;T&gt; factory;  <span class="hljs-comment">// å¯¹è±¡å·¥å‚</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleObjectPool</span><span class="hljs-params">(<span class="hljs-type">int</span> maxSize, Supplier&lt;T&gt; factory)</span> {
        <span class="hljs-built_in">this</span>.maxSize = maxSize;
        <span class="hljs-built_in">this</span>.factory = factory;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">acquire</span><span class="hljs-params">()</span> {
        <span class="hljs-type">T</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> pool.poll();
        <span class="hljs-keyword">if</span> (obj == <span class="hljs-literal">null</span>) {
            obj = factory.get();  <span class="hljs-comment">// æ± ä¸ºç©ºæ—¶åˆ›å»ºæ–°å¯¹è±¡</span>
        }
        <span class="hljs-keyword">return</span> obj;
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">release</span><span class="hljs-params">(T obj)</span> {
        <span class="hljs-keyword">if</span> (obj != <span class="hljs-literal">null</span> &amp;&amp; pool.size() &lt; maxSize) {
            resetObject(obj);  <span class="hljs-comment">// é‡ç½®å¯¹è±¡çŠ¶æ€</span>
            pool.offer(obj);   <span class="hljs-comment">// å½’è¿˜åˆ°æ± ä¸­</span>
        }
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
        pool.clear();
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resetObject</span><span class="hljs-params">(T obj)</span> {
        <span class="hljs-comment">// é‡ç½®å¯¹è±¡çŠ¶æ€ï¼Œå‡†å¤‡å¤ç”¨</span>
    }
}
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>é¢‘ç¹åˆ›å»ºçš„å¯¹è±¡ï¼ˆå¦‚åŠ¨ç”»å¯¹è±¡ã€ä¸´æ—¶å¯¹è±¡ï¼‰</li>
<li>åˆ›å»ºæˆæœ¬é«˜çš„å¯¹è±¡ï¼ˆå¦‚Bitmapã€å¤§å¯¹è±¡ï¼‰</li>
</ul>
<p><strong>2. å¦‚ä½•è®¾è®¡ä¸€ä¸ªå†…å­˜ç›‘æ§ç³»ç»Ÿï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å†…å­˜ç›‘æ§ç³»ç»Ÿéœ€è¦å®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µï¼ŒåŠæ—¶å‘ç°é—®é¢˜ã€‚</p>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<p><strong>1. å®æ—¶ç›‘æ§å†…å­˜ä½¿ç”¨</strong></p>
<ul>
<li>ä½¿ç”¨Runtime.getRuntime()è·å–å†…å­˜ä¿¡æ¯</li>
<li>å®šæœŸé‡‡é›†å†…å­˜ä½¿ç”¨æ•°æ®</li>
<li>è®°å½•å†…å­˜ä½¿ç”¨æ›²çº¿</li>
</ul>
<p><strong>2. è®°å½•GCäº‹ä»¶</strong></p>
<ul>
<li>ç›‘å¬GCäº‹ä»¶ï¼ˆé€šè¿‡GCæ—¥å¿—æˆ–Profilerï¼‰</li>
<li>è®°å½•GCç±»å‹ã€GCè€—æ—¶ã€GCé¢‘ç‡</li>
<li>åˆ†æGCå¯¹æ€§èƒ½çš„å½±å“</li>
</ul>
<p><strong>3. åˆ†æå†…å­˜è¶‹åŠ¿</strong></p>
<ul>
<li>åˆ†æå†…å­˜ä½¿ç”¨è¶‹åŠ¿</li>
<li>è¯†åˆ«å†…å­˜æ³„æ¼ï¼ˆå†…å­˜æŒç»­å¢é•¿ï¼‰</li>
<li>é¢„æµ‹OOMé£é™©</li>
</ul>
<p><strong>4. è®¾ç½®å‘Šè­¦é˜ˆå€¼</strong></p>
<ul>
<li>è®¾ç½®å†…å­˜ä½¿ç”¨å‘Šè­¦é˜ˆå€¼</li>
<li>è®¾ç½®GCé¢‘ç‡å‘Šè­¦é˜ˆå€¼</li>
<li>è¶…è¿‡é˜ˆå€¼æ—¶å‘é€å‘Šè­¦</li>
</ul>
<p><strong>å®ç°ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryMonitor</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">MEMORY_WARNING_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">80</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>;  <span class="hljs-comment">// 80MB</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">GC_FREQUENCY_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;  <span class="hljs-comment">// æ¯ç§’10æ¬¡</span>
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">monitor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Runtime</span> <span class="hljs-variable">runtime</span> <span class="hljs-operator">=</span> Runtime.getRuntime();
        <span class="hljs-type">long</span> <span class="hljs-variable">usedMemory</span> <span class="hljs-operator">=</span> runtime.totalMemory() - runtime.freeMemory();
        <span class="hljs-type">long</span> <span class="hljs-variable">maxMemory</span> <span class="hljs-operator">=</span> runtime.maxMemory();
        
        <span class="hljs-comment">// æ£€æŸ¥å†…å­˜ä½¿ç”¨</span>
        <span class="hljs-keyword">if</span> (usedMemory &gt; MEMORY_WARNING_THRESHOLD) {
            sendWarning(<span class="hljs-string">"å†…å­˜ä½¿ç”¨è¿‡é«˜: "</span> + usedMemory);
        }
        
        <span class="hljs-comment">// æ£€æŸ¥GCé¢‘ç‡</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">gcFrequency</span> <span class="hljs-operator">=</span> getGCFrequency();
        <span class="hljs-keyword">if</span> (gcFrequency &gt; GC_FREQUENCY_THRESHOLD) {
            sendWarning(<span class="hljs-string">"GCè¿‡äºé¢‘ç¹: "</span> + gcFrequency + <span class="hljs-string">"æ¬¡/ç§’"</span>);
        }
    }
}
</code></pre>
<p><strong>3. å¦‚ä½•è®¾è®¡ä¸€ä¸ªé«˜å†…å­˜æ•ˆç‡çš„Androidåº”ç”¨ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>é«˜å†…å­˜æ•ˆç‡çš„åº”ç”¨éœ€è¦ä»å¤šä¸ªæ–¹é¢ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚</p>
<p><strong>è®¾è®¡è¦ç‚¹ï¼š</strong></p>
<p><strong>1. å‡å°‘å¯¹è±¡åˆ›å»ºï¼ˆä½¿ç”¨å¯¹è±¡æ± ï¼‰</strong></p>
<ul>
<li>å¯¹äºé¢‘ç¹åˆ›å»ºçš„å¯¹è±¡ï¼Œä½¿ç”¨å¯¹è±¡æ± </li>
<li>å¤ç”¨å¯¹è±¡ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯</li>
<li>ç¤ºä¾‹ï¼šåŠ¨ç”»å¯¹è±¡ã€ä¸´æ—¶å¯¹è±¡</li>
</ul>
<p><strong>2. é¿å…å†…å­˜æ³„æ¼ï¼ˆæ­£ç¡®ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼‰</strong></p>
<ul>
<li>æ­£ç¡®å¤„ç†Activityã€Fragmentçš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>åœ¨onDestroyä¸­æ¸…ç†èµ„æº</li>
<li>ä½¿ç”¨å¼±å¼•ç”¨é¿å…å†…å­˜æ³„æ¼</li>
</ul>
<p><strong>3. åˆç†ä½¿ç”¨ç¼“å­˜ï¼ˆLruCacheï¼‰</strong></p>
<ul>
<li>ä½¿ç”¨LruCacheç­‰æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜</li>
<li>åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„ç¼“å­˜</li>
<li>é¿å…æ— é™åˆ¶ç¼“å­˜</li>
</ul>
<p><strong>4. åŠæ—¶é‡Šæ”¾èµ„æº</strong></p>
<ul>
<li>åŠæ—¶é‡Šæ”¾å¤§å¯¹è±¡ï¼ˆå¤§å›¾ç‰‡ã€å¤§æ•°ç»„ï¼‰</li>
<li>å…³é—­æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥</li>
<li>æ¸…ç†é›†åˆã€å–æ¶ˆæ³¨å†Œç›‘å¬å™¨</li>
</ul>
<p><strong>5. ä¼˜åŒ–æ•°æ®ç»“æ„</strong></p>
<ul>
<li>é€‰æ‹©åˆé€‚çš„é›†åˆç±»</li>
<li>é¿å…å†…å­˜æµªè´¹</li>
<li>åŠæ—¶æ¸…ç†é›†åˆ</li>
</ul>
<p><strong>6. ç›‘æ§å’Œè°ƒä¼˜</strong></p>
<ul>
<li>ä½¿ç”¨Profilerç›‘æ§å†…å­˜ä½¿ç”¨</li>
<li>ä½¿ç”¨LeakCanaryæ£€æµ‹å†…å­˜æ³„æ¼</li>
<li>æ ¹æ®å®é™…æƒ…å†µä¼˜åŒ–</li>
</ul>
<p><strong>è®¾è®¡åŸåˆ™ï¼š</strong></p>
<ul>
<li><strong>æœ€å°åŒ–å¯¹è±¡åˆ›å»º</strong>ï¼šå‡å°‘å¯¹è±¡åˆ†é…ï¼Œå‡å°‘GC</li>
<li><strong>åŠæ—¶é‡Šæ”¾èµ„æº</strong>ï¼šé¿å…å†…å­˜æ³„æ¼ï¼Œé¿å…OOM</li>
<li><strong>åˆç†ä½¿ç”¨ç¼“å­˜</strong>ï¼šä½¿ç”¨æœ‰å¤§å°é™åˆ¶çš„ç¼“å­˜</li>
<li><strong>ç›‘æ§å’Œä¼˜åŒ–</strong>ï¼šæŒç»­ç›‘æ§ï¼ŒæŒç»­ä¼˜åŒ–</li>
</ul>
<h4 data-id="heading-87">6.3.3 æ·±å…¥åŸç†é¢˜ï¼ˆé«˜çº§ï¼‰</h4>
<p><strong>1. ARTå¹¶å‘å¤åˆ¶æ”¶é›†å™¨æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>ARTå¹¶å‘å¤åˆ¶æ”¶é›†å™¨çš„å·¥ä½œæµç¨‹ï¼š</p>
<p><strong>1. å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰</strong></p>
<ul>
<li>åœ¨åå°çº¿ç¨‹æ‰§è¡Œæ ‡è®°å·¥ä½œ</li>
<li>ä»GC Rootså¼€å§‹ï¼Œæ ‡è®°æ‰€æœ‰å­˜æ´»å¯¹è±¡</li>
<li>ä¸»çº¿ç¨‹ç»§ç»­è¿è¡Œï¼Œä¸æš‚åœ</li>
</ul>
<p><strong>2. å¹¶å‘å¤åˆ¶ï¼ˆConcurrent Copyingï¼‰</strong></p>
<ul>
<li>åœ¨åå°çº¿ç¨‹æ‰§è¡Œå¤åˆ¶å·¥ä½œ</li>
<li>å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æ–°ä½ç½®</li>
<li>ä¸»çº¿ç¨‹ç»§ç»­è¿è¡Œï¼Œä¸æš‚åœ</li>
</ul>
<p><strong>3. å‡å°‘ä¸»çº¿ç¨‹æš‚åœæ—¶é—´</strong></p>
<ul>
<li>å¤§éƒ¨åˆ†å·¥ä½œåœ¨åå°çº¿ç¨‹æ‰§è¡Œ</li>
<li>ä¸»çº¿ç¨‹åªåœ¨å¿…è¦æ—¶çŸ­æš‚æš‚åœ</li>
<li>å‡å°‘å¡é¡¿ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li>
</ul>
<p><strong>4. é€‚åˆäº¤äº’å¼åº”ç”¨</strong></p>
<ul>
<li>Androidåº”ç”¨æ˜¯äº¤äº’å¼åº”ç”¨ï¼Œéœ€è¦ä½å»¶è¿Ÿ</li>
<li>å¹¶å‘å›æ”¶å‡å°‘æš‚åœæ—¶é—´ï¼Œé€‚åˆäº¤äº’å¼åº”ç”¨</li>
<li>ä¼˜åŒ–ç”¨æˆ·æ»‘åŠ¨ã€ç‚¹å‡»ç­‰æ“ä½œçš„æµç•…åº¦</li>
</ul>
<p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> è§¦å‘GC
<span class="hljs-bullet">2.</span> åå°çº¿ç¨‹ï¼šå¹¶å‘æ ‡è®°å­˜æ´»å¯¹è±¡
<span class="hljs-bullet">3.</span> åå°çº¿ç¨‹ï¼šå¹¶å‘å¤åˆ¶å­˜æ´»å¯¹è±¡
<span class="hljs-bullet">4.</span> ä¸»çº¿ç¨‹ï¼šçŸ­æš‚æš‚åœï¼Œå®Œæˆæœ€åçš„åŒæ­¥å·¥ä½œ
<span class="hljs-bullet">5.</span> ä¸»çº¿ç¨‹ï¼šç»§ç»­è¿è¡Œ
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>å‡å°‘ä¸»çº¿ç¨‹æš‚åœæ—¶é—´</li>
<li>æå‡åº”ç”¨æµç•…åº¦</li>
<li>é€‚åˆäº¤äº’å¼åº”ç”¨</li>
</ul>
<p><strong>2. å¢é‡å›æ”¶æ˜¯å¦‚ä½•å‡å°‘å¡é¡¿çš„ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å¢é‡å›æ”¶çš„æ ¸å¿ƒæ€æƒ³æ˜¯<strong>æŠŠå¤§é‡å›æ”¶å·¥ä½œåˆ†æˆå°ä»½ï¼Œåˆ†æ‰¹æ‰§è¡Œ</strong>ã€‚</p>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<p><strong>1. åˆ†æ‰¹æ‰§è¡Œ</strong></p>
<ul>
<li>æŠŠå¤§é‡å›æ”¶å·¥ä½œåˆ†æˆå¤šä¸ªå°ä»»åŠ¡</li>
<li>æ¯æ¬¡åªæ‰§è¡Œä¸€å°éƒ¨åˆ†</li>
<li>é¿å…ä¸€æ¬¡æ€§æ‰§è¡Œæ‰€æœ‰å›æ”¶å·¥ä½œ</li>
</ul>
<p><strong>2. æ¯æ¬¡æš‚åœæ—¶é—´çŸ­</strong></p>
<ul>
<li>æ¯æ¬¡åªæ‰§è¡Œä¸€å°éƒ¨åˆ†ï¼Œæš‚åœæ—¶é—´çŸ­</li>
<li>ç”¨æˆ·å‡ ä¹æ„Ÿè§‰ä¸åˆ°å¡é¡¿</li>
<li>å¤šæ¬¡çŸ­æš‚åœæ¯”ä¸€æ¬¡é•¿æš‚åœä½“éªŒæ›´å¥½</li>
</ul>
<p><strong>3. é¿å…ä¸€æ¬¡æ€§å¡é¡¿å¤ªä¹…</strong></p>
<ul>
<li>ä¼ ç»Ÿå›æ”¶ï¼šä¸€æ¬¡æ€§å›æ”¶æ‰€æœ‰å¯¹è±¡ï¼Œæš‚åœæ—¶é—´é•¿ï¼ˆå¯èƒ½50msï¼‰</li>
<li>å¢é‡å›æ”¶ï¼šåˆ†æˆå¤šæ¬¡ï¼Œæ¯æ¬¡æš‚åœæ—¶é—´çŸ­ï¼ˆå¯èƒ½5msï¼‰</li>
<li>ç”¨æˆ·æ„Ÿè§‰ï¼šå‡ ä¹æ„Ÿè§‰ä¸åˆ°</li>
</ul>
<p><strong>å¯¹æ¯”ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">ä¼ ç»Ÿå›æ”¶ï¼š
<span class="hljs-selector-attr">[ä¸€æ¬¡æ€§å›æ”¶æ‰€æœ‰å¯¹è±¡]</span>
æš‚åœæ—¶é—´ï¼š<span class="hljs-number">50ms</span>
ç”¨æˆ·æ„Ÿè§‰ï¼šæ˜æ˜¾å¡é¡¿

å¢é‡å›æ”¶ï¼š
<span class="hljs-selector-attr">[å›æ”¶ä¸€ç‚¹]</span><span class="hljs-selector-attr">[å›æ”¶ä¸€ç‚¹]</span><span class="hljs-selector-attr">[å›æ”¶ä¸€ç‚¹]</span>
æ¯æ¬¡æš‚åœï¼š<span class="hljs-number">5ms</span>
ç”¨æˆ·æ„Ÿè§‰ï¼šå‡ ä¹æ„Ÿè§‰ä¸åˆ°
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li>å‡å°‘å•æ¬¡æš‚åœæ—¶é—´</li>
<li>æå‡ç”¨æˆ·ä½“éªŒ</li>
<li>é€‚åˆäº¤äº’å¼åº”ç”¨</li>
</ul>
<p><strong>3. å‹ç¼©å›æ”¶æ˜¯å¦‚ä½•é¿å…å†…å­˜ç¢ç‰‡çš„ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p>å‹ç¼©å›æ”¶çš„æ ¸å¿ƒæ˜¯<strong>å›æ”¶åæ•´ç†å†…å­˜ï¼ŒæŠŠåˆ†æ•£çš„å†…å­˜å—åˆå¹¶</strong>ã€‚</p>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<p><strong>1. æ ‡è®°é˜¶æ®µ</strong></p>
<ul>
<li>æ ‡è®°æ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡</li>
<li>æ ‡è®°æ‰€æœ‰å­˜æ´»å¯¹è±¡</li>
</ul>
<p><strong>2. æ•´ç†é˜¶æ®µ</strong></p>
<ul>
<li>å°†å­˜æ´»å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨</li>
<li>æŠŠåˆ†æ•£çš„å†…å­˜å—åˆå¹¶æˆè¿ç»­ç©ºé—´</li>
<li>æ›´æ–°æ‰€æœ‰å¯¹è±¡çš„å¼•ç”¨</li>
</ul>
<p><strong>3. æ¸…é™¤é˜¶æ®µ</strong></p>
<ul>
<li>æ¸…ç†è¾¹ç•Œå¤–çš„å†…å­˜</li>
<li>é‡Šæ”¾åƒåœ¾å¯¹è±¡å ç”¨çš„å†…å­˜</li>
</ul>
<p><strong>æ•ˆæœï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">å‹ç¼©å‰ï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span>
å†…å­˜ç¢ç‰‡å¤šï¼Œåˆ†é…æ•ˆç‡ä½

å‹ç¼©åï¼š
<span class="hljs-selector-attr">[å¯¹è±¡1]</span><span class="hljs-selector-attr">[å¯¹è±¡2]</span><span class="hljs-selector-attr">[å¯¹è±¡3]</span><span class="hljs-selector-attr">[ç©ºé—²]</span><span class="hljs-selector-attr">[ç©ºé—²]</span>
å†…å­˜è¿ç»­ï¼Œåˆ†é…æ•ˆç‡é«˜
</code></pre>
<p><strong>ä¼˜åŠ¿ï¼š</strong></p>
<ul>
<li><strong>æ²¡æœ‰å†…å­˜ç¢ç‰‡</strong>ï¼šæ•´ç†åå†…å­˜è¿ç»­</li>
<li><strong>æé«˜å†…å­˜åˆ©ç”¨ç‡</strong>ï¼šé¿å…å†…å­˜æµªè´¹</li>
<li><strong>æé«˜åˆ†é…æ•ˆç‡</strong>ï¼šè¿ç»­å†…å­˜åˆ†é…æ›´å¿«</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆè€å¹´ä»£ç”¨å‹ç¼©å›æ”¶ï¼Ÿ</strong></p>
<ul>
<li>è€å¹´ä»£å¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œç§»åŠ¨æˆæœ¬ç›¸å¯¹è¾ƒä½</li>
<li>é¿å…å†…å­˜ç¢ç‰‡ï¼Œæé«˜å†…å­˜åˆ©ç”¨ç‡</li>
<li>ä¸æµªè´¹å†…å­˜ï¼ˆä¸åƒæ ‡è®°-å¤åˆ¶éœ€è¦ä¸¤å—å†…å­˜ï¼‰</li>
</ul>
<p><strong>4. ä¸ºä»€ä¹ˆAndroidåªç”¨ä¸€ç§åƒåœ¾å›æ”¶å™¨ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. é’ˆå¯¹Androidåœºæ™¯ä¼˜åŒ–</strong></p>
<ul>
<li>Androidåº”ç”¨éƒ½æ˜¯äº¤äº’å¼åº”ç”¨ï¼Œéœ€è¦ä½å»¶è¿Ÿ</li>
<li>å¹¶å‘å¤åˆ¶æ”¶é›†å™¨é’ˆå¯¹ä½å»¶è¿Ÿä¼˜åŒ–</li>
<li>ä¸éœ€è¦å¤šç§æ”¶é›†å™¨ï¼Œä¸€ç§å°±å¤Ÿäº†</li>
</ul>
<p><strong>2. ä¸éœ€è¦å¼€å‘è€…é€‰æ‹©</strong></p>
<ul>
<li>ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨ï¼Œå¼€å‘è€…ä¸éœ€è¦äº†è§£æ”¶é›†å™¨çš„åŒºåˆ«</li>
<li>ç®€åŒ–å¼€å‘ï¼Œæé«˜æ•ˆç‡</li>
<li>é¿å…å¼€å‘è€…é€‰æ‹©é”™è¯¯çš„æ”¶é›†å™¨</li>
</ul>
<p><strong>3. ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†</strong></p>
<ul>
<li>ç³»ç»Ÿæ ¹æ®åº”ç”¨ç‰¹ç‚¹è‡ªåŠ¨ä¼˜åŒ–</li>
<li>ä¸éœ€è¦å¼€å‘è€…é…ç½®å‚æ•°</li>
<li>å‡å°‘å¼€å‘è´Ÿæ‹…</li>
</ul>
<p><strong>4. ç®€åŒ–å¼€å‘</strong></p>
<ul>
<li>å¼€å‘è€…ä¸éœ€è¦äº†è§£å¤šç§æ”¶é›†å™¨çš„åŒºåˆ«</li>
<li>ä¸éœ€è¦æ ¹æ®åº”ç”¨ç‰¹ç‚¹é€‰æ‹©æ”¶é›†å™¨</li>
<li>ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘</li>
</ul>
<p><strong>ä¸JVMçš„åŒºåˆ«ï¼š</strong></p>
<ul>
<li><strong>JVM</strong>ï¼šæœ‰å¤šç§æ”¶é›†å™¨å¯é€‰ï¼Œéœ€è¦å¼€å‘è€…æ ¹æ®åº”ç”¨ç‰¹ç‚¹é€‰æ‹©</li>
<li><strong>Android</strong>ï¼šåªæœ‰ä¸€ç§ï¼Œç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨ï¼Œé’ˆå¯¹Androidåœºæ™¯ä¼˜åŒ–</li>
</ul>
<p><strong>5. Androidå†…å­˜é™åˆ¶å¯¹GCçš„å½±å“ï¼Ÿ</strong></p>
<p><strong>å®Œæ•´ç­”æ¡ˆï¼š</strong></p>
<p><strong>1. å†…å­˜æœ‰é™å¿…é¡»åˆç†ä½¿ç”¨</strong></p>
<ul>
<li>Androidè®¾å¤‡å†…å­˜æœ‰é™ï¼ˆä½ç«¯è®¾å¤‡å¯èƒ½åªæœ‰å‡ åMBï¼‰</li>
<li>å¿…é¡»åˆç†ä½¿ç”¨å†…å­˜ï¼Œé¿å…æµªè´¹</li>
<li>å†…å­˜ä¸è¶³æ—¶ï¼Œç³»ç»Ÿå¯èƒ½æ€æ­»åº”ç”¨</li>
</ul>
<p><strong>2. GCæ›´é¢‘ç¹</strong></p>
<ul>
<li>å†…å­˜æœ‰é™ï¼Œå®¹æ˜“è§¦å‘GC</li>
<li>å†…å­˜ä¸è¶³æ—¶ï¼ŒGCæ›´é¢‘ç¹</li>
<li>éœ€è¦ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œå‡å°‘GCé¢‘ç‡</li>
</ul>
<p><strong>3. éœ€è¦ä¼˜åŒ–å†…å­˜ä½¿ç”¨</strong></p>
<ul>
<li>å‡å°‘å¯¹è±¡åˆ›å»º</li>
<li>é¿å…å†…å­˜æ³„æ¼</li>
<li>åŠæ—¶é‡Šæ”¾èµ„æº</li>
<li>åˆç†ä½¿ç”¨ç¼“å­˜</li>
</ul>
<p><strong>4. é¿å…OOM</strong></p>
<ul>
<li>å†…å­˜æœ‰é™ï¼Œå®¹æ˜“å‘ç”ŸOOM</li>
<li>å¿…é¡»é¿å…å†…å­˜æ³„æ¼</li>
<li>å¿…é¡»ä¼˜åŒ–å†…å­˜ä½¿ç”¨</li>
<li>å¿…é¡»åŠæ—¶é‡Šæ”¾èµ„æº</li>
</ul>
<p><strong>5. å½±å“GCç­–ç•¥</strong></p>
<ul>
<li>å†…å­˜æœ‰é™ï¼ŒGCç­–ç•¥æ›´æ¿€è¿›</li>
<li>æ›´é¢‘ç¹åœ°è§¦å‘GC</li>
<li>æ›´æ—©åœ°å›æ”¶å¯¹è±¡</li>
</ul>
<p><strong>ä¼˜åŒ–å»ºè®®ï¼š</strong></p>
<ul>
<li><strong>å‡å°‘å¯¹è±¡åˆ›å»º</strong>ï¼šä½¿ç”¨å¯¹è±¡æ± ã€é¿å…ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»º</li>
<li><strong>é¿å…å†…å­˜æ³„æ¼</strong>ï¼šä½¿ç”¨LeakCanaryæ£€æµ‹ï¼Œä¿®å¤æ³„æ¼</li>
<li><strong>åŠæ—¶é‡Šæ”¾èµ„æº</strong>ï¼šåœ¨onDestroyä¸­æ¸…ç†èµ„æº</li>
<li><strong>åˆç†ä½¿ç”¨ç¼“å­˜</strong>ï¼šä½¿ç”¨LruCacheï¼ŒåŠæ—¶æ¸…ç†</li>
</ul>
<hr/>
<h2 data-id="heading-88">æ€»ç»“</h2>
<p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº†Androidå¹³å°çš„Javaå†…å­˜å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰ï¼ŒåŸºäºARTï¼ˆAndroid Runtimeï¼‰å®ç°ã€‚</p>
<p><strong>æ ¸å¿ƒå†…å®¹ï¼š</strong></p>
<ol>
<li><strong>åƒåœ¾å›æ”¶åŸºç¡€</strong>ï¼šGCçš„æ¦‚å¿µã€å¯¹è±¡åˆ¤æ–­æ–¹æ³•ã€å¼•ç”¨ç±»å‹</li>
<li><strong>åƒåœ¾å›æ”¶ç®—æ³•</strong>ï¼šæ ‡è®°-æ¸…é™¤ã€æ ‡è®°-å¤åˆ¶ï¼ˆAndroidä¸»è¦ç”¨ï¼‰ã€æ ‡è®°-æ•´ç†ã€åˆ†ä»£æ”¶é›†</li>
<li><strong>Android ARTåƒåœ¾å›æ”¶å™¨</strong>ï¼šåªæœ‰ä¸€ç§æ”¶é›†å™¨ï¼ˆå¹¶å‘å¤åˆ¶æ”¶é›†å™¨ï¼‰ï¼Œåˆ†ä»£å›æ”¶ã€å¹¶å‘å›æ”¶ã€å¢é‡å›æ”¶ã€å‹ç¼©å›æ”¶</li>
<li><strong>GCä¼˜åŒ–ä¸å®è·µ</strong>ï¼šå‡å°‘å¯¹è±¡åˆ†é…ã€é¿å…å†…å­˜æ³„æ¼ã€å¤„ç†å†…å­˜æº¢å‡º</li>
<li><strong>GCæ£€æµ‹ä¸è¯Šæ–­</strong>ï¼šProfilerã€logcatã€Systraceã€MATã€LeakCanaryç­‰å·¥å…·</li>
<li><strong>é¢è¯•é¢˜</strong>ï¼šæ¶µç›–åŸºç¡€å’Œé«˜çº§é¢˜ç›®ï¼Œå®Œå…¨åº”å¯¹é¢è¯•</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€RAG+LLMå®æˆ˜æŒ‡å—ã€‘å¦‚ä½•ç”¨æ£€ç´¢å¢å¼ºç”Ÿæˆç ´è§£AIå¹»è§‰éš¾é¢˜ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592572266753982527</link>    <guid>https://juejin.cn/post/7592572266753982527</guid>    <pubDate>2026-01-08T07:19:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592572266753982527" data-draft-id="7592759140037328937" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€RAG+LLMå®æˆ˜æŒ‡å—ã€‘å¦‚ä½•ç”¨æ£€ç´¢å¢å¼ºç”Ÿæˆç ´è§£AIå¹»è§‰éš¾é¢˜ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T07:19:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_æ‘˜æ˜Ÿ_"/> <meta itemprop="url" content="https://juejin.cn/user/2228036358374227"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€RAG+LLMå®æˆ˜æŒ‡å—ã€‘å¦‚ä½•ç”¨æ£€ç´¢å¢å¼ºç”Ÿæˆç ´è§£AIå¹»è§‰éš¾é¢˜ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2228036358374227/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _æ‘˜æ˜Ÿ_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:19:03.000Z" title="Thu Jan 08 2026 07:19:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54c0933dfc2845549c7649cee33acceb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-aRmOaYn18=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461543&amp;x-signature=UezmqNSA4Wu10%2FONMGoQgBO4UrY%3D" alt="jimeng-2026-01-08-9882-æ‰å¹³åŒ–åŠ¨ç”»é£æ ¼ï¼Œç§‘æŠ€æµ·æŠ¥è®¾è®¡ï¼ŒæŠ€æœ¯åšå®¢å°é¢å›¾ï¼Œæç®€ä¸»ä¹‰æ„å›¾ï¼Œç§‘æŠ€æ„Ÿåè¶³çš„èƒŒæ™¯å…ƒç´ ....png" loading="lazy"/></p>
<h2 data-id="heading-0">ã€RAG+LLMå®æˆ˜æŒ‡å—ã€‘å¦‚ä½•ç”¨æ£€ç´¢å¢å¼ºç”Ÿæˆç ´è§£AIå¹»è§‰éš¾é¢˜ï¼Ÿ</h2>
<blockquote>
<p>æ‘˜è¦ï¼šæœ¬æ–‡æ·±å…¥æ¢è®¨å¦‚ä½•é€šè¿‡æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰æŠ€æœ¯è§£å†³å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„å¹»è§‰é—®é¢˜ã€‚ç¬”è€…å°†ç»“åˆåœ¨åŒ»ç–—é—®ç­”ç³»ç»Ÿä¸­çš„è¡€æ³ªæ•™è®­ï¼Œå‰–æå¹»è§‰äº§ç”Ÿçš„æŠ€æœ¯æ ¹æºï¼Œå¹¶æä¾›åŸºäºLangChainçš„å®Œæ•´å®ç°æ–¹æ¡ˆã€‚é€šè¿‡çœŸå®æ€§èƒ½å¯¹æ¯”æ•°æ®å’Œå¯å¤ç°ä»£ç ï¼Œè¯»è€…å°†æŒæ¡æ„å»ºå¯é AIç³»ç»Ÿçš„æ ¸å¿ƒæ–¹æ³•ï¼Œç†è§£RAGå¦‚ä½•å°†æ¨¡å‹ç”Ÿæˆå‡†ç¡®ç‡æå‡47%ã€‚æœ¬æ–‡åŒ…å«5ä¸ªå…³é”®ä»£ç æ®µã€2ä¸ªæ¶æ„å›¾å’Œ1ä¸ªå‘é‡æ•°æ®åº“æ€§èƒ½å¯¹æ¯”è¡¨ã€‚</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€ç¼˜èµ·ï¼šä¸€æ¬¡ä»·å€¼30ä¸‡çš„AIå¹»è§‰äº‹æ•…</h3>
<p>2023å¹´8æœˆï¼Œæˆ‘ä»¬å›¢é˜Ÿä¸ºæŸä¸‰ç”²åŒ»é™¢éƒ¨ç½²çš„åŒ»ç–—é—®ç­”ç³»ç»Ÿçªç„¶ç”Ÿæˆäº†ä¸€æ¡è‡´å‘½é”™è¯¯ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># é”™è¯¯ç”Ÿæˆç¤ºä¾‹ï¼ˆæ•æ„Ÿä¿¡æ¯å·²è„±æ•ï¼‰</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>ç”¨æˆ·æé—®ï¼š<span class="hljs-string">"ç›é…¸äºŒç”²åŒèƒçš„ç¦å¿Œç—‡ï¼Ÿ"</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>æ¨¡å‹å›ç­”ï¼š<span class="hljs-string">"è¯¥è¯ç‰©é€‚ç”¨äºæ‰€æœ‰ç³–å°¿ç—…æ‚£è€…ï¼Œæ— ä½¿ç”¨ç¦å¿Œ"</span>
</code></pre>
<p><strong>å®é™…åŒ»å­¦äº‹å®</strong>ï¼šäºŒç”²åŒèƒç¦ç”¨äºè‚¾åŠŸèƒ½ä¸å…¨æ‚£è€…ï¼ˆeGFR&lt;45ï¼‰ã€‚è¿™ä¸ªé”™è¯¯ç›´æ¥å¯¼è‡´åŒ»ç”Ÿå¼€é”™å¤„æ–¹ï¼Œé™©äº›é…¿æˆåŒ»ç–—äº‹æ•…ã€‚äº‹åå¤ç›˜å‘ç°ï¼Œæ¨¡å‹åœ¨è®­ç»ƒæ•°æ®ä¸­ä»æœªè§è¿‡ç›¸å…³ç¦å¿Œæè¿°ï¼Œå´"è‡ªä¿¡æ»¡æ»¡"åœ°ç¼–é€ äº†é”™è¯¯ç­”æ¡ˆã€‚</p>
<p>ğŸ”¥ <strong>ç—›ç‚¹æ ¹æº</strong>ï¼šä¼ ç»ŸLLMåƒ"é—­å·è€ƒè¯•çš„å­¦ç”Ÿ"ï¼Œä»…ä¾èµ–è®­ç»ƒæ—¶è®°å¿†çš„çŸ¥è¯†ã€‚å½“é‡åˆ°è®­ç»ƒæ•°æ®æœªè¦†ç›–çš„é—®é¢˜æ—¶ï¼Œæ¨¡å‹ä¼šåŸºäºè¯­ä¹‰å…³è”<strong>è™šæ„ç­”æ¡ˆ</strong>ï¼Œè¿™ç§ç°è±¡ç§°ä¸º"å¹»è§‰"ï¼ˆHallucinationï¼‰ã€‚</p>
<h3 data-id="heading-2">äºŒã€æŠ€æœ¯åŸç†æ·±åº¦æ‹†è§£</h3>
<h4 data-id="heading-3">2.1 ä»€ä¹ˆæ˜¯AIå¹»è§‰ï¼Ÿ</h4>

























<table><thead><tr><th>å¹»è§‰ç±»å‹</th><th>è¡¨ç°å½¢å¼</th><th>å±é™©ç­‰çº§</th></tr></thead><tbody><tr><td>äº‹å®æ€§å¹»è§‰</td><td>æé€ ä¸å­˜åœ¨çš„äº‹å®</td><td>âš ï¸âš ï¸âš ï¸</td></tr><tr><td>æŒ‡ä»¤å¹»è§‰</td><td>å¿½ç•¥ç”¨æˆ·æ˜ç¡®è¦æ±‚</td><td>âš ï¸âš ï¸</td></tr><tr><td>ä¸Šä¸‹æ–‡å¹»è§‰</td><td>è„±ç¦»å¯¹è¯å†å²èƒŒæ™¯</td><td>âš ï¸</td></tr></tbody></table>
<h4 data-id="heading-4">2.2 RAGæŠ€æœ¯æ ¸å¿ƒåŸç†</h4>
<p><strong>æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRetrieval-Augmented Generationï¼‰</strong> é€šè¿‡ä¸‰é‡æœºåˆ¶ç ´è§£å¹»è§‰ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[ç”¨æˆ·æé—®] --&gt; B[å‘é‡æ•°æ®åº“å®æ—¶æ£€ç´¢]
    B --&gt; C[ç›¸å…³æ–‡æ¡£ç‰‡æ®µ]
    C --&gt; D[LLMç”Ÿæˆå¸¦å¼•ç”¨çš„å›ç­”]
    D --&gt; E[ç­”æ¡ˆæº¯æºéªŒè¯]
</code></pre>
<ol>
<li><strong>å®æ—¶æ£€ç´¢</strong>ï¼šå°†ç”¨æˆ·é—®é¢˜è½¬åŒ–ä¸ºå‘é‡ï¼Œä»çŸ¥è¯†åº“åŒ¹é…ç›¸å…³æ–‡æ¡£</li>
<li><strong>ä¸Šä¸‹æ–‡æ³¨å…¥</strong>ï¼šå°†æ£€ç´¢ç»“æœä½œä¸ºprompté™„åŠ å†…å®¹</li>
<li><strong>æº¯æºæ§åˆ¶</strong>ï¼šå¼ºåˆ¶æ¨¡å‹åŸºäºå¼•ç”¨å†…å®¹ç”Ÿæˆç­”æ¡ˆ</li>
</ol>
<h4 data-id="heading-5">2.3 ä¸ºä»€ä¹ˆä¼ ç»Ÿå¾®è°ƒæ— æ³•æ ¹æ²»å¹»è§‰ï¼Ÿ</h4>
<p>æˆ‘ä»¬åœ¨åŒ»ç–—æ•°æ®é›†ä¸Šåšäº†å¯¹æ¯”å®éªŒï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æµ‹è¯•ä»£ç ç‰‡æ®µ</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">evaluate_hallucination_rate</span>(<span class="hljs-params">model, test_set</span>):
    hallucination_count = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> question, ground_truth <span class="hljs-keyword">in</span> test_set:
        answer = model.generate(question)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> validate_answer(answer, ground_truth):
            hallucination_count += <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> hallucination_count / <span class="hljs-built_in">len</span>(test_set)

<span class="hljs-comment"># æµ‹è¯•ç»“æœ</span>
base_model_rate = <span class="hljs-number">0.38</span>  <span class="hljs-comment"># åŸå§‹æ¨¡å‹å¹»è§‰ç‡</span>
finetuned_model_rate = <span class="hljs-number">0.29</span>  <span class="hljs-comment"># å¾®è°ƒåå¹»è§‰ç‡</span>
</code></pre>
<p><strong>ç»“è®º</strong>ï¼šå¾®è°ƒä»…èƒ½é™ä½å¹»è§‰æ¦‚ç‡ï¼Œæ— æ³•å®Œå…¨æ¶ˆé™¤æœªçŸ¥é¢†åŸŸé”™è¯¯</p>
<h3 data-id="heading-6">ä¸‰ã€æ‰‹æŠŠæ‰‹æ„å»ºRAGç³»ç»Ÿ</h3>
<h4 data-id="heading-7">3.1 æ¶æ„é€‰å‹å¯¹æ¯”</h4>





























<table><thead><tr><th>ç»„ä»¶</th><th>å¯é€‰æ–¹æ¡ˆ</th><th>æ¨èæŒ‡æ•°</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>å‘é‡æ•°æ®åº“</td><td>Pinecone ğŸŸ¢ / Faiss ğŸŸ¡ / Chroma ğŸ”µ</td><td>ğŸŸ¢ğŸŸ¢ğŸŸ¢</td><td>ç”Ÿäº§ç¯å¢ƒé€‰Pinecone</td></tr><tr><td>åµŒå…¥æ¨¡å‹</td><td>text-embedding-3-small ğŸ”µ / bge-large ğŸŸ¢</td><td>ğŸŸ¢ğŸŸ¢ğŸŸ¢</td><td>ä¸­æ–‡åœºæ™¯ç”¨bge-large</td></tr><tr><td>LLMå¼•æ“</td><td>GPT-4 Turbo ğŸŸ¢ / Claude ğŸŸ¡ / Llama3 ğŸ”µ</td><td>ğŸŸ¢ğŸŸ¢ğŸŸ¢</td><td>ç²¾åº¦è¦æ±‚é«˜é€‰GPT-4</td></tr></tbody></table>
<h4 data-id="heading-8">3.2 çŸ¥è¯†åº“æ„å»ºå®æˆ˜</h4>
<p><strong>å…³é”®æ­¥éª¤</strong>ï¼šæ–‡æ¡£åˆ†å—ç­–ç•¥ç›´æ¥å½±å“æ£€ç´¢ç²¾åº¦</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_text_splitters <span class="hljs-keyword">import</span> RecursiveCharacterTextSplitter

<span class="hljs-comment"># æœ€ä½³åˆ†å—é…ç½®ï¼ˆåŒ»ç–—æ–‡çŒ®åœºæ™¯ï¼‰</span>
text_splitter = RecursiveCharacterTextSplitter(
    chunk_size=<span class="hljs-number">512</span>,  <span class="hljs-comment"># å—å¤§å°</span>
    chunk_overlap=<span class="hljs-number">128</span>,  <span class="hljs-comment"># é‡å é¿å…æ–­å¥</span>
    separators=[<span class="hljs-string">"\n\n"</span>, <span class="hljs-string">"\n"</span>, <span class="hljs-string">"ã€‚"</span>, <span class="hljs-string">"ï¼›"</span>] <span class="hljs-comment"># ä¸­æ–‡åˆ†éš”ç¬¦</span>
)

<span class="hljs-comment"># å¤„ç†PDFæ–‡æ¡£</span>
chunks = text_splitter.split_documents(pdf_loader(<span class="hljs-string">"medical_guidelines.pdf"</span>))
</code></pre>
<p>ğŸ“Œ <strong>é¿å‘æŒ‡å—</strong>ï¼š</p>
<ul>
<li>é¿å…ä½¿ç”¨å›ºå®šå­—ç¬¦åˆ†å—ï¼ˆä¼šåˆ‡æ–­å®Œæ•´å¥å­ï¼‰</li>
<li>æ³•å¾‹/åŒ»ç–—æ–‡æœ¬åº”å¢å¤§é‡å åŒºåŸŸï¼ˆå»ºè®®256å­—èŠ‚ï¼‰</li>
<li>æ·»åŠ å…ƒæ•°æ®æ ‡è®°æ–‡æ¡£æ¥æºç« èŠ‚</li>
</ul>
<h4 data-id="heading-9">3.3 æ£€ç´¢å¢å¼ºå®ç°æ ¸å¿ƒä»£ç </h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># RAGé“¾å®Œæ•´å®ç°ï¼ˆåŸºäºLangChainï¼‰</span>
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_community.vectorstores <span class="hljs-keyword">import</span> Pinecone
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI, OpenAIEmbeddings

<span class="hljs-comment"># åˆå§‹åŒ–ç»„ä»¶</span>
vectorstore = Pinecone.from_existing_index(<span class="hljs-string">"medical-index"</span>, embedding=OpenAIEmbeddings())
retriever = vectorstore.as_retriever(search_kwargs={<span class="hljs-string">"k"</span>: <span class="hljs-number">3</span>}) <span class="hljs-comment"># å–TOP3ç‰‡æ®µ</span>
llm = ChatOpenAI(model=<span class="hljs-string">"gpt-4-turbo"</span>)

<span class="hljs-comment"># å®šä¹‰æç¤ºè¯æ¨¡æ¿</span>
template = <span class="hljs-string">"""è¯·ä¸¥æ ¼æ ¹æ®ä»¥ä¸‹åŒ»å­¦èµ„æ–™å›ç­”é—®é¢˜ï¼š
{context}

é—®é¢˜ï¼š{question}
ç­”æ¡ˆå¿…é¡»åŒ…å«æ–‡çŒ®å¼•ç”¨æ ‡è®°ï¼Œå¦‚[1][2]"""</span>
prompt = ChatPromptTemplate.from_template(template)

<span class="hljs-comment"># æ„å»ºRAGé“¾</span>
chain = (
    {<span class="hljs-string">"context"</span>: retriever, <span class="hljs-string">"question"</span>: RunnablePassthrough()} 
    | prompt 
    | llm 
    | StrOutputParser()
)

<span class="hljs-comment"># ç¤ºä¾‹ä½¿ç”¨</span>
response = chain.invoke(<span class="hljs-string">"ç³–å°¿ç—…æ‚£è€…ä½¿ç”¨äºŒç”²åŒèƒçš„ç¦å¿Œç—‡æœ‰å“ªäº›ï¼Ÿ"</span>)
</code></pre>
<h4 data-id="heading-10">3.4 æ•ˆæœéªŒè¯å…³é”®æŒ‡æ ‡</h4>
<p>éƒ¨ç½²RAGåï¼Œæˆ‘ä»¬å¯¹500æ¡åŒ»å­¦é—®ç­”æµ‹è¯•é›†è¿›è¡ŒéªŒè¯ï¼š</p>





























<table><thead><tr><th>è¯„ä¼°ç»´åº¦</th><th>åŸå§‹æ¨¡å‹</th><th>RAGå¢å¼º</th><th>æå‡å¹…åº¦</th></tr></thead><tbody><tr><td>å¹»è§‰ç‡</td><td>38.2%</td><td>5.7%</td><td>â–¼85%</td></tr><tr><td>äº‹å®å‡†ç¡®ç‡</td><td>61.8%</td><td>90.3%</td><td>â–²47%</td></tr><tr><td>ç”¨æˆ·æ»¡æ„åº¦</td><td>2.8/5</td><td>4.5/5</td><td>â–²61%</td></tr></tbody></table>
<h3 data-id="heading-11">å››ã€ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–ç­–ç•¥</h3>
<h4 data-id="heading-12">4.1 æ··åˆæ£€ç´¢æ¶æ„</h4>
<p>å•ä¸€å‘é‡æ£€ç´¢åœ¨ç²¾ç¡®æœ¯è¯­æŸ¥è¯¢æ—¶å¯èƒ½å¤±æ•ˆï¼Œéœ€ç»“åˆå…³é”®è¯æ£€ç´¢ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[ç”¨æˆ·é—®é¢˜] --&gt; B{é—®é¢˜ç±»å‹åˆ†æ}
    B --&gt;|ä¸“ä¸šæœ¯è¯­| C[å…³é”®è¯æ£€ç´¢]
    B --&gt;|è¯­ä¹‰æŸ¥è¯¢| D[å‘é‡æ£€ç´¢]
    C &amp; D --&gt; E[ç»“æœèåˆ]
    E --&gt; F[ç”Ÿæˆç­”æ¡ˆ]
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ··åˆæ£€ç´¢å®ç°</span>
<span class="hljs-keyword">from</span> langchain_community.retrievers <span class="hljs-keyword">import</span> BM25Retriever

<span class="hljs-comment"># åˆå§‹åŒ–åŒæ£€ç´¢å™¨</span>
keyword_retriever = BM25Retriever.from_texts(docs)
vector_retriever = Pinecone.from_existing_index(...)

<span class="hljs-comment"># è‡ªå®šä¹‰èåˆå™¨</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">hybrid_search</span>(<span class="hljs-params">query</span>):
    keyword_results = keyword_retriever.get_relevant_documents(query)
    vector_results = vector_retriever.get_relevant_documents(query)
    <span class="hljs-keyword">return</span> fusion_results(keyword_results, vector_results)
</code></pre>
<h4 data-id="heading-13">4.2 åŠ¨æ€æ¸©åº¦è°ƒèŠ‚</h4>
<p>é€šè¿‡æ¸©åº¦å‚æ•°æ§åˆ¶ç”Ÿæˆè‡ªç”±åº¦ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ ¹æ®é—®é¢˜é£é™©çº§åˆ«è°ƒæ•´æ¸©åº¦</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">safety_aware_generation</span>(<span class="hljs-params">question</span>):
    risk_level = safety_checker(question)
    temperature = <span class="hljs-number">0.3</span> <span class="hljs-keyword">if</span> risk_level == <span class="hljs-string">"high"</span> <span class="hljs-keyword">else</span> <span class="hljs-number">0.7</span>
    <span class="hljs-keyword">return</span> llm.invoke(prompt, config={<span class="hljs-string">"temperature"</span>: temperature})
</code></pre>
<h4 data-id="heading-14">4.3 æº¯æºéªŒè¯æœºåˆ¶</h4>
<p>å¼ºåˆ¶æ¨¡å‹æ ‡æ³¨å¼•ç”¨æ¥æºï¼š</p>
<pre><code class="hljs language-python" lang="python">prompt_template = <span class="hljs-string">"""
è¯·åŸºäºä»¥ä¸‹è¯æ®å›ç­”é—®é¢˜ï¼š
{{context}}

è¦æ±‚ï¼š
1. æ¯ä¸ªåŒ»å­¦å£°æ˜å¿…é¡»æ ‡æ³¨æ¥æºç¼–å·ï¼Œå¦‚[1]
2. ç¦æ­¢æ·»åŠ ä»»ä½•éå¼•ç”¨å†…å®¹
3. è‹¥æ— æ³•å›ç­”è¯·è¯´"æ ¹æ®ç°æœ‰èµ„æ–™æ— æ³•å›ç­”"
"""</span>
</code></pre>
<h3 data-id="heading-15">äº”ã€å‰æ²¿æ‰©å±•æ–¹å‘</h3>
<h4 data-id="heading-16">5.1 è‡ªæˆ‘ä¿®æ­£RAG</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è‡ªä¿®æ­£æµç¨‹ä¼ªä»£ç </span>
initial_answer = rag_chain(question)
verification = fact_checker(question, initial_answer)
<span class="hljs-keyword">if</span> verification.confidence &lt; <span class="hljs-number">0.9</span>:
    new_context = retrieve_more_docs(verification.gaps)
    final_answer = rag_chain(question, new_context)
</code></pre>
<h4 data-id="heading-17">5.2 å¤šæ¨¡æ€RAG</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¤„ç†åŒ»å­¦å½±åƒæ–‡æœ¬</span>
image_retriever = CLIPRetriever(image_database)
text_retriever = VectorRetriever(text_database)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">multimodal_rag</span>(<span class="hljs-params">question, image=<span class="hljs-literal">None</span></span>):
    <span class="hljs-keyword">if</span> image:
        image_context = image_retriever(image)
    text_context = text_retriever(question)
    <span class="hljs-keyword">return</span> generate_with_both_contexts(image_context, text_context)
</code></pre>
<h3 data-id="heading-18">å…­ã€è¡€æ³ªæ•™è®­æ€»ç»“</h3>
<ol>
<li>
<p><strong>çŸ¥è¯†åº“æ›´æ–°æœºåˆ¶</strong>ï¼šæŸæ¬¡è¯å“è¯´æ˜ä¹¦æ›´æ–°æœªåŒæ­¥ï¼Œå¯¼è‡´ç³»ç»Ÿæ¨èç¦ç”¨è¯å‰‚</p>
<ul>
<li>âœ… è§£å†³æ–¹æ¡ˆï¼šå»ºç«‹çŸ¥è¯†åº“å˜æ›´è‡ªåŠ¨è§¦å‘é‡ç´¢å¼•æµæ°´çº¿</li>
</ul>
</li>
<li>
<p><strong>æ£€ç´¢å¤±è´¥å…œåº•</strong>ï¼šå½“æ£€ç´¢è¿”å›ç©ºæ—¶ï¼ŒåŸå§‹æ¨¡å‹ç›´æ¥èƒ¡ç¼–ä¹±é€ </p>
<ul>
<li>âœ… è§£å†³æ–¹æ¡ˆï¼šæ·»åŠ ç©ºç»“æœæ£€æµ‹ï¼Œè§¦å‘"èµ„æ–™ä¸è¶³"å“åº”æ¨¡æ¿</li>
</ul>
</li>
<li>
<p><strong>è¿‡åº¦ä¾èµ–é£é™©</strong>ï¼šåŒ»ç”Ÿå°†ç³»ç»Ÿç­”æ¡ˆè§†ä¸ºç»å¯¹çœŸç†</p>
<ul>
<li>âœ… è§£å†³æ–¹æ¡ˆï¼šåœ¨æ‰€æœ‰å›ç­”æ·»åŠ "æœ¬å»ºè®®éœ€ä¸“ä¸šåŒ»å¸ˆç¡®è®¤"è­¦ç¤ºè¯­</li>
</ul>
</li>
</ol>
<h3 data-id="heading-19">ä¸ƒã€æ€è€ƒé¢˜</h3>
<ol>
<li><strong>ä¼¦ç†å›°å¢ƒ</strong>ï¼šå½“RAGç³»ç»Ÿæ£€ç´¢åˆ°ç›¸äº’å†²çªçš„åŒ»å­¦æ–‡çŒ®æ—¶ï¼ˆå¦‚æ–°æ—§ç‰ˆæŒ‡å—çŸ›ç›¾ï¼‰ï¼Œç³»ç»Ÿåº”å¦‚ä½•åº”å¯¹ï¼Ÿ</li>
<li><strong>æŠ€æœ¯æé™</strong>ï¼šèƒ½å¦è®¾è®¡å‡º100%æ— å¹»è§‰çš„AIç³»ç»Ÿï¼Ÿç†è®ºä¸Šçš„ä¸å¯èƒ½æ€§æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</li>
<li><strong>æˆæœ¬å¹³è¡¡</strong>ï¼šåœ¨å®æ—¶æ€§è¦æ±‚æé«˜çš„æ€¥è¯Šåœºæ™¯ï¼Œå¦‚ä½•å¹³è¡¡RAGçš„æ£€ç´¢è€—æ—¶ä¸ç”Ÿå‘½å®‰å…¨ï¼Ÿ</li>
</ol>
<blockquote>
<p><strong>æœ€åå¿ å‘Š</strong>ï¼šRAGä¸æ˜¯æ¶ˆé™¤å¹»è§‰çš„é“¶å¼¹ï¼Œè€Œæ˜¯äººç±»æ™ºæ…§ä¸AIåä½œçš„æ¡¥æ¢ã€‚æœ€å±é™©çš„å¹»è§‰ï¼Œæ˜¯è®¤ä¸ºAIå¯ä»¥æ›¿ä»£ä¸“ä¸šåˆ¤æ–­ã€‚</p>
</blockquote>
<hr/>
<p><strong>é™„å½•ï¼šå®Œæ•´RAGç³»ç»Ÿéƒ¨ç½²æ¸…å•</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ£€æŸ¥è¡¨</span>
deployment_checklist = [
    <span class="hljs-string">"âœ… çŸ¥è¯†åº“ç‰ˆæœ¬é”å®šæœºåˆ¶"</span>,
    <span class="hljs-string">"âœ… æ£€ç´¢å¤±è´¥å…œåº•ç­–ç•¥"</span>,
    <span class="hljs-string">"âœ… ç”¨æˆ·é£é™©æç¤ºæ¨¡æ¿"</span>,
    <span class="hljs-string">"âœ… å®æ—¶ç›‘æ§ä»ªè¡¨ç›˜"</span>,
    <span class="hljs-string">"âœ… äººå·¥å®¡æ ¸é€šé“"</span>,
    <span class="hljs-string">"âš ï¸ å®šæœŸåŒ»å­¦ä¸“å®¶éªŒè¯"</span>
]
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€ç«™å¼è®²æ¸…Spring AI Alibabaçš„OverAllStateå’ŒRunnableConfig]]></title>    <link>https://juejin.cn/post/7592816646869352457</link>    <guid>https://juejin.cn/post/7592816646869352457</guid>    <pubDate>2026-01-08T07:45:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592816646869352457" data-draft-id="7592424951660019738" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€ç«™å¼è®²æ¸…Spring AI Alibabaçš„OverAllStateå’ŒRunnableConfig"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,æ¶æ„,GitHub"/> <meta itemprop="datePublished" content="2026-01-08T07:45:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æƒ³ç”¨offeræ‰“ç‰Œ"/> <meta itemprop="url" content="https://juejin.cn/user/578781641968972"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€ç«™å¼è®²æ¸…Spring AI Alibabaçš„OverAllStateå’ŒRunnableConfig
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/578781641968972/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æƒ³ç”¨offeræ‰“ç‰Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:45:12.000Z" title="Thu Jan 08 2026 07:45:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.8;font-weight:400;font-size:16px;word-spacing:2px;letter-spacing:2px;overflow-x:hidden;color:#3e3e3e;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{padding-bottom:12px;font-size:24px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:1.2em;border-bottom:2px solid #ef7060;word-spacing:0!important;letter-spacing:0!important;font-size:inherit;line-height:inherit;display:block;font-weight:400;background:#ef7060;color:#fff;padding:10px;border-top-right-radius:3px;border-top-left-radius:3px;margin-right:3px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨ Spring AI Alibabaï¼ˆä»¥åŠæ›´å¹¿æ³›çš„ Spring AI å’Œ LangChain ç”Ÿæ€ç³»ç»Ÿï¼‰ä¸­ï¼Œ<code>RunnableConfig</code> å’Œ <code>OverallState</code>æ˜¯æ„å»ºAgentï¼ˆæ™ºèƒ½ä½“ï¼‰æˆ–Workflowï¼ˆå·¥ä½œæµï¼‰æ—¶çš„ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œé‚£å®ƒä»¬åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<h2 data-id="heading-1">RunnableConfig (è¿è¡Œæ—¶é…ç½®)</h2>
<p><code>RunnableConfig</code> æ˜¯ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œç”¨äºåœ¨æ‰§è¡Œé“¾ï¼ˆChainï¼‰æˆ– Agent çš„å„ä¸ªæ­¥éª¤ä¹‹é—´ä¼ é€’<strong>è¿è¡Œæ—¶</strong>çš„å…ƒæ•°æ®å’Œæ§åˆ¶å‚æ•°ã€‚å®ƒç±»ä¼¼äºä¸€ä¸ªâ€œèƒŒåŒ…â€ï¼Œä¼´éšç€è¯·æ±‚åœ¨æ•´ä¸ªç³»ç»Ÿä¸­æµåŠ¨ï¼Œä½†å®ƒä¸åŒ…å«ä¸šåŠ¡æ•°æ®ï¼ŒåªåŒ…å«â€œå¦‚ä½•æ‰§è¡Œâ€çš„æŒ‡ä»¤ä¸å‚æ•°ã€‚</p>
<h3 data-id="heading-2">æ ¸å¿ƒä½œç”¨ï¼š</h3>
<ol>
<li>
<p><strong>æ§åˆ¶é€’å½’ä¸å¾ªç¯ (Recursion Limit)</strong> ï¼š</p>
<ul>
<li>åœ¨ Agent å¾ªç¯ï¼ˆä¾‹å¦‚ï¼šæ€è€ƒ -&gt; å·¥å…· -&gt; æ€è€ƒï¼‰ä¸­ï¼Œä¸ºäº†é˜²æ­¢æ­»å¾ªç¯ï¼Œ<code>RunnableConfig</code> å¯ä»¥è®¾ç½®æœ€å¤§é€’å½’æ¬¡æ•°ï¼ˆä¾‹å¦‚ 25 æ¬¡ï¼‰ã€‚å¦‚æœè¶…è¿‡è¿™ä¸ªæ¬¡æ•°ï¼Œç³»ç»Ÿä¼šå¼ºåˆ¶åœæ­¢å¹¶æŠ¥é”™ã€‚</li>
</ul>
</li>
<li>
<p><strong>å›è°ƒæœºåˆ¶ (Callbacks)</strong> ï¼š</p>
<ul>
<li>å®ƒæºå¸¦äº† <code>CallbackManager</code>ã€‚ä½ å¯ä»¥é€šè¿‡å®ƒæŒ‚è½½ç›‘å¬å™¨ï¼Œç›‘æ§ Token æ¶ˆè€—ã€æµå¼è¾“å‡ºï¼ˆStreamingï¼‰ã€æˆ–è€…åœ¨æŸä¸ªæ­¥éª¤å¼€å§‹/ç»“æŸæ—¶è§¦å‘æ—¥å¿—ã€‚</li>
</ul>
</li>
<li>
<p><strong>å…ƒæ•°æ®ä¸è¿½è¸ª (Metadata &amp; Tags)</strong> ï¼š</p>
<ul>
<li>ä½ å¯ä»¥ç»™å½“å‰çš„æ‰§è¡Œè¯·æ±‚æ‰“ä¸Š <code>tags</code>ï¼ˆæ ‡ç­¾ï¼‰æˆ– <code>metadata</code>ï¼ˆå…ƒæ•°æ®ï¼‰ã€‚è¿™å¯¹äºé“¾è·¯è¿½è¸ªï¼ˆå¦‚æ¥å…¥ LangSmith æˆ– Zipkinï¼‰éå¸¸é‡è¦ã€‚ä¾‹å¦‚ï¼Œæ ‡è®° <code>userId: 123</code> æˆ– <code>environment: production</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>å¹¶å‘æ§åˆ¶ä¸è¶…æ—¶</strong>ï¼š</p>
<ul>
<li>åœ¨æŸäº›å®ç°ä¸­ï¼Œå®ƒå¯ä»¥æºå¸¦å–æ¶ˆä¿¡å·ï¼ˆCancellation Signalsï¼‰æˆ–è¶…æ—¶è®¾ç½®</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">å…³é”®ç†è§£</h3>
<p>ä½ å¯ä»¥å°†RunnableConfigç†è§£ä¸ºâ€œæ˜¾å¼çš„ã€è·¨çº¿ç¨‹å®‰å…¨çš„ ThreadLocalâ€ã€‚</p>
<p>åœ¨ Spring AI / LangChain çš„æ¶æ„ä¸­ï¼Œ<code>RunnableConfig</code> èµ·åˆ°äº†åŒæ ·çš„ä½œç”¨ï¼š</p>
<ul>
<li><strong>éšå¼ä¼ é€’</strong>ï¼šè™½ç„¶å®ƒä½œä¸ºå‚æ•°ä¼ é€’ï¼Œä½†åœ¨ Agent çš„å†…éƒ¨ç»„ä»¶ï¼ˆå¦‚å„ä¸ª Toolã€å„ä¸ª Chain èŠ‚ç‚¹ï¼‰ä¹‹é—´ï¼Œå®ƒå¾€å¾€æ˜¯ä½œä¸ºä¸€ä¸ªâ€œç¯å¢ƒä¸Šä¸‹æ–‡â€å­˜åœ¨çš„ã€‚</li>
<li><strong>å­˜æ”¾â€œå¸¦å¤–æ•°æ®â€ (Out-of-band Data)</strong> ï¼šå®ƒä¸“é—¨è®¾è®¡äº†ä¸€ä¸ª <code>metadata</code> å­—æ®µï¼ˆæ˜¯ä¸€ä¸ª Mapï¼‰ï¼Œå…è®¸ä½ å¾€é‡Œé¢å¡ä¸€äº›<strong>éä¸šåŠ¡é€»è¾‘æ ¸å¿ƒã€ä½†å…¨é“¾è·¯éƒ½éœ€è¦</strong>çš„æ•°æ®ã€‚</li>
</ul>
<h4 data-id="heading-4">å¼‚æ­¥ä¸è·¨çº¿ç¨‹å®‰å…¨æ€§ (è¿™æ˜¯æœ€å¤§çš„åŒºåˆ«)</h4>
<ul>
<li><strong>ThreadLocal</strong>: å®ƒæ˜¯ç»‘å®šåœ¨<strong>ç‰¹å®šçº¿ç¨‹</strong>ä¸Šçš„ã€‚Spring AI åº•å±‚ï¼ˆç‰¹åˆ«æ˜¯åœ¨æµå¼è¾“å‡º Streaming æˆ–è°ƒç”¨å¤§æ¨¡å‹ API æ—¶ï¼‰ç»å¸¸æ˜¯<strong>å¼‚æ­¥çš„</strong>ï¼ˆä½¿ç”¨ <code>WebFlux</code> æˆ– <code>CompletableFuture</code>ï¼‰ã€‚ä¸€æ—¦ä»£ç åˆ‡æ¢äº†çº¿ç¨‹ï¼ˆä¾‹å¦‚ä» Tomcat çº¿ç¨‹åˆ‡æ¢åˆ° Netty I/O çº¿ç¨‹ï¼‰ï¼Œ<code>ThreadLocal</code> é‡Œçš„æ•°æ®å°±ä¼šä¸¢å¤±ï¼Œé™¤éä½ åšéå¸¸å¤æ‚çš„ Context å¤åˆ¶ã€‚</li>
<li><strong>RunnableConfig</strong>: å®ƒæ˜¯ä¸€ä¸ªæ™®é€šçš„ <strong>Java å¯¹è±¡</strong>ã€‚å½“ AI ä»»åŠ¡åœ¨ä¸åŒçš„çº¿ç¨‹ã€ä¸åŒçš„ Reactor æµä¹‹é—´ä¼ é€’æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šä½œä¸ºä¸€ä¸ªå‚æ•°ä¸€ç›´è·Ÿç€èµ°ã€‚<strong>æ— è®ºçº¿ç¨‹æ€ä¹ˆåˆ‡ï¼Œæ•°æ®éƒ½åœ¨é‚£é‡Œï¼Œä¸ä¼šä¸¢ã€‚</strong></li>
</ul>
<h4 data-id="heading-5">ä½œç”¨åŸŸæ¸…æ™° (Scope)</h4>
<ul>
<li><strong>ThreadLocal</strong>: å¦‚æœå¿˜è®° <code>remove()</code>ï¼Œå®¹æ˜“é€ æˆå†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰ï¼Œæˆ–è€…åœ¨çº¿ç¨‹æ± å¤ç”¨æ—¶é€ æˆæ•°æ®æ±¡æŸ“ï¼ˆä¸Šä¸€ä¸ªè¯·æ±‚çš„æ•°æ®ç•™åˆ°äº†ä¸‹ä¸€ä¸ªè¯·æ±‚ï¼‰ã€‚</li>
<li><strong>RunnableConfig</strong>: å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸¥æ ¼ç»‘å®šåœ¨å•æ¬¡æ‰§è¡Œé“¾ï¼ˆRunï¼‰ä¸Šã€‚ä¹Ÿå°±æ˜¯ <code>agent.invoke()</code> ç»“æŸï¼Œè¿™ä¸ª Config å¯¹è±¡ä¹Ÿå°±å®Œæˆäº†ä½¿å‘½ï¼Œè¢« GC å›æ”¶ï¼Œéå¸¸å¹²å‡€</li>
</ul>
<h3 data-id="heading-6">ç¤ºä¾‹</h3>
<p>ä¸‹é¢æ˜¯Spring AI Alibabaçš„ä¸€æ®µç¤ºä¾‹</p>
<ol>
<li>
<p>ä» <code>toolContext.getContext()</code> ä¸­å–å‡º <code>RunnableConfig</code></p>
</li>
<li>
<p>ä»ä¸­è¯»å– <code>metadata("user_id")</code></p>
</li>
<li>
<p>æ ¹æ®user_id</p>
<p>è¿”å›ä¸åŒä½ç½®ï¼š</p>
<ul>
<li>ç”¨æˆ· ID ä¸º <code>"1"</code> â†’ <code>"Florida"</code></li>
<li>å…¶ä»– â†’ <code>"San Francisco"</code></li>
</ul>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·ä½ç½®å·¥å…· - ä½¿ç”¨ä¸Šä¸‹æ–‡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserLocationTool</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BiFunction</span>&lt;String, ToolContext, String&gt; {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">apply</span><span class="hljs-params">(
        <span class="hljs-meta">@ToolParam(description = "User query")</span> String query,
        ToolContext toolContext)</span> {
        <span class="hljs-comment">// ä»ä¸Šä¸‹æ–‡ä¸­è·å–ç”¨æˆ·ä¿¡æ¯</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
        <span class="hljs-keyword">if</span> (toolContext != <span class="hljs-literal">null</span> &amp;&amp; toolContext.getContext() != <span class="hljs-literal">null</span>) {
			<span class="hljs-type">RunnableConfig</span> <span class="hljs-variable">runnableConfig</span> <span class="hljs-operator">=</span> (RunnableConfig) toolContext.getContext().get(AGENT_CONFIG_CONTEXT_KEY);
			Optional&lt;Object&gt; userIdObjOptional = runnableConfig.metadata(<span class="hljs-string">"user_id"</span>);
			<span class="hljs-keyword">if</span> (userIdObjOptional.isPresent()) {
				userId = (String) userIdObjOptional.get();
			}
		}
		<span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
			userId = <span class="hljs-string">"1"</span>;
		}
        <span class="hljs-keyword">return</span> <span class="hljs-string">"1"</span>.equals(userId) ? <span class="hljs-string">"Florida"</span> : <span class="hljs-string">"San Francisco"</span>;
    }
}
</code></pre>
<p><code>RunnableConfig</code>Â æä¾›äº†ä¸€ä¸ªÂ <code>context()</code>Â æ–¹æ³•ï¼Œå…è®¸ä½ åœ¨åŒä¸€ä¸ªæ‰§è¡Œæµç¨‹ä¸­çš„å¤šä¸ª Hook è°ƒç”¨ã€å¤šè½®æ¨¡å‹æˆ–å·¥å…·è°ƒç”¨ä¹‹é—´å…±äº«æ•°æ®ã€‚è¿™å¯¹äºå®ç°è®¡æ•°å™¨ã€ç´¯ç§¯ç»Ÿè®¡ä¿¡æ¯æˆ–è·¨å¤šæ¬¡è°ƒç”¨ç»´æŠ¤çŠ¶æ€éå¸¸æœ‰ç”¨ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>è·Ÿè¸ªæ¨¡å‹æˆ–å·¥å…·è°ƒç”¨æ¬¡æ•°</li>
<li>ç´¯ç§¯æ€§èƒ½æŒ‡æ ‡ï¼ˆæ€»è€—æ—¶ã€å¹³å‡å“åº”æ—¶é—´ç­‰ï¼‰</li>
<li>åœ¨ before/after Hook ä¹‹é—´ä¼ é€’ä¸´æ—¶æ•°æ®</li>
<li>å®ç°åŸºäºè®¡æ•°çš„é™æµæˆ–æ–­è·¯å™¨</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼šä½¿ç”¨ RunnableConfig.context() å®ç°è°ƒç”¨è®¡æ•°å™¨</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@HookPositions({HookPosition.BEFORE_MODEL, HookPosition.AFTER_MODEL})</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ModelCallCounterHook</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ModelHook</span> {  
  
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">CALL_COUNT_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"__model_call_count__"</span>;  
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOTAL_TIME_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"__total_model_time__"</span>;  
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">START_TIME_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"__call_start_time__"</span>;  
  
<span class="hljs-meta">@Override</span>  
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {  
<span class="hljs-keyword">return</span> <span class="hljs-string">"model_call_counter"</span>;  
}  
  
<span class="hljs-meta">@Override</span>  
<span class="hljs-keyword">public</span> CompletableFuture&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">beforeModel</span><span class="hljs-params">(OverAllState state, RunnableConfig config)</span> {  
<span class="hljs-comment">// ä» context è¯»å–å½“å‰è®¡æ•°ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™é»˜è®¤ä¸º 0ï¼‰  </span>
<span class="hljs-type">int</span> <span class="hljs-variable">currentCount</span> <span class="hljs-operator">=</span> config.context().containsKey(CALL_COUNT_KEY)  
? (<span class="hljs-type">int</span>) config.context().get(CALL_COUNT_KEY) : <span class="hljs-number">0</span>;  
  
System.out.println(<span class="hljs-string">"æ¨¡å‹è°ƒç”¨ #"</span> + (currentCount + <span class="hljs-number">1</span>));  
  
<span class="hljs-comment">// è®°å½•å¼€å§‹æ—¶é—´  </span>
config.context().put(START_TIME_KEY, System.currentTimeMillis());  
  
<span class="hljs-keyword">return</span> CompletableFuture.completedFuture(Map.of());  
}  
  
<span class="hljs-meta">@Override</span>  
<span class="hljs-keyword">public</span> CompletableFuture&lt;Map&lt;String, Object&gt;&gt; <span class="hljs-title function_">afterModel</span><span class="hljs-params">(OverAllState state, RunnableConfig config)</span> {  
<span class="hljs-comment">// è¯»å–å½“å‰è®¡æ•°å¹¶é€’å¢  </span>
<span class="hljs-type">int</span> <span class="hljs-variable">currentCount</span> <span class="hljs-operator">=</span> config.context().containsKey(CALL_COUNT_KEY)  
? (<span class="hljs-type">int</span>) config.context().get(CALL_COUNT_KEY) : <span class="hljs-number">0</span>;  
config.context().put(CALL_COUNT_KEY, currentCount + <span class="hljs-number">1</span>);  
  
<span class="hljs-comment">// è®¡ç®—æœ¬æ¬¡è°ƒç”¨è€—æ—¶å¹¶ç´¯åŠ åˆ°æ€»è€—æ—¶  </span>
<span class="hljs-keyword">if</span> (config.context().containsKey(START_TIME_KEY)) {  
<span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> (<span class="hljs-type">long</span>) config.context().get(START_TIME_KEY);  
<span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;  
  
<span class="hljs-type">long</span> <span class="hljs-variable">totalTime</span> <span class="hljs-operator">=</span> config.context().containsKey(TOTAL_TIME_KEY)  
? (<span class="hljs-type">long</span>) config.context().get(TOTAL_TIME_KEY) : <span class="hljs-number">0L</span>;  
config.context().put(TOTAL_TIME_KEY, totalTime + duration);  
  
<span class="hljs-comment">// è¾“å‡ºç»Ÿè®¡ä¿¡æ¯  </span>
<span class="hljs-type">int</span> <span class="hljs-variable">newCount</span> <span class="hljs-operator">=</span> currentCount + <span class="hljs-number">1</span>;  
<span class="hljs-type">long</span> <span class="hljs-variable">newTotalTime</span> <span class="hljs-operator">=</span> totalTime + duration;  
System.out.println(<span class="hljs-string">"æ¨¡å‹è°ƒç”¨å®Œæˆ: "</span> + duration + <span class="hljs-string">"ms"</span>);  
System.out.println(<span class="hljs-string">"ç´¯è®¡ç»Ÿè®¡ - è°ƒç”¨æ¬¡æ•°: "</span> + newCount + <span class="hljs-string">", æ€»è€—æ—¶: "</span> + newTotalTime + <span class="hljs-string">"ms, å¹³å‡: "</span> + (newTotalTime / newCount) + <span class="hljs-string">"ms"</span>);  
}  
  
<span class="hljs-keyword">return</span> CompletableFuture.completedFuture(Map.of());  
}  
}
</code></pre>
<h2 data-id="heading-7">OverallState (å…¨å±€çŠ¶æ€/ä¸Šä¸‹æ–‡)</h2>
<p><code>OverallState</code> é€šå¸¸ä¸æ˜¯ Spring AI æ¡†æ¶å†…çš„ä¸€ä¸ªå›ºå®šç±»åï¼ˆä¸åƒ <code>RunnableConfig</code> å±äºæ ¸å¿ƒæ¥å£ï¼‰ï¼Œå®ƒé€šå¸¸æ˜¯å¼€å‘è€…åœ¨æ„å»º <strong>åŸºäºå›¾ï¼ˆGraph-basedï¼‰</strong> æˆ– <strong>çŠ¶æ€æœºï¼ˆStatefulï¼‰</strong> çš„ Agent æ—¶è‡ªå®šä¹‰çš„ä¸€ä¸ªç±»ã€‚</p>
<p>åœ¨ Spring AI Alibaba çš„é«˜çº§åº”ç”¨ï¼ˆå¦‚ä»¿ç…§ LangGraph çš„æ¨¡å¼ï¼‰ä¸­ï¼ŒAgent çš„æ‰§è¡Œè¿‡ç¨‹è¢«è§†ä¸ºä¸€ç³»åˆ—èŠ‚ç‚¹çš„æµè½¬ã€‚<code>OverallState</code> å°±æ˜¯åœ¨è¿™äº›èŠ‚ç‚¹ä¹‹é—´ä¼ é€’çš„<strong>å…±äº«å†…å­˜å¯¹è±¡</strong>ã€‚</p>
<p>å®ƒä¸€èˆ¬åŒ…å«çš„å°±æ˜¯åº”ç”¨çš„ä¸šåŠ¡æ•°æ®ã€‚</p>
<h3 data-id="heading-8">æ ¸å¿ƒä½œç”¨ï¼š</h3>
<ol>
<li>
<p><strong>ç»Ÿä¸€çš„æ•°æ®æ€»çº¿</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰çš„èŠ‚ç‚¹ï¼ˆNodeï¼‰éƒ½ä» <code>OverallState</code> è¯»å–æ•°æ®ï¼Œå¤„ç†å®Œåå°†ç»“æœå†™å› <code>OverallState</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>è®°å¿†ç®¡ç† (Memory)</strong> ï¼š</p>
<ul>
<li>
<p>å®ƒé€šå¸¸åŒ…å«ï¼š</p>
<ul>
<li><code>input</code>ï¼šç”¨æˆ·çš„åŸå§‹é—®é¢˜ã€‚</li>
<li><code>chat_history</code>ï¼šå¯¹è¯çš„å†å²æ¶ˆæ¯åˆ—è¡¨ã€‚</li>
<li><code>intermediate_steps</code>ï¼šAgent çš„ä¸­é—´æ€è€ƒè¿‡ç¨‹æˆ–å·¥å…·è°ƒç”¨ç»“æœã€‚</li>
<li><code>output</code>ï¼šæœ€ç»ˆç”Ÿæˆçš„ç­”æ¡ˆã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>çŠ¶æ€æµè½¬</strong>ï¼š</p>
<ul>
<li>åœ¨ Spring AI Alibaba å¯¹æ¥ Qwenï¼ˆé€šä¹‰åƒé—®ï¼‰æ—¶ï¼Œæ¨¡å‹ç”Ÿæˆçš„å›å¤ä¼šæ›´æ–°åˆ° State ä¸­ï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆæ¯”å¦‚å·¥å…·æ‰§è¡ŒèŠ‚ç‚¹ï¼‰ä¼šè¯»å– State ä¸­çš„æ¨¡å‹æŒ‡ä»¤å»æ‰§è¡Œå·¥å…·ã€‚</li>
</ul>
</li>
</ol>
<h3 data-id="heading-9">å·¥ä½œæµ</h3>
<p>ä¸‹é¢æˆ‘ç»™å‡ºä¸€ä¸ªç¤ºä¾‹å·¥ä½œæµã€‚</p>
<ul>
<li>
<p><strong>Start</strong> -&gt; ä¼ å…¥åˆå§‹ <code>OverallState</code>ï¼ˆåŒ…å«ç”¨æˆ·é—®é¢˜ï¼‰ã€‚</p>
</li>
<li>
<p><strong>LLM Node</strong> -&gt; è¯»å– Stateï¼Œè°ƒç”¨ Qwen æ¨¡å‹ï¼Œå°†æ¨¡å‹çš„å›å¤ï¼ˆæ¯”å¦‚â€œå»è°ƒç”¨å¤©æ°”APIâ€ï¼‰å†™å…¥ Stateã€‚</p>
</li>
<li>
<p><strong>Tool Node</strong> -&gt; æ£€æµ‹åˆ° State é‡Œæœ‰è°ƒç”¨è¯·æ±‚ï¼Œæ‰§è¡Œå¤©æ°” APIï¼Œå°†ç»“æœâ€œ25åº¦â€å†™å…¥ Stateã€‚</p>
</li>
<li>
<p><strong>LLM Node</strong> -&gt; å†æ¬¡è¯»å– Stateï¼ˆåŒ…å«é—®é¢˜+å·¥å…·ç»“æœï¼‰ï¼Œç”Ÿæˆæœ€ç»ˆå›ç­”â€œä»Šå¤©25åº¦â€ï¼Œå†™å…¥ Stateã€‚</p>
</li>
<li>
<p><strong>End</strong> -&gt; è¿”å› State ä¸­çš„æœ€ç»ˆå›ç­”ã€‚</p>
</li>
</ul>
<h2 data-id="heading-10">æ€»ç»“å¯¹æ¯”</h2>






























<table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>RunnableConfig</strong></th><th><strong>OverallState (è‡ªå®šä¹‰çŠ¶æ€)</strong></th></tr></thead><tbody><tr><td><strong>å…³æ³¨ç‚¹</strong></td><td><strong>è¿‡ç¨‹æ§åˆ¶</strong> (Process Control)</td><td><strong>ä¸šåŠ¡æ•°æ®</strong> (Business Data)</td></tr><tr><td><strong>å†…å®¹ç¤ºä¾‹</strong></td><td>é€’å½’é™åˆ¶ã€å›è°ƒå‡½æ•°ã€å…ƒæ•°æ®ã€æ ‡ç­¾</td><td>ç”¨æˆ·é—®é¢˜ã€LLM å›å¤ã€å·¥å…·ç»“æœã€æ•°æ®åº“æŸ¥è¯¢å€¼</td></tr><tr><td><strong>å¯å˜æ€§</strong></td><td>é€šå¸¸åœ¨è¿è¡Œå¼€å§‹æ—¶è®¾å®šï¼Œä¼ é€’è¿‡ç¨‹ä¸­è¾ƒå°‘ä¿®æ”¹</td><td>åœ¨æ¯ä¸ªæ­¥éª¤ï¼ˆNodeï¼‰ä¸­ä¸æ–­è¢«è¯»å–å’Œä¿®æ”¹ï¼ˆç´¯åŠ ä¿¡æ¯ï¼‰</td></tr><tr><td><strong>ç±»æ¯”</strong></td><td><strong>äº¤é€šè§„åˆ™ä¸ä¿¡å·ç¯</strong>ï¼ˆçº¢ç»¿ç¯ã€é™é€Ÿï¼‰</td><td><strong>è´§è½¦ä¸Šçš„è´§ç‰©</strong>ï¼ˆæ¯ä¸€ç«™å¯èƒ½ä¼šè£…å¸è´§ç‰©ï¼‰</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot é…ç½®æ–‡ä»¶åŠ è½½å¤§æ­ç§˜ï¼šä¼˜å…ˆçº§è¦†ç›–ä¸äº’è¡¥åˆå¹¶æœºåˆ¶è¯¦è§£]]></title>    <link>https://juejin.cn/post/7592572266754342975</link>    <guid>https://juejin.cn/post/7592572266754342975</guid>    <pubDate>2026-01-08T08:22:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592572266754342975" data-draft-id="7592637149696655395" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot é…ç½®æ–‡ä»¶åŠ è½½å¤§æ­ç§˜ï¼šä¼˜å…ˆçº§è¦†ç›–ä¸äº’è¡¥åˆå¹¶æœºåˆ¶è¯¦è§£"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2026-01-08T08:22:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·030480591263"/> <meta itemprop="url" content="https://juejin.cn/user/3793762867478852"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot é…ç½®æ–‡ä»¶åŠ è½½å¤§æ­ç§˜ï¼šä¼˜å…ˆçº§è¦†ç›–ä¸äº’è¡¥åˆå¹¶æœºåˆ¶è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3793762867478852/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·030480591263
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:22:28.000Z" title="Thu Jan 08 2026 08:22:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Spring Boot é¡¹ç›®çš„éƒ¨ç½²è¿ç»´ä¸­ï¼ˆå°¤å…¶æ˜¯ä½¿ç”¨ <code>java -jar</code> å¯åŠ¨æ—¶ï¼‰ï¼Œé…ç½®æ–‡ä»¶çš„åŠ è½½é€»è¾‘å¸¸å¸¸è®©äººæ„Ÿåˆ°å›°æƒ‘ï¼š</p>
<blockquote>
<p>â€œå¦‚æœæˆ‘åœ¨ jar åŒ…æ—è¾¹æ”¾äº†é…ç½®æ–‡ä»¶ï¼Œconfig ç›®å½•ä¸‹ä¹Ÿæ”¾äº†ä¸€ä¸ªï¼Œjar åŒ…é‡Œè¿˜æœ‰ä¸€ä¸ªï¼Œåˆ°åº•è°ç”Ÿæ•ˆï¼Ÿâ€
â€œå¤–éƒ¨é…ç½®æ–‡ä»¶æ˜¯ä¼šæŠŠå†…éƒ¨çš„å®Œå…¨æ›¿æ¢æ‰å—ï¼Ÿâ€</p>
</blockquote>
<p>ä»Šå¤©æˆ‘ä»¬å°±é€šè¿‡ä¸€ç¯‡æ–‡ç« ï¼Œå½»åº•è®²é€ Spring Boot é…ç½®æ–‡ä»¶çš„ <strong>â€œä¼˜å…ˆçº§è¦†ç›–â€</strong> ä¸ <strong>â€œäº’è¡¥åˆå¹¶â€</strong> ä¸¤å¤§æ ¸å¿ƒæœºåˆ¶ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ æ ¸å¿ƒæœºåˆ¶å›¾è§£</h2>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å»ºç«‹ä¸€ä¸ªæ¦‚å¿µï¼šSpring Boot è¯»å–é…ç½®ï¼Œ<strong>ä¸æ˜¯â€œéé»‘å³ç™½â€çš„æ–‡ä»¶æ›¿æ¢ï¼Œè€Œæ˜¯ç±»ä¼¼â€œåƒå±‚é¥¼â€æˆ–â€œPSå›¾å±‚â€çš„å åŠ ã€‚</strong></p>
<p>å®ƒéµå¾ªä¸¤ä¸ªåŸåˆ™ï¼š</p>
<ol>
<li><strong>ä¼˜å…ˆçº§ï¼ˆPriorityï¼‰ï¼š</strong> å†³å®šè°è¯´äº†ç®—ï¼ˆé‡åˆ°å†²çªï¼Œå¬é«˜ä¼˜å…ˆçº§çš„ï¼‰ã€‚</li>
<li><strong>äº’è¡¥åˆå¹¶ï¼ˆMergeï¼‰ï¼š</strong> å†³å®šå¦‚ä½•å…±å­˜ï¼ˆæ²¡å†²çªçš„ï¼Œå¤§å®¶ä¸€èµ·ç”Ÿæ•ˆï¼‰ã€‚</li>
</ol>
<h2 data-id="heading-1">äºŒã€ ä¼˜å…ˆçº§æ¢¯é˜Ÿï¼ˆè°æ˜¯è€å¤§ï¼Ÿï¼‰</h2>
<p>å½“ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpring Boot ä¼šæŒ‰ç…§ä»¥ä¸‹é¡ºåºæ‰«æé…ç½®æ–‡ä»¶ï¼Œ<strong>ä¼˜å…ˆçº§ä»é«˜åˆ°ä½</strong>ï¼š</p>
<ol>
<li><strong>å‘½ä»¤è¡Œå‚æ•°</strong> <code>(æœ€é«˜)</code>
<ul>
<li><code>java -jar app.jar --server.port=9999</code></li>
<li><em>è¯´æ˜ï¼š</em> ä¸€ç¥¨å¦å†³æƒï¼Œé€šå¸¸ç”¨äºä¸´æ—¶æ•‘æ€¥ã€‚</li>
</ul>
</li>
<li><strong>è¿è¡Œç›®å½•ä¸‹çš„ config å­ç›®å½•</strong>
<ul>
<li><code>file:./config/application.yml</code></li>
<li><em>è¯´æ˜ï¼š</em> å¤–éƒ¨é…ç½®çš„ç‹è€…ï¼Œä¼˜å…ˆçº§é«˜äºæ ¹ç›®å½•ã€‚</li>
</ul>
</li>
<li><strong>è¿è¡Œç›®å½•ï¼ˆJar åŒ…åŒçº§ç›®å½•ï¼‰</strong>
<ul>
<li><code>file:./application.yml</code></li>
<li><em>è¯´æ˜ï¼š</em> æœ€å¸¸ç”¨çš„ç”Ÿäº§ç¯å¢ƒé…ç½®ä½ç½®ã€‚</li>
</ul>
</li>
<li><strong>Classpath å†…éƒ¨</strong> <code>(æœ€ä½/ä¿åº•)</code>
<ul>
<li><code>classpath:/application.yml</code></li>
<li><em>è¯´æ˜ï¼š</em> æ‰“åŒ…åœ¨ Jar åŒ…é‡Œçš„é»˜è®¤é…ç½®ï¼ˆå¼€å‘æ—¶å†™çš„ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€ äº’è¡¥åˆå¹¶æœºåˆ¶ï¼ˆå¦‚ä½•å…±å­˜ï¼Ÿï¼‰</h2>
<p>è¿™æ˜¯å¾ˆå¤šæ–°æ‰‹å®¹æ˜“è¯¯è§£çš„åœ°æ–¹ã€‚</p>
<p><strong>å¤–éƒ¨é…ç½®æ–‡ä»¶ç”Ÿæ•ˆï¼Œå¹¶ä¸ä»£è¡¨å†…éƒ¨é…ç½®æ–‡ä»¶â€œå¤±æ•ˆâ€æˆ–â€œè¢«ä¸¢å¼ƒâ€ï¼</strong>
Spring Boot ä¼šæŠŠæ‰€æœ‰æ‰«æåˆ°çš„é…ç½®æ–‡ä»¶<strong>åŠ è½½è¿›å†…å­˜è¿›è¡Œåˆå¹¶</strong>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆ <strong>Photoshop çš„å›¾å±‚å åŠ </strong>ï¼š</p>
<ul>
<li>é«˜ä¼˜å…ˆçº§çš„é…ç½®åœ¨<strong>ä¸Šå±‚</strong>ã€‚</li>
<li>ä½ä¼˜å…ˆçº§çš„é…ç½®åœ¨<strong>ä¸‹å±‚</strong>ã€‚</li>
<li>å¦‚æœä¸Šå±‚æ²¡æœ‰è®¾ç½®æŸä¸ªå€¼ï¼ˆé€æ˜ï¼‰ï¼Œå°±ä¼šé€è¿‡ä¸Šå±‚çœ‹åˆ°ä¸‹å±‚çš„å€¼ã€‚</li>
</ul>
<h3 data-id="heading-3">å åŠ è§„åˆ™çš„ä¸‰å¤§å®šå¾‹ï¼š</h3>
<ol>
<li><strong>å†²çªè¦†ç›–ï¼ˆOverrideï¼‰ï¼š</strong> Key ç›¸åŒï¼Œé«˜ä¼˜å…ˆçº§è¦†ç›–ä½ä¼˜å…ˆçº§ã€‚</li>
<li><strong>ç¼ºçœä¿ç•™ï¼ˆRetainï¼‰ï¼š</strong> Key ä»…åœ¨ä½ä¼˜å…ˆçº§å­˜åœ¨ï¼Œä¼šè¢«ä¿ç•™ã€‚</li>
<li><strong>å¢é‡è¿½åŠ ï¼ˆAddï¼‰ï¼š</strong> Key ä»…åœ¨é«˜ä¼˜å…ˆçº§å­˜åœ¨ï¼Œä¼šè¢«è¿½åŠ ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-4">å››ã€ ç»ˆæå®æˆ˜æ¼”ç»ƒ</h2>
<p>ä¸ºäº†å½»åº•çœ‹æ‡‚ï¼Œæˆ‘ä»¬å‡è®¾æœ‰ä¸‰ä¸ªé…ç½®æ–‡ä»¶åŒæ—¶å­˜åœ¨ï¼š</p>
<h4 data-id="heading-5">1. å±‚çº§æœ€ä½ï¼šJar åŒ…å†…éƒ¨ (<code>classpath</code>)</h4>
<p>è¿™æ˜¯å¼€å‘æ—¶çš„å…¨é‡é…ç½®ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>             <span class="hljs-comment"># é»˜è®¤ç«¯å£</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">my-app</span>         <span class="hljs-comment"># åº”ç”¨å</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost/dev_db</span> <span class="hljs-comment"># å¼€å‘åº“</span>
</code></pre>
<h4 data-id="heading-6">2. å±‚çº§ä¸­ç­‰ï¼šJar åŒ…åŒçº§ç›®å½• (<code>./application.yml</code>)</h4>
<p>è¿ç»´éƒ¨ç½²æ—¶æ”¾çš„ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9000</span>             <span class="hljs-comment"># ã€å†²çªã€‘æƒ³æ”¹æˆ 9000</span>
<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.1.1/prod_db</span> <span class="hljs-comment"># ã€å†²çªã€‘æ”¹æˆç”Ÿäº§åº“</span>
</code></pre>
<h4 data-id="heading-7">3. å±‚çº§æœ€é«˜ï¼šConfig å­ç›®å½• (<code>./config/application.yml</code>)</h4>
<p>ä¸ºäº†ç‰¹æ®Šè°ƒè¯•ï¼ŒåˆåŠ äº†ä¸€ä¸ªï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9999</span>             <span class="hljs-comment"># ã€å†²çªã€‘è¿™é‡Œçº§åˆ«æœ€é«˜ï¼</span>
<span class="hljs-attr">logging:</span>
  <span class="hljs-attr">level:</span> <span class="hljs-string">debug</span>           <span class="hljs-comment"># ã€æ–°å¢ã€‘è¿™é‡Œç‹¬æœ‰çš„é…ç½®</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">ğŸ’¥ æœ€ç»ˆåˆå¹¶ç»“æœï¼ˆç¨‹åºå®é™…è¿è¡Œé…ç½®ï¼‰</h3>
<p>å½“è¿è¡Œ <code>java -jar app.jar</code> æ—¶ï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„é…ç½®å¦‚ä¸‹ï¼š</p>






























<table><thead><tr><th align="left">é…ç½®é¡¹ (Key)</th><th align="left">æœ€ç»ˆå€¼</th><th align="left">æ¥æºä¸åŸå› </th></tr></thead><tbody><tr><td align="left"><code>server.port</code></td><td align="left"><strong>9999</strong></td><td align="left"><strong>configç›®å½•</strong> (æœ€é«˜ä¼˜) è¦†ç›–äº† jaråŒ…æ— å’Œ jaråŒ…å†… çš„é…ç½®ã€‚</td></tr><tr><td align="left"><code>spring.datasource.url</code></td><td align="left"><strong>.../prod_db</strong></td><td align="left"><strong>jaråŒ…æ—ç›®å½•</strong> (ä¸­ä¼˜) è¦†ç›–äº† jaråŒ…å†… çš„é…ç½®ï¼Œconfigç›®å½•æ²¡å†™ï¼Œæ‰€ä»¥â€œé€â€ä¸‹æ¥äº†ã€‚</td></tr><tr><td align="left"><code>spring.application.name</code></td><td align="left"><strong>my-app</strong></td><td align="left"><strong>jaråŒ…å†…éƒ¨</strong> (ä¿åº•)ã€‚å¤–éƒ¨ä¸¤ä¸ªæ–‡ä»¶éƒ½æ²¡å†™è¿™ä¸ªé…ç½®ï¼Œæ²¿ç”¨é»˜è®¤å€¼ã€‚</td></tr><tr><td align="left"><code>logging.level</code></td><td align="left"><strong>debug</strong></td><td align="left"><strong>configç›®å½•</strong> (æ–°å¢)ã€‚è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„é…ç½®ï¼Œè¢«åˆå¹¶è¿›æ¥äº†ã€‚</td></tr></tbody></table>
<h2 data-id="heading-9">äº”ã€ æ€»ç»“ä¸æœ€ä½³å®è·µ</h2>
<ol>
<li><strong>ä¸è¦è¯•å›¾åœ¨å¤–éƒ¨é‡å†™æ‰€æœ‰é…ç½®</strong>ï¼šåˆ©ç”¨â€œäº’è¡¥åˆå¹¶â€ç‰¹æ€§ï¼Œå¤–éƒ¨é…ç½®æ–‡ä»¶ï¼ˆ<code>application.yml</code>ï¼‰åº”è¯¥<strong>åªåŒ…å«éœ€è¦ä¿®æ”¹çš„å·®å¼‚åŒ–é…ç½®</strong>ï¼ˆå¦‚æ•°æ®åº“å¯†ç ã€ç«¯å£ã€IPï¼‰ã€‚è®©é‚£äº›é€šç”¨çš„é…ç½®ï¼ˆå¦‚ Jackson æ ¼å¼åŒ–ã€çº¿ç¨‹æ± é»˜è®¤è®¾ç½®ï¼‰ç•™åœ¨ Jar åŒ…é‡Œä½œä¸ºä¿åº•ã€‚</li>
<li><strong>ç›®å½•ç»“æ„å»ºè®®</strong>ï¼š
<ul>
<li>å¦‚æœæ˜¯ç®€å•çš„å•æœºéƒ¨ç½²ï¼Œç›´æ¥æŠŠ <code>application.yml</code> æ”¾åœ¨ Jar åŒ…æ—è¾¹å³å¯ã€‚</li>
<li>å¦‚æœä½ å¸Œæœ›ç›®å½•æ›´æ•´æ´ï¼Œæˆ–è€…æœ‰å¤šä¸ªè¾…åŠ©é…ç½®æ–‡ä»¶ï¼Œå»ºè®®åˆ›å»ºä¸€ä¸ª <code>config</code> æ–‡ä»¶å¤¹å­˜æ”¾ã€‚</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½ çš„SQLä¸ºä»€ä¹ˆæ…¢ï¼Ÿçœ‹æ‡‚MySQL EXPLAINæ‰§è¡Œè®¡åˆ’ï¼Œå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆ]]></title>    <link>https://juejin.cn/post/7592768559169929242</link>    <guid>https://juejin.cn/post/7592768559169929242</guid>    <pubDate>2026-01-08T08:23:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592768559169929242" data-draft-id="7592816646869549065" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½ çš„SQLä¸ºä»€ä¹ˆæ…¢ï¼Ÿçœ‹æ‡‚MySQL EXPLAINæ‰§è¡Œè®¡åˆ’ï¼Œå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆ"/> <meta itemprop="keywords" content="æ•°æ®åº“,MySQL"/> <meta itemprop="datePublished" content="2026-01-08T08:23:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CVå·¥ç¨‹å¸ˆçš„è‡ªæˆ‘ä¿®å…»"/> <meta itemprop="url" content="https://juejin.cn/user/1039488093258619"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½ çš„SQLä¸ºä»€ä¹ˆæ…¢ï¼Ÿçœ‹æ‡‚MySQL EXPLAINæ‰§è¡Œè®¡åˆ’ï¼Œå¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1039488093258619/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CVå·¥ç¨‹å¸ˆçš„è‡ªæˆ‘ä¿®å…»
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:23:31.000Z" title="Thu Jan 08 2026 08:23:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å½“ä¸€æ¡SQLæ…¢çš„æ—¶å€™éœ€è¦åˆ†æå…·ä½“åŸå› ï¼ŒåŸºæœ¬ç¬¬ä¸€ååº”å°±æ˜¯ç¥­å‡º<code>EXPLAIN</code>å‘½ä»¤å»è§£æè¿™æ¡SQLæ‰§è¡Œæƒ…å†µã€‚ä½†æ˜¯å¤§å¤šæ•°äººéƒ½åªä¼šçœ‹æ˜¯å¦å‘½ä¸­ç´¢å¼•ä»¥åŠå¯¹è¡¨çš„è®¿é—®ç±»å‹ã€‚æ˜¯å¦çœ‹åˆ°<code>Extra</code>é‡Œçš„<code>Using filesort</code>ã€<code>Using temporary</code>åªçŸ¥é“æ˜¯è­¦å‘Šï¼Œå´ä¸çŸ¥å¦‚ä½•è§£å†³ï¼Ÿä¸‹é¢å°±å¸¦ä½ è¯¦ç»†åˆ†æ<code>EXPLAIN</code>è§£é‡Šç»“æœçš„æ¯ä¸€åˆ—éƒ½åˆ†åˆ«ä»£è¡¨ç€ä»€ä¹ˆæ„æ€ã€‚</p>
<p><strong>id</strong></p>
<p>selectè¯­å¥çš„æ‰§è¡Œåºå·ï¼Œæ‰§è¡Œé¡ºåºä¸ºä»å¤§åˆ°å°æ‰§è¡Œï¼Œå¦‚æœç›¸åŒæ—¶ä»ä¸Šå¾€ä¸‹æ‰§è¡Œã€‚</p>
<p><strong>select_type</strong></p>
<ol>
<li>SIMPLEï¼šç®€å•çš„selectï¼Œä¸ä½¿ç”¨UNIONæˆ–è€…å­æŸ¥è¯¢ç­‰ï¼›</li>
<li>PRIMARYï¼šå­æŸ¥è¯¢ä¸­æœ€å¤–å±‚æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸­è‹¥åŒ…å«ä»»ä½•å¤æ‚çš„å­éƒ¨åˆ†ï¼Œæœ€å¤–å±‚çš„selectè¢«æ ‡è®°ä¸ºPRIMARYï¼›</li>
<li>UNIONï¼šUNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åé¢çš„selectè¯­å¥ï¼›</li>
<li>DEPENDENT UNIONï¼šUNIONä¸­çš„ç¬¬äºŒä¸ªæˆ–è€…åé¢çš„selectè¯­å¥ï¼Œå–å†³äºå¤–é¢çš„æŸ¥è¯¢ï¼›</li>
<li>UNION RESULTï¼šUNIONçš„ç»“æœï¼›</li>
<li>SUBQUERYï¼šå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªselectï¼Œç»“æœä¸ä¾èµ–äºå¤–éƒ¨æŸ¥è¯¢ï¼›</li>
<li>DEPENDENT SUBQUERYï¼šå­æŸ¥è¯¢ä¸­çš„ç¬¬ä¸€ä¸ªselectï¼Œç»“æœä¾èµ–äºå¤–éƒ¨æŸ¥è¯¢ï¼›</li>
<li>DERIVEDï¼šæ´¾ç”Ÿè¡¨çš„selectï¼Œfromè‡ªå±…çš„å­æŸ¥è¯¢ï¼›</li>
<li>UNCACHEABLEã€€SUBQUERYï¼šä¸€ä¸ªå­æŸ¥è¯¢çš„ç»“æœä¸èƒ½è¢«ç¼“å­˜ï¼Œå¿…é¡»é‡æ–°è¯„ä¼°å¤–è¿æ¥é¥¿ç¬¬ä¸€è¡Œ</li>
</ol>
<p><strong>table</strong></p>
<p>æ˜¾ç¤ºè¿™ä¸€æ­¥æ‰€è®¿é—®æ•°æ®åº“ä¸­è¡¨åç§°(æ˜¾ç¤ºè¿™ä¸€è¡Œçš„æ•°æ®æ˜¯å…³äºå“ªå¼ è¡¨çš„)ï¼Œæœ‰æ—¶ä¸æ˜¯çœŸå®çš„è¡¨åç§°ï¼Œå¯èƒ½æ˜¯åˆ«åï¼Œä¹Ÿå¯èƒ½æ˜¯ç¬¬å‡ æ­¥æ‰§è¡Œçš„ç»“æœçš„ç®€ç§°</p>
<p><strong>type</strong></p>
<p>å¯¹è¡¨çš„è®¿é—®æ–¹å¼ï¼Œè¡¨ç¤ºMySQLåœ¨è¡¨ä¸­æ‰¾åˆ°æ‰€éœ€è¡Œçš„æ–¹å¼ï¼Œåˆç§°â€œè®¿é—®ç±»å‹â€ã€‚</p>
<ol>
<li>ALL:å…¨è¡¨æ‰«æï¼Œæ€§èƒ½æœ€å·®ï¼Œå¦‚æœåœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨äº†limit</li>
<li>index:è·ŸALLä¸€æ ·ï¼Œä¹Ÿä¼šè¿›è¡Œå…¨è¡¨æ‰«æï¼Œåªæ˜¯MySQLä¼šæŒ‰ç´¢å¼•æ¬¡åºè¿›è¡Œå…¨è¡¨æ‰«æï¼Œè€Œä¸æ˜¯ç›´æ¥æ‰«æè¡Œæ•°æ®ã€‚å®ƒä¸»è¦çš„ä¼˜ç‚¹æ˜¯é¿å…äº†æ’åºï¼›æœ€å¤§çš„ç¼ºç‚¹æ˜¯è¦æ‰¿æ‹…æŒ‰ç´¢å¼•æ¬¡åºè¯»å–æ•´ä¸ªè¡¨çš„å¼€é”€ã€‚è‹¥æ˜¯æŒ‰éšæœºæ¬¡åºè®¿é—®è¡Œï¼Œå¼€é”€å°†ä¼šéå¸¸å¤§ã€‚</li>
<li>range:èŒƒå›´æ‰«æï¼Œå°±æ˜¯ä¸€ä¸ªæœ‰èŒƒå›´é™åˆ¶çš„ç´¢å¼•æ‰«æã€‚å®ƒå¼€å§‹äºç´¢å¼•é‡Œçš„æŸä¸€ç‚¹ï¼Œè¿”å›æ‰¹åŒ¹é…è¿™ä¸ªèŒƒå›´å€¼çš„è¡Œã€‚rangeæ¯”å…¨ç´¢å¼•æ‰«ææ›´é«˜æ•ˆï¼Œå› ä¸ºå®ƒç”¨ä¸ç€éå†å…¨éƒ¨ç´¢å¼•ã€‚</li>
<li>ref:æ ‡è¯†ä¸Šè¿°è¡¨çš„è¿æ¥åŒ¹é…æ¡ä»¶ï¼Œå³å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—å•†å¾—å€¼ã€‚</li>
<li>eq_ref:ç±»ä¼¼refï¼ŒåŒºåˆ«å°±åœ¨ä½¿ç”¨çš„ç´¢å¼•æ˜¯å”¯ä¸€ç´¢å¼•ï¼Œå¯¹äºæ¯ä¸ªç´¢å¼•é”®å€¼ï¼Œè¡¨ä¸­åªæœ‰ä¸€æ¡è®°å½•åŒ¹é…ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯å¤šè¡¨è¿æ¥ä¸­ä½¿ç”¨primary_keyæˆ–è€…unique_keyä½œä¸ºå…³è”æ¡ä»¶ã€‚</li>
<li>constã€system:å½“MySQLå¯¹æŸ¥è¯¢æŸéƒ¨åˆ†è¿›è¡Œä¼˜åŒ–ï¼Œå¹¶è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡æ—¶ï¼Œä½¿ç”¨è¿™äº›ç±»å‹è®¿é—®ã€‚ä¾‹å¦‚ä¸»é”®è‡³äºwhereåˆ—è¡¨ä¸­ï¼Œmysqlå°±èƒ½å°†è¯¥æŸ¥è¯¢è½¬æ¢ä¸ºä¸€ä¸ªå¸¸é‡ï¼Œsystemæ˜¯constç±»å‹çš„ç‰¹ä¾‹ï¼Œå½“æŸ¥è¯¢çš„è¡¨åªæœ‰ä¸€è¡Œçš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨systemã€‚</li>
<li>null:MySQLåœ¨ä¼˜åŒ–è¿‡ç¨‹ä¸­åˆ†è§£è¯­å¥ï¼Œæ‰§è¡Œæ—¶ç”šè‡³ä¸ç”¨è®¿é—®è¡¨æˆ–è€…ç´¢å¼•ï¼Œä¾‹å¦‚ä»ä¸€ä¸ªç´¢å¼•åˆ—é‡Œé€‰å–æœ€å°å€¼å¯ä»¥é€šè¿‡å•ç‹¬ç´¢å¼•æŸ¥æ‰¾å®Œæˆã€‚</li>
</ol>
<p><strong>possible_keys</strong></p>
<p>æŒ‡å‡ºMySQLèƒ½ä½¿ç”¨å“ªä¸ªç´¢å¼•åœ¨è¡¨ä¸­æ‰¾åˆ°è®°å½•ï¼ŒæŸ¥è¯¢æ¶‰åŠåˆ°çš„å­—æ®µä¸Šè‹¥å­˜åœ¨ç´¢å¼•ï¼Œåˆ™è¯¥ç´¢å¼•å°†è¢«åˆ—å‡ºï¼Œä½†ä¸ä¸€å®šè¢«æŸ¥è¯¢ä½¿ç”¨(è¯¥æŸ¥è¯¢å¯ä»¥åˆ©ç”¨ç´¢å¼•ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•ç´¢å¼•æ˜¾ç¤ºnull)è¯¥åˆ—å®Œå…¨ç‹¬ç«‹äºexplainè¾“å‡ºæ‰€ç¤ºçš„è¡¨çš„æ¬¡åºã€‚è¿™æ„å‘³ç€åœ¨possible_keysä¸­çš„æŸäº›é”®å®é™…ä¸Šä¸èƒ½æŒ‰ç”Ÿæˆçš„è¡¨æ¬¡åºä½¿ç”¨ï¼Œå¦‚æœè¯¥åˆ—æ˜¯nullï¼Œåˆ™æ²¡æœ‰ç›¸å…³çš„ç´¢å¼•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥whereè‡ªå±…çœ‹æ˜¯å¦å®ƒå¼•ç”¨æŸäº›åˆ—æˆ–è€…é€‚åˆç´¢å¼•çš„åˆ—æ¥æé«˜ä½ çš„æŸ¥è¯¢æ€§èƒ½ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼Œåˆ›é€ ä¸€ä¸ªé€‚å½“çš„ç´¢å¼•å¹¶ä¸”å†æ¬¡ç”¨explainæ£€æŸ¥æŸ¥è¯¢ã€‚</p>
<p><strong>key</strong></p>
<p>keyåˆ—æ˜¾ç¤ºMySQLå®é™…å†³å®šä½¿ç”¨çš„é”®ï¼ˆç´¢å¼•ï¼‰ï¼Œå¿…ç„¶åŒ…å«åœ¨possible_keysä¸­å¦‚æœæ²¡æœ‰é€‰æ‹©ç´¢å¼•ï¼Œé”®æ˜¯NULLã€‚è¦æƒ³å¼ºåˆ¶MySQL ä½¿ç”¨æˆ–å¿½è§†possible_keysåˆ—ä¸­çš„ç´¢å¼•ï¼Œåœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨FORCE INDEXã€USE INDEXæˆ–è€…IGNORE INDEXã€‚</p>
<p><strong>key_len</strong></p>
<p>è¡¨ç¤ºç´¢å¼•ä¸­ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œå¯é€šè¿‡è¯¥åˆ—è®¡ç®—æŸ¥è¯¢ä¸­ä½¿ç”¨çš„ç´¢å¼•çš„é•¿åº¦ï¼ˆkey_lenæ˜¾ç¤ºçš„å€¼ä¸ºç´¢å¼•å­—æ®µçš„æœ€å¤§å¯èƒ½é•¿åº¦ï¼Œå¹¶éå®é™…ä½¿ç”¨é•¿åº¦ï¼Œå³key_lenæ˜¯æ ¹æ®è¡¨å®šä¹‰è®¡ç®—è€Œå¾—ï¼Œä¸æ˜¯é€šè¿‡è¡¨å†…æ£€ç´¢å‡ºçš„ï¼‰ä¸æŸå¤±ç²¾ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶ŠçŸ­è¶Šå¥½</p>
<p><strong>ref</strong></p>
<p>åˆ—ä¸ç´¢å¼•çš„æ¯”è¾ƒï¼Œè¡¨ç¤ºä¸Šè¿°è¡¨çš„è¿æ¥åŒ¹é…æ¡ä»¶ï¼Œå³å“ªäº›åˆ—æˆ–å¸¸é‡è¢«ç”¨äºæŸ¥æ‰¾ç´¢å¼•åˆ—ä¸Šçš„å€¼</p>
<p><strong>rows</strong></p>
<p>ä¼°ç®—å‡ºç»“æœé›†è¡Œæ•°ï¼Œè¡¨ç¤ºMySQLæ ¹æ®è¡¨ç»Ÿè®¡ä¿¡æ¯åŠç´¢å¼•é€‰ç”¨æƒ…å†µï¼Œä¼°ç®—çš„æ‰¾åˆ°æ‰€éœ€çš„è®°å½•æ‰€éœ€è¦è¯»å–çš„è¡Œæ•°</p>
<p><strong>extra</strong></p>
<p>è¯¥åˆ—åŒ…å«MySQLè§£å†³æŸ¥è¯¢çš„è¯¦ç»†ä¿¡æ¯,ä¸‹é¢è¯¦ç»†ã€‚</p>
<ol>
<li>Distinct:ä¸€æ—¦MYSQLæ‰¾åˆ°äº†ä¸è¡Œç›¸è”åˆåŒ¹é…çš„è¡Œï¼Œå°±ä¸å†æœç´¢äº†ã€‚</li>
<li>Not exists:MYSQLä¼˜åŒ–äº†LEFT JOINï¼Œä¸€æ—¦å®ƒæ‰¾åˆ°äº†åŒ¹é…LEFT JOINæ ‡å‡†çš„è¡Œï¼Œå°±ä¸å†æœç´¢äº†</li>
<li>Range checked for each:Recordï¼ˆindex map:#ï¼‰æ²¡æœ‰æ‰¾åˆ°ç†æƒ³çš„ç´¢å¼•ï¼Œå› æ­¤å¯¹äºä»å‰é¢è¡¨ä¸­æ¥çš„æ¯ä¸€ä¸ªè¡Œç»„åˆï¼ŒMYSQLæ£€æŸ¥ä½¿ç”¨å“ªä¸ªç´¢å¼•ï¼Œå¹¶ ç”¨å®ƒæ¥ä»è¡¨ä¸­è¿”å›è¡Œã€‚è¿™æ˜¯ä½¿ç”¨ç´¢å¼•çš„æœ€æ…¢çš„è¿æ¥ä¹‹ä¸€</li>
<li>Using filesort:çœ‹åˆ°è¿™ä¸ªçš„æ—¶å€™ï¼ŒæŸ¥è¯¢å°±éœ€è¦ä¼˜åŒ–äº†ã€‚MYSQLéœ€è¦è¿›è¡Œé¢å¤–çš„æ­¥éª¤æ¥å‘ç°å¦‚ä½•å¯¹è¿”å›çš„è¡Œæ’åºã€‚å®ƒæ ¹æ®è¿æ¥ç±»å‹ä»¥åŠå­˜å‚¨æ’åºé”® å€¼å’ŒåŒ¹é…æ¡ä»¶çš„å…¨éƒ¨è¡Œçš„è¡ŒæŒ‡é’ˆæ¥æ’åºå…¨éƒ¨è¡Œ</li>
<li>Using index:åˆ—æ•°æ®æ˜¯ä»ä»…ä»…ä½¿ç”¨äº†ç´¢å¼•ä¸­çš„ä¿¡æ¯è€Œæ²¡æœ‰è¯»å–å®é™…çš„è¡ŒåŠ¨çš„è¡¨è¿”å›çš„ï¼Œè¿™å‘ç”Ÿåœ¨å¯¹è¡¨çš„å…¨éƒ¨çš„è¯·æ±‚åˆ—éƒ½æ˜¯åŒä¸€ä¸ªç´¢å¼•çš„éƒ¨åˆ†çš„æ—¶å€™</li>
<li>Using temporary:çœ‹åˆ°è¿™ä¸ªçš„æ—¶å€™ï¼ŒæŸ¥è¯¢éœ€è¦ä¼˜åŒ–äº†ã€‚è¿™é‡Œï¼ŒMYSQLéœ€è¦åˆ›å»ºä¸€ä¸ªä¸´æ—¶è¡¨æ¥å­˜å‚¨ç»“æœï¼Œè¿™é€šå¸¸å‘ç”Ÿåœ¨å¯¹ä¸åŒçš„åˆ—é›†è¿›è¡ŒORDER BY ä¸Šï¼Œè€Œä¸æ˜¯GROUP BYä¸Š</li>
<li>Using where:ä½¿ç”¨äº†WHEREä»å¥æ¥é™åˆ¶å“ªäº›è¡Œå°†ä¸ä¸‹ä¸€å¼ è¡¨åŒ¹é…æˆ–è€…æ˜¯è¿”å›ç»™ç”¨æˆ·ã€‚å¦‚æœä¸æƒ³è¿”å›è¡¨ä¸­çš„å…¨éƒ¨è¡Œï¼Œå¹¶ä¸”è¿æ¥ç±»å‹ALLæˆ–indexï¼Œè¿™ å°±ä¼šå‘ç”Ÿï¼Œæˆ–è€…æ˜¯æŸ¥è¯¢æœ‰é—®é¢˜</li>
</ol>
<p><strong>æ³¨æ„</strong></p>
<ol>
<li>EXPLAINä¸ä¼šå‘Šè¯‰ä½ å…³äºè§¦å‘å™¨ã€å­˜å‚¨è¿‡ç¨‹çš„ä¿¡æ¯æˆ–ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°å¯¹æŸ¥è¯¢çš„å½±å“æƒ…å†µ</li>
<li>EXPLAINä¸èƒ½æ˜¾ç¤ºMySQLåœ¨æ‰§è¡ŒæŸ¥è¯¢æ—¶æ‰€ä½œçš„ä¼˜åŒ–å·¥ä½œ</li>
<li>éƒ¨åˆ†ç»Ÿè®¡ä¿¡æ¯æ˜¯ä¼°ç®—çš„ï¼Œå¹¶éç²¾ç¡®å€¼</li>
<li>EXPALINåªèƒ½è§£é‡ŠSELECTæ“ä½œï¼Œå…¶ä»–æ“ä½œè¦é‡å†™ä¸ºSELECTåæŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LLM åº”ç”¨è¯„æµ‹é—­ç¯ï¼ševal.jsonl + LLM-as-judge + çº¿ä¸ŠæŒ‡æ ‡ï¼ˆå« Python æœ€å°å®ç°ï¼‰]]></title>    <link>https://juejin.cn/post/7592637149696639011</link>    <guid>https://juejin.cn/post/7592637149696639011</guid>    <pubDate>2026-01-08T08:07:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592637149696639011" data-draft-id="7592622563546071075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LLM åº”ç”¨è¯„æµ‹é—­ç¯ï¼ševal.jsonl + LLM-as-judge + çº¿ä¸ŠæŒ‡æ ‡ï¼ˆå« Python æœ€å°å®ç°ï¼‰"/> <meta itemprop="keywords" content="AIç¼–ç¨‹,AIGC"/> <meta itemprop="datePublished" content="2026-01-08T08:07:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="147API"/> <meta itemprop="url" content="https://juejin.cn/user/872345976974154"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LLM åº”ç”¨è¯„æµ‹é—­ç¯ï¼ševal.jsonl + LLM-as-judge + çº¿ä¸ŠæŒ‡æ ‡ï¼ˆå« Python æœ€å°å®ç°ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/872345976974154/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    147API
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:07:18.000Z" title="Thu Jan 08 2026 08:07:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ æ”¹ promptã€æ¢æ¨¡å‹ã€åŠ  RAGã€åŠ å·¥å…·è°ƒç”¨ä¹‹åï¼Œæœ€éš¾çš„é—®é¢˜å¾€å¾€ä¸æ˜¯â€œæ€ä¹ˆæ”¹â€ï¼Œè€Œæ˜¯ï¼š</p>
<blockquote>
<p><strong>æ€ä¹ˆè¯æ˜æ”¹åŠ¨çœŸçš„å˜å¥½äº†ï¼Ÿ</strong></p>
</blockquote>
<p>è¿™ç¯‡ç›´æ¥ç»™ä½ ä¸€ä¸ªæœ€å°å¯è½åœ°çš„è¯„æµ‹é—­ç¯ï¼š</p>
<ul>
<li>ç¦»çº¿ï¼š<code>eval.jsonl</code> å›å½’é›†ï¼ˆ50 æ¡å…ˆè·‘èµ·æ¥ï¼‰</li>
<li>è‡ªåŠ¨è¯„æµ‹ï¼šLLM-as-judgeï¼ˆrubric + JSON æ ¡éªŒï¼‰</li>
<li>çº¿ä¸Šï¼šå…³é”®å­—æ®µæ‰“ç‚¹ï¼ˆèƒ½å›ç­”â€œå“ªé‡Œæ…¢/å“ªé‡Œè´µ/å“ªé‡Œé”™â€ï¼‰</li>
<li>å‘å¸ƒï¼šé—¨ç¦ + ç°åº¦ + å›æ»š</li>
</ul>
<hr/>
<h2 data-id="heading-0">0ï¼‰ç›®å½•ç»“æ„ï¼ˆå»ºè®®ç…§æŠ„ï¼‰</h2>
<pre><code class="hljs language-text" lang="text">eval/
  eval.jsonl
  run_eval.py
  judge.py
  aggregate.py
</code></pre>
<hr/>
<h2 data-id="heading-1">1ï¼‰è¯„æµ‹é›†æ ¼å¼ï¼ˆeval.jsonlï¼‰</h2>
<p>åˆ«å†™â€œæ ‡å‡†ç­”æ¡ˆå…¨æ–‡â€ï¼Œå†™å…³é”®ç‚¹ï¼ˆæ›´ç¨³å®šã€æ›´å¥½åˆ¤åˆ†ï¼‰ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"q001"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"chat"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"question"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"gold_keypoints"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">,</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"notes"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"åˆ¤åˆ†å£å¾„"</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"q101"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"rag"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"question"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"gold_keypoints"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"gold_evidence_ids"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"docA#p3"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">{</span><span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"q201"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"tool"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"question"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"gold_keypoints"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"..."</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"expected_tool_calls"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"get_order_status"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-2">2ï¼‰ç»Ÿä¸€ LLM è°ƒç”¨ï¼ˆOpenAI å…¼å®¹ï¼‰</h2>
<pre><code class="hljs language-bash" lang="bash">pip install -U openai
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># run_eval.py</span>
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">call_llm</span>(<span class="hljs-params">base_url: <span class="hljs-built_in">str</span>, api_key: <span class="hljs-built_in">str</span>, model: <span class="hljs-built_in">str</span>, messages: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">dict</span>]</span>) -&gt; <span class="hljs-built_in">dict</span>:
    client = OpenAI(api_key=api_key, base_url=base_url)
    t0 = time.time()
    resp = client.chat.completions.create(model=model, messages=messages)
    latency_ms = <span class="hljs-built_in">int</span>((time.time() - t0) * <span class="hljs-number">1000</span>)
    usage = <span class="hljs-built_in">getattr</span>(resp, <span class="hljs-string">"usage"</span>, <span class="hljs-literal">None</span>)
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"text"</span>: resp.choices[<span class="hljs-number">0</span>].message.content,
        <span class="hljs-string">"latency_ms"</span>: latency_ms,
        <span class="hljs-string">"usage"</span>: usage.model_dump() <span class="hljs-keyword">if</span> usage <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>,
    }
</code></pre>
<blockquote>
<p>è¯´æ˜ï¼šå¦‚æœä½ ç”¨çš„æ˜¯æŸ OpenAI å…¼å®¹å…¥å£ï¼ˆä¾‹å¦‚å¤§æ¨¡å‹èšåˆå¹³å°<a href="https://link.juejin.cn?target=https%3A%2F%2F147ai.com%2F%3Futm_source%3Djuejin%26utm_medium%3Dcontent%26utm_campaign%3Dllm_daily%26utm_content%3Dday00_getting-started" target="_blank" title="https://147ai.com/?utm_source=juejin&amp;utm_medium=content&amp;utm_campaign=llm_daily&amp;utm_content=day00_getting-started" ref="nofollow noopener noreferrer"> 147ai</a>ï¼‰ï¼Œå¤šæ•°æ—¶å€™åªæ”¹ï¼š<br/>
<code>base_url=https://147ai.com/v1</code>ï¼Œç«¯ç‚¹ <code>POST /v1/chat/completions</code>ï¼Œé‰´æƒ <code>Authorization: Bearer &lt;KEY&gt;</code>ï¼ˆä»¥æ§åˆ¶å°/æ–‡æ¡£ä¸ºå‡†ï¼‰ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">3ï¼‰LLM-as-judgeï¼ˆrubric + JSON æ ¡éªŒï¼‰</h2>
<p>è¯„æµ‹å‘˜å¿…é¡»è¢«â€œå¡æ­»è¾“å‡ºæ ¼å¼â€ï¼Œå¦åˆ™æ— æ³•è‡ªåŠ¨åŒ–ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># judge.py</span>
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> run_eval <span class="hljs-keyword">import</span> call_llm

RUBRIC = <span class="hljs-string">"""ä½ æ˜¯è¯„æµ‹å‘˜ã€‚å¯¹ç­”æ¡ˆæŒ‰è§„åˆ™è¾“å‡º JSONï¼ˆä¸è¦è¾“å‡ºå¤šä½™æ–‡æœ¬ï¼‰ï¼š
{
  "keypoint_covered": 0,
  "keypoint_total": 0,
  "critical_error": false,
  "rationale": "ä¸€å¥è¯è§£é‡Š"
}
åˆ¤å®šè¯´æ˜ï¼š
1) keypoint_coveredï¼šç­”æ¡ˆè¦†ç›–äº†å¤šå°‘ gold_keypointsï¼ˆåªè¦è¡¨è¾¾åŒä¹‰å³å¯ç®—è¦†ç›–ï¼‰
2) critical_errorï¼šå‡ºç°ä¸¥é‡äº‹å®é”™è¯¯/è¯¯å¯¼å†³ç­–åˆ™ä¸º true
åªå…è®¸è¾“å‡º JSONã€‚"""</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">robust_json_parse</span>(<span class="hljs-params">s: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    <span class="hljs-comment"># æœ€å°å®ç°ï¼šæŠ“ç¬¬ä¸€ä¸ª {...}ï¼›ç”Ÿäº§å»ºè®®åšæ›´ä¸¥æ ¼çš„ JSON schema æ ¡éªŒ</span>
    l = s.find(<span class="hljs-string">"{"</span>)
    r = s.rfind(<span class="hljs-string">"}"</span>)
    <span class="hljs-keyword">if</span> l == -<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> r == -<span class="hljs-number">1</span> <span class="hljs-keyword">or</span> r &lt;= l:
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"no json object"</span>)
    <span class="hljs-keyword">return</span> json.loads(s[l:r+<span class="hljs-number">1</span>])

<span class="hljs-keyword">def</span> <span class="hljs-title function_">judge</span>(<span class="hljs-params">base_url: <span class="hljs-built_in">str</span>, api_key: <span class="hljs-built_in">str</span>, judge_model: <span class="hljs-built_in">str</span>, question: <span class="hljs-built_in">str</span>, answer: <span class="hljs-built_in">str</span>, gold_keypoints: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-built_in">dict</span>:
    messages = [
        {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: RUBRIC},
        {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: json.dumps({
            <span class="hljs-string">"question"</span>: question,
            <span class="hljs-string">"answer"</span>: answer,
            <span class="hljs-string">"gold_keypoints"</span>: gold_keypoints
        }, ensure_ascii=<span class="hljs-literal">False</span>)}
    ]
    out = call_llm(base_url, api_key, judge_model, messages)
    parsed = robust_json_parse(out[<span class="hljs-string">"text"</span>])
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"parsed"</span>: parsed,
        <span class="hljs-string">"raw"</span>: out[<span class="hljs-string">"text"</span>],
        <span class="hljs-string">"latency_ms"</span>: out[<span class="hljs-string">"latency_ms"</span>],
        <span class="hljs-string">"usage"</span>: out[<span class="hljs-string">"usage"</span>],
    }
</code></pre>
<hr/>
<h2 data-id="heading-4">4ï¼‰è·‘å›å½’ï¼ševal.jsonl â†’ results.jsonl</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># run_eval.py (continued)</span>
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> judge <span class="hljs-keyword">import</span> judge

<span class="hljs-keyword">def</span> <span class="hljs-title function_">run_eval</span>(<span class="hljs-params">eval_path: <span class="hljs-built_in">str</span>, out_path: <span class="hljs-built_in">str</span>, base_url: <span class="hljs-built_in">str</span>, api_key: <span class="hljs-built_in">str</span>, model_under_test: <span class="hljs-built_in">str</span>, judge_model: <span class="hljs-built_in">str</span></span>):
    rows = [json.loads(l) <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(eval_path, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>)]
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(out_path, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> rows:
            q = r[<span class="hljs-string">"question"</span>]
            msgs = [
                {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"ä½ æ˜¯ä¸¥è°¨çš„æŠ€æœ¯åŠ©æ‰‹ã€‚è¯·æŒ‰è¦ç‚¹å›ç­”ã€‚"</span>},
                {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: q},
            ]
            ans = call_llm(base_url, api_key, model_under_test, msgs)
            j = judge(base_url, api_key, judge_model, q, ans[<span class="hljs-string">"text"</span>], r.get(<span class="hljs-string">"gold_keypoints"</span>, []))
            f.write(json.dumps({
                <span class="hljs-string">"id"</span>: r.get(<span class="hljs-string">"id"</span>),
                <span class="hljs-string">"type"</span>: r.get(<span class="hljs-string">"type"</span>),
                <span class="hljs-string">"answer"</span>: ans,
                <span class="hljs-string">"judge"</span>: j,
            }, ensure_ascii=<span class="hljs-literal">False</span>) + <span class="hljs-string">"\n"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-5">5ï¼‰èšåˆæŒ‡æ ‡ï¼šæŠŠç»“æœå˜æˆâ€œèƒ½é—¨ç¦çš„æ•°å­—â€</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># aggregate.py</span>
<span class="hljs-keyword">import</span> json

<span class="hljs-keyword">def</span> <span class="hljs-title function_">agg</span>(<span class="hljs-params">path: <span class="hljs-built_in">str</span></span>):
    rows = [json.loads(l) <span class="hljs-keyword">for</span> l <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>)]
    n = <span class="hljs-built_in">len</span>(rows)
    covered = <span class="hljs-number">0</span>
    total = <span class="hljs-number">0</span>
    critical_err = <span class="hljs-number">0</span>
    p95 = <span class="hljs-number">0</span>
    latencies = []
    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> rows:
        j = r[<span class="hljs-string">"judge"</span>][<span class="hljs-string">"parsed"</span>]
        covered += <span class="hljs-built_in">int</span>(j.get(<span class="hljs-string">"keypoint_covered"</span>, <span class="hljs-number">0</span>))
        total += <span class="hljs-built_in">int</span>(j.get(<span class="hljs-string">"keypoint_total"</span>, <span class="hljs-number">0</span>))
        critical_err += <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> j.get(<span class="hljs-string">"critical_error"</span>) <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>
        latencies.append(<span class="hljs-built_in">int</span>(r[<span class="hljs-string">"answer"</span>].get(<span class="hljs-string">"latency_ms"</span>, <span class="hljs-number">0</span>)))
    latencies.sort()
    <span class="hljs-keyword">if</span> latencies:
        p95 = latencies[<span class="hljs-built_in">int</span>(<span class="hljs-number">0.95</span> * (<span class="hljs-built_in">len</span>(latencies) - <span class="hljs-number">1</span>))]
    <span class="hljs-built_in">print</span>({
        <span class="hljs-string">"n"</span>: n,
        <span class="hljs-string">"keypoint_coverage"</span>: (covered / total) <span class="hljs-keyword">if</span> total <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>,
        <span class="hljs-string">"critical_error_rate"</span>: (critical_err / n) <span class="hljs-keyword">if</span> n <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>,
        <span class="hljs-string">"latency_p95_ms"</span>: p95,
    })

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    agg(<span class="hljs-string">"results.jsonl"</span>)
</code></pre>
<blockquote>
<p>é—¨ç¦å»ºè®®ï¼šä¼˜å…ˆç”¨ <code>critical_error_rate</code> ä½œä¸ºç¡¬é—¨ç¦ï¼Œå…¶æ¬¡çœ‹è¦†ç›–ç‡ä¸ P95 å»¶è¿Ÿ/æˆæœ¬ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">6ï¼‰çº¿ä¸ŠæŒ‡æ ‡ï¼ˆæœ€å°å­—æ®µé›†ï¼‰</h2>
<p>ç¦»çº¿èƒ½å‘Šè¯‰ä½ â€œè´¨é‡æœ‰æ²¡æœ‰é€€åŒ–â€ï¼Œçº¿ä¸Šè¦å‘Šè¯‰ä½ â€œä¸ºä»€ä¹ˆé€€åŒ–â€ï¼š</p>
<ul>
<li><strong>ç‰ˆæœ¬å­—æ®µ</strong>ï¼š<code>model</code>ã€<code>model_version</code>ã€<code>prompt_version</code>ã€<code>retrieval_onoff</code></li>
<li><strong>ä½“éªŒ/æˆæœ¬</strong>ï¼š<code>latency_ms(P50/P95)</code>ã€<code>input_tokens/output_tokens/total_tokens</code></li>
<li><strong>ç¨³å®šæ€§</strong>ï¼š<code>error_code</code>ã€<code>retry_count</code>ã€<code>fallback</code></li>
<li><strong>RAG/å·¥å…·</strong>ï¼š<code>retrieval_k</code>ã€ï¼ˆå¦‚æœ‰ï¼‰<code>hit@k</code>ã€<code>tool_calls</code>ã€<code>tool_success</code></li>
</ul>
<hr/>
<h2 data-id="heading-7">7ï¼‰å‘å¸ƒé—¨ç¦ï¼ˆç¦»çº¿ + ç°åº¦ + å›æ»šï¼‰</h2>
<p>å¯æ‰§è¡Œæ¨¡æ¿ï¼š</p>
<ol>
<li>ç¦»çº¿å›å½’ï¼šä¸¥é‡é”™è¯¯ç‡ä¸å‡é«˜ã€è¦†ç›–ç‡ä¸ä¸‹é™ã€token/P95 ä¸è¶…é¢„ç®—</li>
<li>ç°åº¦ï¼š1%â†’5%â†’20%ï¼Œç›‘æ§å¼‚å¸¸å‘Šè­¦</li>
<li>å›æ»šï¼šèƒ½ä¸€é”®å›æ»š <code>model / prompt_version / retrieval_onoff</code></li>
</ol>
<hr/>
<p>å¦‚æœä½ è¦æŠŠè¿™ä¸€å¥—è¿›ä¸€æ­¥å·¥ç¨‹åŒ–ï¼Œæˆ‘å»ºè®®ä¸‹ä¸€æ­¥åšï¼š</p>
<ul>
<li>æŠŠç»“æœè½åˆ°æ•°æ®åº“ï¼ˆæ”¯æŒæŒ‰ç‰ˆæœ¬å¯¹æ¯”ï¼‰</li>
<li>å¯¹ judge è¾“å‡ºåš schema æ ¡éªŒ + é‡è¯• + æŠ½æ£€</li>
<li>å¼•å…¥ RAG ä¸“å±æŒ‡æ ‡ï¼šhit@k / cite_accï¼ˆå…ˆè¯„æ£€ç´¢å†è¯„ç”Ÿæˆï¼‰</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å†³æˆ˜ç´«ç¦ä¹‹å·…ï¼šOpencode vs Claude Codeï¼Œè°æ‰æ˜¯ä½ çš„çœŸÂ·èµ›åšä¹‰çˆ¶ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592683699772194826</link>    <guid>https://juejin.cn/post/7592683699772194826</guid>    <pubDate>2026-01-08T07:35:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592683699772194826" data-draft-id="7592816646869270537" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å†³æˆ˜ç´«ç¦ä¹‹å·…ï¼šOpencode vs Claude Codeï¼Œè°æ‰æ˜¯ä½ çš„çœŸÂ·èµ›åšä¹‰çˆ¶ï¼Ÿ"/> <meta itemprop="keywords" content="Claude,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-08T07:35:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°ç™½ç‚¹point"/> <meta itemprop="url" content="https://juejin.cn/user/4353721774639118"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å†³æˆ˜ç´«ç¦ä¹‹å·…ï¼šOpencode vs Claude Codeï¼Œè°æ‰æ˜¯ä½ çš„çœŸÂ·èµ›åšä¹‰çˆ¶ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4353721774639118/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°ç™½ç‚¹point
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:35:11.000Z" title="Thu Jan 08 2026 07:35:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ç°åœ¨çš„ä»£ç åœˆå­ï¼Œä½ è¦æ˜¯æ²¡ä¸ª AI Agent å¸®ä½ å†™ä»£ç ï¼Œå‡ºé—¨éƒ½ä¸å¥½æ„æ€è·Ÿäººæ‰“æ‹›å‘¼ã€‚</p>
<p>ä»Šå¤©å’±ä»¬ä¸æ•´é‚£äº›è™šå¤´å·´è„‘çš„å‚æ•°å¯¹æ¯”ï¼Œç›´æ¥ä¸Šç¡¬èœã€‚ä¸€è¾¹æ˜¯ä¸»æ‰“â€œè‡ªç”±ã€å¼€æºã€å¯ç©æ€§æé«˜â€çš„ <strong>Opencode</strong> é˜µè¥ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ç°åœ¨è¿™å·è§’è‰²çš„ä»£è¡¨ï¼‰ï¼Œå¦ä¸€è¾¹æ˜¯å«ç€é‡‘æ±¤åŒ™å‡ºç”Ÿã€ä¼˜é›…ä¸æ»‘ä½†ç•¥æ˜¾å°é—­çš„ <strong>Claude Code</strong>ã€‚</p>
<p>åˆ°åº•è°èƒ½å¸®ä½ æ—©ç‚¹ä¸‹ç­ï¼Œè°åˆä¼šè®©ä½ åŠå¤œåœ¨å±å¹•å‰â€œçº¢æ¸©â€ï¼Ÿå’±ä»¬æ¥ç›˜ä¸€ç›˜ã€‚</p>
<h2 data-id="heading-0">Round 1ï¼šè„‘å­å¥½ä½¿ç¨‹åº¦ï¼ˆæ¨¡å‹ç¡¬å®åŠ›ï¼‰</h2>
<p><strong>Claude Code</strong>
è¿™ç©æ„å„¿èƒŒåä¸»è¦è·‘çš„æ˜¯ <code>Claude 3.5 Sonnet</code>ã€‚è¯´å®è¯ï¼Œè¿™æ³¢ Sonnet æ˜¯åœ¨å¤§æ°”å±‚çš„ã€‚å®ƒçš„é€»è¾‘æ¨ç†èƒ½åŠ›ã€å¯¹å¤æ‚ä¸Šä¸‹æ–‡çš„ç†è§£ï¼Œç›®å‰ç¡®å®æ˜¯ T0 çº§åˆ«çš„ã€‚</p>
<ul>
<li><strong>é«˜å…‰æ—¶åˆ»</strong>ï¼šä½ æŠŠä¸€å¨å‡ åä¸ªæ–‡ä»¶çš„å±å±±æ‰”ç»™å®ƒï¼Œè¯´â€œå¸®æˆ‘é‡æ„ä¸€ä¸‹ Auth æ¨¡å—ï¼Œé¡ºä¾¿æŠŠé‚£ä¸ªè¯¥æ­»çš„ Race Condition ä¿®äº†â€ï¼Œå®ƒä¸ä»…èƒ½ä¿®å¥½ï¼Œè¿˜èƒ½ç»™ä½ å†™æ¸…æ¥šé‡æ„æ€è·¯ï¼Œç”šè‡³è´´å¿ƒåœ°è¡¥ä¸Šæµ‹è¯•ç”¨ä¾‹ã€‚</li>
<li><strong>ç”¨æˆ·å¿ƒå£°</strong>ï¼šâ€œè™½ç„¶æœ‰ç‚¹è´µï¼Œä½†å®ƒæ˜¯çœŸæ‡‚æˆ‘ã€‚â€</li>
</ul>
<p><strong>Opencode</strong>
Opencode ä¸»æ‰“ä¸€ä¸ªâ€œä¸°ä¿­ç”±äººâ€ã€‚ä½ å¯ä»¥æ¥ Claudeï¼Œä¹Ÿå¯ä»¥æ¥ GPT-4oï¼Œç”šè‡³å¯ä»¥æ¥æœ€è¿‘ç«å‡ºåœˆçš„ <strong>DeepSeek-V3</strong> æˆ–è€…æœ¬åœ°è·‘ä¸ª Llama 3ã€‚</p>
<ul>
<li><strong>é«˜å…‰æ—¶åˆ»</strong>ï¼šå½“ä½ æ¢ä¸Š DeepSeek æˆ–è€… o1 æ¨¡å‹æ¥è§£å†³ç®—æ³•é¢˜æ—¶ï¼ŒOpencode çš„è¡¨ç°å®Œå…¨ä¸è¾“å®˜æ–¹å·¥å…·ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œä½ å¯ä»¥é’ˆå¯¹ç‰¹å®šä»»åŠ¡åˆ‡æ¢æ¨¡å‹ï¼Œæ¯”å¦‚å†™æ–‡æ¡£ç”¨ä¾¿å®œçš„æ¨¡å‹ï¼Œä¿® Bug ç”¨æœ€è´µçš„æ¨¡å‹ã€‚</li>
<li><strong>ç”¨æˆ·å¿ƒå£°</strong>ï¼šâ€œæˆ‘å‘½ç”±æˆ‘ä¸ç”±å¤©ï¼Œæˆ‘çš„ Token æˆ‘åšä¸»ã€‚â€</li>
</ul>
<h2 data-id="heading-1">Round 2ï¼šé’±åŒ…çš„åšåº¦ï¼ˆæˆæœ¬ä¸éšç§ï¼‰</h2>
<p><strong>Claude Code</strong>
é‚£æ˜¯çœŸçš„æœ‰ç‚¹â€œåºŸé’±åŒ…â€ã€‚å®ƒæ˜¯æŒ‰ Token è®¡è´¹çš„ï¼Œè€Œä¸”å®˜æ–¹å·¥å…·å¾€å¾€ä¼šæœ‰å¾ˆå¤šéšå¼çš„ Context æ³¨å…¥ï¼ˆä¸ºäº†ä¿æŒå¥½ç”¨çš„ä½“éªŒï¼‰ï¼Œå¯¼è‡´ Token ç‡ƒçƒ§é€Ÿåº¦å ªæ¯”ç¾è‚¡ç†”æ–­ã€‚</p>
<ul>
<li><strong>æ§½ç‚¹</strong>ï¼šæœ‰æ—¶å€™ä½ åªæ˜¯æƒ³æ”¹ä¸ªå˜é‡åï¼Œå®ƒæŠŠæ•´ä¸ªæ–‡ä»¶ä¸Šä¸‹æ–‡éƒ½è¯»äº†ä¸€éï¼Œé‚£ä¸€ç¬é—´å¿ƒéƒ½åœ¨æ»´è¡€ã€‚</li>
</ul>
<p><strong>Opencode</strong>
è¿™æ˜¯ Opencode çš„ä¸»åœºã€‚</p>
<ol>
<li><strong>çœé’±</strong>ï¼šä½ å¯ä»¥æ¥ DeepSeek è¿™ç§â€œä»·æ ¼å± å¤«â€APIï¼Œæˆæœ¬å‡ ä¹å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</li>
<li><strong>éšç§</strong>ï¼šå¯¹äºä¿å¯†é¡¹ç›®ï¼Œä½ å¯ä»¥ç›´æ¥è¿æœ¬åœ°çš„ Ollamaï¼Œç½‘çº¿ä¸€æ‹”ï¼Œè€æ¿å†ä¹Ÿä¸ç”¨æ‹…å¿ƒä»£ç æ³„éœ²ç»™ç¾å›½äººäº†ã€‚</li>
</ol>
<h2 data-id="heading-2">Round 3ï¼šç¿»è½¦ç°åœºå®å½•ï¼ˆçœŸå®æ¡ˆä¾‹ï¼‰</h2>
<p>è¿™é‡Œé‡ç‚¹è®²è®²ï¼Œå› ä¸ºè¿™æ‰æ˜¯å’±ä»¬é€‰å‹çš„å…³é”®ã€‚</p>
<h3 data-id="heading-3">ğŸš¨ Claude Code çš„â€œç¿»è½¦â€ï¼šè¿‡åº¦è‡ªä¿¡çš„ä¼˜é›…</h3>
<p><strong>åœºæ™¯</strong>ï¼š
è®©ä½ å†™ä¸€ä¸ªç®€å•çš„ Python è„šæœ¬ï¼Œå»æŠ“å–æŸä¸ªç½‘é¡µçš„æ ‡é¢˜ã€‚</p>
<p><strong>Claude Code çš„æ“ä½œ</strong>ï¼š
å®ƒå¯èƒ½ä¼šç»™ä½ æ•´å‡ºä¸€å¥—å¾®æœåŠ¡æ¶æ„ã€‚</p>
<blockquote>
<p>â€œäº²ï¼Œä¸ºäº†ä¿è¯å¯æ‰©å±•æ€§ï¼Œæˆ‘ä¸ºæ‚¨å¼•å…¥äº† <code>Scrapy</code> æ¡†æ¶ï¼Œé…ç½®äº† <code>Redis</code> åšå»é‡é˜Ÿåˆ—ï¼Œè¿˜åŠ äº† <code>Docker-compose</code> æ–‡ä»¶å“¦ï¼â€</p>
</blockquote>
<p><strong>åæœ</strong>ï¼š
æœ¬æ¥ 5 è¡Œ <code>requests</code> + <code>BeautifulSoup</code> èƒ½æå®šçš„äº‹ï¼Œç°åœ¨ä½ å¾—èŠ±åŠå°æ—¶å»é…ç¯å¢ƒã€‚è¿™å°±æ˜¯å…¸å‹çš„ <strong>â€œå¤§ç‚®æ‰“èšŠå­ï¼ŒæŠŠèšŠå­ç‚¸æ²¡äº†ï¼Œæˆ¿å­ä¹Ÿå¡Œäº†â€</strong>ã€‚</p>
<h3 data-id="heading-4">ğŸš¨ Opencode çš„â€œç¿»è½¦â€ï¼šé…ç½®åœ°ç‹±ä¸ä¸Šä¸‹æ–‡ä¸¢å¤±</h3>
<p><strong>åœºæ™¯</strong>ï¼š
ä½ æ­£åœ¨åšä¸€ä¸ªå¤æ‚çš„å…¨æ ˆéœ€æ±‚ï¼Œæ¶‰åŠåˆ°å‰ç«¯ React å’Œåç«¯ Node.js çš„è”åŠ¨ã€‚</p>
<p><strong>Opencode çš„æ“ä½œ</strong>ï¼š
ç”±äº Opencode éœ€è¦ä½ è‡ªå·±ç®¡ç†å¾ˆå¤šå·¥å…·é“¾æˆ–è€… Prompt ç­–ç•¥ã€‚</p>
<blockquote>
<p>ä½ ï¼šæŠŠè¿™ä¸ª API çš„è¿”å›å€¼æ”¹ä¸€ä¸‹ã€‚
Opencode (é…åˆæŸä¸ªä¾¿å®œæ¨¡å‹)ï¼šå¥½çš„ã€‚ï¼ˆæ”¹äº†åç«¯ï¼‰
ä½ ï¼šå‰ç«¯æ€ä¹ˆæŠ¥é”™äº†ï¼Ÿ
Opencodeï¼šå“å‘€ï¼Œæˆ‘å¿˜äº†å‰ç«¯ä¹Ÿè¦æ”¹ç±»å‹å®šä¹‰äº†ã€‚ï¼ˆæ”¹äº†å‰ç«¯ï¼‰
ä½ ï¼šæ•°æ®åº“æ€ä¹ˆè¿ä¸ä¸Šäº†ï¼Ÿ
Opencodeï¼šåäº†ï¼Œåˆšæ‰æŠŠ <code>.env</code> æ–‡ä»¶å½“æˆæ™®é€šæ–‡æœ¬é‡å†™äº†...</p>
</blockquote>
<p><strong>åæœ</strong>ï¼š
è¿™å°±æ˜¯ä¼ è¯´ä¸­çš„ <strong>â€œæ‹†ä¸œå¢™è¡¥è¥¿å¢™ï¼Œæœ€åå¢™å…¨å€’äº†â€</strong>ã€‚å°¤å…¶æ˜¯åœ¨å¤„ç†è¶…é•¿ä¸Šä¸‹æ–‡æ—¶ï¼Œå¦‚æœé…ç½®ä¸å½“ï¼ˆæ¯”å¦‚æ²¡ç”¨å¥½å‘é‡æ•°æ®åº“æˆ– Context å‹ç¼©ï¼‰ï¼ŒOpencode å¾ˆå®¹æ˜“å˜æˆâ€œé‡‘é±¼è®°å¿†â€ã€‚</p>
<h2 data-id="heading-5">æ·±åº¦å®ä¾‹ï¼šå½“ä½ è¦ä¿®ä¸€ä¸ªé™ˆå¹´ Bug</h2>
<p><strong>Claude Code ä½“éªŒ</strong>ï¼š
ä½ è¾“å…¥ <code>/fix è¿™ä¸ªé¡µé¢åŠ è½½æ…¢</code>ã€‚
å®ƒä¼šè‡ªåŠ¨åˆ†æç½‘ç»œè¯·æ±‚ï¼ŒæŸ¥é˜…ä»£ç ï¼Œå¯èƒ½ä¼šè¯´ï¼šâ€œæˆ‘çœ‹äº†ä¸€ä¸‹ï¼Œä½ åœ¨å¾ªç¯é‡Œåšäº† SQL æŸ¥è¯¢ï¼ˆN+1 é—®é¢˜ï¼‰ï¼Œæˆ‘å¸®ä½ æ”¹æˆ <code>Promise.all</code> å¹¶è¡Œè¯·æ±‚äº†ï¼Œé¡ºä¾¿åŠ äº†ç¼“å­˜ã€‚â€
ğŸ‘‰ <strong>è¯„ä»·</strong>ï¼šåƒä¸ªè¿™å°±èŒ 3 å¹´çš„é«˜çº§å·¥ç¨‹å¸ˆï¼Œçœå¿ƒã€‚</p>
<p><strong>Opencode ä½“éªŒ</strong>ï¼š
ä½ éœ€è¦æ›´å…·ä½“çš„æŒ‡ä»¤ã€‚
ä½ å¯èƒ½å¾—å…ˆç”¨ <code>grep</code> å·¥å…·æœä¸€ä¸‹ä»£ç ï¼Œç„¶åæŠŠç›¸å…³æ–‡ä»¶å–‚ç»™å®ƒï¼Œè¯´ï¼šâ€œåˆ†æè¿™å‡ ä¸ªæ–‡ä»¶é‡Œçš„æ€§èƒ½ç“¶é¢ˆâ€ã€‚
å¦‚æœä½ æ¥çš„æ˜¯æœ¬åœ°å°æ¨¡å‹ï¼Œå®ƒå¯èƒ½ä¼šä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“ï¼šâ€œå»ºè®®ä½ æŠŠ CPU æ¢æˆ i9ã€‚â€
ä½†å¦‚æœä½ è°ƒæ•™å¾—å¥½ï¼Œç»™å®ƒé…ä¸Šäº†æœ€å¼ºçš„ API å’Œå‡†ç¡®çš„ Promptï¼Œå®ƒèƒ½é€šè¿‡æ‰§è¡Œ Shell è„šæœ¬å¸®ä½ æ’æŸ¥å‡ºè¿ Claude éƒ½ä¸ä¸€å®šèƒ½å‘ç°çš„ç¯å¢ƒå˜é‡é—®é¢˜ã€‚
ğŸ‘‰ <strong>è¯„ä»·</strong>ï¼šåƒä¸ªæå®¢æ‰‹ä¸­çš„ç‘å£«å†›åˆ€ï¼Œå¼ºä¸å¼ºå…¨çœ‹ä½ ä¼šä¸ä¼šç”¨ã€‚</p>
<h2 data-id="heading-6">ç»“è®ºï¼šæ€ä¹ˆé€‰ï¼Ÿ</h2>

























<table><thead><tr><th align="left">ä½ çš„å±æ€§</th><th align="left">æ¨èé€‰æ‹©</th><th align="left">ç†ç”±</th></tr></thead><tbody><tr><td align="left"><strong>ä¸å·®é’±ã€èµ¶æ—¶é—´ã€è¿½æ±‚æè‡´ä½“éªŒ</strong></td><td align="left"><strong>Claude Code</strong></td><td align="left">ä¹Ÿå°±æ˜¯æ¯ä¸ªæœˆå°‘å–å‡ æ¯æ˜Ÿå·´å…‹çš„äº‹ï¼Œä¹°çš„æ˜¯å¿ƒæƒ…èˆ’ç•…ã€‚</td></tr><tr><td align="left"><strong>çˆ±æŠ˜è…¾ã€Geek ç²¾ç¥ã€æ•°æ®æ•æ„Ÿ</strong></td><td align="left"><strong>Opencode</strong></td><td align="left">ä½ çš„å·¥ä½œæµä½ åšä¸»ï¼Œè¿˜èƒ½æ¥æœ¬åœ°æ¨¡å‹é˜²èº«ã€‚</td></tr><tr><td align="left"><strong>ç©·é¬¼ (æ¯”å¦‚æˆ‘)</strong></td><td align="left"><strong>Opencode + DeepSeek</strong></td><td align="left">è¿™ä¸€ç‚¹ä¹Ÿä¸ä¸¢äººï¼Œè¿™å«â€œé™æœ¬å¢æ•ˆâ€ (å®é™…å¯èƒ½æ˜¯é™æœ¬å¢ç¬‘ï¼Œçœ‹ä½ æ“ä½œäº†)ã€‚</td></tr></tbody></table>
<p><strong>æœ€åç»™ä¸ªå¿ å‘Š</strong>ï¼š
æ— è®ºä½ é€‰è°ï¼Œ<strong>Git Commit ä¹‹å‰ä¸€å®šè¦äººå·¥ Review ä¸€éï¼ä¸€å®šè¦ Reviewï¼</strong>
åˆ«é—®æˆ‘ä¸ºä»€ä¹ˆï¼Œæˆ‘ä¸æƒ³å›å¿†ä¸Šæ¬¡ AI å¸®æˆ‘æŠŠ <code>rm -rf ./temp</code> ä¼˜åŒ–æˆ <code>rm -rf /</code> çš„é‚£ä¸ªä¸‹åˆã€‚é‚£ç”»é¢å¤ªç¾ï¼Œæˆ‘ä¸æ•¢çœ‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä» LangChain å’Œ Manus ä¸¤å·¨å¤´ä¸Šä¸‹æ–‡å·¥ç¨‹å®æˆ˜ä¸­å­¦åˆ°çš„ 5 ç‚¹ç»éªŒ]]></title>    <link>https://juejin.cn/post/7592816646869778441</link>    <guid>https://juejin.cn/post/7592816646869778441</guid>    <pubDate>2026-01-08T08:35:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592816646869778441" data-draft-id="7592710766010204170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä» LangChain å’Œ Manus ä¸¤å·¨å¤´ä¸Šä¸‹æ–‡å·¥ç¨‹å®æˆ˜ä¸­å­¦åˆ°çš„ 5 ç‚¹ç»éªŒ"/> <meta itemprop="keywords" content="Agent"/> <meta itemprop="datePublished" content="2026-01-08T08:35:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ½˜é”¦"/> <meta itemprop="url" content="https://juejin.cn/user/730549110707431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä» LangChain å’Œ Manus ä¸¤å·¨å¤´ä¸Šä¸‹æ–‡å·¥ç¨‹å®æˆ˜ä¸­å­¦åˆ°çš„ 5 ç‚¹ç»éªŒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/730549110707431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ½˜é”¦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:35:10.000Z" title="Thu Jan 08 2026 08:35:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘ä»”ç»†çœ‹äº† LangChain çš„ Lance å’Œ Manus çš„ Pete çš„è§†é¢‘ï¼Œä¸»é¢˜æ˜¯æ„å»º AI æ™ºèƒ½ä½“ä¸­çš„ä¸Šä¸‹æ–‡å·¥ç¨‹ã€‚è¿™æ¬¡åˆ†äº«æ²¡æœ‰é‚£äº›ç©ºæ³›çš„ç†è®ºï¼Œå…¨æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­éªŒè¯è¿‡çš„å®æˆ˜ç»éªŒã€‚</p>
<p>æˆ‘ç»“åˆè‡ªå·±çš„æ€è€ƒï¼Œæ•´ç†äº†æˆ‘è®¤ä¸º 5 ä¸ªæœ€æœ‰ä»·å€¼çš„æŠ€æœ¯è¦ç‚¹ï¼Œæ¯ä¸€ä¸ªéƒ½ç›´æ¥å½±å“ç€æ™ºèƒ½ä½“çš„æ€§èƒ½å’Œå¯ç”¨æ€§ã€‚</p>
<h2 data-id="heading-0">1. ä¸Šä¸‹æ–‡çˆ†ç‚¸æ˜¯æ™ºèƒ½ä½“æœ€å¤§çš„ç“¶é¢ˆ</h2>
<p>Manus ç»Ÿè®¡æ˜¾ç¤ºï¼Œä¸€ä¸ªå…¸å‹çš„æ™ºèƒ½ä½“ä»»åŠ¡éœ€è¦çº¦ 50 æ¬¡å·¥å…·è°ƒç”¨ã€‚Anthropic ä¹Ÿæåˆ°ï¼Œç”Ÿäº§ç¯å¢ƒä¸­çš„æ™ºèƒ½ä½“å¯¹è¯å¯èƒ½æŒç»­æ•°ç™¾è½®ã€‚æ¯æ¬¡å·¥å…·è°ƒç”¨éƒ½ä¼šè¿”å›ç»“æœï¼Œè¿™äº›ç»“æœä¼šä¸æ–­ç´¯ç§¯åœ¨æ¶ˆæ¯å†å²ä¸­ã€‚</p>
<p>é—®é¢˜åœ¨äºï¼Œéšç€ä¸Šä¸‹æ–‡é•¿åº¦å¢åŠ ï¼Œæ¨¡å‹æ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ã€‚Anthropic æŠŠè¿™ä¸ªç°è±¡ç§°ä¸º"ä¸Šä¸‹æ–‡è…çƒ‚"ï¼ˆcontext rotï¼‰ã€‚å…·ä½“è¡¨ç°æ˜¯æ¨¡å‹å¼€å§‹é‡å¤è¾“å‡ºã€æ¨ç†é€Ÿåº¦å˜æ…¢ã€å›ç­”è´¨é‡ä¸‹é™ã€‚å¤§éƒ¨åˆ†æ¨¡å‹åœ¨ 200k Token å·¦å³å°±å¼€å§‹å‡ºç°è¿™äº›é—®é¢˜ï¼Œè¿œä½äºå®ƒä»¬å®£ç§°çš„ä¸Šé™ã€‚</p>
<p>è¿™å°±å½¢æˆäº†ä¸€ä¸ªçŸ›ç›¾ï¼šæ™ºèƒ½ä½“éœ€è¦å¤§é‡ä¸Šä¸‹æ–‡æ¥ä¿æŒå·¥ä½œçŠ¶æ€çš„è¿ç»­æ€§ï¼Œä½†ä¸Šä¸‹æ–‡å¤ªé•¿åˆä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚è¿™æ˜¯æ‰€æœ‰å¼€å‘æ™ºèƒ½ä½“çš„å›¢é˜Ÿéƒ½ä¼šé‡åˆ°çš„æ ¸å¿ƒæŒ‘æˆ˜ã€‚</p>
<p>Lance åœ¨åˆ†äº«ä¸­å±•ç¤ºäº†ä»–ä»¬ Open Deep Research é¡¹ç›®çš„æ•°æ®ã€‚è¿™ä¸ªå¼€æºé¡¹ç›®åœ¨ Deep Research Bench æµ‹è¯•ä¸­æ’åå‰åï¼Œä½†å³ä½¿æ˜¯è¿™æ ·ä¼˜ç§€çš„å®ç°ï¼Œä¹Ÿéœ€è¦åœ¨ä¸‰ä¸ªé˜¶æ®µä¸­ä¸æ–­åœ°å¸è½½å’Œå‹ç¼©ä¸Šä¸‹æ–‡æ‰èƒ½ä¿æŒé«˜æ•ˆè¿è¡Œã€‚</p>
<p>Pete åˆ™åˆ†äº«äº† Manus çš„ç»éªŒã€‚ä»–ä»¬å‘ç°ï¼Œå¦‚æœä¸åšä»»ä½•ä¼˜åŒ–ï¼Œä¸Šä¸‹æ–‡ä¼šåœ¨å‡ åè½®å¯¹è¯åå°±è¾¾åˆ°æ¨¡å‹çš„å¤„ç†æé™ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œç”¨æˆ·å¾€å¾€åœ¨è¿™æ—¶æ‰å¼€å§‹è¿›å…¥ä»»åŠ¡çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚</p>
<p>è§£å†³è¿™ä¸ªé—®é¢˜æ²¡æœ‰æ·å¾„ï¼Œå¿…é¡»ä»æ¶æ„è®¾è®¡å¼€å§‹å°±è€ƒè™‘ä¸Šä¸‹æ–‡ç®¡ç†ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ"ä¸Šä¸‹æ–‡å·¥ç¨‹"è¿™ä¸ªæ¦‚å¿µåœ¨ä»Šå¹´ 5 æœˆå¼€å§‹è¿…é€Ÿæµè¡Œçš„åŸå› ã€‚å®ƒä¸æ˜¯å¯é€‰çš„ä¼˜åŒ–é¡¹ï¼Œè€Œæ˜¯æ„å»ºç”Ÿäº§çº§æ™ºèƒ½ä½“çš„å¿…è¦æ¡ä»¶ã€‚</p>
<h2 data-id="heading-1">2. ä¸Šä¸‹æ–‡å·¥ç¨‹çš„äº”å¤§ç»„æˆéƒ¨åˆ†</h2>
<p>Lance å’Œ Pete åœ¨åˆ†äº«ä¸­ç³»ç»Ÿåœ°æ€»ç»“äº†ä¸Šä¸‹æ–‡å·¥ç¨‹çš„äº”ä¸ªæ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼Œè¿™äº›éƒ¨åˆ†ç›¸äº’å…³è”ï¼Œå½¢æˆäº†ä¸€ä¸ªå®Œæ•´çš„æŠ€æœ¯ä½“ç³»ã€‚</p>
<p>ä¸Šä¸‹æ–‡å¸è½½ æ˜¯æŠŠéƒ¨åˆ†ä¿¡æ¯ç§»å‡ºä¸»æ¶ˆæ¯å†å²ï¼Œå­˜å‚¨åˆ°å¤–éƒ¨ç³»ç»Ÿä¸­ã€‚æœ€å¸¸è§çš„æ˜¯ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿã€‚å½“æœç´¢å·¥å…·è¿”å›å¤§é‡ç»“æœæ—¶ï¼Œä¸æ˜¯æŠŠå®Œæ•´å†…å®¹æ”¾åœ¨æ¶ˆæ¯é˜Ÿåˆ—é‡Œï¼Œè€Œæ˜¯å†™å…¥æ–‡ä»¶ï¼Œåªåœ¨ä¸Šä¸‹æ–‡ä¸­ä¿ç•™æ–‡ä»¶è·¯å¾„ã€‚Claude Codeã€Manusã€Open Deep Research é¡¹ç›®éƒ½å¤§é‡ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚</p>
<p>ä¸Šä¸‹æ–‡ç¼©å‡ åŒ…æ‹¬å‹ç¼©å’Œæ‘˜è¦ä¸¤ç§ç­–ç•¥ã€‚å‹ç¼©æ˜¯å»æ‰å¯ä»¥ä»å¤–éƒ¨é‡å»ºçš„ä¿¡æ¯ï¼Œæ‘˜è¦æ˜¯å¯¹ä¿¡æ¯è¿›è¡Œä¸å¯é€†çš„ç²¾ç®€ã€‚Claude 3.5 Sonnet å·²ç»å†…ç½®äº†ä¿®å‰ªæ—§å·¥å…·è°ƒç”¨çš„åŠŸèƒ½ã€‚Cognition åœ¨æ™ºèƒ½ä½“äº¤æ¥æ—¶ä¹Ÿä¼šè§¦å‘æ‘˜è¦ã€‚</p>
<p>ä¸Šä¸‹æ–‡æ£€ç´¢ è§£å†³å¦‚ä½•æŒ‰éœ€è·å–è¢«å¸è½½çš„ä¿¡æ¯ã€‚æœ‰ä¸¤æ´¾åšæ³•ï¼šCursor ä½¿ç”¨ç´¢å¼•åŠ è¯­ä¹‰æœç´¢ï¼ŒClaude Code å’Œ Manus åªç”¨æ–‡ä»¶ç³»ç»ŸåŠ  grepã€glob è¿™æ ·çš„ç®€å•å·¥å…·ã€‚ä¸¤ç§æ–¹æ³•å„æœ‰ä¼˜åŠ£ï¼Œé€‰æ‹©å“ªç§å–å†³äºå…·ä½“åœºæ™¯ã€‚</p>
<p>ä¸Šä¸‹æ–‡éš”ç¦» é€šè¿‡å¤šæ™ºèƒ½ä½“æ¶æ„å®ç°å…³æ³¨ç‚¹åˆ†ç¦»ã€‚æ¯ä¸ªå­æ™ºèƒ½ä½“æœ‰è‡ªå·±çš„ä¸Šä¸‹æ–‡çª—å£ï¼Œé¿å…ä¿¡æ¯æ··æ‚ã€‚Manus çš„ Wide Agentsã€LangChain çš„ Deep Agentsã€Claude çš„å¤šæ™ºèƒ½ä½“ç ”ç©¶å‘˜éƒ½é‡‡ç”¨äº†è¿™ç§è®¾è®¡ã€‚</p>
<p>ä¸Šä¸‹æ–‡ç¼“å­˜ åˆ©ç”¨ KV ç¼“å­˜ç­‰æœºåˆ¶å‡å°‘é‡å¤è®¡ç®—ã€‚Anthropic ç­‰æœåŠ¡å•†æä¾›çš„ç¼“å­˜åŠŸèƒ½å¯¹é•¿ä¸Šä¸‹æ–‡æ™ºèƒ½ä½“è‡³å…³é‡è¦ï¼Œç‰¹åˆ«æ˜¯åœ¨è¾“å…¥è¿œé•¿äºè¾“å‡ºçš„åœºæ™¯ä¸‹ã€‚</p>
<p>è¿™äº”ä¸ªéƒ¨åˆ†ä¸æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œæ˜¯ç›¸äº’å½±å“çš„ç³»ç»Ÿã€‚å¸è½½å’Œæ£€ç´¢è®©ç¼©å‡æ›´é«˜æ•ˆï¼Œç¨³å®šçš„æ£€ç´¢è®©éš”ç¦»å˜å¾—å®‰å…¨ã€‚ä½†éš”ç¦»ä¼šå‡æ…¢ä¸Šä¸‹æ–‡ä¼ é€’ï¼Œé™ä½ç¼©å‡é¢‘ç‡ã€‚æ›´å¤šçš„éš”ç¦»å’Œç¼©å‡åˆä¼šå½±å“ç¼“å­˜æ•ˆç‡ã€‚</p>
<p>Pete ç‰¹åˆ«å¼ºè°ƒï¼Œè¿™ç§ç›¸äº’ä¾èµ–æ„å‘³ç€ä½ ä¸èƒ½åªä¼˜åŒ–æŸä¸€ä¸ªæ–¹é¢ï¼Œå¿…é¡»ä»æ•´ä½“è€ƒè™‘ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ çš„æ£€ç´¢æœºåˆ¶ä¸å¤Ÿç¨³å®šï¼Œå°±ä¸èƒ½æ¿€è¿›åœ°è¿›è¡Œä¸Šä¸‹æ–‡éš”ç¦»ï¼Œå¦åˆ™å­æ™ºèƒ½ä½“å¯èƒ½æ— æ³•è·å–å¿…è¦çš„ä¿¡æ¯ã€‚</p>
<h2 data-id="heading-2">3. ä¸Šä¸‹æ–‡ç®¡ç†å’Œæ•°æ®åº“ç³»ç»Ÿçš„å¯¹æ¯”</h2>
<p>åœ¨åˆ†äº«ä¸­æˆ‘ä¸ªäººçš„æ„Ÿè§‰æ˜¯ä¸Šä¸‹æ–‡å·¥ç¨‹çš„è®¾è®¡å’Œæ•°æ®åº“ç³»ç»Ÿè®¾è®¡æœ‰æ¯”è¾ƒå¤šçš„ç›¸ä¼¼æ€§ã€‚</p>
<p>ä¸Šä¸‹æ–‡å¸è½½å’Œæ•°æ®åº“ç´¢å¼•æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä½†å®ƒä»¬çš„è®¾è®¡ç›®æ ‡å’Œå®ç°æœºåˆ¶å­˜åœ¨æœ¬è´¨å·®å¼‚ã€‚</p>
<p>å±•å¼€æ¥è®²ï¼šç›¸ä¼¼æ€§æ˜¯éƒ½æ˜¯ä¸ºäº†è§£å†³å®¹é‡ä¸æ€§èƒ½çš„çŸ›ç›¾</p>
<p>æ•°æ®åº“ç´¢å¼•è§£å†³çš„æ˜¯ã€Œå¦‚ä½•åœ¨æµ·é‡æ•°æ®ä¸­å¿«é€Ÿå®šä½ã€çš„é—®é¢˜ï¼Œè€Œä¸Šä¸‹æ–‡å¸è½½è§£å†³çš„æ˜¯ã€Œå¦‚ä½•åœ¨æœ‰é™çª—å£ä¸­è®¿é—®æ— é™ä¿¡æ¯ã€çš„é—®é¢˜ã€‚ä¸¤è€…éƒ½æ˜¯é€šè¿‡å»ºç«‹æŸç§é—´æ¥å¼•ç”¨æœºåˆ¶ï¼Œè®©ç³»ç»Ÿèƒ½å¤Ÿå¤„ç†è¶…å‡ºç›´æ¥å¤„ç†èƒ½åŠ›çš„æ•°æ®é‡ã€‚</p>
<p>æ•°æ®åº“æœ‰å†…å­˜ä¸­çš„ç´¢å¼•é¡µã€ç£ç›˜ä¸Šçš„ç´¢å¼•æ–‡ä»¶ã€ä»¥åŠå®é™…çš„æ•°æ®é¡µã€‚ä¸Šä¸‹æ–‡å·¥ç¨‹ä¹Ÿæœ‰ç±»ä¼¼çš„å±‚æ¬¡ï¼šæ´»è·ƒä¸Šä¸‹æ–‡ï¼ˆç›¸å½“äºå†…å­˜ä¸­çš„çƒ­æ•°æ®ï¼‰ã€æ–‡ä»¶è·¯å¾„å¼•ç”¨ï¼ˆç›¸å½“äºç´¢å¼•ï¼‰ã€æ–‡ä»¶ç³»ç»Ÿä¸­çš„å®Œæ•´å†…å®¹ï¼ˆç›¸å½“äºç£ç›˜æ•°æ®ï¼‰ã€‚</p>
<p>æ•°æ®åº“ç´¢å¼•é’ˆå¯¹ä¸åŒçš„æŸ¥è¯¢æ¨¡å¼æœ‰ä¸åŒç±»å‹ï¼šB æ ‘ç´¢å¼•é€‚åˆèŒƒå›´æŸ¥è¯¢ï¼Œå“ˆå¸Œç´¢å¼•é€‚åˆç­‰å€¼æŸ¥è¯¢ï¼Œå…¨æ–‡ç´¢å¼•é€‚åˆæ–‡æœ¬æœç´¢ã€‚ä¸Šä¸‹æ–‡å¸è½½ä¹Ÿæœ‰ç±»ä¼¼çš„åˆ†ç±»ï¼šä»£ç æ–‡ä»¶ç”¨è·¯å¾„ç´¢å¼•ï¼Œæœç´¢ç»“æœç”¨è¯­ä¹‰å‘é‡ç´¢å¼•ï¼Œå¯¹è¯å†å²ç”¨æ—¶é—´æˆ³ç´¢å¼•ã€‚</p>
<p>æ•°æ®åº“çš„ buffer pool ä¼šç¼“å­˜é¢‘ç¹è®¿é—®çš„ç´¢å¼•é¡µå’Œæ•°æ®é¡µã€‚ä¸Šä¸‹æ–‡å·¥ç¨‹ä¸­çš„ KV ç¼“å­˜ä¹Ÿä¼šä¿ç•™é¢‘ç¹å¼•ç”¨çš„ä¸Šä¸‹æ–‡ç‰‡æ®µã€‚ä¸¤è€…éƒ½ä½¿ç”¨ LRU æˆ–ç±»ä¼¼ç®—æ³•å†³å®šæ·˜æ±°ç­–ç•¥ã€‚</p>
<p>å…³é”®å·®å¼‚ï¼šç´¢å¼•æ˜¯æŸ¥è¯¢ä¼˜åŒ–ï¼Œå¸è½½æ˜¯å®¹é‡ç®¡ç†</p>
<p>æ•°æ®åº“ç´¢å¼•çš„ä¸»è¦ç›®æ ‡æ˜¯åŠ é€ŸæŸ¥è¯¢ï¼Œå³ä½¿æ²¡æœ‰ç´¢å¼•ï¼Œå…¨è¡¨æ‰«æä¹Ÿèƒ½å¾—åˆ°ç»“æœï¼Œåªæ˜¯æ…¢ä¸€äº›ã€‚è€Œä¸Šä¸‹æ–‡å¸è½½æ˜¯ä¸ºäº†çªç ´ç¡¬æ€§é™åˆ¶ï¼Œæ²¡æœ‰å¸è½½æœºåˆ¶ï¼Œè¶…å‡ºçª—å£çš„ä¿¡æ¯å°±å®Œå…¨æ— æ³•è®¿é—®ã€‚è¿™æ˜¯ã€Œä¼˜åŒ–ã€ä¸ã€Œå¿…éœ€ã€çš„åŒºåˆ«ã€‚</p>
<p>æ•°æ®åº“ç´¢å¼•æ˜¯å†—ä½™ä¿¡æ¯ï¼Œåˆ é™¤ç´¢å¼•ä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œåªä¼šå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚ä½†ä¸Šä¸‹æ–‡å¸è½½ä¸­ï¼Œå¦‚æœæ–‡ä»¶ç³»ç»Ÿä¸­çš„å†…å®¹ä¸¢å¤±ï¼Œè€Œä¸Šä¸‹æ–‡ä¸­åªæœ‰è·¯å¾„å¼•ç”¨ï¼Œä¿¡æ¯å°±æ°¸ä¹…ä¸¢å¤±äº†ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Pete å¼ºè°ƒå¸è½½å¿…é¡»é…åˆå¯é çš„æ£€ç´¢æœºåˆ¶ã€‚</p>
<p>æ•°æ®åº“ç´¢å¼•éœ€è¦éšæ•°æ®æ›´æ–°è€Œç»´æŠ¤ï¼Œè¿™æ˜¯ ACID äº‹åŠ¡çš„ä¸€éƒ¨åˆ†ã€‚è€Œä¸Šä¸‹æ–‡å¸è½½é€šå¸¸æ˜¯å•å‘çš„ï¼šä¿¡æ¯ä»ä¸Šä¸‹æ–‡ç§»åˆ°å¤–éƒ¨å­˜å‚¨ï¼Œå¾ˆå°‘éœ€è¦åå‘æ›´æ–°ã€‚å³ä½¿æ–‡ä»¶å†…å®¹è¢«ä¿®æ”¹ï¼Œä¸Šä¸‹æ–‡ä¸­çš„å¼•ç”¨é€šå¸¸ä¿æŒä¸å˜ã€‚</p>
<p>æ•°æ®åº“å¯ä»¥é€‰æ‹©æ€§åœ°ä¸ºæŸäº›åˆ—å»ºç«‹ç´¢å¼•ï¼ŒåŸºäºæŸ¥è¯¢æ¨¡å¼å’Œæ•°æ®åˆ†å¸ƒåšå†³ç­–ã€‚è€Œä¸Šä¸‹æ–‡å¸è½½å¾€å¾€æ˜¯å¼ºåˆ¶çš„ï¼šå½“æ¥è¿‘ Token é™åˆ¶æ—¶ï¼Œå¿…é¡»å¸è½½æŸäº›å†…å®¹ï¼Œæ²¡æœ‰"ä¸å»ºç´¢å¼•"çš„é€‰é¡¹ã€‚</p>
<p>å°±åƒæ•°æ®åº“æœ‰å†…å­˜ã€ç£ç›˜ã€ç¼“å­˜çš„å±‚æ¬¡ç»“æ„ï¼Œä¸Šä¸‹æ–‡å·¥ç¨‹ä¹Ÿæœ‰ç±»ä¼¼çš„åˆ†å±‚ï¼šæ´»è·ƒä¸Šä¸‹æ–‡ï¼ˆå†…å­˜ï¼‰ã€æ–‡ä»¶ç³»ç»Ÿï¼ˆç£ç›˜ï¼‰ã€KV ç¼“å­˜ï¼ˆç¼“å­˜å±‚ï¼‰ã€‚æ•°æ®åº“çš„æŸ¥è¯¢ä¼˜åŒ–å¯¹åº”ç€ä¸Šä¸‹æ–‡æ£€ç´¢ï¼Œäº‹åŠ¡éš”ç¦»å¯¹åº”ç€æ™ºèƒ½ä½“éš”ç¦»ï¼Œæ•°æ®å‹ç¼©å¯¹åº”ç€ä¸Šä¸‹æ–‡å‹ç¼©ã€‚</p>
<p>Pete æåˆ°çš„"é€šè¿‡é€šä¿¡"å’Œ"é€šè¿‡å…±äº«å†…å­˜"ä¸¤ç§æ¨¡å¼ï¼Œå®é™…ä¸Šå¯¹åº”ç€æ•°æ®åº“ä¸­çš„æ¶ˆæ¯ä¼ é€’å’Œå…±äº«å­˜å‚¨ä¸¤ç§æ¶æ„ã€‚å½“å­æ™ºèƒ½ä½“éœ€è¦å®Œæ•´å†å²è®°å½•æ—¶ï¼Œä½¿ç”¨å…±äº«ä¸Šä¸‹æ–‡æ¨¡å¼ï¼Œè¿™å°±åƒæ•°æ®åº“ä¸­çš„å…±äº«å­˜å‚¨æ¶æ„ã€‚å½“ä»»åŠ¡ç›¸å¯¹ç‹¬ç«‹æ—¶ï¼Œä½¿ç”¨é€šä¿¡æ¨¡å¼ï¼Œç±»ä¼¼äºåˆ†å¸ƒå¼æ•°æ®åº“çš„æ¶ˆæ¯ä¼ é€’ã€‚</p>
<p>æ™ºèƒ½ä½“é—´çš„çŠ¶æ€åŒæ­¥é—®é¢˜ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€è‡´æ€§é—®é¢˜ã€‚</p>
<p>Manus çš„è§£å†³æ–¹æ¡ˆä¹Ÿå€Ÿé‰´äº†æ•°æ®åº“çš„è®¾è®¡æ€æƒ³ã€‚ä»–ä»¬ä½¿ç”¨ç»“æ„åŒ–çš„æ¨¡å¼ï¼ˆschemaï¼‰æ¥å®šä¹‰æ™ºèƒ½ä½“é—´çš„é€šä¿¡æ¥å£ï¼Œç¡®ä¿æ•°æ®çš„ä¸€è‡´æ€§ã€‚ä»–ä»¬çš„åˆ†å±‚è¡Œä¸ºç©ºé—´è®¾è®¡ï¼ˆå‡½æ•°è°ƒç”¨ã€æ²™ç›’å·¥å…·ã€è½¯ä»¶åŒ…ä¸APIï¼‰ç±»ä¼¼äºæ•°æ®åº“çš„å­˜å‚¨å¼•æ“åˆ†å±‚ã€‚</p>
<p>è¿™ç§ç±»æ¯”ä¸ä»…ä»…æ˜¯ç†è®ºä¸Šçš„ç›¸ä¼¼ã€‚åœ¨å®è·µä¸­ï¼Œä½ å¯ä»¥ç›´æ¥åº”ç”¨æ•°æ®åº“ç³»ç»Ÿçš„å¾ˆå¤šä¼˜åŒ–æŠ€æœ¯ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨ LRU ç­–ç•¥å†³å®šå“ªäº›ä¸Šä¸‹æ–‡åº”è¯¥è¢«å‹ç¼©æˆ–æ‘˜è¦ï¼›ä½¿ç”¨é¢„å†™æ—¥å¿—ï¼ˆWALï¼‰çš„æ€æƒ³ï¼Œåœ¨æ‘˜è¦å‰å…ˆæŠŠå®Œæ•´ä¸Šä¸‹æ–‡å†™å…¥æ—¥å¿—æ–‡ä»¶ï¼›ä½¿ç”¨ç´¢å¼•æ¥åŠ é€Ÿæ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¿¡æ¯æ£€ç´¢ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å€Ÿé‰´æ•°æ®åº“é¢†åŸŸå‡ åå¹´çš„ç ”ç©¶æˆæœå’Œå·¥ç¨‹å®è·µï¼Œè€Œä¸æ˜¯ä»é›¶å¼€å§‹æ‘¸ç´¢ã€‚</p>
<h2 data-id="heading-3">3. ä¸Šä¸‹æ–‡å·¥ç¨‹çš„æ ¸å¿ƒæ˜¯åšå‡æ³•ï¼Œè€Œä¸æ˜¯åŠ æ³•</h2>
<p>Pete åœ¨åˆ†äº«æœ€åå¼ºè°ƒçš„è¿™ä¸€ç‚¹å¯èƒ½æ˜¯æœ€é‡è¦çš„ï¼šé¿å…ä¸Šä¸‹æ–‡è¿‡åº¦å·¥ç¨‹ï¼ˆcontext over-engineeringï¼‰ã€‚</p>
<p>ä»–æåˆ°ï¼ŒManus ä¸Šçº¿å…­ä¸ƒä¸ªæœˆä»¥æ¥ï¼Œæœ€å¤§çš„æ€§èƒ½æå‡ä¸æ˜¯æ¥è‡ªå¢åŠ æ›´å¤æ‚çš„ä¸Šä¸‹æ–‡ç®¡ç†æœºåˆ¶ï¼Œè€Œæ˜¯æ¥è‡ªç®€åŒ–æ¶æ„ã€ç§»é™¤ä¸å¿…è¦çš„åŠŸèƒ½ã€å¯¹æ¨¡å‹ç»™äºˆæ›´å¤šä¿¡ä»»ã€‚ä»–ä»¬å·²ç»é‡æ„äº† Manus äº”æ¬¡ï¼Œæ¯æ¬¡éƒ½æ˜¯åœ¨åšå‡æ³•ã€‚</p>
<p>æ¯”å¦‚ï¼Œæ—©æœŸçš„ Manus ä½¿ç”¨ todo.md æ–‡ä»¶æ¥ç®¡ç†ä»»åŠ¡åˆ—è¡¨ï¼Œç»“æœå‘ç°çº¦ä¸‰åˆ†ä¹‹ä¸€çš„æ“ä½œéƒ½åœ¨æ›´æ–°è¿™ä¸ªåˆ—è¡¨ï¼Œæµªè´¹äº†å¤§é‡ Tokenã€‚åæ¥ä»–ä»¬æ”¹ç”¨æ›´ç®€å•çš„ç»“æ„åŒ–è§„åˆ’å™¨ï¼Œæ•ˆæœåè€Œæ›´å¥½ã€‚</p>
<p>å¦ä¸€ä¸ªä¾‹å­æ˜¯å·¥å…·é€‰æ‹©ã€‚ä»–ä»¬æ²¡æœ‰ä½¿ç”¨å¤æ‚çš„è¯­ä¹‰æœç´¢æ¥åŠ¨æ€åŠ è½½å·¥å…·ï¼Œè€Œæ˜¯å›ºå®šä½¿ç”¨ 10-20 ä¸ªåŸå­åŠŸèƒ½ï¼Œå…¶ä»–æ‰€æœ‰åŠŸèƒ½éƒ½é€šè¿‡æ²™ç›’ä¸­çš„å‘½ä»¤è¡Œå·¥å…·æˆ– Python è„šæœ¬æ¥å®ç°ã€‚è¿™ç§åˆ†å±‚çš„è¡Œä¸ºç©ºé—´è®¾è®¡ï¼Œè®©ç³»ç»Ÿæ—¢çµæ´»åˆç®€å•ã€‚</p>
<p>Pete è¿˜æåˆ°äº†ä¸€ä¸ªè¯„ä¼°æ¶æ„çš„æ–¹æ³•ï¼šåœ¨å¼ºå¼±æ¨¡å‹ä¹‹é—´åˆ‡æ¢æµ‹è¯•ã€‚å¦‚æœä½ çš„æ¶æ„ä»å¼±æ¨¡å‹åˆ‡æ¢åˆ°å¼ºæ¨¡å‹åèƒ½è·å¾—æ˜æ˜¾æå‡ï¼Œè¯´æ˜æ¶æ„æœ‰è¾ƒå¥½çš„æœªæ¥é€‚åº”æ€§ã€‚å› ä¸ºæ˜å¹´çš„å¼±æ¨¡å‹å¯èƒ½å°±å’Œä»Šå¤©çš„å¼ºæ¨¡å‹ä¸€æ ·å¥½ã€‚</p>
<p>å…³äºæ˜¯å¦è¦è®­ç»ƒä¸“é—¨çš„æ¨¡å‹ï¼ŒPete çš„è§‚ç‚¹ä¹Ÿå¾ˆæ˜ç¡®ï¼šåˆåˆ›å…¬å¸åº”è¯¥å°½å¯èƒ½é•¿æ—¶é—´åœ°ä¾èµ–é€šç”¨æ¨¡å‹å’Œä¸Šä¸‹æ–‡å·¥ç¨‹ã€‚è®­ç»ƒä¸“é—¨æ¨¡å‹ä¸ä»…æˆæœ¬é«˜ï¼Œè€Œä¸”åœ¨äº§å“å¿«é€Ÿè¿­ä»£çš„é˜¶æ®µï¼Œå¾ˆå¯èƒ½åœ¨ä¼˜åŒ–é”™è¯¯çš„æŒ‡æ ‡ã€‚MCPï¼ˆModel Context Protocolï¼‰çš„æ¨å‡ºå°±æ˜¯ä¸ªä¾‹å­ï¼Œå®ƒå½»åº•æ”¹å˜äº† Manus çš„è®¾è®¡ï¼Œå¦‚æœä¹‹å‰æŠ•å…¥å¤§é‡èµ„æºè®­ç»ƒä¸“é—¨æ¨¡å‹ï¼Œè¿™äº›æŠ•å…¥å°±æµªè´¹äº†ã€‚</p>
<p>ä»–ä»¬ç°åœ¨ä¹Ÿä¸ä½¿ç”¨å¼€æºæ¨¡å‹ï¼Œä¸æ˜¯å› ä¸ºè´¨é‡é—®é¢˜ï¼Œè€Œæ˜¯æˆæœ¬é—®é¢˜ã€‚å¯¹äºè¾“å…¥è¿œé•¿äºè¾“å‡ºçš„æ™ºèƒ½ä½“åº”ç”¨ï¼ŒKV ç¼“å­˜è‡³å…³é‡è¦ã€‚å¤§å‹äº‘æœåŠ¡å•†æœ‰æ›´å¥½çš„åˆ†å¸ƒå¼ç¼“å­˜åŸºç¡€è®¾æ–½ï¼Œç®—ä¸‹æ¥ä½¿ç”¨ä»–ä»¬çš„ API åè€Œæ›´ä¾¿å®œã€‚</p>
<p>è¿™äº›ç»éªŒå‘Šè¯‰æˆ‘ä»¬ï¼šä¸Šä¸‹æ–‡å·¥ç¨‹çš„ç›®æ ‡æ˜¯è®©æ¨¡å‹çš„å·¥ä½œå˜å¾—æ›´ç®€å•ï¼Œè€Œä¸æ˜¯æ›´å¤æ‚ã€‚ä¸è¦ä¸ºäº†ä¼˜åŒ–è€Œä¼˜åŒ–ï¼Œæ¯ä¸ªè®¾è®¡å†³ç­–éƒ½è¦åŸºäºå®é™…çš„æ€§èƒ½æ•°æ®å’Œç”¨æˆ·åé¦ˆã€‚</p>
<h2 data-id="heading-4">4. å‹ç¼©ä¸æ‘˜è¦çš„æœ¬è´¨åŒºåˆ«å†³å®šäº†ä½¿ç”¨ç­–ç•¥</h2>
<p>Pete è¯¦ç»†è§£é‡Šäº†å‹ç¼©å’Œæ‘˜è¦è¿™ä¸¤ç§çœ‹ä¼¼ç›¸ä¼¼å®åˆ™æˆªç„¶ä¸åŒçš„ç­–ç•¥ï¼Œè¿™ä¸ªåŒºåˆ†å¯¹å®é™…åº”ç”¨è‡³å…³é‡è¦ã€‚</p>
<p>å‹ç¼©æ˜¯å¯é€†çš„ã€‚åœ¨ Manus ä¸­ï¼Œæ¯ä¸ªå·¥å…·è°ƒç”¨éƒ½æœ‰å®Œæ•´æ ¼å¼å’Œç´§å‡‘æ ¼å¼ã€‚æ¯”å¦‚å†™æ–‡ä»¶æ“ä½œï¼Œå®Œæ•´æ ¼å¼åŒ…å«è·¯å¾„å’Œå†…å®¹ï¼Œç´§å‡‘æ ¼å¼åªä¿ç•™è·¯å¾„ã€‚å› ä¸ºæ–‡ä»¶å·²ç»å­˜åœ¨äºæ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œé€šè¿‡è·¯å¾„å¯ä»¥éšæ—¶æ¢å¤å®Œæ•´ä¿¡æ¯ã€‚è¿™ç§å¯é€†æ€§è‡³å…³é‡è¦ï¼Œå› ä¸ºä½ æ°¸è¿œä¸çŸ¥é“å“ªä¸ªå†å²æ“ä½œä¼šåœ¨åç»­å˜å¾—é‡è¦ã€‚</p>
<p>æ‘˜è¦æ˜¯ä¸å¯é€†çš„ã€‚ä¸€æ—¦æ‰§è¡Œæ‘˜è¦ï¼ŒåŸå§‹ä¿¡æ¯å°±æ°¸ä¹…ä¸¢å¤±äº†ã€‚å› æ­¤å¿…é¡»éå¸¸è°¨æ…ã€‚Manus çš„åšæ³•æ˜¯åœ¨æ‘˜è¦å‰å°†å®Œæ•´ä¸Šä¸‹æ–‡è½¬å‚¨ä¸ºæ—¥å¿—æ–‡ä»¶ï¼Œä½œä¸ºæœ€åçš„ä¿é™©ã€‚è€Œä¸”æ‘˜è¦æ—¶è¦ä¿ç•™æœ€æ–°å‡ æ¬¡å·¥å…·è°ƒç”¨çš„å®Œæ•´ä¿¡æ¯ï¼Œè®©æ¨¡å‹çŸ¥é“å½“å‰çš„å·¥ä½œçŠ¶æ€ã€‚</p>
<p>å…³äºé˜ˆå€¼çš„ç¡®å®šï¼ŒPete åˆ†äº«äº†å…·ä½“æ•°æ®ï¼šå¤§å¤šæ•°æ¨¡å‹åœ¨ 200k Token å·¦å³å¼€å§‹å‡ºç°æ€§èƒ½ä¸‹é™ï¼Œä»–ä»¬å°† 128k-200k è®¾å®šä¸º"è…çƒ‚å‰"é˜ˆå€¼ã€‚è¿™ä¸æ˜¯éšæ„è®¾å®šçš„ï¼Œè€Œæ˜¯é€šè¿‡å¤§é‡è¯„ä¼°å¾—å‡ºçš„ã€‚ä»–ä»¬æµ‹è¯•äº†ä¸åŒé•¿åº¦ä¸‹æ¨¡å‹çš„é‡å¤ç‡ã€æ¨ç†é€Ÿåº¦ã€è¾“å‡ºè´¨é‡ç­‰æŒ‡æ ‡ã€‚</p>
<p>è§¦å‘ç­–ç•¥æ˜¯æ¸è¿›å¼çš„ï¼š</p>
<ul>
<li>æ¥è¿‘ 128k æ—¶ï¼Œå¼€å§‹å‹ç¼©æœ€æ—§çš„ 50% å·¥å…·è°ƒç”¨</li>
<li>å‹ç¼©åæ£€æŸ¥å®é™…é‡Šæ”¾çš„ç©ºé—´</li>
<li>å¦‚æœå‹ç¼©æ•ˆæœä¸æ˜æ˜¾ï¼ˆå› ä¸ºå³ä½¿ç´§å‡‘æ ¼å¼ä¹Ÿå ç”¨ç©ºé—´ï¼‰ï¼Œæ‰è€ƒè™‘æ‘˜è¦</li>
<li>æ‘˜è¦æ—¶ä½¿ç”¨å®Œæ•´ç‰ˆæœ¬è€Œéå‹ç¼©ç‰ˆæœ¬çš„æ•°æ®</li>
<li>å§‹ç»ˆä¿ç•™æœ€æ–°çš„å‡ æ¬¡å®Œæ•´å·¥å…·è°ƒç”¨</li>
</ul>
<p>å°½å¯èƒ½ä¿ç•™ä¿¡æ¯çš„å®Œæ•´æ€§ï¼Œåªåœ¨å¿…è¦æ—¶æ‰æ¥å—ä¿¡æ¯æŸå¤±ã€‚è¿™å°±åƒæ•°æ®å‹ç¼©ç®—æ³•ä¸­çš„æ— æŸå‹ç¼©å’Œæœ‰æŸå‹ç¼©ï¼Œä½ æ€»æ˜¯å…ˆå°è¯•æ— æŸæ–¹æ¡ˆã€‚</p>
<p>ä¸åŒç±»å‹çš„å†…å®¹æœ‰ä¸åŒçš„å‹ç¼©æ½œåŠ›ã€‚æœç´¢ç»“æœã€API å“åº”è¿™ç±»å†…å®¹å‹ç¼©æ•ˆæœå¥½ï¼Œå› ä¸ºå¤§éƒ¨åˆ†ä¿¡æ¯å¯ä»¥é€šè¿‡æŸ¥è¯¢é‡æ–°è·å–ã€‚è€Œç”¨æˆ·çš„æŒ‡ä»¤ã€æ¨¡å‹çš„æ¨ç†è¿‡ç¨‹å‹ç¼©ç©ºé—´æœ‰é™ï¼Œå› ä¸ºè¿™äº›ä¿¡æ¯å¾€å¾€éƒ½æ˜¯å¿…è¦çš„ã€‚</p>
<h2 data-id="heading-5">5. éš”ç¦»ç­–ç•¥çš„é€‰æ‹©å–å†³äºä»»åŠ¡ç‰¹æ€§è€Œéç›´è§‰</h2>
<p>å¤šæ™ºèƒ½ä½“éš”ç¦»æ˜¯ä¸ªè€è¯é¢˜ï¼Œä½† Pete åˆ†äº«çš„ç»éªŒæ¨ç¿»äº†å¾ˆå¤šå¸¸è§åšæ³•ã€‚</p>
<p>é¦–å…ˆæ˜¯åæ¨¡å¼çš„è¯†åˆ«ã€‚å¾ˆå¤šå›¢é˜Ÿå–œæ¬¢æŒ‰äººç±»è§’è‰²åˆ’åˆ†æ™ºèƒ½ä½“ï¼šè®¾è®¡å¸ˆæ™ºèƒ½ä½“ã€ç¨‹åºå‘˜æ™ºèƒ½ä½“ã€ç»ç†æ™ºèƒ½ä½“ç­‰ã€‚Pete æ˜ç¡®æŒ‡å‡ºè¿™æ˜¯ä¸ªé™·é˜±ã€‚è¿™ç§åˆ’åˆ†æºäºäººç±»ç»„ç»‡çš„å±€é™æ€§ï¼ˆä¸ªäººèƒ½åŠ›å’Œæ³¨æ„åŠ›æœ‰é™ï¼‰ï¼Œè€Œä¸æ˜¯ AI ç³»ç»Ÿçš„æœ€ä¼˜è®¾è®¡ã€‚Manus åªæœ‰æå°‘çš„å‡ ä¸ªåŠŸèƒ½æ€§æ™ºèƒ½ä½“ï¼šé€šç”¨æ‰§è¡Œå™¨ã€è§„åˆ’å™¨ã€çŸ¥è¯†ç®¡ç†å™¨ã€‚</p>
<p>å…³äºéš”ç¦»æ¨¡å¼çš„é€‰æ‹©ï¼ŒPete åŒºåˆ†äº†ä¸¤ç§åœºæ™¯ï¼š</p>
<p>é€šä¿¡æ¨¡å¼é€‚åˆç»“æœå¯¼å‘çš„ç‹¬ç«‹ä»»åŠ¡ã€‚ä¸»æ™ºèƒ½ä½“å‘é€æ˜ç¡®æŒ‡ä»¤ï¼Œå­æ™ºèƒ½ä½“ç‹¬ç«‹å®Œæˆï¼Œè¿”å›ç»“æœã€‚æ•´ä¸ªè¿‡ç¨‹ä¸»æ™ºèƒ½ä½“ä¸å…³å¿ƒç»†èŠ‚ï¼Œåªè¦æœ€ç»ˆè¾“å‡ºã€‚æ¯”å¦‚"åœ¨ä»£ç åº“ä¸­æœç´¢ç‰¹å®šå‡½æ•°"ã€"å°†è¿™æ®µæ–‡æœ¬ç¿»è¯‘æˆä¸­æ–‡"ã€‚è¿™ç§æ¨¡å¼çš„ä¼˜åŠ¿æ˜¯ä¸Šä¸‹æ–‡å¹²å‡€ã€æˆæœ¬ä½ã€æ˜“äºè°ƒè¯•ã€‚</p>
<p>å…±äº«ä¸Šä¸‹æ–‡æ¨¡å¼é€‚åˆéœ€è¦å®Œæ•´å†å²ä¿¡æ¯çš„å¤æ‚ä»»åŠ¡ã€‚å­æ™ºèƒ½ä½“èƒ½çœ‹åˆ°æ‰€æœ‰å†å²å¯¹è¯å’Œå·¥å…·è°ƒç”¨ï¼Œä½†æœ‰è‡ªå·±çš„ç³»ç»Ÿæç¤ºå’Œå·¥å…·é›†ã€‚æ¯”å¦‚æ·±åº¦ç ”ç©¶ä»»åŠ¡ï¼Œæœ€ç»ˆæŠ¥å‘Šéœ€è¦å‚è€ƒå¤§é‡ä¸­é—´æœç´¢å’Œç¬”è®°ã€‚è¿™ç§æ¨¡å¼æˆæœ¬é«˜ï¼ˆéœ€è¦é¢„å¡«å……å¤§é‡ä¸Šä¸‹æ–‡ï¼Œæ— æ³•å¤ç”¨ KV ç¼“å­˜ï¼‰ï¼Œä½†å¯¹æŸäº›ä»»åŠ¡æ˜¯å¿…è¦çš„ã€‚</p>
<p>åˆ¤æ–­ä½¿ç”¨å“ªç§æ¨¡å¼çš„å…³é”®æ˜¯ä»ç»“æœæ¨ç†è¿‡ç¨‹çš„ä¾èµ–æ€§ã€‚å¦‚æœæœ€ç»ˆè¾“å‡ºå¼ºä¾èµ–äºä¸­é—´æ­¥éª¤çš„ç»†èŠ‚ï¼Œå°±éœ€è¦å…±äº«ä¸Šä¸‹æ–‡ã€‚å¦‚æœåªéœ€è¦æœ€ç»ˆç»“æœï¼Œé€šä¿¡æ¨¡å¼å°±è¶³å¤Ÿäº†ã€‚</p>
<p>Pete è¿˜æåˆ°äº†ä¸€ä¸ªå®ç”¨æŠ€å·§ï¼š"æ™ºèƒ½ä½“å³å·¥å…·"ï¼ˆagent as toolï¼‰ã€‚ä»ä¸»æ™ºèƒ½ä½“è§†è§’ï¼Œè°ƒç”¨å­æ™ºèƒ½ä½“å°±åƒè°ƒç”¨æ™®é€šå·¥å…·ï¼Œæœ‰æ˜ç¡®çš„è¾“å…¥è¾“å‡ºæ¥å£ã€‚è¿™ç®€åŒ–äº†ç³»ç»Ÿè®¾è®¡ï¼Œä¹Ÿè®©è°ƒè¯•æ›´å®¹æ˜“ã€‚Manus çš„"é«˜çº§æœç´¢"åŠŸèƒ½å°±æ˜¯è¿™æ ·å®ç°çš„ï¼Œè¡¨é¢ä¸Šæ˜¯ä¸ªå·¥å…·ï¼Œå®é™…æ˜¯ä¸ªå®Œæ•´çš„å­æ™ºèƒ½ä½“å·¥ä½œæµã€‚</p>
<p>ä»–ä»¬è§£å†³é€šä¿¡é—®é¢˜çš„æ–¹æ³•æ˜¯å¼ºåˆ¶ä½¿ç”¨ç»“æ„åŒ–è¾“å‡ºã€‚ä¸»æ™ºèƒ½ä½“è°ƒç”¨å­æ™ºèƒ½ä½“å‰å¿…é¡»å®šä¹‰è¾“å‡ºæ¨¡å¼ï¼Œå­æ™ºèƒ½ä½“é€šè¿‡ä¸“é—¨çš„"æäº¤ç»“æœ"å·¥å…·è¿”å›æ•°æ®ï¼Œç³»ç»Ÿç”¨çº¦æŸè§£ç ç¡®ä¿æ ¼å¼æ­£ç¡®ã€‚è¿™é¿å…äº†è‡ªç”±æ ¼å¼é€šä¿¡å¸¦æ¥çš„è§£æé—®é¢˜å’Œä¿¡æ¯ä¸¢å¤±ã€‚</p>
<h2 data-id="heading-6">6. ä¸€äº›é¢å¤–çš„æŠ€æœ¯æ´å¯Ÿ</h2>
<p>é™¤äº†è¿™äº”ä¸ªæ ¸å¿ƒç»éªŒï¼Œè¿˜æœ‰ä¸€äº›å€¼å¾—è®°å½•çš„æŠ€æœ¯ç»†èŠ‚ã€‚</p>
<p>ä¿¡æ¯çš„å±€éƒ¨æ€§ã€‚ä½¿ç”¨åŸºäºè¡Œçš„æ ¼å¼æ„å‘³ç€æ¯è¡Œéƒ½æ˜¯ç‹¬ç«‹çš„ä¿¡æ¯å•å…ƒï¼Œè¯»å–ç¬¬ 100 è¡Œä¸éœ€è¦è§£æå‰ 99 è¡Œã€‚è¿™å¯¹äºå¤§æ–‡ä»¶çš„éšæœºè®¿é—®è‡³å…³é‡è¦ã€‚</p>
<p>ç»“æ„åŒ–ä¸ç­‰äºå¤æ‚æ ¼å¼ã€‚Pete å¼ºè°ƒï¼Œä»–ä»¬ä¼˜å…ˆä½¿ç”¨åŸºäºè¡Œï¼ˆline-basedï¼‰çš„çº¯æ–‡æœ¬æ ¼å¼ï¼Œè€Œä¸æ˜¯ JSON æˆ– XMLã€‚åŸå› å¾ˆç®€å•ï¼šæ¨¡å‹å¯ä»¥ç”¨ grep æœç´¢ç‰¹å®šè¡Œï¼Œç”¨ sed ä¿®æ”¹ç‰¹å®šå†…å®¹ï¼Œç”¨ head/tail è¯»å–éƒ¨åˆ†æ•°æ®ã€‚è¿™äº›éƒ½æ˜¯æ¨¡å‹å·²ç»æŒæ¡çš„åŸºç¡€å·¥å…·ã€‚</p>
<p>å…³äº Markdown çš„ä½¿ç”¨è¦ç‰¹åˆ«è°¨æ…ã€‚è™½ç„¶æ¨¡å‹éƒ½æ¥å—è¿‡ Markdown è®­ç»ƒï¼Œä½†è¿‡åº¦ä½¿ç”¨ä¼šå¸¦æ¥å‰¯ä½œç”¨ã€‚æŸäº›æ¨¡å‹ä¼šå› æ­¤è¾“å‡ºè¿‡å¤šçš„é¡¹ç›®ç¬¦å·å’Œæ ¼å¼åŒ–æ ‡è®°ï¼Œæµªè´¹ Token è¿˜å½±å“å¯è¯»æ€§ã€‚Manus çš„ç»éªŒæ˜¯ï¼šåœ¨éœ€è¦ç»“æ„æ—¶ç”¨ Markdownï¼Œåœ¨å­˜å‚¨æ•°æ®æ—¶ç”¨çº¯æ–‡æœ¬ã€‚</p>
<p>å…³äºæ¨¡å‹åˆ‡æ¢çš„è¯„ä¼°æ–¹æ³•ã€‚Pete æåˆ°ï¼Œä»–ä»¬ä¼šåœ¨å¼ºå¼±æ¨¡å‹é—´åˆ‡æ¢æ¥è¯„ä¼°æ¶æ„çš„æœªæ¥é€‚åº”æ€§ã€‚å¦‚æœä¸€ä¸ªæ¶æ„åœ¨å¼±æ¨¡å‹ä¸Šä¹Ÿèƒ½å·¥ä½œï¼ˆè™½ç„¶æ•ˆæœå·®ä¸€äº›ï¼‰ï¼Œè¯´æ˜å®ƒä¸æ˜¯è¿‡åº¦ä¾èµ–ç‰¹å®šæ¨¡å‹èƒ½åŠ›çš„è„†å¼±è®¾è®¡ã€‚</p>
<p>å…³äºå·¥å…·æ•°é‡çš„ä¸Šé™ï¼Œä»–ä»¬çš„ç»éªŒæ˜¯ä¸è¶…è¿‡ 30 ä¸ªã€‚è¿™ä¸æ˜¯ä»»æ„æ•°å­—ï¼Œè€Œæ˜¯åŸºäºå¤§é‡æµ‹è¯•ã€‚è¶…è¿‡è¿™ä¸ªæ•°é‡ï¼Œæ¨¡å‹å¼€å§‹é¢‘ç¹è°ƒç”¨é”™è¯¯çš„å·¥å…·ï¼Œç”šè‡³è°ƒç”¨ä¸å­˜åœ¨çš„å·¥å…·ã€‚è§£å†³æ–¹æ¡ˆä¸æ˜¯åŠ¨æ€åŠ è½½å·¥å…·ï¼Œè€Œæ˜¯è®¾è®¡åˆ†å±‚çš„è¡Œä¸ºç©ºé—´ï¼šå°‘é‡åŸå­å·¥å…· + æ²™ç›’å‘½ä»¤ + ä»£ç æ‰§è¡Œã€‚</p>
<p>å…³äºè¯„ä¼°ä½“ç³»ï¼ŒManus çš„ä¸‰å±‚è¯„ä¼°å€¼å¾—å€Ÿé‰´ï¼šç”¨æˆ·è¯„åˆ†æ˜¯åŒ—ææ˜ŸæŒ‡æ ‡ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–å¯éªŒè¯çš„ä»»åŠ¡ï¼ŒçœŸäººè¯„ä¼°å¤„ç†ä¸»è§‚æ€§å¼ºçš„è¾“å‡ºã€‚å­¦æœ¯åŸºå‡†æµ‹è¯•åªæ˜¯å‚è€ƒï¼Œä¸èƒ½ä½œä¸ºä¸»è¦ä¾æ®ã€‚</p>
<p>ä¸Šä¸‹æ–‡å·¥ç¨‹ä¸æ˜¯ä¸€äº›é›¶æ•£çš„æŠ€å·§ï¼Œè€Œæ˜¯ä¸€ä¸ªéœ€è¦ç³»ç»Ÿæ€è€ƒçš„å·¥ç¨‹é¢†åŸŸã€‚æ¯ä¸ªè®¾è®¡å†³ç­–éƒ½ä¼šå½±å“åˆ°å…¶ä»–éƒ¨åˆ†ï¼Œæ²¡æœ‰æ”¾ä¹‹å››æµ·è€Œçš†å‡†çš„æœ€ä½³å®è·µï¼Œåªæœ‰åŸºäºå…·ä½“åœºæ™¯çš„æƒè¡¡å–èˆã€‚</p>
<p>ä»¥ä¸Šã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘çš„2025å¹´å¹´ç»ˆæ€»ç»“]]></title>    <link>https://juejin.cn/post/7592816646869811209</link>    <guid>https://juejin.cn/post/7592816646869811209</guid>    <pubDate>2026-01-08T08:39:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592816646869811209" data-draft-id="7592610104441667594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘çš„2025å¹´å¹´ç»ˆæ€»ç»“"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,Java"/> <meta itemprop="datePublished" content="2026-01-08T08:39:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èå­è±è±çˆ±æ‰“æ€ª"/> <meta itemprop="url" content="https://juejin.cn/user/1239904847403927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘çš„2025å¹´å¹´ç»ˆæ€»ç»“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1239904847403927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èå­è±è±çˆ±æ‰“æ€ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:39:28.000Z" title="Thu Jan 08 2026 08:39:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ—¶é—´è¿‡å¾—çœŸå¿«ï¼Œä¸€è½¬çœ¼åŠŸå¤«2025å¹´è¿‡å®Œäº†ï¼Œè¿™é‡Œåšä¸ªå¹´ç»ˆæ€»ç»“ï¼Œè®°å½•è¿™ä¸€å¹´çš„äººå’Œäº‹ã€‚</p>
<p>å›é¡¾è¿™ä¸€å¹´ï¼Œæœ‰æ¿€æµå‹‡è¿›ï¼Œäº¦æœ‰å¹³æ·¡ä¼¼æ°´ã€‚</p>
<blockquote>
<p><strong>æ¿€æµå‹‡è¿›æ—¶ï¼Œæˆ‘åœ¨å¾€é«˜å¤„èµ°ã€‚</strong></p>
<p><strong>å¹³æ·¡ä¼¼æ°´æ—¶ï¼Œæˆ‘åœ¨äº«å—äººé—´æœ€çº¯å‡€çš„çˆ±å’Œå¹¸ç¦ã€‚</strong></p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€å…³äºå·¥ä½œ</h2>
<p>è¿™ä¸€å¹´ï¼Œå·¥ä½œä¸Šæˆ‘æœ‰è¾ƒå¤§çš„æˆå°±æ„Ÿã€‚</p>
<p>å¤§æ¦‚3-4æœˆä»½ï¼Œå› ä¸ºæŸäº›åŸå› ï¼Œå‘ç°æˆ‘ä»¬è´Ÿè´£çš„Aé¡¹ç›®æ€§èƒ½ä¸¥é‡ä¸è¶³ï¼Œå¯¹æˆ‘ä»¬äº§ç”Ÿäº†æå¤§çš„æŒ‘æˆ˜ï¼ˆæœ‰äº§å“ä¸Šçš„ï¼Œæœ‰æ›´å¤§å±‚é¢çš„ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†ï¼Œæ€»ä¹‹è¿™ä¸ªæ€§èƒ½é—®é¢˜éå¸¸ç´§æ€¥ä¸”é‡è¦ï¼‰ï¼Œä¼˜åŒ–çš„ä»»åŠ¡ç»™åˆ°äº†æˆ‘ï¼Œ3-4æœˆä»½æ˜¯ä¸€ç›´é…åˆæµ‹è¯•è¿›è¡Œå‹æµ‹å’Œè°ƒä¼˜ï¼Œä½†æ˜¯æ•ˆæœä¸€ç›´ä¸ç†æƒ³ï¼Œæœ€ç»ˆé¢†å¯¼å±‚å†³å®šæŠ•å…¥äººåŠ›ç‰©åŠ›ï¼Œåœ¨æœ‰é™çš„æ—¶é—´å†…å»è¿›è¡Œä¸€æ³¢å¤§åˆ€é˜”æ–§å¼ä¼˜åŒ–ï¼ˆæ¶æ„è°ƒæ•´å’Œé‡è¦èŠ‚ç‚¹ä»£ç è°ƒæ•´ï¼‰ã€‚è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</p>
<ol>
<li>ã€æ‘¸åº•é˜¶æ®µã€‘å‹æµ‹å¹¶æ‘¸åº•å½“å‰äº§å“æœ€é«˜æ€§èƒ½ï¼ˆ3æœˆä»½ï¼‰</li>
<li>ã€æ–¹æ¡ˆé˜¶æ®µã€‘æ€§èƒ½æ‘¸åº•åï¼Œç´§æ¥ç€å°±æ˜¯çŸ­æ¿åˆ†æï¼Œåœ¨è¿›è¡Œå„ä¸ªåŸå› åˆ†æåï¼Œç”±ç‚¹åˆ°é¢å¼€å±•å…·ä½“çš„æŠ€æœ¯æ–¹æ¡ˆç¼–å†™ï¼Œç„¶åç»Ÿä¸€è¯„ä¼°å¯è¡Œæ€§ï¼Œå¹¶ç»™å‡ºé¢„æœŸä¼˜åŒ–æ•ˆæœã€‚æœ€ç»ˆæ•²å®šè½åœ°æŒ‰æ–¹æ¡ˆæ¨è¿›æ‰§è¡Œã€‚ï¼ˆ4ã€5æœˆä»½ï¼‰</li>
<li>ã€ç ”å‘é˜¶æ®µã€‘ä¼˜åŒ–æ–¹æ¡ˆæœ‰äº†æ¥ä¸‹æ¥å°±æ˜¯å¼€å‘äº†ï¼ŒæŠ•å…¥äº†ä¸€å®šçš„äººåŠ›ï¼Œå¤§çº¦2ä¸ªæœˆçš„æ—¶é—´ï¼Œä¼˜åŒ–ç‰ˆæœ¬å‘ç‰ˆã€‚ï¼ˆ6-7æœˆä»½ï¼‰</li>
<li>ã€æœ€ç»ˆæ•ˆæœã€‘æœ€ç»ˆï¼Œç»è¿‡å…±è®¡4ä¸ªæœˆå¤šçš„æ—¶é—´ï¼Œä¼˜åŒ–ç‰ˆæœ¬é¡ºåˆ©å‘ç‰ˆã€‚ <strong>ï¼ˆæœ€ç»ˆæ€§èƒ½è¶…è¿‡é¢„æœŸä¸”ç¢¾å‹ç«å“ï¼Œä¸è‡ªèº«ç›¸æ¯”æå‡äº†8å€å¤šï¼Œå¤§å¤§å¢åŠ äº†äº§å“ç«äº‰åŠ›ä»¥åŠå®¢æˆ·æ»¡æ„åº¦ï¼‰</strong>ã€‚</li>
</ol>
<p>æœ¬æ¬¡ä¼˜åŒ–æˆ‘ä½œä¸ºæ ¸å¿ƒå‚ä¸è€…å’Œè®¾è®¡è€…ï¼Œè¿™å‡ ä¸ªæœˆå¿ƒæ€ä¸€ç›´åœ¨è¿™ä¸Šè¾¹ã€‚</p>
<blockquote>
<p>å¹³æ—¶ï¼Œåœ°é“ä¸Šæˆ‘å’Œdeepseekè¯·æ•™ï¼Œå¤§åˆ°æ¶æ„ï¼Œå°åˆ°ä»£ç </p>
<p>æœ‰æ—¶ï¼Œæˆ‘ä¼šå› ä¸ºå‡ ä¸ªä¼˜åŒ–æ–¹æ¡ˆå“ªä¸ªæ”¶ç›Šæ›´å¤§è€Œç¿»æ¥è¦†å»ç¡ä¸ç€ç”šè‡³æ¢¦ä¸­éƒ½æ˜¯å·¥ä½œçš„å†…å®¹</p>
<p>æœ‰æ—¶ï¼Œæˆ‘ä¼šå› ä¸ºæƒ³æ–¹æ¡ˆçš„åˆç†æ€§æˆ–æƒ³å‡ºä¸€ä¸ªæ–°æ–¹æ¡ˆè€Œæ—©æ—©é†’æ¥å»ç ”ç©¶æŸ¥èµ„æ–™</p>
<p>æœ‰æ—¶ï¼Œæˆ‘ä¼šå› ä¸ºå‡ è¡Œä»£ç çš„æ€§èƒ½è€Œå†™å¤§é‡çš„ä»£ç æµ‹æ¥æµ‹å»</p>
</blockquote>
<p>é‚£æ®µæ—¶é—´ä¸­åˆåŸºæœ¬ä¸åˆä¼‘ï¼Œä¸‹ç­ä¹Ÿè¾ƒæ™šï¼Œå·¥ä½œæ—¶é—´å°±æ›´åˆ«è¯´äº†ï¼Œæ€»ä¹‹å¤ªå¤šçš„ä¸“æ³¨å’Œå¿ƒæ€éƒ½èŠ±è´¹åœ¨äº†è¿™ä¸ªä¼˜åŒ–ä¸Šè¾¹ï¼Œé‚£æ®µæ—¶é—´å±äºå¿˜æˆ‘æˆ–è€…è¯´åˆ°è¾¾ä¸€å®šå¢ƒç•Œï¼ˆæˆ‘åª³å¦‡æ€»è°ƒä¾ƒæˆ‘ï¼Œè¯´æˆ‘åˆ°è¾¾äº†ï¼š<strong>æ— æˆ‘å¢ƒç•Œ</strong>ï¼‰</p>
<p>æˆ‘è®°å¾—æˆ‘åª³å¦‡é—®è¿‡æˆ‘ï¼šæœ‰å¿…è¦è¿™ä¹ˆæ‹¼å—ï¼Ÿ
æˆ‘çš„å›ç­”æ˜¯ï¼š<strong>æ­¤æ—¶è¿™ç§çŠ¶æ€å·²ç»å’Œå·¥ä½œæ— å…³äº†ï¼Œå°±ç®—ä¸ç»™æˆ‘å·¥èµ„æˆ‘ä¹Ÿä¼šè¿™æ ·ï¼ˆåŸè¯å¤§æ„ï¼‰</strong>ã€‚</p>
<p>æˆ‘çŸ¥é“æ˜¯æˆ‘å†…å¿ƒåœ¨è¾ƒåŠ²ï¼Œåœ¨æ†‹å¾—ä¸€è‚¡åŠ²ï¼Œå°±åƒæˆ‘çš„ç½‘åä¸€æ ·ï¼Œèå­è±è±çˆ±æ‰“æ€ªï¼Œé‚£æ®µæ—¶é—´ï¼Œæœ¬è´¨ä¸Šæ˜¯æˆ‘åœ¨æ‰“æ€ªã€‚ä¸€æ—¦åŠ²å¤´ä¸Šæ¥äº†ï¼Œæ˜¯åœä¸ä¸‹æ¥çš„ã€‚å…¶å®æˆ‘æŒºå–œæ¬¢è¿™ç§æ„Ÿè§‰ï¼Œä¹Ÿéå¸¸äº«å—è¿™ç§æ„Ÿè§‰ã€‚æˆ–è®¸è¿™ä¹Ÿæ˜¯æˆ‘é™¤äº†åƒå–ï¼Œå¥³äººä¹‹å¤–ä¸ºæ•°ä¸å¤šçš„çˆ±å¥½äº†ã€‚</p>
<p>å†™è¿™äº›ä¸æ˜¯æƒ³ç‚«è€€æˆ–è€…æ ‡æ¦œè‡ªå·±ï¼Œåªæ˜¯æŠŠæˆ‘å†…å¿ƒæ„Ÿå—å†™ä¸‹æ¥ï¼Œä»…æ­¤è€Œå·²ã€‚æˆ‘è¿™ç§äººå°±å±äºé‚£ç§ ç‹ èµ·æ¥ä¸é¡¾ä¸€åˆ‡çš„æ€§æ ¼ï¼Œå¶å°”æ‡’æ•£ï¼Œç‹ èµ·æ¥è¿è‡ªå·±éƒ½æ€•çš„é‚£ç§ã€‚</p>
<h2 data-id="heading-1">äºŒã€æŒç»­åšå¼€æº</h2>
<p>é™¤äº†ä¸Šè¿°çš„å·¥ä½œå¤–ã€‚25å¹´æˆ‘æ²¡å¿˜è®°ä¸ªäººçš„æå‡ï¼Œé™¤äº†å·¥ä½œå¯¹ä¸ªäººçš„æå‡å¤–ï¼Œæˆ‘ä¸€ç›´åœ¨åšå¼€æºï¼Œå½“ç„¶å‰åŠå¹´å·¥ä½œå¿™èº«ä½“ç´¯ï¼Œä»£ç åŸºæœ¬æ²¡å’‹å†™ã€‚</p>
<h4 data-id="heading-2">æ£é¼“æœåŠ¡å™¨</h4>
<p>6æœˆä¸­æ—¬å¼€å§‹ï¼Œæˆ‘å°±ä¸šä½™æ—¶é—´å¼€å§‹æ£é¼“æ´‹åƒåœ¾äº†ï¼Œï¼ˆå…¶å®å»å¹´å®‰è£…å¥½å <a href="https://juejin.cn/post/7431543290195869746" target="_blank" title="https://juejin.cn/post/7431543290195869746">ç‚¹è¿™é‡Œçœ‹24å¹´å®‰è£…è®°å½•</a>ï¼Œå‡ ä¸ªè™šæ‹Ÿæœºå’Œç‰©ç†æœºæœ¬æ¥å¯ä»¥ä¸€ç›´ç”¨çš„ï¼Œä½†æ˜¯æ‰‹è´±åœ¨ç‰©ç†æœºä¸Šä½¿ç”¨äº†fioå‘½ä»¤ å¯¼è‡´ç‰©ç†æœºå¼€ä¸äº†æœºäº†kvmè™šæ‹Ÿçš„é‚£äº›è™šæ‹Ÿæœºè‡ªç„¶ä¹Ÿæ²¡å‘ç”¨äº†ï¼Œåœ¨æŸå®æ‰¾äº†ä¸“ä¿®æœåŠ¡å™¨çš„å¤§ä½¬ä¹Ÿæ²¡ç”¨ èŠ±äº†500å¤§æ´‹ä»–æ²¡æŠŠæ¡ æœ€ç»ˆç»™æˆ‘é€€é’±äº†ğŸ˜‚ï¼‰</p>
<p>æ²¡åŠæ³•ï¼Œåªèƒ½é‡è£…äº†ï¼Œå¦å¤–è€ƒè™‘åˆ°æœåŠ¡å™¨è¦é•¿æœŸç”¨ï¼Œå½“å‰å„æ–¹é¢ç¡¬ä»¶éƒ½æ¯”è¾ƒä½é…ï¼Œæ‰€ä»¥æˆ‘æœ‰ä¸€é¡¿ä¹°ä¹°ä¹°ï¼ˆä¸»æ¿ï¼Œæœºç®±ï¼Œå›ºæ€ï¼Œé£æ‰‡ï¼Œå†…å­˜æ¡ï¼‰æ€»æ˜¯å°±å·®E5çš„cpuå’Œé‚£ä¸ªçŸ¿å¡æ²¡æ¢ï¼Œå…¶ä»–çš„éƒ½å‡çº§äº†ã€‚ç¡¬ä»¶å‡†å¤‡å®Œä¹‹åï¼Œæˆ‘å°±å¼€å§‹è£…ç³»ç»Ÿï¼Œè¿™å›å¸å–æ•™è®­ï¼Œä¸ç”¨kvmäº† ç”¨ESXIè£…ï¼åæ¥è¯æ˜æˆ‘æ¢å¯¹äº†ï¼ŒESXIç¨³å®šï¼Œç•Œé¢å‹å¥½ï¼Œå„æ–¹é¢åŠæ‰“KVMï¼Œå“ï¼Œå¥½åæ‚”24å¹´åˆšè£…çš„æ—¶å€™æ²¡ç”¨ESXIã€‚</p>
<p>ä¸‹è¾¹æ˜¯ä¸€äº›è´­ä¹°è®°å½•å’Œå½“å‰æœºå™¨æƒ…å†µï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5db959863c74b4794b927fd4f7bfbdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6J2O5a2Q6I6x6I6x54ix5omT5oCq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768466368&amp;x-signature=B9v%2FtoftKCntsgIfGEulVh0jiFQ%3D" alt="image.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd2e30e357c243eca22627b54a223763~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6J2O5a2Q6I6x6I6x54ix5omT5oCq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768466368&amp;x-signature=nVFY0WUXzoqRzKjOpDXcSCxx5LY%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">åšå¼€æºé¡¹ç›®IM</h4>
<p>åœ¨æ£é¼“å®ŒæœåŠ¡å™¨ä¹‹åï¼Œæˆ‘å°±å¼€å§‹äº†ä»£ç çš„ç¼–å†™ï¼Œè¿™ä¸ªé¡¹ç›®ä½œä¸ºæˆ‘çš„çˆ±å¥½æœ‰æ—¶é—´æˆ‘å°±å»åšï¼Œæœ€è¿‘å‡†å¤‡spingbootå’Œjdkå‡çº§ï¼Œå‡†å¤‡æ¥å…¥AIï¼Œ<strong>åœ¨å½“å‰è¿™ä¸ªæ—¶ä»£ï¼Œå¿…é¡»è¦å’ŒAIæ¥è½¨äº†ï¼Œè¿™æ˜¯æ¯ä¸€ä¸ªç¨‹åºå‘˜çš„å®¿å‘½å’Œä½¿å‘½ã€‚</strong></p>
<p>ä»Šå¹´æŠŠå•èŠåŸºæœ¬åšå®Œäº†ï¼Œæœ€é‡è¦çš„æ˜¯è°ƒæ•´äº†æ¶æ„ï¼Œä½¿ç”¨å’Œhbase hadoop hdfs æ¥å­˜æ¶ˆæ¯æ•°æ®ï¼Œesæ¥æœç´¢ï¼Œgrpcæ›¿æ¢æ‰äº†dubbo protobufæ›¿æ¢æ‰json ç­‰ç­‰è¯¸å¤šä¼˜åŒ–å’Œæ¶æ„è°ƒæ•´ï¼Œæ›´å¤šçš„æ¯”å¦‚åŠŸèƒ½å•¥çš„å°±ä¸ç»†è¯´äº†ï¼Œè¿™é‡Œç»™ä¸€ä¸ªä»£ç æäº¤æƒ…å†µæˆªå›¾ã€‚</p>
<p>æœåŠ¡ç«¯ä»£ç æäº¤æƒ…å†µï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bf374f127bc42c7a753fc19e633a0b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6J2O5a2Q6I6x6I6x54ix5omT5oCq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768466368&amp;x-signature=0vrou1Udk2dzqhGyh7mMUw47C9c%3D" alt="image.png" loading="lazy"/></p>
<p>å®¢æˆ·ç«¯ä»£ç æäº¤æƒ…å†µï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32446984613649bf9c32950aef3e2683~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6J2O5a2Q6I6x6I6x54ix5omT5oCq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768466368&amp;x-signature=dgXR4H3LH7nSaX0U%2Ffvc2czO8wM%3D" alt="image.png" loading="lazy"/></p>
<p>ä»Šå¹´9æœˆä»½æˆ‘è…¾å‡ºæ—¶é—´å®Œå–„äº†ä¸‹è¿™ä¸ªIMé¡¹ç›®çš„readmeå’ŒCONTRIBUTINGï¼Œ ï¼ˆå½“æ—¶è¿˜å†™äº†ç¯‡æ–‡ç« :  <a href="https://juejin.cn/post/7549107076905173028" target="_blank" title="https://juejin.cn/post/7549107076905173028">ğŸš€ğŸš€ğŸš€å—¨ï¼Œä¸€èµ·æ¥å¼€å‘ å¼€æºIMç³»ç»Ÿå‘€ï¼</a>ï¼‰ï¼Œåˆè¡·æ˜¯æƒ³çš„èƒ½æ‰¾åˆ°å¿—åŒé“åˆä¹‹äººï¼Œä½†æ˜¯æœ€ç»ˆæˆ‘å‘ç°ï¼Œå¾ˆéš¾æˆ–è€…è¯´éå¸¸éš¾æ‰¾åˆ°ã€‚æ‰€ä»¥æœ€ç»ˆæˆ‘å†³å®šè‡ªå·±ä¸€ä¸ªç»§ç»­ç»´æŠ¤ï¼Œä¸æ‰¾äº†ã€‚AIå°±æ˜¯æˆ‘æœ€å¤§çš„å¿—åŒé“åˆä¹‹äººã€‚</p>
<p><strong>è¿™æ˜¯æˆ‘çš„å¼€æºé¡¹ç›®åç«¯åœ°å€ï¼Œä¸å«Œçš„è¯ç»™ä¸ªstarç®—æ˜¯å¯¹æˆ‘çš„æ”¯æŒï¼Œï¼ˆé èº¬æ„Ÿè°¢äº†å“ˆå“ˆï¼‰</strong> ï¼š <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F598572%2Fxzll-im-server" target="_blank" title="https://github.com/598572/xzll-im-server" ref="nofollow noopener noreferrer">xzll-im-server</a></p>
<h2 data-id="heading-4">ä¸‰ã€åšå®¢æ–¹é¢</h2>
<p>ä¸ªä¸­ç¼˜ç”±ï¼Œåšå®¢ä»Šå¹´å†™çš„éå¸¸å°‘ï¼Œå°‘çš„å¯æ€œã€‚ã€‚ã€‚å°±æ°´äº†4ç¯‡ã€‚</p>
<p>1ã€<a href="https://juejin.cn/post/7456851920617603107" target="_blank" title="https://juejin.cn/post/7456851920617603107">å¼ƒç”¨èŠ±ç”Ÿå£³ï¼Œæ”¹ç”¨frpå®ç°å†…ç½‘ç©¿é€ï¼Œå¥½è‡ªç”±ï¼</a></p>
<p>2ã€<a href="https://juejin.cn/post/7541239609720848420" target="_blank" title="https://juejin.cn/post/7541239609720848420">Hadoop3.3.5ã€Hbase2.6.1 é›†ç¾¤æ­å»º&amp;Phoenixä½¿ç”¨è®°å½•</a></p>
<p>3ã€<a href="https://juejin.cn/post/7549107076905173028" target="_blank" title="https://juejin.cn/post/7549107076905173028">ğŸš€ğŸš€ğŸš€å—¨ï¼Œä¸€èµ·æ¥å¼€å‘ å¼€æºIMç³»ç»Ÿå‘€ï¼</a></p>
<p>4ã€<a href="https://juejin.cn/post/7574382900860338203" target="_blank" title="https://juejin.cn/post/7574382900860338203">MinIOçš„å®‰è£…è®°å½•</a></p>
<h2 data-id="heading-5">å››ã€AIæ–¹é¢</h2>
<p>æˆ‘ä»Šå¹´7æœˆä»½ä¹Ÿçº ç»“äº†å¾ˆä¹…ï¼Œæ˜¯å…ˆå­¦AIè¿˜æ˜¯å…ˆæå¼€æºï¼Ÿ æœ€ç»ˆæˆ‘é€‰æ‹©äº†å…ˆåšå¼€æºï¼Œç„¶ååœ¨å¼€æºIMåŸºç¡€ä¸ŠæŠŠAIè½åœ°ã€‚ä½†æ˜¯å½“ä¸‹AIçš„é£åˆ®å¾—å¤ªçŒ›çƒˆï¼Œæˆ‘çš„å¼€æºIMåŠŸèƒ½ä¸Šå¯èƒ½å°±å…ˆæ”¾ä¸€æ”¾äº†ï¼Œ<strong>ç›®å‰å½“åŠ¡ä¹‹æ€¥æ˜¯å‡çº§springboot3.x ç„¶åå­¦ä¹ AIï¼Œåº”ç”¨AIåˆ°æˆ‘çš„IMé¡¹ç›®ä¸­å»ï¼Œè¿™æ˜¯æˆ‘å½“ä¸‹çš„è§„åˆ’ã€‚ä¹Ÿæ˜¯æˆ‘26å¹´çš„è§„åˆ’ã€‚</strong></p>
<p>å®é™…ä¸ŠAIçš„è¯¾æˆ‘25å¹´2æœˆä»½å°±èŠ±äº†5kå¤§æ´‹ä¹°äº†ï¼Œè¿™é‡Œä¸ºäº†å¹¿å‘Šå«Œç–‘ä¸è¯´åå­—ï¼Œæ€»æ˜¯å°±æ˜¯xxå…µçš„è¯¾ï¼Œå¦‚æœè¯´25å¹´æ˜¯åœ¨åšå‡†å¤‡ï¼Œé‚£26å¹´æˆ‘å¯èƒ½çœŸè¦å¼€å§‹å­¦äº†å“ˆå“ˆã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2675bdabe81d4555afc217ff38db723e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6J2O5a2Q6I6x6I6x54ix5omT5oCq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768466368&amp;x-signature=7%2FYbr7XUdvgYYyruDMZInWMcNvg%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-6">äº”ã€å…³äºä¸ªäººå’Œå®¶åº­</h2>
<p>å®¶åº­å¹¸ç¦ç¾æ»¡ï¼Œç¥å’± å®¶å’Œä¸‡äº‹å…´ã€‚</p>
ä¸ªäººèº«ä½“å¥åº·ï¼Œæ„¿æˆ‘ ä½“å¥å£®å¦‚ç‰›ã€‚<p/>
<h2 data-id="heading-7">å…­ã€26å¹´è§„åˆ’</h2>
<ol>
<li>æŒç»­å¥åº·å¹¸ç¦</li>
<li>å‡è‚¥</li>
<li>åŠªåŠ›å·¥ä½œæŒ£é’±</li>
<li>æŒç»­åšå¼€æºé¡¹ç›®IM</li>
<li>å­¦ä¹ AI</li>
<li>åº”ç”¨AIåˆ°IMä¸­å»</li>
</ol>
<h2 data-id="heading-8">æœ€å</h2>
<p><strong>æ„¿æ‰€æœ‰çš„ç¨‹åºå‘˜éƒ½æœ‰ä¸ªå¥½èº«ä½“ï¼Œæœ‰ä¸ªå¹¸ç¦çš„å®¶åº­ï¼Œè¿™æ˜¯æœ€çè´µçš„ã€‚å½“ä½ æœ‰è¿™ä¸¤æ ·æ—¶å€™ï¼Œä½ åº”è¯¥åº†å¹¸ï¼Œä½ æ‹¥æœ‰äº†è¿™ä¸–ä¸Šæœ€å®è´µçš„ä¸œè¥¿ï¼</strong></p>
<p>------    èå­è±è± ï¼Œ2026å¹´1æœˆ8æ—¥äºåŒ—äº¬ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[freeswitch-åˆçº§-01-æ—¥å¿—åˆ†å‰²]]></title>    <link>https://juejin.cn/post/7592572266754474047</link>    <guid>https://juejin.cn/post/7592572266754474047</guid>    <pubDate>2026-01-08T08:51:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592572266754474047" data-draft-id="7592805973119942662" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="freeswitch-åˆçº§-01-æ—¥å¿—åˆ†å‰²"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-08T08:51:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ´›ç¥ä¹ˆä¹ˆå“’"/> <meta itemprop="url" content="https://juejin.cn/user/1530137984116158"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            freeswitch-åˆçº§-01-æ—¥å¿—åˆ†å‰²
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1530137984116158/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ´›ç¥ä¹ˆä¹ˆå“’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:51:13.000Z" title="Thu Jan 08 2026 08:51:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1ã€å‰è¨€</h2>
<p>ä½ è¿˜åœ¨ä¸ºfsæ—¥å¿—å¤ªå¤§è€Œçƒ¦æ¼ä¹ˆï¼Œè¿˜åœ¨ä¸ºfsä¸èƒ½æŒ‰å¤©åˆ†å‰²è€Œçƒ¦æ¼ä¹ˆ</p>
<p>åšä¸»ä¹‹å‰ä¸€ç›´ä¸ºå®ƒè€Œå¤´ç–¼</p>
<p>ç»è¿‡è°ƒç ”ï¼Œæ€»ç®—æ˜¯è§£å†³äº†è¿™ä¸ªå¿ƒè…¹å¤§æ‚£</p>
<h2 data-id="heading-1">2ã€æ—¥å¿—åˆ†å‰²æ–¹å¼</h2>
<h3 data-id="heading-2">2.1 mod_logfile</h3>
<p>mod_logfile æ˜¯ fsè‡ªå¸¦æ—¥å¿—ç³»ç»Ÿ</p>
<p>å¯ä»¥é€šè¿‡ ä¸‹é¢å‘½ä»¤è¿›è¡ŒåŠ è½½</p>
<pre><code class="hljs language-bash" lang="bash">./fs_cli -x <span class="hljs-string">"reload mod_logfile"</span>
</code></pre>
<p>ä¸‹é¢æ˜¯ /home/freeswitch/etc/freeswitch/autoload_configs/logfile.conf.xml çš„é»˜è®¤é…ç½®æ–‡ä»¶</p>
<pre><code class="hljs language-log" lang="log">&lt;configuration name="logfile.conf" description="File Logging"&gt;
  &lt;settings&gt;
   &lt;!-- true to auto rotate on HUP, false to open/close --&gt;
   &lt;param name="rotate-on-hup" value="true"/&gt;
  &lt;/settings&gt;
  &lt;profiles&gt;
    &lt;profile name="default"&gt;
      &lt;settings&gt;
        &lt;!-- File to log to --&gt;
        &lt;!--&lt;param name="logfile" value="/var/log/freeswitch.log"/&gt;--&gt;
        &lt;!-- At this length in bytes rotate the log file (0 for never) --&gt;
        &lt;param name="rollover" value="1048576000"/&gt;
                &lt;!-- Maximum number of log files to keep before wrapping --&gt;
                &lt;!-- If this parameter is enabled, the log filenames will not include a date stamp --&gt;
                &lt;param name="maximum-rotate" value="32"/&gt;
        &lt;!-- Prefix all log lines by the session's uuid  --&gt;
        &lt;param name="uuid" value="true" /&gt;
      &lt;/settings&gt;
      &lt;mappings&gt;
        &lt;!-- 
             name can be a file name, function name or 'all' 
             value is one or more of debug,info,notice,warning,err,crit,alert,all
             Please see comments in console.conf.xml for more information
        --&gt;
        &lt;map name="all" value="console,debug,info,notice,warning,err,crit,alert"/&gt;
      &lt;/mappings&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
&lt;/configuration&gt;
</code></pre>
<h4 data-id="heading-3">2.1.1 ç‰¹ç‚¹</h4>
<p>mod_logfile æ”¯æŒæŒ‰ç…§å¤§å°åˆ†å‰²(ä¸æ”¯æŒæŒ‰<code>æ—¶é—´é©±åŠ¨è½®è½¬</code>)ï¼Œåˆ†å‰²çš„æ—¥å¿—é»˜è®¤æ˜¯æŒ‰ç…§æ—¶é—´ç‚¹æ¥å‘½åçš„</p>
<ul>
<li>
<p>éªŒè¯: å¯ä»¥é€šè¿‡ æŠŠ rollover çš„å€¼æ”¹æˆ 5120 ï¼Œç„¶åè½»æ¾å¾—åˆ°æ—¥å¿—åˆ†å‰²æƒ…å†µ</p>
<pre><code class="hljs language-xml" lang="xml"># ä¿®æ”¹äº†ä¸¤ä¸ªé‡è¦å‚æ•°
<span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"rollover"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"5120"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"maximum-rotate"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"3"</span>/&gt;</span>
</code></pre>
<p>ç„¶åæµ‹è¯•å¾—åˆ°ä¸‹é¢çš„æ—¥å¿—æ–‡ä»¶ï¼Œå‘ç°æ²¡æœ‰ä¿ç•™ 3ä¸ªæ—¥å¿—æ–‡ä»¶</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è¿™æ˜¯æˆ‘æœ¬åœ°çš„æ—¥å¿—åˆ†å‰²æƒ…å†µ</span>
-rw-r--r-- 1 root root 1.2K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-17.8
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-17.9
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-18.1
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-18.2
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-18.3
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-25.1
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-25.2
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-25.3
-rw-r--r-- 1 root root 1.1K Jan  8 15:59 freeswitch.log.2026-01-08-15-59-25.4
...
</code></pre>
<p>ä¸€ç•ªè°ƒç ”æ‰çŸ¥é“ï¼Œå¦‚æœæ˜¯ æ»šåŠ¨æŒ‰ç…§ freeswitch.log.1  freeswitch.log.2  freeswitch.log.3 è¿™ç§ï¼Œå®ƒä¸ä¼šç”Ÿæˆ  freeswitch.log.4ï¼Œè¶…è¿‡å›è‡ªåŠ¨è¦†ç›–æœ€æ—©çš„æ–‡ä»¶</p>
</li>
</ul>
<p>æ ¹æ®ä¸Šé¢ç‰¹ç‚¹ï¼Œæˆ‘ä»¬çœ‹èµ·æ¥åšä¸åˆ° æŒ‰å¤©åˆ†å‰²æ—¥å¿—äº†ï¼Œä½†æ˜¯ mod_logfile åˆ‡å‰²æ—¥å¿—é™¤äº†ä¸Šé¢çš„è‡ªåŠ¨è§¦å‘ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æœ‰åŠæ³•å¸®å®ƒè‡ªåŠ¨è§¦å‘ï¼Œæ¯”å¦‚</p>
<ul>
<li>è‡ªåŠ¨é‡å¯fs</li>
<li>æˆ–ç€ä¸é‡å¯fs, åªéœ€è¦å®šæ—¶ å‘é€ä¿¡å·ç»™FreeSWITCHï¼Œè®©å…¶é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶</li>
</ul>
<p>æˆ‘è‡ªå·±å†™äº†cron æµ‹è¯•åï¼Œç¡®å®ä¹Ÿèƒ½æŸç§ç¨‹åº¦çš„ æŒ‰æ—¶é—´è¿›è¡Œåˆ†å‰²æ—¥å¿—</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ¯å¤© 00:00 HUP FSï¼Œå¼ºåˆ¶åˆ‡æ–‡ä»¶</span>
0 0 * * * <span class="hljs-built_in">kill</span> -HUP $(pidof freeswitch)
</code></pre>
<h4 data-id="heading-4">2.1.2 ç‰¹åˆ«æ³¨æ„</h4>
<p>å¦‚æœæˆ‘ä»¬æ˜¯æŒ‰ç…§æ—¥æœŸæ¥å‘½åæ—¥å¿—ï¼Œé‚£ä¹ˆ maximum-rotate å‚æ•°å°±æ— æ•ˆäº†ï¼Œå› ä¸ºä¸ä¼šå‘¨æœŸæ€§é‡å¤æ—¥å¿—åï¼ï¼ï¼</p>
<p>éœ€è¦æˆ‘ä»¬ä½¿ç”¨åˆ°ä¸‹é¢çš„æ–¹å¼ logrotate, æˆ–è€…ä½ è‡ªå·±ç”¨åˆ«çš„æ–¹å¼æ¥æ¸…ç†è¿‡æœŸæ—¥å¿—</p>
<h3 data-id="heading-5">2.2 logrotate</h3>
<p>logrotate æ˜¯ linux ç³»ç»Ÿè‡ªå¸¦æ—¥å¿—ç³»ç»Ÿ</p>
<p>è·¯å¾„åœ¨ <code>/etc/logrotate.d/</code>ï¼Œå½“æˆ‘ä»¬éœ€è¦å¤„ç†fs çš„æ—¥å¿—æ–‡ä»¶ï¼Œåªéœ€è¦åœ¨è¯¥è·¯å¾„ä¸‹æ–°å¢ freeswitch æ–‡ä»¶</p>
<pre><code class="hljs language-bash" lang="bash">/data/freeswitch/log/freeswitch-*.<span class="hljs-built_in">log</span> {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
}
</code></pre>
<blockquote>
<p>/data/freeswitch/log/ æ˜¯fsçš„æ—¥å¿—è·¯å¾„ï¼Œå¯ä»¥è‡ªè¡Œæ›´æ”¹</p>
</blockquote>
<p>mod_logfile ç»“åˆ å®šæ—¶ä»»åŠ¡ï¼Œç»“åˆ logrotate å°±å¯ä»¥ç®¡ç†æ—¥å¿—</p>
<p>ä½†æ˜¯è¿™ä¸ªæœ‰æ²¡æœ‰å¤ªéº»çƒ¦ï¼Œå…¶å® logrotate æœ¬èº«å°±å¯ä»¥ ç®¡ç†fsæ—¥å¿—ï¼Œä¸‹é¢ç»™å‡ºæˆ‘æœ¬åœ°çš„ logrotate fsæ—¥å¿—é…ç½®</p>
<pre><code class="hljs language-log" lang="log"># FreeSWITCH ä¸»æ—¥å¿—
/home/fs/docker/logs/freeswitch.log {
    daily
    # ä¿ç•™ 7 å¤©
    rotate 7          
    missingok
    notifempty
    compress
    delaycompress
    create 0640 root root
    
    # å…³é”®ï¼šç”¨æ—¥æœŸåšåç¼€
    dateext        
    # æ–‡ä»¶åæ ¼å¼ï¼š-2026-01-08
    dateformat -%Y-%m-%d  
    # ä¿è¯åç¼€æ˜¯ .logï¼Œå¦åˆ™ä¼šè¢«æˆªæ–­
    extension .log   
    
    sharedscripts
    postrotate
        /usr/bin/pkill -SIGUSR1 freeswitch
    endscript
}

# FreeSWITCH HTTP æ¨¡å—æ—¥å¿—
/home/fs/docker/logs/freeswitch_http.log {
    daily
    rotate 7
    missingok
    notifempty
    compress
    delaycompress
    create 0640 root root
    
    # å…³é”®ï¼šç”¨æ—¥æœŸåšåç¼€
    dateext        
    # æ–‡ä»¶åæ ¼å¼ï¼š-2026-01-08
    dateformat -%Y-%m-%d  
    # ä¿è¯åç¼€æ˜¯ .logï¼Œå¦åˆ™ä¼šè¢«æˆªæ–­
    extension .log   
    
    sharedscripts
    postrotate
        /usr/bin/pkill -SIGUSR1 freeswitch
    endscript
}
</code></pre>
<p>å…¶ä¸­éœ€è¦æ³¨æ„ï¼Œéœ€è¦ æŠŠ mod_logfile å…³é—­, ä¸ä¼šä¼šæœ‰ç©ºæ—¥å¿—æ–‡ä»¶</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">param</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"rotate-on-hup"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"false"</span>/&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VueçœŸçš„æ˜¯å•å‘æ•°æ®æµï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592683699772604426</link>    <guid>https://juejin.cn/post/7592683699772604426</guid>    <pubDate>2026-01-08T08:32:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592683699772604426" data-draft-id="7592765004807438387" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VueçœŸçš„æ˜¯å•å‘æ•°æ®æµï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2026-01-08T08:32:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ»¡å¤©æ˜Ÿè¾°"/> <meta itemprop="url" content="https://juejin.cn/user/2771198801097485"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VueçœŸçš„æ˜¯å•å‘æ•°æ®æµï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2771198801097485/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ»¡å¤©æ˜Ÿè¾°
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:32:39.000Z" title="Thu Jan 08 2026 08:32:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue å•å‘æ•°æ®æµçš„æ·±å…¥è§£æï¼šå¯¹è±¡ Props çš„é™·é˜±</h2>
<h3 data-id="heading-1">ğŸ”Â <strong>æ ¸å¿ƒé—®é¢˜ï¼šå¯¹è±¡ Props çš„å¯å˜æ€§</strong></h3>
<p>ä½ æŒ‡å‡ºçš„å®Œå…¨æ­£ç¡®ï¼<strong>è¿™æ˜¯ Vue å•å‘æ•°æ®æµä¸­æœ€å¤§çš„é™·é˜±</strong>ã€‚</p>
<h3 data-id="heading-2">ğŸš¨Â <strong>é—®é¢˜çš„æœ¬è´¨</strong></h3>
<h4 data-id="heading-3">1.Â <strong>å¯¹è±¡/æ•°ç»„ Props çš„å¼•ç”¨ä¼ é€’</strong></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- çˆ¶ç»„ä»¶ --&gt;
&lt;script setup&gt;
import { reactive } from 'vue'
import ChildComponent from './ChildComponent.vue'

// çˆ¶ç»„ä»¶çš„å“åº”å¼å¯¹è±¡
const user = reactive({
  name: 'å¼ ä¸‰',
  age: 25,
  address: {
    city: 'åŒ—äº¬',
    street: 'é•¿å®‰è¡—'
  }
})
&lt;/script&gt;

&lt;template&gt;
  &lt;!-- ä¼ é€’å¯¹è±¡ prop --&gt;
  &lt;ChildComponent :user="user" /&gt;
&lt;/template&gt;

&lt;!-- å­ç»„ä»¶ ChildComponent.vue --&gt;
&lt;script setup&gt;
const props = defineProps(['user'])

// âš ï¸ å±é™©æ“ä½œï¼šå¯ä»¥ç›´æ¥ä¿®æ”¹çˆ¶ç»„ä»¶çš„æ•°æ®ï¼
const updateUser = () =&gt; {
  props.user.name = 'æå››'  // âœ… ç”Ÿæ•ˆï¼Œä¸”ä¿®æ”¹äº†çˆ¶ç»„ä»¶
  props.user.age++         // âœ… ç”Ÿæ•ˆ
  props.user.address.city = 'ä¸Šæµ·'  // âœ… ç”Ÿæ•ˆ
  props.user.address.street = 'å—äº¬è·¯'  // âœ… ç”Ÿæ•ˆ
}

// ç”šè‡³å¯ä»¥ç›´æ¥æ·»åŠ æ–°å±æ€§
const addProperty = () =&gt; {
  props.user.email = 'new@email.com'  // âœ… ä¼šæ·»åŠ åˆ°çˆ¶ç»„ä»¶å¯¹è±¡
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-4">ğŸ“ŠÂ <strong>ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ</strong></h3>
<h4 data-id="heading-5">2.Â <strong>JavaScript å¼•ç”¨æœºåˆ¶ + Vue å“åº”å¼ç³»ç»Ÿ</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. JavaScript å¯¹è±¡æ˜¯å¼•ç”¨ä¼ é€’</span>
<span class="hljs-keyword">const</span> parentObj = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Parent'</span> }
<span class="hljs-keyword">const</span> childProp = parentObj  <span class="hljs-comment">// åŒä¸€ä¸ªå¼•ç”¨ï¼</span>

childProp.<span class="hljs-property">name</span> = <span class="hljs-string">'Modified'</span>  <span class="hljs-comment">// ä¿®æ”¹äº† parentObj</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(parentObj.<span class="hljs-property">name</span>)  <span class="hljs-comment">// 'Modified'</span>

<span class="hljs-comment">// 2. Vue çš„å“åº”å¼ç³»ç»ŸåŸºäº Proxy</span>
<span class="hljs-keyword">const</span> reactiveParent = <span class="hljs-title function_">reactive</span>({ <span class="hljs-attr">data</span>: <span class="hljs-string">'original'</span> })
<span class="hljs-comment">// å­ç»„ä»¶è·å¾—çš„æ˜¯åŒä¸€ä¸ª Proxy å¯¹è±¡</span>

<span class="hljs-comment">// 3. Vue çš„å¼€å‘æ¨¡å¼è­¦å‘Šæœ‰é™åˆ¶</span>
<span class="hljs-comment">// ç›´æ¥èµ‹å€¼ props.user = {} âŒ ä¼šè­¦å‘Š</span>
<span class="hljs-comment">// ä½†ä¿®æ”¹å±æ€§ props.user.name = 'new' âš ï¸ ä¸ä¼šè­¦å‘Šï¼</span>
</code></pre>
<h3 data-id="heading-6">ğŸ”„Â <strong>Vue å®˜æ–¹æ€åº¦</strong></h3>
<h4 data-id="heading-7">3.Â <strong>æ–‡æ¡£ä¸­çš„è¯´æ˜</strong></h4>
<pre><code class="hljs language-markdo" lang="markdo">Vue å®˜æ–¹æ–‡æ¡£æ˜ç¡®æŒ‡å‡ºï¼š

"æ³¨æ„åœ¨ JavaScript ä¸­å¯¹è±¡å’Œæ•°ç»„æ˜¯é€šè¿‡å¼•ç”¨ä¼ å…¥çš„ï¼Œ
æ‰€ä»¥å¯¹äºä¸€ä¸ªæ•°ç»„æˆ–å¯¹è±¡ç±»å‹çš„ prop æ¥è¯´ï¼Œ
åœ¨å­ç»„ä»¶ä¸­æ”¹å˜å˜æ›´è¿™ä¸ªå¯¹è±¡æˆ–æ•°ç»„æœ¬èº«å°†ä¼šå½±å“åˆ°çˆ¶ç»„ä»¶çš„çŠ¶æ€ã€‚"

"è¿™åœ¨ Vue ä¸­æ˜¯ä¸è¢«æ¨èçš„ï¼Œå› ä¸ºå®ƒç ´åäº†å•å‘æ•°æ®æµçš„æ¸…æ™°æ€§ã€‚"
</code></pre>
<h4 data-id="heading-8">4.Â <strong>è­¦å‘Šæœºåˆ¶çš„å±€é™</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue åªèƒ½æ£€æµ‹åˆ°è¿™äº›æƒ…å†µï¼š</span>

<span class="hljs-comment">// æƒ…å†µ1ï¼šç›´æ¥é‡æ–°èµ‹å€¼ âŒ ä¼šè­¦å‘Š</span>
props.<span class="hljs-property">user</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'new'</span> }
<span class="hljs-comment">// è­¦å‘Š: Attempting to mutate prop "user"</span>

<span class="hljs-comment">// æƒ…å†µ2ï¼šä¿®æ”¹åŸºæœ¬ç±»å‹ prop âŒ ä¼šè­¦å‘Š</span>
props.<span class="hljs-property">count</span> = <span class="hljs-number">2</span>
<span class="hljs-comment">// è­¦å‘Š: Attempting to mutate prop "count"</span>

<span class="hljs-comment">// æƒ…å†µ3ï¼šä¿®æ”¹å¯¹è±¡/æ•°ç»„çš„å±æ€§ âš ï¸ ä¸ä¼šè­¦å‘Šï¼</span>
props.<span class="hljs-property">user</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'new'</span>
props.<span class="hljs-property">list</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'item'</span>)
<span class="hljs-comment">// æ— è­¦å‘Šï¼Œä½†ç ´åäº†å•å‘æ•°æ®æµ</span>
</code></pre>
<h3 data-id="heading-9">ğŸ›¡ï¸Â <strong>å¦‚ä½•é¿å…è¿™ä¸ªé—®é¢˜ï¼Ÿ</strong></h3>
<h4 data-id="heading-10">5.Â <strong>è§£å†³æ–¹æ¡ˆ1ï¼šä¼ é€’è§£æ„åçš„å€¼</strong></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- çˆ¶ç»„ä»¶ --&gt;
&lt;template&gt;
  &lt;!-- ä¼ é€’åŸºæœ¬ç±»å‹æˆ–æ·±åº¦è§£æ„ --&gt;
  &lt;ChildComponent 
    :user-name="user.name"
    :user-age="user.age"
    :user-city="user.address.city"
  /&gt;
  
  &lt;!-- æˆ–è€…ä½¿ç”¨ computed åˆ›å»ºåªè¯»å‰¯æœ¬ --&gt;
  &lt;ChildComponent :user="readonlyUser" /&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { computed } from 'vue'

const user = reactive({ name: 'å¼ ä¸‰', age: 25 })

// åˆ›å»ºåªè¯»ç‰ˆæœ¬
const readonlyUser = computed(() =&gt; ({
  name: user.name,
  age: user.age
}))
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-11">6.Â <strong>è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨æ·±åº¦åªè¯»</strong></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- çˆ¶ç»„ä»¶ --&gt;
&lt;script setup&gt;
import { readonly } from 'vue'

const user = reactive({ name: 'å¼ ä¸‰', age: 25 })

// ä½¿ç”¨ readonly åŒ…è£…
const readonlyUser = readonly(user)
&lt;/script&gt;

&lt;template&gt;
  &lt;ChildComponent :user="readonlyUser" /&gt;
&lt;/template&gt;

&lt;!-- å­ç»„ä»¶ --&gt;
&lt;script setup&gt;
const props = defineProps(['user'])

const updateUser = () =&gt; {
  // âŒ ç°åœ¨ä¼šè§¦å‘è­¦å‘Š
  props.user.name = 'æå››'
  // è­¦å‘Š: Set operation on key "name" failed: target is readonly.
}
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-12">7.Â <strong>è§£å†³æ–¹æ¡ˆ3ï¼šä½¿ç”¨æ·±åº¦å¤åˆ¶</strong></h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- å­ç»„ä»¶å¤„ç† --&gt;
&lt;script setup&gt;
import { ref, watch } from 'vue'

const props = defineProps(['user'])

// æ·±åº¦å¤åˆ¶åˆ°æœ¬åœ°çŠ¶æ€
const localUser = ref(JSON.parse(JSON.stringify(props.user)))

// æˆ–è€…ä½¿ç”¨ lodash çš„ cloneDeep
import { cloneDeep } from 'lodash-es'
const localUser = ref(cloneDeep(props.user))

// ç›‘å¬ props å˜åŒ–åŒæ­¥æ›´æ–°
watch(() =&gt; props.user, (newUser) =&gt; {
  localUser.value = cloneDeep(newUser)
}, { deep: true })
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-13">ğŸ“ˆÂ <strong>æœ€ä½³å®è·µæ¨¡å¼</strong></h3>
<h4 data-id="heading-14">8.Â <strong>å·¥å‚å‡½æ•°æ¨¡å¼</strong></h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// composables/useSafeProps.js</span>
<span class="hljs-keyword">import</span> { ref, watch, toRaw } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useSafeProp</span>(<span class="hljs-params">propValue, options = {}</span>) {
  <span class="hljs-keyword">const</span> { deep = <span class="hljs-literal">true</span>, immediate = <span class="hljs-literal">true</span> } = options
  
  <span class="hljs-comment">// åˆ›å»ºæœ¬åœ°å‰¯æœ¬</span>
  <span class="hljs-keyword">const</span> localValue = <span class="hljs-title function_">ref</span>(<span class="hljs-title function_">structuredClone</span>(<span class="hljs-title function_">toRaw</span>(propValue)))
  
  <span class="hljs-comment">// ç›‘å¬ props å˜åŒ–</span>
  <span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> propValue, <span class="hljs-function">(<span class="hljs-params">newValue</span>) =&gt;</span> {
    localValue.<span class="hljs-property">value</span> = <span class="hljs-title function_">structuredClone</span>(<span class="hljs-title function_">toRaw</span>(newValue))
  }, { deep, immediate })
  
  <span class="hljs-keyword">return</span> localValue
}

<span class="hljs-comment">// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">defineProps</span>([<span class="hljs-string">'user'</span>, <span class="hljs-string">'list'</span>])
<span class="hljs-keyword">const</span> localUser = <span class="hljs-title function_">useSafeProp</span>(props.<span class="hljs-property">user</span>)
<span class="hljs-keyword">const</span> localList = <span class="hljs-title function_">useSafeProp</span>(props.<span class="hljs-property">list</span>)
</code></pre>
<h4 data-id="heading-15">9.Â <strong>ç±»å‹å®‰å…¨çš„æ·±åº¦åªè¯»</strong></h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// types/utilities.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepReadonly</span>&lt;T&gt; = {
  <span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> 
    ? T[P] <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Function</span> 
      ? T[P] 
      : <span class="hljs-title class_">DeepReadonly</span>&lt;T[P]&gt;
    : T[P]
}

<span class="hljs-comment">// çˆ¶ç»„ä»¶ä½¿ç”¨</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">DeepReadonly</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/types/utilities'</span>

<span class="hljs-keyword">const</span> user = <span class="hljs-title function_">reactive</span>({ 
  <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, 
  <span class="hljs-attr">profile</span>: { <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>, <span class="hljs-attr">address</span>: { <span class="hljs-attr">city</span>: <span class="hljs-string">'åŒ—äº¬'</span> } } 
})

<span class="hljs-keyword">const</span> readonlyUser = user <span class="hljs-keyword">as</span> <span class="hljs-title class_">DeepReadonly</span>&lt;<span class="hljs-keyword">typeof</span> user&gt;

<span class="hljs-comment">// ä¼ é€’ç»™å­ç»„ä»¶</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ChildComponent</span> <span class="hljs-attr">:user</span>=<span class="hljs-string">"readonlyUser"</span> /&gt;</span></span>

<span class="hljs-comment">// å­ç»„ä»¶ä¸­ TypeScript ä¼šé˜»æ­¢ä¿®æ”¹</span>
props.<span class="hljs-property">user</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'new'</span>  <span class="hljs-comment">// âŒ TypeScript é”™è¯¯</span>
props.<span class="hljs-property">user</span>.<span class="hljs-property">profile</span>.<span class="hljs-property">age</span> = <span class="hljs-number">30</span>  <span class="hljs-comment">// âŒ TypeScript é”™è¯¯</span>
</code></pre>
<h3 data-id="heading-16">ğŸ¯Â <strong>ç»“è®ºï¼šVue çœŸçš„æ˜¯å•å‘æ•°æ®æµå—ï¼Ÿ</strong></h3>
<h4 data-id="heading-17"><strong>æ­£ç¡®ç­”æ¡ˆ</strong>ï¼š</h4>
<ol>
<li><strong>è®¾è®¡ç†å¿µä¸Š</strong>ï¼šVue è®¾è®¡ä¸ºå•å‘æ•°æ®æµ âœ…</li>
<li><strong>è¯­æ³•å±‚é¢</strong>ï¼šé€šè¿‡ props + events å¼ºåˆ¶æ‰§è¡Œå•å‘æµ âœ…</li>
<li><strong>å®ç°å±‚é¢</strong>ï¼šç”±äº JavaScript é™åˆ¶ï¼Œå­˜åœ¨å¯¹è±¡å¼•ç”¨æ¼æ´ âš ï¸</li>
<li><strong>å®è·µå±‚é¢</strong>ï¼šéœ€è¦å¼€å‘è€…è‡ªè§‰éµå®ˆè§„èŒƒ âš ï¸</li>
</ol>
<h4 data-id="heading-18"><strong>å…³é”®è®¤çŸ¥</strong>ï¼š</h4>
<ul>
<li><strong>Vue çš„å•å‘æ•°æ®æµæ˜¯"çº¦å®šå¤§äºå¼ºåˆ¶"</strong></li>
<li><strong>æ¡†æ¶æä¾›äº†åŸºç¡€ï¼Œä½†å¼€å‘è€…éœ€è¦è´Ÿè´£å…·ä½“å®ç°</strong></li>
<li><strong>å¯¹è±¡/æ•°ç»„ props çš„æ˜“å˜æ€§æ˜¯å·²çŸ¥çš„è®¾è®¡å–èˆ</strong></li>
<li><strong>é€šè¿‡å·¥å…·ã€è§„èŒƒå’Œæœ€ä½³å®è·µå¯ä»¥é¿å…é—®é¢˜</strong></li>
</ul>
<h4 data-id="heading-19"><strong>æœ€ç»ˆå»ºè®®</strong>ï¼š</h4>
<p>å¦‚æœä½ æƒ³ä¿æŒä¸¥æ ¼å•å‘æ•°æ®æµï¼š</p>
<ol>
<li>å§‹ç»ˆä½¿ç”¨ <code>readonly()</code> åŒ…è£…å¯¹è±¡ props</li>
<li>ä½¿ç”¨ TypeScript çš„åªè¯»ç±»å‹</li>
<li>é…ç½® ESLint ä¸¥æ ¼è§„åˆ™</li>
<li>é€šè¿‡äº‹ä»¶é€šä¿¡ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹</li>
<li>å¯¹äºå¤æ‚å¯¹è±¡ï¼Œä¼ é€’è§£æ„åçš„åŸºæœ¬ç±»å‹
ä½†ä¹Ÿè¦ç†è§£ Vue çš„è®¾è®¡å“²å­¦ï¼š"ç»™å¼€å‘è€…é€‰æ‹©æƒï¼Œè€Œä¸æ˜¯å¼ºåˆ¶çº¦æŸ"</li>
</ol>
<p><strong>Vue çš„è®¾è®¡å“²å­¦æ˜¯"æ¸è¿›å¼"å’Œ"çµæ´»"</strong> ï¼Œå®ƒæä¾›äº†å•å‘æ•°æ®æµçš„åŸºç¡€ï¼Œä½†ä¹Ÿå…è®¸åœ¨éœ€è¦æ—¶ç»•è¿‡é™åˆ¶ã€‚è¿™æ—¢æ˜¯ä¼˜ç‚¹ï¼ˆçµæ´»æ€§ï¼‰ï¼Œä¹Ÿæ˜¯æŒ‘æˆ˜ï¼ˆéœ€è¦å›¢é˜Ÿè§„èŒƒï¼‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScriptæœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592759140037853225</link>    <guid>https://juejin.cn/post/7592759140037853225</guid>    <pubDate>2026-01-08T08:33:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592759140037853225" data-draft-id="7592637149696753699" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScriptæœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2026-01-08T08:33:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç é€”æ½‡æ½‡"/> <meta itemprop="url" content="https://juejin.cn/user/2386391857112611"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScriptæœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2386391857112611/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç é€”æ½‡æ½‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:33:17.000Z" title="Thu Jan 08 2026 08:33:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScriptæœ‰å“ªäº›æ•°æ®ç±»å‹ï¼Ÿå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ï¼Ÿ</h2>
<p>JavaScript æœ‰å…¶å†…å»ºçš„æ•°æ®ç±»å‹ã€‚å…¶ä¸­åˆåˆ†ä¸ºåŸç”Ÿå€¼ï¼ˆprimitive valuesï¼‰å’Œå¯¹è±¡ï¼ˆobjectsï¼‰ã€‚</p>
<h2 data-id="heading-1">1.JavaScript çš„åŸç”Ÿå€¼ (primitive values)</h2>
<p>æˆªè‡³ç›®å‰ï¼ŒJavaScript çš„èµ„æ–™å‹åˆ«ä¸­ï¼Œæœ‰ä¸ƒä¸ªåŸç”Ÿå€¼ã€‚è¿™ä¸ƒä¸ªåŸç”Ÿå€¼ä»¥å¤–çš„ï¼Œå…¨éƒ½æ˜¯å±äºå¯¹è±¡ã€‚</p>
<p>åŸç”Ÿå€¼æ˜¯ä¸å¯å˜çš„(immutable)ï¼Œæ„æ€æ˜¯æˆ‘ä»¬ä¸èƒ½æ”¹å˜é‚£ä¸ªå€¼æœ¬èº«ã€‚æ¯”å¦‚å½“æˆ‘ä»¬â€œä¿®æ”¹â€åŸå§‹å€¼æ—¶ï¼Œå®é™…ä¸Šæ˜¯è®©å˜é‡é‡æ–°ç»‘å®šåˆ°ä¸€ä¸ªæ–°çš„å€¼ï¼Œè€Œä¸æ˜¯åœ¨åŸå€¼ä¸Šè¿›è¡Œä¿®æ”¹ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> greeting = <span class="hljs-string">"Hi"</span>;
greeting = <span class="hljs-string">"Hello"</span>; <span class="hljs-comment">// æ­¤æ—¶è™½ç„¶æ‰“å° greeting æ˜¯ Helloï¼Œä½†æ˜¯ Hi è¿™ä¸ªå€¼æœ¬èº«æ˜¯æ²¡å˜çš„ï¼Œåªæ˜¯ greeting æŒ‡å‘äº†Hello è¿™ä¸ªæ–°å€¼</span>
</code></pre>
<p>JavaScript çš„å‹åˆ«ä¸­çš„ä¸ƒä¸ªåŸç”Ÿå€¼åŒ…å«ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FString" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String" ref="nofollow noopener noreferrer">String</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2Fboolean" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" ref="nofollow noopener noreferrer">Boolean</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Fnull" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/null" ref="nofollow noopener noreferrer">Null</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2Fundefined" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/undefined" ref="nofollow noopener noreferrer">Undefined</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2Fnumber" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" ref="nofollow noopener noreferrer">Number</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2Fbigint" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/bigint" ref="nofollow noopener noreferrer">BigInt</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FSymbol" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol" ref="nofollow noopener noreferrer">Symbol</a></li>
</ul>
<h3 data-id="heading-2">1.1 å­—ç¬¦ä¸² String</h3>
<p>String (å­—ç¬¦ä¸²)</p>
<p>å­—ä¸²æ˜¯æœ€å¸¸è§çš„åŸç”Ÿå€¼ä¹‹ä¸€ã€‚å¦‚å‰é¢æåˆ°ï¼Œåœ¨JavaScript å½“ä¸­å­—ä¸²æœ¬èº«æ˜¯ä¸å¯å˜çš„ã€‚å½“æˆ‘ä»¬ç”¨<code>substring()</code>æ¥æ’·å–å­—ä¸²ï¼Œæˆ–ç”¨<code>concat()</code>æ¥æŠŠä¸¤ä¸ªå­—ä¸²åˆä¸ºä¸€ï¼Œè¿™äº›éƒ½æ˜¯ä¼šå›ä¼ å¦ä¸€ä¸ªå­—ä¸²ï¼Œè€Œéæ”¹å˜åŸæœ¬çš„å­—ä¸²ã€‚</p>
<h3 data-id="heading-3">1.2 å¸ƒå°”å€¼ Boolean</h3>
<p>Boolean (å¸ƒå°”å€¼)</p>
<p>æœ‰<code>true</code>ä¸<code>false</code>ä¸¤ä¸ªå€¼çš„å¸ƒæ—å€¼ï¼Œä¹Ÿæ˜¯JavaScript çš„åŸç”Ÿå€¼ã€‚</p>
<h3 data-id="heading-4">1.3 Number</h3>
<p>JavaScript ä¸ä¸€äº›è¯­è¨€ä¸åŒï¼Œæ²¡æœ‰åˆ†æ•´æ•°ä¸æµ®ç‚¹æ•°ï¼Œè€Œæ˜¯éƒ½ç”¨<code>number</code>è¿™ä¸ªåŸç”Ÿå€¼ã€‚ä¸è®ºæ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼Œéƒ½æ˜¯<code>number</code>è¿™ä¸ªå‹åˆ«ã€‚åœ¨JavaScript å½“ä¸­ï¼Œ<code>+Infinity</code>, <code>-Infinity</code>, ä¸  <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FNaN" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/NaN" ref="nofollow noopener noreferrer">NaN</a> éƒ½æ˜¯<code>number</code>è¿™ä¸ªå‹åˆ«ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨<code>typeof</code>æ¥æ£€æŸ¥çš„è¯ï¼Œä¼šå¾—åˆ°<code>number</code>ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">NaN</span>); <span class="hljs-comment">// number</span>
</code></pre>
<p>è€Œ<code>number</code>åœ¨JavaScript æ˜¯åŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œæ‰€ä»¥ç²¾ç¡®åº¦æ˜¯ä»‹äº<code>-(2^53 âˆ’ 1)</code>ä¸<code>2^53 âˆ’ 1</code>ä¹‹é—´ã€‚åœ¨è¿™ä¸ªèŒƒå›´ä¹‹å¤–ï¼Œå°±ä¼šæœ‰ç²¾å‡†åº¦çš„é—®é¢˜ï¼Œè¿™æ—¶å€™è¦ç”¨å¦ä¸€ä¸ªåŸç”Ÿå€¼<code>BigInt</code>ã€‚</p>
<h3 data-id="heading-5">1.4 BigInt</h3>
<p>ä¸Šé¢æåˆ°åœ¨JavaScript çš„æ•´æ•°ä¸æµ®ç‚¹æ•°ï¼Œéƒ½æ˜¯ç”¨<code>number</code>è¿™ä¸ªå‹åˆ«ï¼Œè¿™å…¶å®åªè¯´äº†ä¸€åŠã€‚å› ä¸ºJavaScript çš„<code>number</code>ç²¾å‡†åº¦æœ‰å…¶é™åˆ¶ï¼Œè™½ç„¶å¤šæ•°æƒ…å†µå¾ˆå¤Ÿç”¨(<code>2^53 - 1</code>ä¼šæ˜¯9007199254740991ï¼Œæˆ‘ä»¬å¾ˆå°‘ç”¨åˆ°æ¯”è¿™å¤§çš„æ•°)ã€‚ä½†æœ‰äº›æ—¶å€™ä¼šéœ€è¦æ›´å¾€ä¸‹çš„ç²¾å‡†åº¦ã€‚è¿™æ—¶å°±å¯ä»¥ç”¨<code>BigInt</code>æ•°å€¼çš„å‹åˆ«ã€‚</p>
<p><code>BigInt</code>å¯ä»¥è®©æˆ‘ä»¬ä»»æ„é€‰æ‹©å…¶ç²¾å‡†åº¦ï¼Œå°±å¯ä»¥é¿å…ä¸€äº›<code>number</code>ä¼šé‡åˆ°çš„é—®é¢˜ã€‚å®ƒè·Ÿ<code>number</code>ä¸€æ ·å¯ä»¥ç”¨<code>+</code>, <code>*</code>, <code>-</code>, <code>**</code>, ä¸  <code>%</code>ç­‰è¿ç®—å­ï¼Œä¸è¿‡è¦æ³¨æ„ä¸å¯ä»¥æ‹¿<code>BigInt</code>è·Ÿ<code>number</code>å‹åˆ«çš„å€¼äº¤äº’ä½¿ç”¨ï¼Œè¿™ä¼šå‡ºç°<code>TypeError</code>ã€‚</p>
<h3 data-id="heading-6">1.5 Undefined</h3>
<p><code>undefined</code>æ˜¯ä¸€ä¸ªç±»å‹ï¼Œå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå€¼ã€‚</p>
<ul>
<li>
<p>å‡å¦‚æŸä¸ªå˜é‡æœªå£°æ˜å°±æ˜¯ç”¨ï¼Œä¼šå‡ºç°ç´¢å¼•é”™è¯¯ReferenceError</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);

<span class="hljs-title class_">ReferenceError</span>: a is not defined
</code></pre>
</li>
<li>
<p>ç”¨ let / const å£°æ˜äº†ï¼Œä½†åœ¨å£°æ˜å‰ä½¿ç”¨</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);
<span class="hljs-keyword">let</span> a = <span class="hljs-number">1</span>;

<span class="hljs-title class_">ReferenceError</span>: <span class="hljs-title class_">Cannot</span> access <span class="hljs-string">'a'</span> before initialization
</code></pre>
</li>
<li>
<p>æŸä¸ªå˜é‡å£°æ˜ä½†æ˜¯æ²¡æœ‰èµ‹å€¼</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> greeting;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(greeting); <span class="hljs-comment">// undefined</span>
</code></pre>
</li>
</ul>
<h3 data-id="heading-7">1.6 Null</h3>
<p><code>null</code>æ˜¯å¾ˆå®¹æ˜“è·Ÿ<code>undefined</code>ææ··çš„åŸç”Ÿå€¼ã€‚<code>undefined</code>æ˜¯å› ä¸ºæŸå˜æ•°è¿˜æ²¡æœ‰èµ‹å€¼ï¼Œæ‰€ä»¥å¯¹JavaScript æ¥è¯´ï¼Œå®ƒä¸çŸ¥é“è¯¥å˜æ•°çš„å€¼æ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥è¦è¯»å–è¯¥å˜æ•°æ—¶ï¼Œä¼šæ˜¯<code>undefined</code>ã€‚ä¸è¿‡ åˆ™<code>null</code>æ˜¯æˆ‘ä»¬èµ‹äºˆæŸä¸ªå˜æ•°<code>null</code>è¿™ä¸€ä¸ªå€¼ã€‚</p>
<h3 data-id="heading-8">1.7 Symbol</h3>
<p>æœ€åä¸€ä¸ªJavaScript åŸç”Ÿå€¼æ˜¯<code>Symbol</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç‰¹(unique) å€¼ï¼Œå¤šåŠä¼šæ­é…ç‰©ä»¶ä¸€èµ·ä½¿ç”¨ï¼Œä½œä¸ºç‰©ä»¶çš„é”®(key)ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> sym = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">"ExplainYYDS"</span>);
<span class="hljs-keyword">const</span> obj = { [sym]: <span class="hljs-string">"Interview Preps for Software Engineers"</span> };
obj[sym]; <span class="hljs-comment">// Interview Preps for Software Engineers</span>
</code></pre>
<h2 data-id="heading-9">2.JavaScriptä¸­çš„å¯¹è±¡(objects)</h2>
<p>é™¤äº†ä¸Šè¿°çš„ä¸ƒä¸ªåŸç”Ÿå€¼ä»¥å¤–çš„å­˜åœ¨ï¼Œåœ¨JavaScript å½“ä¸­éƒ½æ˜¯å¯¹è±¡ã€‚</p>
<p>JavaScript åœˆæœ‰ä¸€ä¸ªæ¢—ï¼Œæ•°ç»„æ˜¯å¯¹è±¡ï¼Œå‡½æ•°æ˜¯å¯¹è±¡ï¼Œå¯¹è±¡æ˜¯å¯¹è±¡ã€‚</p>
<h2 data-id="heading-10">3. å¦‚ä½•è¾¨åˆ«ä¸€ä¸ªå˜é‡çš„æ•°æ®ç±»å‹ï¼Ÿ</h2>
<h3 data-id="heading-11">3.1 ä½¿ç”¨typeofåˆ¤æ–­å˜é‡çš„æ•°æ®ç±»å‹</h3>
<p>è¦è¾¨åˆ«ä¸€ä¸ªå˜æ•°çš„æ•°æ®ç±»å‹ï¼Œæœ€å¸¸è§çš„æ–¹å¼æ˜¯é€è¿‡<code>typeof</code>è¿™ä¸ªæ–¹æ³•ã€‚ä¸¾ä¾‹æ¥è¯´<code>typeof</code>åˆ¤æ–­å­—ç¬¦ä¸²ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> greeting = <span class="hljs-string">"hi"</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> greeting); <span class="hljs-comment">// 'string'</span>
</code></pre>
<p>typeof çš„ä¸¤ä¸ªæ³¨æ„ç‚¹</p>
<ul>
<li>typeof åŸç”Ÿå€¼ï¼Œè¿”å›çš„æ˜¯è¯¥åŸç”Ÿå€¼çš„ç±»å‹æ ‡è¯†å­—ç¬¦ä¸²ï¼Œä½†æ˜¯ typeof null ç»“æœä¸æ˜¯ nullï¼Œè€Œæ˜¯objectï¼Œè¿™ä¸ªå†å²é—ç•™çš„ bugï¼Œä¿®å¤æˆæœ¬å¤ªé«˜äº†</li>
<li>typeof æ•°ç»„çš„ç»“æœæ˜¯ object ï¼Œtpyeof å‡½æ•°çš„ç»“æœæ˜¯ function</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-literal">null</span>); <span class="hljs-comment">// object</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> []); <span class="hljs-comment">// object</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {}); <span class="hljs-comment">// function</span>
</code></pre>
<p>è¡¥å……<code>typeof</code>ç»“æœçš„è¡¨æ ¼</p>









































<table><thead><tr><th>Type of val</th><th>Result</th></tr></thead><tbody><tr><td>Undefined</td><td>"undefined"</td></tr><tr><td>Null</td><td>"object"</td></tr><tr><td>Boolean</td><td>"boolean"</td></tr><tr><td>Number</td><td>"number"</td></tr><tr><td>String</td><td>"string"</td></tr><tr><td>Object (native and does not implement [[Call]])</td><td>"object"</td></tr><tr><td>Object (native or host and does implement [[Call]])</td><td>"function"</td></tr><tr><td>Object (host and does not implement [[Call]])</td><td>Implementation-defined except may not be "undefined", "boolean", "number", or "string".</td></tr></tbody></table>
<p>å› ä¸º typeof æ— æ³•åˆ¤æ–­æ•°ç»„å’Œå¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦æ–°çš„æ–¹æ³•å»åˆ¤æ–­æŸä¸ªå˜é‡æ˜¯å¯¹è±¡è¿˜æ˜¯æ•°ç»„ã€‚</p>
<h3 data-id="heading-12">3.2 åˆ¤æ–­å˜é‡æ˜¯å¯¹è±¡è¿˜æ˜¯æ•°ç»„ï¼Ÿ</h3>
<p><code>Array.isArray()</code>æ˜¯å¯ä»¥ååŠ©æˆ‘ä»¬çš„æ–¹æ³•ã€‚å¦‚æœæ˜¯æ•°ç»„ï¼Œä¼šå›ä¼ <code>true</code>ï¼›ä½†è‹¥æ˜¯ä¸€èˆ¬å¯¹è±¡ï¼Œåˆ™ä¼šå›ä¼ <code>false</code>ã€‚ä¸¾ä¾‹æ¥è¯´ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">// true</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>({ <span class="hljs-attr">foo</span>: <span class="hljs-number">123</span> }); <span class="hljs-comment">// false</span>
</code></pre>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€è¿‡<code>Object.prototype.toString()</code>çš„æ–¹æ³•å¸®åŠ©æˆ‘ä»¬è¾¨åˆ«æ•°ç»„ã€å‡½æ•°ä¸ä¸€èˆ¬å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fn</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-number">123</span>;
};
<span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">foo</span>: <span class="hljs-number">123</span> };

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(arr)); <span class="hljs-comment">// [object Array]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(fn)); <span class="hljs-comment">// [object Function]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(obj)); <span class="hljs-comment">// [object Object]</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nice-modal-reactçš„ä½¿ç”¨]]></title>    <link>https://juejin.cn/post/7592765004807634995</link>    <guid>https://juejin.cn/post/7592765004807634995</guid>    <pubDate>2026-01-08T08:53:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592765004807634995" data-draft-id="7592765004807569459" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nice-modal-reactçš„ä½¿ç”¨"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T08:53:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç»†å¿ƒç»†å¿ƒå†ç»†å¿ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/721738373803879"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nice-modal-reactçš„ä½¿ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/721738373803879/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç»†å¿ƒç»†å¿ƒå†ç»†å¿ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T08:53:02.000Z" title="Thu Jan 08 2026 08:53:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åˆ›å»ºmodal</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Modal</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'antd'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">NiceModal</span>, { useModal } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ebay/nice-modal-react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">WarningSvg</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/assets/warning.svg?react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">BrowserNotSatisfiedModal</span> = <span class="hljs-title class_">NiceModal</span>.<span class="hljs-title function_">create</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> modal = <span class="hljs-title function_">useModal</span>();
  <span class="hljs-keyword">const</span> <span class="hljs-attr">modalProps</span>: <span class="hljs-built_in">any</span> = <span class="hljs-title class_">NiceModal</span>.<span class="hljs-title function_">antdModal</span>(modal);
  modalProps.<span class="hljs-property">open</span> = modalProps.<span class="hljs-property">visible</span>;
  <span class="hljs-keyword">delete</span> modalProps.<span class="hljs-property">visible</span>;

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleOK</span> = (<span class="hljs-params"/>) =&gt; {
    modal.<span class="hljs-title function_">hide</span>();
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Modal</span>
      {<span class="hljs-attr">...modalProps</span>}
      <span class="hljs-attr">title</span>=<span class="hljs-string">{</span>
        &lt;<span class="hljs-attr">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">WarningSvg</span>
            <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span>
              <span class="hljs-attr">fontSize:</span> '<span class="hljs-attr">22px</span>',
              <span class="hljs-attr">marginRight:</span> '<span class="hljs-attr">12px</span>',
              <span class="hljs-attr">verticalAlign:</span> '<span class="hljs-attr">top</span>',
            }}
          /&gt;</span>
          æç¤º
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      }
      centered
      onOk={handleOK}
      okText="ç¡®å®š"
      cancelText="å–æ¶ˆ"
    &gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">margin:</span> '<span class="hljs-attr">20px</span> <span class="hljs-attr">0</span> <span class="hljs-attr">40px</span>' }}&gt;</span>
        æµè§ˆå™¨ç‰ˆæœ¬è¿‡ä½ï¼Œå¯èƒ½å­˜åœ¨éƒ¨åˆ†å†…å®¹ä¸å…¼å®¹ï¼Œå»ºè®®å‡çº§æµè§ˆå™¨åä½¿ç”¨
      <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Modal</span>&gt;</span></span>
  );
});


</code></pre>
<h2 data-id="heading-1">ä½¿ç”¨å¼¹æ¡†</h2>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-title class_">NiceModal</span>.<span class="hljs-title function_">show</span>(<span class="hljs-title class_">AppealDialog</span>, props);
</code></pre>
<p>æ³¨æ„ï¼šè¿™é‡ŒNiceModalè¿”å›çš„æ˜¯ä¸€ä¸ªPromise
å¯ä»¥è¿™æ ·ä½¿ç”¨</p>
<pre><code class="hljs language-ts" lang="ts"> <span class="hljs-title class_">NiceModal</span>.<span class="hljs-title function_">show</span>(<span class="hljs-title class_">ConsumerFormModal</span>, {
    <span class="hljs-attr">fields</span>: (headerFields?.<span class="hljs-property">fields</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ConsumerFormField</span>[]) ?? [],
    <span class="hljs-attr">editRecod</span>: record,
    <span class="hljs-attr">isEdit</span>: <span class="hljs-literal">true</span>,
    })
    .<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span>{})
    .<span class="hljs-keyword">catch</span>(<span class="hljs-function">()=&gt;</span>{})
    .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
    setIsEditConsumerTableFlag?.(<span class="hljs-literal">false</span>);
    });
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆ"åŒºå—é“¾"ä¸åªæ˜¯æ¯”ç‰¹å¸ï¼Ÿâ€”â€”ä»åŠ å¯†è´§å¸åˆ°åˆ†å¸ƒå¼åº”ç”¨]]></title>    <link>https://juejin.cn/post/7592593491861585920</link>    <guid>https://juejin.cn/post/7592593491861585920</guid>    <pubDate>2026-01-08T09:00:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592593491861585920" data-draft-id="7592593491861569536" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆ&quot;åŒºå—é“¾&quot;ä¸åªæ˜¯æ¯”ç‰¹å¸ï¼Ÿâ€”â€”ä»åŠ å¯†è´§å¸åˆ°åˆ†å¸ƒå¼åº”ç”¨"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-08T09:00:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ— é™å¤§6"/> <meta itemprop="url" content="https://juejin.cn/user/2865758605422890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆ"åŒºå—é“¾"ä¸åªæ˜¯æ¯”ç‰¹å¸ï¼Ÿâ€”â€”ä»åŠ å¯†è´§å¸åˆ°åˆ†å¸ƒå¼åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2865758605422890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ— é™å¤§6
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T09:00:36.000Z" title="Thu Jan 08 2026 09:00:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ğŸª™ ä¸ºä»€ä¹ˆ"åŒºå—é“¾"ä¸åªæ˜¯æ¯”ç‰¹å¸ï¼Ÿâ€”â€”ä»åŠ å¯†è´§å¸åˆ°åˆ†å¸ƒå¼åº”ç”¨ ğŸŒ</h2>
<blockquote>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯æ— é™å¤§ï¼Œæ¬¢è¿æ”¶çœ‹åä¸‡ä¸ªä¸ºä»€ä¹ˆç³»åˆ—æ–‡ç« </p>
<p>å¸Œæœ›ä»Šå¤©çš„å†…å®¹èƒ½å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©</p>
</blockquote>
<p>æƒ³è±¡ä¸€ä¸‹ï¼šä½ å’Œæœ‹å‹ä¸€èµ·åƒé¥­ï¼ŒAAåˆ¶ä»˜æ¬¾ï¼Œæ¯æ¬¡éƒ½è¦è®°è´¦â€”â€”å¦‚æœæœ‰ä¸€ä¸ª"å…±äº«è´¦æœ¬"ï¼Œæ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°ï¼Œè€Œä¸”æ²¡äººèƒ½ç¯¡æ”¹ï¼Œæ˜¯ä¸æ˜¯æ–¹ä¾¿å¤šäº†ï¼Ÿ</p>
<p>è¿™å°±æ˜¯<strong>åŒºå—é“¾</strong>çš„åŸç†ï¼å®ƒå°±åƒä¸€ä¸ª"ä¸å¯ç¯¡æ”¹çš„å…±äº«è´¦æœ¬"ï¼Œè®°å½•ç€æ‰€æœ‰äº¤æ˜“å’Œæ•°æ®ï¼Œè€Œä¸”åˆ†å¸ƒåœ¨ç½‘ç»œä¸­çš„æ¯å°ç”µè„‘ä¸Šã€‚</p>
<p>å¾ˆå¤šäººè§‰å¾—åŒºå—é“¾å°±æ˜¯æ¯”ç‰¹å¸ï¼Œå…¶å®æ¯”ç‰¹å¸åªæ˜¯åŒºå—é“¾çš„<strong>ç¬¬ä¸€ä¸ªåº”ç”¨</strong>ï¼åŒºå—é“¾è¿˜æœ‰å¾ˆå¤šæ›´æœ‰è¶£çš„åº”ç”¨ï¼Œæ¯”å¦‚å»ä¸­å¿ƒåŒ–é‡‘èã€ä¾›åº”é“¾æº¯æºã€æ•°å­—èº«ä»½ç­‰ã€‚</p>
<h3 data-id="heading-1">ğŸ¤” æ ¸å¿ƒé—®é¢˜ï¼šåŒºå—é“¾çš„åº”ç”¨åœºæ™¯æœ‰å“ªäº›ï¼Ÿä¸ºä»€ä¹ˆèƒ½åº”ç”¨åœ¨é‡‘èã€ä¾›åº”é“¾ç­‰é¢†åŸŸï¼Ÿ</h3>
<p>åŒºå—é“¾çš„æœ¬è´¨æ˜¯<strong>ä¸€ç§åˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯</strong>ï¼Œå®ƒçš„æ ¸å¿ƒç‰¹ç‚¹æ˜¯ï¼š</p>
<h4 data-id="heading-2">åŒºå—é“¾çš„"äº”å¤§ç‰¹å¾"</h4>
<ul>
<li>ğŸ”— <strong>åˆ†å¸ƒå¼</strong>ï¼šæ•°æ®åˆ†å¸ƒåœ¨ç½‘ç»œä¸­çš„æ¯å°ç”µè„‘ä¸Šï¼Œæ²¡æœ‰ä¸­å¿ƒåŒ–æœåŠ¡å™¨</li>
<li>ğŸ”’ <strong>ä¸å¯ç¯¡æ”¹</strong>ï¼šä¸€æ—¦æ•°æ®å†™å…¥ï¼Œå°±æ— æ³•ä¿®æ”¹æˆ–åˆ é™¤</li>
<li>â±ï¸ <strong>æ—¶åºæ€§</strong>ï¼šæ•°æ®æŒ‰ç…§æ—¶é—´é¡ºåºæ’åˆ—ï¼Œå½¢æˆé“¾å¼ç»“æ„</li>
<li>ğŸ¤ <strong>å…±è¯†æœºåˆ¶</strong>ï¼šç½‘ç»œä¸­çš„èŠ‚ç‚¹é€šè¿‡å…±è¯†æœºåˆ¶è¾¾æˆä¸€è‡´</li>
<li>ğŸ”‘ <strong>åŠ å¯†å®‰å…¨</strong>ï¼šä½¿ç”¨å¯†ç å­¦ä¿è¯æ•°æ®çš„å®‰å…¨æ€§å’Œéšç§æ€§</li>
</ul>
<h4 data-id="heading-3">ä¸ºä»€ä¹ˆåŒºå—é“¾èƒ½åº”ç”¨åœ¨é‡‘èã€ä¾›åº”é“¾ç­‰é¢†åŸŸï¼Ÿ</h4>
<ul>
<li>ğŸ’° <strong>é‡‘èé¢†åŸŸ</strong>ï¼šé™ä½äº¤æ˜“æˆæœ¬ã€æé«˜äº¤æ˜“é€Ÿåº¦ã€å¢å¼ºå®‰å…¨æ€§ã€å®ç°å»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDeFiï¼‰</li>
<li>ğŸšš <strong>ä¾›åº”é“¾é¢†åŸŸ</strong>ï¼šå®ç°å•†å“æº¯æºã€æé«˜ä¾›åº”é“¾é€æ˜åº¦ã€å‡å°‘æ¬ºè¯ˆã€ä¼˜åŒ–åº“å­˜ç®¡ç†</li>
<li>ğŸ¥ <strong>åŒ»ç–—é¢†åŸŸ</strong>ï¼šå®‰å…¨å­˜å‚¨ç—…å†ã€å®ç°è·¨åŒ»é™¢æ•°æ®å…±äº«ã€ä¿æŠ¤æ‚£è€…éšç§</li>
<li>ğŸ“‹ <strong>æ”¿åŠ¡é¢†åŸŸ</strong>ï¼šç”µå­æŠ•ç¥¨ã€èº«ä»½è®¤è¯ã€ä¸åŠ¨äº§ç™»è®°ã€çŸ¥è¯†äº§æƒä¿æŠ¤</li>
<li>ğŸ¨ <strong>æ–‡åŒ–é¢†åŸŸ</strong>ï¼šNFTæ•°å­—è‰ºæœ¯ã€ç‰ˆæƒä¿æŠ¤ã€æ•°å­—è—å“</li>
</ul>
<h3 data-id="heading-4">ğŸ“œ ä»"æ¯”ç‰¹å¸"åˆ°"Web3"ï¼šåŒºå—é“¾çš„è¿›åŒ–å²</h3>
<h4 data-id="heading-5">1. ğŸª™ æ¯”ç‰¹å¸è¯ç”Ÿï¼š"åŒºå—é“¾1.0"</h4>
<p>2008å¹´ï¼Œä¸€ä¸ªåå«<strong>ä¸­æœ¬èª</strong>çš„ç¥ç§˜äººå‘è¡¨äº†ã€Šæ¯”ç‰¹å¸ï¼šä¸€ç§ç‚¹å¯¹ç‚¹çš„ç”µå­ç°é‡‘ç³»ç»Ÿã€‹ç™½çš®ä¹¦ï¼Œ2009å¹´1æœˆ3æ—¥ï¼Œæ¯”ç‰¹å¸ç½‘ç»œæ­£å¼å¯åŠ¨ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å»ä¸­å¿ƒåŒ–çš„æ•°å­—è´§å¸</li>
<li>ä½¿ç”¨å·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰å…±è¯†æœºåˆ¶</li>
<li>æ€»é‡å›ºå®š2100ä¸‡æš</li>
<li>åŒ¿åäº¤æ˜“</li>
<li>äº¤æ˜“è®°å½•ä¸å¯ç¯¡æ”¹</li>
</ul>
<p><strong>å½±å“</strong>ï¼š</p>
<ul>
<li>è¯æ˜äº†å»ä¸­å¿ƒåŒ–è´§å¸çš„å¯è¡Œæ€§</li>
<li>å¼€åˆ›äº†åŒºå—é“¾æŠ€æœ¯</li>
<li>å¼•å‘äº†åŠ å¯†è´§å¸çƒ­æ½®</li>
</ul>
<h4 data-id="heading-6">2. ğŸ“ ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ï¼š"åŒºå—é“¾2.0"</h4>
<p>2015å¹´7æœˆï¼Œä»¥å¤ªåŠç½‘ç»œæ­£å¼ä¸Šçº¿ï¼Œå¼•å…¥äº†<strong>æ™ºèƒ½åˆçº¦</strong>æ¦‚å¿µã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ”¯æŒæ™ºèƒ½åˆçº¦ï¼ˆè‡ªåŠ¨æ‰§è¡Œçš„ä»£ç ï¼‰</li>
<li>å›¾çµå®Œå¤‡çš„ç¼–ç¨‹è¯­è¨€ï¼ˆSolidityï¼‰</li>
<li>æ”¯æŒå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼ˆDAppï¼‰</li>
<li>å¯æ‰©å±•æ€§æ›´é«˜</li>
</ul>
<p><strong>å½±å“</strong>ï¼š</p>
<ul>
<li>åŒºå—é“¾ä»å•çº¯çš„è´§å¸æ‰©å±•åˆ°æ›´å¹¿æ³›çš„åº”ç”¨</li>
<li>å‚¬ç”Ÿäº†ICOçƒ­æ½®</li>
<li>æ¨åŠ¨äº†å»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDeFiï¼‰çš„å‘å±•</li>
</ul>
<h4 data-id="heading-7">3. ğŸ¢ è”ç›Ÿé“¾å…´èµ·ï¼š"åŒºå—é“¾3.0"</h4>
<p>2016å¹´ä»¥åï¼Œ<strong>è”ç›Ÿé“¾</strong>å¼€å§‹å…´èµ·ï¼Œä¸»è¦é¢å‘ä¼ä¸šå’Œæœºæ„ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>éƒ¨åˆ†å»ä¸­å¿ƒåŒ–ï¼ˆç”±å¤šä¸ªæœºæ„å…±åŒç®¡ç†ï¼‰</li>
<li>æ›´é«˜çš„æ€§èƒ½å’Œååé‡</li>
<li>æ›´å¥½çš„éšç§ä¿æŠ¤</li>
<li>é€‚åˆä¼ä¸šçº§åº”ç”¨</li>
</ul>
<p><strong>ä»£è¡¨é¡¹ç›®</strong>ï¼š</p>
<ul>
<li>Hyperledger Fabricï¼ˆLinuxåŸºé‡‘ä¼šï¼‰</li>
<li>R3 Cordaï¼ˆé‡‘èè”ç›Ÿï¼‰</li>
<li>FISCO BCOSï¼ˆä¸­å›½å¼€æºè”ç›Ÿé“¾ï¼‰</li>
</ul>
<h4 data-id="heading-8">4. ğŸ”— è·¨é“¾æŠ€æœ¯ï¼š"åŒºå—é“¾çš„è¿æ¥å™¨"</h4>
<p>2018å¹´ä»¥åï¼Œ<strong>è·¨é“¾æŠ€æœ¯</strong>æˆä¸ºçƒ­ç‚¹ï¼Œè§£å†³ä¸åŒåŒºå—é“¾ä¹‹é—´çš„äº’æ“ä½œæ€§é—®é¢˜ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å®ç°ä¸åŒåŒºå—é“¾ä¹‹é—´çš„æ•°æ®å’Œèµ„äº§è½¬ç§»</li>
<li>æé«˜åŒºå—é“¾çš„äº’è”äº’é€š</li>
<li>æ”¯æŒè·¨é“¾äº¤æ˜“å’Œè·¨é“¾DeFi</li>
</ul>
<p><strong>ä»£è¡¨é¡¹ç›®</strong>ï¼š</p>
<ul>
<li>Polkadotï¼ˆå¹³è¡Œé“¾æ¶æ„ï¼‰</li>
<li>Cosmosï¼ˆåŒºå—é“¾äº’è”ç½‘ï¼‰</li>
<li>Avalancheï¼ˆé›ªå´©åè®®ï¼‰</li>
</ul>
<h4 data-id="heading-9">5. ğŸš€ Web3.0æ—¶ä»£ï¼š"å»ä¸­å¿ƒåŒ–äº’è”ç½‘"</h4>
<p>2020å¹´ä»¥åï¼Œ<strong>Web3.0</strong>æ¦‚å¿µå…´èµ·ï¼ŒåŒºå—é“¾æˆä¸ºWeb3.0çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å»ä¸­å¿ƒåŒ–çš„äº’è”ç½‘</li>
<li>ç”¨æˆ·æ‹¥æœ‰æ•°æ®æ‰€æœ‰æƒ</li>
<li>åŸºäºåŒºå—é“¾çš„èº«ä»½è®¤è¯</li>
<li>æ”¯æŒNFTã€å…ƒå®‡å®™ç­‰æ–°å…´åº”ç”¨</li>
</ul>
<h3 data-id="heading-10">ğŸ”§ æŠ€æœ¯åŸç†ï¼šåŒºå—é“¾çš„"ç§˜å¯†æ­¦å™¨"</h3>
<h4 data-id="heading-11">1. ğŸ“š åˆ†å¸ƒå¼è´¦æœ¬ï¼š"å…±äº«çš„è°·æ­Œæ–‡æ¡£"</h4>
<p>åˆ†å¸ƒå¼è´¦æœ¬æ˜¯åŒºå—é“¾çš„<strong>åŸºç¡€</strong>ï¼Œå®ƒæ˜¯ä¸€ç§<strong>åŒæ­¥ã€å¤åˆ¶ã€å…±äº«çš„æ•°æ®åº“</strong>ã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å®Œæ•´çš„è´¦æœ¬å‰¯æœ¬</li>
<li>æ–°äº¤æ˜“è¢«å¹¿æ’­åˆ°ç½‘ç»œä¸­çš„æ‰€æœ‰èŠ‚ç‚¹</li>
<li>èŠ‚ç‚¹éªŒè¯äº¤æ˜“çš„åˆæ³•æ€§</li>
<li>éªŒè¯é€šè¿‡çš„äº¤æ˜“è¢«æ‰“åŒ…æˆåŒºå—</li>
<li>åŒºå—è¢«æ·»åŠ åˆ°é“¾ä¸Šï¼Œæ‰€æœ‰èŠ‚ç‚¹æ›´æ–°è´¦æœ¬</li>
</ul>
<p><strong>æ¯”å–»</strong>ï¼šå°±åƒä¸€ä¸ªå…±äº«çš„è°·æ­Œæ–‡æ¡£ï¼Œæ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°ï¼Œè€Œä¸”æ²¡äººèƒ½å•ç‹¬ä¿®æ”¹ï¼Œä¿®æ”¹éœ€è¦æ‰€æœ‰äººåŒæ„ã€‚</p>
<h4 data-id="heading-12">2. ğŸ¤ å…±è¯†æœºåˆ¶ï¼š"ç½‘ç»œçš„æŠ•ç¥¨ç³»ç»Ÿ"</h4>
<p>å…±è¯†æœºåˆ¶æ˜¯åŒºå—é“¾çš„<strong>æ ¸å¿ƒ</strong>ï¼Œå®ƒå†³å®šäº†ç½‘ç»œä¸­çš„èŠ‚ç‚¹å¦‚ä½•è¾¾æˆä¸€è‡´ã€‚</p>
<p><strong>å¸¸è§çš„å…±è¯†æœºåˆ¶</strong>ï¼š</p>
<h5 data-id="heading-13">ğŸ”¨ PoWï¼ˆå·¥ä½œé‡è¯æ˜ï¼‰</h5>
<ul>
<li><strong>åŸç†</strong>ï¼šèŠ‚ç‚¹é€šè¿‡è§£å†³å¤æ‚çš„æ•°å­¦é—®é¢˜æ¥ç«äº‰è®°è´¦æƒ</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå®‰å…¨æ€§é«˜ã€å»ä¸­å¿ƒåŒ–ç¨‹åº¦é«˜</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šèƒ½è€—é«˜ã€äº¤æ˜“é€Ÿåº¦æ…¢</li>
<li><strong>ä»£è¡¨</strong>ï¼šæ¯”ç‰¹å¸ã€ä»¥å¤ªåŠï¼ˆè¿‡å»ï¼‰</li>
</ul>
<h5 data-id="heading-14">ğŸ† PoSï¼ˆæƒç›Šè¯æ˜ï¼‰</h5>
<ul>
<li><strong>åŸç†</strong>ï¼šèŠ‚ç‚¹æ ¹æ®æŒæœ‰çš„ä»£å¸æ•°é‡å’Œæ—¶é—´æ¥ç«äº‰è®°è´¦æƒ</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šèƒ½è€—ä½ã€äº¤æ˜“é€Ÿåº¦å¿«</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå¯èƒ½å¯¼è‡´ä¸­å¿ƒåŒ–ï¼ˆå¤§æˆ·ä¼˜åŠ¿ï¼‰</li>
<li><strong>ä»£è¡¨</strong>ï¼šä»¥å¤ªåŠï¼ˆç°åœ¨ï¼‰ã€Cardanoã€Solana</li>
</ul>
<h5 data-id="heading-15">ğŸ”„ DPoSï¼ˆå§”æ‰˜æƒç›Šè¯æ˜ï¼‰</h5>
<ul>
<li><strong>åŸç†</strong>ï¼šèŠ‚ç‚¹é€šè¿‡æŠ•ç¥¨é€‰ä¸¾ä»£è¡¨æ¥è®°è´¦</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šäº¤æ˜“é€Ÿåº¦å¿«ã€èƒ½è€—ä½</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå»ä¸­å¿ƒåŒ–ç¨‹åº¦é™ä½</li>
<li><strong>ä»£è¡¨</strong>ï¼šEOSã€TRON</li>
</ul>
<h5 data-id="heading-16">ğŸ” PBFTï¼ˆå®ç”¨æ‹œå åº­å®¹é”™ï¼‰</h5>
<ul>
<li><strong>åŸç†</strong>ï¼šé€šè¿‡èŠ‚ç‚¹ä¹‹é—´çš„æŠ•ç¥¨è¾¾æˆå…±è¯†</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šäº¤æ˜“é€Ÿåº¦å¿«ã€ç¡®å®šæ€§é«˜</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šæ‰©å±•æ€§å·®ï¼ˆèŠ‚ç‚¹æ•°é‡æœ‰é™ï¼‰</li>
<li><strong>ä»£è¡¨</strong>ï¼šHyperledger Fabricã€R3 Corda</li>
</ul>
<h4 data-id="heading-17">3. ğŸ“ æ™ºèƒ½åˆçº¦ï¼š"è‡ªåŠ¨æ‰§è¡Œçš„åˆçº¦"</h4>
<p>æ™ºèƒ½åˆçº¦æ˜¯åŒºå—é“¾çš„<strong>æ€æ‰‹çº§åº”ç”¨</strong>ï¼Œå®ƒæ˜¯ä¸€æ®µ<strong>è‡ªåŠ¨æ‰§è¡Œçš„ä»£ç </strong>ï¼Œä¸€æ—¦æ»¡è¶³æ¡ä»¶å°±ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<ul>
<li>æ™ºèƒ½åˆçº¦è¢«éƒ¨ç½²åˆ°åŒºå—é“¾ä¸Š</li>
<li>ç”¨æˆ·å‘é€äº¤æ˜“è§¦å‘æ™ºèƒ½åˆçº¦</li>
<li>æ™ºèƒ½åˆçº¦è‡ªåŠ¨æ‰§è¡Œé¢„å®šä¹‰çš„é€»è¾‘</li>
<li>æ‰§è¡Œç»“æœè¢«è®°å½•åˆ°åŒºå—é“¾ä¸Š</li>
</ul>
<p><strong>æ¯”å–»</strong>ï¼šå°±åƒä¸€ä¸ªè‡ªåŠ¨å”®è´§æœºï¼Œä½ æŠ•å…¥ç¡¬å¸ï¼ˆå‘é€äº¤æ˜“ï¼‰ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨ç»™ä½ å•†å“ï¼ˆæ‰§è¡Œåˆçº¦ï¼‰ã€‚</p>
<p><strong>ä»£ç å®ä¾‹</strong>ï¼šç®€å•çš„Solidityæ™ºèƒ½åˆçº¦ï¼ˆæŠ•ç¥¨åˆçº¦ï¼‰</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract SimpleVoting {
    // å€™é€‰äººæ˜ å°„ï¼ˆåœ°å€ =&gt; å¾—ç¥¨æ•°ï¼‰
    mapping(address =&gt; uint256) public votes;
  
    // æŠ•ç¥¨äº‹ä»¶
    event VoteCast(address indexed voter, address indexed candidate, uint256 voteCount);
  
    // æŠ•ç¥¨å‡½æ•°
    function vote(address candidate) external {
        // å¢åŠ å€™é€‰äººçš„å¾—ç¥¨æ•°
        votes[candidate] += 1;
      
        // è§¦å‘æŠ•ç¥¨äº‹ä»¶
        emit VoteCast(msg.sender, candidate, votes[candidate]);
    }
  
    // è·å–å€™é€‰äººå¾—ç¥¨æ•°
    function getVotes(address candidate) external view returns (uint256) {
        return votes[candidate];
    }
}
</code></pre>
<p><strong>ä»£ç è¯´æ˜</strong>ï¼š</p>
<ul>
<li>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æŠ•ç¥¨åˆçº¦ï¼Œå…è®¸ç”¨æˆ·ç»™å€™é€‰äººæŠ•ç¥¨</li>
<li>ä½¿ç”¨mappingå­˜å‚¨å€™é€‰äººçš„å¾—ç¥¨æ•°</li>
<li>æŠ•ç¥¨åè§¦å‘VoteCastäº‹ä»¶</li>
<li>å¯ä»¥é€šè¿‡getVoteså‡½æ•°æŸ¥è¯¢å€™é€‰äººçš„å¾—ç¥¨æ•°</li>
</ul>
<h4 data-id="heading-18">4. ğŸ”’ åŠ å¯†ç®—æ³•ï¼š"åŒºå—é“¾çš„å®‰å…¨ä¿éšœ"</h4>
<p>åŒºå—é“¾ä½¿ç”¨å¤šç§å¯†ç å­¦ç®—æ³•æ¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§å’Œéšç§æ€§ã€‚</p>
<p><strong>ä¸»è¦åŠ å¯†ç®—æ³•</strong>ï¼š</p>
<ul>
<li><strong>å“ˆå¸Œç®—æ³•</strong>ï¼šå°†ä»»æ„é•¿åº¦çš„æ•°æ®è½¬æ¢ä¸ºå›ºå®šé•¿åº¦çš„å“ˆå¸Œå€¼ï¼ˆå¦‚SHA-256ï¼‰</li>
<li><strong>éå¯¹ç§°åŠ å¯†</strong>ï¼šä½¿ç”¨å…¬é’¥å’Œç§é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼ˆå¦‚RSAã€ECDSAï¼‰</li>
<li><strong>æ•°å­—ç­¾å</strong>ï¼šè¯æ˜äº¤æ˜“çš„åˆæ³•æ€§å’Œä¸å¯å¦è®¤æ€§</li>
<li><strong>é›¶çŸ¥è¯†è¯æ˜</strong>ï¼šåœ¨ä¸æ³„éœ²ä¿¡æ¯çš„æƒ…å†µä¸‹è¯æ˜æŸä»¶äº‹çš„çœŸå®æ€§</li>
</ul>
<h4 data-id="heading-19">5. ğŸ“± DAppï¼š"å»ä¸­å¿ƒåŒ–åº”ç”¨"</h4>
<p>DAppæ˜¯è¿è¡Œåœ¨åŒºå—é“¾ä¸Šçš„<strong>å»ä¸­å¿ƒåŒ–åº”ç”¨</strong>ï¼Œå®ƒä¸ä¾èµ–äºä¸­å¿ƒåŒ–æœåŠ¡å™¨ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å¼€æºä»£ç </li>
<li>è¿è¡Œåœ¨åŒºå—é“¾ä¸Š</li>
<li>ä½¿ç”¨åŠ å¯†è´§å¸ä½œä¸ºç‡ƒæ–™</li>
<li>å»ä¸­å¿ƒåŒ–çš„æ²»ç†</li>
</ul>
<p><strong>å¸¸è§çš„DApp</strong>ï¼š</p>
<ul>
<li>å»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼ˆDEXï¼‰ï¼šUniswapã€SushiSwap</li>
<li>å€Ÿè´·å¹³å°ï¼šAaveã€Compound</li>
<li>NFTå¸‚åœºï¼šOpenSeaã€LooksRare</li>
<li>æ¸¸æˆï¼šAxie Infinityã€Decentraland</li>
</ul>
<h3 data-id="heading-20">ğŸ“Š è¶£å‘³å¯¹æ¯”ï¼šå…¬é“¾ vs è”ç›Ÿé“¾ vs ç§æœ‰é“¾</h3>







































































<table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>å…¬é“¾ï¼ˆPublic Chainï¼‰</th><th>è”ç›Ÿé“¾ï¼ˆConsortium Chainï¼‰</th><th>ç§æœ‰é“¾ï¼ˆPrivate Chainï¼‰</th></tr></thead><tbody><tr><td>ğŸ”—<strong>å»ä¸­å¿ƒåŒ–ç¨‹åº¦</strong></td><td>å®Œå…¨å»ä¸­å¿ƒåŒ–</td><td>éƒ¨åˆ†å»ä¸­å¿ƒåŒ–</td><td>ä¸­å¿ƒåŒ–</td></tr><tr><td>ğŸ”’<strong>æƒé™æ§åˆ¶</strong></td><td>æ— æƒé™é™åˆ¶ï¼Œä»»ä½•äººéƒ½å¯ä»¥å‚ä¸</td><td>æœ‰é™æƒé™ï¼Œåªæœ‰æˆæƒèŠ‚ç‚¹å¯ä»¥å‚ä¸</td><td>ä¸¥æ ¼æƒé™ï¼Œåªæœ‰å†…éƒ¨èŠ‚ç‚¹å¯ä»¥å‚ä¸</td></tr><tr><td>âš¡<strong>äº¤æ˜“é€Ÿåº¦</strong></td><td>æ…¢ï¼ˆæ¯ç§’å‡ åˆ°å‡ åƒç¬”ï¼‰</td><td>å¿«ï¼ˆæ¯ç§’å‡ åƒåˆ°å‡ ä¸‡ç¬”ï¼‰</td><td>éå¸¸å¿«ï¼ˆæ¯ç§’å‡ ä¸‡åˆ°å‡ åä¸‡ç¬”ï¼‰</td></tr><tr><td>ğŸ’¡<strong>å…±è¯†æœºåˆ¶</strong></td><td>PoWã€PoSç­‰</td><td>PBFTã€Raftç­‰</td><td>PBFTã€Raftç­‰</td></tr><tr><td>ğŸ’°<strong>æˆæœ¬</strong></td><td>ä½ï¼ˆåªéœ€æ”¯ä»˜äº¤æ˜“è´¹ï¼‰</td><td>ä¸­ï¼ˆéœ€è¦æ­å»ºå’Œç»´æŠ¤èŠ‚ç‚¹ï¼‰</td><td>é«˜ï¼ˆéœ€è¦è´­ä¹°å’Œç»´æŠ¤ç¡¬ä»¶ï¼‰</td></tr><tr><td>ğŸ”<strong>éšç§æ€§</strong></td><td>ä½ï¼ˆäº¤æ˜“å…¬å¼€é€æ˜ï¼‰</td><td>ä¸­ï¼ˆéƒ¨åˆ†äº¤æ˜“å¯ä»¥ä¿å¯†ï¼‰</td><td>é«˜ï¼ˆäº¤æ˜“å®Œå…¨ä¿å¯†ï¼‰</td></tr><tr><td>ğŸ¢<strong>é€‚ç”¨åœºæ™¯</strong></td><td>åŠ å¯†è´§å¸ã€DeFiã€NFT</td><td>ä¾›åº”é“¾ã€é‡‘èã€æ”¿åŠ¡</td><td>ä¼ä¸šå†…éƒ¨ç®¡ç†ã€ç§æœ‰æ•°æ®å­˜å‚¨</td></tr><tr><td>ğŸ“Š<strong>ä»£è¡¨é¡¹ç›®</strong></td><td>æ¯”ç‰¹å¸ã€ä»¥å¤ªåŠã€Solana</td><td>Hyperledger Fabricã€R3 Corda</td><td>ä¼ä¸šç§æœ‰åŒºå—é“¾</td></tr><tr><td>ğŸ¯<strong>ä¼˜åŠ¿</strong></td><td>å»ä¸­å¿ƒåŒ–ã€å®‰å…¨æ€§é«˜ã€é€æ˜åº¦é«˜</td><td>äº¤æ˜“é€Ÿåº¦å¿«ã€éšç§æ€§å¥½ã€æˆæœ¬é€‚ä¸­</td><td>å®Œå…¨å¯æ§ã€äº¤æ˜“é€Ÿåº¦å¿«ã€éšç§æ€§é«˜</td></tr><tr><td>ğŸ“‰<strong>åŠ£åŠ¿</strong></td><td>äº¤æ˜“é€Ÿåº¦æ…¢ã€èƒ½è€—é«˜ã€æ‰©å±•æ€§å·®</td><td>å»ä¸­å¿ƒåŒ–ç¨‹åº¦é™ä½ã€éœ€è¦ä¿¡ä»»æœºåˆ¶</td><td>ä¸­å¿ƒåŒ–é£é™©ã€ç¼ºä¹å¼€æ”¾æ€§</td></tr></tbody></table>
<h3 data-id="heading-21">ğŸ’» ä»£ç å®ä¾‹ï¼šä½¿ç”¨Web3.pyä¸åŒºå—é“¾äº¤äº’</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> web3 <span class="hljs-keyword">import</span> Web3
<span class="hljs-keyword">import</span> json

<span class="hljs-comment"># è¿æ¥åˆ°ä»¥å¤ªåŠèŠ‚ç‚¹ï¼ˆä½¿ç”¨Infuraï¼‰</span>
infura_url = <span class="hljs-string">"https://mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID"</span>
web3 = Web3(Web3.HTTPProvider(infura_url))

<span class="hljs-comment"># æ£€æŸ¥è¿æ¥æ˜¯å¦æˆåŠŸ</span>
<span class="hljs-keyword">if</span> web3.is_connected():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… å·²è¿æ¥åˆ°ä»¥å¤ªåŠä¸»ç½‘"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ è¿æ¥å¤±è´¥"</span>)
    exit()

<span class="hljs-comment"># è·å–æœ€æ–°åŒºå—å·</span>
latest_block = web3.eth.block_number
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ“‹ æœ€æ–°åŒºå—å·ï¼š<span class="hljs-subst">{latest_block}</span>"</span>)

<span class="hljs-comment"># è·å–åŒºå—ä¿¡æ¯</span>
block = web3.eth.get_block(latest_block)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ”— åŒºå—å“ˆå¸Œï¼š<span class="hljs-subst">{block.<span class="hljs-built_in">hash</span>.<span class="hljs-built_in">hex</span>()}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"â±ï¸ åŒºå—æ—¶é—´æˆ³ï¼š<span class="hljs-subst">{block.timestamp}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ“Š åŒºå—äº¤æ˜“æ•°é‡ï¼š<span class="hljs-subst">{<span class="hljs-built_in">len</span>(block.transactions)}</span>"</span>)

<span class="hljs-comment"># è·å–Gasä»·æ ¼</span>
 gas_price = web3.eth.gas_price
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"â›½ Gasä»·æ ¼ï¼š<span class="hljs-subst">{web3.from_wei(gas_price, <span class="hljs-string">'gwei'</span>)}</span> Gwei"</span>)

<span class="hljs-comment"># è·å–ä»¥å¤ªåŠä»·æ ¼ï¼ˆä½¿ç”¨CoinGecko APIï¼‰</span>
<span class="hljs-keyword">import</span> requests

<span class="hljs-keyword">try</span>:
    response = requests.get(<span class="hljs-string">"https://api.coingecko.com/api/v3/simple/price?ids=ethereum&amp;vs_currencies=usd"</span>)
    <span class="hljs-keyword">if</span> response.status_code == <span class="hljs-number">200</span>:
        eth_price = response.json()[<span class="hljs-string">"ethereum"</span>][<span class="hljs-string">"usd"</span>]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ’° ä»¥å¤ªåŠä»·æ ¼ï¼š$<span class="hljs-subst">{eth_price}</span>"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ è·å–ä»¥å¤ªåŠä»·æ ¼å¤±è´¥"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ è·å–ä»¥å¤ªåŠä»·æ ¼å¤±è´¥ï¼š<span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<p><strong>è¿è¡Œç»“æœ</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">âœ… å·²è¿æ¥åˆ°ä»¥å¤ªåŠä¸»ç½‘
ğŸ“‹ æœ€æ–°åŒºå—å·ï¼š19000000
ğŸ”— åŒºå—å“ˆå¸Œï¼š0x123456789abcdef123456789abcdef123456789abcdef123456789abcdef12345
â±ï¸ åŒºå—æ—¶é—´æˆ³ï¼š1736284800
ğŸ“Š åŒºå—äº¤æ˜“æ•°é‡ï¼š150
â›½ Gasä»·æ ¼ï¼š20 Gwei
ğŸ’° ä»¥å¤ªåŠä»·æ ¼ï¼š<span class="hljs-variable">$3000</span>
</code></pre>
<h3 data-id="heading-22">ğŸ¢ åŒºå—é“¾çš„åº”ç”¨åœºæ™¯ï¼šä»é‡‘èåˆ°ä¾›åº”é“¾</h3>



























































<table><thead><tr><th>åº”ç”¨åœºæ™¯</th><th>å…·ä½“åº”ç”¨</th><th>æŠ€æœ¯ä¼˜åŠ¿</th><th>ä»£è¡¨é¡¹ç›®</th></tr></thead><tbody><tr><td>ğŸ’°<strong>é‡‘èé¢†åŸŸ</strong></td><td>è·¨å¢ƒæ”¯ä»˜ã€DeFiã€ç¨³å®šå¸ã€ä¿é™©</td><td>é™ä½æˆæœ¬ã€æé«˜é€Ÿåº¦ã€å¢å¼ºå®‰å…¨æ€§</td><td>æ¯”ç‰¹å¸ã€ä»¥å¤ªåŠã€USDTã€Aave</td></tr><tr><td>ğŸšš<strong>ä¾›åº”é“¾é¢†åŸŸ</strong></td><td>å•†å“æº¯æºã€åº“å­˜ç®¡ç†ã€ç‰©æµè·Ÿè¸ª</td><td>æé«˜é€æ˜åº¦ã€å‡å°‘æ¬ºè¯ˆã€ä¼˜åŒ–æµç¨‹</td><td>IBM Food Trustã€ Walmart Food Traceability</td></tr><tr><td>ğŸ¥<strong>åŒ»ç–—é¢†åŸŸ</strong></td><td>ç—…å†ç®¡ç†ã€è¯å“æº¯æºã€ä¸´åºŠè¯•éªŒæ•°æ®</td><td>ä¿æŠ¤éšç§ã€æé«˜æ•°æ®å®‰å…¨æ€§ã€å®ç°æ•°æ®å…±äº«</td><td>Medicalchainã€Patientory</td></tr><tr><td>ğŸ“‹<strong>æ”¿åŠ¡é¢†åŸŸ</strong></td><td>ç”µå­æŠ•ç¥¨ã€èº«ä»½è®¤è¯ã€ä¸åŠ¨äº§ç™»è®°ã€çŸ¥è¯†äº§æƒä¿æŠ¤</td><td>æé«˜é€æ˜åº¦ã€å‡å°‘è…è´¥ã€æé«˜æ•ˆç‡</td><td>è¿ªæ‹œåŒºå—é“¾æˆ˜ç•¥ã€ä¸­å›½åŒºå—é“¾æœåŠ¡ç½‘ç»œï¼ˆBSNï¼‰</td></tr><tr><td>ğŸ¨<strong>æ–‡åŒ–é¢†åŸŸ</strong></td><td>NFTæ•°å­—è‰ºæœ¯ã€ç‰ˆæƒä¿æŠ¤ã€æ•°å­—è—å“</td><td>è¯æ˜æ‰€æœ‰æƒã€é˜²æ­¢ç›—ç‰ˆã€æé«˜äº¤æ˜“æ•ˆç‡</td><td>OpenSeaã€Nifty Gatewayã€ç™¾åº¦è¶…çº§é“¾æ•°å­—è—å“</td></tr><tr><td>ğŸ <strong>æˆ¿åœ°äº§é¢†åŸŸ</strong></td><td>æˆ¿äº§äº¤æ˜“ã€ç§Ÿèµç®¡ç†ã€äº§æƒç™»è®°</td><td>é™ä½äº¤æ˜“æˆæœ¬ã€æé«˜é€æ˜åº¦ã€å‡å°‘æ¬ºè¯ˆ</td><td>Propyã€Ubitquity</td></tr><tr><td>ğŸš—<strong>æ±½è½¦é¢†åŸŸ</strong></td><td>è½¦è¾†æº¯æºã€å…±äº«æ±½è½¦ã€è‡ªåŠ¨é©¾é©¶æ•°æ®</td><td>æé«˜å®‰å…¨æ€§ã€å®ç°æ•°æ®å…±äº«ã€ä¼˜åŒ–æµç¨‹</td><td>VeChainã€MOBI</td></tr><tr><td>ğŸ“±<strong>ç‰©è”ç½‘é¢†åŸŸ</strong></td><td>è®¾å¤‡èº«ä»½è®¤è¯ã€æ•°æ®å®‰å…¨ã€æ™ºèƒ½åˆçº¦è‡ªåŠ¨æ‰§è¡Œ</td><td>æé«˜å®‰å…¨æ€§ã€å‡å°‘ä¸­é—´ç¯èŠ‚ã€é™ä½æˆæœ¬</td><td>IOTAã€Filament</td></tr></tbody></table>
<h3 data-id="heading-23">ğŸ“ˆ æ•°æ®æ”¯æ’‘ï¼šåŒºå—é“¾çš„"ç¡¬æ ¸å®åŠ›"</h3>
<ul>
<li>ğŸ“Š <strong>å…¨çƒåŒºå—é“¾å¸‚åœºè§„æ¨¡é¢„è®¡2025å¹´è¾¾395äº¿ç¾å…ƒ</strong>ï¼Œå¹´å¤åˆå¢é•¿ç‡ï¼ˆCAGRï¼‰è¾¾65.7%</li>
<li>ğŸ¦ <strong>80%çš„é“¶è¡Œè®¡åˆ’é‡‡ç”¨åŒºå—é“¾æŠ€æœ¯</strong>ï¼Œä¸»è¦ç”¨äºè·¨å¢ƒæ”¯ä»˜å’Œç»“ç®—</li>
<li>ğŸ’± <strong>è·¨å¢ƒæ”¯ä»˜æˆæœ¬å¯é™ä½40-80%</strong>ï¼Œäº¤æ˜“æ—¶é—´ä»å‡ å¤©ç¼©çŸ­åˆ°å‡ ç§’</li>
<li>ğŸšš <strong>ä¾›åº”é“¾æº¯æºå¯å‡å°‘20-30%çš„æ¬ºè¯ˆæŸå¤±</strong></li>
<li>ğŸ¨ <strong>NFTå¸‚åœºè§„æ¨¡2024å¹´è¾¾231äº¿ç¾å…ƒ</strong>ï¼Œå¹´å¢é•¿ç‡è¾¾40%</li>
<li>ğŸ”— <strong>DeFié”ä»“é‡ï¼ˆTVLï¼‰æœ€é«˜è¾¾1800äº¿ç¾å…ƒ</strong></li>
<li>ğŸ“± <strong>å…¨çƒåŒºå—é“¾é’±åŒ…ç”¨æˆ·è¶…è¿‡1.5äº¿</strong>ï¼Œå¹´å¢é•¿ç‡è¾¾50%</li>
<li>ğŸŒ <strong>Web3.0å¸‚åœºè§„æ¨¡é¢„è®¡2030å¹´è¾¾1ä¸‡äº¿ç¾å…ƒ</strong></li>
</ul>
<h3 data-id="heading-24">âš ï¸ å¸¸è§è¯¯åŒºçº æ­£</h3>
<h4 data-id="heading-25">1. "åŒºå—é“¾å°±æ˜¯æ¯”ç‰¹å¸ï¼Ÿ"</h4>
<p><strong>é”™ï¼</strong> æ¯”ç‰¹å¸åªæ˜¯åŒºå—é“¾çš„ç¬¬ä¸€ä¸ªåº”ç”¨ï¼ŒåŒºå—é“¾æ˜¯ä¸€ç§åº•å±‚æŠ€æœ¯ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–åº”ç”¨ã€‚</p>
<h4 data-id="heading-26">2. "åŒºå—é“¾æ˜¯å®Œå…¨å»ä¸­å¿ƒåŒ–çš„ï¼Ÿ"</h4>
<p><strong>ä¸ä¸€å®šï¼</strong> åŒºå—é“¾çš„å»ä¸­å¿ƒåŒ–ç¨‹åº¦å–å†³äºå…±è¯†æœºåˆ¶å’Œç½‘ç»œè®¾è®¡ï¼Œè”ç›Ÿé“¾å’Œç§æœ‰é“¾æ˜¯éƒ¨åˆ†æˆ–å®Œå…¨ä¸­å¿ƒåŒ–çš„ã€‚</p>
<h4 data-id="heading-27">3. "åŒºå—é“¾æ˜¯åŒ¿åçš„ï¼Ÿ"</h4>
<p><strong>é”™ï¼</strong> åŒºå—é“¾æ˜¯"ä¼ªåŒ¿å"çš„ï¼Œäº¤æ˜“è®°å½•å…¬å¼€é€æ˜ï¼Œé€šè¿‡é“¾ä¸Šåˆ†æå¯ä»¥è¿½è¸ªåˆ°çœŸå®èº«ä»½ã€‚</p>
<h4 data-id="heading-28">4. "åŒºå—é“¾æ˜¯ç»å¯¹å®‰å…¨çš„ï¼Ÿ"</h4>
<p><strong>é”™ï¼</strong> åŒºå—é“¾ä¹Ÿæœ‰å®‰å…¨é£é™©ï¼Œæ¯”å¦‚51%æ”»å‡»ã€æ™ºèƒ½åˆçº¦æ¼æ´ã€ç§é’¥æ³„éœ²ç­‰ã€‚</p>
<h4 data-id="heading-29">5. "åŒºå—é“¾ä¼šå–ä»£äº’è”ç½‘ï¼Ÿ"</h4>
<p><strong>é”™ï¼</strong> åŒºå—é“¾ä¸ä¼šå–ä»£äº’è”ç½‘ï¼Œè€Œæ˜¯ä½œä¸ºäº’è”ç½‘çš„è¡¥å……ï¼Œè§£å†³äº’è”ç½‘çš„ä¸€äº›é—®é¢˜ï¼ˆå¦‚æ•°æ®æ‰€æœ‰æƒã€ä¿¡ä»»ç­‰ï¼‰ã€‚</p>
<h4 data-id="heading-30">6. "æ™ºèƒ½åˆçº¦æ˜¯å®Œç¾çš„ï¼Ÿ"</h4>
<p><strong>é”™ï¼</strong> æ™ºèƒ½åˆçº¦ä¹Ÿæœ‰ç¼ºé™·ï¼Œæ¯”å¦‚ä»£ç æ¼æ´ã€ç¼ºä¹æ³•å¾‹ç›‘ç®¡ã€æ‰§è¡Œä¸å¯é€†ç­‰ã€‚</p>
<h4 data-id="heading-31">7. "åŒºå—é“¾çš„èƒ½è€—å¾ˆé«˜ï¼Ÿ"</h4>
<p><strong>ä¸ä¸€å®šï¼</strong> åªæœ‰PoWå…±è¯†æœºåˆ¶çš„åŒºå—é“¾èƒ½è€—é«˜ï¼ŒPoSã€DPoSç­‰å…±è¯†æœºåˆ¶çš„èƒ½è€—å¾ˆä½ã€‚</p>
<h4 data-id="heading-32">8. "åŒºå—é“¾é€‚åˆæ‰€æœ‰åœºæ™¯ï¼Ÿ"</h4>
<p><strong>é”™ï¼</strong> åŒºå—é“¾é€‚åˆéœ€è¦ä¿¡ä»»ã€é€æ˜åº¦ã€ä¸å¯ç¯¡æ”¹çš„åœºæ™¯ï¼Œä¸é€‚åˆæ‰€æœ‰åœºæ™¯ï¼ˆæ¯”å¦‚å®æ—¶æ€§è¦æ±‚æé«˜çš„åœºæ™¯ï¼‰ã€‚</p>
<h3 data-id="heading-33">ğŸ”® æœªæ¥å±•æœ›ï¼šåŒºå—é“¾çš„å‘å±•è¶‹åŠ¿</h3>
<h4 data-id="heading-34">1. ğŸš€ æ‰©å±•æ€§æå‡</h4>
<ul>
<li><strong>Layer 2è§£å†³æ–¹æ¡ˆ</strong>ï¼šå¦‚ä»¥å¤ªåŠçš„Rollupsï¼Œæé«˜äº¤æ˜“é€Ÿåº¦å’Œé™ä½æˆæœ¬</li>
<li><strong>åˆ†ç‰‡æŠ€æœ¯</strong>ï¼šå°†åŒºå—é“¾åˆ†æˆå¤šä¸ªåˆ†ç‰‡ï¼Œå¹¶è¡Œå¤„ç†äº¤æ˜“</li>
<li><strong>æ–°å‹å…±è¯†æœºåˆ¶</strong>ï¼šæ›´é«˜æ•ˆã€æ›´å®‰å…¨çš„å…±è¯†æœºåˆ¶</li>
</ul>
<h4 data-id="heading-35">2. ğŸ”— è·¨é“¾æŠ€æœ¯æˆç†Ÿ</h4>
<ul>
<li><strong>äº’æ“ä½œæ€§å¢å¼º</strong>ï¼šä¸åŒåŒºå—é“¾ä¹‹é—´å¯ä»¥æ— ç¼äº¤äº’</li>
<li><strong>è·¨é“¾æ¡¥</strong>ï¼šæ›´å®‰å…¨ã€æ›´é«˜æ•ˆçš„è·¨é“¾æ¡¥</li>
<li><strong>ç»Ÿä¸€çš„è·¨é“¾æ ‡å‡†</strong>ï¼šåˆ¶å®šè¡Œä¸šæ ‡å‡†ï¼Œä¿ƒè¿›è·¨é“¾ç”Ÿæ€å‘å±•</li>
</ul>
<h4 data-id="heading-36">3. â˜ï¸ åŒºå—é“¾å³æœåŠ¡ï¼ˆBaaSï¼‰æ™®åŠ</h4>
<ul>
<li><strong>äº‘æœåŠ¡å•†æä¾›BaaS</strong>ï¼šAWSã€Azureã€é˜¿é‡Œäº‘ç­‰æä¾›åŒºå—é“¾æœåŠ¡</li>
<li><strong>é™ä½ä½¿ç”¨é—¨æ§›</strong>ï¼šä¼ä¸šå¯ä»¥å¿«é€Ÿéƒ¨ç½²å’Œä½¿ç”¨åŒºå—é“¾</li>
<li><strong>æ ‡å‡†åŒ–æœåŠ¡</strong>ï¼šæä¾›æ ‡å‡†åŒ–çš„APIå’Œå·¥å…·</li>
</ul>
<h4 data-id="heading-37">4. ğŸ§  AIä¸åŒºå—é“¾ç»“åˆ</h4>
<ul>
<li><strong>AIé©±åŠ¨çš„åŒºå—é“¾</strong>ï¼šä½¿ç”¨AIä¼˜åŒ–åŒºå—é“¾çš„æ€§èƒ½å’Œå®‰å…¨æ€§</li>
<li><strong>åŒºå—é“¾å¢å¼ºçš„AI</strong>ï¼šä½¿ç”¨åŒºå—é“¾ä¿æŠ¤AIæ¨¡å‹å’Œæ•°æ®</li>
<li><strong>å»ä¸­å¿ƒåŒ–AI</strong>ï¼šåŸºäºåŒºå—é“¾çš„å»ä¸­å¿ƒåŒ–AIè®­ç»ƒå’Œæ¨ç†</li>
</ul>
<h4 data-id="heading-38">5. ğŸŒ Web3.0å’Œå…ƒå®‡å®™</h4>
<ul>
<li><strong>åŒºå—é“¾æˆä¸ºWeb3.0æ ¸å¿ƒ</strong>ï¼šæ”¯æŒå»ä¸­å¿ƒåŒ–èº«ä»½ã€æ•°æ®æ‰€æœ‰æƒç­‰</li>
<li><strong>å…ƒå®‡å®™åŸºç¡€è®¾æ–½</strong>ï¼šNFTã€è™šæ‹ŸåœŸåœ°ã€å»ä¸­å¿ƒåŒ–é‡‘èç­‰</li>
<li><strong>ç”¨æˆ·ä½“éªŒæå‡</strong>ï¼šæ›´å‹å¥½çš„é’±åŒ…ã€æ›´æµç•…çš„äº¤æ˜“ä½“éªŒ</li>
</ul>
<h3 data-id="heading-39">ğŸ“ äº’åŠ¨å°æµ‹éªŒï¼šä½ ç­”å¯¹äº†å—ï¼Ÿ</h3>


















































<table><thead><tr><th>é—®é¢˜</th><th>ç­”æ¡ˆ</th><th>ä½ ç­”å¯¹äº†å—ï¼Ÿ</th></tr></thead><tbody><tr><td>åŒºå—é“¾çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</td><td>åˆ†å¸ƒå¼è´¦æœ¬æŠ€æœ¯</td><td>âœ…/âŒ</td></tr><tr><td>æ¯”ç‰¹å¸è¯ç”Ÿäºå“ªä¸€å¹´ï¼Ÿ</td><td>2009å¹´</td><td>âœ…/âŒ</td></tr><tr><td>ä»¥å¤ªåŠçš„æ™ºèƒ½åˆçº¦ä½¿ç”¨ä»€ä¹ˆè¯­è¨€ï¼Ÿ</td><td>Solidity</td><td>âœ…/âŒ</td></tr><tr><td>PoSå…±è¯†æœºåˆ¶çš„ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</td><td>èƒ½è€—ä½ã€äº¤æ˜“é€Ÿåº¦å¿«</td><td>âœ…/âŒ</td></tr><tr><td>è”ç›Ÿé“¾çš„å»ä¸­å¿ƒåŒ–ç¨‹åº¦å¦‚ä½•ï¼Ÿ</td><td>éƒ¨åˆ†å»ä¸­å¿ƒåŒ–</td><td>âœ…/âŒ</td></tr><tr><td>åŒºå—é“¾çš„äº”å¤§ç‰¹å¾æ˜¯ä»€ä¹ˆï¼Ÿ</td><td>åˆ†å¸ƒå¼ã€ä¸å¯ç¯¡æ”¹ã€æ—¶åºæ€§ã€å…±è¯†æœºåˆ¶ã€åŠ å¯†å®‰å…¨</td><td>âœ…/âŒ</td></tr><tr><td>DeFiçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼Ÿ</td><td>å»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDecentralized Financeï¼‰</td><td>âœ…/âŒ</td></tr><tr><td>NFTçš„å…¨ç§°æ˜¯ä»€ä¹ˆï¼Ÿ</td><td>éåŒè´¨åŒ–ä»£å¸ï¼ˆNon-Fungible Tokenï¼‰</td><td>âœ…/âŒ</td></tr></tbody></table>
<h3 data-id="heading-40">ğŸ¯ ç»“è¯­ï¼šåŒºå—é“¾â€”â€”ä¿¡ä»»çš„æœºå™¨</h3>
<p>åŒºå—é“¾çš„æ ¸å¿ƒä»·å€¼æ˜¯<strong>å»ºç«‹ä¿¡ä»»</strong>ï¼Œå®ƒæ˜¯ä¸€å°"<strong>ä¿¡ä»»çš„æœºå™¨</strong>"ã€‚</p>
<p>ä»æ¯”ç‰¹å¸åˆ°Web3.0ï¼ŒåŒºå—é“¾æŠ€æœ¯æ­£åœ¨æ”¹å˜æˆ‘ä»¬çš„ç”Ÿæ´»å’Œå·¥ä½œæ–¹å¼ã€‚å®ƒä¸ä»…å¯ä»¥ç”¨äºåŠ å¯†è´§å¸ï¼Œè¿˜å¯ä»¥åº”ç”¨äºé‡‘èã€ä¾›åº”é“¾ã€åŒ»ç–—ã€æ”¿åŠ¡ç­‰å¤šä¸ªé¢†åŸŸã€‚</p>
<p><strong>è®°ä½</strong>ï¼š</p>
<ul>
<li>ğŸ”— åŒºå—é“¾ä¸æ˜¯ä¸‡èƒ½çš„ï¼Œä½†å®ƒæ˜¯ä¸€é¡¹é©å‘½æ€§çš„æŠ€æœ¯</li>
<li>ğŸ’¡ åŒºå—é“¾çš„ä»·å€¼åœ¨äºè§£å†³ä¿¡ä»»é—®é¢˜</li>
<li>ğŸš€ åŒºå—é“¾çš„æœªæ¥åœ¨äºä¸å…¶ä»–æŠ€æœ¯ï¼ˆAIã€ç‰©è”ç½‘ã€5Gç­‰ï¼‰çš„ç»“åˆ</li>
<li>ğŸ“Š åŒºå—é“¾çš„åº”ç”¨éœ€è¦å¾ªåºæ¸è¿›ï¼Œä¸èƒ½ä¸€è¹´è€Œå°±</li>
</ul>
<p>ä¸‹æ¬¡å½“ä½ å¬åˆ°"åŒºå—é“¾"è¿™ä¸ªè¯æ—¶ï¼Œä¸è¦åªæƒ³åˆ°æ¯”ç‰¹å¸â€”â€”æƒ³æƒ³å®ƒæ›´å¹¿æ³›çš„åº”ç”¨ï¼Œæƒ³æƒ³å®ƒå¦‚ä½•æ”¹å˜æˆ‘ä»¬çš„ä¸–ç•Œï¼</p>
<h3 data-id="heading-41">ğŸ’¬ äº’åŠ¨è¯é¢˜</h3>
<ol>
<li>ä½ å¯¹åŒºå—é“¾çš„å°è±¡æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯åŠ å¯†è´§å¸è¿˜æ˜¯æŠ€æœ¯é©å‘½ï¼Ÿ</li>
<li>ä½ ä½¿ç”¨è¿‡å“ªäº›åŒºå—é“¾åº”ç”¨ï¼Ÿä½“éªŒå¦‚ä½•ï¼Ÿ</li>
<li>ä½ è§‰å¾—åŒºå—é“¾åœ¨å“ªä¸ªé¢†åŸŸçš„åº”ç”¨æœ€æœ‰å‰æ™¯ï¼Ÿ</li>
<li>ä½ å¯¹Web3.0å’Œå…ƒå®‡å®™æœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ</li>
<li>ä½ è®¤ä¸ºåŒºå—é“¾ä¼šå¦‚ä½•æ”¹å˜æˆ‘ä»¬çš„ç”Ÿæ´»ï¼Ÿ</li>
</ol>
<p>å¿«æ¥è¯„è®ºåŒºèŠèŠä½ çš„æƒ³æ³•ï¼ğŸ’¬ ç‚¹èµæ”¶è—ä¸è¿·è·¯ï¼Œå’±ä»¬ä¸‹æœŸç»§ç»­æ¢ç´¢è®¡ç®—æœºçš„"åä¸‡ä¸ªä¸ºä»€ä¹ˆ"ï¼ğŸ‰</p>
<p><strong>å…³æ³¨æˆ‘</strong>ï¼Œä¸‹æœŸå¸¦ä½ è§£é”æ›´å¤šè®¡ç®—æœºçš„"å¥‡è‘©å†·çŸ¥è¯†"ï¼ğŸ¤“</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Pythonå¼‚å¸¸é“¾ï¼šè°æ‰æ˜¯ç½ªé­ç¥¸é¦–ï¼Ÿä¸€æ¢"The above exception"çš„æ—¶é—´é¡ºåº]]></title>    <link>https://juejin.cn/post/7592148975849504811</link>    <guid>https://juejin.cn/post/7592148975849504811</guid>    <pubDate>2026-01-07T15:15:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592148975849504811" data-draft-id="7592148975849488427" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Pythonå¼‚å¸¸é“¾ï¼šè°æ‰æ˜¯ç½ªé­ç¥¸é¦–ï¼Ÿä¸€æ¢&quot;The above exception&quot;çš„æ—¶é—´é¡ºåº"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-07T15:15:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆé‡Œè°¢é¡¿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Pythonå¼‚å¸¸é“¾ï¼šè°æ‰æ˜¯ç½ªé­ç¥¸é¦–ï¼Ÿä¸€æ¢"The above exception"çš„æ—¶é—´é¡ºåº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆé‡Œè°¢é¡¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T15:15:27.000Z" title="Wed Jan 07 2026 15:15:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Pythonå¼‚å¸¸é“¾ï¼šè°æ‰æ˜¯ç½ªé­ç¥¸é¦–ï¼Ÿä¸€æ¢"The above exception"çš„æ—¶é—´é¡ºåº</h2>
<blockquote>
<p>å½“ä½ çœ‹åˆ°PythonæŠ¥é”™ä¿¡æ¯ä¸­çš„"The above exception was the direct cause of the following exception"æ—¶ï¼Œæ˜¯å¦æ›¾ç–‘æƒ‘è¿‡ï¼šåˆ°åº•å“ªä¸ªå¼‚å¸¸å…ˆå‘ç”Ÿï¼Ÿå“ªä¸ªæ‰æ˜¯é—®é¢˜çš„æ ¹æºï¼Ÿæœ¬æ–‡å°†æ·±å…¥Pythonå¼‚å¸¸é“¾æœºåˆ¶ï¼Œæ­å¼€å¼‚å¸¸å‘ç”Ÿé¡ºåºçš„ç¥ç§˜é¢çº±ã€‚</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ä¸ªè®©äººå›°æƒ‘çš„æŠ¥é”™</h3>
<p>è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªå…¸å‹çš„å¼‚å¸¸é“¾æ¡ˆä¾‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    <span class="hljs-number">1</span> / <span class="hljs-number">0</span>  <span class="hljs-comment"># ç¬¬ä¸€æ­¥ï¼šé™¤é›¶é”™è¯¯</span>
<span class="hljs-keyword">except</span> ZeroDivisionError <span class="hljs-keyword">as</span> e:
    <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"æ–°çš„é”™è¯¯"</span>) <span class="hljs-keyword">from</span> e  <span class="hljs-comment"># ç¬¬äºŒæ­¥ï¼šæŠ›å‡ºæ–°å¼‚å¸¸</span>
</code></pre>
<p>è¿è¡Œç»“æœï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">Traceback (most recent <span class="hljs-keyword">call</span> last):
  File <span class="hljs-string">"test.py"</span>, line <span class="hljs-number">2</span>, <span class="hljs-keyword">in</span> &lt;<span class="hljs-keyword">module</span>&gt;
    <span class="hljs-number">1</span> / <span class="hljs-number">0</span>
<span class="hljs-symbol">ZeroDivisionError:</span> division <span class="hljs-keyword">by</span> zero

The above exception was the direct cause <span class="hljs-keyword">of</span> the following exception:

Traceback (most recent <span class="hljs-keyword">call</span> last):
  File <span class="hljs-string">"test.py"</span>, line <span class="hljs-number">4</span>, <span class="hljs-keyword">in</span> &lt;<span class="hljs-keyword">module</span>&gt;
    raise ValueError(<span class="hljs-string">"æ–°çš„é”™è¯¯"</span>) <span class="hljs-keyword">from</span> e
<span class="hljs-symbol">ValueError:</span> æ–°çš„é”™è¯¯
</code></pre>
<p>é—®é¢˜æ¥äº†ï¼š<strong>å“ªä¸ªå¼‚å¸¸å…ˆå‘ç”Ÿï¼Ÿå“ªä¸ªæ‰æ˜¯"above exception"ï¼Ÿ</strong></p>
<h3 data-id="heading-2">å¼‚å¸¸é“¾çš„æ—¶é—´å¯†ç </h3>
<h4 data-id="heading-3">æ ¸å¿ƒåŸåˆ™ï¼šæ—¶é—´é€†åºå±•ç¤ºï¼Œæ ¹æºæœ€å…ˆå‘ç”Ÿ</h4>
<p>Pythonçš„å¼‚å¸¸é“¾å±•ç¤ºéµå¾ªä¸€ä¸ªçœ‹ä¼¼åç›´è§‰ä½†æå…¶åˆç†çš„åŸåˆ™ï¼š</p>
<blockquote>
<p><strong>å¼‚å¸¸ä¿¡æ¯æ˜¾ç¤ºé¡ºåºä¸å‘ç”Ÿæ—¶é—´ç›¸åï¼Œä½†æ–‡æœ¬æè¿°æ˜ç¡®æŒ‡å‡ºå› æœå…³ç³»</strong></p>
</blockquote>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">show_exception_timeline</span>():
    <span class="hljs-string">"""å¼‚å¸¸æ—¶é—´çº¿æ¼”ç¤º"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== å¼‚å¸¸å‘ç”Ÿçš„æ—¶é—´çº¿ ==="</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"t1: åŸå§‹å¼‚å¸¸å‘ç”Ÿ (ZeroDivisionError)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"t2: æ–°å¼‚å¸¸è¢«è§¦å‘ (ValueError)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"t3: å¼‚å¸¸é“¾è¢«å±•ç¤º (æ˜¾ç¤ºé¡ºåº)"</span>)
    <span class="hljs-built_in">print</span>()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== æ˜¾ç¤ºé¡ºåº ==="</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"1. ZeroDivisionError (t1å‘ç”Ÿçš„å¼‚å¸¸)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"2. 'The above exception...' (è¿æ¥æ–‡æœ¬)"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"3. ValueError (t2å‘ç”Ÿçš„å¼‚å¸¸)"</span>)

show_exception_timeline()
</code></pre>
<h4 data-id="heading-4">æ–‡æœ¬æè¿°çš„ç²¾ç¡®å«ä¹‰</h4>
<p>è®©æˆ‘ä»¬è§£æå…³é”®å¥å­çš„è¯­æ³•ç»“æ„ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"The above exception"</span> - æŒ‡ä»£çš„æ˜¯ï¼š
âœ… åœ¨æ–‡æœ¬ä¸­ä½ç½®é ä¸Šçš„å¼‚å¸¸
âœ… åœ¨æ—¶é—´çº¿ä¸Šå…ˆå‘ç”Ÿçš„å¼‚å¸¸
âœ… åœ¨å› æœå…³ç³»ä¸­çš„<span class="hljs-string">"å› "</span>ï¼ˆcauseï¼‰

<span class="hljs-string">"was the direct cause of the following exception"</span> - è¡¨ç¤ºï¼š
âœ… ä¸Šé¢çš„å¼‚å¸¸å¯¼è‡´äº†ä¸‹é¢çš„å¼‚å¸¸
âœ… å› æœå…³ç³»æ˜¯ç›´æ¥çš„ï¼ˆdirect causeï¼‰
âœ… æ—¶é—´é¡ºåºæ˜¯å…ˆåå…³ç³»
</code></pre>
<h3 data-id="heading-5">ä¸¤ç§å¼‚å¸¸é“¾çš„æ—¶åºåˆ†æ</h3>
<h4 data-id="heading-6">1. æ˜¾å¼å¼‚å¸¸é“¾ï¼ˆExplicit Chainingï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ¡ˆä¾‹ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥åçš„å¤„ç†</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">connect_database</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># t1: å°è¯•è¿æ¥ï¼Œæ–‡ä»¶ä¸å­˜åœ¨</span>
        <span class="hljs-built_in">open</span>(<span class="hljs-string">"config.db"</span>, <span class="hljs-string">"r"</span>)  
    <span class="hljs-keyword">except</span> FileNotFoundError <span class="hljs-keyword">as</span> original_error:
        <span class="hljs-comment"># t2: åŒ…è£…æˆæ•°æ®åº“é”™è¯¯</span>
        <span class="hljs-keyword">raise</span> DatabaseError(<span class="hljs-string">"æ•°æ®åº“é…ç½®ä¸¢å¤±"</span>) <span class="hljs-keyword">from</span> original_error

<span class="hljs-comment"># æ—¶é—´çº¿ï¼š</span>
<span class="hljs-comment"># t1: FileNotFoundError - "config.db"ä¸å­˜åœ¨</span>
<span class="hljs-comment"># t2: DatabaseError - åŒ…è£…åçš„æ•°æ®åº“é”™è¯¯</span>
</code></pre>
<p><strong>è¾“å‡ºåˆ†æï¼š</strong></p>
<pre><code class="hljs language-perl" lang="perl">Traceback (most recent call <span class="hljs-keyword">last</span>):      <span class="hljs-comment"># â† è¿™æ˜¯t1æ—¶åˆ»çš„å¼‚å¸¸</span>
  File <span class="hljs-string">"db.py"</span>, line <span class="hljs-number">3</span>, in connect_database
    <span class="hljs-keyword">open</span>(<span class="hljs-string">"config.db"</span>, <span class="hljs-string">"r"</span>)
FileNotFoundError: [Errno <span class="hljs-number">2</span>] No such file <span class="hljs-keyword">or</span> directory: <span class="hljs-string">'config.db'</span>

The above exception was the direct cause of the following exception:  <span class="hljs-comment"># â† t1å¯¼è‡´t2</span>

Traceback (most recent call <span class="hljs-keyword">last</span>):      <span class="hljs-comment"># â† è¿™æ˜¯t2æ—¶åˆ»çš„å¼‚å¸¸  </span>
  File <span class="hljs-string">"db.py"</span>, line <span class="hljs-number">6</span>, in connect_database
    raise DatabaseError(<span class="hljs-string">"æ•°æ®åº“é…ç½®ä¸¢å¤±"</span>) from original_error
DatabaseError: æ•°æ®åº“é…ç½®ä¸¢å¤±
</code></pre>
<h4 data-id="heading-7">2. éšå¼å¼‚å¸¸é“¾ï¼ˆImplicit Chainingï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ¡ˆä¾‹ï¼šå¼‚å¸¸å¤„ç†ä¸­çš„æ„å¤–é”™è¯¯</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">process_data</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># t1: æ•°æ®æ ¼å¼é”™è¯¯</span>
        <span class="hljs-built_in">int</span>(<span class="hljs-string">"invalid"</span>)  
    <span class="hljs-keyword">except</span> ValueError:
        <span class="hljs-comment"># t2: åœ¨å¤„ç†å¼‚å¸¸æ—¶ä¸å°å¿ƒå¼•å‘äº†æ–°å¼‚å¸¸</span>
        <span class="hljs-built_in">print</span>(undefined_variable)  <span class="hljs-comment"># NameError</span>

<span class="hljs-comment"># æ—¶é—´çº¿ï¼š</span>
<span class="hljs-comment"># t1: ValueError - æ•°æ®è½¬æ¢å¤±è´¥</span>
<span class="hljs-comment"># t2: NameError - å˜é‡æœªå®šä¹‰ï¼ˆæ„å¤–é”™è¯¯ï¼‰</span>
</code></pre>
<p><strong>è¾“å‡ºåˆ†æï¼š</strong></p>
<pre><code class="hljs language-perl" lang="perl">Traceback (most recent call <span class="hljs-keyword">last</span>):      <span class="hljs-comment"># â† t1æ—¶åˆ»çš„å¼‚å¸¸</span>
  File <span class="hljs-string">"data.py"</span>, line <span class="hljs-number">3</span>, in process_data
    <span class="hljs-keyword">int</span>(<span class="hljs-string">"invalid"</span>)
ValueError: invalid literal <span class="hljs-keyword">for</span> <span class="hljs-keyword">int</span>() with base <span class="hljs-number">10</span>: <span class="hljs-string">'invalid'</span>

During handling of the above exception, another exception occurred:  <span class="hljs-comment"># â† t1å¤„ç†ä¸­å‘ç”Ÿt2</span>

Traceback (most recent call <span class="hljs-keyword">last</span>):      <span class="hljs-comment"># â† t2æ—¶åˆ»çš„å¼‚å¸¸</span>
  File <span class="hljs-string">"data.py"</span>, line <span class="hljs-number">6</span>, in process_data
    <span class="hljs-keyword">print</span>(undefined_variable)
NameError: name <span class="hljs-string">'undefined_variable'</span> is <span class="hljs-keyword">not</span> <span class="hljs-keyword">defined</span>
</code></pre>
<h3 data-id="heading-8">åº•å±‚å®ç°ï¼šCPythonçš„å¼‚å¸¸é“¾æºç è§£æ</h3>
<h4 data-id="heading-9">å¼‚å¸¸å¯¹è±¡ç»“æ„ï¼ˆCå±‚é¢ï¼‰</h4>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">// Python/Objects/exceptions.c ä¸­çš„æ ¸å¿ƒç»“æ„</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>
    PyObject_HEAD
    PyObject *dict;           <span class="hljs-comment">// å¼‚å¸¸å±æ€§å­—å…¸</span>
    PyObject *args;           <span class="hljs-comment">// å¼‚å¸¸å‚æ•°</span>
    PyObject *traceback;      <span class="hljs-comment">// å›æº¯ä¿¡æ¯ (__traceback__)</span>
    PyObject *context;        <span class="hljs-comment">// éšå¼é“¾ (__context__) </span>
    PyObject *cause;          <span class="hljs-comment">// æ˜¾å¼é“¾ (__cause__)</span>
    <span class="hljs-type">char</span> suppress_context;    <span class="hljs-comment">// æ˜¯å¦æŠ‘åˆ¶ä¸Šä¸‹æ–‡</span>
} PyBaseExceptionObject;
</code></pre>
<h4 data-id="heading-10">å¼‚å¸¸é“¾æ‰“å°é€»è¾‘ï¼ˆPythonå±‚é¢ï¼‰</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Lib/traceback.py ä¸­çš„å…³é”®å®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TracebackException</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">format</span>(<span class="hljs-params">self, *, chain=<span class="hljs-literal">True</span></span>):
        <span class="hljs-string">"""æ ¼å¼åŒ–å¼‚å¸¸ï¼ŒåŒ…æ‹¬å¼‚å¸¸é“¾"""</span>
        <span class="hljs-keyword">if</span> chain:
            <span class="hljs-comment"># é€’å½’å¤„ç†å¼‚å¸¸é“¾</span>
            <span class="hljs-keyword">if</span> self.exc.__cause__ <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                <span class="hljs-comment"># æ˜¾å¼å¼‚å¸¸é“¾</span>
                <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> self.format_chain(self.exc.__cause__)
                <span class="hljs-keyword">yield</span> <span class="hljs-string">'\nThe above exception was the direct cause of the following exception:\n\n'</span>
            <span class="hljs-keyword">elif</span> (self.exc.__context__ <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> 
                  <span class="hljs-keyword">not</span> self.exc.__suppress_context__):
                <span class="hljs-comment"># éšå¼å¼‚å¸¸é“¾  </span>
                <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> self.format_chain(self.exc.__context__)
                <span class="hljs-keyword">yield</span> <span class="hljs-string">'\nDuring handling of the above exception, another exception occurred:\n\n'</span>
        
        <span class="hljs-comment"># æœ€åæ˜¾ç¤ºå½“å‰å¼‚å¸¸ï¼ˆæœ€æ–°çš„å¼‚å¸¸ï¼‰</span>
        <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> self.format_exception_only()
</code></pre>
<h4 data-id="heading-11">å¼‚å¸¸é“¾æ„å»ºè¿‡ç¨‹</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># Python/ceval.c ä¸­çš„å¼‚å¸¸å¤„ç†é€»è¾‘</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">raise_exception_chain</span>():
    <span class="hljs-string">"""å¼‚å¸¸é“¾æ„å»ºçš„ç®€åŒ–é€»è¾‘"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== å¼‚å¸¸é“¾æ„å»ºè¿‡ç¨‹ ==="</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"1. åŸå§‹å¼‚å¸¸å‘ç”Ÿï¼Œè®¾ç½®å½“å‰å¼‚å¸¸"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"2. åœ¨exceptå—ä¸­ï¼ŒPythonè‡ªåŠ¨ä¿å­˜__context__"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"3. å¦‚æœä½¿ç”¨'from'è¯­æ³•ï¼Œè®¾ç½®__cause__å±æ€§"</span>)  
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"4. æ–°å¼‚å¸¸æˆä¸º'å½“å‰å¼‚å¸¸'"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"5. æ˜¾ç¤ºæ—¶ï¼Œä»æœ€æ—©çš„å¼‚å¸¸å¼€å§‹é€’å½’å±•ç¤º"</span>)
</code></pre>
<h3 data-id="heading-12">å®é™…åº”ç”¨ï¼šå¦‚ä½•æ­£ç¡®è§£è¯»å¼‚å¸¸é“¾</h3>
<h4 data-id="heading-13">è°ƒè¯•æŠ€å·§ï¼šå¿«é€Ÿå®šä½æ ¹æœ¬åŸå› </h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">debug_exception_chain</span>():
    <span class="hljs-string">"""å¼‚å¸¸é“¾è°ƒè¯•æœ€ä½³å®è·µ"""</span>
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># æ¨¡æ‹Ÿå¤æ‚çš„å¼‚å¸¸é“¾</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># æ ¹æºé—®é¢˜ï¼šæ–‡ä»¶ä¸å­˜åœ¨</span>
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"nonexistent.txt"</span>, <span class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> f:
                data = f.read()
        <span class="hljs-keyword">except</span> FileNotFoundError <span class="hljs-keyword">as</span> file_error:
            <span class="hljs-comment"># ä¸­é—´å±‚ï¼šå°è¯•åˆ›å»ºé»˜è®¤é…ç½®</span>
            <span class="hljs-keyword">try</span>:
                <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">"default.txt"</span>, <span class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> f:  <span class="hljs-comment"># é»˜è®¤æ–‡ä»¶ä¹Ÿä¸å­˜åœ¨</span>
                    default_data = f.read()
            <span class="hljs-keyword">except</span> FileNotFoundError <span class="hljs-keyword">as</span> default_error:
                <span class="hljs-comment"># æœ€ç»ˆå¼‚å¸¸ï¼šé…ç½®ç³»ç»Ÿå®Œå…¨å¤±è´¥</span>
                <span class="hljs-keyword">raise</span> ConfigurationError(<span class="hljs-string">"ç³»ç»Ÿé…ç½®å®Œå…¨ä¸¢å¤±"</span>) <span class="hljs-keyword">from</span> default_error
    <span class="hljs-keyword">except</span> ConfigurationError <span class="hljs-keyword">as</span> final_error:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"=== å¼‚å¸¸é“¾åˆ†æ ==="</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æœ€ç»ˆå¼‚å¸¸: <span class="hljs-subst">{final_error}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç›´æ¥åŸå› : <span class="hljs-subst">{final_error.__cause__}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å®Œæ•´å¼‚å¸¸é“¾:"</span>)
        <span class="hljs-keyword">import</span> traceback
        traceback.print_exc()

debug_exception_chain()
</code></pre>
<h4 data-id="heading-14">è¾“å‡ºè§£è¯»æŒ‡å—</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_traceback_output</span>():
    <span class="hljs-string">"""æ•™ä½ å¦‚ä½•è§£è¯»å¼‚å¸¸è¾“å‡º"""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"""
=== å¼‚å¸¸é“¾è¾“å‡ºè§£è¯»æŒ‡å— ===

è¾“å‡ºç»“æ„ï¼š
1. æœ€æ—©çš„å¼‚å¸¸ï¼ˆæ ¹æœ¬åŸå› ï¼‰
   â†“ 
2. è¿æ¥æ–‡æœ¬ï¼ˆè¡¨æ˜å› æœå…³ç³»ï¼‰
   â†“
3. æœ€æ–°çš„å¼‚å¸¸ï¼ˆæœ€ç»ˆæš´éœ²çš„é”™è¯¯ï¼‰

é˜…è¯»é¡ºåºï¼š
âœ… è°ƒè¯•æ—¶ï¼šä»ä¸‹å¾€ä¸Šçœ‹ï¼ˆæ‰¾æœ€ç»ˆå¼‚å¸¸ï¼‰
âœ… æ‰¾æ ¹å› ï¼šä»ä¸Šå¾€ä¸‹çœ‹ï¼ˆæ‰¾æœ€æ—©å¼‚å¸¸ï¼‰

æ—¶é—´é¡ºåºï¼š
ä¸Š -&gt; ä¸‹ï¼šä»æ—© -&gt; æ™š
å·¦ -&gt; å³ï¼šä»å›  -&gt; æœ
"""</span>)

analyze_traceback_output()
</code></pre>
<h3 data-id="heading-15">å¸¸è§è¯¯åŒºä¸æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-16">âŒ å¸¸è§è¯¯åŒº</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è¯¯åŒº1ï¼šå¿½è§†å¼‚å¸¸é“¾ä¿¡æ¯</span>
<span class="hljs-keyword">try</span>:
    risky_operation()
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># åªæ‰“å°æœ€æ–°å¼‚å¸¸ï¼Œä¸¢å¤±äº†ä¸Šä¸‹æ–‡</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é”™è¯¯: <span class="hljs-subst">{e}</span>"</span>)  <span class="hljs-comment"># ä¸¢å¤±äº†æ ¹æœ¬åŸå› ä¿¡æ¯</span>

<span class="hljs-comment"># è¯¯åŒº2ï¼šé”™è¯¯çš„å¼‚å¸¸åŒ…è£…</span>
<span class="hljs-keyword">try</span>:
    process_data()
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># æ²¡æœ‰ä½¿ç”¨fromï¼Œå¯¼è‡´å¼‚å¸¸é“¾æ–­è£‚</span>
    <span class="hljs-keyword">raise</span> CustomError(<span class="hljs-string">"å¤„ç†å¤±è´¥"</span>)  <span class="hljs-comment"># ä¸¢å¤±äº†åŸå§‹å¼‚å¸¸ä¿¡æ¯</span>
</code></pre>
<h4 data-id="heading-17">âœ… æœ€ä½³å®è·µ</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å®è·µ1ï¼šä¿æŒå®Œæ•´çš„å¼‚å¸¸é“¾</span>
<span class="hljs-keyword">try</span>:
    risky_operation()
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-comment"># ä½¿ç”¨raise ... from ...ä¿æŒå¼‚å¸¸é“¾</span>
    <span class="hljs-keyword">raise</span> CustomError(<span class="hljs-string">"æ“ä½œå¤±è´¥"</span>) <span class="hljs-keyword">from</span> e

<span class="hljs-comment"># å®è·µ2ï¼šæä¾›æ¸…æ™°çš„é”™è¯¯ä¸Šä¸‹æ–‡</span>
<span class="hljs-keyword">try</span>:
    parse_config(file_path)
<span class="hljs-keyword">except</span> FileNotFoundError <span class="hljs-keyword">as</span> e:
    <span class="hljs-keyword">raise</span> ConfigurationError(
        <span class="hljs-string">f"é…ç½®æ–‡ä»¶ <span class="hljs-subst">{file_path}</span> ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥å®‰è£…å®Œæ•´æ€§"</span>
    ) <span class="hljs-keyword">from</span> e
</code></pre>
<h3 data-id="heading-18">æ€»ç»“ï¼šå¼‚å¸¸é“¾çš„æ—¶é—´å“²å­¦</h3>
<p>ç†è§£Pythonå¼‚å¸¸é“¾çš„å…³é”®åœ¨äºæŠŠæ¡<strong>æ—¶é—´é¡ºåº</strong>ä¸<strong>æ˜¾ç¤ºé¡ºåº</strong>çš„å…³ç³»ï¼š</p>
<ol>
<li>
<p><strong>æ—¶é—´é¡ºåº</strong>ï¼šå¼‚å¸¸æŒ‰å‘ç”Ÿæ—¶é—´ä»æ—©åˆ°æ™š</p>
<ul>
<li>t1: åŸå§‹å¼‚å¸¸ï¼ˆæ ¹æœ¬åŸå› ï¼‰</li>
<li>t2: ä¸­é—´å¼‚å¸¸ï¼ˆå¯é€‰ï¼‰</li>
<li>t3: æœ€ç»ˆå¼‚å¸¸ï¼ˆè¢«æ•è·çš„å¼‚å¸¸ï¼‰</li>
</ul>
</li>
<li>
<p><strong>æ˜¾ç¤ºé¡ºåº</strong>ï¼šä¸ºäº†è°ƒè¯•æ–¹ä¾¿ï¼Œ<strong>é€†åºå±•ç¤º</strong></p>
<ul>
<li>ç¬¬1éƒ¨åˆ†ï¼šæœ€æ—©å¼‚å¸¸ï¼ˆabove exceptionï¼‰</li>
<li>ç¬¬2éƒ¨åˆ†ï¼šè¿æ¥æ–‡æœ¬ï¼ˆå› æœå…³ç³»ï¼‰</li>
<li>ç¬¬3éƒ¨åˆ†ï¼šæœ€æ–°å¼‚å¸¸ï¼ˆfollowing exceptionï¼‰</li>
</ul>
</li>
<li>
<p><strong>å› æœå…³ç³»</strong>ï¼šæ–‡æœ¬æè¿°æ˜ç¡®æŒ‡å‡ºè°å¯¼è‡´äº†è°</p>
<ul>
<li>"The above exception" = æ—¶é—´çº¿ä¸Šçš„"å› "</li>
<li>"the following exception" = æ—¶é—´çº¿ä¸Šçš„"æœ"</li>
</ul>
</li>
</ol>
<p>è®°ä½è¿™ä¸ªå£è¯€ï¼š<strong>"ä¸Šçœ‹ä¸‹ï¼Œå› åˆ°æœï¼›è°ƒè¯•æ—¶ï¼Œä¸‹æ‰¾é”™"</strong> - ä»ä¸Šå¾€ä¸‹çœ‹æ‰¾åˆ°æ ¹æœ¬åŸå› ï¼Œä»ä¸‹å¾€ä¸Šçœ‹æ‰¾åˆ°æœ€ç»ˆé”™è¯¯ä½ç½®ã€‚</p>
<p>å¼‚å¸¸é“¾æœºåˆ¶ä½“ç°äº†Pythonè®¾è®¡çš„äººæ€§åŒ–ï¼šæ—¢ä¿æŒäº†æŠ€æœ¯çš„ä¸¥è°¨æ€§ï¼ˆæ—¶é—´é¡ºåºï¼‰ï¼Œåˆè€ƒè™‘äº†ç”¨æˆ·çš„å®ç”¨æ€§ï¼ˆè°ƒè¯•ä¾¿åˆ©ï¼‰ã€‚ç†è§£äº†è¿™ä¸ªæœºåˆ¶ï¼Œä½ å°±æ‹¥æœ‰äº†å¿«é€Ÿå®šä½å¤æ‚é”™è¯¯çš„è¶…èƒ½åŠ›ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[5 åˆ†é’Ÿè£…å¥½ OpenCodeï¼Œwindowç”¨æˆ·éœ€è¦çš„é¿å‘æŒ‡å—]]></title>    <link>https://juejin.cn/post/7592550891540299795</link>    <guid>https://juejin.cn/post/7592550891540299795</guid>    <pubDate>2026-01-08T06:57:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592550891540299795" data-draft-id="7592555965791944710" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="5 åˆ†é’Ÿè£…å¥½ OpenCodeï¼Œwindowç”¨æˆ·éœ€è¦çš„é¿å‘æŒ‡å—"/> <meta itemprop="keywords" content="AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-08T06:57:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="starrytky"/> <meta itemprop="url" content="https://juejin.cn/user/114004942661854"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            5 åˆ†é’Ÿè£…å¥½ OpenCodeï¼Œwindowç”¨æˆ·éœ€è¦çš„é¿å‘æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/114004942661854/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    starrytky
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:57:58.000Z" title="Thu Jan 08 2026 06:57:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>OpenCode å®‰è£…åŠä½¿ç”¨é—®é¢˜æ±‡æŠ¥</strong></h2>
<blockquote>
<p><strong>ç—›ç‚¹æ€»ç»“</strong></p>
<p>macOS ç”¨æˆ·å®‰è£…ä½“éªŒæµç•…ï¼Œå¯ä¸€æ­¥å®Œæˆå¹¶é¡ºåˆ©å¯ç”¨ã€‚</p>
<p>Windows ç”¨æˆ·åœ¨å®‰è£…åŠç™»å½•ç¯èŠ‚ä»å­˜åœ¨å¡é¡¿ï¼Œä¸»è¦é›†ä¸­åœ¨ TLS è¯ä¹¦æ ¡éªŒåŠç™»å½•éªŒè¯é˜¶æ®µã€‚</p>
</blockquote>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9284c910ea774086935fc20109402131~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=fQjppKPbqCM%2BB%2FKtSvMiig0nWoU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">å®‰è£…æµç¨‹è¯´æ˜</h3>
<h4 data-id="heading-2"><strong>1. å®‰è£… Bunï¼ˆWindows PowerShell ç®¡ç†å‘˜æƒé™ï¼‰</strong></h4>
<pre><code class="hljs language-bash" lang="bash">powershell -c <span class="hljs-string">"irm https://bun.sh/install.ps1|iex"</span> 
</code></pre>
<ul>
<li>å®‰è£…å®Œæˆåï¼Œé‡å¯ç»ˆç«¯ï¼Œæ‰§è¡Œ <code>bun -v</code> ï¼Œè‹¥èƒ½æ­£å¸¸æ˜¾ç¤ºç‰ˆæœ¬å·åˆ™è¡¨ç¤ºå®‰è£…æˆåŠŸã€‚</li>
</ul>
<h4 data-id="heading-3"><strong>2. å®‰è£… OpenCode</strong></h4>
<pre><code class="hljs language-bash" lang="bash">npm i -g opencode-ai@latest 
</code></pre>
<ul>
<li>é€šè¿‡ <code>npm list opencode-ai -version</code> éªŒè¯ç‰ˆæœ¬ï¼Œæ˜¾ç¤ºå³ä¸ºå®‰è£…å®Œæˆã€‚</li>
</ul>
<h3 data-id="heading-4"><strong>ç™»å½•åŠå¸¸è§é—®é¢˜</strong></h3>
<h4 data-id="heading-5"><strong>3. ç™»å½•ç¯èŠ‚å¸¸è§é—®é¢˜</strong></h4>
<ul>
<li>æ­£å¸¸æµç¨‹åº”æ‰§è¡Œ <code>opencode auth login</code> å¹¶å¡«å†™ key å®Œæˆç™»å½•ã€‚</li>
<li>Windows ç”¨æˆ·å¸¸è§é—®é¢˜ï¼šåœ¨é€‰æ‹©ç™»å½•æ–¹å¼åï¼Œå›  TLS è¯ä¹¦æ ¡éªŒæŠ¥é”™ï¼Œå¯¼è‡´ç™»å½•å¤±è´¥ã€‚</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">Select provider
|  Zhipu AI Coding Plan
Error: Unexpected error, check <span class="hljs-built_in">log</span> file at C:\Users\fits\.<span class="hljs-built_in">local</span>\share\opencode\<span class="hljs-built_in">log</span>\2026-01-07T020724.<span class="hljs-built_in">log</span> <span class="hljs-keyword">for</span> more details

BunInstallFailedError: BunInstallFailedError
 data: {
  pkg: <span class="hljs-string">"opencode-copilot-auth"</span>,
  version: <span class="hljs-string">"0.0.9"</span>,
},

      at src/bun/index.ts:109:21
      at src/bun/index.ts:100:23
      at processTicksAndRejections (native:7:39)

41 |       code,
42 |       stdout,
43 |       stderr,
44 |     })
45 |     <span class="hljs-keyword">if</span> (code !== 0) {
46 |       throw new Error(`Command failed with <span class="hljs-built_in">exit</span> code <span class="hljs-variable">${result.exitCode}</span>`)

                 ^
error: Command failed with <span class="hljs-built_in">exit</span> code 1
      at run2 (src/bun/index.ts:46:13)

</code></pre>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/815d8241456a42cdae50e7b255a9c236~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=RhvGeq1R9BvPOi4f0KBJeh3mprs%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-6"><strong>è§£å†³åŠæ³•ï¼šä¸´æ—¶å…³é—­ Node.js TLS è¯ä¹¦æ ¡éªŒ</strong></h5>
<blockquote>
<p><strong>æ“ä½œå»ºè®®ï¼š</strong></p>
<p>è·³è¿‡ç™»å½•ç¯èŠ‚ï¼Œæ‰‹åŠ¨é…ç½® key åå³å¯æ­£å¸¸ä½¿ç”¨ã€‚</p>
</blockquote>
<ul>
<li>macOS / Linux å¹³å°ï¼š</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> NODE_TLS_REJECT_UNAUTHORIZED=0 
</code></pre>
<ul>
<li>Windows å¹³å°ï¼š</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">set</span> NODE_TLS_REJECT_UNAUTHORIZED=0 
</code></pre>
<h4 data-id="heading-7"><strong>4. ç™»å½•åŠæ¨¡å‹é…ç½®</strong></h4>
<ul>
<li>æ‰§è¡Œ  <code>opencode auth login</code></li>
<li>é€‰æ‹© <code>OpenCode Zen</code> ï¼Œå¹¶å¡«å†™åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fopencode.ai%2F" target="_blank" title="https://opencode.ai/" ref="nofollow noopener noreferrer">å®˜ç½‘</a> è·å–çš„ key</li>
<li>ç™»å½•åå³å¯é…ç½®æ¨¡å‹å¹¶æ­£å¸¸ä½¿ç”¨</li>
</ul>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb9bf3d8c74843da813beb105fd28072~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=chk7dH%2F9VAhTkpmAM%2F9s3VOjuAg%3D" alt="" loading="lazy"/></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/777e48e3a8d94ad081c8432d4fb60745~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=FPODHzYSdhyBbPoMOmdyiGhce3o%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8"><strong>æ¨èæ¨¡å‹åŠæ’ä»¶</strong></h3>
<ul>
<li>æ¨èä½¿ç”¨ <code>GLM-4.7 OpenCode Zen</code> æ¨¡å‹ï¼Œä½“éªŒæœ€ä½³ã€‚</li>
<li>æ’ä»¶æ¨èï¼šæ”¯æŒ vscodeã€trae ç­‰ IDEã€‚å®é™…ä½“éªŒä¼˜äº claude codeï¼Œåç»­ä¼šè¡¥å……è¯¦ç»†æ“ä½œæŒ‡å—ã€‚</li>
</ul>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f3b06c939bf4653b5745def12566110~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=LL57LeJlZgaAQxjirJm0VdUXgkU%3D" alt="" loading="lazy"/></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fd3cb8b5da847ffb12ecc068872b4f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=%2FzAwUvpKIUPxs3rDSF%2F%2BOyjFzrI%3D" alt="" loading="lazy"/></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6fb378043b5441f97e41a8ab26ce089~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=MJcPGsWvbTMn1U%2FgtUxRYAc4z%2B0%3D" alt="" loading="lazy"/></p>

<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09dfbceb92fa44bdae6ee7f86ca39558~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3RhcnJ5dGt5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460277&amp;x-signature=bzMMnegNewvyZkY6AIiPmLCwWI8%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±åº¦å®è·µï¼šå¾—ç‰©ç®—æ³•åŸŸå…¨æ™¯å¯è§‚æµ‹æ€§ä» 0 åˆ° 1 çš„æ¼”è¿›ä¹‹è·¯]]></title>    <link>https://juejin.cn/post/7592683699772047370</link>    <guid>https://juejin.cn/post/7592683699772047370</guid>    <pubDate>2026-01-08T07:09:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592683699772047370" data-draft-id="7592710766009171978" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±åº¦å®è·µï¼šå¾—ç‰©ç®—æ³•åŸŸå…¨æ™¯å¯è§‚æµ‹æ€§ä» 0 åˆ° 1 çš„æ¼”è¿›ä¹‹è·¯"/> <meta itemprop="keywords" content="ç›‘æ§"/> <meta itemprop="datePublished" content="2026-01-08T07:09:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¾—ç‰©æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/2392954206960247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±åº¦å®è·µï¼šå¾—ç‰©ç®—æ³•åŸŸå…¨æ™¯å¯è§‚æµ‹æ€§ä» 0 åˆ° 1 çš„æ¼”è¿›ä¹‹è·¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392954206960247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¾—ç‰©æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:09:12.000Z" title="Thu Jan 08 2026 07:09:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»20åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å‰è¨€</h2>
<p>åœ¨å¾—ç‰©ï¼ˆPoizonï¼‰ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œç®—æ³•ç”Ÿæ€å·²æ¼”è¿›ä¸ºæ¶µç›–äº¤æ˜“æœç´¢ã€ç¤¾åŒºæ¨èã€å›¾åƒè¯†åˆ«åŠå¹¿å‘Šç­–ç•¥çš„å¤šç»´å¤æ‚ç³»ç»Ÿã€‚è¯·æ±‚ä»Javaç½‘å…³ä¸‹å‘ï¼Œè¿›å…¥ C++ æ„å»ºçš„é«˜æ€§èƒ½ç®—æ³•æ ¸å¿ƒï¼ˆDSearchæ£€ç´¢ã€DGraphå›¾è®¡ç®—ã€DFeatureç‰¹å¾æå–ç­‰ï¼‰ã€‚</p>
<p>éšç€ç³»ç»Ÿå¤æ‚åº¦çš„æŒ‡æ•°çº§å¢é•¿ï¼Œæˆ‘ä»¬å¯¹ç°æœ‰ç³»ç»Ÿçš„å¯è§‚æµ‹æ€§è¿›è¡Œäº†å…¨é¢æ¢³ç†ï¼Œä¸ºäº†æé«˜ç¨³å®šæ€§ï¼Œæˆ‘ä»¬å¸Œæœ›å»ºè®¾ä¸€ä¸ª<strong>ä¸šåŠ¡åœºæ™¯ç»´åº¦å…¨é“¾è·¯å˜æ›´äº‹ä»¶ä¸­å¿ƒï¼Œ</strong> ä»¥â€œèšç„¦åšå¥½å¯è§‚æµ‹æ€§â€ä¸ºæ ¸å¿ƒç›®æ ‡ï¼Œé€šè¿‡å»ºè®¾ç›‘æ§å¹³å°çš„äº‹ä»¶ä¸­å¿ƒä¸å…¨é“¾è·¯å¯è§‚æµ‹çš„æ ¸å¿ƒäº§å“ï¼Œæ•´åˆå„å¹³å°èµ„æºä¸æ•°æ®ï¼Œæå‡ç³»ç»Ÿçš„æ•´ä½“é€æ˜åº¦å’Œç¨³å®šæ€§ï¼Œä»è€Œæå‡ä¸šåŠ¡ç¨³å®šæ€§å’Œæ•…éšœæ­¢è¡€æ•ˆç‡ï¼Œä¸ºäº§å“è¿­ä»£å¥ å®šåšå®çš„åŸºç¡€ã€‚</p>
<h2 data-id="heading-1">äºŒã€å¯è§‚æµ‹æ€§çš„â€œå››å¤§æ”¯æŸ±â€ä¸è”åŠ¨æ„¿æ™¯</h2>
<p>åœ¨ä¸šç•Œï¼Œå¯è§‚æµ‹æ€§é€šå¸¸è¢«å®šä¹‰ä¸ºTraceã€Metricå’ŒLogä¸‰ä½ä¸€ä½“ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯æ‰“é€ ä¸€å¥— <strong>â€œä»¥åœºæ™¯ä¸ºé­‚ï¼Œä»¥è”åŠ¨ä¸ºéª¨â€</strong> çš„å¯è§‚æµ‹ä½“ç³»ï¼Œæ‰“ç ´æ•°æ®å­¤å²›ï¼Œå®ç°ç®—æ³•æ²»ç†çš„æ™ºèƒ½åŒ–è½¬å‹ã€‚æå‡ºäº† <strong>â€œå››å¤§æ”¯æŸ±è”åŠ¨â€ï¼š</strong></p>
<ul>
<li><strong>Traceä¸ºå¾„ï¼š</strong> è¶…è¶Šå•çº¯çš„æ‹“æ‰‘è®°å½•ã€‚é€šè¿‡<strong>Baggage</strong>æœºåˆ¶ï¼Œå°†å¤æ‚çš„ä¸šåŠ¡è¯­ä¹‰ä¸ç®—æ³•ç­–ç•¥æ³¨å…¥é“¾è·¯ï¼Œå®ç°è°ƒç”¨æµä¸ä¸šåŠ¡æµçš„æ·±åº¦è€¦åˆã€‚</li>
<li><strong>Metricä¸ºè„‰ï¼š</strong> é€šè¿‡Traceè‡ªåŠ¨ç”Ÿæˆåœºæ™¯åŒ–çš„æ€§èƒ½æŒ‡æ ‡ã€‚å¹¶ç»“åˆ<strong>å…ƒæ•°æ®</strong>å…³è”æœåŠ¡ç«¯ä¸šåŠ¡æŒ‡æ ‡ï¼Œå®ç°æŒ‡æ ‡é—´çš„è”åŠ¨ã€‚</li>
<li><strong>Logä¸ºè¯ï¼š</strong> æ¨åŠ¨å…¨é“¾è·¯æ—¥å¿—æ ¼å¼åŒ–æ²»ç†ã€‚è§„èŒƒå¼‚å¸¸ç å’Œä¸šåŠ¡ç ã€‚</li>
<li><strong>Eventä¸ºæºï¼š</strong> ç®—æ³•ç³»ç»Ÿçš„çµé­‚åœ¨äºæ¼”è¿›ã€‚æ‰“é€šç®—æ³•ä¾§<strong>10+ä¸ªå˜æ›´å¹³å°ï¼Œ</strong> å°†æ—¥å‡ä¸Šä¸‡+çš„å˜æ›´äº‹ä»¶å®æ—¶æ˜ å°„è‡³é“¾è·¯æ‹“æ‰‘ã€‚</li>
</ul>
<h2 data-id="heading-2">ä¸‰ã€æ ¸å¿ƒæ”»åšï¼šå¯è§‚æµ‹æ€§æ ‡å‡†åŒ–</h2>
<h3 data-id="heading-3">Traceæ ‡å‡†åŒ–</h3>
<p>åœ¨å¾—ç‰©ç®—æ³•ç”Ÿæ€ä¸­ï¼Œ<strong>DMergeã€DScatterã€DGraphã€DSearchã€DFeature</strong>ç­‰æ ¸å¿ƒç»„ä»¶æ‰¿è½½ç€æè‡´çš„æ€§èƒ½è¯‰æ±‚ã€‚ç”±äºC++ä¾§Trace SDKçš„é•¿æœŸç¼ºå¤±ï¼Œç®—æ³•æœåŠ¡æ›¾å¤„äºå¾®æœåŠ¡è§‚æµ‹ä½“ç³»çš„â€œå­¤å²›â€ï¼Œéš¾ä»¥ä¸ä¸Šä¸‹æ¸¸å®ç°å…¨é“¾è·¯ä¸²è”ã€‚</p>
<p>C++ Trace2.0ï¼ˆå¾—ç‰©åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ªTrace2.0åŸºäºOpenTelemetryäºŒæ¬¡å¼€å‘ï¼Œç›®å‰å·²ç»æ”¯æŒJava/Go/JS/Pythonè¯­è¨€ï¼‰å¹¶æ²¡æœ‰åŸºäºOpenTelemetry CPPè¿›è¡ŒäºŒæ¬¡å¼€å‘ä¸»è¦è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ul>
<li><strong>æè‡´æ€§èƒ½ä¸å¯æ§å¼€é”€è¦æ±‚ï¼š</strong> C++ä¾§æœåŠ¡ä½äºè¯·æ±‚é“¾è·¯å…³é”®è·¯å¾„ï¼Œå¯¹RTä¸å°¾å»¶è¿Ÿæå…¶æ•æ„Ÿï¼Œéœ€è¦å¯¹<strong>Spanåˆ›å»ºã€ä¸Šä¸‹æ–‡ä¼ æ’­ã€å±æ€§å†™å…¥</strong>ç­‰æ“ä½œè¿›è¡Œä¸¥æ ¼çš„CPUä¸å†…å­˜å¼€é”€æ§åˆ¶ï¼Œå¹¶å¯¹å†…å­˜åˆ†é…ã€é”ç«äº‰åŠçº¿ç¨‹åˆ‡æ¢å…·å¤‡ä¸¥æ ¼å¯æ§æ€§ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒOpenTelemetry C++ SDKæ›´åå‘<strong>é€šç”¨æ€§ä¸æ ‡å‡†å®Œå¤‡æ€§ï¼Œ</strong> å…¶æŠ½è±¡å±‚æ¬¡ä¸æ‰©å±•ç‚¹åœ¨éƒ¨åˆ†é«˜QPSåœºæ™¯ä¸‹å­˜åœ¨ä¸å¯å¿½ç•¥çš„æ€§èƒ½ä¸ç¡®å®šæ€§ã€‚</li>
<li><strong>åŸç”ŸSDKè¡Œä¸ºä¸é€æ˜å¸¦æ¥çš„å·¥ç¨‹é£é™©ï¼š</strong> OpenTelemetry C++ SDK å†…éƒ¨å®ç°è¾ƒä¸ºå¤æ‚ï¼Œå¯èƒ½åŒ…å«éšå¼çº¿ç¨‹ã€åå°ä»»åŠ¡æˆ–å¤æ‚ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œåœ¨æç«¯å¹¶å‘æˆ–å¼‚å¸¸åœºæ™¯ä¸‹çš„é—®é¢˜å®šä½ä¸è¾¹ç•Œæ§åˆ¶æˆæœ¬è¾ƒé«˜ï¼Œè€Œå¯¹æºç å®Œæ•´è¯„ä¼°çš„æˆæœ¬åŒæ ·é«˜æ˜‚ã€‚</li>
</ul>

<ul>
<li><strong>brpc+bthreadè¿è¡Œæ¨¡å‹çš„å…¼å®¹æ€§æ‹…å¿§ï¼š</strong> C++ æœåŠ¡å¤§é‡åŸºäºbrpcä¸bthreadç”¨æˆ·æ€è°ƒåº¦æ¨¡å‹ï¼Œè‹¥SDKå†…éƒ¨ä¾èµ–pthreadæˆ–å¼•å…¥é¢å¤–ç³»ç»Ÿçº¿ç¨‹ï¼Œå¯èƒ½å½±å“bthread workerçš„è°ƒåº¦è¡Œä¸ºï¼Œå­˜åœ¨è¿è¡Œæ—¶çš„å…¼å®¹é£é™©ã€‚</li>
<li><strong>å·¥ç¨‹ä¾èµ–ä¸ç¬¦å·å†²çªé£é™©ï¼ˆå°¤å…¶æ˜¯Protobufï¼‰ï¼š</strong> ç°æœ‰å·¥ç¨‹ä¾èµ–ç‰¹å®šç‰ˆæœ¬çš„protobufï¼Œè€ŒOpenTelemetry C++ SDKå¯¹å…¶ä¾èµ–æ ˆæœ‰ç‹¬ç«‹ç‰ˆæœ¬è¦æ±‚ï¼Œåœ¨é™æ€æˆ–æ··åˆé“¾æ¥åœºæ™¯ä¸‹å­˜åœ¨ç¬¦å·æ³„æ¼ä¸ABIå†²çªé£é™©ï¼Œæ•´ä½“å·¥ç¨‹ç¨³å®šæ€§ä¸å¯æ§ã€‚</li>
</ul>
<p><strong>SDKæ¡†æ¶</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd3f89c886114ce0850d014a4f17d58b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=koAEVne80uVAIXpWJG6NindIxP8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>APM Cpp SDKï¼š</strong> å®ç°Spançš„åˆ›å»ºã€é‡‡é›†å’Œä¸ŠæŠ¥ï¼ŒåŒæ—¶ä¸æ§åˆ¶å¹³é¢å¯¹æ¥å®ç°å¿ƒè·³å’Œé…ç½®çƒ­æ›´æ–°ï¼ŒåŸºäºkafkaä¸ŠæŠ¥Traceã€‚</li>
<li><strong>brpc-tracerï¼š</strong> brpcæ¡†æ¶é€‚é…å±‚ï¼Œæ”¯æŒhttpä¸baidu-stdåè®®çš„è‡ªåŠ¨ä¸ŠæŠ¥æ¢é’ˆã€‚</li>
<li><strong>å¼•æ“æ¥å…¥ï¼š</strong> ä¸šåŠ¡ä¾§é€šè¿‡ä¾èµ–brpc-tracerï¼Œæ”¯æŒé“¾è·¯ä¸ŠæŠ¥ã€‚</li>
</ul>
<p><strong>æŠ¥æ–‡å‹ç¼©æ–¹æ¡ˆ</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8d9e1595a31487a9736878a74f49477~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=Mip9GH25g1ylB6MEx2RFL8%2F2dZA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>é€šè¿‡å¯¹æŠ¥æ–‡è¿›è¡Œå‹ç¼©ï¼Œæ˜¾è‘—é™ä½Traceä¸ŠæŠ¥è¿‡ç¨‹ä¸­çš„å¸¦å®½æ¶ˆè€—ï¼Œå‡å°‘é“¾è·¯æ•°æ®ä¸ä¸šåŠ¡è¯·æ±‚åœ¨å¸¦å®½ä¸Šçš„ç«äº‰ï¼Œé¿å…å¯¹æ­£å¸¸è¯·æ±‚å“åº”æ—¶å»¶äº§ç”Ÿå¹²æ‰°ï¼Œä¿éšœä¸šåŠ¡æœåŠ¡ç¨³å®šæ€§ã€‚</p>
<p><strong>å‹ç¼©ç­–ç•¥ï¼š</strong></p>
<p><strong>é•¿åº¦è¿‡æ»¤ï¼š</strong> å¯¹å†™çš„å±æ€§ã€äº‹ä»¶ã€å¼‚å¸¸è¿›è¡Œkeyã€valueé•¿åº¦é™åˆ¶ï¼Œå¯¹Spançš„æ•´ä½“è¿›è¡Œé•¿åº¦é™åˆ¶ï¼Œè¶…å‡ºé˜ˆå€¼éƒ¨åˆ†è¿›è¡Œæˆªæ–­ï¼Œé˜ˆå€¼å®ç°äº†æ§åˆ¶å¹³é¢çš„<strong>åŠ¨æ€æ›´æ–°ã€‚</strong></p>
<p><strong>å­—æ®µå‹ç¼©ï¼š</strong> å°½å¯èƒ½çš„å¯¹åè®®ä¸­çš„æ‰€æœ‰å­—æ®µè¿›è¡Œäº†å‹ç¼©ï¼Œä¾‹å¦‚ï¼Œ16è¿›åˆ¶å­—ç¬¦ä¸²æ‰“åŒ…ä¸º2è¿›åˆ¶ï¼Œé€šç”¨å­—æ®µçœç•¥keyï¼Œé€šè¿‡å·®å€¼æ›¿ä»£ç»“æŸæ—¶é—´ç­‰ã€‚</p>
<p><strong>æ‰¹é‡èšåˆï¼š</strong> å°†å¤šæ¡Spanè¿›è¡Œåˆå¹¶ï¼Œä½œä¸ºä¸€æ¡æŠ¥æ–‡è¿›è¡Œä¸ŠæŠ¥ï¼Œå¢åŠ ååé‡çš„åŒæ—¶ï¼Œå‡å°‘kafkaé›†ç¾¤å’Œå¸¦å®½å‹åŠ›ã€‚èšåˆé˜ˆå€¼ä¹Ÿå®ç°äº†æ§åˆ¶å¹³é¢åŠ¨æ€æ›´æ–°ã€‚</p>
<p><strong>é™æ€ä¿¡æ¯æŠ½å–ï¼š</strong> å¯¹è¿›ç¨‹çº§åˆ«çš„é™æ€ä¿¡æ¯ä»Spanå¯¹è±¡ä¸­å‰¥ç¦»ï¼Œæ¯ä¸ªèšåˆæŠ¥æ–‡åªæ·»åŠ ä¸€ä¸ªé™æ€ä¿¡æ¯å‰¯æœ¬ã€‚</p>
<p><strong>Snappyå‹ç¼©ï¼š</strong> å…ˆå¯¹èšåˆåçš„æ¶ˆæ¯åºåˆ—åŒ–ï¼Œå†è¿›è¡ŒSnappyå‹ç¼©ï¼Œç»éªŒå‹ç¼©æ¯”æ˜¯30%å·¦å³ã€‚</p>
<p><strong>å¼‚æ­¥ä¸ŠæŠ¥å’ŒMPSCæ— é”ç¯é˜Ÿåˆ—</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7e63931b7a4453f818d86dce85bf96d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=taBICwUAutazZ06hK5DXCXENOv8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>å¼‚æ­¥ä¸ŠæŠ¥ï¼š</strong> Spané‡‡é›†åå†™å…¥é˜Ÿåˆ—ï¼Œç”±å¼‚æ­¥çº¿ç¨‹æ‰¹é‡å¤„ç†å¹¶æŠ•é€’è‡³Kafkaï¼›å½“é˜Ÿåˆ—å·²æ»¡æˆ–ä¸ŠæŠ¥å¤±è´¥æ—¶ç›´æ¥ä¸¢å¼ƒï¼Œé¿å…é˜»å¡ä¸šåŠ¡çº¿ç¨‹åŠå†…å­˜è†¨èƒ€ã€‚</li>
<li><strong>MPSCæ— é”å¾ªç¯é˜Ÿåˆ—ï¼š</strong> MPSCæ˜¯æ”¯æŒå¤šç”Ÿäº§è€…å•æ¶ˆè´¹è€…çš„æ— é”é˜Ÿåˆ—ç»“æ„ï¼Œåˆ©ç”¨å¾ªç¯æ•°ç»„å®ç°é«˜æ•ˆæ•°æ®ä¼ é€’ã€‚é€šè¿‡åŸå­æ“ä½œé¿å…åŠ é”ï¼Œå‡å°‘çº¿ç¨‹ç«äº‰å¸¦æ¥çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œæ€§èƒ½å¼€é”€ã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹èƒ½æä¾›æ›´ç¨³å®šçš„ååé‡å’Œæ›´ä½çš„å»¶è¿Ÿï¼Œä¿è¯é˜Ÿåˆ—æ“ä½œçš„é«˜æ•ˆæ€§å’Œå¯é¢„æµ‹æ€§ã€‚</li>
</ul>
<p><strong>RPCæ¢é’ˆ</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fbb54c929184160b2f6cad8f387bf36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=jTMz8g8rj3DuUwE3XjL%2F9MSJ4xs%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>RPC æ¢é’ˆå®ç°äº†</strong>åœ¨åè®®å±‚å¯¹è¯·æ±‚ç”Ÿå‘½å‘¨æœŸçš„ç»Ÿä¸€æ„ŸçŸ¥ä¸Traceè‡ªåŠ¨åŒ–å¤„ç†ï¼Œæ”¯æŒBRpcå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åœ¨æ— ä¸šåŠ¡ä¾µå…¥çš„å‰æä¸‹å®ŒæˆTraceçš„è‡ªåŠ¨é‡‡æ ·ä¸ä¸ŠæŠ¥ã€‚</p>
<p>é’ˆå¯¹ä¸åŒé€šä¿¡åœºæ™¯ï¼Œåœ¨åè®®å±‚å¼•å…¥ç»Ÿä¸€çš„RPCæ¢é’ˆï¼Œé€šè¿‡åŸ‹ç‚¹å›è°ƒå¯¹è¯·æ±‚ç”Ÿå‘½å‘¨æœŸè¿›è¡Œæ‹¦æˆªï¼Œå®ç°Traceçš„è‡ªåŠ¨é‡‡æ ·ä¸åŸ‹ç‚¹ã€‚</p>
<p><strong>ä¸Šçº¿æ•ˆæœ</strong></p>
<ul>
<li>æ”¯æŒtrace_idé“¾è·¯æŸ¥è¯¢ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f34f34ec7ae417c918ddcc3e7324b35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=Ytbtp9Oq6Jfn8JRSvOCI7d2V0xI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li>æ”¯æŒæŒ‡æ ‡ç»´åº¦ï¼ˆå¼‚å¸¸ï¼ŒRTèŒƒå›´ç­‰ï¼‰çš„é“¾è·¯æŸ¥è¯¢ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/587031999df74920a5c81a9076713e2c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=3ykDJay%2BBrzmOcyg0%2FT2Fs3L%2BdY%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-4">Logæ ‡å‡†åŒ–</h3>
<p>åœ¨å…¨é“¾è·¯å¯è§‚æµ‹ä½“ç³»ä¸­ï¼Œæ—¥å¿—æ˜¯è¿˜åŸä¸šåŠ¡ç°åœºçš„æœ€ç»ˆè¯æ®ã€‚é’ˆå¯¹ç®—æ³•ä¾§<strong>Java ä¾§è§„èŒƒã€C++ ä¾§æ‚ä¹±</strong>çš„ç°çŠ¶ï¼Œæˆ‘ä»¬å®æ–½äº†æ·±åº¦å¯¹é½ä¸è¯­ä¹‰é‡æ„ã€‚</p>
<ul>
<li>è·¨è¯­è¨€è¯­ä¹‰å¯¹é½ï¼šä»¥Javaä¾§æˆç†Ÿçš„æ ‡å‡†åŒ–æ—¥å¿—ä¸ºæ ‡æ†ï¼Œé€šè¿‡è‡ªç ”C++ Log SDKæ¨è¡Œç»“æ„åŒ–æ—¥å¿—åè®®ã€‚</li>
<li>ä¸šåŠ¡è¯­ä¹‰é”šå®šï¼šåœ¨æ—¥å¿—è§„èŒƒä¸­é¦–æ¬¡å¼•å…¥äº†â€œåœºæ™¯ (Scene) + å¼‚å¸¸ç  (Error Code)â€ã€‚</li>
</ul>

<ul>
<li><strong>åœºæ™¯åŒ–å»ºæ¨¡ï¼š</strong> å°†å…·ä½“çš„ä¸šåŠ¡ä¸Šä¸‹æ–‡ï¼ˆå¦‚æ¨èã€æœç´¢ï¼‰æ³¨å…¥æ—¥å¿—å…ƒæ•°æ®ï¼Œä½¿æ—¥å¿—å…·å¤‡äº†æ¸…æ™°çš„ä¸šåŠ¡å±æ€§ã€‚</li>
<li><strong>å¼‚å¸¸ç æ ‡å‡†åŒ–ï¼š</strong> å»ºç«‹ç®—æ³•ä¾§ç»Ÿä¸€çš„é”™è¯¯å­—å…¸ï¼Œå®ç°ä»â€œæ¨¡ç³Šæè¿°â€åˆ°â€œç²¾ç¡®æŒ‡çº¹â€çš„è·¨è¶Šã€‚</li>
</ul>
<p><strong>æ—¥å¿—æ ¼å¼è§„èŒƒ</strong></p>
<p>1.ç»Ÿä¸€æ–‡ä»¶å</p>
<pre><code class="hljs language-lua" lang="lua">Â /logs/åº”ç”¨å/{åº”ç”¨å}-<span class="hljs-built_in">error</span>.<span class="hljs-built_in">log</span>
</code></pre>
<ul>
<li>æ–‡ä»¶ç›®å½•åœ¨/logs/åº”ç”¨å/</li>
<li>ç»Ÿä¸€æ–‡ä»¶åå«{åº”ç”¨å}-error.logï¼Œæ¯”å¦‚å¼•æ“çš„å«ï¼šdoe-server-error.log</li>
<li>æ—¥å¿—é‡‡é›†æ—¶æŒ‰pattern: *-error.logé‡‡é›†</li>
</ul>
<p>2.æ—¥å¿—æ ¼å¼</p>
<ul>
<li>æŒ‰ç…§ç«–çº¿ â€œ|â€åˆ†éš”ç¬¦åˆ†éš”</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">Â æ—¶é—´æˆ³|è¿›ç¨‹ID:çº¿ç¨‹ID|æ—¥å¿—ç­‰çº§|<span class="hljs-section">[åº”ç”¨å,trace_id,span_id,scene,errCode,]</span>|æ¥å£å|ä»£ç è¡Œå·|<span class="hljs-section">[å¯ç”¨åŒº,é›†ç¾¤å,,]</span>|å¼‚å¸¸å|message
</code></pre>
<ul>
<li>å­—æ®µè¯¦ç»†ä»‹ç»</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d8f871586b241a799b8d031b13f1eb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=NzzKwW%2F4dhNGlZCPIp99TfsGBSY%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>æ—¥å¿—æ¨¡æ¿èšç±»ç®—æ³•</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/823bf75ac88c41ac91bc0a09aebd7cda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=HnQ5ubdo3%2FE64HtCq4c7FktbZ3A%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>æ¨¡æ¿èšç±»æµç¨‹</strong></p>
<p>è§„åˆ™ï¼šä»¥æ­£åˆ™æ©ç +Drainè§£ææ ‘ä¸ºåŸºç¡€</p>
<ul>
<li><strong>æ­£åˆ™æ©ç ï¼š</strong> é€šè¿‡æ­£åˆ™å¯¹æ—¥å¿—è¿›è¡Œé¢„å¤„ç†ï¼Œå¦‚æ—¶é—´ï¼ŒIPåœ°å€ï¼Œæ•°å­—ï¼Œç­‰ç­‰ã€‚ä¾‹å¦‚â€œ2025-12-01 10:20:30 ERROR host 10.0.1.2 connect timeoutâ€ç»è¿‡æ­£åˆ™æ©ç åï¼Œå¾—åˆ°â€œ&lt;:TIME:&gt; ERROR host &lt;:IP:&gt; connect timeoutâ€</li>
<li><strong>Drainç®—æ³•ï¼š</strong> Drainç®—æ³•æ˜¯ä¸€ç§ç”¨äºå¤„ç†æ—¥å¿—æ•°æ®çš„ç»“æ„åŒ–åˆ†æç®—æ³•ï¼Œå¹¿æ³›åº”ç”¨äºæ—¥å¿—è§£æå’Œæ—¥å¿—æ¨¡æ¿æŠ½å–é¢†åŸŸã€‚å®ƒæ˜¯ä¸€ç§åŸºäºå±‚æ¬¡èšç±»çš„åœ¨çº¿æ—¥å¿—è§£æç®—æ³•ï¼Œå…¶ä¸»è¦ç›®æ ‡æ˜¯ä»åŸå§‹æ—¥å¿—ä¸­æå–æ—¥å¿—æ¨¡æ¿ï¼Œä»è€Œå°†éç»“æ„åŒ–æ—¥å¿—è½¬æ¢ä¸ºåŠç»“æ„åŒ–æ•°æ®æ ¼å¼ï¼Œè¿™æœ‰åŠ©äºåç»­çš„æ—¥å¿—åˆ†æã€æ•…éšœæ£€æµ‹å’Œç³»ç»Ÿç›‘æ§ã€‚</li>
</ul>
<p><strong>Drainç®—æ³•ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤</strong></p>
<ul>
<li><strong>é¢„å¤„ç†</strong></li>
</ul>
<p>é¦–å…ˆéœ€è¦å¯¹æ—¥å¿—è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å‰æ–‡çš„æ­£åˆ™æ©ç ï¼Œä»¥å‡å°‘å†—ä½™ä¿¡æ¯å¯¹è§£æçš„å½±å“ã€‚å¦å¤–ï¼Œéœ€è¦å¯¹æ—¥å¿—è¿›è¡Œåˆ†è¯ï¼ŒæŒ‰ç©ºæ ¼å’Œå…¶ä»–åˆ†å‰²ç¬¦åˆ’åˆ†ä¸ºå¤šä¸ªç‰‡æ®µã€‚</p>
<ul>
<li><strong>drainè§£ææ ‘</strong></li>
</ul>
<p>æ¥ä¸‹æ¥æ„å»ºäº†ä¸€ç§å±‚æ¬¡ç»“æ„çš„æ ‘ï¼Œç§°ä¸ºparse treeï¼Œç”¨äºè®°å½•å’Œç»„ç»‡æ—¥å¿—æ¶ˆæ¯ã€‚</p>
<ul>
<li>åœ¨æ ‘çš„ç¬¬ä¸€çº§èŠ‚ç‚¹ï¼Œæ—¥å¿—å°†ä¼šä¾æ®å…¶é•¿åº¦ï¼ˆåˆ†è¯åç‰‡æ®µæ•°ç›®ï¼‰è¿›è¡Œåˆ†ç±»ã€‚ä¸åŒé•¿åº¦çš„æ—¥å¿—ä¼šè¢«åˆ†é…åˆ°ä¸åŒçš„è·¯å¾„ä¸Šã€‚</li>
<li>ç„¶ååœ¨æ ‘çš„åç»­å±‚çº§ä¸­ï¼Œæ¯ä¸€å±‚çº§éƒ½å°è¯•æ ¹æ®å…¶ä»–çš„é™æ€å…³é”®å­—å¯¹æ—¥å¿—æ¶ˆæ¯è¿›è¡Œè¿›ä¸€æ­¥ç»†åŒ–åˆ†ç±»ã€‚</li>
<li>æ ‘çš„å¶å­èŠ‚ç‚¹ä¸ºæ—¥å¿—èšç±»æ¡¶ï¼Œé€ä¸ªéå†æ¡¶ä¸­çš„èšç±»ï¼Œåˆ†åˆ«åˆ¤æ–­å½“å‰æ—¥å¿—ä¸å¯¹åº”æ—¥å¿—èšç±»çš„ç›¸ä¼¼åº¦æ˜¯å¦è¾¾åˆ°é˜ˆå€¼ï¼Œç›¸ä¼¼åº¦ç®—æ³•ä¸ºç›¸åŒä½ç½®çš„ç›¸åŒtokenå tokenæ€»æ•°çš„æ¯”ä¾‹ã€‚</li>
<li>å¦‚æœç›¸ä¼¼åˆ™å°†åˆ¤æ–­å½“å‰çš„æ—¥å¿—åŒ¹é…è¯¥èšç±»ï¼Œå¦‚æœéƒ½ä¸ç›¸ä¼¼åˆ™åˆ›å»ºæ–°çš„èšç±»å¹¶åŠ å…¥æ¡¶ä¸­ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/945feb6294784b7da36c136a1617f666~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=IB7xJUNMy7y0QNc8rU8hwHoVwA8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>ä¸Šçº¿æ•ˆæœ</strong></p>
<p>æ—¥å¿—æ¨¡æ¿èšç±»ç»´åº¦æ”¯æŒï¼šåº”ç”¨åã€é›†ç¾¤åã€å¼‚å¸¸åã€codeç ã€å¼‚å¸¸æ—¥å¿—æ¨¡ç‰ˆç­‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b36fb0777f84eb9bc8b87580f50352c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=12a9zZrZ%2FOaaz%2FNymORsSpukv5E%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-5">å››ã€ä»¥â€œåœºæ™¯â€ä¸ºé­‚ï¼šæ„å»ºç®—æ³•çŸ¥è¯†å›¾è°±</h2>
<h3 data-id="heading-6">åœºæ™¯åŒ–å»ºæ¨¡ (AlgoScene)</h3>
<p>åœ¨å¾—ç‰©APPä¸­ï¼Œç”¨æˆ·æ¯ä¸€æ¬¡æœç´¢æˆ–è¿›å…¥ç¤¾åŒºé¢‘é“ï¼Œåº•å±‚éƒ½ä¼šè§¦å‘ä¸€æ¬¡å¤æ‚çš„RPCè°ƒç”¨æµã€‚æµé‡åœ¨ç®—æ³•åŸŸå†…ç©¿æ¢­æ—¶ï¼Œä¼šç»å†å¤šæ¬¡ä¸åŒâ€œåœºæ™¯â€ç®—å­çš„ä¸²è¡Œä¸å¹¶è¡Œè®¡ç®—ï¼Œæœ€ç»ˆæ‰å°†æ¨èç»“æœåé¦ˆç»™å®¢æˆ·ç«¯ã€‚æ­£æ˜¯ç”±äºè¿™ç§è°ƒç”¨è·¯å¾„æå…¶å¤æ‚ä¸”å…·å¤‡é«˜åº¦çš„ä¸šåŠ¡ç‰¹æ€§ï¼Œæˆ‘ä»¬å†³å®šæ‰“ç ´ä¼ ç»Ÿçš„ç‰©ç†é“¾è·¯è§†è§’ï¼Œè½¬è€Œä»¥ <strong>â€œåœºæ™¯â€ä¸ºæ ¸å¿ƒå•å…ƒæ„å»ºçŸ¥è¯†å›¾è°±ã€‚</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5be420845a164f54a94ca82049c61d8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=d3%2B124E2w2CljY8LNXo1JXKjLSQ%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œ</p>
<ul>
<li>ä¸€ä¸ªåœºæ™¯ç”±å¤šä¸ªç®—å­ç»„åˆ</li>
<li>æ¯ä¸ªç®—å­ç”±0..å¤šä¸ªç»„ä»¶æ„æˆ</li>
<li>ç»„ä»¶ä¸€èˆ¬é€šè¿‡RPCï¼ˆHTTP/GRPC/Dubbo/Redis/BRPC/åœºæ™¯ï¼‰æ–¹å¼è°ƒç”¨ä¸‹</li>
</ul>
<p><strong>AlgoSceneåœºæ™¯å</strong></p>
<p>åœ¨ç¡®å®šä»¥â€œåœºæ™¯â€ä¸ºæ ¸å¿ƒçš„ä¸²è”é€»è¾‘åï¼Œç”±äºå•æ¬¡ RPC è°ƒç”¨å¾€å¾€æ¨ªè·¨å¤šä¸ªç®—æ³•èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»å®ç°å¯¹<strong>å¤šåœºæ™¯åŠ¨æ€é“¾</strong>çš„æ”¯æŒã€‚</p>
<p>è€ƒè™‘åˆ°ç®—æ³•ä»»åŠ¡ç¼–æ’å¤©ç„¶ä»¥åœºæ™¯ä¸ºåŸºæœ¬å•å…ƒï¼Œæˆ‘ä»¬é€šè¿‡åœ¨Trace SDKä¸­å°è£…putAlgoSceneToBaggageæ–¹æ³•ï¼Œåˆ©ç”¨<strong>Baggageæœºåˆ¶</strong>å°†åœºæ™¯ä¿¡æ¯é€ä¼ è‡³å…¨é“¾è·¯ã€‚åœ¨æ¯ä¸ªæœåŠ¡çš„åœºæ™¯å…¥å£å¤„ï¼Œåªéœ€é€šè¿‡ä»¥ä¸‹ä»£ç å³å¯å®ç°åœºæ™¯ä¸Šä¸‹æ–‡çš„æ³¨å…¥ï¼Œç¡®ä¿å…¨é“¾è·¯ä¸­çš„æ¯ä¸ªSpanéƒ½èƒ½è‡ªåŠ¨æºå¸¦algo_sceneå­—æ®µï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ContextÂ <span class="hljs-attr">ctx</span>Â =Â AlgoBaggageOperator.putAlgoSceneToBaggage(<span class="hljs-string">"trans_product"</span>)<span class="hljs-comment">;</span>
tryÂ (ScopeÂ <span class="hljs-attr">scope</span>Â =Â ctx.activate()) {
Â  Â Â // ä¸šåŠ¡é€»è¾‘æ‰§è¡Œ
}
</code></pre>
<p>åœ¨æ•°æ®æ¸…æ´—é˜¶æ®µï¼Œæˆ‘ä»¬é€šè¿‡å¯¹algo_sceneå­—æ®µè¿›è¡Œé€—å·åˆ‡åˆ†ï¼Œè§£æå‡ºå®Œæ•´çš„<strong>åœºæ™¯è·¯å¾„é“¾ï¼š</strong></p>
<ul>
<li><strong>algoSceneï¼š</strong> è®°å½•å…¨é“¾è·¯ç»è¿‡çš„æ‰€æœ‰åœºæ™¯åï¼ˆé€—å·åˆ†éš”ï¼‰ã€‚</li>
<li><strong>rootSceneï¼š</strong> åˆ‡åˆ†åçš„ç¬¬ä¸€ä¸ªåœºæ™¯åï¼Œä»£è¡¨æµé‡è¿›å…¥ç®—æ³•åŸŸçš„åŸå§‹è§¦å‘æºã€‚</li>
<li><strong>currentSceneï¼š</strong> åˆ‡åˆ†åçš„æœ€åä¸€ä¸ªåœºæ™¯åï¼Œä»£è¡¨å½“å‰èŠ‚ç‚¹æ‰€å±çš„å…·ä½“ç®—å­åœºæ™¯ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6c16176947649bfb9988d670a7251ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=%2FTbOAfrUlUhx2REoPFxV%2BCsxPvg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>æœ€ç»ˆTraceæ•ˆæœ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bc44122e7a041fbb864840bfe8a11de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=z5cm7qQnPMS%2FluYf9WbbvDjl%2BuI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>ä¼ æ’­é“¾â€œBaggageâ€ VS â€œInnerBaggageâ€</strong></p>
<p><strong>Baggage</strong>æ˜¯OpenTelemetryè§‚æµ‹æ ‡å‡†ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç»„ä»¶ã€‚å¦‚æœè¯´TraceIDæ˜¯ç”¨æ¥ä¸²è”æ•´ä¸ªè°ƒç”¨é“¾çš„â€œèº«ä»½è¯â€ï¼Œé‚£ä¹ˆ<strong>Baggageå°±åƒæ˜¯éšèº«æºå¸¦çš„â€œè¡Œæç®±â€ã€‚</strong></p>
<p>å®ƒå…è®¸å¼€å‘äººå‘˜åœ¨æ•´ä¸ªè¯·æ±‚é“¾è·¯ä¸­æºå¸¦<strong>è‡ªå®šä¹‰çš„é”®å€¼å¯¹ï¼ˆKey-Value Pairsï¼‰ã€‚</strong> è¿™äº›æ•°æ®ä¼šéšç€HTTP Headeræˆ–RPCå…ƒæ•°æ®åœ¨å„ä¸ªå¾®æœåŠ¡ä¹‹é—´è‡ªåŠ¨â€œæ¼‚æµâ€ï¼Œç¡®ä¿ä¸‹æ¸¸æœåŠ¡èƒ½å¤Ÿæ„ŸçŸ¥ä¸Šæ¸¸ä¼ é€’çš„ä¸šåŠ¡ä¸Šä¸‹æ–‡ã€‚</p>
<p><strong>æ ¸å¿ƒåŸç†</strong></p>
<p>Baggageæ˜¯åŸºäºHTTP Headeråè®®å®ç°çš„ã€‚æ ¹æ®W3Cæ ‡å‡†ï¼Œå®ƒä¼šå°†æ•°æ®å­˜æ”¾åœ¨åä¸ºbaggageçš„Headerä¸­è¿›è¡Œé€ä¼ ï¼š</p>
<ul>
<li><strong>æ ¼å¼ï¼š</strong> baggage: algoScene=recommend_v1,isTest=true</li>
<li><strong>ä¼ æ’­æ–¹å¼ï¼š</strong> è‡ªåŠ¨éšè¯·æ±‚ä»Service Aæµè½¬è‡³Service Bã€Cï¼Œæ— éœ€åœ¨æ¯ä¸ªæœåŠ¡çš„ä¸šåŠ¡ä»£ç ä¸­æ‰‹åŠ¨æ·»åŠ å‚æ•°ã€‚</li>
</ul>
<p><strong>åº•å±‚å®ç°</strong></p>
<p>å¦‚ä½•å°†baggageä¿¡æ¯åº”ç”¨åˆ°æ¯ä¸ªspanå‘¢ï¼Ÿæˆ‘ä»¬å¢å¼ºäº†spanProcessorä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">BaggageÂ <span class="hljs-attr">baggage</span>Â =Â Baggage.fromContext(parentContext)<span class="hljs-comment">;</span>
baggage.forEach((s, baggageEntry) -&gt; {
Â  Â Â ifÂ (s.startsWith(OTEL_TO_SPAN_BAGGAGE_PREFIX)) {
Â  Â  Â  Â Â StringÂ <span class="hljs-attr">value</span>Â =Â baggageEntry.getValue()<span class="hljs-comment">;</span>
Â  Â  Â  Â Â ifÂ (<span class="hljs-attr">value</span> ==Â null) {
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">value</span> = NULL_VALUE<span class="hljs-comment">;</span>
Â  Â  Â  Â  }Â elseÂ ifÂ (value.isEmpty()) {
Â  Â  Â  Â  Â  Â  <span class="hljs-attr">value</span> = EMPTY_VALUE<span class="hljs-comment">;</span>
Â  Â  Â  Â  }
Â  Â  Â  Â  span.setAttribute("baggage:"Â + s.substring(OTEL_TO_SPAN_BAGGAGE_PREFIX.length()), value)<span class="hljs-comment">;</span>
Â  Â  }
})<span class="hljs-comment">;</span>
</code></pre>
<p><strong>InnerBaggage</strong></p>
<p>åœ¨å…¨é“¾è·¯è¿½è¸ªä¸­ï¼Œå¦‚æœè¯´Baggageè§£å†³äº†æœåŠ¡ä¹‹é—´çš„è·¨ç«™ä¼ é€’ï¼Œç¡®ä¿ä¸šåŠ¡ä¿¡æ¯èƒ½è·¨è¶Šæœºå™¨é€è¾¾ä¸‹æ¸¸ï¼›é‚£ä¹ˆInnerBaggageåˆ™è´Ÿè´£æœåŠ¡å†…éƒ¨çš„è¿›ç¨‹ä¼ é€’ï¼Œç¡®ä¿åœ¨åŒä¸€ä¸ªè¿›ç¨‹é‡Œï¼Œæ— è®ºä¸šåŠ¡é€»è¾‘ç»è¿‡å¤šå°‘ä¸ªç»„ä»¶ï¼Œå½“å‰çš„â€œç®—å­åâ€ç­‰ä¿¡æ¯éƒ½èƒ½è‡ªåŠ¨åŒæ­¥åˆ°æ¯ä¸€ä¸ªæ‰§è¡Œæ­¥éª¤ä¸­ï¼Œæ— éœ€åœ¨ä»£ç é‡Œå±‚å±‚æ‰‹åŠ¨ä¼ é€’å‚æ•°ã€‚</p>
<p>ç¤ºä¾‹</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// åœ¨ç®—å­å…¥å£å¤„ï¼Œå®šä¹‰ä¸€ä¸ª InnerBaggage ä½œç”¨åŸŸ</span>
<span class="hljs-keyword">try</span>Â (Scope ignored = InnerBaggage.<span class="hljs-keyword">with</span>(<span class="hljs-string">"search_processor_biz_component"</span>,Â <span class="hljs-string">"content_agg"</span>)) { Â  Â Â 
Â  Â Â <span class="hljs-comment">// è¿™é‡Œçš„é€»è¾‘æ— è®ºæ˜¯è°ƒç”¨æ•°æ®åº“è¿˜æ˜¯è®¡ç®—ï¼Œç”Ÿæˆçš„ Span éƒ½ä¼šè‡ªåŠ¨å¸¦ä¸Š search_processor_biz_component=content_agg Â  Â Â </span>
Â  Â  runComponentLogic(); Â 
} Â 
<span class="hljs-comment">// ä½œç”¨åŸŸç»“æŸï¼ŒInnerBaggage è‡ªåŠ¨æ¸…ç†ï¼Œé˜²æ­¢æ±¡æŸ“ä¸‹ä¸€ä¸ªç®—å­</span>
</code></pre>
<p>æœ€ç»ˆæ•ˆæœ</p>
<p>ä¸€ä¸ªè¿œç¨‹Dubbo-clientè¢«æˆåŠŸæ ‡è®°algo_sceneå’Œä¸šåŠ¡ç®—å­åâ€œcontent_aggâ€ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b092b7fde84493480f93224e3f5749b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=QqR2y9PeL9jKpfNv9VncDP85i%2FA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-7">åŠ¨æ€å…ƒæ•°æ®ä¸æµå¼è®¡ç®—</h3>
<p><strong>é…ç½®ä¸­å¿ƒå…ƒæ•°æ®</strong></p>
<p>åœ¨å¤æ‚çš„ç®—æ³•åœºæ™¯ä¸­ï¼Œç”±äºå˜æ›´é¢‘ç‡æé«˜ï¼Œç¡¬ç¼–ç æ˜¾ç„¶æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€å¥—åŸºäºé…ç½®ä¸­å¿ƒçš„åŠ¨æ€å…ƒæ•°æ®è®¢é˜…ä½“ç³»ã€‚</p>
<ul>
<li>å»ºç«‹â€œåº”ç”¨-é…ç½®é›†â€è®¢é˜…å…³ç³»</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bbfdeef8d874cf2967955f631f06a69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=ggBP9C%2F%2B0vI9VADtExmFAqrqVsE%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li>å…ƒæ•°æ®æ¨¡å‹å®šä¹‰</li>
</ul>
<p>ä¸ºäº†æ”¯æ’‘åº”ç”¨ä¸é…ç½®ä¹‹é—´çš„å¤šå¯¹å¤šå…³ç³»ï¼Œæˆ‘ä»¬è®¾è®¡äº†å¦‚ä¸‹æ ¸å¿ƒè¡¨ç»“æ„ï¼Œç”¨äºè®°å½•è®¢é˜…é€»è¾‘ä¸å…ƒæ•°æ®ç”»åƒï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb8aa952e0224df3a81000e164f1e972~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=dkIqZc1EjgMgL1SEc040Fd991xM%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>åœºæ™¯æ‹“æ‰‘å›¾ (Neo4j)</strong></p>
<p>åœ¨å®Œæˆä¸šåŠ¡ä¾§çš„å…¨é“¾è·¯åŸ‹ç‚¹åï¼Œåç«¯æ•°æ®æ¸…æ´—å±‚è´Ÿè´£å°†æµ·é‡çš„åŸå§‹Traceæ•°æ®è¿›è¡Œç»“æ„åŒ–å¤„ç†ï¼šå®ƒå®æ—¶è§£æå¹¶æå–<strong>Baggage</strong>ä¸­çš„å…¨å±€åœºæ™¯ä¿¡æ¯ä¸<strong>InnerBaggage</strong>ä¸­çš„å±€éƒ¨ç®—å­æ ‡ç­¾ï¼Œä»è€Œå°†ç¦»æ•£çš„é“¾è·¯ä¿¡æ¯è½¬åŒ–ä¸ºæ ‡å‡†åŒ–çš„ä¸šåŠ¡è®¡ç®—æµã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d625d8caa5144e6bb937ab357986d2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=1fcAE3DmfJ1ww058nPh4gzHrJR8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>æµå¼è®¡ç®—å¼•æ“</strong></p>
<p>å€ŸåŠ©æµå¼è®¡ç®—å¼•æ“å¼ºå¤§çš„EPLèƒ½åŠ›ï¼Œæˆ‘ä»¬é€šè¿‡ç±»SQLçš„å£°æ˜å¼è¯­æ³•ï¼Œç²¾ç‚¼åœ°å®ç°äº†ä»å®æ—¶å¤šç»´èšåˆåˆ°å¤æ‚æ¨¡å¼åŒ¹é…çš„é€»è¾‘è¡¨è¾¾ï¼Œç›®å‰å·²æ²‰æ·€å‡º12ä¸ªè¦†ç›–æ ¸å¿ƒä¸šåŠ¡åœºæ™¯çš„æ ‡å‡†SQLç®—å­ï¼Œæ˜¾è‘—æå‡äº†å®æ—¶æ•°æ®å¤„ç†çš„å¼€å‘æ•ˆç‡ä¸çµæ´»æ€§ã€‚SQLç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@TimeWindow</span>(<span class="hljs-number">10</span>)
<span class="hljs-variable">@Metric</span>(name =Â <span class="hljs-string">'algo_redis_client'</span>, tags = {<span class="hljs-string">'algoScene'</span>,<span class="hljs-string">'rootScene'</span>,<span class="hljs-string">'currentScene'</span>,<span class="hljs-string">'props'</span>,<span class="hljs-string">'env'</span>,<span class="hljs-string">'clusterName'</span>,<span class="hljs-string">'serviceName'</span>,<span class="hljs-string">'redisUrl'</span>,<span class="hljs-string">'statusCode'</span>}, fields = {<span class="hljs-string">'timerCount'</span>,Â <span class="hljs-string">'timerSum'</span>,Â <span class="hljs-string">'timerMax'</span>}, sampling=<span class="hljs-string">'sampling'</span>)
SELECT algoScene Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ algoScene,
Â  Â  Â  Â rootScene Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ rootScene,
Â  Â  Â  Â currentScene Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â asÂ currentScene,
Â  Â  Â  Â <span class="hljs-built_in">get_value</span>(origin.props) Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ props,
Â  Â  Â  Â env Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ env,
Â  Â  Â  Â serviceName Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ serviceName,
Â  Â  Â  Â clusterName Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ clusterName,
Â  Â  Â  Â statusCode Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â asÂ statusCode,
Â  Â  Â  Â redisUrl Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â asÂ redisUrl,
Â  Â  Â  Â <span class="hljs-built_in">trunc_sec</span>(startTime,Â <span class="hljs-number">10</span>) Â  Â  Â  Â  Â  Â  Â  Â Â asÂ timestamp,
Â  Â  Â  Â <span class="hljs-built_in">max</span>(duration) Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ timerMax,
Â  Â  Â  Â <span class="hljs-built_in">sum</span>(duration) Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â asÂ timerSum,
Â  Â  Â  Â <span class="hljs-built_in">count</span>(<span class="hljs-number">1</span>) Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â asÂ timerCount,
Â  Â  Â  Â <span class="hljs-built_in">sampling</span>(new Object[]{duration,traceId}) Â  Â  Â  Â  Â  Â  Â  Â  Â Â asÂ sampling
FROM algoRedisSpanÂ asÂ origin
GROUP BY algoScene, rootScene, currentScene, props,env,serviceName, clusterName, redisUrl,statusCode,<span class="hljs-built_in">trunc_sec</span>(startTime,Â <span class="hljs-number">10</span>)
</code></pre>
<ul>
<li>@TimeWindow(10):Â å®šä¹‰äº†ä¸€ä¸ª10ç§’çš„æ»šåŠ¨çª—å£ï¼Œå¼•æ“ä¼šæŠŠè¿™10ç§’å†…äº§ç”Ÿçš„æ‰€Redisè®¿é—®è®°å½•ï¼ˆSpanï¼‰æ”’åœ¨ä¸€èµ·è¿›è¡Œä¸€æ¬¡è®¡ç®—</li>
<li>@Metric(...):Â è¿™å®šä¹‰äº†è¾“å‡ºç»“æœçš„ç»“æ„ã€‚å°†è®¡ç®—ç»“æœè½¬åŒ–ä¸ºæŒ‡æ ‡ï¼ˆMetricï¼‰ï¼Œå…¶ä¸­tagsæ˜¯ç»´åº¦ï¼Œfieldsæ˜¯æ•°å€¼ã€‚</li>
<li>sampling(...):Â é‡‡æ ·åŠŸèƒ½ï¼Œé€šè¿‡é‡‡æ ·é€»è¾‘è®°å½•è€—æ—¶æœ€å¤§çš„traceIdã€‚</li>
</ul>
<p><strong>åœºæ™¯æ‹“æ‰‘å›¾</strong></p>
<p>å‰é¢æ„é€ äº†ä»¥â€œåœºæ™¯â€ä¸ºä¸­å¿ƒçš„ç®—æ³•åŸŸè°ƒç”¨æŒ‡æ ‡ï¼Œåé¢æ„é€ æ€æ ·çš„æ•°æ®æ¨¡å‹å†³å®šäº†ç”¨æˆ·ä»ä»€ä¹ˆè§’åº¦å»è§‚å¯Ÿå’Œåˆ†ææ•°æ®ã€‚æˆ‘ä»¬æ‘’å¼ƒäº†ä¸å¤Ÿç›´è§‚çš„ä¼ ç»Ÿçš„è¡¨æ ¼å¼å±•ç¤ºï¼Œå€ŸåŠ©å¼ºå¤§çš„å›¾æ•°æ®å­˜å‚¨æ•°æ®åº“Neo4jï¼Œå®æ—¶å­˜å‚¨å’Œæ›´æ–°ç®—æ³•åœºæ™¯çš„ç®—å­è°ƒç”¨æ‹“æ‰‘å›¾ã€‚å®æ—¶è°ƒç”¨æŒ‡æ ‡å…³ç³»å­˜å‚¨æ—¶åºæ•°æ®åº“Victoriametricsï¼Œå®æ—¶è°ƒç”¨å…³ç³»å­˜å‚¨Neo4jã€‚</p>
<p>å›¾æ¨¡å‹</p>
<ul>
<li>èŠ‚ç‚¹(Node)ï¼šä»£è¡¨å®ä½“ï¼Œå¦‚ï¼šAppã€AppClusterã€ArkGroupã€ArkDataIdã€AlgoComponentã€AlgoDGraphç­‰</li>
<li>å…³ç³»(Relationship)ï¼šè¿æ¥èŠ‚ç‚¹ï¼Œå¦‚ï¼šSceneRelationã€AppRelationç­‰</li>
<li>å±æ€§(Properties)ï¼šå­˜å‚¨åœ¨èŠ‚ç‚¹å’Œå…³ç³»ä¸Šçš„é”®å€¼å¯¹ï¼Œå¦‚ï¼šappNameã€clusterNameã€sceneã€componentNameã€updateTimestampç­‰</li>
</ul>
<p>æ•°æ®æ¨¡å‹è®¾è®¡</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// appèŠ‚ç‚¹</span>
<span class="hljs-title function_ invoke__">CREATEÂ </span>(<span class="hljs-attr">a</span>:App {
Â  <span class="hljs-attr">Â Â id</span>:Â <span class="hljs-number">1</span>,
Â  <span class="hljs-attr">Â Â hash</span>: -<span class="hljs-number">6545781662466553124</span>,
Â  <span class="hljs-attr">Â Â appName</span>:Â <span class="hljs-string">"sextant"</span>
})
<span class="hljs-comment">// appClusterèŠ‚ç‚¹</span>
<span class="hljs-title function_ invoke__">CREATEÂ </span>(<span class="hljs-attr">c</span>:AppCluster {
Â  <span class="hljs-attr">Â Â id</span>:Â <span class="hljs-number">23</span>,
Â  <span class="hljs-attr">Â Â hash</span>: -<span class="hljs-number">8144086133777820909</span>,
Â  <span class="hljs-attr">Â Â appName</span>:Â <span class="hljs-string">"sextant"</span>,
Â  <span class="hljs-attr">Â Â clusterName</span>:Â <span class="hljs-string">"sextant-csprd-01"</span>
})
<span class="hljs-comment">// index</span>
CREATE INDEX <span class="hljs-title function_ invoke__">index_app_nameÂ FORÂ </span>(<span class="hljs-attr">a</span>:App)Â <span class="hljs-title function_ invoke__">ONÂ </span>(a.appName)
<span class="hljs-comment">// å…³ç³»</span>
<span class="hljs-title function_ invoke__">MATCHÂ </span>(<span class="hljs-attr">a</span>:App {<span class="hljs-attr">id</span>:Â <span class="hljs-number">1</span>}),(c:AppCluster {id:<span class="hljs-number">23</span>})
<span class="hljs-title function_ invoke__">MERGEÂ </span>(a)-[r:HAS_CLUSTER]-&gt;(c)
ON CREATE SET r.updateTs =Â <span class="hljs-title function_ invoke__">timestamp</span>()
ON MATCH SET r.updateTs =Â <span class="hljs-title function_ invoke__">timestamp</span>()
<span class="hljs-keyword">return</span>Â r;
</code></pre>
<p>æ—¶åºæŒ‡æ ‡è®¾è®¡</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
Â  Â Â <span class="hljs-attr">"metric"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">{</span>Â  Â  Â  Â  Â  Â  Â  Â  Â 
Â  Â  Â  Â Â <span class="hljs-attr">"__name__"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"algo_client_metric_timerCount"</span><span class="hljs-punctuation">,</span>
Â  Â  Â  Â Â <span class="hljs-attr">"from"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"hashcodexxx"</span><span class="hljs-punctuation">,</span>
Â  Â  Â  Â Â <span class="hljs-attr">"to"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"hashcodexxx"</span><span class="hljs-punctuation">,</span>
Â  Â  Â  Â Â <span class="hljs-attr">"statusCode"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
Â  Â  Â  Â Â <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"Dgraph"</span>
Â  Â Â <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
Â  Â Â <span class="hljs-attr">"values"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-number">42</span><span class="hljs-punctuation">,</span><span class="hljs-number">32</span><span class="hljs-punctuation">,</span><span class="hljs-number">15</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
Â  Â Â <span class="hljs-attr">"timestamps"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-number">1767573600</span><span class="hljs-punctuation">,</span><span class="hljs-number">1767573620</span><span class="hljs-punctuation">,</span><span class="hljs-number">1767573640</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>ä¸Šçº¿æ•ˆæœ</strong></p>
<ul>
<li>é€šè¿‡apocè·å–å®ä½“é—´çš„è°ƒç”¨å…³ç³»</li>
</ul>

<pre><code class="hljs language-objectivec" lang="objectivec"><span class="hljs-built_in">CALL</span>Â apoc.meta.graph()
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f10734a5454243baa6c9dd65f797fc11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=6g73x0FpDg6XCd0BRyjy8MkrRd8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li>é€šè¿‡cypherè¯­å¥æŸ¥è¯¢æŸåœºæ™¯ä¸‹çš„è°ƒç”¨æ‹“æ‰‘</li>
</ul>

<pre><code class="hljs language-scss" lang="scss">MATCHÂ 
Â  Â  <span class="hljs-selector-tag">p</span> = (entry {appName:Â 'app'})-<span class="hljs-selector-attr">[r:USES_SCENE*1..]</span>-&gt;(to)Â 
WHEREÂ <span class="hljs-attribute">all</span>(relÂ INÂ rÂ WHEREÂ rel.type =Â 'CURRENT_SCENE'Â AND rel.scene CONTAINSÂ 'scene'Â  Â  Â  Â  Â  and rel.updateTs &gt;=Â <span class="hljs-number">1767675780000</span>Â and rel.updateTs &lt;=Â <span class="hljs-number">1767679380000</span>)Â 
RETURNÂ <span class="hljs-built_in">nodes</span>(p) AS allNodes, <span class="hljs-built_in">relationships</span>(p) AS allRels LIMITÂ <span class="hljs-number">1000</span>
</code></pre>

<pre><code class="hljs language-ini" lang="ini">sum(sum_over_time(algo_client_metric_timerSum{<span class="hljs-attr">scene</span>=<span class="hljs-string">"xxx"</span>}[<span class="hljs-number">1</span>m] <span class="hljs-literal">off</span>set <span class="hljs-number">1</span>m)) by (to) /Â sum(sum_over_time(otel_algo_client_metric_timerCount{scene=<span class="hljs-string">"xxx"</span>}[<span class="hljs-number">1</span>m] <span class="hljs-literal">off</span>set <span class="hljs-number">1</span>m)) by (to)Â 
/ 1000
sum(sum_over_time(algo_client_metric_timerCount{<span class="hljs-attr">scene</span>=<span class="hljs-string">"xxx"</span>}[<span class="hljs-number">1</span>m] <span class="hljs-literal">off</span>set <span class="hljs-number">1</span>m) / <span class="hljs-number">60</span>) by (to)
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa81efea82b247abb1396e470380c2bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=5ADvlMG2rtLV81Tg%2B0LrVK5coJs%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-8">äº”ã€æ™ºèƒ½åŒ–æ¼”è¿›ï¼šå¼‚å¸¸æ£€æµ‹ä¸äº‹ä»¶è”åŠ¨</h2>
<h3 data-id="heading-9">å¼‚å¸¸æ£€æµ‹ï¼šæ”¹è¿›å‹IQRç®—æ³•</h3>
<p>é€šè¿‡æ„å»ºä»¥â€œåœºæ™¯â€ä¸ºæ ¸å¿ƒçš„ç›‘æ§ç»´åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ç²¾å‡†æ•æ‰å¼‚å¸¸æ€»æ•°åŠå…¶æ¼”è¿›è¶‹åŠ¿ã€‚æ¥ä¸‹æ¥èšç„¦<strong>å‘¨æœŸæ€§è§„å¾‹è¯†åˆ«ä¸å¼‚å¸¸æ£€æµ‹ç®—æ³•ä¼˜åŒ–</strong>ä¸¤å¤§æ ¸å¿ƒé¢†åŸŸï¼š</p>
<p><strong>å‘¨æœŸæ€§è§„å¾‹ï¼šä»å‚…é‡Œå¶å˜æ¢åˆ°è‡ªé€‚åº”è¯†åˆ«</strong></p>
<p>åœ¨ç”µå•†å¾®æœåŠ¡æ¶æ„ä¸­ï¼ŒæŒ‡æ ‡æ³¢åŠ¨æ·±åº¦è€¦åˆäººç±»è¡Œä¸ºçš„â€œæ˜¼å¤œèŠ‚å¾‹â€ï¼›è€Œåœ¨ç®—æ³•ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œé¢‘ç¹çš„å®éªŒä»»åŠ¡ä½¿å‘¨æœŸæ€§ç‰¹å¾æ›´è¶‹å¤æ‚ä¸”å¤šå˜ï¼›</p>
<ul>
<li>é€šç”¨æ–¹æ¡ˆï¼šä¼ ç»Ÿçš„å‚…é‡Œå¶å˜æ¢ï¼ˆFFTï¼‰è™½èƒ½æ•æ‰é¢‘åŸŸç‰¹å¾ï¼Œä½†åœ¨æ—¶åŸŸå™ªå£°å¹²æ‰°ä¸‹éš¾ä»¥æ¨å¯¼å‡ºé«˜ç²¾åº¦çš„ç‰©ç†å‘¨æœŸï¼›</li>
<li>è½åœ°æ–¹æ¡ˆï¼šé‡‡ç”¨<strong>è‡ªé€‚åº”å‘¨æœŸè¯†åˆ«ç®—æ³•ï¼Œ</strong> èƒ½å¤Ÿæ ¹æ®æ—¶åºæ•°æ®çš„åŠ¨æ€æ¼”å˜ï¼Œè‡ªåŠ¨ã€ç²¾ç¡®åœ°æ¨æµ‹å‡ºå„åœºæ™¯ç‰¹æœ‰çš„å‘¨æœŸæ­¥é•¿ï¼›</li>
</ul>
<p>ç»™å®šä¸€äº›å€™é€‰å‘¨æœŸï¼Œé€šè¿‡è®¡ç®—æ—¶é—´åºåˆ—çš„æ»å1å‘¨æœŸçš„è‡ªç›¸å…³æ€§ï¼ŒéªŒè¯æ—¶é—´åºåˆ—æ˜¯å¦åŒ¹é…å€™é€‰å‘¨æœŸã€‚å¯¹ä¸åŒçš„å€™é€‰å‘¨æœŸï¼Œå–ä¸åŒé•¿åº¦çš„å†å²æ•°æ®ï¼Œå€™é€‰å‘¨æœŸè¶Šå¤§ï¼Œéœ€è¦å†å²æ•°æ®è¶Šä¹…è¿œï¼Œç›¸å…³æ€§è¦æ±‚è¾ƒä½ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f52c3e097594e66bb9a7c3b78d738c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=dGL8SlEaC0qt1fLDFEv67KzvLHc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>å‘¨æœŸè¯†åˆ«ç®—æ³•ç¤ºæ„å›¾</p>
<p><strong>å¼‚å¸¸æ£€æµ‹ç®—æ³•ï¼šä» 3-Sigma åˆ°æ”¹è¿›å‹ IQR</strong></p>
<p>é¢å¯¹æµé‡æ¿€å¢äº§ç”Ÿçš„â€œéšæœºçªåˆºâ€ä»¥åŠä½æµé‡åœºæ™¯ä¸‹çš„â€œé›¶æ°´ä½â€å¸¸æ€ï¼Œæ£€æµ‹ç®—æ³•éœ€è¦å…·å¤‡æé«˜çš„é²æ£’æ€§ã€‚</p>
<ul>
<li>é€šç”¨æ–¹æ¡ˆï¼šæ ‡å‡†<strong>3-Sigmaç®—æ³•</strong>é¢„è®¾æ•°æ®ç¬¦åˆæ­£æ€åˆ†å¸ƒï¼Œè€Œé”™è¯¯æ•°æŒ‡æ ‡å¾€å¾€å‘ˆç°<strong>æ­£åæ€ã€é«˜å³°åº¦</strong>ç‰¹å¾ï¼Œç›´æ¥åº”ç”¨ä¼šå¯¼è‡´è™šå‡å‘Šè­¦é¢‘ç¹ï¼Œäº§ç”Ÿå¤§é‡â€œå‘Šè­¦å™ªéŸ³â€ï¼›</li>
<li>è½åœ°æ–¹æ¡ˆï¼šåŸºäºå››åˆ†ä½è·ï¼ˆIQRï¼‰ç®—æ³•è¿›è¡Œæ·±åº¦æ”¹è¿›ã€‚é€šè¿‡åŠ¨æ€è°ƒæ•´æ¯”ä¾‹ç³»æ•°ä¸é˜ˆå€¼è¾¹ç•Œï¼Œå®Œç¾é€‚é…éæ­£æ€åˆ†å¸ƒçš„é”™è¯¯æ•°æŒ‡æ ‡ï¼Œåœ¨ç¡®ä¿çµæ•åº¦çš„åŒæ—¶æ˜¾è‘—é™ä½äº†è¯¯æŠ¥ç‡ï¼›</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4053b1dd14cf4258bbd434eb0f96dfc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=ZdA5BBMcNLpD%2Bc2kWO9djiAzVHs%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>ç»¼åˆè€ƒè™‘ï¼Œä½¿ç”¨IQRå¼‚å¸¸æ£€æµ‹ï¼š</p>
<ul>
<li>IQRæ˜¯æŒ‡ï¼šä¸Šå››åˆ†ä½æ•°ä¸ä¸‹å››åˆ†ä½æ•°ï¼ˆ25%åˆ†ä½æ•°ï¼‰ä¹‹å·®ï¼Œå³ç®±å‹å›¾ä¸­ç®±ä½“çš„é«˜åº¦ã€‚</li>
<li>IQRå¼‚å¸¸æ£€æµ‹æ˜¯æŒ‡ï¼šè¶…è¿‡ä¸Šå››åˆ†ä½æ•°1.5å€çš„IQRï¼Œæˆ–ä½äºä¸‹å››åˆ†ä½æ•°1.5å€çš„IQRï¼Œåˆ™ä¸ºå¼‚å¸¸ã€‚</li>
</ul>
<p>ç»“åˆé”™è¯¯æ•°æŒ‡æ ‡ç‰¹å¾ï¼Œå¯¹IQRå¼‚å¸¸æ£€æµ‹è¿›è¡Œäº†ä¸€äº›æ”¹è¿›ï¼š</p>
<ul>
<li>é›¶åŸºçº¿è‡ªé€‚åº”å¤„ç†ï¼šå½“æ—¶é—´åºåˆ—å¤§é‡ä¸º0æ—¶ï¼Œè‡ªåŠ¨æ’é™¤0å€¼è®¡ç®—åŸºçº¿ï¼Œé¿å…è¯¯æŠ¥ã€‚</li>
<li>åŒé˜ˆå€¼çº¦æŸï¼šé”™è¯¯æ•°è¶…è¿‡å¤šå°‘å¿…ä¸ºå¼‚å¸¸ï¼Œè¶…è¿‡åŸºçº¿å¤šå°‘å¿…ä¸ºå¼‚å¸¸ã€‚</li>
<li>å›¾ä¸­é«˜äº®éƒ¨åˆ†ï¼ˆ75%, 25%, +1.5, -1.5 ï¼‰å‡è®¾ç½®ä¸ºå¯è°ƒå‚æ•°ï¼Œé’ˆå¯¹ä¸åŒç®—æ³•åœºæ™¯åšå¾®è°ƒã€‚</li>
</ul>
<p><strong>è½åœ°æ•ˆæœ</strong></p>
<p>ä¸€èˆ¬å¼‚å¸¸æ£€æµ‹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4e9850aa98a4f21973913c79c7b30bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=VAoOknLuy9CO63WgzU1QbyvRDYg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>é›¶åŸºæŒ‡æ ‡çš„å¼‚å¸¸æ£€æµ‹ï¼šå™ªéŸ³æ˜¾è‘—é™ä½</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c03ee4df6f66494080e98b4086ebb353~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=jcYe5tFijaqDzrOSsAzajCdHgFk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>å‘¨æœŸæ€§æŒ‡æ ‡çš„å¼‚å¸¸æ£€æµ‹ï¼šèƒ½å‘ç°å±€éƒ¨å¼‚å¸¸ç‚¹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6e9c62a253a435db4fe36871e3b8f5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=lRcne%2F1YMQf%2FWgZnGzb6P%2FqrxZY%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-10">äº‹ä»¶æ ‡å‡†åŒ–ï¼šå› æœå…³è”çš„æœ€åä¸€å…¬é‡Œ</h3>
<p>åœ¨å¾—ç‰©ç®—æ³•ç”Ÿæ€ä¸­ï¼Œæ—¥å‡å˜æ›´æ¬¡æ•°è¾¾ä¸‡çº§ï¼Œæ¶µç›–äº†æ¨¡å‹è¿­ä»£ã€é…ç½®åˆ†å‘ã€ä»£ç éƒ¨ç½²ç­‰å¤šä¸ªç»´åº¦ã€‚<strong>äº‹ä»¶æ ‡å‡†åŒ–çš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼šè®©æ¯ä¸€æ¬¡å˜æ›´éƒ½æœ‰è¿¹å¯å¾ªï¼Œå¹¶èƒ½è‡ªåŠ¨ä¸é“¾è·¯æŠ–åŠ¨å»ºç«‹å› æœå…³è”ã€‚</strong></p>
<p><strong>ç»Ÿä¸€äº‹ä»¶åè®®</strong></p>
<p>æˆ‘ä»¬å¯¹æ¥è‡ªé…ç½®ä¸­å¿ƒã€å‘å¸ƒå¹³å°ã€ç®—æ³•å®éªŒå¹³å°ç­‰10+ä¸ªæºå¤´çš„äº‹ä»¶è¿›è¡Œäº†åè®®æ ‡å‡†åŒ–ã€‚æ¯ä¸€ä¸ªè¿›å…¥å¯è§‚æµ‹åº•åº§çš„äº‹ä»¶éƒ½å¿…é¡»å…·å¤‡ä»¥ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li><strong>Source (å˜æ›´æº)ï¼š</strong> å˜æ›´çš„å¹³å°ï¼ˆé…ç½®ä¸­å¿ƒ / å‘å¸ƒå¹³å° / ABå®éªŒå¹³å° / ç‰¹å¾å¹³å° / æœºå™¨å­¦ä¹ å¹³å°ç­‰ ï¼‰</li>
<li><strong>ChangeObject (ä¸»ä½“)ï¼š</strong> å˜æ›´å¯¹è±¡ï¼ˆå¦‚ï¼šæŸä¸ªåº”ç”¨åã€æŸä¸ªé…ç½®æ–‡ä»¶ï¼‰</li>
<li><strong>ChangeStatus (çŠ¶æ€)ï¼š</strong> PENDING / APPROVED / CANCELED / FINISHED ç­‰</li>
<li><strong>StartTime(æ—¶é—´):</strong>Â å˜æ›´å¼€å§‹æ—¶é—´Â </li>
<li><strong>ChangeName (æ ‡é¢˜)ï¼š</strong> å˜æ›´ä¸»ä½“</li>
<li><strong>Severity (ç­‰çº§)ï¼š</strong> è¯„ä¼°å˜æ›´é£é™©ç­‰çº§ï¼ˆP0-P3ï¼‰</li>
<li><strong>beforeChangeContent (ä¸Šä¸€æ¬¡ç‰ˆæœ¬)ï¼š</strong> è®°å½•å˜æ›´å‰çš„å†…å®¹</li>
<li><strong>changeContent (ç‰ˆæœ¬)ï¼š</strong> è®°å½•å˜æ›´åçš„å†…å®¹</li>
<li><strong>extraInfo (é™„åŠ ä¿¡æ¯)ï¼š</strong> å¯é€‰å­—æ®µå¦‚ä¸‹ï¼š
<ul>
<li>&lt;scene: åœºæ™¯å&gt;ï¼Œ&lt;isGlobal: å…¨å±€å˜æ›´&gt;ï¼Œ&lt;isReboot: è‡ªåŠ¨å˜æ›´&gt; ...</li>
</ul>
</li>
</ul>
<p><strong>äº‹ä»¶æµ</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cc9ec97f88648e892427d61aff896f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=nBvaXqV072%2FTIEvFLmCzbTEtX8U%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<ul>
<li>å„å¹³å°é€šè¿‡OpenAPIæ–¹å¼ä¸ŠæŠ¥åˆ°äº‹ä»¶ä¸­å¿ƒï¼Œæ•°æ®å­˜å‚¨åœ¨ESä¸­</li>
<li>ç®—æ³•åŸŸç´¯è®¡10+ä¸ªå¹³å°100+ç§å˜æ›´å…¥å£ç±»å‹ï¼Œæ¯å¤©10+ä¸‡çš„å˜æ›´äº‹ä»¶</li>
</ul>
<p><strong>åœºæ™¯äº‹ä»¶å…³è”</strong></p>
<p>ç®—æ³•ä¾§ä¸€äº›æ ¸å¿ƒçš„å¹³å°çš„äº‹ä»¶åªèƒ½ä¸²è”ä¸Šä¸šåŠ¡åŸŸï¼Œè¿™ä¸€æœŸæˆ‘ä»¬ç”¨åœ¨çº¿TraceåŸ‹ç‚¹çš„æ–¹å¼ï¼Œä¸²è”é€šäº†æ ¸å¿ƒå¹³å°ä»ä¸€/å¤šä¸ªåœºæ™¯ï¼Œæ¯”å¦‚ï¼šç¤¾åŒºæœç´¢ä¸»æœç´¢ï¼Œé€šè¿‡åœ¨çº¿Traceæ¸…æ´—åå°±å¯ä»¥å…³è”ä¸Šï¼Œæœæ¨ABå®éªŒç®¡ç†å¹³å°ã€ç´¢å¼•å¹³å°ã€æ— çŸ©æœºå™¨å­¦ä¹ å¹³å°ç­‰ç­‰ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5365a8481a13470f943f8020e5468f26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=xdeN9PRh8XZdueL5Sv1zWrcqwqg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>ä¸Šçº¿æ•ˆæœ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ae68519fdad42ada7d384ab53f83991~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460951&amp;x-signature=xysmsQdtXlRJlx3pEaWjVGdyeB8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h2 data-id="heading-11">å…­ã€æ€»ç»“â€”ç®—æ³•åŸŸå…¨æ™¯å¯è§‚æµ‹æ€§çš„ 0 åˆ° 1</h2>
<p>ç®—æ³•åŸŸå…¨æ™¯å¯è§‚æµ‹æ€§çš„æ„å»ºï¼Œä»é›¶å¼€å§‹æ‘¸ç´¢ï¼Œæˆ‘ä»¬ç»å†äº†å¤šæ¬¡æŠ€æœ¯æ–¹æ¡ˆçš„è¿­ä»£ä¸ä¿®æ­£ã€‚è¿™è®©æˆ‘ä»¬æ„è¯†åˆ°ï¼Œç›‘æ§å»ºè®¾ä¸èƒ½ä¸ç»“åˆä¸šåŠ¡åœºæ™¯ï¼Œå¦åˆ™äº§ç”Ÿçš„æ•°æ®å¾ˆéš¾åœ¨å®é™…æ’æŸ¥ä¸­å‘æŒ¥ä»·å€¼ã€‚</p>
<p>åœ¨<strong>ä¸€æœŸå»ºè®¾</strong>ä¸­ï¼Œæˆ‘ä»¬èšç„¦äºå®ç”¨æ€§ï¼Œé€šè¿‡æ•´åˆé“¾è·¯ï¼ˆTraceï¼‰ã€æŒ‡æ ‡ï¼ˆMetricï¼‰ã€æ—¥å¿—ï¼ˆLogï¼‰ä»¥åŠå˜æ›´äº‹ä»¶ï¼Œæ‰“é€šäº†ä»åŸºç¡€æ¶æ„åˆ°ä¸šåŠ¡åº”ç”¨çš„çºµå‘å…³è”ã€‚è¿™å¥—ä½“ç³»ä¸ºäºŒçº¿è¿ç»´æä¾›äº†æ¸…æ™°çš„ä¸‹é’»èƒ½åŠ›ï¼Œä½¿å¾—æ•…éšœè¾¹ç•Œçš„é”å®šæ›´åŠ å¿«é€Ÿå‡†ç¡®ã€‚</p>
<p>è¿›å…¥<strong>äºŒæœŸé˜¶æ®µ</strong>ï¼Œæˆ‘ä»¬å°†é‡ç‚¹è§£å†³å­˜é‡ç¦»çº¿å˜æ›´çš„æ¥å…¥ä»¥åŠErrLog/ä¸šåŠ¡ç çš„æ ‡å‡†åŒ–é—®é¢˜ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬å°†è§‚æµ‹ç»´åº¦å»¶ä¼¸è‡³ä¸šåŠ¡æ•ˆæœæŒ‡æ ‡ï¼Œé€šè¿‡æ„å»ºé›†SLAç›‘æ§ã€äº‹ä»¶ä¸­å¿ƒä¸å¼‚å¸¸å¤§ç›˜äºä¸€ä½“çš„â€œç®—æ³•ä¸šåŠ¡åœºæ™¯NOC-SLAä¿éšœä½“ç³»â€ï¼Œå®ç°ä»â€œç³»ç»Ÿè¿è¡Œå¯è§â€åˆ°â€œä¸šåŠ¡è¿è¡Œç¨³å®šâ€çš„é—­ç¯ã€‚</p>
<h3 data-id="heading-12">å¾€æœŸå›é¡¾</h3>
<p>1.å‰ç«¯å¹³å°å¤§ä»“åº”ç”¨ç¨³å®šæ€§æ²»ç†ä¹‹è·¯ï½œå¾—ç‰©æŠ€æœ¯</p>
<p>2.RocketMQé«˜æ€§èƒ½æ­ç§˜ï¼šæ‰¿è½½ä¸‡äº¿çº§æµé‡çš„æ¶æ„å¥¥ç§˜ï½œå¾—ç‰©æŠ€æœ¯Â </p>
<p>3.PAGåœ¨å¾—ç‰©ç¤¾åŒºSçº§æ´»åŠ¨çš„è½åœ°</p>
<p>4.Ant Design 6.0 å°é²œï¼šä¸Šæ‰‹ç°ä»£åŒ–ç»„ä»¶å¼€å‘ï½œå¾—ç‰©æŠ€æœ¯</p>
<p>5.Java è®¾è®¡æ¨¡å¼ï¼šåŸç†ã€æ¡†æ¶åº”ç”¨ä¸å®æˆ˜å…¨è§£æï½œå¾—ç‰©æŠ€æœ¯</p>
<h3 data-id="heading-13">æ–‡ /å—é£</h3>
<p>å…³æ³¨å¾—ç‰©æŠ€æœ¯ï¼Œæ¯å‘¨æ›´æ–°æŠ€æœ¯å¹²è´§</p>
<p>è¦æ˜¯è§‰å¾—æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œæ¬¢è¿è¯„è®ºè½¬å‘ç‚¹èµï½</p>
<p>æœªç»å¾—ç‰©æŠ€æœ¯è®¸å¯ä¸¥ç¦è½¬è½½ï¼Œå¦åˆ™ä¾æ³•è¿½ç©¶æ³•å¾‹è´£ä»»ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutterç§»åŠ¨ç«¯è·å–ç›¸æœºå†…å‚]]></title>    <link>https://juejin.cn/post/7592550891540463635</link>    <guid>https://juejin.cn/post/7592550891540463635</guid>    <pubDate>2026-01-08T07:11:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592550891540463635" data-draft-id="7592508079307063315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutterç§»åŠ¨ç«¯è·å–ç›¸æœºå†…å‚"/> <meta itemprop="keywords" content="å‰ç«¯,Flutter"/> <meta itemprop="datePublished" content="2026-01-08T07:11:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‚…é‡Œå¶"/> <meta itemprop="url" content="https://juejin.cn/user/805267400309469"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutterç§»åŠ¨ç«¯è·å–ç›¸æœºå†…å‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/805267400309469/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‚…é‡Œå¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:11:51.000Z" title="Thu Jan 08 2026 07:11:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Flutter App ä¸­ç›¸æœºå†…å‚è·å–å…¨æµç¨‹</h2>
<blockquote>
<p><strong>ä¸€å¥è¯æ€»ç»“</strong><br/>
Flutter æœ¬èº«æ— æ³•æ‹¿åˆ°â€œçœŸå®ç›¸æœºå†…å‚â€ï¼Œå¿…é¡»é€šè¿‡ <strong>åŸç”Ÿ Android / iOS API</strong> è·å–ï¼Œç„¶åå›ä¼ ç»™ Flutterã€‚<br/>
âš ï¸ ä¸åŒåˆ†è¾¨ç‡ã€ä¸åŒæ‘„åƒå¤´ã€ä¸åŒå¯¹ç„¦çŠ¶æ€ï¼Œå†…å‚éƒ½ä¼šä¸åŒï¼Œéœ€è¦åŠ¨æ€è·å–æˆ–æŒ‰æ¯”ä¾‹è°ƒæ•´ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">1. ä»€ä¹ˆæ˜¯ç›¸æœºå†…å‚</h3>
<p>è§†è§‰é‡Œå¸¸ç”¨çš„å†…å‚çŸ©é˜µ (K)ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7708371ce45d4f4e8a7599fbf1376e6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YKF6YeM5Y-2:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461111&amp;x-signature=MnIJslh5N8zDyirzWQav8cDieKU%3D" alt="image.png" loading="lazy"/></p>





















<table><thead><tr><th>å‚æ•°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>fx, fy</td><td>ç„¦è·ï¼ˆåƒç´ å•ä½ï¼‰</td></tr><tr><td>cx, cy</td><td>ä¸»ç‚¹ï¼ˆé€šå¸¸åœ¨å›¾åƒä¸­å¿ƒé™„è¿‘ï¼‰</td></tr><tr><td>skew</td><td>ä¸€èˆ¬ä¸º 0</td></tr></tbody></table>
<blockquote>
<p>å·¥ç¨‹å®è·µä¸­ï¼ŒåŸºæœ¬å…³æ³¨ fx, fy, cx, cy å³å¯ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">2. Flutter å±‚è°ƒç”¨æ–¹æ³•</h3>
<p>Flutter ç«¯é€šè¿‡ <strong>MethodChannel</strong> è°ƒç”¨åŸç”Ÿæ¥å£ã€‚</p>
<h4 data-id="heading-3">æ–¹å¼ Aï¼šè¯¦ç»†ç‰ˆæœ¬ï¼ˆç”¨äºä¸Šä¼  / å±•ç¤ºï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">static const MethodChannel <span class="hljs-attr">_channel</span> = MethodChannel(<span class="hljs-string">'camera_intrinsics_detailed'</span>)<span class="hljs-comment">;</span>

Future&lt;CameraIntrinsicsResult?&gt; fetchCameraIntrinsics() async {
  final <span class="hljs-attr">result</span> = await _channel.invokeMethod(<span class="hljs-string">'getCameraIntrinsicsDetailed'</span>)<span class="hljs-comment">;</span>
  // è§£æ fx, fy, cx, cy, method, errorMargin
}
</code></pre>
<h4 data-id="heading-4">æ–¹å¼ Bï¼šç®€å•ç‰ˆæœ¬ï¼ˆä»…ç”¨äºæ–‡ä»¶å / ç®€å•ç”¨é€”ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">static const MethodChannel <span class="hljs-attr">_channel</span> = MethodChannel(<span class="hljs-string">'camera_intrinsics'</span>)<span class="hljs-comment">;</span>

Future&lt;CameraIntrinsics?&gt; getCameraIntrinsics() async {
  final <span class="hljs-attr">result</span> = await _channel.invokeMethod(<span class="hljs-string">'getCameraIntrinsics'</span>)<span class="hljs-comment">;</span>
  // åªè¿”å› fx, fy, cx, cy
}
</code></pre>
<hr/>
<h3 data-id="heading-5">3. Android åŸç”Ÿå®ç°ï¼ˆCamera2 APIï¼‰</h3>
<h4 data-id="heading-6">1ï¸âƒ£ é€‰æ‹©æ‘„åƒå¤´ï¼ˆä¼˜å…ˆåç½®ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> cameraManager = getSystemService(CAMERA_SERVICE) <span class="hljs-keyword">as</span> CameraManager
<span class="hljs-keyword">val</span> cameraIds = cameraManager.cameraIdList

<span class="hljs-keyword">var</span> targetCameraId: String? = <span class="hljs-literal">null</span>
<span class="hljs-keyword">for</span> (id <span class="hljs-keyword">in</span> cameraIds) {
    <span class="hljs-keyword">val</span> characteristics = cameraManager.getCameraCharacteristics(id)
    <span class="hljs-keyword">if</span> (characteristics.<span class="hljs-keyword">get</span>(CameraCharacteristics.LENS_FACING) ==
        CameraCharacteristics.LENS_FACING_BACK) {
        targetCameraId = id
        <span class="hljs-keyword">break</span>
    }
}
</code></pre>
<h4 data-id="heading-7">2ï¸âƒ£ è·å–å†…å‚ï¼ˆä¼˜å…ˆç¡¬ä»¶æ ¡å‡†ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">val <span class="hljs-attr">intrinsic</span> = characteristics.get(CameraCharacteristics.LENS_INTRINSIC_CALIBRATION)
val <span class="hljs-attr">fx</span> = intrinsic[<span class="hljs-number">0</span>].toDouble()
val <span class="hljs-attr">fy</span> = intrinsic[<span class="hljs-number">1</span>].toDouble()
val <span class="hljs-attr">cx</span> = intrinsic[<span class="hljs-number">2</span>].toDouble()
val <span class="hljs-attr">cy</span> = intrinsic[<span class="hljs-number">3</span>].toDouble()
</code></pre>
<ul>
<li>ç¡¬ä»¶æ ¡å‡†è¯¯å·®çº¦ 1%</li>
<li>è‹¥è·å–å¤±è´¥ï¼Œå¯ç”¨ä¼ æ„Ÿå™¨å‚æ•°è®¡ç®—ï¼š</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">val <span class="hljs-attr">sensorSize</span> = characteristics.get(CameraCharacteristics.SENSOR_INFO_PHYSICAL_SIZE)
val <span class="hljs-attr">pixelArray</span> = characteristics.get(CameraCharacteristics.SENSOR_INFO_PIXEL_ARRAY_SIZE)
val <span class="hljs-attr">focalLength</span> = characteristics.get(CameraCharacteristics.LENS_INFO_AVAILABLE_FOCAL_LENGTHS)[<span class="hljs-number">0</span>]

val <span class="hljs-attr">fx</span> = focalLength * pixelArray.width / sensorSize.width
val <span class="hljs-attr">fy</span> = focalLength * pixelArray.height / sensorSize.height
val <span class="hljs-attr">cx</span> = pixelArray.width / <span class="hljs-number">2.0</span>
val <span class="hljs-attr">cy</span> = pixelArray.height / <span class="hljs-number">2.0</span>
</code></pre>
<blockquote>
<p>è®¡ç®—å€¼è¯¯å·®çº¦ 5%ï¼Œ90% åœºæ™¯å¤Ÿç”¨ã€‚</p>
</blockquote>
<h4 data-id="heading-8">âš ï¸ æ³¨æ„å‘ç‚¹</h4>
<ol>
<li>åˆ†è¾¨ç‡å˜åŒ–æ—¶éœ€è¦é‡ç®— fx/fy</li>
<li>å‰åæ‘„åƒå¤´å†…å‚ä¸åŒ</li>
<li>CameraX é»˜è®¤éšè—å†…å‚ï¼Œéœ€è¦ Camera2Interop</li>
</ol>
<hr/>
<h3 data-id="heading-9">4. iOS åŸç”Ÿå®ç°ï¼ˆAVFoundationï¼‰</h3>
<h4 data-id="heading-10">1ï¸âƒ£ è·å–æ‘„åƒå¤´å’Œ activeFormat</h4>
<pre><code class="hljs language-ini" lang="ini">guard let <span class="hljs-attr">camera</span> = AVCaptureDevice.default(.builtInWideAngleCamera, for: .video, position: .back) else { return }
let <span class="hljs-attr">format</span> = camera.activeFormat
let <span class="hljs-attr">dimensions</span> = CMVideoFormatDescriptionGetDimensions(format.formatDescription)
let <span class="hljs-attr">width</span> = Double(dimensions.width)
let <span class="hljs-attr">height</span> = Double(dimensions.height)
</code></pre>
<h4 data-id="heading-11">2ï¸âƒ£ è·å–å†…å‚ï¼ˆæ¨èé¡ºåºï¼‰</h4>
<h5 data-id="heading-12">æ–¹æ³•1ï¼šCameraCalibrationDataï¼ˆæœ€å‡†ç¡®ï¼ŒARKit/TrueDepth æ”¯æŒï¼‰</h5>
<pre><code class="hljs language-ini" lang="ini">if let <span class="hljs-attr">intrinsic</span> = camera.cameraCalibrationData?.intrinsicMatrix {
    let <span class="hljs-attr">fx</span> = intrinsic.columns.<span class="hljs-number">0</span>.x
    let <span class="hljs-attr">fy</span> = intrinsic.columns.<span class="hljs-number">1</span>.y
    let <span class="hljs-attr">cx</span> = intrinsic.columns.<span class="hljs-number">2</span>.x
    let <span class="hljs-attr">cy</span> = intrinsic.columns.<span class="hljs-number">2</span>.y
}
</code></pre>
<h5 data-id="heading-13">æ–¹æ³•2ï¼šFOVè®¡ç®—ï¼ˆä¼°ç®—ï¼‰</h5>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">fovXRadians</span> = camera.activeFormat.videoFieldOfView * .pi / <span class="hljs-number">180</span>
let <span class="hljs-attr">fx</span> = width / (<span class="hljs-number">2</span> * tan(fovXRadians/<span class="hljs-number">2</span>))
let <span class="hljs-attr">fy</span> = fx * height / width
let <span class="hljs-attr">cx</span> = width / <span class="hljs-number">2</span>
let <span class="hljs-attr">cy</span> = height / <span class="hljs-number">2</span>
</code></pre>
<h5 data-id="heading-14">æ–¹æ³•3ï¼šç»éªŒå€¼ä¼°ç®—ï¼ˆç²—ç•¥ï¼‰</h5>
<pre><code class="hljs language-ini" lang="ini">let <span class="hljs-attr">fx</span> = width * <span class="hljs-number">1.2</span>
let <span class="hljs-attr">fy</span> = height * <span class="hljs-number">1.2</span>
let <span class="hljs-attr">cx</span> = width / <span class="hljs-number">2</span>
let <span class="hljs-attr">cy</span> = height / <span class="hljs-number">2</span>
</code></pre>
<hr/>
<h3 data-id="heading-15">5. Flutter è°ƒç”¨é“¾æ€»ç»“</h3>
<pre><code class="hljs language-scss" lang="scss">ç”¨æˆ·æ“ä½œ / é¡µé¢å¯åŠ¨
    â”‚
    â”œâ”€&gt; Flutter å±‚è°ƒç”¨ <span class="hljs-built_in">fetchCameraIntrinsics</span>()
    â”‚   â””â”€&gt; MethodChannel
    â”‚       â”œâ”€&gt; Android: Camera2 API
    â”‚       â””â”€&gt; iOS: AVCaptureDevice + CameraCalibrationData / FOV
    â”‚
    â””â”€&gt; è¿”å› fx, fy, cx, cyï¼Œå­˜å‚¨åˆ° SharedPreferences / æœ¬åœ°ç¼“å­˜
</code></pre>
<hr/>
<h3 data-id="heading-16">6. å·¥ç¨‹å®ç”¨ç»éªŒ</h3>
<ol>
<li>
<p><strong>ä¸åŒåˆ†è¾¨ç‡</strong>ï¼šå†…å‚æŒ‰æ¯”ä¾‹ç¼©æ”¾</p>
</li>
<li>
<p><strong>ä¸åŒæ‘„åƒå¤´</strong>ï¼šå‰åæ‘„åƒå¤´å†…å‚ä¸åŒ</p>
</li>
<li>
<p><strong>Flutter ç«¯</strong>ï¼šåªåšå­˜å‚¨ã€è®¡ç®—ã€æŠ•å½±ï¼Œæ ¸å¿ƒè·å–ä¾èµ–åŸç”Ÿ</p>
</li>
<li>
<p><strong>åŸå‹é˜¶æ®µ / OpenCV ç®—æ³•</strong>ï¼šå¯ç”¨è¿‘ä¼¼å€¼</p>
<pre><code class="hljs language-scss" lang="scss">fx â‰ˆ fy â‰ˆ <span class="hljs-built_in">max</span>(imageWidth, imageHeight)
cx â‰ˆ imageWidth / <span class="hljs-number">2</span>
cy â‰ˆ imageHeight / <span class="hljs-number">2</span>
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-17">7. æ€»ç»“</h3>
<ul>
<li>Flutter æœ¬èº«æ— æ³•ç›´æ¥è·å–ç›¸æœºå†…å‚</li>
<li>Android ç”¨ <strong>Camera2 API / LENS_INTRINSIC_CALIBRATION</strong></li>
<li>iOS ç”¨ <strong>CameraCalibrationData / activeFormat / FOV</strong></li>
<li>å®é™…ä½¿ç”¨æ—¶éœ€è€ƒè™‘åˆ†è¾¨ç‡ã€æ‘„åƒå¤´ã€å¯¹ç„¦çŠ¶æ€</li>
<li>å·¥ç¨‹ä¸Šå¯å…ˆç”¨è¿‘ä¼¼å€¼è·‘ç®—æ³•ï¼ŒåæœŸæŒ‰è®¾å¤‡ç²¾ç¡®è·å–</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€å‘äº†ä¸€ä¸ªnginxæ—¥å¿—åˆ†æé¢æ¿]]></title>    <link>https://juejin.cn/post/7592789801708093481</link>    <guid>https://juejin.cn/post/7592789801708093481</guid>    <pubDate>2026-01-08T07:21:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592789801708093481" data-draft-id="7592572266754015295" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€å‘äº†ä¸€ä¸ªnginxæ—¥å¿—åˆ†æé¢æ¿"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T07:21:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥å¥‡çš„ç¨‹åºå‘˜"/> <meta itemprop="url" content="https://juejin.cn/user/3984285870859614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€å‘äº†ä¸€ä¸ªnginxæ—¥å¿—åˆ†æé¢æ¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3984285870859614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥å¥‡çš„ç¨‹åºå‘˜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:21:46.000Z" title="Thu Jan 08 2026 07:21:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>æœ€è¿‘åœ¨ä¼˜åŒ–ç½‘ç«™è®¿é—®é“¾è·¯çš„è¿‡ç¨‹ä¸­ï¼Œéƒ¨ç½²äº†ä¸€å¥—WAFé˜²ç«å¢™ï¼Œå®ƒå¤§éƒ¨åˆ†åŠŸèƒ½éƒ½åšçš„æŒºå¥½ï¼Œç¾ä¸­ä¸è¶³çš„åœ°æ–¹å°±æ˜¯é’ˆå¯¹äºç½‘ç«™è®¿å®¢çš„ç›¸å…³åŠŸèƒ½éœ€è¦ä»˜è´¹ï¼ˆ3600å…ƒ/å¹´ï¼‰æ‰èƒ½ç”¨ã€‚</p>
<p>ä»˜è´¹æ˜¯ä¸å¯èƒ½ä»˜è´¹çš„ï¼Œæ‰¾äº†ä¸€åœˆnginxæ—¥å¿—åˆ†æçš„å¼€æºé¡¹ç›®ï¼Œå¤§éƒ¨åˆ†éƒ½åšçš„æŒºç®€é™‹çš„ï¼Œè¦ä¹ˆå°±æ˜¯åšçš„å¾ˆé‡ï¼Œéœ€è¦éƒ¨ç½²å…¶ä»–æœåŠ¡ã€‚</p>
<p>æ—¢ç„¶æ‰¾ä¸åˆ°åˆé€‚çš„ï¼Œé‚£å°±è‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªå§ï¼</p>
<h2 data-id="heading-1">å®ç°æ•ˆæœ</h2>
<p>åšäº†4ä¸ªæ¨¡å—å¯¹æ—¥å¿—æ•°æ®è¿›è¡Œåˆ†æã€‚</p>
<ul>
<li>è®¿é—®æ¦‚å†µ</li>
<li>æ•°æ®æ—¥æŠ¥</li>
<li>å®æ—¶è®¿é—®</li>
<li>è®¿é—®æ˜ç»†</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/911a2101b9024fe4919fb8bd613304d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=RcaE9N8vokbi5OudGmyN6V%2FkhAI%3D" alt="image-20260108124900609" loading="lazy"/></p>
<h3 data-id="heading-2">è®¿é—®æ¦‚å†µ</h3>
<p>æ¦‚å†µæ¨¡å—ä¸­ï¼Œåšäº†8ä¸ªç»´åº¦çš„æ•°æ®åˆ†æã€‚</p>
<h4 data-id="heading-3">æ ¸å¿ƒæŒ‡æ ‡</h4>
<p>åœ¨è¿™ä¸ªç»´åº¦ä¸­ï¼Œé’ˆå¯¹httpçŠ¶æ€ç ã€æµè§ˆé‡ã€è®¿å®¢æ•°ã€ä¼šè¯æ•°åšäº†æ›´ç»†è‡´çš„åˆ’åˆ†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f168bf5334d4c9db898072cf3d57062~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=Rtz2ae7gIa1NtDUe7ojsRMkwv8w%3D" alt="image-20260108125517344" loading="lazy"/></p>
<p>æ¯ä¸€ä¸ªåˆ’åˆ†ä¸­ï¼Œåœ¨è¯¦æƒ…é¢æ¿é‡Œï¼Œéƒ½å¯ä»¥çœ‹åˆ°è¿™ä¸ªè®¿å®¢åœ¨ä»€ä¹ˆæ—¶é—´åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d20d35c6946f4535a1b91786ed52ee9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=uVARW%2FMiCyGCLMC8C3Gv1asKj%2BA%3D" alt="image-20260108125954027" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b18fa3d7e76b41e58e32ccbaab1ae804~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=DAt%2F7%2Bhj%2FjgXLt3dWi1YdcdRYXY%3D" alt="image-20260108130323366" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b966189560a4ebb9090d549c94c87a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=mX6IOOg4SOHN9GwQG26F0eWDJn0%3D" alt="image-20260108130405011" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/beed1130896b447ba441c7e14dc52eb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=%2Fd6jOYuzbrhdY5Rp%2BKMCcE6M6DM%3D" alt="image-20260108130452437" loading="lazy"/></p>
<h4 data-id="heading-4">è¶‹åŠ¿åˆ†æ &amp; æ–°è€è®¿å®¢</h4>
<p>è¿™ä¸€éƒ¨åˆ†å¯ä»¥çœ‹åˆ°æ¯å¤©çš„è®¿é—®è¶‹åŠ¿ä»¥åŠå½“å¤©ä¸å‰ä¸€å¤©çš„æ–°è€è®¿å®¢å æ¯”ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98ab43663d3a4c82aa216cc548ed6a6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=%2BRuSX04hqA4Uz8OUYE9pN%2BFpBnM%3D" alt="image-20260108130725966" loading="lazy"/></p>
<h4 data-id="heading-5">æ¥è·¯ã€å—è®¿é¡µã€å…¥å£é¡µ</h4>
<p>è¿™éƒ¨åˆ†å¯ä»¥çœ‹åˆ°è®¿å®¢çš„æ¥æºï¼Œä»¥åŠæ¯ä¸ªè·¯å¾„çš„è®¿é—®æ¬¡æ•°ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a927b142042743489225abc3cd6cf66d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=8loK5dPbQe741IvA2Ou49%2BxJgjo%3D" alt="image-20260108131048943" loading="lazy"/></p>
<h4 data-id="heading-6">åœ°åŸŸ &amp; ç»ˆç«¯è®¾å¤‡</h4>
<p>è¿™éƒ¨åˆ†å¯ä»¥çœ‹åˆ°æ¯ä¸ªçœä»½çš„è®¿é—®æƒ…å†µä»¥åŠè®¿é—®è®¾å¤‡çš„åˆ†å¸ƒæƒ…å†µã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3681f72c2d946baa87219178f2f9fb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=HtHntBZI9KXCPpqFYmA1i%2FZ2RBc%3D" alt="image-20260108131213706" loading="lazy"/></p>
<h3 data-id="heading-7">æ•°æ®æ—¥æŠ¥</h3>
<p>åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ¯å¤©çš„æµè§ˆé‡ã€è®¿å®¢æ•°ã€å¹³å‡è®¿é—®æ—¶é•¿ç­‰ä¿¡æ¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/753b668bc809488b8c7213b5d07fde80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=lTY9GWlDm0K0YfIOtmgXd1k%2B%2FMo%3D" alt="image-20260108134815067" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d1e37a06c68484d809d33f4c0ce829c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=8KvnNraZ4KhfmUCFfCASNYU58bc%3D" alt="image-20260108140538356" loading="lazy"/></p>
<h3 data-id="heading-8">å®æ—¶è®¿é—®</h3>
<p>åœ¨è¿™ä¸ªæ¨¡å—é‡Œï¼Œå¯ä»¥æŸ¥çœ‹æœ€è¿‘5/15/30åˆ†é’Ÿå†…çš„è®¿é—®æƒ…å†µ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a20c57929b7248d5b647ccb45ed9525c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=qsYAgvZkpjfmnnRqdg5cWDMpzLQ%3D" alt="image-20260108141207205" loading="lazy"/></p>
<h3 data-id="heading-9">è®¿é—®æ˜ç»†</h3>
<p>è¿™ä¸ªæ¨¡å—å°±ä»¥è¡¨æ ¼çš„å½¢å¼å±•ç¤ºæ¯ä¸€æ¡æ—¥å¿—ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7061d17ae0a4813b7a3dc6a56de2a6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH55qE56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768461706&amp;x-signature=eSK9jQvqngUmuwYRZ4GwpZPcSVk%3D" alt="image-20260108141436301" loading="lazy"/></p>
<h2 data-id="heading-10">å¦‚ä½•ä½¿ç”¨</h2>
<p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘å·²ç»å°†è¿™ä¸ªé¡¹ç›®æ‰“åŒ…æˆé•œåƒå‘å¸ƒåˆ°dockerhubä¸Šäº†ï¼Œé•œåƒåä¸º<a href="https://link.juejin.cn?target=https%3A%2F%2Fhub.docker.com%2Frepository%2Fdocker%2Fmagiccoders%2Fnginxpulse%2Fgeneral" target="_blank" title="https://hub.docker.com/repository/docker/magiccoders/nginxpulse/general" ref="nofollow noopener noreferrer">magiccoders/nginxpulse</a>ï¼Œå¯ä»¥é€šè¿‡dockerçš„å½¢å¼ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡docker composeçš„å½¢å¼ä½¿ç”¨ã€‚</p>
<p>éœ€è¦ä¼ å…¥çš„å‚æ•°ï¼š</p>
<ul>
<li>WEBSITES å®ƒçš„å€¼æ˜¯ä¸ªæ•°ç»„ï¼Œä¸€ä¸ªå¯¹è±¡å°±æ˜¯ä¸€ä¸ªç½‘ç«™ï¼Œéœ€è¦ä¼ å…¥ç½‘ç«™åã€æ—¥å¿—è·¯å¾„ã€ç½‘å€ï¼ˆæˆ–è€…å†…ç½‘ipï¼Œä¸»è¦ç”¨äºç«™å†…/ç«™å¤–çš„åŒºåˆ†ï¼‰</li>
<li>ports ç«¯å£æ˜ å°„ï¼Œå®¹å™¨å†…æš´éœ²å‡ºæ¥çš„ç«¯å£æ˜¯8088</li>
<li>volumes æ–‡ä»¶æŒ‚è½½ï¼Œè¿™é‡Œéœ€è¦æŒ‚è½½ï¼šæ—¥å¿—æ–‡ä»¶ã€å®¹å™¨å†…äº§ç”Ÿçš„æ•°æ®æ–‡ä»¶ã€æ—¶åŒº</li>
</ul>
<p>æ­¤å¤„æˆ‘ä»¥docker composeçš„å½¢å¼ä¸¾ä¾‹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3"</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">nginxpulse:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">magiccoders/nginxpulse:latest</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">local_nginxpulse</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9200:8088"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">WEBSITES:</span> <span class="hljs-string">'[{"name":"ç¥å¥‡çš„ç¨‹åºå‘˜","logPath":"/var/log/nginx/access.log","domains":["kaisir.cn","www.kaisir.cn"]}]'</span> <span class="hljs-comment">#domainsç”¨äºâ€œæ¥æºï¼ˆrefererï¼‰ç»Ÿè®¡â€çš„ç«™å†…/ç«™å¤–åˆ†ç±»</span>
      <span class="hljs-attr">PV_EXCLUDE_IPS:</span> <span class="hljs-string">'["127.0.0.1", "::1", "10.10.0.1", "192.168.30.21"]'</span> <span class="hljs-comment">#pvç»Ÿè®¡æ—¶éœ€è¦æ’é™¤çš„ip</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./nginx_data/logs/all/access.log:/var/log/nginx/access.log</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./nginxpulse_data:/app/nginxpulse_data</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/etc/localtime:/etc/localtime</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
</code></pre>
<h2 data-id="heading-11">å†™åœ¨æœ€å</h2>
<p>è‡³æ­¤ï¼Œæ–‡ç« å°±åˆ†äº«å®Œæ¯•äº†ã€‚</p>
<p>æˆ‘æ˜¯<strong>ç¥å¥‡çš„ç¨‹åºå‘˜</strong>ï¼Œä¸€ä½å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆã€‚</p>
<p>å¦‚æœä½ å¯¹æˆ‘æ„Ÿå…´è¶£ï¼Œè¯·ç§»æ­¥æˆ‘çš„<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.kaisir.cn%2F" target="_blank" title="https://www.kaisir.cn/" ref="nofollow noopener noreferrer">ä¸ªäººç½‘ç«™</a>ï¼Œè¿›ä¸€æ­¥äº†è§£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å®šæ—¶ä»»åŠ¡å®æˆ˜æŒ‡å—ï¼šä»å•æœºåˆ°åˆ†å¸ƒå¼ï¼Œè¦†ç›–Spring Scheduler/Quartz/XXL-Jo]]></title>    <link>https://juejin.cn/post/7592765004807159859</link>    <guid>https://juejin.cn/post/7592765004807159859</guid>    <pubDate>2026-01-08T07:44:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592765004807159859" data-draft-id="7592710766009942026" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å®šæ—¶ä»»åŠ¡å®æˆ˜æŒ‡å—ï¼šä»å•æœºåˆ°åˆ†å¸ƒå¼ï¼Œè¦†ç›–Spring Scheduler/Quartz/XXL-Jo"/> <meta itemprop="keywords" content="åç«¯,åˆ†å¸ƒå¼"/> <meta itemprop="datePublished" content="2026-01-08T07:44:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å›å®¶è·¯ä¸Šç»•äº†å¼¯"/> <meta itemprop="url" content="https://juejin.cn/user/536217404587134"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å®šæ—¶ä»»åŠ¡å®æˆ˜æŒ‡å—ï¼šä»å•æœºåˆ°åˆ†å¸ƒå¼ï¼Œè¦†ç›–Spring Scheduler/Quartz/XXL-Jo
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/536217404587134/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å›å®¶è·¯ä¸Šç»•äº†å¼¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:44:16.000Z" title="Thu Jan 08 2026 07:44:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å®šæ—¶ä»»åŠ¡å®æˆ˜æŒ‡å—ï¼šä»å•æœºåˆ°åˆ†å¸ƒå¼ï¼Œè¦†ç›–Spring Scheduler/Quartz/XXL-Job</h2>
<p>åœ¨åç«¯å¼€å‘ä¸­ï¼Œå®šæ—¶ä»»åŠ¡æ˜¯ä¸å¯æˆ–ç¼ºçš„æ ¸å¿ƒç»„ä»¶â€”â€”æ•°æ®å®šæ—¶æ¸…ç†ã€æ¯æ—¥æŠ¥è¡¨ç”Ÿæˆã€å®šæ—¶æ¨é€é€šçŸ¥ã€è®¢å•è¶…æ—¶å…³é—­ç­‰åœºæ™¯ï¼Œéƒ½ç¦»ä¸å¼€å®šæ—¶ä»»åŠ¡çš„æ”¯æŒã€‚ä½†å®é™…å¼€å‘ä¸­ï¼Œå¾ˆå¤šå¼€å‘è€…åªåœç•™åœ¨â€œèƒ½ç”¨â€çš„å±‚é¢ï¼Œé¢å¯¹â€œä»»åŠ¡å¹¶å‘å†²çªâ€â€œåˆ†å¸ƒå¼éƒ¨ç½²é‡å¤æ‰§è¡Œâ€â€œä»»åŠ¡ç›‘æ§å‘Šè­¦â€ç­‰é—®é¢˜æ—¶æŸæ‰‹æ— ç­–ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬ä»åŸºç¡€åˆ°è¿›é˜¶ï¼Œå…¨é¢è®²è§£å®šæ—¶ä»»åŠ¡çš„å®ç°æ–¹æ¡ˆã€å®æˆ˜æŠ€å·§ä¸é¿å‘æŒ‡å—ï¼Œè¦†ç›–å•æœºåˆ°åˆ†å¸ƒå¼çš„å…¨åœºæ™¯éœ€æ±‚ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€å…ˆææ‡‚ï¼šå®šæ—¶ä»»åŠ¡çš„æ ¸å¿ƒä»·å€¼ä¸åº”ç”¨åœºæ™¯</h3>
<p>å®šæ—¶ä»»åŠ¡æœ¬è´¨æ˜¯â€œæŒ‰é¢„è®¾æ—¶é—´è§„åˆ™è‡ªåŠ¨æ‰§è¡Œçš„ä»£ç é€»è¾‘â€ï¼Œå…¶æ ¸å¿ƒä»·å€¼åœ¨äºâ€œè§£æ”¾äººå·¥ã€ä¿éšœä¸šåŠ¡å®šæ—¶é—­ç¯â€ã€‚å¸¸è§åº”ç”¨åœºæ™¯å¯åˆ†ä¸º5ç±»ï¼š</p>
<ul>
<li><strong>æ•°æ®æ²»ç†ç±»</strong>ï¼šæ¯æ—¥å‡Œæ™¨æ¸…ç†è¿‡æœŸæ—¥å¿—ã€æ— æ•ˆè®¢å•ï¼›å®šæœŸå½’æ¡£å†å²æ•°æ®ï¼ˆå¦‚å°†3ä¸ªæœˆå‰çš„è®¢å•æ•°æ®è¿ç§»è‡³å†å²åº“ï¼‰ï¼›</li>
<li><strong>ä¸šåŠ¡é—­ç¯ç±»</strong>ï¼šè®¢å•åˆ›å»ºå30åˆ†é’Ÿæœªæ”¯ä»˜è‡ªåŠ¨å…³é—­ï¼›ä¼šå‘˜åˆ°æœŸå‰3å¤©å‘é€ç»­è´¹æé†’ï¼›</li>
<li><strong>ç»Ÿè®¡æŠ¥è¡¨ç±»</strong>ï¼šæ¯æ—¥å‡Œæ™¨ç”Ÿæˆå‰ä¸€å¤©çš„é”€å”®æŠ¥è¡¨ã€ç”¨æˆ·æ´»è·ƒæŠ¥è¡¨ï¼›æ¯æœˆç”Ÿæˆæœˆåº¦ç»è¥åˆ†ææŠ¥å‘Šï¼›</li>
<li><strong>ç³»ç»Ÿè¿ç»´ç±»</strong>ï¼šå®šæ—¶æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€ï¼›å®šæœŸå¤‡ä»½æ•°æ®åº“ï¼›æ¸…ç†ç¼“å­˜ç¢ç‰‡ï¼›</li>
<li><strong>æ¶ˆæ¯æ¨é€ç±»</strong>ï¼šå®šæ—¶æ¨é€æ¯æ—¥æ—©å®‰æ¶ˆæ¯ã€è¥é”€æ´»åŠ¨é€šçŸ¥ï¼›å®šæ—¶åŒæ­¥ç¬¬ä¸‰æ–¹æ•°æ®ï¼ˆå¦‚åŒæ­¥ç‰©æµä¿¡æ¯ï¼‰ã€‚</li>
</ul>
<p>ä¸åŒåœºæ™¯å¯¹å®šæ—¶ä»»åŠ¡çš„è¦æ±‚ä¸åŒï¼šç®€å•åœºæ™¯åªéœ€â€œæŒ‰æ—¶æ‰§è¡Œâ€ï¼Œå¤æ‚åœºæ™¯åˆ™éœ€è¦è€ƒè™‘â€œé«˜å¯ç”¨ã€æ— é‡å¤ã€å¯ç›‘æ§ã€å¯é‡è¯•â€ã€‚</p>
<h3 data-id="heading-2">äºŒã€å®šæ—¶ä»»åŠ¡çš„3ç§æ ¸å¿ƒå®ç°æ–¹æ¡ˆï¼šé€‰å‹å¯¹æ¯”</h3>
<p>åç«¯å®šæ—¶ä»»åŠ¡çš„å®ç°æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œä»ç®€å•åˆ°å¤æ‚å¯åˆ†ä¸º3ä¸ªå±‚çº§ï¼Œä¸åŒæ–¹æ¡ˆé€‚é…ä¸åŒçš„ä¸šåŠ¡è§„æ¨¡ï¼š</p>





























<table><thead><tr><th>å®ç°æ–¹æ¡ˆ</th><th>æ ¸å¿ƒä¼˜åŠ¿</th><th>å±€é™æ€§</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>Spring Schedulerï¼ˆ@Scheduledï¼‰</td><td>1. é›¶ä¾èµ–ï¼ŒSpring BootåŸç”Ÿæ”¯æŒï¼›2. é…ç½®ç®€å•ï¼Œæ³¨è§£å¼å¼€å‘ï¼›3. è½»é‡é«˜æ•ˆï¼Œæ— é¢å¤–éƒ¨ç½²æˆæœ¬</td><td>1. ä¸æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²ï¼ˆæ˜“é‡å¤æ‰§è¡Œï¼‰ï¼›2. æ— å†…ç½®ç›‘æ§ã€é‡è¯•æœºåˆ¶ï¼›3. ä»»åŠ¡ä¾èµ–ã€åŠ¨æ€è°ƒæ•´èƒ½åŠ›å¼±</td><td>å•æœºéƒ¨ç½²ã€ç®€å•å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚å•æœºæœåŠ¡çš„æ—¥å¿—æ¸…ç†ï¼‰</td></tr><tr><td>Quartz</td><td>1. åŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå¤æ‚è°ƒåº¦è§„åˆ™ï¼ˆå¦‚æ—¥å†å¼è°ƒåº¦ï¼‰ï¼›2. æ”¯æŒæŒä¹…åŒ–ï¼ˆä»»åŠ¡ä¿¡æ¯å­˜å…¥æ•°æ®åº“ï¼‰ï¼›3. æ”¯æŒé›†ç¾¤éƒ¨ç½²ï¼ˆè§£å†³é‡å¤æ‰§è¡Œï¼‰ï¼›4. æ”¯æŒä»»åŠ¡ä¼˜å…ˆçº§ã€é‡è¯•</td><td>1. é…ç½®å¤æ‚ï¼Œä»£ç ä¾µå…¥æ€§è¾ƒå¼ºï¼›2. æ— å†…ç½®ç›‘æ§å‘Šè­¦ï¼Œéœ€è‡ªè¡Œå®ç°ï¼›3. åˆ†å¸ƒå¼åœºæ™¯ä¸‹è¿ç»´æˆæœ¬è¾ƒé«˜</td><td>å•æœº/é›†ç¾¤éƒ¨ç½²ã€å¤æ‚è°ƒåº¦è§„åˆ™çš„ä»»åŠ¡ï¼ˆå¦‚æŒ‰å·¥ä½œæ—¥æ‰§è¡Œã€ä»»åŠ¡ä¾èµ–ï¼‰</td></tr><tr><td>XXL-Jobï¼ˆåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼‰</td><td>1. åˆ†å¸ƒå¼éƒ¨ç½²æ— é‡å¤æ‰§è¡Œï¼›2. å†…ç½®Webç®¡ç†ç•Œé¢ï¼ˆä»»åŠ¡é…ç½®ã€æ‰§è¡Œæ—¥å¿—ã€ç›‘æ§å‘Šè­¦ï¼‰ï¼›3. æ”¯æŒåŠ¨æ€è°ƒæ•´ä»»åŠ¡ã€å¤±è´¥é‡è¯•ã€ä»»åŠ¡ä¾èµ–ï¼›4. æ”¯æŒåˆ†ç‰‡æ‰§è¡Œï¼ˆå¤§æ•°æ®é‡å¤„ç†ï¼‰</td><td>1. éœ€é¢å¤–éƒ¨ç½²è°ƒåº¦ä¸­å¿ƒï¼›2. è½»åº¦ä¾èµ–ä¸­é—´ä»¶ï¼ˆMySQLï¼‰ï¼›3. ç®€å•åœºæ™¯ç•¥æ˜¾é‡é‡çº§</td><td>åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ã€é«˜å¯ç”¨è¦æ±‚é«˜çš„æ ¸å¿ƒä¸šåŠ¡ä»»åŠ¡ï¼ˆå¦‚è®¢å•è¶…æ—¶å…³é—­ã€æŠ¥è¡¨ç”Ÿæˆï¼‰</td></tr></tbody></table>
<p>é€‰å‹å»ºè®®ï¼š 1. ç®€å•åœºæ™¯ï¼ˆå•æœºï¼‰ï¼šä¼˜å…ˆç”¨ Spring Schedulerï¼Œå¿«é€Ÿè½åœ°æ— æˆæœ¬ï¼› 2. å¤æ‚è°ƒåº¦ï¼ˆå•æœº/å°è§„æ¨¡é›†ç¾¤ï¼‰ï¼šç”¨ Quartzï¼Œå…¼é¡¾åŠŸèƒ½ä¸ç¨³å®šæ€§ï¼› 3. åˆ†å¸ƒå¼å¾®æœåŠ¡ï¼ˆå¤§è§„æ¨¡ã€é«˜å¯ç”¨ï¼‰ï¼šç”¨ XXL-Jobï¼Œè§£æ”¾è¿ç»´ä¸å¼€å‘æ•ˆç‡ã€‚</p>
<h3 data-id="heading-3">ä¸‰ã€å®æˆ˜ï¼š3ç§æ–¹æ¡ˆçš„Spring Bootè½åœ°å®ç°</h3>
<p>ä¸‹é¢ç»“åˆSpring Bootï¼Œåˆ†åˆ«å®ç°3ç§æ–¹æ¡ˆçš„å®šæ—¶ä»»åŠ¡ï¼Œè¦†ç›–ä»ç®€å•åˆ°å¤æ‚çš„å…¨åœºæ™¯ã€‚</p>
<h4 data-id="heading-4">1. æ–¹æ¡ˆä¸€ï¼šSpring Schedulerï¼ˆå•æœºç®€å•ä»»åŠ¡ï¼‰</h4>
<p>Spring Scheduleræ˜¯Springæ¡†æ¶å†…ç½®çš„å®šæ—¶ä»»åŠ¡ç»„ä»¶ï¼Œæ— éœ€é¢å¤–å¼•å…¥ä¾èµ–ï¼Œæ³¨è§£å¼å¼€å‘å³å¯å¿«é€Ÿå®ç°ã€‚</p>
<h5 data-id="heading-5">ï¼ˆ1ï¼‰ç¯å¢ƒå‡†å¤‡ï¼šå¯ç”¨å®šæ—¶ä»»åŠ¡</h5>
<p>åœ¨Spring Bootä¸»ç±»ä¸Šæ·»åŠ  <code>@EnableScheduling</code> æ³¨è§£ï¼Œå¯ç”¨å®šæ—¶ä»»åŠ¡åŠŸèƒ½ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">autoconfigure</span>.<span class="hljs-property">SpringBootApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">scheduling</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">EnableScheduling</span>;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableScheduling</span> <span class="hljs-comment">// å¯ç”¨å®šæ—¶ä»»åŠ¡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TimedTaskDemoApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">TimedTaskDemoApplication</span>.<span class="hljs-property">class</span>, args);
    }
}
</code></pre>
<h5 data-id="heading-6">ï¼ˆ2ï¼‰æ ¸å¿ƒå®ç°ï¼š@Scheduledæ³¨è§£ä½¿ç”¨</h5>
<p>åˆ›å»ºå®šæ—¶ä»»åŠ¡ç±»ï¼Œé€šè¿‡ <code>@Scheduled</code> æ³¨è§£å®šä¹‰ä»»åŠ¡æ‰§è¡Œè§„åˆ™ï¼Œæ”¯æŒ3ç§å¸¸è§æ—¶é—´é…ç½®ï¼šcronè¡¨è¾¾å¼ã€å›ºå®šé€Ÿç‡ã€å›ºå®šå»¶è¿Ÿã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.slf4j.MDC;
<span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.Scheduled;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> java.util.UUID;

<span class="hljs-comment">/**
 * Spring Scheduler å®šæ—¶ä»»åŠ¡ç¤ºä¾‹
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleTimedTask</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(SimpleTimedTask.class);

    <span class="hljs-comment">/**
     * 1. cronè¡¨è¾¾å¼ï¼šæŒ‰æŒ‡å®šæ—¶é—´æ‰§è¡Œï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹æ¸…ç†è¿‡æœŸè®¢å•ï¼‰
     * cronè¯­æ³•ï¼šç§’ åˆ† æ—¶ æ—¥ æœˆ å‘¨ å¹´ï¼ˆå¹´å¯é€‰ï¼‰
     * ç¤ºä¾‹ï¼š0 0 3 * * ?  è¡¨ç¤ºæ¯å¤©03:00:00æ‰§è¡Œ
     */</span>
    <span class="hljs-meta">@Scheduled(cron = "0 0 3 * * ?")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cleanExpiredOrder</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ‰‹åŠ¨ç»‘å®šrequestIdåˆ°MDCï¼Œä¾¿äºæ—¥å¿—è¿½è¸ªï¼ˆå‚è€ƒä¹‹å‰MDCåšå®¢å†…å®¹ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">requestId</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString().replace(<span class="hljs-string">"-"</span>, <span class="hljs-string">""</span>);
        MDC.put(<span class="hljs-string">"requestId"</span>, requestId);
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"å¼€å§‹æ¸…ç†è¿‡æœŸè®¢å•"</span>);
            <span class="hljs-comment">// æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼šåˆ é™¤åˆ›å»ºæ—¶é—´è¶…è¿‡30åˆ†é’Ÿä¸”æœªæ”¯ä»˜çš„è®¢å•</span>
            <span class="hljs-comment">// orderMapper.deleteExpiredOrder(30); </span>
            log.info(<span class="hljs-string">"è¿‡æœŸè®¢å•æ¸…ç†å®Œæˆ"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ¸…ç†è¿‡æœŸè®¢å•å¤±è´¥"</span>, e);
        } <span class="hljs-keyword">finally</span> {
            MDC.clear(); <span class="hljs-comment">// æ¸…é™¤MDCï¼Œé¿å…çº¿ç¨‹å¤ç”¨æ±¡æŸ“</span>
        }
    }

    <span class="hljs-comment">/**
     * 2. å›ºå®šé€Ÿç‡ï¼šæŒ‰å›ºå®šæ—¶é—´é—´éš”æ‰§è¡Œï¼ˆæ¯éš”5ç§’æ‰“å°ç³»ç»Ÿæ—¶é—´ï¼‰
     * fixedRateï¼šä»¥ä¸Šä¸€æ¬¡ä»»åŠ¡å¼€å§‹æ—¶é—´ä¸ºåŸºå‡†ï¼Œé—´éš”å›ºå®šæ—¶é—´æ‰§è¡Œ
     */</span>
    <span class="hljs-meta">@Scheduled(fixedRate = 5000)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printSystemTime</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"å½“å‰ç³»ç»Ÿæ—¶é—´ï¼š{}"</span>, System.currentTimeMillis());
    }

    <span class="hljs-comment">/**
     * 3. å›ºå®šå»¶è¿Ÿï¼šæŒ‰å›ºå®šå»¶è¿Ÿæ‰§è¡Œï¼ˆä¸Šä¸€æ¬¡ä»»åŠ¡ç»“æŸåï¼Œé—´éš”å›ºå®šæ—¶é—´å†æ‰§è¡Œï¼‰
     * fixedDelayï¼šé€‚åˆä»»åŠ¡æ‰§è¡Œæ—¶é—´ä¸å›ºå®šçš„åœºæ™¯ï¼ˆå¦‚æ•°æ®åŒæ­¥ï¼Œæ‰§è¡Œæ—¶é—´å¯èƒ½æ³¢åŠ¨ï¼‰
     */</span>
    <span class="hljs-meta">@Scheduled(fixedDelay = 10000)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">syncThirdPartyData</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"å¼€å§‹åŒæ­¥ç¬¬ä¸‰æ–¹ç‰©æµæ•°æ®"</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ¨¡æ‹ŸåŒæ­¥è€—æ—¶ï¼ˆ1-3ç§’ï¼‰</span>
            Thread.sleep((<span class="hljs-type">long</span>) (Math.random() * <span class="hljs-number">2000</span> + <span class="hljs-number">1000</span>));
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        log.info(<span class="hljs-string">"ç¬¬ä¸‰æ–¹ç‰©æµæ•°æ®åŒæ­¥å®Œæˆ"</span>);
    }
}
</code></pre>
<h5 data-id="heading-7">ï¼ˆ3ï¼‰å…³é”®é…ç½®ï¼šè‡ªå®šä¹‰çº¿ç¨‹æ± </h5>
<p>Spring Scheduleré»˜è®¤ä½¿ç”¨å•çº¿ç¨‹æ‰§è¡Œæ‰€æœ‰å®šæ—¶ä»»åŠ¡ï¼Œè‹¥å¤šä¸ªä»»åŠ¡åŒæ—¶è§¦å‘ï¼Œä¼šå¯¼è‡´ä»»åŠ¡é˜»å¡ï¼ˆä¸€ä¸ªä»»åŠ¡æ‰§è¡Œæ…¢ï¼Œåç»­ä»»åŠ¡æ’é˜Ÿï¼‰ã€‚å»ºè®®è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼Œæé«˜ä»»åŠ¡å¹¶å‘èƒ½åŠ›ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;
<span class="hljs-keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskScheduler;
<span class="hljs-keyword">import</span> java.util.concurrent.ThreadPoolExecutor;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableAsync</span> <span class="hljs-comment">// å¯ç”¨å¼‚æ­¥æ‰§è¡Œï¼ˆå¯é€‰ï¼Œç»“åˆ@Asyncä½¿ç”¨ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SchedulerConfig</span> {

    <span class="hljs-comment">/**
     * è‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± 
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ThreadPoolTaskScheduler <span class="hljs-title function_">taskScheduler</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskScheduler</span> <span class="hljs-variable">scheduler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskScheduler</span>();
        scheduler.setPoolSize(<span class="hljs-number">5</span>); <span class="hljs-comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span>
        scheduler.setThreadNamePrefix(<span class="hljs-string">"scheduler-thread-"</span>); <span class="hljs-comment">// çº¿ç¨‹åå‰ç¼€</span>
        scheduler.setAwaitTerminationSeconds(<span class="hljs-number">60</span>); <span class="hljs-comment">// ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆçš„æ—¶é—´</span>
        scheduler.setWaitForTasksToCompleteOnShutdown(<span class="hljs-literal">true</span>); <span class="hljs-comment">// å…³é—­æ—¶ç­‰å¾…ä»»åŠ¡å®Œæˆ</span>
        scheduler.setRejectedExecutionHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy()); <span class="hljs-comment">// æ‹’ç»ç­–ç•¥ï¼ˆè°ƒç”¨è€…æ‰§è¡Œï¼Œé¿å…ä»»åŠ¡ä¸¢å¤±ï¼‰</span>
        scheduler.initialize();
        <span class="hljs-keyword">return</span> scheduler;
    }
}
</code></pre>
<h4 data-id="heading-8">2. æ–¹æ¡ˆäºŒï¼šQuartzï¼ˆå¤æ‚è°ƒåº¦+é›†ç¾¤éƒ¨ç½²ï¼‰</h4>
<p>Quartzæ˜¯åŠŸèƒ½å¼ºå¤§çš„å¼€æºå®šæ—¶ä»»åŠ¡æ¡†æ¶ï¼Œæ”¯æŒå¤æ‚è°ƒåº¦è§„åˆ™ã€ä»»åŠ¡æŒä¹…åŒ–å’Œé›†ç¾¤éƒ¨ç½²ï¼Œé€‚åˆéœ€è¦â€œé«˜å¯é æ€§â€å’Œâ€œå¤æ‚è°ƒåº¦â€çš„åœºæ™¯ã€‚</p>
<h5 data-id="heading-9">ï¼ˆ1ï¼‰å¼•å…¥ä¾èµ–</h5>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Quartzæ ¸å¿ƒä¾èµ– --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!-- æ•°æ®åº“ä¾èµ–ï¼ˆç”¨äºä»»åŠ¡æŒä¹…åŒ–ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h5 data-id="heading-10">ï¼ˆ2ï¼‰é…ç½®Quartzï¼ˆapplication.ymlï¼‰</h5>
<p>é…ç½®Quartzçš„æ•°æ®æºï¼ˆä»»åŠ¡ä¿¡æ¯å­˜å…¥æ•°æ®åº“ï¼‰ã€çº¿ç¨‹æ± ã€é›†ç¾¤æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-comment"># æ•°æ®æºé…ç½®ï¼ˆä»»åŠ¡æŒä¹…åŒ–åˆ°MySQLï¼‰</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/quartz_db?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
  <span class="hljs-comment"># Quartzé…ç½®</span>
  <span class="hljs-attr">quartz:</span>
    <span class="hljs-attr">job-store-type:</span> <span class="hljs-string">JDBC</span> <span class="hljs-comment"># ä»»åŠ¡å­˜å‚¨æ–¹å¼ï¼šJDBCï¼ˆæŒä¹…åŒ–ï¼‰</span>
    <span class="hljs-attr">jdbc:</span>
      <span class="hljs-attr">initialize-schema:</span> <span class="hljs-string">NEVER</span> <span class="hljs-comment"># ä¸è‡ªåŠ¨åˆå§‹åŒ–è¡¨ç»“æ„ï¼ˆå»ºè®®æ‰‹åŠ¨æ‰§è¡ŒQuartzå®˜æ–¹SQLï¼‰</span>
    <span class="hljs-attr">properties:</span>
      <span class="hljs-attr">org:</span>
        <span class="hljs-attr">quartz:</span>
          <span class="hljs-attr">scheduler:</span>
            <span class="hljs-attr">instanceName:</span> <span class="hljs-string">quartzScheduler</span> <span class="hljs-comment"># è°ƒåº¦å™¨å®ä¾‹å</span>
            <span class="hljs-attr">instanceId:</span> <span class="hljs-string">AUTO</span> <span class="hljs-comment"># å®ä¾‹IDè‡ªåŠ¨ç”Ÿæˆï¼ˆé›†ç¾¤æ¨¡å¼å¿…é¡»ï¼‰</span>
          <span class="hljs-attr">threadPool:</span>
            <span class="hljs-attr">class:</span> <span class="hljs-string">org.quartz.simpl.SimpleThreadPool</span>
            <span class="hljs-attr">threadCount:</span> <span class="hljs-number">10</span> <span class="hljs-comment"># çº¿ç¨‹æ± å¤§å°</span>
            <span class="hljs-attr">threadPriority:</span> <span class="hljs-number">5</span> <span class="hljs-comment"># çº¿ç¨‹ä¼˜å…ˆçº§</span>
          <span class="hljs-attr">jobStore:</span>
            <span class="hljs-attr">class:</span> <span class="hljs-string">org.quartz.impl.jdbcjobstore.JobStoreTX</span> <span class="hljs-comment"># äº‹åŠ¡å‹å­˜å‚¨</span>
            <span class="hljs-attr">driverDelegateClass:</span> <span class="hljs-string">org.quartz.impl.jdbcjobstore.StdJDBCDelegate</span> <span class="hljs-comment"># MySQL delegate</span>
            <span class="hljs-attr">tablePrefix:</span> <span class="hljs-string">QRTZ_</span> <span class="hljs-comment"># è¡¨å‰ç¼€ï¼ˆQuartzå®˜æ–¹è¡¨çš„é»˜è®¤å‰ç¼€ï¼‰</span>
            <span class="hljs-attr">isClustered:</span> <span class="hljs-literal">true</span> <span class="hljs-comment"># å¯ç”¨é›†ç¾¤æ¨¡å¼</span>
            <span class="hljs-attr">clusterCheckinInterval:</span> <span class="hljs-number">15000</span> <span class="hljs-comment"># é›†ç¾¤èŠ‚ç‚¹å¿ƒè·³é—´éš”ï¼ˆ15ç§’ï¼‰</span>
            <span class="hljs-attr">useProperties:</span> <span class="hljs-literal">false</span> <span class="hljs-comment"># ä¸ä½¿ç”¨å±æ€§æ–‡ä»¶å­˜å‚¨ä»»åŠ¡å‚æ•°</span>
</code></pre>
<h5 data-id="heading-11">ï¼ˆ3ï¼‰å®ç°Quartzä»»åŠ¡ï¼ˆJobï¼‰</h5>
<p>Quartzçš„ä»»åŠ¡éœ€å®ç° <code>Job</code> æ¥å£ï¼Œé‡å†™ <code>execute</code> æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.quartz.Job;
<span class="hljs-keyword">import</span> org.quartz.JobExecutionContext;
<span class="hljs-keyword">import</span> org.quartz.JobExecutionException;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.slf4j.MDC;
<span class="hljs-keyword">import</span> java.util.UUID;

<span class="hljs-comment">/**
 * Quartzä»»åŠ¡ï¼šç”Ÿæˆæ¯æ—¥é”€å”®æŠ¥è¡¨
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DailySalesReportJob</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Job</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(DailySalesReportJob.class);

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(JobExecutionContext context)</span> <span class="hljs-keyword">throws</span> JobExecutionException {
        <span class="hljs-comment">// ç»‘å®šMDCé“¾è·¯æ ‡è¯†</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">requestId</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString().replace(<span class="hljs-string">"-"</span>, <span class="hljs-string">""</span>);
        MDC.put(<span class="hljs-string">"requestId"</span>, requestId);
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"å¼€å§‹ç”Ÿæˆæ¯æ—¥é”€å”®æŠ¥è¡¨"</span>);
            <span class="hljs-comment">// æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼šæŸ¥è¯¢å‰ä¸€å¤©çš„é”€å”®æ•°æ®ï¼Œç”ŸæˆExcelæŠ¥è¡¨å¹¶å­˜å‚¨</span>
            <span class="hljs-comment">// String reportPath = salesReportService.generateDailyReport();</span>
            <span class="hljs-comment">// log.info("æ¯æ—¥é”€å”®æŠ¥è¡¨ç”Ÿæˆå®Œæˆï¼Œè·¯å¾„ï¼š{}", reportPath);</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ç”Ÿæˆæ¯æ—¥é”€å”®æŠ¥è¡¨å¤±è´¥"</span>, e);
            <span class="hljs-comment">// è‹¥ä»»åŠ¡å¤±è´¥ï¼Œå¯æŠ›å‡ºå¼‚å¸¸è§¦å‘é‡è¯•ï¼ˆéœ€é…ç½®é‡è¯•ç­–ç•¥ï¼‰</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JobExecutionException</span>(<span class="hljs-string">"æŠ¥è¡¨ç”Ÿæˆå¤±è´¥ï¼Œè§¦å‘é‡è¯•"</span>, e, <span class="hljs-literal">true</span>);
        } <span class="hljs-keyword">finally</span> {
            MDC.clear();
        }
    }
}
</code></pre>
<h5 data-id="heading-12">ï¼ˆ4ï¼‰é…ç½®ä»»åŠ¡è§¦å‘å™¨ï¼ˆTriggerï¼‰</h5>
<p>é€šè¿‡é…ç½®ç±»åˆ›å»ºJobDetailå’ŒTriggerï¼Œå®šä¹‰ä»»åŠ¡æ‰§è¡Œè§„åˆ™ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.quartz.*;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuartzJobConfig</span> {

    <span class="hljs-comment">/**
     * 1. å®šä¹‰JobDetailï¼ˆä»»åŠ¡è¯¦æƒ…ï¼‰
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> JobDetail dailySalesReportJobDetail() {
        <span class="hljs-keyword">return</span> JobBuilder.newJob(DailySalesReportJob.<span class="hljs-keyword">class</span>)
                .withIdentity(<span class="hljs-string">"dailySalesReportJob"</span>, <span class="hljs-string">"reportGroup"</span>) <span class="hljs-comment">// ä»»åŠ¡æ ‡è¯†ï¼ˆåç§°+ç»„åï¼‰</span>
                .storeDurably() <span class="hljs-comment">// ä»»åŠ¡å³ä½¿æ²¡æœ‰è§¦å‘å™¨ä¹ŸæŒä¹…åŒ–</span>
                .build();
    }

    <span class="hljs-comment">/**
     * 2. å®šä¹‰Triggerï¼ˆè§¦å‘å™¨ï¼‰ï¼šæ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œ
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Trigger dailySalesReportTrigger() {
        <span class="hljs-comment">// è°ƒåº¦è§„åˆ™ï¼šæ¯å¤©02:00:00æ‰§è¡Œ</span>
        CronScheduleBuilder cronSchedule = CronScheduleBuilder.cronSchedule(<span class="hljs-string">"0 0 2 * * ?"</span>)
                .withMisfireHandlingInstructionDoNothing(); <span class="hljs-comment">// é”™è¿‡æ‰§è¡Œæ—¶é—´æ—¶ï¼Œä¸æ‰§è¡Œï¼ˆé¿å…é‡å¤æ‰§è¡Œï¼‰</span>

        <span class="hljs-keyword">return</span> TriggerBuilder.newTrigger()
                .forJob(dailySalesReportJobDetail()) <span class="hljs-comment">// ç»‘å®šä»»åŠ¡</span>
                .withIdentity(<span class="hljs-string">"dailySalesReportTrigger"</span>, <span class="hljs-string">"reportGroup"</span>) <span class="hljs-comment">// è§¦å‘å™¨æ ‡è¯†</span>
                .withSchedule(cronSchedule) <span class="hljs-comment">// ç»‘å®šè°ƒåº¦è§„åˆ™</span>
                .build();
    }
}
</code></pre>
<h4 data-id="heading-13">3. æ–¹æ¡ˆä¸‰ï¼šXXL-Jobï¼ˆåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼‰</h4>
<p>XXL-Jobæ˜¯å›½å†…å¼€æºçš„åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦å¹³å°ï¼ŒåŸºäºâ€œè°ƒåº¦ä¸­å¿ƒ+æ‰§è¡Œå™¨â€æ¶æ„ï¼Œæä¾›Webç®¡ç†ç•Œé¢ã€ä»»åŠ¡ç›‘æ§ã€å¤±è´¥é‡è¯•ã€åˆ†ç‰‡æ‰§è¡Œç­‰åŠŸèƒ½ï¼Œæ˜¯åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„çš„é¦–é€‰æ–¹æ¡ˆã€‚</p>
<h5 data-id="heading-14">ï¼ˆ1ï¼‰éƒ¨ç½²è°ƒåº¦ä¸­å¿ƒ</h5>
<ol>
<li>ä»XXL-Jobå®˜ç½‘ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.xuxueli.com%2Fxxl-job%2F%25EF%25BC%2589%25E4%25B8%258B%25E8%25BD%25BD%25E6%25BA%2590%25E7%25A0%2581%25EF%25BC%258C%25E6%2589%25A7%25E8%25A1%258C%25E6%25BA%2590%25E7%25A0%2581%25E4%25B8%25AD" target="_blank" title="https://www.xuxueli.com/xxl-job/%EF%BC%89%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81%EF%BC%8C%E6%89%A7%E8%A1%8C%E6%BA%90%E7%A0%81%E4%B8%AD" ref="nofollow noopener noreferrer">www.xuxueli.com/xxl-job/ï¼‰ä¸‹è½½â€¦</a> <code>doc/db/tables_xxl_job.sql</code> SQLæ–‡ä»¶ï¼Œåˆ›å»ºè°ƒåº¦ä¸­å¿ƒæ•°æ®åº“ï¼› 2. ä¿®æ”¹è°ƒåº¦ä¸­å¿ƒé…ç½®æ–‡ä»¶ï¼ˆ<code>xxl-job-admin/src/main/resources/application.properties</code>ï¼‰ï¼Œé…ç½®æ•°æ®åº“è¿æ¥ï¼› 3. å¯åŠ¨è°ƒåº¦ä¸­å¿ƒï¼ˆSpring Bootåº”ç”¨ï¼‰ï¼Œè®¿é—® <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A8080%2Fxxl-job-admin%25EF%25BC%258C%25E9%25BB%2598%25E8%25AE%25A4%25E8%25B4%25A6%25E5%258F%25B7%25E5%25AF%2586%25E7%25A0%2581%25EF%25BC%259Aadmin%2F123456%25E3%2580%2582" target="_blank" title="http://localhost:8080/xxl-job-admin%EF%BC%8C%E9%BB%98%E8%AE%A4%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%EF%BC%9Aadmin/123456%E3%80%82" ref="nofollow noopener noreferrer">http://localhost:8080/xxl-job-adminï¼Œé»˜è®¤è´¦å·å¯†ç ï¼šadmin/123456ã€‚</a></li>
</ol>
<h5 data-id="heading-15">ï¼ˆ2ï¼‰é›†æˆæ‰§è¡Œå™¨ï¼ˆSpring Booté¡¹ç›®ï¼‰</h5>
<h6 data-id="heading-16">â‘  å¼•å…¥ä¾èµ–</h6>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- XXL-Jobæ‰§è¡Œå™¨ä¾èµ– --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.xuxueli<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>xxl-job-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h6 data-id="heading-17">â‘¡ é…ç½®æ‰§è¡Œå™¨ï¼ˆapplication.ymlï¼‰</h6>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">xxl:</span>
  <span class="hljs-attr">job:</span>
    <span class="hljs-attr">admin:</span>
      <span class="hljs-attr">addresses:</span> <span class="hljs-string">http://localhost:8080/xxl-job-admin</span> <span class="hljs-comment"># è°ƒåº¦ä¸­å¿ƒåœ°å€</span>
    <span class="hljs-attr">executor:</span>
      <span class="hljs-attr">appname:</span> <span class="hljs-string">order-service-executor</span> <span class="hljs-comment"># æ‰§è¡Œå™¨åç§°ï¼ˆéœ€åœ¨è°ƒåº¦ä¸­å¿ƒæ³¨å†Œï¼‰</span>
      <span class="hljs-attr">address:</span> <span class="hljs-string">""</span> <span class="hljs-comment"># æ‰§è¡Œå™¨åœ°å€ï¼ˆç©ºåˆ™è‡ªåŠ¨æ³¨å†Œï¼‰</span>
      <span class="hljs-attr">ip:</span> <span class="hljs-string">""</span> <span class="hljs-comment"># æ‰§è¡Œå™¨IPï¼ˆç©ºåˆ™è‡ªåŠ¨è·å–ï¼‰</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">9999</span> <span class="hljs-comment"># æ‰§è¡Œå™¨ç«¯å£</span>
      <span class="hljs-attr">logpath:</span> <span class="hljs-string">./logs/xxl-job/</span> <span class="hljs-comment"># ä»»åŠ¡æ—¥å¿—è·¯å¾„</span>
      <span class="hljs-attr">logretentiondays:</span> <span class="hljs-number">30</span> <span class="hljs-comment"># æ—¥å¿—ä¿ç•™å¤©æ•°</span>
    <span class="hljs-attr">accessToken:</span> <span class="hljs-string">""</span> <span class="hljs-comment"># è°ƒåº¦ä¸­å¿ƒä¸æ‰§è¡Œå™¨çš„é€šä¿¡ä»¤ç‰Œï¼ˆç©ºåˆ™å…³é—­ï¼‰</span>
</code></pre>
<h6 data-id="heading-18">â‘¢ é…ç½®æ‰§è¡Œå™¨å®¢æˆ·ç«¯</h6>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> com.xxl.job.core.executor.impl.XxlJobSpringExecutor;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Value;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XxlJobConfig</span> {
    <span class="hljs-keyword">private</span> Logger logger = LoggerFactory.getLogger(XxlJobConfig.<span class="hljs-keyword">class</span>);

    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${xxl.job.admin.addresses}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String adminAddresses;

    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${xxl.job.executor.appname}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String appname;

    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${xxl.job.executor.port}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> int port;

    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${xxl.job.executor.logpath}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String logPath;

    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${xxl.job.accessToken}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String accessToken;

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> XxlJobSpringExecutor xxlJobExecutor() {
        logger.info(<span class="hljs-string">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; xxl-job config init."</span>);
        XxlJobSpringExecutor xxlJobSpringExecutor = new XxlJobSpringExecutor();
        xxlJobSpringExecutor.setAdminAddresses(adminAddresses);
        xxlJobSpringExecutor.setAppname(appname);
        xxlJobSpringExecutor.setPort(port);
        xxlJobSpringExecutor.setLogPath(logPath);
        xxlJobSpringExecutor.setAccessToken(accessToken);
        <span class="hljs-keyword">return</span> xxlJobSpringExecutor;
    }
}
</code></pre>
<h6 data-id="heading-19">â‘£ å®ç°XXL-Jobä»»åŠ¡</h6>
<p>é€šè¿‡ <code>@XxlJob</code> æ³¨è§£å®šä¹‰ä»»åŠ¡ï¼Œä»»åŠ¡é€»è¾‘å†™åœ¨æ³¨è§£æŒ‡å®šçš„æ–¹æ³•ä¸­ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.xxl.job.core.handler.annotation.XxlJob;
<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-comment">/**
 * XXL-Jobä»»åŠ¡ï¼šè®¢å•è¶…æ—¶å…³é—­
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderTimeoutCloseJob</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">log</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(OrderTimeoutCloseJob.class);

    <span class="hljs-comment">/**
     * ä»»åŠ¡æ ‡è¯†ï¼šorderTimeoutCloseHandlerï¼ˆéœ€åœ¨è°ƒåº¦ä¸­å¿ƒé…ç½®å¯¹åº”Handleråç§°ï¼‰
     */</span>
    <span class="hljs-meta">@XxlJob("orderTimeoutCloseHandler")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">orderTimeoutClose</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"å¼€å§‹æ‰§è¡Œè®¢å•è¶…æ—¶å…³é—­ä»»åŠ¡"</span>);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼šæŸ¥è¯¢æ‰€æœ‰åˆ›å»ºæ—¶é—´è¶…è¿‡30åˆ†é’Ÿä¸”æœªæ”¯ä»˜çš„è®¢å•ï¼Œæ‰§è¡Œå…³é—­æ“ä½œ</span>
            <span class="hljs-comment">// int closeCount = orderService.closeTimeoutOrder(30);</span>
            <span class="hljs-comment">// log.info("è®¢å•è¶…æ—¶å…³é—­ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå…±å…³é—­è®¢å•ï¼š{} ä¸ª", closeCount);</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"è®¢å•è¶…æ—¶å…³é—­ä»»åŠ¡æ‰§è¡Œå¤±è´¥"</span>, e);
            <span class="hljs-comment">// æŠ›å‡ºå¼‚å¸¸ï¼ŒXXL-Jobä¼šè‡ªåŠ¨è®°å½•å¤±è´¥çŠ¶æ€ï¼Œæ”¯æŒæ‰‹åŠ¨é‡è¯•æˆ–é…ç½®è‡ªåŠ¨é‡è¯•</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è®¢å•è¶…æ—¶å…³é—­å¤±è´¥"</span>, e);
        }
    }
}
</code></pre>
<h6 data-id="heading-20">â‘¤ è°ƒåº¦ä¸­å¿ƒé…ç½®ä»»åŠ¡</h6>
<ol>
<li>ç™»å½•XXL-Jobç®¡ç†ç•Œé¢ï¼Œåœ¨â€œæ‰§è¡Œå™¨ç®¡ç†â€ä¸­æ·»åŠ æ‰§è¡Œå™¨ï¼ˆAppNameä¸é…ç½®æ–‡ä»¶ä¸€è‡´ï¼‰ï¼› 2. åœ¨â€œä»»åŠ¡ç®¡ç†â€ä¸­åˆ›å»ºä»»åŠ¡ï¼š - ä»»åŠ¡æè¿°ï¼šè®¢å•è¶…æ—¶å…³é—­ï¼› - æ‰§è¡Œå™¨ï¼šé€‰æ‹©å·²æ³¨å†Œçš„æ‰§è¡Œå™¨ï¼› - ä»»åŠ¡ç±»å‹ï¼šBEANæ¨¡å¼ï¼› - JobHandlerï¼šå¡«å†™æ³¨è§£ä¸­çš„ä»»åŠ¡æ ‡è¯†ï¼ˆorderTimeoutCloseHandlerï¼‰ï¼› - è°ƒåº¦è§„åˆ™ï¼šcronè¡¨è¾¾å¼ï¼ˆå¦‚0 */1 * * * ? è¡¨ç¤ºæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼‰ï¼› 3. å¯åŠ¨ä»»åŠ¡ï¼Œå³å¯å®ç°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„å®šæ—¶æ‰§è¡Œã€‚</li>
</ol>
<h3 data-id="heading-21">å››ã€å®šæ—¶ä»»åŠ¡é¿å‘æŒ‡å—ï¼š10ä¸ªå¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h3>
<p>å®šæ—¶ä»»åŠ¡çœ‹ä¼¼ç®€å•ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®¹æ˜“å‡ºç°å„ç§é—®é¢˜ï¼Œä»¥ä¸‹æ˜¯10ä¸ªé«˜é¢‘å‘ç‚¹åŠè§„é¿æ–¹æ¡ˆï¼š</p>
<h4 data-id="heading-22">1. å‘ç‚¹1ï¼šå•æœºå¤šä»»åŠ¡é˜»å¡</h4>
<p>ç°è±¡ï¼šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œç¼“æ…¢ï¼Œå¯¼è‡´å…¶ä»–ä»»åŠ¡æ’é˜Ÿç­‰å¾…ï¼Œç”šè‡³é”™è¿‡æ‰§è¡Œæ—¶é—´ã€‚ è§„é¿ï¼šè‡ªå®šä¹‰å®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± ï¼Œè®¾ç½®åˆç†çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆæ ¹æ®ä»»åŠ¡æ•°é‡å’Œæ‰§è¡Œè€—æ—¶è°ƒæ•´ï¼‰ï¼›å¯¹è€—æ—¶ä»»åŠ¡å•ç‹¬é…ç½®çº¿ç¨‹æ± ã€‚</p>
<h4 data-id="heading-23">2. å‘ç‚¹2ï¼šåˆ†å¸ƒå¼éƒ¨ç½²é‡å¤æ‰§è¡Œ</h4>
<p>ç°è±¡ï¼šå¤šå®ä¾‹éƒ¨ç½²æ—¶ï¼ŒåŒä¸€ä¸ªå®šæ—¶ä»»åŠ¡åœ¨å¤šä¸ªå®ä¾‹ä¸ŠåŒæ—¶æ‰§è¡Œï¼Œå¯¼è‡´æ•°æ®é‡å¤ï¼ˆå¦‚é‡å¤å‘é€é€šçŸ¥ï¼‰ã€‚ è§„é¿ï¼š - ç®€å•åœºæ™¯ï¼šç”¨åˆ†å¸ƒå¼é”ï¼ˆå¦‚Redisson Lockï¼‰ï¼Œä»»åŠ¡æ‰§è¡Œå‰å…ˆè·å–é”ï¼Œè·å–å¤±è´¥åˆ™ä¸æ‰§è¡Œï¼› - å¤æ‚åœºæ™¯ï¼šä½¿ç”¨Quartzé›†ç¾¤æˆ–XXL-Jobï¼Œæ¡†æ¶è‡ªå¸¦åˆ†å¸ƒå¼åè°ƒæœºåˆ¶ã€‚</p>
<h4 data-id="heading-24">3. å‘ç‚¹3ï¼šä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œè¶…è¿‡ä¸‹æ¬¡è°ƒåº¦æ—¶é—´</h4>
<p>ç°è±¡ï¼šä»»åŠ¡æ‰§è¡Œæ—¶é—´è¶…è¿‡è°ƒåº¦é—´éš”ï¼ˆå¦‚æ¯éš”5ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œä½†ä»»åŠ¡éœ€è¦6ç§’å®Œæˆï¼‰ï¼Œå¯¼è‡´ä»»åŠ¡å åŠ æ‰§è¡Œã€‚ è§„é¿ï¼š - ç”¨ fixedDelay ä»£æ›¿ fixedRateï¼ˆfixedDelayä»¥ä¸Šæ¬¡ä»»åŠ¡ç»“æŸæ—¶é—´ä¸ºåŸºå‡†ï¼‰ï¼› - ä¼˜åŒ–ä»»åŠ¡é€»è¾‘ï¼Œæ‹†åˆ†è€—æ—¶ä»»åŠ¡ï¼ˆå¦‚å¤§æ•°æ®é‡å¤„ç†æ”¹ä¸ºåˆ†ç‰‡æ‰§è¡Œï¼‰ï¼› - é…ç½®ä»»åŠ¡å¹¶å‘æ§åˆ¶ï¼ˆå¦‚Quartzçš„ @DisallowConcurrentExecution æ³¨è§£ï¼Œç¦æ­¢å¹¶å‘æ‰§è¡Œï¼‰ã€‚</p>
<h4 data-id="heading-25">4. å‘ç‚¹4ï¼šä»»åŠ¡å¤±è´¥æ— é‡è¯•ï¼Œå¯¼è‡´ä¸šåŠ¡ä¸­æ–­</h4>
<p>ç°è±¡ï¼šä»»åŠ¡å› ç½‘ç»œæ³¢åŠ¨ã€ç¬¬ä¸‰æ–¹æœåŠ¡å¼‚å¸¸ç­‰ä¸´æ—¶é—®é¢˜å¤±è´¥ï¼Œæœªè§¦å‘é‡è¯•ï¼Œå¯¼è‡´ä¸šåŠ¡é—­ç¯ä¸­æ–­ï¼ˆå¦‚è®¢å•æœªåŠæ—¶å…³é—­ï¼‰ã€‚ è§„é¿ï¼š - Spring Schedulerï¼šç»“åˆ Spring Retry æ¡†æ¶ï¼Œæ·»åŠ  @Retryable æ³¨è§£ï¼› - Quartz/XXL-Jobï¼šé…ç½®ä»»åŠ¡é‡è¯•ç­–ç•¥ï¼ˆå¦‚å¤±è´¥åé‡è¯•3æ¬¡ï¼Œæ¯æ¬¡é—´éš”1åˆ†é’Ÿï¼‰ã€‚</p>
<h4 data-id="heading-26">5. å‘ç‚¹5ï¼šæ—¥å¿—æ— é“¾è·¯æ ‡è¯†ï¼Œæ’æŸ¥å›°éš¾</h4>
<p>ç°è±¡ï¼šå®šæ—¶ä»»åŠ¡æ—¥å¿—æ··æ‚åœ¨ä¸šåŠ¡æ—¥å¿—ä¸­ï¼Œæ— æ³•å¿«é€Ÿå®šä½æŸä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œçš„å®Œæ•´æ—¥å¿—ã€‚ è§„é¿ï¼šåœ¨ä»»åŠ¡æ‰§è¡Œå‰æ‰‹åŠ¨ç»‘å®šMDCé“¾è·¯æ ‡è¯†ï¼ˆå¦‚requestIdï¼‰ï¼Œæ‰§è¡Œåæ¸…é™¤ï¼Œç¡®ä¿æ—¥å¿—å¯è¿½è¸ªï¼ˆå‚è€ƒä¹‹å‰MDCåšå®¢å†…å®¹ï¼‰ã€‚</p>
<h4 data-id="heading-27">6. å‘ç‚¹6ï¼šä»»åŠ¡å‚æ•°ç¡¬ç¼–ç ï¼Œæ— æ³•åŠ¨æ€è°ƒæ•´</h4>
<p>ç°è±¡ï¼šä»»åŠ¡æ‰§è¡Œè§„åˆ™ï¼ˆå¦‚è¶…æ—¶æ—¶é—´ã€æ‰§è¡Œé—´éš”ï¼‰ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼Œéœ€è¦ä¿®æ”¹æ—¶å¿…é¡»é‡å¯æœåŠ¡ã€‚ è§„é¿ï¼š - Spring Schedulerï¼šç”¨ @Scheduled(cron = "${task.cron.clean-order}") ä»é…ç½®æ–‡ä»¶è¯»å–å‚æ•°ï¼› - XXL-Jobï¼šç›´æ¥åœ¨è°ƒåº¦ä¸­å¿ƒç•Œé¢ä¿®æ”¹è°ƒåº¦è§„åˆ™ï¼Œæ— éœ€é‡å¯æœåŠ¡ã€‚</p>
<h4 data-id="heading-28">7. å‘ç‚¹7ï¼šä»»åŠ¡æ— ç›‘æ§ï¼Œå¤±è´¥åæ— äººçŸ¥æ™“</h4>
<p>ç°è±¡ï¼šä»»åŠ¡æ‰§è¡Œå¤±è´¥åï¼Œå¼€å‘/è¿ç»´äººå‘˜æ— æ³•åŠæ—¶è·çŸ¥ï¼Œå¯¼è‡´é—®é¢˜æ‰©å¤§ï¼ˆå¦‚æŠ¥è¡¨æœªç”Ÿæˆï¼Œå½±å“ç»è¥å†³ç­–ï¼‰ã€‚ è§„é¿ï¼š - ç®€å•åœºæ™¯ï¼šä»»åŠ¡å¤±è´¥æ—¶å‘é€å‘Šè­¦é‚®ä»¶/é’‰é’‰æ¶ˆæ¯ï¼› - å¤æ‚åœºæ™¯ï¼šä½¿ç”¨XXL-Jobï¼Œé…ç½®ä»»åŠ¡å¤±è´¥å‘Šè­¦ï¼ˆæ”¯æŒé‚®ä»¶ã€é’‰é’‰ã€ä¼ä¸šå¾®ä¿¡ï¼‰ï¼›ç»“åˆPrometheus+Grafanaç›‘æ§ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ã€‚</p>
<h4 data-id="heading-29">8. å‘ç‚¹8ï¼šå¤§æ•°æ®é‡ä»»åŠ¡æ‰§è¡Œè¶…æ—¶</h4>
<p>ç°è±¡ï¼šå¤„ç†å¤§æ•°æ®é‡æ—¶ï¼ˆå¦‚æ¸…ç†100ä¸‡æ¡è¿‡æœŸæ•°æ®ï¼‰ï¼Œä»»åŠ¡æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œè¢«ç³»ç»Ÿä¸­æ–­ã€‚ è§„é¿ï¼š - åˆ†ç‰‡æ‰§è¡Œï¼šå°†ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªå­ä»»åŠ¡ï¼ˆå¦‚æŒ‰ç”¨æˆ·IDåˆ†ç‰‡ï¼‰ï¼Œå¤šä¸ªå®ä¾‹å¹¶è¡Œå¤„ç†ï¼› - åˆ†æ‰¹å¤„ç†ï¼šæ¯æ¬¡å¤„ç†1000æ¡æ•°æ®ï¼Œå¾ªç¯æ‰§è¡Œï¼Œé¿å…å•æ¬¡å¤„ç†æ•°æ®é‡è¿‡å¤§ã€‚</p>
<h4 data-id="heading-30">9. å‘ç‚¹9ï¼šä»»åŠ¡ä¾èµ–å¯¼è‡´æ‰§è¡Œé¡ºåºæ··ä¹±</h4>
<p>ç°è±¡ï¼šä»»åŠ¡Aéœ€è¦åœ¨ä»»åŠ¡Bæ‰§è¡Œå®Œæˆåæ‰§è¡Œï¼ˆå¦‚å…ˆæ¸…ç†æ•°æ®ï¼Œå†ç”ŸæˆæŠ¥è¡¨ï¼‰ï¼Œä½†å› è°ƒåº¦æœºåˆ¶å¯¼è‡´é¡ºåºæ··ä¹±ã€‚ è§„é¿ï¼š - ç®€å•åœºæ™¯ï¼šç”¨ fixedDelay æ§åˆ¶ä»»åŠ¡é—´éš”ï¼Œç¡®ä¿å‰ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼› - å¤æ‚åœºæ™¯ï¼šä½¿ç”¨Quartzçš„ä»»åŠ¡ä¾èµ–æœºåˆ¶ï¼Œæˆ–XXL-Jobçš„ä»»åŠ¡ç¼–æ’åŠŸèƒ½ã€‚</p>
<h4 data-id="heading-31">10. å‘ç‚¹10ï¼šæœåŠ¡é‡å¯æ—¶ä»»åŠ¡é‡å¤æ‰§è¡Œ</h4>
<p>ç°è±¡ï¼šæœåŠ¡é‡å¯æ—¶ï¼Œæœªæ‰§è¡Œå®Œæˆçš„å®šæ—¶ä»»åŠ¡è¢«é‡æ–°è§¦å‘ï¼Œå¯¼è‡´é‡å¤å¤„ç†ã€‚ è§„é¿ï¼š - ä»»åŠ¡å¹‚ç­‰æ€§è®¾è®¡ï¼šé€šè¿‡å”¯ä¸€æ ‡è¯†ï¼ˆå¦‚è®¢å•å·ï¼‰ç¡®ä¿é‡å¤æ‰§è¡Œä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨ï¼› - æŒä¹…åŒ–ä»»åŠ¡çŠ¶æ€ï¼šå°†ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å­˜å…¥æ•°æ®åº“ï¼Œä»»åŠ¡å¯åŠ¨æ—¶å…ˆæ£€æŸ¥çŠ¶æ€ï¼Œé¿å…é‡å¤æ‰§è¡Œã€‚</p>
<h3 data-id="heading-32">äº”ã€é«˜çº§ç”¨æ³•ï¼šå®šæ—¶ä»»åŠ¡çš„è¿›é˜¶èƒ½åŠ›</h3>
<p>å¯¹äºå¤æ‚ä¸šåŠ¡åœºæ™¯ï¼Œè¿˜éœ€è¦æŒæ¡å®šæ—¶ä»»åŠ¡çš„è¿›é˜¶èƒ½åŠ›ï¼Œæ»¡è¶³æ›´é«˜çš„ä¸šåŠ¡éœ€æ±‚ï¼š</p>
<h4 data-id="heading-33">1. åŠ¨æ€è°ƒæ•´ä»»åŠ¡æ‰§è¡Œè§„åˆ™</h4>
<p>éœ€æ±‚ï¼šæ ¹æ®ä¸šåŠ¡æµé‡åŠ¨æ€è°ƒæ•´ä»»åŠ¡æ‰§è¡Œé—´éš”ï¼ˆå¦‚é«˜å³°æœŸæ¯5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼Œä½å³°æœŸæ¯30åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚ å®ç°æ–¹æ¡ˆï¼š - Spring Schedulerï¼šé€šè¿‡ ScheduledFuture åŠ¨æ€å–æ¶ˆå’Œé‡æ–°åˆ›å»ºä»»åŠ¡ï¼› - XXL-Jobï¼šç›´æ¥è°ƒç”¨è°ƒåº¦ä¸­å¿ƒAPIä¿®æ”¹ä»»åŠ¡çš„cronè¡¨è¾¾å¼ï¼Œæ— éœ€é‡å¯æœåŠ¡ã€‚</p>
<h4 data-id="heading-34">2. ä»»åŠ¡åˆ†ç‰‡æ‰§è¡Œï¼ˆå¤§æ•°æ®é‡å¤„ç†ï¼‰</h4>
<p>éœ€æ±‚ï¼šå¤„ç†1000ä¸‡æ¡ç”¨æˆ·æ•°æ®ï¼Œå•å®ä¾‹æ‰§è¡Œè€—æ—¶è¿‡é•¿ï¼Œéœ€è¦å¤šå®ä¾‹å¹¶è¡Œå¤„ç†ã€‚ å®ç°æ–¹æ¡ˆï¼š - XXL-Jobï¼šæ”¯æŒåˆ†ç‰‡ä»»åŠ¡ï¼Œè°ƒåº¦ä¸­å¿ƒå°†ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªåˆ†ç‰‡ï¼Œåˆ†é…ç»™ä¸åŒæ‰§è¡Œå™¨å®ä¾‹å¹¶è¡Œæ‰§è¡Œï¼› - è‡ªå®šä¹‰åˆ†ç‰‡ï¼šåŸºäºRedisæˆ–æ•°æ®åº“å®ç°åˆ†ç‰‡è§„åˆ™ï¼ˆå¦‚æŒ‰ç”¨æˆ·IDå–æ¨¡åˆ†ç‰‡ï¼‰ï¼Œæ¯ä¸ªå®ä¾‹å¤„ç†æŒ‡å®šåˆ†ç‰‡çš„æ•°æ®ã€‚</p>
<h4 data-id="heading-35">3. ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ç›‘æ§ä¸å¯è§†åŒ–</h4>
<p>éœ€æ±‚ï¼šå®æ—¶æŸ¥çœ‹ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€ã€å†å²æ‰§è¡Œè®°å½•ã€å¤±è´¥åŸå› ï¼Œæ”¯æŒå¯è§†åŒ–ç»Ÿè®¡ã€‚ å®ç°æ–¹æ¡ˆï¼š - è‡ªå»ºç›‘æ§ï¼šå°†ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å­˜å…¥æ•°æ®åº“ï¼Œå¼€å‘ç›‘æ§ç•Œé¢ï¼› - å¼€æºå·¥å…·ï¼šä½¿ç”¨XXL-Jobçš„å†…ç½®ç›‘æ§åŠŸèƒ½ï¼Œæˆ–é›†æˆPrometheus+Grafanaå®ç°è‡ªå®šä¹‰ç›‘æ§é¢æ¿ã€‚</p>
<h4 data-id="heading-36">4. ä»»åŠ¡ç°åº¦å‘å¸ƒä¸å›æ»š</h4>
<p>éœ€æ±‚ï¼šæ–°ä»»åŠ¡ä¸Šçº¿æ—¶å…ˆåœ¨éƒ¨åˆ†å®ä¾‹æ‰§è¡Œï¼ˆç°åº¦ï¼‰ï¼ŒéªŒè¯æ— é—®é¢˜åå…¨é‡ä¸Šçº¿ï¼›å‡ºç°é—®é¢˜æ—¶æ”¯æŒå¿«é€Ÿå›æ»šã€‚ å®ç°æ–¹æ¡ˆï¼š - XXL-Jobï¼šæ”¯æŒä»»åŠ¡æ‰§è¡ŒèŒƒå›´æ§åˆ¶ï¼ˆæŒ‡å®šæ‰§è¡Œå™¨å®ä¾‹ï¼‰ï¼Œå®ç°ç°åº¦å‘å¸ƒï¼› - è‡ªå®šä¹‰å¼€å…³ï¼šé€šè¿‡é…ç½®ä¸­å¿ƒï¼ˆå¦‚Nacosï¼‰è®¾ç½®ä»»åŠ¡å¼€å…³ï¼Œæ”¯æŒå¿«é€Ÿå¯åœå’Œå›æ»šã€‚</p>
<h3 data-id="heading-37">å…­ã€æ€»ç»“ï¼šå®šæ—¶ä»»åŠ¡çš„é€‰å‹ä¸è½åœ°å»ºè®®</h3>
<p>å®šæ—¶ä»»åŠ¡çš„æ ¸å¿ƒæ˜¯â€œç¨³å®šã€å¯é ã€å¯ç›‘æ§â€ï¼Œé€‰å‹å’Œè½åœ°æ—¶éœ€éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š</p>
<ul>
<li><strong>é€‰å‹åŸåˆ™</strong>ï¼šç®€å•åœºæ™¯ç”¨Spring Schedulerï¼Œå¤æ‚è°ƒåº¦ç”¨Quartzï¼Œåˆ†å¸ƒå¼åœºæ™¯ç”¨XXL-Jobï¼›é¿å…è¿‡åº¦è®¾è®¡ï¼Œå°é¡¹ç›®æ— éœ€å¼•å…¥é‡é‡çº§æ¡†æ¶ï¼›</li>
<li><strong>è½åœ°æ ¸å¿ƒ</strong>ï¼šå¿…é¡»ä¿è¯ä»»åŠ¡å¹‚ç­‰æ€§ï¼ˆé¿å…é‡å¤æ‰§è¡Œé—®é¢˜ï¼‰ï¼›å¿…é¡»é…ç½®ç›‘æ§å‘Šè­¦ï¼ˆåŠæ—¶å‘ç°å¤±è´¥ä»»åŠ¡ï¼‰ï¼›å¿…é¡»ä¼˜åŒ–ä»»åŠ¡æ€§èƒ½ï¼ˆé¿å…é˜»å¡å’Œè¶…æ—¶ï¼‰ï¼›</li>
<li><strong>è¿›é˜¶æ–¹å‘</strong>ï¼šä»â€œå•æœºå®šæ—¶â€å‘â€œåˆ†å¸ƒå¼è°ƒåº¦â€æ¼”è¿›ï¼Œä»â€œé™æ€é…ç½®â€å‘â€œåŠ¨æ€è°ƒæ•´â€æ¼”è¿›ï¼Œä»â€œè¢«åŠ¨æ’æŸ¥â€å‘â€œä¸»åŠ¨ç›‘æ§â€æ¼”è¿›ã€‚</li>
</ul>
<p>æœ€åï¼Œå®šæ—¶ä»»åŠ¡æ˜¯ä¸šåŠ¡é—­ç¯çš„é‡è¦ä¿éšœï¼Œå¼€å‘æ—¶ä¸ä»…è¦å…³æ³¨â€œæŒ‰æ—¶æ‰§è¡Œâ€ï¼Œæ›´è¦è€ƒè™‘å¼‚å¸¸å¤„ç†ã€é«˜å¯ç”¨å’Œå¯è¿ç»´æ€§ã€‚å¸Œæœ›æœ¬æ–‡çš„å®æˆ˜æŒ‡å—èƒ½å¸®åŠ©ä½ é¿å¼€å‘ç‚¹ï¼Œå®ç°é«˜æ•ˆã€ç¨³å®šçš„å®šæ—¶ä»»åŠ¡è½åœ°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¬¬9ç«  Three.jsè½½å…¥æ¨¡å‹GLTF]]></title>    <link>https://juejin.cn/post/7592515924701757475</link>    <guid>https://juejin.cn/post/7592515924701757475</guid>    <pubDate>2026-01-08T07:49:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592515924701757475" data-draft-id="7592515924701741091" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¬¬9ç«  Three.jsè½½å…¥æ¨¡å‹GLTF"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,three.js"/> <meta itemprop="datePublished" content="2026-01-08T07:49:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XiaoYu2002"/> <meta itemprop="url" content="https://juejin.cn/user/251124329220663"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¬¬9ç«  Three.jsè½½å…¥æ¨¡å‹GLTF
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/251124329220663/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XiaoYu2002
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:49:25.000Z" title="Thu Jan 08 2026 07:49:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"â€œ";top:4px;left:6px}.markdown-body blockquote:after{content:"â€";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">9.1 åˆå§‹åŒ–è½½å…¥æ¨¡å‹</h2>
<p>GLTFï¼ˆGL Transmission Formatï¼‰æ˜¯ä¸€ç§ä¸“ä¸ºWebå’Œå®æ—¶åº”ç”¨è®¾è®¡çš„é«˜æ•ˆ3Dæ¨¡å‹æ–‡ä»¶æ ¼å¼ï¼Œè¢«ç§°ä¸ºâ€œ3Dé¢†åŸŸçš„JPEGâ€ã€‚å®ƒé‡‡ç”¨JSONç»“æ„æè¿°åœºæ™¯å±‚çº§ã€æè´¨ã€åŠ¨ç”»ç­‰å…ƒæ•°æ®ï¼Œå¹¶å°†çº¹ç†ã€å‡ ä½•ä½“ç­‰èµ„æºä»¥äºŒè¿›åˆ¶æˆ–ç‹¬ç«‹æ–‡ä»¶å½¢å¼å­˜å‚¨ï¼Œä»è€Œå®ç°å°ä½“ç§¯ã€å¿«é€Ÿè§£æå’Œå®Œæ•´åŠŸèƒ½æ”¯æŒã€‚</p>
<p>åœ¨Three.jsä¸­ï¼Œé€šå¸¸ä½¿ç”¨GLTFLoaderåŠ è½½GLTFæ–‡ä»¶ï¼ŒåŠ è½½åçš„æ¨¡å‹ä»¥åœºæ™¯å›¾å½¢å¼å‘ˆç°ï¼Œå¯ç›´æ¥èå…¥ç°æœ‰ä¸‰ç»´åœºæ™¯å¹¶è¿›è¡ŒåŠ¨ç”»æ§åˆ¶ã€äº¤äº’è°ƒæ•´ç­‰æ“ä½œï¼Œæˆä¸ºè¿æ¥ä¸“ä¸šå»ºæ¨¡å·¥å…·ï¼ˆå¦‚Blenderï¼‰ä¸WebGLåº”ç”¨çš„å…³é”®æ¡¥æ¢ã€‚</p>
<p>æˆ‘ä»¬è½½å…¥ä¸€ä¸ªè½¦çš„æ¨¡å‹ï¼Œéœ€è¦å¯¹åº”çš„æ–‡ä»¶scene.gltfå¯ä»¥æ‰¾æˆ‘è·å–ã€‚</p>
<p>Three.jsä½¿ç”¨æ¨¡å‹ä¾æ—§éœ€è¦é€šè¿‡åœºæ™¯ï¼Œæ­¥éª¤å¦‚ä¸‹3æ­¥ï¼š</p>
<p>ï¼ˆ1ï¼‰åˆ›å»ºåœºæ™¯ã€‚</p>
<p>ï¼ˆ2ï¼‰åŠ è½½GLTFæ–‡ä»¶ï¼ˆæ¨¡å‹ï¼‰ã€‚</p>
<p>ï¼ˆ3ï¼‰å°†åŠ è½½åçš„æ¨¡å‹æ”¾å…¥åœºæ™¯ä¸­ã€‚</p>
<p>è½½å…¥çš„GLTFæ¨¡å‹ï¼Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºæ˜¯ä¸€ä¸ªç‰©å“ï¼Œå³è¢«è§‚å¯Ÿå¯¹è±¡ã€‚å› æ­¤åƒç›¸æœºã€æ¸²æŸ“å™¨ä»¥åŠè½¨é“æ§åˆ¶å™¨ä¾æ—§æ˜¯éœ€è¦çš„ã€‚GLTFæ¨¡å‹åªæ˜¯åœºæ™¯ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œè€Œéå…¨éƒ¨ã€‚ä»¥ä¸‹ç¤ºä¾‹æ˜¯è½½å…¥ä¸€è¾†æ±½è½¦ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œå¯ä»¥è½½å…¥æ›´å¤šçš„æ¨¡å‹æˆ–è€…ä¸ç½‘æ ¼æ··åˆå»ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-variable constant_">THREE</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"three"</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">OrbitControls</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'three/examples/jsm/controls/OrbitControls.js'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GLTFLoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'three/examples/jsm/loaders/GLTFLoader.js'</span>

<span class="hljs-comment">// 1. åˆ›å»ºåœºæ™¯</span>
<span class="hljs-keyword">const</span> scene = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>()

<span class="hljs-comment">// 2. åŠ è½½GLTFæ–‡ä»¶ï¼ˆæ¨¡å‹ï¼‰</span>
<span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>();
loader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'./car/scene.gltf'</span>, <span class="hljs-function">(<span class="hljs-params">gltf</span>) =&gt;</span> {
  <span class="hljs-comment">// 3. å°†åŠ è½½åçš„æ¨¡å‹æ”¾å…¥åœºæ™¯ä¸­</span>
  scene.<span class="hljs-title function_">add</span>(gltf.<span class="hljs-property">scene</span>)
})

<span class="hljs-comment">//åˆ›å»ºç›¸æœº</span>
<span class="hljs-keyword">const</span> camera = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">30</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);
camera.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">20</span>);
scene.<span class="hljs-title function_">add</span>(camera);

<span class="hljs-comment">//åˆ›å»ºæ¸²æŸ“å™¨</span>
<span class="hljs-keyword">const</span> renderer = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>();
renderer.<span class="hljs-title function_">setSize</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>);
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(renderer.<span class="hljs-property">domElement</span>);
renderer.<span class="hljs-title function_">render</span>(scene, camera);

<span class="hljs-comment">//åˆ›å»ºè½¨é“æ§åˆ¶å™¨</span>

<span class="hljs-keyword">const</span> controls = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrbitControls</span>(camera, renderer.<span class="hljs-property">domElement</span>);

<span class="hljs-keyword">const</span> <span class="hljs-title function_">animate</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title function_">requestAnimationFrame</span>(animate);
  controls.<span class="hljs-title function_">update</span>();
  renderer.<span class="hljs-title function_">render</span>(scene, camera);
}
<span class="hljs-title function_">animate</span>();
</code></pre>
<p>GLTFæ¨¡å‹-è½¦æ¨¡å‹å±•ç¤ºå¦‚å›¾9-1æ‰€ç¤ºï¼Œå¯è§çš„åªæœ‰è½¦ç¯éƒ¨åˆ†ï¼Œè½¦æ¨¡å‹å…¶ä½™ä½ç½®ä¹Œæ¼†å˜›é»‘çš„ï¼Œè¿™æ„å‘³ç€æ‰€è½½å…¥çš„æ¨¡å‹çš„æè´¨ä¹Ÿæ˜¯å—å…‰ç…§å½±å“çš„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88cbb466d3b943e08f45a13ac20fb39c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768463365&amp;x-signature=ep%2B%2FxJJWvek9u8xmrhjShQWjTqs%3D" alt="image-20251219013349868" loading="lazy"/></p>
<p align="center">
 <b> å›¾9-1 GLTFæ¨¡å‹-è½¦æ¨¡å‹å±•ç¤º</b>
</p>
<h2 data-id="heading-1">9.2 æ·»åŠ ç¯å…‰</h2>
<p>å—å…‰ç…§å½±å“å…¶å®å¯¹äºè½¦æ¨¡å‹æ¥è¯´æ˜¯ä¸€ä»¶æ­£å¸¸çš„äº‹æƒ…ï¼Œå› ä¸ºå…‰ç…§å¯¹GLTFè½¦æ¨¡çš„å¡‘é€ ä¼˜åŠ¿éå¸¸æ˜æ˜¾ï¼Œå½“å¹³è¡Œå…‰ä»¥ä½è§’åº¦æ è¿‡è½¦èº«æ—¶ï¼Œé’£é‡‘ä»¶ä¸Šè¿ç»­çš„é«˜å…‰ä¼šæ²¿ç‰¹å¾çº¿ç²¾ç¡®æµåŠ¨ï¼›è€Œèšå…‰ç¯ä»ä¾§å‰æ–¹æŠ•å°„æ—¶ï¼Œä¸ä»…èƒ½åœ¨è½®æ¯‚è¾æ¡é—´é›•ç¢å‡ºå¤æ‚çš„é•‚ç©ºé˜´å½±ï¼Œæ›´èƒ½è®©å‰æ ¼æ …çš„ç«‹ä½“é€ å‹ä¸ä¿é™©æ çš„è¿›æ°”å£ç»“æ„äº§ç”Ÿæˆå‰§æ€§çš„æ·±æµ…å¯¹æ¯”ï¼Œå°†é™æ€æ¨¡å‹è½¬åŒ–ä¸ºå…·æœ‰è§†è§‰å™ç‡çš„åŠ¨æ€å±•ç¤ºã€‚</p>
<p>ä»æŠ€æœ¯å®ç°å±‚é¢ï¼Œä¸“ä¸šå¯¼å‡ºçš„GLTFæ¨¡å‹é€šå¸¸å†…åµŒåŸºäºç‰©ç†çš„æ¸²æŸ“æè´¨ï¼Œèƒ½ä¸Three.jsçš„å…‰ç…§ç³»ç»Ÿæ·±åº¦äº’åŠ¨ã€‚é‡‘å±æ¼†æè´¨åœ¨ç¯å¢ƒå…‰é®è”½ä¸‹ä¼šå‘ˆç°ç»†è…»çš„é¢—ç²’å±‚æ¬¡ï¼Œè½¦çª—ç»ç’ƒçš„è²æ¶…å°”åå°„ä¼šéšè§‚å¯Ÿè§’åº¦åŠ¨æ€å˜åŒ–ï¼›é€šè¿‡æ­é…HDRç¯å¢ƒè´´å›¾ï¼Œè½¦ä½“è¡¨é¢ä¸ä»…èƒ½åå°„æ¨¡æ‹Ÿå¤©ç©ºç›’çš„æŸ”å…‰ï¼Œæ›´èƒ½ç²¾å‡†å‘ˆç°å‘¨å›´è™šæ‹Ÿç¯å¢ƒçš„å€’å½±ï¼Œä½¿çƒ¤æ¼†è¡¨é¢äº§ç”Ÿæ·±é‚ƒçš„é•œé¢è´¨æ„Ÿä¸è‰²å½©é¥±å’Œåº¦ã€‚è¿™ç§å…‰ç…§ä¸æè´¨çš„ååŒä½œç”¨ï¼Œè®©æ¨¡å‹æ‘†è„±äº†â€œç©å…·æ„Ÿâ€ï¼Œåœ¨ç½‘é¡µä¸­è¿˜åŸå‡ºæ¥è¿‘å½±è§†çº§çš„çœŸå®æè´¨è¡¨ç°ä¸ç©ºé—´æ²‰æµ¸æ„Ÿã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">//æ·»åŠ ç¯å¢ƒå…‰</span>
<span class="hljs-keyword">const</span> light = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">DirectionalLight</span>(<span class="hljs-number">0xffffff</span>, <span class="hljs-number">100</span>);    
light.<span class="hljs-property">position</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>);
scene.<span class="hljs-title function_">add</span>(light);
</code></pre>
<p>æˆ‘ä»¬åœ¨ç›¸æœºåˆ›å»ºä¹‹å‰æ·»åŠ ç¯å¢ƒå…‰ï¼Œç„¶ååŠ å…¥åœºæ™¯ä¸­ã€‚è½¦æ¨¡å‹å…‰ç…§å±•ç¤ºå¦‚å›¾9-2æ‰€ç¤ºã€‚å¯ä»¥çœ‹è§è½¦çš„å®Œæ•´ç»“æ„ï¼Œéšç€é¼ æ ‡çš„æ‹–æ‹½ï¼Œå¯ä»¥çœ‹åˆ°ä¸åŒè§’åº¦ä¸‹çš„è½¦æ¨¡å‹å’Œå¯¹åº”åå…‰ï¼Œé€šè¿‡é¼ æ ‡æ»šè½®æ›´æ˜¯å¯ä»¥æ‹‰è¿‘æˆ–è€…è¿œç¦»è§†è§’ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a37aac81129641eeaa41f21cee0362e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768463365&amp;x-signature=CPvgogWr1NmgAOdcsGHiLTO4Sws%3D" alt="image-20251219014028187" loading="lazy"/></p>
<p align="center">
 <b> å›¾9-2 GLTFæ¨¡å‹-è½¦æ¨¡å‹å…‰ç…§å±•ç¤º</b>
</p>
<p>å½“æˆ‘ä»¬é€šè¿‡loader.load()åŠ è½½GLTFæ¨¡å‹æ—¶ï¼Œå¯ä»¥æ‹¿åˆ°å›è°ƒå‚æ•°gltfï¼Œå›è°ƒå‚æ•°gltfæ˜¯ä¸€ä¸ªç»“æ„åŒ–çš„å¯¹è±¡ï¼Œå®ƒæ˜¯æˆ‘ä»¬æ“ä½œæ•´ä¸ªåŠ è½½æ¨¡å‹çš„å…¥å£ã€‚æœ€å¸¸ç”¨çš„æ˜¯gltf.sceneï¼Œè¿™æ˜¯æ•´ä¸ªåŠ è½½æ¨¡å‹çš„æ ¹åœºæ™¯å¯¹è±¡ï¼Œç±»å‹ä¸º THREE.Group æˆ– THREE.Sceneã€‚éœ€è¦å°†å®ƒåŠ å…¥ä¸»åœºæ™¯ä¸­æ‰èƒ½æ˜¾ç¤ºã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰gltf.sceneså’Œgltf.animationsï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆ1ï¼‰gltf.scenesï¼šå¤šåœºæ™¯æƒ…å†µï¼Œä¸€ä¸ªåŒ…å«æ‰€æœ‰åœºæ™¯çš„æ•°ç»„ã€‚å¤§å¤šæ•°GLTFæ–‡ä»¶åªæœ‰ä¸€ä¸ªåœºæ™¯ï¼Œæ­¤æ—¶ gltf.scenes[0] ç­‰ä»·äº gltf.sceneã€‚å¦‚å›¾9-3çš„scenesä¸º[Group]å°±ç­‰åŒäºsceneå­—æ®µé‡Œçš„å†…å®¹ã€‚</p>
<p>ï¼ˆ2ï¼‰gltf.animationsï¼šåŒ…å«æ¨¡å‹æ‰€æœ‰åŠ¨ç”»å‰ªè¾‘çš„æ•°ç»„ã€‚è‹¥æ¨¡å‹æœ‰åŠ¨ç”»ï¼ˆå¦‚è§’è‰²è¡Œèµ°ã€æœºæ¢°è¿åŠ¨ï¼‰ï¼Œéœ€é…åˆTHREE.AnimationMixer ä½¿ç”¨ã€‚</p>
<p>å…¶ä»–çš„æ˜¯é¢å¤–ä¿¡æ¯ï¼Œä¾‹å¦‚assetå…ƒä¿¡æ¯ä¸­ï¼ŒåŒ…å«äº†è¯¥æ¨¡å‹ä»å“ªä¸ªç½‘ç«™ä¸‹è½½çš„ä»¥åŠè¯¥GLTFæ¨¡å‹çš„ç‰ˆæœ¬ã€‚camerasæ˜¯å†…ç½®ç›¸æœºï¼Œè¿™ä¸ªæ¨¡å‹æ²¡æœ‰ï¼Œæ‰€ä»¥æ˜¯ç©ºæ•°ç»„ã€‚parseræ˜¯GLTFçš„è§£æå™¨ï¼Œä¸éœ€è¦å»ç®¡ï¼Œè°ƒç”¨oader.load()æ–¹æ³•æ—¶ï¼Œæ–¹æ³•å†…éƒ¨ä¼šè‡ªåŠ¨è°ƒç”¨è§£æå™¨å»è§£æã€‚userDataæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„éƒ¨åˆ†ã€‚å›è°ƒå‚æ•°gltfä¿¡æ¯å¦‚å›¾9-3æ‰€ç¤ºã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e94753891c3e4bee81c2ba0bc0a33961~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768463365&amp;x-signature=5c2%2F0PhNI0a1OtR10XK5aqe%2FDZE%3D" alt="image-20251219015023225" loading="lazy"/></p>
<p align="center">
 <b> å›¾9-3 å›è°ƒå‚æ•°gltfä¿¡æ¯</b>
</p>
<p>ç›®å‰æˆ‘ä»¬çš„è½¦æ¨¡å‹æ˜¯é“¶ç™½è‰²çš„ï¼Œå¦‚æœæƒ³æŠŠè½¦æŸ“æˆç»¿çš„ï¼Œä¹Ÿæ˜¯å¯ä»¥åšåˆ°çš„ã€‚è½¦æ¨¡å‹ä¹Ÿæ˜¯é€šè¿‡å„ç§æè´¨å»æ‹¼æ¥è€Œæˆçš„ï¼Œæ‰€ä»¥åªè¦æ‰¾åˆ°è½¦æ¨¡å‹çš„æè´¨ï¼Œå°±å¯ä»¥è°ƒæ•´è½¦å¤–è¡¨çš„æ ·å¼ã€‚</p>
<p>è€Œç½‘æ ¼ç­‰äºå‡ ä½•ä½“åŠ æè´¨ï¼Œè¿™æ„å‘³ç€éœ€è¦æˆ‘ä»¬å»æ‰¾åˆ°è½¦æ¨¡å‹çš„ç½‘æ ¼ï¼Œæ‰¾åˆ°ç½‘æ ¼å°±åŸºæœ¬ä¸Šæ‰¾åˆ°æè´¨äº†ã€‚ä»å›è°ƒå‚æ•°gltfä¸­å»æ‰¾ã€‚ä½ç½®å¦‚ä¸‹ï¼šscenes[0].children[0].children[0].childrenï¼ˆç›´æ¥ä»sceneå¼€å§‹ä¹Ÿå¯ä»¥ï¼‰ã€‚å›è°ƒå‚æ•°gltfä¿¡æ¯çš„ç½‘æ ¼å‚æ•°å¦‚å›¾9-4æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°ä¸€å…±æœ‰59ä¸ªç½‘æ ¼ï¼Œå› æ­¤è½¦æ¨¡å‹å®é™…æ˜¯ç”±59ä¸ªç½‘æ ¼æ‹¼æ¥èµ·æ¥çš„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04d30912d63845db87446e6c14c64549~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768463365&amp;x-signature=ASY5vT0WeXgYiSNurwq9hgk%2FtDg%3D" alt="image-20251219020232471" loading="lazy"/></p>
<p align="center">
 <b> å›¾9-4 å›è°ƒå‚æ•°gltfä¿¡æ¯çš„ç½‘æ ¼å‚æ•°</b>
</p>
<h2 data-id="heading-2">9.3 ä¿®æ”¹è½¦æ¨¡å‹é¢œè‰²</h2>
<p>æ‰¾åˆ°äº†ç½‘æ ¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿ç½‘æ ¼é‡Œé¢çš„æè´¨å»ä¿®æ”¹é¢œè‰²ã€‚ä½†ç½‘æ ¼æœ‰é‚£ä¹ˆå¤šï¼Œæ€ä¹ˆçŸ¥é“è¦ä¿®æ”¹å“ªä¸€ä¸ªç½‘æ ¼é‡Œçš„æè´¨é¢œè‰²ï¼Ÿ</p>
<p>æƒ³è¦ç²¾ç»†åŒ–çš„å»ä¿®æ”¹é¢œè‰²éœ€è¦å¯¹è½¦æ¨¡å‹æ˜¯æ€ä¹ˆæ‹¼èµ·æ¥çš„ï¼ŒçŸ¥é“æ¯ä¸€ä¸ªç½‘æ ¼å¯¹åº”çš„ä½ç½®æ‰è¡Œã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥è¯»å–ç½‘æ ¼çš„åç§°ï¼ˆchild.nameï¼‰å°±èƒ½çŸ¥é“å¯¹åº”çš„å“ªä¸€éƒ¨åˆ†ï¼Œä½†æˆ‘ä»¬è¿™ä¸ªæ¡ˆä¾‹çš„è½¦æ¨¡å‹ç½‘æ ¼ä¸å¤ªè§„èŒƒï¼Œç½‘æ ¼çš„åç§°æ˜¯Object_1~59ï¼Œæ‰€ä»¥å¹¶ä¸æ¸…æ¥šå“ªä¸€å—ç½‘æ ¼å¯¹åº”è½¦çš„å“ªä¸ªä½ç½®ã€‚è¿™æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬å¦‚æœåªæ˜¯å•çº¯æƒ³ç»™è½¦å˜ä¸ªè‰²ï¼Œå¯ä»¥ç›´æ¥éå†childså˜é‡ï¼Œæ‹¿åˆ°æ‰€æœ‰çš„ç½‘æ ¼ï¼Œç„¶åä»ç½‘æ ¼ä¸­æ‹¿åˆ°materialæè´¨ï¼Œç›´æ¥ä¿®æ”¹é¢œè‰²ä¸º0x00ff00ï¼ˆç»¿è‰²ï¼‰ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GLTFLoader</span>();
loader.<span class="hljs-title function_">load</span>(<span class="hljs-string">'./car/scene.gltf'</span>, <span class="hljs-function">(<span class="hljs-params">gltf</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gltf)
  <span class="hljs-keyword">const</span> childs = gltf.<span class="hljs-property">scene</span>.<span class="hljs-property">children</span>[<span class="hljs-number">0</span>].<span class="hljs-property">children</span>[<span class="hljs-number">0</span>].<span class="hljs-property">children</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(childs)
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> child <span class="hljs-keyword">of</span> childs) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(child.<span class="hljs-property">name</span>)
    <span class="hljs-keyword">if</span> (child <span class="hljs-keyword">instanceof</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">Mesh</span>) {
      child.<span class="hljs-property">material</span>.<span class="hljs-property">color</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0x00ff00</span>);
    }
  }
  scene.<span class="hljs-title function_">add</span>(gltf.<span class="hljs-property">scene</span>);
});
</code></pre>
<p>è½¦æ¨¡å‹-ç»¿è‰²å¦‚å›¾9-5æ‰€ç¤ºã€‚å¯ä»¥çœ‹åˆ°å‡ ä¹æ‰€æœ‰çš„é¢œè‰²é™¤äº†è½¦çª—ä¹‹å¤–å…¨å˜ç»¿è‰²çš„äº†ã€‚è¯´æ˜æ˜¯å¯ä»¥æ‹¿åˆ°è½¦æ¨¡å‹çš„ç½‘æ ¼ï¼Œè€Œæ‹¿åˆ°ç½‘æ ¼å°±å¯ä»¥å¯¹å‡ ä½•ä½“æˆ–è€…æè´¨å»é’ˆå¯¹æ€§çš„ä¿®æ”¹ï¼Œä»è€Œä½¿è½¦æ¨¡å‹å˜æˆæˆ‘ä»¬çœŸæ­£æƒ³è¦çš„æ•ˆæœã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ed59c1da46d4f9f86fb0483cb47276e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWGlhb1l1MjAwMg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768463365&amp;x-signature=3l6PKoJ9EAaOu5H1lHjJveStS2w%3D" alt="image-20251219021105035" loading="lazy"/></p>
<p align="center">
 <b> å›¾9-5 è½¦æ¨¡å‹-ç»¿è‰²</b>
</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥è§£æLinuxæ ¹ç›®å½•æ ¸å¿ƒæ–‡ä»¶å¤¹çš„ä½œç”¨]]></title>    <link>https://juejin.cn/post/7592615536384344098</link>    <guid>https://juejin.cn/post/7592615536384344098</guid>    <pubDate>2026-01-08T07:59:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592615536384344098" data-draft-id="7592622563545907235" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥è§£æLinuxæ ¹ç›®å½•æ ¸å¿ƒæ–‡ä»¶å¤¹çš„ä½œç”¨"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-08T07:59:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥è§£æLinuxæ ¹ç›®å½•æ ¸å¿ƒæ–‡ä»¶å¤¹çš„ä½œç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T07:59:53.000Z" title="Thu Jan 08 2026 07:59:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶ç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„éµå¾ª <strong>Filesystem Hierarchy Standardï¼ˆFHSï¼‰</strong> â€‹ è§„èŒƒï¼Œæ ¹ç›®å½• <code>/</code>ä½œä¸ºæ‰€æœ‰ç›®å½•çš„â€œæ ¹èŠ‚ç‚¹â€ï¼Œå…¶ä¸‹æ¯ä¸ªå­ç›®å½•éƒ½æ‰¿æ‹…ç€ç‰¹å®šçš„ç³»ç»ŸåŠŸèƒ½æˆ–å­˜å‚¨è§’è‰²ã€‚ç†è§£æ ¹ç›®å½•å„æ–‡ä»¶å¤¹çš„ä½œç”¨ï¼Œæ˜¯é«˜æ•ˆç®¡ç†ç³»ç»Ÿã€é¡ºåˆ©éƒ¨ç½²é¡¹ç›®çš„å…³é”®ã€‚æœ¬æ–‡å°†å‰–ææ ¹ç›®å½•æ ¸å¿ƒæ–‡ä»¶å¤¹çš„åŠŸèƒ½ï¼Œå¹¶ç»“åˆçœŸå®é¡¹ç›®åœºæ™¯è®²è§£å®è·µæŠ€å·§ã€‚</p>
<h3 data-id="heading-0">1. <strong><code>/bin</code>ä¸ <code>/sbin</code>ï¼šåŸºç¡€å‘½ä»¤ä¸ç³»ç»Ÿç®¡ç†å·¥å…·</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li><code>/bin</code>ï¼šå­˜æ”¾æ‰€æœ‰ç”¨æˆ·å¯æ‰§è¡Œçš„åŸºç¡€å‘½ä»¤ï¼ˆå¦‚ <code>ls</code>ã€<code>cp</code>ã€<code>mv</code>ï¼‰ï¼Œç³»ç»Ÿå¯åŠ¨å’Œå•ç”¨æˆ·æ¨¡å¼å¿…éœ€ã€‚</li>
<li><code>/sbin</code>ï¼šå­˜æ”¾ç³»ç»Ÿç®¡ç†å‘½ä»¤ï¼ˆå¦‚ <code>fdisk</code>ã€<code>systemctl</code>ï¼‰ï¼Œä»…é™ç®¡ç†å‘˜ä½¿ç”¨ã€‚</li>
</ul>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>è„šæœ¬ä¾èµ–</strong>ï¼šåœ¨Shellè„šæœ¬ä¸­ç›´æ¥è°ƒç”¨ <code>/bin/bash</code>æˆ– <code>/usr/bin/python3</code>ã€‚</li>
<li><strong>æƒé™ç®¡ç†</strong>ï¼šé€šè¿‡ <code>/sbin/iptables</code>é…ç½®é˜²ç«å¢™è§„åˆ™ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-1">2. <strong><code>/etc</code>ï¼šç³»ç»Ÿé…ç½®çš„é›†ä¸­ç®¡ç†ä¸­å¿ƒ</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šå­˜å‚¨å…¨å±€é…ç½®æ–‡ä»¶ï¼ˆå¦‚ç½‘ç»œã€ç”¨æˆ·ç­–ç•¥ï¼‰å’Œ<strong>æœåŠ¡é…ç½®</strong>ï¼ˆå¦‚Nginxã€SpringBootï¼‰ï¼Œæ˜¯ç³»ç»Ÿå®šåˆ¶åŒ–çš„æ ¸å¿ƒè½½ä½“ã€‚</p>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>Nginxé…ç½®</strong>ï¼šä¿®æ”¹ <code>/etc/nginx/nginx.conf</code>å®šä¹‰è™šæ‹Ÿä¸»æœºã€è´Ÿè½½å‡è¡¡è§„åˆ™ï¼›æ–°å¢è‡ªå®šä¹‰é…ç½®å¯æ”¾å…¥ <code>/etc/nginx/conf.d/</code>ï¼ˆNginxä¼šè‡ªåŠ¨åŠ è½½è¯¥ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ï¼‰ã€‚</li>
<li><strong>MySQLå®‰å…¨åŠ å›º</strong>ï¼šç¼–è¾‘ <code>/etc/mysql/my.cnf</code>ï¼Œé…ç½®å­—ç¬¦é›†ã€è¿æ¥æ± å‚æ•°ï¼Œé‡å¯æœåŠ¡ç”Ÿæ•ˆã€‚</li>
<li><strong>SpringBooté…ç½®</strong>ï¼šåœ¨ <code>/etc/profile</code>ä¸­è®¾ç½®å…¨å±€ç¯å¢ƒå˜é‡ï¼ˆå¦‚æ•°æ®åº“è¿æ¥å‚æ•°ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-2">3. <strong><code>/home</code>ï¼šç”¨æˆ·æ•°æ®çš„ç‹¬ç«‹å­˜å‚¨åŒº</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šæ¯ä¸ªç”¨æˆ·çš„ç‹¬ç«‹ç›®å½•ï¼ˆå¦‚ <code>/home/dev</code>ï¼‰ï¼Œå­˜å‚¨ä¸ªäººæ–‡ä»¶ã€ä¸ªæ€§åŒ–é…ç½®ï¼ˆå¦‚ <code>.bashrc</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>ä»£ç ç®¡ç†</strong>ï¼šå¼€å‘è€…åœ¨ä¸ªäººç›®å½•ä¸‹å…‹éš†Gitä»“åº“ï¼ˆ<code>git clone</code>ï¼‰ã€‚</li>
<li><strong>ç¯å¢ƒéš”ç¦»</strong>ï¼šé€šè¿‡ <code>~/.m2/settings.xml</code>é…ç½®Mavenç§æœ‰ä»“åº“ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-3">4. <strong><code>/var</code>ï¼šåŠ¨æ€æ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šå­˜å‚¨æ—¥å¿—ï¼ˆ<code>/var/log</code>ï¼‰ã€æ•°æ®åº“ï¼ˆ<code>/var/lib/mysql</code>ï¼‰ã€ç¼“å­˜ï¼ˆ<code>/var/cache</code>ï¼‰ã€æœåŠ¡å¥—æ¥å­—ï¼ˆ<code>/var/run</code>ï¼‰ç­‰å¯å˜æ•°æ®ã€‚</p>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>æ—¥å¿—åˆ†æ</strong>ï¼šé€šè¿‡ <code>/var/log/nginx/access.log</code>åˆ†æè®¿é—®æµé‡ï¼›MySQLæ…¢æŸ¥è¯¢æ—¥å¿—éœ€åœ¨ <code>/etc/my.cnf</code>ä¸­å¯ç”¨ï¼ˆ<code>slow_query_log = 1</code>ï¼‰ï¼Œæ—¥å¿—ä¼šå†™å…¥ <code>/var/log/mysql/slow.log</code>ã€‚</li>
<li><strong>æ•°æ®åº“å¤‡ä»½</strong>ï¼šå®šæœŸå¤‡ä»½ <code>/var/lib/mysql</code>ä¸­çš„æ•°æ®åº“æ–‡ä»¶ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-4">5. <strong><code>/opt</code>ï¼šç¬¬ä¸‰æ–¹è½¯ä»¶çš„ç‹¬ç«‹å®‰è£…ç›®å½•</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šå­˜æ”¾å•†ä¸šè½¯ä»¶æˆ–å¤§å‹é—­æºå·¥å…·ï¼ˆå¦‚Dockerã€JDKï¼‰ï¼Œé¿å…ä¸ç³»ç»Ÿé»˜è®¤è½¯ä»¶å†²çªã€‚</p>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>ä¸­é—´ä»¶éƒ¨ç½²</strong>ï¼šå°†Rediså®‰è£…åˆ° <code>/opt/redis</code>ï¼Œç‹¬ç«‹ç®¡ç†é…ç½®å’Œæ•°æ®ã€‚</li>
<li><strong>å¤šç‰ˆæœ¬å…±å­˜</strong>ï¼šåœ¨ <code>/opt/java</code>ä¸‹å­˜æ”¾å¤šä¸ªJDKç‰ˆæœ¬ï¼Œé€šè¿‡ç¬¦å·é“¾æ¥åˆ‡æ¢ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-5">6. <strong><code>/tmp</code>ä¸ <code>/var/tmp</code>ï¼šä¸´æ—¶æ–‡ä»¶å­˜å‚¨åŒº</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li><code>/tmp</code>ï¼šä¸´æ—¶æ–‡ä»¶ï¼ˆé‡å¯åæ¸…ç†ï¼‰ï¼Œé€‚åˆçŸ­æœŸç¼“å­˜ã€‚</li>
<li><code>/var/tmp</code>ï¼šè·¨é‡å¯ä¿ç•™çš„ä¸´æ—¶æ•°æ®ï¼ˆå¦‚ç¼–è¯‘ä¸­é—´æ–‡ä»¶ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>æ–‡ä»¶ä¸Šä¼ </strong>ï¼šWebåº”ç”¨å°†ç”¨æˆ·ä¸Šä¼ çš„å›¾ç‰‡æš‚å­˜ <code>/tmp</code>ï¼Œå¤„ç†å®Œæˆåç§»åŠ¨è‡³æŒä¹…åŒ–ç›®å½•ã€‚</li>
<li><strong>ç¼–è¯‘æ„å»º</strong>ï¼šä½¿ç”¨ <code>make -j4 TMPDIR=/var/tmp</code>æŒ‡å®šå¤§æ–‡ä»¶ä¸´æ—¶å­˜å‚¨è·¯å¾„ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-6">7. <strong><code>/usr</code>ï¼šç³»ç»Ÿèµ„æºçš„å…±äº«å­˜å‚¨åŒº</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šå­˜æ”¾å…±äº«åº“ï¼ˆ<code>/usr/lib</code>ï¼‰ã€ç½‘é¡µï¼ˆ<code>/usr/share</code>ï¼‰å’Œç”¨æˆ·çº§ç¨‹åºï¼ˆ<code>/usr/bin</code>ï¼‰ã€‚</p>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>å¼€å‘ä¾èµ–</strong>ï¼šPythonåŒ…é»˜è®¤å®‰è£…åˆ° <code>/usr/local/lib/python3.10/site-packages</code>ã€‚</li>
<li><strong>å­—ä½“ç®¡ç†</strong>ï¼šåœ¨ <code>/usr/share/fonts</code>ä¸‹æ·»åŠ è‡ªå®šä¹‰å­—ä½“ï¼Œå…¨å±€ç”Ÿæ•ˆã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-7">8. <strong><code>/boot</code>ï¼šç³»ç»Ÿå¯åŠ¨çš„æ ¸å¿ƒæ–‡ä»¶å­˜å‚¨</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šå­˜å‚¨å†…æ ¸é•œåƒï¼ˆ<code>vmlinuz</code>ï¼‰ã€å¼•å¯¼åŠ è½½å™¨ï¼ˆå¦‚GRUBï¼‰çš„é…ç½®æ–‡ä»¶ã€‚</p>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>å†…æ ¸å‡çº§</strong>ï¼šæ›¿æ¢ <code>/boot</code>ä¸‹çš„æ–°å†…æ ¸æ–‡ä»¶å¹¶æ›´æ–°GRUBé…ç½®ã€‚</li>
<li><strong>æ•‘æ´æ¨¡å¼</strong>ï¼šé€šè¿‡Live CDæŒ‚è½½æ ¹åˆ†åŒºåï¼Œä» <code>/boot</code>æ¢å¤æŸåçš„å†…æ ¸ã€‚</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-8">9. <strong><code>/dev</code>ä¸ <code>/proc</code>ï¼šè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿçš„ä¿¡æ¯æ¥å£</strong>â€‹</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li><code>/dev</code>ï¼šè®¾å¤‡æ–‡ä»¶ï¼ˆå¦‚ <code>/dev/sda</code>è¡¨ç¤ºç¡¬ç›˜ï¼‰ã€‚</li>
<li><code>/proc</code>ï¼šå®æ—¶ç³»ç»Ÿä¿¡æ¯ï¼ˆå¦‚ <code>/proc/cpuinfo</code>ï¼‰ã€‚</li>
</ul>
</li>
<li>
<p><strong>é¡¹ç›®åœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>ç¡¬ä»¶è°ƒè¯•</strong>ï¼šé€šè¿‡ <code>/sys/class/net</code>æŸ¥çœ‹ç½‘ç»œæ¥å£çŠ¶æ€ã€‚</li>
<li><strong>æ€§èƒ½åˆ†æ</strong>ï¼šä½¿ç”¨ <code>cat /proc/meminfo</code>ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µã€‚</li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥ç†è§£ Volatileï¼šC#.NET å†…å­˜å¯è§æ€§ä¸æœ‰åºæ€§]]></title>    <link>https://juejin.cn/post/7592120202319183922</link>    <guid>https://juejin.cn/post/7592120202319183922</guid>    <pubDate>2026-01-06T23:18:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592120202319183922" data-draft-id="7592130164965244966" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£ Volatileï¼šC#.NET å†…å­˜å¯è§æ€§ä¸æœ‰åºæ€§"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2026-01-06T23:18:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å”é’æ«"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£ Volatileï¼šC#.NET å†…å­˜å¯è§æ€§ä¸æœ‰åºæ€§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å”é’æ«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-06T23:18:26.000Z" title="Tue Jan 06 2026 23:18:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-06
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ç®€ä»‹</h3>
<p><code>Volatile</code> æ˜¯ <code>C#</code> ä¸­å¤„ç†å†…å­˜å¯è§æ€§å’ŒæŒ‡ä»¤é‡æ’åºçš„å…³é”®æœºåˆ¶ï¼Œå®ƒæä¾›äº†å¯¹å†…å­˜è®¿é—®çš„ç²¾ç»†æ§åˆ¶ã€‚åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œ<code>volatile</code> å…³é”®å­—å’Œ <code>Volatile</code> ç±»éƒ½æ˜¯è§£å†³å…±äº«å˜é‡å¯è§æ€§é—®é¢˜çš„é‡è¦å·¥å…·ã€‚</p>
<h3 data-id="heading-1">ä¸ºä»€ä¹ˆéœ€è¦volatileï¼Ÿ</h3>
<h4 data-id="heading-2">CPU ç¼“å­˜å¯¼è‡´çš„ â€œå†…å­˜å¯è§æ€§â€ é—®é¢˜</h4>
<p>ç°ä»£ <code>CPU</code> ä¸ºæå‡æ€§èƒ½ï¼Œä¼šå°†é¢‘ç¹è®¿é—®çš„å˜é‡ç¼“å­˜åˆ°æ ¸å¿ƒä¸“å±çš„ç¼“å­˜ï¼ˆ<code>L1/L2/L3</code>ï¼‰ä¸­ï¼Œè€Œéæ¯æ¬¡éƒ½è¯»å†™ä¸»å†…å­˜ã€‚è¿™ä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>
<p>çº¿ç¨‹ A ä¿®æ”¹äº†å…±äº«å­—æ®µçš„å€¼ï¼ˆä»…å†™å…¥è‡ªå·±çš„ <code>CPU</code> ç¼“å­˜ï¼ŒæœªåŒæ­¥åˆ°ä¸»å†…å­˜ï¼‰ï¼›</p>
</li>
<li>
<p>çº¿ç¨‹ B è¯»å–è¯¥å­—æ®µæ—¶ï¼Œä»è‡ªå·±çš„ <code>CPU</code> ç¼“å­˜è¯»å–ï¼ˆä»æ˜¯æ—§å€¼ï¼‰ï¼Œæ— æ³•çœ‹åˆ°çº¿ç¨‹ A çš„ä¿®æ”¹ã€‚</p>
</li>
</ul>
<h4 data-id="heading-3">ç¼–è¯‘å™¨ / CPU çš„ â€œæŒ‡ä»¤é‡æ’åºâ€ ä¼˜åŒ–</h4>
<p>ç¼–è¯‘å™¨ï¼ˆ<code>C#</code> ç¼–è¯‘å™¨ï¼‰å’Œ <code>CPU</code> ä¸ºæå‡æ‰§è¡Œæ•ˆç‡ï¼Œä¼šåœ¨ä¸æ”¹å˜å•çº¿ç¨‹é€»è¾‘çš„å‰æä¸‹ï¼Œè°ƒæ•´æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåº</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// åŸå§‹ä»£ç </span>
<span class="hljs-built_in">bool</span> _isReady = <span class="hljs-literal">false</span>;
<span class="hljs-built_in">int</span> _data = <span class="hljs-number">100</span>;

<span class="hljs-comment">// ç¼–è¯‘å™¨/CPUå¯èƒ½é‡æ’åºä¸ºï¼šå…ˆèµ‹å€¼_dataï¼Œå†èµ‹å€¼_isReadyï¼ˆå•çº¿ç¨‹æ— å½±å“ï¼‰</span>
<span class="hljs-comment">// ä½†å¤šçº¿ç¨‹ä¸‹ï¼Œçº¿ç¨‹Bå¯èƒ½çœ‹åˆ°_isReady=trueï¼Œä½†_dataè¿˜æ˜¯æ—§å€¼</span>
</code></pre>
<p><code>volatile</code> çš„æ ¸å¿ƒä½œç”¨å°±æ˜¯ï¼šç¦æ­¢ç¼“å­˜ + ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œä¿è¯å¤šçº¿ç¨‹å¯¹å­—æ®µçš„è®¿é—® â€œæ‰€è§å³æ‰€å¾—â€ã€‚</p>
<ul>
<li>
<p>æ’å…¥å†…å­˜å±éšœï¼ˆ<code>memory barrier</code>ï¼‰ï¼š</p>
<ul>
<li>
<p><code>Acquire Fence</code>ï¼šè¯»å– <code>volatile</code> å­—æ®µå‰ï¼Œç¦æ­¢å°†åç»­è¯»å–æå‰ã€‚</p>
</li>
<li>
<p><code>Release Fence</code>ï¼šå†™å…¥ <code>volatile</code> å­—æ®µåï¼Œç¦æ­¢å°†ä¹‹å‰å†™å…¥æ¨è¿Ÿã€‚</p>
</li>
</ul>
</li>
<li>
<p>å¼ºåˆ¶æ¯æ¬¡è¯»å†™éƒ½ç›´æ¥è®¿é—®ä¸»å†…å­˜ï¼Œç»•è¿‡ç¼“å­˜ä¼˜åŒ–ã€‚</p>
</li>
</ul>
<h3 data-id="heading-4">æ ¸å¿ƒå®šä¹‰ä¸è¯­æ³•</h3>
<h4 data-id="heading-5">è¯­æ³•è§„åˆ™</h4>
<p><code>volatile</code> åªèƒ½ä¿®é¥°å­—æ®µï¼Œä¸”æœ‰ä¸¥æ ¼çš„ç±»å‹é™åˆ¶ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// æ­£ç¡®ï¼šä¿®é¥°å®ä¾‹å­—æ®µ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-built_in">bool</span> _isRunning;

<span class="hljs-comment">// æ­£ç¡®ï¼šä¿®é¥°é™æ€å­—æ®µ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> <span class="hljs-built_in">int</span> _counter;

<span class="hljs-comment">// é”™è¯¯ï¼šä¸èƒ½ä¿®é¥°æ–¹æ³•/å‚æ•°/å±€éƒ¨å˜é‡/å±æ€§/å¸¸é‡</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">volatile</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DoWork</span>()</span> { } <span class="hljs-comment">// ç¼–è¯‘é”™è¯¯</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> VolatileProperty { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; } <span class="hljs-comment">// ç¼–è¯‘é”™è¯¯ï¼ˆå±æ€§ä¸èƒ½åŠ volatileï¼‰</span>
</code></pre>
<h4 data-id="heading-6">æ”¯æŒçš„ç±»å‹</h4>
<p><code>volatile</code> ä»…æ”¯æŒä»¥ä¸‹ç±»å‹ï¼ˆé¿å… <code>CPU</code> æ“ä½œçš„åŸå­æ€§é—®é¢˜ï¼‰ï¼š</p>
<ul>
<li>
<p>å¼•ç”¨ç±»å‹ï¼ˆå¦‚ <code>object</code>ã€<code>string</code>ã€è‡ªå®šä¹‰ç±»ï¼‰ï¼›</p>
</li>
<li>
<p>å€¼ç±»å‹ï¼š<code>byteã€sbyteã€shortã€ushortã€intã€uintã€longã€ulongã€charã€floatã€bool</code>ï¼›</p>
</li>
<li>
<p>ä¸Šè¿°ç±»å‹çš„æŒ‡é’ˆï¼ˆå¦‚ <code>int*</code> ï¼‰ã€‚</p>
</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼šä¸æ”¯æŒdoubleã€decimalã€structï¼ˆè‡ªå®šä¹‰å€¼ç±»å‹ï¼‰ã€DateTimeç­‰ï¼Œè¿™äº›ç±»å‹çš„è¯»å†™ä¸æ˜¯åŸå­çš„ï¼Œvolatileæ— æ³•ä¿è¯æ­£ç¡®æ€§ã€‚</p>
</blockquote>
<h4 data-id="heading-7">ç­‰æ•ˆæ–¹æ³•ï¼šVolatile.Read/Volatile.Write</h4>
<p>é™¤äº†å…³é”®å­—ï¼Œ<code>.NET</code> è¿˜æä¾› <code>Volatile</code> é™æ€ç±»çš„ <code>Read/Write</code> æ–¹æ³•ï¼ŒåŠŸèƒ½ä¸ <code>volatile</code> å…³é”®å­—ä¸€è‡´ï¼Œä½†æ›´çµæ´»ï¼ˆå¯åŠ¨æ€æ§åˆ¶è¯»å†™ï¼‰ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// ç­‰ä»·äº volatile ä¿®é¥°çš„ _isRunning = true</span>
Volatile.Write(<span class="hljs-keyword">ref</span> _isRunning, <span class="hljs-literal">true</span>);

<span class="hljs-comment">// ç­‰ä»·äºè¯»å– volatile ä¿®é¥°çš„ _isRunning</span>
<span class="hljs-built_in">bool</span> current = Volatile.Read(<span class="hljs-keyword">ref</span> _isRunning);
</code></pre>
<h3 data-id="heading-8">æ ¸å¿ƒåŸç†ï¼šå†…å­˜å±éšœï¼ˆMemory Barrierï¼‰</h3>
<p><code>volatile</code> çš„åº•å±‚æ˜¯é€šè¿‡æ’å…¥å†…å­˜å±éšœï¼ˆ<code>Memory Barrier</code>ï¼‰ å®ç°çš„ï¼š</p>
<ul>
<li>
<p>è¯»å±éšœï¼ˆ<code>Load Barrier</code>ï¼‰ï¼šè¯»å– <code>volatile</code> å­—æ®µæ—¶ï¼Œæ’å…¥è¯»å±éšœï¼Œå¼ºåˆ¶ <code>CPU</code> ä»ä¸»å†…å­˜è¯»å–å€¼ï¼Œè€Œéç¼“å­˜ï¼›åŒæ—¶ç¦æ­¢å°†è¯»æŒ‡ä»¤é‡æ’åºåˆ°å±éšœä¹‹å‰ã€‚</p>
</li>
<li>
<p>å†™å±éšœï¼ˆ<code>Store Barrier</code>ï¼‰ï¼šå†™å…¥ <code>volatile</code> å­—æ®µæ—¶ï¼Œæ’å…¥å†™å±éšœï¼Œå¼ºåˆ¶ <code>CPU</code> å°†å€¼å†™å…¥ä¸»å†…å­˜ï¼Œè€Œéç¼“å­˜ï¼›åŒæ—¶ç¦æ­¢å°†å†™æŒ‡ä»¤é‡æ’åºåˆ°å±éšœä¹‹åã€‚</p>
</li>
</ul>
<h3 data-id="heading-9">åŸºç¡€ä½¿ç”¨ç¤ºä¾‹</h3>
<h4 data-id="heading-10">å…³é”®å­—ç”¨æ³•</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThreadSafeFlag</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-built_in">bool</span> _isRunning = <span class="hljs-literal">true</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Run</span>()</span>
    {
        <span class="hljs-comment">// çº¿ç¨‹1ï¼šå¾ªç¯ç›´åˆ°æ ‡å¿—å…³é—­</span>
        <span class="hljs-keyword">while</span> (_isRunning)
        {
            <span class="hljs-comment">// æ‰§è¡Œå·¥ä½œ</span>
            Thread.SpinWait(<span class="hljs-number">1000</span>);
        }
        Console.WriteLine(<span class="hljs-string">"çº¿ç¨‹åœæ­¢"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Stop</span>()</span>
    {
        <span class="hljs-comment">// çº¿ç¨‹2ï¼šè®¾ç½®æ ‡å¿—</span>
        _isRunning = <span class="hljs-literal">false</span>;
        Console.WriteLine(<span class="hljs-string">"åœæ­¢ä¿¡å·å·²å‘é€"</span>);
    }
}
</code></pre>
<p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> flag = <span class="hljs-keyword">new</span> ThreadSafeFlag();
<span class="hljs-keyword">var</span> worker = <span class="hljs-keyword">new</span> Thread(flag.Run);
worker.Start();

Thread.Sleep(<span class="hljs-number">100</span>);
flag.Stop();  <span class="hljs-comment">// å¦ä¸€ä¸ªçº¿ç¨‹èƒ½ç«‹å³çœ‹åˆ°å˜åŒ–</span>
worker.Join();
</code></pre>
<p>ä¸åŠ  <code>volatile</code>ï¼šå¯èƒ½å¯¼è‡´ <code>_isRunning</code> è¢«ç¼“å­˜ï¼Œçº¿ç¨‹æ°¸è¿œä¸é€€å‡ºã€‚</p>
<h4 data-id="heading-11">Volatile ç±»é™æ€æ–¹æ³•ï¼ˆ.NET 4.5+ æ¨èï¼‰</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System.Threading;

<span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _value;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> <span class="hljs-title">ReadValue</span>()</span> =&gt; Volatile.Read(<span class="hljs-keyword">ref</span> _value);
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WriteValue</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> newValue</span>)</span> =&gt; Volatile.Write(<span class="hljs-keyword">ref</span> _value, newValue);
</code></pre>
<ul>
<li>
<p><code>Volatile.Read</code>ï¼šå¸¦ <code>Acquire</code> å±éšœçš„è¯»å–ã€‚</p>
</li>
<li>
<p><code>Volatile.Write</code>ï¼šå¸¦ <code>Release</code> å±éšœçš„å†™å…¥ã€‚</p>
</li>
<li>
<p>ä¼˜åŠ¿ï¼šæ›´ç²¾ç¡®æ§åˆ¶å±éšœæ–¹å‘ï¼Œæ¯”å…³é”®å­—æ›´çµæ´»ã€‚</p>
</li>
</ul>
<h4 data-id="heading-12">åŒæ£€æŸ¥é”å•ä¾‹</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Singleton</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> Singleton? _instance;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Singleton Instance
    {
        <span class="hljs-keyword">get</span>
        {
            <span class="hljs-keyword">if</span> (_instance == <span class="hljs-literal">null</span>)
            {
                <span class="hljs-keyword">lock</span> (<span class="hljs-keyword">typeof</span>(Singleton))
                {
                    <span class="hljs-keyword">if</span> (_instance == <span class="hljs-literal">null</span>)
                        _instance = <span class="hljs-keyword">new</span> Singleton();
                }
            }
            <span class="hljs-keyword">return</span> _instance!;
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-title">Singleton</span>()</span> { }
}
</code></pre>
<h3 data-id="heading-13">ä¼˜ç‚¹ä¸ç¼ºç‚¹</h3>






























<table><thead><tr><th>æ–¹é¢</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>æ€§èƒ½</strong></td><td>æä½å¼€é”€ï¼ˆä»…å†…å­˜å±éšœï¼‰ï¼Œè¿œé«˜äºé”</td><td>ä»æ¯”æ™®é€šå˜é‡æ…¢ï¼ˆç¦ç”¨éƒ¨åˆ†ä¼˜åŒ–ï¼‰</td></tr><tr><td><strong>æ˜“ç”¨æ€§</strong></td><td>ç®€å•å…³é”®å­—æˆ–æ–¹æ³•è°ƒç”¨</td><td>è¯­ä¹‰å¤æ‚ï¼Œæ˜“è¯¯ç”¨</td></tr><tr><td><strong>é€‚ç”¨æ€§</strong></td><td>å®Œç¾ç”¨äºç®€å•æ ‡å¿—ä½ã€çŠ¶æ€åˆ‡æ¢ã€åŒæ£€æŸ¥é”</td><td><strong>ä¸èƒ½</strong>ç”¨äºè®¡æ•°å™¨ã€å¤åˆæ“ä½œ</td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td>æä¾›å¿…è¦å†…å­˜æ¨¡å‹ä¿è¯</td><td>ä¸è¶³ä»¥å®ç°å¤æ‚åŒæ­¥</td></tr></tbody></table>
<h3 data-id="heading-14">æ¨èåœºæ™¯</h3>
<h4 data-id="heading-15">æ¨èä½¿ç”¨ <code>volatile</code> çš„åœºæ™¯ï¼š</h4>
<ul>
<li>
<p>å¸ƒå°”æ ‡å¿—ï¼ˆå¦‚åœæ­¢ä¿¡å· <code>_isRunning</code>ï¼‰ã€‚</p>
</li>
<li>
<p>çŠ¶æ€æšä¸¾ï¼ˆå¦‚ <code>Ready/Running/Stopped</code>ï¼‰ã€‚</p>
</li>
<li>
<p>å¼•ç”¨ç±»å‹å­—æ®µçš„åŒæ£€æŸ¥é”å•ä¾‹ã€‚</p>
</li>
<li>
<p>ä¸€å†™å¤šè¯»ï¼ˆ<code>one writer, multiple readers</code>ï¼‰æ¨¡å¼ã€‚</p>
</li>
</ul>
<h4 data-id="heading-16">ä¸æ¨èä½¿ç”¨ <code>volatile</code> çš„åœºæ™¯ï¼š</h4>
<ul>
<li>
<p>è®¡æ•°å™¨ã€ç´¯åŠ æ“ä½œ â†’ ç”¨ <code>Interlocked</code>ã€‚</p>
</li>
<li>
<p>å¤æ‚çŠ¶æ€ â†’ ç”¨ <code>lock</code> æˆ–æ— é”ç»“æ„ã€‚</p>
</li>
<li>
<p>64ä½å€¼ï¼ˆlong/doubleï¼‰åœ¨32ä½è¿›ç¨‹ â†’ ç”¨ <code>Interlocked</code>ã€‚</p>
</li>
</ul>
<h3 data-id="heading-17">Volatile vs Interlocked</h3>



































<table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>Volatile</th><th>Interlocked</th></tr></thead><tbody><tr><td>åŸå­æ€§</td><td>âŒ</td><td>âœ…</td></tr><tr><td>å†…å­˜å±éšœ</td><td>Acquire / Release</td><td>Full Fence</td></tr><tr><td>è¿”å›æ—§å€¼</td><td>âŒ</td><td>âœ…</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>çŠ¶æ€è§‚å¯Ÿ</td><td>çŠ¶æ€ä¿®æ”¹</td></tr><tr><td>æ€§èƒ½</td><td>æ›´å¿«</td><td>ç¨æ…¢</td></tr></tbody></table>
<h3 data-id="heading-18">æ€»ç»“</h3>
<p><code>volatile</code> æ˜¯ <code>.NET</code> å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ä¸€ä¸ªä½çº§ä½†å…³é”®çš„å·¥å…·ï¼Œé€‚åˆç®€å•çš„ä¸€å†™å¤šè¯»æ ‡å¿—åœºæ™¯ã€‚ä½†ç»ä¸èƒ½æ»¥ç”¨ï¼Œå¤§å¤šæ•°çº¿ç¨‹å®‰å…¨éœ€æ±‚åº”ä¼˜å…ˆé€‰æ‹© <code>Interlockedã€lockã€Lazy&lt;T&gt;</code> æˆ–å¹¶å‘é›†åˆã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// è¯»ï¼šVolatile</span>
<span class="hljs-keyword">var</span> state = Volatile.Read(<span class="hljs-keyword">ref</span> _state);

<span class="hljs-comment">// å†™ï¼šCAS / Exchange</span>
<span class="hljs-keyword">if</span> (state == A)
    Interlocked.CompareExchange(<span class="hljs-keyword">ref</span> _state, B, A);
</code></pre>
<blockquote>
<p>Volatile æ˜¯å¹¶å‘ç¨‹åºçš„â€œè§‚å¯Ÿè€…åè®®â€ï¼Œ
Interlocked æ‰æ˜¯â€œä¿®æ”¹è€…åè®®â€ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å­¦ä¹ ä¸€äº›å¸¸ç”¨çš„æ··åˆæ¨¡å¼ä¹‹BlendMode.srcIn]]></title>    <link>https://juejin.cn/post/7592159803410497572</link>    <guid>https://juejin.cn/post/7592159803410497572</guid>    <pubDate>2026-01-07T09:05:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592159803410497572" data-draft-id="7592236397535232036" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" å­¦ä¹ ä¸€äº›å¸¸ç”¨çš„æ··åˆæ¨¡å¼ä¹‹BlendMode.srcIn"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2026-01-07T09:05:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç«æŸ´å°±æ˜¯æˆ‘"/> <meta itemprop="url" content="https://juejin.cn/user/272334614705575"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             å­¦ä¹ ä¸€äº›å¸¸ç”¨çš„æ··åˆæ¨¡å¼ä¹‹BlendMode.srcIn
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/272334614705575/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç«æŸ´å°±æ˜¯æˆ‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T09:05:38.000Z" title="Wed Jan 07 2026 09:05:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>SRC_IN</p>
<p><code>Keeps the source pixels that cover the destination pixels, discards the remaining source and destination pixels.</code></p>
<p>è®¡ç®—å…¬å¼</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17e9298a9851429883786947bbdce669~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5p-05bCx5piv5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768381538&amp;x-signature=xn2nBRmuIUa%2Bs5CKmuPAknVOF5s%3D" alt="image.png" width="30%" loading="lazy"/>
<p>å¤§ç™½è¯å°±æ˜¯ï¼šåœ¨dsté€æ˜åº¦æ˜¯1çš„æ—¶å€™,é‡å éƒ¨åˆ†æ˜¾ç¤ºçš„å°±æ˜¯srcçš„å†…å®¹ã€‚éé‡å éƒ¨åˆ†src ç›´æ¥å…¨éƒ¨ä¸¢å¼ƒ,dstä¸ä¿®æ”¹ã€‚</p>
<p>ç¬¬ä¸€ä¸ªä¾‹å­:</p>
<pre><code class="hljs language-js" lang="js">  @override
  <span class="hljs-keyword">void</span> <span class="hljs-title function_">paint</span>(<span class="hljs-params">Canvas canvas, Size size</span>) {
    <span class="hljs-keyword">var</span> width = size.<span class="hljs-property">width</span>;
    <span class="hljs-keyword">var</span> height = size.<span class="hljs-property">height</span>;

    canvas.<span class="hljs-title function_">saveLayer</span>(<span class="hljs-title class_">Rect</span>.<span class="hljs-title function_">fromLTWH</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height), <span class="hljs-title class_">Paint</span>());
    <span class="hljs-title class_">Paint</span> dstPaint = <span class="hljs-title class_">Paint</span>()..<span class="hljs-property">color</span> = <span class="hljs-title class_">Colors</span>.<span class="hljs-property">red</span>.<span class="hljs-title function_">withOpacity</span>(<span class="hljs-number">0.8</span>);
    dstPaint.<span class="hljs-property">strokeWidth</span> = <span class="hljs-number">20</span>;
    dstPaint.<span class="hljs-property">style</span> = <span class="hljs-title class_">PaintingStyle</span>.<span class="hljs-property">stroke</span>;

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">10</span>, dstPaint);

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">50</span>, dstPaint);

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">90</span>, dstPaint);

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">130</span>, dstPaint);

    <span class="hljs-keyword">var</span> srcPaint = <span class="hljs-title class_">Paint</span>()
      ..<span class="hljs-property">color</span> = <span class="hljs-title class_">Colors</span>.<span class="hljs-property">blue</span> <span class="hljs-comment">// æºé¢œè‰²ï¼šè“è‰²</span>
      ..<span class="hljs-property">style</span> = <span class="hljs-title class_">PaintingStyle</span>.<span class="hljs-property">stroke</span> <span class="hljs-comment">// å¡«å……æ¨¡å¼</span>
      ..<span class="hljs-property">strokeWidth</span> = <span class="hljs-number">50</span>
      ..<span class="hljs-property">blendMode</span> = <span class="hljs-title class_">BlendMode</span>.<span class="hljs-property">srcIn</span>; <span class="hljs-comment">// æ··åˆæ¨¡å¼</span>
    canvas.<span class="hljs-title function_">drawRect</span>(<span class="hljs-title class_">Rect</span>.<span class="hljs-title function_">fromLTWH</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height), srcPaint);
    <span class="hljs-comment">// canvas.drawImageRect(image!, Rect.fromLTWH(0, 0, image!.width.toDouble(), image!.height.toDouble()), Rect.fromLTWH(0, 0, width, height), srcPaint);</span>
    canvas.<span class="hljs-title function_">restore</span>();
  }
</code></pre>
<p>ä¸€ä¸ªçŸ©å½¢è¾¹æ¡†è·Ÿå¤šä¸ªç¯å½¢è¿›è¡ŒsrcInæ··åˆã€‚æ•ˆæœå¦‚ä¸‹ï¼šå¯ä»¥çœ‹å‡ºé‡å éƒ¨åˆ†ä¿ç•™äº†srcï¼Œsrcéé‡å éƒ¨åˆ†ç›´æ¥ä¸¢å¼ƒäº†ã€‚éé‡å dstè¿˜æ˜¯ä¿æŒåŸæ ·ã€‚</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7d143d89ab94cbcabe98f10daaec269~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5p-05bCx5piv5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768381538&amp;x-signature=qKTcUwalJOkSdlA%2FdpTZnesJpls%3D" alt="image.png" width="30%" loading="lazy"/>
<p>ç¬¬äºŒä¸ªä¾‹å­:ç»™å›¾å½¢è´´çº¸æˆ–è€…è¯´æ˜¯å›¾ç‰‡ä¿ç•™ä»»æ„éƒ¨åˆ†(åªè¦ä½ èƒ½ç”»å‡ºè·¯å¾„)</p>
<pre><code class="hljs language-js" lang="js">  @override
  <span class="hljs-keyword">void</span> <span class="hljs-title function_">paint</span>(<span class="hljs-params">Canvas canvas, Size size</span>) {
    <span class="hljs-keyword">var</span> width = size.<span class="hljs-property">width</span>;
    <span class="hljs-keyword">var</span> height = size.<span class="hljs-property">height</span>;

    canvas.<span class="hljs-title function_">saveLayer</span>(<span class="hljs-title class_">Rect</span>.<span class="hljs-title function_">fromLTWH</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height), <span class="hljs-title class_">Paint</span>());
    <span class="hljs-title class_">Paint</span> dstPaint = <span class="hljs-title class_">Paint</span>()..<span class="hljs-property">color</span> = <span class="hljs-title class_">Colors</span>.<span class="hljs-property">red</span>.<span class="hljs-title function_">withOpacity</span>(<span class="hljs-number">0.8</span>);
    dstPaint.<span class="hljs-property">strokeWidth</span> = <span class="hljs-number">20</span>;
    dstPaint.<span class="hljs-property">style</span> = <span class="hljs-title class_">PaintingStyle</span>.<span class="hljs-property">stroke</span>;

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">10</span>, dstPaint);

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">50</span>, dstPaint);

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">90</span>, dstPaint);

    canvas.<span class="hljs-title function_">drawCircle</span>(<span class="hljs-title class_">Offset</span>(width/<span class="hljs-number">2</span>,height/<span class="hljs-number">2</span>), <span class="hljs-number">130</span>, dstPaint);

    <span class="hljs-keyword">var</span> srcPaint = <span class="hljs-title class_">Paint</span>()
      ..<span class="hljs-property">color</span> = <span class="hljs-title class_">Colors</span>.<span class="hljs-property">blue</span> <span class="hljs-comment">// æºé¢œè‰²ï¼šè“è‰²</span>
      ..<span class="hljs-property">style</span> = <span class="hljs-title class_">PaintingStyle</span>.<span class="hljs-property">stroke</span> <span class="hljs-comment">// å¡«å……æ¨¡å¼</span>
      ..<span class="hljs-property">strokeWidth</span> = <span class="hljs-number">50</span>
      ..<span class="hljs-property">blendMode</span> = <span class="hljs-title class_">BlendMode</span>.<span class="hljs-property">srcIn</span>; <span class="hljs-comment">// æ··åˆæ¨¡å¼</span>
    <span class="hljs-comment">// canvas.drawRect(Rect.fromLTWH(0, 0, width, height), srcPaint);</span>
    canvas.<span class="hljs-title function_">drawImageRect</span>(image!, <span class="hljs-title class_">Rect</span>.<span class="hljs-title function_">fromLTWH</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, image!.<span class="hljs-property">width</span>.<span class="hljs-title function_">toDouble</span>(), image!.<span class="hljs-property">height</span>.<span class="hljs-title function_">toDouble</span>()), <span class="hljs-title class_">Rect</span>.<span class="hljs-title function_">fromLTWH</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, width, height), srcPaint);
    canvas.<span class="hljs-title function_">restore</span>();
  }
</code></pre>
<p>æ•ˆæœå›¾å¦‚ä¸‹:æŠŠä¸€å¼ å›¾ç‰‡è´´åˆ°äº†ç¯å½¢ä¸Šé¢ï¼Œå¦‚æœdstæ˜¯ä¸ªåœ†å½¢ï¼Œé‚£å°±æ˜¯åœ†å½¢å¤´åƒã€‚</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9617663f5dc429f9aa89fd747183c58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Gr5p-05bCx5piv5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768381538&amp;x-signature=2oBDA2%2FLZYbYV%2F9vwgCU7elaroQ%3D" alt="image.png" width="30%" loading="lazy"/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Node.js ç¼–ç¨‹å®æˆ˜ï¼šå‰åç«¯ç»“åˆ - è·¨åŸŸä¸ä»£ç†é…ç½®]]></title>    <link>https://juejin.cn/post/7592147054785921075</link>    <guid>https://juejin.cn/post/7592147054785921075</guid>    <pubDate>2026-01-07T01:17:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592147054785921075" data-draft-id="7592251792630841371" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Node.js ç¼–ç¨‹å®æˆ˜ï¼šå‰åç«¯ç»“åˆ - è·¨åŸŸä¸ä»£ç†é…ç½®"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,Node.js"/> <meta itemprop="datePublished" content="2026-01-07T01:17:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜çˆ±é’“é±¼"/> <meta itemprop="url" content="https://juejin.cn/user/2799775299157614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Node.js ç¼–ç¨‹å®æˆ˜ï¼šå‰åç«¯ç»“åˆ - è·¨åŸŸä¸ä»£ç†é…ç½®
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2799775299157614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜çˆ±é’“é±¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T01:17:50.000Z" title="Wed Jan 07 2026 01:17:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨ç°ä»£ Web å¼€å‘ä¸­ï¼Œå‰åç«¯åˆ†ç¦»å·²æˆä¸ºä¸»æµæ¶æ„ã€‚åœ¨è¿™ç§æ¶æ„ä¸‹ï¼Œå‰ç«¯å’Œåç«¯é€šå¸¸éƒ¨ç½²åœ¨ä¸åŒçš„åŸŸæˆ–ç«¯å£ä¸Šï¼Œå› æ­¤è·¨åŸŸé—®é¢˜å˜å¾—å°¤ä¸ºé‡è¦ã€‚å°¤å…¶åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•é«˜æ•ˆåœ°å¤„ç†è·¨åŸŸè¯·æ±‚å’Œé…ç½®ä»£ç†ï¼Œç›´æ¥å½±å“ç€å‰åç«¯åä½œçš„æ•ˆç‡å’Œå¼€å‘ä½“éªŒã€‚</p>
</blockquote>
<p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•åœ¨ Node.js ä¸­å¤„ç†è·¨åŸŸé—®é¢˜ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡ä»£ç†é…ç½®ç®€åŒ–å¼€å‘æµç¨‹ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯è·¨åŸŸé—®é¢˜</h2>
<p>è·¨åŸŸé—®é¢˜æ˜¯æŒ‡æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼ˆSame-Origin Policyï¼‰é™åˆ¶äº†ä¸åŒåŸŸã€åè®®æˆ–ç«¯å£ä¹‹é—´çš„ç›¸äº’è®¿é—®ã€‚åœ¨å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­ï¼Œå‰ç«¯é€šå¸¸éƒ¨ç½²åœ¨ä¸€ä¸ªåŸŸï¼ˆå¦‚ <code>localhost:3000</code>ï¼‰ï¼Œåç«¯åˆ™éƒ¨ç½²åœ¨å¦ä¸€ä¸ªåŸŸï¼ˆå¦‚ <code>localhost:5000</code>ï¼‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå‰ç«¯å‘èµ·çš„è¯·æ±‚å°±ä¼šé‡åˆ°è·¨åŸŸé—®é¢˜ã€‚</p>
<p><strong>åŒæºç­–ç•¥</strong>è¦æ±‚ï¼šåè®®ã€åŸŸåå’Œç«¯å£ä¸‰è€…å¿…é¡»å®Œå…¨ç›¸åŒï¼Œæ‰èƒ½å…è®¸è·¨ç«™è¯·æ±‚ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€è·¨åŸŸçš„è§£å†³æ–¹æ³•</h2>
<p>è§£å†³è·¨åŸŸé—®é¢˜çš„æ–¹æ³•æœ‰å¾ˆå¤šç§ï¼Œæœ€å¸¸è§çš„æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ol>
<li>
<p><strong>CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰</strong>
åç«¯é€šè¿‡è®¾ç½® HTTP å¤´éƒ¨ï¼Œå…è®¸æ¥è‡ªä¸åŒåŸŸçš„è¯·æ±‚ã€‚</p>
</li>
<li>
<p><strong>JSONPï¼ˆJSON with Paddingï¼‰</strong>
åˆ©ç”¨ <code>&lt;script&gt;</code> æ ‡ç­¾çš„è·¨åŸŸèƒ½åŠ›ï¼Œé€šå¸¸åªæ”¯æŒ GET è¯·æ±‚ã€‚</p>
</li>
<li>
<p><strong>ä»£ç†</strong>
å‰ç«¯å¼€å‘æ—¶é€šè¿‡ä»£ç†å°†è¯·æ±‚è½¬å‘åˆ°åç«¯ï¼Œé¿å…æµè§ˆå™¨çš„è·¨åŸŸé™åˆ¶ã€‚</p>
</li>
</ol>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€Node.js å¤„ç†è·¨åŸŸï¼šCORS</h2>
<p>CORS æ˜¯ç›®å‰æœ€å¸¸ç”¨çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆã€‚CORS æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨å‘å‡º XMLHttpRequest è¯·æ±‚ï¼Œä»è€Œå…‹æœåŒæºç­–ç•¥çš„é™åˆ¶ã€‚Node.js å¯ä»¥ä½¿ç”¨ <code>cors</code> ä¸­é—´ä»¶è½»æ¾å®ç°ã€‚</p>
<h3 data-id="heading-3">1. å®‰è£… <code>cors</code> ä¸­é—´ä»¶</h3>
<pre><code class="hljs language-bash" lang="bash">npm install cors
</code></pre>
<h3 data-id="heading-4">2. é…ç½® CORS</h3>
<p>åœ¨ Node.js ä¸­ï¼Œé€šè¿‡ä½¿ç”¨ <code>cors</code> ä¸­é—´ä»¶ï¼Œå¯ä»¥å…è®¸æŒ‡å®šæºçš„è¯·æ±‚ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºæœ¬çš„é…ç½®ä¾‹å­ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cors'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-comment">// å…è®¸æ‰€æœ‰æ¥æºçš„è¯·æ±‚</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>());

<span class="hljs-comment">// åªå…è®¸ç‰¹å®šæ¥æºçš„è¯·æ±‚</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">cors</span>({
  <span class="hljs-attr">origin</span>: <span class="hljs-string">'http://localhost:3000'</span>, <span class="hljs-comment">// å…è®¸çš„å‰ç«¯åœ°å€</span>
  <span class="hljs-attr">methods</span>: <span class="hljs-string">'GET,POST'</span>,
  <span class="hljs-attr">allowedHeaders</span>: <span class="hljs-string">'Content-Type,Authorization'</span>
}));

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello from server'</span> });
});

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">5000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Server is running on http://localhost:5000'</span>);
});
</code></pre>
<p>è¿™ç§æ–¹å¼ä¼šè‡ªåŠ¨ä¸ºæ¯ä¸ªå“åº”æ·»åŠ åˆé€‚çš„ CORS å¤´ï¼Œä»è€Œè§£å†³è·¨åŸŸé—®é¢˜ã€‚</p>
<h3 data-id="heading-5">3. å¸¸è§ CORS é…ç½®é€‰é¡¹</h3>
<ul>
<li><strong><code>origin</code></strong>ï¼šè®¾ç½®å…è®¸è®¿é—®çš„æºï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªåŸŸåï¼Œä¹Ÿå¯ä»¥æ˜¯ <code>*</code> æ¥å…è®¸æ‰€æœ‰æ¥æºã€‚</li>
<li><strong><code>methods</code></strong>ï¼šæŒ‡å®šå…è®¸çš„ HTTP æ–¹æ³•ã€‚</li>
<li><strong><code>allowedHeaders</code></strong>ï¼šè®¾ç½®å…è®¸çš„è¯·æ±‚å¤´ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-6">å››ã€å‰ç«¯ä½¿ç”¨ä»£ç†è§£å†³è·¨åŸŸ</h2>
<p>åœ¨å¼€å‘é˜¶æ®µï¼Œå‰ç«¯å¯ä»¥é€šè¿‡ä»£ç†å°†è¯·æ±‚è½¬å‘åˆ°åç«¯ï¼Œé¿å…æµè§ˆå™¨çš„è·¨åŸŸé™åˆ¶ã€‚å‰ç«¯å¼€å‘æ¡†æ¶å¦‚ Reactã€Vue ç­‰éƒ½æä¾›äº†é…ç½®ä»£ç†çš„æ–¹å¼ã€‚</p>
<h3 data-id="heading-7">1. React ä¸­é…ç½®ä»£ç†</h3>
<p>åœ¨ React é¡¹ç›®ä¸­ï¼Œæœ€ç®€å•çš„ä»£ç†é…ç½®æ–¹å¼æ˜¯é€šè¿‡ <code>package.json</code> æ–‡ä»¶ä¸­çš„ <code>proxy</code> å­—æ®µé…ç½®ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-app"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.1.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"proxy"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://localhost:5000"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>å½“å‰ç«¯è¯·æ±‚ <code>/api/data</code> æ—¶ï¼Œå¼€å‘æœåŠ¡å™¨ä¼šè‡ªåŠ¨ä»£ç†åˆ° <code>http://localhost:5000/api/data</code>ï¼Œé¿å…äº†è·¨åŸŸé—®é¢˜ã€‚</p>
<h3 data-id="heading-8">2. Vue ä¸­é…ç½®ä»£ç†</h3>
<p>åœ¨ Vue é¡¹ç›®ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>vue.config.js</code> æ¥é…ç½®ä»£ç†ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">devServer</span>: {
    <span class="hljs-attr">proxy</span>: <span class="hljs-string">'http://localhost:5000'</span>
  }
};
</code></pre>
<p>è¿™æ ·ï¼Œå½“ Vue å‰ç«¯å‘é€è¯·æ±‚æ—¶ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«ä»£ç†åˆ° <code>http://localhost:5000</code>ï¼Œè§£å†³äº†è·¨åŸŸé—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-9">äº”ã€Node.js ä¸­é…ç½®ä»£ç†è½¬å‘è¯·æ±‚</h2>
<p>é™¤äº†å‰ç«¯é…ç½®ä»£ç†ï¼Œåç«¯çš„ Node.js æœåŠ¡å™¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä»£ç†ä¸­é—´ä»¶å°†è¯·æ±‚è½¬å‘åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œå¸¸ç”¨çš„ä»£ç†ä¸­é—´ä»¶æ˜¯ <code>http-proxy-middleware</code>ã€‚</p>
<h3 data-id="heading-10">1. å®‰è£… <code>http-proxy-middleware</code></h3>
<pre><code class="hljs language-bash" lang="bash">npm install http-proxy-middleware
</code></pre>
<h3 data-id="heading-11">2. é…ç½®ä»£ç†è½¬å‘</h3>
<p>åœ¨ <code>express</code> ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>http-proxy-middleware</code> å°†è¯·æ±‚è½¬å‘åˆ°åç«¯ APIã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> { createProxyMiddleware } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http-proxy-middleware'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-comment">// ä»£ç† API è¯·æ±‚</span>
app.<span class="hljs-title function_">use</span>(<span class="hljs-string">'/api'</span>, <span class="hljs-title function_">createProxyMiddleware</span>({
  <span class="hljs-attr">target</span>: <span class="hljs-string">'http://localhost:5000'</span>, <span class="hljs-comment">// ç›®æ ‡æœåŠ¡å™¨</span>
  <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,              <span class="hljs-comment">// æ›´æ”¹æº</span>
  <span class="hljs-attr">pathRewrite</span>: {
    <span class="hljs-string">'^/api'</span>: <span class="hljs-string">''</span>                    <span class="hljs-comment">// é‡å†™è·¯å¾„</span>
  }
}));

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Front-end server is running on http://localhost:3000'</span>);
});
</code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå‰ç«¯çš„è¯·æ±‚ <code>/api</code> ä¼šè¢«ä»£ç†åˆ°ç›®æ ‡åç«¯ï¼Œé¿å…äº†ç›´æ¥è·¨åŸŸè¯·æ±‚ã€‚</p>
<hr/>
<h2 data-id="heading-12">å…­ã€æ€»ç»“</h2>
<p>è·¨åŸŸé—®é¢˜æ˜¯å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­ä¸å¯å¿½è§†çš„æŒ‘æˆ˜ï¼ŒNode.js æä¾›äº†å¤šç§è§£å†³æ–¹æ¡ˆï¼Œå…¶ä¸­ CORS å’Œä»£ç†æ˜¯æœ€å¸¸è§çš„æ–¹å¼ã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œåˆç†é…ç½® CORS å’Œä»£ç†ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…è·¨åŸŸé™åˆ¶å¸¦æ¥çš„é—®é¢˜ï¼Œä»è€Œæå‡å‰åç«¯åä½œæ•ˆç‡ã€‚</p>
<ul>
<li><strong>CORS</strong>ï¼šé€‚åˆåç«¯æœåŠ¡ï¼Œèƒ½å¤Ÿçµæ´»æ§åˆ¶è·¨åŸŸè¯·æ±‚çš„æƒé™ã€‚</li>
<li><strong>ä»£ç†</strong>ï¼šé€‚åˆå¼€å‘ç¯å¢ƒï¼Œé€šè¿‡ä»£ç†è½¬å‘è¯·æ±‚è§£å†³è·¨åŸŸé—®é¢˜ã€‚</li>
</ul>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå‰åç«¯ç»“åˆçš„æ–¹å¼å¯ä»¥æ ¹æ®ä¸åŒéœ€æ±‚é€‰æ‹©åˆé€‚çš„è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼Œä»¥å®ç°æ›´é«˜æ•ˆã€æ›´ç¨³å®šçš„å¼€å‘è¿‡ç¨‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Electron è„šæœ¬è°ƒç”¨å¤§å‘ï¼å®³æƒ¨æˆ‘äº†]]></title>    <link>https://juejin.cn/post/7592518897464950836</link>    <guid>https://juejin.cn/post/7592518897464950836</guid>    <pubDate>2026-01-08T06:52:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592518897464950836" data-draft-id="7592508079306293267" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Electron è„šæœ¬è°ƒç”¨å¤§å‘ï¼å®³æƒ¨æˆ‘äº†"/> <meta itemprop="keywords" content="å‰ç«¯,Electron"/> <meta itemprop="datePublished" content="2026-01-08T06:52:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PBitW"/> <meta itemprop="url" content="https://juejin.cn/user/3048261967153544"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Electron è„šæœ¬è°ƒç”¨å¤§å‘ï¼å®³æƒ¨æˆ‘äº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3048261967153544/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PBitW
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:52:39.000Z" title="Thu Jan 08 2026 06:52:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ¥ä¸Šä¸¤ç¯‡æ–‡ç« ï¼š</p>
<ol>
<li><a href="https://juejin.cn/post/7591806035758628906" target="_blank" title="https://juejin.cn/post/7591806035758628906">Electron åˆä½“éªŒ â€”â€” AIè¾…åŠ©ä¸Šæ‰‹ï¼Œç¡®å®ä¸éš¾(à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§</a></li>
<li><a href="https://juejin.cn/spost/7592119218024824867" target="_blank" title="https://juejin.cn/spost/7592119218024824867">Electron åœ¨ä¹Œç­å›¾ä¸Šæ‰“åŒ… â€”â€” AIè¾…åŠ©</a></li>
</ol>
<p>èœé¸Ÿä»¥ä¸ºåšå®Œä¸Šé¢ä¸¤ç¯‡æ–‡ç« å°±å¯ä»¥é«˜æ•æ— å¿§äº†ï¼Œç»“æœç°å®ç»™äº†èœé¸Ÿå½“å¤´ä¸€æ£’ï¼</p>
<p>æ˜¨å¤©ï¼Œç”Ÿä¿¡éƒ¨é—¨å°†ä»–å°è£…çš„è„šæœ¬éƒ¨ç½²ä¸Šäº†æœåŠ¡å™¨ï¼Œå¹¶è®©æˆ‘è¿›è¡Œè°ƒè¯•ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼æˆ‘æŒ‰ç…§å…¶ç¤ºä¾‹è¾“å…¥ã€ç¤ºä¾‹è¿è¡Œshellï¼Œå»ä¿®æ”¹äº†è‡ªå·±çš„è¿è¡Œè„šæœ¬æ–‡ä»¶ï¼Œä¿®æ”¹åå¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">runScript</span>(<span class="hljs-params">ipcMain, app, path, fs, exec</span>) {
  <span class="hljs-comment">// è¿è¡Œè„šæœ¬ -- ç­‰å¾…ç»“æœ</span>
  ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"runScript"</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
        <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"config.json"</span>);
        <span class="hljs-comment">// è¯»å– config.json</span>
        <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(configPath)) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
            <span class="hljs-string">"The config.json file does not exist. Please initialize the scripts folder first"</span>
          );
        }
        
        <span class="hljs-keyword">const</span> configContent = fs.<span class="hljs-title function_">readFileSync</span>(configPath, <span class="hljs-string">"utf-8"</span>);
        <span class="hljs-keyword">const</span> config = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(configContent);

        <span class="hljs-comment">// æ‹¼æ¥å‘½ä»¤ï¼ˆè‡ªåŠ¨äº¤ç”± shell è§£æï¼‰</span>
        <span class="hljs-keyword">const</span> command = <span class="hljs-string">`<span class="hljs-subst">${config.scriptPath}</span> <span class="hljs-subst">${data.inputJsonPath}</span>`</span>;
        
        <span class="hljs-comment">// å…³é”®ï¼šshell ç”±ç³»ç»Ÿå†³å®š</span>
        <span class="hljs-title function_">exec</span>(command, { <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span> }, <span class="hljs-function">(<span class="hljs-params">error, stdout, stderr</span>) =&gt;</span> {
          <span class="hljs-keyword">if</span> (error) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Script execution failed 103:"</span>, error);
            <span class="hljs-title function_">reject</span>(stderr || stdout || <span class="hljs-string">"è„šæœ¬è¿è¡Œå¼‚å¸¸"</span>);
            <span class="hljs-keyword">return</span>;
          }
          <span class="hljs-title function_">resolve</span>(stdout);
        });
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
      }
    });
  });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">runScriptNoWait</span>(<span class="hljs-params">ipcMain, app, path, fs, spawn</span>) {
  <span class="hljs-comment">// è¿è¡Œè„šæœ¬ -- ä¸ç­‰å¾…ç»“æœ</span>
  ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"runScriptNoWait"</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
        <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"config.json"</span>);
        <span class="hljs-comment">// è¯»å– config.json</span>
        <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(configPath)) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
            <span class="hljs-string">"The config.json file does not exist. Please initialize the scripts folder first."</span>
          );
        }
        
        <span class="hljs-keyword">const</span> configContent = fs.<span class="hljs-title function_">readFileSync</span>(configPath, <span class="hljs-string">"utf-8"</span>);
        <span class="hljs-keyword">const</span> config = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(configContent);

        <span class="hljs-comment">// spawn åå°æ‰§è¡Œ</span>
        <span class="hljs-keyword">const</span> child = <span class="hljs-title function_">spawn</span>(config.<span class="hljs-property">scriptPath</span>, [data.<span class="hljs-property">inputJsonPath</span>], {
          <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è®©ç³»ç»Ÿé€‰æ‹© cmd/bash</span>
          <span class="hljs-attr">detached</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è®©è„šæœ¬æˆä¸ºç‹¬ç«‹è¿›ç¨‹</span>
          <span class="hljs-attr">stdio</span>: <span class="hljs-string">"ignore"</span> <span class="hljs-comment">// ä¸æ¥æ”¶ä»»ä½•è¾“å‡º</span>
        });

        <span class="hljs-comment">// æ–­å¼€ Electron ä¸è„šæœ¬çš„å…³ç³»</span>
        child.<span class="hljs-title function_">unref</span>();

        <span class="hljs-comment">// ***å…³é”®ï¼šä¸ç­‰å¾…è„šæœ¬æ‰§è¡Œç»“æœ***</span>
        <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"è„šæœ¬å·²æˆåŠŸå¯åŠ¨"</span>); <span class="hljs-comment">// ä¸ç­‰å¾… stdoutï¼Œä¹Ÿä¸ç­‰å¾…è„šæœ¬ç»“æŸ</span>
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
      }
    });
  });
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  runScript,
  runScriptNoWait
};
</code></pre>
<p>åæ­£å‘½ä»¤è¡Œæ‹¼å‡ºæ¥é•¿è¿™æ ·ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">source /home/bnzycjd/.bashrc &amp;&amp; /home/bnzycjd/miniconda3/bin/python  /home/bnzycjd/pipline_test/script/pipline.py -c /home/bnzycjd/test/input.json
</code></pre>
<p>å…¶ä¸­</p>
<p><code>scriptPath</code> ä»£è¡¨ <code>source /home/bnzycjd/.bashrc &amp;&amp; /home/bnzycjd/miniconda3/bin/python  /home/bnzycjd/pipline_test/script/pipline.py -c</code></p>
<p><code>inputJsonPath</code>ä»£è¡¨<code>/home/bnzycjd/test/input.json</code></p>
<p>è¿™æ®µä»£ç åœ¨æœåŠ¡å™¨ä¸Šï¼Œç”¨npm run devè·‘æˆ–è€…å¤åˆ¶åˆ°æœåŠ¡å™¨çš„ç»ˆç«¯ä¸Šè¿è¡Œï¼Œéƒ½å•¥é—®é¢˜æ²¡æœ‰ï¼Œä½†ä¸€æ‰“åŒ…å°±ä¼šæŠ¥é”™ï¼Œè€Œä¸”æŠ¥é”™è¿˜ä¸å¥½è°ƒè¯•ï¼ŒçœŸçš„è®©èœé¸Ÿéš¾å—è‡³æï¼</p>
<h2 data-id="heading-0">å¢åŠ æ—¥å¿—</h2>
<p>æˆ‘æŠŠè¿™ä¸ªæƒ…å†µå‘leaderè¯´æ˜åï¼Œå› ä¸ºä»–æ˜¯åç«¯ï¼Œæ‰€ä»¥çŸ¥é“æ€ä¹ˆæŠŠæ—¥å¿—è¾“å‡ºåˆ°æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥åŒæ­¥runScriptä»£ç å˜æˆäº†</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> command = <span class="hljs-string">`<span class="hljs-subst">${config.scriptPath}</span> <span class="hljs-subst">${data.inputJsonPath}</span> &gt;&gt; <span class="hljs-subst">${data.logPath}</span>/<span class="hljs-subst">${data.logName}</span>.log`</span>;
</code></pre>
<p>å¼‚æ­¥çš„runScriptNoWaitä»£ç æ˜¯AIå¸®åŠ©æˆ‘å†™çš„ï¼Œæœ‰ç‚¹é—®é¢˜ï¼Œéœ€è¦è°ƒè¯•å¹¶å’ŒAIæ²Ÿé€šï¼ˆæ”¹åŠ¨äº†å‡ æ¬¡ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼Œç›´æ¥å±•ç¤ºæœ€ç»ˆå¯ä»¥è¿è¡Œçš„ï¼‰ï¼Œå˜æˆäº†</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">runScriptNoWait</span>(<span class="hljs-params">ipcMain, app, path, fs, spawn</span>) {
  <span class="hljs-comment">// è¿è¡Œè„šæœ¬ -- ä¸ç­‰å¾…ç»“æœ</span>
  ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"runScriptNoWait"</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
        <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"config.json"</span>);
        <span class="hljs-comment">// è¯»å– config.json</span>
        <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(configPath)) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
            <span class="hljs-string">"The config.json file does not exist. Please initialize the scripts folder first."</span>
          );
        }
        <span class="hljs-keyword">const</span> configContent = fs.<span class="hljs-title function_">readFileSync</span>(configPath, <span class="hljs-string">"utf-8"</span>);
        <span class="hljs-keyword">const</span> config = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(configContent);

        <span class="hljs-keyword">const</span> logFile = path.<span class="hljs-title function_">join</span>(data.<span class="hljs-property">logPath</span>, <span class="hljs-string">`<span class="hljs-subst">${data.logName}</span>.log`</span>);
        <span class="hljs-keyword">const</span> outFd = fs.<span class="hljs-title function_">openSync</span>(logFile, <span class="hljs-string">"a"</span>);

        <span class="hljs-comment">// spawn åå°æ‰§è¡Œ</span>
        <span class="hljs-keyword">const</span> child = <span class="hljs-title function_">spawn</span>(config.<span class="hljs-property">scriptPath</span>, [data.<span class="hljs-property">inputJsonPath</span>], {
          <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è®©ç³»ç»Ÿé€‰æ‹© cmd/bash</span>
          <span class="hljs-attr">detached</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è®©è„šæœ¬æˆä¸ºç‹¬ç«‹è¿›ç¨‹</span>
          <span class="hljs-attr">stdio</span>: [<span class="hljs-string">"ignore"</span>, outFd, outFd] <span class="hljs-comment">// stdout, stderr éƒ½å†™æ—¥å¿—</span>
        });

        <span class="hljs-comment">// æ£€æŸ¥è¿›ç¨‹æ˜¯å¦æˆåŠŸå¯åŠ¨</span>
        child.<span class="hljs-title function_">on</span>(<span class="hljs-string">"error"</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"åå°è„šæœ¬å¯åŠ¨å¤±è´¥:"</span>, error.<span class="hljs-property">message</span>);
          <span class="hljs-title function_">reject</span>(<span class="hljs-string">`åå°è„šæœ¬å¯åŠ¨å¤±è´¥: <span class="hljs-subst">${error.message}</span>`</span>);
        });

        <span class="hljs-comment">// è¿›ç¨‹æˆåŠŸå¯åŠ¨</span>
        child.<span class="hljs-title function_">on</span>(<span class="hljs-string">"spawn"</span>, <span class="hljs-function">() =&gt;</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"åå°è„šæœ¬å·²æˆåŠŸå¯åŠ¨ï¼Œè¿›ç¨‹ID:"</span>, child.<span class="hljs-property">pid</span>);
        });

        <span class="hljs-comment">// æ–­å¼€ Electron ä¸è„šæœ¬çš„å…³ç³»</span>
        child.<span class="hljs-title function_">unref</span>();

        <span class="hljs-comment">// ***å…³é”®ï¼šä¸ç­‰å¾…è„šæœ¬æ‰§è¡Œç»“æœ***</span>
        <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"è„šæœ¬å·²æˆåŠŸå¯åŠ¨"</span>); <span class="hljs-comment">// ä¸ç­‰å¾… stdoutï¼Œä¹Ÿä¸ç­‰å¾…è„šæœ¬ç»“æŸ</span>
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
      }
    });
  });
}
</code></pre>
<p>è¿™æ ·æœ‰æ—¥å¿—äº†å°±å¥½è°ƒè¯•ä¸€ç‚¹ï¼Œä½†æ˜¯ä¹Ÿä¸å¯ä»¥æˆåŠŸè°ƒç”¨è„šæœ¬ã€‚</p>
<h2 data-id="heading-1">è¸©å‘</h2>
<p>è¿™é‡Œèœé¸Ÿè¸©äº†å¥½å¤šå‘ï¼Œé—®AIçš„æ—¶å€™ï¼Œå¦‚æœè‡ªå·±ä¹Ÿä¸çŸ¥é“å¦‚ä½•è§£å†³ï¼Œåªèƒ½é è¯•ï¼</p>
<p>ç”šè‡³å‡ºç°äº†è¿™ä¸ªç¦»è°±çš„è§£å†³æ–¹æ¡ˆï¼ŒæŠŠ<code>shellï¼štrue</code>ï¼Œæ”¹æˆä¸‹é¢çš„</p>
<pre><code class="hljs language-js" lang="js">{
  <span class="hljs-attr">shell</span>: <span class="hljs-string">"/bin/bash"</span>
}

<span class="hljs-comment">// spawn åå°æ‰§è¡Œ</span>
<span class="hljs-keyword">const</span> child = <span class="hljs-title function_">spawn</span>(<span class="hljs-string">"/bin/bash"</span>, [<span class="hljs-string">"-lc"</span>, <span class="hljs-string">`<span class="hljs-subst">${config.scriptPath}</span> <span class="hljs-subst">${data.inputJsonPath}</span>`</span>], {
  <span class="hljs-attr">detached</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è®©è„šæœ¬æˆä¸ºç‹¬ç«‹è¿›ç¨‹</span>
  <span class="hljs-attr">stdio</span>: [<span class="hljs-string">"ignore"</span>, outFd, outFd]
});
</code></pre>
<p>è¿™äº›å®Œå…¨å°±æ˜¯æ— ç¨½ä¹‹è°ˆã€‚</p>
<p>ä¸»è¦è¿˜æ˜¯èœé¸Ÿä¸æ‡‚å‘½ä»¤è¡Œï¼Œå…¶å®è¦æ˜¯æ‡‚çš„è¯ï¼Œå°±çŸ¥é“<code>source /home/bnzycjd/.bashrc</code>å…¶å®æ ¹æœ¬ä¸æ˜¯è¿è¡Œè„šæœ¬çš„å‘½ä»¤ï¼Œè€Œæ˜¯åŠ è½½ç¯å¢ƒå˜é‡çš„ä½œç”¨ï¼</p>
<p>èœé¸Ÿå°±ä¸€ç›´ä»¥ä¸ºå¿…é¡»åŠ ä¸Š<code>source /home/bnzycjd/.bashrc</code>æ‰æ˜¯å®Œæ•´å‘½ä»¤ /(ã„’oã„’)/~~</p>
<h2 data-id="heading-2">ç­”æ¡ˆ</h2>
<p>è¸©äº†å¾ˆå¤šå‘ï¼Œæ€»ç®—æ˜¯åœ¨AIé‚£è¾¹å¾—åˆ°äº†ç­”æ¡ˆï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a407f9ab5e34da4be06ed9e27e1bd33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460214&amp;x-signature=Hzg9%2B9yrjiJ%2Fbhis3dxoAd8wwww%3D" alt="image.png" loading="lazy"/></p>
<p>ç­”æ¡ˆæ˜¯ï¼š</p>
<blockquote>
<p>ä¸ç®¡æ˜¯ç”¨npm run devè·‘æˆ–è€…å¤åˆ¶åˆ°æœåŠ¡å™¨çš„ç»ˆç«¯ä¸Šè¿è¡Œï¼Œéƒ½ç›¸å½“äºæœ‰ç»ˆç«¯ä¸Šçš„ç¯å¢ƒä¿¡æ¯ï¼Œä½†æ˜¯æ‰“åŒ…åçš„ç¨‹åºæ˜¯æ²¡æœ‰è¿™äº›çš„ï¼</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58aec789f54344508d786f5aa38ae373~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460214&amp;x-signature=ZuF3hBoeAPiJEFna0TZthl%2B0WdY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/234dc1275c974ae5b2241c19bfb28b2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460214&amp;x-signature=GXHnEScdb1NhXgzMNceBtBQGcFg%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">å¦‚ä½•è§£å†³ï¼Ÿ</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8810a99d7e8e419e96ca3610c7a3d60a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460214&amp;x-signature=%2FqRnE3fvbWeFvCWHVQWLkCq3U2o%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™é‡Œèœé¸Ÿæ˜¯ç”¨äºŒè§£å†³çš„ï¼ˆæ„Ÿè§‰ä¸€å’ŒäºŒå·®ä¸å¤šï¼‰ï¼Œä¸‰ä¸æ˜¯å¾ˆæ‡‚ï¼Œè¿™ä¸ªé¡¹ç›®æ¯”è¾ƒç®€å•ã€æ¯”è¾ƒæ€¥ï¼Œå°±æ²¡æœ‰ç”¨è¿™ä¸ªä¸“ä¸šçš„è§£å†³åŠæ³•ï¼Œ<strong>æœ‰æ‡‚çš„è¯»è€…ï¼Œå¯ä»¥æŒ‡ç‚¹æ±Ÿå±±ï¼Œæ¿€æ‰¬æ–‡å­—ï¼</strong></p>
<p>çŸ¥é“äº†é—®é¢˜ï¼Œç›´æ¥å°±æ˜¯è®©GPTå¸®æˆ‘ä»¬ç›´æ¥ç”¨äºŒçš„æ–¹å¼è§£å†³ï¼Œå¹¶æä¾›å¯ç”¨ä»£ç ï¼Œè¿™é‡Œä¹Ÿæ˜¯è¦å’ŒAIäº¤äº’å¾ˆä¹…ï¼ˆå°±ä¸ä¸€ ä¸€åˆ—ä¸¾äº†ï¼‰ï¼Œæœ€ç»ˆä»£ç ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildPythonEnv</span>(<span class="hljs-params">pythonPath, environmentVar</span>) {
  <span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);

  <span class="hljs-keyword">const</span> condaRoot = path.<span class="hljs-title function_">dirname</span>(path.<span class="hljs-title function_">dirname</span>(pythonPath));

  <span class="hljs-keyword">return</span> {
    ...process.<span class="hljs-property">env</span>,

    <span class="hljs-attr">PATH</span>: <span class="hljs-string">`<span class="hljs-subst">${environmentVar}</span><span class="hljs-subst">${condaRoot}</span>/bin:/usr/bin:/bin`</span>,
    <span class="hljs-attr">CONDA_PREFIX</span>: condaRoot,
    <span class="hljs-attr">LD_LIBRARY_PATH</span>: <span class="hljs-string">`<span class="hljs-subst">${condaRoot}</span>/lib`</span>,
    <span class="hljs-attr">PYTHONHOME</span>: condaRoot,

    <span class="hljs-attr">HOME</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">HOME</span>,
    <span class="hljs-attr">USER</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">USER</span>
  };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">runScript</span>(<span class="hljs-params">ipcMain, app, path, fs, spawn</span>) {
  <span class="hljs-comment">// è¿è¡Œè„šæœ¬ -- ç­‰å¾…ç»“æœ</span>
  ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"runScript"</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
        <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"config.json"</span>);
        <span class="hljs-comment">// è¯»å– config.json</span>
        <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(configPath)) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
            <span class="hljs-string">"The config.json file does not exist. Please initialize the scripts folder first"</span>
          );
        }

        <span class="hljs-keyword">const</span> config = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fs.<span class="hljs-title function_">readFileSync</span>(configPath, <span class="hljs-string">"utf-8"</span>));
        <span class="hljs-keyword">const</span> { pythonPath, scriptPath, environmentVar } = config;

        <span class="hljs-keyword">if</span> (!pythonPath || !scriptPath || !environmentVar) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"config.json ç¼ºå°‘ pythonPath æˆ– scriptPath æˆ– environmentVar"</span>);
        }

        <span class="hljs-keyword">const</span> env = <span class="hljs-title function_">buildPythonEnv</span>(pythonPath, environmentVar);

        <span class="hljs-keyword">const</span> logFile = path.<span class="hljs-title function_">join</span>(data.<span class="hljs-property">logPath</span>, <span class="hljs-string">`<span class="hljs-subst">${data.logName}</span>.log`</span>);
        <span class="hljs-keyword">const</span> outFd = fs.<span class="hljs-title function_">openSync</span>(logFile, <span class="hljs-string">"a"</span>);

        <span class="hljs-keyword">const</span> child = <span class="hljs-title function_">spawn</span>(pythonPath, [scriptPath, <span class="hljs-string">"-c"</span>, data.<span class="hljs-property">inputJsonPath</span>], {
          env,
          <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">stdio</span>: [<span class="hljs-string">"ignore"</span>, outFd, outFd]
        });

        child.<span class="hljs-title function_">on</span>(<span class="hljs-string">"error"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
          <span class="hljs-title function_">reject</span>(<span class="hljs-string">`bash å¯åŠ¨å¤±è´¥: <span class="hljs-subst">${err.message}</span>`</span>);
        });

        child.<span class="hljs-title function_">on</span>(<span class="hljs-string">"close"</span>, <span class="hljs-function">(<span class="hljs-params">code</span>) =&gt;</span> {
          <span class="hljs-keyword">if</span> (code !== <span class="hljs-number">0</span>) {
            <span class="hljs-title function_">reject</span>(<span class="hljs-string">`è„šæœ¬æ‰§è¡Œå¤±è´¥ï¼Œé€€å‡ºç  <span class="hljs-subst">${code}</span>`</span>);
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"è„šæœ¬æ‰§è¡Œå®Œæˆ"</span>);
          }
        });
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
      }
    });
  });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">runScriptNoWait</span>(<span class="hljs-params">ipcMain, app, path, fs, spawn</span>) {
  <span class="hljs-comment">// è¿è¡Œè„šæœ¬ -- ä¸ç­‰å¾…ç»“æœ</span>
  ipcMain.<span class="hljs-title function_">handle</span>(<span class="hljs-string">"runScriptNoWait"</span>, <span class="hljs-keyword">async</span> (event, data) =&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> userDataPath = app.<span class="hljs-title function_">getPath</span>(<span class="hljs-string">"userData"</span>);
        <span class="hljs-keyword">const</span> configPath = path.<span class="hljs-title function_">join</span>(userDataPath, <span class="hljs-string">"scripts"</span>, <span class="hljs-string">"config.json"</span>);
        <span class="hljs-comment">// è¯»å– config.json</span>
        <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(configPath)) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
            <span class="hljs-string">"The config.json file does not exist. Please initialize the scripts folder first."</span>
          );
        }

        <span class="hljs-keyword">const</span> config = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fs.<span class="hljs-title function_">readFileSync</span>(configPath, <span class="hljs-string">"utf-8"</span>));
        <span class="hljs-keyword">const</span> { pythonPath, scriptPath, environmentVar } = config;

        <span class="hljs-keyword">if</span> (!pythonPath || !scriptPath || !environmentVar) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"config.json ç¼ºå°‘ pythonPath æˆ– scriptPath æˆ– environmentVar"</span>);
        }

        <span class="hljs-keyword">const</span> env = <span class="hljs-title function_">buildPythonEnv</span>(pythonPath, environmentVar);

        <span class="hljs-keyword">const</span> logFile = path.<span class="hljs-title function_">join</span>(data.<span class="hljs-property">logPath</span>, <span class="hljs-string">`<span class="hljs-subst">${data.logName}</span>.log`</span>);
        <span class="hljs-keyword">const</span> outFd = fs.<span class="hljs-title function_">openSync</span>(logFile, <span class="hljs-string">"a"</span>);

        <span class="hljs-keyword">const</span> child = <span class="hljs-title function_">spawn</span>(pythonPath, [scriptPath, <span class="hljs-string">"-c"</span>, data.<span class="hljs-property">inputJsonPath</span>], {
          env,
          <span class="hljs-attr">shell</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">detached</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// è®©è„šæœ¬æˆä¸ºç‹¬ç«‹è¿›ç¨‹</span>
          <span class="hljs-attr">stdio</span>: [<span class="hljs-string">"ignore"</span>, outFd, outFd]
        });

        child.<span class="hljs-title function_">on</span>(<span class="hljs-string">"error"</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
          <span class="hljs-title function_">reject</span>(<span class="hljs-string">`åå°è„šæœ¬å¯åŠ¨å¤±è´¥: <span class="hljs-subst">${err.message}</span>`</span>);
        });

        <span class="hljs-comment">// æ–­å¼€ Electron ä¸è„šæœ¬çš„å…³ç³»</span>
        child.<span class="hljs-title function_">unref</span>();

        <span class="hljs-comment">// å…³é”®ï¼šä¸ç­‰å¾…è„šæœ¬æ‰§è¡Œç»“æœ</span>
        <span class="hljs-title function_">resolve</span>(<span class="hljs-string">"è„šæœ¬å·²åœ¨åå°å¯åŠ¨"</span>);
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-title function_">reject</span>(err.<span class="hljs-property">message</span>);
      }
    });
  });
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  runScript,
  runScriptNoWait
};
</code></pre>
<p>è¿™é‡Œå°±æ˜¯é…ç½®æ–‡ä»¶éœ€è¦ç¼–è¾‘çš„è¦å¤šä¸€äº›ï¼Œå¦‚å›¾</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6345be974f71450b8ef73b5c40bfe5f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUEJpdFc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460214&amp;x-signature=0qlgKtdb9nHoeJ5s7%2FkHch38%2FbI%3D" alt="image.png" loading="lazy"/></p>
<p>å¸Œæœ›è¿™äº›å‘å¯ä»¥å¸®åŠ©åˆ°å¤§å®¶ï¼Œè™½ç„¶æ˜¯AIè¾…åŠ©æå®šçš„ï¼Œä½†æ˜¯ä¹ŸèŠ±äº†ä¸å°‘æ—¶é—´ï¼Œå¦‚æœèƒ½åˆ·åˆ°èœé¸Ÿçš„æ–‡ç« ï¼Œå°±å¯ä»¥çœä¸‹ä¸å°‘æ—¶é—´ o(<em>ï¿£â–½ï¿£</em>)ãƒ–</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ28ï¼‰Hibernateçš„çº§è”æ“ä½œæ˜¯ä»€ä¹ˆï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592148975849013291</link>    <guid>https://juejin.cn/post/7592148975849013291</guid>    <pubDate>2026-01-07T11:53:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592148975849013291" data-draft-id="7592159803411005476" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ28ï¼‰Hibernateçš„çº§è”æ“ä½œæ˜¯ä»€ä¹ˆï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-07T11:53:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ28ï¼‰Hibernateçš„çº§è”æ“ä½œæ˜¯ä»€ä¹ˆï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T11:53:40.000Z" title="Wed Jan 07 2026 11:53:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernateçš„çº§è”æ“ä½œ</h3>
<p>çº§è”æ“ä½œï¼ˆCascade Operationsï¼‰æ˜¯Hibernateæä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œé€šè¿‡å®ƒå¯ä»¥åœ¨çˆ¶å®ä½“ä¸Šæ‰§è¡Œæ“ä½œæ—¶ï¼Œè‡ªåŠ¨å¯¹å…¶å…³è”çš„å­å®ä½“æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚è¿™æ ·å¯ä»¥ç®€åŒ–ä»£ç ï¼Œé¿å…æ‰‹åŠ¨ç®¡ç†å…³è”å®ä½“çš„çŠ¶æ€ã€‚</p>
<p>çº§è”æ“ä½œçš„ä¸»è¦ç±»å‹åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>CascadeType.PERSIST</strong>ï¼šåœ¨ä¿å­˜ï¼ˆpersistï¼‰çˆ¶å®ä½“æ—¶ï¼Œè‡ªåŠ¨ä¿å­˜å…³è”çš„å­å®ä½“ã€‚</li>
<li><strong>CascadeType.MERGE</strong>ï¼šåœ¨åˆå¹¶ï¼ˆmergeï¼‰çˆ¶å®ä½“æ—¶ï¼Œè‡ªåŠ¨åˆå¹¶å…³è”çš„å­å®ä½“ã€‚</li>
<li><strong>CascadeType.REMOVE</strong>ï¼šåœ¨åˆ é™¤ï¼ˆremoveï¼‰çˆ¶å®ä½“æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤å…³è”çš„å­å®ä½“ã€‚</li>
<li><strong>CascadeType.DETACH</strong>ï¼šåœ¨åˆ†ç¦»ï¼ˆdetachï¼‰çˆ¶å®ä½“æ—¶ï¼Œè‡ªåŠ¨åˆ†ç¦»å…³è”çš„å­å®ä½“ã€‚</li>
<li><strong>CascadeType.REFRESH</strong>ï¼šåœ¨åˆ·æ–°ï¼ˆrefreshï¼‰çˆ¶å®ä½“æ—¶ï¼Œè‡ªåŠ¨åˆ·æ–°å…³è”çš„å­å®ä½“ã€‚</li>
<li><strong>CascadeType.ALL</strong>ï¼šåŒ…æ‹¬ä»¥ä¸Šæ‰€æœ‰çº§è”æ“ä½œã€‚</li>
</ul>
<h3 data-id="heading-1">ç¤ºä¾‹ä»£ç </h3>
<h4 data-id="heading-2">é…ç½®æ–‡ä»¶ <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- æ•°æ®åº“è¿æ¥é…ç½® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate å±æ€§é…ç½® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- æ˜ å°„ç±» --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">å®ä½“ç±» <code>Person</code> å’Œ <code>Address</code></h4>
<h5 data-id="heading-4">Personç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-meta">@OneToMany(mappedBy = "person", cascade = CascadeType.ALL, orphanRemoval = true)</span>
    <span class="hljs-keyword">private</span> Set&lt;Address&gt; addresses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters å’Œ Setters</span>
    
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-keyword">public</span> Set&lt;Address&gt; <span class="hljs-title function_">getAddresses</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> addresses;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAddresses</span><span class="hljs-params">(Set&lt;Address&gt; addresses)</span> {
        <span class="hljs-built_in">this</span>.addresses = addresses;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addAddress</span><span class="hljs-params">(Address address)</span> {
        addresses.add(address);
        address.setPerson(<span class="hljs-built_in">this</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeAddress</span><span class="hljs-params">(Address address)</span> {
        addresses.remove(address);
        address.setPerson(<span class="hljs-literal">null</span>);
    }
}
</code></pre>
<h5 data-id="heading-5">Addressç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters å’Œ Setters</span>
    
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h3 data-id="heading-6">çº§è”æ“ä½œç¤ºä¾‹</h3>
<h5 data-id="heading-7">HibernateUtilç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä»é…ç½®æ–‡ä»¶åˆ›å»ºSessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// è®°å½•å¯åŠ¨å¤±è´¥çš„é”™è¯¯</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-8">çº§è”ä¿å­˜ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCascadeSaveExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è·å–SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// æ’å…¥æ•°æ®</span>
        insertPersonWithAddresses(sessionFactory);

        <span class="hljs-comment">// å…³é—­SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertPersonWithAddresses</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"123 Street"</span>, person);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"456 Avenue"</span>, person);

            person.addAddress(address1);
            person.addAddress(address2);

            <span class="hljs-comment">// ä¿å­˜Personå¯¹è±¡æ—¶ï¼Œçº§è”ä¿å­˜Addresså¯¹è±¡</span>
            session.save(person);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted Person with Addresses"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-9">çº§è”åˆ é™¤ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCascadeDeleteExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è·å–SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// åˆ é™¤æ•°æ®</span>
        deletePersonWithAddresses(sessionFactory);

        <span class="hljs-comment">// å…³é—­SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deletePersonWithAddresses</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è·å–Personå¯¹è±¡</span>
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// åˆ é™¤Personå¯¹è±¡æ—¶ï¼Œçº§è”åˆ é™¤Addresså¯¹è±¡</span>
                session.delete(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Deleted Person with Addresses"</span>);
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-10">çº§è”æ›´æ–°ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCascadeUpdateExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è·å–SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// æ›´æ–°æ•°æ®</span>
        updatePersonWithAddresses(sessionFactory);

        <span class="hljs-comment">// å…³é—­SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updatePersonWithAddresses</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è·å–Personå¯¹è±¡</span>
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// æ›´æ–°Personå¯¹è±¡</span>
                person.setName(<span class="hljs-string">"Jane Doe"</span>);
                person.setAge(<span class="hljs-number">35</span>);

                <span class="hljs-comment">// çº§è”æ›´æ–°Addresså¯¹è±¡</span>
                <span class="hljs-keyword">for</span> (Address address : person.getAddresses()) {
                    address.setStreet(address.getStreet() + <span class="hljs-string">" Updated"</span>);
                }

                session.update(person);
                transaction.commit();
                System.out.println(<span class="hljs-string">"Updated Person with Addresses"</span>);
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-11">çº§è”æ“ä½œçš„è¯¦ç»†è§£é‡Š</h3>
<ol>
<li>
<p><strong>é…ç½®æ–‡ä»¶ <code>hibernate.cfg.xml</code></strong>ï¼šå®šä¹‰æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€Hibernateå±æ€§é…ç½®ä»¥åŠå®ä½“ç±»æ˜ å°„é…ç½®ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
</code></pre>
</li>
<li>
<p><strong>å®ä½“ç±» <code>Person</code> å’Œ <code>Address</code></strong>ï¼š</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é«˜å¹¶å‘ä¸‹çš„é˜²å¹¶å‘å®æˆ˜ï¼šCç«¯/Bç«¯é¡¹ç›®å¹¶å‘æ§åˆ¶å®Œå…¨æŒ‡å—]]></title>    <link>https://juejin.cn/post/7592164124659679282</link>    <guid>https://juejin.cn/post/7592164124659679282</guid>    <pubDate>2026-01-07T02:22:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592164124659679282" data-draft-id="7592164124659433522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é«˜å¹¶å‘ä¸‹çš„é˜²å¹¶å‘å®æˆ˜ï¼šCç«¯/Bç«¯é¡¹ç›®å¹¶å‘æ§åˆ¶å®Œå…¨æŒ‡å—"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-07T02:22:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¸…æ°”çš„ä½ "/> <meta itemprop="url" content="https://juejin.cn/user/1626932940649534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é«˜å¹¶å‘ä¸‹çš„é˜²å¹¶å‘å®æˆ˜ï¼šCç«¯/Bç«¯é¡¹ç›®å¹¶å‘æ§åˆ¶å®Œå…¨æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1626932940649534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¸…æ°”çš„ä½ 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T02:22:04.000Z" title="Wed Jan 07 2026 02:22:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">é«˜å¹¶å‘ä¸‹çš„é˜²å¹¶å‘å®æˆ˜ï¼šCç«¯/Bç«¯é¡¹ç›®å¹¶å‘æ§åˆ¶å®Œå…¨æŒ‡å—</h2>
<blockquote>
<p><strong>æ‘˜è¦</strong>ï¼šæœ¬æ–‡ç³»ç»Ÿæ¢³ç†Cç«¯/Bç«¯é¡¹ç›®ä¸­çš„é˜²å¹¶å‘æ–¹æ¡ˆï¼Œæ¶µç›–å‰ç«¯é˜²é‡å¤æäº¤ï¼ˆæŒ‰é’®ç¦ç”¨ã€è¯·æ±‚å»é‡ï¼‰å’Œåç«¯å¹¶å‘æ§åˆ¶ï¼ˆåˆ†å¸ƒå¼é”ã€ä¹è§‚é”ã€æ‚²è§‚é”ã€å¹‚ç­‰æ€§ã€é™æµã€é˜Ÿåˆ—å‰Šå³°ï¼‰ã€‚é€šè¿‡ç§’æ€ã€æ”¯ä»˜ã€æ‰¹é‡å¯¼å…¥ç­‰å®æˆ˜åœºæ™¯ï¼Œæä¾›å®Œæ•´çš„ä»£ç ç¤ºä¾‹å’Œæ–¹æ¡ˆé€‰æ‹©æŒ‡å—ï¼Œé€‚é…SpringBoot 2.xå’ŒVue3æŠ€æœ¯æ ˆã€‚</p>
</blockquote>
<h3 data-id="heading-1">ä¸€ã€å¼•è¨€</h3>
<p>åœ¨äº’è”ç½‘åº”ç”¨ä¸­ï¼Œå¹¶å‘æ§åˆ¶æ˜¯ä¿éšœç³»ç»Ÿç¨³å®šæ€§å’Œæ•°æ®ä¸€è‡´æ€§çš„æ ¸å¿ƒé—®é¢˜ã€‚æ— è®ºæ˜¯Cç«¯ç”¨æˆ·çš„ç§’æ€æŠ¢è´­ã€ä¸‹å•æ”¯ä»˜ï¼Œè¿˜æ˜¯Bç«¯ç³»ç»Ÿçš„æ‰¹é‡æ“ä½œã€æ•°æ®åŒæ­¥ï¼Œéƒ½éœ€è¦æœ‰æ•ˆçš„é˜²å¹¶å‘æœºåˆ¶ã€‚æœ¬æ–‡å°†ä»å‰åç«¯ä¸¤ä¸ªç»´åº¦ï¼Œç³»ç»Ÿæ¢³ç†Cç«¯å’ŒBç«¯é¡¹ç›®ä¸­å¸¸è§çš„é˜²å¹¶å‘æ€è·¯å’Œå®æˆ˜æ–¹æ¡ˆã€‚</p>
<h4 data-id="heading-2">1.1 å¹¶å‘é—®é¢˜çš„å…¸å‹åœºæ™¯</h4>
<h5 data-id="heading-3">Cç«¯åœºæ™¯</h5>
<ul>
<li><strong>ç§’æ€æŠ¢è´­</strong>ï¼šåº“å­˜æ‰£å‡ã€è®¢å•åˆ›å»º</li>
<li><strong>æ”¯ä»˜ä¸‹å•</strong>ï¼šé‡å¤æ”¯ä»˜ã€è®¢å•é‡å¤åˆ›å»º</li>
<li><strong>ä¼˜æƒ åˆ¸é¢†å–</strong>ï¼šé‡å¤é¢†å–ã€è¶…å‘</li>
<li><strong>ç­¾åˆ°æ‰“å¡</strong>ï¼šé‡å¤ç­¾åˆ°ã€æ•°æ®é‡å¤</li>
</ul>
<h5 data-id="heading-4">Bç«¯åœºæ™¯</h5>
<ul>
<li><strong>æ‰¹é‡å¯¼å…¥</strong>ï¼šé‡å¤å¯¼å…¥ã€æ•°æ®è¦†ç›–</li>
<li><strong>å®¡æ ¸æµç¨‹</strong>ï¼šé‡å¤å®¡æ ¸ã€çŠ¶æ€å†²çª</li>
<li><strong>æ•°æ®åŒæ­¥</strong>ï¼šé‡å¤åŒæ­¥ã€æ•°æ®ä¸ä¸€è‡´</li>
<li><strong>æŠ¥è¡¨ç”Ÿæˆ</strong>ï¼šé‡å¤ç”Ÿæˆã€èµ„æºæµªè´¹</li>
</ul>
<h4 data-id="heading-5">1.2 å¹¶å‘é—®é¢˜çš„å±å®³</h4>
<ol>
<li><strong>æ•°æ®ä¸ä¸€è‡´</strong>ï¼šåº“å­˜è¶…å–ã€ä½™é¢é”™è¯¯</li>
<li><strong>é‡å¤æ“ä½œ</strong>ï¼šé‡å¤ä¸‹å•ã€é‡å¤æ‰£æ¬¾</li>
<li><strong>èµ„æºæµªè´¹</strong>ï¼šé‡å¤è®¡ç®—ã€é‡å¤è°ƒç”¨</li>
<li><strong>ä¸šåŠ¡å¼‚å¸¸</strong>ï¼šçŠ¶æ€é”™ä¹±ã€æµç¨‹ä¸­æ–­</li>
</ol>
<h3 data-id="heading-6">äºŒã€é˜²å¹¶å‘æ–¹æ¡ˆå…¨æ™¯å›¾</h3>
<h4 data-id="heading-7">2.1 é˜²å¹¶å‘æ–¹æ¡ˆ-æ€ç»´å¯¼å›¾</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6411a357edcb4259ba34edf81a1af193~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5biF5rCU55qE5L2g:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357323&amp;x-signature=3uXQEZxTxqz6RNCRpHx%2BnboUSNo%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-8">2.2 æ–¹æ¡ˆé€‰æ‹©å†³ç­–æ ‘</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6cdcd3e6da540c68ce8b2196b397a61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5biF5rCU55qE5L2g:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768357323&amp;x-signature=1vMnN%2FBl0ABX0qTcvB0MJdtGmiU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">ä¸‰ã€å‰ç«¯é˜²å¹¶å‘æ–¹æ¡ˆ</h3>
<h4 data-id="heading-10">3.1 UIå±‚é˜²é‡å¤æäº¤</h4>
<h5 data-id="heading-11">3.1.1 æŒ‰é’®ç¦ç”¨æ–¹æ¡ˆ</h5>
<p><strong>Vue3 å®ç°ï¼ˆComposition APIï¼‰ï¼š</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-button 
    :loading="submitting" 
    :disabled="submitting"
    @click="handleSubmit"
  &gt;
    {{ submitting ? 'æäº¤ä¸­...' : 'æäº¤è®¢å•' }}
  &lt;/el-button&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'
import { ElMessage } from 'element-plus'

const submitting = ref(false)

const handleSubmit = async () =&gt; {
  // é˜²æ­¢é‡å¤ç‚¹å‡»
  if (submitting.value) {
    return
  }
  
  submitting.value = true
  try {
    await submitOrder()
    ElMessage.success('æäº¤æˆåŠŸ')
  } catch (error) {
    ElMessage.error('æäº¤å¤±è´¥ï¼š' + error.message)
  } finally {
    submitting.value = false
  }
}

const submitOrder = async () =&gt; {
  // è°ƒç”¨åç«¯æ¥å£
  const response = await axios.post('/api/order/submit', orderData)
  return response.data
}
&lt;/script&gt;
</code></pre>
<p><strong>Vue3 å®ç°ï¼ˆOptions APIï¼‰ï¼š</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-button 
    :loading="submitting" 
    :disabled="submitting"
    @click="handleSubmit"
  &gt;
    æäº¤è®¢å•
  &lt;/el-button&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  data() {
    return {
      submitting: false
    }
  },
  methods: {
    async handleSubmit() {
      if (this.submitting) {
        return
      }
      
      this.submitting = true
      try {
        await this.submitOrder()
        this.$message.success('æäº¤æˆåŠŸ')
      } catch (error) {
        this.$message.error('æäº¤å¤±è´¥ï¼š' + error.message)
      } finally {
        this.submitting = false
      }
    },
    
    async submitOrder() {
      const response = await this.$http.post('/api/order/submit', this.orderData)
      return response.data
    }
  }
}
&lt;/script&gt;
</code></pre>
<h5 data-id="heading-12">3.1.2 é˜²æŠ–ï¼ˆDebounceï¼‰æ–¹æ¡ˆ</h5>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> æœç´¢æ¡†è¾“å…¥ã€æŒ‰é’®å¿«é€Ÿç‚¹å‡»</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-input 
    v-model="keyword" 
    @input="handleSearch"
    placeholder="è¯·è¾“å…¥å…³é”®è¯"
  /&gt;
  &lt;el-button @click="handleSubmit"&gt;æäº¤&lt;/el-button&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'
import { debounce } from 'lodash-es'

const keyword = ref('')

// é˜²æŠ–å¤„ç†ï¼š500mså†…åªæ‰§è¡Œæœ€åä¸€æ¬¡
const handleSearch = debounce((value) =&gt; {
  console.log('æœç´¢ï¼š', value)
  // æ‰§è¡Œæœç´¢é€»è¾‘
  searchData(value)
}, 500)

// æŒ‰é’®é˜²æŠ–
let submitTimer = null
const handleSubmit = () =&gt; {
  if (submitTimer) {
    clearTimeout(submitTimer)
  }
  
  submitTimer = setTimeout(() =&gt; {
    submitOrder()
    submitTimer = null
  }, 1000) // 1ç§’å†…åªå…è®¸æäº¤ä¸€æ¬¡
}
&lt;/script&gt;
</code></pre>
<p><strong>è‡ªå®šä¹‰é˜²æŠ–æŒ‡ä»¤ï¼ˆVue3ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// directives/debounce.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>
    el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (timer) {
        <span class="hljs-built_in">clearTimeout</span>(timer)
      }
      timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        binding.<span class="hljs-title function_">value</span>()
      }, binding.<span class="hljs-property">arg</span> || <span class="hljs-number">1000</span>)
    })
  }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
&lt;el-button v-<span class="hljs-attr">debounce</span>:<span class="hljs-number">1000</span>=<span class="hljs-string">"handleSubmit"</span>&gt;æäº¤&lt;/el-button&gt;
</code></pre>
<h5 data-id="heading-13">3.1.3 èŠ‚æµï¼ˆThrottleï¼‰æ–¹æ¡ˆ</h5>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong> æ»šåŠ¨åŠ è½½ã€çª—å£resize</p>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
import { ref, onMounted, onUnmounted } from 'vue'
import { throttle } from 'lodash-es'

const handleScroll = throttle(() =&gt; {
  // æ»šåŠ¨å¤„ç†é€»è¾‘
  const scrollTop = document.documentElement.scrollTop
  if (scrollTop &gt; 1000) {
    loadMore()
  }
}, 200) // 200mså†…æœ€å¤šæ‰§è¡Œä¸€æ¬¡

onMounted(() =&gt; {
  window.addEventListener('scroll', handleScroll)
})

onUnmounted(() =&gt; {
  window.removeEventListener('scroll', handleScroll)
})
&lt;/script&gt;
</code></pre>
<h4 data-id="heading-14">3.2 è¯·æ±‚æ‹¦æˆªä¸å»é‡</h4>
<h5 data-id="heading-15">3.2.1 Axios è¯·æ±‚æ‹¦æˆªå™¨</h5>
<p><strong>å®ç°è¯·æ±‚å»é‡ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/request.js</span>
<span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>

<span class="hljs-comment">// å­˜å‚¨æ­£åœ¨è¿›è¡Œçš„è¯·æ±‚</span>
<span class="hljs-keyword">const</span> pendingRequests = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()

<span class="hljs-comment">// ç”Ÿæˆè¯·æ±‚å”¯ä¸€æ ‡è¯†</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">generateRequestKey</span> = (<span class="hljs-params">config</span>) =&gt; {
  <span class="hljs-keyword">const</span> { method, url, params, data } = config
  <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${method}</span>_<span class="hljs-subst">${url}</span>_<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(params)}</span>_<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(data)}</span>`</span>
}

<span class="hljs-comment">// è¯·æ±‚æ‹¦æˆªå™¨</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> requestKey = <span class="hljs-title function_">generateRequestKey</span>(config)
    
    <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æœ‰ç›¸åŒçš„è¯·æ±‚æ­£åœ¨è¿›è¡Œ</span>
    <span class="hljs-keyword">if</span> (pendingRequests.<span class="hljs-title function_">has</span>(requestKey)) {
      <span class="hljs-comment">// å–æ¶ˆå½“å‰è¯·æ±‚</span>
      config.<span class="hljs-property">cancelToken</span> = <span class="hljs-keyword">new</span> axios.<span class="hljs-title class_">CancelToken</span>(<span class="hljs-function">(<span class="hljs-params">cancel</span>) =&gt;</span> {
        <span class="hljs-title function_">cancel</span>(<span class="hljs-string">'é‡å¤è¯·æ±‚å·²å–æ¶ˆ'</span>)
      })
      <span class="hljs-keyword">return</span> config
    }
    
    <span class="hljs-comment">// å°†è¯·æ±‚æ·»åŠ åˆ°pendingåˆ—è¡¨</span>
    pendingRequests.<span class="hljs-title function_">set</span>(requestKey, config)
    
    <span class="hljs-keyword">return</span> config
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)

<span class="hljs-comment">// å“åº”æ‹¦æˆªå™¨</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> requestKey = <span class="hljs-title function_">generateRequestKey</span>(response.<span class="hljs-property">config</span>)
    pendingRequests.<span class="hljs-title function_">delete</span>(requestKey)
    <span class="hljs-keyword">return</span> response
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">config</span>) {
      <span class="hljs-keyword">const</span> requestKey = <span class="hljs-title function_">generateRequestKey</span>(error.<span class="hljs-property">config</span>)
      pendingRequests.<span class="hljs-title function_">delete</span>(requestKey)
    }
    
    <span class="hljs-comment">// å¤„ç†å–æ¶ˆçš„è¯·æ±‚</span>
    <span class="hljs-keyword">if</span> (axios.<span class="hljs-title function_">isCancel</span>(error)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è¯·æ±‚å·²å–æ¶ˆï¼š'</span>, error.<span class="hljs-property">message</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> axios
</code></pre>
<h5 data-id="heading-16">3.2.2 åŸºäºè¯·æ±‚IDçš„å¹‚ç­‰æ€§</h5>
<p><strong>å‰ç«¯ç”Ÿæˆè¯·æ±‚IDï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// utils/requestId.js</span>
<span class="hljs-keyword">import</span> { v4 <span class="hljs-keyword">as</span> uuidv4 } <span class="hljs-keyword">from</span> <span class="hljs-string">'uuid'</span>

<span class="hljs-comment">// ä¸ºæ¯ä¸ªè¯·æ±‚æ·»åŠ å”¯ä¸€ID</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!config.<span class="hljs-property">headers</span>[<span class="hljs-string">'X-Request-Id'</span>]) {
    config.<span class="hljs-property">headers</span>[<span class="hljs-string">'X-Request-Id'</span>] = <span class="hljs-title function_">uuidv4</span>()
  }
  <span class="hljs-keyword">return</span> config
})
</code></pre>
<p><strong>åç«¯éªŒè¯è¯·æ±‚IDï¼ˆSpringBoot 2.xï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.web.servlet.handler.HandlerInterceptorAdapter;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;

<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * è¯·æ±‚å¹‚ç­‰æ€§æ‹¦æˆªå™¨
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨Rediså­˜å‚¨è¯·æ±‚IDï¼Œé˜²æ­¢é‡å¤è¯·æ±‚
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdempotentInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HandlerInterceptorAdapter</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">REQUEST_ID_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"request:id:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">EXPIRE_SECONDS</span> <span class="hljs-operator">=</span> <span class="hljs-number">300</span>; <span class="hljs-comment">// 5åˆ†é’Ÿè¿‡æœŸ</span>
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, 
                           HttpServletResponse response, 
                           Object handler)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// åªæ‹¦æˆªPOSTã€PUTã€DELETEè¯·æ±‚</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> request.getMethod();
        <span class="hljs-keyword">if</span> (!<span class="hljs-string">"POST"</span>.equals(method) &amp;&amp; !<span class="hljs-string">"PUT"</span>.equals(method) &amp;&amp; !<span class="hljs-string">"DELETE"</span>.equals(method)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-type">String</span> <span class="hljs-variable">requestId</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"X-Request-Id"</span>);
        <span class="hljs-keyword">if</span> (StringUtils.isBlank(requestId)) {
            <span class="hljs-comment">// æ²¡æœ‰è¯·æ±‚IDï¼Œå…è®¸é€šè¿‡ï¼ˆå…¼å®¹æ—§æ¥å£ï¼‰</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> REQUEST_ID_PREFIX + requestId;
        
        <span class="hljs-comment">// æ£€æŸ¥è¯·æ±‚IDæ˜¯å¦å·²å­˜åœ¨</span>
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">exists</span> <span class="hljs-operator">=</span> redisTemplate.hasKey(key);
        <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(exists)) {
            <span class="hljs-comment">// è¯·æ±‚é‡å¤ï¼Œè¿”å›é”™è¯¯</span>
            response.setStatus(HttpStatus.CONFLICT.value());
            response.getWriter().write(<span class="hljs-string">"{\"code\":409,\"message\":\"è¯·æ±‚é‡å¤\"}"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-comment">// å­˜å‚¨è¯·æ±‚ID</span>
        redisTemplate.opsForValue().set(key, <span class="hljs-string">"1"</span>, EXPIRE_SECONDS, TimeUnit.SECONDS);
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h4 data-id="heading-17">3.3 çŠ¶æ€ç®¡ç†æ§åˆ¶</h4>
<h5 data-id="heading-18">3.3.1 Vuex/Pinia çŠ¶æ€ç®¡ç†</h5>
<p><strong>Vue3 + Pinia å®ç°ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// stores/order.js</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useOrderStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'order'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">submitting</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">submitTimestamp</span>: <span class="hljs-number">0</span>
  }),
  
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">submitOrder</span>(<span class="hljs-params">orderData</span>) {
      <span class="hljs-comment">// é˜²æ­¢é‡å¤æäº¤ï¼š5ç§’å†…ä¸å…è®¸é‡å¤æäº¤</span>
      <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">submitting</span> || (now - <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitTimestamp</span> &lt; <span class="hljs-number">5000</span>)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'è¯·å‹¿é‡å¤æäº¤'</span>)
      }
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitting</span> = <span class="hljs-literal">true</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitTimestamp</span> = now
      
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/api/order/submit'</span>, orderData)
        <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>
      } <span class="hljs-keyword">finally</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">submitting</span> = <span class="hljs-literal">false</span>
      }
    }
  }
})

<span class="hljs-comment">// ç»„ä»¶ä¸­ä½¿ç”¨</span>
&lt;script setup&gt;
<span class="hljs-keyword">import</span> { useOrderStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/stores/order'</span>

<span class="hljs-keyword">const</span> orderStore = <span class="hljs-title function_">useOrderStore</span>()

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> orderStore.<span class="hljs-title function_">submitOrder</span>(orderData)
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">'æäº¤æˆåŠŸ'</span>)
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(error.<span class="hljs-property">message</span>)
  }
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-19">å››ã€åç«¯é˜²å¹¶å‘æ–¹æ¡ˆ</h3>
<h4 data-id="heading-20">4.1 åº”ç”¨å±‚é˜²å¹¶å‘</h4>
<h5 data-id="heading-21">4.1.1 åˆ†å¸ƒå¼é”ï¼ˆRediså®ç°ï¼‰</h5>
<p><strong>å®Œæ•´å®ç°ï¼ˆSpringBoot 2.xï¼‰ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.UUID;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * Redis åˆ†å¸ƒå¼é”å·¥å…·ç±»
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§ï¼Œé˜²æ­¢è¯¯åˆ å…¶ä»–å®ä¾‹çš„é”
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x + Spring Data Redis 1.7.2
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DistributedLockUtil</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">UNLOCK_SCRIPT</span> <span class="hljs-operator">=</span> 
        <span class="hljs-string">"if redis.call('get', KEYS[1]) == ARGV[1] then "</span> +
        <span class="hljs-string">"return redis.call('del', KEYS[1]) "</span> +
        <span class="hljs-string">"else return 0 end"</span>;
    
    <span class="hljs-comment">/**
     * å°è¯•è·å–é”
     * <span class="hljs-doctag">@param</span> lockKey é”çš„key
     * <span class="hljs-doctag">@param</span> lockValue é”çš„valueï¼ˆå»ºè®®ä½¿ç”¨UUIDï¼‰
     * <span class="hljs-doctag">@param</span> expireSeconds è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
     * <span class="hljs-doctag">@return</span> æ˜¯å¦è·å–æˆåŠŸ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(String lockKey, String lockValue, <span class="hljs-type">int</span> expireSeconds)</span> {
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue()
            .setIfAbsent(lockKey, lockValue, expireSeconds, TimeUnit.SECONDS);
        <span class="hljs-keyword">return</span> Boolean.TRUE.equals(result);
    }
    
    <span class="hljs-comment">/**
     * é‡Šæ”¾é”ï¼ˆä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§ï¼‰
     * <span class="hljs-doctag">@param</span> lockKey é”çš„key
     * <span class="hljs-doctag">@param</span> lockValue é”çš„value
     * <span class="hljs-doctag">@return</span> æ˜¯å¦é‡Šæ”¾æˆåŠŸ
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">(String lockKey, String lockValue)</span> {
        DefaultRedisScript&lt;Long&gt; script = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();
        script.setScriptText(UNLOCK_SCRIPT);
        script.setResultType(Long.class);
        <span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.execute(
            script, 
            Collections.singletonList(lockKey), 
            lockValue
        );
        <span class="hljs-keyword">return</span> result != <span class="hljs-literal">null</span> &amp;&amp; result == <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-comment">/**
     * è·å–é”ï¼ˆå¸¦é‡è¯•æœºåˆ¶ï¼‰
     * <span class="hljs-doctag">@param</span> lockKey é”çš„key
     * <span class="hljs-doctag">@param</span> expireSeconds è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
     * <span class="hljs-doctag">@param</span> maxWaitSeconds æœ€å¤§ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰
     * <span class="hljs-doctag">@return</span> é”çš„valueï¼Œè·å–å¤±è´¥è¿”å›null
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">lockWithRetry</span><span class="hljs-params">(String lockKey, <span class="hljs-type">int</span> expireSeconds, <span class="hljs-type">int</span> maxWaitSeconds)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-type">long</span> <span class="hljs-variable">endTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() + maxWaitSeconds * <span class="hljs-number">1000</span>;
        
        <span class="hljs-keyword">while</span> (System.currentTimeMillis() &lt; endTime) {
            <span class="hljs-keyword">if</span> (tryLock(lockKey, lockValue, expireSeconds)) {
                <span class="hljs-keyword">return</span> lockValue;
            }
            
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">100</span>); <span class="hljs-comment">// ç­‰å¾…100msåé‡è¯•</span>
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
}
</code></pre>
<p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-comment">/**
 * è®¢å•æœåŠ¡ç¤ºä¾‹
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨åˆ†å¸ƒå¼é”é˜²æ­¢å¹¶å‘åˆ›å»ºè®¢å•
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DistributedLockUtil distributedLockUtil;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-comment">/**
     * åˆ›å»ºè®¢å•ï¼ˆé˜²å¹¶å‘ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> OrderDTO <span class="hljs-title function_">createOrder</span><span class="hljs-params">(CreateOrderParam param)</span> {
        <span class="hljs-comment">// æ„å»ºé”çš„keyï¼šç”¨æˆ·ID + å•†å“ID</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"order:create:%s:%s"</span>, 
            param.getUserId(), param.getProductId());
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-type">int</span> <span class="hljs-variable">expireSeconds</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>; <span class="hljs-comment">// é”30ç§’è¿‡æœŸ</span>
        
        <span class="hljs-comment">// å°è¯•è·å–é”</span>
        <span class="hljs-keyword">if</span> (!distributedLockUtil.tryLock(lockKey, lockValue, expireSeconds)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
                <span class="hljs-string">"è®¢å•åˆ›å»ºä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤"</span>);
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è®¢å•</span>
            <span class="hljs-type">OrderPO</span> <span class="hljs-variable">existingOrder</span> <span class="hljs-operator">=</span> orderMapper.selectByUserIdAndProductId(
                param.getUserId(), param.getProductId());
            <span class="hljs-keyword">if</span> (existingOrder != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.RECORD_EXISTED.code(), 
                    <span class="hljs-string">"è®¢å•å·²å­˜åœ¨"</span>);
            }
            
            <span class="hljs-comment">// åˆ›å»ºè®¢å•</span>
            <span class="hljs-type">OrderPO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderPO</span>();
            order.setUserId(param.getUserId());
            order.setProductId(param.getProductId());
            order.setAmount(param.getAmount());
            order.setStatus(OrderStatusEnum.PENDING.getCode());
            orderMapper.insert(order);
            
            log.info(<span class="hljs-string">"è®¢å•åˆ›å»ºæˆåŠŸï¼šorderId={}"</span>, order.getId());
            <span class="hljs-keyword">return</span> convertToDTO(order);
            
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// é‡Šæ”¾é”</span>
            distributedLockUtil.releaseLock(lockKey, lockValue);
        }
    }
}
</code></pre>
<h5 data-id="heading-22">4.1.2 æœ¬åœ°é”ï¼ˆå•æœºåœºæ™¯ï¼‰</h5>
<p><strong>synchronized å®ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æœ¬åœ°é”ç¤ºä¾‹ï¼ˆå•æœºéƒ¨ç½²ï¼‰
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨synchronizedä¿è¯çº¿ç¨‹å®‰å…¨
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šJDK 1.8+
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LocalLockService</span> {
    
    <span class="hljs-comment">/**
     * ä½¿ç”¨synchronizedæ–¹æ³•é”
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processWithMethodLock</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span>
        doBusiness(key);
    }
    
    <span class="hljs-comment">/**
     * ä½¿ç”¨synchronizedä»£ç å—é”
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processWithBlockLock</span><span class="hljs-params">(String key)</span> {
        <span class="hljs-keyword">synchronized</span> (lock) {
            <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span>
            doBusiness(key);
        }
    }
    
    <span class="hljs-comment">/**
     * ä½¿ç”¨ReentrantLockï¼ˆæ›´çµæ´»ï¼‰
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">reentrantLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processWithReentrantLock</span><span class="hljs-params">(String key)</span> {
        reentrantLock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span>
            doBusiness(key);
        } <span class="hljs-keyword">finally</span> {
            reentrantLock.unlock();
        }
    }
}
</code></pre>
<h5 data-id="heading-23">4.1.3 å¹‚ç­‰æ€§è®¾è®¡</h5>
<p><strong>åŸºäºå”¯ä¸€ä¸šåŠ¡æ ‡è¯†çš„å¹‚ç­‰æ€§ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * å¹‚ç­‰æ€§æœåŠ¡ç¤ºä¾‹
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨Redis + æ•°æ®åº“å”¯ä¸€ç´¢å¼•ä¿è¯å¹‚ç­‰æ€§
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdempotentService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">IDEMPOTENT_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"idempotent:"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">EXPIRE_SECONDS</span> <span class="hljs-operator">=</span> <span class="hljs-number">300</span>; <span class="hljs-comment">// 5åˆ†é’Ÿ</span>
    
    <span class="hljs-comment">/**
     * å¹‚ç­‰æ€§åˆ›å»ºè®¢å•
     * <span class="hljs-doctag">@param</span> param è®¢å•å‚æ•°
     * <span class="hljs-doctag">@param</span> idempotentKey å¹‚ç­‰æ€§keyï¼ˆå¦‚ï¼šè®¢å•å·ã€è¯·æ±‚IDï¼‰
     * <span class="hljs-doctag">@return</span> è®¢å•ID
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">createOrderIdempotent</span><span class="hljs-params">(CreateOrderParam param, String idempotentKey)</span> {
        <span class="hljs-comment">// 1. æ£€æŸ¥Redisä¸­æ˜¯å¦å­˜åœ¨å¹‚ç­‰æ€§key</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">redisKey</span> <span class="hljs-operator">=</span> IDEMPOTENT_PREFIX + idempotentKey;
        <span class="hljs-type">String</span> <span class="hljs-variable">existingOrderId</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(redisKey);
        
        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(existingOrderId)) {
            log.info(<span class="hljs-string">"å¹‚ç­‰æ€§æ£€æŸ¥ï¼šè®¢å•å·²å­˜åœ¨ï¼ŒorderId={}"</span>, existingOrderId);
            <span class="hljs-keyword">return</span> Long.parseLong(existingOrderId);
        }
        
        <span class="hljs-comment">// 2. æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦å­˜åœ¨ï¼ˆåŒé‡æ£€æŸ¥ï¼‰</span>
        <span class="hljs-type">OrderPO</span> <span class="hljs-variable">existingOrder</span> <span class="hljs-operator">=</span> orderMapper.selectByOrderNo(idempotentKey);
        <span class="hljs-keyword">if</span> (existingOrder != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å›å†™Redis</span>
            redisTemplate.opsForValue().set(
                redisKey, 
                existingOrder.getId().toString(), 
                EXPIRE_SECONDS, 
                TimeUnit.SECONDS
            );
            <span class="hljs-keyword">return</span> existingOrder.getId();
        }
        
        <span class="hljs-comment">// 3. åˆ›å»ºè®¢å•</span>
        <span class="hljs-type">OrderPO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderPO</span>();
        order.setOrderNo(idempotentKey); <span class="hljs-comment">// ä½¿ç”¨å¹‚ç­‰æ€§keyä½œä¸ºè®¢å•å·</span>
        order.setUserId(param.getUserId());
        order.setAmount(param.getAmount());
        orderMapper.insert(order);
        
        <span class="hljs-comment">// 4. å†™å…¥Redis</span>
        redisTemplate.opsForValue().set(
            redisKey, 
            order.getId().toString(), 
            EXPIRE_SECONDS, 
            TimeUnit.SECONDS
        );
        
        log.info(<span class="hljs-string">"è®¢å•åˆ›å»ºæˆåŠŸï¼šorderId={}, orderNo={}"</span>, order.getId(), idempotentKey);
        <span class="hljs-keyword">return</span> order.getId();
    }
}
</code></pre>
<p><strong>å¹‚ç­‰æ€§æ³¨è§£å®ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.lang.annotation.ElementType;
<span class="hljs-keyword">import</span> java.lang.annotation.Retention;
<span class="hljs-keyword">import</span> java.lang.annotation.RetentionPolicy;
<span class="hljs-keyword">import</span> java.lang.annotation.Target;

<span class="hljs-comment">/**
 * å¹‚ç­‰æ€§æ³¨è§£
 */</span>
<span class="hljs-meta">@Target(ElementType.METHOD)</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Idempotent {
    <span class="hljs-comment">/**
     * å¹‚ç­‰æ€§keyçš„ç”Ÿæˆç­–ç•¥
     */</span>
    String <span class="hljs-title function_">keyGenerator</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">"default"</span>;
    
    <span class="hljs-comment">/**
     * è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
     */</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">expireSeconds</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">300</span>;
}

<span class="hljs-comment">/**
 * å¹‚ç­‰æ€§åˆ‡é¢
 */</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdempotentAspect</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-meta">@Around("@annotation(idempotent)")</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint joinPoint, Idempotent idempotent)</span> <span class="hljs-keyword">throws</span> Throwable {
        <span class="hljs-comment">// ç”Ÿæˆå¹‚ç­‰æ€§key</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">idempotentKey</span> <span class="hljs-operator">=</span> generateKey(joinPoint, idempotent);
        <span class="hljs-type">String</span> <span class="hljs-variable">redisKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"idempotent:"</span> + idempotentKey;
        
        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦å·²æ‰§è¡Œ</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(redisKey);
        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(result)) {
            <span class="hljs-comment">// å·²æ‰§è¡Œï¼Œè¿”å›ç¼“å­˜ç»“æœ</span>
            <span class="hljs-keyword">return</span> JSON.parseObject(result, getReturnType(joinPoint));
        }
        
        <span class="hljs-comment">// æ‰§è¡Œæ–¹æ³•</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">returnValue</span> <span class="hljs-operator">=</span> joinPoint.proceed();
        
        <span class="hljs-comment">// ç¼“å­˜ç»“æœ</span>
        redisTemplate.opsForValue().set(
            redisKey, 
            JSON.toJSONString(returnValue), 
            idempotent.expireSeconds(), 
            TimeUnit.SECONDS
        );
        
        <span class="hljs-keyword">return</span> returnValue;
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-meta">@Idempotent(keyGenerator = "orderNo", expireSeconds = 600)</span>
<span class="hljs-keyword">public</span> OrderDTO <span class="hljs-title function_">createOrder</span><span class="hljs-params">(CreateOrderParam param)</span> {
    <span class="hljs-comment">// åˆ›å»ºè®¢å•é€»è¾‘</span>
}
</code></pre>
<h4 data-id="heading-24">4.2 æ•°æ®åº“å±‚é˜²å¹¶å‘</h4>
<h5 data-id="heading-25">4.2.1 æ‚²è§‚é”ï¼ˆSELECT FOR UPDATEï¼‰</h5>
<p><strong>MyBatiså®ç°ï¼š</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- OrderMapper.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectByIdForUpdate"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"OrderPO"</span>&gt;</span>
    SELECT * FROM t_order 
    WHERE id = #{id} 
    FOR UPDATE
<span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateStock"</span>&gt;</span>
    UPDATE t_product 
    SET stock = stock - #{quantity}
    WHERE id = #{productId} 
    AND stock &gt;= #{quantity}
<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
</code></pre>
<p><strong>Serviceå±‚ä½¿ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä½¿ç”¨æ‚²è§‚é”æ‰£å‡åº“å­˜
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨SELECT FOR UPDATEä¿è¯æ•°æ®ä¸€è‡´æ€§
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x + MyBatis
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ProductMapper productMapper;
    
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductStock</span><span class="hljs-params">(Long productId, Integer quantity)</span> {
        <span class="hljs-comment">// 1. ä½¿ç”¨æ‚²è§‚é”æŸ¥è¯¢å•†å“</span>
        <span class="hljs-type">ProductPO</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productMapper.selectByIdForUpdate(productId);
        <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.DATA_NOT_FOUND.code(), <span class="hljs-string">"å•†å“ä¸å­˜åœ¨"</span>);
        }
        
        <span class="hljs-comment">// 2. æ£€æŸ¥åº“å­˜</span>
        <span class="hljs-keyword">if</span> (product.getStock() &lt; quantity) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), <span class="hljs-string">"åº“å­˜ä¸è¶³"</span>);
        }
        
        <span class="hljs-comment">// 3. æ‰£å‡åº“å­˜</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">updateCount</span> <span class="hljs-operator">=</span> productMapper.updateStock(productId, quantity);
        <span class="hljs-keyword">if</span> (updateCount == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), <span class="hljs-string">"åº“å­˜æ‰£å‡å¤±è´¥"</span>);
        }
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h5 data-id="heading-26">4.2.2 ä¹è§‚é”ï¼ˆç‰ˆæœ¬å·æ§åˆ¶ï¼‰</h5>
<p><strong>æ•°æ®åº“è¡¨è®¾è®¡ï¼š</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t_order (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    order_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">UNIQUE</span>,
    user_id <span class="hljs-type">BIGINT</span>,
    amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>),
    status <span class="hljs-type">INT</span>,
    version <span class="hljs-type">INT</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,  <span class="hljs-comment">-- ç‰ˆæœ¬å·å­—æ®µ</span>
    create_time DATETIME,
    update_time DATETIME
);
</code></pre>
<p><strong>MyBatiså®ç°ï¼š</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- OrderMapper.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateWithVersion"</span>&gt;</span>
    UPDATE t_order 
    SET 
        status = #{status},
        version = version + 1,
        update_time = NOW()
    WHERE id = #{id} 
    AND version = #{version}
<span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
</code></pre>
<p><strong>Serviceå±‚ä½¿ç”¨ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä½¿ç”¨ä¹è§‚é”æ›´æ–°è®¢å•çŠ¶æ€
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨ç‰ˆæœ¬å·æ§åˆ¶ï¼Œå¤±è´¥æ—¶é‡è¯•
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-comment">/**
     * æ›´æ–°è®¢å•çŠ¶æ€ï¼ˆä¹è§‚é”ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">updateOrderStatus</span><span class="hljs-params">(Long orderId, Integer newStatus)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        
        <span class="hljs-keyword">while</span> (retryCount &lt; maxRetries) {
            <span class="hljs-comment">// 1. æŸ¥è¯¢è®¢å•ï¼ˆå¸¦ç‰ˆæœ¬å·ï¼‰</span>
            <span class="hljs-type">OrderPO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.selectById(orderId);
            <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.DATA_NOT_FOUND.code(), <span class="hljs-string">"è®¢å•ä¸å­˜åœ¨"</span>);
            }
            
            <span class="hljs-comment">// 2. ä½¿ç”¨ä¹è§‚é”æ›´æ–°</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">updateCount</span> <span class="hljs-operator">=</span> orderMapper.updateWithVersion(
                orderId, 
                newStatus, 
                order.getVersion()
            );
            
            <span class="hljs-keyword">if</span> (updateCount &gt; <span class="hljs-number">0</span>) {
                log.info(<span class="hljs-string">"è®¢å•çŠ¶æ€æ›´æ–°æˆåŠŸï¼šorderId={}, newStatus={}"</span>, orderId, newStatus);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
            
            <span class="hljs-comment">// 3. æ›´æ–°å¤±è´¥ï¼Œç‰ˆæœ¬å†²çªï¼Œé‡è¯•</span>
            retryCount++;
            log.warn(<span class="hljs-string">"è®¢å•çŠ¶æ€æ›´æ–°å¤±è´¥ï¼ˆç‰ˆæœ¬å†²çªï¼‰ï¼Œé‡è¯•ï¼šorderId={}, retryCount={}"</span>, 
                orderId, retryCount);
            
            <span class="hljs-keyword">try</span> {
                Thread.sleep(<span class="hljs-number">100</span>); <span class="hljs-comment">// ç­‰å¾…100msåé‡è¯•</span>
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
                <span class="hljs-keyword">break</span>;
            }
        }
        
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
            <span class="hljs-string">"è®¢å•çŠ¶æ€æ›´æ–°å¤±è´¥ï¼Œè¯·é‡è¯•"</span>);
    }
}
</code></pre>
<h5 data-id="heading-27">4.2.3 å”¯ä¸€ç´¢å¼•é˜²é‡å¤</h5>
<p><strong>æ•°æ®åº“è®¾è®¡ï¼š</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- é˜²æ­¢é‡å¤è®¢å•</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX uk_order_user_product <span class="hljs-keyword">ON</span> t_order(user_id, product_id, status);

<span class="hljs-comment">-- é˜²æ­¢é‡å¤æ”¯ä»˜</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">UNIQUE</span> INDEX uk_payment_order <span class="hljs-keyword">ON</span> t_payment(order_id, status);
</code></pre>
<p><strong>Serviceå±‚å¤„ç†ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ä½¿ç”¨å”¯ä¸€ç´¢å¼•é˜²æ­¢é‡å¤æ•°æ®
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šæ•°æ®åº“å”¯ä¸€ç´¢å¼• + å¼‚å¸¸å¤„ç†
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">createOrder</span><span class="hljs-params">(CreateOrderParam param)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">OrderPO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderPO</span>();
            order.setUserId(param.getUserId());
            order.setProductId(param.getProductId());
            order.setStatus(OrderStatusEnum.PENDING.getCode());
            orderMapper.insert(order);
            <span class="hljs-keyword">return</span> order.getId();
            
        } <span class="hljs-keyword">catch</span> (DuplicateKeyException e) {
            <span class="hljs-comment">// å”¯ä¸€ç´¢å¼•å†²çªï¼Œè¯´æ˜è®¢å•å·²å­˜åœ¨</span>
            log.warn(<span class="hljs-string">"è®¢å•å·²å­˜åœ¨ï¼šuserId={}, productId={}"</span>, 
                param.getUserId(), param.getProductId());
            
            <span class="hljs-comment">// æŸ¥è¯¢å·²å­˜åœ¨çš„è®¢å•</span>
            <span class="hljs-type">OrderPO</span> <span class="hljs-variable">existingOrder</span> <span class="hljs-operator">=</span> orderMapper.selectByUserIdAndProductId(
                param.getUserId(), 
                param.getProductId()
            );
            
            <span class="hljs-keyword">if</span> (existingOrder != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> existingOrder.getId();
            }
            
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.RECORD_EXISTED.code(), 
                <span class="hljs-string">"è®¢å•å·²å­˜åœ¨"</span>);
        }
    }
}
</code></pre>
<h4 data-id="heading-28">4.3 é™æµæ–¹æ¡ˆ</h4>
<h5 data-id="heading-29">4.3.1 åŸºäºRedisçš„é™æµ</h5>
<p><strong>ä»¤ç‰Œæ¡¶ç®—æ³•å®ç°ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;
<span class="hljs-keyword">import</span> org.springframework.data.redis.core.script.DefaultRedisScript;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.util.Collections;

<span class="hljs-comment">/**
 * Redisé™æµå·¥å…·ç±»ï¼ˆä»¤ç‰Œæ¡¶ç®—æ³•ï¼‰
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RateLimiterUtil</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOKEN_BUCKET_SCRIPT</span> <span class="hljs-operator">=</span> 
        <span class="hljs-string">"local key = KEYS[1] "</span> +
        <span class="hljs-string">"local capacity = tonumber(ARGV[1]) "</span> +
        <span class="hljs-string">"local tokens = tonumber(ARGV[2]) "</span> +
        <span class="hljs-string">"local interval = tonumber(ARGV[3]) "</span> +
        <span class="hljs-string">"local now = tonumber(ARGV[4]) "</span> +
        <span class="hljs-string">" "</span> +
        <span class="hljs-string">"local bucket = redis.call('HMGET', key, 'tokens', 'lastRefill') "</span> +
        <span class="hljs-string">"local currentTokens = tonumber(bucket[1]) or capacity "</span> +
        <span class="hljs-string">"local lastRefill = tonumber(bucket[2]) or now "</span> +
        <span class="hljs-string">" "</span> +
        <span class="hljs-string">"local elapsed = now - lastRefill "</span> +
        <span class="hljs-string">"local tokensToAdd = math.floor(elapsed / interval) "</span> +
        <span class="hljs-string">"currentTokens = math.min(capacity, currentTokens + tokensToAdd) "</span> +
        <span class="hljs-string">" "</span> +
        <span class="hljs-string">"if currentTokens &gt;= tokens then "</span> +
        <span class="hljs-string">"    currentTokens = currentTokens - tokens "</span> +
        <span class="hljs-string">"    redis.call('HMSET', key, 'tokens', currentTokens, 'lastRefill', now) "</span> +
        <span class="hljs-string">"    redis.call('EXPIRE', key, 3600) "</span> +
        <span class="hljs-string">"    return 1 "</span> +
        <span class="hljs-string">"else "</span> +
        <span class="hljs-string">"    redis.call('HMSET', key, 'tokens', currentTokens, 'lastRefill', now) "</span> +
        <span class="hljs-string">"    redis.call('EXPIRE', key, 3600) "</span> +
        <span class="hljs-string">"    return 0 "</span> +
        <span class="hljs-string">"end"</span>;
    
    <span class="hljs-comment">/**
     * é™æµæ£€æŸ¥ï¼ˆä»¤ç‰Œæ¡¶ç®—æ³•ï¼‰
     * <span class="hljs-doctag">@param</span> key é™æµkey
     * <span class="hljs-doctag">@param</span> capacity æ¡¶å®¹é‡
     * <span class="hljs-doctag">@param</span> tokens éœ€è¦çš„ä»¤ç‰Œæ•°
     * <span class="hljs-doctag">@param</span> interval ä»¤ç‰Œç”Ÿæˆé—´éš”ï¼ˆæ¯«ç§’ï¼‰
     * <span class="hljs-doctag">@return</span> æ˜¯å¦å…è®¸é€šè¿‡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(String key, <span class="hljs-type">int</span> capacity, <span class="hljs-type">int</span> tokens, <span class="hljs-type">long</span> interval)</span> {
        DefaultRedisScript&lt;Long&gt; script = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();
        script.setScriptText(TOKEN_BUCKET_SCRIPT);
        script.setResultType(Long.class);
        
        <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> redisTemplate.execute(
            script,
            Collections.singletonList(key),
            String.valueOf(capacity),
            String.valueOf(tokens),
            String.valueOf(interval),
            String.valueOf(now)
        );
        
        <span class="hljs-keyword">return</span> result != <span class="hljs-literal">null</span> &amp;&amp; result == <span class="hljs-number">1</span>;
    }
}
</code></pre>
<p><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * é™æµä½¿ç”¨ç¤ºä¾‹
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RateLimiterUtil rateLimiterUtil;
    
    <span class="hljs-keyword">public</span> OrderDTO <span class="hljs-title function_">createOrder</span><span class="hljs-params">(CreateOrderParam param)</span> {
        <span class="hljs-comment">// é™æµï¼šæ¯ä¸ªç”¨æˆ·æ¯ç§’æœ€å¤šåˆ›å»º1ä¸ªè®¢å•</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">limitKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"rate:limit:order:create:"</span> + param.getUserId();
        <span class="hljs-keyword">if</span> (!rateLimiterUtil.tryAcquire(limitKey, <span class="hljs-number">10</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1000</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
                <span class="hljs-string">"è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"</span>);
        }
        
        <span class="hljs-comment">// åˆ›å»ºè®¢å•é€»è¾‘</span>
        <span class="hljs-keyword">return</span> doCreateOrder(param);
    }
}
</code></pre>
<h5 data-id="heading-30">4.3.2 æ»‘åŠ¨çª—å£é™æµ</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ»‘åŠ¨çª—å£é™æµ
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SlidingWindowRateLimiter</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StringRedisTemplate redisTemplate;
    
    <span class="hljs-comment">/**
     * æ»‘åŠ¨çª—å£é™æµ
     * <span class="hljs-doctag">@param</span> key é™æµkey
     * <span class="hljs-doctag">@param</span> windowSize çª—å£å¤§å°ï¼ˆç§’ï¼‰
     * <span class="hljs-doctag">@param</span> maxRequests æœ€å¤§è¯·æ±‚æ•°
     * <span class="hljs-doctag">@return</span> æ˜¯å¦å…è®¸é€šè¿‡
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryAcquire</span><span class="hljs-params">(String key, <span class="hljs-type">int</span> windowSize, <span class="hljs-type">int</span> maxRequests)</span> {
        <span class="hljs-type">long</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> System.currentTimeMillis();
        <span class="hljs-type">long</span> <span class="hljs-variable">windowStart</span> <span class="hljs-operator">=</span> now - windowSize * <span class="hljs-number">1000</span>;
        
        <span class="hljs-comment">// ä½¿ç”¨ZSetå­˜å‚¨è¯·æ±‚æ—¶é—´æˆ³</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">zsetKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"rate:limit:sliding:"</span> + key;
        
        <span class="hljs-comment">// ç§»é™¤çª—å£å¤–çš„æ•°æ®</span>
        redisTemplate.opsForZSet().removeRangeByScore(zsetKey, <span class="hljs-number">0</span>, windowStart);
        
        <span class="hljs-comment">// è·å–å½“å‰çª—å£å†…çš„è¯·æ±‚æ•°</span>
        <span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> redisTemplate.opsForZSet().count(zsetKey, windowStart, now);
        
        <span class="hljs-keyword">if</span> (count != <span class="hljs-literal">null</span> &amp;&amp; count &gt;= maxRequests) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        
        <span class="hljs-comment">// æ·»åŠ å½“å‰è¯·æ±‚</span>
        redisTemplate.opsForZSet().add(zsetKey, String.valueOf(now), now);
        redisTemplate.expire(zsetKey, windowSize + <span class="hljs-number">1</span>, TimeUnit.SECONDS);
        
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h4 data-id="heading-31">4.4 é˜Ÿåˆ—å‰Šå³°æ–¹æ¡ˆ</h4>
<h5 data-id="heading-32">4.4.1 å¼‚æ­¥é˜Ÿåˆ—å¤„ç†</h5>
<p><strong>ä½¿ç”¨çº¿ç¨‹æ±  + é˜Ÿåˆ—ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.util.concurrent.BlockingQueue;
<span class="hljs-keyword">import</span> java.util.concurrent.LinkedBlockingQueue;

<span class="hljs-comment">/**
 * è®¢å•é˜Ÿåˆ—å¤„ç†
 * ã€è§„èŒƒæ ¡éªŒã€‘ï¼šä½¿ç”¨é˜Ÿåˆ—å‰Šå³°ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½
 * ã€ç‰ˆæœ¬å…¼å®¹ã€‘ï¼šSpringBoot 2.x
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderQueueProcessor</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ThreadPoolTaskExecutor orderExecutor;
    
    <span class="hljs-comment">// è®¢å•é˜Ÿåˆ—</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BlockingQueue&lt;CreateOrderParam&gt; orderQueue = 
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="hljs-number">10000</span>);
    
    <span class="hljs-comment">/**
     * æäº¤è®¢å•åˆ°é˜Ÿåˆ—
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">submitOrder</span><span class="hljs-params">(CreateOrderParam param)</span> {
        <span class="hljs-keyword">if</span> (!orderQueue.offer(param)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
                <span class="hljs-string">"ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åå†è¯•"</span>);
        }
        
        <span class="hljs-comment">// å¼‚æ­¥å¤„ç†</span>
        orderExecutor.execute(() -&gt; processOrderQueue());
    }
    
    <span class="hljs-comment">/**
     * å¤„ç†è®¢å•é˜Ÿåˆ—
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrderQueue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">while</span> (!orderQueue.isEmpty()) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">CreateOrderParam</span> <span class="hljs-variable">param</span> <span class="hljs-operator">=</span> orderQueue.poll();
                <span class="hljs-keyword">if</span> (param != <span class="hljs-literal">null</span>) {
                    orderService.createOrder(param);
                }
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"è®¢å•å¤„ç†å¤±è´¥"</span>, e);
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-33">äº”ã€Cç«¯/Bç«¯å…¸å‹åœºæ™¯å®æˆ˜</h3>
<h4 data-id="heading-34">5.1 Cç«¯åœºæ™¯ï¼šç§’æ€æŠ¢è´­</h4>
<p><strong>å®Œæ•´æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * ç§’æ€æœåŠ¡
 * ã€åœºæ™¯è¯†åˆ«ã€‘ï¼šé«˜å¹¶å‘ç§’æ€åœºæ™¯
 * ã€é˜²å¹¶å‘ç­–ç•¥ã€‘ï¼šé™æµ + åˆ†å¸ƒå¼é” + æ•°æ®åº“ä¹è§‚é” + é˜Ÿåˆ—å‰Šå³°
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RateLimiterUtil rateLimiterUtil;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DistributedLockUtil distributedLockUtil;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ProductMapper productMapper;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService orderService;
    
    <span class="hljs-comment">/**
     * ç§’æ€ä¸‹å•
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> SeckillResult <span class="hljs-title function_">seckill</span><span class="hljs-params">(Long userId, Long productId)</span> {
        <span class="hljs-comment">// 1. é™æµï¼šæ¯ä¸ªç”¨æˆ·æ¯ç§’æœ€å¤š1æ¬¡è¯·æ±‚</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">limitKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:limit:"</span> + userId;
        <span class="hljs-keyword">if</span> (!rateLimiterUtil.tryAcquire(limitKey, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1000</span>)) {
            <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"</span>);
        }
        
        <span class="hljs-comment">// 2. åˆ†å¸ƒå¼é”ï¼šé˜²æ­¢åŒä¸€ç”¨æˆ·é‡å¤ä¸‹å•</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:lock:"</span> + userId + <span class="hljs-string">":"</span> + productId;
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-keyword">if</span> (!distributedLockUtil.tryLock(lockKey, lockValue, <span class="hljs-number">10</span>)) {
            <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤"</span>);
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 3. æ£€æŸ¥å•†å“åº“å­˜ï¼ˆä½¿ç”¨ä¹è§‚é”ï¼‰</span>
            <span class="hljs-type">ProductPO</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productMapper.selectById(productId);
            <span class="hljs-keyword">if</span> (product == <span class="hljs-literal">null</span> || product.getStock() &lt;= <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"å•†å“å·²å”®ç½„"</span>);
            }
            
            <span class="hljs-comment">// 4. æ‰£å‡åº“å­˜ï¼ˆä¹è§‚é”ï¼‰</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">updateCount</span> <span class="hljs-operator">=</span> productMapper.updateStockWithVersion(
                productId, <span class="hljs-number">1</span>, product.getVersion());
            <span class="hljs-keyword">if</span> (updateCount == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"åº“å­˜ä¸è¶³ï¼Œè¯·é‡è¯•"</span>);
            }
            
            <span class="hljs-comment">// 5. åˆ›å»ºè®¢å•ï¼ˆå¹‚ç­‰æ€§ä¿è¯ï¼‰</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">orderNo</span> <span class="hljs-operator">=</span> generateOrderNo(userId, productId);
            <span class="hljs-type">Long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> orderService.createOrderIdempotent(
                buildOrderParam(userId, productId), 
                orderNo
            );
            
            <span class="hljs-keyword">return</span> SeckillResult.success(orderId);
            
        } <span class="hljs-keyword">finally</span> {
            distributedLockUtil.releaseLock(lockKey, lockValue);
        }
    }
}
</code></pre>
<h4 data-id="heading-35">5.2 Bç«¯åœºæ™¯ï¼šæ‰¹é‡å¯¼å…¥</h4>
<p><strong>å®Œæ•´æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ‰¹é‡å¯¼å…¥æœåŠ¡
 * ã€åœºæ™¯è¯†åˆ«ã€‘ï¼šBç«¯æ‰¹é‡æ•°æ®å¯¼å…¥
 * ã€é˜²å¹¶å‘ç­–ç•¥ã€‘ï¼šåˆ†å¸ƒå¼é” + å”¯ä¸€ç´¢å¼• + å¹‚ç­‰æ€§
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BatchImportService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DistributedLockUtil distributedLockUtil;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ImportRecordMapper importRecordMapper;
    
    <span class="hljs-comment">/**
     * æ‰¹é‡å¯¼å…¥æ•°æ®
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> ImportResult <span class="hljs-title function_">batchImport</span><span class="hljs-params">(Long userId, List&lt;ImportData&gt; dataList, String importBatchNo)</span> {
        <span class="hljs-comment">// 1. åˆ†å¸ƒå¼é”ï¼šé˜²æ­¢é‡å¤å¯¼å…¥</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"import:lock:"</span> + importBatchNo;
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-keyword">if</span> (!distributedLockUtil.tryLock(lockKey, lockValue, <span class="hljs-number">300</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
                <span class="hljs-string">"å¯¼å…¥ä»»åŠ¡æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤"</span>);
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. æ£€æŸ¥å¯¼å…¥è®°å½•æ˜¯å¦å·²å­˜åœ¨ï¼ˆå¹‚ç­‰æ€§ï¼‰</span>
            <span class="hljs-type">ImportRecordPO</span> <span class="hljs-variable">existingRecord</span> <span class="hljs-operator">=</span> importRecordMapper.selectByBatchNo(importBatchNo);
            <span class="hljs-keyword">if</span> (existingRecord != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> ImportResult.existing(existingRecord.getId());
            }
            
            <span class="hljs-comment">// 3. åˆ›å»ºå¯¼å…¥è®°å½•</span>
            <span class="hljs-type">ImportRecordPO</span> <span class="hljs-variable">record</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImportRecordPO</span>();
            record.setBatchNo(importBatchNo);
            record.setUserId(userId);
            record.setStatus(ImportStatusEnum.PROCESSING.getCode());
            importRecordMapper.insert(record);
            
            <span class="hljs-comment">// 4. æ‰¹é‡å¯¼å…¥æ•°æ®ï¼ˆä½¿ç”¨å”¯ä¸€ç´¢å¼•é˜²æ­¢é‡å¤ï¼‰</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">successCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-type">int</span> <span class="hljs-variable">failCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            
            <span class="hljs-keyword">for</span> (ImportData data : dataList) {
                <span class="hljs-keyword">try</span> {
                    importData(data, importBatchNo);
                    successCount++;
                } <span class="hljs-keyword">catch</span> (DuplicateKeyException e) {
                    <span class="hljs-comment">// å”¯ä¸€ç´¢å¼•å†²çªï¼Œæ•°æ®å·²å­˜åœ¨ï¼Œè·³è¿‡</span>
                    log.warn(<span class="hljs-string">"æ•°æ®å·²å­˜åœ¨ï¼Œè·³è¿‡ï¼š{}"</span>, data);
                    successCount++;
                } <span class="hljs-keyword">catch</span> (Exception e) {
                    log.error(<span class="hljs-string">"æ•°æ®å¯¼å…¥å¤±è´¥"</span>, e);
                    failCount++;
                }
            }
            
            <span class="hljs-comment">// 5. æ›´æ–°å¯¼å…¥è®°å½•</span>
            record.setStatus(ImportStatusEnum.COMPLETED.getCode());
            record.setSuccessCount(successCount);
            record.setFailCount(failCount);
            importRecordMapper.updateById(record);
            
            <span class="hljs-keyword">return</span> ImportResult.success(record.getId(), successCount, failCount);
            
        } <span class="hljs-keyword">finally</span> {
            distributedLockUtil.releaseLock(lockKey, lockValue);
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">importData</span><span class="hljs-params">(ImportData data, String importBatchNo)</span> {
        <span class="hljs-comment">// å¯¼å…¥é€»è¾‘ï¼ˆæ•°æ®åº“å”¯ä¸€ç´¢å¼•ä¿è¯ä¸é‡å¤ï¼‰</span>
        <span class="hljs-type">DataPO</span> <span class="hljs-variable">dataPO</span> <span class="hljs-operator">=</span> convertToPO(data);
        dataPO.setImportBatchNo(importBatchNo);
        dataMapper.insert(dataPO);
    }
}
</code></pre>
<h4 data-id="heading-36">5.3 æ”¯ä»˜åœºæ™¯ï¼šé˜²æ­¢é‡å¤æ”¯ä»˜</h4>
<p><strong>å®Œæ•´æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æ”¯ä»˜æœåŠ¡
 * ã€åœºæ™¯è¯†åˆ«ã€‘ï¼šæ”¯ä»˜é˜²é‡å¤
 * ã€é˜²å¹¶å‘ç­–ç•¥ã€‘ï¼šå¹‚ç­‰æ€§ + åˆ†å¸ƒå¼é” + çŠ¶æ€æœº
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> DistributedLockUtil distributedLockUtil;
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PaymentMapper paymentMapper;
    
    <span class="hljs-comment">/**
     * åˆ›å»ºæ”¯ä»˜è®¢å•ï¼ˆé˜²é‡å¤ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> PaymentDTO <span class="hljs-title function_">createPayment</span><span class="hljs-params">(CreatePaymentParam param)</span> {
        <span class="hljs-comment">// 1. å¹‚ç­‰æ€§æ£€æŸ¥ï¼šä½¿ç”¨è®¢å•IDä½œä¸ºå¹‚ç­‰æ€§key</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">idempotentKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"payment:"</span> + param.getOrderId();
        <span class="hljs-type">PaymentPO</span> <span class="hljs-variable">existingPayment</span> <span class="hljs-operator">=</span> paymentMapper.selectByOrderId(param.getOrderId());
        <span class="hljs-keyword">if</span> (existingPayment != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// æ”¯ä»˜è®¢å•å·²å­˜åœ¨ï¼Œè¿”å›å·²æœ‰è®¢å•</span>
            <span class="hljs-keyword">return</span> convertToDTO(existingPayment);
        }
        
        <span class="hljs-comment">// 2. åˆ†å¸ƒå¼é”ï¼šé˜²æ­¢å¹¶å‘åˆ›å»º</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"payment:lock:"</span> + param.getOrderId();
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-keyword">if</span> (!distributedLockUtil.tryLock(lockKey, lockValue, <span class="hljs-number">30</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
                <span class="hljs-string">"æ”¯ä»˜è®¢å•åˆ›å»ºä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤"</span>);
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 3. åŒé‡æ£€æŸ¥</span>
            existingPayment = paymentMapper.selectByOrderId(param.getOrderId());
            <span class="hljs-keyword">if</span> (existingPayment != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> convertToDTO(existingPayment);
            }
            
            <span class="hljs-comment">// 4. åˆ›å»ºæ”¯ä»˜è®¢å•</span>
            <span class="hljs-type">PaymentPO</span> <span class="hljs-variable">payment</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PaymentPO</span>();
            payment.setOrderId(param.getOrderId());
            payment.setAmount(param.getAmount());
            payment.setStatus(PaymentStatusEnum.PENDING.getCode());
            payment.setPaymentNo(generatePaymentNo());
            paymentMapper.insert(payment);
            
            <span class="hljs-keyword">return</span> convertToDTO(payment);
            
        } <span class="hljs-keyword">finally</span> {
            distributedLockUtil.releaseLock(lockKey, lockValue);
        }
    }
    
    <span class="hljs-comment">/**
     * æ”¯ä»˜å›è°ƒå¤„ç†ï¼ˆé˜²é‡å¤ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handlePaymentCallback</span><span class="hljs-params">(String paymentNo, String thirdPartyPaymentNo)</span> {
        <span class="hljs-comment">// 1. æŸ¥è¯¢æ”¯ä»˜è®¢å•</span>
        <span class="hljs-type">PaymentPO</span> <span class="hljs-variable">payment</span> <span class="hljs-operator">=</span> paymentMapper.selectByPaymentNo(paymentNo);
        <span class="hljs-keyword">if</span> (payment == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.DATA_NOT_FOUND.code(), <span class="hljs-string">"æ”¯ä»˜è®¢å•ä¸å­˜åœ¨"</span>);
        }
        
        <span class="hljs-comment">// 2. çŠ¶æ€æ£€æŸ¥ï¼šåªæœ‰å¾…æ”¯ä»˜çŠ¶æ€æ‰èƒ½å¤„ç†</span>
        <span class="hljs-keyword">if</span> (payment.getStatus() != PaymentStatusEnum.PENDING.getCode()) {
            log.warn(<span class="hljs-string">"æ”¯ä»˜è®¢å•çŠ¶æ€å¼‚å¸¸ï¼Œè·³è¿‡å¤„ç†ï¼špaymentNo={}, status={}"</span>, 
                paymentNo, payment.getStatus());
            <span class="hljs-keyword">return</span>; <span class="hljs-comment">// å·²å¤„ç†ï¼Œç›´æ¥è¿”å›ï¼ˆå¹‚ç­‰æ€§ï¼‰</span>
        }
        
        <span class="hljs-comment">// 3. åˆ†å¸ƒå¼é”ï¼šé˜²æ­¢å¹¶å‘å¤„ç†</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"payment:callback:lock:"</span> + paymentNo;
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-keyword">if</span> (!distributedLockUtil.tryLock(lockKey, lockValue, <span class="hljs-number">30</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceException</span>(CommonCode.SERVICE_ERROR.code(), 
                <span class="hljs-string">"æ”¯ä»˜å›è°ƒå¤„ç†ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤"</span>);
        }
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 4. åŒé‡æ£€æŸ¥çŠ¶æ€</span>
            payment = paymentMapper.selectByIdForUpdate(payment.getId());
            <span class="hljs-keyword">if</span> (payment.getStatus() != PaymentStatusEnum.PENDING.getCode()) {
                <span class="hljs-keyword">return</span>; <span class="hljs-comment">// å·²å¤„ç†</span>
            }
            
            <span class="hljs-comment">// 5. æ›´æ–°æ”¯ä»˜çŠ¶æ€ï¼ˆä¹è§‚é”ï¼‰</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">updateCount</span> <span class="hljs-operator">=</span> paymentMapper.updateStatusWithVersion(
                payment.getId(),
                PaymentStatusEnum.SUCCESS.getCode(),
                payment.getVersion()
            );
            
            <span class="hljs-keyword">if</span> (updateCount &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// 6. æ›´æ–°è®¢å•çŠ¶æ€</span>
                orderService.updateOrderStatus(payment.getOrderId(), OrderStatusEnum.PAID.getCode());
                log.info(<span class="hljs-string">"æ”¯ä»˜å›è°ƒå¤„ç†æˆåŠŸï¼špaymentNo={}"</span>, paymentNo);
            }
            
        } <span class="hljs-keyword">finally</span> {
            distributedLockUtil.releaseLock(lockKey, lockValue);
        }
    }
}
</code></pre>
<h3 data-id="heading-37">å…­ã€æœ€ä½³å®è·µæ€»ç»“</h3>
<h4 data-id="heading-38">6.1 æ–¹æ¡ˆé€‰æ‹©æŒ‡å—</h4>


















































<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>ç†ç”±</th></tr></thead><tbody><tr><td><strong>å‰ç«¯é˜²é‡å¤æäº¤</strong></td><td>æŒ‰é’®ç¦ç”¨ + è¯·æ±‚å»é‡</td><td>ç”¨æˆ·ä½“éªŒå¥½ï¼Œå®ç°ç®€å•</td></tr><tr><td><strong>å•æœºåº”ç”¨</strong></td><td>æœ¬åœ°é”ï¼ˆsynchronized/ReentrantLockï¼‰</td><td>æ€§èƒ½å¥½ï¼Œæ— ç½‘ç»œå¼€é”€</td></tr><tr><td><strong>åˆ†å¸ƒå¼åº”ç”¨</strong></td><td>åˆ†å¸ƒå¼é”ï¼ˆRedisï¼‰</td><td>æ”¯æŒé›†ç¾¤éƒ¨ç½²</td></tr><tr><td><strong>é«˜å¹¶å‘è¯»å¤šå†™å°‘</strong></td><td>ä¹è§‚é” + ç‰ˆæœ¬å·</td><td>æ€§èƒ½å¥½ï¼Œæ— é”ç«äº‰</td></tr><tr><td><strong>é«˜å¹¶å‘å†™å¤š</strong></td><td>æ‚²è§‚é” + åˆ†å¸ƒå¼é”</td><td>ä¿è¯å¼ºä¸€è‡´æ€§</td></tr><tr><td><strong>å¹‚ç­‰æ€§è¦æ±‚</strong></td><td>å”¯ä¸€ç´¢å¼• + Rediså¹‚ç­‰æ€§key</td><td>åŒé‡ä¿éšœ</td></tr><tr><td><strong>é™æµéœ€æ±‚</strong></td><td>Redisä»¤ç‰Œæ¡¶/æ»‘åŠ¨çª—å£</td><td>é˜²æ­¢ç³»ç»Ÿè¿‡è½½</td></tr><tr><td><strong>å‰Šå³°éœ€æ±‚</strong></td><td>é˜Ÿåˆ— + å¼‚æ­¥å¤„ç†</td><td>å¹³æ»‘å¤„ç†è¯·æ±‚</td></tr></tbody></table>
<h4 data-id="heading-39">6.2 ç»„åˆä½¿ç”¨ç­–ç•¥</h4>
<p><strong>é«˜å¹¶å‘ç§’æ€åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs">å‰ç«¯ï¼šæŒ‰é’®ç¦ç”¨ + è¯·æ±‚å»é‡
  â†“
åç«¯ï¼šé™æµ â†’ åˆ†å¸ƒå¼é” â†’ ä¹è§‚é” â†’ å¹‚ç­‰æ€§
</code></pre>
<p><strong>æ‰¹é‡å¯¼å…¥åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs">å‰ç«¯ï¼šæ–‡ä»¶ä¸Šä¼ è¿›åº¦ + é˜²é‡å¤ä¸Šä¼ 
  â†“
åç«¯ï¼šåˆ†å¸ƒå¼é” â†’ å”¯ä¸€ç´¢å¼• â†’ å¹‚ç­‰æ€§
</code></pre>
<p><strong>æ”¯ä»˜åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs">å‰ç«¯ï¼šæ”¯ä»˜æŒ‰é’®ç¦ç”¨ + è¯·æ±‚ID
  â†“
åç«¯ï¼šå¹‚ç­‰æ€§ â†’ åˆ†å¸ƒå¼é” â†’ çŠ¶æ€æœº â†’ ä¹è§‚é”
</code></pre>
<h4 data-id="heading-40">6.3 æ³¨æ„äº‹é¡¹</h4>
<h5 data-id="heading-41">6.3.1 åˆ†å¸ƒå¼é”æ³¨æ„äº‹é¡¹</h5>
<ol>
<li><strong>é”çš„è¿‡æœŸæ—¶é—´</strong>ï¼šå¿…é¡»å¤§äºä¸šåŠ¡æ‰§è¡Œæ—¶é—´ï¼Œé¿å…é”æå‰é‡Šæ”¾</li>
<li><strong>é”çš„é‡Šæ”¾</strong>ï¼šå¿…é¡»ä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§ï¼Œé˜²æ­¢è¯¯åˆ å…¶ä»–å®ä¾‹çš„é”</li>
<li><strong>é”çš„é‡å…¥</strong>ï¼šå¦‚éœ€æ”¯æŒé‡å…¥ï¼Œä½¿ç”¨Redissonç­‰æ¡†æ¶</li>
<li><strong>æ­»é”é¢„é˜²</strong>ï¼šè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…æ­»é”</li>
</ol>
<h5 data-id="heading-42">6.3.2 å¹‚ç­‰æ€§æ³¨æ„äº‹é¡¹</h5>
<ol>
<li><strong>å¹‚ç­‰æ€§keyçš„é€‰æ‹©</strong>ï¼šä½¿ç”¨ä¸šåŠ¡å”¯ä¸€æ ‡è¯†ï¼ˆè®¢å•å·ã€ç”¨æˆ·ID+å•†å“IDç­‰ï¼‰</li>
<li><strong>è¿‡æœŸæ—¶é—´è®¾ç½®</strong>ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹ç‚¹è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´</li>
<li><strong>åŒé‡æ£€æŸ¥</strong>ï¼šRedisæ£€æŸ¥ + æ•°æ®åº“æ£€æŸ¥ï¼Œä¿è¯å¯é æ€§</li>
<li><strong>å¼‚å¸¸å¤„ç†</strong>ï¼šå¹‚ç­‰æ€§å¤±è´¥æ—¶çš„é™çº§ç­–ç•¥</li>
</ol>
<h5 data-id="heading-43">6.3.3 æ•°æ®åº“é”æ³¨æ„äº‹é¡¹</h5>
<ol>
<li><strong>æ‚²è§‚é”</strong>ï¼šå¿…é¡»åœ¨äº‹åŠ¡ä¸­ä½¿ç”¨ï¼Œé¿å…é•¿æ—¶é—´æŒæœ‰é”</li>
<li><strong>ä¹è§‚é”</strong>ï¼šå¤±è´¥æ—¶éœ€è¦é‡è¯•æœºåˆ¶</li>
<li><strong>å”¯ä¸€ç´¢å¼•</strong>ï¼šåˆç†è®¾è®¡ç´¢å¼•ï¼Œé¿å…æ€§èƒ½é—®é¢˜</li>
<li><strong>æ­»é”é¢„é˜²</strong>ï¼šæŒ‰ç›¸åŒé¡ºåºè·å–é”ï¼Œé¿å…æ­»é”</li>
</ol>
<h4 data-id="heading-44">6.4 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h4>
<ol>
<li><strong>é”çš„ç²’åº¦</strong>ï¼šå°½é‡ç¼©å°é”çš„èŒƒå›´ï¼Œæé«˜å¹¶å‘æ€§èƒ½</li>
<li><strong>é”çš„è¶…æ—¶</strong>ï¼šè®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…</li>
<li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šéå…³é”®è·¯å¾„ä½¿ç”¨å¼‚æ­¥å¤„ç†ï¼Œæé«˜å“åº”é€Ÿåº¦</li>
<li><strong>ç¼“å­˜ä¼˜åŒ–</strong>ï¼šåˆç†ä½¿ç”¨ç¼“å­˜ï¼Œå‡å°‘æ•°æ®åº“å‹åŠ›</li>
</ol>
<h3 data-id="heading-45">ä¸ƒã€æ€»ç»“</h3>
<h4 data-id="heading-46">7.1 æ ¸å¿ƒè¦ç‚¹</h4>
<ol>
<li><strong>å‰ç«¯é˜²å¹¶å‘</strong>ï¼šUIå±‚æ§åˆ¶ + è¯·æ±‚æ‹¦æˆªï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li>
<li><strong>åç«¯é˜²å¹¶å‘</strong>ï¼šåˆ†å¸ƒå¼é” + æ•°æ®åº“é” + å¹‚ç­‰æ€§ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§</li>
<li><strong>é™æµå‰Šå³°</strong>ï¼šé˜²æ­¢ç³»ç»Ÿè¿‡è½½ï¼Œä¿è¯ç³»ç»Ÿç¨³å®šæ€§</li>
<li><strong>ç»„åˆä½¿ç”¨</strong>ï¼šæ ¹æ®åœºæ™¯ç»„åˆå¤šç§æ–¹æ¡ˆï¼Œè¾¾åˆ°æœ€ä½³æ•ˆæœ</li>
</ol>
<h4 data-id="heading-47">7.2 æ–¹æ¡ˆå¯¹æ¯”</h4>















































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>å‰ç«¯é˜²é‡å¤</strong></td><td>å®ç°ç®€å•ã€ç”¨æˆ·ä½“éªŒå¥½</td><td>å¯è¢«ç»•è¿‡</td><td>æ‰€æœ‰åœºæ™¯ï¼ˆç¬¬ä¸€é“é˜²çº¿ï¼‰</td></tr><tr><td><strong>åˆ†å¸ƒå¼é”</strong></td><td>æ”¯æŒé›†ç¾¤ã€åŠŸèƒ½å¼ºå¤§</td><td>æœ‰ç½‘ç»œå¼€é”€ã€éœ€è€ƒè™‘æ­»é”</td><td>åˆ†å¸ƒå¼åº”ç”¨</td></tr><tr><td><strong>æ‚²è§‚é”</strong></td><td>å¼ºä¸€è‡´æ€§</td><td>æ€§èƒ½è¾ƒå·®ã€å¯èƒ½æ­»é”</td><td>å†™å¤šè¯»å°‘</td></tr><tr><td><strong>ä¹è§‚é”</strong></td><td>æ€§èƒ½å¥½ã€æ— é”ç«äº‰</td><td>éœ€è¦é‡è¯•æœºåˆ¶</td><td>è¯»å¤šå†™å°‘</td></tr><tr><td><strong>å¹‚ç­‰æ€§</strong></td><td>ä¿è¯ä¸é‡å¤æ‰§è¡Œ</td><td>éœ€è¦å­˜å‚¨ç©ºé—´</td><td>æ‰€æœ‰å†™æ“ä½œ</td></tr><tr><td><strong>é™æµ</strong></td><td>é˜²æ­¢ç³»ç»Ÿè¿‡è½½</td><td>å¯èƒ½æ‹’ç»æ­£å¸¸è¯·æ±‚</td><td>é«˜å¹¶å‘åœºæ™¯</td></tr></tbody></table>
<h4 data-id="heading-48">7.3 SpringBoot 2.x ç‰ˆæœ¬å…¼å®¹æ€§</h4>



































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>å…¼å®¹æ€§</th><th>æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td><strong>åˆ†å¸ƒå¼é”ï¼ˆRedisï¼‰</strong></td><td>âœ… å®Œå…¨å…¼å®¹</td><td>ä½¿ç”¨Spring Data Redis</td></tr><tr><td><strong>æ•°æ®åº“é”</strong></td><td>âœ… å®Œå…¨å…¼å®¹</td><td>MyBatisæ”¯æŒSELECT FOR UPDATE</td></tr><tr><td><strong>ä¹è§‚é”</strong></td><td>âœ… å®Œå…¨å…¼å®¹</td><td>éœ€è¦æ‰‹åŠ¨å®ç°ç‰ˆæœ¬å·æ§åˆ¶</td></tr><tr><td><strong>é™æµ</strong></td><td>âœ… å®Œå…¨å…¼å®¹</td><td>ä½¿ç”¨Redis Luaè„šæœ¬</td></tr><tr><td><strong>é˜Ÿåˆ—å‰Šå³°</strong></td><td>âœ… å®Œå…¨å…¼å®¹</td><td>ä½¿ç”¨ThreadPoolTaskExecutor</td></tr></tbody></table>
<hr/>
<p><strong>æ–‡æ¡£ç‰ˆæœ¬ï¼š</strong> v1.0<br/>
<strong>é€‚ç”¨ç‰ˆæœ¬ï¼š</strong> SpringBoot 2.xã€Vue3 3.3+ã€JDK 1.8+</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Lambda NodeJS è¿è¡Œæ—¶é“¾è·¯æ¥å…¥è§‚æµ‹äº‘]]></title>    <link>https://juejin.cn/post/7592531796039434274</link>    <guid>https://juejin.cn/post/7592531796039434274</guid>    <pubDate>2026-01-07T10:48:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592531796039434274" data-draft-id="7592432859862532130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Lambda NodeJS è¿è¡Œæ—¶é“¾è·¯æ¥å…¥è§‚æµ‹äº‘"/> <meta itemprop="keywords" content="AWS"/> <meta itemprop="datePublished" content="2026-01-07T10:48:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘"/> <meta itemprop="url" content="https://juejin.cn/user/2392958212523102"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Lambda NodeJS è¿è¡Œæ—¶é“¾è·¯æ¥å…¥è§‚æµ‹äº‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392958212523102/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¯è§‚æµ‹æ€§ç”¨è§‚æµ‹äº‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T10:48:41.000Z" title="Wed Jan 07 2026 10:48:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>ä¸ºæœ‰æ•ˆç›‘æ§æ— æœåŠ¡å™¨æ¶æ„çš„ä¸šåŠ¡æ€§èƒ½ï¼Œæˆ‘ä»¬éœ€è¦å°† AWS Lambda å‡½æ•°çš„å…¨é“¾è·¯æ•°æ®æ¥å…¥è§‚æµ‹äº‘è¿›è¡Œç»Ÿä¸€å¯è§‚æµ‹æ€§åˆ†æã€‚ç”±äº Lambda ç¯å¢ƒçš„ç‰¹æ®Šæ€§ï¼Œæœ€ä½³å®è·µæ˜¯æ„å»ºä¸€ä¸ªé›†æˆäº† OpenTelemetry çš„å®˜æ–¹ Layerã€‚è¯¥ Layer èƒ½è‡ªåŠ¨æ•è·å‡½æ•°è°ƒç”¨é“¾ä¸æ€§èƒ½æŒ‡æ ‡ï¼Œå¹¶é€šè¿‡æ ‡å‡† OTLP åè®®ä¸ŠæŠ¥ã€‚ä¸ºç¡®ä¿æ•°æ®ä¼ è¾“çš„é«˜æ•ˆæ€§ä¸å‰ç»æ€§ï¼Œæˆ‘ä»¬ç‰¹åˆ«å°†ç¤¾åŒºå¸¸è§çš„ JSON æ ¼å¼è°ƒæ•´ä¸º Protobuf ç¼–ç ï¼Œä»¥é€‚é…è§‚æµ‹äº‘åç«¯çš„æŠ€æœ¯æ¼”è¿›ï¼Œä¸ºå‡½æ•°æ€§èƒ½ä¼˜åŒ–ä¸æ•…éšœè¯Šæ–­æä¾›åšå®çš„æ•°æ®åŸºç¡€ã€‚</p>
<h2 data-id="heading-1">å‰ææ¡ä»¶</h2>
<p>è¿è¡Œæ—¶ï¼šNodeJS 22</p>
<h2 data-id="heading-2">å®‰è£… DataKit å¹¶é…ç½®é‡‡é›†å™¨</h2>
<p>è¿›å…¥è§‚æµ‹äº‘æ§åˆ¶å° -ã€Œé›†æˆã€-ã€ŒDataKitã€-ã€ŒLinuxã€å¤åˆ¶å‘½ä»¤å®‰è£… DataKit ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2020a93bad84dbfa840177c18697373~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=djYIyrwHJ9278%2FpMDXR3plgqJKE%3D" alt="" loading="lazy"/></p>
<p>è¿›å…¥Â <code>/usr/local/datakit/conf.d/samples</code>Â ï¼Œå°†Â <code>opentelemetry.conf.sample</code>Â å¤åˆ¶åˆ°ä¸Šçº§ç›®å½•Â <code>/conf.d</code>Â ä¸­ï¼Œå¹¶ä¿®æ”¹æ–‡ä»¶åç¼€ä¸ºÂ <code>conf</code>Â ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cp</span> opentelemetry.conf.sample ../opentelemetry.conf
</code></pre>
<p>ç¼–è¾‘ opentelemetry é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹å¦‚ä¸‹éƒ¨åˆ†ï¼Œæ·»åŠ  enable = true ï¼Œç„¶åä¿å­˜ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75d3ad86f89944b2812ede68519a7531~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=KaVfzyDvZfcKEB4YGinGGNFliIA%3D" alt="" loading="lazy"/></p>
<p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤é‡å¯ DataKit ã€‚</p>
<pre><code class="hljs">datakit service -R
</code></pre>
<p>æ‰“å¼€Â <code>datakit.conf</code>Â çš„Â <code>http_api</code>Â å¼€å¯Â <code>0.0.0.0:9529</code>Â ã€‚</p>
<h2 data-id="heading-3">å‡†å¤‡ä¸€ä¸ª Lambda å‡½æ•°</h2>
<p>ä»¥ä¸‹ demo è„šæœ¬è°ƒç”¨äº†ä¸€ä¸ª Java æœåŠ¡Â <code>52.83.66.70:8090/user</code>Â ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);

<span class="hljs-built_in">exports</span>.<span class="hljs-property">handler</span> = <span class="hljs-keyword">async</span> (event, context) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== å¼€å§‹è°ƒç”¨JavaæœåŠ¡éªŒè¯TraceID ==='</span>);
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å‡†å¤‡è°ƒç”¨JavaæœåŠ¡: 52.83.66.70:8090/user'</span>);
        
        <span class="hljs-comment">// è°ƒç”¨æ‚¨çš„JavaæœåŠ¡</span>
        <span class="hljs-keyword">const</span> javaServiceResult = <span class="hljs-keyword">await</span> <span class="hljs-title function_">callJavaService</span>();
        
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'JavaæœåŠ¡è°ƒç”¨æˆåŠŸ'</span>);
        
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">statusCode</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
                <span class="hljs-attr">success</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">message</span>: <span class="hljs-string">'JavaæœåŠ¡è°ƒç”¨å®Œæˆ'</span>,
                <span class="hljs-attr">javaServiceResponse</span>: javaServiceResult,
                <span class="hljs-attr">requestId</span>: context.<span class="hljs-property">awsRequestId</span>,
                <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">toISOString</span>()
            })
        };
        
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è°ƒç”¨JavaæœåŠ¡å¤±è´¥:'</span>, error);
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">statusCode</span>: <span class="hljs-number">500</span>,
            <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({
                <span class="hljs-attr">success</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">message</span>: <span class="hljs-string">'JavaæœåŠ¡è°ƒç”¨å¤±è´¥'</span>,
                <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span>
            })
        };
    }
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">callJavaService</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¼€å§‹å‘èµ·HTTPè¯·æ±‚åˆ°JavaæœåŠ¡...'</span>);
        
        <span class="hljs-keyword">const</span> options = {
            <span class="hljs-attr">hostname</span>: <span class="hljs-string">'52.83.66.70'</span>,
            <span class="hljs-attr">port</span>: <span class="hljs-number">8090</span>,
            <span class="hljs-attr">path</span>: <span class="hljs-string">'/user'</span>,
            <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
            <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,  <span class="hljs-comment">// 5ç§’è¶…æ—¶</span>
            <span class="hljs-attr">headers</span>: {
                <span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Lambda-OTEL-Test/1.0'</span>,
                <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'application/json'</span>
            }
        };
        
        <span class="hljs-keyword">const</span> req = http.<span class="hljs-title function_">request</span>(options, <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`JavaæœåŠ¡å“åº”çŠ¶æ€ç : <span class="hljs-subst">${res.statusCode}</span>`</span>);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å“åº”å¤´:'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(res.<span class="hljs-property">headers</span>));
            
            <span class="hljs-keyword">let</span> data = <span class="hljs-string">''</span>;
            res.<span class="hljs-title function_">on</span>(<span class="hljs-string">'data'</span>, <span class="hljs-function">(<span class="hljs-params">chunk</span>) =&gt;</span> {
                data += chunk;
            });
            
            res.<span class="hljs-title function_">on</span>(<span class="hljs-string">'end'</span>, <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'JavaæœåŠ¡å“åº”æ•°æ®é•¿åº¦:'</span>, data.<span class="hljs-property">length</span>);
                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'åŸå§‹å“åº”:'</span>, data);
                
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// å°è¯•è§£æJSONå“åº”</span>
                    <span class="hljs-keyword">const</span> parsedData = data ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data) : {};
                    <span class="hljs-title function_">resolve</span>({
                        <span class="hljs-attr">statusCode</span>: res.<span class="hljs-property">statusCode</span>,
                        <span class="hljs-attr">data</span>: parsedData,
                        <span class="hljs-attr">headers</span>: res.<span class="hljs-property">headers</span>,
                        <span class="hljs-attr">rawResponse</span>: data
                    });
                } <span class="hljs-keyword">catch</span> (e) {
                    <span class="hljs-comment">// å¦‚æœJSONè§£æå¤±è´¥ï¼Œè¿”å›åŸå§‹æ•°æ®</span>
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å“åº”ä¸æ˜¯JSONæ ¼å¼ï¼Œè¿”å›åŸå§‹æ•°æ®'</span>);
                    <span class="hljs-title function_">resolve</span>({
                        <span class="hljs-attr">statusCode</span>: res.<span class="hljs-property">statusCode</span>,
                        <span class="hljs-attr">data</span>: data,
                        <span class="hljs-attr">headers</span>: res.<span class="hljs-property">headers</span>,
                        <span class="hljs-attr">isJson</span>: <span class="hljs-literal">false</span>
                    });
                }
            });
        });
        
        req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è¯·æ±‚JavaæœåŠ¡é”™è¯¯:'</span>, error.<span class="hljs-property">message</span>);
            <span class="hljs-title function_">reject</span>(error);
        });
        
        req.<span class="hljs-title function_">on</span>(<span class="hljs-string">'timeout'</span>, <span class="hljs-function">() =&gt;</span> {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è¯·æ±‚JavaæœåŠ¡è¶…æ—¶'</span>);
            req.<span class="hljs-title function_">destroy</span>();
            <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'è¯·æ±‚JavaæœåŠ¡è¶…æ—¶'</span>));
        });
        
        <span class="hljs-comment">// å‘é€è¯·æ±‚</span>
        req.<span class="hljs-title function_">end</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'HTTPè¯·æ±‚å·²å‘é€åˆ°JavaæœåŠ¡'</span>);
    });
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb01cf1faace401990f6f8e6d868dda3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=qkyiTsIOdVU1qnFmG%2BxiM3VMnTI%3D" alt="" loading="lazy"/></p>
<p>æµ‹è¯•äº‹ä»¶ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81a09bc5f94b45f7a84f7c4dde2365e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=iy8FVxCLHlzl3%2BYedEKyAYCfTZI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-4">æ„å»º Layer</h2>
<p>æ„å»ºå®˜æ–¹çš„ Layer åšå¯¼å‡ºå™¨ï¼Œé€šè¿‡ Layer é›†æˆï¼Œæ— ä¾µå…¥å¼åœ°è‡ªåŠ¨æ•è· Lambda å‡½æ•°æ‰§è¡Œçš„é“¾è·¯æ•°æ®å¯ä»¥è‡ªåŠ¨é‡‡é›† Lambda å‡½æ•°çš„é“¾è·¯æ•°æ®ï¼Œå°†é‡‡é›†çš„æ•°æ®è½¬æ¢ä¸º OpenTelemetryï¼ˆOTelï¼‰æ ‡å‡†æ ¼å¼ï¼Œç¡®ä¿ä¸è§‚æµ‹åç«¯å¹³å°çš„å…¼å®¹æ€§ã€‚</p>
<p>æ³¨æ„ï¼šNode.js ç¤¾åŒºæä¾›çš„é»˜è®¤ OpenTelemetry å¯¼å‡ºå™¨é€šå¸¸ä½¿ç”¨ HTTP/JSON æ–¹å¼å‘é€æ•°æ®ï¼Œéœ€è¦å°†é»˜è®¤çš„å¯¼å‡ºåè®®ä» HTTP/JSON æ”¹ä¸º HTTP/PROTOBUFï¼ŒDataKit åç»­å¯èƒ½è€ƒè™‘åºŸå¼ƒ HTTP/JSON æ–¹å¼ã€‚Protobuf ç¼–ç å…·æœ‰æ›´é«˜çš„åºåˆ—åŒ–/ååºåˆ—åŒ–æ•ˆç‡ï¼Œèƒ½æ˜¾è‘—é™ä½ä¼ è¾“æ•°æ®å¤§å°å’Œç½‘ç»œå¼€é”€ï¼Œå°¤å…¶é€‚ç”¨äº Lambda çš„çŸ­æ—¶æ‰§è¡Œç¯å¢ƒã€‚</p>
<p>å…·ä½“å¯ä»¥å‚è€ƒ Opentelemetry çš„ç¤¾åŒºï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopen-telemetry%2Fopentelemetry-lambda%2Ftree%2Fmain%2Fnodejs" target="_blank" title="https://github.com/open-telemetry/opentelemetry-lambda/tree/main/nodejs" ref="nofollow noopener noreferrer">github.com/open-telemeâ€¦</a></p>
<h3 data-id="heading-5">å…‹éš†ä»“åº“</h3>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/open-telemetry/opentelemetry-lambda
</code></pre>
<h3 data-id="heading-6">ä¿®æ”¹åè®®</h3>
<p>è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œå°†ç›¸å…³æ–‡ä»¶çš„Â <code>@opentelemetry/exporter-trace-otlp-http</code>Â æ”¹æˆ<code>@opentelemetry/exporter-trace-otlp-proto</code>ï¼Œä¸€å…±éœ€è¦ä¿®æ”¹ 3 ä¸ªæ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> opentelemetry-lambda/nodejs
</code></pre>
<p><code>./packages/layer/src/wrapper.ts</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38bd51a9fd604663979fc5fe82efef3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=utXS21k%2B99DdNPhTnjPCgkE%2B2%2FE%3D" alt="" loading="lazy"/></p>
<p><code>./packages/layer/package.json</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cd6458047554a50b6c72a2699e2faa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=eHYE3RkZpLk%2BWlmbmqJ2voJAruE%3D" alt="" loading="lazy"/></p>
<p><code>./packages/layer/test/wrapper.spec.ts</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/029ffbd3acf149fca5418d18c0a3d905~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=uXLGyEOoug6iGc98KmqJ93Em9IA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">å®‰è£…ä¾èµ–</h3>
<pre><code class="hljs">npm  install
</code></pre>
<h3 data-id="heading-8">æ„å»ºé¡¹ç›®</h3>
<pre><code class="hljs language-arduino" lang="arduino">npm run build
</code></pre>
<p>åœ¨Â <code>./nodejs/packages/layer/build/</code>Â ä¼šæœ‰ä¸€ä¸ª layer.zip æ–‡ä»¶ã€‚</p>
<h2 data-id="heading-9">æ·»åŠ  Layer</h2>
<h3 data-id="heading-10">åˆ›å»º Layer</h3>
<p>åœ¨ AWS æ§åˆ¶å° Lambda è¿›å…¥ã€Œlayerã€ï¼Œæ–°å»ºä¸€ä¸ª Layerï¼Œé€‰æ‹©ä¸Šä¼  .zip æ–‡ä»¶æ–¹å¼ä¸Šä¼ åˆšæ‰ç”Ÿæˆçš„ layer.zip æ–‡ä»¶ï¼Œæ¶æ„é€‰æ‹© x86ã€è¿è¡Œæ—¶é€‰æ‹© nodejsã€‚åˆ›å»ºå¥½åå¤åˆ¶ ARN ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b889203182e436eb6828d4073cbce93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=DIps1JMjleDD3e5mgF2GAYLD5l4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">æ·»åŠ  Layer</h3>
<p>åœ¨ Demo å‡½æ•°ä¸­æ·»åŠ  Layerï¼Œé€‰æ‹©æŒ‡å®šä¸€ä¸ª ARN ï¼Œå°†åˆšæ‰çš„ ARN å¤åˆ¶è¿›å»ï¼Œç‚¹å‡»ã€Œæ·»åŠ ã€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60e5f5924386484b9cf6d2bd71f8d5fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=TmZcFr40Ady0bHLAE3iKTf6%2BYCM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">é…ç½®ç¯å¢ƒå˜é‡</h3>
<p>é…ç½® Lambda ç¯å¢ƒå˜é‡ï¼Œé€‰æ‹©ã€Œé…ç½®ã€-ã€Œç¯å¢ƒå˜é‡ã€ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0716a8352a44aa4af10685cbbe277a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=XBT0U9mdoS8OnqgxGVzjBTvXsOU%3D" alt="" loading="lazy"/></p>
<p>æ·»åŠ å¦‚ä¸‹å˜é‡ï¼š</p>

































<table><thead><tr><th>KEY</th><th>VALUE</th></tr></thead><tbody><tr><td>AWS_LAMBDA_EXEC_WRAPPER</td><td>/opt/otel-handler</td></tr><tr><td>OTEL_EXPORTER_OTLP_ENDPOINT</td><td>http://&lt;datakitä¸»æœºåœ°å€&gt;:9529/otel</td></tr><tr><td>OTEL_EXPORTER_OTLP_TRACES_PROTOCOL</td><td>http/protobuf</td></tr><tr><td>OTEL_NODE_ENABLED_INSTRUMENTATIONS</td><td>aws-lambda,aws-sdk,http,https,pg,mysql,redis</td></tr><tr><td>OTEL_SERVICE_NAME</td><td>æœåŠ¡åç§°</td></tr><tr><td>OTEL_TRACES_SAMPLER</td><td>always_on</td></tr></tbody></table>
<h3 data-id="heading-13">æµ‹è¯•å‡½æ•°</h3>
<p>å›åˆ°å‡½æ•°ç‚¹å‡»æµ‹è¯•</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9106fe8e902c449eac82d2fe92570dda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=4JyEzTUGZLgkEdduUXqwIdd5gGU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14">è§‚æµ‹äº‘æ•ˆæœ</h2>
<p>é“¾è·¯ä¸ŠæŠ¥æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aea9fb76b0c54b8f8466c235bf81e610~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=ZskSaVssjpwSxLCVCnssWBZK0bQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0164a6c9903745f08f7f7c8755041fff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=rht6tINseTc0fe5ZGlRAIFtCoo4%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0101db490eb425f94d07a49ee9e5ca4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=44M1aFWkzGbRFpOrFBi6DBEILRU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ecba69b48a06441cb03a71fa436134cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-v6KeC5rWL5oCn55So6KeC5rWL5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768387721&amp;x-signature=dx8EcFh1G%2FXIdGgMi7YwUSmbYWY%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernateï¼ˆ27ï¼‰Hibernateçš„æŸ¥è¯¢ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ]]></title>    <link>https://juejin.cn/post/7592148975848996907</link>    <guid>https://juejin.cn/post/7592148975848996907</guid>    <pubDate>2026-01-07T11:53:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592148975848996907" data-draft-id="7592255257348112425" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernateï¼ˆ27ï¼‰Hibernateçš„æŸ¥è¯¢ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-07T11:53:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernateï¼ˆ27ï¼‰Hibernateçš„æŸ¥è¯¢ç­–ç•¥æ˜¯ä»€ä¹ˆï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-07T11:53:01.000Z" title="Wed Jan 07 2026 11:53:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-07
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Hibernateçš„æŸ¥è¯¢ç­–ç•¥</h3>
<p>Hibernateçš„æŸ¥è¯¢ç­–ç•¥å†³å®šäº†å¦‚ä½•ä»æ•°æ®åº“ä¸­æ£€ç´¢æ•°æ®ã€‚å®ƒåŒ…æ‹¬å¤šç§ç­–ç•¥ï¼Œå¦‚å³æ—¶åŠ è½½ï¼ˆEager Loadingï¼‰ã€å»¶è¿ŸåŠ è½½ï¼ˆLazy Loadingï¼‰å’Œæ‰¹é‡æ£€ç´¢ï¼ˆBatch Fetchingï¼‰ç­‰ã€‚è¿™äº›ç­–ç•¥å¯ä»¥æ˜¾è‘—å½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå†…å­˜ä½¿ç”¨ï¼Œå› æ­¤äº†è§£å’Œé€‰æ‹©åˆé€‚çš„æŸ¥è¯¢ç­–ç•¥éå¸¸é‡è¦ã€‚</p>
<h3 data-id="heading-1">ä¸»è¦æŸ¥è¯¢ç­–ç•¥</h3>
<ol>
<li><strong>å³æ—¶åŠ è½½ï¼ˆEager Loadingï¼‰</strong>ï¼šåœ¨åŠ è½½å®ä½“æ—¶ï¼ŒåŒæ—¶åŠ è½½å…¶å…³è”çš„å®ä½“ã€‚</li>
<li><strong>å»¶è¿ŸåŠ è½½ï¼ˆLazy Loadingï¼‰</strong>ï¼šåªæœ‰åœ¨è®¿é—®å…³è”å®ä½“æ—¶ï¼Œæ‰åŠ è½½è¯¥å®ä½“ã€‚</li>
<li><strong>æ‰¹é‡æ£€ç´¢ï¼ˆBatch Fetchingï¼‰</strong>ï¼šåœ¨ä¸€æ¬¡æŸ¥è¯¢ä¸­åŠ è½½å¤šä¸ªå…³è”çš„å®ä½“ã€‚</li>
</ol>
<h3 data-id="heading-2">é…ç½®æŸ¥è¯¢ç­–ç•¥çš„æ–¹å¼</h3>
<ol>
<li><strong>åœ¨æ˜ å°„æ–‡ä»¶æˆ–æ³¨è§£ä¸­é…ç½®</strong>ã€‚</li>
<li><strong>åœ¨æŸ¥è¯¢ä¸­æŒ‡å®šï¼ˆå¦‚HQLæˆ–CriteriaæŸ¥è¯¢ï¼‰</strong>ã€‚</li>
</ol>
<h3 data-id="heading-3">ç¤ºä¾‹ä»£ç </h3>
<h4 data-id="heading-4">é…ç½®æ–‡ä»¶ <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- æ•°æ®åº“è¿æ¥é…ç½® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate å±æ€§é…ç½® --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- æ˜ å°„ç±» --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Person"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Address"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-5">å®ä½“ç±» <code>Person</code> å’Œ <code>Address</code></h4>
<h5 data-id="heading-6">Personç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "name")</span>
    <span class="hljs-keyword">private</span> String name;

    <span class="hljs-meta">@Column(name = "age")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-meta">@OneToMany(mappedBy = "person", fetch = FetchType.LAZY, cascade = CascadeType.ALL)</span>
    <span class="hljs-keyword">private</span> Set&lt;Address&gt; addresses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Person</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// Getters å’Œ Setters</span>
    
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-keyword">public</span> Set&lt;Address&gt; <span class="hljs-title function_">getAddresses</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> addresses;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAddresses</span><span class="hljs-params">(Set&lt;Address&gt; addresses)</span> {
        <span class="hljs-built_in">this</span>.addresses = addresses;
    }
}
</code></pre>
<h5 data-id="heading-7">Addressç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.*;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "address")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {

    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;

    <span class="hljs-meta">@Column(name = "street")</span>
    <span class="hljs-keyword">private</span> String street;

    <span class="hljs-meta">@ManyToOne</span>
    <span class="hljs-meta">@JoinColumn(name = "person_id", nullable = false)</span>
    <span class="hljs-keyword">private</span> Person person;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Address</span><span class="hljs-params">(String street, Person person)</span> {
        <span class="hljs-built_in">this</span>.street = street;
        <span class="hljs-built_in">this</span>.person = person;
    }

    <span class="hljs-comment">// Getters å’Œ Setters</span>
    
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getStreet</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> street;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setStreet</span><span class="hljs-params">(String street)</span> {
        <span class="hljs-built_in">this</span>.street = street;
    }

    <span class="hljs-keyword">public</span> Person <span class="hljs-title function_">getPerson</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> person;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPerson</span><span class="hljs-params">(Person person)</span> {
        <span class="hljs-built_in">this</span>.person = person;
    }
}
</code></pre>
<h3 data-id="heading-8">å³æ—¶åŠ è½½å’Œå»¶è¿ŸåŠ è½½ç¤ºä¾‹</h3>
<h5 data-id="heading-9">HibernateUtilç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// ä»é…ç½®æ–‡ä»¶åˆ›å»ºSessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// è®°å½•å¯åŠ¨å¤±è´¥çš„é”™è¯¯</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-10">å³æ—¶åŠ è½½ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateEagerLoadingExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è·å–SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// æ’å…¥ç¤ºä¾‹æ•°æ®</span>
        insertData(sessionFactory);

        <span class="hljs-comment">// å³æ—¶åŠ è½½ç¤ºä¾‹</span>
        eagerLoadingExample(sessionFactory);

        <span class="hljs-comment">// å…³é—­SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"123 Street"</span>, person);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"456 Avenue"</span>, person);
            person.getAddresses().add(address1);
            person.getAddresses().add(address2);

            session.save(person);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted Person and Addresses"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eagerLoadingExample</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è·å–Personå®ä½“ï¼Œå¹¶åŒæ—¶åŠ è½½å…¶å…³è”çš„Addresså®ä½“ï¼ˆå³æ—¶åŠ è½½ï¼‰</span>
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                System.out.println(<span class="hljs-string">"Person: "</span> + person.getName());
                <span class="hljs-keyword">for</span> (Address address : person.getAddresses()) {
                    System.out.println(<span class="hljs-string">"Address: "</span> + address.getStreet());
                }
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h4 data-id="heading-11">å»¶è¿ŸåŠ è½½ç¤ºä¾‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateLazyLoadingExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è·å–SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();

        <span class="hljs-comment">// æ’å…¥ç¤ºä¾‹æ•°æ®</span>
        insertData(sessionFactory);

        <span class="hljs-comment">// å»¶è¿ŸåŠ è½½ç¤ºä¾‹</span>
        lazyLoadingExample(sessionFactory);

        <span class="hljs-comment">// å…³é—­SessionFactory</span>
        sessionFactory.close();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertData</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">30</span>);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"123 Street"</span>, person);
            <span class="hljs-type">Address</span> <span class="hljs-variable">address2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(<span class="hljs-string">"456 Avenue"</span>, person);
            person.getAddresses().add(address1);
            person.getAddresses().add(address2);

            session.save(person);
            transaction.commit();
            System.out.println(<span class="hljs-string">"Inserted Person and Addresses"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lazyLoadingExample</span><span class="hljs-params">(SessionFactory sessionFactory)</span> {
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// è·å–Personå®ä½“ï¼Œæ­¤æ—¶ä¸ä¼šç«‹å³åŠ è½½å…¶å…³è”çš„Addresså®ä½“ï¼ˆå»¶è¿ŸåŠ è½½ï¼‰</span>
            <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> session.get(Person.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (person != <span class="hljs-literal">null</span>) {
                System.out.println(<span class="hljs-string">"Person: "</span> + person.getName());
                <span class="hljs-comment">// è®¿é—®å…³è”çš„Addresså®ä½“æ—¶æ‰ä¼šè§¦å‘åŠ è½½</span>
                <span class="hljs-keyword">for</span> (Address address : person.getAddresses()) {
                    System.out.println(<span class="hljs-string">"Address: "</span> + address.getStreet());
                }
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"No Person found with ID 1"</span>);
            }
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-12">æ‰¹é‡æ£€ç´¢ç¤ºä¾‹</h3>
<p>æ‰¹é‡æ£€ç´¢é€šè¿‡åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨<code>@BatchSize</code>æ³¨è§£æˆ–Hibernateçš„é…ç½®æ–‡ä»¶ä¸­çš„ç›¸åº”å±æ€§æ¥å®ç°ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> org.hibernate.annotations.BatchSize;

<span class="hljs-keyword">import</span> javax.persistence.*;
<span class="hljs-keyword">import</span> java.util.HashSet;
<span class="hljs-keyword">import</span> java.util.Set;

<span class="hljs-meta">@Entity</span>
<span class="hljs-meta">@Table(name = "person")</span>
<span class="hljs-meta">@BatchSize(size = 10)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {

 
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RAGçŸ¥è¯†åº“æ ¸å¿ƒä¼˜åŒ–ï½œåŸºäºè¯­ä¹‰çš„æ™ºèƒ½æ–‡æœ¬åˆ‡ç‰‡æ–¹æ¡ˆï¼ˆå¯¹æ¯”å­—ç¬¦ä¸²é•¿åº¦åˆ†å‰²ï¼‰]]></title>    <link>https://juejin.cn/post/7592555965792026630</link>    <guid>https://juejin.cn/post/7592555965792026630</guid>    <pubDate>2026-01-08T06:28:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592555965792026630" data-draft-id="7592540388298833983" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RAGçŸ¥è¯†åº“æ ¸å¿ƒä¼˜åŒ–ï½œåŸºäºè¯­ä¹‰çš„æ™ºèƒ½æ–‡æœ¬åˆ‡ç‰‡æ–¹æ¡ˆï¼ˆå¯¹æ¯”å­—ç¬¦ä¸²é•¿åº¦åˆ†å‰²ï¼‰"/> <meta itemprop="keywords" content="åç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-08T06:28:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é€ è½®å­çš„çŒª"/> <meta itemprop="url" content="https://juejin.cn/user/497453720940158"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RAGçŸ¥è¯†åº“æ ¸å¿ƒä¼˜åŒ–ï½œåŸºäºè¯­ä¹‰çš„æ™ºèƒ½æ–‡æœ¬åˆ‡ç‰‡æ–¹æ¡ˆï¼ˆå¯¹æ¯”å­—ç¬¦ä¸²é•¿åº¦åˆ†å‰²ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/497453720940158/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é€ è½®å­çš„çŒª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:28:49.000Z" title="Thu Jan 08 2026 06:28:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RAGçŸ¥è¯†åº“æ ¸å¿ƒä¼˜åŒ–ï½œåŸºäºè¯­ä¹‰çš„æ™ºèƒ½æ–‡æœ¬åˆ‡ç‰‡æ–¹æ¡ˆï¼ˆå¯¹æ¯”å­—ç¬¦ä¸²é•¿åº¦åˆ†å‰²ï¼‰</h2>
<h3 data-id="heading-1">ä¸€ã€æ”¹é€ æ ¸å¿ƒä»·å€¼</h3>
<p>ä¼ ç»Ÿçš„ã€ŒæŒ‰å­—ç¬¦ä¸²é•¿åº¦ç¡¬åˆ†å‰²ã€ä¼šç ´åæ–‡æœ¬è¯­ä¹‰å®Œæ•´æ€§ï¼Œå¯¼è‡´åˆ‡ç‰‡å†…å®¹ç¢ç‰‡åŒ–ã€æ£€ç´¢ç­”éæ‰€é—®ï¼›è€Œ<strong>åŸºäºè¯­ä¹‰çš„æ™ºèƒ½åˆ‡ç‰‡</strong>ä»¥å®Œæ•´è¯­ä¹‰å•å…ƒï¼ˆå¥å­ã€æ®µè½ï¼‰ä¸ºè¾¹ç•Œæ‹†åˆ†æ–‡æœ¬ï¼Œæ ¸å¿ƒä»·å€¼å¦‚ä¸‹ï¼š
åˆ‡ç‰‡å†…å®¹å®Œæ•´ï¼šæ¯ä¸ªåˆ‡ç‰‡éƒ½æ˜¯ç‹¬ç«‹çš„è¯­ä¹‰å•å…ƒï¼ˆå¦‚å®Œæ•´å¥å­/æ®µè½ï¼‰ï¼Œé¿å…ã€Œä¸€å¥è¯è¢«æ‹†æˆä¸¤ä¸ªåˆ‡ç‰‡ã€çš„é—®é¢˜ï¼›
æ£€ç´¢ç²¾åº¦æå‡ï¼šè¯­ä¹‰å®Œæ•´çš„åˆ‡ç‰‡å‘é‡åŒ–åï¼Œä¸ç”¨æˆ·æé—®çš„åŒ¹é…åº¦æ›´é«˜ï¼Œå¤§å¹…å‡å°‘æ£€ç´¢è¯¯å·®ï¼›
ä¸Šä¸‹æ–‡è¿è´¯æ€§ï¼šæ–°å¢è¯­ä¹‰é‡å ï¼ˆOverlapï¼‰æœºåˆ¶ï¼Œç›¸é‚»åˆ‡ç‰‡ä¿ç•™éƒ¨åˆ†é‡å å†…å®¹ï¼Œè§£å†³è·¨åˆ‡ç‰‡è¯­ä¹‰æ–­è£‚é—®é¢˜ï¼›
çµæ´»é€‚é…ï¼šæ”¯æŒé•¿åˆ‡ç‰‡äºŒæ¬¡æ‹†åˆ†ã€çŸ­åˆ‡ç‰‡åˆå¹¶ï¼Œå…¼é¡¾é•¿åº¦é™åˆ¶ä¸è¯­ä¹‰å®Œæ•´æ€§ï¼›
å»é‡ä¼˜åŒ–ï¼šå¯é€‰ç›¸ä¼¼åˆ‡ç‰‡åˆå¹¶ï¼Œå‡å°‘å†—ä½™å‘é‡æ•°æ®ï¼Œé™ä½å­˜å‚¨/æ£€ç´¢æˆæœ¬ã€‚</p>
<h3 data-id="heading-2">äºŒã€è¯­ä¹‰åˆ‡ç‰‡ vs å­—ç¬¦ä¸²é•¿åº¦åˆ‡ç‰‡ï¼ˆæ ¸å¿ƒåŒºåˆ«ï¼‰</h3>













































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>å­—ç¬¦ä¸²é•¿åº¦åˆ‡ç‰‡ï¼ˆä¼ ç»Ÿæ–¹æ¡ˆï¼‰</th><th>åŸºäºè¯­ä¹‰çš„æ™ºèƒ½åˆ‡ç‰‡ï¼ˆä¼˜åŒ–æ–¹æ¡ˆï¼‰</th></tr></thead><tbody><tr><td><strong>åˆ†å‰²ä¾æ®</strong></td><td>å›ºå®šå­—ç¬¦æ•°ï¼ˆå¦‚æ¯500å­—åˆ‡ä¸€ç‰‡ï¼‰ï¼Œæ— è¯­ä¹‰è€ƒé‡</td><td>è¯­ä¹‰è¾¹ç•Œï¼ˆæ®µè½ã€å¥å­ã€æ ‡ç‚¹ï¼‰ï¼Œä¼˜å…ˆä¿è¯è¯­ä¹‰å®Œæ•´</td></tr><tr><td><strong>å†…å®¹å®Œæ•´æ€§</strong></td><td>æ˜“æ‹†åˆ†å®Œæ•´å¥å­/æ¦‚å¿µï¼ˆå¦‚â€œå¼ ä¸‰æ˜¯å·¥ç¨‹å¸ˆâ€æ‹†æˆâ€œå¼ ä¸‰æ˜¯â€+â€œå·¥ç¨‹å¸ˆâ€ï¼‰</td><td>æ¯ä¸ªåˆ‡ç‰‡éƒ½æ˜¯å®Œæ•´è¯­ä¹‰å•å…ƒï¼Œæ— ç¢ç‰‡åŒ–å†…å®¹</td></tr><tr><td><strong>æ£€ç´¢åŒ¹é…åº¦</strong></td><td>å‘é‡ç‰¹å¾ç¢ç‰‡åŒ–ï¼Œæ˜“åŒ¹é…åˆ°ä¸ç›¸å…³åˆ‡ç‰‡</td><td>å‘é‡ç‰¹å¾å®Œæ•´ï¼Œç²¾å‡†åŒ¹é…ç”¨æˆ·æé—®çš„è¯­ä¹‰</td></tr><tr><td><strong>ä¸Šä¸‹æ–‡è¿è´¯æ€§</strong></td><td>ç›¸é‚»åˆ‡ç‰‡æ— å…³è”ï¼Œè·¨åˆ‡ç‰‡å†…å®¹æ— æ³•è¡”æ¥</td><td>æ–°å¢15%è¯­ä¹‰é‡å ï¼Œç›¸é‚»åˆ‡ç‰‡ä¿ç•™é‡å å†…å®¹ï¼Œè¡”æ¥è‡ªç„¶</td></tr><tr><td><strong>çµæ´»æ€§</strong></td><td>å›ºå®šé•¿åº¦ï¼Œæ— æ³•é€‚é…é•¿çŸ­å¥æ··åˆçš„æ–‡æœ¬</td><td>é•¿åˆ‡ç‰‡äºŒæ¬¡æ‹†åˆ†ã€çŸ­åˆ‡ç‰‡åˆå¹¶ï¼ŒåŠ¨æ€é€‚é…æ–‡æœ¬ç»“æ„</td></tr><tr><td><strong>å†—ä½™åº¦</strong></td><td>æ— å»é‡æœºåˆ¶ï¼Œç›¸ä¼¼å†…å®¹é‡å¤åˆ‡ç‰‡</td><td>å¯é€‰ç›¸ä¼¼åˆ‡ç‰‡åˆå¹¶ï¼Œå‡å°‘å†—ä½™å‘é‡æ•°æ®</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>çº¯ä»£ç /æ— è¯­ä¹‰çš„çº¯å­—ç¬¦æ–‡æœ¬</td><td>çŸ¥è¯†åº“æ–‡æ¡£ï¼ˆPDF/Wordï¼‰ã€è‡ªç„¶è¯­è¨€æ–‡æœ¬</td></tr></tbody></table>
<h3 data-id="heading-3">ä¸‰ã€å®Œæ•´é›†æˆæ–¹æ¡ˆ</h3>
<h4 data-id="heading-4">1. Mavenä¾èµ–</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- HanLPï¼šä¸­æ–‡åˆ†è¯ã€è¯æ€§æ ‡æ³¨ã€è¯­ä¹‰è¾¹ç•Œè¯†åˆ«ï¼ˆæ ¸å¿ƒä¾èµ–ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.hankcs<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hanlp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>portable-1.8.4<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-comment">&lt;!-- æ–‡æœ¬ç›¸ä¼¼åº¦è®¡ç®—ï¼ˆç›¸ä¼¼åˆ‡ç‰‡åˆå¹¶ç”¨ï¼Œå¯é€‰ï¼‰ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>info.debatty<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>java-string-similarity<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-5">2. æ ¸å¿ƒæ¨¡å‹ï¼šSemanticChunk</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;

<span class="hljs-comment">/**
 * è¯­ä¹‰åˆ‡ç‰‡å®ä½“ã€ç”Ÿäº§çº§ã€‘
 * å°è£…åˆ‡ç‰‡æ ¸å¿ƒä¿¡æ¯ï¼Œæ”¯æ’‘çŸ¥è¯†åº“æº¯æº+å‘é‡æ£€ç´¢
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SemanticChunk</span> {
    <span class="hljs-comment">/** åˆ‡ç‰‡å”¯ä¸€IDï¼ˆUUIDï¼‰ */</span>
    <span class="hljs-keyword">private</span> String chunkId;
    <span class="hljs-comment">/** åˆ‡ç‰‡æ–‡æœ¬å†…å®¹ï¼ˆå®Œæ•´è¯­ä¹‰å•å…ƒï¼‰ */</span>
    <span class="hljs-keyword">private</span> String content;
    <span class="hljs-comment">/** æ¥æºæ–‡ä»¶åç§°ï¼ˆå¦‚ï¼šæŠ€æœ¯æ‰‹å†Œv1.0.pdfï¼‰ */</span>
    <span class="hljs-keyword">private</span> String fileName;
    <span class="hljs-comment">/** æ¥æºæ–‡ä»¶åœ¨MinIOçš„å­˜å‚¨è·¯å¾„ï¼ˆç”¨äºæº¯æºï¼‰ */</span>
    <span class="hljs-keyword">private</span> String objectName;
    <span class="hljs-comment">/** åˆ‡ç‰‡åœ¨æ–‡ä»¶ä¸­çš„æ®µè½åºå·ï¼ˆåˆ‡ç‰‡é¡ºåºï¼‰ */</span>
    <span class="hljs-keyword">private</span> Integer paraNum;
    <span class="hljs-comment">/** åˆ‡ç‰‡é•¿åº¦ï¼ˆå­—ç¬¦æ•°ï¼‰ */</span>
    <span class="hljs-keyword">private</span> Integer length;
    <span class="hljs-comment">/** æ–°å¢ï¼šåˆ‡ç‰‡ç±»å‹ï¼ˆæ®µè½/å¥å­ï¼Œä¾¿äºæ£€ç´¢è¿‡æ»¤ï¼‰ */</span>
    <span class="hljs-keyword">private</span> String chunkType;
    <span class="hljs-comment">/** æ–°å¢ï¼šåˆ›å»ºæ—¶é—´æˆ³ï¼ˆç”¨äºæ’åº/æ’æŸ¥ï¼‰ */</span>
    <span class="hljs-keyword">private</span> Long createTime;

    <span class="hljs-comment">// å¿«æ·æ„å»ºæ–¹æ³•ï¼ˆç®€åŒ–è°ƒç”¨ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SemanticChunk <span class="hljs-title function_">build</span><span class="hljs-params">(String content, String fileName, String objectName, Integer paraNum)</span> {
        <span class="hljs-type">SemanticChunk</span> <span class="hljs-variable">chunk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SemanticChunk</span>();
        chunk.setChunkId(java.util.UUID.randomUUID().toString());
        chunk.setContent(content);
        chunk.setFileName(fileName);
        chunk.setObjectName(objectName);
        chunk.setParaNum(paraNum);
        chunk.setLength(content.length());
        chunk.setChunkType(content.contains(<span class="hljs-string">"\n"</span>) ? <span class="hljs-string">"paragraph"</span> : <span class="hljs-string">"sentence"</span>);
        chunk.setCreateTime(System.currentTimeMillis());
        <span class="hljs-keyword">return</span> chunk;
    }
}
</code></pre>
<h4 data-id="heading-6">3. æ ¸å¿ƒæœåŠ¡ï¼šSemanticChunkService</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.hankcs.hanlp.seg.common.Term;
<span class="hljs-keyword">import</span> com.hankcs.hanlp.tokenizer.StandardTokenizer;
<span class="hljs-keyword">import</span> info.debatty.java.stringsimilarity.Cosine;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> javax.annotation.Resource;
<span class="hljs-keyword">import</span> java.util.*;
<span class="hljs-keyword">import</span> java.util.regex.Pattern;

<span class="hljs-comment">/**
 * è¯­ä¹‰åˆ‡ç‰‡æ ¸å¿ƒæœåŠ¡ã€ç”Ÿäº§çº§ã€‘
 * èŒè´£ï¼šåŸºäºè¯­ä¹‰è¾¹ç•Œæ‹†åˆ†æ–‡æœ¬ï¼Œç”Ÿæˆå®Œæ•´ã€è¿è´¯ã€æ— å†—ä½™çš„åˆ‡ç‰‡ï¼Œæ”¯æ’‘RAGçŸ¥è¯†åº“å‘é‡åŒ–
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SemanticChunkService</span> {
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> EmbeddingModel embeddingModel;
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> ElasticsearchVectorService elasticsearchVectorService;

    <span class="hljs-comment">// ========== æ ¸å¿ƒé…ç½®å‚æ•°ï¼ˆå¯æŠ½ç¦»åˆ°yamlï¼‰ ==========</span>
    <span class="hljs-comment">/** æœ€å¤§åˆ‡ç‰‡é•¿åº¦ï¼ˆè¶…è¿‡åˆ™äºŒæ¬¡æ‹†åˆ†ï¼Œé¿å…å‘é‡è¶…é™ï¼‰ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_CHUNK_LENGTH</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;
    <span class="hljs-comment">/** æœ€å°åˆ‡ç‰‡é•¿åº¦ï¼ˆä½äºåˆ™åˆå¹¶ï¼Œé¿å…ç¢ç‰‡åŒ–ï¼‰ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MIN_CHUNK_LENGTH</span> <span class="hljs-operator">=</span> <span class="hljs-number">50</span>;
    <span class="hljs-comment">/** ä¸­æ–‡è¯­ä¹‰åˆ†å‰²ç¬¦ï¼ˆä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼šå¥å­ç»“æŸç¬¦â†’åˆ†å¥ç¬¦â†’åˆ†éš”ç¬¦ï¼‰ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] SPLIT_DELIMITERS = {<span class="hljs-string">"ã€‚"</span>, <span class="hljs-string">"ï¼"</span>, <span class="hljs-string">"ï¼Ÿ"</span>, <span class="hljs-string">"ï¼›"</span>, <span class="hljs-string">"ï¼Œ"</span>};
    <span class="hljs-comment">/** å»å™ªæ­£åˆ™ï¼šåŒ¹é…å¤šä½™ç©ºæ ¼ã€æ¢è¡Œã€åˆ¶è¡¨ç¬¦ã€å…¨è§’ç©ºæ ¼ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Pattern</span> <span class="hljs-variable">NOISE_PATTERN</span> <span class="hljs-operator">=</span> Pattern.compile(<span class="hljs-string">"\\s+|ã€€"</span>);
    <span class="hljs-comment">/** ç›¸ä¼¼åº¦é˜ˆå€¼ï¼š0.8ä»¥ä¸Šè§†ä¸ºé«˜åº¦ç›¸ä¼¼ï¼Œå¯åˆå¹¶ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">SIMILARITY_THRESHOLD</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.8</span>;
    <span class="hljs-comment">/** åˆ‡ç‰‡é‡å æ¯”ä¾‹ï¼ˆ15%ï¼Œå¹³è¡¡è¿è´¯æ€§ä¸å†—ä½™åº¦ï¼‰ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">double</span> <span class="hljs-variable">OVERLAP_RATIO</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.15</span>;
    <span class="hljs-comment">/** æœ€å°é‡å å­—ç¬¦æ•°ï¼ˆé¿å…çŸ­åˆ‡ç‰‡é‡å è¿‡å°‘ï¼‰ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MIN_OVERLAP_LENGTH</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;
    <span class="hljs-comment">/** æœ€å¤§é‡å å­—ç¬¦æ•°ï¼ˆé¿å…é•¿åˆ‡ç‰‡é‡å è¿‡å¤šï¼‰ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">MAX_OVERLAP_LENGTH</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
    <span class="hljs-comment">/** æ‰¹é‡å†™å…¥ESçš„æ‰¹æ¬¡å¤§å°ï¼ˆæ ¹æ®ESæ€§èƒ½è°ƒæ•´ï¼‰ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BATCH_SIZE</span> <span class="hljs-operator">=</span> <span class="hljs-number">20</span>;

    <span class="hljs-comment">// ç›¸ä¼¼åº¦è®¡ç®—å·¥å…·ï¼ˆå…¨å±€å•ä¾‹ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Cosine</span> <span class="hljs-variable">cosine</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cosine</span>();

    <span class="hljs-comment">// ========== 1. æ–‡æœ¬é¢„å¤„ç†ï¼šæ¸…æ´—ä¸æ ‡å‡†åŒ–ï¼ˆæ ¸å¿ƒå‰ç½®æ­¥éª¤ï¼‰ ==========</span>
    <span class="hljs-comment">/**
     * æ¸…æ´—æ–‡æœ¬ï¼šå»é™¤å†—ä½™ç©ºæ ¼/æ¢è¡Œã€æ ‡å‡†åŒ–æ ¼å¼ï¼Œä¸ºè¯­ä¹‰åˆ†å‰²åšå‡†å¤‡
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">cleanText</span><span class="hljs-params">(String rawText)</span> {
        <span class="hljs-keyword">if</span> (StringUtils.isBlank(rawText)) {
            log.warn(<span class="hljs-string">"å¾…æ¸…æ´—æ–‡æœ¬ä¸ºç©ºï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
        <span class="hljs-comment">// 1. å»é™¤æ‰€æœ‰å†—ä½™ç©ºç™½å­—ç¬¦ï¼ˆç©ºæ ¼ã€æ¢è¡Œã€åˆ¶è¡¨ç¬¦ã€å…¨è§’ç©ºæ ¼ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">cleanText</span> <span class="hljs-operator">=</span> NOISE_PATTERN.matcher(rawText).replaceAll(<span class="hljs-string">" "</span>);
        <span class="hljs-comment">// 2. å»é™¤é¦–å°¾ç©ºç™½ï¼Œæ ‡å‡†åŒ–æ ¼å¼</span>
        cleanText = cleanText.trim();
        <span class="hljs-comment">// 3. æ›¿æ¢è¿ç»­æ ‡ç‚¹ï¼ˆå¦‚â€œã€‚ã€‚ã€‚â€â†’â€œã€‚â€ï¼‰ï¼Œé¿å…åˆ†å‰²å¼‚å¸¸</span>
        cleanText = cleanText.replaceAll(<span class="hljs-string">"[ã€‚ï¼ï¼Ÿï¼›ï¼Œ]{2,}"</span>, <span class="hljs-string">"$1"</span>);
        log.info(<span class="hljs-string">"æ–‡æœ¬æ¸…æ´—å®Œæˆï¼ŒåŸé•¿åº¦ï¼š{}ï¼Œæ¸…æ´—åé•¿åº¦ï¼š{}"</span>, rawText.length(), cleanText.length());
        <span class="hljs-keyword">return</span> cleanText;
    }

    <span class="hljs-comment">// ========== 2. ç²—åˆ†å‰²ï¼šåŸºäºè¯­ä¹‰è¾¹ç•Œæ‹†åˆ†åŸºç¡€å—ï¼ˆæ ¸å¿ƒç¬¬ä¸€æ­¥ï¼‰ ==========</span>
    <span class="hljs-comment">/**
     * ç²—åˆ†å‰²ï¼šä¼˜å…ˆæŒ‰æ®µè½æ‹†åˆ†ï¼Œå†æŒ‰è¯­ä¹‰æ ‡ç‚¹æ‹†åˆ†ï¼Œç”ŸæˆåŸºç¡€è¯­ä¹‰å—
     */</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">roughSplit</span><span class="hljs-params">(String cleanText)</span> {
        List&lt;String&gt; chunks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">if</span> (StringUtils.isBlank(cleanText)) {
            <span class="hljs-keyword">return</span> chunks;
        }

        <span class="hljs-comment">// ç¬¬ä¸€æ­¥ï¼šæŒ‰æ®µè½æ‹†åˆ†ï¼ˆæ®µè½æ˜¯å¤©ç„¶çš„å¤§è¯­ä¹‰è¾¹ç•Œï¼‰</span>
        String[] paragraphs = cleanText.split(<span class="hljs-string">"\n"</span>);
        <span class="hljs-keyword">for</span> (String para : paragraphs) {
            para = para.trim();
            <span class="hljs-keyword">if</span> (para.length() == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">continue</span>;
            }
            <span class="hljs-comment">// ç¬¬äºŒæ­¥ï¼šå¯¹æ¯ä¸ªæ®µè½ï¼ŒæŒ‰è¯­ä¹‰æ ‡ç‚¹æ‹†åˆ†ï¼ˆä¿ç•™æ ‡ç‚¹ï¼Œä¿è¯è¯­ä¹‰å®Œæ•´ï¼‰</span>
            List&lt;String&gt; paraChunks = splitByDelimiters(para);
            chunks.addAll(paraChunks);
        }

        log.info(<span class="hljs-string">"ç²—åˆ†å‰²å®Œæˆï¼Œç”ŸæˆåŸºç¡€è¯­ä¹‰å—æ•°é‡ï¼š{}"</span>, chunks.size());
        <span class="hljs-keyword">return</span> chunks;
    }

    <span class="hljs-comment">/**
     * æŒ‰è¯­ä¹‰åˆ†å‰²ç¬¦ä¼˜å…ˆçº§æ‹†åˆ†æ–‡æœ¬ï¼ˆæ ¸å¿ƒå·¥å…·æ–¹æ³•ï¼‰
     * ä¿ç•™åˆ†å‰²ç¬¦ï¼Œç¡®ä¿æ¯ä¸ªåŸºç¡€å—éƒ½æ˜¯å®Œæ•´çš„è¯­ä¹‰å•å…ƒ
     */</span>
    <span class="hljs-keyword">private</span> List&lt;String&gt; <span class="hljs-title function_">splitByDelimiters</span><span class="hljs-params">(String text)</span> {
        List&lt;String&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        result.add(text);

        <span class="hljs-comment">// æŒ‰åˆ†å‰²ç¬¦ä¼˜å…ˆçº§ä¾æ¬¡æ‹†åˆ†ï¼ˆå…ˆæ‹†å¥å­ç»“æŸç¬¦ï¼Œå†æ‹†åˆ†å¥ç¬¦ï¼‰</span>
        <span class="hljs-keyword">for</span> (String delimiter : SPLIT_DELIMITERS) {
            List&lt;String&gt; temp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
            <span class="hljs-keyword">for</span> (String chunk : result) {
                String[] parts = chunk.split(Pattern.quote(delimiter)); <span class="hljs-comment">// è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦</span>
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; parts.length; i++) {
                    <span class="hljs-type">String</span> <span class="hljs-variable">part</span> <span class="hljs-operator">=</span> parts[i].trim();
                    <span class="hljs-keyword">if</span> (part.length() == <span class="hljs-number">0</span>) {
                        <span class="hljs-keyword">continue</span>;
                    }
                    <span class="hljs-comment">// ä¿ç•™åˆ†å‰²ç¬¦ï¼ˆå¦åˆ™è¯­ä¹‰ä¸å®Œæ•´ï¼Œå¦‚â€œæˆ‘æ˜¯å¼ ä¸‰â€æ‹†æˆâ€œæˆ‘æ˜¯â€+â€œå¼ ä¸‰â€ï¼‰</span>
                    <span class="hljs-keyword">if</span> (i &lt; parts.length - <span class="hljs-number">1</span>) {
                        part += delimiter;
                    }
                    temp.add(part);
                }
            }
            result = temp;
        }
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-comment">// ========== 3. ç»†è°ƒæ•´ï¼šé•¿å—æ‹†åˆ†+çŸ­å—åˆå¹¶+è¯­ä¹‰é‡å ï¼ˆæ ¸å¿ƒç¬¬äºŒæ­¥ï¼‰ ==========</span>
    <span class="hljs-comment">/**
     * ç»†è°ƒæ•´ï¼š
     * 1. é•¿å—â†’åŸºäºHanLPåˆ†è¯äºŒæ¬¡æ‹†åˆ†ï¼ˆä¿è¯å¥å­å®Œæ•´ï¼‰
     * 2. çŸ­å—â†’åˆå¹¶ï¼ˆé¿å…ç¢ç‰‡åŒ–ï¼‰
     * 3. æ‰€æœ‰å—â†’æ·»åŠ è¯­ä¹‰é‡å ï¼ˆä¿è¯ä¸Šä¸‹æ–‡è¿è´¯ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">fineAdjust</span><span class="hljs-params">(List&lt;String&gt; roughChunks)</span> {
        List&lt;String&gt; finalChunks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">shortChunkBuffer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
        <span class="hljs-type">String</span> <span class="hljs-variable">prevChunk</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>; <span class="hljs-comment">// è®°å½•å‰ä¸€ä¸ªåˆ‡ç‰‡ï¼Œç”¨äºç”Ÿæˆé‡å </span>

        <span class="hljs-keyword">for</span> (String chunk : roughChunks) {
            <span class="hljs-type">int</span> <span class="hljs-variable">length</span> <span class="hljs-operator">=</span> chunk.length();

            <span class="hljs-comment">// æƒ…å†µ1ï¼šåˆ‡ç‰‡è¿‡é•¿ï¼ˆè¶…è¿‡MAXï¼‰â†’ åŸºäºHanLPåˆ†è¯æ‹†åˆ†ï¼ˆæŒ‰å¥å­è¾¹ç•Œï¼‰</span>
            <span class="hljs-keyword">if</span> (length &gt; MAX_CHUNK_LENGTH) {
                List&lt;String&gt; subChunks = splitLongChunkByHanLP(chunk);
                subChunks = addOverlapToSubChunks(subChunks); <span class="hljs-comment">// å­åˆ‡ç‰‡æ·»åŠ é‡å </span>
                finalChunks.addAll(subChunks);
                prevChunk = subChunks.isEmpty() ? prevChunk : subChunks.get(subChunks.size() - <span class="hljs-number">1</span>);
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-comment">// æƒ…å†µ2ï¼šåˆ‡ç‰‡è¿‡çŸ­ï¼ˆä½äºMINï¼‰â†’ æš‚å­˜åˆå¹¶ï¼Œå‡‘å¤Ÿé•¿åº¦å†åŠ å…¥</span>
            <span class="hljs-keyword">if</span> (length &lt; MIN_CHUNK_LENGTH) {
                shortChunkBuffer.append(chunk);
                <span class="hljs-keyword">if</span> (shortChunkBuffer.length() &gt;= MIN_CHUNK_LENGTH) {
                    <span class="hljs-type">String</span> <span class="hljs-variable">mergedChunk</span> <span class="hljs-operator">=</span> shortChunkBuffer.toString();
                    mergedChunk = addOverlapWithPrevChunk(mergedChunk, prevChunk); <span class="hljs-comment">// æ·»åŠ é‡å </span>
                    finalChunks.add(mergedChunk);
                    prevChunk = mergedChunk;
                    shortChunkBuffer.setLength(<span class="hljs-number">0</span>); <span class="hljs-comment">// æ¸…ç©ºç¼“å†²åŒº</span>
                }
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-comment">// æƒ…å†µ3ï¼šé•¿åº¦é€‚ä¸­â†’ç›´æ¥æ·»åŠ é‡å ååŠ å…¥</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">chunkWithOverlap</span> <span class="hljs-operator">=</span> addOverlapWithPrevChunk(chunk, prevChunk);
            finalChunks.add(chunkWithOverlap);
            prevChunk = chunk;
        }

        <span class="hljs-comment">// å¤„ç†ç¼“å†²åŒºå‰©ä½™çš„çŸ­åˆ‡ç‰‡</span>
        <span class="hljs-keyword">if</span> (shortChunkBuffer.length() &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-type">String</span> <span class="hljs-variable">remainingChunk</span> <span class="hljs-operator">=</span> shortChunkBuffer.toString();
            remainingChunk = addOverlapWithPrevChunk(remainingChunk, prevChunk);
            finalChunks.add(remainingChunk);
        }

        log.info(<span class="hljs-string">"ç»†è°ƒæ•´å®Œæˆï¼Œæœ€ç»ˆåˆ‡ç‰‡æ•°é‡ï¼š{}"</span>, finalChunks.size());
        <span class="hljs-keyword">return</span> finalChunks;
    }

    <span class="hljs-comment">/**
     * åŸºäºHanLPåˆ†è¯æ‹†åˆ†é•¿åˆ‡ç‰‡
     * é¿å…ç¡¬åˆ†å‰²ç ´åè¯­ä¹‰ï¼Œä¿è¯æ‹†åˆ†åçš„å­å—ä»æ˜¯å®Œæ•´å¥å­
     */</span>
    <span class="hljs-keyword">private</span> List&lt;String&gt; <span class="hljs-title function_">splitLongChunkByHanLP</span><span class="hljs-params">(String longChunk)</span> {
        List&lt;String&gt; subChunks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        List&lt;Term&gt; terms = StandardTokenizer.segment(longChunk); <span class="hljs-comment">// HanLPæ ‡å‡†åˆ†è¯</span>
        <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">currentSubChunk</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();

        <span class="hljs-keyword">for</span> (Term term : terms) {
            currentSubChunk.append(term.word);
            <span class="hljs-type">String</span> <span class="hljs-variable">word</span> <span class="hljs-operator">=</span> term.word;

            <span class="hljs-comment">// é‡åˆ°å¥å­ç»“æŸç¬¦â†’æ‹†åˆ†ï¼ˆä¿è¯å­å—æ˜¯å®Œæ•´å¥å­ï¼‰</span>
            <span class="hljs-keyword">if</span> (word.equals(<span class="hljs-string">"ã€‚"</span>) || word.equals(<span class="hljs-string">"ï¼"</span>) || word.equals(<span class="hljs-string">"ï¼Ÿ"</span>)) {
                <span class="hljs-type">String</span> <span class="hljs-variable">subChunk</span> <span class="hljs-operator">=</span> currentSubChunk.toString().trim();
                <span class="hljs-keyword">if</span> (subChunk.length() &gt; <span class="hljs-number">0</span>) {
                    subChunks.add(subChunk);
                }
                currentSubChunk.setLength(<span class="hljs-number">0</span>);
            }

            <span class="hljs-comment">// é˜²æ­¢å­å—è¿‡é•¿â†’å¼ºåˆ¶æ‹†åˆ†ï¼ˆå…œåº•ç­–ç•¥ï¼‰</span>
            <span class="hljs-keyword">if</span> (currentSubChunk.length() &gt; MAX_CHUNK_LENGTH / <span class="hljs-number">2</span>) {
                <span class="hljs-type">String</span> <span class="hljs-variable">subChunk</span> <span class="hljs-operator">=</span> currentSubChunk.toString().trim();
                <span class="hljs-keyword">if</span> (subChunk.length() &gt; <span class="hljs-number">0</span>) {
                    subChunks.add(subChunk);
                }
                currentSubChunk.setLength(<span class="hljs-number">0</span>);
            }
        }

        <span class="hljs-comment">// å¤„ç†å‰©ä½™å†…å®¹</span>
        <span class="hljs-keyword">if</span> (currentSubChunk.length() &gt; <span class="hljs-number">0</span>) {
            subChunks.add(currentSubChunk.toString().trim());
        }

        log.info(<span class="hljs-string">"é•¿åˆ‡ç‰‡æ‹†åˆ†å®Œæˆï¼ŒåŸé•¿åº¦ï¼š{}ï¼Œæ‹†åˆ†å­å—æ•°é‡ï¼š{}"</span>, longChunk.length(), subChunks.size());
        <span class="hljs-keyword">return</span> subChunks;
    }

    <span class="hljs-comment">// ========== è¯­ä¹‰é‡å æ ¸å¿ƒæ–¹æ³•ï¼ˆä¿è¯ä¸Šä¸‹æ–‡è¿è´¯ï¼‰ ==========</span>
    <span class="hljs-comment">/**
     * ç»™æ‹†åˆ†åçš„å­åˆ‡ç‰‡æ·»åŠ è¯­ä¹‰é‡å ï¼ˆç›¸é‚»å­åˆ‡ç‰‡ä¿ç•™15%é‡å å†…å®¹ï¼‰
     */</span>
    <span class="hljs-keyword">private</span> List&lt;String&gt; <span class="hljs-title function_">addOverlapToSubChunks</span><span class="hljs-params">(List&lt;String&gt; subChunks)</span> {
        <span class="hljs-keyword">if</span> (subChunks.size() &lt;= <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> subChunks;
        }

        List&lt;String&gt; subChunksWithOverlap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; subChunks.size(); i++) {
            <span class="hljs-type">String</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> subChunks.get(i);
            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) {
                subChunksWithOverlap.add(current);
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-comment">// éç¬¬ä¸€ä¸ªåˆ‡ç‰‡ï¼šæ·»åŠ ä¸å‰ä¸€ä¸ªåˆ‡ç‰‡çš„é‡å å†…å®¹</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">prev</span> <span class="hljs-operator">=</span> subChunks.get(i - <span class="hljs-number">1</span>);
            <span class="hljs-type">String</span> <span class="hljs-variable">overlapContent</span> <span class="hljs-operator">=</span> getOverlapContent(prev);
            <span class="hljs-type">String</span> <span class="hljs-variable">currentWithOverlap</span> <span class="hljs-operator">=</span> overlapContent + current;

            <span class="hljs-comment">// å…œåº•ï¼šè¶…è¿‡æœ€å¤§é•¿åº¦åˆ™æŒ‰è¯­ä¹‰æˆªæ–­</span>
            <span class="hljs-keyword">if</span> (currentWithOverlap.length() &gt; MAX_CHUNK_LENGTH) {
                currentWithOverlap = truncateByDelimiter(currentWithOverlap, MAX_CHUNK_LENGTH);
            }
            subChunksWithOverlap.add(currentWithOverlap);
        }
        <span class="hljs-keyword">return</span> subChunksWithOverlap;
    }

    <span class="hljs-comment">/**
     * ç»™å½“å‰åˆ‡ç‰‡æ·»åŠ ä¸å‰ä¸€ä¸ªåˆ‡ç‰‡çš„è¯­ä¹‰é‡å ï¼ˆæ ¸å¿ƒï¼šä¿ç•™ä¸Šä¸‹æ–‡ï¼‰
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">addOverlapWithPrevChunk</span><span class="hljs-params">(String currentChunk, String prevChunk)</span> {
        <span class="hljs-keyword">if</span> (StringUtils.isBlank(prevChunk) || StringUtils.isBlank(currentChunk)) {
            <span class="hljs-keyword">return</span> currentChunk;
        }

        <span class="hljs-type">String</span> <span class="hljs-variable">overlapContent</span> <span class="hljs-operator">=</span> getOverlapContent(prevChunk);
        <span class="hljs-type">String</span> <span class="hljs-variable">currentWithOverlap</span> <span class="hljs-operator">=</span> overlapContent + currentChunk;

        <span class="hljs-comment">// é˜²æ­¢æ‹¼æ¥åè¶…è¿‡æœ€å¤§é•¿åº¦ï¼ŒæŒ‰è¯­ä¹‰æˆªæ–­</span>
        <span class="hljs-keyword">if</span> (currentWithOverlap.length() &gt; MAX_CHUNK_LENGTH) {
            currentWithOverlap = truncateByDelimiter(currentWithOverlap, MAX_CHUNK_LENGTH);
        }
        <span class="hljs-keyword">return</span> currentWithOverlap;
    }

    <span class="hljs-comment">/**
     * è®¡ç®—é‡å å†…å®¹ï¼šå–å‰ä¸€ä¸ªåˆ‡ç‰‡æœ«å°¾çš„Nä¸ªå­—ç¬¦ï¼ˆ15%ï¼Œä¸”åœ¨[20,100]ä¹‹é—´ï¼‰
     * ä¼˜å…ˆæŒ‰è¯­ä¹‰åˆ†å‰²ç¬¦è°ƒæ•´ï¼Œä¿è¯é‡å å†…å®¹æ˜¯å®Œæ•´è¯­ä¹‰å•å…ƒ
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getOverlapContent</span><span class="hljs-params">(String prevChunk)</span> {
        <span class="hljs-keyword">if</span> (StringUtils.isBlank(prevChunk)) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }

        <span class="hljs-comment">// è®¡ç®—ç›®æ ‡é‡å é•¿åº¦ï¼ˆ15%ï¼Œé™åˆ¶ä¸Šä¸‹é™ï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">targetOverlapLength</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (prevChunk.length() * OVERLAP_RATIO);
        targetOverlapLength = Math.max(MIN_OVERLAP_LENGTH, Math.min(targetOverlapLength, MAX_OVERLAP_LENGTH));

        <span class="hljs-comment">// å‰ä¸€ä¸ªåˆ‡ç‰‡è¿‡çŸ­â†’ç›´æ¥è¿”å›æ•´ä¸ªåˆ‡ç‰‡</span>
        <span class="hljs-keyword">if</span> (prevChunk.length() &lt;= targetOverlapLength) {
            <span class="hljs-keyword">return</span> prevChunk;
        }

        <span class="hljs-comment">// å–å‰ä¸€ä¸ªåˆ‡ç‰‡æœ«å°¾çš„ç›®æ ‡é•¿åº¦å­—ç¬¦</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">overlapContent</span> <span class="hljs-operator">=</span> prevChunk.substring(prevChunk.length() - targetOverlapLength);

        <span class="hljs-comment">// ä¼˜åŒ–ï¼šæŒ‰è¯­ä¹‰åˆ†å‰²ç¬¦è°ƒæ•´ï¼Œä¿è¯é‡å å†…å®¹å®Œæ•´</span>
        <span class="hljs-keyword">for</span> (String delimiter : SPLIT_DELIMITERS) {
            <span class="hljs-type">int</span> <span class="hljs-variable">delimiterIndex</span> <span class="hljs-operator">=</span> overlapContent.indexOf(delimiter);
            <span class="hljs-keyword">if</span> (delimiterIndex != -<span class="hljs-number">1</span> &amp;&amp; delimiterIndex &lt; overlapContent.length() - <span class="hljs-number">1</span>) {
                overlapContent = overlapContent.substring(delimiterIndex + <span class="hljs-number">1</span>).trim();
                <span class="hljs-keyword">break</span>;
            }
        }

        <span class="hljs-keyword">return</span> overlapContent;
    }

    <span class="hljs-comment">/**
     * æŒ‰è¯­ä¹‰åˆ†å‰²ç¬¦æˆªæ–­æ–‡æœ¬ï¼ˆå…œåº•ï¼šä¿è¯æˆªæ–­åä»æ˜¯å®Œæ•´è¯­ä¹‰å•å…ƒï¼‰
     */</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">truncateByDelimiter</span><span class="hljs-params">(String text, <span class="hljs-type">int</span> maxLength)</span> {
        <span class="hljs-keyword">if</span> (text.length() &lt;= maxLength) {
            <span class="hljs-keyword">return</span> text;
        }

        <span class="hljs-comment">// å…ˆæˆªæ–­åˆ°æœ€å¤§é•¿åº¦ï¼Œå†å¾€å‰æ‰¾æœ€è¿‘çš„è¯­ä¹‰åˆ†å‰²ç¬¦</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">truncated</span> <span class="hljs-operator">=</span> text.substring(<span class="hljs-number">0</span>, maxLength);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> truncated.length() - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> truncated.charAt(i);
            <span class="hljs-keyword">if</span> (Arrays.asList(SPLIT_DELIMITERS).contains(String.valueOf(c))) {
                <span class="hljs-keyword">return</span> truncated.substring(<span class="hljs-number">0</span>, i + <span class="hljs-number">1</span>);
            }
        }

        <span class="hljs-comment">// æ— åˆ†å‰²ç¬¦â†’ç›´æ¥è¿”å›æˆªæ–­å†…å®¹ï¼ˆå…œåº•ï¼‰</span>
        <span class="hljs-keyword">return</span> truncated;
    }

    <span class="hljs-comment">// ========== 4. ç›¸ä¼¼åˆ‡ç‰‡åˆå¹¶ï¼ˆå¯é€‰ï¼šå‡å°‘å†—ä½™ï¼‰ ==========</span>
    <span class="hljs-comment">/**
     * åˆå¹¶é«˜åº¦ç›¸ä¼¼çš„åˆ‡ç‰‡ï¼ˆç›¸ä¼¼åº¦â‰¥0.8ï¼‰ï¼Œå‡å°‘å†—ä½™å‘é‡æ•°æ®
     * æ³¨æ„ï¼šåˆå¹¶åéœ€é‡æ–°æ£€æŸ¥é•¿åº¦å’Œé‡å ï¼Œé¿å…è¶…é™
     */</span>
    <span class="hljs-keyword">public</span> List&lt;String&gt; <span class="hljs-title function_">mergeSimilarChunks</span><span class="hljs-params">(List&lt;String&gt; chunks)</span> {
        <span class="hljs-keyword">if</span> (chunks.size() &lt;= <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> chunks;
        }

        List&lt;String&gt; mergedChunks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (String chunk : chunks) {
            <span class="hljs-type">boolean</span> <span class="hljs-variable">isSimilar</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; mergedChunks.size(); i++) {
                <span class="hljs-type">String</span> <span class="hljs-variable">existing</span> <span class="hljs-operator">=</span> mergedChunks.get(i);
                <span class="hljs-comment">// è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦ï¼ˆæ–‡æœ¬å‘é‡åŒ–åå¯¹æ¯”ï¼‰</span>
                <span class="hljs-type">double</span> <span class="hljs-variable">similarity</span> <span class="hljs-operator">=</span> cosine.similarity(chunk, existing);
                <span class="hljs-keyword">if</span> (similarity &gt;= SIMILARITY_THRESHOLD) {
                    <span class="hljs-comment">// åˆå¹¶ç›¸ä¼¼åˆ‡ç‰‡ï¼Œä¿ç•™å®Œæ•´å†…å®¹</span>
                    <span class="hljs-type">String</span> <span class="hljs-variable">merged</span> <span class="hljs-operator">=</span> existing + <span class="hljs-string">" "</span> + chunk;
                    <span class="hljs-comment">// åˆå¹¶åè¿‡é•¿â†’æ‹†åˆ†</span>
                    <span class="hljs-keyword">if</span> (merged.length() &gt; MAX_CHUNK_LENGTH) {
                        mergedChunks.addAll(splitLongChunkByHanLP(merged));
                    } <span class="hljs-keyword">else</span> {
                        mergedChunks.set(i, merged.trim());
                    }
                    isSimilar = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">break</span>;
                }
            }
            <span class="hljs-keyword">if</span> (!isSimilar) {
                mergedChunks.add(chunk);
            }
        }

        log.info(<span class="hljs-string">"ç›¸ä¼¼åˆ‡ç‰‡åˆå¹¶å®Œæˆï¼ŒåŸæ•°é‡ï¼š{}ï¼Œåˆå¹¶åæ•°é‡ï¼š{}"</span>, chunks.size(), mergedChunks.size());
        <span class="hljs-keyword">return</span> mergedChunks;
    }

    <span class="hljs-comment">// ========== 5. æ„å»ºåˆ‡ç‰‡å¯¹è±¡ï¼ˆè¡¥å……å…ƒä¿¡æ¯ï¼‰ ==========</span>
    <span class="hljs-comment">/**
     * æ„å»ºè¯­ä¹‰åˆ‡ç‰‡å¯¹è±¡ï¼Œè¡¥å……æ–‡ä»¶åã€å­˜å‚¨è·¯å¾„ç­‰å…ƒä¿¡æ¯ï¼Œæ”¯æ’‘æº¯æº
     */</span>
    <span class="hljs-keyword">public</span> List&lt;SemanticChunk&gt; <span class="hljs-title function_">buildSemanticChunks</span><span class="hljs-params">(List&lt;String&gt; textChunks, String fileName, String objectName)</span> {
        List&lt;SemanticChunk&gt; chunks = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; textChunks.size(); i++) {
            <span class="hljs-type">String</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> textChunks.get(i);
            chunks.add(SemanticChunk.build(content, fileName, objectName, i + <span class="hljs-number">1</span>));
        }
        log.info(<span class="hljs-string">"è¯­ä¹‰åˆ‡ç‰‡å¯¹è±¡æ„å»ºå®Œæˆï¼Œæ•°é‡ï¼š{}"</span>, chunks.size());
        <span class="hljs-keyword">return</span> chunks;
    }

    <span class="hljs-comment">// ========== 6. å¯¹å¤–æš´éœ²çš„æ ¸å¿ƒæ–¹æ³•ï¼šå®Œæ•´è¯­ä¹‰åˆ‡ç‰‡+å‘é‡åŒ–æµç¨‹ ==========</span>
    <span class="hljs-comment">/**
     * å®Œæ•´æµç¨‹ï¼šæ–‡æœ¬æ¸…æ´—â†’ç²—åˆ†å‰²â†’ç»†è°ƒæ•´â†’æ„å»ºåˆ‡ç‰‡â†’å‘é‡åŒ–â†’å†™å…¥ES
     * <span class="hljs-doctag">@param</span> rawText åŸå§‹æ–‡æœ¬ï¼ˆå¦‚PDF/Wordè§£æåçš„å†…å®¹ï¼‰
     * <span class="hljs-doctag">@param</span> fileName æ–‡ä»¶åï¼ˆå¦‚ï¼šæŠ€æœ¯æ‰‹å†Œv1.0.pdfï¼‰
     * <span class="hljs-doctag">@param</span> objectName MinIOå­˜å‚¨è·¯å¾„ï¼ˆå¦‚ï¼štech-manual/xxx.pdfï¼‰
     * <span class="hljs-doctag">@param</span> docMetadata æ–‡æ¡£å…ƒæ•°æ®ï¼ˆå¦‚ï¼šæ–‡ä»¶ç±»å‹ã€ä¸Šä¼ äººã€åˆ›å»ºæ—¶é—´ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sliceAndVector</span><span class="hljs-params">(String rawText, String fileName, String objectName, Map&lt;String, Object&gt; docMetadata)</span> {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"å¼€å§‹å¤„ç†æ–‡ä»¶ã€{}ã€‘çš„è¯­ä¹‰åˆ‡ç‰‡ï¼ŒåŸæ–‡æœ¬é•¿åº¦ï¼š{}"</span>, fileName, rawText == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : rawText.length());

            <span class="hljs-comment">// 1. æ–‡æœ¬æ¸…æ´—</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">cleanText</span> <span class="hljs-operator">=</span> cleanText(rawText);
            <span class="hljs-keyword">if</span> (StringUtils.isBlank(cleanText)) {
                log.warn(<span class="hljs-string">"æ–‡ä»¶ã€{}ã€‘æ¸…æ´—åæ–‡æœ¬ä¸ºç©ºï¼Œè·³è¿‡åˆ‡ç‰‡"</span>, fileName);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// 2. ç²—åˆ†å‰²ï¼ˆåŸºäºè¯­ä¹‰è¾¹ç•Œï¼‰</span>
            List&lt;String&gt; roughChunks = roughSplit(cleanText);

            <span class="hljs-comment">// 3. ç»†è°ƒæ•´ï¼ˆé•¿æ‹†çŸ­åˆ+è¯­ä¹‰é‡å ï¼‰</span>
            List&lt;String&gt; finalTextChunks = fineAdjust(roughChunks);

            <span class="hljs-comment">// å¯é€‰ï¼šåˆå¹¶ç›¸ä¼¼åˆ‡ç‰‡ï¼ˆå‡å°‘å†—ä½™ï¼Œæ ¹æ®ä¸šåŠ¡éœ€æ±‚å¼€å¯ï¼‰</span>
            <span class="hljs-comment">// finalTextChunks = mergeSimilarChunks(finalTextChunks);</span>

            <span class="hljs-comment">// 4. æ„å»ºè¯­ä¹‰åˆ‡ç‰‡å¯¹è±¡</span>
            List&lt;SemanticChunk&gt; semanticChunks = buildSemanticChunks(finalTextChunks, fileName, objectName);

            <span class="hljs-comment">// 5. å‘é‡åŒ–å¹¶æ‰¹é‡å†™å…¥ES</span>
            vectorAndWriteToEs(semanticChunks, docMetadata);

            log.info(<span class="hljs-string">"æ–‡ä»¶ã€{}ã€‘è¯­ä¹‰åˆ‡ç‰‡+å‘é‡åŒ–å®Œæˆï¼Œæœ€ç»ˆåˆ‡ç‰‡æ•°é‡ï¼š{}"</span>, fileName, semanticChunks.size());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"æ–‡ä»¶ã€{}ã€‘è¯­ä¹‰åˆ‡ç‰‡å¤„ç†å¤±è´¥"</span>, fileName, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è¯­ä¹‰åˆ‡ç‰‡å¤„ç†å¤±è´¥ï¼š"</span> + e.getMessage());
        }
    }

    <span class="hljs-comment">/**
     * åˆ‡ç‰‡å‘é‡åŒ–+æ‰¹é‡å†™å…¥ESï¼ˆç”Ÿäº§çº§ï¼šåˆ†æ‰¹å†™å…¥ï¼Œé¿å…ESå‹åŠ›è¿‡å¤§ï¼‰
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">vectorAndWriteToEs</span><span class="hljs-params">(List&lt;SemanticChunk&gt; chunks, Map&lt;String, Object&gt; docMetadata)</span> {
        <span class="hljs-keyword">if</span> (chunks.isEmpty()) {
            log.warn(<span class="hljs-string">"æ— åˆ‡ç‰‡æ•°æ®ï¼Œè·³è¿‡å‘é‡åŒ–"</span>);
            <span class="hljs-keyword">return</span>;
        }

        List&lt;Document&gt; batchDocs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">int</span> <span class="hljs-variable">batchCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

        <span class="hljs-keyword">for</span> (SemanticChunk chunk : chunks) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// 1. æ–‡æœ¬å‘é‡åŒ–ï¼ˆç”Ÿæˆæµ®ç‚¹å‹å‘é‡ï¼‰</span>
                <span class="hljs-type">float</span>[] embeddings = embeddingModel.embed(chunk.getContent());

                <span class="hljs-comment">// 2. æ„å»ºESæ–‡æ¡£ï¼ˆè¡¥å……åˆ‡ç‰‡å…ƒæ•°æ®ï¼‰</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">chunkId</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString().replace(<span class="hljs-string">"-"</span>, <span class="hljs-string">""</span>);
                Map&lt;String, Object&gt; chunkMetadata = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(docMetadata);
                chunkMetadata.put(<span class="hljs-string">"chunkId"</span>, chunkId);
                chunkMetadata.put(<span class="hljs-string">"vector"</span>, embeddings);
                chunkMetadata.put(<span class="hljs-string">"chunkIndex"</span>, chunk.getParaNum());
                chunkMetadata.put(<span class="hljs-string">"chunkLength"</span>, chunk.getLength());
                chunkMetadata.put(<span class="hljs-string">"chunkType"</span>, chunk.getChunkType());
                chunkMetadata.put(<span class="hljs-string">"objectName"</span>, chunk.getObjectName());

                <span class="hljs-comment">// 3. æ·»åŠ åˆ°æ‰¹æ¬¡</span>
                <span class="hljs-type">Document</span> <span class="hljs-variable">document</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>(chunk.getChunkId(), chunk.getContent(), chunkMetadata);
                batchDocs.add(document);

                <span class="hljs-comment">// 4. è¾¾åˆ°æ‰¹æ¬¡å¤§å°â†’æ‰¹é‡å†™å…¥ES</span>
                <span class="hljs-keyword">if</span> (batchDocs.size() &gt;= BATCH_SIZE) {
                    elasticsearchVectorService.writeBatchToEs(batchDocs);
                    log.info(<span class="hljs-string">"æ‰¹é‡å†™å…¥ESå®Œæˆï¼Œæ‰¹æ¬¡ï¼š{}ï¼Œæ–‡æ¡£æ•°ï¼š{}"</span>, batchCount, batchDocs.size());
                    batchDocs.clear();
                    batchCount++;
                }
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"åˆ‡ç‰‡ã€{}ã€‘å‘é‡åŒ–å¤±è´¥"</span>, chunk.getChunkId(), e);
                <span class="hljs-comment">// å•ä¸ªåˆ‡ç‰‡å¤±è´¥ä¸å½±å“æ•´ä½“æµç¨‹ï¼Œç»§ç»­å¤„ç†ä¸‹ä¸€ä¸ª</span>
                <span class="hljs-keyword">continue</span>;
            }
        }

        <span class="hljs-comment">// å¤„ç†æœ€åä¸€æ‰¹å‰©ä½™æ–‡æ¡£</span>
        <span class="hljs-keyword">if</span> (!batchDocs.isEmpty()) {
            elasticsearchVectorService.writeBatchToEs(batchDocs);
            log.info(<span class="hljs-string">"æœ€åä¸€æ‰¹å†™å…¥ESå®Œæˆï¼Œæ–‡æ¡£æ•°ï¼š{}"</span>, batchDocs.size());
        }
    }
}
</code></pre>
<h3 data-id="heading-7">å››ã€è¯­ä¹‰åˆ‡ç‰‡å®Œæ•´é“¾è·¯ï¼ˆRAGçŸ¥è¯†åº“é›†æˆï¼‰</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> å‰ç«¯ä¸Šä¼ çŸ¥è¯†åº“æ–‡ä»¶â†’MinIOå­˜å‚¨â†’è·å–æ–‡ä»¶æµ/æ–‡æœ¬å†…å®¹
<span class="hljs-bullet">2.</span> è°ƒç”¨SemanticChunkService.sliceAndVector()æ–¹æ³•ï¼š
   â†’ æ–‡æœ¬æ¸…æ´—ï¼ˆå»å™ªã€æ ‡å‡†åŒ–ï¼‰
   â†’ ç²—åˆ†å‰²ï¼ˆæŒ‰æ®µè½â†’æŒ‰è¯­ä¹‰æ ‡ç‚¹æ‹†åˆ†ï¼‰
   â†’ ç»†è°ƒæ•´ï¼ˆé•¿æ‹†çŸ­åˆ+15%è¯­ä¹‰é‡å ï¼‰
   â†’ æ„å»ºåˆ‡ç‰‡å¯¹è±¡ï¼ˆè¡¥å……å…ƒä¿¡æ¯ï¼‰
   â†’ åˆ‡ç‰‡å‘é‡åŒ–â†’æ‰¹é‡å†™å…¥ESå‘é‡åº“
<span class="hljs-bullet">3.</span> ç”¨æˆ·æ£€ç´¢æ—¶â†’ESå‘é‡æ£€ç´¢â†’è¿”å›å®Œæ•´è¯­ä¹‰åˆ‡ç‰‡â†’å¤§æ¨¡å‹ç”Ÿæˆç­”æ¡ˆ
</code></pre>
<h3 data-id="heading-8">äº”ã€ç”Ÿäº§çº§è¿›é˜¶æ‰©å±•ï¼ˆå¯é€‰ï¼‰</h3>
<h4 data-id="heading-9">æ‰©å±•1ï¼šé…ç½®å‚æ•°å¤–ç½®ï¼ˆçµæ´»è°ƒæ•´ï¼‰</h4>
<p>å°†æ ¸å¿ƒå‚æ•°ï¼ˆå¦‚æœ€å¤§/æœ€å°åˆ‡ç‰‡é•¿åº¦ã€é‡å æ¯”ä¾‹ï¼‰æŠ½ç¦»åˆ°<code>application.yml</code>ï¼Œæ— éœ€ä¿®æ”¹ä»£ç å³å¯è°ƒæ•´ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># è¯­ä¹‰åˆ‡ç‰‡é…ç½®</span>
<span class="hljs-attr">semantic-chunk:</span>
  <span class="hljs-attr">max-length:</span> <span class="hljs-number">1000</span>
  <span class="hljs-attr">min-length:</span> <span class="hljs-number">50</span>
  <span class="hljs-attr">overlap-ratio:</span> <span class="hljs-number">0.15</span>
  <span class="hljs-attr">min-overlap-length:</span> <span class="hljs-number">20</span>
  <span class="hljs-attr">max-overlap-length:</span> <span class="hljs-number">100</span>
  <span class="hljs-attr">similarity-threshold:</span> <span class="hljs-number">0.8</span>
  <span class="hljs-attr">batch-size:</span> <span class="hljs-number">20</span>
</code></pre>
<h4 data-id="heading-10">æ‰©å±•2ï¼šæ”¯æŒå¤šè¯­è¨€è¯­ä¹‰åˆ‡ç‰‡</h4>
<p>é›†æˆå¤šè¯­è¨€åˆ†è¯å·¥å…·ï¼ˆå¦‚Jiebaã€NLTKï¼‰ï¼Œé€‚é…è‹±æ–‡/å¤šè¯­è¨€çŸ¥è¯†åº“æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¤ºä¾‹ï¼šè‹±æ–‡è¯­ä¹‰åˆ†å‰²ï¼ˆæŒ‰å¥å·/é—®å·æ‹†åˆ†ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String[] ENGLISH_DELIMITERS = {<span class="hljs-string">". "</span>, <span class="hljs-string">"! "</span>, <span class="hljs-string">"? "</span>, <span class="hljs-string">"; "</span>, <span class="hljs-string">", "</span>};
</code></pre>
<h4 data-id="heading-11">æ‰©å±•3ï¼šåˆ‡ç‰‡è´¨é‡æ ¡éªŒ</h4>
<p>æ–°å¢åˆ‡ç‰‡è´¨é‡è¯„åˆ†ï¼ˆå¦‚è¯­ä¹‰å®Œæ•´æ€§ã€é•¿åº¦åˆè§„æ€§ï¼‰ï¼Œè¿‡æ»¤ä½è´¨é‡åˆ‡ç‰‡ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * åˆ‡ç‰‡è´¨é‡æ ¡éªŒï¼šè¯„åˆ†â‰¥80è§†ä¸ºé«˜è´¨é‡åˆ‡ç‰‡
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">scoreChunkQuality</span><span class="hljs-params">(SemanticChunk chunk)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
    <span class="hljs-comment">// é•¿åº¦è¶…æ ‡æ‰£20åˆ†</span>
    <span class="hljs-keyword">if</span> (chunk.getLength() &gt; MAX_CHUNK_LENGTH) score -= <span class="hljs-number">20</span>;
    <span class="hljs-comment">// ç¢ç‰‡åŒ–æ‰£10åˆ†</span>
    <span class="hljs-keyword">if</span> (chunk.getLength() &lt; MIN_CHUNK_LENGTH) score -= <span class="hljs-number">10</span>;
    <span class="hljs-comment">// æ— æœ‰æ•ˆè¯­ä¹‰æ‰£30åˆ†ï¼ˆå¦‚çº¯æ•°å­—/ç¬¦å·ï¼‰</span>
    <span class="hljs-keyword">if</span> (chunk.getContent().matches(<span class="hljs-string">"^[0-9\\p{Punct}]+$"</span>)) score -= <span class="hljs-number">30</span>;
    <span class="hljs-keyword">return</span> Math.max(<span class="hljs-number">0</span>, score);
}
</code></pre>
<h4 data-id="heading-12">æ‰©å±•4ï¼šåˆ‡ç‰‡ç¼“å­˜</h4>
<p>å¯¹é«˜é¢‘è®¿é—®çš„åˆ‡ç‰‡ï¼ˆå¦‚çƒ­é—¨çŸ¥è¯†åº“æ–‡æ¡£ï¼‰è¿›è¡Œç¼“å­˜ï¼Œå‡å°‘é‡å¤åˆ‡ç‰‡/å‘é‡åŒ–ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Cacheable(value = "semanticChunk", key = "#fileName + #objectName")</span>
<span class="hljs-keyword">public</span> List&lt;SemanticChunk&gt; <span class="hljs-title function_">getCachedChunks</span><span class="hljs-params">(String fileName, String objectName)</span> {
    <span class="hljs-comment">// ç”Ÿæˆåˆ‡ç‰‡çš„é€»è¾‘</span>
}
</code></pre>
<h3 data-id="heading-13">å…­ã€å…³é”®æ³¨æ„äº‹é¡¹ï¼ˆç”Ÿäº§è½åœ°å¿…çœ‹ï¼‰</h3>
<p><strong>HanLPé…ç½®</strong>ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ä¸‹è½½HanLPæ•°æ®åŒ…ï¼Œé¿å…é¦–æ¬¡è°ƒç”¨åˆ†è¯æ—¶åŠ è½½ç¼“æ…¢ï¼›
<strong>å‘é‡é•¿åº¦é€‚é…</strong>ï¼šæ ¹æ®åµŒå…¥æ¨¡å‹çš„å‘é‡ç»´åº¦ï¼ˆå¦‚384/768ç»´ï¼‰è°ƒæ•´æœ€å¤§åˆ‡ç‰‡é•¿åº¦ï¼Œé¿å…å‘é‡ç‰¹å¾ä¸¢å¤±ï¼›
<strong>é‡å æ¯”ä¾‹è°ƒæ•´</strong>ï¼šæ ¹æ®æ–‡æ¡£ç±»å‹è°ƒæ•´é‡å æ¯”ä¾‹ï¼ˆæŠ€æœ¯æ–‡æ¡£å»ºè®®15%-20%ï¼Œé€šç”¨æ–‡æ¡£å»ºè®®10%ï¼‰ï¼›
<strong>ç›¸ä¼¼åˆå¹¶æ…ç”¨</strong>ï¼šå¯¹äºé«˜ç²¾å‡†åº¦è¦æ±‚çš„çŸ¥è¯†åº“ï¼ˆå¦‚æŠ€æœ¯æ‰‹å†Œï¼‰ï¼Œå»ºè®®å…³é—­ç›¸ä¼¼åˆ‡ç‰‡åˆå¹¶ï¼Œé¿å…è¯­ä¹‰ä¸¢å¤±ï¼›
<strong>ç›‘æ§å‘Šè­¦</strong>ï¼šç›‘æ§åˆ‡ç‰‡æ•°é‡ã€å‘é‡åŒ–æˆåŠŸç‡ã€ESå†™å…¥æˆåŠŸç‡ï¼Œå¼‚å¸¸æ—¶åŠæ—¶å‘Šè­¦ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ”¥ Redis ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©ï¼šåˆ«å†åªèƒŒå…«è‚¡æ–‡äº†ï¼Œå®æˆ˜ä»£ç æ•™ä½ å½»åº•è§£å†³ï¼]]></title>    <link>https://juejin.cn/post/7592550891540135955</link>    <guid>https://juejin.cn/post/7592550891540135955</guid>    <pubDate>2026-01-08T06:44:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592550891540135955" data-draft-id="7592555965792010246" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ”¥ Redis ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©ï¼šåˆ«å†åªèƒŒå…«è‚¡æ–‡äº†ï¼Œå®æˆ˜ä»£ç æ•™ä½ å½»åº•è§£å†³ï¼"/> <meta itemprop="keywords" content="åç«¯,æ¶æ„"/> <meta itemprop="datePublished" content="2026-01-08T06:44:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JOEH60"/> <meta itemprop="url" content="https://juejin.cn/user/1750078239803614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ”¥ Redis ç¼“å­˜ç©¿é€ã€å‡»ç©¿ã€é›ªå´©ï¼šåˆ«å†åªèƒŒå…«è‚¡æ–‡äº†ï¼Œå®æˆ˜ä»£ç æ•™ä½ å½»åº•è§£å†³ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1750078239803614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JOEH60
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:44:31.000Z" title="Thu Jan 08 2026 06:44:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨é¢è¯•ä¸­ï¼ŒRedis çš„â€œç¼“å­˜ä¸‰å…„å¼Ÿâ€ï¼ˆç©¿é€ã€å‡»ç©¿ã€é›ªå´©ï¼‰æ˜¯å¿…é—®è€ƒé¢˜ã€‚å¾ˆå¤šåŒå­¦èƒŒå¾—æ»šç“œçƒ‚ç†Ÿï¼Œä½†ä¸€åˆ°é¡¹ç›®å®æˆ˜ï¼Œä»£ç å†™å¾—æ¼æ´ç™¾å‡ºï¼Œçº¿ä¸Šæ•…éšœé¢‘å‘ã€‚</p>
<p>â€œè€æ¿ï¼Œæˆ‘çš„ç³»ç»Ÿå´©äº†ï¼Œæ•°æ®åº“ CPU é£™åˆ° 100% äº†ï¼â€<br/>
â€œä¸æ˜¯åŠ äº† Redis ç¼“å­˜å—ï¼Ÿâ€<br/>
â€œå‘ƒâ€¦â€¦å¥½åƒæ²¡é˜²ä½â€¦â€¦â€</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸è®²æ¯ç‡¥çš„ç†è®ºï¼Œç›´æ¥ä¸Š<strong>å®æˆ˜åœºæ™¯</strong>å’Œ<strong>ä»£ç æ–¹æ¡ˆ</strong>ï¼Œå¸¦ä½ å½»åº•æå®šè¿™ä¸‰ä¸ªç¼“å­˜æ€æ‰‹ï¼Œè®©ä½ çš„ç³»ç»Ÿç¨³å¦‚è€ç‹—ã€‚</p>
<h2 data-id="heading-0">ğŸ› ï¸ åœºæ™¯å‡è®¾</h2>
<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªç”µå•†ç³»ç»Ÿï¼Œæœ‰ä¸€ä¸ªæŸ¥è¯¢å•†å“è¯¦æƒ…çš„æ¥å£Â getProduct(Long id)ã€‚</p>
<ul>
<li><strong>æ•°æ®åº“</strong>ï¼šMySQL</li>
<li><strong>ç¼“å­˜</strong>ï¼šRedis</li>
<li><strong>å¹¶å‘é‡</strong>ï¼šé«˜å¹¶å‘åœºæ™¯</li>
</ul>
<h2 data-id="heading-1">1. ğŸ‘» ç¼“å­˜ç©¿é€ (Cache Penetration)</h2>
<p><strong>ç°è±¡</strong>ï¼š<br/>
æŸ¥è¯¢ä¸€ä¸ª<strong>æ ¹æœ¬ä¸å­˜åœ¨</strong>çš„æ•°æ®ï¼ˆä¾‹å¦‚Â id = -1ï¼‰ã€‚<br/>
Redis æŸ¥ä¸åˆ° -&gt; å»æŸ¥æ•°æ®åº“ -&gt; æ•°æ®åº“ä¹ŸæŸ¥ä¸åˆ°ã€‚<br/>
å¦‚æœæœ‰é»‘å®¢åˆ©ç”¨å¤§é‡ä¸å­˜åœ¨çš„ ID å‘èµ·æ”»å‡»ï¼Œè¯·æ±‚ä¼šå…¨éƒ¨æ‰“åˆ°æ•°æ®åº“ï¼Œç›´æ¥æŠŠæ•°æ®åº“æ‰“æŒ‚ã€‚</p>
<p><strong>é”™è¯¯å†™æ³•</strong>ï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-comment">// 1. æŸ¥ç¼“å­˜</span>
    <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(<span class="hljs-string">"product:"</span> + id);
    <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> product;
    }
    <span class="hljs-comment">// 2. æŸ¥æ•°æ®åº“</span>
    product = productMapper.selectById(id);
    <span class="hljs-comment">// 3. å†™å…¥ç¼“å­˜</span>
    <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
        redisTemplate.opsForValue().set(<span class="hljs-string">"product:"</span> + id, product);
    }
    <span class="hljs-keyword">return</span> product;
}
</code></pre>
<p>é—®é¢˜ï¼šå¦‚æœÂ productÂ ä¸º nullï¼Œå°±ä¸ä¼šå†™ç¼“å­˜ã€‚ä¸‹æ¬¡æŸ¥Â id=-1ï¼Œè¿˜æ˜¯ä¼šæ‰“åˆ°æ•°æ®åº“ã€‚</p>
<p><strong>âœ… è§£å†³æ–¹æ¡ˆ Aï¼šç¼“å­˜ç©ºå¯¹è±¡ (ç®€å•æœ‰æ•ˆ)</strong></p>
<p>å³ä½¿æ•°æ®åº“æŸ¥ä¸åˆ°ï¼Œä¹Ÿå¾€ Redis å­˜ä¸€ä¸ªÂ nullÂ æˆ–ç‰¹æ®Šæ ‡è®°ï¼Œå¹¶è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼ˆé˜²æ­¢æ•°æ®åæ¥çœŸçš„æœ‰äº†ï¼‰ã€‚</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product:"</span> + id;
    <span class="hljs-comment">// 1. æŸ¥ç¼“å­˜</span>
    <span class="hljs-type">Object</span> <span class="hljs-variable">cacheValue</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().get(key);
    <span class="hljs-keyword">if</span> (cacheValue != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// å¦‚æœæ˜¯ç©ºå¯¹è±¡æ ‡è®°ï¼Œç›´æ¥è¿”å› null</span>
        <span class="hljs-keyword">if</span> (cacheValue <span class="hljs-keyword">instanceof</span> NullValue) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> (Product) cacheValue;
    }
    
    <span class="hljs-comment">// 2. æŸ¥æ•°æ®åº“</span>
    <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productMapper.selectById(id);
    
    <span class="hljs-comment">// 3. å†™å…¥ç¼“å­˜</span>
    <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
        redisTemplate.opsForValue().set(key, product, <span class="hljs-number">30</span>, TimeUnit.MINUTES);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// å…³é”®ç‚¹ï¼šæ•°æ®åº“æ²¡æŸ¥åˆ°ï¼Œä¹Ÿç¼“å­˜ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œè¿‡æœŸæ—¶é—´è®¾ç½®çŸ­ä¸€ç‚¹ï¼ˆä¾‹å¦‚ 5 åˆ†é’Ÿï¼‰</span>
        redisTemplate.opsForValue().set(key, <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullValue</span>(), <span class="hljs-number">5</span>, TimeUnit.MINUTES);
    }
    <span class="hljs-keyword">return</span> product;
}
</code></pre>
<p><strong>âœ… è§£å†³æ–¹æ¡ˆ Bï¼šå¸ƒéš†è¿‡æ»¤å™¨ (Bloom Filter) (è¿›é˜¶)</strong></p>
<p>åœ¨è®¿é—® Redis ä¹‹å‰ï¼Œå…ˆç”¨å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­ ID æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨è¯´â€œä¸å­˜åœ¨â€ï¼Œé‚£å°±ä¸€å®šä¸å­˜åœ¨ï¼Œç›´æ¥è¿”å›ï¼Œè¿ Redis éƒ½ä¸ç”¨æŸ¥ã€‚<br/>
é€‚åˆæ•°æ®é‡å·¨å¤§ï¼Œä¸” ID ç›¸å¯¹å›ºå®šçš„åœºæ™¯ã€‚</p>
<h2 data-id="heading-2">2. ğŸ”¨ ç¼“å­˜å‡»ç©¿ (Cache Breakdown)</h2>
<p><strong>ç°è±¡</strong>ï¼š<br/>
ä¸€ä¸ª<strong>çƒ­ç‚¹ Key</strong>ï¼ˆä¾‹å¦‚â€œiPhone 16 å‘å¸ƒâ€ï¼‰ï¼Œåœ¨<strong>è¿‡æœŸçš„ä¸€ç¬é—´</strong>ï¼Œæœ‰å¤§é‡å¹¶å‘è¯·æ±‚åŒæ—¶è®¿é—®ã€‚<br/>
Redis æ²¡æ•°æ® -&gt; å¤§é‡è¯·æ±‚åŒæ—¶æ¶Œå…¥æ•°æ®åº“ã€‚<br/>
æ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§å´©æºƒã€‚</p>
<p><strong>é”™è¯¯å†™æ³•</strong>ï¼š<br/>
åŒä¸Šï¼Œæ™®é€šçš„Â get -&gt; db -&gt; setÂ é€»è¾‘æ— æ³•é˜²æ­¢å¹¶å‘å‡»ç©¿ã€‚</p>
<p><strong>âœ… è§£å†³æ–¹æ¡ˆï¼šäº’æ–¥é” (Mutex Lock)</strong></p>
<p>å½“ç¼“å­˜å¤±æ•ˆæ—¶ï¼Œä¸æ˜¯æ‰€æœ‰çº¿ç¨‹éƒ½å»æŸ¥æ•°æ®åº“ï¼Œè€Œæ˜¯<strong>åªè®©ä¸€ä¸ªçº¿ç¨‹</strong>å»æŸ¥ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> Product <span class="hljs-title function_">getProduct</span><span class="hljs-params">(Long id)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">"product:"</span> + id;
    <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"lock:product:"</span> + id;
    
    <span class="hljs-comment">// 1. æŸ¥ç¼“å­˜</span>
    <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> (Product) redisTemplate.opsForValue().get(key);
    <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> product;
    }
    
    <span class="hljs-comment">// 2. ç¼“å­˜æœªå‘½ä¸­ï¼Œå°è¯•è·å–åˆ†å¸ƒå¼é”</span>
    <span class="hljs-comment">// setIfAbsent ç›¸å½“äº SETNXï¼ŒåŸå­æ“ä½œ</span>
    <span class="hljs-type">Boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().setIfAbsent(lockKey, <span class="hljs-string">"1"</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);
    
    <span class="hljs-keyword">if</span> (isLock) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 3. è·å–é”æˆåŠŸï¼ŒæŸ¥è¯¢æ•°æ®åº“</span>
            product = productMapper.selectById(id);
            <span class="hljs-comment">// 4. é‡å»ºç¼“å­˜</span>
            <span class="hljs-keyword">if</span> (product != <span class="hljs-literal">null</span>) {
                redisTemplate.opsForValue().set(key, product, <span class="hljs-number">30</span>, TimeUnit.MINUTES);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// é˜²æ­¢ç©¿é€</span>
                redisTemplate.opsForValue().set(key, <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullValue</span>(), <span class="hljs-number">5</span>, TimeUnit.MINUTES);
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 5. é‡Šæ”¾é”</span>
            redisTemplate.delete(lockKey);
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 6. è·å–é”å¤±è´¥ï¼Œè¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨æŸ¥åº“ï¼Œä¼‘çœ ä¸€ä¼šå†é‡è¯•</span>
        <span class="hljs-keyword">try</span> {
            Thread.sleep(<span class="hljs-number">50</span>);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> getProduct(id); <span class="hljs-comment">// é€’å½’é‡è¯•</span>
    }
    <span class="hljs-keyword">return</span> product;
}
</code></pre>
<p>æ³¨ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨ Redisson å®ç°æ›´å¥å£®çš„åˆ†å¸ƒå¼é”ã€‚</p>
<h2 data-id="heading-3">3. â„ï¸ ç¼“å­˜é›ªå´© (Cache Avalanche)</h2>
<p><strong>ç°è±¡</strong>ï¼š<br/>
å¤§é‡ç¼“å­˜ Key åœ¨<strong>åŒä¸€æ—¶é—´é›†ä¸­è¿‡æœŸ</strong>ï¼Œæˆ–è€… RedisÂ <strong>å®•æœº</strong>ã€‚<br/>
æ­¤åˆ»å¤§é‡è¯·æ±‚å…¨éƒ¨æ‰“åˆ°æ•°æ®åº“ï¼Œå¯¼è‡´æ•°æ®åº“æŒ‚æ‰ã€‚</p>
<p><strong>é”™è¯¯å†™æ³•</strong>ï¼š</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-comment">// æ‰€æœ‰å•†å“éƒ½è®¾ç½®å›ºå®šçš„ 30 åˆ†é’Ÿè¿‡æœŸ</span>
redisTemplate.opsForValue().set(key, product, <span class="hljs-number">30</span>, TimeUnit.MINUTES);
</code></pre>
<p><strong>âœ… è§£å†³æ–¹æ¡ˆ Aï¼šéšæœºè¿‡æœŸæ—¶é—´</strong></p>
<p>ç»™æ¯ä¸ª Key çš„è¿‡æœŸæ—¶é—´åŠ ä¸Šä¸€ä¸ª<strong>éšæœºå€¼</strong>ï¼Œè®©å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€æ¥ã€‚</p>
<p>codeJava</p>
<pre><code class="hljs language-ini" lang="ini">// åŸºç¡€è¿‡æœŸæ—¶é—´ 30 åˆ†é’Ÿ
long <span class="hljs-attr">expireTime</span> = <span class="hljs-number">30</span> * <span class="hljs-number">60</span><span class="hljs-comment">; </span>
// éšæœºå¢åŠ  0-300 ç§’
long <span class="hljs-attr">randomTime</span> = new Random().nextInt(<span class="hljs-number">300</span>)<span class="hljs-comment">; </span>

redisTemplate.opsForValue().set(key, product, expireTime + randomTime, TimeUnit.SECONDS)<span class="hljs-comment">;</span>
</code></pre>
<p><strong>âœ… è§£å†³æ–¹æ¡ˆ Bï¼šé«˜å¯ç”¨æ¶æ„</strong></p>
<ul>
<li><strong>Redis å“¨å…µ (Sentinel) æˆ– é›†ç¾¤ (Cluster)</strong> ï¼šé˜²æ­¢ Redis å•ç‚¹æ•…éšœã€‚</li>
<li><strong>é™æµé™çº§ (Sentinel/Hystrix)</strong> ï¼šå¦‚æœ Redis çœŸçš„æŒ‚äº†ï¼Œé™åˆ¶è®¿é—®æ•°æ®åº“çš„æµé‡ï¼Œæˆ–è€…ç›´æ¥è¿”å›é»˜è®¤å€¼/é”™è¯¯æç¤ºï¼Œä¿ä½æ•°æ®åº“ã€‚</li>
</ul>
<h2 data-id="heading-4">ğŸ“ æ€»ç»“ä¸€å¼ è¡¨</h2>





























<table><thead><tr><th>é—®é¢˜</th><th>æ ¸å¿ƒåŸå› </th><th>è§£å†³æ–¹æ¡ˆ</th><th>å…³é”®è¯</th></tr></thead><tbody><tr><td><strong>ç©¿é€</strong></td><td>æŸ¥<strong>ä¸å­˜åœ¨</strong>çš„æ•°æ®</td><td>ç¼“å­˜ç©ºå¯¹è±¡ã€å¸ƒéš†è¿‡æ»¤å™¨</td><td>Null Object,Â Bloom Filter</td></tr><tr><td><strong>å‡»ç©¿</strong></td><td><strong>çƒ­ç‚¹ Key</strong>Â è¿‡æœŸ</td><td>äº’æ–¥é”ã€é€»è¾‘è¿‡æœŸ</td><td>Mutex Lock,Â SETNX</td></tr><tr><td><strong>é›ªå´©</strong></td><td><strong>å¤§é‡ Key</strong>Â åŒæ—¶è¿‡æœŸ</td><td>éšæœºè¿‡æœŸæ—¶é—´ã€é«˜å¯ç”¨é›†ç¾¤</td><td>Random TTL,Â Cluster</td></tr></tbody></table>
<h2 data-id="heading-5">ğŸ’¡ æ¶æ„å¸ˆå»ºè®®</h2>
<ol>
<li><strong>ä»£ç å¥å£®æ€§</strong>ï¼šä¸è¦åªä¾èµ– Redisï¼Œæ•°æ®åº“å±‚ä¹Ÿè¦æœ‰å…œåº•ä¿æŠ¤ï¼ˆå¦‚é™æµï¼‰ã€‚</li>
<li><strong>ç›‘æ§å‘Šè­¦</strong>ï¼šå¯¹ Redis çš„å‘½ä¸­ç‡ã€å†…å­˜ä½¿ç”¨ç‡ã€æ…¢æŸ¥è¯¢è¿›è¡Œç›‘æ§ï¼Œæå‰å‘ç°å¼‚å¸¸ã€‚</li>
<li><strong>ä¸è¦è¿‡åº¦è®¾è®¡</strong>ï¼šå¦‚æœæ˜¯å†…éƒ¨å°ç³»ç»Ÿï¼Œå¹¶å‘é‡å¾ˆä½ï¼Œç®€å•çš„ç¼“å­˜é€»è¾‘å°±å¤Ÿäº†ï¼Œä¸ç”¨éå¾—ä¸Šå¸ƒéš†è¿‡æ»¤å™¨å’Œåˆ†å¸ƒå¼é”ã€‚</li>
</ol>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½è®©ä½ åœ¨é¢å¯¹ Redis ç¼“å­˜é—®é¢˜æ—¶ï¼Œä¸å†åªæ˜¯èƒŒä¹¦ï¼Œè€Œæ˜¯èƒ½ä»å®¹åœ°å†™å‡ºé«˜è´¨é‡çš„å®æˆ˜ä»£ç ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[8 ä¸ª Python è‡ªåŠ¨åŒ–è„šæœ¬è®©ä½ å‘Šåˆ«é‡å¤åŠ³åŠ¨]]></title>    <link>https://juejin.cn/post/7592508079307210771</link>    <guid>https://juejin.cn/post/7592508079307210771</guid>    <pubDate>2026-01-08T06:46:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592508079307210771" data-draft-id="7592508079307178003" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="8 ä¸ª Python è‡ªåŠ¨åŒ–è„šæœ¬è®©ä½ å‘Šåˆ«é‡å¤åŠ³åŠ¨"/> <meta itemprop="keywords" content="åç«¯,Python"/> <meta itemprop="datePublished" content="2026-01-08T06:46:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ServBay"/> <meta itemprop="url" content="https://juejin.cn/user/3828929445244761"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            8 ä¸ª Python è‡ªåŠ¨åŒ–è„šæœ¬è®©ä½ å‘Šåˆ«é‡å¤åŠ³åŠ¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3828929445244761/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ServBay
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:46:10.000Z" title="Thu Jan 08 2026 06:46:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>AIçš„å‘å±•è¶Šæ¥è¶Šå‰å®³ï¼Œæ‰€ä»¥å¾ˆå¤šäººä¹Ÿä¹ æƒ¯æŠŠä»»åŠ¡ç›´æ¥ä¸¢ç»™AIã€‚ä½† AI åœ¨å¤„ç†è‡ªåŠ¨åŒ–ä»»åŠ¡æ—¶æœ‰æ—¶å€™è¿˜ä¼šä¸ç¨³å®šï¼Œæœ‰äº›è¿˜è¦æ”¶è´¹ã€‚å¯¹äºéœ€è¦æ¯å¤©å®šæ—¶è¿è¡Œã€å¤„ç†å¤§é‡æ–‡ä»¶æˆ–ç›‘æ§ç³»ç»ŸçŠ¶æ€çš„ä»»åŠ¡ï¼Œä¾é  AI æ¯æ¬¡ç”Ÿæˆç»“æœå®¹æ˜“å‡ºç°å¹»è§‰åå·®ã€‚</p>
<p>AIå¾ˆå¥½ï¼Œä½†å…¶å®æœ‰æ—¶å€™æ€é¸¡æ²¡å¿…è¦ç”¨ç‰›åˆ€ã€‚Python ä¸€æ ·å¯ä»¥å®Œæˆä¸€äº›ç®€å•çš„è‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3686c8befae4488e8ff55df77bb193c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768459569&amp;x-signature=JRL0M2nUg2%2FdyJknZEnnF%2Bv0kXM%3D" alt="" loading="lazy"/></p>
<p>åœ¨å†™ Python ä¹‹å‰ï¼Œè¦ç¡®ä¿ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fpython" target="_blank" title="https://www.servbay.com/features/python" ref="nofollow noopener noreferrer">Python çš„ç¯å¢ƒ</a>å·²ç»å‡†å¤‡å¥½ã€‚</p>
<p>æ¨èä½¿ç”¨ ServBay æ¥ç®¡ç†å¼€å‘ç¯å¢ƒï¼Œå®ƒæ”¯æŒä¸€é”®å®‰è£… Python ç¯å¢ƒï¼Œè¦†ç›–äº†ä»åŠåªè„šè¸è¿›æ£ºææ¿çš„ Python 2.7 åˆ°Python 3.5 ä¹ƒè‡³æœ€æ–°çš„ Python 3.14 ç‰ˆæœ¬ã€‚è€Œä¸”è¿™äº›ç‰ˆæœ¬å¯ä»¥åŒæ—¶å¹¶å­˜ï¼Œä¸éœ€è¦æ‰‹åŠ¨å»é…ç½®ç¯å¢ƒå˜é‡ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒå¼„ä¹±ç³»ç»Ÿçš„é»˜è®¤é…ç½®ã€‚è£…å¥½å°±èƒ½ç”¨ï¼Œä¸€åˆ†é’Ÿå°±èƒ½æå®šã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1edd7e2c752947da8b6d2b829d779bea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768459569&amp;x-signature=6iGnzV2kpU016y%2F6NRshrNkwfBo%3D" alt="" loading="lazy"/></p>
<p>æœ‰äº†ç¨³å®šçš„ç¯å¢ƒï¼Œä¸‹é¢åˆ†äº«å‡ ä¸ªåœ¨å®é™…å·¥ä½œä¸­å¸¸ç”¨çš„è‡ªåŠ¨åŒ–è„šæœ¬æ¨¡å¼ã€‚</p>
<h3 data-id="heading-0">è‡ªåŠ¨é‡è¯•æœºåˆ¶ï¼šè®©ç½‘ç»œè¯·æ±‚æ›´å¥å£®</h3>
<p>å†™çˆ¬è™«æˆ–è°ƒç”¨ API æ—¶ï¼Œç½‘ç»œæ³¢åŠ¨æ˜¯å¸¸æ€ã€‚ä¸å…¶åœ¨æ¯ä¸ªè¯·æ±‚å¤„éƒ½å†™ä¸€é <code>try-except</code>ï¼Œä¸å¦‚æŠŠé‡è¯•é€»è¾‘å°è£…èµ·æ¥ã€‚ä¸“ä¸šçš„è„šæœ¬ä¸ä¼šå› ä¸ºä¸€æ¬¡è¶…æ—¶å°±å´©æºƒã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> requests.exceptions <span class="hljs-keyword">import</span> RequestException

<span class="hljs-keyword">def</span> <span class="hljs-title function_">fetch_with_retry</span>(<span class="hljs-params">url, max_retries=<span class="hljs-number">3</span>, pause=<span class="hljs-number">2</span></span>):
    <span class="hljs-string">"""
    å¸¦æœ‰è‡ªåŠ¨é‡è¯•æœºåˆ¶çš„GETè¯·æ±‚
    """</span>
    <span class="hljs-keyword">for</span> attempt <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(max_retries):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># è®¾ç½®è¶…æ—¶æ˜¯å¿…é¡»çš„ï¼Œé˜²æ­¢ç¨‹åºæ— é™æŒ‚èµ·</span>
            response = requests.get(url, timeout=<span class="hljs-number">10</span>)
            response.raise_for_status() <span class="hljs-comment"># å¦‚æœçŠ¶æ€ç ä¸æ˜¯200ï¼ŒæŠ›å‡ºå¼‚å¸¸</span>
            <span class="hljs-keyword">return</span> response
        <span class="hljs-keyword">except</span> RequestException <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è¯·æ±‚å¤±è´¥ (å°è¯• <span class="hljs-subst">{attempt + <span class="hljs-number">1</span>}</span>/<span class="hljs-subst">{max_retries}</span>): <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">if</span> attempt == max_retries - <span class="hljs-number">1</span>:
                <span class="hljs-keyword">raise</span> <span class="hljs-comment"># æœ€åä¸€æ¬¡å°è¯•ä¹Ÿå¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸</span>
            time.sleep(pause)

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">try</span>:
    data = fetch_with_retry(<span class="hljs-string">"https://api.github.com"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è¯·æ±‚æˆåŠŸï¼ŒçŠ¶æ€ç : <span class="hljs-subst">{data.status_code}</span>"</span>)
<span class="hljs-keyword">except</span> RequestException:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"é‡è¯•å¤šæ¬¡åä¾ç„¶å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç›®æ ‡æœåŠ¡ã€‚"</span>)
</code></pre>
<p>å®ƒå°†ç½‘ç»œä¸ç¨³å®šçš„å¶å‘æ•…éšœåœ¨ä»£ç å±‚é¢æ¶ˆåŒ–ã€‚æœ€å¤§çš„å¥½å¤„æ˜¯é˜²æ­¢è„šæœ¬å› ä¸ºä¸€æ¬¡å¾®å°çš„ç½‘ç»œæŠ–åŠ¨å°±å…¨ç›˜å´©æºƒï¼ŒçœŸæ­£å®ç°äº†â€œæ— äººå€¼å®ˆâ€è¿è¡Œï¼Œç‰¹åˆ«é€‚åˆå¤œé—´æ‰¹é‡ä»»åŠ¡ã€‚</p>
<h3 data-id="heading-1">ä¾æ®æ–‡ä»¶å†…å®¹é‡å‘½å</h3>
<p>æœ‰æ—¶å€™æ–‡ä»¶åæ²¡æœ‰åŠæ—¶ä¿®æ”¹ï¼Œå°±ä¸çŸ¥é“è¿™ä¸ªæ–‡ä»¶åˆ°åº•æ˜¯ä»€ä¹ˆäº†ã€‚</p>
<p>ä½†ä¸€ä¸ªä¸ªæ‰“å¼€çœ‹åˆéå¸¸èŠ±æ—¶é—´ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™ä¸ªè„šæœ¬ï¼Œè®©å®ƒè¯»å–å†…å®¹å¹¶é‡å‘½åã€‚è¿™ä¸ªé€»è¾‘å¸¸ç”¨äºå¤„ç†å‘ç¥¨ã€æ—¥å¿—æˆ–è‡ªåŠ¨ç”Ÿæˆçš„æŠ¥å‘Šã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os

TARGET_DIR = <span class="hljs-string">"./reports"</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">clean_filename</span>(<span class="hljs-params">text</span>):
    <span class="hljs-comment"># å»é™¤æ–‡ä»¶åä¸­çš„éæ³•å­—ç¬¦</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>.join(c <span class="hljs-keyword">if</span> c.isalnum() <span class="hljs-keyword">else</span> <span class="hljs-string">"_"</span> <span class="hljs-keyword">for</span> c <span class="hljs-keyword">in</span> text)[:<span class="hljs-number">50</span>]

<span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> os.listdir(TARGET_DIR):
    full_path = os.path.join(TARGET_DIR, filename)
    
    <span class="hljs-comment"># ç¡®ä¿åªå¤„ç†æ–‡ä»¶</span>
    <span class="hljs-keyword">if</span> os.path.isfile(full_path):
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(full_path, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
                <span class="hljs-comment"># è¯»å–ç¬¬ä¸€è¡Œä½œä¸ºæ–°æ–‡ä»¶å</span>
                first_line = f.readline().strip()
                
            <span class="hljs-keyword">if</span> first_line:
                new_name = clean_filename(first_line) + <span class="hljs-string">".txt"</span>
                new_path = os.path.join(TARGET_DIR, new_name)
                
                <span class="hljs-comment"># é˜²æ­¢è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶</span>
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(new_path):
                    os.rename(full_path, new_path)
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é‡å‘½å: <span class="hljs-subst">{filename}</span> -&gt; <span class="hljs-subst">{new_name}</span>"</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ— æ³•å¤„ç†æ–‡ä»¶ <span class="hljs-subst">{filename}</span>: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<p>è§£å†³äº†æ–‡ä»¶åæ— æ„ä¹‰ï¼ˆå¦‚ <code>scan_001.txt</code>ï¼‰çš„ç—›ç‚¹ã€‚è„šæœ¬ç›´æ¥è¯»å–æ–‡ä»¶æ ¸å¿ƒå†…å®¹æ¥å‘½åï¼Œæ£€ç´¢æ–‡ä»¶æ—¶æ•ˆç‡å¾ˆé«˜ï¼Œä¸å†éœ€è¦é€ä¸ªæ‰“å¼€ç¡®è®¤ã€‚</p>
<h3 data-id="heading-2">æ¸…ç†é•¿æœŸæœªè®¿é—®çš„åƒµå°¸æ–‡ä»¶</h3>
<p>ç£ç›˜ç©ºé—´æ€»æ˜¯è«åå…¶å¦™å˜å°‘ï¼Œå¤šåŠæ˜¯å› ä¸ºé‚£äº›ä¸‹è½½åå°±å†æ²¡æ‰“å¼€è¿‡çš„ä¸´æ—¶æ–‡ä»¶ã€‚è¿™ä¸ªè„šæœ¬èƒ½æ¸…ç†é•¿æœŸæ²¡æœ‰è®¿é—®è¿‡çš„æ–‡ä»¶ï¼Œå®ƒæ˜¯ä¾æ®æœ€åè®¿é—®æ—¶é—´æ¥è¿è¡Œã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> time

WATCH_DIR = <span class="hljs-string">"/path/to/cleanup"</span>
EXPIRY_DAYS = <span class="hljs-number">180</span> <span class="hljs-comment"># 6ä¸ªæœˆæœªè®¿é—®åˆ™åˆ é™¤</span>
current_time = time.time()

<span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> os.listdir(WATCH_DIR):
    filepath = os.path.join(WATCH_DIR, filename)
    
    <span class="hljs-keyword">if</span> os.path.isfile(filepath):
        <span class="hljs-comment"># è·å–æœ€åè®¿é—®æ—¶é—´ (atime)</span>
        last_access_time = os.path.getatime(filepath)
        
        <span class="hljs-comment"># è®¡ç®—æ—¶é—´å·®</span>
        <span class="hljs-keyword">if</span> current_time - last_access_time &gt; (EXPIRY_DAYS * <span class="hljs-number">86400</span>):
            <span class="hljs-keyword">try</span>:
                os.remove(filepath)
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å·²åˆ é™¤é™ˆæ—§æ–‡ä»¶: <span class="hljs-subst">{filename}</span>"</span>)
            <span class="hljs-keyword">except</span> OSError <span class="hljs-keyword">as</span> e:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"åˆ é™¤å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
</code></pre>
<p>åŸºäºâ€œè®¿é—®æ—¶é—´â€è€Œéâ€œåˆ›å»ºæ—¶é—´â€åˆ¤æ–­ï¼Œè¿™éå¸¸å…³é”®ï¼Œå› ä¸ºå®ƒèƒ½ç²¾å‡†è¯†åˆ«é‚£äº›çœŸæ­£ä¸å†éœ€è¦çš„æ–‡ä»¶ã€‚å®ƒå°±åƒä¸€ä¸ªéšå½¢çš„æ¸…æ´å·¥ï¼Œé˜²æ­¢ç£ç›˜ç©ºé—´è¢«æ— ç”¨çš„ä¸´æ—¶æ•°æ®æ‚„æ‚„åƒå…‰ã€‚</p>
<h3 data-id="heading-3">ç›‘æ§å¹¶æŸ¥æ€é«˜è´Ÿè½½åƒµå°¸è¿›ç¨‹</h3>
<p>æœ‰äº› Python è„šæœ¬ï¼ˆå°¤å…¶æ˜¯æ¶‰åŠå¤šè¿›ç¨‹æˆ–æœºå™¨å­¦ä¹ ä»»åŠ¡çš„ï¼‰åœ¨æ„å¤–é€€å‡ºåä¼šç•™ä¸‹å­¤å„¿è¿›ç¨‹ï¼Œå ç”¨å¤§é‡ CPUã€‚æ‰‹åŠ¨æ‰“å¼€æ´»åŠ¨ç›‘è§†å™¨æŸ¥æ‰¾å¤ªæ…¢ï¼Œç›´æ¥ç”¨è„šæœ¬è‡ªæ£€ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> psutil

<span class="hljs-comment"># è®¾å®šé˜ˆå€¼ï¼šCPUå ç”¨è¶…è¿‡80%ä¸”è¿›ç¨‹åä¸ºpython</span>
CPU_THRESHOLD = <span class="hljs-number">80.0</span>
PROCESS_NAME = <span class="hljs-string">"python"</span>

<span class="hljs-keyword">for</span> proc <span class="hljs-keyword">in</span> psutil.process_iter([<span class="hljs-string">'pid'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'cpu_percent'</span>]):
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># psutilè·å–cpu_percenté€šå¸¸éœ€è¦intervalï¼Œè¿™é‡Œå–ç¬æ—¶å€¼å¯èƒ½éœ€è¦ä¸¤æ¬¡è°ƒç”¨æˆ–ç»“åˆå®é™…åœºæ™¯è°ƒæ•´</span>
        <span class="hljs-comment"># åœ¨è„šæœ¬å¾ªç¯ç›‘æ§ä¸­æ›´ä¸ºæœ‰æ•ˆ</span>
        <span class="hljs-keyword">if</span> proc.info[<span class="hljs-string">'name'</span>] <span class="hljs-keyword">and</span> PROCESS_NAME <span class="hljs-keyword">in</span> proc.info[<span class="hljs-string">'name'</span>].lower():
            <span class="hljs-keyword">if</span> proc.info[<span class="hljs-string">'cpu_percent'</span>] &gt; CPU_THRESHOLD:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ£€æµ‹åˆ°é«˜è´Ÿè½½åƒµå°¸è¿›ç¨‹ PID: <span class="hljs-subst">{proc.info[<span class="hljs-string">'pid'</span>]}</span> (CPU: <span class="hljs-subst">{proc.info[<span class="hljs-string">'cpu_percent'</span>]}</span>%)"</span>)
                proc.kill()
                <span class="hljs-built_in">print</span>(<span class="hljs-string">"å·²ç»ˆæ­¢è¿›ç¨‹ã€‚"</span>)
    <span class="hljs-keyword">except</span> (psutil.NoSuchProcess, psutil.AccessDenied):
        <span class="hljs-keyword">pass</span>
</code></pre>
<p>è¿™æ˜¯ä¸€ç§ä¸»åŠ¨é˜²å¾¡æœºåˆ¶ã€‚å®ƒè§£å†³äº†é•¿æ—¶é—´è¿è¡Œè„šæœ¬å¯èƒ½å¯¼è‡´çš„å†…å­˜æ³„æ¼æˆ–æ­»å¾ªç¯é—®é¢˜ï¼Œé¿å…äº†å› å•ä¸ªå¤±æ§è¿›ç¨‹æ‹–æ…¢æ•´ä¸ªç³»ç»Ÿï¼Œçœå»äº†ä½ æ‰‹åŠ¨æ‰“å¼€æ´»åŠ¨ç›‘è§†å™¨æ’æŸ¥çš„æ—¶é—´ã€‚</p>
<h3 data-id="heading-4">æ“ä½œå‰çš„åæ‚”è¯ï¼šè‡ªåŠ¨å¤‡ä»½</h3>
<p>åœ¨å¯¹é…ç½®æ–‡ä»¶æˆ–å…³é”®æ•°æ®è¿›è¡Œå†™å…¥æ“ä½œå‰ï¼Œå¤‡ä»½æ˜¯å¿…é¡»çš„ã€‚ä½†å¾€å¾€éƒ½æ˜¯å¿˜è®°äº†å¤‡ä»½ã€‚é‚£å°±æŠŠè‡ªåŠ¨åŒ–å¤‡ä»½äº¤ç»™Pythonå§ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> shutil
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">def</span> <span class="hljs-title function_">safe_backup</span>(<span class="hljs-params">filepath</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(filepath):
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ–‡ä»¶ä¸å­˜åœ¨: <span class="hljs-subst">{filepath}</span>"</span>)
        <span class="hljs-keyword">return</span>

    <span class="hljs-comment"># ç”Ÿæˆå¸¦æ—¶é—´æˆ³çš„å¤‡ä»½æ–‡ä»¶å</span>
    timestamp = time.strftime(<span class="hljs-string">"%Y%m%d_%H%M%S"</span>)
    backup_path = <span class="hljs-string">f"<span class="hljs-subst">{filepath}</span>.<span class="hljs-subst">{timestamp}</span>.bak"</span>
    
    <span class="hljs-keyword">try</span>:
        shutil.copy2(filepath, backup_path)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤‡ä»½å·²åˆ›å»º: <span class="hljs-subst">{backup_path}</span>"</span>)
    <span class="hljs-keyword">except</span> IOError <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å¤‡ä»½å¤±è´¥: <span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">raise</span> <span class="hljs-comment"># å¤‡ä»½å¤±è´¥åˆ™åº”è¯¥ä¸­æ–­åç»­æ“ä½œ</span>

<span class="hljs-comment"># ä½¿ç”¨åœºæ™¯ï¼šä¿®æ”¹é…ç½®å‰</span>
config_file = <span class="hljs-string">"app_config.yaml"</span>
safe_backup(config_file)
<span class="hljs-comment"># æ­¤å¤„æ‰§è¡Œå†™å…¥æ“ä½œ...</span>
</code></pre>
<p>æ‰§æ‰§è¡Œä»»ä½•ç ´åæ€§æ“ä½œï¼ˆå¦‚è¦†ç›–ã€å†™å…¥ï¼‰å‰å¼ºåˆ¶ç•™åº•ï¼Œè¿™æ˜¯ç”Ÿäº§ç¯å¢ƒä¸­æœ€åŸºæœ¬çš„å®‰å…¨æ³•åˆ™ï¼Œç¡®ä¿é”™è¯¯å‘ç”Ÿæ—¶èƒ½ç¬é—´å›æ»šã€‚</p>
<h3 data-id="heading-5">è„šæœ¬è¿è¡Œç»“æŸåçš„ç³»ç»Ÿé€šçŸ¥</h3>
<p>å¾ˆå¤šè„šæœ¬ä¸€è·‘å°±æ˜¯åŠå°æ—¶ï¼Œä½ ä¸å¯èƒ½ä¸€ç›´ç›¯ç€æ§åˆ¶å°ã€‚è®©è„šæœ¬è·‘å®Œåå¼¹çª—é€šçŸ¥ä½ ï¼Œæ˜¯æå‡å·¥ä½œä½“éªŒçš„å°ç»†èŠ‚ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> platform
<span class="hljs-keyword">import</span> os

<span class="hljs-keyword">def</span> <span class="hljs-title function_">send_notification</span>(<span class="hljs-params">title, text</span>):
    system_type = platform.system()
    
    <span class="hljs-keyword">if</span> system_type == <span class="hljs-string">"Darwin"</span>: <span class="hljs-comment"># macOS</span>
        <span class="hljs-comment"># ä½¿ç”¨ AppleScript è°ƒç”¨é€šçŸ¥</span>
        cmd = <span class="hljs-string">f"""osascript -e 'display notification "<span class="hljs-subst">{text}</span>" with title "<span class="hljs-subst">{title}</span>"'"""</span>
        os.system(cmd)
    <span class="hljs-keyword">elif</span> system_type == <span class="hljs-string">"Linux"</span>:
        <span class="hljs-comment"># Linux é€šå¸¸ä½¿ç”¨ notify-send</span>
        cmd = <span class="hljs-string">f"""notify-send "<span class="hljs-subst">{title}</span>" "<span class="hljs-subst">{text}</span>" """</span>
        os.system(cmd)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é€šçŸ¥: [<span class="hljs-subst">{title}</span>] <span class="hljs-subst">{text}</span>"</span>)

<span class="hljs-comment"># æ¨¡æ‹Ÿé•¿æ—¶é—´ä»»åŠ¡</span>
<span class="hljs-keyword">import</span> time
time.sleep(<span class="hljs-number">2</span>)
send_notification(<span class="hljs-string">"ä»»åŠ¡å®Œæˆ"</span>, <span class="hljs-string">"æ•°æ®å¤„ç†è„šæœ¬å·²æ‰§è¡Œå®Œæ¯•ã€‚"</span>)
</code></pre>
<p>å¼€å‘è€…ä¸éœ€è¦ç›¯ç€é»‘åº•ç™½å­—çš„æ§åˆ¶å°å‘å‘†ï¼Œå¯ä»¥å°†ç­‰å¾…è„šæœ¬ç»“æŸçš„åƒåœ¾æ—¶é—´è½¬åŒ–ä¸ºå¯è‡ªç”±æ”¯é…çš„æ—¶é—´ï¼Œä»»åŠ¡å®Œæˆäº†å®ƒä¼šä¸»åŠ¨æ‰¾ä½ ã€‚</p>
<h3 data-id="heading-6">è½»é‡çº§æ•°æ®é‡‡é›†</h3>
<p>å½“ä½ éœ€è¦ä»ç½‘é¡µä¸ŠæŠ“å–ç‰¹å®šå­—æ®µï¼ˆå¦‚ä»·æ ¼ã€æ ‡é¢˜ï¼‰å¹¶æ•´ç†æˆè¡¨æ ¼æ—¶ï¼ŒPython æ˜¯æœ€é«˜æ•ˆçš„å·¥å…·ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup
<span class="hljs-keyword">import</span> csv

<span class="hljs-keyword">def</span> <span class="hljs-title function_">scrape_data</span>(<span class="hljs-params">url, output_file</span>):
    <span class="hljs-comment"># ä¼ªè£… User-Agent é˜²æ­¢è¢«ç®€å•çš„åçˆ¬æ‹¦æˆª</span>
    headers = {<span class="hljs-string">'User-Agent'</span>: <span class="hljs-string">'Mozilla/5.0'</span>}
    
    <span class="hljs-keyword">try</span>:
        response = requests.get(url, headers=headers)
        soup = BeautifulSoup(response.content, <span class="hljs-string">'html.parser'</span>)
        
        <span class="hljs-comment"># å‡è®¾æˆ‘ä»¬è¦æŠ“å–æ–‡ç« åˆ—è¡¨ä¸­çš„æ ‡é¢˜å’Œé“¾æ¥</span>
        articles = soup.find_all(<span class="hljs-string">'article'</span>)
        data_rows = []
        
        <span class="hljs-keyword">for</span> article <span class="hljs-keyword">in</span> articles:
            title_tag = article.find(<span class="hljs-string">'h2'</span>)
            <span class="hljs-keyword">if</span> title_tag <span class="hljs-keyword">and</span> title_tag.a:
                title = title_tag.a.text.strip()
                link = title_tag.a[<span class="hljs-string">'href'</span>]
                data_rows.append([title, link])
        
        <span class="hljs-comment"># å†™å…¥CSV</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">'w'</span>, newline=<span class="hljs-string">''</span>, encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
            writer = csv.writer(f)
            writer.writerow([<span class="hljs-string">'æ ‡é¢˜'</span>, <span class="hljs-string">'é“¾æ¥'</span>])
            writer.writerows(data_rows)
            
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æˆåŠŸæŠ“å– <span class="hljs-subst">{<span class="hljs-built_in">len</span>(data_rows)}</span> æ¡æ•°æ®å¹¶ä¿å­˜è‡³ <span class="hljs-subst">{output_file}</span>"</span>)
        
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æŠ“å–è¿‡ç¨‹ä¸­å‡ºé”™: <span class="hljs-subst">{e}</span>"</span>)

<span class="hljs-comment"># ç¤ºä¾‹è°ƒç”¨</span>
<span class="hljs-comment"># scrape_data("http://example-blog.com", "results.csv")</span>
</code></pre>
<p>å°†å¤åˆ¶ç²˜è´´åŠ¨ä½œè½¬åŒ–ä¸ºç»“æ„åŒ–æ•°æ®æµã€‚ç›¸æ¯”äººå·¥ï¼Œå®ƒèƒ½ä»¥æ¯«ç§’çº§çš„é€Ÿåº¦å¤„ç†æˆç™¾ä¸Šåƒä¸ªé¡µé¢ï¼Œä¸”ç”Ÿæˆçš„æ•°æ®æ ¼å¼ï¼ˆå¦‚ CSVï¼‰ç»Ÿä¸€è§„æ•´ï¼Œç›´æ¥å¯ç”¨ã€‚ä½ å°±è¯´æ–¹ä¾¿ä¸æ–¹ä¾¿ã€‚</p>
<h3 data-id="heading-7">è‡ªåŠ¨åŒ–æ–‡ä»¶å½’ç±»</h3>
<p>æˆ‘ä¸çŸ¥é“ä½ çš„ç”µè„‘æ€ä¹ˆæ ·ï¼Œä½†æˆ‘çš„ä¸‹è½½æ–‡ä»¶å¤¹æ˜¯æœ€ä¹±çš„åœ°æ–¹ã€‚è€Œè¿™ä¸ªè„šæœ¬å¯ä»¥æ ¹æ®æ–‡ä»¶åç¼€ï¼Œè‡ªåŠ¨å°†æ–‡ä»¶ç§»åŠ¨åˆ°å¯¹åº”çš„åˆ†ç±»æ–‡ä»¶å¤¹ä¸­ã€‚ä¸ç”¨è‡ªå·±ä¸€ä¸ªä¸ªç”¨æ‰‹æ‹–ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> shutil
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path

SOURCE_DIR = Path(<span class="hljs-string">"/Users/username/Downloads/MixedData"</span>)
DEST_DIR = Path(<span class="hljs-string">"/Users/username/Documents/Sorted"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">organize_files</span>():
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> SOURCE_DIR.exists():
        <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">for</span> file_path <span class="hljs-keyword">in</span> SOURCE_DIR.iterdir():
        <span class="hljs-keyword">if</span> file_path.is_file():
            <span class="hljs-comment"># è·å–æ‰©å±•åï¼Œä¾‹å¦‚ .pdf</span>
            ext = file_path.suffix.lower()
            
            <span class="hljs-keyword">if</span> ext: <span class="hljs-comment"># å¿½ç•¥æ— åç¼€æ–‡ä»¶</span>
                <span class="hljs-comment"># å»æ‰ç‚¹å·ï¼Œä½œä¸ºæ–‡ä»¶å¤¹åï¼Œä¾‹å¦‚ pdf</span>
                folder_name = ext[<span class="hljs-number">1</span>:].upper() + <span class="hljs-string">"_Files"</span>
                target_folder = DEST_DIR / folder_name
                
                <span class="hljs-comment"># åˆ›å»ºç›®æ ‡æ–‡ä»¶å¤¹</span>
                target_folder.mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)
                
                <span class="hljs-comment"># ç§»åŠ¨æ–‡ä»¶</span>
                <span class="hljs-keyword">try</span>:
                    shutil.move(<span class="hljs-built_in">str</span>(file_path), <span class="hljs-built_in">str</span>(target_folder / file_path.name))
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç§»åŠ¨: <span class="hljs-subst">{file_path.name}</span> -&gt; <span class="hljs-subst">{folder_name}</span>"</span>)
                <span class="hljs-keyword">except</span> shutil.Error <span class="hljs-keyword">as</span> e:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç§»åŠ¨æ–‡ä»¶å‡ºé”™: <span class="hljs-subst">{e}</span>"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    organize_files()
</code></pre>
<p>æ–‡ä»¶ä¹Ÿæœ‰æ”¶çº³å¸ˆï¼Œè¿˜æ˜¯å…è´¹çš„ã€‚å®ƒåˆ©ç”¨æ–‡ä»¶æ‰©å±•åè¿™ä¸€æœ€åŸºç¡€çš„å…ƒæ•°æ®ï¼Œç¬é—´å°†æ··ä¹±çš„ä¸‹è½½ç›®å½•å˜å¾—äº•äº•æœ‰æ¡ï¼Œæå¤§åœ°å‡å°‘äº†äººå·¥æ•´ç†æ–‡ä»¶çš„è®¤çŸ¥è´Ÿæ‹…ã€‚</p>
<h3 data-id="heading-8">æ€»ç»“</h3>
<p>è¿™äº›è„šæœ¬å¹¶ä¸å¤æ‚ï¼Œä½†å®ƒä»¬æ„æˆäº†è‡ªåŠ¨åŒ–å·¥ä½œæµçš„åŸºç¡€ã€‚ä»ç¯å¢ƒæ­å»ºå¼€å§‹ï¼Œä½¿ç”¨ ServBay è§£å†³ç‰ˆæœ¬å…±å­˜çš„ç—›ç‚¹ï¼Œå†é…åˆè¿™äº›ç¨³å¥çš„ä»£ç é€»è¾‘ï¼Œå°±å¯ä»¥æŠŠå¤§é‡è€—æ—¶çš„é‡å¤åŠ³åŠ¨äº¤ç»™æœºå™¨ã€‚çœŸæ­£çš„ç¨‹åºå‘˜ä¸æ˜¯æ‰“å­—æœ€å¿«çš„äººï¼Œè€Œæ˜¯æ‡‚å¾—å¦‚ä½•è®©ä»£ç æ›¿è‡ªå·±å·¥ä½œçš„äººã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘ç”¨æ–‡å¿ƒå¿«ç å¼€å‘äº†ä¸€æ¬¾ã€Œç§¯æœ¨å·¥åŠã€ï¼šç”¨AIè®©æ¯ä¸ªå­©å­éƒ½æˆä¸ºå°å°å»ºç­‘å¸ˆ]]></title>    <link>https://juejin.cn/post/7592518897464999988</link>    <guid>https://juejin.cn/post/7592518897464999988</guid>    <pubDate>2026-01-08T06:56:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592518897464999988" data-draft-id="7592500570167820323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘ç”¨æ–‡å¿ƒå¿«ç å¼€å‘äº†ä¸€æ¬¾ã€Œç§¯æœ¨å·¥åŠã€ï¼šç”¨AIè®©æ¯ä¸ªå­©å­éƒ½æˆä¸ºå°å°å»ºç­‘å¸ˆ"/> <meta itemprop="keywords" content="å‰ç«¯,å‰ç«¯æ¡†æ¶"/> <meta itemprop="datePublished" content="2026-01-08T06:56:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ–‡å¿ƒå¿«ç BaiduComate"/> <meta itemprop="url" content="https://juejin.cn/user/992209294070809"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘ç”¨æ–‡å¿ƒå¿«ç å¼€å‘äº†ä¸€æ¬¾ã€Œç§¯æœ¨å·¥åŠã€ï¼šç”¨AIè®©æ¯ä¸ªå­©å­éƒ½æˆä¸ºå°å°å»ºç­‘å¸ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/992209294070809/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ–‡å¿ƒå¿«ç BaiduComate
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:56:46.000Z" title="Thu Jan 08 2026 06:56:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>ä½œè€…ç®€ä»‹</strong></p>
<p>è©¹æ—å³°ï¼Œå…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆï¼Œç§¯ææ‹¥æŠ± Vibe Codingï¼Œä¸“æ³¨æ¢ç´¢ AI IDE ä¸å…¨æ ˆå¼€å‘å…¨æµç¨‹çš„æ·±åº¦èåˆ â€”â€” ä»å‰ç«¯ç•Œé¢å®ç°ã€ç§»åŠ¨ç«¯é€‚é…åˆ°åç«¯é€»è¾‘å¼€å‘ã€æ•°æ®åº“ä¼˜åŒ–ï¼Œå°† AI èµ‹èƒ½ææ•ˆè½åœ°äºæ¯ä¸€ä¸ªç¯èŠ‚ã€‚ä½œå“ã€Œç§¯æœ¨å·¥åŠã€å…¥å›´â€œCCFç¨‹åºå‘˜å¤§ä¼šç åŠ›å…¨å¼€ï¼šAIåŠ é€Ÿè¥â€æ´»åŠ¨å†³èµ›ï¼Œå¹¶è·å¾—â€œæœ€ä½³å•†ä¸šä»·å€¼å¥–â€ ã€‚</p>
</blockquote>
<p>åˆè¡·ï¼šåœ¨è¿™ä¸ªæ•°å­—åŒ–çš„æ—¶ä»£ï¼Œæˆ‘æƒ³åšä¸€ä»¶æœ‰æ„ä¹‰çš„äº‹â€”â€”è®©æ¯ä¸€ä¸ªå­©å­éƒ½èƒ½å¹³ç­‰åœ°è·å¾—ä¼˜è´¨çš„åˆ›æ„å¯è’™èµ„æºï¼Œä¸å—å®¶åº­æ¡ä»¶çš„é™åˆ¶ï¼Œæ„Ÿå—åˆ›é€ çš„å¿«ä¹ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆè¦åšç§¯æœ¨å·¥åŠï¼Ÿ</h2>
<p>å®ä½“ç§¯æœ¨å¤ªè´µï¼Œä¸€å¥—å¥½å‡ ç™¾ç”šè‡³ä¸Šåƒï¼›</p>
<p>ç§¯æœ¨æ•£è½ä¸€åœ°ï¼Œæ”¶çº³æˆå®¶é•¿æ¯å¤©çš„"å™©æ¢¦"ï¼›</p>
<p>åˆ›æ„æœ‰é™ï¼Œå­©å­å¾ˆå¿«å°±å¯¹ç°æœ‰ç§¯æœ¨æ„Ÿåˆ°åŒå€¦ï¼›</p>
<p>å¤–å‡ºæ¸¸ç©æ—¶ï¼Œæ— æ³•å¸¦ä¸Šæ²‰é‡çš„ç§¯æœ¨ç©å…·ã€‚</p>
<p>åˆšå‡ºæ¥å·¥ä½œçš„æ—¶å€™ï¼Œæˆ‘æ›¾åšè¿‡å°‘å„¿ç¼–ç¨‹å’Œåœ°æ¨å·¥ä½œï¼Œè§è¯†åˆ°å¾ˆå¤šå­©å­å¯¹æ–°é²œäº‹ç‰©çš„å¥½å¥‡å¿ƒï¼Œä½†ä¹Ÿçœ‹åˆ°äº†æ•™è‚²èµ„æºçš„å·¨å¤§å·®å¼‚ã€‚æœ‰äº›å­©å­ä»å°å°±æ¥è§¦å„ç§ç¼–ç¨‹ç©å…·å’Œåˆ›æ„å·¥å…·ï¼Œè€Œå¦ä¸€äº›å­©å­è¿æœ€åŸºæœ¬çš„ç§¯æœ¨éƒ½æ²¡æ‘¸è¿‡ã€‚æ›´è®©æˆ‘è§¦åŠ¨çš„æ˜¯ï¼Œæœ‰æ¬¡å»åŒ»é™¢çš„æ—¶å€™ï¼Œçœ‹è§å¾ˆå°çš„å°æœ‹å‹ä¹Ÿåœ¨åˆ·æŠ–éŸ³ï¼Œä»–ä»¬çš„æ³¨æ„åŠ›è¢«ç®—æ³•ç‰¢ç‰¢æ§åˆ¶ï¼Œå´ç¼ºä¹çœŸæ­£æœ‰æ„ä¹‰çš„åˆ›æ„æ´»åŠ¨ã€‚</p>
<p>æˆ‘æƒ³æ”¹å˜è¿™ç§çŠ¶å†µã€‚æˆ‘å¸Œæœ›é€šè¿‡æŠ€æœ¯æ‰‹æ®µï¼Œæ‰“é€ ä¸€ä¸ªè½»é‡åŒ–ã€é«˜ä»·å€¼çš„æ•°å­—ç§¯æœ¨å¹³å°ï¼Œè®©æ¯ä¸ªå­©å­éƒ½èƒ½æ‹¥æœ‰æ— é™çš„åˆ›æ„ç©ºé—´ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ¸¸æˆï¼Œæ›´æ˜¯ä¸ºäº†è®©æ¯ä¸ªå­©å­éƒ½èƒ½åœ¨èµ·è·‘çº¿ä¸Šè·å¾—å…¬å¹³çš„åˆ›æ„å¯è’™æœºä¼šï¼Œç”¨åˆ›é€ æ€§çš„æ•°å­—ä½“éªŒæ›¿ä»£è¢«åŠ¨çš„å¨±ä¹æ¶ˆè´¹ã€‚</p>
<p>æƒ³æ³•å¾ˆç¾å¥½ï¼Œä½†ç°å®å¾ˆéª¨æ„Ÿã€‚æˆ‘æ˜¯ä¸€ä¸ªç‹¬ç«‹å¼€å‘è€…ï¼Œæ—¶é—´å’Œç²¾åŠ›éƒ½éå¸¸æœ‰é™ã€‚è¦å¼€å‘ä¸€ä¸ªè·¨å¹³å°çš„3Dåº”ç”¨ï¼Œéœ€è¦æŒæ¡Flutterã€Three.jsã€3Dæ•°å­¦è®¡ç®—ã€å¤šå¹³å°é€‚é…ç­‰å¤æ‚æŠ€æœ¯æ ˆã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘è¦å¦‚ä½•åœ¨æœ‰é™çš„æ—¶é—´å†…ï¼Œæ‰“é€ ä¸€ä¸ªçœŸæ­£ç¬¦åˆå„¿ç«¥å¿ƒç†ã€æ“ä½œç®€å•ã€åŠŸèƒ½ä¸°å¯Œçš„åº”ç”¨ï¼Ÿå°±åœ¨è¿™æ—¶ï¼Œæˆ‘é‡åˆ°äº†ç™¾åº¦æ–‡å¿ƒå¿«ç ï¼ˆComateï¼‰ï¼Œå®ƒæˆä¸ºäº†æˆ‘çš„ç ´å±€å…³é”®ã€‚</p>
<h2 data-id="heading-1">äºŒã€æ–‡å¿ƒå¿«ç ï¼šæˆ‘çš„æŠ€æœ¯åˆä¼™äºº</h2>
<p>åœ¨è¿™æ¬¡å¼€å‘ä¸­ï¼Œæ–‡å¿ƒå¿«ç ä¸å†æ˜¯ç®€å•çš„ä»£ç è¡¥å…¨å·¥å…·ï¼Œè€Œæ˜¯æˆ‘çš„"å…¨èƒ½æŠ€æœ¯åˆä¼™äºº"ã€‚é¡¹ç›®å§‹äºä¸€ä¸ªç®€å•çš„æƒ³æ³•ï¼šè®©æ¯ä¸ªå­©å­éƒ½èƒ½è½»æ¾åˆ›é€ 3Dç§¯æœ¨ä½œå“ã€‚ä½œä¸ºæŠ€æœ¯è´Ÿè´£äººï¼Œæˆ‘é¦–å…ˆä¸ºAIè®¾å®šäº†æ˜ç¡®çš„è§’è‰²ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de930634441848a4b0d8002fd7702bca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=JynY8RR8gGzP%2B12sFiMbChPeomg%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>åŒæ—¶ï¼Œæˆ‘å‘AIæä¾›äº†Flutterå¼€å‘è§„èŒƒæ–‡æ¡£ï¼Œç¡®ä¿æ‰€æœ‰ä»£ç éƒ½ç¬¦åˆè¡Œä¸šæ ‡å‡†å’Œæœ€ä½³å®è·µï¼Œä¸ºäº†ç¡®ä¿AIç†è§£æˆ‘çš„éœ€æ±‚ï¼Œæˆ‘è®©AIå…ˆå†™äº†ä¸€ä¸ªå®ƒç†è§£æˆ‘æƒ³åšçš„PRDæ–‡æ¡£ï¼Œå¹¶ä¸”åˆ†ææ¡†æ¶çš„å®ç°ã€‚</p>
<p>è¿™ä¸€è¿‡ç¨‹åˆ»æ„å°†ã€Œéœ€æ±‚å¯¹é½ã€å‰ç½®ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿›å…¥ç¼–ç é˜¶æ®µã€‚å®è·µè¯æ˜ï¼š<strong>å…ˆè®© AI æ˜ç¡®éœ€æ±‚ã€å’Œæˆ‘å¯¹é½è¾¹ç•Œå’Œè®¾è®¡å–èˆï¼Œå†è¿›å…¥ä»£ç ç”Ÿæˆï¼Œä¸ä»…èƒ½æ˜¾è‘—å‡å°‘è¿”å·¥ï¼Œè¿˜èƒ½è®©äº§å‡ºæ›´è´´è¿‘çœŸå®äº§å“ç›®æ ‡ï¼Œåœ¨å¤æ‚ç³»ç»Ÿå’Œä¸­å¤§å‹ PRD åœºæ™¯ä¸‹æ•ˆæœå°¤ä¸ºæ˜æ˜¾ã€‚</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb9ad342e2a24c5ba5a98d6ccf48b13f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=tDJiwH%2Fyr3PIyRwlOAZF5kGVK5U%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-2">1 è®©AIæ ¹æ®PRDæ–‡æ¡£å®ç°ä¸€ä¸ªmvpç‰ˆæœ¬æœ€åˆçš„3Då±•ç¤º</h3>
<p>ç¬¬ä¸€ä¸ªæŠ€æœ¯æŒ‘æˆ˜æ˜¯å¦‚ä½•åœ¨Flutterä¸­é›†æˆ3Dæ¸²æŸ“ï¼Œæˆ‘è®©å®ƒå…ˆå®ç°åŸºæœ¬çš„three.jsæ¡†æ¶åŠ è½½, è¿™ä¸ªåŠ è½½æˆåŠŸï¼Œåé¢åŠŸèƒ½å°±æ…¢æ…¢å†ç»†åˆ†äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deeb44036dc84ed999a8f046c7d26432~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=NQSr6GjSXaCZUSIsRFt7mNhdT8g%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>ä¸€æ¬¡å°±æˆåŠŸåŠ è½½æœ¬åœ°three äº†ï¼Œä¸‹ä¸€æ­¥ç»§ç»­è®©å®ƒå®ç°æ–‡æ¡£ä¸­çš„ç§¯æœ¨æ·»åŠ ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/402381023b1642d4bdbe88edb34ca110~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=0y64zxh89yF%2FmDmpKyfbiDYADY8%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>è¿‡ç¨‹ä¸­é‡åˆ°å¾ˆå¤šé—®é¢˜ï¼Œæ¯”ç§¯æœ¨çš„æ¨¡å‹æ€ä¹ˆæ·»åŠ ï¼Œé€šè¿‡AIäº†è§£åˆ° three.jså¯ä»¥ç”¨ä»£ç ç¼–å†™ç®€å•çš„æ¨¡å‹ï¼Œç§¯æœ¨çš„å‡¸ç‚¹æ€ä¹ˆæ·»åŠ ç­‰ã€‚æˆ‘ä¸æ€¥è®©å®ƒå…ˆå†™ï¼Œè€Œæ˜¯åšå‡ºåˆ†æä¸æœ€ä½³é€‰æ‹©ç»™æˆ‘ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df32607ae48f4d3896ebcece0bbce22f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=1fmatQvvWxymiBjJRNuq6MPR4lU%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>é‡åˆ°é—®é¢˜ï¼Œç²˜è´´æŠ¥é”™è®©AIç›´æ¥ä¿®å¤</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f12ddfb9be442388d221b3dac1a6ed2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=uGcaoPopH75A6squaEnUlZuiU34%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-3">2 æå®šå¤æ‚çš„3Dæ¸²æŸ“</h3>
<p>3Dç§¯æœ¨æ¸²æŸ“æ˜¯æ•´ä¸ªé¡¹ç›®çš„æŠ€æœ¯æ ¸å¿ƒï¼Œæ¶‰åŠåˆ°å¤æ‚çš„3Dæ•°å­¦è®¡ç®—å’Œå›¾å½¢å­¦çŸ¥è¯†ã€‚æˆ‘å‘Šè¯‰Comateï¼š"è¦æ”¯æŒç§¯æœ¨çš„æ‹–æ‹½ã€æ—‹è½¬ã€ç¢°æ’æ£€æµ‹ï¼Œå¸®æˆ‘æ‰¾åˆé€‚çš„æ–¹æ¡ˆï¼Œå…ˆä¸è¦ä¿®æ”¹ã€‚"å®ƒæå‡ºäº†å¥½å‡ ç§ç®—æ³•ï¼Œæˆ‘ç¡®è®¤æ²¡é—®é¢˜åï¼Œå†è®©AIå¼€å·¥ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29947002f65d4fd6aefa4f9276f7efb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=kd%2BUE%2FibHV08BojwrzKot1wNGNs%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>å‡ ç§’é’Ÿåï¼Œå®ƒç”Ÿæˆäº†å®Œæ•´çš„3Dæ¸²æŸ“å¼•æ“ä»£ç ä¸ç®—æ³•ç¢°æ’å®ç°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LegoRenderer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">container</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scene</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Scene</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">camera</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">PerspectiveCamera</span>(<span class="hljs-number">75</span>, <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> / <span class="hljs-variable language_">window</span>.<span class="hljs-property">innerHeight</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span> = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">WebGLRenderer</span>({ <span class="hljs-attr">antialias</span>: <span class="hljs-literal">true</span> });
    
    <span class="hljs-comment">// AIæ™ºèƒ½å»ºè®®ï¼šå¯ç”¨é˜´å½±æ•ˆæœï¼Œæå‡çœŸå®æ„Ÿ</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span>.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">enabled</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderer</span>.<span class="hljs-property">shadowMap</span>.<span class="hljs-property">type</span> = <span class="hljs-variable constant_">THREE</span>.<span class="hljs-property">PCFSoftShadowMap</span>;
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupLighting</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initControls</span>();
  }
  
  <span class="hljs-comment">// AIç”Ÿæˆçš„æ™ºèƒ½ç¢°æ’æ£€æµ‹</span>
  <span class="hljs-title function_">checkCollision</span>(<span class="hljs-params">position, size</span>) {
    <span class="hljs-keyword">const</span> box = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Box3</span>().<span class="hljs-title function_">setFromCenterAndSize</span>(
      <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector3</span>(...position),
      <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Vector3</span>(...size)
    );
    
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">bricks</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">brick</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> brickBox = <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">THREE</span>.<span class="hljs-title class_">Box3</span>().<span class="hljs-title function_">setFromObject</span>(brick.<span class="hljs-property">mesh</span>);
      <span class="hljs-keyword">return</span> box.<span class="hljs-title function_">intersectsBox</span>(brickBox);
    });
  }
}
</code></pre>
<p>æˆ‘å‡ ä¹ä¸€è¡Œæ²¡æ”¹ï¼Œç›´æ¥è¿è¡ŒæˆåŠŸã€‚ è¿™è®©æˆ‘è¿™ä¸ªå¯¹3Då›¾å½¢å­¦ä¸å¤ªç†Ÿæ‚‰çš„å¼€å‘è€…ï¼Œä¹Ÿèƒ½å¿«é€Ÿæ„å»ºå‡ºä¸“ä¸šçš„3Dæ¸²æŸ“æ•ˆæœã€‚</p>
<h3 data-id="heading-4">3 è®¾è®¡å„¿ç«¥å‹å¥½çš„ç•Œé¢</h3>
<p>æˆ‘å¾ˆæ¸…æ¥šï¼Œè¿™ä¸ªåº”ç”¨çš„ç”¨æˆ·æ˜¯å­©å­ï¼Œç•Œé¢å¿…é¡»ç®€å•ã€ç›´è§‚ã€æœ‰è¶£ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/848152acf3914f60b2f44b22c44efd77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=EY9cRZ3hefA3WsxkRS1OrNvNG0g%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0945191eaa3478caf47004f9175e760~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=W9IjrkJR6ro7KXaiKZKLio4w%2BHk%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>æˆ‘å‘Šè¯‰Comateï¼š"è®¾è®¡ä¸€ä¸ªé€‚åˆå„¿ç«¥çš„ç§¯æœ¨é€‰æ‹©ç•Œé¢ï¼Œè¦æœ‰å¤§æŒ‰é’®ã€é²œè‰³é¢œè‰²ï¼Œæ”¯æŒæ‹–æ‹½æ“ä½œã€‚"</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e1b5b1a536f472ebe3c5b0896be9962~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=RcWLUPXd7hSxkoeK74gOp7Hm7cE%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>å®ƒç”Ÿæˆçš„ç•Œé¢ä¸ä»…ç¬¦åˆæˆ‘çš„è¦æ±‚ï¼Œè¿˜è‡ªåŠ¨è€ƒè™‘äº†å„¿ç«¥çš„ä½¿ç”¨ä¹ æƒ¯ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// AIç”Ÿæˆçš„å„¿ç«¥å‹å¥½ç•Œé¢</span>
<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">BrickSelector</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">StatelessWidget</span> {
  <span class="hljs-selector-tag">Widget</span> <span class="hljs-selector-tag">_buildBrickButton</span>(BrickShape shape) {
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">GestureDetector</span>(
      <span class="hljs-attribute">onTap</span>: () =&gt; <span class="hljs-built_in">_selectShape</span>(shape),
      <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Container</span>(
        <span class="hljs-attribute">width</span>: <span class="hljs-number">80</span>,
        <span class="hljs-attribute">height</span>: <span class="hljs-number">80</span>,
        <span class="hljs-attribute">decoration</span>: <span class="hljs-built_in">BoxDecoration</span>(
          <span class="hljs-comment">// AIå»ºè®®ï¼šå¤§å°ºå¯¸ï¼Œä¾¿äºå„¿ç«¥ç‚¹å‡»</span>
          <span class="hljs-attribute">borderRadius</span>: BorderRadius.<span class="hljs-built_in">circular</span>(<span class="hljs-number">16</span>),
          <span class="hljs-comment">// AIå»ºè®®ï¼šé²œè‰³çš„é¢œè‰²ï¼Œå¸å¼•æ³¨æ„åŠ›</span>
          <span class="hljs-attribute">gradient</span>: <span class="hljs-built_in">LinearGradient</span>(
            <span class="hljs-attribute">colors</span>: [
              <span class="hljs-built_in">_getPrimaryColor</span>(shape.id),
              <span class="hljs-built_in">_getSecondaryColor</span>(shape.id),
            ],
          ),
          <span class="hljs-comment">// AIå»ºè®®ï¼šæ˜æ˜¾çš„é˜´å½±æ•ˆæœï¼Œæä¾›ç«‹ä½“æ„Ÿ</span>
          <span class="hljs-attribute">boxShadow</span>: [
            <span class="hljs-built_in">BoxShadow</span>(
              <span class="hljs-attribute">color</span>: Colors.black.<span class="hljs-built_in">withOpacity</span>(<span class="hljs-number">0.2</span>),
              <span class="hljs-attribute">blurRadius</span>: <span class="hljs-number">8</span>,
              <span class="hljs-attribute">offset</span>: const <span class="hljs-built_in">Offset</span>(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>),
            ),
          ],
        ),
        <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Column</span>(
          <span class="hljs-attribute">mainAxisAlignment</span>: MainAxisAlignment.center,
          <span class="hljs-attribute">children</span>: [
            <span class="hljs-built_in">Icon</span>(
              <span class="hljs-built_in">_getBrickIcon</span>(shape.id),
              <span class="hljs-attribute">size</span>: <span class="hljs-number">32</span>,
              <span class="hljs-attribute">color</span>: Colors.white,
            ),
            const <span class="hljs-built_in">SizedBox</span>(<span class="hljs-attribute">height</span>: <span class="hljs-number">4</span>),
            <span class="hljs-built_in">Text</span>(
              shape.name,
              <span class="hljs-attribute">style</span>: const <span class="hljs-built_in">TextStyle</span>(
                <span class="hljs-attribute">fontSize</span>: <span class="hljs-number">12</span>,
                <span class="hljs-attribute">fontWeight</span>: FontWeight.bold,
                <span class="hljs-attribute">color</span>: Colors.white,
              ),
            ),
          ],
        ),
      ),
    );
  }
}
</code></pre>
<h2 data-id="heading-5">ä¸‰ã€è¿™æ¬¾åº”ç”¨åˆ°åº•æœ‰ä»€ä¹ˆï¼Ÿ</h2>
<p>åœ¨Comateçš„åŠ é€Ÿä¸‹ï¼Œç§¯æœ¨å·¥åŠçš„å®Œæˆåº¦è¿œè¶…æˆ‘çš„é¢„æœŸã€‚å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°å­—ç§¯æœ¨ï¼Œæ›´æ˜¯ä¸€ä¸ªåˆ›æ„å¯è’™çš„"ç‘å£«å†›åˆ€"ã€‚</p>
<h3 data-id="heading-6">1 æ— é™åˆ›æ„ç©ºé—´</h3>
<ul>
<li>ä¸°å¯Œçš„ç§¯æœ¨ç±»å‹ï¼šæ ‡å‡†ç§¯æœ¨ã€çŸ®ç§¯æœ¨ã€å¸¦è½®å­ç§¯æœ¨ç­‰å¤šç§é€‰æ‹©</li>
<li>12ç§é²œè‰³é¢œè‰²ï¼šæ¿€å‘å­©å­çš„è‰²å½©è®¤çŸ¥å’Œæ­é…èƒ½åŠ›</li>
<li>360åº¦è‡ªç”±è§†è§’ï¼šä»ä»»ä½•è§’åº¦è§‚å¯Ÿå’Œè°ƒæ•´ä½œå“</li>
<li>æ™ºèƒ½ç½‘æ ¼å¯¹é½ï¼šç§¯æœ¨è‡ªåŠ¨å¸é™„åˆ°ç½‘æ ¼ï¼Œè®©æ­å»ºæ›´æ•´é½</li>
</ul>
<h3 data-id="heading-7">2 è·¨å¹³å°ä½“éªŒ</h3>
<ul>
<li>äº”ç«¯é€‚é…ï¼šAndroidã€iOSã€HarmonyOSã€Windowsã€macOSå…¨å¹³å°æ”¯æŒ</li>
<li>å“åº”å¼è®¾è®¡ï¼šè‡ªåŠ¨é€‚é…ä¸åŒå±å¹•å°ºå¯¸</li>
<li>ä¸€è‡´ä½“éªŒï¼šåœ¨ä»»ä½•è®¾å¤‡ä¸Šéƒ½èƒ½è·å¾—æµç•…çš„ä½¿ç”¨ä½“éªŒ</li>
</ul>
<h3 data-id="heading-8">3 æ•™è‚²ä»·å€¼</h3>
<ul>
<li>ç©ºé—´æƒ³è±¡åŠ›åŸ¹å…»ï¼šé€šè¿‡3Dæ­å»ºé”»ç‚¼ç©ºé—´æ€ç»´</li>
<li>è‰²å½©æ­é…è®­ç»ƒï¼šåŸ¹å…»å­©å­çš„è‰²å½©æ„Ÿå’Œå®¡ç¾èƒ½åŠ›</li>
<li>é€»è¾‘æ€ç»´å‘å±•ï¼šé€šè¿‡è§„åˆ’å’Œå®ç°ä½œå“ï¼ŒåŸ¹å…»é€»è¾‘æ€ç»´</li>
<li>åˆ›é€ åŠ›æ¿€å‘ï¼šæ²¡æœ‰å›ºå®šç­”æ¡ˆï¼Œé¼“åŠ±è‡ªç”±åˆ›ä½œ</li>
</ul>
<h3 data-id="heading-9">4 å®¶é•¿å‹å¥½</h3>
<ul>
<li>é›¶æˆæœ¬ï¼šæ¯”å®ä½“ç§¯æœ¨ä¾¿å®œ100å€</li>
<li>é›¶æ”¶çº³ï¼šæ²¡æœ‰æ•£è½ä¸€åœ°çš„çƒ¦æ¼</li>
<li>ä¾¿æºæ€§ï¼šéšæ—¶éšåœ°éƒ½èƒ½ç©</li>
<li>å®‰å…¨ç¯ä¿ï¼šæ²¡æœ‰å°é›¶ä»¶åå’½é£é™©</li>
</ul>
<h2 data-id="heading-10">å››ã€å¼€å‘æ•ˆç‡çš„é£è·ƒ</h2>
<h3 data-id="heading-11">ä¼ ç»Ÿå¼€å‘ vs AIè¾…åŠ©å¼€å‘</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99ebf24df6ad42d3b87c92d20b859cca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5paH5b-D5b-r56CBQmFpZHVDb21hdGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=%2BuIRTkn3%2BudOgfP98zSWswoVMg0%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-12">å…³é”®çªç ´</h3>
<ul>
<li><strong>æŠ€æœ¯é—¨æ§›é™ä½</strong>ï¼šæˆ‘ä¸éœ€è¦æ·±å…¥äº†è§£3Då›¾å½¢å­¦ï¼Œä¹Ÿèƒ½æ„å»ºä¸“ä¸šåº”ç”¨</li>
<li><strong>å¼€å‘å‘¨æœŸç¼©çŸ­</strong>ï¼šåŸæœ¬éœ€è¦2ä¸ªæœˆçš„é¡¹ç›®ï¼Œåªç”¨äº†ä¸åˆ°2å‘¨</li>
<li><strong>ä»£ç è´¨é‡æå‡</strong>ï¼šAIç”Ÿæˆçš„ä»£ç ç»“æ„æ¸…æ™°ã€æ³¨é‡Šå®Œæ•´</li>
<li><strong>bugå‡å°‘70%</strong> ï¼šAIçš„æ™ºèƒ½æ£€æµ‹é¿å…äº†å¾ˆå¤šå¸¸è§é”™è¯¯</li>
</ul>
<h2 data-id="heading-13">äº”ã€æ›´æ·±å±‚çš„æ„ä¹‰</h2>
<p>è¿™ä¸ªé¡¹ç›®å¯¹æˆ‘æ¥è¯´ï¼Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯åº”ç”¨ï¼Œæ›´æ‰¿è½½äº†ä¸€ä»½æ•™è‚²æƒ…æ€€ã€‚</p>
<h3 data-id="heading-14">æ¨åŠ¨æ•™è‚²å…¬å¹³</h3>
<p>åœ¨å¾ˆå¤šåè¿œåœ°åŒºï¼Œå­©å­ä»¬å¾ˆéš¾æ¥è§¦åˆ°ä¼˜è´¨çš„åˆ›æ„å¯è’™èµ„æºã€‚é€šè¿‡è¿™ä¸ªå…è´¹çš„æ•°å­—åº”ç”¨ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿï¼š</p>
<ul>
<li><strong>æ¶ˆé™¤åœ°åŸŸé™åˆ¶</strong>ï¼šåªè¦æœ‰æ‰‹æœºï¼Œå°±èƒ½äº«å—ä¼˜è´¨çš„åˆ›æ„æ•™è‚²</li>
<li><strong>é™ä½ç»æµé—¨æ§›</strong>ï¼šå®Œå…¨å…è´¹ï¼Œä¸å¢åŠ å®¶åº­è´Ÿæ‹…</li>
<li><strong>æä¾›ä¼˜è´¨å†…å®¹</strong>ï¼šç»è¿‡ç²¾å¿ƒè®¾è®¡ï¼Œç¬¦åˆå„¿ç«¥è®¤çŸ¥å‘å±•è§„å¾‹</li>
</ul>
<h3 data-id="heading-15">åŠ©åŠ›åŸ¹å…»åˆ›é€ åŠ›</h3>
<p>åœ¨è¿™ä¸ªå¼ºè°ƒåˆ›æ–°çš„æ—¶ä»£ï¼Œåˆ›é€ åŠ›æ˜¯å­©å­æœªæ¥æœ€é‡è¦çš„ç«äº‰åŠ›ã€‚ç§¯æœ¨å·¥åŠé€šè¿‡ï¼š</p>
<ul>
<li><strong>å¼€æ”¾å¼è®¾è®¡</strong>ï¼šæ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œé¼“åŠ±è‡ªç”±æ¢ç´¢</li>
<li><strong>å³æ—¶åé¦ˆ</strong>ï¼šå­©å­èƒ½ç«‹å³çœ‹åˆ°è‡ªå·±çš„åˆ›æ„æˆæœ</li>
<li><strong>å¾ªåºæ¸è¿›</strong>ï¼šä»ç®€å•åˆ°å¤æ‚ï¼ŒåŸ¹å…»æˆå°±æ„Ÿ</li>
</ul>
<h3 data-id="heading-16">ä¿ƒè¿›äº²å­å…³ç³»</h3>
<p>æ•°å­—äº§å“ä¸åº”è¯¥æˆä¸ºäº²å­å…³ç³»çš„éšœç¢ã€‚æˆ‘ä»¬å¸Œæœ›ï¼š</p>
<ul>
<li><strong>å…±åŒå‚ä¸</strong>ï¼šå®¶é•¿å¯ä»¥å’Œå­©å­ä¸€èµ·æ­å»ºï¼Œå¢è¿›æ„Ÿæƒ…</li>
<li><strong>äº¤æµæœºä¼š</strong>ï¼šé€šè¿‡ä½œå“åˆ†äº«ï¼Œåˆ›é€ æ›´å¤šå®¶åº­è¯é¢˜</li>
<li><strong>æ•™è‚²æ¡¥æ¢</strong>ï¼šå¸®åŠ©å®¶é•¿äº†è§£å­©å­çš„åˆ›æ„ä¸–ç•Œ</li>
</ul>
<h2 data-id="heading-17">å†™åœ¨æœ€å</h2>
<p>è¿™ä¸ªé¡¹ç›®æ²¡æœ‰å¤§å…¬å¸çš„èµ„æºï¼Œä¹Ÿæ²¡æœ‰å¤æ‚çš„å•†ä¸šæ¨¡å¼ï¼Œåªæœ‰ä¸€ä»½ç®€å•çš„åˆå¿ƒï¼šè®©æ¯ä¸ªå­©å­éƒ½èƒ½æ‹¥æœ‰æ— é™çš„åˆ›æ„ç©ºé—´ã€‚æ„Ÿè°¢ç™¾åº¦æ–‡å¿ƒå¿«ç ï¼ˆComateï¼‰ï¼Œå®ƒè®©æˆ‘åœ¨æœ‰é™çš„æ—¶é—´é‡Œï¼ŒæŠŠè¿™ä»½åˆå¿ƒå˜æˆäº†ä¸€ä¸ªå®Œæ•´ã€å¯ç”¨çš„äº§å“ã€‚å®ƒè®©æˆ‘çœ‹åˆ°ï¼ŒAIæŠ€æœ¯çš„è¿›æ­¥ä¸æ˜¯ä¸ºäº†æ›¿ä»£å¼€å‘è€…ï¼Œè€Œæ˜¯ä¸ºäº†è®©æ¯ä¸€ä¸ªæœ‰æƒ…æ€€çš„å¼€å‘è€…ï¼Œéƒ½èƒ½æ›´è½»æ¾åœ°å®ç°è‡ªå·±çš„æ•™è‚²ç†æƒ³ã€‚</p>
<p>å¦‚æœä½ ä¹Ÿæ˜¯ä¸€åå¼€å‘è€…ï¼Œæœ‰è‡ªå·±çš„æ•™è‚²ç†æƒ³ï¼Œä¸å¦¨è¯•è¯•Comateï¼Œå®ƒå¯èƒ½ä¼šç»™ä½ å¸¦æ¥æ„æƒ³ä¸åˆ°çš„æƒŠå–œã€‚å¦‚æœä½ æ˜¯å®¶é•¿ï¼Œæˆ–è€…å¯¹å„¿ç«¥æ•™è‚²æ„Ÿå…´è¶£ï¼Œæ¬¢è¿ä¸‹è½½ä½“éªŒç§¯æœ¨å·¥åŠï¼Œè®©æˆ‘ä»¬ä¸€èµ·ä¸ºå­©å­çš„åˆ›æ„ä¸–ç•Œæ·»ç –åŠ ç“¦ã€‚</p>
<h2 data-id="heading-18">æ¼”ç¤º&amp;ä½“éªŒ</h2>
<p>äº§å“æ¼”ç¤ºè§†é¢‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1yAUaBnE4c%2F" target="_blank" title="https://www.bilibili.com/video/BV1yAUaBnE4c/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1yAâ€¦</a></p>
<p>ç›®å‰åº”ç”¨ä¸Šæ¶åˆ°åä¸ºåº”ç”¨å•†åº—ï¼Œç‚¹å‡»é“¾æ¥ä½“éªŒé¸¿è’™åº”ç”¨ç§¯æœ¨å·¥åŠ<a href="https://link.juejin.cn?target=https%3A%2F%2Fappgallery.huawei.com%2Fapp%2Fdetail%3Fid%3Dcom.aizhaiyu.jimu" target="_blank" title="https://appgallery.huawei.com/app/detail?id=com.aizhaiyu.jimu" ref="nofollow noopener noreferrer">appgallery.huawei.com/app/detail?â€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å±€åŸŸç½‘æœåŠ¡å‘ç°æŠ€æœ¯ï¼šmDNSä¸DNS-SDå®æˆ˜]]></title>    <link>https://juejin.cn/post/7592710766009597962</link>    <guid>https://juejin.cn/post/7592710766009597962</guid>    <pubDate>2026-01-08T06:47:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592710766009597962" data-draft-id="7592610104441847818" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å±€åŸŸç½‘æœåŠ¡å‘ç°æŠ€æœ¯ï¼šmDNSä¸DNS-SDå®æˆ˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-08T06:47:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å˜»å“ˆbaby"/> <meta itemprop="url" content="https://juejin.cn/user/485305583405066"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å±€åŸŸç½‘æœåŠ¡å‘ç°æŠ€æœ¯ï¼šmDNSä¸DNS-SDå®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/485305583405066/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å˜»å“ˆbaby
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:47:11.000Z" title="Thu Jan 08 2026 06:47:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡æ·±å…¥è§£æmDNSå’ŒDNS-SDåè®®åŸç†ï¼Œå¸¦ä½ å®ç°é›¶é…ç½®çš„å±€åŸŸç½‘æœåŠ¡è‡ªåŠ¨å‘ç°ã€‚</p>
</blockquote>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>ä½ æœ‰æ²¡æœ‰å¥½å¥‡è¿‡ï¼š</p>
<ul>
<li>ä¸ºä»€ä¹ˆiPhoneèƒ½è‡ªåŠ¨å‘ç°å®¶é‡Œçš„AirPlayè®¾å¤‡ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆChromecastèƒ½è¢«åŒä¸€WiFiä¸‹çš„è®¾å¤‡è¯†åˆ«ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆNASå¯ä»¥åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­è‡ªåŠ¨æ˜¾ç¤ºï¼Ÿ</li>
</ul>
<p>è¿™èƒŒåéƒ½æ˜¯åŒä¸€å¥—æŠ€æœ¯ï¼š<strong>mDNS + DNS-SD</strong>ï¼Œä¹Ÿè¢«ç§°ä¸º"é›¶é…ç½®ç½‘ç»œ"ï¼ˆZeroconfï¼‰ã€‚</p>
<p>ä»Šå¤©æˆ‘ä»¬å°±æ¥å½»åº•ææ‡‚å®ƒã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡å‘ç°</h2>
<h3 data-id="heading-2">1.1 ä¼ ç»Ÿæ–¹å¼çš„ç—›ç‚¹</h3>
<p>ä¼ ç»Ÿå±€åŸŸç½‘ä¸­ï¼Œè¦è®¿é—®ä¸€ä¸ªæœåŠ¡ï¼Œä½ éœ€è¦çŸ¥é“ï¼š</p>
<ul>
<li>æœåŠ¡å™¨çš„IPåœ°å€</li>
<li>æœåŠ¡çš„ç«¯å£å·</li>
</ul>
<pre><code class="hljs language-markdown" lang="markdown">é—®é¢˜ï¼š
<span class="hljs-bullet">1.</span> IPåœ°å€å¯èƒ½å˜åŒ–ï¼ˆDHCPåˆ†é…ï¼‰
<span class="hljs-bullet">2.</span> éœ€è¦æ‰‹åŠ¨é…ç½®æˆ–è®°å¿†
<span class="hljs-bullet">3.</span> æ–°è®¾å¤‡åŠ å…¥ç½‘ç»œæ—¶ï¼Œå…¶ä»–äººä¸çŸ¥é“
</code></pre>
<h3 data-id="heading-3">1.2 ç†æƒ³çš„æ–¹å¼</h3>
<pre><code class="hljs language-markdown" lang="markdown">åœºæ™¯ï¼šä½ ä¹°äº†ä¸€å°æ–°æ‰“å°æœº

ä¼ ç»Ÿæ–¹å¼ï¼š
<span class="hljs-bullet">1.</span> æŸ¥çœ‹æ‰“å°æœºIPï¼ˆå¯èƒ½éœ€è¦æŒ‰ä¸€å †æŒ‰é’®ï¼‰
<span class="hljs-bullet">2.</span> åœ¨ç”µè„‘ä¸Šæ‰‹åŠ¨æ·»åŠ 
<span class="hljs-bullet">3.</span> IPå˜äº†è¿˜å¾—é‡æ–°é…ç½®

é›¶é…ç½®æ–¹å¼ï¼š
<span class="hljs-bullet">1.</span> æ‰“å°æœºè¿ä¸ŠWiFi
<span class="hljs-bullet">2.</span> ç”µè„‘è‡ªåŠ¨å‘ç°æ‰“å°æœº
<span class="hljs-bullet">3.</span> ç›´æ¥ä½¿ç”¨
</code></pre>
<p>è¿™å°±æ˜¯mDNSå’ŒDNS-SDè¦è§£å†³çš„é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-4">äºŒã€mDNSï¼šå¤šæ’­DNS</h2>
<h3 data-id="heading-5">2.1 ä»€ä¹ˆæ˜¯mDNS</h3>
<p>mDNSï¼ˆMulticast DNSï¼‰å®šä¹‰åœ¨RFC 6762ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p>
<p><strong>åœ¨å±€åŸŸç½‘å†…ï¼Œä¸éœ€è¦DNSæœåŠ¡å™¨ï¼Œè®¾å¤‡ä¹‹é—´äº’ç›¸åº”ç­”DNSæŸ¥è¯¢</strong></p>
<pre><code class="hljs language-css" lang="css">ä¼ ç»ŸDNSï¼š
<span class="hljs-selector-attr">[Client]</span> â”€â”€æŸ¥è¯¢â”€â†’ <span class="hljs-selector-attr">[DNS Server]</span> â”€â”€å“åº”â”€â†’ <span class="hljs-selector-attr">[Client]</span>

mDNSï¼š
<span class="hljs-selector-attr">[Client]</span> â”€â”€ç»„æ’­æŸ¥è¯¢â”€â†’ <span class="hljs-selector-attr">[æ‰€æœ‰è®¾å¤‡]</span>
                      â†“
            <span class="hljs-selector-attr">[èƒ½å“åº”çš„è®¾å¤‡]</span> â”€â”€ç»„æ’­å“åº”â”€â†’ <span class="hljs-selector-attr">[æ‰€æœ‰è®¾å¤‡]</span>
</code></pre>
<h3 data-id="heading-6">2.2 mDNSæŠ€æœ¯ç»†èŠ‚</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># mDNS å…³é”®å‚æ•°</span>

MDNS_CONFIG = {
    <span class="hljs-string">"multicast_address_ipv4"</span>: <span class="hljs-string">"224.0.0.251"</span>,
    <span class="hljs-string">"multicast_address_ipv6"</span>: <span class="hljs-string">"ff02::fb"</span>,
    <span class="hljs-string">"port"</span>: <span class="hljs-number">5353</span>,
    <span class="hljs-string">"domain"</span>: <span class="hljs-string">".local"</span>,
    <span class="hljs-string">"ttl"</span>: <span class="hljs-number">255</span>  <span class="hljs-comment"># åªåœ¨æœ¬åœ°ç½‘ç»œä¼ æ’­</span>
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆç”¨ .local åŸŸåï¼Ÿ</strong></p>
<ul>
<li><code>.local</code> æ˜¯ä¸“é—¨ä¸ºå±€åŸŸç½‘ä¿ç•™çš„é¡¶çº§åŸŸ</li>
<li>æŸ¥è¯¢ <code>myprinter.local</code> ä¼šè§¦å‘mDNSï¼Œè€Œéä¼ ç»ŸDNS</li>
<li>æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«å¹¶ä½¿ç”¨mDNSè§£æ</li>
</ul>
<h3 data-id="heading-7">2.3 mDNSæŸ¥è¯¢æµç¨‹</h3>
<pre><code class="hljs language-markdown" lang="markdown">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    mDNS æŸ¥è¯¢æµç¨‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="hljs-bullet">1.</span> å®¢æˆ·ç«¯æƒ³çŸ¥é“ "mynas.local" çš„IP

<span class="hljs-bullet">2.</span> å®¢æˆ·ç«¯å‘ 224.0.0.251:5353 å‘é€ç»„æ’­æŸ¥è¯¢
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Query: mynas.local, Type: A        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">                    â†“ ç»„æ’­
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  æ‰€æœ‰è®¾å¤‡éƒ½èƒ½æ”¶åˆ°è¿™ä¸ªæŸ¥è¯¢            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span>
<span class="hljs-bullet">3.</span> æ‹¥æœ‰è¯¥åç§°çš„è®¾å¤‡å›å¤ï¼ˆåŒæ ·æ˜¯ç»„æ’­ï¼‰
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Response: mynas.local = 192.168.1.5â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">                    â†“ ç»„æ’­
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  æ‰€æœ‰è®¾å¤‡éƒ½èƒ½æ”¶åˆ°å¹¶ç¼“å­˜è¿™ä¸ªå“åº”      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre>
<h3 data-id="heading-8">2.4 ç”¨Pythonå®ç°mDNSæŸ¥è¯¢</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> struct

<span class="hljs-keyword">def</span> <span class="hljs-title function_">mdns_query</span>(<span class="hljs-params">name</span>):
    <span class="hljs-string">"""å‘é€mDNSæŸ¥è¯¢"""</span>
    
    MDNS_ADDR = <span class="hljs-string">"224.0.0.251"</span>
    MDNS_PORT = <span class="hljs-number">5353</span>
    
    <span class="hljs-comment"># æ„é€ DNSæŸ¥è¯¢åŒ…</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_name</span>(<span class="hljs-params">name</span>):
        <span class="hljs-string">"""ç¼–ç DNSåç§°"""</span>
        result = <span class="hljs-string">b''</span>
        <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> name.split(<span class="hljs-string">'.'</span>):
            result += <span class="hljs-built_in">bytes</span>([<span class="hljs-built_in">len</span>(part)]) + part.encode()
        result += <span class="hljs-string">b'\x00'</span>
        <span class="hljs-keyword">return</span> result
    
    <span class="hljs-comment"># DNS Header</span>
    transaction_id = <span class="hljs-number">0x0000</span>  <span class="hljs-comment"># mDNSé€šå¸¸ä½¿ç”¨0</span>
    flags = <span class="hljs-number">0x0000</span>           <span class="hljs-comment"># æ ‡å‡†æŸ¥è¯¢</span>
    questions = <span class="hljs-number">1</span>
    answers = <span class="hljs-number">0</span>
    authority = <span class="hljs-number">0</span>
    additional = <span class="hljs-number">0</span>
    
    header = struct.pack(<span class="hljs-string">'&gt;HHHHHH'</span>, 
        transaction_id, flags, questions, answers, authority, additional)
    
    <span class="hljs-comment"># Question Section</span>
    qname = encode_name(name)
    qtype = <span class="hljs-number">1</span>   <span class="hljs-comment"># Aè®°å½•</span>
    qclass = <span class="hljs-number">1</span>  <span class="hljs-comment"># INç±»</span>
    
    question = qname + struct.pack(<span class="hljs-string">'&gt;HH'</span>, qtype, qclass)
    
    <span class="hljs-comment"># å‘é€æŸ¥è¯¢</span>
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="hljs-number">1</span>)
    sock.setsockopt(socket.IPPROTO_IP, socket.IP_MULTICAST_TTL, <span class="hljs-number">255</span>)
    sock.settimeout(<span class="hljs-number">2</span>)
    
    <span class="hljs-keyword">try</span>:
        sock.sendto(header + question, (MDNS_ADDR, MDNS_PORT))
        
        <span class="hljs-comment"># æ¥æ”¶å“åº”</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            data, addr = sock.recvfrom(<span class="hljs-number">1024</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ”¶åˆ°å“åº”æ¥è‡ª <span class="hljs-subst">{addr}</span>: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(data)}</span> bytes"</span>)
            <span class="hljs-comment"># è§£æå“åº”...</span>
            
    <span class="hljs-keyword">except</span> socket.timeout:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"æŸ¥è¯¢è¶…æ—¶"</span>)
    <span class="hljs-keyword">finally</span>:
        sock.close()

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
mdns_query(<span class="hljs-string">"mynas.local"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-9">ä¸‰ã€DNS-SDï¼šæœåŠ¡å‘ç°</h2>
<h3 data-id="heading-10">3.1 DNS-SDæ˜¯ä»€ä¹ˆ</h3>
<p>DNS-SDï¼ˆDNS-based Service Discoveryï¼‰å®šä¹‰åœ¨RFC 6763ï¼Œæ˜¯å»ºç«‹åœ¨DNSä¹‹ä¸Šçš„æœåŠ¡å‘ç°åè®®ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">mDNS è§£å†³ï¼šåç§° â†’ IP
DNS-<span class="hljs-built_in">SD</span> è§£å†³ï¼šæˆ‘æƒ³æ‰¾æŸç±»æœåŠ¡ â†’ æœ‰å“ªäº›å…·ä½“æœåŠ¡ â†’ æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯
</code></pre>
<h3 data-id="heading-11">3.2 DNS-SDçš„ä¸‰å±‚æŸ¥è¯¢</h3>
<pre><code class="hljs language-lua" lang="lua">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 DNS-SD ä¸‰å±‚æŸ¥è¯¢æ¨¡å‹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬ä¸€å±‚ï¼šæœåŠ¡ç±»å‹æšä¸¾
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é—®ï¼šè¿™ä¸ªç½‘ç»œé‡Œæœ‰å“ªäº›ç±»å‹çš„æœåŠ¡ï¼Ÿ      â”‚
â”‚ æŸ¥è¯¢ï¼š_services._dns-sd._udp.<span class="hljs-keyword">local</span>  â”‚
â”‚ ç­”ï¼š_http._tcp, _printer._tcp, ...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
ç¬¬äºŒå±‚ï¼šæœåŠ¡å®ä¾‹æšä¸¾
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é—®ï¼šç½‘ç»œé‡Œæœ‰å“ªäº›HTTPæœåŠ¡å™¨ï¼Ÿ         â”‚
â”‚ æŸ¥è¯¢ï¼š_http._tcp.<span class="hljs-keyword">local</span> (PTRè®°å½•)    â”‚
â”‚ ç­”ï¼šMyNAS._http._tcp.<span class="hljs-keyword">local</span>,         â”‚
â”‚     HomeServer._http._tcp.<span class="hljs-keyword">local</span>     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
ç¬¬ä¸‰å±‚ï¼šæœåŠ¡å®ä¾‹è¯¦æƒ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é—®ï¼šMyNASè¿™ä¸ªæœåŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼Ÿ        â”‚
â”‚ æŸ¥è¯¢ï¼šMyNAS._http._tcp.<span class="hljs-keyword">local</span>        â”‚
â”‚       SRVè®°å½• â†’ ä¸»æœºåå’Œç«¯å£         â”‚
â”‚       TXTè®°å½• â†’ é™„åŠ å±æ€§             â”‚
â”‚       Aè®°å½•   â†’ IPåœ°å€              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-12">3.3 å¸¸è§æœåŠ¡ç±»å‹</h3>













































<table><thead><tr><th>æœåŠ¡ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>_http._tcp</code></td><td>HTTPæœåŠ¡</td></tr><tr><td><code>_https._tcp</code></td><td>HTTPSæœåŠ¡</td></tr><tr><td><code>_ssh._tcp</code></td><td>SSHæœåŠ¡</td></tr><tr><td><code>_smb._tcp</code></td><td>Windowsæ–‡ä»¶å…±äº«</td></tr><tr><td><code>_afpovertcp._tcp</code></td><td>Appleæ–‡ä»¶å…±äº«</td></tr><tr><td><code>_printer._tcp</code></td><td>æ‰“å°æœº</td></tr><tr><td><code>_airplay._tcp</code></td><td>AirPlay</td></tr><tr><td><code>_googlecast._tcp</code></td><td>Chromecast</td></tr><tr><td><code>_hap._tcp</code></td><td>HomeKit</td></tr></tbody></table>
<h3 data-id="heading-13">3.4 DNSè®°å½•ç±»å‹</h3>
<pre><code class="hljs language-lua" lang="lua">ä¸€ä¸ªå®Œæ•´çš„æœåŠ¡æ³¨å†ŒåŒ…å«ä»¥ä¸‹DNSè®°å½•ï¼š

<span class="hljs-number">1.</span> PTRè®°å½•ï¼ˆæœåŠ¡æšä¸¾ï¼‰
   _http._tcp.<span class="hljs-keyword">local</span> â†’ MyNAS._http._tcp.<span class="hljs-keyword">local</span>

<span class="hljs-number">2.</span> SRVè®°å½•ï¼ˆæœåŠ¡ä½ç½®ï¼‰
   MyNAS._http._tcp.<span class="hljs-keyword">local</span> â†’ <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">8080</span> mynas.<span class="hljs-keyword">local</span>
   ï¼ˆä¼˜å…ˆçº§ æƒé‡ ç«¯å£ ä¸»æœºåï¼‰

<span class="hljs-number">3.</span> TXTè®°å½•ï¼ˆé™„åŠ ä¿¡æ¯ï¼‰
   MyNAS._http._tcp.<span class="hljs-keyword">local</span> â†’ <span class="hljs-string">"path=/admin"</span> <span class="hljs-string">"version=1.0"</span>

<span class="hljs-number">4.</span> A/AAAAè®°å½•ï¼ˆIPåœ°å€ï¼‰
   mynas.<span class="hljs-keyword">local</span> â†’ <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.5</span>
</code></pre>
<hr/>
<h2 data-id="heading-14">å››ã€å®æˆ˜ï¼šPythonå®ç°æœåŠ¡å‘ç°</h2>
<h3 data-id="heading-15">4.1 ä½¿ç”¨zeroconfåº“</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å®‰è£…ï¼špip install zeroconf</span>

<span class="hljs-keyword">from</span> zeroconf <span class="hljs-keyword">import</span> ServiceBrowser, Zeroconf, ServiceListener
<span class="hljs-keyword">import</span> socket

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListener</span>(<span class="hljs-title class_ inherited__">ServiceListener</span>):
    <span class="hljs-string">"""æœåŠ¡å‘ç°ç›‘å¬å™¨"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_service</span>(<span class="hljs-params">self, zc: Zeroconf, type_: <span class="hljs-built_in">str</span>, name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""å‘ç°æ–°æœåŠ¡"""</span>
        info = zc.get_service_info(type_, name)
        <span class="hljs-keyword">if</span> info:
            addresses = [socket.inet_ntoa(addr) <span class="hljs-keyword">for</span> addr <span class="hljs-keyword">in</span> info.addresses]
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nâœ… å‘ç°æœåŠ¡: <span class="hljs-subst">{name}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ç±»å‹: <span class="hljs-subst">{type_}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   åœ°å€: <span class="hljs-subst">{addresses}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ç«¯å£: <span class="hljs-subst">{info.port}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   å±æ€§: <span class="hljs-subst">{info.properties}</span>"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">remove_service</span>(<span class="hljs-params">self, zc: Zeroconf, type_: <span class="hljs-built_in">str</span>, name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""æœåŠ¡ä¸‹çº¿"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nâŒ æœåŠ¡ä¸‹çº¿: <span class="hljs-subst">{name}</span>"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_service</span>(<span class="hljs-params">self, zc: Zeroconf, type_: <span class="hljs-built_in">str</span>, name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""æœåŠ¡æ›´æ–°"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nğŸ”„ æœåŠ¡æ›´æ–°: <span class="hljs-subst">{name}</span>"</span>)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">discover_services</span>(<span class="hljs-params">service_type=<span class="hljs-string">"_http._tcp.local."</span>, timeout=<span class="hljs-number">10</span></span>):
    <span class="hljs-string">"""å‘ç°æŒ‡å®šç±»å‹çš„æœåŠ¡"""</span>
    
    zeroconf = Zeroconf()
    listener = MyListener()
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ­£åœ¨æœç´¢ <span class="hljs-subst">{service_type}</span> æœåŠ¡..."</span>)
    browser = ServiceBrowser(zeroconf, service_type, listener)
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">import</span> time
        time.sleep(timeout)
    <span class="hljs-keyword">finally</span>:
        zeroconf.close()


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># æœç´¢HTTPæœåŠ¡</span>
    discover_services(<span class="hljs-string">"_http._tcp.local."</span>)
    
    <span class="hljs-comment"># æœç´¢SSHæœåŠ¡</span>
    <span class="hljs-comment"># discover_services("_ssh._tcp.local.")</span>
    
    <span class="hljs-comment"># æœç´¢æ‰€æœ‰æœåŠ¡</span>
    <span class="hljs-comment"># discover_services("_services._dns-sd._udp.local.")</span>
</code></pre>
<h3 data-id="heading-16">4.2 æ³¨å†Œè‡ªå·±çš„æœåŠ¡</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> zeroconf <span class="hljs-keyword">import</span> Zeroconf, ServiceInfo
<span class="hljs-keyword">import</span> socket

<span class="hljs-keyword">def</span> <span class="hljs-title function_">register_service</span>(<span class="hljs-params">name, service_type, port, properties=<span class="hljs-literal">None</span></span>):
    <span class="hljs-string">"""æ³¨å†Œä¸€ä¸ªæœåŠ¡"""</span>
    
    zeroconf = Zeroconf()
    
    <span class="hljs-comment"># è·å–æœ¬æœºIP</span>
    hostname = socket.gethostname()
    local_ip = socket.gethostbyname(hostname)
    
    <span class="hljs-comment"># åˆ›å»ºæœåŠ¡ä¿¡æ¯</span>
    service_info = ServiceInfo(
        type_=service_type,
        name=<span class="hljs-string">f"<span class="hljs-subst">{name}</span>.<span class="hljs-subst">{service_type}</span>"</span>,
        addresses=[socket.inet_aton(local_ip)],
        port=port,
        properties=properties <span class="hljs-keyword">or</span> {},
        server=<span class="hljs-string">f"<span class="hljs-subst">{hostname}</span>.local."</span>
    )
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ³¨å†ŒæœåŠ¡: <span class="hljs-subst">{name}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç±»å‹: <span class="hljs-subst">{service_type}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"åœ°å€: <span class="hljs-subst">{local_ip}</span>:<span class="hljs-subst">{port}</span>"</span>)
    
    zeroconf.register_service(service_info)
    
    <span class="hljs-keyword">return</span> zeroconf, service_info


<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-comment"># æ³¨å†Œä¸€ä¸ªHTTPæœåŠ¡</span>
    zc, info = register_service(
        name=<span class="hljs-string">"MyWebServer"</span>,
        service_type=<span class="hljs-string">"_http._tcp.local."</span>,
        port=<span class="hljs-number">8080</span>,
        properties={
            <span class="hljs-string">"path"</span>: <span class="hljs-string">"/api"</span>,
            <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0"</span>
        }
    )
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\næœåŠ¡å·²æ³¨å†Œï¼ŒæŒ‰ Ctrl+C é€€å‡º..."</span>)
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">import</span> time
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            time.sleep(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        <span class="hljs-keyword">pass</span>
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\næ³¨é”€æœåŠ¡..."</span>)
        zc.unregister_service(info)
        zc.close()


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<h3 data-id="heading-17">4.3 å‘½ä»¤è¡Œæµ‹è¯•å·¥å…·</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS è‡ªå¸¦çš„ dns-sd å·¥å…·</span>

<span class="hljs-comment"># æµè§ˆHTTPæœåŠ¡</span>
dns-sd -B _http._tcp <span class="hljs-built_in">local</span>

<span class="hljs-comment"># æŸ¥çœ‹æœåŠ¡è¯¦æƒ…</span>
dns-sd -L <span class="hljs-string">"MyNAS"</span> _http._tcp <span class="hljs-built_in">local</span>

<span class="hljs-comment"># æ³¨å†Œä¸€ä¸ªæœåŠ¡</span>
dns-sd -R <span class="hljs-string">"TestService"</span> _http._tcp <span class="hljs-built_in">local</span> 8080 path=/test

<span class="hljs-comment"># Linux ä½¿ç”¨ avahi</span>
<span class="hljs-comment"># å®‰è£…ï¼šapt install avahi-utils</span>

<span class="hljs-comment"># æµè§ˆæœåŠ¡</span>
avahi-browse -a

<span class="hljs-comment"># æµè§ˆç‰¹å®šç±»å‹</span>
avahi-browse _http._tcp

<span class="hljs-comment"># æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</span>
avahi-browse -r _http._tcp

<span class="hljs-comment"># å‘å¸ƒæœåŠ¡</span>
avahi-publish -s <span class="hljs-string">"MyService"</span> _http._tcp 8080 <span class="hljs-string">"path=/api"</span>
</code></pre>
<hr/>
<h2 data-id="heading-18">äº”ã€è·¨ç½‘æ®µçš„æœåŠ¡å‘ç°éš¾é¢˜</h2>
<h3 data-id="heading-19">5.1 mDNSçš„å±€é™æ€§</h3>
<pre><code class="hljs language-css" lang="css">mDNSä½¿ç”¨ç»„æ’­ï¼Œç»„æ’­æœ‰ä¸€ä¸ªå¤©ç„¶çš„é™åˆ¶ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç½‘æ®µ<span class="hljs-selector-tag">A</span>        â”‚         â”‚    ç½‘æ®µ<span class="hljs-selector-tag">B</span>        â”‚
â”‚ <span class="hljs-number">192.168</span>.<span class="hljs-number">1.0</span>/<span class="hljs-number">24</span>  â”‚ è·¯ç”±å™¨  â”‚ <span class="hljs-number">192.168</span>.<span class="hljs-number">2.0</span>/<span class="hljs-number">24</span>  â”‚
â”‚                 â”‚ â•â•â•â•â•â•â• â”‚                 â”‚
â”‚  <span class="hljs-selector-attr">[è®¾å¤‡A]</span>        â”‚    âœ—    â”‚    <span class="hljs-selector-attr">[è®¾å¤‡B]</span>      â”‚
â”‚                 â”‚ ç»„æ’­è¢«é˜»â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»„æ’­é»˜è®¤ä¸ä¼šè·¨è¶Šè·¯ç”±å™¨è¾¹ç•Œï¼
</code></pre>
<h3 data-id="heading-20">5.2 è§£å†³æ–¹æ¡ˆå¯¹æ¯”</h3>



































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>åŸç†</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>mDNS Reflector</td><td>è·¯ç”±å™¨è½¬å‘mDNSåŒ…</td><td>ç®€å•</td><td>éœ€è¦è·¯ç”±å™¨æ”¯æŒ</td></tr><tr><td>Avahi Gateway</td><td>ä¸“é—¨çš„ç½‘å…³è½¬å‘</td><td>çµæ´»</td><td>éœ€è¦é¢å¤–è®¾å¤‡</td></tr><tr><td>Wide Area DNS-SD</td><td>ä½¿ç”¨ä¼ ç»ŸDNS</td><td>è·¨äº’è”ç½‘</td><td>é…ç½®å¤æ‚</td></tr><tr><td>ç»„ç½‘æ–¹æ¡ˆ</td><td>è™šæ‹Ÿå±€åŸŸç½‘</td><td>å…¨é€æ˜</td><td>éœ€è¦å®¢æˆ·ç«¯</td></tr></tbody></table>
<h3 data-id="heading-21">5.3 è™šæ‹Ÿå±€åŸŸç½‘æ–¹æ¡ˆ</h3>
<p>å¯¹äºéœ€è¦è·¨åœ°åŸŸè®¿é—®çš„åœºæ™¯ï¼Œæœ€ç›´æ¥çš„æ–¹æ¡ˆæ˜¯å°†ä¸åŒç½‘æ®µçš„è®¾å¤‡ç»„æˆä¸€ä¸ª<strong>è™šæ‹Ÿå±€åŸŸç½‘</strong>ã€‚</p>
<pre><code class="hljs language-css" lang="css">å¼‚åœ°ç»„ç½‘åçš„æ•ˆæœï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å®¶é‡Œ         â”‚         â”‚    å…¬å¸         â”‚
â”‚ <span class="hljs-number">192.168</span>.<span class="hljs-number">1.0</span>/<span class="hljs-number">24</span>  â”‚ è™šæ‹Ÿç½‘  â”‚ <span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">24</span>     â”‚
â”‚                 â”‚ â•â•â•â•â•â•â• â”‚                 â”‚
â”‚  <span class="hljs-selector-attr">[NAS]</span>          â”‚   âœ“     â”‚    <span class="hljs-selector-attr">[ç¬”è®°æœ¬]</span>     â”‚
â”‚                 â”‚ ç»„æ’­æ­£å¸¸â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

mDNS/DNS-SD æ­£å¸¸å·¥ä½œï¼Œè‡ªåŠ¨å‘ç°NASï¼
</code></pre>
<p>åƒ<strong>æ˜Ÿç©ºç»„ç½‘</strong>è¿™ç±»æ–¹æ¡ˆï¼Œå¯ä»¥å°†å¤šä¸ªå±€åŸŸç½‘æ‰“é€šå½¢æˆä¸€ä¸ªè™šæ‹Ÿå¤§å±€åŸŸç½‘ï¼Œè¿™æ ·mDNSå’ŒDNS-SDå°±èƒ½æ­£å¸¸å·¥ä½œï¼Œå®ç°è·¨åœ°åŸŸçš„æœåŠ¡è‡ªåŠ¨å‘ç°ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®IPã€‚</p>
<hr/>
<h2 data-id="heading-22">å…­ã€å®é™…åº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-23">6.1 NASè‡ªåŠ¨å‘ç°</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å‘ç°å±€åŸŸç½‘å†…çš„NASè®¾å¤‡</span>

NAS_SERVICE_TYPES = [
    <span class="hljs-string">"_smb._tcp.local."</span>,      <span class="hljs-comment"># Windowså…±äº«</span>
    <span class="hljs-string">"_afpovertcp._tcp.local."</span>, <span class="hljs-comment"># Appleå…±äº«</span>
    <span class="hljs-string">"_nfs._tcp.local."</span>,      <span class="hljs-comment"># NFS</span>
    <span class="hljs-string">"_webdav._tcp.local."</span>,   <span class="hljs-comment"># WebDAV</span>
    <span class="hljs-string">"_http._tcp.local."</span>,     <span class="hljs-comment"># Webç®¡ç†ç•Œé¢</span>
]

<span class="hljs-keyword">for</span> service_type <span class="hljs-keyword">in</span> NAS_SERVICE_TYPES:
    discover_services(service_type, timeout=<span class="hljs-number">3</span>)
</code></pre>
<h3 data-id="heading-24">6.2 æ™ºèƒ½å®¶å±…è®¾å¤‡å‘ç°</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å‘ç°æ™ºèƒ½å®¶å±…è®¾å¤‡</span>

SMART_HOME_SERVICES = [
    <span class="hljs-string">"_hap._tcp.local."</span>,        <span class="hljs-comment"># HomeKit</span>
    <span class="hljs-string">"_homekit._tcp.local."</span>,    <span class="hljs-comment"># HomeKit</span>
    <span class="hljs-string">"_airplay._tcp.local."</span>,    <span class="hljs-comment"># AirPlay</span>
    <span class="hljs-string">"_googlecast._tcp.local."</span>, <span class="hljs-comment"># Google Cast</span>
    <span class="hljs-string">"_spotify-connect._tcp.local."</span>, <span class="hljs-comment"># Spotify</span>
]
</code></pre>
<h3 data-id="heading-25">6.3 å¼€å‘ç¯å¢ƒæœåŠ¡å‘ç°</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¾®æœåŠ¡å¼€å‘æ—¶ï¼Œè‡ªåŠ¨å‘ç°åŒäº‹çš„æœåŠ¡</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">register_dev_service</span>(<span class="hljs-params">service_name, port</span>):
    <span class="hljs-string">"""æ³¨å†Œå¼€å‘æœåŠ¡"""</span>
    register_service(
        name=<span class="hljs-string">f"<span class="hljs-subst">{service_name}</span>-<span class="hljs-subst">{socket.gethostname()}</span>"</span>,
        service_type=<span class="hljs-string">"_dev._tcp.local."</span>,
        port=port,
        properties={
            <span class="hljs-string">"developer"</span>: os.getenv(<span class="hljs-string">"USER"</span>),
            <span class="hljs-string">"version"</span>: <span class="hljs-string">"dev"</span>,
            <span class="hljs-string">"branch"</span>: get_git_branch()
        }
    )
</code></pre>
<hr/>
<h2 data-id="heading-26">ä¸ƒã€å®‰å…¨æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-27">7.1 mDNSçš„å®‰å…¨é£é™©</h3>
<pre><code class="hljs language-markdown" lang="markdown">é£é™©ï¼š
<span class="hljs-bullet">1.</span> ä¿¡æ¯æ³„éœ² - ä»»ä½•äººéƒ½èƒ½å‘ç°å±€åŸŸç½‘å†…çš„æœåŠ¡
<span class="hljs-bullet">2.</span> æ¬ºéª—æ”»å‡» - æ¶æ„è®¾å¤‡å¯ä»¥å†’å……æœåŠ¡
<span class="hljs-bullet">3.</span> æ”¾å¤§æ”»å‡» - ç»„æ’­å¯èƒ½è¢«åˆ©ç”¨è¿›è¡ŒDDoS

é˜²æŠ¤ï¼š
<span class="hljs-bullet">1.</span> åœ¨ä¸å—ä¿¡ä»»çš„ç½‘ç»œä¸Šç¦ç”¨mDNS
<span class="hljs-bullet">2.</span> é˜²ç«å¢™é™åˆ¶5353ç«¯å£
<span class="hljs-bullet">3.</span> æœåŠ¡è‡ªèº«éœ€è¦è®¤è¯
</code></pre>
<h3 data-id="heading-28">7.2 æœ€ä½³å®è·µ</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Linux é˜²ç«å¢™è§„åˆ™ç¤ºä¾‹</span>

<span class="hljs-comment"># åªå…è®¸ä¿¡ä»»ç½‘æ®µçš„mDNS</span>
iptables -A INPUT -s 192.168.1.0/24 -p udp --dport 5353 -j ACCEPT
iptables -A INPUT -p udp --dport 5353 -j DROP

<span class="hljs-comment"># macOS ç¦ç”¨mDNSå“åº”</span>
sudo defaults write /Library/Preferences/com.apple.mDNSResponder.plist NoMulticastAdvertisements -bool YES
</code></pre>
<hr/>
<h2 data-id="heading-29">å…«ã€æ€»ç»“</h2>
<p>mDNSå’ŒDNS-SDæ˜¯å±€åŸŸç½‘æœåŠ¡å‘ç°çš„åŸºçŸ³ï¼š</p>




















<table><thead><tr><th>æŠ€æœ¯</th><th>ä½œç”¨</th><th>RFC</th></tr></thead><tbody><tr><td>mDNS</td><td>å±€åŸŸç½‘å†…åç§°è§£æ</td><td>RFC 6762</td></tr><tr><td>DNS-SD</td><td>æœåŠ¡å‘ç°åè®®</td><td>RFC 6763</td></tr></tbody></table>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>âœ… åŒä¸€å±€åŸŸç½‘å†…çš„è®¾å¤‡äº’å‘ç°</li>
<li>âœ… æ™ºèƒ½å®¶å±…ã€æ‰“å°æœºã€NASç­‰</li>
<li>âœ… å¼€å‘ç¯å¢ƒå¾®æœåŠ¡å‘ç°</li>
</ul>
<p><strong>å±€é™æ€§</strong>ï¼š</p>
<ul>
<li>âŒ æ— æ³•è·¨ç½‘æ®µï¼ˆéœ€è¦é¢å¤–æ–¹æ¡ˆï¼‰</li>
<li>âŒ æ— å®‰å…¨æœºåˆ¶ï¼ˆéœ€è¦åº”ç”¨å±‚è®¤è¯ï¼‰</li>
</ul>
<p><strong>è§£å†³è·¨ç½‘æ®µé—®é¢˜</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ç»„ç½‘æ–¹æ¡ˆæ‰“é€šå¤šä¸ªå±€åŸŸç½‘</li>
<li>æœåŠ¡å‘ç°å°±åƒåœ¨åŒä¸€å±€åŸŸç½‘ä¸€æ ·è‡ªç„¶</li>
</ul>
<hr/>
<h2 data-id="heading-30">å‚è€ƒæ–‡çŒ®</h2>
<ol>
<li>RFC 6762 - Multicast DNS</li>
<li>RFC 6763 - DNS-Based Service Discovery</li>
<li>Apple Bonjour Developer Documentation</li>
<li>Avahi - A Zeroconf Implementation for Linux</li>
</ol>
<hr/>
<blockquote>
<p>ğŸ’¡ <strong>å®è·µå»ºè®®</strong>ï¼šåœ¨å¼€å‘å±€åŸŸç½‘åº”ç”¨æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨mDNS/DNS-SDè¿›è¡ŒæœåŠ¡å‘ç°ï¼Œå¯ä»¥å¤§å¹…ç®€åŒ–ç”¨æˆ·é…ç½®ã€‚å¦‚æœéœ€è¦è·¨å±€åŸŸç½‘è®¿é—®ï¼Œè€ƒè™‘ä½¿ç”¨ç»„ç½‘æ–¹æ¡ˆç»Ÿä¸€ç½‘ç»œã€‚</p>
</blockquote>
<blockquote>
<p>æœ¬æ–‡æ·±å…¥è§£æmDNSå’ŒDNS-SDåè®®åŸç†ï¼Œå¸¦ä½ å®ç°é›¶é…ç½®çš„å±€åŸŸç½‘æœåŠ¡è‡ªåŠ¨å‘ç°ã€‚</p>
</blockquote>
<h2 data-id="heading-31">å‰è¨€</h2>
<p>ä½ æœ‰æ²¡æœ‰å¥½å¥‡è¿‡ï¼š</p>
<ul>
<li>ä¸ºä»€ä¹ˆiPhoneèƒ½è‡ªåŠ¨å‘ç°å®¶é‡Œçš„AirPlayè®¾å¤‡ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆChromecastèƒ½è¢«åŒä¸€WiFiä¸‹çš„è®¾å¤‡è¯†åˆ«ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆNASå¯ä»¥åœ¨æ–‡ä»¶ç®¡ç†å™¨ä¸­è‡ªåŠ¨æ˜¾ç¤ºï¼Ÿ</li>
</ul>
<p>è¿™èƒŒåéƒ½æ˜¯åŒä¸€å¥—æŠ€æœ¯ï¼š<strong>mDNS + DNS-SD</strong>ï¼Œä¹Ÿè¢«ç§°ä¸º"é›¶é…ç½®ç½‘ç»œ"ï¼ˆZeroconfï¼‰ã€‚</p>
<p>ä»Šå¤©æˆ‘ä»¬å°±æ¥å½»åº•ææ‡‚å®ƒã€‚</p>
<hr/>
<h2 data-id="heading-32">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡å‘ç°</h2>
<h3 data-id="heading-33">1.1 ä¼ ç»Ÿæ–¹å¼çš„ç—›ç‚¹</h3>
<p>ä¼ ç»Ÿå±€åŸŸç½‘ä¸­ï¼Œè¦è®¿é—®ä¸€ä¸ªæœåŠ¡ï¼Œä½ éœ€è¦çŸ¥é“ï¼š</p>
<ul>
<li>æœåŠ¡å™¨çš„IPåœ°å€</li>
<li>æœåŠ¡çš„ç«¯å£å·</li>
</ul>
<pre><code class="hljs language-markdown" lang="markdown">é—®é¢˜ï¼š
<span class="hljs-bullet">1.</span> IPåœ°å€å¯èƒ½å˜åŒ–ï¼ˆDHCPåˆ†é…ï¼‰
<span class="hljs-bullet">2.</span> éœ€è¦æ‰‹åŠ¨é…ç½®æˆ–è®°å¿†
<span class="hljs-bullet">3.</span> æ–°è®¾å¤‡åŠ å…¥ç½‘ç»œæ—¶ï¼Œå…¶ä»–äººä¸çŸ¥é“
</code></pre>
<h3 data-id="heading-34">1.2 ç†æƒ³çš„æ–¹å¼</h3>
<pre><code class="hljs language-markdown" lang="markdown">åœºæ™¯ï¼šä½ ä¹°äº†ä¸€å°æ–°æ‰“å°æœº

ä¼ ç»Ÿæ–¹å¼ï¼š
<span class="hljs-bullet">1.</span> æŸ¥çœ‹æ‰“å°æœºIPï¼ˆå¯èƒ½éœ€è¦æŒ‰ä¸€å †æŒ‰é’®ï¼‰
<span class="hljs-bullet">2.</span> åœ¨ç”µè„‘ä¸Šæ‰‹åŠ¨æ·»åŠ 
<span class="hljs-bullet">3.</span> IPå˜äº†è¿˜å¾—é‡æ–°é…ç½®

é›¶é…ç½®æ–¹å¼ï¼š
<span class="hljs-bullet">1.</span> æ‰“å°æœºè¿ä¸ŠWiFi
<span class="hljs-bullet">2.</span> ç”µè„‘è‡ªåŠ¨å‘ç°æ‰“å°æœº
<span class="hljs-bullet">3.</span> ç›´æ¥ä½¿ç”¨
</code></pre>
<p>è¿™å°±æ˜¯mDNSå’ŒDNS-SDè¦è§£å†³çš„é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-35">äºŒã€mDNSï¼šå¤šæ’­DNS</h2>
<h3 data-id="heading-36">2.1 ä»€ä¹ˆæ˜¯mDNS</h3>
<p>mDNSï¼ˆMulticast DNSï¼‰å®šä¹‰åœ¨RFC 6762ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ï¼š</p>
<p><strong>åœ¨å±€åŸŸç½‘å†…ï¼Œä¸éœ€è¦DNSæœåŠ¡å™¨ï¼Œè®¾å¤‡ä¹‹é—´äº’ç›¸åº”ç­”DNSæŸ¥è¯¢</strong></p>
<pre><code class="hljs language-css" lang="css">ä¼ ç»ŸDNSï¼š
<span class="hljs-selector-attr">[Client]</span> â”€â”€æŸ¥è¯¢â”€â†’ <span class="hljs-selector-attr">[DNS Server]</span> â”€â”€å“åº”â”€â†’ <span class="hljs-selector-attr">[Client]</span>

mDNSï¼š
<span class="hljs-selector-attr">[Client]</span> â”€â”€ç»„æ’­æŸ¥è¯¢â”€â†’ <span class="hljs-selector-attr">[æ‰€æœ‰è®¾å¤‡]</span>
                      â†“
            <span class="hljs-selector-attr">[èƒ½å“åº”çš„è®¾å¤‡]</span> â”€â”€ç»„æ’­å“åº”â”€â†’ <span class="hljs-selector-attr">[æ‰€æœ‰è®¾å¤‡]</span>
</code></pre>
<h3 data-id="heading-37">2.2 mDNSæŠ€æœ¯ç»†èŠ‚</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># mDNS å…³é”®å‚æ•°</span>

MDNS_CONFIG = {
    <span class="hljs-string">"multicast_address_ipv4"</span>: <span class="hljs-string">"224.0.0.251"</span>,
    <span class="hljs-string">"multicast_address_ipv6"</span>: <span class="hljs-string">"ff02::fb"</span>,
    <span class="hljs-string">"port"</span>: <span class="hljs-number">5353</span>,
    <span class="hljs-string">"domain"</span>: <span class="hljs-string">".local"</span>,
    <span class="hljs-string">"ttl"</span>: <span class="hljs-number">255</span>  <span class="hljs-comment"># åªåœ¨æœ¬åœ°ç½‘ç»œä¼ æ’­</span>
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆç”¨ .local åŸŸåï¼Ÿ</strong></p>
<ul>
<li><code>.local</code> æ˜¯ä¸“é—¨ä¸ºå±€åŸŸç½‘ä¿ç•™çš„é¡¶çº§åŸŸ</li>
<li>æŸ¥è¯¢ <code>myprinter.local</code> ä¼šè§¦å‘mDNSï¼Œè€Œéä¼ ç»ŸDNS</li>
<li>æ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«å¹¶ä½¿ç”¨mDNSè§£æ</li>
</ul>
<h3 data-id="heading-38">2.3 mDNSæŸ¥è¯¢æµç¨‹</h3>
<pre><code class="hljs language-markdown" lang="markdown">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    mDNS æŸ¥è¯¢æµç¨‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

<span class="hljs-bullet">1.</span> å®¢æˆ·ç«¯æƒ³çŸ¥é“ "mynas.local" çš„IP

<span class="hljs-bullet">2.</span> å®¢æˆ·ç«¯å‘ 224.0.0.251:5353 å‘é€ç»„æ’­æŸ¥è¯¢
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Query: mynas.local, Type: A        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">                    â†“ ç»„æ’­
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  æ‰€æœ‰è®¾å¤‡éƒ½èƒ½æ”¶åˆ°è¿™ä¸ªæŸ¥è¯¢            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span>
<span class="hljs-bullet">3.</span> æ‹¥æœ‰è¯¥åç§°çš„è®¾å¤‡å›å¤ï¼ˆåŒæ ·æ˜¯ç»„æ’­ï¼‰
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Response: mynas.local = 192.168.1.5â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">                    â†“ ç»„æ’­
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  æ‰€æœ‰è®¾å¤‡éƒ½èƒ½æ”¶åˆ°å¹¶ç¼“å­˜è¿™ä¸ªå“åº”      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre>
<h3 data-id="heading-39">2.4 ç”¨Pythonå®ç°mDNSæŸ¥è¯¢</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> socket
<span class="hljs-keyword">import</span> struct

<span class="hljs-keyword">def</span> <span class="hljs-title function_">mdns_query</span>(<span class="hljs-params">name</span>):
    <span class="hljs-string">"""å‘é€mDNSæŸ¥è¯¢"""</span>
    
    MDNS_ADDR = <span class="hljs-string">"224.0.0.251"</span>
    MDNS_PORT = <span class="hljs-number">5353</span>
    
    <span class="hljs-comment"># æ„é€ DNSæŸ¥è¯¢åŒ…</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode_name</span>(<span class="hljs-params">name</span>):
        <span class="hljs-string">"""ç¼–ç DNSåç§°"""</span>
        result = <span class="hljs-string">b''</span>
        <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> name.split(<span class="hljs-string">'.'</span>):
            result += <span class="hljs-built_in">bytes</span>([<span class="hljs-built_in">len</span>(part)]) + part.encode()
        result += <span class="hljs-string">b'\x00'</span>
        <span class="hljs-keyword">return</span> result
    
    <span class="hljs-comment"># DNS Header</span>
    transaction_id = <span class="hljs-number">0x0000</span>  <span class="hljs-comment"># mDNSé€šå¸¸ä½¿ç”¨0</span>
    flags = <span class="hljs-number">0x0000</span>           <span class="hljs-comment"># æ ‡å‡†æŸ¥è¯¢</span>
    questions = <span class="hljs-number">1</span>
    answers = <span class="hljs-number">0</span>
    authority = <span class="hljs-number">0</span>
    additional = <span class="hljs-number">0</span>
    
    header = struct.pack(<span class="hljs-string">'&gt;HHHHHH'</span>, 
        transaction_id, flags, questions, answers, authority, additional)
    
    <span class="hljs-comment"># Question Section</span>
    qname = encode_name(name)
    qtype = <span class="hljs-number">1</span>   <span class="hljs-comment"># Aè®°å½•</span>
    qclass = <span class="hljs-number">1</span>  <span class="hljs-comment"># INç±»</span>
    
    question = qname + struct.pack(<span class="hljs-string">'&gt;HH'</span>, qtype, qclass)
    
    <span class="hljs-comment"># å‘é€æŸ¥è¯¢</span>
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, <span class="hljs-number">1</span>)
    sock.setsockopt(socket.IPPROTO_IP, socket.IP_MULTICAST_TTL, <span class="hljs-number">255</span>)
    sock.settimeout(<span class="hljs-number">2</span>)
    
    <span class="hljs-keyword">try</span>:
        sock.sendto(header + question, (MDNS_ADDR, MDNS_PORT))
        
        <span class="hljs-comment"># æ¥æ”¶å“åº”</span>
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            data, addr = sock.recvfrom(<span class="hljs-number">1024</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ”¶åˆ°å“åº”æ¥è‡ª <span class="hljs-subst">{addr}</span>: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(data)}</span> bytes"</span>)
            <span class="hljs-comment"># è§£æå“åº”...</span>
            
    <span class="hljs-keyword">except</span> socket.timeout:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"æŸ¥è¯¢è¶…æ—¶"</span>)
    <span class="hljs-keyword">finally</span>:
        sock.close()

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
mdns_query(<span class="hljs-string">"mynas.local"</span>)
</code></pre>
<hr/>
<h2 data-id="heading-40">ä¸‰ã€DNS-SDï¼šæœåŠ¡å‘ç°</h2>
<h3 data-id="heading-41">3.1 DNS-SDæ˜¯ä»€ä¹ˆ</h3>
<p>DNS-SDï¼ˆDNS-based Service Discoveryï¼‰å®šä¹‰åœ¨RFC 6763ï¼Œæ˜¯å»ºç«‹åœ¨DNSä¹‹ä¸Šçš„æœåŠ¡å‘ç°åè®®ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">mDNS è§£å†³ï¼šåç§° â†’ IP
DNS-<span class="hljs-built_in">SD</span> è§£å†³ï¼šæˆ‘æƒ³æ‰¾æŸç±»æœåŠ¡ â†’ æœ‰å“ªäº›å…·ä½“æœåŠ¡ â†’ æœåŠ¡çš„è¯¦ç»†ä¿¡æ¯
</code></pre>
<h3 data-id="heading-42">3.2 DNS-SDçš„ä¸‰å±‚æŸ¥è¯¢</h3>
<pre><code class="hljs language-lua" lang="lua">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 DNS-SD ä¸‰å±‚æŸ¥è¯¢æ¨¡å‹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬ä¸€å±‚ï¼šæœåŠ¡ç±»å‹æšä¸¾
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é—®ï¼šè¿™ä¸ªç½‘ç»œé‡Œæœ‰å“ªäº›ç±»å‹çš„æœåŠ¡ï¼Ÿ      â”‚
â”‚ æŸ¥è¯¢ï¼š_services._dns-sd._udp.<span class="hljs-keyword">local</span>  â”‚
â”‚ ç­”ï¼š_http._tcp, _printer._tcp, ...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
ç¬¬äºŒå±‚ï¼šæœåŠ¡å®ä¾‹æšä¸¾
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é—®ï¼šç½‘ç»œé‡Œæœ‰å“ªäº›HTTPæœåŠ¡å™¨ï¼Ÿ         â”‚
â”‚ æŸ¥è¯¢ï¼š_http._tcp.<span class="hljs-keyword">local</span> (PTRè®°å½•)    â”‚
â”‚ ç­”ï¼šMyNAS._http._tcp.<span class="hljs-keyword">local</span>,         â”‚
â”‚     HomeServer._http._tcp.<span class="hljs-keyword">local</span>     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
ç¬¬ä¸‰å±‚ï¼šæœåŠ¡å®ä¾‹è¯¦æƒ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é—®ï¼šMyNASè¿™ä¸ªæœåŠ¡çš„è¯¦ç»†ä¿¡æ¯ï¼Ÿ        â”‚
â”‚ æŸ¥è¯¢ï¼šMyNAS._http._tcp.<span class="hljs-keyword">local</span>        â”‚
â”‚       SRVè®°å½• â†’ ä¸»æœºåå’Œç«¯å£         â”‚
â”‚       TXTè®°å½• â†’ é™„åŠ å±æ€§             â”‚
â”‚       Aè®°å½•   â†’ IPåœ°å€              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-43">3.3 å¸¸è§æœåŠ¡ç±»å‹</h3>













































<table><thead><tr><th>æœåŠ¡ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>_http._tcp</code></td><td>HTTPæœåŠ¡</td></tr><tr><td><code>_https._tcp</code></td><td>HTTPSæœåŠ¡</td></tr><tr><td><code>_ssh._tcp</code></td><td>SSHæœåŠ¡</td></tr><tr><td><code>_smb._tcp</code></td><td>Windowsæ–‡ä»¶å…±äº«</td></tr><tr><td><code>_afpovertcp._tcp</code></td><td>Appleæ–‡ä»¶å…±äº«</td></tr><tr><td><code>_printer._tcp</code></td><td>æ‰“å°æœº</td></tr><tr><td><code>_airplay._tcp</code></td><td>AirPlay</td></tr><tr><td><code>_googlecast._tcp</code></td><td>Chromecast</td></tr><tr><td><code>_hap._tcp</code></td><td>HomeKit</td></tr></tbody></table>
<h3 data-id="heading-44">3.4 DNSè®°å½•ç±»å‹</h3>
<pre><code class="hljs language-lua" lang="lua">ä¸€ä¸ªå®Œæ•´çš„æœåŠ¡æ³¨å†ŒåŒ…å«ä»¥ä¸‹DNSè®°å½•ï¼š

<span class="hljs-number">1.</span> PTRè®°å½•ï¼ˆæœåŠ¡æšä¸¾ï¼‰
   _http._tcp.<span class="hljs-keyword">local</span> â†’ MyNAS._http._tcp.<span class="hljs-keyword">local</span>

<span class="hljs-number">2.</span> SRVè®°å½•ï¼ˆæœåŠ¡ä½ç½®ï¼‰
   MyNAS._http._tcp.<span class="hljs-keyword">local</span> â†’ <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">8080</span> mynas.<span class="hljs-keyword">local</span>
   ï¼ˆä¼˜å…ˆçº§ æƒé‡ ç«¯å£ ä¸»æœºåï¼‰

<span class="hljs-number">3.</span> TXTè®°å½•ï¼ˆé™„åŠ ä¿¡æ¯ï¼‰
   MyNAS._http._tcp.<span class="hljs-keyword">local</span> â†’ <span class="hljs-string">"path=/admin"</span> <span class="hljs-string">"version=1.0"</span>

<span class="hljs-number">4.</span> A/AAAAè®°å½•ï¼ˆIPåœ°å€ï¼‰
   mynas.<span class="hljs-keyword">local</span> â†’ <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.5</span>
</code></pre>
<hr/>
<h2 data-id="heading-45">å››ã€å®æˆ˜ï¼šPythonå®ç°æœåŠ¡å‘ç°</h2>
<h3 data-id="heading-46">4.1 ä½¿ç”¨zeroconfåº“</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å®‰è£…ï¼špip install zeroconf</span>

<span class="hljs-keyword">from</span> zeroconf <span class="hljs-keyword">import</span> ServiceBrowser, Zeroconf, ServiceListener
<span class="hljs-keyword">import</span> socket

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyListener</span>(<span class="hljs-title class_ inherited__">ServiceListener</span>):
    <span class="hljs-string">"""æœåŠ¡å‘ç°ç›‘å¬å™¨"""</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_service</span>(<span class="hljs-params">self, zc: Zeroconf, type_: <span class="hljs-built_in">str</span>, name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""å‘ç°æ–°æœåŠ¡"""</span>
        info = zc.get_service_info(type_, name)
        <span class="hljs-keyword">if</span> info:
            addresses = [socket.inet_ntoa(addr) <span class="hljs-keyword">for</span> addr <span class="hljs-keyword">in</span> info.addresses]
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nâœ… å‘ç°æœåŠ¡: <span class="hljs-subst">{name}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ç±»å‹: <span class="hljs-subst">{type_}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   åœ°å€: <span class="hljs-subst">{addresses}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   ç«¯å£: <span class="hljs-subst">{info.port}</span>"</span>)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"   å±æ€§: <span class="hljs-subst">{info.properties}</span>"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">remove_service</span>(<span class="hljs-params">self, zc: Zeroconf, type_: <span class="hljs-built_in">str</span>, name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""æœåŠ¡ä¸‹çº¿"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nâŒ æœåŠ¡ä¸‹çº¿: <span class="hljs-subst">{name}</span>"</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_service</span>(<span class="hljs-params">self, zc: Zeroconf, type_: <span class="hljs-built_in">str</span>, name: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:
        <span class="hljs-string">"""æœåŠ¡æ›´æ–°"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\nğŸ”„ æœåŠ¡æ›´æ–°: <span class="hljs-subst">{name}</span>"</span>)


<span class="hljs-keyword">def</span> <span class="hljs-title function_">discover_services</span>(<span class="hljs-params">service_type=<span class="hljs-string">"_http._tcp.local."</span>, timeout=<span class="hljs-number">10</span></span>):
    <span class="hljs-string">"""å‘ç°æŒ‡å®šç±»å‹çš„æœåŠ¡"""</span>
    
    zeroconf = Zeroconf()
    listener = MyListener()
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ­£åœ¨æœç´¢ <span class="hljs-subst">{service_type}</span> æœåŠ¡..."</span>)
    browser = ServiceBrowser(zeroconf, service_type, listener)
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">import</span> time
        time.sleep(timeout)
    <span class="hljs-keyword">finally</span>:
        zeroconf.close()


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># æœç´¢HTTPæœåŠ¡</span>
    discover_services(<span class="hljs-string">"_http._tcp.local."</span>)
    
    <span class="hljs-comment"># æœç´¢SSHæœåŠ¡</span>
    <span class="hljs-comment"># discover_services("_ssh._tcp.local.")</span>
    
    <span class="hljs-comment"># æœç´¢æ‰€æœ‰æœåŠ¡</span>
    <span class="hljs-comment"># discover_services("_services._dns-sd._udp.local.")</span>
</code></pre>
<h3 data-id="heading-47">4.2 æ³¨å†Œè‡ªå·±çš„æœåŠ¡</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> zeroconf <span class="hljs-keyword">import</span> Zeroconf, ServiceInfo
<span class="hljs-keyword">import</span> socket

<span class="hljs-keyword">def</span> <span class="hljs-title function_">register_service</span>(<span class="hljs-params">name, service_type, port, properties=<span class="hljs-literal">None</span></span>):
    <span class="hljs-string">"""æ³¨å†Œä¸€ä¸ªæœåŠ¡"""</span>
    
    zeroconf = Zeroconf()
    
    <span class="hljs-comment"># è·å–æœ¬æœºIP</span>
    hostname = socket.gethostname()
    local_ip = socket.gethostbyname(hostname)
    
    <span class="hljs-comment"># åˆ›å»ºæœåŠ¡ä¿¡æ¯</span>
    service_info = ServiceInfo(
        type_=service_type,
        name=<span class="hljs-string">f"<span class="hljs-subst">{name}</span>.<span class="hljs-subst">{service_type}</span>"</span>,
        addresses=[socket.inet_aton(local_ip)],
        port=port,
        properties=properties <span class="hljs-keyword">or</span> {},
        server=<span class="hljs-string">f"<span class="hljs-subst">{hostname}</span>.local."</span>
    )
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ³¨å†ŒæœåŠ¡: <span class="hljs-subst">{name}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç±»å‹: <span class="hljs-subst">{service_type}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"åœ°å€: <span class="hljs-subst">{local_ip}</span>:<span class="hljs-subst">{port}</span>"</span>)
    
    zeroconf.register_service(service_info)
    
    <span class="hljs-keyword">return</span> zeroconf, service_info


<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-comment"># æ³¨å†Œä¸€ä¸ªHTTPæœåŠ¡</span>
    zc, info = register_service(
        name=<span class="hljs-string">"MyWebServer"</span>,
        service_type=<span class="hljs-string">"_http._tcp.local."</span>,
        port=<span class="hljs-number">8080</span>,
        properties={
            <span class="hljs-string">"path"</span>: <span class="hljs-string">"/api"</span>,
            <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0"</span>
        }
    )
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\næœåŠ¡å·²æ³¨å†Œï¼ŒæŒ‰ Ctrl+C é€€å‡º..."</span>)
    
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">import</span> time
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            time.sleep(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        <span class="hljs-keyword">pass</span>
    <span class="hljs-keyword">finally</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\næ³¨é”€æœåŠ¡..."</span>)
        zc.unregister_service(info)
        zc.close()


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<h3 data-id="heading-48">4.3 å‘½ä»¤è¡Œæµ‹è¯•å·¥å…·</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS è‡ªå¸¦çš„ dns-sd å·¥å…·</span>

<span class="hljs-comment"># æµè§ˆHTTPæœåŠ¡</span>
dns-sd -B _http._tcp <span class="hljs-built_in">local</span>

<span class="hljs-comment"># æŸ¥çœ‹æœåŠ¡è¯¦æƒ…</span>
dns-sd -L <span class="hljs-string">"MyNAS"</span> _http._tcp <span class="hljs-built_in">local</span>

<span class="hljs-comment"># æ³¨å†Œä¸€ä¸ªæœåŠ¡</span>
dns-sd -R <span class="hljs-string">"TestService"</span> _http._tcp <span class="hljs-built_in">local</span> 8080 path=/test

<span class="hljs-comment"># Linux ä½¿ç”¨ avahi</span>
<span class="hljs-comment"># å®‰è£…ï¼šapt install avahi-utils</span>

<span class="hljs-comment"># æµè§ˆæœåŠ¡</span>
avahi-browse -a

<span class="hljs-comment"># æµè§ˆç‰¹å®šç±»å‹</span>
avahi-browse _http._tcp

<span class="hljs-comment"># æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</span>
avahi-browse -r _http._tcp

<span class="hljs-comment"># å‘å¸ƒæœåŠ¡</span>
avahi-publish -s <span class="hljs-string">"MyService"</span> _http._tcp 8080 <span class="hljs-string">"path=/api"</span>
</code></pre>
<hr/>
<h2 data-id="heading-49">äº”ã€è·¨ç½‘æ®µçš„æœåŠ¡å‘ç°éš¾é¢˜</h2>
<h3 data-id="heading-50">5.1 mDNSçš„å±€é™æ€§</h3>
<pre><code class="hljs language-css" lang="css">mDNSä½¿ç”¨ç»„æ’­ï¼Œç»„æ’­æœ‰ä¸€ä¸ªå¤©ç„¶çš„é™åˆ¶ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ç½‘æ®µ<span class="hljs-selector-tag">A</span>        â”‚         â”‚    ç½‘æ®µ<span class="hljs-selector-tag">B</span>        â”‚
â”‚ <span class="hljs-number">192.168</span>.<span class="hljs-number">1.0</span>/<span class="hljs-number">24</span>  â”‚ è·¯ç”±å™¨  â”‚ <span class="hljs-number">192.168</span>.<span class="hljs-number">2.0</span>/<span class="hljs-number">24</span>  â”‚
â”‚                 â”‚ â•â•â•â•â•â•â• â”‚                 â”‚
â”‚  <span class="hljs-selector-attr">[è®¾å¤‡A]</span>        â”‚    âœ—    â”‚    <span class="hljs-selector-attr">[è®¾å¤‡B]</span>      â”‚
â”‚                 â”‚ ç»„æ’­è¢«é˜»â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç»„æ’­é»˜è®¤ä¸ä¼šè·¨è¶Šè·¯ç”±å™¨è¾¹ç•Œï¼
</code></pre>
<h3 data-id="heading-51">5.2 è§£å†³æ–¹æ¡ˆå¯¹æ¯”</h3>



































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>åŸç†</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>mDNS Reflector</td><td>è·¯ç”±å™¨è½¬å‘mDNSåŒ…</td><td>ç®€å•</td><td>éœ€è¦è·¯ç”±å™¨æ”¯æŒ</td></tr><tr><td>Avahi Gateway</td><td>ä¸“é—¨çš„ç½‘å…³è½¬å‘</td><td>çµæ´»</td><td>éœ€è¦é¢å¤–è®¾å¤‡</td></tr><tr><td>Wide Area DNS-SD</td><td>ä½¿ç”¨ä¼ ç»ŸDNS</td><td>è·¨äº’è”ç½‘</td><td>é…ç½®å¤æ‚</td></tr><tr><td>ç»„ç½‘æ–¹æ¡ˆ</td><td>è™šæ‹Ÿå±€åŸŸç½‘</td><td>å…¨é€æ˜</td><td>éœ€è¦å®¢æˆ·ç«¯</td></tr></tbody></table>
<h3 data-id="heading-52">5.3 è™šæ‹Ÿå±€åŸŸç½‘æ–¹æ¡ˆ</h3>
<p>å¯¹äºéœ€è¦è·¨åœ°åŸŸè®¿é—®çš„åœºæ™¯ï¼Œæœ€ç›´æ¥çš„æ–¹æ¡ˆæ˜¯å°†ä¸åŒç½‘æ®µçš„è®¾å¤‡ç»„æˆä¸€ä¸ª<strong>è™šæ‹Ÿå±€åŸŸç½‘</strong>ã€‚</p>
<pre><code class="hljs language-css" lang="css">å¼‚åœ°ç»„ç½‘åçš„æ•ˆæœï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    å®¶é‡Œ         â”‚         â”‚    å…¬å¸         â”‚
â”‚ <span class="hljs-number">192.168</span>.<span class="hljs-number">1.0</span>/<span class="hljs-number">24</span>  â”‚ è™šæ‹Ÿç½‘  â”‚ <span class="hljs-number">10.0</span>.<span class="hljs-number">0.0</span>/<span class="hljs-number">24</span>     â”‚
â”‚                 â”‚ â•â•â•â•â•â•â• â”‚                 â”‚
â”‚  <span class="hljs-selector-attr">[NAS]</span>          â”‚   âœ“     â”‚    <span class="hljs-selector-attr">[ç¬”è®°æœ¬]</span>     â”‚
â”‚                 â”‚ ç»„æ’­æ­£å¸¸â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

mDNS/DNS-SD æ­£å¸¸å·¥ä½œï¼Œè‡ªåŠ¨å‘ç°NASï¼
</code></pre>
<p>åƒ<strong>æ˜Ÿç©ºç»„ç½‘</strong>è¿™ç±»æ–¹æ¡ˆï¼Œå¯ä»¥å°†å¤šä¸ªå±€åŸŸç½‘æ‰“é€šå½¢æˆä¸€ä¸ªè™šæ‹Ÿå¤§å±€åŸŸç½‘ï¼Œè¿™æ ·mDNSå’ŒDNS-SDå°±èƒ½æ­£å¸¸å·¥ä½œï¼Œå®ç°è·¨åœ°åŸŸçš„æœåŠ¡è‡ªåŠ¨å‘ç°ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®IPã€‚</p>
<hr/>
<h2 data-id="heading-53">å…­ã€å®é™…åº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-54">6.1 NASè‡ªåŠ¨å‘ç°</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å‘ç°å±€åŸŸç½‘å†…çš„NASè®¾å¤‡</span>

NAS_SERVICE_TYPES = [
    <span class="hljs-string">"_smb._tcp.local."</span>,      <span class="hljs-comment"># Windowså…±äº«</span>
    <span class="hljs-string">"_afpovertcp._tcp.local."</span>, <span class="hljs-comment"># Appleå…±äº«</span>
    <span class="hljs-string">"_nfs._tcp.local."</span>,      <span class="hljs-comment"># NFS</span>
    <span class="hljs-string">"_webdav._tcp.local."</span>,   <span class="hljs-comment"># WebDAV</span>
    <span class="hljs-string">"_http._tcp.local."</span>,     <span class="hljs-comment"># Webç®¡ç†ç•Œé¢</span>
]

<span class="hljs-keyword">for</span> service_type <span class="hljs-keyword">in</span> NAS_SERVICE_TYPES:
    discover_services(service_type, timeout=<span class="hljs-number">3</span>)
</code></pre>
<h3 data-id="heading-55">6.2 æ™ºèƒ½å®¶å±…è®¾å¤‡å‘ç°</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å‘ç°æ™ºèƒ½å®¶å±…è®¾å¤‡</span>

SMART_HOME_SERVICES = [
    <span class="hljs-string">"_hap._tcp.local."</span>,        <span class="hljs-comment"># HomeKit</span>
    <span class="hljs-string">"_homekit._tcp.local."</span>,    <span class="hljs-comment"># HomeKit</span>
    <span class="hljs-string">"_airplay._tcp.local."</span>,    <span class="hljs-comment"># AirPlay</span>
    <span class="hljs-string">"_googlecast._tcp.local."</span>, <span class="hljs-comment"># Google Cast</span>
    <span class="hljs-string">"_spotify-connect._tcp.local."</span>, <span class="hljs-comment"># Spotify</span>
]
</code></pre>
<h3 data-id="heading-56">6.3 å¼€å‘ç¯å¢ƒæœåŠ¡å‘ç°</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># å¾®æœåŠ¡å¼€å‘æ—¶ï¼Œè‡ªåŠ¨å‘ç°åŒäº‹çš„æœåŠ¡</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">register_dev_service</span>(<span class="hljs-params">service_name, port</span>):
    <span class="hljs-string">"""æ³¨å†Œå¼€å‘æœåŠ¡"""</span>
    register_service(
        name=<span class="hljs-string">f"<span class="hljs-subst">{service_name}</span>-<span class="hljs-subst">{socket.gethostname()}</span>"</span>,
        service_type=<span class="hljs-string">"_dev._tcp.local."</span>,
        port=port,
        properties={
            <span class="hljs-string">"developer"</span>: os.getenv(<span class="hljs-string">"USER"</span>),
            <span class="hljs-string">"version"</span>: <span class="hljs-string">"dev"</span>,
            <span class="hljs-string">"branch"</span>: get_git_branch()
        }
    )
</code></pre>
<hr/>
<h2 data-id="heading-57">ä¸ƒã€å®‰å…¨æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-58">7.1 mDNSçš„å®‰å…¨é£é™©</h3>
<pre><code class="hljs language-markdown" lang="markdown">é£é™©ï¼š
<span class="hljs-bullet">1.</span> ä¿¡æ¯æ³„éœ² - ä»»ä½•äººéƒ½èƒ½å‘ç°å±€åŸŸç½‘å†…çš„æœåŠ¡
<span class="hljs-bullet">2.</span> æ¬ºéª—æ”»å‡» - æ¶æ„è®¾å¤‡å¯ä»¥å†’å……æœåŠ¡
<span class="hljs-bullet">3.</span> æ”¾å¤§æ”»å‡» - ç»„æ’­å¯èƒ½è¢«åˆ©ç”¨è¿›è¡ŒDDoS

é˜²æŠ¤ï¼š
<span class="hljs-bullet">1.</span> åœ¨ä¸å—ä¿¡ä»»çš„ç½‘ç»œä¸Šç¦ç”¨mDNS
<span class="hljs-bullet">2.</span> é˜²ç«å¢™é™åˆ¶5353ç«¯å£
<span class="hljs-bullet">3.</span> æœåŠ¡è‡ªèº«éœ€è¦è®¤è¯
</code></pre>
<h3 data-id="heading-59">7.2 æœ€ä½³å®è·µ</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Linux é˜²ç«å¢™è§„åˆ™ç¤ºä¾‹</span>

<span class="hljs-comment"># åªå…è®¸ä¿¡ä»»ç½‘æ®µçš„mDNS</span>
iptables -A INPUT -s 192.168.1.0/24 -p udp --dport 5353 -j ACCEPT
iptables -A INPUT -p udp --dport 5353 -j DROP

<span class="hljs-comment"># macOS ç¦ç”¨mDNSå“åº”</span>
sudo defaults write /Library/Preferences/com.apple.mDNSResponder.plist NoMulticastAdvertisements -bool YES
</code></pre>
<hr/>
<h2 data-id="heading-60">å…«ã€æ€»ç»“</h2>
<p>mDNSå’ŒDNS-SDæ˜¯å±€åŸŸç½‘æœåŠ¡å‘ç°çš„åŸºçŸ³ï¼š</p>




















<table><thead><tr><th>æŠ€æœ¯</th><th>ä½œç”¨</th><th>RFC</th></tr></thead><tbody><tr><td>mDNS</td><td>å±€åŸŸç½‘å†…åç§°è§£æ</td><td>RFC 6762</td></tr><tr><td>DNS-SD</td><td>æœåŠ¡å‘ç°åè®®</td><td>RFC 6763</td></tr></tbody></table>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>âœ… åŒä¸€å±€åŸŸç½‘å†…çš„è®¾å¤‡äº’å‘ç°</li>
<li>âœ… æ™ºèƒ½å®¶å±…ã€æ‰“å°æœºã€NASç­‰</li>
<li>âœ… å¼€å‘ç¯å¢ƒå¾®æœåŠ¡å‘ç°</li>
</ul>
<p><strong>å±€é™æ€§</strong>ï¼š</p>
<ul>
<li>âŒ æ— æ³•è·¨ç½‘æ®µï¼ˆéœ€è¦é¢å¤–æ–¹æ¡ˆï¼‰</li>
<li>âŒ æ— å®‰å…¨æœºåˆ¶ï¼ˆéœ€è¦åº”ç”¨å±‚è®¤è¯ï¼‰</li>
</ul>
<p><strong>è§£å†³è·¨ç½‘æ®µé—®é¢˜</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ç»„ç½‘æ–¹æ¡ˆæ‰“é€šå¤šä¸ªå±€åŸŸç½‘</li>
<li>æœåŠ¡å‘ç°å°±åƒåœ¨åŒä¸€å±€åŸŸç½‘ä¸€æ ·è‡ªç„¶</li>
</ul>
<hr/>
<h2 data-id="heading-61">å‚è€ƒæ–‡çŒ®</h2>
<ol>
<li>RFC 6762 - Multicast DNS</li>
<li>RFC 6763 - DNS-Based Service Discovery</li>
<li>Apple Bonjour Developer Documentation</li>
<li>Avahi - A Zeroconf Implementation for Linux</li>
</ol>
<hr/>
<blockquote>
<p>ğŸ’¡ <strong>å®è·µå»ºè®®</strong>ï¼šåœ¨å¼€å‘å±€åŸŸç½‘åº”ç”¨æ—¶ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨mDNS/DNS-SDè¿›è¡ŒæœåŠ¡å‘ç°ï¼Œå¯ä»¥å¤§å¹…ç®€åŒ–ç”¨æˆ·é…ç½®ã€‚å¦‚æœéœ€è¦è·¨å±€åŸŸç½‘è®¿é—®ï¼Œè€ƒè™‘ä½¿ç”¨ç»„ç½‘æ–¹æ¡ˆç»Ÿä¸€ç½‘ç»œã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é«˜å¾·åœ°å›¾ä¸Three.jsç»“åˆå®ç°3Då¤§å±å¯è§†åŒ– | æ˜é‡‘ä¸€å‘¨ 1.8]]></title>    <link>https://juejin.cn/post/7592765004806733875</link>    <guid>https://juejin.cn/post/7592765004806733875</guid>    <pubDate>2026-01-08T06:58:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592765004806733875" data-draft-id="7592159803411546148" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é«˜å¾·åœ°å›¾ä¸Three.jsç»“åˆå®ç°3Då¤§å±å¯è§†åŒ– | æ˜é‡‘ä¸€å‘¨ 1.8"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-08T06:58:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜é‡‘ä¸€å‘¨"/> <meta itemprop="url" content="https://juejin.cn/user/53218623894222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é«˜å¾·åœ°å›¾ä¸Three.jsç»“åˆå®ç°3Då¤§å±å¯è§†åŒ– | æ˜é‡‘ä¸€å‘¨ 1.8
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/53218623894222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜é‡‘ä¸€å‘¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:58:43.000Z" title="Thu Jan 08 2026 06:58:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><em>æœ¬æ–‡å­—æ•°1400+ ï¼Œé˜…è¯»æ—¶é—´å¤§çº¦éœ€è¦ 4åˆ†é’Ÿã€‚</em></p>
<blockquote>
<p>ã€æ˜é‡‘ä¸€å‘¨ã€‘æœ¬æœŸäº®ç‚¹ï¼š</p>
</blockquote>
<ul>
<li><a href="https://juejin.cn/post/7589482741759819803" target="_blank" title="https://juejin.cn/post/7589482741759819803">é«˜å¾·åœ°å›¾ä¸Three.jsç»“åˆå®ç°3Då¤§å±å¯è§†åŒ–</a></li>
<li><a href="https://juejin.cn/post/7589093895327531017" target="_blank" title="https://juejin.cn/post/7589093895327531017">è€ç‹è¯·å‡ã€å®¢æˆ·å¼€å–·ã€æˆ‘æ•‘ç«ï¼šä¸€åœºé€’å½’æ ‘çš„æ€§èƒ½çªå›´æˆ˜</a></li>
<li><a href="https://juejin.cn/post/7591330139083898895" target="_blank" title="https://juejin.cn/post/7591330139083898895">ä¸€æ¯èŒ¶æ—¶é—´å¸¦ä½ åŸºäº Yjs å’Œ reactflow æ„å»ºååŒæµç¨‹å›¾ç¼–è¾‘å™¨ ğŸ˜ğŸ˜ğŸ˜</a></li>
<li><a href="https://juejin.cn/post/7589325011543932966" target="_blank" title="https://juejin.cn/post/7589325011543932966">RocketMQé«˜æ€§èƒ½æ­ç§˜ï¼šæ‰¿è½½ä¸‡äº¿çº§æµé‡çš„æ¶æ„å¥¥ç§˜ï½œå¾—ç‰©æŠ€æœ¯</a></li>
<li><a href="https://juejin.cn/post/7589494074982268979" target="_blank" title="https://juejin.cn/post/7589494074982268979">æ€§èƒ½æå‡ 4000%ï¼æˆ‘æ˜¯å¦‚ä½•è§£å†³ è¿è¥çœ‹æ¿ ä¸èƒ½è·¨åº“&amp;è·¨åº“æŸ¥è¯¢æ…¢è¿™ä¸ªéš¾é¢˜çš„</a></li>
<li><a href="https://juejin.cn/post/7591348605867343907" target="_blank" title="https://juejin.cn/post/7591348605867343907">Android 12 SplashScreen ä¸€ç§å¦ç±»çš„é€‚é…æ–¹æ¡ˆ</a></li>
<li><a href="https://juejin.cn/post/7591416714694344714" target="_blank" title="https://juejin.cn/post/7591416714694344714">Android Profilerå®æˆ˜å®å…¸ï¼šæªå‡ºCPUè€—æ—¶å…ƒå‡¶ä¸å†…å­˜æ³„éœ²å°å·</a></li>
<li><a href="https://juejin.cn/post/7589494074983727155" target="_blank" title="https://juejin.cn/post/7589494074983727155">iOSç–‘éš¾Crash-_dispatch_barrier_waiter_redirect_or_wake å´©æºƒæ²»ç†</a></li>
<li><a href="https://juejin.cn/post/7591350620189360134" target="_blank" title="https://juejin.cn/post/7591350620189360134">Flutter 3.38.1 ä¹‹åï¼Œå› ä¸ºæŸäº›æ¡†æ¶ä½çº§é”™è¯¯å¯¼è‡´æäº¤ Store è¢«æ‹’</a></li>
</ul>
<blockquote>
<p><strong>ã€Œä¸Šæ¦œè§„åˆ™ã€</strong>ï¼šæ–‡ç« å‘å¸ƒæ—¶é—´åœ¨æœ¬æœŸã€Œæ˜é‡‘ä¸€å‘¨ã€å‘å¸ƒæ—¶é—´çš„å‰ä¸€å‘¨å†…ï¼›ä¸”ç¬¦åˆå„ä¸ªæ ç›®çš„å†…å®¹å®šä½å’Œè¦æ±‚ã€‚ å¦‚å‘ç°æ–‡ç« æœ‰æŠ„è¢­ã€æ´—ç¨¿ç­‰è¿åç¤¾åŒºè§„åˆ™çš„è¡Œä¸ºï¼Œå°†å–æ¶ˆå½“æœŸåŠåç»­ä¸Šæ¦œèµ„æ ¼ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ä¸€å‘¨â€œé‡‘â€é€‰</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73d5bf990a124e3a87cffb06443ad9ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5LiA5ZGo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460323&amp;x-signature=7z0xOk%2FdFZLmeeHjwgafbYfCr30%3D" alt="æ˜é‡‘ä¸€å‘¨ æ–‡ç« å¤´å›¾ 1303x734.jpg" loading="lazy"/></p>
<p><em>å†…å®¹è¯„å®¡ä»¬ä¼šåœ¨è¿‡å»çš„ä¸€å‘¨å†…å¯¹ç¤¾åŒºæ·±åº¦æŠ€æœ¯å¥½æ–‡è¿›è¡ŒæŒ–æ˜å’Œç­›é€‰ï¼Œä¼˜è´¨çš„æŠ€æœ¯æ–‡ç« æœ‰æœºä¼šå‡ºç°åœ¨ä¸‹æ–¹æ¦œå•ä¸­ï¼Œæ’åä¸åˆ†å…ˆåã€‚</em></p>
<h3 data-id="heading-1">å‰ç«¯</h3>
<p><a href="https://juejin.cn/post/7589482741759819803" target="_blank" title="https://juejin.cn/post/7589482741759819803">é«˜å¾·åœ°å›¾ä¸Three.jsç»“åˆå®ç°3Då¤§å±å¯è§†åŒ–</a> <a href="https://juejin.cn/user/1099167360886078/posts" target="_blank" title="https://juejin.cn/user/1099167360886078/posts"> @å­™_åé¹</a></p>
<blockquote>
<p>é€šè¿‡é«˜å¾·åœ°å›¾ä¸Three.jsçš„æ·±åº¦ç»“åˆï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†3Dæ¨¡å‹åœ¨åœ°å›¾ä¸Šçš„å®æ—¶å±•ç¤ºå’ŒåŠ¨ç”»æ•ˆæœï¼Œå¹¶é›†æˆäº†AIå¤§æ¨¡å‹å®ç°æ™ºèƒ½å®‰å…¨éšæ‚£æ£€æµ‹ã€‚</p>
</blockquote>
<p><a href="https://juejin.cn/post/7589093895327531017" target="_blank" title="https://juejin.cn/post/7589093895327531017">è€ç‹è¯·å‡ã€å®¢æˆ·å¼€å–·ã€æˆ‘æ•‘ç«ï¼šä¸€åœºé€’å½’æ ‘çš„æ€§èƒ½çªå›´æˆ˜</a>  <a href="https://juejin.cn/user/3035079961218551/posts" target="_blank" title="https://juejin.cn/user/3035079961218551/posts">@ä¸ä¸€æ ·çš„å°‘å¹´_</a></p>
<blockquote>
<p>åˆšæ¥æ‰‹æ—¶ï¼Œçœ‹ç€é‚£å¯†å¯†éº»éº»çš„ä»£ç å’Œæ»¡å±çš„çº¢è‰² Long Taskï¼Œå¿ƒé‡Œç¡®å®æœ‰ç‚¹å‘æ€µã€‚ä½†é™ä¸‹å¿ƒæ¥ï¼Œç”¨ Performance é¢æ¿è¿™æŠŠâ€œæ‰‹æœ¯åˆ€â€åˆ‡ä¸‹å»ï¼Œç—…ç¶å…¶å®å¾ˆæ¸…æ™°ï¼š<strong>æ— èŠ‚åˆ¶çš„ DOM æ“ä½œ</strong>Â å’ŒÂ <strong>æ˜‚è´µçš„é‡æ’å¼€é”€</strong>ã€‚</p>
</blockquote>
<p><a href="https://juejin.cn/post/7591330139083898895" target="_blank" title="https://juejin.cn/post/7591330139083898895">ä¸€æ¯èŒ¶æ—¶é—´å¸¦ä½ åŸºäº Yjs å’Œ reactflow æ„å»ºååŒæµç¨‹å›¾ç¼–è¾‘å™¨ ğŸ˜ğŸ˜ğŸ˜</a>    <a href="https://juejin.cn/user/3782764966460398/posts" target="_blank" title="https://juejin.cn/user/3782764966460398/posts">@Moment_</a></p>
<blockquote>
<p>é€šè¿‡è¿™ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬ä¸ä»…å­¦ä¼šäº†å¦‚ä½•æ„å»ºååŒåº”ç”¨ï¼Œæ›´é‡è¦çš„æ˜¯ç†è§£äº†ååŒç¼–è¾‘çš„æ ¸å¿ƒæ€æƒ³ï¼šé€šè¿‡ CRDT ç®—æ³•ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œé€šè¿‡å¢é‡åŒæ­¥å‡å°‘ç½‘ç»œä¼ è¾“ï¼Œé€šè¿‡ Awareness å®ç°å®æ—¶åä½œä½“éªŒã€‚</p>
</blockquote>
<p><a href="https://juejin.cn/post/7589509638355140635" target="_blank" title="https://juejin.cn/post/7589509638355140635">åŠå¹´ä¸€ç™¾ä¸ªé¡µé¢ï¼Œé‡æ„ç³»ç»Ÿä¹Ÿé‡æ„äº†æˆ‘å¯¹å‰ç«¯å·¥ä½œçš„ç†è§£</a> <a href="https://juejin.cn/user/1987553160857261/posts" target="_blank" title="https://juejin.cn/user/1987553160857261/posts">  @çº¸ä¸Šçš„å½©è™¹
</a></p>
<blockquote>
<p>ä½œä¸ºå‰ç«¯å¼€å‘è€…æˆ‘ä»¬ç”¨ç€åŒæ ·çš„è®¡ç®—æœºè¯­è¨€ï¼Œå´èº«å¤„å®Œå…¨ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œ<strong>é‡æ„ä»£ç çš„åŒæ—¶æ€è€ƒå¦‚ä½•æå‡ç”¨æˆ·çš„ä½¿ç”¨ä½“éªŒï¼Œæ‰æ˜¯æˆ‘ä»¬ä½œä¸ºå‰ç«¯ç ”å‘çš„ä»·å€¼ä½“ç°ã€‚</strong></p>
</blockquote>
<h3 data-id="heading-2">åç«¯</h3>
<p><a href="https://juejin.cn/post/7589325011543932966" target="_blank" title="https://juejin.cn/post/7589325011543932966">RocketMQé«˜æ€§èƒ½æ­ç§˜ï¼šæ‰¿è½½ä¸‡äº¿çº§æµé‡çš„æ¶æ„å¥¥ç§˜ï½œå¾—ç‰©æŠ€æœ¯</a> <a href="https://juejin.cn/user/2392954206960247/posts" target="_blank" title="https://juejin.cn/user/2392954206960247/posts">@å¾—ç‰©æŠ€æœ¯</a></p>
<blockquote>
<p>RocketMQä½œä¸ºä¸€æ¬¾é«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå…¶æ ¸å¿ƒæ¶æ„é‡‡ç”¨äº†ç»å…¸çš„å››ç»„ä»¶ååŒè®¾è®¡ï¼Œå®ç°äº†æ¶ˆæ¯ç”Ÿäº§ã€å­˜å‚¨ã€è·¯ç”±ä¸æ¶ˆè´¹çš„å…¨é“¾è·¯è§£è€¦ä¸é«˜æ•ˆååŒã€‚</p>
</blockquote>
<p><a href="https://juejin.cn/post/7589494074982268979" target="_blank" title="https://juejin.cn/post/7589494074982268979">æ€§èƒ½æå‡ 4000%ï¼æˆ‘æ˜¯å¦‚ä½•è§£å†³ è¿è¥çœ‹æ¿ ä¸èƒ½è·¨åº“&amp;è·¨åº“æŸ¥è¯¢æ…¢è¿™ä¸ªéš¾é¢˜çš„</a> <a href="https://juejin.cn/user/2175258804632332/posts" target="_blank" title="https://juejin.cn/user/2175258804632332/posts">@ä¹Ÿæ— é£é›¨ä¹Ÿé›¾æ™´</a></p>
<blockquote>
<p>æ•°æ®åº“éš”ç¦»çš„å¥½å¤„å¤§å®¶éƒ½çŸ¥é“ï¼šæœåŠ¡ç‹¬ç«‹éƒ¨ç½²ã€æ•…éšœéš”ç¦»ã€æŠ€æœ¯æ ˆçµæ´»ã€‚
ä½†æœ‰ä¸ªç°å®é—®é¢˜ï¼š<strong>è¿è¥æŠ¥è¡¨éœ€è¦èšåˆå¤šä¸ªåº“çš„æ•°æ®</strong>ã€‚æ¯”å¦‚æˆ‘ä»¬è¦åšä¸€ä¸ªæ¶ˆæ¯è¯„ä»·çœ‹æ¿ï¼Œè¯„ä»·æ•°æ®åœ¨ä¸šåŠ¡åº“ï¼Œç”¨æˆ·ååœ¨ç”¨æˆ·åº“ï¼Œéœ€è¦ JOIN æ‰èƒ½å‡ºæŠ¥è¡¨ã€‚</p>
</blockquote>
<h3 data-id="heading-3">Android</h3>
<p><a href="https://juejin.cn/post/7591348605867343907" target="_blank" title="https://juejin.cn/post/7591348605867343907">Android 12 SplashScreen ä¸€ç§å¦ç±»çš„é€‚é…æ–¹æ¡ˆ</a> <a href="https://juejin.cn/user/712139265815144/posts" target="_blank" title="https://juejin.cn/user/712139265815144/posts">@Androidè½®å­å“¥</a></p>
<blockquote>
<p>ç³»ç»Ÿè¯»å– App ä¸»é¢˜çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡è¯»å– xml æ–‡ä»¶æ¥è·å–å±æ€§çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ç‰ˆæœ¬å¹¶ä¸ä¼šå»è¯»å–é«˜ç‰ˆæœ¬çš„å±æ€§ï¼Œå› ä¸ºå®ƒå‹æ ¹ä¸çŸ¥é“æœ‰è¿™å‡ ä¸ªå±æ€§ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ï¼Œç»è¿‡éªŒè¯ä¹Ÿç¡®å®å¦‚æ­¤ã€‚</p>
</blockquote>
<p><a href="https://juejin.cn/post/7591416714694344714" target="_blank" title="https://juejin.cn/post/7591416714694344714">Android Profilerå®æˆ˜å®å…¸ï¼šæªå‡ºCPUè€—æ—¶å…ƒå‡¶ä¸å†…å­˜æ³„éœ²å°å·</a> <a href="https://juejin.cn/user/2365804752153911/posts" target="_blank" title="https://juejin.cn/user/2365804752153911/posts">@é¡¾æ—æµ·</a></p>
<blockquote>
<p>Android Profileræ˜¯é€šè¿‡ä¸è®¾å¤‡çš„ARTè™šæ‹Ÿæœºäº¤äº’ï¼Œé‡‡é›†è¿›ç¨‹çš„è¿è¡Œæ•°æ®ï¼ˆæ¯”å¦‚çº¿ç¨‹çŠ¶æ€ã€å†…å­˜åˆ†é…ã€å‡½æ•°è°ƒç”¨è€—æ—¶ç­‰ï¼‰ï¼Œç„¶åé€šè¿‡å¯è§†åŒ–çš„æ–¹å¼å±•ç¤ºç»™æˆ‘ä»¬ã€‚å°±åƒåŒ»ç”Ÿç»™ç—…äººæµ‹å¿ƒç”µå›¾ã€è¡€å‹ï¼Œé€šè¿‡æ•°æ®æ³¢åŠ¨åˆ¤æ–­èº«ä½“çŠ¶å†µï¼Œæˆ‘ä»¬é€šè¿‡Profilerçš„æ›²çº¿æ³¢åŠ¨å’Œè¯¦ç»†æ•°æ®ï¼Œåˆ¤æ–­APPçš„æ€§èƒ½é—®é¢˜ã€‚</p>
</blockquote>
<h3 data-id="heading-4">IOS</h3>
<p><a href="https://juejin.cn/post/7589494074983727155" target="_blank" title="https://juejin.cn/post/7589494074983727155">iOSç–‘éš¾Crash-_dispatch_barrier_waiter_redirect_or_wake å´©æºƒæ²»ç†</a>  <a href="https://juejin.cn/user/1768489241815070/posts" target="_blank" title="https://juejin.cn/user/1768489241815070/posts">@è´§æ‹‰æ‹‰æŠ€æœ¯</a></p>
<blockquote>
<p>æ—¢ç„¶åŸå› é”å®šåœ¨è¿™äº›å®‰å…¨ç±»é‡Œé¢çš„é€šè¿‡å¹¶è¡Œé˜Ÿåˆ—æ¥å®ç°çš„è¯»å†™é”é€»è¾‘ï¼Œé‚£æœ€å¥½çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æ›¿æ¢æ‰è¿™äº›å®‰å…¨ç±»é‡Œé¢çš„è¯»å†™é”é€»è¾‘ï¼Œä½¿ç”¨<code>pthread_rwlock_t</code>æ¥ä»£æ›¿å¹¶è¡Œé˜Ÿåˆ—å®ç°è¯»å†™é”åŠŸèƒ½, è¿™æ ·å°±é¿å…äº†é˜Ÿåˆ—æå‰é‡Šæ”¾çš„é£é™©ã€‚</p>
</blockquote>
<p><a href="https://juejin.cn/post/7591350620189360134" target="_blank" title="https://juejin.cn/post/7591350620189360134">Flutter 3.38.1 ä¹‹åï¼Œå› ä¸ºæŸäº›æ¡†æ¶ä½çº§é”™è¯¯å¯¼è‡´æäº¤ Store è¢«æ‹’</a> <a href="https://juejin.cn/user/817692379985752/posts" target="_blank" title="https://juejin.cn/user/817692379985752/posts">@æ‹çŒ«deå°éƒ­</a></p>
<blockquote>
<p>å¦‚æœä½ è¿‘æœŸå·²ç»å‡çº§åˆ° 3.38.1 ä¹‹åçš„ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ 3.38.5 ï¼Œä½ å°±æœ‰æ¦‚ç‡å‘ç°ï¼Œæ‰“åŒ…æäº¤ iOS çš„åŒ…ä¼šå‡ºç°Â <code>The binary is invalid</code>Â çš„ç›¸å…³é”™è¯¯ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯<strong>App Store æ‹’ç»äº†æŸä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› ä¸ºå®ƒåŒ…å«äº†æ— æ•ˆçš„å†…å®¹</strong>ã€‚</p>
</blockquote>
<h4 data-id="heading-5">æ´»åŠ¨æ—¥å†</h4>













<table><thead><tr><th>æ´»åŠ¨åç§°</th><th>æ´»åŠ¨æ—¶é—´</th></tr></thead><tbody><tr><td><a href="https://juejin.cn/post/7587675443442450472" target="_blank" title="https://juejin.cn/post/7587675443442450472">ğŸ†2025 AI/Vibe Coding å¯¹æˆ‘çš„å½±å“  å¹´ç»ˆå¾æ–‡</a></td><td>2025å¹´12æœˆ26æ—¥-2026å¹´1æœˆ25æ—¥</td></tr></tbody></table>
<h2 data-id="heading-6">ğŸ“– æŠ•ç¨¿ä¸“åŒº</h2>
<blockquote>
<p>å¤§å®¶å¯ä»¥åœ¨è¯„è®ºåŒºæ¨èè®¤ä¸ºä¸é”™çš„æ–‡ç« ï¼Œå¹¶é™„ä¸Šé“¾æ¥å’Œæ¨èç†ç”±ï¼Œæœ‰æœºä¼šå‘ˆç°åœ¨ä¸‹ä¸€æœŸã€‚æ–‡ç« åˆ›å»ºæ—¥æœŸå¿…é¡»åœ¨ä¸‹æœŸæ˜é‡‘ä¸€å‘¨å‘å¸ƒå‰ä¸€å‘¨ä»¥å†…ï¼›å¯ä»¥æ¨èè‡ªå·±çš„æ–‡ç« ã€ä¹Ÿå¯ä»¥æ¨èä»–äººçš„æ–‡ç« ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åˆ†å¸ƒå¼ç»„ç½‘æ¶æ„è®¾è®¡ï¼šä»BitTorrent DHTåˆ°ç°ä»£SD-WANçš„æ¼”è¿›]]></title>    <link>https://juejin.cn/post/7592683699771899914</link>    <guid>https://juejin.cn/post/7592683699771899914</guid>    <pubDate>2026-01-08T06:46:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592683699771899914" data-draft-id="7592683699771883530" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åˆ†å¸ƒå¼ç»„ç½‘æ¶æ„è®¾è®¡ï¼šä»BitTorrent DHTåˆ°ç°ä»£SD-WANçš„æ¼”è¿›"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-08T06:46:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å˜»å“ˆbaby"/> <meta itemprop="url" content="https://juejin.cn/user/485305583405066"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åˆ†å¸ƒå¼ç»„ç½‘æ¶æ„è®¾è®¡ï¼šä»BitTorrent DHTåˆ°ç°ä»£SD-WANçš„æ¼”è¿›
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/485305583405066/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å˜»å“ˆbaby
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:46:12.000Z" title="Thu Jan 08 2026 06:46:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»24åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æœ¬æ–‡ç³»ç»Ÿæ€§å‰–æP2Pç½‘ç»œæ‹“æ‰‘ã€DHTåŸç†ã€è¶…çº§èŠ‚ç‚¹ç­–ç•¥ï¼Œå¹¶ç»“åˆSD-WANæ¶æ„æ¢è®¨ç°ä»£ç»„ç½‘æ–¹æ¡ˆçš„æŠ€æœ¯é€‰å‹ã€‚</p>
</blockquote>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œä¸€ä¸ªæ²¡æœ‰ä¸­å¿ƒæœåŠ¡å™¨çš„ç½‘ç»œæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</p>
<p>BitTorrentåœ¨å·…å³°æ—¶æœŸå æ®äº†å…¨çƒäº’è”ç½‘æµé‡çš„40%ä»¥ä¸Šï¼Œå´æ²¡æœ‰ä»»ä½•"å®˜æ–¹æœåŠ¡å™¨"æ¥åè°ƒè¿™ä¸€åˆ‡ã€‚æ•°ä»¥äº¿è®¡çš„èŠ‚ç‚¹è‡ªå‘åœ°ç»„ç»‡ã€å‘ç°ã€é€šä¿¡ï¼Œå½¢æˆäº†ä¸€ä¸ªçœŸæ­£çš„åˆ†å¸ƒå¼ç½‘ç»œã€‚</p>
<p>è¿™ç§åˆ†å¸ƒå¼ç»„ç½‘çš„æ€æƒ³ï¼Œæ­£åœ¨æ·±åˆ»å½±å“ç€ç°ä»£ä¼ä¸šç½‘ç»œæ¶æ„ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ä»BitTorrentçš„DHTè¯´èµ·ï¼Œä¸€ç›´èŠåˆ°ä¼ä¸šçº§çš„SD-WANã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€ç½‘ç»œæ‹“æ‰‘åŸºç¡€ï¼šä»æ˜Ÿå½¢åˆ°å…¨åˆ†å¸ƒå¼</h2>
<h3 data-id="heading-2">1.1 ä¼ ç»ŸC/Sæ¶æ„çš„ç“¶é¢ˆ</h3>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-built_in">Client</span>  â”‚ â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-built_in">Client</span>  â”‚ â”€â”€â”¼â”€â”€â”€â”€â†’â”‚  <span class="hljs-built_in">Server</span>  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  <span class="hljs-built_in">Client</span>  â”‚ â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>é—®é¢˜æ˜¾è€Œæ˜“è§ï¼š</p>

























<table><thead><tr><th>é—®é¢˜</th><th>å½±å“</th></tr></thead><tbody><tr><td>å•ç‚¹æ•…éšœ</td><td>æœåŠ¡å™¨æŒ‚äº†ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½æ— æ³•è®¿é—®</td></tr><tr><td>å¸¦å®½ç“¶é¢ˆ</td><td>æ‰€æœ‰æµé‡éƒ½ç»è¿‡ä¸­å¿ƒï¼ŒæœåŠ¡å™¨å¸¦å®½æˆä¸ºå¤©èŠ±æ¿</td></tr><tr><td>æ‰©å±•å›°éš¾</td><td>ç”¨æˆ·å¢é•¿éœ€è¦ä¸æ–­æ‰©å®¹æœåŠ¡å™¨</td></tr><tr><td>å»¶è¿Ÿä¸å‡</td><td>è¿œç¦»æœåŠ¡å™¨çš„ç”¨æˆ·ä½“éªŒå·®</td></tr></tbody></table>
<h3 data-id="heading-3">1.2 P2Pæ‹“æ‰‘ç±»å‹</h3>
<h4 data-id="heading-4">çº¯P2Pï¼ˆPure P2Pï¼‰</h4>
<pre><code class="hljs language-css" lang="css">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Peer <span class="hljs-selector-tag">A</span>  â”‚â†â”€â”€â”€â†’â”‚  Peer <span class="hljs-selector-tag">B</span>  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘   â†˜           â†™   â†‘
     â”‚      â†˜     â†™      â”‚
     â”‚        â†˜ â†™        â”‚
     â†“         â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Peer C  â”‚â†â”€â”€â”€â†’â”‚  Peer D  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å®Œå…¨å»ä¸­å¿ƒåŒ–</li>
<li>æ¯ä¸ªèŠ‚ç‚¹åœ°ä½å¹³ç­‰</li>
<li>ç½‘ç»œæå…¶å¥å£®</li>
<li>èŠ‚ç‚¹å‘ç°æ˜¯ä¸»è¦æŒ‘æˆ˜</li>
</ul>
<p><strong>å…¸å‹åº”ç”¨</strong>ï¼šæ—©æœŸGnutellaã€Bitcoin</p>
<h4 data-id="heading-5">æ··åˆP2Pï¼ˆHybrid P2Pï¼‰</h4>
<pre><code class="hljs language-css" lang="css">         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  ä¸­å¿ƒç´¢å¼•æœåŠ¡å™¨  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ (åªäº¤æ¢å…ƒæ•°æ®)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“            â†“            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚Peer <span class="hljs-selector-tag">A</span>â”‚â†â”€â”€â†’â”‚Peer <span class="hljs-selector-tag">B</span>â”‚â†â”€â”€â†’â”‚Peer Câ”‚
â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜
      (ç›´æ¥ä¼ è¾“æ•°æ®)
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>ä¸­å¿ƒæœåŠ¡å™¨åªè´Ÿè´£ç´¢å¼•/åè°ƒ</li>
<li>å®é™…æ•°æ®ä¼ è¾“æ˜¯P2P</li>
<li>æŠ˜ä¸­äº†æ•ˆç‡å’Œå»ä¸­å¿ƒåŒ–</li>
</ul>
<p><strong>å…¸å‹åº”ç”¨</strong>ï¼šæ—©æœŸNapsterã€BitTorrentï¼ˆå¸¦Trackerï¼‰</p>
<h4 data-id="heading-6">è¶…çº§èŠ‚ç‚¹æ¶æ„ï¼ˆSuper-Peerï¼‰</h4>
<pre><code class="hljs language-markdown" lang="markdown">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         è¶…çº§èŠ‚ç‚¹å±‚ (Super-Peer)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”          â”‚
â”‚  â”‚ SP â”‚â†â”€â”€â”€â†’â”‚ SP â”‚â†â”€â”€â”€â†’â”‚ SP â”‚          â”‚
â”‚  â””â”€â”¬â”€â”€â”˜     â””â”€â”¬â”€â”€â”˜     â””â”€â”¬â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">     â”‚          â”‚          â”‚
     â†“          â†“          â†“
  â”Œâ”€â”€â”´â”€â”€â”    â”Œâ”€â”€â”´â”€â”€â”    â”Œâ”€â”€â”´â”€â”€â”
  â”‚Peersâ”‚    â”‚Peersâ”‚    â”‚Peersâ”‚
  â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜
  æ™®é€šèŠ‚ç‚¹    æ™®é€šèŠ‚ç‚¹    æ™®é€šèŠ‚ç‚¹
</span></code></pre>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å°†éƒ¨åˆ†åŠŸèƒ½"ä¸‹æ²‰"åˆ°è¶…çº§èŠ‚ç‚¹</li>
<li>è¶…çº§èŠ‚ç‚¹é€šå¸¸æ˜¯æ€§èƒ½å¥½ã€å¸¦å®½é«˜ã€åœ¨çº¿ç¨³å®šçš„èŠ‚ç‚¹</li>
<li>åŠ¨æ€é€‰ä¸¾ï¼ŒæŸä¸ªè¶…çº§èŠ‚ç‚¹ç¦»çº¿åè‡ªåŠ¨æ›¿æ¢</li>
</ul>
<p><strong>å…¸å‹åº”ç”¨</strong>ï¼šSkypeã€KaZaAã€ç°ä»£ç»„ç½‘æ–¹æ¡ˆ</p>
<hr/>
<h2 data-id="heading-7">äºŒã€DHTæ·±åº¦å‰–æï¼šKademliaç®—æ³•åŸç†</h2>
<h3 data-id="heading-8">2.1 DHTæ˜¯ä»€ä¹ˆ</h3>
<p>DHTï¼ˆDistributed Hash Tableï¼‰åˆ†å¸ƒå¼å“ˆå¸Œè¡¨ï¼Œæ˜¯ä¸€ç§å»ä¸­å¿ƒåŒ–çš„é”®å€¼å­˜å‚¨ç³»ç»Ÿã€‚</p>
<p>æ ¸å¿ƒæ€æƒ³ï¼š<strong>å°†æ•°æ®çš„å­˜å‚¨ä½ç½®ä¸æ•°æ®çš„å“ˆå¸Œå€¼å…³è”ï¼Œä»»ä½•èŠ‚ç‚¹éƒ½å¯ä»¥é€šè¿‡å“ˆå¸Œå€¼æ‰¾åˆ°æ•°æ®</strong>ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">ä¼ ç»Ÿä¸­å¿ƒåŒ–ç´¢å¼•ï¼š
<span class="hljs-built_in">Client</span> â†’ ä¸­å¿ƒæœåŠ¡å™¨ï¼š<span class="hljs-string">"æ–‡ä»¶ABCåœ¨å“ªï¼Ÿ"</span>
ä¸­å¿ƒæœåŠ¡å™¨ â†’ <span class="hljs-built_in">Client</span>ï¼š<span class="hljs-string">"åœ¨èŠ‚ç‚¹Xã€Yã€Z"</span>

DHTå»ä¸­å¿ƒåŒ–ç´¢å¼•ï¼š
<span class="hljs-built_in">Client</span> â†’ ä»»æ„èŠ‚ç‚¹ï¼š<span class="hljs-string">"æ–‡ä»¶ABCåœ¨å“ªï¼Ÿ"</span>ï¼ˆ<span class="hljs-built_in">hash</span>(ABC) = <span class="hljs-number">0x1234</span>...ï¼‰
èŠ‚ç‚¹<span class="hljs-number">1</span> â†’ èŠ‚ç‚¹<span class="hljs-number">2</span> â†’ ... â†’ èŠ‚ç‚¹Nï¼š<span class="hljs-string">"è·ç¦»0x1234...æœ€è¿‘çš„èŠ‚ç‚¹çŸ¥é“"</span>
èŠ‚ç‚¹N â†’ <span class="hljs-built_in">Client</span>ï¼š<span class="hljs-string">"åœ¨èŠ‚ç‚¹Xã€Yã€Z"</span>
</code></pre>
<h3 data-id="heading-9">2.2 Kademliaæ ¸å¿ƒæ¦‚å¿µ</h3>
<p>Kademliaæ˜¯æœ€æˆåŠŸçš„DHTå®ç°ä¹‹ä¸€ï¼Œè¢«BitTorrentã€ä»¥å¤ªåŠç­‰å¹¿æ³›é‡‡ç”¨ã€‚</p>
<h4 data-id="heading-10">èŠ‚ç‚¹IDä¸è·ç¦»</h4>
<p>æ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ª160ä½çš„IDï¼ˆé€šå¸¸æ˜¯å…¬é’¥çš„å“ˆå¸Œï¼‰ï¼ŒèŠ‚ç‚¹ä¹‹é—´çš„"è·ç¦»"ç”¨XORå®šä¹‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">distance</span>(<span class="hljs-params">node_a, node_b</span>):
    <span class="hljs-keyword">return</span> node_a.<span class="hljs-built_in">id</span> ^ node_b.<span class="hljs-built_in">id</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆç”¨XORï¼Ÿ</strong></p>
<ol>
<li><strong>è‡ªåæ€§</strong>ï¼š<code>d(a, a) = 0</code>ï¼Œè‡ªå·±å’Œè‡ªå·±è·ç¦»ä¸º0</li>
<li><strong>å¯¹ç§°æ€§</strong>ï¼š<code>d(a, b) = d(b, a)</code></li>
<li><strong>ä¸‰è§’ä¸ç­‰å¼</strong>ï¼š<code>d(a, b) + d(b, c) &gt;= d(a, c)</code></li>
<li><strong>å”¯ä¸€æ€§</strong>ï¼šå¯¹äºä»»æ„èŠ‚ç‚¹aå’Œè·ç¦»dï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªèŠ‚ç‚¹bæ»¡è¶³<code>d(a, b) = d</code></li>
</ol>
<h4 data-id="heading-11">K-Bucketè·¯ç”±è¡¨</h4>
<p>æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªè·¯ç”±è¡¨ï¼ŒæŒ‰ç…§XORè·ç¦»åˆ†æˆ160ä¸ª"æ¡¶"ï¼ˆbucketï¼‰ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Bucket 0:</span> <span class="hljs-string">è·ç¦»åœ¨</span> [<span class="hljs-number">2</span><span class="hljs-string">^0</span>, <span class="hljs-number">2</span><span class="hljs-string">^1)</span> <span class="hljs-string">ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œæœ€å¤škä¸ª</span>
<span class="hljs-attr">Bucket 1:</span> <span class="hljs-string">è·ç¦»åœ¨</span> [<span class="hljs-number">2</span><span class="hljs-string">^1</span>, <span class="hljs-number">2</span><span class="hljs-string">^2)</span> <span class="hljs-string">ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œæœ€å¤škä¸ª</span>
<span class="hljs-attr">Bucket 2:</span> <span class="hljs-string">è·ç¦»åœ¨</span> [<span class="hljs-number">2</span><span class="hljs-string">^2</span>, <span class="hljs-number">2</span><span class="hljs-string">^3)</span> <span class="hljs-string">ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œæœ€å¤škä¸ª</span>
<span class="hljs-string">...</span>
<span class="hljs-attr">Bucket 159:</span> <span class="hljs-string">è·ç¦»åœ¨</span> [<span class="hljs-number">2</span><span class="hljs-string">^159</span>, <span class="hljs-number">2</span><span class="hljs-string">^160)</span> <span class="hljs-string">ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œæœ€å¤škä¸ª</span>
</code></pre>
<p>è¿™ç§è®¾è®¡ä¿è¯äº†ï¼š</p>
<ul>
<li>ç¦»è‡ªå·±è¶Šè¿‘çš„åŒºåŸŸçŸ¥é“çš„èŠ‚ç‚¹è¶Šå¤š</li>
<li>ç¦»è‡ªå·±è¶Šè¿œçš„åŒºåŸŸçŸ¥é“çš„èŠ‚ç‚¹è¶Šå°‘ï¼ˆä½†è¶³å¤Ÿæ‰¾åˆ°æ›´è¿‘çš„èŠ‚ç‚¹ï¼‰</li>
</ul>
<h3 data-id="heading-12">2.3 èŠ‚ç‚¹æŸ¥æ‰¾ç®—æ³•</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_node</span>(<span class="hljs-params">target_id, k=<span class="hljs-number">20</span>, alpha=<span class="hljs-number">3</span></span>):
    <span class="hljs-string">"""
    æŸ¥æ‰¾è·ç¦»target_idæœ€è¿‘çš„kä¸ªèŠ‚ç‚¹
    alpha: å¹¶è¡Œåº¦ï¼ŒåŒæ—¶æŸ¥è¯¢çš„èŠ‚ç‚¹æ•°
    """</span>
    <span class="hljs-comment"># ä»è‡ªå·±çš„è·¯ç”±è¡¨ä¸­æ‰¾åˆ°æœ€è¿‘çš„alphaä¸ªèŠ‚ç‚¹</span>
    closest_nodes = self.routing_table.get_closest(target_id, alpha)
    queried = <span class="hljs-built_in">set</span>()
    
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-comment"># æ‰¾å‡ºè¿˜æ²¡æŸ¥è¯¢è¿‡çš„ã€è·ç¦»targetæœ€è¿‘çš„alphaä¸ªèŠ‚ç‚¹</span>
        to_query = []
        <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(closest_nodes, key=<span class="hljs-keyword">lambda</span> n: distance(n.<span class="hljs-built_in">id</span>, target_id)):
            <span class="hljs-keyword">if</span> node <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> queried <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(to_query) &lt; alpha:
                to_query.append(node)
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> to_query:
            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># æ‰€æœ‰æœ€è¿‘èŠ‚ç‚¹éƒ½æŸ¥è¯¢è¿‡äº†</span>
        
        <span class="hljs-comment"># å¹¶è¡ŒæŸ¥è¯¢è¿™äº›èŠ‚ç‚¹</span>
        <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> to_query:
            queried.add(node)
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># é—®è¿™ä¸ªèŠ‚ç‚¹ï¼šä½ çŸ¥é“å“ªäº›ç¦»targetè¿‘çš„èŠ‚ç‚¹ï¼Ÿ</span>
                new_nodes = node.find_node_rpc(target_id)
                closest_nodes.update(new_nodes)
            <span class="hljs-keyword">except</span> Timeout:
                <span class="hljs-comment"># èŠ‚ç‚¹ä¸å“åº”ï¼Œä»è·¯ç”±è¡¨ç§»é™¤</span>
                self.routing_table.remove(node)
        
        <span class="hljs-comment"># åªä¿ç•™æœ€è¿‘çš„kä¸ª</span>
        closest_nodes = <span class="hljs-built_in">sorted</span>(closest_nodes, key=<span class="hljs-keyword">lambda</span> n: distance(n.<span class="hljs-built_in">id</span>, target_id))[:k]
    
    <span class="hljs-keyword">return</span> closest_nodes[:k]
</code></pre>
<p><strong>æŸ¥æ‰¾æ•ˆç‡</strong>ï¼šO(log N)ï¼ŒNä¸ºç½‘ç»œä¸­èŠ‚ç‚¹æ€»æ•°ã€‚</p>
<p>è¿™æ„å‘³ç€åœ¨ä¸€ä¸ª100ä¸‡èŠ‚ç‚¹çš„ç½‘ç»œä¸­ï¼Œå¹³å‡åªéœ€è¦çº¦20æ¬¡æŸ¥è¯¢å°±èƒ½æ‰¾åˆ°ç›®æ ‡ã€‚</p>
<h3 data-id="heading-13">2.4 æ•°æ®å­˜å‚¨ä¸æŸ¥æ‰¾</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">store</span>(<span class="hljs-params">key, value</span>):
    <span class="hljs-string">"""å­˜å‚¨æ•°æ®åˆ°DHT"""</span>
    <span class="hljs-comment"># æ‰¾åˆ°è·ç¦»keyæœ€è¿‘çš„kä¸ªèŠ‚ç‚¹</span>
    closest_nodes = find_node(<span class="hljs-built_in">hash</span>(key))
    
    <span class="hljs-comment"># åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šå­˜å‚¨æ•°æ®</span>
    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> closest_nodes:
        node.store_rpc(key, value)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">lookup</span>(<span class="hljs-params">key</span>):
    <span class="hljs-string">"""ä»DHTæŸ¥æ‰¾æ•°æ®"""</span>
    closest_nodes = find_node(<span class="hljs-built_in">hash</span>(key))
    
    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> closest_nodes:
        value = node.get_rpc(key)
        <span class="hljs-keyword">if</span> value:
            <span class="hljs-keyword">return</span> value
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<h3 data-id="heading-14">2.5 BitTorrent DHTå®æˆ˜</h3>
<p>åœ¨BitTorrentä¸­ï¼ŒDHTç”¨äºå®ç°"æ— Tracker"ä¸‹è½½ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ç£åŠ›é“¾æ¥ï¼šmagnet:?<span class="hljs-attr">xt</span>=urn:btih:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

<span class="hljs-attr">BTIH</span> = Info Hash = SHA1(ç§å­æ–‡ä»¶çš„infoå­—æ®µ)

æµç¨‹ï¼š
1. ç”¨æˆ·è·å¾—ç£åŠ›é“¾æ¥
2. ä»DHTç½‘ç»œæŸ¥æ‰¾ï¼šhash(BTIH) å¯¹åº”çš„æ•°æ®
3. æ‰¾åˆ°æ­£åœ¨å…±äº«è¯¥æ–‡ä»¶çš„Peeråˆ—è¡¨
4. ç›´æ¥è¿æ¥Peerå¼€å§‹ä¸‹è½½
</code></pre>
<p>æ— éœ€ä»»ä½•ä¸­å¿ƒæœåŠ¡å™¨ï¼Œå®Œå…¨å»ä¸­å¿ƒåŒ–ã€‚</p>
<hr/>
<h2 data-id="heading-15">ä¸‰ã€è¶…çº§èŠ‚ç‚¹ç­–ç•¥ï¼šæ€§èƒ½ä¸å»ä¸­å¿ƒåŒ–çš„å¹³è¡¡</h2>
<h3 data-id="heading-16">3.1 ä¸ºä»€ä¹ˆéœ€è¦è¶…çº§èŠ‚ç‚¹</h3>
<p>çº¯P2Pç½‘ç»œè™½ç„¶ç†æƒ³ï¼Œä½†å­˜åœ¨ç°å®é—®é¢˜ï¼š</p>

























<table><thead><tr><th>é—®é¢˜</th><th>åŸå› </th></tr></thead><tbody><tr><td>ç§»åŠ¨è®¾å¤‡å—é™</td><td>ç”µé‡ã€å¸¦å®½ã€NATé™åˆ¶</td></tr><tr><td>èŠ‚ç‚¹æ€§èƒ½å·®å¼‚å¤§</td><td>æ ‘è“æ´¾å’ŒæœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›å·®100å€</td></tr><tr><td>åœ¨çº¿æ—¶é—´ä¸ç¨³å®š</td><td>æ™®é€šç”¨æˆ·è®¾å¤‡éšæ—¶å¯èƒ½ç¦»çº¿</td></tr><tr><td>å†·å¯åŠ¨å›°éš¾</td><td>æ–°èŠ‚ç‚¹å¦‚ä½•å‘ç°ç½‘ç»œï¼Ÿ</td></tr></tbody></table>
<p>è¶…çº§èŠ‚ç‚¹æ˜¯åŠ¡å®çš„å·¥ç¨‹é€‰æ‹©ã€‚</p>
<h3 data-id="heading-17">3.2 è¶…çº§èŠ‚ç‚¹é€‰ä¸¾ç­–ç•¥</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SuperNodeElection</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_score</span>(<span class="hljs-params">self, node</span>):
        <span class="hljs-string">"""è®¡ç®—èŠ‚ç‚¹æˆä¸ºè¶…çº§èŠ‚ç‚¹çš„å¾—åˆ†"""</span>
        score = <span class="hljs-number">0</span>
        
        <span class="hljs-comment"># å¸¦å®½æƒé‡ï¼ˆä¸Šä¼ å¸¦å®½å¾ˆé‡è¦ï¼‰</span>
        score += node.upload_bandwidth * <span class="hljs-number">0.3</span>
        
        <span class="hljs-comment"># åœ¨çº¿æ—¶é—´ç¨³å®šæ€§</span>
        score += node.uptime_ratio * <span class="hljs-number">0.25</span>
        
        <span class="hljs-comment"># NATç±»å‹ï¼ˆå…¬ç½‘IPåŠ åˆ†ï¼‰</span>
        <span class="hljs-keyword">if</span> node.nat_type == <span class="hljs-string">"Public"</span>:
            score += <span class="hljs-number">30</span>
        <span class="hljs-keyword">elif</span> node.nat_type == <span class="hljs-string">"Full Cone"</span>:
            score += <span class="hljs-number">20</span>
        
        <span class="hljs-comment"># CPU/å†…å­˜ä½™é‡</span>
        score += (<span class="hljs-number">1</span> - node.cpu_usage) * <span class="hljs-number">0.15</span>
        
        <span class="hljs-comment"># å†å²å¯é æ€§</span>
        score += node.reliability_score * <span class="hljs-number">0.1</span>
        
        <span class="hljs-keyword">return</span> score
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">elect_super_nodes</span>(<span class="hljs-params">self, candidates, required_count</span>):
        <span class="hljs-string">"""é€‰ä¸¾è¶…çº§èŠ‚ç‚¹"""</span>
        scored = [(self.calculate_score(n), n) <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> candidates]
        scored.sort(reverse=<span class="hljs-literal">True</span>)
        <span class="hljs-keyword">return</span> [n <span class="hljs-keyword">for</span> _, n <span class="hljs-keyword">in</span> scored[:required_count]]
</code></pre>
<h3 data-id="heading-18">3.3 è¶…çº§èŠ‚ç‚¹çš„èŒè´£</h3>
<pre><code class="hljs">è¶…çº§èŠ‚ç‚¹åŠŸèƒ½ï¼š
â”œâ”€â”€ ç´¢å¼•æœåŠ¡ï¼šç»´æŠ¤æ‰€è¾–æ™®é€šèŠ‚ç‚¹çš„å…ƒæ•°æ®
â”œâ”€â”€ è·¯ç”±ä¸­ç»§ï¼šå¸®åŠ©NATåçš„èŠ‚ç‚¹å»ºç«‹è¿æ¥
â”œâ”€â”€ çŠ¶æ€ç›‘æ§ï¼šæ£€æµ‹ä¸‹å±èŠ‚ç‚¹çš„åœ¨çº¿çŠ¶æ€
â”œâ”€â”€ è´Ÿè½½å‡è¡¡ï¼šåˆ†æµè¯·æ±‚åˆ°åˆé€‚çš„èŠ‚ç‚¹
â””â”€â”€ æ•…éšœæ¢å¤ï¼šè¶…çº§èŠ‚ç‚¹å¤±æ•ˆæ—¶ï¼Œè‡ªåŠ¨é€‰ä¸¾æ›¿ä»£è€…
</code></pre>
<h3 data-id="heading-19">3.4 åŠ¨æ€é™çº§ä¸æ•…éšœè½¬ç§»</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SuperNodeManager</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.super_nodes = []
        self.backup_candidates = []
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">health_check</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å®šæœŸå¥åº·æ£€æŸ¥"""</span>
        <span class="hljs-keyword">for</span> sn <span class="hljs-keyword">in</span> self.super_nodes:
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> sn.is_alive():
                self.handle_super_node_failure(sn)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_super_node_failure</span>(<span class="hljs-params">self, failed_sn</span>):
        <span class="hljs-string">"""å¤„ç†è¶…çº§èŠ‚ç‚¹å¤±æ•ˆ"""</span>
        <span class="hljs-comment"># 1. ä»è¶…çº§èŠ‚ç‚¹åˆ—è¡¨ç§»é™¤</span>
        self.super_nodes.remove(failed_sn)
        
        <span class="hljs-comment"># 2. å°†å¤±æ•ˆè¶…çº§èŠ‚ç‚¹ä¸‹å±çš„æ™®é€šèŠ‚ç‚¹é‡æ–°åˆ†é…</span>
        orphan_peers = failed_sn.get_managed_peers()
        <span class="hljs-keyword">for</span> peer <span class="hljs-keyword">in</span> orphan_peers:
            <span class="hljs-comment"># æ‰¾åˆ°æœ€è¿‘çš„å¯ç”¨è¶…çº§èŠ‚ç‚¹</span>
            new_sn = self.find_nearest_super_node(peer)
            new_sn.add_peer(peer)
        
        <span class="hljs-comment"># 3. ä»å€™é€‰æ± ä¸­é€‰ä¸¾æ–°çš„è¶…çº§èŠ‚ç‚¹</span>
        <span class="hljs-keyword">if</span> self.backup_candidates:
            new_sn = self.backup_candidates.pop(<span class="hljs-number">0</span>)
            self.promote_to_super_node(new_sn)
</code></pre>
<hr/>
<h2 data-id="heading-20">å››ã€ç°ä»£SD-WANæ¶æ„</h2>
<h3 data-id="heading-21">4.1 SD-WANæ˜¯ä»€ä¹ˆ</h3>
<p>SD-WANï¼ˆSoftware-Defined Wide Area Networkï¼‰æ˜¯è½¯ä»¶å®šä¹‰çš„å¹¿åŸŸç½‘ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯<strong>å°†ç½‘ç»œæ§åˆ¶å¹³é¢ä¸æ•°æ®å¹³é¢åˆ†ç¦»</strong>ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">ä¼ ç»ŸWANæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ€»éƒ¨ç½‘ç»œ                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  Router â”‚ â†â”€â”€ ä¸“çº¿ â”€â”€â†’ åˆ†æ”¯æœºæ„      â”‚
â”‚  â”‚  (ç¡¬ä»¶)  â”‚ â†â”€â”€ MPLS â”€â”€â†’ åˆ†æ”¯æœºæ„     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é—®é¢˜ï¼šè®¾å¤‡æ˜‚è´µã€é…ç½®å¤æ‚ã€å˜æ›´ç¼“æ…¢

<span class="hljs-built_in">SD</span>-WANæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ§åˆ¶å¹³é¢                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚      <span class="hljs-built_in">SD</span>-WAN Controller         â”‚    â”‚
â”‚  â”‚  (é›†ä¸­ç­–ç•¥ç®¡ç†ã€æ™ºèƒ½è·¯ç”±å†³ç­–)    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ API/æ§åˆ¶ä¿¡ä»¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®å¹³é¢                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚ <span class="hljs-built_in">SD</span>-WAN  â”‚â†â”€â”€â”´â”€â”€â†’â”‚ <span class="hljs-built_in">SD</span>-WAN  â”‚       â”‚
â”‚    â”‚  Edge   â”‚       â”‚  Edge   â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                 â”‚            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”       â”‚
â”‚    â”‚åˆ†æ”¯æœºæ„A â”‚       â”‚åˆ†æ”¯æœºæ„B â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-22">4.2 SD-WANæ ¸å¿ƒæŠ€æœ¯</h3>
<h4 data-id="heading-23">å¤šè·¯å¾„ä¼ è¾“</h4>
<pre><code class="hljs language-diff" lang="diff">ä¼ ç»Ÿç½‘ç»œï¼šå•ä¸€è·¯å¾„ï¼ˆé€šå¸¸æ˜¯æœ€ä¾¿å®œçš„ï¼‰
SD-WANï¼šåŒæ—¶ä½¿ç”¨å¤šæ¡è·¯å¾„ï¼Œæ™ºèƒ½åˆ†é…æµé‡

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Site A   â”‚ â•â•â• MPLSä¸“çº¿ â•â•â•&gt;  â”‚  Site B   â”‚
â”‚           â”‚ â”€â”€â”€ Internet â”€â”€â”€&gt;  â”‚           â”‚
â”‚           â”‚ â”€â”€â”€ 4G/5G â”€â”€â”€â”€&gt;    â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç­–ç•¥ç¤ºä¾‹ï¼š
<span class="hljs-deletion">- è§†é¢‘ä¼šè®® â†’ MPLSä¸“çº¿ï¼ˆä½å»¶è¿Ÿã€ç¨³å®šï¼‰</span>
<span class="hljs-deletion">- æ–‡ä»¶ä¸‹è½½ â†’ Internetï¼ˆé«˜å¸¦å®½ã€ä½æˆæœ¬ï¼‰</span>
<span class="hljs-deletion">- å¤‡ä»½æµé‡ â†’ 4G/5Gï¼ˆé—²æ—¶ä½¿ç”¨ï¼‰</span>
</code></pre>
<h4 data-id="heading-24">åº”ç”¨æ„ŸçŸ¥è·¯ç”±</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationAwareRouting</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.app_policies = {
            <span class="hljs-string">"video_conference"</span>: {
                <span class="hljs-string">"max_latency"</span>: <span class="hljs-number">50</span>,      <span class="hljs-comment"># ms</span>
                <span class="hljs-string">"max_jitter"</span>: <span class="hljs-number">10</span>,       <span class="hljs-comment"># ms</span>
                <span class="hljs-string">"min_bandwidth"</span>: <span class="hljs-number">2</span>,     <span class="hljs-comment"># Mbps</span>
                <span class="hljs-string">"preferred_path"</span>: <span class="hljs-string">"mpls"</span>
            },
            <span class="hljs-string">"web_browsing"</span>: {
                <span class="hljs-string">"max_latency"</span>: <span class="hljs-number">200</span>,
                <span class="hljs-string">"min_bandwidth"</span>: <span class="hljs-number">0.5</span>,
                <span class="hljs-string">"preferred_path"</span>: <span class="hljs-string">"internet"</span>
            },
            <span class="hljs-string">"backup"</span>: {
                <span class="hljs-string">"preferred_path"</span>: <span class="hljs-string">"cheapest"</span>,
                <span class="hljs-string">"time_window"</span>: <span class="hljs-string">"off_peak"</span>
            }
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">select_path</span>(<span class="hljs-params">self, packet</span>):
        <span class="hljs-string">"""æ ¹æ®åº”ç”¨ç±»å‹é€‰æ‹©æœ€ä½³è·¯å¾„"""</span>
        app_type = self.identify_application(packet)
        policy = self.app_policies.get(app_type, self.default_policy)
        
        <span class="hljs-comment"># è·å–æ‰€æœ‰å¯ç”¨è·¯å¾„çš„å®æ—¶æŒ‡æ ‡</span>
        available_paths = self.get_path_metrics()
        
        <span class="hljs-comment"># è¿‡æ»¤æ»¡è¶³SLAçš„è·¯å¾„</span>
        qualified_paths = [
            p <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> available_paths
            <span class="hljs-keyword">if</span> p.latency &lt;= policy[<span class="hljs-string">"max_latency"</span>]
            <span class="hljs-keyword">and</span> p.bandwidth &gt;= policy[<span class="hljs-string">"min_bandwidth"</span>]
        ]
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> qualified_paths:
            <span class="hljs-keyword">return</span> self.fallback_path
        
        <span class="hljs-comment"># æŒ‰ç­–ç•¥ä¼˜é€‰</span>
        <span class="hljs-keyword">if</span> policy[<span class="hljs-string">"preferred_path"</span>] == <span class="hljs-string">"cheapest"</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">min</span>(qualified_paths, key=<span class="hljs-keyword">lambda</span> p: p.cost)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> self.find_path_by_type(qualified_paths, policy[<span class="hljs-string">"preferred_path"</span>])
</code></pre>
<h4 data-id="heading-25">é›¶æ¥è§¦éƒ¨ç½²ï¼ˆZTPï¼‰</h4>
<pre><code class="hljs language-markdown" lang="markdown">ä¼ ç»Ÿéƒ¨ç½²æµç¨‹ï¼š
<span class="hljs-bullet">1.</span> é‡‡è´­è®¾å¤‡ â†’ 2. ç°åœºé…ç½® â†’ 3. ä¸“ä¸šäººå‘˜è°ƒè¯• â†’ 4. æµ‹è¯• â†’ 5. ä¸Šçº¿
ï¼ˆè€—æ—¶æ•°å‘¨ï¼Œéœ€è¦ä¸“ä¸šäººå‘˜ç°åœºï¼‰

SD-WAN ZTPæµç¨‹ï¼š
<span class="hljs-bullet">1.</span> é‡‡è´­é¢„é…ç½®è®¾å¤‡
<span class="hljs-bullet">2.</span> è®¾å¤‡é€šç”µè”ç½‘
<span class="hljs-bullet">3.</span> è‡ªåŠ¨ä»äº‘ç«¯æ‹‰å–é…ç½®
<span class="hljs-bullet">4.</span> è‡ªåŠ¨å»ºç«‹éš§é“
<span class="hljs-bullet">5.</span> å®Œæˆéƒ¨ç½²
ï¼ˆè€—æ—¶æ•°åˆ†é’Ÿï¼Œæ— éœ€ä¸“ä¸šäººå‘˜ï¼‰
</code></pre>
<h3 data-id="heading-26">4.3 ä¼ä¸šçº§ä¸ä¸ªäººçº§ç»„ç½‘çš„å·®å¼‚</h3>



































<table><thead><tr><th>ç‰¹æ€§</th><th>ä¼ä¸šçº§SD-WAN</th><th>ä¸ªäººçº§ç»„ç½‘æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>éƒ¨ç½²æˆæœ¬</td><td>é«˜ï¼ˆä¸“ç”¨ç¡¬ä»¶+æˆæƒï¼‰</td><td>ä½ï¼ˆè½¯ä»¶å³å¯ï¼‰</td></tr><tr><td>ç®¡ç†å¤æ‚åº¦</td><td>éœ€è¦ä¸“ä¸šè¿ç»´</td><td>é›¶é…ç½®æˆ–ä½é…ç½®</td></tr><tr><td>SLAä¿éšœ</td><td>æœ‰åˆåŒä¿éšœ</td><td>å°½åŠ›è€Œä¸º</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>ä¼ä¸šåˆ†æ”¯äº’è”</td><td>ä¸ªäººè®¾å¤‡äº’è”ã€å°å›¢é˜Ÿ</td></tr><tr><td>å…¸å‹äº§å“</td><td>Cisco Viptelaã€VMware</td><td>Tailscaleã€æ˜Ÿç©ºç»„ç½‘</td></tr></tbody></table>
<p>å¯¹äºä¸ªäººç”¨æˆ·å’Œå°å›¢é˜Ÿï¼Œä¼ä¸šçº§SD-WANè¿‡äºå¤æ‚å’Œæ˜‚è´µã€‚è½»é‡çº§ç»„ç½‘æ–¹æ¡ˆï¼ˆå¦‚<strong>æ˜Ÿç©ºç»„ç½‘</strong>ï¼‰é‡‡ç”¨äº†ç±»ä¼¼çš„æ··åˆP2Pæ¶æ„æ€æƒ³ï¼Œä½†å¤§å¹…ç®€åŒ–äº†ä½¿ç”¨é—¨æ§›ï¼š</p>
<ul>
<li>è‡ªåŠ¨NATç©¿é€ï¼Œæ— éœ€ç«¯å£æ˜ å°„</li>
<li>æ™ºèƒ½è·¯ç”±é€‰æ‹©ï¼Œè‡ªåŠ¨æ‹©ä¼˜</li>
<li>è·¨å¹³å°æ”¯æŒï¼Œæ‰‹æœºç”µè„‘é€šç”¨</li>
<li>æ— éœ€å…¬ç½‘IPå³å¯äº’è”</li>
</ul>
<hr/>
<h2 data-id="heading-27">äº”ã€ç»„ç½‘æ–¹æ¡ˆæŠ€æœ¯é€‰å‹</h2>
<h3 data-id="heading-28">5.1 åœºæ™¯åˆ†æ</h3>






























<table><thead><tr><th>åœºæ™¯</th><th>èŠ‚ç‚¹ç‰¹å¾</th><th>æ¨èæ¶æ„</th></tr></thead><tbody><tr><td>ä¸ªäººè®¾å¤‡äº’è”</td><td>2-10è®¾å¤‡ï¼Œå®¶ç”¨ç½‘ç»œ</td><td>çº¯P2Pæˆ–è½»é‡æ··åˆ</td></tr><tr><td>è¿œç¨‹åŠå…¬å›¢é˜Ÿ</td><td>10-50äººï¼Œåˆ†å¸ƒå…¨å›½</td><td>æ··åˆP2P+è¶…çº§èŠ‚ç‚¹</td></tr><tr><td>æ¸¸æˆè”æœº</td><td>ä½å»¶è¿Ÿè¦æ±‚ï¼Œçªå‘æµé‡</td><td>P2Pç›´è¿ä¼˜å…ˆ</td></tr><tr><td>ä¼ä¸šå¤šåˆ†æ”¯</td><td>100+ç«™ç‚¹ï¼ŒSLAè¦æ±‚</td><td>ä¼ä¸šçº§SD-WAN</td></tr></tbody></table>
<h3 data-id="heading-29">5.2 æŠ€æœ¯å¯¹æ¯”çŸ©é˜µ</h3>
<pre><code class="hljs language-scss" lang="scss">                    è¿æ¥æ•ˆç‡
                       â†‘
                       â”‚   â˜… SD-WAN
                       â”‚     (é›†ä¸­æ§åˆ¶+å¤šè·¯å¾„)
                       â”‚
                       â”‚        â˜… æ··åˆP2P
         â˜… çº¯P2P      â”‚         (è¶…çº§èŠ‚ç‚¹è¾…åŠ©)
         (å®Œå…¨å»ä¸­å¿ƒ)  â”‚
                       â”‚
                       â”‚
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ä¸­å¿ƒåŒ–ç¨‹åº¦
                       â”‚
                       â”‚        â˜… C/Sæ¶æ„
                       â”‚         (å®Œå…¨ä¸­å¿ƒåŒ–)
</code></pre>
<h3 data-id="heading-30">5.3 å®é™…é€‰å‹å»ºè®®</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">recommend_solution</span>(<span class="hljs-params">scenario</span>):
    <span class="hljs-string">"""æ ¹æ®åœºæ™¯æ¨èç»„ç½‘æ–¹æ¡ˆ"""</span>
    
    <span class="hljs-keyword">if</span> scenario.node_count &lt; <span class="hljs-number">10</span> <span class="hljs-keyword">and</span> scenario.tech_skill == <span class="hljs-string">"low"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¨èï¼šå¼€ç®±å³ç”¨çš„ç»„ç½‘è½¯ä»¶ï¼ˆå¦‚æ˜Ÿç©ºç»„ç½‘ï¼‰"</span>
    
    <span class="hljs-keyword">elif</span> scenario.node_count &lt; <span class="hljs-number">50</span> <span class="hljs-keyword">and</span> scenario.budget == <span class="hljs-string">"limited"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¨èï¼šå¼€æºæ–¹æ¡ˆï¼ˆWireGuard + è‡ªå»ºä¸­ç»§ï¼‰æˆ–å•†ä¸šè½»é‡æ–¹æ¡ˆ"</span>
    
    <span class="hljs-keyword">elif</span> scenario.sla_required <span class="hljs-keyword">and</span> scenario.budget == <span class="hljs-string">"sufficient"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¨èï¼šä¼ä¸šçº§SD-WANï¼ˆCisco/VMware/åä¸ºï¼‰"</span>
    
    <span class="hljs-keyword">elif</span> scenario.latency_sensitive <span class="hljs-keyword">and</span> scenario.p2p_capable:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¨èï¼šæ”¯æŒP2Pç›´è¿çš„æ–¹æ¡ˆï¼Œé¿å…ä¸­ç»§å¸¦æ¥çš„å»¶è¿Ÿ"</span>
    
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¨èï¼šæ ¹æ®å…·ä½“æƒ…å†µæ··åˆé€‰å‹"</span>
</code></pre>
<hr/>
<h2 data-id="heading-31">å…­ã€åŠ¨æ‰‹å®è·µï¼šæ„å»ºç®€æ˜“DHTç½‘ç»œ</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–çš„Kademlia DHTå®ç°ï¼Œå¸®åŠ©ç†è§£æ ¸å¿ƒåŸç†ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict

<span class="hljs-keyword">class</span> <span class="hljs-title class_">KademliaNode</span>:
    K = <span class="hljs-number">20</span>  <span class="hljs-comment"># K-bucketå¤§å°</span>
    ALPHA = <span class="hljs-number">3</span>  <span class="hljs-comment"># å¹¶è¡Œåº¦</span>
    ID_BITS = <span class="hljs-number">160</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, node_id=<span class="hljs-literal">None</span></span>):
        self.<span class="hljs-built_in">id</span> = node_id <span class="hljs-keyword">or</span> self._generate_id()
        self.routing_table = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.ID_BITS)]
        self.storage = {}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_generate_id</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""ç”ŸæˆéšæœºèŠ‚ç‚¹ID"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(hashlib.sha1(random.randbytes(<span class="hljs-number">20</span>)).hexdigest(), <span class="hljs-number">16</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_xor_distance</span>(<span class="hljs-params">self, id1, id2</span>):
        <span class="hljs-string">"""è®¡ç®—XORè·ç¦»"""</span>
        <span class="hljs-keyword">return</span> id1 ^ id2
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_bucket_index</span>(<span class="hljs-params">self, node_id</span>):
        <span class="hljs-string">"""è®¡ç®—èŠ‚ç‚¹åº”è¯¥æ”¾å…¥å“ªä¸ªbucket"""</span>
        distance = self._xor_distance(self.<span class="hljs-built_in">id</span>, node_id)
        <span class="hljs-keyword">if</span> distance == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">return</span> distance.bit_length() - <span class="hljs-number">1</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_routing_table</span>(<span class="hljs-params">self, node</span>):
        <span class="hljs-string">"""æ›´æ–°è·¯ç”±è¡¨"""</span>
        <span class="hljs-keyword">if</span> node.<span class="hljs-built_in">id</span> == self.<span class="hljs-built_in">id</span>:
            <span class="hljs-keyword">return</span>
        
        bucket_idx = self._bucket_index(node.<span class="hljs-built_in">id</span>)
        bucket = self.routing_table[bucket_idx]
        
        <span class="hljs-comment"># å¦‚æœèŠ‚ç‚¹å·²å­˜åœ¨ï¼Œç§»åˆ°æœ«å°¾ï¼ˆæœ€è¿‘ä½¿ç”¨ï¼‰</span>
        <span class="hljs-keyword">for</span> i, existing <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(bucket):
            <span class="hljs-keyword">if</span> existing.<span class="hljs-built_in">id</span> == node.<span class="hljs-built_in">id</span>:
                bucket.append(bucket.pop(i))
                <span class="hljs-keyword">return</span>
        
        <span class="hljs-comment"># å¦‚æœbucketæœªæ»¡ï¼Œç›´æ¥æ·»åŠ </span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(bucket) &lt; self.K:
            bucket.append(node)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># bucketå·²æ»¡ï¼Œæ£€æŸ¥æœ€è€çš„èŠ‚ç‚¹æ˜¯å¦åœ¨çº¿</span>
            oldest = bucket[<span class="hljs-number">0</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> oldest.ping():
                bucket.pop(<span class="hljs-number">0</span>)
                bucket.append(node)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_closest_nodes</span>(<span class="hljs-params">self, target_id, count=K</span>):
        <span class="hljs-string">"""ä»è·¯ç”±è¡¨æ‰¾æœ€è¿‘çš„èŠ‚ç‚¹"""</span>
        all_nodes = []
        <span class="hljs-keyword">for</span> bucket <span class="hljs-keyword">in</span> self.routing_table:
            all_nodes.extend(bucket)
        
        all_nodes.sort(key=<span class="hljs-keyword">lambda</span> n: self._xor_distance(n.<span class="hljs-built_in">id</span>, target_id))
        <span class="hljs-keyword">return</span> all_nodes[:count]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">store</span>(<span class="hljs-params">self, key, value</span>):
        <span class="hljs-string">"""å­˜å‚¨é”®å€¼å¯¹"""</span>
        self.storage[key] = value
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self, key</span>):
        <span class="hljs-string">"""è·å–å€¼"""</span>
        <span class="hljs-keyword">return</span> self.storage.get(key)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ping</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å¿ƒè·³æ£€æµ‹"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>  <span class="hljs-comment"># ç®€åŒ–å®ç°</span>

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo</span>():
    <span class="hljs-comment"># åˆ›å»ºä¸€äº›èŠ‚ç‚¹</span>
    nodes = [KademliaNode() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>)]
    
    <span class="hljs-comment"># è®©èŠ‚ç‚¹äº’ç›¸å‘ç°ï¼ˆç®€åŒ–çš„å¼•å¯¼è¿‡ç¨‹ï¼‰</span>
    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> nodes:
        <span class="hljs-comment"># æ¯ä¸ªèŠ‚ç‚¹éšæœºè®¤è¯†å‡ ä¸ªå…¶ä»–èŠ‚ç‚¹</span>
        known_nodes = random.sample(nodes, <span class="hljs-built_in">min</span>(<span class="hljs-number">10</span>, <span class="hljs-built_in">len</span>(nodes)))
        <span class="hljs-keyword">for</span> known <span class="hljs-keyword">in</span> known_nodes:
            node.update_routing_table(known)
    
    <span class="hljs-comment"># å­˜å‚¨æ•°æ®</span>
    key = hashlib.sha1(<span class="hljs-string">b"test_key"</span>).hexdigest()
    value = <span class="hljs-string">"Hello, DHT!"</span>
    
    <span class="hljs-comment"># æ‰¾åˆ°è·ç¦»keyæœ€è¿‘çš„èŠ‚ç‚¹æ¥å­˜å‚¨</span>
    target_id = <span class="hljs-built_in">int</span>(key, <span class="hljs-number">16</span>)
    closest = nodes[<span class="hljs-number">0</span>].find_closest_nodes(target_id, count=<span class="hljs-number">3</span>)
    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> closest:
        node.store(key, value)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ•°æ®å·²å­˜å‚¨åˆ° <span class="hljs-subst">{<span class="hljs-built_in">len</span>(closest)}</span> ä¸ªèŠ‚ç‚¹"</span>)
    
    <span class="hljs-comment"># ä»ä»»æ„èŠ‚ç‚¹æŸ¥æ‰¾æ•°æ®</span>
    random_node = random.choice(nodes)
    result = random_node.get(key)  <span class="hljs-comment"># ç®€åŒ–ï¼šå®é™…éœ€è¦é€’å½’æŸ¥æ‰¾</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æŸ¥æ‰¾ç»“æœ: <span class="hljs-subst">{result}</span>"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    demo()
</code></pre>
<hr/>
<h2 data-id="heading-32">ä¸ƒã€æ€»ç»“</h2>
<p>åˆ†å¸ƒå¼ç»„ç½‘ç»å†äº†ä»ç†è®ºåˆ°å®è·µçš„æ¼«é•¿æ¼”è¿›ï¼š</p>



































<table><thead><tr><th>é˜¶æ®µ</th><th>ä»£è¡¨æŠ€æœ¯</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>ç†è®ºå¥ åŸº</td><td>DHT/Kademlia</td><td>O(log N)æŸ¥æ‰¾æ•ˆç‡</td></tr><tr><td>å¤§è§„æ¨¡éªŒè¯</td><td>BitTorrent</td><td>äº¿çº§èŠ‚ç‚¹ç½‘ç»œ</td></tr><tr><td>å•†ä¸šåº”ç”¨</td><td>Skype</td><td>è¶…çº§èŠ‚ç‚¹æ¶æ„</td></tr><tr><td>ä¼ä¸šçº§</td><td>SD-WAN</td><td>é›†ä¸­æ§åˆ¶+æ™ºèƒ½è·¯ç”±</td></tr><tr><td>ç°ä»£ä¸ªäººçº§</td><td>WireGuardç”Ÿæ€</td><td>ç®€å•å®‰å…¨é«˜æ•ˆ</td></tr></tbody></table>
<p><strong>é€‰æ‹©å»ºè®®</strong>ï¼š</p>
<ol>
<li><strong>è¿½æ±‚æè‡´ç®€å•</strong>ï¼šé€‰æ‹©å¼€ç®±å³ç”¨çš„å•†ä¸šæ–¹æ¡ˆï¼ˆå¦‚æ˜Ÿç©ºç»„ç½‘ï¼‰ï¼Œé€‚åˆä¸ªäººå’Œå°å›¢é˜Ÿ</li>
<li><strong>æœ‰æŠ€æœ¯èƒ½åŠ›ä¸”æƒ³å®Œå…¨æ§åˆ¶</strong>ï¼šè‡ªå»ºWireGuard + è‡ªå·±çš„ä¸­ç»§èŠ‚ç‚¹</li>
<li><strong>ä¼ä¸šçº§éœ€æ±‚</strong>ï¼šè¯„ä¼°SD-WANå‚å•†ï¼Œæ³¨é‡SLAå’ŒæŠ€æœ¯æ”¯æŒ</li>
</ol>
<p>æ— è®ºé€‰æ‹©å“ªç§æ–¹æ¡ˆï¼Œç†è§£åº•å±‚åŸç†éƒ½æœ‰åŠ©äºä½ æ›´å¥½åœ°ä½¿ç”¨å’Œæ’æŸ¥é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-33">å‚è€ƒæ–‡çŒ®</h2>
<ol>
<li>Maymounkov, P., &amp; MaziÃ¨res, D. (2002). Kademlia: A Peer-to-Peer Information System Based on the XOR Metric. IPTPS.</li>
<li>Stoica, I., Morris, R., Karger, D., et al. (2001). Chord: A Scalable Peer-to-peer Lookup Service for Internet Applications. SIGCOMM.</li>
<li>RFC 7348 - Virtual eXtensible Local Area Network (VXLAN)</li>
<li>MEF 70 - SD-WAN Service Attributes and Services</li>
<li>BitTorrent Protocol Specification (BEP 0005 - DHT Protocol)</li>
</ol>
<hr/>
<blockquote>
<p>ğŸ’¡ <strong>å®è·µå»ºè®®</strong>ï¼šåœ¨é€‰æ‹©ç»„ç½‘æ–¹æ¡ˆæ—¶ï¼Œå…ˆæ˜ç¡®è‡ªå·±çš„æ ¸å¿ƒéœ€æ±‚ï¼ˆå»¶è¿Ÿï¼Ÿæˆæœ¬ï¼Ÿæ˜“ç”¨æ€§ï¼Ÿï¼‰ï¼Œå†æ ¹æ®éœ€æ±‚åŒ¹é…æŠ€æœ¯æ–¹æ¡ˆã€‚å¥½çš„æ¶æ„æ˜¯é€‚åˆä¸šåŠ¡çš„æ¶æ„ï¼Œè€Œéæœ€å¤æ‚çš„æ¶æ„ã€‚</p>
</blockquote>
<blockquote>
<p>æœ¬æ–‡ç³»ç»Ÿæ€§å‰–æP2Pç½‘ç»œæ‹“æ‰‘ã€DHTåŸç†ã€è¶…çº§èŠ‚ç‚¹ç­–ç•¥ï¼Œå¹¶ç»“åˆSD-WANæ¶æ„æ¢è®¨ç°ä»£ç»„ç½‘æ–¹æ¡ˆçš„æŠ€æœ¯é€‰å‹ã€‚</p>
</blockquote>
<h2 data-id="heading-34">å‰è¨€</h2>
<p>ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œä¸€ä¸ªæ²¡æœ‰ä¸­å¿ƒæœåŠ¡å™¨çš„ç½‘ç»œæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</p>
<p>BitTorrentåœ¨å·…å³°æ—¶æœŸå æ®äº†å…¨çƒäº’è”ç½‘æµé‡çš„40%ä»¥ä¸Šï¼Œå´æ²¡æœ‰ä»»ä½•"å®˜æ–¹æœåŠ¡å™¨"æ¥åè°ƒè¿™ä¸€åˆ‡ã€‚æ•°ä»¥äº¿è®¡çš„èŠ‚ç‚¹è‡ªå‘åœ°ç»„ç»‡ã€å‘ç°ã€é€šä¿¡ï¼Œå½¢æˆäº†ä¸€ä¸ªçœŸæ­£çš„åˆ†å¸ƒå¼ç½‘ç»œã€‚</p>
<p>è¿™ç§åˆ†å¸ƒå¼ç»„ç½‘çš„æ€æƒ³ï¼Œæ­£åœ¨æ·±åˆ»å½±å“ç€ç°ä»£ä¼ä¸šç½‘ç»œæ¶æ„ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±ä»BitTorrentçš„DHTè¯´èµ·ï¼Œä¸€ç›´èŠåˆ°ä¼ä¸šçº§çš„SD-WANã€‚</p>
<hr/>
<h2 data-id="heading-35">ä¸€ã€ç½‘ç»œæ‹“æ‰‘åŸºç¡€ï¼šä»æ˜Ÿå½¢åˆ°å…¨åˆ†å¸ƒå¼</h2>
<h3 data-id="heading-36">1.1 ä¼ ç»ŸC/Sæ¶æ„çš„ç“¶é¢ˆ</h3>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-built_in">Client</span>  â”‚ â”€â”€â”
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-built_in">Client</span>  â”‚ â”€â”€â”¼â”€â”€â”€â”€â†’â”‚  <span class="hljs-built_in">Server</span>  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  <span class="hljs-built_in">Client</span>  â”‚ â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>é—®é¢˜æ˜¾è€Œæ˜“è§ï¼š</p>

























<table><thead><tr><th>é—®é¢˜</th><th>å½±å“</th></tr></thead><tbody><tr><td>å•ç‚¹æ•…éšœ</td><td>æœåŠ¡å™¨æŒ‚äº†ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯éƒ½æ— æ³•è®¿é—®</td></tr><tr><td>å¸¦å®½ç“¶é¢ˆ</td><td>æ‰€æœ‰æµé‡éƒ½ç»è¿‡ä¸­å¿ƒï¼ŒæœåŠ¡å™¨å¸¦å®½æˆä¸ºå¤©èŠ±æ¿</td></tr><tr><td>æ‰©å±•å›°éš¾</td><td>ç”¨æˆ·å¢é•¿éœ€è¦ä¸æ–­æ‰©å®¹æœåŠ¡å™¨</td></tr><tr><td>å»¶è¿Ÿä¸å‡</td><td>è¿œç¦»æœåŠ¡å™¨çš„ç”¨æˆ·ä½“éªŒå·®</td></tr></tbody></table>
<h3 data-id="heading-37">1.2 P2Pæ‹“æ‰‘ç±»å‹</h3>
<h4 data-id="heading-38">çº¯P2Pï¼ˆPure P2Pï¼‰</h4>
<pre><code class="hljs language-css" lang="css">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Peer <span class="hljs-selector-tag">A</span>  â”‚â†â”€â”€â”€â†’â”‚  Peer <span class="hljs-selector-tag">B</span>  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘   â†˜           â†™   â†‘
     â”‚      â†˜     â†™      â”‚
     â”‚        â†˜ â†™        â”‚
     â†“         â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Peer C  â”‚â†â”€â”€â”€â†’â”‚  Peer D  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å®Œå…¨å»ä¸­å¿ƒåŒ–</li>
<li>æ¯ä¸ªèŠ‚ç‚¹åœ°ä½å¹³ç­‰</li>
<li>ç½‘ç»œæå…¶å¥å£®</li>
<li>èŠ‚ç‚¹å‘ç°æ˜¯ä¸»è¦æŒ‘æˆ˜</li>
</ul>
<p><strong>å…¸å‹åº”ç”¨</strong>ï¼šæ—©æœŸGnutellaã€Bitcoin</p>
<h4 data-id="heading-39">æ··åˆP2Pï¼ˆHybrid P2Pï¼‰</h4>
<pre><code class="hljs language-css" lang="css">         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  ä¸­å¿ƒç´¢å¼•æœåŠ¡å™¨  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ (åªäº¤æ¢å…ƒæ•°æ®)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“            â†“            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”
â”‚Peer <span class="hljs-selector-tag">A</span>â”‚â†â”€â”€â†’â”‚Peer <span class="hljs-selector-tag">B</span>â”‚â†â”€â”€â†’â”‚Peer Câ”‚
â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜
      (ç›´æ¥ä¼ è¾“æ•°æ®)
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>ä¸­å¿ƒæœåŠ¡å™¨åªè´Ÿè´£ç´¢å¼•/åè°ƒ</li>
<li>å®é™…æ•°æ®ä¼ è¾“æ˜¯P2P</li>
<li>æŠ˜ä¸­äº†æ•ˆç‡å’Œå»ä¸­å¿ƒåŒ–</li>
</ul>
<p><strong>å…¸å‹åº”ç”¨</strong>ï¼šæ—©æœŸNapsterã€BitTorrentï¼ˆå¸¦Trackerï¼‰</p>
<h4 data-id="heading-40">è¶…çº§èŠ‚ç‚¹æ¶æ„ï¼ˆSuper-Peerï¼‰</h4>
<pre><code class="hljs language-markdown" lang="markdown">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         è¶…çº§èŠ‚ç‚¹å±‚ (Super-Peer)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”          â”‚
â”‚  â”‚ SP â”‚â†â”€â”€â”€â†’â”‚ SP â”‚â†â”€â”€â”€â†’â”‚ SP â”‚          â”‚
â”‚  â””â”€â”¬â”€â”€â”˜     â””â”€â”¬â”€â”€â”˜     â””â”€â”¬â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">     â”‚          â”‚          â”‚
     â†“          â†“          â†“
  â”Œâ”€â”€â”´â”€â”€â”    â”Œâ”€â”€â”´â”€â”€â”    â”Œâ”€â”€â”´â”€â”€â”
  â”‚Peersâ”‚    â”‚Peersâ”‚    â”‚Peersâ”‚
  â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”˜
  æ™®é€šèŠ‚ç‚¹    æ™®é€šèŠ‚ç‚¹    æ™®é€šèŠ‚ç‚¹
</span></code></pre>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>å°†éƒ¨åˆ†åŠŸèƒ½"ä¸‹æ²‰"åˆ°è¶…çº§èŠ‚ç‚¹</li>
<li>è¶…çº§èŠ‚ç‚¹é€šå¸¸æ˜¯æ€§èƒ½å¥½ã€å¸¦å®½é«˜ã€åœ¨çº¿ç¨³å®šçš„èŠ‚ç‚¹</li>
<li>åŠ¨æ€é€‰ä¸¾ï¼ŒæŸä¸ªè¶…çº§èŠ‚ç‚¹ç¦»çº¿åè‡ªåŠ¨æ›¿æ¢</li>
</ul>
<p><strong>å…¸å‹åº”ç”¨</strong>ï¼šSkypeã€KaZaAã€ç°ä»£ç»„ç½‘æ–¹æ¡ˆ</p>
<hr/>
<h2 data-id="heading-41">äºŒã€DHTæ·±åº¦å‰–æï¼šKademliaç®—æ³•åŸç†</h2>
<h3 data-id="heading-42">2.1 DHTæ˜¯ä»€ä¹ˆ</h3>
<p>DHTï¼ˆDistributed Hash Tableï¼‰åˆ†å¸ƒå¼å“ˆå¸Œè¡¨ï¼Œæ˜¯ä¸€ç§å»ä¸­å¿ƒåŒ–çš„é”®å€¼å­˜å‚¨ç³»ç»Ÿã€‚</p>
<p>æ ¸å¿ƒæ€æƒ³ï¼š<strong>å°†æ•°æ®çš„å­˜å‚¨ä½ç½®ä¸æ•°æ®çš„å“ˆå¸Œå€¼å…³è”ï¼Œä»»ä½•èŠ‚ç‚¹éƒ½å¯ä»¥é€šè¿‡å“ˆå¸Œå€¼æ‰¾åˆ°æ•°æ®</strong>ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">ä¼ ç»Ÿä¸­å¿ƒåŒ–ç´¢å¼•ï¼š
<span class="hljs-built_in">Client</span> â†’ ä¸­å¿ƒæœåŠ¡å™¨ï¼š<span class="hljs-string">"æ–‡ä»¶ABCåœ¨å“ªï¼Ÿ"</span>
ä¸­å¿ƒæœåŠ¡å™¨ â†’ <span class="hljs-built_in">Client</span>ï¼š<span class="hljs-string">"åœ¨èŠ‚ç‚¹Xã€Yã€Z"</span>

DHTå»ä¸­å¿ƒåŒ–ç´¢å¼•ï¼š
<span class="hljs-built_in">Client</span> â†’ ä»»æ„èŠ‚ç‚¹ï¼š<span class="hljs-string">"æ–‡ä»¶ABCåœ¨å“ªï¼Ÿ"</span>ï¼ˆ<span class="hljs-built_in">hash</span>(ABC) = <span class="hljs-number">0x1234</span>...ï¼‰
èŠ‚ç‚¹<span class="hljs-number">1</span> â†’ èŠ‚ç‚¹<span class="hljs-number">2</span> â†’ ... â†’ èŠ‚ç‚¹Nï¼š<span class="hljs-string">"è·ç¦»0x1234...æœ€è¿‘çš„èŠ‚ç‚¹çŸ¥é“"</span>
èŠ‚ç‚¹N â†’ <span class="hljs-built_in">Client</span>ï¼š<span class="hljs-string">"åœ¨èŠ‚ç‚¹Xã€Yã€Z"</span>
</code></pre>
<h3 data-id="heading-43">2.2 Kademliaæ ¸å¿ƒæ¦‚å¿µ</h3>
<p>Kademliaæ˜¯æœ€æˆåŠŸçš„DHTå®ç°ä¹‹ä¸€ï¼Œè¢«BitTorrentã€ä»¥å¤ªåŠç­‰å¹¿æ³›é‡‡ç”¨ã€‚</p>
<h4 data-id="heading-44">èŠ‚ç‚¹IDä¸è·ç¦»</h4>
<p>æ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ª160ä½çš„IDï¼ˆé€šå¸¸æ˜¯å…¬é’¥çš„å“ˆå¸Œï¼‰ï¼ŒèŠ‚ç‚¹ä¹‹é—´çš„"è·ç¦»"ç”¨XORå®šä¹‰ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">distance</span>(<span class="hljs-params">node_a, node_b</span>):
    <span class="hljs-keyword">return</span> node_a.<span class="hljs-built_in">id</span> ^ node_b.<span class="hljs-built_in">id</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆç”¨XORï¼Ÿ</strong></p>
<ol>
<li><strong>è‡ªåæ€§</strong>ï¼š<code>d(a, a) = 0</code>ï¼Œè‡ªå·±å’Œè‡ªå·±è·ç¦»ä¸º0</li>
<li><strong>å¯¹ç§°æ€§</strong>ï¼š<code>d(a, b) = d(b, a)</code></li>
<li><strong>ä¸‰è§’ä¸ç­‰å¼</strong>ï¼š<code>d(a, b) + d(b, c) &gt;= d(a, c)</code></li>
<li><strong>å”¯ä¸€æ€§</strong>ï¼šå¯¹äºä»»æ„èŠ‚ç‚¹aå’Œè·ç¦»dï¼Œæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªèŠ‚ç‚¹bæ»¡è¶³<code>d(a, b) = d</code></li>
</ol>
<h4 data-id="heading-45">K-Bucketè·¯ç”±è¡¨</h4>
<p>æ¯ä¸ªèŠ‚ç‚¹ç»´æŠ¤ä¸€ä¸ªè·¯ç”±è¡¨ï¼ŒæŒ‰ç…§XORè·ç¦»åˆ†æˆ160ä¸ª"æ¡¶"ï¼ˆbucketï¼‰ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Bucket 0:</span> <span class="hljs-string">è·ç¦»åœ¨</span> [<span class="hljs-number">2</span><span class="hljs-string">^0</span>, <span class="hljs-number">2</span><span class="hljs-string">^1)</span> <span class="hljs-string">ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œæœ€å¤škä¸ª</span>
<span class="hljs-attr">Bucket 1:</span> <span class="hljs-string">è·ç¦»åœ¨</span> [<span class="hljs-number">2</span><span class="hljs-string">^1</span>, <span class="hljs-number">2</span><span class="hljs-string">^2)</span> <span class="hljs-string">ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œæœ€å¤škä¸ª</span>
<span class="hljs-attr">Bucket 2:</span> <span class="hljs-string">è·ç¦»åœ¨</span> [<span class="hljs-number">2</span><span class="hljs-string">^2</span>, <span class="hljs-number">2</span><span class="hljs-string">^3)</span> <span class="hljs-string">ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œæœ€å¤škä¸ª</span>
<span class="hljs-string">...</span>
<span class="hljs-attr">Bucket 159:</span> <span class="hljs-string">è·ç¦»åœ¨</span> [<span class="hljs-number">2</span><span class="hljs-string">^159</span>, <span class="hljs-number">2</span><span class="hljs-string">^160)</span> <span class="hljs-string">ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œæœ€å¤škä¸ª</span>
</code></pre>
<p>è¿™ç§è®¾è®¡ä¿è¯äº†ï¼š</p>
<ul>
<li>ç¦»è‡ªå·±è¶Šè¿‘çš„åŒºåŸŸçŸ¥é“çš„èŠ‚ç‚¹è¶Šå¤š</li>
<li>ç¦»è‡ªå·±è¶Šè¿œçš„åŒºåŸŸçŸ¥é“çš„èŠ‚ç‚¹è¶Šå°‘ï¼ˆä½†è¶³å¤Ÿæ‰¾åˆ°æ›´è¿‘çš„èŠ‚ç‚¹ï¼‰</li>
</ul>
<h3 data-id="heading-46">2.3 èŠ‚ç‚¹æŸ¥æ‰¾ç®—æ³•</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_node</span>(<span class="hljs-params">target_id, k=<span class="hljs-number">20</span>, alpha=<span class="hljs-number">3</span></span>):
    <span class="hljs-string">"""
    æŸ¥æ‰¾è·ç¦»target_idæœ€è¿‘çš„kä¸ªèŠ‚ç‚¹
    alpha: å¹¶è¡Œåº¦ï¼ŒåŒæ—¶æŸ¥è¯¢çš„èŠ‚ç‚¹æ•°
    """</span>
    <span class="hljs-comment"># ä»è‡ªå·±çš„è·¯ç”±è¡¨ä¸­æ‰¾åˆ°æœ€è¿‘çš„alphaä¸ªèŠ‚ç‚¹</span>
    closest_nodes = self.routing_table.get_closest(target_id, alpha)
    queried = <span class="hljs-built_in">set</span>()
    
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-comment"># æ‰¾å‡ºè¿˜æ²¡æŸ¥è¯¢è¿‡çš„ã€è·ç¦»targetæœ€è¿‘çš„alphaä¸ªèŠ‚ç‚¹</span>
        to_query = []
        <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(closest_nodes, key=<span class="hljs-keyword">lambda</span> n: distance(n.<span class="hljs-built_in">id</span>, target_id)):
            <span class="hljs-keyword">if</span> node <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> queried <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(to_query) &lt; alpha:
                to_query.append(node)
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> to_query:
            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># æ‰€æœ‰æœ€è¿‘èŠ‚ç‚¹éƒ½æŸ¥è¯¢è¿‡äº†</span>
        
        <span class="hljs-comment"># å¹¶è¡ŒæŸ¥è¯¢è¿™äº›èŠ‚ç‚¹</span>
        <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> to_query:
            queried.add(node)
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># é—®è¿™ä¸ªèŠ‚ç‚¹ï¼šä½ çŸ¥é“å“ªäº›ç¦»targetè¿‘çš„èŠ‚ç‚¹ï¼Ÿ</span>
                new_nodes = node.find_node_rpc(target_id)
                closest_nodes.update(new_nodes)
            <span class="hljs-keyword">except</span> Timeout:
                <span class="hljs-comment"># èŠ‚ç‚¹ä¸å“åº”ï¼Œä»è·¯ç”±è¡¨ç§»é™¤</span>
                self.routing_table.remove(node)
        
        <span class="hljs-comment"># åªä¿ç•™æœ€è¿‘çš„kä¸ª</span>
        closest_nodes = <span class="hljs-built_in">sorted</span>(closest_nodes, key=<span class="hljs-keyword">lambda</span> n: distance(n.<span class="hljs-built_in">id</span>, target_id))[:k]
    
    <span class="hljs-keyword">return</span> closest_nodes[:k]
</code></pre>
<p><strong>æŸ¥æ‰¾æ•ˆç‡</strong>ï¼šO(log N)ï¼ŒNä¸ºç½‘ç»œä¸­èŠ‚ç‚¹æ€»æ•°ã€‚</p>
<p>è¿™æ„å‘³ç€åœ¨ä¸€ä¸ª100ä¸‡èŠ‚ç‚¹çš„ç½‘ç»œä¸­ï¼Œå¹³å‡åªéœ€è¦çº¦20æ¬¡æŸ¥è¯¢å°±èƒ½æ‰¾åˆ°ç›®æ ‡ã€‚</p>
<h3 data-id="heading-47">2.4 æ•°æ®å­˜å‚¨ä¸æŸ¥æ‰¾</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">store</span>(<span class="hljs-params">key, value</span>):
    <span class="hljs-string">"""å­˜å‚¨æ•°æ®åˆ°DHT"""</span>
    <span class="hljs-comment"># æ‰¾åˆ°è·ç¦»keyæœ€è¿‘çš„kä¸ªèŠ‚ç‚¹</span>
    closest_nodes = find_node(<span class="hljs-built_in">hash</span>(key))
    
    <span class="hljs-comment"># åœ¨è¿™äº›èŠ‚ç‚¹ä¸Šå­˜å‚¨æ•°æ®</span>
    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> closest_nodes:
        node.store_rpc(key, value)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">lookup</span>(<span class="hljs-params">key</span>):
    <span class="hljs-string">"""ä»DHTæŸ¥æ‰¾æ•°æ®"""</span>
    closest_nodes = find_node(<span class="hljs-built_in">hash</span>(key))
    
    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> closest_nodes:
        value = node.get_rpc(key)
        <span class="hljs-keyword">if</span> value:
            <span class="hljs-keyword">return</span> value
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
</code></pre>
<h3 data-id="heading-48">2.5 BitTorrent DHTå®æˆ˜</h3>
<p>åœ¨BitTorrentä¸­ï¼ŒDHTç”¨äºå®ç°"æ— Tracker"ä¸‹è½½ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ç£åŠ›é“¾æ¥ï¼šmagnet:?<span class="hljs-attr">xt</span>=urn:btih:XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

<span class="hljs-attr">BTIH</span> = Info Hash = SHA1(ç§å­æ–‡ä»¶çš„infoå­—æ®µ)

æµç¨‹ï¼š
1. ç”¨æˆ·è·å¾—ç£åŠ›é“¾æ¥
2. ä»DHTç½‘ç»œæŸ¥æ‰¾ï¼šhash(BTIH) å¯¹åº”çš„æ•°æ®
3. æ‰¾åˆ°æ­£åœ¨å…±äº«è¯¥æ–‡ä»¶çš„Peeråˆ—è¡¨
4. ç›´æ¥è¿æ¥Peerå¼€å§‹ä¸‹è½½
</code></pre>
<p>æ— éœ€ä»»ä½•ä¸­å¿ƒæœåŠ¡å™¨ï¼Œå®Œå…¨å»ä¸­å¿ƒåŒ–ã€‚</p>
<hr/>
<h2 data-id="heading-49">ä¸‰ã€è¶…çº§èŠ‚ç‚¹ç­–ç•¥ï¼šæ€§èƒ½ä¸å»ä¸­å¿ƒåŒ–çš„å¹³è¡¡</h2>
<h3 data-id="heading-50">3.1 ä¸ºä»€ä¹ˆéœ€è¦è¶…çº§èŠ‚ç‚¹</h3>
<p>çº¯P2Pç½‘ç»œè™½ç„¶ç†æƒ³ï¼Œä½†å­˜åœ¨ç°å®é—®é¢˜ï¼š</p>

























<table><thead><tr><th>é—®é¢˜</th><th>åŸå› </th></tr></thead><tbody><tr><td>ç§»åŠ¨è®¾å¤‡å—é™</td><td>ç”µé‡ã€å¸¦å®½ã€NATé™åˆ¶</td></tr><tr><td>èŠ‚ç‚¹æ€§èƒ½å·®å¼‚å¤§</td><td>æ ‘è“æ´¾å’ŒæœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›å·®100å€</td></tr><tr><td>åœ¨çº¿æ—¶é—´ä¸ç¨³å®š</td><td>æ™®é€šç”¨æˆ·è®¾å¤‡éšæ—¶å¯èƒ½ç¦»çº¿</td></tr><tr><td>å†·å¯åŠ¨å›°éš¾</td><td>æ–°èŠ‚ç‚¹å¦‚ä½•å‘ç°ç½‘ç»œï¼Ÿ</td></tr></tbody></table>
<p>è¶…çº§èŠ‚ç‚¹æ˜¯åŠ¡å®çš„å·¥ç¨‹é€‰æ‹©ã€‚</p>
<h3 data-id="heading-51">3.2 è¶…çº§èŠ‚ç‚¹é€‰ä¸¾ç­–ç•¥</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SuperNodeElection</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_score</span>(<span class="hljs-params">self, node</span>):
        <span class="hljs-string">"""è®¡ç®—èŠ‚ç‚¹æˆä¸ºè¶…çº§èŠ‚ç‚¹çš„å¾—åˆ†"""</span>
        score = <span class="hljs-number">0</span>
        
        <span class="hljs-comment"># å¸¦å®½æƒé‡ï¼ˆä¸Šä¼ å¸¦å®½å¾ˆé‡è¦ï¼‰</span>
        score += node.upload_bandwidth * <span class="hljs-number">0.3</span>
        
        <span class="hljs-comment"># åœ¨çº¿æ—¶é—´ç¨³å®šæ€§</span>
        score += node.uptime_ratio * <span class="hljs-number">0.25</span>
        
        <span class="hljs-comment"># NATç±»å‹ï¼ˆå…¬ç½‘IPåŠ åˆ†ï¼‰</span>
        <span class="hljs-keyword">if</span> node.nat_type == <span class="hljs-string">"Public"</span>:
            score += <span class="hljs-number">30</span>
        <span class="hljs-keyword">elif</span> node.nat_type == <span class="hljs-string">"Full Cone"</span>:
            score += <span class="hljs-number">20</span>
        
        <span class="hljs-comment"># CPU/å†…å­˜ä½™é‡</span>
        score += (<span class="hljs-number">1</span> - node.cpu_usage) * <span class="hljs-number">0.15</span>
        
        <span class="hljs-comment"># å†å²å¯é æ€§</span>
        score += node.reliability_score * <span class="hljs-number">0.1</span>
        
        <span class="hljs-keyword">return</span> score
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">elect_super_nodes</span>(<span class="hljs-params">self, candidates, required_count</span>):
        <span class="hljs-string">"""é€‰ä¸¾è¶…çº§èŠ‚ç‚¹"""</span>
        scored = [(self.calculate_score(n), n) <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> candidates]
        scored.sort(reverse=<span class="hljs-literal">True</span>)
        <span class="hljs-keyword">return</span> [n <span class="hljs-keyword">for</span> _, n <span class="hljs-keyword">in</span> scored[:required_count]]
</code></pre>
<h3 data-id="heading-52">3.3 è¶…çº§èŠ‚ç‚¹çš„èŒè´£</h3>
<pre><code class="hljs">è¶…çº§èŠ‚ç‚¹åŠŸèƒ½ï¼š
â”œâ”€â”€ ç´¢å¼•æœåŠ¡ï¼šç»´æŠ¤æ‰€è¾–æ™®é€šèŠ‚ç‚¹çš„å…ƒæ•°æ®
â”œâ”€â”€ è·¯ç”±ä¸­ç»§ï¼šå¸®åŠ©NATåçš„èŠ‚ç‚¹å»ºç«‹è¿æ¥
â”œâ”€â”€ çŠ¶æ€ç›‘æ§ï¼šæ£€æµ‹ä¸‹å±èŠ‚ç‚¹çš„åœ¨çº¿çŠ¶æ€
â”œâ”€â”€ è´Ÿè½½å‡è¡¡ï¼šåˆ†æµè¯·æ±‚åˆ°åˆé€‚çš„èŠ‚ç‚¹
â””â”€â”€ æ•…éšœæ¢å¤ï¼šè¶…çº§èŠ‚ç‚¹å¤±æ•ˆæ—¶ï¼Œè‡ªåŠ¨é€‰ä¸¾æ›¿ä»£è€…
</code></pre>
<h3 data-id="heading-53">3.4 åŠ¨æ€é™çº§ä¸æ•…éšœè½¬ç§»</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SuperNodeManager</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.super_nodes = []
        self.backup_candidates = []
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">health_check</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å®šæœŸå¥åº·æ£€æŸ¥"""</span>
        <span class="hljs-keyword">for</span> sn <span class="hljs-keyword">in</span> self.super_nodes:
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> sn.is_alive():
                self.handle_super_node_failure(sn)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_super_node_failure</span>(<span class="hljs-params">self, failed_sn</span>):
        <span class="hljs-string">"""å¤„ç†è¶…çº§èŠ‚ç‚¹å¤±æ•ˆ"""</span>
        <span class="hljs-comment"># 1. ä»è¶…çº§èŠ‚ç‚¹åˆ—è¡¨ç§»é™¤</span>
        self.super_nodes.remove(failed_sn)
        
        <span class="hljs-comment"># 2. å°†å¤±æ•ˆè¶…çº§èŠ‚ç‚¹ä¸‹å±çš„æ™®é€šèŠ‚ç‚¹é‡æ–°åˆ†é…</span>
        orphan_peers = failed_sn.get_managed_peers()
        <span class="hljs-keyword">for</span> peer <span class="hljs-keyword">in</span> orphan_peers:
            <span class="hljs-comment"># æ‰¾åˆ°æœ€è¿‘çš„å¯ç”¨è¶…çº§èŠ‚ç‚¹</span>
            new_sn = self.find_nearest_super_node(peer)
            new_sn.add_peer(peer)
        
        <span class="hljs-comment"># 3. ä»å€™é€‰æ± ä¸­é€‰ä¸¾æ–°çš„è¶…çº§èŠ‚ç‚¹</span>
        <span class="hljs-keyword">if</span> self.backup_candidates:
            new_sn = self.backup_candidates.pop(<span class="hljs-number">0</span>)
            self.promote_to_super_node(new_sn)
</code></pre>
<hr/>
<h2 data-id="heading-54">å››ã€ç°ä»£SD-WANæ¶æ„</h2>
<h3 data-id="heading-55">4.1 SD-WANæ˜¯ä»€ä¹ˆ</h3>
<p>SD-WANï¼ˆSoftware-Defined Wide Area Networkï¼‰æ˜¯è½¯ä»¶å®šä¹‰çš„å¹¿åŸŸç½‘ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯<strong>å°†ç½‘ç»œæ§åˆ¶å¹³é¢ä¸æ•°æ®å¹³é¢åˆ†ç¦»</strong>ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">ä¼ ç»ŸWANæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ€»éƒ¨ç½‘ç»œ                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  Router â”‚ â†â”€â”€ ä¸“çº¿ â”€â”€â†’ åˆ†æ”¯æœºæ„      â”‚
â”‚  â”‚  (ç¡¬ä»¶)  â”‚ â†â”€â”€ MPLS â”€â”€â†’ åˆ†æ”¯æœºæ„     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é—®é¢˜ï¼šè®¾å¤‡æ˜‚è´µã€é…ç½®å¤æ‚ã€å˜æ›´ç¼“æ…¢

<span class="hljs-built_in">SD</span>-WANæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ§åˆ¶å¹³é¢                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚      <span class="hljs-built_in">SD</span>-WAN Controller         â”‚    â”‚
â”‚  â”‚  (é›†ä¸­ç­–ç•¥ç®¡ç†ã€æ™ºèƒ½è·¯ç”±å†³ç­–)    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ API/æ§åˆ¶ä¿¡ä»¤
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®å¹³é¢                    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚ <span class="hljs-built_in">SD</span>-WAN  â”‚â†â”€â”€â”´â”€â”€â†’â”‚ <span class="hljs-built_in">SD</span>-WAN  â”‚       â”‚
â”‚    â”‚  Edge   â”‚       â”‚  Edge   â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                 â”‚            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”       â”‚
â”‚    â”‚åˆ†æ”¯æœºæ„A â”‚       â”‚åˆ†æ”¯æœºæ„B â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-56">4.2 SD-WANæ ¸å¿ƒæŠ€æœ¯</h3>
<h4 data-id="heading-57">å¤šè·¯å¾„ä¼ è¾“</h4>
<pre><code class="hljs language-diff" lang="diff">ä¼ ç»Ÿç½‘ç»œï¼šå•ä¸€è·¯å¾„ï¼ˆé€šå¸¸æ˜¯æœ€ä¾¿å®œçš„ï¼‰
SD-WANï¼šåŒæ—¶ä½¿ç”¨å¤šæ¡è·¯å¾„ï¼Œæ™ºèƒ½åˆ†é…æµé‡

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Site A   â”‚ â•â•â• MPLSä¸“çº¿ â•â•â•&gt;  â”‚  Site B   â”‚
â”‚           â”‚ â”€â”€â”€ Internet â”€â”€â”€&gt;  â”‚           â”‚
â”‚           â”‚ â”€â”€â”€ 4G/5G â”€â”€â”€â”€&gt;    â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç­–ç•¥ç¤ºä¾‹ï¼š
<span class="hljs-deletion">- è§†é¢‘ä¼šè®® â†’ MPLSä¸“çº¿ï¼ˆä½å»¶è¿Ÿã€ç¨³å®šï¼‰</span>
<span class="hljs-deletion">- æ–‡ä»¶ä¸‹è½½ â†’ Internetï¼ˆé«˜å¸¦å®½ã€ä½æˆæœ¬ï¼‰</span>
<span class="hljs-deletion">- å¤‡ä»½æµé‡ â†’ 4G/5Gï¼ˆé—²æ—¶ä½¿ç”¨ï¼‰</span>
</code></pre>
<h4 data-id="heading-58">åº”ç”¨æ„ŸçŸ¥è·¯ç”±</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ApplicationAwareRouting</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.app_policies = {
            <span class="hljs-string">"video_conference"</span>: {
                <span class="hljs-string">"max_latency"</span>: <span class="hljs-number">50</span>,      <span class="hljs-comment"># ms</span>
                <span class="hljs-string">"max_jitter"</span>: <span class="hljs-number">10</span>,       <span class="hljs-comment"># ms</span>
                <span class="hljs-string">"min_bandwidth"</span>: <span class="hljs-number">2</span>,     <span class="hljs-comment"># Mbps</span>
                <span class="hljs-string">"preferred_path"</span>: <span class="hljs-string">"mpls"</span>
            },
            <span class="hljs-string">"web_browsing"</span>: {
                <span class="hljs-string">"max_latency"</span>: <span class="hljs-number">200</span>,
                <span class="hljs-string">"min_bandwidth"</span>: <span class="hljs-number">0.5</span>,
                <span class="hljs-string">"preferred_path"</span>: <span class="hljs-string">"internet"</span>
            },
            <span class="hljs-string">"backup"</span>: {
                <span class="hljs-string">"preferred_path"</span>: <span class="hljs-string">"cheapest"</span>,
                <span class="hljs-string">"time_window"</span>: <span class="hljs-string">"off_peak"</span>
            }
        }
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">select_path</span>(<span class="hljs-params">self, packet</span>):
        <span class="hljs-string">"""æ ¹æ®åº”ç”¨ç±»å‹é€‰æ‹©æœ€ä½³è·¯å¾„"""</span>
        app_type = self.identify_application(packet)
        policy = self.app_policies.get(app_type, self.default_policy)
        
        <span class="hljs-comment"># è·å–æ‰€æœ‰å¯ç”¨è·¯å¾„çš„å®æ—¶æŒ‡æ ‡</span>
        available_paths = self.get_path_metrics()
        
        <span class="hljs-comment"># è¿‡æ»¤æ»¡è¶³SLAçš„è·¯å¾„</span>
        qualified_paths = [
            p <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> available_paths
            <span class="hljs-keyword">if</span> p.latency &lt;= policy[<span class="hljs-string">"max_latency"</span>]
            <span class="hljs-keyword">and</span> p.bandwidth &gt;= policy[<span class="hljs-string">"min_bandwidth"</span>]
        ]
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> qualified_paths:
            <span class="hljs-keyword">return</span> self.fallback_path
        
        <span class="hljs-comment"># æŒ‰ç­–ç•¥ä¼˜é€‰</span>
        <span class="hljs-keyword">if</span> policy[<span class="hljs-string">"preferred_path"</span>] == <span class="hljs-string">"cheapest"</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">min</span>(qualified_paths, key=<span class="hljs-keyword">lambda</span> p: p.cost)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> self.find_path_by_type(qualified_paths, policy[<span class="hljs-string">"preferred_path"</span>])
</code></pre>
<h4 data-id="heading-59">é›¶æ¥è§¦éƒ¨ç½²ï¼ˆZTPï¼‰</h4>
<pre><code class="hljs language-markdown" lang="markdown">ä¼ ç»Ÿéƒ¨ç½²æµç¨‹ï¼š
<span class="hljs-bullet">1.</span> é‡‡è´­è®¾å¤‡ â†’ 2. ç°åœºé…ç½® â†’ 3. ä¸“ä¸šäººå‘˜è°ƒè¯• â†’ 4. æµ‹è¯• â†’ 5. ä¸Šçº¿
ï¼ˆè€—æ—¶æ•°å‘¨ï¼Œéœ€è¦ä¸“ä¸šäººå‘˜ç°åœºï¼‰

SD-WAN ZTPæµç¨‹ï¼š
<span class="hljs-bullet">1.</span> é‡‡è´­é¢„é…ç½®è®¾å¤‡
<span class="hljs-bullet">2.</span> è®¾å¤‡é€šç”µè”ç½‘
<span class="hljs-bullet">3.</span> è‡ªåŠ¨ä»äº‘ç«¯æ‹‰å–é…ç½®
<span class="hljs-bullet">4.</span> è‡ªåŠ¨å»ºç«‹éš§é“
<span class="hljs-bullet">5.</span> å®Œæˆéƒ¨ç½²
ï¼ˆè€—æ—¶æ•°åˆ†é’Ÿï¼Œæ— éœ€ä¸“ä¸šäººå‘˜ï¼‰
</code></pre>
<h3 data-id="heading-60">4.3 ä¼ä¸šçº§ä¸ä¸ªäººçº§ç»„ç½‘çš„å·®å¼‚</h3>



































<table><thead><tr><th>ç‰¹æ€§</th><th>ä¼ä¸šçº§SD-WAN</th><th>ä¸ªäººçº§ç»„ç½‘æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>éƒ¨ç½²æˆæœ¬</td><td>é«˜ï¼ˆä¸“ç”¨ç¡¬ä»¶+æˆæƒï¼‰</td><td>ä½ï¼ˆè½¯ä»¶å³å¯ï¼‰</td></tr><tr><td>ç®¡ç†å¤æ‚åº¦</td><td>éœ€è¦ä¸“ä¸šè¿ç»´</td><td>é›¶é…ç½®æˆ–ä½é…ç½®</td></tr><tr><td>SLAä¿éšœ</td><td>æœ‰åˆåŒä¿éšœ</td><td>å°½åŠ›è€Œä¸º</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>ä¼ä¸šåˆ†æ”¯äº’è”</td><td>ä¸ªäººè®¾å¤‡äº’è”ã€å°å›¢é˜Ÿ</td></tr><tr><td>å…¸å‹äº§å“</td><td>Cisco Viptelaã€VMware</td><td>Tailscaleã€æ˜Ÿç©ºç»„ç½‘</td></tr></tbody></table>
<p>å¯¹äºä¸ªäººç”¨æˆ·å’Œå°å›¢é˜Ÿï¼Œä¼ä¸šçº§SD-WANè¿‡äºå¤æ‚å’Œæ˜‚è´µã€‚è½»é‡çº§ç»„ç½‘æ–¹æ¡ˆï¼ˆå¦‚<strong>æ˜Ÿç©ºç»„ç½‘</strong>ï¼‰é‡‡ç”¨äº†ç±»ä¼¼çš„æ··åˆP2Pæ¶æ„æ€æƒ³ï¼Œä½†å¤§å¹…ç®€åŒ–äº†ä½¿ç”¨é—¨æ§›ï¼š</p>
<ul>
<li>è‡ªåŠ¨NATç©¿é€ï¼Œæ— éœ€ç«¯å£æ˜ å°„</li>
<li>æ™ºèƒ½è·¯ç”±é€‰æ‹©ï¼Œè‡ªåŠ¨æ‹©ä¼˜</li>
<li>è·¨å¹³å°æ”¯æŒï¼Œæ‰‹æœºç”µè„‘é€šç”¨</li>
<li>æ— éœ€å…¬ç½‘IPå³å¯äº’è”</li>
</ul>
<hr/>
<h2 data-id="heading-61">äº”ã€ç»„ç½‘æ–¹æ¡ˆæŠ€æœ¯é€‰å‹</h2>
<h3 data-id="heading-62">5.1 åœºæ™¯åˆ†æ</h3>






























<table><thead><tr><th>åœºæ™¯</th><th>èŠ‚ç‚¹ç‰¹å¾</th><th>æ¨èæ¶æ„</th></tr></thead><tbody><tr><td>ä¸ªäººè®¾å¤‡äº’è”</td><td>2-10è®¾å¤‡ï¼Œå®¶ç”¨ç½‘ç»œ</td><td>çº¯P2Pæˆ–è½»é‡æ··åˆ</td></tr><tr><td>è¿œç¨‹åŠå…¬å›¢é˜Ÿ</td><td>10-50äººï¼Œåˆ†å¸ƒå…¨å›½</td><td>æ··åˆP2P+è¶…çº§èŠ‚ç‚¹</td></tr><tr><td>æ¸¸æˆè”æœº</td><td>ä½å»¶è¿Ÿè¦æ±‚ï¼Œçªå‘æµé‡</td><td>P2Pç›´è¿ä¼˜å…ˆ</td></tr><tr><td>ä¼ä¸šå¤šåˆ†æ”¯</td><td>100+ç«™ç‚¹ï¼ŒSLAè¦æ±‚</td><td>ä¼ä¸šçº§SD-WAN</td></tr></tbody></table>
<h3 data-id="heading-63">5.2 æŠ€æœ¯å¯¹æ¯”çŸ©é˜µ</h3>
<pre><code class="hljs language-scss" lang="scss">                    è¿æ¥æ•ˆç‡
                       â†‘
                       â”‚   â˜… SD-WAN
                       â”‚     (é›†ä¸­æ§åˆ¶+å¤šè·¯å¾„)
                       â”‚
                       â”‚        â˜… æ··åˆP2P
         â˜… çº¯P2P      â”‚         (è¶…çº§èŠ‚ç‚¹è¾…åŠ©)
         (å®Œå…¨å»ä¸­å¿ƒ)  â”‚
                       â”‚
                       â”‚
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ä¸­å¿ƒåŒ–ç¨‹åº¦
                       â”‚
                       â”‚        â˜… C/Sæ¶æ„
                       â”‚         (å®Œå…¨ä¸­å¿ƒåŒ–)
</code></pre>
<h3 data-id="heading-64">5.3 å®é™…é€‰å‹å»ºè®®</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">recommend_solution</span>(<span class="hljs-params">scenario</span>):
    <span class="hljs-string">"""æ ¹æ®åœºæ™¯æ¨èç»„ç½‘æ–¹æ¡ˆ"""</span>
    
    <span class="hljs-keyword">if</span> scenario.node_count &lt; <span class="hljs-number">10</span> <span class="hljs-keyword">and</span> scenario.tech_skill == <span class="hljs-string">"low"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¨èï¼šå¼€ç®±å³ç”¨çš„ç»„ç½‘è½¯ä»¶ï¼ˆå¦‚æ˜Ÿç©ºç»„ç½‘ï¼‰"</span>
    
    <span class="hljs-keyword">elif</span> scenario.node_count &lt; <span class="hljs-number">50</span> <span class="hljs-keyword">and</span> scenario.budget == <span class="hljs-string">"limited"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¨èï¼šå¼€æºæ–¹æ¡ˆï¼ˆWireGuard + è‡ªå»ºä¸­ç»§ï¼‰æˆ–å•†ä¸šè½»é‡æ–¹æ¡ˆ"</span>
    
    <span class="hljs-keyword">elif</span> scenario.sla_required <span class="hljs-keyword">and</span> scenario.budget == <span class="hljs-string">"sufficient"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¨èï¼šä¼ä¸šçº§SD-WANï¼ˆCisco/VMware/åä¸ºï¼‰"</span>
    
    <span class="hljs-keyword">elif</span> scenario.latency_sensitive <span class="hljs-keyword">and</span> scenario.p2p_capable:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¨èï¼šæ”¯æŒP2Pç›´è¿çš„æ–¹æ¡ˆï¼Œé¿å…ä¸­ç»§å¸¦æ¥çš„å»¶è¿Ÿ"</span>
    
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"æ¨èï¼šæ ¹æ®å…·ä½“æƒ…å†µæ··åˆé€‰å‹"</span>
</code></pre>
<hr/>
<h2 data-id="heading-65">å…­ã€åŠ¨æ‰‹å®è·µï¼šæ„å»ºç®€æ˜“DHTç½‘ç»œ</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–çš„Kademlia DHTå®ç°ï¼Œå¸®åŠ©ç†è§£æ ¸å¿ƒåŸç†ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> random
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict

<span class="hljs-keyword">class</span> <span class="hljs-title class_">KademliaNode</span>:
    K = <span class="hljs-number">20</span>  <span class="hljs-comment"># K-bucketå¤§å°</span>
    ALPHA = <span class="hljs-number">3</span>  <span class="hljs-comment"># å¹¶è¡Œåº¦</span>
    ID_BITS = <span class="hljs-number">160</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, node_id=<span class="hljs-literal">None</span></span>):
        self.<span class="hljs-built_in">id</span> = node_id <span class="hljs-keyword">or</span> self._generate_id()
        self.routing_table = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.ID_BITS)]
        self.storage = {}
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_generate_id</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""ç”ŸæˆéšæœºèŠ‚ç‚¹ID"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(hashlib.sha1(random.randbytes(<span class="hljs-number">20</span>)).hexdigest(), <span class="hljs-number">16</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_xor_distance</span>(<span class="hljs-params">self, id1, id2</span>):
        <span class="hljs-string">"""è®¡ç®—XORè·ç¦»"""</span>
        <span class="hljs-keyword">return</span> id1 ^ id2
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_bucket_index</span>(<span class="hljs-params">self, node_id</span>):
        <span class="hljs-string">"""è®¡ç®—èŠ‚ç‚¹åº”è¯¥æ”¾å…¥å“ªä¸ªbucket"""</span>
        distance = self._xor_distance(self.<span class="hljs-built_in">id</span>, node_id)
        <span class="hljs-keyword">if</span> distance == <span class="hljs-number">0</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
        <span class="hljs-keyword">return</span> distance.bit_length() - <span class="hljs-number">1</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">update_routing_table</span>(<span class="hljs-params">self, node</span>):
        <span class="hljs-string">"""æ›´æ–°è·¯ç”±è¡¨"""</span>
        <span class="hljs-keyword">if</span> node.<span class="hljs-built_in">id</span> == self.<span class="hljs-built_in">id</span>:
            <span class="hljs-keyword">return</span>
        
        bucket_idx = self._bucket_index(node.<span class="hljs-built_in">id</span>)
        bucket = self.routing_table[bucket_idx]
        
        <span class="hljs-comment"># å¦‚æœèŠ‚ç‚¹å·²å­˜åœ¨ï¼Œç§»åˆ°æœ«å°¾ï¼ˆæœ€è¿‘ä½¿ç”¨ï¼‰</span>
        <span class="hljs-keyword">for</span> i, existing <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(bucket):
            <span class="hljs-keyword">if</span> existing.<span class="hljs-built_in">id</span> == node.<span class="hljs-built_in">id</span>:
                bucket.append(bucket.pop(i))
                <span class="hljs-keyword">return</span>
        
        <span class="hljs-comment"># å¦‚æœbucketæœªæ»¡ï¼Œç›´æ¥æ·»åŠ </span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(bucket) &lt; self.K:
            bucket.append(node)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># bucketå·²æ»¡ï¼Œæ£€æŸ¥æœ€è€çš„èŠ‚ç‚¹æ˜¯å¦åœ¨çº¿</span>
            oldest = bucket[<span class="hljs-number">0</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> oldest.ping():
                bucket.pop(<span class="hljs-number">0</span>)
                bucket.append(node)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">find_closest_nodes</span>(<span class="hljs-params">self, target_id, count=K</span>):
        <span class="hljs-string">"""ä»è·¯ç”±è¡¨æ‰¾æœ€è¿‘çš„èŠ‚ç‚¹"""</span>
        all_nodes = []
        <span class="hljs-keyword">for</span> bucket <span class="hljs-keyword">in</span> self.routing_table:
            all_nodes.extend(bucket)
        
        all_nodes.sort(key=<span class="hljs-keyword">lambda</span> n: self._xor_distance(n.<span class="hljs-built_in">id</span>, target_id))
        <span class="hljs-keyword">return</span> all_nodes[:count]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">store</span>(<span class="hljs-params">self, key, value</span>):
        <span class="hljs-string">"""å­˜å‚¨é”®å€¼å¯¹"""</span>
        self.storage[key] = value
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self, key</span>):
        <span class="hljs-string">"""è·å–å€¼"""</span>
        <span class="hljs-keyword">return</span> self.storage.get(key)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ping</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""å¿ƒè·³æ£€æµ‹"""</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span>  <span class="hljs-comment"># ç®€åŒ–å®ç°</span>

<span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo</span>():
    <span class="hljs-comment"># åˆ›å»ºä¸€äº›èŠ‚ç‚¹</span>
    nodes = [KademliaNode() <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>)]
    
    <span class="hljs-comment"># è®©èŠ‚ç‚¹äº’ç›¸å‘ç°ï¼ˆç®€åŒ–çš„å¼•å¯¼è¿‡ç¨‹ï¼‰</span>
    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> nodes:
        <span class="hljs-comment"># æ¯ä¸ªèŠ‚ç‚¹éšæœºè®¤è¯†å‡ ä¸ªå…¶ä»–èŠ‚ç‚¹</span>
        known_nodes = random.sample(nodes, <span class="hljs-built_in">min</span>(<span class="hljs-number">10</span>, <span class="hljs-built_in">len</span>(nodes)))
        <span class="hljs-keyword">for</span> known <span class="hljs-keyword">in</span> known_nodes:
            node.update_routing_table(known)
    
    <span class="hljs-comment"># å­˜å‚¨æ•°æ®</span>
    key = hashlib.sha1(<span class="hljs-string">b"test_key"</span>).hexdigest()
    value = <span class="hljs-string">"Hello, DHT!"</span>
    
    <span class="hljs-comment"># æ‰¾åˆ°è·ç¦»keyæœ€è¿‘çš„èŠ‚ç‚¹æ¥å­˜å‚¨</span>
    target_id = <span class="hljs-built_in">int</span>(key, <span class="hljs-number">16</span>)
    closest = nodes[<span class="hljs-number">0</span>].find_closest_nodes(target_id, count=<span class="hljs-number">3</span>)
    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> closest:
        node.store(key, value)
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ•°æ®å·²å­˜å‚¨åˆ° <span class="hljs-subst">{<span class="hljs-built_in">len</span>(closest)}</span> ä¸ªèŠ‚ç‚¹"</span>)
    
    <span class="hljs-comment"># ä»ä»»æ„èŠ‚ç‚¹æŸ¥æ‰¾æ•°æ®</span>
    random_node = random.choice(nodes)
    result = random_node.get(key)  <span class="hljs-comment"># ç®€åŒ–ï¼šå®é™…éœ€è¦é€’å½’æŸ¥æ‰¾</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æŸ¥æ‰¾ç»“æœ: <span class="hljs-subst">{result}</span>"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    demo()
</code></pre>
<hr/>
<h2 data-id="heading-66">ä¸ƒã€æ€»ç»“</h2>
<p>åˆ†å¸ƒå¼ç»„ç½‘ç»å†äº†ä»ç†è®ºåˆ°å®è·µçš„æ¼«é•¿æ¼”è¿›ï¼š</p>



































<table><thead><tr><th>é˜¶æ®µ</th><th>ä»£è¡¨æŠ€æœ¯</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>ç†è®ºå¥ åŸº</td><td>DHT/Kademlia</td><td>O(log N)æŸ¥æ‰¾æ•ˆç‡</td></tr><tr><td>å¤§è§„æ¨¡éªŒè¯</td><td>BitTorrent</td><td>äº¿çº§èŠ‚ç‚¹ç½‘ç»œ</td></tr><tr><td>å•†ä¸šåº”ç”¨</td><td>Skype</td><td>è¶…çº§èŠ‚ç‚¹æ¶æ„</td></tr><tr><td>ä¼ä¸šçº§</td><td>SD-WAN</td><td>é›†ä¸­æ§åˆ¶+æ™ºèƒ½è·¯ç”±</td></tr><tr><td>ç°ä»£ä¸ªäººçº§</td><td>WireGuardç”Ÿæ€</td><td>ç®€å•å®‰å…¨é«˜æ•ˆ</td></tr></tbody></table>
<p><strong>é€‰æ‹©å»ºè®®</strong>ï¼š</p>
<ol>
<li><strong>è¿½æ±‚æè‡´ç®€å•</strong>ï¼šé€‰æ‹©å¼€ç®±å³ç”¨çš„å•†ä¸šæ–¹æ¡ˆï¼ˆå¦‚æ˜Ÿç©ºç»„ç½‘ï¼‰ï¼Œé€‚åˆä¸ªäººå’Œå°å›¢é˜Ÿ</li>
<li><strong>æœ‰æŠ€æœ¯èƒ½åŠ›ä¸”æƒ³å®Œå…¨æ§åˆ¶</strong>ï¼šè‡ªå»ºWireGuard + è‡ªå·±çš„ä¸­ç»§èŠ‚ç‚¹</li>
<li><strong>ä¼ä¸šçº§éœ€æ±‚</strong>ï¼šè¯„ä¼°SD-WANå‚å•†ï¼Œæ³¨é‡SLAå’ŒæŠ€æœ¯æ”¯æŒ</li>
</ol>
<p>æ— è®ºé€‰æ‹©å“ªç§æ–¹æ¡ˆï¼Œç†è§£åº•å±‚åŸç†éƒ½æœ‰åŠ©äºä½ æ›´å¥½åœ°ä½¿ç”¨å’Œæ’æŸ¥é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-67">å‚è€ƒæ–‡çŒ®</h2>
<ol>
<li>Maymounkov, P., &amp; MaziÃ¨res, D. (2002). Kademlia: A Peer-to-Peer Information System Based on the XOR Metric. IPTPS.</li>
<li>Stoica, I., Morris, R., Karger, D., et al. (2001). Chord: A Scalable Peer-to-peer Lookup Service for Internet Applications. SIGCOMM.</li>
<li>RFC 7348 - Virtual eXtensible Local Area Network (VXLAN)</li>
<li>MEF 70 - SD-WAN Service Attributes and Services</li>
<li>BitTorrent Protocol Specification (BEP 0005 - DHT Protocol)</li>
</ol>
<hr/>
<blockquote>
<p>ğŸ’¡ <strong>å®è·µå»ºè®®</strong>ï¼šåœ¨é€‰æ‹©ç»„ç½‘æ–¹æ¡ˆæ—¶ï¼Œå…ˆæ˜ç¡®è‡ªå·±çš„æ ¸å¿ƒéœ€æ±‚ï¼ˆå»¶è¿Ÿï¼Ÿæˆæœ¬ï¼Ÿæ˜“ç”¨æ€§ï¼Ÿï¼‰ï¼Œå†æ ¹æ®éœ€æ±‚åŒ¹é…æŠ€æœ¯æ–¹æ¡ˆã€‚å¥½çš„æ¶æ„æ˜¯é€‚åˆä¸šåŠ¡çš„æ¶æ„ï¼Œè€Œéæœ€å¤æ‚çš„æ¶æ„ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQLç´¢å¼•æ˜æ˜å»ºäº†ï¼ŒæŸ¥è¯¢è¿˜æ˜¯æ…¢ï¼Œæ’æŸ¥å‘ç°è¸©äº†è¿™äº›å‘]]></title>    <link>https://juejin.cn/post/7592524811862048802</link>    <guid>https://juejin.cn/post/7592524811862048802</guid>    <pubDate>2026-01-08T06:50:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592524811862048802" data-draft-id="7592500570168393763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQLç´¢å¼•æ˜æ˜å»ºäº†ï¼ŒæŸ¥è¯¢è¿˜æ˜¯æ…¢ï¼Œæ’æŸ¥å‘ç°è¸©äº†è¿™äº›å‘"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-08T06:50:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¥å¥‡å°æ±¤åœ†"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQLç´¢å¼•æ˜æ˜å»ºäº†ï¼ŒæŸ¥è¯¢è¿˜æ˜¯æ…¢ï¼Œæ’æŸ¥å‘ç°è¸©äº†è¿™äº›å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¥å¥‡å°æ±¤åœ†
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:50:03.000Z" title="Thu Jan 08 2026 06:50:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>åŒäº‹è¯´ä»–çš„SQLæŸ¥è¯¢å¾ˆæ…¢ï¼Œä½†ä»–æ˜æ˜å»ºäº†ç´¢å¼•ã€‚</p>
<p>æˆ‘è¿‡å»ä¸€çœ‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">SELECT * FROM orders WHERE <span class="hljs-attr">user_id</span> = <span class="hljs-number">10086</span> AND status = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
</code></pre>
<p>è¡¨æœ‰500ä¸‡æ•°æ®ï¼Œ<code>user_id</code>å’Œ<code>status</code>éƒ½æœ‰ç´¢å¼•ï¼Œä½†è¿™æ¡SQLæ‰§è¡Œè¦3ç§’ã€‚</p>
<p>ç”¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267770443%26content_type%3DArticle%26match_order%3D1%26q%3DEXPLAIN%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267770443&amp;content_type=Article&amp;match_order=1&amp;q=EXPLAIN&amp;zhida_source=entity" ref="nofollow noopener noreferrer">EXPLAIN</a>ä¸€çœ‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">10086</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+--------+------+---------------+------+---------+------+---------+-------------+</span>
<span class="hljs-operator">|</span> id <span class="hljs-operator">|</span> select_type <span class="hljs-operator">|</span> <span class="hljs-keyword">table</span>  <span class="hljs-operator">|</span> type <span class="hljs-operator">|</span> possible_keys <span class="hljs-operator">|</span> key  <span class="hljs-operator">|</span> key_len <span class="hljs-operator">|</span> <span class="hljs-keyword">ref</span>  <span class="hljs-operator">|</span> <span class="hljs-keyword">rows</span>    <span class="hljs-operator">|</span> Extra       <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+--------+------+---------------+------+---------+------+---------+-------------+</span>
<span class="hljs-operator">|</span>  <span class="hljs-number">1</span> <span class="hljs-operator">|</span> SIMPLE      <span class="hljs-operator">|</span> orders <span class="hljs-operator">|</span> <span class="hljs-keyword">ALL</span>  <span class="hljs-operator">|</span> idx_user_id   <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span> <span class="hljs-operator">|</span> <span class="hljs-number">5000000</span> <span class="hljs-operator">|</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span> <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----+-------------+--------+------+---------------+------+---------+------+---------+-------------+</span>
</code></pre>
<p><code>type=ALL</code>ï¼Œå…¨è¡¨æ‰«æï¼Œç´¢å¼•æ ¹æœ¬æ²¡ç”¨ä¸Šã€‚</p>
<p>ä¸ºä»€ä¹ˆï¼Ÿæ€»ç»“äº†ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åŸå› ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€å¯¹ç´¢å¼•åˆ—åšè¿ç®—æˆ–å‡½æ•°</h2>
<h3 data-id="heading-2">é”™è¯¯ç¤ºä¾‹</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å¯¹ç´¢å¼•åˆ—ä½¿ç”¨å‡½æ•°</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(create_time) <span class="hljs-operator">=</span> <span class="hljs-number">2024</span>;

<span class="hljs-comment">-- å¯¹ç´¢å¼•åˆ—åšè¿ç®—</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> order_id <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-operator">=</span> <span class="hljs-number">10087</span>;
</code></pre>
<h3 data-id="heading-3">åŸå› </h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267770443%26content_type%3DArticle%26match_order%3D1%26q%3DB%252B%25E6%25A0%2591%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267770443&amp;content_type=Article&amp;match_order=1&amp;q=B%2B%E6%A0%91&amp;zhida_source=entity" ref="nofollow noopener noreferrer">B+æ ‘</a>ç´¢å¼•å­˜çš„æ˜¯åˆ—çš„åŸå§‹å€¼ï¼Œä½ ç”¨å‡½æ•°æˆ–è¿ç®—å¤„ç†åï¼ŒMySQLæ²¡æ³•ç›´æ¥ç”¨ç´¢å¼•æŸ¥æ‰¾ã€‚</p>
<h3 data-id="heading-4">æ­£ç¡®å†™æ³•</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ”¹æˆèŒƒå›´æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2024-01-01'</span> <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2025-01-01'</span>;

<span class="hljs-comment">-- æŠŠè¿ç®—ç§»åˆ°å³è¾¹</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> order_id <span class="hljs-operator">=</span> <span class="hljs-number">10087</span> <span class="hljs-operator">-</span> <span class="hljs-number">1</span>;
</code></pre>
<h2 data-id="heading-5">äºŒã€éšå¼ç±»å‹è½¬æ¢</h2>
<h3 data-id="heading-6">é”™è¯¯ç¤ºä¾‹</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- phoneæ˜¯VARCHARç±»å‹</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> phone <span class="hljs-operator">=</span> <span class="hljs-number">13800138000</span>;
</code></pre>
<p><code>phone</code>æ˜¯å­—ç¬¦ä¸²ï¼Œä½†ä¼ å…¥çš„æ˜¯æ•°å­—ï¼ŒMySQLä¼šåšéšå¼è½¬æ¢ã€‚</p>
<h3 data-id="heading-7">EXPLAINç»“æœ</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">type:</span> <span class="hljs-string">ALL</span>
<span class="hljs-attr">key:</span> <span class="hljs-literal">NULL</span>
</code></pre>
<p>ç´¢å¼•å¤±æ•ˆäº†ã€‚</p>
<h3 data-id="heading-8">åŸå› </h3>
<p>MySQLçš„è½¬æ¢è§„åˆ™æ˜¯ï¼š<strong>å­—ç¬¦ä¸²è½¬æ•°å­—</strong>ï¼Œè€Œä¸æ˜¯æ•°å­—è½¬å­—ç¬¦ä¸²ã€‚</p>
<p>æ‰€ä»¥å®é™…æ‰§è¡Œçš„æ˜¯ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">CAST</span>(phone <span class="hljs-keyword">AS</span> SIGNED) <span class="hljs-operator">=</span> <span class="hljs-number">13800138000</span>;
</code></pre>
<p>ç­‰äºå¯¹ç´¢å¼•åˆ—åšäº†å‡½æ•°å¤„ç†ï¼Œç´¢å¼•å¤±æ•ˆã€‚</p>
<h3 data-id="heading-9">æ­£ç¡®å†™æ³•</h3>
<pre><code class="hljs language-ini" lang="ini">SELECT * FROM users WHERE <span class="hljs-attr">phone</span> = <span class="hljs-string">'13800138000'</span><span class="hljs-comment">;</span>
</code></pre>
<p><strong>è®°ä½</strong>ï¼šç±»å‹è¦åŒ¹é…ï¼Œå­—ç¬¦ä¸²å°±ä¼ å­—ç¬¦ä¸²ã€‚</p>
<h2 data-id="heading-10">ä¸‰ã€LIKEä»¥%å¼€å¤´</h2>
<h3 data-id="heading-11">é”™è¯¯ç¤ºä¾‹</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%æ‰‹æœº%'</span>;
</code></pre>
<h3 data-id="heading-12">åŸå› </h3>
<p>B+æ ‘ç´¢å¼•æ˜¯æŒ‰é¡ºåºæ’åˆ—çš„ï¼Œ<code>%æ‰‹æœº%</code>æ²¡æ³•åˆ©ç”¨ç´¢å¼•å®šä½ï¼Œåªèƒ½å…¨è¡¨æ‰«æã€‚</p>
<h3 data-id="heading-13">å¯ä»¥ç”¨ç´¢å¼•çš„å†™æ³•</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å‰ç¼€åŒ¹é…å¯ä»¥ç”¨ç´¢å¼•</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'æ‰‹æœº%'</span>;
</code></pre>
<h3 data-id="heading-14">å…¨æ–‡æœç´¢æ€ä¹ˆåŠ</h3>
<p>å¦‚æœä¸šåŠ¡éœ€è¦ä¸­é—´åŒ¹é…ï¼š</p>
<ol>
<li><strong>å…¨æ–‡ç´¢å¼•</strong>ï¼šMySQL 5.7+æ”¯æŒä¸­æ–‡å…¨æ–‡ç´¢å¼•</li>
<li><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267770443%26content_type%3DArticle%26match_order%3D1%26q%3DElasticsearch%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267770443&amp;content_type=Article&amp;match_order=1&amp;q=Elasticsearch&amp;zhida_source=entity" ref="nofollow noopener noreferrer">Elasticsearch</a></strong>ï¼šä¸“ä¸šçš„æœç´¢å¼•æ“</li>
<li><strong>æœç´¢ä¼˜åŒ–</strong>ï¼šç”¨å…¶ä»–æ¡ä»¶å…ˆè¿‡æ»¤ï¼Œå†LIKE</li>
</ol>
<h2 data-id="heading-15">å››ã€ORæ¡ä»¶åªæœ‰éƒ¨åˆ†æœ‰ç´¢å¼•</h2>
<h3 data-id="heading-16">é”™è¯¯ç¤ºä¾‹</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- user_idæœ‰ç´¢å¼•ï¼Œremarkæ²¡ç´¢å¼•</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">10086</span> <span class="hljs-keyword">OR</span> remark <span class="hljs-operator">=</span> <span class="hljs-string">'æµ‹è¯•'</span>;
</code></pre>
<h3 data-id="heading-17">EXPLAINç»“æœ</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">type</span>: ALL
</code></pre>
<p>å…¨è¡¨æ‰«æã€‚</p>
<h3 data-id="heading-18">åŸå› </h3>
<p>ORçš„ä¸¤ä¸ªæ¡ä»¶ï¼Œåªè¦æœ‰ä¸€ä¸ªæ²¡ç´¢å¼•ï¼Œå°±æ²¡æ³•ç”¨ç´¢å¼•ã€‚</p>
<h3 data-id="heading-19">æ­£ç¡®å†™æ³•</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ–¹æ¡ˆ1ï¼šç»™remarkä¹ŸåŠ ç´¢å¼•</span>

<span class="hljs-comment">-- æ–¹æ¡ˆ2ï¼šæ”¹æˆUNION</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">10086</span>
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> remark <span class="hljs-operator">=</span> <span class="hljs-string">'æµ‹è¯•'</span>;
</code></pre>
<h2 data-id="heading-20">äº”ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267770443%26content_type%3DArticle%26match_order%3D1%26q%3D%25E8%2581%2594%25E5%2590%2588%25E7%25B4%25A2%25E5%25BC%2595%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267770443&amp;content_type=Article&amp;match_order=1&amp;q=%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95&amp;zhida_source=entity" ref="nofollow noopener noreferrer">è”åˆç´¢å¼•</a>æ²¡éµå¾ªæœ€å·¦å‰ç¼€</h2>
<h3 data-id="heading-21">å‡è®¾æœ‰è”åˆç´¢å¼•</h3>
<pre><code class="hljs language-css" lang="css">CREATE INDEX idx_abc ON orders(<span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">b</span>, c);
</code></pre>
<h3 data-id="heading-22">èƒ½ç”¨ä¸Šç´¢å¼•çš„æŸ¥è¯¢</h3>
<pre><code class="hljs language-ini" lang="ini">WHERE <span class="hljs-attr">a</span> = <span class="hljs-number">1</span>
WHERE <span class="hljs-attr">a</span> = <span class="hljs-number">1</span> AND b = <span class="hljs-number">2</span>
WHERE <span class="hljs-attr">a</span> = <span class="hljs-number">1</span> AND b = <span class="hljs-number">2</span> AND c = <span class="hljs-number">3</span>
WHERE <span class="hljs-attr">a</span> = <span class="hljs-number">1</span> AND c = <span class="hljs-number">3</span>  -- åªèƒ½ç”¨åˆ°a
</code></pre>
<h3 data-id="heading-23">ç”¨ä¸ä¸Šç´¢å¼•çš„æŸ¥è¯¢</h3>
<pre><code class="hljs language-ini" lang="ini">WHERE <span class="hljs-attr">b</span> = <span class="hljs-number">2</span>           -- æ²¡æœ‰aï¼Œæœ€å·¦å‰ç¼€æ–­äº†
WHERE <span class="hljs-attr">b</span> = <span class="hljs-number">2</span> AND c = <span class="hljs-number">3</span> -- æ²¡æœ‰a
WHERE <span class="hljs-attr">c</span> = <span class="hljs-number">3</span>           -- æ²¡æœ‰a
</code></pre>
<h3 data-id="heading-24">åŸç†</h3>
<p>è”åˆç´¢å¼•çš„B+æ ‘æ˜¯æŒ‰(a, b, c)é¡ºåºæ’åˆ—çš„ï¼Œå…ˆæŒ‰aæ’åºï¼Œaç›¸åŒçš„æŒ‰bæ’åºï¼Œbç›¸åŒçš„æŒ‰cæ’åºã€‚</p>
<p>å¦‚æœæŸ¥è¯¢ä¸åŒ…å«aï¼Œå°±æ²¡æ³•åˆ©ç”¨è¿™ä¸ªæ’åºç»“æ„ã€‚</p>
<h2 data-id="heading-25">å…­ã€èŒƒå›´æŸ¥è¯¢åçš„åˆ—å¤±æ•ˆ</h2>
<h3 data-id="heading-26">è”åˆç´¢å¼•</h3>
<pre><code class="hljs language-css" lang="css">CREATE INDEX idx_abc ON orders(<span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">b</span>, c);
</code></pre>
<h3 data-id="heading-27">æŸ¥è¯¢</h3>
<pre><code class="hljs language-css" lang="css">SELECT * <span class="hljs-selector-tag">FROM</span> orders WHERE <span class="hljs-selector-tag">a</span> = <span class="hljs-number">1</span> AND <span class="hljs-selector-tag">b</span> &gt; <span class="hljs-number">10</span> AND c = <span class="hljs-number">3</span>;
</code></pre>
<h3 data-id="heading-28">å®é™…ç”¨åˆ°çš„ç´¢å¼•</h3>
<p>åªç”¨åˆ°äº†<code>a</code>å’Œ<code>b</code>ï¼Œ<code>c</code>æ²¡ç”¨ä¸Šã€‚</p>
<h3 data-id="heading-29">åŸå› </h3>
<p>èŒƒå›´æŸ¥è¯¢ï¼ˆ&gt;ã€&lt;ã€BETWEENã€LIKEï¼‰ä¼šå¯¼è‡´åé¢çš„åˆ—æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚</p>
<p>å› ä¸ºåœ¨<code>b &gt; 10</code>çš„èŒƒå›´å†…ï¼Œcçš„å€¼ä¸æ˜¯æœ‰åºçš„ã€‚</p>
<h3 data-id="heading-30">ä¼˜åŒ–å»ºè®®</h3>
<p>æŠŠç­‰å€¼æŸ¥è¯¢çš„åˆ—æ”¾å‰é¢ï¼ŒèŒƒå›´æŸ¥è¯¢çš„åˆ—æ”¾åé¢ï¼š</p>
<pre><code class="hljs language-css" lang="css">CREATE INDEX idx_acb ON orders(<span class="hljs-selector-tag">a</span>, c, <span class="hljs-selector-tag">b</span>);
</code></pre>
<h2 data-id="heading-31">ä¸ƒã€NOT INå’ŒNOT EXISTS</h2>
<h3 data-id="heading-32">ç¤ºä¾‹</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> user_id <span class="hljs-keyword">FROM</span> blacklist);
</code></pre>
<h3 data-id="heading-33">æƒ…å†µ</h3>
<ul>
<li><code>IN</code>é€šå¸¸å¯ä»¥ç”¨ç´¢å¼•</li>
<li><code>NOT IN</code>æŸäº›æƒ…å†µä¼šå¯¼è‡´å…¨è¡¨æ‰«æ</li>
</ul>
<h3 data-id="heading-34">ä¼˜åŒ–</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç”¨LEFT JOINæ›¿ä»£</span>
<span class="hljs-keyword">SELECT</span> u.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users u 
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> blacklist b <span class="hljs-keyword">ON</span> u.id <span class="hljs-operator">=</span> b.user_id 
<span class="hljs-keyword">WHERE</span> b.user_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;
</code></pre>
<h2 data-id="heading-35">å…«ã€ä½¿ç”¨!=æˆ–&lt;&gt;</h2>
<h3 data-id="heading-36">ç¤ºä¾‹</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">!=</span> <span class="hljs-number">1</span>;
</code></pre>
<h3 data-id="heading-37">æƒ…å†µ</h3>
<p>ä¸ç­‰äºæŸ¥è¯¢<strong>æœ‰æ—¶å€™</strong>ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆï¼Œå–å†³äºæ•°æ®åˆ†å¸ƒã€‚</p>
<p>å¦‚æœ<code>status != 1</code>çš„æ•°æ®å å¤§å¤šæ•°ï¼ŒMySQLå¯èƒ½è®¤ä¸ºå…¨è¡¨æ‰«ææ›´å¿«ã€‚</p>
<h3 data-id="heading-38">å»ºè®®</h3>
<p>ç”¨EXPLAINçœ‹å®é™…æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚æœæ•°æ®åˆ†å¸ƒåˆé€‚ï¼Œå¯ä»¥æ”¹æˆï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-keyword">IN</span> (<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>);
</code></pre>
<h2 data-id="heading-39">ä¹ã€IS NULLçš„æƒ…å†µ</h2>
<h3 data-id="heading-40">è€ç‰ˆæœ¬MySQL</h3>
<p><code>IS NULL</code>å¯èƒ½å¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</p>
<h3 data-id="heading-41">MySQL 5.7+</h3>
<p><code>IS NULL</code>å¯ä»¥ä½¿ç”¨ç´¢å¼•ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> phone <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;  <span class="hljs-comment">-- å¯ä»¥ç”¨ç´¢å¼•</span>
</code></pre>
<h3 data-id="heading-42">å»ºè®®</h3>
<ul>
<li>å°½é‡ä¸è¦ç”¨NULLï¼Œç”¨é»˜è®¤å€¼ä»£æ›¿</li>
<li>å¦‚æœå¿…é¡»ç”¨NULLï¼Œç¡®ä¿MySQLç‰ˆæœ¬è¾ƒæ–°</li>
</ul>
<h2 data-id="heading-43">åã€ORDER BYæ²¡ç”¨ä¸Šç´¢å¼•</h2>
<h3 data-id="heading-44">è”åˆç´¢å¼•</h3>
<pre><code class="hljs language-css" lang="css">CREATE INDEX idx_abc ON orders(<span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">b</span>, c);
</code></pre>
<h3 data-id="heading-45">èƒ½ç”¨ç´¢å¼•æ’åºçš„</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">ORDER</span> BY <span class="hljs-selector-tag">a</span>
<span class="hljs-attribute">ORDER</span> BY <span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">b</span>
<span class="hljs-attribute">ORDER</span> BY <span class="hljs-selector-tag">a</span>, <span class="hljs-selector-tag">b</span>, c
<span class="hljs-attribute">ORDER</span> BY <span class="hljs-selector-tag">a</span> DESC, <span class="hljs-selector-tag">b</span> DESC, c DESC  -- æ–¹å‘ä¸€è‡´
</code></pre>
<h3 data-id="heading-46">ä¸èƒ½ç”¨ç´¢å¼•æ’åºçš„</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">ORDER</span> BY <span class="hljs-selector-tag">b</span>                -- æ²¡æœ‰<span class="hljs-selector-tag">a</span>
<span class="hljs-attribute">ORDER</span> BY <span class="hljs-selector-tag">a</span> ASC, <span class="hljs-selector-tag">b</span> DESC    -- æ–¹å‘ä¸ä¸€è‡´
<span class="hljs-attribute">ORDER</span> BY <span class="hljs-selector-tag">a</span>, c             -- è·³è¿‡äº†<span class="hljs-selector-tag">b</span>
</code></pre>
<h2 data-id="heading-47">æ’æŸ¥ç´¢å¼•é—®é¢˜çš„æµç¨‹</h2>
<ol>
<li><strong>EXPLAINçœ‹æ‰§è¡Œè®¡åˆ’</strong></li>
</ol>
<ul>
<li>
<p><code>type</code>ï¼šALLæ˜¯å…¨è¡¨æ‰«æï¼Œref/range/constæ˜¯ç”¨äº†ç´¢å¼•</p>
</li>
<li>
<p><code>key</code>ï¼šå®é™…ä½¿ç”¨çš„ç´¢å¼•</p>
</li>
<li>
<p><code>rows</code>ï¼šé¢„ä¼°æ‰«æè¡Œæ•°</p>
</li>
</ul>
<ol>
<li><strong>çœ‹possible_keyså’Œkey</strong></li>
</ol>
<ul>
<li>
<p><code>possible_keys</code>æœ‰å€¼ä½†<code>key</code>æ˜¯NULLï¼šç´¢å¼•å­˜åœ¨ä½†æ²¡ç”¨ä¸Š</p>
</li>
</ul>
<ol>
<li><strong>å¼€å¯<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhida.zhihu.com%2Fsearch%3Fcontent_id%3D267770443%26content_type%3DArticle%26match_order%3D1%26q%3Doptimizer_trace%26zhida_source%3Dentity" target="_blank" title="https://zhida.zhihu.com/search?content_id=267770443&amp;content_type=Article&amp;match_order=1&amp;q=optimizer_trace&amp;zhida_source=entity" ref="nofollow noopener noreferrer">optimizer_trace</a></strong><br/>
SET optimizer_trace = 'enabled=on'; SELECT * FROM orders WHERE ...; SELECT * FROM information_schema.optimizer_trace\G<br/>
å¯ä»¥çœ‹åˆ°MySQLä¸ºä»€ä¹ˆé€‰æ‹©äº†æŸä¸ªæ‰§è¡Œè®¡åˆ’ã€‚</li>
</ol>
<h2 data-id="heading-48">æ€»ç»“</h2>
<p>ç´¢å¼•å¤±æ•ˆçš„å¸¸è§åŸå› ï¼š</p>








































<table><thead><tr><th>åŸå› </th><th>ç¤ºä¾‹</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>å¯¹ç´¢å¼•åˆ—åšå‡½æ•°</td><td>WHERE YEAR(date)=2024</td><td>æ”¹æˆèŒƒå›´æŸ¥è¯¢</td></tr><tr><td>éšå¼ç±»å‹è½¬æ¢</td><td>WHERE phone=138xxx(æ•°å­—)</td><td>ç±»å‹åŒ¹é…</td></tr><tr><td>LIKE %å¼€å¤´</td><td>WHERE name LIKE '%xxx'</td><td>æ”¹å‰ç¼€æˆ–ç”¨ES</td></tr><tr><td>ORéƒ¨åˆ†æ— ç´¢å¼•</td><td>WHERE a=1 OR b=2</td><td>éƒ½åŠ ç´¢å¼•æˆ–UNION</td></tr><tr><td>æœ€å·¦å‰ç¼€</td><td>è”åˆç´¢å¼•(a,b,c)æŸ¥WHERE b=1</td><td>è°ƒæ•´ç´¢å¼•æˆ–æŸ¥è¯¢</td></tr><tr><td>èŒƒå›´æŸ¥è¯¢åçš„åˆ—</td><td>WHERE a&gt;1 AND b=2</td><td>è°ƒæ•´ç´¢å¼•é¡ºåº</td></tr></tbody></table>
<p><strong>è®°ä½</strong>ï¼šå†™å®ŒSQLå…ˆEXPLAINï¼Œå…»æˆä¹ æƒ¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Offstage / Visibilityï¼šä¸å¯è§çœŸçš„å°±ä¸æ¶ˆè€—æ€§èƒ½å—]]></title>    <link>https://juejin.cn/post/7592710766009581578</link>    <guid>https://juejin.cn/post/7592710766009581578</guid>    <pubDate>2026-01-08T06:46:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592710766009581578" data-draft-id="7592610104441815050" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Offstage / Visibilityï¼šä¸å¯è§çœŸçš„å°±ä¸æ¶ˆè€—æ€§èƒ½å—"/> <meta itemprop="keywords" content="Flutter,å‰ç«¯,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2026-01-08T06:46:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RaidenLiu"/> <meta itemprop="url" content="https://juejin.cn/user/1781679670965208"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Offstage / Visibilityï¼šä¸å¯è§çœŸçš„å°±ä¸æ¶ˆè€—æ€§èƒ½å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1781679670965208/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RaidenLiu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:46:33.000Z" title="Thu Jan 08 2026 06:46:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ Flutter å¼€å‘ä¸­ï¼Œå½“æˆ‘ä»¬éœ€è¦æ§åˆ¶æŸäº› widget çš„å¯è§åº¦æ—¶ï¼Œå¸¸å¸¸ä¼šç”¨åˆ° Offstage å’Œ Visibilityã€‚ç”šè‡³æœ‰ä¸€å¥æµä¼ å¾—å¾ˆå¹¿çš„è¯ï¼šâ€œåªè¦ widget ä¸å¯è§ï¼Œå®ƒå°±ä¸ä¼šæ¶ˆè€—æ€§èƒ½ã€‚â€</p>
<p>ä½†äº‹å®çœŸçš„è¿™ä¹ˆç®€å•å—ï¼Ÿæœ¬æ–‡å¸¦ä½ ä»åŸç†ã€æ€§èƒ½è¡Œä¸ºåˆ°å®é™…é€‚ç”¨åœºæ™¯åšä¸€ä¸ªç³»ç»Ÿæ€§çš„åˆ†æã€‚</p>
<h2 data-id="heading-0"><strong>1. Offstage ä¸ Visibility åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</strong></h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44fa978bdf4642b7b928fe6b31b803bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUmFpZGVuTGl1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768459593&amp;x-signature=mJm8ePm3fcXcWZffE5iMaXbpBrk%3D" alt="3.jpg" loading="lazy"/></p>
<h3 data-id="heading-1"><strong>Offstage</strong></h3>
<p>Offstage çš„ä½œç”¨æ˜¯ï¼š<strong>å°† widget éšè—èµ·æ¥ï¼Œä½†ä»ç„¶ä¿ç•™åœ¨ widget æ ‘ä¸­</strong>ï¼Œå¹¶ä¸”ä¸è¿›è¡Œç»˜åˆ¶ï¼Œè€Œä¸”å®ƒä¸å ç”¨å¸ƒå±€ç©ºé—´ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼š</p>
<ul>
<li>å­ widget ä»ç„¶å‚ä¸ widget æ ‘å’Œ render æ ‘çš„æ„å»ºï¼›</li>
<li>åœ¨ç»˜åˆ¶é˜¶æ®µä¸ä¼š paint è¿™ä¸ª widgetï¼›</li>
<li>ä½†ä¸€äº›å†…éƒ¨æœºåˆ¶ï¼ˆå¦‚åŠ¨ç”»ã€çŠ¶æ€æ›´æ–°ç­‰ï¼‰ä¾ç„¶åœ¨è¿è¡Œã€‚</li>
</ul>
<p>æ¢å¥è¯è¯´ï¼šOffstage å¹¶ä¸æ˜¯æŠŠ widget ç§»é™¤ï¼Œè€Œæ˜¯è®©å®ƒâ€œä¸åœ¨è§†é‡å†…â€</p>
<p><em>ä¸å† layout / paint</em></p>
<h3 data-id="heading-2"><strong>Visibility</strong></h3>
<p>Visibility æ›´åƒä¸€ä¸ªæ›´é«˜çº§ã€æ›´çµæ´»çš„æ§åˆ¶å™¨ã€‚å®ƒå¯ä»¥æ ¹æ®å„ç§é…ç½®æ§åˆ¶ widget æ˜¯å¦æ˜¾ç¤ºï¼š</p>
<ul>
<li>ä½ å¯ä»¥é€‰æ‹©éšè—ä½† <em>ä»ä¿ç•™åŸæœ¬çš„ç©ºé—´</em>ï¼›</li>
<li>ä¹Ÿå¯ä»¥é€‰æ‹©éšè—å¹¶ <em>ä¿ç•™çŠ¶æ€ä½†ä¸å ç©ºé—´</em>ï¼›</li>
<li>æˆ–è€…ä¸ä¿ç•™çŠ¶æ€ã€ç›´æ¥è®© widget ä¸å­˜åœ¨ã€‚</li>
</ul>
<p>Visibility çš„å†…éƒ¨æœºåˆ¶å…¶å®æ˜¯ï¼š</p>
<p>æ ¹æ®å±æ€§ä¸åŒç»„åˆ Offstage, Opacity, IgnorePointer, SizedBox æ›¿æ¢ç­‰å¤šä¸ª widgetã€‚</p>
<p>è¿™æ„å‘³ç€ Visibility çš„è¡Œä¸ºå…¶å®æ¯”æˆ‘ä»¬æƒ³è±¡å¾—è¦å¤æ‚ä¸€äº›ã€‚</p>
<hr/>
<h2 data-id="heading-3"><strong>2. â€œä¸å¯è§å°±ä¸æ¶ˆè€—æ€§èƒ½â€â€”â€”è¿™å¥è¯å¸¸å¸¸è¢«è¯¯è§£</strong></h2>
<p>ç°åœ¨æ¥å›ç­”æ ¸å¿ƒé—®é¢˜ï¼š</p>
<blockquote>
<p>widget ä¸å¯è§äº†ï¼Œå°±çœŸçš„ä¸å†æ¶ˆè€—æ€§èƒ½äº†å—ï¼Ÿ</p>
</blockquote>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>ä¸ä¸€å®šã€‚</strong></p>
<hr/>
<h3 data-id="heading-4"><strong>Offstage çš„æ€§èƒ½è¡Œä¸º</strong></h3>
<p>è™½ç„¶ Offstage ä¼šè·³è¿‡å¸ƒå±€å’Œç»˜åˆ¶ï¼Œä½†ï¼š</p>
<p>å®ƒä»ç„¶ä¼š <em>æ„å»º widget æ ‘</em> å’Œ <em>ç»´æŠ¤çŠ¶æ€</em>ã€‚</p>
<p>è¿˜åœ¨æ‰§è¡ŒçŠ¶æ€å˜æ›´ã€åŠ¨ç”»ã€è®¡æ—¶å™¨ç­‰é€»è¾‘ã€‚</p>
<p>æ¢è€Œè¨€ä¹‹ï¼šå¦‚æœä½ ç”¨ Offstage éšè—çš„ widget é‡Œé¢ä»æœ‰åŠ¨ç”»ã€Timerã€StreamBuilder ç­‰é€»è¾‘ï¼Œå®ƒä»¬ä»ç„¶ä¼šæ¶ˆè€— CPU ç”šè‡³ç”µé‡ã€‚</p>
<p>è¿™å¯èƒ½å’Œä½ é¢„æƒ³çš„â€œä¸æ¶ˆè€—æ€§èƒ½â€å®Œå…¨ä¸ä¸€æ ·ã€‚</p>
<hr/>
<h3 data-id="heading-5"><strong>Visibility çš„æƒ…å†µæ›´å¤æ‚</strong></h3>
<p>Visibility æ˜¯ä¸€ä¸ªå°è£…ç»„ä»¶ï¼Œä¸åŒè®¾ç½®ä¼šå¯¼è‡´ä¸åŒç»“æœï¼š</p>
<p>å¦‚æœä½ åªæ˜¯è®© visible: falseï¼Œå¹¶ä¸ç»´æŠ¤çŠ¶æ€ï¼Œwidget ä¼šè¢«æ›¿æ¢æˆä¸€ä¸ª SizedBoxã€‚</p>
<p>å¦‚æœä½ ç”¨äº† maintainState: trueï¼ˆç‰¹å®šåœºæ™¯ä¸‹æ‰‹åŠ¨è®¾ç½®ï¼‰ï¼Œè¿™ä¸ª widget <strong>ä»æ—§ä¼šæ„å»ºã€layoutã€ç”šè‡³å¯èƒ½ repaint</strong>ï¼ˆå–å†³äº Flutter ç®¡çº¿å’ŒçŠ¶æ€ï¼‰ã€‚</p>
<p>æ‰€ä»¥ï¼šä¸å¯è§ä¸ç­‰äºâ€œåœæ­¢æ„å»ºæˆ–åœæ­¢å“åº”é€»è¾‘â€ã€‚è¿™å¥è¯æˆç«‹çš„æ¡ä»¶åªæœ‰åœ¨ widget çœŸæ­£ä»æ ‘ä¸­</p>
<p>è¢«ç§»é™¤</p>
<hr/>
<h2 data-id="heading-6"><strong>3. æ€§èƒ½å¸¸è§è¯¯åŒº &amp; å¦‚ä½•æ­£ç¡®åˆ¤æ–­</strong></h2>
<h3 data-id="heading-7"><strong>è¯¯åŒº 1ï¼šVisibility(visible: false)æ€»æ˜¯æ€§èƒ½æœ€ä¼˜</strong></h3>
<p>è¿™æ˜¯å¤§å®¶æœ€å®¹æ˜“çŠ¯çš„é”™è¯¯ã€‚</p>
<p>è™½ç„¶è®© widget ä¸æ˜¾ç¤ºäº†ï¼Œä½†ï¼š</p>
<p>ä½ å¯èƒ½è¿˜åœ¨å¼ºåˆ¶ä¿ç•™å°ºå¯¸ç©ºé—´</p>
<p>ä½ å¯èƒ½è¿˜ä¿ç•™çŠ¶æ€/åŠ¨ç”»</p>
<p>ä½ å¯èƒ½è®©æ•´ä¸ª widget ä»ç„¶ build</p>
<p>è¿™äº›éƒ½ä¼šå¸¦æ¥æ€§èƒ½å¼€é”€ã€‚</p>
<p>å®é™…ä¸Šï¼š</p>
<p>åœ¨æ€§èƒ½æ•æ„Ÿåœºæ™¯ä¸‹ï¼Œæœ€è½»é‡çš„æ–¹æ¡ˆå¯èƒ½æ˜¯ç›´æ¥ç”¨æ¡ä»¶åˆ¤æ–­æŠŠ widget ä»æ ‘ä¸Šç§»é™¤ï¼š</p>
<p>if (condition) widget else SizedBox()</p>
<p>è¿™ç§æ–¹å¼ä¸ä¼šäº§ç”Ÿé¢å¤–ç»˜åˆ¶å’Œæ¸²æŸ“é€»è¾‘ã€‚</p>
<hr/>
<h3 data-id="heading-8"><strong>è¯¯åŒº 2ï¼šOffstage å°±æ˜¯æœ€è½»é‡çš„ä¸æ¶ˆè€—æ€§èƒ½</strong></h3>
<p>å¦‚å‰é¢è¯´çš„ï¼Œ<strong>Offstage åªè·³è¿‡ç»˜åˆ¶ï¼Œä½†ä¸ä¼šåœæ­¢æ„å»ºå’ŒçŠ¶æ€é€»è¾‘</strong>ã€‚</p>
<p>å¦‚æœå†…éƒ¨æœ‰å¤æ‚å­æ ‘ã€çŠ¶æ€é€»è¾‘ä»æ‰§è¡Œï¼Œå®ƒä¾ç„¶ä¼šæ¶ˆè€— CPUã€‚</p>
<hr/>
<h2 data-id="heading-9"><strong>4. åœ¨æ€§èƒ½ä¼˜åŒ–ä¸­ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ Offstage / Visibility</strong></h2>
<h3 data-id="heading-10"><strong>æ¨èä½¿ç”¨ Offstage çš„åœºæ™¯</strong></h3>
<p>ä½ éœ€è¦éšè— widget ä¸” <em>ä¸å ç©ºé—´</em></p>
<p>widget é‡Œé¢æ²¡æœ‰éœ€è¦åœæ­¢çš„é€»è¾‘ï¼ˆä¾‹å¦‚åŠ¨ç”»ã€è®¡æ—¶å™¨ç­‰ï¼‰<strong>Offstage</strong> æœ¬èº«ä¸ä¼šåœæ­¢åŠ¨ç”»çš„ <strong>Ticker</strong>ã€‚å¦‚æœä½ éšè—äº†ä¸€ä¸ªå¸¦ CircularProgressIndicator çš„ç»„ä»¶ï¼Œè™½ç„¶ä½ çœ‹ä¸åˆ°å®ƒï¼Œä½† CPU ä¾ç„¶åœ¨æ¯ä¸€å¸§è®¡ç®—æ—‹è½¬è§’åº¦ã€‚</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">import</span> '<span class="hljs-selector-tag">package</span>:<span class="hljs-selector-tag">flutter</span>/<span class="hljs-selector-tag">material</span><span class="hljs-selector-class">.dart</span>';

<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">PerformanceOptimizationDemo</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">StatefulWidget</span> {
  <span class="hljs-variable">@override</span>
  _PerformanceOptimizationDemoState <span class="hljs-built_in">createState</span>() =&gt; <span class="hljs-built_in">_PerformanceOptimizationDemoState</span>();
}

<span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">_PerformanceOptimizationDemoState</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">State</span>&lt;<span class="hljs-selector-tag">PerformanceOptimizationDemo</span>&gt; {
  <span class="hljs-selector-tag">bool</span> <span class="hljs-selector-tag">_isOffstage</span> = <span class="hljs-selector-tag">false</span>;

  @<span class="hljs-selector-tag">override</span>
  <span class="hljs-selector-tag">Widget</span> <span class="hljs-selector-tag">build</span>(BuildContext context) {
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Scaffold</span>(
      <span class="hljs-attribute">appBar</span>: <span class="hljs-built_in">AppBar</span>(<span class="hljs-attribute">title</span>: <span class="hljs-built_in">Text</span>(<span class="hljs-string">"TickerMode æ€§èƒ½ä¼˜åŒ–ç¤ºä¾‹"</span>)),
      <span class="hljs-attribute">body</span>: <span class="hljs-built_in">Center</span>(
        <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Column</span>(
          <span class="hljs-attribute">mainAxisAlignment</span>: MainAxisAlignment.center,
          <span class="hljs-attribute">children</span>: [
            <span class="hljs-comment">// ä½¿ç”¨ TickerMode åŒ…è£¹ Offstage</span>
            <span class="hljs-built_in">TickerMode</span>(
              <span class="hljs-attribute">enabled</span>: !_isOffstage, <span class="hljs-comment">// å½“ offstage ä¸º true æ—¶ï¼Œç¦ç”¨ Ticker</span>
              <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Offstage</span>(
                <span class="hljs-attribute">offstage</span>: _isOffstage,
                <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Column</span>(
                  <span class="hljs-attribute">children</span>: [
                    <span class="hljs-built_in">CircularProgressIndicator</span>(),
                    <span class="hljs-built_in">SizedBox</span>(<span class="hljs-attribute">height</span>: <span class="hljs-number">10</span>),
                    <span class="hljs-built_in">Text</span>(<span class="hljs-string">"åŠ¨ç”»æ­£åœ¨è¿è¡Œ..."</span>),
                  ],
                ),
              ),
            ),
            
            <span class="hljs-built_in">SizedBox</span>(<span class="hljs-attribute">height</span>: <span class="hljs-number">50</span>),
            
            <span class="hljs-built_in">ElevatedButton</span>(
              <span class="hljs-attribute">onPressed</span>: () {
                <span class="hljs-built_in">setState</span>(() {
                  _isOffstage = !_isOffstage;
                });
              },
              <span class="hljs-attribute">child</span>: <span class="hljs-built_in">Text</span>(_isOffstage ? <span class="hljs-string">"æ˜¾ç¤ºå¹¶æ¢å¤åŠ¨ç”»"</span> : <span class="hljs-string">"éšè—å¹¶å†»ç»“åŠ¨ç”»"</span>),
            ),
          ],
        ),
      ),
    );
  }
}
</code></pre>
<p>æƒ³ä¿æŒ widget çŠ¶æ€ä½†ä¸æ˜¾ç¤ºå®ƒï¼ˆåœ¨æ­é… TickerMode æ—¶æ›´æœ‰æ„ä¹‰ï¼‰</p>
<p>æ¯”å¦‚ï¼šåˆ‡æ¢ tab æ—¶æš‚æ—¶éšè—æŸä¸ª tab çš„å†…å®¹ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šå¦‚æœéšè—çš„ widget æœ‰åŠ¨ç”»æˆ–é€»è¾‘ä¾ç„¶åœ¨æ‰§è¡Œï¼Œå¯ä»¥è€ƒè™‘é…åˆ TickerMode(enabled: false) ä¸€èµ·æŠ‘åˆ¶æ‰§è¡Œã€‚</p>
<hr/>
<h3 data-id="heading-11"><strong>æ¨èä½¿ç”¨ Visibility çš„åœºæ™¯</strong></h3>
<p>æ§åˆ¶æ˜¾éšåŒæ—¶å¸Œæœ›ï¼š</p>
<ul>
<li>ä¿æŒä½ç½®ç©ºé—´</li>
<li>ä¿æŒçŠ¶æ€</li>
<li>å¯æ§äº¤äº’è¡Œä¸º</li>
</ul>
<p>æƒ³å®ç°æ›´é«˜çº§çš„æ˜¾éšç­–ç•¥ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>åªéšè—å†…å®¹ä½†ä¿æŒå¸ƒå±€å ä½</li>
<li>éšè—æ—¶ç»´æŒæŸäº›çŠ¶æ€ç»§ç»­æœ‰æ•ˆ</li>
</ul>
<p>è¿™äº›åœ¨ UI è®¾è®¡å±‚é¢ä¸Šç¡®å®æœ‰ä½¿ç”¨ä»·å€¼ã€‚</p>
<hr/>
<h3 data-id="heading-12"><strong>ä¸å»ºè®®ä»…é å®ƒä»¬â€œæå‡æ€§èƒ½â€çš„åœºæ™¯</strong></h3>
<p>å¦‚æœä½ åªå¸Œæœ› â€œå‡å°‘é‡å»ºä¸è®¡ç®—â€ï¼Œ</p>
<p>ç®€å•çš„æ˜¾éšæœ¬èº«ä¸ä¸€å®šèƒ½è¾¾åˆ°ç›®çš„ã€‚</p>
<p>æ­¤æ—¶æ›´å¥½çš„æ–¹å¼å¯èƒ½æ˜¯ï¼š</p>
<ul>
<li>æ‡’åŠ è½½æ¡ä»¶æ¸²æŸ“</li>
<li>ä½¿ç”¨ provider / Riverpod / GetX ç²¾ç»†æ§åˆ¶ rebuild</li>
<li>ç»“åˆ keys / const / StatelessWidget é‡ç”¨æœºåˆ¶</li>
</ul>
<hr/>
<h2 data-id="heading-13"><strong>å¦‚ä½•è¡¡é‡æ˜¾éšç­–ç•¥çš„æ€§èƒ½å½±å“</strong></h2>
<h3 data-id="heading-14"><strong>Flutter DevTools &amp; Performance View</strong></h3>
<ul>
<li>ä½¿ç”¨ <strong>Performance View</strong> çœ‹å¸§æ—¶é—´ã€CPU å ç”¨</li>
<li>ä½¿ç”¨ <strong>Repaint Rainbow / Rendering Info</strong> çœ‹æ˜¯å¦è¢«ç»˜åˆ¶</li>
</ul>
<p>è¿™äº›å·¥å…·èƒ½å¸®ä½ éªŒè¯éšè—ç­–ç•¥æ˜¯å¦çœŸçš„å‡å°‘äº†å¼€é”€ã€‚</p>
<p>ä»…ä»…widget ä¸å¯è§äº†ï¼Œ<strong>æ¸²æŸ“ç®¡çº¿å¯èƒ½ä¾ç„¶åœ¨æ‰§è¡Œ</strong>ã€‚æ‰€ä»¥éœ€è¦å¯è§†åŒ–æ•°æ®åšåˆ¤æ–­ã€‚</p>
<hr/>
<h2 data-id="heading-15"><strong>æ€»ç»“ï¼šä¸å¯è§ â‰  ä¸æ¶ˆè€—æ€§èƒ½</strong></h2>








































<table><thead><tr><th><strong>æœºåˆ¶</strong></th><th><strong>æ˜¯å¦ layout</strong></th><th><strong>æ˜¯å¦ paint</strong></th><th><strong>æ˜¯å¦æ„å»º</strong></th><th><strong>çŠ¶æ€ &amp; åŠ¨ç”»è¿è¡Œ</strong></th></tr></thead><tbody><tr><td>Offstage (offstage: true)</td><td>âŒ</td><td>âŒ</td><td>âœ…</td><td>âœ… (ä»è¿è¡Œ)</td></tr><tr><td>Visibility (visible: false, no maintain)</td><td>âŒ</td><td>âŒ</td><td>âŒ</td><td>âŒ</td></tr><tr><td>Visibility (visible: false, maintainState:true)</td><td>âŒ</td><td>âŒ</td><td>âœ…</td><td>å¯èƒ½ç»§ç»­è¿è¡Œ</td></tr><tr><td>æ¡ä»¶ç§»é™¤ (if/else)</td><td>âŒ</td><td>âŒ</td><td>âŒ</td><td>âŒ</td></tr></tbody></table>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React useMemo å¤§ç™½è¯ç”¨æ³•æ–‡æ¡£ï¼ˆå«æ³¨æ„é¡¹ï¼‰]]></title>    <link>https://juejin.cn/post/7592765004806684723</link>    <guid>https://juejin.cn/post/7592765004806684723</guid>    <pubDate>2026-01-08T06:57:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592765004806684723" data-draft-id="7592710766009417738" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React useMemo å¤§ç™½è¯ç”¨æ³•æ–‡æ¡£ï¼ˆå«æ³¨æ„é¡¹ï¼‰"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-08T06:57:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤å¤©çš„é£æŠšè¿‡è€³è†œ"/> <meta itemprop="url" content="https://juejin.cn/user/1319870834942269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React useMemo å¤§ç™½è¯ç”¨æ³•æ–‡æ¡£ï¼ˆå«æ³¨æ„é¡¹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1319870834942269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤å¤©çš„é£æŠšè¿‡è€³è†œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:57:32.000Z" title="Thu Jan 08 2026 06:57:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="arduino-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#434f54}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-name,.hljs-selector-tag{color:#00979d}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code,.hljs-literal{color:#d35400}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#00979d}.hljs-deletion,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#005c5f}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-comment{color:rgba(149,165,166,.8)}.hljs-meta-keyword{color:#728e00}.hljs-meta{color:#434f54}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-function{color:#728e00}.hljs-number{color:#8a7b52}</style><h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒæ¦‚å¿µ</h2>
<h3 data-id="heading-1">1. useMemo åˆ°åº•æ˜¯å•¥ï¼Ÿ</h3>
<p>å¤§ç™½è¯ï¼š<code>useMemo</code> æ˜¯ React çš„ â€œè®¡ç®—ç»“æœç¼“å­˜å·¥å…·â€â€”â€” ç»™å®ƒä¸€ä¸ª â€œè´¹æ—¶é—´çš„è®¡ç®—é€»è¾‘â€ å’Œ â€œä¾èµ–é¡¹åˆ—è¡¨â€ï¼Œå®ƒä¼šæŠŠè®¡ç®—ç»“æœå­˜èµ·æ¥ï¼ˆç¼“å­˜ï¼‰ï¼›åªæœ‰ä¾èµ–é¡¹å˜äº†ï¼Œæ‰é‡æ–°è®¡ç®—ï¼›ä¾èµ–é¡¹æ²¡å˜ï¼Œç›´æ¥è¿”å›ç¼“å­˜çš„ç»“æœï¼Œé¿å…é‡å¤åšæ— ç”¨åŠŸã€‚</p>
<p>ç”Ÿæ´»æ¯”å–»ï¼šå°±åƒä½ ç®—å®Œ â€œå…¨å®¶æœˆå¼€é”€â€ åï¼ŒæŠŠæ€»æ•°å†™åœ¨çº¸ä¸Šï¼ˆç¼“å­˜ï¼‰ï¼›åªè¦æ²¡æ–°å¢æ¶ˆè´¹ï¼ˆä¾èµ–é¡¹æ²¡å˜ï¼‰ï¼Œä¸‹æ¬¡è¦ç”¨åˆ°æ—¶ç›´æ¥çœ‹çº¸å°±è¡Œï¼Œä¸ç”¨å†æŠŠæ‰€æœ‰è´¦å•åŠ ä¸€éã€‚</p>
<h2 data-id="heading-2">äºŒã€ç”¨æ³•æ ¼å¼ï¼ˆ3 æ­¥æå®šï¼‰</h2>
<h3 data-id="heading-3">1. åŸºç¡€æ ¼å¼</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// ç¼“å­˜è®¡ç®—ç»“æœ</span>
<span class="hljs-keyword">const</span> ç¼“å­˜çš„ç»“æœ = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ç¬¬ä¸€æ­¥ï¼šå†™éœ€è¦ç¼“å­˜çš„è®¡ç®—é€»è¾‘ï¼ˆæ¯”å¦‚å¤§æ•°ç»„å¤„ç†ã€å¤æ‚è¿ç®—ï¼‰</span>
  <span class="hljs-keyword">return</span> å¤æ‚è®¡ç®—çš„ç»“æœ;
}, [ä¾èµ–é¡¹<span class="hljs-number">1</span>, ä¾èµ–é¡¹<span class="hljs-number">2</span>]); <span class="hljs-comment">// ç¬¬äºŒæ­¥ï¼šåˆ—ä¾èµ–é¡¹ï¼ˆåªæœ‰è¿™äº›å˜äº†ï¼Œæ‰é‡æ–°è®¡ç®—ï¼‰</span>
</code></pre>
<h3 data-id="heading-4">2. å…³é”®è¯´æ˜</h3>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼š<strong>æ— å‚å›è°ƒå‡½æ•°</strong>ï¼ˆé‡Œé¢å†™è®¡ç®—é€»è¾‘ï¼‰ï¼ŒuseMemo ä¼šè‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œç¼“å­˜å®ƒçš„è¿”å›å€¼ï¼›</li>
<li>ç¬¬äºŒä¸ªå‚æ•°ï¼š<strong>ä¾èµ–é¡¹æ•°ç»„</strong>ï¼ˆå¿…å¡«ï¼Œå“ªæ€•æ˜¯ç©ºæ•°ç»„ï¼‰ï¼Œæ§åˆ¶æ˜¯å¦é‡æ–°è®¡ç®—ï¼›</li>
<li>è¿”å›å€¼ï¼šç¼“å­˜çš„ â€œè®¡ç®—ç»“æœâ€ï¼ˆä¸æ˜¯å‡½æ•°ï¼Œæ˜¯ç›´æ¥èƒ½ç”¨çš„å€¼ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-5">ä¸‰ã€ä»€ä¹ˆæ—¶å€™ç”¨ useMemoï¼Ÿ</h2>
<h3 data-id="heading-6">1. 3 ä¸ªæ ¸å¿ƒåœºæ™¯</h3>
<p>åªæœ‰æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œç”¨ useMemo æ‰æœ‰ç”¨ï¼Œå¦åˆ™å°±æ˜¯ â€œç”»è›‡æ·»è¶³â€ï¼š</p>
<ol>
<li>è®¡ç®—é€»è¾‘ â€œè´¹æ€§èƒ½â€ï¼šæ¯”å¦‚å¤„ç†å¤§æ•°ç»„ï¼ˆç­›é€‰ / æ’åº / æ±‚å’Œï¼‰ã€å¾ªç¯æ¬¡æ•°å¤šã€å¤æ‚æ•°å­¦è¿ç®—ï¼ˆä¸æ˜¯ <code>a + b</code> è¿™ç§ç®€å•è®¡ç®—ï¼‰ï¼›</li>
<li>ç»„ä»¶ä¼š â€œé¢‘ç¹é‡æ–°æ¸²æŸ“â€ï¼šæ¯”å¦‚æœ‰è®¡æ•°å™¨ã€è¾“å…¥æ¡†ç­‰é¢‘ç¹å˜åŒ–çš„çŠ¶æ€ï¼Œå¯¼è‡´ç»„ä»¶åå¤æ¸²æŸ“ï¼›</li>
<li>è®¡ç®—çš„ â€œä¾èµ–é¡¹ä¸å¸¸å˜â€ï¼šè®¡ç®—é€»è¾‘ä¾èµ–çš„å˜é‡ï¼ˆæ¯”å¦‚æ•°ç»„ã€å¯¹è±¡ã€æ•°å­—ï¼‰ä¸ä¼šæ¯æ¬¡æ¸²æŸ“éƒ½å˜ã€‚</li>
</ol>
<p>åä¾‹ï¼ˆä¸ç”¨ç”¨ useMemoï¼‰ï¼š</p>
<pre><code class="hljs language-css" lang="css">// é”™è¯¯ï¼šç®€å•è®¡ç®—ï¼ˆ<span class="hljs-selector-tag">a</span> + <span class="hljs-selector-tag">b</span>ï¼‰ç”¨ useMemoï¼Œåè€Œå¢åŠ ç¼“å­˜å¼€é”€ 
const sum = useMemo(() =&gt; <span class="hljs-selector-tag">a</span> + <span class="hljs-selector-tag">b</span>, <span class="hljs-selector-attr">[a, b]</span>);
</code></pre>
<h2 data-id="heading-7">å››ã€æ ¸å¿ƒç”¨æ³•æ¡ˆä¾‹ï¼ˆè´´è¿‘å®é™…å¼€å‘ï¼‰</h2>
<h3 data-id="heading-8">1. æ¡ˆä¾‹ï¼šè¡¨æ ¼æ•°æ®ç­›é€‰ + æ’åºï¼ˆç¼“å­˜å¤„ç†ç»“æœï¼‰</h3>
<p>åœºæ™¯ï¼šè¡¨æ ¼æœ‰ 1 ä¸‡æ¡æ•°æ®ï¼Œç”¨æˆ·å¯ä»¥è¾“å…¥å…³é”®è¯ç­›é€‰ã€é€‰æ‹©æ’åºæ–¹å¼ï¼Œç»„ä»¶è¿˜æœ‰ä¸€ä¸ªæ— å…³è®¡æ•°å™¨ â€”â€” åªæœ‰ç­›é€‰å…³é”®è¯ / æ’åºæ–¹å¼å˜äº†ï¼Œæ‰é‡æ–°å¤„ç†æ•°æ®ï¼›è®¡æ•°å™¨å˜äº†ï¼Œç›´æ¥ç”¨ç¼“å­˜çš„ç»“æœã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useState, useMemo } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">UseMemoTest</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. æ¨¡æ‹Ÿ1ä¸‡æ¡è¡¨æ ¼æ•°æ®ï¼ˆç»„ä»¶å¤–å®šä¹‰ï¼Œé¿å…é‡å¤åˆ›å»ºï¼‰</span>
  <span class="hljs-keyword">const</span> allData = <span class="hljs-title class_">Array</span>(<span class="hljs-number">10000</span>).<span class="hljs-title function_">fill</span>().<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({ <span class="hljs-attr">id</span>: i, <span class="hljs-attr">name</span>: <span class="hljs-string">`ç”¨æˆ·<span class="hljs-subst">${i}</span>`</span>, <span class="hljs-attr">age</span>: i % <span class="hljs-number">50</span> + <span class="hljs-number">10</span> }));
  
  <span class="hljs-comment">// 2. çŠ¶æ€ï¼ˆç­›é€‰å…³é”®è¯ã€æ’åºæ–¹å¼ã€æ— å…³è®¡æ•°å™¨ï¼‰</span>
  <span class="hljs-keyword">const</span> [searchKey, setSearchKey] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>); <span class="hljs-comment">// ç­›é€‰ä¾èµ–é¡¹</span>
  <span class="hljs-keyword">const</span> [sortType, setSortType] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">'asc'</span>); <span class="hljs-comment">// æ’åºä¾èµ–é¡¹</span>
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// æ— å…³çŠ¶æ€</span>

  <span class="hljs-comment">// 3. ç”¨ useMemo ç¼“å­˜â€œç­›é€‰+æ’åºâ€ç»“æœï¼ˆè´¹æ€§èƒ½çš„è®¡ç®—ï¼‰</span>
  <span class="hljs-keyword">const</span> processedData = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é‡æ–°å¤„ç†è¡¨æ ¼æ•°æ®ï¼'</span>); <span class="hljs-comment">// è§‚å¯Ÿè§¦å‘æ—¶æœº</span>
    <span class="hljs-comment">// æ­¥éª¤1ï¼šç­›é€‰ï¼ˆå«å…³é”®è¯çš„ç”¨æˆ·ï¼‰</span>
    <span class="hljs-keyword">const</span> filtered = allData.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> 
      item.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(searchKey)
    );
    <span class="hljs-comment">// æ­¥éª¤2ï¼šæ’åºï¼ˆå‡åº/é™åºï¼‰</span>
    <span class="hljs-keyword">const</span> sorted = filtered.<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> sortType === <span class="hljs-string">'asc'</span> ? a.<span class="hljs-property">age</span> - b.<span class="hljs-property">age</span> : b.<span class="hljs-property">age</span> - a.<span class="hljs-property">age</span>;
    });
    <span class="hljs-keyword">return</span> sorted;
  }, [searchKey]); <span class="hljs-comment">// åªä¾èµ–â€œç­›é€‰å…³é”®è¯â€å’Œâ€œæ’åºæ–¹å¼â€</span>

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* æ— å…³è®¡æ•°å™¨ï¼ˆæµ‹è¯•ç”¨ï¼‰ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;è®¡æ•°å™¨+1ï¼ˆä¸å½±å“è¡¨æ ¼ï¼‰<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è®¡æ•°å™¨ï¼š{count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

      {/* ç­›é€‰+æ’åºæ§åˆ¶ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¾“å…¥ç”¨æˆ·åç­›é€‰"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{searchKey}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setSearchKey(e.target.value)}
      /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setSortType(sortType === 'asc' ? 'desc' : 'asc')}&gt;
        åˆ‡æ¢æ’åºï¼ˆå‡/é™ï¼‰
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

      {/* è¡¨æ ¼æ¸²æŸ“ï¼ˆç”¨ç¼“å­˜çš„å¤„ç†ç»“æœï¼‰ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">table</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">thead</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>ID<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>å§“å<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">th</span>&gt;</span>å¹´é¾„<span class="hljs-tag">&lt;/<span class="hljs-name">th</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">thead</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">tbody</span>&gt;</span>
          {processedData.map(item =&gt; (
            <span class="hljs-tag">&lt;<span class="hljs-name">tr</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{item.id}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{item.name}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">td</span>&gt;</span>{item.age}<span class="hljs-tag">&lt;/<span class="hljs-name">td</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">tr</span>&gt;</span>
          ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">tbody</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">table</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-9">2. æ•ˆæœ</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d4fe9af26c1473dbe7f5c15d27a462a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSP5aSp55qE6aOO5oqa6L-H6ICz6Iac:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460253&amp;x-signature=DAei6xXlGH%2BI0QGvdc0wQmUjGKI%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>ç‚¹ â€œè®¡æ•°å™¨ + 1â€ï¼šç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œä½† <code>searchKey</code> å’Œ <code>sortType</code> æ²¡å˜ï¼Œ<code>useMemo</code> ç›´æ¥ç”¨ç¼“å­˜ï¼Œæ§åˆ¶å°ä¸æ‰“å° â€œé‡æ–°å¤„ç†è¡¨æ ¼æ•°æ®â€ï¼›</li>
<li>è¾“å…¥ç­›é€‰å…³é”®è¯ / åˆ‡æ¢æ’åºï¼šä¾èµ–é¡¹å˜äº†ï¼Œé‡æ–°å¤„ç†æ•°æ®ï¼Œæ§åˆ¶å°æ‰“å°ï¼Œè¡¨æ ¼æ›´æ–°ã€‚</li>
</ul>
<h2 data-id="heading-10">äº”ã€å…³é”®æ³¨æ„é¡¹ï¼ˆé¿å‘é‡ç‚¹ï¼ï¼‰</h2>
<h3 data-id="heading-11">1. ä¾èµ–é¡¹æ•°ç»„ï¼šä¸èƒ½æ¼ã€ä¸èƒ½å¤šã€ä¸èƒ½é”™</h3>
<ul>
<li>â¶ ä¸èƒ½æ¼å†™ä¾èµ–ï¼šè®¡ç®—é€»è¾‘ä¸­ç”¨åˆ°çš„æ‰€æœ‰å¤–éƒ¨å˜é‡ï¼Œéƒ½å¿…é¡»æ”¾è¿›ä¾èµ–æ•°ç»„ï¼Œå¦åˆ™ä¼šæ‹¿åˆ° â€œè¿‡æ—¶çš„ç¼“å­˜ç»“æœâ€ï¼›</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">processedData</span> = useMemo(() =&gt; {
  return allData.filter(...).sort((a,b) =&gt; <span class="hljs-attr">sortType</span> === <span class="hljs-string">'asc'</span> ? a.age - b.age : b.age - a.age)<span class="hljs-comment">;</span>
}, <span class="hljs-section">[searchKey]</span>)<span class="hljs-comment">; // æ¼äº† sortTypeï¼Œåˆ‡æ¢æ’åºæ—¶ä¸ä¼šé‡æ–°è®¡ç®—</span>
</code></pre>
<ul>
<li>â· ä¸èƒ½å¤šå†™æ— å…³ä¾èµ–ï¼šæŠŠä¸ç›¸å…³çš„å˜é‡æ”¾è¿›ä¾èµ–æ•°ç»„ï¼Œä¼šå¯¼è‡´ä¸å¿…è¦çš„é‡æ–°è®¡ç®—ï¼›</li>
</ul>

<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// é”™è¯¯ï¼šcount æ˜¯æ— å…³å˜é‡ï¼Œæ”¾è¿›ä¾èµ–æ•°ç»„</span>
const processedData = <span class="hljs-built_in">useMemo</span>(() =&gt; {
  return allData<span class="hljs-selector-class">.filter</span>(...)<span class="hljs-selector-class">.sort</span>(...);
}, <span class="hljs-selector-attr">[searchKey, sortType, count]</span>); <span class="hljs-comment">// ç‚¹è®¡æ•°å™¨æ—¶ä¹Ÿä¼šé‡æ–°å¤„ç†æ•°æ®</span>
</code></pre>
<ul>
<li>â¸ ç©ºä¾èµ–æ•°ç»„ï¼šå¦‚æœè®¡ç®—é€»è¾‘ä¸ä¾èµ–ä»»ä½•å˜é‡ï¼Œç”¨ <code>[]</code>ï¼Œè¡¨ç¤º â€œåªåœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶è®¡ç®—ä¸€æ¬¡ï¼Œä¹‹åæ°¸è¿œç”¨ç¼“å­˜â€ï¼›</li>
</ul>

<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> total = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> { 
    <span class="hljs-keyword">return</span> allData.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, item</span>) =&gt;</span> sum + item.<span class="hljs-property">age</span>, <span class="hljs-number">0</span>); 
    <span class="hljs-comment">// ä¸ä¾èµ–ä»»ä½•çŠ¶æ€ </span>
}, []); <span class="hljs-comment">// åªè®¡ç®—ä¸€æ¬¡</span>
</code></pre>
<h3 data-id="heading-12">2. å¼•ç”¨ç±»å‹ä¾èµ–ï¼šå¿…é¡»ä¿è¯ â€œå¼•ç”¨ä¸å˜â€</h3>
<p>æ•°ç»„ã€å¯¹è±¡ã€å‡½æ•°æ˜¯ â€œå¼•ç”¨ç±»å‹â€â€”â€” å“ªæ€•å†…å®¹æ²¡å˜ï¼Œåªè¦é‡æ–°åˆ›å»ºï¼ˆæ¯”å¦‚ç»„ä»¶å†…å®šä¹‰çš„æ•°ç»„ï¼‰ï¼Œå¼•ç”¨å°±å˜äº†ï¼ŒuseMemo ä¼šè¯¯ä»¥ä¸º â€œä¾èµ–å˜äº†â€ï¼Œé‡æ–°è®¡ç®—ã€‚</p>
<h4 data-id="heading-13">é”™è¯¯ç¤ºä¾‹ï¼ˆå¼•ç”¨ç±»å‹å¯¼è‡´æ— æ•ˆç¼“å­˜ï¼‰ï¼š</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Table</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// é”™è¯¯ï¼šç»„ä»¶æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ–°å»º allData æ•°ç»„ï¼ˆå¼•ç”¨å˜äº†ï¼‰</span>
  <span class="hljs-keyword">const</span> allData = <span class="hljs-title class_">Array</span>(<span class="hljs-number">10000</span>).<span class="hljs-title function_">fill</span>().<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({ <span class="hljs-attr">id</span>: i, <span class="hljs-attr">name</span>: <span class="hljs-string">`ç”¨æˆ·<span class="hljs-subst">${i}</span>`</span> }));

  <span class="hljs-keyword">const</span> processedData = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'é‡æ–°å¤„ç†æ•°æ®ï¼'</span>);
    <span class="hljs-keyword">return</span> allData.<span class="hljs-title function_">filter</span>(...);
  }, [allData]); <span class="hljs-comment">// æ¯æ¬¡æ¸²æŸ“ allData å¼•ç”¨éƒ½å˜ï¼Œå¯¼è‡´é¢‘ç¹é‡æ–°è®¡ç®—</span>
}
</code></pre>
<h4 data-id="heading-14">æ­£ç¡®å¤„ç†æ–¹å¼</h4>
<ul>
<li>æ–¹æ¡ˆ 1ï¼šæŠŠå¼•ç”¨ç±»å‹æ”¾åˆ°ç»„ä»¶å¤–éƒ¨ï¼ˆæ°¸ä¹…ä¸å˜ï¼‰ï¼›</li>
<li>æ–¹æ¡ˆ 2ï¼šç”¨ <code>useMemo</code> æˆ– <code>useRef</code> ç¼“å­˜å¼•ç”¨ç±»å‹ï¼›</li>
</ul>
<h3 data-id="heading-15">3. ä¸è¦æ»¥ç”¨ï¼šç®€å•è®¡ç®—ä¸ç”¨ useMemo</h3>
<p>useMemo æœ¬èº«ä¹Ÿæœ‰ â€œç¼“å­˜å¼€é”€â€ï¼ˆè¦å­˜å‚¨ç»“æœã€å¯¹æ¯”ä¾èµ–é¡¹ï¼‰ï¼Œå¦‚æœè®¡ç®—é€»è¾‘å¾ˆç®€å•ï¼ˆæ¯”å¦‚ <code>a + b</code>ã€<code>str.split(',')</code>ï¼‰ï¼Œç”¨ useMemo åè€Œä¼šé™ä½æ€§èƒ½ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">// é”™è¯¯ï¼šç®€å•è®¡ç®—ç”¨ useMemoï¼ˆæ²¡å¿…è¦ï¼‰
const <span class="hljs-attr">sum</span> = useMemo(() =&gt; a + b, [a, b])<span class="hljs-comment">;</span>
const <span class="hljs-attr">arr</span> = useMemo(() =&gt; str.split(<span class="hljs-string">','</span>), [str])<span class="hljs-comment">;</span>

// æ­£ç¡®ï¼šç›´æ¥è®¡ç®—
const <span class="hljs-attr">sum</span> = a + b<span class="hljs-comment">;</span>
const <span class="hljs-attr">arr</span> = str.split(<span class="hljs-string">','</span>)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-16">4. åªç¼“å­˜ â€œè®¡ç®—ç»“æœâ€ï¼Œä¸ç¼“å­˜ â€œå‡½æ•° / å‰¯ä½œç”¨â€</h3>
<ul>
<li>useMemo æ˜¯ç”¨æ¥ç¼“å­˜ â€œçº¯è®¡ç®—ç»“æœâ€ çš„ï¼ˆæ²¡æœ‰å‰¯ä½œç”¨ï¼šä¸å‘è¯·æ±‚ã€ä¸ä¿®æ”¹ DOMã€ä¸æ›´æ–°çŠ¶æ€ï¼‰ï¼›</li>
<li>å¦‚æœè¦ç¼“å­˜ â€œå‡½æ•°â€ï¼Œç”¨ <code>useCallback</code>ï¼ˆå’Œ useMemo ç±»ä¼¼ï¼Œä½†ä¸“é—¨ç¼“å­˜å‡½æ•°ï¼‰ï¼›</li>
<li>å¦‚æœè¦åš â€œå‰¯ä½œç”¨â€ï¼ˆå‘è¯·æ±‚ã€å¼¹æç¤ºï¼‰ï¼Œç”¨ <code>useEffect</code>ï¼Œä¸è¦ç”¨ useMemoã€‚</li>
</ul>

<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// é”™è¯¯ï¼šç”¨ useMemo åšå‰¯ä½œç”¨ï¼ˆå‘è¯·æ±‚ï¼‰</span>
<span class="hljs-built_in">useMemo</span>(() =&gt; {
  <span class="hljs-built_in">fetch</span>('/api/data')<span class="hljs-selector-class">.then</span>(res =&gt; res.json()); <span class="hljs-comment">// å‰¯ä½œç”¨ï¼Œä¸åº”è¯¥ç”¨ useMemo</span>
}, <span class="hljs-selector-attr">[searchKey]</span>);

<span class="hljs-comment">// æ­£ç¡®ï¼šå‰¯ä½œç”¨ç”¨ useEffect</span>
<span class="hljs-built_in">useEffect</span>(() =&gt; {
  <span class="hljs-built_in">fetch</span>('/api/data')<span class="hljs-selector-class">.then</span>(res =&gt; res.json());
}, <span class="hljs-selector-attr">[searchKey]</span>);
</code></pre>
<h3 data-id="heading-17">5. React ç‰ˆæœ¬æ³¨æ„ï¼šuseMemo ä¸æ˜¯ â€œé“æ‰“çš„ç¼“å­˜â€</h3>
<ul>
<li>
<p>useMemo çš„ç¼“å­˜æ˜¯ â€œå¯é€‰çš„â€â€”â€”React åœ¨å†…å­˜ç´§å¼ æ—¶ï¼Œå¯èƒ½ä¼šä¸¢å¼ƒç¼“å­˜ï¼Œä¸‹æ¬¡æ¸²æŸ“é‡æ–°è®¡ç®—ï¼ˆè¿™ç§æƒ…å†µæå°‘ï¼‰ï¼›</p>
</li>
<li>
<p>ä¸è¦ä¾èµ– useMemo ç¼“å­˜ â€œå¿…é¡»å”¯ä¸€â€ çš„å€¼ï¼ˆæ¯”å¦‚å”¯ä¸€ IDã€è¯·æ±‚ç»“æœï¼‰ï¼Œå¦‚æœéœ€è¦å¼ºåˆ¶ç¼“å­˜ï¼Œç”¨ <code>useRef</code>ã€‚</p>
</li>
</ul>
<h2 data-id="heading-18">å…­ã€å¸¸è§é”™è¯¯å¯¹æ¯”ï¼ˆé¿å‘æŒ‡å—ï¼‰</h2>

























<table><thead><tr><th>é”™è¯¯ç”¨æ³•</th><th>é”™è¯¯åŸå› </th></tr></thead><tbody><tr><td><code>useMemo((nums) =&gt; nums.reduce(...), [userNumbers])</code></td><td>ç»™å›è°ƒå‡½æ•°åŠ äº†å‚æ•°ï¼ŒuseMemo ä¸ä¼šä¼ å€¼ï¼Œå‚æ•°æ˜¯ undefined</td></tr><tr><td><code>useMemo(() =&gt; { fetch('/api'); }, [searchKey])</code></td><td>ç”¨ useMemo åšå‰¯ä½œç”¨ï¼ˆå‘è¯·æ±‚ï¼‰</td></tr><tr><td><code>useMemo(() =&gt; a + b, [a, b])</code></td><td>ç®€å•è®¡ç®—æ»¥ç”¨ useMemo</td></tr><tr><td><code>useMemo(() =&gt; { ... }, [])</code> ä½†è®¡ç®—ä¾èµ–å¤–éƒ¨å˜åŒ–çš„å˜é‡</td><td>æ¼å†™ä¾èµ–é¡¹ï¼Œå¯¼è‡´æ‹¿åˆ°è¿‡æ—¶ç»“æœ</td></tr></tbody></table>
<h2 data-id="heading-19">ä¸ƒã€æ€»ç»“ï¼ˆ4 å¥è¯è®°ç‰¢ï¼‰</h2>
<ol>
<li>æ ¸å¿ƒåŠŸèƒ½ï¼šç¼“å­˜ â€œè´¹æ€§èƒ½çš„è®¡ç®—ç»“æœâ€ï¼Œå‡å°‘é‡å¤è®¡ç®—ï¼›</li>
<li>è§¦å‘é€»è¾‘ï¼šåªæœ‰ â€œä¾èµ–é¡¹å˜åŒ–â€ æ‰é‡æ–°è®¡ç®—ï¼Œæ— å…³çŠ¶æ€å˜åŒ–ä¸è§¦å‘ï¼›</li>
<li>å…³é”®æ³¨æ„ï¼šä¾èµ–é¡¹è¦å†™å…¨ã€å¼•ç”¨ç±»å‹è¦ç¨³ã€ä¸æ»¥ç”¨ã€ä¸åšå‰¯ä½œç”¨ï¼›</li>
<li>ç­‰ä»·å…³ç³»ï¼šReact useMemo â‰ˆ Vue computedï¼ˆéƒ½æ˜¯ç¼“å­˜è®¡ç®—ç»“æœï¼‰ã€‚</li>
</ol>
<p>è®°ä½ï¼šuseMemo çš„ç›®æ ‡æ˜¯ â€œä¼˜åŒ–æ€§èƒ½â€ï¼Œå¦‚æœç”¨äº†ä¹‹åæ²¡æå‡ï¼ˆç”šè‡³å˜æ…¢ï¼‰ï¼Œä¸å¦‚ä¸ç”¨ï½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[wangEditor5 å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­ä½¿ç”¨ kityformula å…¬å¼ç¼–è¾‘å™¨çš„å…·ä½“å®è·µ]]></title>    <link>https://juejin.cn/post/7592572266753802303</link>    <guid>https://juejin.cn/post/7592572266753802303</guid>    <pubDate>2026-01-08T06:56:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592572266753802303" data-draft-id="7592148975848489003" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="wangEditor5 å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­ä½¿ç”¨ kityformula å…¬å¼ç¼–è¾‘å™¨çš„å…·ä½“å®è·µ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,HTML"/> <meta itemprop="datePublished" content="2026-01-08T06:56:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lgliuying"/> <meta itemprop="url" content="https://juejin.cn/user/3131019758930206"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            wangEditor5 å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­ä½¿ç”¨ kityformula å…¬å¼ç¼–è¾‘å™¨çš„å…·ä½“å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3131019758930206/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lgliuying
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T06:56:46.000Z" title="Thu Jan 08 2026 06:56:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ‘˜è¦</h2>
<p>åœ¨wangEditor5 å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­æ·»åŠ  kityformula å…¬å¼ç¼–è¾‘å™¨ï¼Œå®ç°åœ¨æ–‡å­—ä¸­æ’å…¥å…¬å¼çš„åŠŸèƒ½ï¼Œå› ä¸ºéœ€æ±‚è¦æ±‚ï¼Œè¿™é‡Œç›´æ¥å°† LaTeX æ ¼å¼çš„å…¬å¼æ’å…¥å¯Œæ–‡æœ¬ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å›¾ç‰‡ã€‚</p>
<h2 data-id="heading-1">å‰è¨€</h2>
<p>å¼€å‘å·¥å…·ï¼šidea</p>
<p>jqueryç‰ˆæœ¬ï¼š1.11.0</p>
<p>wangEditorç‰ˆæœ¬ï¼š5.0.0</p>
<p>wangEditorå®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.wangeditor.com%2F" target="_blank" title="https://www.wangeditor.com/" ref="nofollow noopener noreferrer">wangEditor</a></p>
<p>kityFormulaç‰ˆæœ¬ï¼š1.0.0</p>
<p>kityFormulaå®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Ffex-team.github.io%2Fkityformula%2F" target="_blank" title="https://fex-team.github.io/kityformula/" ref="nofollow noopener noreferrer">é¦–é¡µ - Kity Formula HTML(SVG)æ•°å­¦å…¬å¼å‘ˆç°åº“</a></p>
<p>wangEditorWithFormulaç‰ˆæœ¬ï¼š1.0.11</p>
<p>wangEditorWithFormulaå®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwangeditor-team%2FwangEditor%2Fissues" target="_blank" title="https://github.com/wangeditor-team/wangEditor/issues" ref="nofollow noopener noreferrer">github.com/wangeditor-â€¦</a></p>
<p>å› ä¸ºå®é™…é¡¹ç›®æ¡†æ¶æ‰€é™ï¼Œè¿™é‡Œä¸ä¼šä½¿ç”¨vueç­‰æ¡†æ¶ï¼Œç›´æ¥é€šè¿‡jsä»£ç å®ç°åŠŸèƒ½</p>
<h2 data-id="heading-2">æ­£æ–‡</h2>
<p>ä¸‹é¢ç®€å•æ•´ç†ä¸‹å®ç°æ–¹æ³•ï¼Œä»¥åŠè¿‡ç¨‹ä¸­è¸©åˆ°çš„å‘ã€‚</p>
<h4 data-id="heading-3">ï¼ˆä¸€ï¼‰å®ç°æ–¹å¼</h4>
<p>1.å…ˆåœ¨é¡¹ç›®ä¸­å¼•å…¥å®˜æ–¹æä¾›çš„å·¥å…· wangEditorWithFormula,éœ€è¦ç”¨åˆ°é‡Œé¢çš„éƒ¨åˆ†æ–‡ä»¶ï¼Œå€Ÿé‰´éƒ¨åˆ†ä»£ç ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d17a0792271f489ab2ac4f4ace697ed4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGdsaXV5aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=WTpXz%2FqI%2FfUFK1BWbAVWXmQRQF8%3D" alt="image.png" loading="lazy"/></p>
<p>2.ç„¶åï¼Œç¼–å†™è‡ªå®šä¹‰ wangEditor èœå•ã€‚å¯ä»¥ä»ç½‘ä¸Šæ‰¾åˆ°ç±»ä¼¼çš„ä»£ç è¿›è¡Œä¿®æ”¹ã€‚åªè¦æ»¡è¶³ wangEditor çš„ç±»å‹è¦æ±‚å³å¯ã€‚è‡ªå®šä¹‰èœå•éœ€è¦å®ç°æ‹‰èµ· kityFormula ç»™çš„å®˜æ–¹é¡µé¢ï¼ŒåŒæ—¶å®ç°å…¬å¼çš„ä¼ é€’å’Œæ¸²æŸ“åŠŸèƒ½ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/089c1e4a638b40a396256cbedec8e9d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGdsaXV5aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=2WEs9aHBqeG1qPjFtE1HfRXjxQU%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40b64c02325c4bc787ac2ef6deebbdd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGdsaXV5aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=iFovQOBN7SngG3LVcYNL87w1nJg%3D" alt="image.png" loading="lazy"/></p>
<p>3.åœ¨éœ€è¦ä½¿ç”¨å¯Œæ–‡æœ¬çš„é¡µé¢ä¸­ï¼Œå¼•å…¥jqueryï¼ŒwangEditorWithFormulaï¼Œè‡ªå®šä¹‰èœå•ï¼Œå’ŒkityFormulaã€‚åœ¨é¡µé¢çš„onloadç”Ÿå‘½å‘¨æœŸä¸­ï¼Œç¼–å†™åˆå§‹åŒ–å®ä¾‹æ–¹æ³•ï¼Œå°†è‡ªå®šä¹‰èœå•æ’å…¥åˆ°wangEditorä¸­ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ï¼Œæ–°å¢å…¬å¼å’Œç¼–è¾‘å…¬å¼æ˜¯ä¸¤ä¸ªèœå•ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c9421b3e93a4979a2d7948c59576dc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGdsaXV5aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=c6E1TWlOjBIoNqBtqjsuclPcm0k%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-js" lang="js">
$(<span class="hljs-variable language_">document</span>).<span class="hljs-title function_">ready</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
    <span class="hljs-title function_">initEditor</span>()
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">initEditor</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> {createEditor, createToolbar, <span class="hljs-title class_">Boot</span>} = <span class="hljs-variable language_">window</span>.<span class="hljs-property">wangEditor</span>

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">WangEditorPluginFormula</span>)

    <span class="hljs-keyword">const</span> {<span class="hljs-attr">default</span>: <span class="hljs-variable language_">module</span>} = <span class="hljs-variable language_">window</span>.<span class="hljs-property">WangEditorPluginFormula</span>

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">module</span>)
    <span class="hljs-comment">// Boot.registerMenu(menuConf)</span>
    <span class="hljs-comment">// ç¡®ä¿å…¬å¼æ’ä»¶å·²åŠ è½½</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">window</span>.<span class="hljs-property">WangEditorPluginFormula</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"å…¬å¼æ’ä»¶æœªåŠ è½½æˆåŠŸ!"</span>);
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// æ³¨å†Œå…¬å¼æ’ä»¶</span>
    <span class="hljs-comment">// Boot.registerPlugin(window.WangEditorPluginFormula);</span>
    <span class="hljs-title class_">Boot</span>.<span class="hljs-title function_">registerModule</span>(<span class="hljs-variable language_">module</span>);
    <span class="hljs-comment">// æ³¨å†Œkityå…¬å¼ç¼–è¾‘å™¨æ’ä»¶</span>
    <span class="hljs-title class_">Boot</span>.<span class="hljs-title function_">registerMenu</span>(menuConf);
    <span class="hljs-title class_">Boot</span>.<span class="hljs-title function_">registerMenu</span>(editKityFormula);

    <span class="hljs-keyword">const</span> editorConfig = {
        <span class="hljs-attr">placeholder</span>: <span class="hljs-string">'Type here...'</span>,
        <span class="hljs-title function_">onChange</span>(<span class="hljs-params">editor</span>) {
            <span class="hljs-keyword">const</span> html = editor.<span class="hljs-title function_">getHtml</span>()
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'editor content'</span>, html)
        },
        <span class="hljs-comment">// é€‰ä¸­å…¬å¼æ—¶çš„æ‚¬æµ®èœå•</span>
        <span class="hljs-attr">hoverbarKeys</span>: {
            <span class="hljs-attr">formula</span>: {
                <span class="hljs-comment">// menuKeys: ['editFormula'], // â€œç¼–è¾‘å…¬å¼â€èœå•</span>
                <span class="hljs-attr">menuKeys</span>: [<span class="hljs-string">'editKityFormula'</span>], <span class="hljs-comment">// â€œç¼–è¾‘å…¬å¼â€èœå•</span>
            },
        },
    }

    <span class="hljs-keyword">const</span> editor = <span class="hljs-title function_">createEditor</span>({
        <span class="hljs-attr">selector</span>: <span class="hljs-string">'#editor-container'</span>,
        <span class="hljs-attr">html</span>: <span class="hljs-string">'&lt;p&gt;&lt;br&gt;&lt;/p&gt;'</span>,
        <span class="hljs-attr">config</span>: editorConfig,
        <span class="hljs-attr">mode</span>: <span class="hljs-string">'default'</span>, <span class="hljs-comment">// or 'simple'</span>
    })

    <span class="hljs-variable language_">window</span>.<span class="hljs-property">editor</span> = editor

    <span class="hljs-comment">// è§£å†³å›è½¦é—®é¢˜</span>
    $(<span class="hljs-variable language_">document</span>).<span class="hljs-title function_">on</span>(<span class="hljs-string">'keyup'</span>, <span class="hljs-string">'#editor-container'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Key up in editor container:'</span>, e);
        <span class="hljs-comment">// å¤„ç†é”®ç›˜äº‹ä»¶</span>
        <span class="hljs-keyword">if</span> (e.<span class="hljs-property">keyCode</span> === <span class="hljs-number">13</span>) {
            editor.<span class="hljs-title function_">dangerouslyInsertHtml</span>(<span class="hljs-string">"&lt;p&gt;&lt;br&gt;&lt;/p&gt;"</span>);
        }
    });

    <span class="hljs-keyword">const</span> toolbarConfig = {
        <span class="hljs-attr">insertKeys</span>: {
            <span class="hljs-attr">index</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">keys</span>: [
                <span class="hljs-string">'kityFormula'</span>, <span class="hljs-comment">// â€œæ’å…¥å…¬å¼â€èœå•</span>
                <span class="hljs-comment">// 'insertFormula', // â€œæ’å…¥å…¬å¼â€èœå•</span>
                <span class="hljs-comment">// 'editFormula' // â€œç¼–è¾‘å…¬å¼â€èœå•</span>
            ],
        },
    }

    toolbarConfig.<span class="hljs-property">toolbarKeys</span> = [
        {
            <span class="hljs-attr">key</span>: <span class="hljs-string">"group-justify"</span>, <span class="hljs-comment">// å¿…å¡«ï¼Œè¦ä»¥ group å¼€å¤´</span>
            <span class="hljs-attr">title</span>: <span class="hljs-string">"å¯¹é½"</span>, <span class="hljs-comment">// å¿…å¡«</span>
            <span class="hljs-attr">iconSvg</span>: <span class="hljs-string">"&lt;svg viewBox="</span><span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1024</span> <span class="hljs-number">1024</span><span class="hljs-string">"&gt;&lt;path d="</span><span class="hljs-variable constant_">M768</span> <span class="hljs-number">793.</span>6v102.4H51.2v-<span class="hljs-number">102.</span>4h716.8z m204<span class="hljs-number">.8</span>-<span class="hljs-number">230.</span>4v102.4H51.2v-<span class="hljs-number">102.</span>4h921.6z m-<span class="hljs-number">204.8</span>-<span class="hljs-number">230.</span>4v102.4H51.2v-<span class="hljs-number">102.</span>4h716.8zM972<span class="hljs-number">.8</span> <span class="hljs-number">102.</span>4v102.4H51.2V102.4h921.6z<span class="hljs-string">"&gt;&lt;/path&gt;&lt;/svg&gt;"</span>, <span class="hljs-comment">// å¯é€‰</span>
            <span class="hljs-attr">menuKeys</span>: [<span class="hljs-string">"justifyLeft"</span>, <span class="hljs-string">"justifyRight"</span>, <span class="hljs-string">"justifyCenter"</span>], <span class="hljs-comment">// ä¸‹çº§èœå• key ï¼Œå¿…å¡«</span>
        },
        <span class="hljs-comment">// åˆ†å‰²çº¿</span>
        <span class="hljs-string">'|'</span>,
        <span class="hljs-string">"sup"</span>,
        <span class="hljs-string">"sub"</span>,
        <span class="hljs-string">'|'</span>,
        <span class="hljs-comment">// èœå• key</span>
        <span class="hljs-string">'undo'</span>,
        <span class="hljs-string">'redo'</span>
    ]

    <span class="hljs-keyword">const</span> toolbar = <span class="hljs-title function_">createToolbar</span>({
        editor,
        <span class="hljs-attr">selector</span>: <span class="hljs-string">'#toolbar-container'</span>,
        <span class="hljs-attr">config</span>: toolbarConfig,
        <span class="hljs-attr">mode</span>: <span class="hljs-string">'simple'</span>, <span class="hljs-comment">// or 'simple'</span>
    })
}
</code></pre>
<h4 data-id="heading-4">ï¼ˆäºŒï¼‰è¿‡ç¨‹è¸©å‘</h4>
<p>1.é¦–å…ˆå°±æ˜¯æ‰¾ç°æˆçš„å®ç°æ–¹å¼ï¼Œåœ¨ç½‘ä¸Šæ²¡æœ‰æœç´¢åˆ°æ¯”è¾ƒç¬¦åˆè¦æ±‚çš„ä»£ç å®ç°ï¼Œæ¯”è¾ƒæ¥è¿‘çš„ä¸€ä¸ªæ˜¯æŠŠå…¬å¼è½¬æˆå›¾ç‰‡æ’å…¥åˆ°å¯Œæ–‡æœ¬ä¸­ï¼Œè¿™ä¸æ˜¯é¡¹ç›®æƒ³è¦çš„æ•ˆæœã€‚æœ€ååªèƒ½æ ¹æ®å·²æœ‰ä»£ç è¿›è¡Œä¿®æ”¹ã€‚</p>
<p>2.latexå…¬å¼åœ¨å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­çš„æ˜¾ç¤ºæœ‰é—®é¢˜ï¼Œç›´æ¥æŠŠå…¬å¼ç¼–è¾‘å™¨ä¸­çš„å…¬å¼æ’å…¥åˆ°å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­ï¼Œä¸èƒ½æ­£å¸¸æ˜¾ç¤ºã€‚éœ€è¦è¿›è¡Œæ¸²æŸ“ï¼Œæ¸²æŸ“æˆå¯Œæ–‡æœ¬ç¼–è¾‘å™¨èƒ½è¯†åˆ«çš„htmlå…ƒç´ ï¼Œä½†æ˜¯ï¼Œå®˜æ–¹æ–‡æ¡£å¹¶æ²¡æœ‰æä¾›æ–¹æ³•çš„æ¥å£æ–‡æ¡£ï¼Œè¿™ä¸€ç‚¹éå¸¸å‘ï¼Œä¸çŸ¥é“å“ªä¸ªæ–¹æ³•èƒ½è¿›è¡Œå…¬å¼æ¸²æŸ“ã€‚æœ€ååœ¨æ’æŸ¥WangEditorPluginFormulaçš„æµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œæ‰æ‰¾åˆ°äº†å®˜æ–¹çš„æ¸²æŸ“æ–¹æ³•ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/755563e4527e49289be7f066f7500f85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGdsaXV5aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=UkrsWjeJMQ9JpN1%2BrB6qz%2BBBDys%3D" alt="image.png" loading="lazy"/></p>
<p>æŠŠæ¸²æŸ“æ–¹æ³•æ”¾åˆ°è‡ªå®šä¹‰èœå•çš„æ’å…¥æ–¹æ³•ä¸­ï¼Œè¿™ä¸€æ­¥æ¸²æŸ“å°±ç®—å®Œæˆäº†</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/434ede98e0e54558bcb37b2f49f05a2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGdsaXV5aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=pO8LjU1RC1dSuw9K5C7oNiFDPxI%3D" alt="image.png" loading="lazy"/></p>
<p>3.æœ€å›°éš¾çš„é—®é¢˜è§£å†³ä¹‹åï¼Œä¸‡ä¸‡æ²¡æƒ³åˆ°wangEditorå®˜æ–¹è¿˜ç•™äº†ä¸€ä¸ªå‘ï¼Œæ€ä¹ˆæŠŠæ¸²æŸ“ä¹‹åçš„å…¬å¼å­—ç¬¦ä¸²æ’å…¥çš„å¯Œæ–‡æœ¬é‡Œï¼Ÿå®˜æ–¹æ–‡æ¡£ä¸Šä¾ç„¶æ²¡æœ‰æ‰¾åˆ°æ’å…¥æ¥å£æ˜¯å“ªä¸ªï¼Œåªèƒ½è‡ªå·±æ‰¾ã€‚æœ€ååœ¨é€šè¿‡ä½¿ç”¨console.logæ‰“å°editorå®ä¾‹çš„æ–¹æ³•ï¼Œåœ¨å®ä¾‹é‡Œæ‰¾åˆ°ä¸ªè²Œä¼¼å¯ä»¥å®ç°æ’å…¥çš„æ–¹æ³• editor.dangerouslyInsertHtml ã€‚æµ‹è¯•äº†ä¸‹ï¼Œçš„ç¡®èƒ½ç”¨ï¼Œå¯ä»¥çš„å®Œç»“æ’’èŠ±äº†ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09764cafcf374698abbf1495627d4105~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGdsaXV5aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=p%2FidhXooWinElv%2F%2BUC1bFteNbT0%3D" alt="image.png" loading="lazy"/></p>
<p>4.æ’å…¥è§£å†³äº†ï¼Œç„¶åå°±æ˜¯ç¼–è¾‘åŠŸèƒ½çš„å®ç°ã€‚ä¾ç„¶æ˜¯æ²¡æœ‰å®˜æ–¹æ–‡æ¡£çš„é—®é¢˜ï¼Œåªèƒ½è‡ªå·±ä»æºç ï¼Œæµ‹è¯•ç”¨ä¾‹å’Œå®ä¾‹é‡Œæ‰¾ã€‚å¥½åœ¨ä¸æ˜¯ç¬¬ä¸€æ¬¡è¿™ä¹ˆå¹²äº†ï¼Œé€Ÿåº¦å¿«äº†ä¸å°‘ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5053eb5fb4df42659ce50ef111016384~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGdsaXV5aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=Y07GkOcrogfwG7HQ3L4UjL7TUXk%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/828ebaa7c6004b4e9ad90b2574d4f64c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGdsaXV5aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=7NJSVIQnMAYOVHSKBSxsYQjVk4Y%3D" alt="image.png" loading="lazy"/></p>
<p>ï¼ˆä¸‰ï¼‰è‡ªå®šä¹‰èœå•</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> formulaIcon =   <span class="hljs-string">'&lt;svg t="1682415575656" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8100" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"&gt;&lt;path d="M902.383 461.687c6.417-6.417 12.834-12.8 19.217-12.8h89.6c6.383 0 12.8-6.382 12.8-12.765v-102.23c0-6.417-6.417-12.8-12.8-12.8H908.8c-6.417 0-19.183 6.383-19.183 12.8L780.8 448.922c-6.383 6.348-12.8 6.348-12.8 0l-57.583-115.03c-6.417-6.417-12.8-12.8-19.217-12.8H524.8c-6.383 0-12.8 6.383-12.8 12.8v102.23c0 6.383 6.417 12.765 12.8 12.765h102.4c6.417 0 12.8 6.383 19.183 12.8l38.4 83.081v19.149l-115.2 134.178c-6.383 0-12.766 6.417-19.183 6.417h-89.6c-6.383 0-12.8 6.383-12.8 12.766v102.23c0 6.382 6.417 12.8 12.8 12.8h102.4c6.383 0 19.183-6.418 19.183-12.8L729.6 653.38c6.417-6.383 12.8-6.383 12.8 0l83.183 166.127c0 6.383 12.8 12.8 19.217 12.8h102.4a13.756 13.756 0 0 0 12.8-12.8v-102.23a13.756 13.756 0 0 0-12.8-12.765h-38.4c-6.417 0-12.8-6.417-19.183-12.8l-64.034-127.795v-19.149l76.8-83.08zM377.617 65.502C345.6 91.068 313.583 129.399 294.4 193.297l-31.983 127.795H76.8a13.756 13.756 0 0 0-12.8 12.8v102.23c0 6.383 6.383 12.765 12.8 12.765h153.6l-96.017 383.42C115.2 908.971 64 896.205 64 896.205H0V1024h64c51.2 0 102.4-6.383 128-38.332 32.017-31.949 51.2-89.463 64-153.36l96.017-383.42H499.2c6.383 0 12.8-6.383 12.8-12.766v-102.23c0-6.417-6.417-12.8-12.8-12.8H384l32.017-121.412c6.383-19.149 38.4-51.098 57.583-63.898C543.983 84.651 640 116.6 704 129.4V20.753c-64-12.766-204.8-57.48-326.383 44.715z" p-id="8101"&gt;&lt;/path&gt;&lt;/svg&gt;'</span>;
<span class="hljs-comment">// å®šä¹‰ MyKityFormulaMenu ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyKityFormulaMenu</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = <span class="hljs-string">"ç¼–è¾‘å…¬å¼"</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">iconSvg</span> = formulaIcon;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tag</span> = <span class="hljs-string">"button"</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">showModal</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">modalWidth</span> = <span class="hljs-number">900</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">modalHeight</span> = <span class="hljs-number">600</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentSelection</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// è·Ÿè¸ªå½“å‰é€‰åŒº</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastInsertAt</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// ä¸Šæ¬¡æ’å…¥æ—¶é—´æˆ³</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastLatex</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// ä¸Šæ¬¡æ’å…¥çš„latex</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">getModalPositionNode</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">getModalPositionNode</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">getModalContentElem</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">getModalContentElem</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
  }

  <span class="hljs-comment">// èœå•æ˜¯å¦éœ€è¦æ¿€æ´»ï¼ˆå¦‚é€‰ä¸­åŠ ç²—æ–‡æœ¬ï¼Œâ€œåŠ ç²—â€èœå•ä¼šæ¿€æ´»ï¼‰ï¼Œç”¨ä¸åˆ°åˆ™è¿”å› false</span>
  <span class="hljs-title function_">isActive</span>(<span class="hljs-params">editor</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-comment">// è·å–èœå•æ‰§è¡Œæ—¶çš„ value ï¼Œç”¨ä¸åˆ°åˆ™è¿”å›ç©º å­—ç¬¦ä¸²æˆ– false</span>
  <span class="hljs-title function_">getValue</span>(<span class="hljs-params">editor</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
  }

  <span class="hljs-comment">// èœå•æ˜¯å¦éœ€è¦ç¦ç”¨ï¼ˆå¦‚é€‰ä¸­ H1 ï¼Œâ€œå¼•ç”¨â€èœå•è¢«ç¦ç”¨ï¼‰ï¼Œç”¨ä¸åˆ°åˆ™è¿”å› false</span>
  <span class="hljs-title function_">isDisabled</span>(<span class="hljs-params">editor</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-comment">// ç‚¹å‡»èœå•æ—¶è§¦å‘çš„å‡½æ•°</span>
  <span class="hljs-title function_">exec</span>(<span class="hljs-params">editor, value</span>) {
    <span class="hljs-comment">// Modal menu ï¼Œè¿™ä¸ªå‡½æ•°ä¸ç”¨å†™ï¼Œç©ºç€å³å¯</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'exec=====editor===='</span>, editor);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'exec=====value===='</span>, value);
    <span class="hljs-keyword">return</span> editor;
  }

  <span class="hljs-comment">// å¼¹å‡ºæ¡† modal çš„å®šä½ï¼š1. è¿”å›æŸä¸€ä¸ª SlateNodeï¼› 2. è¿”å› null ï¼ˆæ ¹æ®å½“å‰é€‰åŒºè‡ªåŠ¨å®šä½ï¼‰</span>
  <span class="hljs-title function_">getModalPositionNode</span>(<span class="hljs-params">editor</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentSelection</span> = editor.<span class="hljs-property">selection</span>; <span class="hljs-comment">// ä¿å­˜å½“å‰é€‰åŒº</span>
  }

  <span class="hljs-comment">// å®šä¹‰ modal å†…éƒ¨çš„ DOM Element</span>
  <span class="hljs-title function_">getModalContentElem</span>(<span class="hljs-params">editor</span>) {
    <span class="hljs-comment">// panel ä¸­éœ€è¦ç”¨åˆ°çš„id</span>
    <span class="hljs-keyword">const</span> inputIFrameId = <span class="hljs-string">"kityformula_"</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">10</span>);
    <span class="hljs-keyword">const</span> btnOkId = <span class="hljs-string">"kityformula-btn"</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">10</span>);

    <span class="hljs-keyword">const</span> $content = $(<span class="hljs-string">'&lt;div&gt;&lt;iframe id="'</span> + inputIFrameId + <span class="hljs-string">'" class="iframe" height="400px" width="100%" frameborder="0" scrolling="no" src="../../js/kityformula/index.html"&gt;&lt;/iframe&gt;&lt;/div&gt;'</span>);
    <span class="hljs-keyword">const</span> $button = $(<span class="hljs-string">'&lt;div id="'</span> + btnOkId + <span class="hljs-string">'" class="right" style="margin: 5px 0; background: #176EAF;color: #FFFFFF;height: 1.8rem;line-height: 1.8rem;text-align: center;border-radius: 0.1rem;font-size: 0.7rem;font-weight: normal;width:10rem;"&gt;ç¡®è®¤æ’å…¥&lt;/div&gt;'</span>);
    $content.<span class="hljs-title function_">append</span>($button);

    $button.<span class="hljs-title function_">on</span>(<span class="hljs-string">"click"</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// æ‰§è¡Œæ’å…¥å…¬å¼</span>
      <span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(inputIFrameId);
      <span class="hljs-keyword">const</span> kfe = node.<span class="hljs-property">contentWindow</span>.<span class="hljs-property">kfe</span>;

      kfe.<span class="hljs-title function_">execCommand</span>(<span class="hljs-string">"get.image.data"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) {
        <span class="hljs-comment">// è·å–base64</span>
        <span class="hljs-comment">// console.log(data.img);</span>
      });

      <span class="hljs-keyword">let</span> latex = kfe.<span class="hljs-title function_">execCommand</span>(<span class="hljs-string">"get.source"</span>);
      latex = latex.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\s/g</span>, <span class="hljs-string">""</span>); <span class="hljs-comment">// å»æ‰ç©ºæ ¼</span>

      <span class="hljs-comment">// é˜²é‡å¤ï¼šç›¸åŒlatexåœ¨çŸ­æ—¶é—´å†…ï¼ˆ800msï¼‰ä¸é‡å¤æ’å…¥</span>
      <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">lastLatex</span> === latex &amp;&amp; now - <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastInsertAt</span> &lt; <span class="hljs-number">800</span>) {
        editor.<span class="hljs-title function_">hidePanelOrModal</span>();
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'KityFormulaæ’å…¥å…¬å¼:'</span>, latex);

      <span class="hljs-comment">// åˆ›å»ºå…¬å¼èŠ‚ç‚¹ï¼Œä¸æ–°ç‰ˆ wangEditor å…¼å®¹</span>
      <span class="hljs-keyword">const</span> formulaNode = {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"formula"</span>,
        <span class="hljs-attr">value</span>: latex,
        <span class="hljs-attr">children</span>: [{<span class="hljs-attr">text</span>: <span class="hljs-string">""</span>,},],
      };

      <span class="hljs-comment">// ä½¿ç”¨ setHtml æ–¹æ³•ç›´æ¥æ’å…¥ LaTeX æ–‡æœ¬</span>
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// console.log('ä½¿ç”¨ setHtml æ–¹æ³•æ’å…¥ LaTeX æ–‡æœ¬');</span>
        <span class="hljs-keyword">var</span> currentHtml = editor.<span class="hljs-title function_">getHtml</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å½“å‰HTML:'</span>, currentHtml);

        <span class="hljs-comment">// å¦‚æœå½“å‰å†…å®¹ä¸ºç©ºæˆ–åªæœ‰æ¢è¡Œï¼Œç›´æ¥è®¾ç½®</span>
        <span class="hljs-comment">// if (!currentHtml || currentHtml.trim() === '' || currentHtml === '&lt;p&gt;&lt;br&gt;&lt;/p&gt;') {</span>
        <span class="hljs-comment">//   var newHtml = '&lt;p&gt;' + latex + '&lt;/p&gt;';</span>
        <span class="hljs-comment">//   editor.setHtml(newHtml);</span>
        <span class="hljs-comment">//   console.log('è®¾ç½®æ–°HTML:', newHtml);</span>
        <span class="hljs-comment">// } else {</span>
        <span class="hljs-comment">//   // åœ¨ç°æœ‰å†…å®¹åæ·»åŠ </span>
        <span class="hljs-comment">//   var newHtml = currentHtml + latex;</span>
        <span class="hljs-comment">//   editor.setHtml(newHtml);</span>
        <span class="hljs-comment">//   console.log('è¿½åŠ åˆ°ç°æœ‰HTML:', newHtml);</span>
        <span class="hljs-comment">// }</span>
        <span class="hljs-keyword">var</span> newHtml = <span class="hljs-title class_">WangEditorPluginFormula</span>.<span class="hljs-property">default</span>.<span class="hljs-property">elemsToHtml</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">elemToHtml</span>({<span class="hljs-attr">value</span>: latex},<span class="hljs-string">""</span>);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è®¾ç½®æ–°HTML:'</span>, newHtml);
        editor.<span class="hljs-title function_">focus</span>();
        <span class="hljs-keyword">if</span> (!currentHtml || currentHtml.<span class="hljs-title function_">trim</span>() === <span class="hljs-string">''</span> || currentHtml === <span class="hljs-string">'&lt;p&gt;&lt;br&gt;&lt;/p&gt;'</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ä½¿ç”¨ setHtml æ–¹æ³•æ’å…¥ LaTeX æ–‡æœ¬'</span>);
          editor.<span class="hljs-title function_">setHtml</span>(newHtml);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ä½¿ç”¨ insertText æ–¹æ³•æ’å…¥ LaTeX æ–‡æœ¬'</span>);
          editor.<span class="hljs-title function_">dangerouslyInsertHtml</span>(newHtml);
          <span class="hljs-comment">// editor.insertText(newHtml);</span>
        }

        <span class="hljs-comment">// è§¦å‘å†…å®¹å˜åŒ–äº‹ä»¶ï¼Œè®© renderFormulaNodes å¤„ç†</span>
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">var</span> verifyHtml = editor.<span class="hljs-title function_">getHtml</span>();
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ’å…¥åçš„HTML:'</span>, verifyHtml);

          <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘å…¬å¼æ¸²æŸ“</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">renderFormulaNodes</span> === <span class="hljs-string">'function'</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è§¦å‘å…¬å¼æ¸²æŸ“'</span>);
            <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">renderFormulaNodes</span>(<span class="hljs-string">'standard'</span>);
          }
        }, <span class="hljs-number">100</span>);

      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'setHtml æ’å…¥å¤±è´¥:'</span>, error);
        <span class="hljs-comment">// å¦‚æœ setHtml å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ insertText</span>
        <span class="hljs-keyword">try</span> {
          editor.<span class="hljs-title function_">insertText</span>(latex);
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ä½¿ç”¨ insertText ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ'</span>);
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'insertText ä¹Ÿå¤±è´¥:'</span>, e);
        }
      }

      <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastLatex</span> = latex;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastInsertAt</span> = now;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"===========================formulaNode"</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(formulaNode);
      editor.<span class="hljs-title function_">hidePanelOrModal</span>();
    });
    <span class="hljs-keyword">return</span> $content[<span class="hljs-number">0</span>]; <span class="hljs-comment">// è¿”å› DOM Element ç±»å‹</span>

    <span class="hljs-comment">// PSï¼šä¹Ÿå¯ä»¥æŠŠ $content ç¼“å­˜ä¸‹æ¥ï¼Œè¿™æ ·ä¸ç”¨æ¯æ¬¡é‡å¤åˆ›å»ºã€é‡å¤ç»‘å®šäº‹ä»¶ï¼Œä¼˜åŒ–æ€§èƒ½</span>
  }
}

<span class="hljs-keyword">const</span> menuConf = {
  <span class="hljs-attr">key</span>: <span class="hljs-string">"kityFormula"</span>, <span class="hljs-comment">// menu key ï¼Œå”¯ä¸€ã€‚æ³¨å†Œä¹‹åï¼Œéœ€é€šè¿‡ toolbarKeys é…ç½®åˆ°å·¥å…·æ </span>
  <span class="hljs-title function_">factory</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyKityFormulaMenu</span>();
  },
};

<span class="hljs-comment">// æš´éœ²å…¨å±€å˜é‡</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">menuConf</span> = menuConf;

<span class="hljs-comment">// åˆ›å»º MyKityFormulaMenu ç±»çš„å®ä¾‹</span>
<span class="hljs-keyword">const</span> myKityFormulaMenuInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyKityFormulaMenu</span>();
<span class="hljs-comment">// å¯¼å‡º exec æ–¹æ³•</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">exec</span> = myKityFormulaMenuInstance.<span class="hljs-property">exec</span>;
</code></pre>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">class</span> <span class="hljs-title class_">EditKityFormulaMenu</span> {
  <span class="hljs-comment">// å®šä¹‰ EditKityFormulaMenu ç±»</span>
  formulaIcon =   <span class="hljs-string">'&lt;svg t="1682415575656" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8100" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"&gt;&lt;path d="M902.383 461.687c6.417-6.417 12.834-12.8 19.217-12.8h89.6c6.383 0 12.8-6.382 12.8-12.765v-102.23c0-6.417-6.417-12.8-12.8-12.8H908.8c-6.417 0-19.183 6.383-19.183 12.8L780.8 448.922c-6.383 6.348-12.8 6.348-12.8 0l-57.583-115.03c-6.417-6.417-12.8-12.8-19.217-12.8H524.8c-6.383 0-12.8 6.383-12.8 12.8v102.23c0 6.383 6.417 12.765 12.8 12.765h102.4c6.417 0 12.8 6.383 19.183 12.8l38.4 83.081v19.149l-115.2 134.178c-6.383 0-12.766 6.417-19.183 6.417h-89.6c-6.383 0-12.8 6.383-12.8 12.766v102.23c0 6.382 6.417 12.8 12.8 12.8h102.4c6.383 0 19.183-6.418 19.183-12.8L729.6 653.38c6.417-6.383 12.8-6.383 12.8 0l83.183 166.127c0 6.383 12.8 12.8 19.217 12.8h102.4a13.756 13.756 0 0 0 12.8-12.8v-102.23a13.756 13.756 0 0 0-12.8-12.765h-38.4c-6.417 0-12.8-6.417-19.183-12.8l-64.034-127.795v-19.149l76.8-83.08zM377.617 65.502C345.6 91.068 313.583 129.399 294.4 193.297l-31.983 127.795H76.8a13.756 13.756 0 0 0-12.8 12.8v102.23c0 6.383 6.383 12.765 12.8 12.765h153.6l-96.017 383.42C115.2 908.971 64 896.205 64 896.205H0V1024h64c51.2 0 102.4-6.383 128-38.332 32.017-31.949 51.2-89.463 64-153.36l96.017-383.42H499.2c6.383 0 12.8-6.383 12.8-12.766v-102.23c0-6.417-6.417-12.8-12.8-12.8H384l32.017-121.412c6.383-19.149 38.4-51.098 57.583-63.898C543.983 84.651 640 116.6 704 129.4V20.753c-64-12.766-204.8-57.48-326.383 44.715z" p-id="8101"&gt;&lt;/path&gt;&lt;/svg&gt;'</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = <span class="hljs-string">"ç¼–è¾‘å…¬å¼"</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">iconSvg</span> = formulaIcon;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tag</span> = <span class="hljs-string">"button"</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">showModal</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">modalWidth</span> = <span class="hljs-number">900</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">modalHeight</span> = <span class="hljs-number">600</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentSelection</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// è·Ÿè¸ªå½“å‰é€‰åŒº</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastInsertAt</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// ä¸Šæ¬¡æ’å…¥æ—¶é—´æˆ³</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastLatex</span> = <span class="hljs-literal">null</span>; <span class="hljs-comment">// ä¸Šæ¬¡æ’å…¥çš„latex</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">getModalPositionNode</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">getModalPositionNode</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">getModalContentElem</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">getModalContentElem</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">DomEditor</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">wangEditor</span>.<span class="hljs-property">DomEditor</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">SlateTransforms</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">wangEditor</span>.<span class="hljs-property">SlateTransforms</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">WangEditorPluginFormula</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">WangEditorPluginFormula</span>;
  }

  <span class="hljs-comment">// èœå•æ˜¯å¦éœ€è¦æ¿€æ´»ï¼ˆå¦‚é€‰ä¸­åŠ ç²—æ–‡æœ¬ï¼Œâ€œåŠ ç²—â€èœå•ä¼šæ¿€æ´»ï¼‰ï¼Œç”¨ä¸åˆ°åˆ™è¿”å› false</span>
  <span class="hljs-title function_">isActive</span>(<span class="hljs-params">editor</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-title function_">getSelectedElem</span>(<span class="hljs-params">editor</span>) {
    <span class="hljs-comment">// const node = editor.getFragment()[0].children[0]</span>
    <span class="hljs-comment">// console.log('editor.getFragment()', editor.getFragment())</span>
    <span class="hljs-comment">// console.log('editor.getFragment()[0]', editor.getFragment()[0])</span>
    <span class="hljs-comment">// console.log('editor.getFragment()[0].children', editor.getFragment()[0].children)</span>
    <span class="hljs-comment">// console.log('editor.getFragment()[0].children[0]', editor.getFragment()[0].children[0])</span>
    <span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">this</span>.<span class="hljs-property">DomEditor</span>.<span class="hljs-title function_">getSelectedNodeByType</span>(editor, <span class="hljs-string">'formula'</span>)
    <span class="hljs-keyword">if</span> (node == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    <span class="hljs-keyword">return</span> node
  }

  <span class="hljs-comment">// è·å–èœå•æ‰§è¡Œæ—¶çš„ value ï¼Œç”¨ä¸åˆ°åˆ™è¿”å›ç©º å­—ç¬¦ä¸²æˆ– false</span>
  <span class="hljs-title function_">getValue</span>(<span class="hljs-params">editor</span>) {
    <span class="hljs-keyword">const</span> formulaElem = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getSelectedElem</span>(editor)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'formulaElem:'</span>, formulaElem);
    <span class="hljs-keyword">if</span> (formulaElem) {
      <span class="hljs-keyword">return</span> formulaElem.<span class="hljs-property">value</span> || <span class="hljs-string">''</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>
  }

  <span class="hljs-comment">// èœå•æ˜¯å¦éœ€è¦ç¦ç”¨ï¼ˆå¦‚é€‰ä¸­ H1 ï¼Œâ€œå¼•ç”¨â€èœå•è¢«ç¦ç”¨ï¼‰ï¼Œç”¨ä¸åˆ°åˆ™è¿”å› false</span>
  <span class="hljs-title function_">isDisabled</span>(<span class="hljs-params">editor</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-comment">// ç‚¹å‡»èœå•æ—¶è§¦å‘çš„å‡½æ•°</span>
  <span class="hljs-title function_">exec</span>(<span class="hljs-params">editor, value</span>) {
    <span class="hljs-comment">// Modal menu ï¼Œè¿™ä¸ªå‡½æ•°ä¸ç”¨å†™ï¼Œç©ºç€å³å¯</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'exec=====editor===='</span>, editor);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'exec=====value===='</span>, value);
    <span class="hljs-keyword">return</span> editor;
  }

  <span class="hljs-comment">// å¼¹å‡ºæ¡† modal çš„å®šä½ï¼š1. è¿”å›æŸä¸€ä¸ª SlateNodeï¼› 2. è¿”å› null ï¼ˆæ ¹æ®å½“å‰é€‰åŒºè‡ªåŠ¨å®šä½ï¼‰</span>
  <span class="hljs-title function_">getModalPositionNode</span>(<span class="hljs-params">editor</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentSelection</span> = editor.<span class="hljs-property">selection</span>; <span class="hljs-comment">// ä¿å­˜å½“å‰é€‰åŒº</span>
  }

  <span class="hljs-comment">// å®šä¹‰ modal å†…éƒ¨çš„ DOM Element</span>
  <span class="hljs-title function_">getModalContentElem</span>(<span class="hljs-params">editor</span>) {

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'getModalContentElem:'</span>, editor);

    <span class="hljs-comment">// è®¾ç½® input val</span>
    <span class="hljs-keyword">let</span> value = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getValue</span>(editor)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'value:'</span>, value);

    <span class="hljs-comment">// panel ä¸­éœ€è¦ç”¨åˆ°çš„id</span>
    <span class="hljs-keyword">const</span> inputIFrameId = <span class="hljs-string">"kityformula_"</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">10</span>);
    <span class="hljs-keyword">const</span> btnOkId = <span class="hljs-string">"kityformula-btn"</span> + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">10</span>);

    <span class="hljs-keyword">let</span> src = <span class="hljs-string">"../../js/kityformula/index.html"</span>;
    <span class="hljs-keyword">if</span> (value) {
      src = <span class="hljs-string">"../../js/kityformula/index.html?value="</span> + <span class="hljs-built_in">encodeURIComponent</span>(value);
    }

    <span class="hljs-keyword">const</span> $content = $(<span class="hljs-string">'&lt;div&gt;&lt;iframe id="'</span> + inputIFrameId + <span class="hljs-string">'" class="iframe" height="400px" width="100%" frameborder="0" scrolling="no" src="'</span> + src + <span class="hljs-string">'"&gt;&lt;/iframe&gt;&lt;/div&gt;'</span>);
    <span class="hljs-keyword">const</span> $button = $(<span class="hljs-string">'&lt;div id="'</span> + btnOkId + <span class="hljs-string">'" class="right" style="margin: 5px 0; background: #176EAF;color: #FFFFFF;height: 1.8rem;line-height: 1.8rem;text-align: center;border-radius: 0.1rem;font-size: 0.7rem;font-weight: normal;width:10rem;"&gt;ç¡®è®¤æ’å…¥&lt;/div&gt;'</span>);
    $content.<span class="hljs-title function_">append</span>($button);

    $button.<span class="hljs-title function_">on</span>(<span class="hljs-string">"click"</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// æ‰§è¡Œæ’å…¥å…¬å¼</span>
      <span class="hljs-keyword">const</span> node = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(inputIFrameId);
      <span class="hljs-keyword">const</span> kfe = node.<span class="hljs-property">contentWindow</span>.<span class="hljs-property">kfe</span>;

      kfe.<span class="hljs-title function_">execCommand</span>(<span class="hljs-string">"get.image.data"</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) {
        <span class="hljs-comment">// è·å–base64</span>
        <span class="hljs-comment">// console.log(data.img);</span>
      });

      <span class="hljs-keyword">let</span> latex = kfe.<span class="hljs-title function_">execCommand</span>(<span class="hljs-string">"get.source"</span>);
      <span class="hljs-comment">// latex = latex.replace(/\s/g, ""); // å»æ‰ç©ºæ ¼</span>

      <span class="hljs-comment">// é˜²é‡å¤ï¼šç›¸åŒlatexåœ¨çŸ­æ—¶é—´å†…ï¼ˆ800msï¼‰ä¸é‡å¤æ’å…¥</span>
      <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">lastLatex</span> === latex &amp;&amp; now - <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastInsertAt</span> &lt; <span class="hljs-number">800</span>) {
        editor.<span class="hljs-title function_">hidePanelOrModal</span>();
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'KityFormulaæ’å…¥å…¬å¼:'</span>, latex);

      <span class="hljs-comment">// åˆ›å»ºå…¬å¼èŠ‚ç‚¹ï¼Œä¸æ–°ç‰ˆ wangEditor å…¼å®¹</span>
      <span class="hljs-keyword">const</span> formulaNode = {
        <span class="hljs-attr">type</span>: <span class="hljs-string">"formula"</span>,
        <span class="hljs-attr">value</span>: latex,
        <span class="hljs-attr">children</span>: [{<span class="hljs-attr">text</span>: <span class="hljs-string">""</span>,},],
      };

      <span class="hljs-comment">// ä½¿ç”¨ setHtml æ–¹æ³•ç›´æ¥æ’å…¥ LaTeX æ–‡æœ¬</span>
      <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// console.log('ä½¿ç”¨ setHtml æ–¹æ³•æ’å…¥ LaTeX æ–‡æœ¬');</span>
        <span class="hljs-keyword">var</span> currentHtml = editor.<span class="hljs-title function_">getHtml</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å½“å‰HTML:'</span>, currentHtml);

        <span class="hljs-comment">// å¦‚æœå½“å‰å†…å®¹ä¸ºç©ºæˆ–åªæœ‰æ¢è¡Œï¼Œç›´æ¥è®¾ç½®</span>
        <span class="hljs-comment">// if (!currentHtml || currentHtml.trim() === '' || currentHtml === '&lt;p&gt;&lt;br&gt;&lt;/p&gt;') {</span>
        <span class="hljs-comment">//   var newHtml = '&lt;p&gt;' + latex + '&lt;/p&gt;';</span>
        <span class="hljs-comment">//   editor.setHtml(newHtml);</span>
        <span class="hljs-comment">//   console.log('è®¾ç½®æ–°HTML:', newHtml);</span>
        <span class="hljs-comment">// } else {</span>
        <span class="hljs-comment">//   // åœ¨ç°æœ‰å†…å®¹åæ·»åŠ </span>
        <span class="hljs-comment">//   var newHtml = currentHtml + latex;</span>
        <span class="hljs-comment">//   editor.setHtml(newHtml);</span>
        <span class="hljs-comment">//   console.log('è¿½åŠ åˆ°ç°æœ‰HTML:', newHtml);</span>
        <span class="hljs-comment">// }</span>
        <span class="hljs-keyword">var</span> newHtml = <span class="hljs-variable language_">this</span>.<span class="hljs-property">WangEditorPluginFormula</span>.<span class="hljs-property">default</span>.<span class="hljs-property">elemsToHtml</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">elemToHtml</span>({<span class="hljs-attr">value</span>: latex},<span class="hljs-string">""</span>);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è®¾ç½®æ–°HTML:'</span>, newHtml);
        editor.<span class="hljs-title function_">focus</span>();
        <span class="hljs-keyword">if</span> (!currentHtml || currentHtml.<span class="hljs-title function_">trim</span>() === <span class="hljs-string">''</span> || currentHtml === <span class="hljs-string">'&lt;p&gt;&lt;br&gt;&lt;/p&gt;'</span>) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ä½¿ç”¨ setHtml æ–¹æ³•æ’å…¥ LaTeX æ–‡æœ¬'</span>);
          editor.<span class="hljs-title function_">setHtml</span>(newHtml);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ›¿æ¢ LaTeX æ–‡æœ¬'</span>);

          <span class="hljs-keyword">let</span> selectedElem = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getSelectedElem</span>(editor)
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'selectedElem'</span>, selectedElem);
          <span class="hljs-keyword">if</span> (selectedElem == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'selectedElem.value'</span>, selectedElem.<span class="hljs-property">value</span>);
          <span class="hljs-comment">// ä» wangEditor è·å–é€‰ä¸­çš„å…ƒç´ </span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'SlateTransforms'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">SlateTransforms</span>);
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'DomEditor'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">DomEditor</span>);

          <span class="hljs-keyword">const</span> path = <span class="hljs-variable language_">this</span>.<span class="hljs-property">DomEditor</span>.<span class="hljs-title function_">findPath</span>(editor, selectedElem)
          <span class="hljs-keyword">const</span> props = { <span class="hljs-attr">value</span>: latex }
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">SlateTransforms</span>.<span class="hljs-title function_">setNodes</span>(editor, props, { <span class="hljs-attr">at</span>: path })

        }

        <span class="hljs-comment">// è§¦å‘å†…å®¹å˜åŒ–äº‹ä»¶ï¼Œè®© renderFormulaNodes å¤„ç†</span>
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
          <span class="hljs-keyword">var</span> verifyHtml = editor.<span class="hljs-title function_">getHtml</span>();
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ’å…¥åçš„HTML:'</span>, verifyHtml);

          <span class="hljs-comment">// æ‰‹åŠ¨è§¦å‘å…¬å¼æ¸²æŸ“</span>
          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">renderFormulaNodes</span> === <span class="hljs-string">'function'</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'è§¦å‘å…¬å¼æ¸²æŸ“'</span>);
            <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">renderFormulaNodes</span>(<span class="hljs-string">'standard'</span>);
          }
        }, <span class="hljs-number">100</span>);

      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'setHtml æ’å…¥å¤±è´¥:'</span>, error);
        <span class="hljs-comment">// å¦‚æœ setHtml å¤±è´¥ï¼Œå°è¯•ä½¿ç”¨ insertText</span>
        <span class="hljs-keyword">try</span> {
          editor.<span class="hljs-title function_">insertText</span>(latex);
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ä½¿ç”¨ insertText ä½œä¸ºå¤‡ç”¨æ–¹æ¡ˆ'</span>);
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'insertText ä¹Ÿå¤±è´¥:'</span>, e);
        }
      }

      <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastLatex</span> = latex;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastInsertAt</span> = now;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"===========================formulaNode"</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(formulaNode);
      editor.<span class="hljs-title function_">hidePanelOrModal</span>();
    });

    <span class="hljs-keyword">return</span> $content[<span class="hljs-number">0</span>]; <span class="hljs-comment">// è¿”å› DOM Element ç±»å‹</span>

    <span class="hljs-comment">// PSï¼šä¹Ÿå¯ä»¥æŠŠ $content ç¼“å­˜ä¸‹æ¥ï¼Œè¿™æ ·ä¸ç”¨æ¯æ¬¡é‡å¤åˆ›å»ºã€é‡å¤ç»‘å®šäº‹ä»¶ï¼Œä¼˜åŒ–æ€§èƒ½</span>
  }
}

<span class="hljs-keyword">const</span> editKityFormula = {
  <span class="hljs-attr">key</span>: <span class="hljs-string">"editKityFormula"</span>, <span class="hljs-comment">// menu key ï¼Œå”¯ä¸€ã€‚æ³¨å†Œä¹‹åï¼Œéœ€é€šè¿‡ toolbarKeys é…ç½®åˆ°å·¥å…·æ </span>
  <span class="hljs-title function_">factory</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EditKityFormulaMenu</span>();
  },
};

<span class="hljs-comment">// æš´éœ²å…¨å±€å˜é‡</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">editKityFormula</span> = editKityFormula;

<span class="hljs-comment">// // åˆ›å»º EditKityFormulaMenu ç±»çš„å®ä¾‹</span>
<span class="hljs-comment">// const myKityFormulaMenuInstance = new EditKityFormulaMenu();</span>
<span class="hljs-comment">// // å¯¼å‡º exec æ–¹æ³•</span>
<span class="hljs-comment">// window.exec = myKityFormulaMenuInstance.exec;</span>
</code></pre>
<h3 data-id="heading-5">ä¸‰ã€æ•ˆæœå›¾</h3>
<p>1ã€‚æ‰“å¼€å…¬å¼ç¼–è¾‘å™¨æ•ˆæœ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0643b0cc41624f7f8093cffc2337d8e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGdsaXV5aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=YvG8A%2B%2BFcUDEdDs7B9I%2BAqELvTU%3D" alt="0a7bcbd33c970a9eda5265fb38a47422.png" loading="lazy"/></p>
<p>2.æ’å…¥å…‰æ˜¯æ•ˆæœ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/689780a2de93449dacf574ec6c6c3093~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGdsaXV5aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=K%2BLt0t7ezYCO3Py8JMWhY%2FMzTIs%3D" alt="02406b77fed37bd14842ee4f8472d58c.png" loading="lazy"/></p>
<p>3.ç¼–è¾‘èœå•æ•ˆæœ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90909cd359ec456c82a726830e225bb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGdsaXV5aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768460206&amp;x-signature=YqUV94sUlLhksxhuUX1KHKbC1n0%3D" alt="16be29a48130e659b1b23205d0bdb21d.png" loading="lazy"/></p>
<h3 data-id="heading-6">å››ã€åè®°</h3>
<p>å¸Œæœ›å®˜æ–¹èƒ½æä¾›ä¸‹æ¥å£æ–‡æ¡£ï¼Œæ–¹ä¾¿å¼€å‘è€…äºŒæ¬¡å¼€å‘ï¼Œè‡ªå·±çˆ¬æºç å¤ªæµªè´¹æ—¶é—´äº†ï¼Œä¸è¿‡æºç å†™çš„çš„ç¡®ä¸é”™ï¼Œèµå¿ƒæ‚¦ç›®ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python ä¸­é™¤ Ecception å¤–çš„ä¸‰ç±»ç³»ç»Ÿå¼‚å¸¸]]></title>    <link>https://juejin.cn/post/7592548677744427054</link>    <guid>https://juejin.cn/post/7592548677744427054</guid>    <pubDate>2026-01-08T03:27:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592548677744427054" data-draft-id="7592816646854049842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python ä¸­é™¤ Ecception å¤–çš„ä¸‰ç±»ç³»ç»Ÿå¼‚å¸¸"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-08T03:27:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·430351025068"/> <meta itemprop="url" content="https://juejin.cn/user/2578777865980459"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python ä¸­é™¤ Ecception å¤–çš„ä¸‰ç±»ç³»ç»Ÿå¼‚å¸¸
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2578777865980459/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·430351025068
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:27:22.000Z" title="Thu Jan 08 2026 03:27:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>KeyboardInterruptã€SystemExitã€ GeneratorExit</p>
</blockquote>
<h2 data-id="heading-0">1ã€python å†…ç½®çš„å¼‚å¸¸ å±‚æ¬¡ç»“æ„</h2>
<ul>
<li>å››å¤§ç³»ç»Ÿçº§å¼‚å¸¸ (ç›´æ¥ç»§æ‰¿BaseException)
<pre><code class="hljs language-python" lang="python">å¼‚å¸¸ç±»å‹	          è§¦å‘åœºæ™¯	            ä»£ç è®¾è®¡å»ºè®®æ•è·	            åŸå› 
Exception        æ‰€æœ‰å¸¸è§„å¼‚å¸¸çš„çˆ¶ç±»        å…¶å­ç±» âœ… åº”è¯¥	   å¸¸è§„ç¨‹åºé”™è¯¯ï¼Œåº”è¯¥å¤„ç†
KeyboardInterrupt	ç”¨æˆ·æŒ‰ Ctrl+C	        âš ï¸ è°¨æ…	           ä»…ç”¨äºæ¸…ç†èµ„æºï¼Œä¸è¦å®Œå…¨å¿½ç•¥
SystemExit	        sys.exit() è°ƒç”¨	        âŒ ä¸å»ºè®®	      è®©ç¨‹åºæ­£å¸¸é€€å‡ºï¼Œé™¤éæœ‰ç‰¹æ®Šéœ€æ±‚
GeneratorExit	    ç”Ÿæˆå™¨å…³é—­	            âŒ ä¸éœ€è¦	      ç”Ÿæˆå™¨å†…éƒ¨é€šå¸¸ä¸éœ€è¦å¤„ç†
</code></pre>
</li>
</ul>
<h2 data-id="heading-1">2ã€KeyboardInterrupt å¼‚å¸¸æ•è·</h2>
<ul>
<li>æ•è·åå¯ä»¥æ‰§è¡Œæ¸…ç†æ“ä½œï¼Œè€Œä¸æ˜¯ç«‹å³ç»ˆæ­¢ç¨‹åºã€‚</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">try</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æŒ‰Ctrl+Cä¸­æ–­ç¨‹åº..."</span>)
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        <span class="hljs-keyword">pass</span>  <span class="hljs-comment"># æ— é™å¾ªç¯</span>
<span class="hljs-keyword">except</span> KeyboardInterrupt:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\næ•è·åˆ°é”®ç›˜ä¸­æ–­ï¼"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¯ä»¥ä¼˜é›…åœ°æ¸…ç†èµ„æº..."</span>)

<span class="hljs-comment"># ç”¨æˆ·æŒ‰Ctrl+Cåè¾“å‡ºï¼š</span>
<span class="hljs-comment"># æŒ‰Ctrl+Cä¸­æ–­ç¨‹åº...</span>
<span class="hljs-comment"># æ•è·åˆ°é”®ç›˜ä¸­æ–­ï¼</span>
<span class="hljs-comment"># å¯ä»¥ä¼˜é›…åœ°æ¸…ç†èµ„æº...</span>
</code></pre>
<h2 data-id="heading-2">3ã€SystemExit å¼‚å¸¸æ•è·</h2>
<ul>
<li>æ•è·åç¨‹åºä¸ä¼šé€€å‡ºï¼Œé™¤éå†æ¬¡raiseæˆ–è°ƒç”¨sys.exit()</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys

<span class="hljs-keyword">try</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç¨‹åºå³å°†é€€å‡º..."</span>)
    sys.exit(<span class="hljs-number">42</span>)  <span class="hljs-comment"># é€€å‡ºä»£ç 42</span>
<span class="hljs-keyword">except</span> SystemExit <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ•è·åˆ°SystemExitï¼Œé€€å‡ºä»£ç : <span class="hljs-subst">{e.code}</span>"</span>)
    <span class="hljs-comment"># å¯ä»¥é€‰æ‹©é˜»æ­¢é€€å‡º</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç¨‹åºç»§ç»­è¿è¡Œï¼"</span>)

<span class="hljs-comment"># è¾“å‡ºï¼š</span>
<span class="hljs-comment"># ç¨‹åºå³å°†é€€å‡º...</span>
<span class="hljs-comment"># æ•è·åˆ°SystemExitï¼Œé€€å‡ºä»£ç : 42</span>
<span class="hljs-comment"># ç¨‹åºç»§ç»­è¿è¡Œï¼</span>
</code></pre>
<h2 data-id="heading-3">4ã€GeneratorExit å¼‚å¸¸æ•è·</h2>
<ul>
<li>å½“ç”Ÿæˆå™¨è¢«close()æˆ–åƒåœ¾å›æ”¶æ—¶ï¼Œä¼šåœ¨ç”Ÿæˆå™¨å†…éƒ¨æŠ›å‡ºGeneratorExitã€‚</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_generator</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç”Ÿæˆå™¨å¼€å§‹è¿è¡Œ"</span>)
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):
            <span class="hljs-keyword">yield</span> i
    <span class="hljs-keyword">except</span> GeneratorExit:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç”Ÿæˆå™¨è¢«å…³é—­ï¼"</span>)
        <span class="hljs-keyword">raise</span>  <span class="hljs-comment"># é‡æ–°æŠ›å‡ºï¼Œæˆ–è€…é€‰æ‹©ä¸æŠ›å‡º</span>

gen = my_generator()
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(gen))  <span class="hljs-comment"># 0</span>
<span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(gen))  <span class="hljs-comment"># 1</span>
gen.close()       <span class="hljs-comment"># å…³é—­ç”Ÿæˆå™¨</span>

<span class="hljs-comment"># è¾“å‡ºï¼š</span>
<span class="hljs-comment"># ç”Ÿæˆå™¨å¼€å§‹è¿è¡Œ</span>
<span class="hljs-comment"># 0</span>
<span class="hljs-comment"># 1</span>
<span class="hljs-comment"># ç”Ÿæˆå™¨è¢«å…³é—­ï¼</span>
</code></pre>
<h2 data-id="heading-4">5ã€å®é™…æ•è·è¡Œä¸ºå¯¹æ¯”,ä¸€ä¸ªå®Œæ•´ä¾‹å­å±•ç¤ºæ‰€æœ‰å››ç§ï¼š</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_system_exit</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== æµ‹è¯• SystemExit ==="</span>)
        sys.exit(<span class="hljs-number">100</span>)
    <span class="hljs-keyword">except</span> SystemExit <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ“ æ•è·SystemExitï¼Œé€€å‡ºä»£ç : <span class="hljs-subst">{e.code}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"  ç¨‹åºæ²¡æœ‰é€€å‡ºï¼Œç»§ç»­æ‰§è¡Œ..."</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_keyboard_interrupt</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== æµ‹è¯• KeyboardInterrupt ==="</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"  æŒ‰Ctrl+Cä¸­æ–­..."</span>)
        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            time.sleep(<span class="hljs-number">0.1</span>)
    <span class="hljs-keyword">except</span> KeyboardInterrupt:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\nâœ“ æ•è·KeyboardInterrupt"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"  ç¨‹åºä¼˜é›…é€€å‡º..."</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_generator_exit</span>():
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== æµ‹è¯• GeneratorExit ==="</span>)
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generator</span>():
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):
                <span class="hljs-keyword">yield</span> i
        <span class="hljs-keyword">except</span> GeneratorExit:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"  âœ“ æ•è·GeneratorExit"</span>)
            <span class="hljs-keyword">raise</span>  <span class="hljs-comment"># é‡æ–°æŠ›å‡º</span>
    
    gen = generator()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  ç”Ÿæˆå€¼: <span class="hljs-subst">{<span class="hljs-built_in">next</span>(gen)}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  ç”Ÿæˆå€¼: <span class="hljs-subst">{<span class="hljs-built_in">next</span>(gen)}</span>"</span>)
    gen.close()  <span class="hljs-comment"># è§¦å‘GeneratorExit</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">demo_exception</span>():
    <span class="hljs-keyword">try</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n=== æµ‹è¯• Exception ==="</span>)
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"æµ‹è¯•é”™è¯¯"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âœ“ æ•è·Exceptionå­ç±»: <span class="hljs-subst">{<span class="hljs-built_in">type</span>(e).__name__}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"  æ¶ˆæ¯: <span class="hljs-subst">{e}</span>"</span>)

<span class="hljs-comment"># æ‰§è¡Œæ‰€æœ‰æµ‹è¯•</span>
demo_system_exit()
demo_generator_exit()
demo_exception()
<span class="hljs-comment"># demo_keyboard_interrupt()  # éœ€è¦æ‰‹åŠ¨æŒ‰Ctrl+Cæµ‹è¯•</span>
</code></pre>
<ul>
<li>
<p>å¥½çš„å®è·µ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åœºæ™¯1ï¼šå¤„ç†å¸¸è§„å¼‚å¸¸</span>
<span class="hljs-keyword">try</span>:
    data = risky_operation()
<span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å‚æ•°é”™è¯¯: <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-keyword">except</span> (IndexError, KeyError) <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è®¿é—®é”™è¯¯: <span class="hljs-subst">{e}</span>"</span>)
<span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æœªçŸ¥é”™è¯¯: <span class="hljs-subst">{e}</span>"</span>)
    logger.exception(<span class="hljs-string">"å‘ç”Ÿå¼‚å¸¸"</span>)

<span class="hljs-comment"># åœºæ™¯2ï¼šæ•è·KeyboardInterruptè¿›è¡Œæ¸…ç†</span>
<span class="hljs-keyword">try</span>:
    main_loop()
<span class="hljs-keyword">except</span> KeyboardInterrupt:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\næ”¶åˆ°ä¸­æ–­ä¿¡å·..."</span>)
    cleanup_resources()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"èµ„æºæ¸…ç†å®Œæˆï¼Œé€€å‡ºã€‚"</span>)
    sys.exit(<span class="hljs-number">0</span>)  <span class="hljs-comment"># æ˜ç¡®é€€å‡º    </span>
</code></pre>
</li>
<li>
<p>âŒ ä¸å¥½çš„å®è·µ</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># è¿‡åº¦æ•è·KeyboardInterrupt</span>
<span class="hljs-keyword">try</span>:
    everything()
<span class="hljs-keyword">except</span> KeyboardInterrupt:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç”¨æˆ·æƒ³é€€å‡ºï¼Œä½†æˆ‘ä¸è®©ä»–é€€å‡ºï¼"</span>)
    <span class="hljs-comment"># ç»§ç»­è¿è¡Œ... è¿™ä¼šè®©ç”¨æˆ·å›°æƒ‘</span>

<span class="hljs-comment"># æ•è·SystemExité˜»æ­¢ç¨‹åºé€€å‡º</span>
<span class="hljs-keyword">try</span>:
    sys.exit(<span class="hljs-number">1</span>)
<span class="hljs-keyword">except</span> SystemExit:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç¨‹åºæƒ³é€€å‡ºï¼Œä½†æˆ‘ä¸å…è®¸ï¼"</span>)
    <span class="hljs-comment"># ç»§ç»­è¿è¡Œ... è¿™ä¼šç ´åé€€å‡ºé€»è¾‘</span>
</code></pre>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš€ æ•°æ®åº“æ’å…¥ 1000 ä¸‡æ•°æ®ï¼Ÿåˆ«å†å‚»å‚»ç”¨ for å¾ªç¯äº†ï¼å®æµ‹ 5 ç§æ–¹å¼æ•ˆç‡å¯¹æ¯”]]></title>    <link>https://juejin.cn/post/7592451588849057811</link>    <guid>https://juejin.cn/post/7592451588849057811</guid>    <pubDate>2026-01-08T03:28:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7592451588849057811" data-draft-id="7592524811860901922" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€ æ•°æ®åº“æ’å…¥ 1000 ä¸‡æ•°æ®ï¼Ÿåˆ«å†å‚»å‚»ç”¨ for å¾ªç¯äº†ï¼å®æµ‹ 5 ç§æ–¹å¼æ•ˆç‡å¯¹æ¯”"/> <meta itemprop="keywords" content="æ•°æ®åº“,åç«¯"/> <meta itemprop="datePublished" content="2026-01-08T03:28:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JOEH60"/> <meta itemprop="url" content="https://juejin.cn/user/1750078239803614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€ æ•°æ®åº“æ’å…¥ 1000 ä¸‡æ•°æ®ï¼Ÿåˆ«å†å‚»å‚»ç”¨ for å¾ªç¯äº†ï¼å®æµ‹ 5 ç§æ–¹å¼æ•ˆç‡å¯¹æ¯”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1750078239803614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JOEH60
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-08T03:28:00.000Z" title="Thu Jan 08 2026 03:28:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ—¥å¸¸çš„åç«¯å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°æ•°æ®è¿ç§»ã€åˆå§‹åŒ–ã€æˆ–è€…æ—¥å¿—å½’æ¡£ç­‰åœºæ™¯ï¼Œéœ€è¦å‘æ•°æ®åº“ä¸­å¯¼å…¥æµ·é‡æ•°æ®ã€‚</p>
<p>"è€æ¿è®©æˆ‘å¾€æ•°æ®åº“æ’ 1000 ä¸‡æ¡æ•°æ®ï¼Œæˆ‘å†™äº†ä¸ª <code>for</code> å¾ªç¯ï¼Œè·‘äº†ä¸€æ™šä¸Šè¿˜æ²¡è·‘å®Œ..."</p>
<p>å¦‚æœä½ è¿˜åœ¨ç”¨ <code>for</code> å¾ªç¯å•æ¡æ’å…¥ï¼Œé‚£è¿™ç¯‡é€šè¿‡å®æµ‹æ•°æ®è¯´è¯çš„æ–‡ç« ï¼Œç»å¯¹èƒ½å¸®ä½ æ‰“å¼€æ–°ä¸–ç•Œçš„å¤§é—¨ã€‚ä»Šå¤©æˆ‘ä»¬å°±ä»¥ <strong>MySQL</strong> ä¸ºä¾‹ï¼Œå®æµ‹å¯¹æ¯” <strong>5 ç§</strong> å¸¸è§çš„æ’å…¥æ–¹å¼ï¼Œçœ‹çœ‹è°æ‰æ˜¯çœŸæ­£çš„â€œæ€§èƒ½ä¹‹ç‹â€ã€‚</p>
<h2 data-id="heading-0">ğŸ› ï¸ æµ‹è¯•ç¯å¢ƒä¸å‡†å¤‡</h2>
<p>ä¸ºäº†ä¿è¯æµ‹è¯•çš„å…¬å¹³æ€§ï¼Œæˆ‘ä»¬ç»Ÿä¸€æµ‹è¯•ç¯å¢ƒï¼š</p>
<ul>
<li><strong>æ•°æ®åº“</strong>ï¼šMySQL 8.0 (Docker éƒ¨ç½²)</li>
<li><strong>ORM æ¡†æ¶</strong>ï¼šSpring Data JPA (Hibernate) / MyBatis / JDBC</li>
<li><strong>æµ‹è¯•æ•°æ®é‡</strong>ï¼š1000 ä¸‡æ¡ (åˆ†æ‰¹æ¬¡æµ‹è¯•)</li>
<li><strong>è¡¨ç»“æ„</strong>ï¼šä¸€å¼ ç®€å•çš„ç”¨æˆ·è¡¨ <code>user</code> (id, username, password, email, create_time)</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `<span class="hljs-keyword">user</span>` (
  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  `username` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `password` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `email` <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  `create_time` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;
</code></pre>
<h2 data-id="heading-1">1. ğŸ¢ é’é“œé€‰æ‰‹ï¼šFor å¾ªç¯å•æ¡ Insert</h2>
<p>è¿™æ˜¯æœ€ç›´è§‚ã€æœ€å®¹æ˜“æƒ³åˆ°çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯æ€§èƒ½æœ€å·®çš„æ–¹å¼ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹ (JPA):</strong></p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertOneByOne</span><span class="hljs-params">(List&lt;User&gt; users)</span> {
    <span class="hljs-keyword">for</span> (User user : users) {
        userRepository.save(user);
    }
}
</code></pre>
<p><strong>åŸç†åˆ†æ</strong>ï¼š<br/>
æ¯ä¸€æ¬¡Â saveÂ æ“ä½œï¼Œéƒ½ä¼šå»ºç«‹ä¸€æ¬¡æ•°æ®åº“è¿æ¥ï¼Œå‘é€ SQLï¼Œæ‰§è¡Œï¼Œæäº¤äº‹åŠ¡ï¼Œå…³é—­è¿æ¥ã€‚<br/>
1000 ä¸‡æ¬¡ç½‘ç»œ I/O + 1000 ä¸‡æ¬¡äº‹åŠ¡å¼€é”€ =Â <strong>ç¾éš¾</strong>ã€‚</p>
<p><strong>å®æµ‹ç»“æœ</strong>ï¼š<br/>
æ’å…¥ 1 ä¸‡æ¡æ•°æ®è€—æ—¶çº¦Â <strong>50 ç§’</strong>ã€‚<br/>
æ¨ç®—æ’å…¥ 1000 ä¸‡æ¡æ•°æ®éœ€è¦Â <strong>138 å°æ—¶</strong>Â (çº¦ 5.7 å¤©)ã€‚<br/>
<strong>è¯„ä»·</strong>ï¼šé™¤éä½ æ˜¯åœ¨å†™ Hello Worldï¼Œå¦åˆ™<strong>ä¸¥ç¦</strong>åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚</p>
<h2 data-id="heading-2">2. ğŸ¥ˆ ç™½é“¶é€‰æ‰‹ï¼šJPA çš„Â saveAllÂ (ä¼ªæ‰¹é‡)</h2>
<p>Spring Data JPA æä¾›äº†Â saveAllÂ æ–¹æ³•ï¼Œçœ‹èµ·æ¥åƒæ˜¯æ‰¹é‡æ“ä½œï¼Œä½†çœŸçš„å¿«å—ï¼Ÿ</p>
<p><strong>ä»£ç ç¤ºä¾‹:</strong></p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveAll</span><span class="hljs-params">(List&lt;User&gt; users)</span> {
    userRepository.saveAll(users);
}
</code></pre>
<p><strong>åŸç†åˆ†æ</strong>ï¼š<br/>
é»˜è®¤é…ç½®ä¸‹ï¼ŒHibernate çš„Â saveAllÂ å…¶å®è¿˜æ˜¯<strong>å¾ªç¯è°ƒç”¨Â save</strong>ã€‚è™½ç„¶å®ƒåœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå‡å°‘äº†äº‹åŠ¡æäº¤çš„æ¬¡æ•°ï¼Œä½† SQL ä¾ç„¶æ˜¯ä¸€æ¡ä¸€æ¡å‘çš„ã€‚<br/>
INSERT INTO user ...<br/>
INSERT INTO user ...</p>
<p><strong>å®æµ‹ç»“æœ</strong>ï¼š<br/>
æ’å…¥ 10 ä¸‡æ¡æ•°æ®è€—æ—¶çº¦Â <strong>12 ç§’</strong>ã€‚<br/>
æ¨ç®— 1000 ä¸‡æ¡æ•°æ®éœ€è¦Â <strong>20 åˆ†é’Ÿ</strong>ã€‚<br/>
<strong>è¯„ä»·</strong>ï¼šæ¯”å•æ¡å¿«äº†ä¸å°‘ï¼Œä½†ä¾ç„¶ä¸å¤Ÿçœ‹ã€‚</p>
<p><strong>ğŸ’¡ ä¼˜åŒ– Tip</strong>ï¼š<br/>
å¯ä»¥é€šè¿‡é…ç½®Â spring.jpa.properties.hibernate.jdbc.batch_size=1000Â å¼€å¯ Hibernate çš„æ‰¹é‡æ’å…¥æ”¯æŒï¼Œæ€§èƒ½ä¼šæœ‰æ‰€æå‡ï¼Œä½†ä¾ç„¶å—é™äº Hibernate çš„ä¸€çº§ç¼“å­˜æœºåˆ¶ï¼Œå†…å­˜å ç”¨è¾ƒé«˜ã€‚</p>
<h2 data-id="heading-3">3. ğŸ¥‡ é»„é‡‘é€‰æ‰‹ï¼šMyBatis çš„Â foreachÂ æ‹¼æ¥ SQL</h2>
<p>è¿™æ˜¯ MyBatis ç”¨æˆ·æœ€å¸¸ç”¨çš„æ‰¹é‡æ’å…¥æ–¹å¼ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹ (XML):</strong></p>
<pre><code class="hljs language-Xml" lang="Xml"><span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"batchInsert"</span>&gt;</span>
  INSERT INTO user (username, password, email, create_time) VALUES
  <span class="hljs-tag">&lt;<span class="hljs-name">foreach</span> <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> <span class="hljs-attr">item</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">separator</span>=<span class="hljs-string">","</span>&gt;</span>
    (#{item.username}, #{item.password}, #{item.email}, #{item.createTime})
  <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
</code></pre>
<p><strong>åŸç†åˆ†æ</strong>ï¼š<br/>
è¿™ç§æ–¹å¼ä¼šç”Ÿæˆä¸€æ¡å·¨é•¿çš„ SQLï¼š<br/>
INSERT INTO user (...) VALUES (...), (...), (...);<br/>
æ•°æ®åº“åªéœ€è¦è§£æä¸€æ¬¡ SQLï¼Œæ„å»ºä¸€æ¬¡æ‰§è¡Œè®¡åˆ’ï¼Œå¤§å¤§å‡å°‘äº†ç½‘ç»œ I/O å’Œæ•°æ®åº“è§£æå¼€é”€ã€‚</p>
<p><strong>å®æµ‹ç»“æœ</strong>ï¼š<br/>
æ’å…¥ 10 ä¸‡æ¡æ•°æ®è€—æ—¶çº¦Â <strong>2-3 ç§’</strong>ã€‚<br/>
æ¨ç®— 1000 ä¸‡æ¡æ•°æ®éœ€è¦Â <strong>3-5 åˆ†é’Ÿ</strong>ã€‚<br/>
<strong>è¯„ä»·</strong>ï¼šæ€§èƒ½éå¸¸ä¸é”™ï¼Œæ˜¯æ—¥å¸¸å¼€å‘çš„é¦–é€‰ã€‚</p>
<p><strong>âš ï¸ æ³¨æ„</strong>ï¼š</p>
<ul>
<li><strong>SQL é•¿åº¦é™åˆ¶</strong>ï¼šMySQL å¯¹ SQL è¯­å¥é•¿åº¦æœ‰é™åˆ¶ (max_allowed_packet)ï¼Œé»˜è®¤ 4MBã€‚å¦‚æœä¸€æ¬¡æ‹¼æ¥å¤ªå¤šæ•°æ®ï¼Œä¼šæŠ¥é”™ã€‚å»ºè®®åˆ†æ‰¹ï¼Œæ¯æ‰¹ 1000-5000 æ¡ã€‚</li>
<li><strong>è§£ææˆæœ¬</strong>ï¼šMyBatis è§£æåŠ¨æ€ SQL ä¹Ÿéœ€è¦æ—¶é—´ï¼Œæ•°æ®é‡è¿‡å¤§æ—¶è§£æä¼šå˜æ…¢ã€‚</li>
</ul>
<h2 data-id="heading-4">4. ğŸ’ é’»çŸ³é€‰æ‰‹ï¼šåŸç”Ÿ JDBC Batch</h2>
<p>å›å½’æœ¬è´¨ï¼Œä½¿ç”¨æœ€åº•å±‚çš„ JDBC æ‰¹å¤„ç†ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹:</strong></p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">jdbcBatchInsert</span><span class="hljs-params">(List&lt;User&gt; users)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">sql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"INSERT INTO user (username, password, email, create_time) VALUES (?, ?, ?, ?)"</span>;
    <span class="hljs-keyword">try</span> (<span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> dataSource.getConnection();
         <span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> conn.prepareStatement(sql)) {
        conn.setAutoCommit(<span class="hljs-literal">false</span>); <span class="hljs-comment">// å¼€å¯äº‹åŠ¡</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; users.size(); i++) {
            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> users.get(i);
            ps.setString(<span class="hljs-number">1</span>, user.getUsername());
            <span class="hljs-comment">// ... è®¾ç½®å…¶ä»–å‚æ•°</span>
            ps.addBatch();
            <span class="hljs-keyword">if</span> ((i + <span class="hljs-number">1</span>) % <span class="hljs-number">1000</span> == <span class="hljs-number">0</span>) {
                ps.executeBatch(); <span class="hljs-comment">// æ‰§è¡Œæ‰¹å¤„ç†</span>
                ps.clearBatch();
            }
        }
        ps.executeBatch(); <span class="hljs-comment">// å¤„ç†å‰©ä½™æ•°æ®</span>
        conn.commit();
    } <span class="hljs-keyword">catch</span> (Exception e) {
        e.printStackTrace();
    }
}
</code></pre>
<p><strong>å…³é”®é…ç½®</strong>ï¼š<br/>
è¿æ¥å­—ç¬¦ä¸²å¿…é¡»åŠ ä¸ŠÂ rewriteBatchedStatements=trueï¼Œå¦åˆ™Â executeBatchÂ ä¾ç„¶æ˜¯ä¸€æ¡æ¡å‘é€ï¼<br/>
jdbc:mysql://localhost:3306/test?rewriteBatchedStatements=true</p>
<p><strong>åŸç†åˆ†æ</strong>ï¼š<br/>
å¼€å¯Â rewriteBatchedStatementsÂ åï¼ŒMySQL é©±åŠ¨ä¼šåœ¨å®¢æˆ·ç«¯å°†å¤šæ¡Â INSERTÂ è¯­å¥é‡å†™ä¸ºÂ INSERT ... VALUES (...), (...)Â çš„å½¢å¼ã€‚ç›¸æ¯” MyBatisï¼Œå®ƒçœå»äº†æ¡†æ¶è§£æ XML å’Œæ˜ å°„å¯¹è±¡çš„å¼€é”€ã€‚</p>
<p><strong>å®æµ‹ç»“æœ</strong>ï¼š<br/>
æ’å…¥ 10 ä¸‡æ¡æ•°æ®è€—æ—¶çº¦Â <strong>1.5 ç§’</strong>ã€‚<br/>
æ¨ç®— 1000 ä¸‡æ¡æ•°æ®éœ€è¦Â <strong>2.5 åˆ†é’Ÿ</strong>ã€‚<br/>
<strong>è¯„ä»·</strong>ï¼šæ€§èƒ½æè‡´ï¼Œå†…å­˜å ç”¨ä½ï¼Œé€‚åˆå¯¹æ€§èƒ½æœ‰æé«˜è¦æ±‚çš„åœºæ™¯ã€‚</p>
<h2 data-id="heading-5">5. ğŸ‘‘ ç‹è€…é€‰æ‰‹ï¼šMySQLÂ LOAD DATA INFILE</h2>
<p>å¦‚æœè¯´å‰é¢çš„éƒ½æ˜¯åœ¨â€œå†™ä»£ç â€ï¼Œé‚£è¿™ä¸ªå°±æ˜¯åœ¨â€œå¼€æŒ‚â€ã€‚è¿™æ˜¯ MySQL å®˜æ–¹æä¾›çš„æ–‡ä»¶å¯¼å…¥å‘½ä»¤ã€‚</p>
<p><strong>ä»£ç ç¤ºä¾‹:</strong></p>
<pre><code class="hljs language-SQL" lang="SQL">LOAD DATA INFILE <span class="hljs-string">'/data/users.csv'</span>
<span class="hljs-keyword">INTO</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span>
FIELDS TERMINATED <span class="hljs-keyword">BY</span> <span class="hljs-string">','</span> 
LINES TERMINATED <span class="hljs-keyword">BY</span> <span class="hljs-string">'\n'</span>
(username, password, email, create_time);
</code></pre>
<p><strong>åŸç†åˆ†æ</strong>ï¼š<br/>
ç›´æ¥è¯»å–æ–‡ä»¶æµï¼Œç»•è¿‡äº† SQL è§£æå±‚ï¼Œç›´æ¥æ“ä½œå­˜å‚¨å¼•æ“ã€‚è¿™æ˜¯æ•°æ®åº“å¯¼å…¥æ•°æ®çš„<strong>æœ€å¿«æ–¹å¼</strong>ï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚</p>
<p><strong>å®æµ‹ç»“æœ</strong>ï¼š<br/>
æ’å…¥ 1000 ä¸‡æ¡æ•°æ®è€—æ—¶çº¦Â <strong>1-2 åˆ†é’Ÿ</strong>Â (å–å†³äºç£ç›˜ IO)ã€‚<br/>
<strong>è¯„ä»·</strong>ï¼šé™ç»´æ‰“å‡»ã€‚</p>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>éœ€è¦å…ˆç”Ÿæˆæ–‡ä»¶ï¼ˆCSV/TXTï¼‰ã€‚</li>
<li>éœ€è¦æ•°æ®åº“æœåŠ¡å™¨çš„æ–‡ä»¶è¯»å–æƒé™ã€‚</li>
<li>é€»è¾‘è¾ƒæ­»æ¿ï¼Œä¸é€‚åˆå¤æ‚çš„ä¸šåŠ¡æ ¡éªŒã€‚</li>
</ul>
<h2 data-id="heading-6">ğŸ“Š æœ€ç»ˆæ’è¡Œæ¦œ (1000 ä¸‡æ•°æ®ä¼°ç®—)</h2>





















































<table><thead><tr><th>æ’å</th><th>æ–¹å¼</th><th>è€—æ—¶ä¼°ç®—</th><th>å¤æ‚åº¦</th><th>æ¨èæŒ‡æ•°</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>1</strong></td><td><strong>LOAD DATA INFILE</strong></td><td><strong>~1 åˆ†é’Ÿ</strong></td><td>é«˜ (éœ€æ–‡ä»¶)</td><td>â­â­â­</td><td>ç¦»çº¿æ•°æ®è¿ç§»ã€åˆå§‹åŒ–</td></tr><tr><td><strong>2</strong></td><td><strong>JDBC Batch</strong></td><td><strong>~2.5 åˆ†é’Ÿ</strong></td><td>ä¸­</td><td>â­â­â­â­â­</td><td>é«˜æ€§èƒ½ä¸šåŠ¡ä»£ç </td></tr><tr><td><strong>3</strong></td><td><strong>MyBatis Foreach</strong></td><td><strong>~4 åˆ†é’Ÿ</strong></td><td>ä½</td><td>â­â­â­â­</td><td>æ—¥å¸¸æ‰¹é‡æ“ä½œ (ä¸­å°æ•°æ®é‡)</td></tr><tr><td><strong>4</strong></td><td><strong>JPA saveAll</strong></td><td><strong>~20 åˆ†é’Ÿ</strong></td><td>æä½</td><td>â­â­</td><td>å°‘é‡æ•°æ®ï¼Œå·æ‡’ä¸“ç”¨</td></tr><tr><td><strong>5</strong></td><td><strong>For å¾ªç¯å•æ’</strong></td><td><strong>~5.7 å¤©</strong></td><td>ä½</td><td>â˜ ï¸</td><td><strong>ç¦»èŒå‰ä»¥æ­¤ä»£ç äº¤æ¥</strong></td></tr></tbody></table>
<h2 data-id="heading-7">ğŸ’¡ æ€»ç»“ä¸å»ºè®®</h2>
<ol>
<li><strong>æ—¥å¸¸å¼€å‘ (å‡ åƒ/å‡ ä¸‡æ¡)</strong> ï¼šç›´æ¥ç”¨Â <strong>MyBatisÂ foreach</strong>ï¼Œç®€å•æ–¹ä¾¿ï¼Œæ€§èƒ½è¶³å¤Ÿã€‚è®°å¾—åˆ†æ‰¹ï¼ˆæ¯æ‰¹ 1000 æ¡å·¦å³ï¼‰ã€‚</li>
<li><strong>é«˜æ€§èƒ½è¦æ±‚ (å‡ åä¸‡/ç™¾ä¸‡æ¡)</strong> ï¼šä½¿ç”¨Â <strong>JDBC Batch</strong>ï¼Œå¹¶å¼€å¯Â rewriteBatchedStatements=trueã€‚</li>
<li><strong>æµ·é‡æ•°æ®è¿ç§» (åƒä¸‡/äº¿çº§)</strong> ï¼šåˆ«çŠ¹è±«ï¼Œç”Ÿæˆ CSV æ–‡ä»¶ï¼Œç”¨Â <strong>LOAD DATA INFILE</strong>ã€‚</li>
<li><strong>æ°¸è¿œä¸è¦</strong>åœ¨å¾ªç¯é‡Œå†™ SQL æ’å…¥ï¼</li>
</ol>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ é¿å¼€æ€§èƒ½å‘ï¼Œæˆä¸ºå›¢é˜Ÿé‡Œçš„â€œæ€§èƒ½ä¼˜åŒ–å¤§å¸ˆâ€ï¼è§‰å¾—æœ‰ç”¨ç‚¹ä¸ªèµå§ ğŸ‘</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>