<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[MongoDB（6）什么是BSON？]]></title>    <link>https://juejin.cn/post/7605145921618952244</link>    <guid>https://juejin.cn/post/7605145921618952244</guid>    <pubDate>2026-02-11T14:55:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605145921618952244" data-draft-id="7605206033267474467" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MongoDB（6）什么是BSON？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-11T14:55:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MongoDB（6）什么是BSON？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T14:55:05.000Z" title="Wed Feb 11 2026 14:55:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>BSON（Binary JSON）是MongoDB中用于存储和传输文档数据的二进制格式。BSON是一种类似于JSON的二进制编码，它不仅支持JSON中的所有数据类型，还扩展了更多的数据类型，如日期、整数、浮点数和二进制数据。由于其二进制形式，BSON能够高效地存储和解析数据。</p>
<h3 data-id="heading-0">特点</h3>
<ol>
<li><strong>二进制格式</strong>：BSON是二进制格式，比纯文本JSON更高效。</li>
<li><strong>丰富的数据类型</strong>：支持更多的数据类型，适用于各种数据需求。</li>
<li><strong>可遍历性</strong>：BSON格式便于快速遍历和解析。</li>
<li><strong>灵活性</strong>：支持嵌套文档和数组，便于表示复杂数据结构。</li>
</ol>
<h3 data-id="heading-1">数据类型</h3>
<p>BSON支持以下数据类型：</p>
<ul>
<li>null</li>
<li>布尔型</li>
<li>整数（32位和64位）</li>
<li>浮点数（双精度）</li>
<li>字符串</li>
<li>文档（类似于JSON对象）</li>
<li>数组</li>
<li>二进制数据</li>
<li>ObjectId</li>
<li>日期</li>
<li>正则表达式</li>
</ul>
<h3 data-id="heading-2">示例</h3>
<p>以下是如何使用BSON进行文档编码和解码的示例。在实际应用中，MongoDB驱动程序会自动处理BSON的编码和解码，但了解其工作原理有助于更深入地理解MongoDB的数据存储机制。</p>
<h4 data-id="heading-3">1. 安装依赖</h4>
<p>首先，需要安装<code>bson</code>包来进行BSON的编码和解码。可以使用npm进行安装：</p>
<pre><code class="hljs language-bash" lang="bash">npm install bson
</code></pre>
<h4 data-id="heading-4">2. 编码和解码示例</h4>
<p>以下示例展示了如何使用<code>bson</code>包对文档进行编码和解码。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BSON</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bson'</span>);
<span class="hljs-keyword">const</span> bson = <span class="hljs-keyword">new</span> <span class="hljs-title function_">BSON</span>();

<span class="hljs-comment">// 示例文档</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable language_">document</span> = {
    <span class="hljs-attr">name</span>: <span class="hljs-string">"John Doe"</span>,
    <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">isActive</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">hobbies</span>: [<span class="hljs-string">"reading"</span>, <span class="hljs-string">"traveling"</span>, <span class="hljs-string">"coding"</span>],
    <span class="hljs-attr">address</span>: {
        <span class="hljs-attr">street</span>: <span class="hljs-string">"123 Main St"</span>,
        <span class="hljs-attr">city</span>: <span class="hljs-string">"Anytown"</span>,
        <span class="hljs-attr">state</span>: <span class="hljs-string">"CA"</span>,
        <span class="hljs-attr">zip</span>: <span class="hljs-string">"12345"</span>
    },
    <span class="hljs-attr">createdAt</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),
    <span class="hljs-attr">objectId</span>: <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">BSON</span>.<span class="hljs-title class_">ObjectId</span>()
};

<span class="hljs-comment">// 编码为BSON</span>
<span class="hljs-keyword">const</span> encoded = bson.<span class="hljs-title function_">serialize</span>(<span class="hljs-variable language_">document</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Encoded BSON:'</span>, encoded);

<span class="hljs-comment">// 解码为JavaScript对象</span>
<span class="hljs-keyword">const</span> decoded = bson.<span class="hljs-title function_">deserialize</span>(encoded);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Decoded Document:'</span>, decoded);
</code></pre>
<h4 data-id="heading-5">3. BSON数据类型示例</h4>
<p>以下示例展示了BSON支持的各种数据类型。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable language_">document</span> = {
    <span class="hljs-attr">nullValue</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">booleanValue</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">int32Value</span>: <span class="hljs-number">42</span>,
    <span class="hljs-attr">int64Value</span>: <span class="hljs-variable constant_">BSON</span>.<span class="hljs-property">Long</span>.<span class="hljs-title function_">fromNumber</span>(<span class="hljs-number">1234567890123456789</span>),
    <span class="hljs-attr">doubleValue</span>: <span class="hljs-number">3.14159</span>,
    <span class="hljs-attr">stringValue</span>: <span class="hljs-string">"Hello, World!"</span>,
    <span class="hljs-attr">documentValue</span>: {
        <span class="hljs-attr">embeddedField</span>: <span class="hljs-string">"This is an embedded document"</span>
    },
    <span class="hljs-attr">arrayValue</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-string">"four"</span>],
    <span class="hljs-attr">binaryValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">BSON</span>.<span class="hljs-title class_">Binary</span>(<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>([<span class="hljs-number">0x01</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x04</span>])),
    <span class="hljs-attr">objectIdValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-variable constant_">BSON</span>.<span class="hljs-title class_">ObjectId</span>(),
    <span class="hljs-attr">dateValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),
    <span class="hljs-attr">regexValue</span>: <span class="hljs-regexp">/pattern/i</span>
};

<span class="hljs-comment">// 编码为BSON</span>
<span class="hljs-keyword">const</span> encoded = bson.<span class="hljs-title function_">serialize</span>(<span class="hljs-variable language_">document</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Encoded BSON:'</span>, encoded);

<span class="hljs-comment">// 解码为JavaScript对象</span>
<span class="hljs-keyword">const</span> decoded = bson.<span class="hljs-title function_">deserialize</span>(encoded);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Decoded Document:'</span>, decoded);
</code></pre>
<h3 data-id="heading-6">高级操作</h3>
<h4 data-id="heading-7">使用ObjectId</h4>
<p>BSON中的ObjectId是一种用于唯一标识文档的12字节标识符。它由时间戳、机器标识、进程ID和随机数构成。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">ObjectId</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bson'</span>);

<span class="hljs-comment">// 创建新的 ObjectId</span>
<span class="hljs-keyword">const</span> objectId = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectId</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Generated ObjectId:'</span>, objectId);

<span class="hljs-comment">// 从字符串解析 ObjectId</span>
<span class="hljs-keyword">const</span> parsedObjectId = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectId</span>(<span class="hljs-string">'507f1f77bcf86cd799439011'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Parsed ObjectId:'</span>, parsedObjectId);

<span class="hljs-comment">// 获取 ObjectId 的字符串表示形式</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ObjectId as String:'</span>, parsedObjectId.<span class="hljs-title function_">toHexString</span>());
</code></pre>
<h4 data-id="heading-8">编码和解码二进制数据</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">Binary</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bson'</span>);

<span class="hljs-comment">// 创建二进制数据</span>
<span class="hljs-keyword">const</span> buffer = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(<span class="hljs-string">'hello world'</span>, <span class="hljs-string">'utf-8'</span>);
<span class="hljs-keyword">const</span> binary = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Binary</span>(buffer);

<span class="hljs-comment">// 编码和解码示例文档</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable language_">document</span> = {
    <span class="hljs-attr">binaryData</span>: binary
};

<span class="hljs-comment">// 编码为BSON</span>
<span class="hljs-keyword">const</span> encoded = bson.<span class="hljs-title function_">serialize</span>(<span class="hljs-variable language_">document</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Encoded BSON:'</span>, encoded);

<span class="hljs-comment">// 解码为JavaScript对象</span>
<span class="hljs-keyword">const</span> decoded = bson.<span class="hljs-title function_">deserialize</span>(encoded);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Decoded Document:'</span>, decoded);
</code></pre>
<h3 data-id="heading-9">总结</h3>
<p>BSON是MongoDB中用于存储和传输文档数据的高效二进制格式。其主要特点和常见操作如下：</p>

































<table><thead><tr><th>特性</th><th>详细说明</th></tr></thead><tbody><tr><td>二进制格式</td><td>比纯文本JSON更高效</td></tr><tr><td>丰富的数据类型</td><td>支持更多的数据类型，如日期、整数、二进制数据</td></tr><tr><td>可遍历性</td><td>BSON格式便于快速遍历和解析</td></tr><tr><td>灵活性</td><td>支持嵌套文档和数组，适用于复杂数据结构</td></tr><tr><td>ObjectId</td><td>用于唯一标识文档的12字节标识符</td></tr><tr><td>二进制数据</td><td>支持存储和传输二进制数据</td></tr></tbody></table>
<p>通过实际代码示例，可以直观地了解如何使用BSON进行文档的编码和解码，从而更好地应用于实际项目开发中。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MongoDB（7）什么是MongoDB的索引(Index)？]]></title>    <link>https://juejin.cn/post/7605262897648975907</link>    <guid>https://juejin.cn/post/7605262897648975907</guid>    <pubDate>2026-02-11T14:55:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605262897648975907" data-draft-id="7605184380612067380" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MongoDB（7）什么是MongoDB的索引(Index)？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-11T14:55:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MongoDB（7）什么是MongoDB的索引(Index)？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T14:55:45.000Z" title="Wed Feb 11 2026 14:55:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在MongoDB中，索引（Index）是一种特殊的数据结构，用于提高查询操作的效率。索引存储在一种容易遍历的结构中，并且保存了数据集中特定字段的值，能够显著加快数据检索的速度。没有索引的查询需要扫描整个集合，这在大数据量时可能非常缓慢。索引的存在使得MongoDB可以快速定位到符合条件的文档，大大提升查询性能。</p>
<h3 data-id="heading-0">特点</h3>
<ol>
<li><strong>加速查询</strong>：通过索引可以快速定位目标数据，提高查询效率。</li>
<li><strong>多种类型</strong>：支持单字段索引、复合索引、地理空间索引、文本索引、哈希索引等多种类型。</li>
<li><strong>自动维护</strong>：MongoDB自动维护索引的更新，当插入、更新或删除文档时，相关索引会自动更新。</li>
<li><strong>存储开销</strong>：索引会占用额外的磁盘空间，需要在性能和存储之间找到平衡。</li>
</ol>
<h3 data-id="heading-1">常见索引类型</h3>
<ol>
<li><strong>单字段索引</strong>：针对单一字段创建的索引。</li>
<li><strong>复合索引</strong>：针对多个字段创建的索引。</li>
<li><strong>地理空间索引</strong>：用于存储和查询地理空间数据。</li>
<li><strong>文本索引</strong>：用于文本搜索的索引。</li>
<li><strong>哈希索引</strong>：基于哈希的索引，适用于分片键。</li>
</ol>
<h3 data-id="heading-2">示例</h3>
<p>以下是如何在MongoDB中创建、使用和维护索引的示例。</p>
<h4 data-id="heading-3">1. 安装MongoDB Node.js驱动</h4>
<p>首先，需要安装MongoDB的Node.js驱动。可以使用npm进行安装：</p>
<pre><code class="hljs language-bash" lang="bash">npm install mongodb
</code></pre>
<h4 data-id="heading-4">2. 创建和使用单字段索引</h4>
<p>单字段索引是最简单的索引类型，针对集合中单个字段创建索引。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { <span class="hljs-title class_">MongoClient</span> } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mongodb'</span>);
<span class="hljs-keyword">const</span> url = <span class="hljs-string">'mongodb://localhost:27017'</span>;
<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MongoClient</span>(url);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Connected to MongoDB"</span>);

        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'users'</span>);

        <span class="hljs-comment">// 插入示例数据</span>
        <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">insertMany</span>([
            { <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">"alice@example.com"</span> },
            { <span class="hljs-attr">name</span>: <span class="hljs-string">"Bob"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">"bob@example.com"</span> },
            { <span class="hljs-attr">name</span>: <span class="hljs-string">"Charlie"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">35</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">"charlie@example.com"</span> }
        ]);

        <span class="hljs-comment">// 创建单字段索引</span>
        <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">createIndex</span>({ <span class="hljs-attr">age</span>: <span class="hljs-number">1</span> });
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Created index on 'age' field"</span>);

        <span class="hljs-comment">// 使用索引进行查询</span>
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">age</span>: { <span class="hljs-attr">$gt</span>: <span class="hljs-number">28</span> } }).<span class="hljs-title function_">toArray</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Query result:'</span>, result);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">run</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h4 data-id="heading-5">3. 创建和使用复合索引</h4>
<p>复合索引是针对多个字段创建的索引，可以用于提高多条件查询的效率。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createCompositeIndex</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'users'</span>);

        <span class="hljs-comment">// 创建复合索引</span>
        <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">createIndex</span>({ <span class="hljs-attr">name</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">email</span>: <span class="hljs-number">1</span> });
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Created composite index on 'name' and 'email' fields"</span>);

        <span class="hljs-comment">// 使用复合索引进行查询</span>
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-attr">email</span>: <span class="hljs-string">"alice@example.com"</span> }).<span class="hljs-title function_">toArray</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Query result:'</span>, result);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">createCompositeIndex</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h4 data-id="heading-6">4. 创建和使用文本索引</h4>
<p>文本索引用于文本搜索，允许对字符串字段进行全文本搜索。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createTextIndex</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'articles'</span>);

        <span class="hljs-comment">// 插入示例数据</span>
        <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">insertMany</span>([
            { <span class="hljs-attr">title</span>: <span class="hljs-string">"Introduction to MongoDB"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"MongoDB is a NoSQL database..."</span> },
            { <span class="hljs-attr">title</span>: <span class="hljs-string">"Advanced MongoDB"</span>, <span class="hljs-attr">content</span>: <span class="hljs-string">"This article covers advanced features of MongoDB..."</span> }
        ]);

        <span class="hljs-comment">// 创建文本索引</span>
        <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">createIndex</span>({ <span class="hljs-attr">content</span>: <span class="hljs-string">"text"</span> });
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Created text index on 'content' field"</span>);

        <span class="hljs-comment">// 使用文本索引进行全文搜索</span>
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">find</span>({ <span class="hljs-attr">$text</span>: { <span class="hljs-attr">$search</span>: <span class="hljs-string">"advanced"</span> } }).<span class="hljs-title function_">toArray</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Text search result:'</span>, result);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">createTextIndex</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h4 data-id="heading-7">5. 创建和使用地理空间索引</h4>
<p>地理空间索引用于存储和查询地理空间数据，支持二维平面和球面几何查询。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createGeospatialIndex</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'locations'</span>);

        <span class="hljs-comment">// 插入示例数据</span>
        <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">insertMany</span>([
            { <span class="hljs-attr">name</span>: <span class="hljs-string">"Central Park"</span>, <span class="hljs-attr">location</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"Point"</span>, <span class="hljs-attr">coordinates</span>: [-<span class="hljs-number">73.9654</span>, <span class="hljs-number">40.7829</span>] } },
            { <span class="hljs-attr">name</span>: <span class="hljs-string">"Empire State Building"</span>, <span class="hljs-attr">location</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"Point"</span>, <span class="hljs-attr">coordinates</span>: [-<span class="hljs-number">73.9857</span>, <span class="hljs-number">40.7488</span>] } }
        ]);

        <span class="hljs-comment">// 创建地理空间索引</span>
        <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">createIndex</span>({ <span class="hljs-attr">location</span>: <span class="hljs-string">"2dsphere"</span> });
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Created geospatial index on 'location' field"</span>);

        <span class="hljs-comment">// 使用地理空间索引进行查询</span>
        <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">find</span>({
            <span class="hljs-attr">location</span>: {
                <span class="hljs-attr">$near</span>: {
                    <span class="hljs-attr">$geometry</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"Point"</span>, <span class="hljs-attr">coordinates</span>: [-<span class="hljs-number">73.9857</span>, <span class="hljs-number">40.7488</span>] },
                    <span class="hljs-attr">$maxDistance</span>: <span class="hljs-number">5000</span>
                }
            }
        }).<span class="hljs-title function_">toArray</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Geospatial query result:'</span>, result);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">createGeospatialIndex</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h3 data-id="heading-8">索引管理</h3>
<h4 data-id="heading-9">列出索引</h4>
<p>可以列出集合中的所有索引。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">listIndexes</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'users'</span>);

        <span class="hljs-comment">// 列出所有索引</span>
        <span class="hljs-keyword">const</span> indexes = <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">indexes</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Indexes:'</span>, indexes);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">listIndexes</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h4 data-id="heading-10">删除索引</h4>
<p>可以删除不再需要的索引。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">dropIndex</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">connect</span>();
        <span class="hljs-keyword">const</span> db = client.<span class="hljs-title function_">db</span>(<span class="hljs-string">'exampledb'</span>);
        <span class="hljs-keyword">const</span> collection = db.<span class="hljs-title function_">collection</span>(<span class="hljs-string">'users'</span>);

        <span class="hljs-comment">// 删除索引</span>
        <span class="hljs-keyword">await</span> collection.<span class="hljs-title function_">dropIndex</span>(<span class="hljs-string">'name_1_email_1'</span>);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Dropped index 'name_1_email_1'"</span>);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">await</span> client.<span class="hljs-title function_">close</span>();
    }
}

<span class="hljs-title function_">dropIndex</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">dir</span>);
</code></pre>
<h3 data-id="heading-11">总结</h3>
<p>MongoDB中的索引是一种用于加速查询操作的强大工具。以下是其主要特点和常见操作：</p>





































<table><thead><tr><th>特性</th><th>详细说明</th></tr></thead><tbody><tr><td>加速查询</td><td>通过索引可以快速定位目标数据，提高查询效率</td></tr><tr><td>多种类型</td><td>支持单字段索引、复合索引、地理空间索引、文本索引、哈希索引等多种类型</td></tr><tr><td>自动维护</td><td>MongoDB自动维护索引的更新</td></tr><tr><td>存储开销</td><td>索引会占用额外的磁盘空间</td></tr><tr><td>索引管理</td><td>支持列出、删除索引等管理操作</td></tr><tr><td>地理空间索引</td><td>支持存储和查询地理空间数据</td></tr><tr><td>文本索引</td><td>支持全文本搜索</td></tr></tbody></table>
<p>通过实际代码示例，可以直观地了解如何在MongoDB中创建、使用和管理索引，从而更好地应用于实际项目开发中。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 名词解释]]></title>    <link>https://juejin.cn/post/7605157203592052763</link>    <guid>https://juejin.cn/post/7605157203592052763</guid>    <pubDate>2026-02-11T13:08:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605157203592052763" data-draft-id="7605421123185999899" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 名词解释"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-02-11T13:08:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="倚栏听风雨"/> <meta itemprop="url" content="https://juejin.cn/user/2682464103830750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 名词解释
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2682464103830750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    倚栏听风雨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T13:08:53.000Z" title="Wed Feb 11 2026 13:08:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>神经元
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/159eb194ed2b42039601debe438cbbdf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=Wr8SbVvdr87W7ZVvxiKLvc8%2Bqo4%3D" alt="image.png" loading="lazy"/></p>
<p>隐藏层
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b76321190f1b4b7e874286c2f2e81066~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=no0ovWOK%2FJP2MV5BL5kX1EQM7i0%3D" alt="image.png" loading="lazy"/></p>
<p>神经网络
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e451a3b2f78a4b6bb7c5ab23121ef436~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=RCEc95T5XohQ0MyaZsULerXnKm4%3D" alt="image.png" loading="lazy"/></p>
<p>前向传播</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deb8e656e1794e45acac42cdbb91cd75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=mxr8yllIRhO3%2BlMgdN3yNXs8pdk%3D" alt="image.png" loading="lazy"/></p>
<p>拟合</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56a48e27b44a4f88baf8d653471ad84c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=zMOzDShUhGHw%2BX%2FZnkoBipKmucM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e08dfaf5bcc42d795ec61ffe2a36b9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=FQx%2B0ftAzkpPSJuM2BoRhyfpar0%3D" alt="image.png" loading="lazy"/></p>
<p>过拟合</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57ef4c380b664578a1db70dc0b39ab8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=nRMcl5%2BsXW%2BUg6C%2BzBzGkdoaaqg%3D" alt="image.png" loading="lazy"/></p>
<p>泛化能力</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aa2841456c66421683d68e0dd47719a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=nC3IV1QiHmC%2F67u8JN7sNbZIX2Q%3D" alt="image.png" loading="lazy"/></p>
<p>编码</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/934afa1d02f347abb84d313827030998~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=iwdlitv9f4RUXag2CGAl0sW565M%3D" alt="image.png" loading="lazy"/></p>
<p>孤热编码</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8747c74ccf8c482299f4070d8f9fb53b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=QWaYNpjZgfOR2zZgdKfav9%2FnEos%3D" alt="image.png" loading="lazy"/></p>
<p>词嵌入
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff3778a8e4e240799645d5a7fcd9a387~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=vWcUeRg57rYmIXQ28eql3h3vxlk%3D" alt="image.png" loading="lazy"/></p>
<p>点积 相识度</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ba849f65cc042b8a67170b4a011b899~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=EfSVoNpPMH6qp%2Fm9w60iBnVHFnI%3D" alt="image.png" loading="lazy"/></p>
<p>嵌入矩阵
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfb28dd386154e1ba2779642c9d8bb42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=x0vZjiKbmQVzYSvHQ8d61taNqr4%3D" alt="image.png" loading="lazy"/></p>
<p>潜空间
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/318b158ee89442f5932085b9c9c6ca87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=X5vIFC2Ba2Yx7QQObX1lKm1pfLg%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2023d19b35204daa8fd939c70e808638~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=ZyhXsWoV3HELSzGDczyai7odzoI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58626f5959e7477ab858ec420992123b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCa5qCP5ZCs6aOO6Zuo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771420132&amp;x-signature=xEk2z%2Bat%2FzKtBZKHvvkiEU6h7RM%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Code案例-浏览器插件开发之notion to markdwon剪切板(已开源)]]></title>    <link>https://juejin.cn/post/7605401415856701490</link>    <guid>https://juejin.cn/post/7605401415856701490</guid>    <pubDate>2026-02-11T13:23:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605401415856701490" data-draft-id="7605366560065372170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Code案例-浏览器插件开发之notion to markdwon剪切板(已开源)"/> <meta itemprop="keywords" content="OpenAI,AI编程"/> <meta itemprop="datePublished" content="2026-02-11T13:23:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="可夫小子"/> <meta itemprop="url" content="https://juejin.cn/user/1878415577453223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Code案例-浏览器插件开发之notion to markdwon剪切板(已开源)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1878415577453223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    可夫小子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T13:23:22.000Z" title="Wed Feb 11 2026 13:23:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>💡 大家好，我是可夫小子，《小白玩转ChatGPT》专栏作者，关注AI编程、AI自动化和自媒体。</p>
</blockquote>
<p><img src="https://ob-1253382987.cos.ap-guangzhou.myqcloud.com/notion/c98e4feb8393bd2204aca1c2702c0b0c.png" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">背景</h2>
<p>我自己的主力笔记软件是使用notion，有时候需要把笔记转成markdown格式发布到其他平台，比如知乎、CSDN是直接支持Markdown格式。notion笔记自带导出为Markdown的功能 ，但获得的是markdown格式和本地图片，但这不能完全满足我的需求，而我期望的是把markdown内容copy到剪切板。于是借助Claude Code，两个小时就手撸了一个可用的浏览器插件。现在我也开源了，地址我写在文章后面，接下来看看我是怎样一步一步完这个小项目的。</p>
<h2 data-id="heading-1">方案调研</h2>
<h3 data-id="heading-2">已有方案的缺陷</h3>
<p>我首先在搜索引擎内搜索是否有相关工具或者插件。在排名前几的网页都是使用github 的action来实现下载的（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmarketplace%2Factions%2Fnotion2markdown-action" target="_blank" title="https://github.com/marketplace/actions/notion2markdown-action" ref="nofollow noopener noreferrer">github.com/marketplace…</a>），他们的使用场景是把markdown文章放到个人网站下面渲染。这不是插件，也不是网站，是需要配置github的action，这么调研下来，还是没有复制到粘贴板的方案。</p>
<p>我之前用于Notion MCP和Picgo + 腾讯对象存储COS的接口，于是我想到通过Claude Code来编写一个插件，整合之前单个使用到技术，主要用到的技术栈如下。</p>
<h3 data-id="heading-3"><strong>🛠️ 技术栈</strong></h3>
<ul>
<li><strong>Notion API</strong>: <code>@notionhq/client</code> - 官方 Notion API 客户端：用于拉取Notion的文章内容</li>
<li><strong>Markdown 转换</strong>: <code>notion-to-md</code> - Notion 块到 Markdown 的转换：把Notion格式转成标准的Markdown格式</li>
<li><strong>云存储</strong>: <code>cos-js-sdk-v5</code> - 腾讯云对象存储 SDK：用于图片的处理，这是重点。</li>
<li><strong>构建工具</strong>: Webpack 5：这是Claude Code选择方案。</li>
</ul>
<h3 data-id="heading-4">界面</h3>
<p><img src="https://ob-1253382987.cos.ap-guangzhou.myqcloud.com/notion/5aa01a67dc5d788fc8c7912e1720eed7.png" alt="image.png" loading="lazy"/></p>
<p><img src="https://ob-1253382987.cos.ap-guangzhou.myqcloud.com/notion/199f6bbb041a1ecc6e2a1f6db31034e4.png" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">Vibe Coding过程</h2>
<p>我会把我整个与claude code对话的过程展示出来，有一些冗余，目的是让你看到我是如何一步一步做出来，希望能给到你一些启发，自己动作做一个小工具，会比看万篇教程更有收获。</p>
<p>我先给一些背景资料供他研究。</p>
<pre><code class="hljs language-javascript" lang="javascript">阅读这个项目<span class="hljs-attr">https</span>:<span class="hljs-comment">//github.com/marketplace/actions/notion2markdown-action，协助我配置好这个项目，让我快速实现notion文章转成Markdown</span>
</code></pre>
<p>很快，他就总结了这个项目技术方案，接着我就引导他改造成chrome插件。</p>
<pre><code class="hljs language-javascript" lang="javascript">根据这样的机制，实现一个chrome浏览器插件，把<span class="hljs-title class_">Notion</span>文章，一键拷贝为<span class="hljs-title class_">Markdown</span>格式文章，要注意图片的处理，可以通过picgo+腾讯云<span class="hljs-variable constant_">COS</span> 对象存储
</code></pre>
<p>现在就开始真正大量时间大概5-8分钟在编程上，先规划，再一步一步实现，其实就完成一初稿。接着我就让他打包，生成插件。</p>
<pre><code class="hljs language-javascript" lang="javascript">你构建一下这个项目
</code></pre>
<p>这个打包过程，如果电脑缺少工具或者包，就会自己去下载。打包完成之后，我自己上手调试一下。发现出错了，第一步加载就失败了，就把错误日志发给他。</p>
<pre><code class="hljs language-javascript" lang="javascript">加载失败：[<span class="hljs-title class_">Pasted</span> text #<span class="hljs-number">1</span> +<span class="hljs-number">5</span> lines]
</code></pre>
<p>他分析了日志，就修复代码，我再次尝试，加载正常了。接下来我就把相关配置信息填好，测试功能，又出错了，同时，都交给Calude Code。</p>
<pre><code class="hljs language-javascript" lang="javascript">设置好相关参数，执行出错：<span class="hljs-title class_">Error</span>: <span class="hljs-title class_">Failed</span> to execute <span class="hljs-string">'fetch'</span> on <span class="hljs-string">'Window'</span>: <span class="hljs-title class_">Illegal</span> invocation
</code></pre>
<p>仍然出错，继续交给它自己反思。</p>
<pre><code class="hljs language-javascript" lang="javascript">仍然出相同的错误。<span class="hljs-title class_">Error</span>: <span class="hljs-title class_">Failed</span> to execute <span class="hljs-string">'fetch'</span> on <span class="hljs-string">'Window'</span>: <span class="hljs-title class_">Illegal</span> invocation。
</code></pre>
<p>经过几次迭代，就完成了基本功能，非常丝滑。有了背景让他学习，基本上就按照可靠的技术路线来实现，你只要测试把关即可。</p>
<p>接着，我又让它把代码提交到github仓库，写README文档，提交commit这些都让它操作</p>
<pre><code class="hljs language-javascript" lang="javascript">完成了基本功能，请把chrome-extension 相关源码整理，创建git仓库，并创建一条初始提交，并上传到github上。我的github账号koffuxu，我应该配置了github的公钥，如果没有，请通知我配置。
</code></pre>
<p>这就完成了基本功能，github地址如下：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fkoffuxu%2Fnotion-to-markdown-extension" target="_blank" title="https://github.com/koffuxu/notion-to-markdown-extension" ref="nofollow noopener noreferrer">github.com/koffuxu/not…</a></li>
</ul>
<p>后面我自己还迭代了几个版本，兼容了Cookie的方案，还在调试中，大家感兴趣可以接着开发。Token方式是完全可用，就是配置要复杂一点。</p>
<h2 data-id="heading-6">后记</h2>
<p>市场上一定有未被满足的长尾需求，你要善于发现，如果发现不了，就从自己的生活点滴出来来提炼。</p>
<p>有了AI编程，一定自己动手做，当你开始code时，比看万篇教程都有收获。你解决了一个问题，或者是其他人的痛点，那你离变现就很近了。</p>
<hr/>
<h2 data-id="heading-7">🧨 彩蛋</h2>
<p>我的《<strong>AI编程与自动化</strong>》2026训练营正式开营，以<strong>AI编程</strong>为驱动，让每个个体都拥有自己的小产品、小生意。训练营已积累了我过去三年200篇+的教程和案例。都是我自己实操总结，都是使用心得，并非复制网上过时的信息。现在以每周至少三篇的更新频率，让你获得最新、最接地气的AI资讯和教程。</p>
<p><strong>知识库模块</strong></p>
<p><img src="https://ob-1253382987.cos.ap-guangzhou.myqcloud.com/notion/b776e1be476650a01e9d552e7d400a91.png" alt="image.png" loading="lazy"/></p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HTTP常考状态码详解（附面试官考察点深扒）]]></title>    <link>https://juejin.cn/post/7605174711182639167</link>    <guid>https://juejin.cn/post/7605174711182639167</guid>    <pubDate>2026-02-11T13:53:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605174711182639167" data-draft-id="7605214360085676068" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HTTP常考状态码详解（附面试官考察点深扒）"/> <meta itemprop="keywords" content="前端,面试,HTTP"/> <meta itemprop="datePublished" content="2026-02-11T13:53:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NEXT06"/> <meta itemprop="url" content="https://juejin.cn/user/1176918763246011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HTTP常考状态码详解（附面试官考察点深扒）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1176918763246011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NEXT06
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T13:53:43.000Z" title="Wed Feb 11 2026 13:53:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：那个让人尴尬的面试现场 😅</h2>
<p>不管是校招萌新还是想跳槽的老鸟，面试时大概率都遇到过这样一个场景：<br/>
面试官推了推眼镜，轻描淡写地问了一句：“<strong>简单说一下 301 和 302 的区别？再讲讲 304 是怎么产生的？</strong> ”</p>
<p>这时候，很多人脑子里可能只有一行字：“完了，这题我看过，但我忘了……”<br/>
于是只能支支吾吾：“额，一个是永久，一个是临时...那个...304好像是缓存？”</p>
<p>面试官微微一笑，你的心里却凉了半截。</p>
<p>其实，<strong>HTTP 状态码（Status Code）</strong>  真的不是枯燥的数字。对于我们后端开发来说，它不仅是面试的“敲门砖”，更是线上排错（Troubleshooting）的“听诊器”。看到 502 和看到 504，排查方向可是完全不一样的！</p>
<p>今天这篇文章，咱们不搞死记硬背，我带大家从<strong>应用场景</strong>和<strong>面试官视角</strong>，把这块硬骨头彻底嚼碎了！</p>
<hr/>
<h2 data-id="heading-1">🌏 状态码家族概览：先看大局</h2>
<p>HTTP 状态码由 3 位数字组成，第一个数字定义了响应的类别。你可以把它们想象成 5 个性格迥异的家族：</p>
<ul>
<li>
<p><strong>1xx：消息（Information）</strong></p>
<ul>
<li>🐢 <strong>一句话总结</strong>：“服务收到了，你继续发。”（实际开发中很少直接处理）</li>
</ul>
</li>
<li>
<p><strong>2xx：成功（Success）</strong></p>
<ul>
<li>✅ <strong>一句话总结</strong>：“操作成功，舒服了。”</li>
</ul>
</li>
<li>
<p><strong>3xx：重定向（Redirection）</strong></p>
<ul>
<li>👉 <strong>一句话总结</strong>：“资源搬家了，你去那边找它。”</li>
</ul>
</li>
<li>
<p><strong>4xx：客户端错误（Client Error）</strong></p>
<ul>
<li>🙅‍♂️ <strong>一句话总结</strong>：“你（客户端）发的东西有毛病，服务器处理不了。”</li>
</ul>
</li>
<li>
<p><strong>5xx：服务端错误（Server Error）</strong></p>
<ul>
<li>💥 <strong>一句话总结</strong>：“我（服务端）炸了，不是你的锅。”</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-2">🔍 核心状态码详解：别只背定义，要懂场景</h2>
<h3 data-id="heading-3">1. 2xx 系列：不仅仅只有 200</h3>
<ul>
<li>
<p><strong>200 OK</strong></p>
<ul>
<li><strong>含义</strong>：最常见的，请求成功。</li>
<li><strong>场景</strong>：网页正常打开，接口正常返回数据。</li>
</ul>
</li>
<li>
<p><strong>201 Created</strong></p>
<ul>
<li><strong>含义</strong>：请求成功并且服务器创建了新的资源。</li>
<li><strong>场景</strong>：RESTful API 中，使用 POST 创建用户或订单成功后，应该返回 201 而不是 200。</li>
</ul>
</li>
<li>
<p><strong>204 No Content</strong></p>
<ul>
<li><strong>含义</strong>：服务器处理成功，但不需要返回任何实体内容。</li>
<li><strong>场景</strong>：前端发送 DELETE 请求删除某条记录，后端删完了，没必要回传什么数据，给个 204 告诉前端“妥了”即可。</li>
</ul>
</li>
<li>
<p><strong>206 Partial Content (💡划重点)</strong></p>
<ul>
<li><strong>含义</strong>：服务器已经成功处理了部分 GET 请求。</li>
<li><strong>场景</strong>：<strong>大文件断点续传</strong>、视频流媒体播放。前端会在 Header 里带上 Range: bytes=0-100，后端就只返回这部分数据。面试问到“断点续传怎么做”，这个状态码是核心。</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-4">2. 3xx 系列：重定向与缓存的纠葛</h3>
<ul>
<li>
<p><strong>301 Moved Permanently (永久重定向)</strong></p>
<ul>
<li><strong>含义</strong>：资源已经被<strong>永久</strong>移动到了新位置。</li>
<li><strong>场景</strong>：网站更换域名（如 http 升级到 https），或者老旧的 URL 废弃。</li>
<li><strong>关键点</strong>：浏览器会缓存这个重定向，下次你再访问老地址，浏览器<strong>直接</strong>就去新地址了，根本不会去问服务器。</li>
</ul>
</li>
<li>
<p><strong>302 Found (临时重定向)</strong></p>
<ul>
<li><strong>含义</strong>：资源暂时去别的地方了，但未来可能还会回来。</li>
<li><strong>场景</strong>：活动页面的临时跳转，未登录用户跳转到登录页。</li>
</ul>
</li>
<li>
<p><strong>304 Not Modified (🔥 超高频考点)</strong></p>
<ul>
<li>
<p><strong>含义</strong>：资源没修改，你可以直接用你本地的缓存。</p>
</li>
<li>
<p><strong>原理</strong>：</p>
<ol>
<li>浏览器第一次请求资源，服务器返回 200，并在 Header 里带上 ETag (文件指纹) 或 Last-Modified (最后修改时间)。</li>
<li>浏览器第二次请求，Header 里带上 If-None-Match (对应 ETag) 或 If-Modified-Since。</li>
<li>服务器对比发现：“哎？这文件我没改过啊！”</li>
<li>服务器直接返回 <strong>304</strong>（响应体是空的，省带宽），告诉浏览器：“别下新的了，用你缓存里那个！”</li>
</ol>
</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-5">3. 4xx 系列：客户端的锅</h3>
<ul>
<li>
<p><strong>400 Bad Request</strong></p>
<ul>
<li><strong>含义</strong>：请求参数有误，语义错误。</li>
<li><strong>场景</strong>：前端传的 JSON 格式不对，或者必填参数没传。</li>
</ul>
</li>
<li>
<p><strong>401 Unauthorized vs 403 Forbidden (⚠️ 易混淆)</strong></p>
<ul>
<li><strong>401</strong>：<strong>未认证</strong>。意思是“你是谁？我不认识你”。（通常没登录，或者 Token 过期）。</li>
<li><strong>403</strong>：<strong>禁止</strong>。意思是“我知道你是谁，但你没权限进这个屋”。（比如普通用户想删管理员的数据）。</li>
</ul>
</li>
<li>
<p><strong>404 Not Found</strong></p>
<ul>
<li><strong>含义</strong>：资源未找到。</li>
<li><strong>场景</strong>：URL 输错了，或者资源被删了。</li>
</ul>
</li>
<li>
<p><strong>405 Method Not Allowed</strong></p>
<ul>
<li><strong>含义</strong>：方法不被允许。</li>
<li><strong>场景</strong>：接口只支持 POST，你非要用 GET 去调。</li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-6">4. 5xx 系列：服务端的泪</h3>
<ul>
<li>
<p><strong>500 Internal Server Error</strong></p>
<ul>
<li><strong>含义</strong>：服务器内部错误。</li>
<li><strong>场景</strong>：后端代码抛了空指针异常（NPE）、数据库连不上了、代码逻辑炸了。</li>
</ul>
</li>
<li>
<p><strong>502 Bad Gateway vs 504 Gateway Timeout (🔥 线上排错必问)</strong></p>
<ul>
<li>
<p>这俩通常出现在 <strong>Nginx（网关）</strong>  和 <strong>后端服务（如 Java/Go/Python 应用）</strong>  之间。</p>
</li>
<li>
<p><strong>502 Bad Gateway</strong>：<strong>上游服务挂了或返回了无效响应</strong>。</p>
<ul>
<li>大白话：Nginx 给后端发请求，后端直接断开连接，或者后端进程直接崩了（端口通但不干活）。</li>
</ul>
</li>
<li>
<p><strong>504 Gateway Timeout</strong>：<strong>上游服务超时</strong>。</p>
<ul>
<li>大白话：Nginx 给后端发请求，后端活着，但是处理太慢了（比如慢 SQL 查了 60 秒），超过了 Nginx 设置的等待时间。</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-7">🎯 面试官的“伏击圈”：最常考&amp;最易混淆点</h2>
<p>这里是整篇文章的精华，面试官问这些问题时，心里其实是有“小九九”的。</p>
<h3 data-id="heading-8">1. 问：301 和 302 到底有啥本质区别？我不都是跳过去了吗？</h3>
<ul>
<li>
<p><strong>🚫 易忘点</strong>：只记得“永久”和“临时”，忘了<strong>SEO（搜索引擎优化）<strong>和</strong>缓存</strong>。</p>
</li>
<li>
<p><strong>🕵️‍♂️ 面试官想考察什么</strong>：你是否了解 HTTP 协议对搜索引擎的影响，以及浏览器缓存策略。</p>
</li>
<li>
<p><strong>💯 完美回答范例</strong>：</p>
<blockquote>
<p>“虽然用户体验一样，但核心区别在于<strong>缓存</strong>和<strong>SEO</strong>。<br/>
<strong>301</strong> 会被浏览器强制缓存，下次根本不请求服务器；搜索引擎会把旧地址的权重转移到新地址。<br/>
<strong>302</strong> 不会被缓存，每次都会去问服务器，搜索引擎也会保留旧地址。<br/>
所以做网站迁移一定要用 301，否则旧域名的 SEO 权重就丢了。”</p>
</blockquote>
</li>
</ul>
<h3 data-id="heading-9">2. 问：304 状态码是怎么产生的？</h3>
<ul>
<li>
<p><strong>🚫 易忘点</strong>：只知道是缓存，说不出 ETag 和 Last-Modified 的协商过程。</p>
</li>
<li>
<p><strong>🕵️‍♂️ 面试官想考察什么</strong>：<strong>Web 性能优化</strong>。你是否懂“协商缓存”机制，是否知道如何通过 HTTP 头节省带宽。</p>
</li>
<li>
<p><strong>💯 完美回答范例</strong>：</p>
<blockquote>
<p>“304 是<strong>协商缓存</strong>的结果。<br/>
客户端带着 If-None-Match (ETag) 或 If-Modified-Since 发起请求。<br/>
服务端对比发现资源未变，就不传 Body，只回一个 304 头。<br/>
这能极大减少带宽消耗，提升页面加载速度。”</p>
</blockquote>
</li>
</ul>
<h3 data-id="heading-10">3. 问：线上报 502 和 504，你怎么排查？</h3>
<ul>
<li>
<p><strong>🚫 易忘点</strong>：分不清谁是因谁是果，瞎查数据库。</p>
</li>
<li>
<p><strong>🕵️‍♂️ 面试官想考察什么</strong>：<strong>Troubleshooting（故障排查）能力</strong>。这是区分“码农”和“工程师”的分水岭。</p>
</li>
<li>
<p><strong>💯 完美回答范例</strong>：</p>
<blockquote>
<p>“看到 <strong>502</strong>，我首先怀疑<strong>后端服务没启动</strong>或<strong>进程崩了</strong>，或者 Nginx 配置的 Upstream 地址配错了。<br/>
看到 <strong>504</strong>，说明后端连接正常但<strong>处理太慢</strong>。我会去查后端日志看有没有<strong>慢 SQL</strong>，或者是不是<strong>死锁</strong>导致请求卡住超时了。”</p>
</blockquote>
</li>
</ul>
<hr/>
<h2 data-id="heading-11">📝 总结：一张图带你记忆</h2>
<p>最后，给兄弟们整几个顺口溜，助你记忆：</p>
<ul>
<li><strong>200</strong>：皆大欢喜。</li>
<li><strong>301</strong>：搬家了，不回来了；<strong>302</strong>：出差了，过几天回。</li>
<li><strong>304</strong>：没改过，用旧的。</li>
<li><strong>401</strong>：没身份证；<strong>403</strong>：有身份证但不让进。</li>
<li><strong>404</strong>：查无此人。</li>
<li><strong>500</strong>：代码写烂了。</li>
<li><strong>502</strong>：后端挂了；<strong>504</strong>：后端慢了。</li>
</ul>
<p>希望这篇文章能帮你把 HTTP 状态码彻底搞懂！下次面试官再问，直接把原理拍他脸上！😎</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[纯国产算力硬刚GPT？聊聊刚发布的讯飞星火X2]]></title>    <link>https://juejin.cn/post/7605366560065339402</link>    <guid>https://juejin.cn/post/7605366560065339402</guid>    <pubDate>2026-02-11T12:19:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605366560065339402" data-draft-id="7605366560065323018" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="纯国产算力硬刚GPT？聊聊刚发布的讯飞星火X2"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-02-11T12:19:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            纯国产算力硬刚GPT？聊聊刚发布的讯飞星火X2
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T12:19:22.000Z" title="Wed Feb 11 2026 12:19:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这几天科技圈最热闹的事，莫过于科大讯飞扔出的这颗重磅炸弹。</p>
<p>就在2026年2月11日，讯飞星火X2大模型正式发布。说实话，作为一名长期关注AI底层的博主，我起初对这场发布会的期待值是持保留态度的。毕竟市面上“吊打”、“遥遥领先”的PPT我们见得太多了。</p>
<p>但这次不一样。星火X2最让我感兴趣的不是它的参数量，而是它脚下踩着的基座——<strong>全链路国产算力</strong>。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fasdfasfg-1024x561.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/asdfasfg-1024x561.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7af13400793f42c180f03ce096e1850d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771417162&amp;x-signature=kPXKyQOXE4Uz4HjtuQhVp3r35TI%3D" alt="asdfasfg" loading="lazy"/></a></p>
<p>没错，在被卡脖子的大背景下，讯飞这次没用英伟达，而是完全基于国产昇腾服务器跑通了训练和推理。这本身就是一个巨大的工程学信号。</p>
<h3 data-id="heading-0">293B参数，单卡居然能跑？</h3>
<p>先看参数党最关心的硬指标。星火X2采用了293B的MoE（混合专家）稀疏架构。</p>
<p>两年前我们还在纠结MoE怎么训练稳定，现在讯飞已经把它玩出花了。他们搞定了一个叫“训推采样校准”的技术，简单说就是让模型在训练和推理时的表现更一致，不再是“模拟考满分，高考拉胯”。</p>
<p>最离谱的数据是部署门槛。对于千亿级参数的模型，通常需要昂贵的集群支撑。但星火X2通过极极致的权重量化和VTP（虚拟张量并行）技术，宣称<strong>单台国产昇腾服务器就能跑起来</strong>。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fasfsdaf-1024x621.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/asfsdaf-1024x621.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52962e5a35144159a6d8684d506a181d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771417162&amp;x-signature=uhPYegyhBaZ%2FOdp0tuUgoOA3Nhg%3D" alt="asfsdaf" loading="lazy"/></a></p>
<p>这对企业意味着什么？意味着私有化部署的成本直接腰斩。推理性能比上一代X1.5提升了50%，这在实际业务中是肉眼可见的流畅度提升。</p>
<h3 data-id="heading-1">不只是聊天，更是“做题家”</h3>
<p>为了证明自己不是只能聊天的“吉祥物”，讯飞直接拿出了哈佛-麻省理工数学锦标赛（HMMT）的题目来练手。</p>
<p>演示中，X2不仅解出了这道英文高难数学题，甚至连步骤逻辑都严丝合缝。官方称其数学和逻辑推理能力已经“媲美国际最优”。虽然“对标”这个词在业界通稿里很常见，但结合其在医疗和教育领域的实战数据来看，这次的底气确实比以往更足。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fasfsdfsdf-1-1024x443.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/asfsdfsdf-1-1024x443.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55c6bf4c930f4918828ddbe09818873c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771417162&amp;x-signature=4zhrM5yyO2fMDxu1widkEHcompo%3D" alt="asfsdfsdf" loading="lazy"/></a></p>
<p>说到实战，这才是讯飞的老本行。</p>
<h3 data-id="heading-2">垂直场景的“降维打击”</h3>
<p>如果不谈落地，大模型就是空中楼阁。讯飞这次显然是盯着“干活”去的：</p>
<ul>
<li><strong>医疗领域</strong>：这可能是最硬核的背书。X2的医疗能力通过了上海市医疗大模型应用检测验证中心的评测。在看病历、写报告、审处方这些事上，官方数据显示它甚至压过了DeepSeek V3.2和GPT-5.2。</li>
<li><strong>教育领域</strong>：AI学习机一直是个黑箱，以前是直接给你答案，现在X2能做到“错因贯穿”。它能像老师一样分析你为什么错，而不是仅仅告诉你什么是对的。</li>
<li><strong>汽车座舱</strong>：这块大家痛点最深。以前的车机是“人工智障”，稍微复杂点的模糊指令就听不懂。X2上车后，把那套基于2B/7B小模型的意图理解能力拉高了一个档次，终于能听懂人话了。</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2026%2F02%2Fhdfghfgh-1024x460.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2026/02/hdfghfgh-1024x460.webp" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63942432ac894211a66a65e50817f638~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771417162&amp;x-signature=t8iOkrxCIm2TKBVSY7zY3Rn0UNQ%3D" alt="hdfghfgh" loading="lazy"/></a></p>
<h3 data-id="heading-3">商业化的野心</h3>
<p>还有一个数据很有意思。2025年，讯飞拿下了23.16亿元的大模型中标金额，比第二名到第六名的总和还多。这说明在B端市场，尤其是在政企、央国企这些对数据安全和国产化极其敏感的领域，讯飞已经建立了绝对的护城河。</p>
<h3 data-id="heading-4">写在最后</h3>
<p>星火X2的发布，某种意义上是中国AI产业的一个分水岭。</p>
<p>它证明了在顶级算力受限的情况下，通过算法优化和工程创新（MoE架构+国产硬件软硬协同），我们依然能造出第一梯队的大模型。</p>
<p>对于开发者来说，讯飞这次也挺大方，新注册直接送100万Tokens。不管你是做应用的还是纯粹的技术爱好者，我都建议你去试一试。毕竟，在全栈国产化的这条路上，星火X2可能是目前最接近“完全体”的样本。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI主播监管新规，技术合规边界与行业影响分析]]></title>    <link>https://juejin.cn/post/7605214360085266468</link>    <guid>https://juejin.cn/post/7605214360085266468</guid>    <pubDate>2026-02-11T11:38:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605214360085266468" data-draft-id="7605150769009655851" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI主播监管新规，技术合规边界与行业影响分析"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-11T11:38:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="indieAI"/> <meta itemprop="url" content="https://juejin.cn/user/4488643649743614"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI主播监管新规，技术合规边界与行业影响分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4488643649743614/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    indieAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T11:38:07.000Z" title="Wed Feb 11 2026 11:38:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2026年2月1日，《直播电商监督管理办法》（以下简称《办法》）正式施行，标志着AI生成内容在直播电商领域进入全面监管时代。作为中国首个将数字人主播等人工智能生成内容明确纳入监管范围的部门规章，新规不仅回应了AI主播带货虚假宣传、消费者权益受损等现实问题，更从技术实现、责任归属、行业规范等维度构建了全链条治理体系。</p>
<p>本文将从政策背景、核心条款、技术实现、行业影响、企业应对、国际对比六个维度，系统解读新规的技术合规边界与产业变革意义。</p>
<h2 data-id="heading-0">一、政策背景：从监管真空到全链条治理</h2>
<p><strong>技术应用与风险同步爆发</strong></p>
<p>2025年，中国AI主播带货市场规模突破8万亿元，同比增长240%，但消费者投诉率同比飙升120%。虚假宣传、货不对板、数据造假等问题集中爆发，传统监管工具在AI生成内容面前面临三大挑战：</p>
<ol>
<li><strong>身份模糊性</strong>：数字人主播以高度拟真形象出现，消费者难以区分真人主播与AI生成形象</li>
<li><strong>责任推诿</strong>：技术提供方、运营方、平台方之间责任边界不清，违规后相互推诿</li>
<li><strong>取证困难</strong>：AI生成内容可实时修改、无痕删除，监管部门难以固定证据</li>
</ol>
<p><strong>监管逻辑演进路径</strong></p>
<p>面对技术挑战，监管体系经历三个阶段演进：</p>
<ul>
<li><strong>1.0阶段（2023-2024）</strong>：原则性引导，以《生成式人工智能服务管理暂行办法》为代表，确立“发展与安全并重”基调</li>
<li><strong>2.0阶段（2025）</strong>：技术规范落地，《人工智能生成合成内容标识办法》强制实施显隐双重标识</li>
<li><strong>3.0阶段（2026）</strong>：场景化治理，《直播电商监督管理办法》聚焦直播电商垂直领域，实现从技术到商业的全流程监管</li>
</ul>
<p>新规的核心突破在于：首次将AI生成内容的责任主体从技术层面延伸至商业应用层面，形成“技术合规+商业合规”的双轨制监管框架。</p>
<h2 data-id="heading-1">二、核心条款：五大关键要求解读</h2>
<p>《办法》围绕标识义务、责任归属、内容审核、数据留存、违规处置五个维度，构建了清晰的合规边界。</p>
<h3 data-id="heading-2">1. 强制标识义务：全程显著提示</h3>
<p>新规第十七条明确规定：“直播间运营者使用人工智能等技术生成的人物图像、视频从事直播电商活动的，应当依照国家有关规定进行标识，持续向消费者提示该人物图像、视频由人工智能等技术生成。”</p>
<p><strong>技术实现要求：</strong></p>
<ul>
<li><strong>显式标识</strong>：在直播画面固定位置（如右下角）持续显示“AI数字人主播”或“人工智能合成”字样，文字高度不低于画面最短边长的5%</li>
<li><strong>隐式标识</strong>：在文件元数据中嵌入内容属性、服务提供者编码、内容编号等溯源信息</li>
<li><strong>持续提示</strong>：标识必须在直播全过程可见，不得仅在开场闪现</li>
</ul>
<h3 data-id="heading-3">2. 责任主体界定：谁用谁担责</h3>
<p>第三十七条明确：“在直播电商活动中，使用人工智能生成内容出现违反法律、法规、规章行为的，由管理或者使用该人物图像、视频的直播间运营者承担责任。”</p>
<p><strong>责任分层体系：</strong></p>
<ul>
<li><strong>第一责任</strong>：直播间运营者承担全部法律责任，不得以技术故障为由免责</li>
<li><strong>连带责任</strong>：平台方、MCN机构、技术提供方按各自义务承担相应责任</li>
<li><strong>协同治理</strong>：建立“运营者-平台-监管部门”三级联动机制</li>
</ul>
<h3 data-id="heading-4">3. 事前审核机制：全流程风控</h3>
<p>《办法》要求直播间运营者建立完善的信息公示、身份核验、事前合规审核、主播纠错等制度，具体包括：</p>
<ul>
<li><strong>脚本预审</strong>：直播话术、商品描述、功效宣传等需经审核才能上线</li>
<li><strong>敏感词过滤</strong>：内置实时监测系统，识别并拦截虚假宣传、绝对化用语等违规内容</li>
<li><strong>资质核验</strong>：核验实际销售商品/服务的经营者信息、合格证明文件等</li>
</ul>
<h3 data-id="heading-5">4. 事中监控体系：实时预警处置</h3>
<p>平台需建立动态监测系统，对高风险直播间实施实时巡查：</p>
<ul>
<li><strong>AI多模态审核</strong>：融合语音识别、图像分析、文本语义理解技术，多维度识别违规</li>
<li><strong>分级分类管理</strong>：根据主播影响力、商品类型、历史合规记录实施差异化监管</li>
<li><strong>实时告警</strong>：系统自动触发预警，要求运营者立即整改，未及时整改者可自动下播</li>
</ul>
<h3 data-id="heading-6">5. 违规处罚标准：阶梯式惩戒</h3>
<p>根据《办法》第四十二条，违规处罚采取“警示-限流-封号-罚款”四级阶梯：</p>
<ul>
<li><strong>首次违规</strong>：警告并限期整改，可限制流量7天</li>
<li><strong>二次违规</strong>：暂停直播7-30天，罚款1-5万元</li>
<li><strong>严重违规</strong>：永久封号，没收违法所得，最高处违法所得3倍罚款</li>
<li><strong>刑事追责</strong>：构成犯罪的，依法追究刑事责任</li>
</ul>
<h2 data-id="heading-7">三、技术实现：合规架构的技术支撑</h2>
<p>新规的落地实施，需要从技术底层构建“标识+审核+溯源+监控”四位一体的合规架构。</p>
<h3 data-id="heading-8">1. AI内容溯源技术：数字身份证体系</h3>
<p><strong>数字水印技术方案：</strong></p>
<ul>
<li><strong>频域嵌入技术</strong>：利用离散余弦变换（DCT）在频域插入水印，通过调整α系数（0.05-0.1）平衡隐蔽性与鲁棒性</li>
<li><strong>潜在空间扰动</strong>：在Stable Diffusion等生成模型的潜在空间添加参数扰动，通过sign函数确保可逆提取</li>
<li><strong>双重标识体系</strong>：显式标识（文字/语音提示）保障用户知情权，隐式标识（元数据/数字水印）支持技术溯源</li>
</ul>
<p><strong>实际应用案例：</strong></p>
<p>谷歌SynthID Detector通过扫描文件中的隐形数字水印，可精准识别AI生成媒体，即使内容被分享或转码，水印依然可被检测，识别准确率超过95%。</p>
<h3 data-id="heading-9">2. 审核算法透明化：可解释AI（XAI）应用</h3>
<p><strong>技术实现路径：</strong></p>
<ul>
<li><strong>局部解释技术</strong>：采用SHAP（SHapley Additive exPlanations）算法，量化每个特征对决策的贡献度</li>
<li><strong>全局解释框架</strong>：如悉尼科技大学2025年提出的“物理-算法双轨溯源框架”，将模型内部运算转化为可理解的特征关联图谱</li>
<li><strong>多智能体协作系统</strong>：如某平台部署的“检测-推理-裁决”流水线，将内容风控从“黑盒打分”升级为“可辩论的司法流程”</li>
</ul>
<p><strong>透明化要求：</strong></p>
<p>根据《办法》配套标准，审核算法需向用户披露：</p>
<ul>
<li>审核依据的关键词库与识别规则</li>
<li>审核结果的形成逻辑与证据链</li>
<li>申诉复核的完整流程与时间承诺</li>
</ul>
<h3 data-id="heading-10">3. 合规技术架构：合规-by-Design实践</h3>
<p><strong>架构设计原则：</strong></p>
<ul>
<li><strong>模块化分离</strong>：合规功能与业务逻辑解耦，支持动态规则更新</li>
<li><strong>全生命周期覆盖</strong>：从数据采集、模型训练到内容生成、传播监控，建立端到端合规链路</li>
<li><strong>实时监控反馈</strong>：部署异常检测系统，实现秒级响应与自动处置</li>
</ul>
<p><strong>技术实现方案：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 合规引擎核心代码示例</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">content_compliance_check</span>(<span class="hljs-params">content, policy_rules</span>):
    <span class="hljs-comment"># 1. 标识验证</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> verify_ai_label(content):
        <span class="hljs-keyword">return</span> ComplianceResult.FAIL, <span class="hljs-string">"AI标识缺失"</span>
    
    <span class="hljs-comment"># 2. 敏感词检测</span>
    violation_list = sensitive_word_detection(content.text)
    <span class="hljs-keyword">if</span> violation_list:
        <span class="hljs-keyword">return</span> ComplianceResult.FAIL, <span class="hljs-string">f"敏感词违规: <span class="hljs-subst">{violation_list}</span>"</span>
    
    <span class="hljs-comment"># 3. 内容真实性评估</span>
    authenticity_score = evaluate_authenticity(content)
    <span class="hljs-keyword">if</span> authenticity_score &lt; THRESHOLD:
        <span class="hljs-keyword">return</span> ComplianceResult.REVIEW, <span class="hljs-string">"需人工复核"</span>
    
    <span class="hljs-keyword">return</span> ComplianceResult.PASS, <span class="hljs-string">"合规"</span>
</code></pre>
<h3 data-id="heading-11">4. AI生成内容质量标准化管理：技术与工具支撑</h3>
<p>新规要求企业建立AI生成内容质量管理体系，确保内容可追溯、可评估、可审计。在这一环节，技术工具的价值尤为关键。</p>
<p><strong>prompt-minder.com的合规赋能实践：</strong></p>
<ul>
<li>
<p><strong>Prompt版本控制</strong>：通过完整的版本历史记录，实现从Prompt设计到生成结果的全链路追溯。企业可以精准定位每一次AI内容生成的具体参数与上下文，为合规审计提供完整证据链。</p>
</li>
<li>
<p><strong>效果追踪与分析</strong>：系统实时监控不同Prompt模板的生成质量与合规指标，自动识别高风险内容模式。例如，当某类Prompt频繁生成夸大宣传内容时，系统会触发预警并建议优化方向。</p>
</li>
<li>
<p><strong>标准化管理流程</strong>：提供从Prompt设计、质量评估到合规审计的一站式管理工具，帮助企业将AI内容生成纳入标准化、可审计的业务流程。</p>
</li>
</ul>
<p><strong>实际应用价值：</strong></p>
<p>某电商企业在部署prompt-minder.com的质量管理模块后，AI主播的违规率从每月12.3%下降至2.1%，审核效率提升67%。系统自动记录的Prompt版本与效果数据，在监管部门抽查时提供了完整的合规证据，避免了潜在的行政处罚。</p>
<h2 data-id="heading-12">四、行业影响：量化分析与趋势预测</h2>
<p>新规实施将引发直播电商行业深度洗牌，不同主体面临差异化影响。</p>
<h3 data-id="heading-13">1. 行业整体影响：短期阵痛与长期规范</h3>
<p><strong>市场规模预测（2026-2027）：</strong></p>



































<table><thead><tr><th>指标</th><th>2025年基准</th><th>2026年（新规实施）</th><th>2027年（规范期）</th></tr></thead><tbody><tr><td>AI主播带货规模</td><td>8.2万亿元</td><td>7.5万亿元（-8.5%）</td><td>9.8万亿元（+19.5%）</td></tr><tr><td>商家采用率</td><td>35%</td><td>42%（+7%）</td><td>58%（+16%）</td></tr><tr><td>消费者投诉率</td><td>120%（同比增）</td><td>65%（-45%）</td><td>40%（-25%）</td></tr><tr><td>头部平台合规投入</td><td>15亿元/年</td><td>28亿元/年（+87%）</td><td>35亿元/年（+25%）</td></tr></tbody></table>
<p><strong>核心趋势判断：</strong></p>
<ul>
<li><strong>短期（2026上半年）</strong>：行业合规成本上升15-20%，小型技术公司淘汰率预计达30%</li>
<li><strong>中期（2026下半年）</strong>：标准化解决方案成熟，合规成本下降10-15%，行业集中度提升</li>
<li><strong>长期（2027年后）</strong>：AI主播成为直播电商基础设施，合规率超过95%，用户信任度显著提升</li>
</ul>
<h3 data-id="heading-14">2. 细分领域影响分析</h3>
<p><strong>直播电商平台：</strong></p>
<ul>
<li><strong>正面影响</strong>：建立行业标准壁垒，提升平台权威性；通过合规技术服务获得新收入增长点</li>
<li><strong>挑战</strong>：技术改造成本高（头部平台预计投入20-40亿元）；监管责任加重，需建立7×24小时监控体系</li>
</ul>
<p><strong>MCN机构与品牌方：</strong></p>
<ul>
<li><strong>成本结构变化</strong>：合规审核成本占比从5%提升至12-15%；技术采购支出增长30-50%</li>
<li><strong>运营模式调整</strong>：需建立“AI生成内容审核-责任追溯-应急响应”三级管理架构</li>
</ul>
<p><strong>AI技术提供商：</strong></p>
<ul>
<li><strong>市场机会</strong>：合规技术解决方案市场预计达120亿元；头部企业市场份额有望突破40%</li>
<li><strong>竞争格局</strong>：具备“技术+合规+行业”复合能力的企业将主导市场，单一技术公司面临生存压力</li>
</ul>
<h3 data-id="heading-15">3. 消费者权益保护成效</h3>
<p>根据新规实施前的模拟测试，强制标识制度预计带来：</p>
<ul>
<li><strong>知情权保障</strong>：AI主播识别准确率从47%提升至98%，消费者受误导概率下降85%</li>
<li><strong>维权效率提升</strong>：投诉响应时间从平均72小时缩短至24小时内，处置成功率从35%提升至78%</li>
<li><strong>交易安全增强</strong>：虚假宣传导致的退货率预计下降60%，消费者满意度提升42个百分点</li>
</ul>
<h2 data-id="heading-16">五、企业应对：合规化转型路线图</h2>
<p>面对新规要求，企业需从被动合规转向主动治理，构建覆盖技术、流程、组织的全体系合规能力。</p>
<h3 data-id="heading-17">第一阶段：合规诊断与差距分析（1-2个月）</h3>
<p><strong>核心任务：</strong></p>
<ol>
<li><strong>资产盘点</strong>：识别企业内所有AI生成内容应用场景，绘制技术依赖图谱</li>
<li><strong>风险评估</strong>：基于七大风险框架（数据、算法、内容、安全、隐私、公平、责任）量化业务影响</li>
<li><strong>合规差距分析</strong>：对照《办法》具体要求，建立“现状-标准”差距矩阵</li>
</ol>
<p><strong>关键产出：</strong></p>
<ul>
<li>AI应用资产清单与技术架构图</li>
<li>风险评级报告（高/中/低风险分类）</li>
<li>合规整改优先级清单</li>
</ul>
<h3 data-id="heading-18">第二阶段：技术方案设计与部署（3-6个月）</h3>
<p><strong>合规架构设计：</strong></p>
<ol>
<li>
<p><strong>标识体系构建</strong>：</p>
<ul>
<li>部署显式标识生成模块，确保直播全程AI标识可见</li>
<li>建立隐式标识嵌入管道，在元数据中写入溯源信息</li>
<li>开发标识验证工具，实现自动化合规检查</li>
</ul>
</li>
<li>
<p><strong>审核系统升级</strong>：</p>
<ul>
<li>集成多模态AI检测能力，实现语音+图像+文本的实时分析</li>
<li>部署可解释AI模块，确保审核决策透明可追溯</li>
<li>建立分级分类管理机制，差异化配置监控资源</li>
</ul>
</li>
<li>
<p><strong>质量管理体系建立</strong>：</p>
<ul>
<li>引入prompt-minder.com等专业工具，实现Prompt版本控制与效果追踪</li>
<li>构建AI内容生成质量管理流程，确保全流程可审计</li>
<li>部署实时监控与预警系统，实现风险早发现早处置</li>
</ul>
</li>
</ol>
<p><strong>技术投入估算：</strong></p>



































<table><thead><tr><th>项目</th><th>中小型企业</th><th>大型企业</th></tr></thead><tbody><tr><td>标识系统开发</td><td>15-25万元</td><td>80-150万元</td></tr><tr><td>审核系统升级</td><td>20-35万元</td><td>120-200万元</td></tr><tr><td>质量管理工具</td><td>5-10万元/年</td><td>30-50万元/年</td></tr><tr><td>人员培训投入</td><td>3-5万元</td><td>15-25万元</td></tr><tr><td><strong>年度总投入</strong></td><td><strong>43-75万元</strong></td><td><strong>245-425万元</strong></td></tr></tbody></table>
<h3 data-id="heading-19">第三阶段：组织流程再造（2-4个月）</h3>
<p><strong>组织架构调整：</strong></p>
<ul>
<li><strong>设立AI合规委员会</strong>：由技术、法务、运营、市场等多部门组成，负责合规战略决策</li>
<li><strong>配置专职岗位</strong>：AI合规官、内容审核经理、数据安全专员等</li>
<li><strong>建立跨部门协作机制</strong>：明确技术、业务、法务部门的协同流程与责任边界</li>
</ul>
<p><strong>制度流程建设：</strong></p>
<ul>
<li><strong>制定《AI生成内容管理规范》</strong>：明确标识要求、审核标准、责任追溯流程</li>
<li><strong>建立风险应急预案</strong>：针对不同违规场景（虚假宣传、数据泄露等）制定分级响应机制</li>
<li><strong>实施常态化培训</strong>：每季度组织AI合规专题培训，提升全员合规意识</li>
</ul>
<h3 data-id="heading-20">第四阶段：持续监控与优化（常态化）</h3>
<p><strong>监控体系构建：</strong></p>
<ul>
<li><strong>部署实时监控系统</strong>：对AI主播内容进行7×24小时监测，自动识别违规行为</li>
<li><strong>建立合规指标体系</strong>：设定标识合规率、审核准确率、投诉处理时效等关键指标</li>
<li><strong>实施定期审计</strong>：每半年开展AI合规专项审计，评估制度执行效果</li>
</ul>
<p><strong>持续优化机制：</strong></p>
<ul>
<li><strong>动态规则更新</strong>：跟踪监管政策变化，及时调整内部合规标准</li>
<li><strong>技术迭代升级</strong>：持续引入先进检测工具，提升自动化合规能力</li>
<li><strong>经验总结分享</strong>：定期组织跨部门合规案例复盘，形成可复用最佳实践</li>
</ul>
<h2 data-id="heading-21">六、国际对比：中美欧监管政策差异</h2>
<p>全球AI生成内容监管呈现“三足鼎立”格局，中国、欧盟、美国采取差异化治理路径。</p>
<h3 data-id="heading-22">中国：强制标识与全链条责任</h3>
<p><strong>监管特征：</strong></p>
<ul>
<li><strong>技术标准先行</strong>：《人工智能生成合成内容标识办法》构建显隐双重标识体系</li>
<li><strong>场景化治理</strong>：《直播电商监督管理办法》聚焦垂直领域，实现精准监管</li>
<li><strong>责任穿透</strong>：明确直播间运营者为第一责任人，建立“技术提供方-平台方-运营方”连带责任机制</li>
</ul>
<p><strong>合规要求对比：</strong></p>






























<table><thead><tr><th>维度</th><th>中国要求</th><th>国际常见做法</th></tr></thead><tbody><tr><td>标识义务</td><td>强制显隐双重标识，全程持续提示</td><td>多数国家无强制要求，以平台自律为主</td></tr><tr><td>责任主体</td><td>运营者承担全部责任，不得推诿</td><td>责任分散，平台承担有限责任</td></tr><tr><td>数据留存</td><td>直播回放等信息保存不少于3年</td><td>通常6个月至1年</td></tr><tr><td>处罚力度</td><td>最高处违法所得3倍罚款，永久封号</td><td>以罚款为主，封号多为临时性</td></tr></tbody></table>
<h3 data-id="heading-23">欧盟：风险分级与第三方审计</h3>
<p><strong>《人工智能法案》（2025年8月生效）核心要求：</strong></p>
<ul>
<li><strong>四级风险分类</strong>：禁止类（实时生物识别）、高风险（医疗诊断）、有限风险（聊天机器人）、最小风险</li>
<li><strong>第三方审计</strong>：高风险AI系统必须经认证机构审计，确保合规性</li>
<li><strong>全球示范效应</strong>：建立“布鲁塞尔效应”，推动全球监管标准趋同</li>
</ul>
<p><strong>与中国监管差异：</strong></p>






























<table><thead><tr><th>比较点</th><th>欧盟模式</th><th>中国模式</th></tr></thead><tbody><tr><td>监管逻辑</td><td>风险分级，分类施策</td><td>全链条覆盖，统一标准</td></tr><tr><td>技术路径</td><td>强调算法透明与可解释性</td><td>标识溯源与内容审核并重</td></tr><tr><td>处罚力度</td><td>最高3500万欧元或全球营业额7%</td><td>违法所得3倍罚款，行业禁入</td></tr><tr><td>实施机制</td><td>第三方认证与审计</td><td>平台自查+行政监管</td></tr></tbody></table>
<h3 data-id="heading-24">美国：技术中立与市场竞争</h3>
<p><strong>特朗普政府第14365号行政令《确保人工智能国家监管政策框架》核心转向：</strong></p>
<ul>
<li><strong>减少监管干预</strong>：推动“逐底竞争”，禁止各州对AI输出内容强制修改</li>
<li><strong>技术言论自由</strong>：将AI生成内容视为“技术言论”，享有宪法第一修正案保护</li>
<li><strong>诉讼特遣队</strong>：成立专门机构起诉州级监管法律，统一联邦标准</li>
</ul>
<p><strong>企业出海合规建议：</strong></p>
<p>对于计划拓展海外市场的中国企业，需建立“一国一策”的合规架构：</p>
<ol>
<li><strong>欧盟市场</strong>：重点投入第三方审计认证，建立高风险AI系统合规档案</li>
<li><strong>美国市场</strong>：关注联邦与州法律差异，避免触发“技术言论自由”争议</li>
<li><strong>新兴市场</strong>：参考中国监管模式，输出技术标准与治理经验</li>
</ol>
<p><strong>合规整合策略：</strong></p>
<ul>
<li><strong>技术平台统一化</strong>：开发支持多区域合规配置的标识与审核系统</li>
<li><strong>治理框架模块化</strong>：根据目标市场风险等级，动态调整合规策略</li>
<li><strong>审计证据标准化</strong>：建立跨区域互认的合规证据体系，降低重复审计成本</li>
</ul>
<h2 data-id="heading-25">结语：从监管压力到发展机遇</h2>
<p>《直播电商监督管理办法》的实施，标志着AI主播从“野蛮生长”进入“规范发展”新阶段。表面看是监管收紧，实质是行业洗牌与价值重塑。</p>
<p><strong>对企业而言，合规不再是成本负担，而是构建长期竞争力的战略投资。</strong> 通过建立技术合规能力，企业不仅可以规避监管风险，更能在以下维度获得差异化优势：</p>
<ol>
<li><strong>用户信任</strong>：清晰的AI标识与透明的审核机制，将提升消费者信任度，降低交易摩擦</li>
<li><strong>运营效率</strong>：自动化合规系统可大幅降低人工审核成本，实现7×24小时不间断合规监控</li>
<li><strong>市场准入</strong>：完善的合规体系是企业进入高监管行业（金融、医疗、教育等）的必要前提</li>
<li><strong>技术壁垒</strong>：先进的AI合规技术将成为企业的核心技术资产，形成竞争护城河</li>
</ol>
<p><strong>对行业而言，新规将推动AI主播从“流量工具”向“价值平台”转型。</strong> 通过建立标准化、透明化、可追溯的治理体系，AI主播技术将真正成为提升商业效率、保护消费者权益、促进产业升级的基础设施。</p>
<p>正如中国监管逻辑所体现的：<strong>技术发展必须在规范轨道上前行，而规范的目标正是为了让技术走得更稳、更远。</strong> 在AI技术浪潮中，那些率先完成合规转型的企业，将不仅获得监管的“通行证”，更将赢得市场与用户的“信任票”，在智能商业时代占据领先地位。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git Worktree + Claude Code：多终端并发开发完全实战]]></title>    <link>https://juejin.cn/post/7605214360085299236</link>    <guid>https://juejin.cn/post/7605214360085299236</guid>    <pubDate>2026-02-11T11:50:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605214360085299236" data-draft-id="7605150769009672235" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git Worktree + Claude Code：多终端并发开发完全实战"/> <meta itemprop="keywords" content="AI编程,Claude"/> <meta itemprop="datePublished" content="2026-02-11T11:50:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git Worktree + Claude Code：多终端并发开发完全实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T11:50:24.000Z" title="Wed Feb 11 2026 11:50:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言:等待 AI 的时间浪费</h2>
<p>如果你已经开始使用 Claude Code 进行开发,一定遇到过这样的场景:</p>
<ul>
<li><strong>场景 1</strong>: 让 AI 分析一个复杂的 Bug,你坐在电脑前等了 5 分钟,AI 还在读代码...</li>
<li><strong>场景 2</strong>: 让 AI 重构一个大模块,15 分钟过去了,你刷完了朋友圈,AI 还在工作...</li>
<li><strong>场景 3</strong>: 临时有个紧急 Bug 要修,但 AI 正在实现另一个功能,你该打断它还是继续等?</li>
</ul>
<p><strong>本质问题</strong>:单终端开发模式让你变成了"AI 的陪跑员"——大量时间花在等待上,开发效率反而下降了。</p>
<h3 data-id="heading-1">💡 解决方案:多终端并发</h3>
<p>想象一下这样的工作方式:</p>
<ul>
<li><strong>终端 1</strong>: AI 正在分析内存泄漏问题</li>
<li><strong>终端 2</strong>: 同时实现新的登录功能</li>
<li><strong>终端 3</strong>: 编写单元测试用例</li>
<li><strong>你的手机</strong>: 收到通知"内存泄漏分析完成",立即切换回去查看</li>
</ul>
<p>三个 AI "队友"同时工作,你只需要在任务完成时切换过去验收成果。效率提升 2-3 倍不是梦想。</p>
<p><strong>本文核心内容</strong>:</p>
<ol>
<li>Git Worktree 详解 - 多终端并发的基础设施</li>
<li>Claude Code 多会话机制</li>
<li>Android 开发的实战案例</li>
</ol>
<blockquote>
<p>"Git Worktree:让多个分支同时活跃,AI 并行工作的基础设施"</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">一、为什么需要多终端并发?</h2>
<h3 data-id="heading-3">1.1 单终端开发的效率瓶颈</h3>
<p>让我们用数据说话,看一个典型的 Android 功能开发流程:</p>
<pre><code class="hljs language-markdown" lang="markdown">串行开发(单终端):
需求分析(AI)      → 10 分钟
架构设计          → 15 分钟
实现登录界面      → 20 分钟
实现后端接口      → 25 分钟
编写单元测试      → 15 分钟
<span class="hljs-section">修复Bug           → 10 分钟
----------------------------</span>
总耗时: 95 分钟 (~1.5 小时)
</code></pre>
<p><strong>问题分析</strong>:</p>
<ul>
<li>每个阶段都要等待前一个阶段完成</li>
<li>大量时间花在等待 AI 生成代码和分析</li>
<li>紧急任务无法插队,只能等待或打断</li>
</ul>
<h3 data-id="heading-4">1.2 多终端并发的效率提升</h3>
<p>同样的任务,使用多终端并发:</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">串行部分(必须按顺序):</span>
需求分析(AI)      → 10 分钟
架构设计          → 15 分钟

<span class="hljs-section">并行开发(基于架构设计):</span>
<span class="hljs-section">终端1: 实现登录界面(同时进行)                 → 20 分钟</span>
<span class="hljs-section">终端2: 实现后端接口(同时进行)                 → 25 分钟</span>

<span class="hljs-section">并行测试和Bug修复(开发完成后):</span>
<span class="hljs-section">终端1: 编写单元测试(开发完成后)               → 15 分钟</span>
<span class="hljs-section">终端2: 修复Bug1(发现问题)                     → 10 分钟</span>
<span class="hljs-section">终端3: 修复Bug2(同时进行)                     → 8 分钟</span>
----------------------------
<span class="hljs-section">总耗时: 10 + 15 + 25(最长) + 15(最长) = 65 分钟 (~1.1 小时)</span>
</code></pre>
<p><strong>效率对比</strong>:</p>
<ul>
<li>串行: 95 分钟</li>
<li>并行: 65 分钟</li>
<li><strong>提升幅度: 1.5 倍</strong> ✨</li>
</ul>
<p><strong>关键点</strong>:</p>
<ul>
<li>需求分析和架构设计必须串行,确保方向正确</li>
<li>UI和后端开发可以并行,前提是接口已定义</li>
<li>测试必须在开发完成后进行</li>
<li>多个Bug修复可以并行处理</li>
</ul>
<h3 data-id="heading-5">1.3 并行开发的核心挑战</h3>
<p>虽然并行开发能大幅提升效率,但在同一个代码工程中并行工作会遇到一个关键问题:</p>
<p><strong>问题</strong>: 如果多个终端同时修改同一个文件,就会产生 Git 冲突。</p>
<p>例如:</p>
<ul>
<li>终端1 在 <code>feature/login</code> 分支修改 <code>LoginActivity.kt</code></li>
<li>终端2 在 <code>feature/payment</code> 分支也修改 <code>LoginActivity.kt</code></li>
<li>合并时会产生冲突,需要手动解决</li>
</ul>
<p><strong>传统解决方案的局限</strong>:</p>
<ul>
<li>使用 <code>git checkout</code> 切换分支: 只能同时工作在一个分支上</li>
<li>切换分支需要重新编译,浪费时间</li>
<li>未提交的修改会阻止切换</li>
</ul>
<p><strong>解决方案</strong>: 使用 <strong>Git Worktree</strong> 让多个分支同时活跃,每个分支有独立的工作目录,避免文件冲突。</p>
<hr/>
<h2 data-id="heading-6">二、基础设施:Git Worktree 详解</h2>
<h3 data-id="heading-7">2.1 什么是 Git Worktree?</h3>
<p><strong>Git Worktree</strong> 是 Git 2.5+ 引入的功能(现代 Git 版本都支持),允许你<strong>同时检出多个分支到不同的目录</strong>,每个工作目录可以独立编译和运行,互不干扰。</p>
<h4 data-id="heading-8">传统方式 vs Worktree</h4>
<p><strong>传统分支切换</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 只有一个工作目录</span>
my-project/
  ├── src/
  ├── build/
  └── .git/

<span class="hljs-comment"># 切换分支会改变工作目录内容</span>
git checkout feature-login    <span class="hljs-comment"># 工作目录变成 login 分支内容</span>
git checkout feature-payment  <span class="hljs-comment"># 工作目录变成 payment 分支内容</span>
</code></pre>
<p><strong>问题</strong>:</p>
<ul>
<li>只能同时工作在一个分支上</li>
<li>切换分支需要重新编译</li>
<li>未提交的修改会阻止切换</li>
</ul>
<p><strong>Worktree 方式</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 多个工作目录同时存在</span>
my-project/          <span class="hljs-comment"># 主分支(main)</span>
  ├── src/
  ├── build/
  └── .git/

my-project-login/    <span class="hljs-comment"># login 分支</span>
  ├── src/
  ├── build/
  └── .git/          <span class="hljs-comment"># 软链接到主仓库</span>

my-project-payment/  <span class="hljs-comment"># payment 分支</span>
  ├── src/
  ├── build/
  └── .git/          <span class="hljs-comment"># 软链接到主仓库</span>
</code></pre>
<p><strong>优势</strong>:</p>
<ul>
<li>✅ 多个分支同时活跃</li>
<li>✅ 无需切换分支,无需重新编译</li>
<li>✅ 每个分支独立运行 Claude Code</li>
<li>✅ 共享同一个 Git 仓库,节省磁盘空间</li>
</ul>
<h3 data-id="heading-9">2.2 Worktree 基本使用</h3>
<h4 data-id="heading-10">创建 Worktree</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 语法</span>
git worktree add &lt;path&gt; &lt;branch&gt;

<span class="hljs-comment"># 示例:创建 feature-login 分支的 worktree</span>
git worktree add ../my-app-login -b feature-login

<span class="hljs-comment"># 示例:从远程分支创建</span>
git worktree add ../my-app-payment -b feature-payment origin/feature-payment
</code></pre>
<p><strong>参数说明</strong>:</p>
<ul>
<li><code>&lt;path&gt;</code>: Worktree 目录路径(建议使用绝对路径或相对于仓库根目录的路径)</li>
<li><code>&lt;branch&gt;</code>: 分支名称</li>
<li><code>-b</code>: 创建新分支(如果分支已存在,省略此参数)</li>
</ul>
<h4 data-id="heading-11">查看所有 Worktree</h4>
<pre><code class="hljs language-bash" lang="bash">git worktree list

<span class="hljs-comment"># 输出示例:</span>
<span class="hljs-comment"># /home/user/projects/my-app              abc123 [main]</span>
<span class="hljs-comment"># /home/user/projects/my-app-login        def456 [feature-login]</span>
<span class="hljs-comment"># /home/user/projects/my-app-payment      ghi789 [feature-payment]</span>
</code></pre>
<h4 data-id="heading-12">删除 Worktree</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方法1:删除目录后清理 (推荐)</span>
<span class="hljs-built_in">rm</span> -rf ../my-app-login
git worktree prune

<span class="hljs-comment"># 方法2:使用 git worktree remove (Git 2.17+)</span>
git worktree remove ../my-app-login

<span class="hljs-comment"># 强制删除(即使有未提交的修改)</span>
git worktree remove -f ../my-app-login
</code></pre>
<h4 data-id="heading-13">其他常用命令</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 移动 worktree 到新位置</span>
git worktree move &lt;old-path&gt; &lt;new-path&gt;

<span class="hljs-comment"># 锁定 worktree (防止被 prune 删除)</span>
git worktree lock &lt;path&gt;

<span class="hljs-comment"># 解锁 worktree</span>
git worktree unlock &lt;path&gt;
</code></pre>
<h3 data-id="heading-14">2.3 推荐的目录结构</h3>
<p>对于 Android 项目,推荐以下目录组织方式:</p>
<pre><code class="hljs language-bash" lang="bash">~/AndroidProjects/
  ├── MyApp/                    <span class="hljs-comment"># 主工作目录 (main 分支)</span>
  │   ├── app/
  │   ├── gradle/
  │   └── .git/
  │
  ├── MyApp-feature-login/      <span class="hljs-comment"># 登录功能 worktree</span>
  │   ├── app/
  │   └── .git -&gt; ../MyApp/.git
  │
  ├── MyApp-feature-payment/    <span class="hljs-comment"># 支付功能 worktree</span>
  │   ├── app/
  │   └── .git -&gt; ../MyApp/.git
  │
  └── MyApp-bugfix-memory/      <span class="hljs-comment"># Bug 修复 worktree</span>
      ├── app/
      └── .git -&gt; ../MyApp/.git
</code></pre>
<p><strong>命名规范建议</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 功能开发</span>
&lt;项目名&gt;-feature-&lt;功能名&gt;

<span class="hljs-comment"># Bug 修复</span>
&lt;项目名&gt;-bugfix-&lt;问题描述&gt;

<span class="hljs-comment"># 重构任务</span>
&lt;项目名&gt;-refactor-&lt;模块名&gt;

<span class="hljs-comment"># 测试用例</span>
&lt;项目名&gt;-<span class="hljs-built_in">test</span>-&lt;模块名&gt;
</code></pre>
<h3 data-id="heading-15">2.4 Worktree 的工作原理</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7432b02f6269460aaf3668e7e6f5b416~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771415424&amp;x-signature=CHcX5ArMRaiUL0PIrkZEvxrknjU%3D" alt="06-01-worktree-structure.png" loading="lazy"/></p>
<p>Git Worktree 通过<strong>符号链接</strong>共享 Git 对象数据库:</p>
<pre><code class="hljs language-bash" lang="bash">主仓库 MyApp/.git/
  ├── objects/           <span class="hljs-comment"># 所有对象数据(共享)</span>
  ├── refs/              <span class="hljs-comment"># 所有引用(共享)</span>
  ├── config             <span class="hljs-comment"># 仓库配置(共享)</span>
  └── worktrees/         <span class="hljs-comment"># Worktree 元数据</span>
      ├── MyApp-login/   <span class="hljs-comment"># 记录 worktree 位置和分支</span>
      └── MyApp-payment/

Worktree MyApp-login/
  ├── app/               <span class="hljs-comment"># 工作目录</span>
  └── .git              <span class="hljs-comment"># 文件,内容: gitdir: ../MyApp/.git/worktrees/MyApp-login</span>
</code></pre>
<p><strong>核心机制</strong>:</p>
<ol>
<li>所有 worktree 共享同一个对象数据库(objects/)</li>
<li>每个 worktree 有独立的工作目录和 HEAD</li>
<li>提交操作会更新共享的对象数据库</li>
<li>磁盘占用仅增加工作目录大小,不重复存储 Git 数据</li>
</ol>
<h3 data-id="heading-16">2.5 Worktree 的注意事项</h3>
<h4 data-id="heading-17">⚠️ 注意文件冲突风险,使用 Claude Code 辅助解决</h4>
<p>Git Worktree 允许在不同分支并行开发,但<strong>仍然需要注意文件冲突的风险</strong>。如果多个分支修改了同一个文件,合并时会产生冲突。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 示例:两个 worktree 都修改 LoginActivity.kt</span>
终端1 (MyApp-login): 在 feature/login 分支修改 LoginActivity.kt
终端2 (MyApp-payment): 在 feature/payment 分支也修改 LoginActivity.kt

<span class="hljs-comment"># 合并时会产生冲突,需要处理</span>
</code></pre>
<p><strong>重要说明</strong>:</p>
<ul>
<li>Git Worktree <strong>本身无法解决冲突</strong>,它只是提供了并行开发的能力</li>
<li>冲突仍然需要手动或工具辅助解决</li>
<li><strong>Claude Code 可以辅助解决冲突</strong>,理解代码语义,减少人工处理的工作量</li>
</ul>
<p><strong>使用 Claude Code 处理冲突</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 合并 feature/login 到 main</span>
<span class="hljs-built_in">cd</span> ~/AndroidProjects/MyApp
git checkout main
git merge feature/login

<span class="hljs-comment"># 如果有冲突,使用 Claude Code 辅助解决</span>
claude
<span class="hljs-comment"># 输入提示词来让ClaudeCode自动处理</span>
AI: 分析冲突...已智能合并,保留了登录和支付功能,请确认是否符合预期
</code></pre>
<p><strong>最佳实践</strong>:</p>
<ul>
<li>尽量规划任务,减少文件重叠修改</li>
<li>如果必须修改公共文件,及时合并,避免差异过大</li>
<li>使用 Claude Code 辅助解决冲突,提高效率</li>
</ul>
<h4 data-id="heading-18">✅ 定期同步和合并</h4>
<p>在功能完成时及时合并回主分支，防止差异过大之后合不进去</p>
<h4 data-id="heading-19">⚠️ 及时清理无用的 Worktree</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 定期检查</span>
git worktree list

<span class="hljs-comment"># 删除已完成任务的 worktree</span>
git worktree remove MyApp-feature-login

<span class="hljs-comment"># 清理过期引用</span>
git worktree prune
</code></pre>
<hr/>
<h2 data-id="heading-20">三、Claude Code 的多终端支持</h2>
<h3 data-id="heading-21">3.1 会话隔离机制</h3>
<p>Claude Code 支持多个独立会话,每个会话有:</p>
<ul>
<li>独立的上下文历史</li>
<li>独立的 Token 计数</li>
<li>独立的任务队列</li>
</ul>
<h4 data-id="heading-22">启动独立会话</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 示例:在不同 worktree 中启动不同会话</span>
<span class="hljs-built_in">cd</span> ~/AndroidProjects/MyApp-login
claude

<span class="hljs-built_in">cd</span> ~/AndroidProjects/MyApp-payment
claude
</code></pre>
<h4 data-id="heading-23">恢复之前的会话</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 恢复会话(自动加载上下文)</span>
claude -c
<span class="hljs-comment"># 列出所有会话，选择恢复</span>
claude -r
</code></pre>
<h3 data-id="heading-24">3.2 任务完成通知</h3>
<p>多终端并发时,你无法实时监控每个终端。建议配置任务完成通知,让你在任务完成时及时收到提醒。</p>
<p><strong>配置方法</strong>: 参考第 5 篇文章中的 Hook 机制,配置 <code>task-complete</code> Hook 来实现任务完成通知。详细配置步骤和脚本示例请参考第 5 篇。</p>
<hr/>
<h2 data-id="heading-25">四、实战案例: AOSP Music 应用多需求并行开发</h2>
<h3 data-id="heading-26">背景</h3>
<p>以 AOSP 原生 Music 应用为例,需要同时开发两个功能:</p>
<ol>
<li><strong>需求 A</strong>: 添加时长显示功能 - 在播放界面显示当前播放时长和总时长</li>
<li><strong>需求 B</strong>: 添加音频焦点请求结果处理 - 处理音频焦点请求成功/失败的回调</li>
</ol>
<p>传统串行开发预计需要 <strong>90 分钟</strong>。</p>
<h4 data-id="heading-27">任务分解</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 准备 AOSP Music 应用代码库</span>
<span class="hljs-built_in">cd</span> ~/aosp/packages/apps/Music
<span class="hljs-comment"># 确保代码库已同步到最新</span>

<span class="hljs-comment"># 2. 创建两个 Worktree 用于并行开发</span>
git worktree add ../Music-feature-a -b feature-a
git worktree add ../Music-feature-b -b feature-b

</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0e863bf9ea74ab991ca5b3852eeda5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771415424&amp;x-signature=lWHEaiaiCRcMhQKMf2lMyAw3SS4%3D" alt="06-02-add-worktree.png" loading="lazy"/></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 3. 启动 2 个 Claude Code 会话</span>
<span class="hljs-comment"># 终端1: 需求 A</span>
<span class="hljs-built_in">cd</span> ../Music-feature-a
claude

<span class="hljs-comment"># 终端2: 需求 B</span>
<span class="hljs-built_in">cd</span> ../Music-feature-b
claude
</code></pre>
<h4 data-id="heading-28">并行开发流程</h4>
<p><strong>终端 1 (需求 A: 时长显示功能)</strong>:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/246e4a37455849b2a00aa5aa0ab696bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771415424&amp;x-signature=F%2FJkgFUxPcu%2BNuFKVZiASzSxiiM%3D" alt="06-03-worktree-feature-a.png" loading="lazy"/></p>
<p><strong>终端 2 (需求 B: 音频焦点请求结果处理)</strong>:</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db87b860eb014160b543833ab3c82585~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771415424&amp;x-signature=Ej7tiiubQH6QVtkT5hsH%2B09Iu9Q%3D" alt="06-04-worktree-feature-b.png" loading="lazy"/></p>
<h4 data-id="heading-29">合并代码和提交代码</h4>
<p>遵循代码提交的原则，每笔提交要求保证功能的原子化。我们先合并需求A的代码到本地主线分支并提交，再合并需求B的代码。如果需求A和B有关联，需要合并测试，则根据实际情况调整。</p>
<p><strong>首先处理需求A的修改</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在feature-a分支提交需求A的修改</span>
<span class="hljs-built_in">cd</span> ../Music-feature-a
git status .
<span class="hljs-comment"># 添加需要提交的代码</span>
git add .
git commit -m <span class="hljs-string">"feat: 添加时长显示功能"</span>
</code></pre>
<p><strong>合并回主分支</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 返回主仓库</span>
<span class="hljs-built_in">cd</span> ../Music

<span class="hljs-comment"># 合并功能分支</span>
git checkout master
git merge feature-a
</code></pre>
<p><strong>然后处理需求B的修改</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在feature-b分支提交需求B的修改</span>
<span class="hljs-built_in">cd</span> ../Music-feature-b
git status .
<span class="hljs-comment"># 添加需要提交的代码</span>
git add .
git commit -m <span class="hljs-string">"feat: 添加音频焦点请求结果处理"</span>
</code></pre>
<p><strong>合并回主分支</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 返回主仓库</span>
<span class="hljs-built_in">cd</span> ../Music

<span class="hljs-comment"># 合并功能分支</span>
git checkout master
git merge feature-b
</code></pre>
<p>这一步可能会出现feature-b和feature-a修改的代码冲突，需要解决冲突。</p>
<h4 data-id="heading-30">使用 Claude Code 自动化处理</h4>
<h4 data-id="heading-31">使用ClaudeCode</h4>
<p>以上过程大家也看出来了，多多少少还是有些麻烦的，而且要记好几条命令，这个年代了代码都AI写了，还让我们人工处理提交和合并，这不就是我们给AI打工了。不行，万万不行。
果断起一个claude会话，让它来处理。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b387a3dccca4062ba1eb0b2501b9056~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771415424&amp;x-signature=ioYSBfQG2p5cQfTQYnfcuPR7qRE%3D" alt="06-06-merge-code-with-cc.png" loading="lazy"/></p>
<p>如果这两个worktree空间不需要了，也可以直接让ClaudeCode清除掉空间和分支。</p>
<hr/>
<h2 data-id="heading-32">五、最佳实践与经验总结</h2>
<h3 data-id="heading-33">5.1 Worktree 管理最佳实践</h3>
<h4 data-id="heading-34">命名规范</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 推荐的命名模式</span>
&lt;项目名&gt;-&lt;类型&gt;-&lt;简短描述&gt;

<span class="hljs-comment"># 示例</span>
MyApp-feature-login        <span class="hljs-comment"># 功能开发</span>
MyApp-bugfix-crash         <span class="hljs-comment"># Bug 修复</span>
MyApp-refactor-network     <span class="hljs-comment"># 重构任务</span>
MyApp-test-unit            <span class="hljs-comment"># 测试用例</span>
MyApp-hotfix-security      <span class="hljs-comment"># 紧急修复</span>
</code></pre>
<h4 data-id="heading-35">定期清理</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 每周检查 Worktree 列表</span>
git worktree list

<span class="hljs-comment"># 删除已合并的 Worktree</span>
git worktree remove MyApp-feature-login

<span class="hljs-comment"># 清理无效引用</span>
git worktree prune

<span class="hljs-comment"># 批量清理 (慎用!)</span>
<span class="hljs-keyword">for</span> wt <span class="hljs-keyword">in</span> $(git worktree list --porcelain | grep <span class="hljs-string">"worktree"</span> | <span class="hljs-built_in">cut</span> -d<span class="hljs-string">' '</span> -f2); <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$wt</span>"</span> != <span class="hljs-string">"<span class="hljs-subst">$(pwd)</span>"</span> ]; <span class="hljs-keyword">then</span>
        git worktree remove <span class="hljs-string">"<span class="hljs-variable">$wt</span>"</span> 2&gt;/dev/null || <span class="hljs-built_in">echo</span> <span class="hljs-string">"Skipped: <span class="hljs-variable">$wt</span>"</span>
    <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
</code></pre>
<h3 data-id="heading-36">5.2 效率提升 Checklist</h3>
<p>在开始多终端开发前,检查以下事项:</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>任务已拆分</strong>: 明确各任务的边界和接口</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>Worktree 已创建</strong>: 每个任务有独立工作目录</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>会话已隔离</strong>: 每个 Worktree 启动独立 Claude Code 会话</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>通知已配置</strong>: task-complete Hook 已设置</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>依赖已梳理</strong>: 清楚哪些任务可以并行</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>资源已确认</strong>: 确保机器有足够内存和 API 配额</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>合并策略已定</strong>: 知道如何合并多个分支</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>冲突方案已备</strong>: 准备好处理潜在冲突</li>
</ul>
<hr/>
<h2 data-id="heading-37">六、参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Fdocs%2Fgit-worktree" target="_blank" title="https://git-scm.com/docs/git-worktree" ref="nofollow noopener noreferrer">Git Worktree 官方文档</a></li>
</ul>
<hr/>
<p>🔗 <strong>相关文章</strong>:</p>
<ul>
<li><a href="https://juejin.cn/post/7603911453704159275" target="_blank" title="https://juejin.cn/post/7603911453704159275">上一篇: Hook 机制实战:让 ClaudeCode 主动通知你</a></li>
</ul>
<hr/>
<p><em>如果这篇文章对你有帮助,欢迎点赞、收藏、分享!有任何问题或建议,欢迎在评论区留言讨论。让我们一起学习,一起成长!</em></p>
<p><em>也欢迎访问我的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>发现更多宝藏资源</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天一个开源项目（第19篇）：Folo - AI驱动的下一代信息阅读器]]></title>    <link>https://juejin.cn/post/7605214360085315620</link>    <guid>https://juejin.cn/post/7605214360085315620</guid>    <pubDate>2026-02-11T11:53:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605214360085315620" data-draft-id="7605131777176207423" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天一个开源项目（第19篇）：Folo - AI驱动的下一代信息阅读器"/> <meta itemprop="keywords" content="人工智能,开源,资讯"/> <meta itemprop="datePublished" content="2026-02-11T11:53:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="冬奇Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天一个开源项目（第19篇）：Folo - AI驱动的下一代信息阅读器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    冬奇Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T11:53:45.000Z" title="Wed Feb 11 2026 11:53:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<blockquote>
<p>"你的思想就是你阅读的内容——我们已经被嘈杂的信息流困扰太久了！"</p>
</blockquote>
<p>这是"一天一个开源项目"系列的第19篇文章。今天带你了解的项目是 <strong>Folo</strong>（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRSSNext%2FFolo" target="_blank" title="https://github.com/RSSNext/Folo" ref="nofollow noopener noreferrer">GitHub</a>）。</p>
<p>在信息爆炸的时代，我们每天面对海量的 RSS 源、新闻网站、博客和社交媒体内容。传统的 RSS 阅读器要么功能单一，要么界面复杂，要么缺乏智能化能力。<strong>Folo</strong> 应运而生，它是一个<strong>AI 驱动的下一代信息阅读器</strong>，将各种内容源（RSS、列表、集合）统一聚合到一条时间线上，让你在一个地方就能追踪所有重要信息。更重要的是，它内置了 AI 能力，支持翻译、摘要、智能推荐等功能，让阅读变得更加高效和愉悦。</p>
<p><strong>为什么选择这个项目？</strong></p>
<ul>
<li>📰 <strong>统一信息聚合</strong>：RSS、列表、集合等多种内容源统一管理</li>
<li>🤖 <strong>AI 增强阅读</strong>：内置翻译、摘要、智能推荐等 AI 功能</li>
<li>📱 <strong>全平台支持</strong>：Web、iOS、Android、macOS、Windows、Linux 全覆盖</li>
<li>🎨 <strong>现代化界面</strong>：简洁美观，专注阅读体验</li>
<li>🔄 <strong>实时同步</strong>：多端数据实时同步，随时随地阅读</li>
<li>🌐 <strong>社区驱动</strong>：支持列表分享、集合探索，打造开放的信息社区</li>
<li>🎯 <strong>无噪音设计</strong>：智能过滤，只关注真正重要的内容</li>
</ul>
<h3 data-id="heading-1">你将学到什么</h3>
<ul>
<li>Folo 的核心架构和 Monorepo 设计</li>
<li>如何实现多端统一的阅读体验</li>
<li>AI 功能在阅读器中的应用</li>
<li>RSS 订阅源的管理和同步机制</li>
<li>与 Feedly、Inoreader 等传统 RSS 阅读器的对比</li>
<li>信息聚合和内容管理的技术实现</li>
<li>实际使用场景和最佳实践</li>
</ul>
<h3 data-id="heading-2">前置知识</h3>
<ul>
<li>对 RSS 协议有基本了解</li>
<li>了解现代前端开发（React、TypeScript）</li>
<li>对 Monorepo 架构有基本概念（可选）</li>
<li>对 AI 应用集成感兴趣（可选）</li>
</ul>
<hr/>
<h2 data-id="heading-3">项目背景</h2>
<h3 data-id="heading-4">项目简介</h3>
<p><strong>Folo</strong>（Follow Everything）是一个<strong>开源的 AI 驱动信息阅读器</strong>，由 RSSNext 团队开发。它不仅仅是一个 RSS 阅读器，更是一个<strong>统一的信息聚合平台</strong>，将 RSS 订阅、用户创建的列表、社区集合等多种内容源整合到一条时间线上，让用户能够在一个地方追踪所有重要信息。</p>
<p><strong>项目解决的核心问题</strong>：</p>
<ul>
<li>信息源分散：RSS、新闻网站、博客、社交媒体内容分散在各个平台</li>
<li>传统阅读器功能单一：缺乏 AI 增强、多端同步等现代功能</li>
<li>信息过载：海量内容难以筛选，缺乏智能过滤机制</li>
<li>阅读体验差：界面老旧，缺乏现代化设计</li>
<li>社区互动不足：无法分享和发现优质内容源</li>
</ul>
<p><strong>面向的用户群体</strong>：</p>
<ul>
<li>需要追踪多个信息源的新闻工作者和内容创作者</li>
<li>希望统一管理阅读内容的普通用户</li>
<li>需要多端同步阅读的移动用户</li>
<li>对 AI 增强功能感兴趣的技术爱好者</li>
<li>希望分享和发现优质内容源的社区用户</li>
</ul>
<h3 data-id="heading-5">作者/团队介绍</h3>
<p><strong>团队：RSSNext</strong></p>
<ul>
<li><strong>背景</strong>：专注于信息聚合和阅读体验的开源团队</li>
<li><strong>代表作品</strong>：Folo</li>
<li><strong>理念</strong>：让信息获取更加高效、智能、开放</li>
<li><strong>技术栈</strong>：TypeScript、React、React Native、Electron、Node.js</li>
</ul>
<h3 data-id="heading-6">项目数据</h3>
<ul>
<li>⭐ <strong>GitHub Stars</strong>: 37.1k+（持续增长中）</li>
<li>🍴 <strong>Forks</strong>: 2k+</li>
<li>📦 <strong>版本</strong>: v1.2.6（持续更新中，6,571+ commits）</li>
<li>📄 <strong>License</strong>: AGPL-3.0（开源协议，部分图标资源有特殊版权）</li>
<li>🌐 <strong>官网</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fapp.folo.is" target="_blank" title="https://app.folo.is" ref="nofollow noopener noreferrer">app.folo.is</a></li>
<li>💬 <strong>社区</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.gg%2FAwWcAQ7euc" target="_blank" title="https://discord.gg/AwWcAQ7euc" ref="nofollow noopener noreferrer">Discord</a>、GitHub Issues</li>
<li>👥 <strong>贡献者</strong>: 147位贡献者，活跃的社区参与</li>
</ul>
<p><strong>项目发展历程</strong>：</p>
<ul>
<li>2024年：项目创建，实现核心 RSS 阅读功能</li>
<li>持续迭代：添加 AI 功能、多端支持、列表分享等特性</li>
<li>社区增长：达到 37.1k+ Stars，成为最热门的开源 RSS 阅读器之一</li>
<li>全平台覆盖：支持 Web、iOS、Android、桌面端（macOS、Windows、Linux）</li>
<li>229个版本发布：持续的功能更新和 bug 修复</li>
</ul>
<p><strong>技术栈分布</strong>：</p>
<ul>
<li>TypeScript: 95.7%（主要开发语言）</li>
<li>Swift: 2.3%（iOS 原生部分）</li>
<li>JavaScript: 0.7%</li>
<li>CSS: 0.6%</li>
<li>HTML: 0.3%</li>
<li>Kotlin: 0.2%（Android 原生部分）</li>
<li>其他: 0.2%</li>
</ul>
<hr/>
<h2 data-id="heading-7">主要功能</h2>
<h3 data-id="heading-8">核心作用</h3>
<p>Folo 的核心作用是<strong>提供一个统一的信息聚合和阅读平台</strong>，主要功能包括：</p>
<ol>
<li><strong>多源订阅管理</strong>：支持 RSS/Atom 订阅源、用户列表、社区集合</li>
<li><strong>统一时间线</strong>：将所有内容源聚合到一条时间线，按时间顺序展示</li>
<li><strong>AI 增强功能</strong>：翻译、摘要、智能推荐等 AI 能力</li>
<li><strong>多端同步</strong>：Web、移动端、桌面端数据实时同步</li>
<li><strong>内容管理</strong>：标记已读、收藏、分类管理</li>
<li><strong>社区功能</strong>：分享列表、探索集合、发现优质内容</li>
<li><strong>多媒体支持</strong>：支持文章、视频、图片、音频等多种内容格式</li>
<li><strong>无干扰阅读</strong>：专注阅读体验，减少噪音干扰</li>
</ol>
<h3 data-id="heading-9">使用场景</h3>
<p>Folo 适用于多种信息阅读和管理场景：</p>
<ol>
<li>
<p><strong>新闻追踪</strong></p>
<ul>
<li>订阅多个新闻源，统一管理</li>
<li>通过时间线快速浏览最新资讯</li>
<li>使用 AI 摘要快速了解文章要点</li>
</ul>
</li>
<li>
<p><strong>技术博客聚合</strong></p>
<ul>
<li>订阅多个技术博客和开发者社区</li>
<li>在一个地方追踪所有技术更新</li>
<li>收藏重要文章，建立个人知识库</li>
</ul>
</li>
<li>
<p><strong>多语言阅读</strong></p>
<ul>
<li>使用 AI 翻译功能阅读外文内容</li>
<li>自动识别语言并提供翻译选项</li>
<li>支持多种语言的内容源</li>
</ul>
</li>
<li>
<p><strong>内容发现</strong></p>
<ul>
<li>浏览社区分享的优质列表</li>
<li>探索不同主题的内容集合</li>
<li>发现新的优质内容源</li>
</ul>
</li>
<li>
<p><strong>移动阅读</strong></p>
<ul>
<li>在手机上随时随地阅读</li>
<li>离线下载文章，无网络也能阅读</li>
<li>多设备同步，无缝切换</li>
</ul>
</li>
</ol>
<h3 data-id="heading-10">快速开始</h3>
<h4 data-id="heading-11">安装方式</h4>
<p>Folo 提供多种安装方式，覆盖所有主流平台：</p>
<p><strong>Web 版本（最简单）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 直接访问官网即可使用</span>
<span class="hljs-comment"># https://app.folo.is</span>
</code></pre>
<p><strong>桌面应用</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS - App Store</span>
<span class="hljs-comment"># 搜索 "Folo" 或访问：</span>
<span class="hljs-comment"># https://apps.apple.com/us/app/folo-follow-everything/id6739802604</span>

<span class="hljs-comment"># Windows - Microsoft Store</span>
<span class="hljs-comment"># 搜索 "Folo" 或访问：</span>
<span class="hljs-comment"># https://apps.microsoft.com/detail/9nvfzpv0v0ht</span>

<span class="hljs-comment"># Linux - 下载 AppImage</span>
<span class="hljs-comment"># 访问 GitHub Releases 页面下载</span>
<span class="hljs-comment"># https://github.com/RSSNext/Folo/releases/latest</span>
</code></pre>
<p><strong>移动应用</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># iOS - App Store</span>
<span class="hljs-comment"># 搜索 "Folo" 或访问：</span>
<span class="hljs-comment"># https://apps.apple.com/us/app/folo-follow-everything/id6739802604</span>

<span class="hljs-comment"># Android - Google Play</span>
<span class="hljs-comment"># 搜索 "Folo" 或访问：</span>
<span class="hljs-comment"># https://play.google.com/store/apps/details?id=is.follow</span>
</code></pre>
<p><strong>社区维护的安装方式</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Arch Linux</span>
yay -S folo-appimage  <span class="hljs-comment"># 由 timochan 和 grtsinry43 维护</span>

<span class="hljs-comment"># Nix</span>
nix-env -iA nixos.follow  <span class="hljs-comment"># 由 iosmanthus 维护</span>

<span class="hljs-comment"># macOS Homebrew</span>
brew install --cask folo  <span class="hljs-comment"># 由 realSunyz 维护</span>

<span class="hljs-comment"># Windows Scoop</span>
scoop install folo  <span class="hljs-comment"># 由 cscnk52 维护</span>
</code></pre>
<h4 data-id="heading-12">基本使用</h4>
<p><strong>1. 创建账户</strong></p>
<p>首次使用需要创建账户，支持邮箱注册或第三方登录。</p>
<p><strong>2. 添加订阅源</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式一：直接添加 RSS 链接</span>
1. 点击<span class="hljs-string">"添加订阅源"</span>
2. 输入 RSS/Atom 链接
3. 系统自动识别和验证

<span class="hljs-comment"># 方式二：搜索发现</span>
1. 使用内置的源发现功能
2. 浏览热门订阅源
3. 一键添加

<span class="hljs-comment"># 方式三：导入 OPML</span>
1. 从其他阅读器导出 OPML
2. 在 Folo 中导入
3. 批量添加订阅源
</code></pre>
<p><strong>3. 开始阅读</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 时间线浏览</span>
- 所有订阅源的内容按时间顺序展示
- 支持标记已读/未读
- 支持收藏重要文章

<span class="hljs-comment"># AI 功能使用</span>
- 点击文章，使用<span class="hljs-string">"摘要"</span>功能快速了解要点
- 使用<span class="hljs-string">"翻译"</span>功能阅读外文内容
- 根据阅读习惯获得智能推荐
</code></pre>
<p><strong>4. 管理内容</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 分类管理</span>
- 创建文件夹组织订阅源
- 按主题分类管理
- 设置自动标记规则

<span class="hljs-comment"># 同步设置</span>
- 开启多端同步
- 设置同步频率
- 管理离线下载
</code></pre>
<h3 data-id="heading-13">核心特性</h3>
<ol>
<li>
<p><strong>统一时间线</strong></p>
<ul>
<li>将所有订阅源的内容聚合到一条时间线</li>
<li>按时间顺序展示，最新内容优先</li>
<li>支持过滤和搜索，快速找到目标内容</li>
</ul>
</li>
<li>
<p><strong>AI 增强阅读</strong></p>
<ul>
<li><strong>智能摘要</strong>：自动生成文章摘要，快速了解要点</li>
<li><strong>多语言翻译</strong>：支持多种语言的实时翻译</li>
<li><strong>智能推荐</strong>：根据阅读习惯推荐相关内容</li>
<li><strong>内容理解</strong>：AI 分析文章主题和关键信息</li>
</ul>
</li>
<li>
<p><strong>多端同步</strong></p>
<ul>
<li>Web、iOS、Android、桌面端数据实时同步</li>
<li>阅读进度、收藏、标记状态全平台同步</li>
<li>离线下载支持，无网络也能阅读</li>
</ul>
</li>
<li>
<p><strong>列表和集合</strong></p>
<ul>
<li><strong>个人列表</strong>：创建和管理个人内容列表</li>
<li><strong>列表分享</strong>：分享优质列表给其他用户</li>
<li><strong>集合探索</strong>：浏览社区创建的优质内容集合</li>
<li><strong>发现新源</strong>：通过社区发现新的优质内容源</li>
</ul>
</li>
<li>
<p><strong>现代化界面</strong></p>
<ul>
<li>简洁美观的设计，专注阅读体验</li>
<li>支持深色/浅色主题切换</li>
<li>响应式布局，适配各种屏幕尺寸</li>
<li>流畅的动画和交互体验</li>
</ul>
</li>
<li>
<p><strong>多媒体支持</strong></p>
<ul>
<li>支持文章、视频、图片、音频等多种格式</li>
<li>内置媒体播放器</li>
<li>支持富文本和 Markdown 渲染</li>
</ul>
</li>
<li>
<p><strong>无噪音设计</strong></p>
<ul>
<li>智能过滤重复和低质量内容</li>
<li>可自定义的过滤规则</li>
<li>专注重要内容，减少干扰</li>
</ul>
</li>
<li>
<p><strong>开放生态</strong></p>
<ul>
<li>支持 RSS/Atom 标准协议</li>
<li>支持 OPML 导入导出</li>
<li>API 接口支持（如有）</li>
<li>插件系统（如有）</li>
</ul>
</li>
</ol>
<h3 data-id="heading-14">项目优势</h3>
<p>与传统 RSS 阅读器和其他信息聚合工具的对比：</p>





























































<table><thead><tr><th align="left">对比项</th><th align="left">Folo</th><th align="left">Feedly</th><th align="left">Inoreader</th><th align="left">Pocket</th></tr></thead><tbody><tr><td align="left"><strong>开源</strong></td><td align="left">✅ 完全开源</td><td align="left">❌ 闭源</td><td align="left">❌ 闭源</td><td align="left">❌ 闭源</td></tr><tr><td align="left"><strong>AI 功能</strong></td><td align="left">✅ 内置翻译、摘要</td><td align="left">⚠️ 部分功能需付费</td><td align="left">⚠️ 部分功能需付费</td><td align="left">❌ 无</td></tr><tr><td align="left"><strong>多端同步</strong></td><td align="left">✅ 全平台免费</td><td align="left">⚠️ 高级功能需付费</td><td align="left">⚠️ 高级功能需付费</td><td align="left">✅ 免费</td></tr><tr><td align="left"><strong>社区功能</strong></td><td align="left">✅ 列表分享、集合探索</td><td align="left">❌ 无</td><td align="left">❌ 无</td><td align="left">❌ 无</td></tr><tr><td align="left"><strong>界面设计</strong></td><td align="left">✅ 现代化、简洁</td><td align="left">⚠️ 功能丰富但复杂</td><td align="left">⚠️ 功能丰富但复杂</td><td align="left">✅ 简洁</td></tr><tr><td align="left"><strong>本地部署</strong></td><td align="left">✅ 可自托管</td><td align="left">❌ 仅云端</td><td align="left">❌ 仅云端</td><td align="left">❌ 仅云端</td></tr><tr><td align="left"><strong>价格</strong></td><td align="left">✅ 完全免费</td><td align="left">⚠️ 基础免费，高级付费</td><td align="left">⚠️ 基础免费，高级付费</td><td align="left">✅ 免费</td></tr></tbody></table>
<p><strong>为什么选择 Folo？</strong></p>
<ul>
<li>🆓 <strong>完全免费</strong>：所有功能免费使用，无订阅费用</li>
<li>🔓 <strong>开源透明</strong>：代码完全开源，可审查、可定制</li>
<li>🤖 <strong>AI 增强</strong>：内置 AI 功能，提升阅读效率</li>
<li>🌐 <strong>全平台</strong>：一个账户，所有设备同步</li>
<li>👥 <strong>社区驱动</strong>：通过社区发现和分享优质内容</li>
<li>🎨 <strong>现代设计</strong>：简洁美观，专注阅读体验</li>
<li>🔒 <strong>隐私保护</strong>：可自托管，数据完全掌控</li>
</ul>
<hr/>
<h2 data-id="heading-15">项目详细剖析</h2>
<h3 data-id="heading-16">架构设计</h3>
<p>Folo 采用 <strong>Monorepo 架构</strong>，使用 pnpm workspaces 和 Turbo 进行管理，实现了代码的高度复用和统一维护。</p>
<h4 data-id="heading-17">Monorepo 结构</h4>
<pre><code class="hljs language-csharp" lang="csharp">Folo/
├── apps/
│   ├── ssr/              <span class="hljs-meta"># 服务端渲染应用（Hono + React）</span>
│   ├── desktop/           <span class="hljs-meta"># Electron 桌面应用</span>
│   └── mobile/            <span class="hljs-meta"># React Native 移动应用（Expo）</span>
├── packages/
│   └── <span class="hljs-keyword">internal</span>/          <span class="hljs-meta"># 核心逻辑复用库</span>
│       ├── 状态管理
│       ├── 数据库层（Drizzle ORM）
│       ├── UI 组件库
│       └── 业务逻辑
├── api/                   <span class="hljs-meta"># API 服务层</span>
├── plugins/               <span class="hljs-meta"># 插件系统</span>
└── scripts/               <span class="hljs-meta"># 构建和部署脚本</span>
</code></pre>
<h4 data-id="heading-18">核心架构特点</h4>
<p><strong>1. 代码复用最大化</strong></p>
<ul>
<li><code>packages/internal</code> 包含所有可复用的核心逻辑</li>
<li>Web、桌面、移动端共享相同的业务逻辑和状态管理</li>
<li>UI 组件库统一，保证跨平台体验一致</li>
</ul>
<p><strong>2. 多端统一体验</strong></p>
<ul>
<li><strong>Web 端</strong>：基于 Hono 的 SSR 应用，支持服务端渲染和客户端交互</li>
<li><strong>桌面端</strong>：基于 Electron，复用 Web 代码，提供原生体验</li>
<li><strong>移动端</strong>：基于 React Native（Expo），共享业务逻辑，原生 UI 组件</li>
</ul>
<p><strong>3. 技术栈选择</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 前端技术栈</span>
- <span class="hljs-title class_">React</span> <span class="hljs-number">18</span>+：<span class="hljs-variable constant_">UI</span> 框架
- <span class="hljs-title class_">TypeScript</span>：类型安全
- <span class="hljs-title class_">Tailwind</span> <span class="hljs-variable constant_">CSS</span>：样式方案
- <span class="hljs-title class_">Drizzle</span> <span class="hljs-variable constant_">ORM</span>：数据库操作
- <span class="hljs-title class_">Hono</span>：轻量级 <span class="hljs-title class_">Web</span> 框架

<span class="hljs-comment">// 移动端</span>
- <span class="hljs-title class_">React</span> <span class="hljs-title class_">Native</span>（<span class="hljs-title class_">Expo</span>）：跨平台移动开发
- 原生模块：iOS（<span class="hljs-title class_">Swift</span>）、<span class="hljs-title class_">Android</span>（<span class="hljs-title class_">Kotlin</span>）

<span class="hljs-comment">// 桌面端</span>
- <span class="hljs-title class_">Electron</span>：跨平台桌面应用
- 原生集成：系统通知、快捷键等
</code></pre>
<h3 data-id="heading-19">核心模块</h3>
<h4 data-id="heading-20">1. 订阅源管理模块</h4>
<p><strong>功能</strong>：</p>
<ul>
<li>RSS/Atom 订阅源的添加、验证、更新</li>
<li>订阅源的分类和文件夹管理</li>
<li>订阅源的导入导出（OPML）</li>
</ul>
<p><strong>技术实现</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 订阅源验证</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">validateFeed</span>(<span class="hljs-params">url: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);
    <span class="hljs-keyword">const</span> xml = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">text</span>();
    <span class="hljs-keyword">const</span> feed = <span class="hljs-title function_">parseRSS</span>(xml);
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">valid</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">title</span>: feed.<span class="hljs-property">title</span>,
      <span class="hljs-attr">description</span>: feed.<span class="hljs-property">description</span>,
      <span class="hljs-attr">items</span>: feed.<span class="hljs-property">items</span>
    };
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">valid</span>: <span class="hljs-literal">false</span>, error };
  }
}

<span class="hljs-comment">// 订阅源更新</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateFeed</span>(<span class="hljs-params">feedId: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> feed = <span class="hljs-keyword">await</span> db.<span class="hljs-property">feeds</span>.<span class="hljs-title function_">findById</span>(feedId);
  <span class="hljs-keyword">const</span> newItems = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchFeedItems</span>(feed.<span class="hljs-property">url</span>);
  <span class="hljs-keyword">const</span> unreadItems = <span class="hljs-title function_">filterUnreadItems</span>(newItems, feed.<span class="hljs-property">lastUpdate</span>);
  <span class="hljs-keyword">await</span> db.<span class="hljs-property">items</span>.<span class="hljs-title function_">bulkInsert</span>(unreadItems);
  <span class="hljs-keyword">await</span> db.<span class="hljs-property">feeds</span>.<span class="hljs-title function_">updateLastUpdate</span>(feedId);
}
</code></pre>
<h4 data-id="heading-21">2. 时间线聚合模块</h4>
<p><strong>功能</strong>：</p>
<ul>
<li>将所有订阅源的内容按时间聚合</li>
<li>支持过滤、搜索、排序</li>
<li>实时更新新内容</li>
</ul>
<p><strong>技术实现</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 时间线生成</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateTimeline</span>(<span class="hljs-params">filters: TimelineFilters</span>) {
  <span class="hljs-keyword">const</span> feeds = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getSubscribedFeeds</span>(filters.<span class="hljs-property">folderId</span>);
  <span class="hljs-keyword">const</span> items = <span class="hljs-keyword">await</span> db.<span class="hljs-property">items</span>.<span class="hljs-title function_">findByFeeds</span>(feeds, {
    <span class="hljs-attr">unreadOnly</span>: filters.<span class="hljs-property">unreadOnly</span>,
    <span class="hljs-attr">dateRange</span>: filters.<span class="hljs-property">dateRange</span>,
    <span class="hljs-attr">search</span>: filters.<span class="hljs-property">search</span>
  });
  
  <span class="hljs-keyword">return</span> items
    .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b.<span class="hljs-property">publishedAt</span> - a.<span class="hljs-property">publishedAt</span>)
    .<span class="hljs-title function_">slice</span>(filters.<span class="hljs-property">offset</span>, filters.<span class="hljs-property">offset</span> + filters.<span class="hljs-property">limit</span>);
}
</code></pre>
<h4 data-id="heading-22">3. AI 功能模块</h4>
<p><strong>功能</strong>：</p>
<ul>
<li>文章摘要生成</li>
<li>多语言翻译</li>
<li>智能推荐</li>
<li>内容理解</li>
</ul>
<p><strong>技术实现</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// AI 摘要生成</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateSummary</span>(<span class="hljs-params">articleId: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> article = <span class="hljs-keyword">await</span> db.<span class="hljs-property">items</span>.<span class="hljs-title function_">findById</span>(articleId);
  <span class="hljs-keyword">const</span> content = <span class="hljs-title function_">extractTextContent</span>(article.<span class="hljs-property">content</span>);
  
  <span class="hljs-comment">// 调用 AI API（如 OpenAI、Claude 等）</span>
  <span class="hljs-keyword">const</span> summary = <span class="hljs-keyword">await</span> aiService.<span class="hljs-title function_">summarize</span>({
    <span class="hljs-attr">text</span>: content,
    <span class="hljs-attr">maxLength</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">language</span>: <span class="hljs-string">'zh-CN'</span>
  });
  
  <span class="hljs-keyword">await</span> db.<span class="hljs-property">summaries</span>.<span class="hljs-title function_">save</span>(articleId, summary);
  <span class="hljs-keyword">return</span> summary;
}

<span class="hljs-comment">// 多语言翻译</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">translateContent</span>(<span class="hljs-params">
  articleId: <span class="hljs-built_in">string</span>, 
  targetLanguage: <span class="hljs-built_in">string</span>
</span>) {
  <span class="hljs-keyword">const</span> article = <span class="hljs-keyword">await</span> db.<span class="hljs-property">items</span>.<span class="hljs-title function_">findById</span>(articleId);
  <span class="hljs-keyword">const</span> translated = <span class="hljs-keyword">await</span> aiService.<span class="hljs-title function_">translate</span>({
    <span class="hljs-attr">text</span>: article.<span class="hljs-property">content</span>,
    <span class="hljs-attr">from</span>: article.<span class="hljs-property">language</span>,
    <span class="hljs-attr">to</span>: targetLanguage
  });
  
  <span class="hljs-keyword">return</span> translated;
}
</code></pre>
<h4 data-id="heading-23">4. 同步模块</h4>
<p><strong>功能</strong>：</p>
<ul>
<li>多端数据同步</li>
<li>阅读进度同步</li>
<li>收藏和标记状态同步</li>
<li>离线数据管理</li>
</ul>
<p><strong>技术实现</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 同步服务</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SyncService</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">syncToServer</span>(<span class="hljs-params">localChanges: LocalChanges</span>) {
    <span class="hljs-comment">// 上传本地变更</span>
    <span class="hljs-keyword">await</span> api.<span class="hljs-property">sync</span>.<span class="hljs-title function_">upload</span>(localChanges);
    
    <span class="hljs-comment">// 获取服务器变更</span>
    <span class="hljs-keyword">const</span> serverChanges = <span class="hljs-keyword">await</span> api.<span class="hljs-property">sync</span>.<span class="hljs-title function_">download</span>({
      <span class="hljs-attr">lastSyncTime</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastSyncTime</span>
    });
    
    <span class="hljs-comment">// 合并变更</span>
    <span class="hljs-keyword">const</span> merged = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">mergeChanges</span>(localChanges, serverChanges);
    
    <span class="hljs-comment">// 应用合并结果</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyChanges</span>(merged);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastSyncTime</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  }
  
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">mergeChanges</span>(<span class="hljs-params">local: LocalChanges, server: ServerChanges</span>) {
    <span class="hljs-comment">// 冲突解决策略</span>
    <span class="hljs-comment">// 1. 时间戳优先</span>
    <span class="hljs-comment">// 2. 用户操作优先</span>
    <span class="hljs-comment">// 3. 智能合并</span>
    <span class="hljs-keyword">return</span> conflictResolver.<span class="hljs-title function_">merge</span>(local, server);
  }
}
</code></pre>
<h4 data-id="heading-24">5. 列表和集合模块</h4>
<p><strong>功能</strong>：</p>
<ul>
<li>用户创建和管理个人列表</li>
<li>列表分享功能</li>
<li>社区集合浏览</li>
<li>内容发现和推荐</li>
</ul>
<p><strong>技术实现</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 列表管理</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ListService</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">createList</span>(<span class="hljs-params">userId: <span class="hljs-built_in">string</span>, listData: ListData</span>) {
    <span class="hljs-keyword">const</span> list = <span class="hljs-keyword">await</span> db.<span class="hljs-property">lists</span>.<span class="hljs-title function_">create</span>({
      ...listData,
      userId,
      <span class="hljs-attr">public</span>: listData.<span class="hljs-property">isPublic</span>
    });
    
    <span class="hljs-keyword">if</span> (listData.<span class="hljs-property">isPublic</span>) {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">indexListForDiscovery</span>(list);
    }
    
    <span class="hljs-keyword">return</span> list;
  }
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">shareList</span>(<span class="hljs-params">listId: <span class="hljs-built_in">string</span>, shareOptions: ShareOptions</span>) {
    <span class="hljs-keyword">const</span> list = <span class="hljs-keyword">await</span> db.<span class="hljs-property">lists</span>.<span class="hljs-title function_">findById</span>(listId);
    <span class="hljs-keyword">const</span> shareLink = <span class="hljs-title function_">generateShareLink</span>(listId, shareOptions);
    
    <span class="hljs-keyword">if</span> (shareOptions.<span class="hljs-property">toCommunity</span>) {
      <span class="hljs-keyword">await</span> db.<span class="hljs-property">communityCollections</span>.<span class="hljs-title function_">add</span>(list);
    }
    
    <span class="hljs-keyword">return</span> shareLink;
  }
}
</code></pre>
<h3 data-id="heading-25">关键技术实现</h3>
<h4 data-id="heading-26">1. 多端代码复用</h4>
<p>Folo 通过 Monorepo 和共享包实现了最大化的代码复用：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/internal/src/feed-manager.ts</span>
<span class="hljs-comment">// 所有平台共享的订阅源管理逻辑</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FeedManager</span> {
  <span class="hljs-comment">// 业务逻辑，不依赖平台</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">addFeed</span>(<span class="hljs-params">url: <span class="hljs-built_in">string</span></span>) { <span class="hljs-comment">/* ... */</span> }
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">updateFeed</span>(<span class="hljs-params">feedId: <span class="hljs-built_in">string</span></span>) { <span class="hljs-comment">/* ... */</span> }
}

<span class="hljs-comment">// apps/ssr/src/routes/feeds.ts</span>
<span class="hljs-comment">// Web 端使用</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">FeedManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@folo/internal'</span>;

<span class="hljs-comment">// apps/desktop/src/main/feed-handler.ts</span>
<span class="hljs-comment">// 桌面端使用</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">FeedManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@folo/internal'</span>;

<span class="hljs-comment">// apps/mobile/src/services/feed-service.ts</span>
<span class="hljs-comment">// 移动端使用</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">FeedManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@folo/internal'</span>;
</code></pre>
<h4 data-id="heading-27">2. 状态管理</h4>
<p>使用统一的状态管理方案（可能是 Zustand、Jotai 或 Redux）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/internal/src/store/feed-store.ts</span>
<span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'zustand'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">FeedState</span> {
  <span class="hljs-attr">feeds</span>: <span class="hljs-title class_">Feed</span>[];
  <span class="hljs-attr">selectedFeed</span>: <span class="hljs-title class_">Feed</span> | <span class="hljs-literal">null</span>;
  <span class="hljs-attr">addFeed</span>: <span class="hljs-function">(<span class="hljs-params">feed: Feed</span>) =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">selectFeed</span>: <span class="hljs-function">(<span class="hljs-params">feedId: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useFeedStore = create&lt;<span class="hljs-title class_">FeedState</span>&gt;(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">feeds</span>: [],
  <span class="hljs-attr">selectedFeed</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">addFeed</span>: <span class="hljs-function">(<span class="hljs-params">feed</span>) =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ 
    <span class="hljs-attr">feeds</span>: [...state.<span class="hljs-property">feeds</span>, feed] 
  })),
  <span class="hljs-attr">selectFeed</span>: <span class="hljs-function">(<span class="hljs-params">feedId</span>) =&gt;</span> <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({
    <span class="hljs-attr">selectedFeed</span>: state.<span class="hljs-property">feeds</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f.<span class="hljs-property">id</span> === feedId) || <span class="hljs-literal">null</span>
  }))
}));
</code></pre>
<h4 data-id="heading-28">3. 数据库设计</h4>
<p>使用 Drizzle ORM 进行类型安全的数据库操作：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/internal/src/db/schema.ts</span>
<span class="hljs-keyword">import</span> { pgTable, text, timestamp, <span class="hljs-built_in">boolean</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'drizzle-orm/pg-core'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> feeds = <span class="hljs-title function_">pgTable</span>(<span class="hljs-string">'feeds'</span>, {
  <span class="hljs-attr">id</span>: <span class="hljs-title function_">text</span>(<span class="hljs-string">'id'</span>).<span class="hljs-title function_">primaryKey</span>(),
  <span class="hljs-attr">url</span>: <span class="hljs-title function_">text</span>(<span class="hljs-string">'url'</span>).<span class="hljs-title function_">notNull</span>(),
  <span class="hljs-attr">title</span>: <span class="hljs-title function_">text</span>(<span class="hljs-string">'title'</span>).<span class="hljs-title function_">notNull</span>(),
  <span class="hljs-attr">description</span>: <span class="hljs-title function_">text</span>(<span class="hljs-string">'description'</span>),
  <span class="hljs-attr">lastUpdate</span>: <span class="hljs-title function_">timestamp</span>(<span class="hljs-string">'last_update'</span>),
  <span class="hljs-attr">folderId</span>: <span class="hljs-title function_">text</span>(<span class="hljs-string">'folder_id'</span>)
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> items = <span class="hljs-title function_">pgTable</span>(<span class="hljs-string">'items'</span>, {
  <span class="hljs-attr">id</span>: <span class="hljs-title function_">text</span>(<span class="hljs-string">'id'</span>).<span class="hljs-title function_">primaryKey</span>(),
  <span class="hljs-attr">feedId</span>: <span class="hljs-title function_">text</span>(<span class="hljs-string">'feed_id'</span>).<span class="hljs-title function_">references</span>(<span class="hljs-function">() =&gt;</span> feeds.<span class="hljs-property">id</span>),
  <span class="hljs-attr">title</span>: <span class="hljs-title function_">text</span>(<span class="hljs-string">'title'</span>).<span class="hljs-title function_">notNull</span>(),
  <span class="hljs-attr">content</span>: <span class="hljs-title function_">text</span>(<span class="hljs-string">'content'</span>),
  <span class="hljs-attr">link</span>: <span class="hljs-title function_">text</span>(<span class="hljs-string">'link'</span>).<span class="hljs-title function_">notNull</span>(),
  <span class="hljs-attr">publishedAt</span>: <span class="hljs-title function_">timestamp</span>(<span class="hljs-string">'published_at'</span>).<span class="hljs-title function_">notNull</span>(),
  <span class="hljs-attr">read</span>: <span class="hljs-title function_">boolean</span>(<span class="hljs-string">'read'</span>).<span class="hljs-title function_">default</span>(<span class="hljs-literal">false</span>),
  <span class="hljs-attr">starred</span>: <span class="hljs-title function_">boolean</span>(<span class="hljs-string">'starred'</span>).<span class="hljs-title function_">default</span>(<span class="hljs-literal">false</span>)
});
</code></pre>
<h4 data-id="heading-29">4. AI 集成</h4>
<p>统一的 AI 服务接口，支持多种 AI 提供商：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/internal/src/ai/ai-service.ts</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">AIService</span> {
  <span class="hljs-title function_">summarize</span>(<span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">options</span>: <span class="hljs-title class_">SummaryOptions</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;;
  <span class="hljs-title function_">translate</span>(<span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">options</span>: <span class="hljs-title class_">TranslateOptions</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;;
  <span class="hljs-title function_">recommend</span>(<span class="hljs-attr">userId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Item</span>[]&gt;;
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">OpenAIAdapter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AIService</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">summarize</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span>, options: SummaryOptions</span>) {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> openai.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
      <span class="hljs-attr">model</span>: <span class="hljs-string">'gpt-4'</span>,
      <span class="hljs-attr">messages</span>: [{
        <span class="hljs-attr">role</span>: <span class="hljs-string">'system'</span>,
        <span class="hljs-attr">content</span>: <span class="hljs-string">'你是一个专业的文章摘要生成器...'</span>
      }, {
        <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>,
        <span class="hljs-attr">content</span>: text
      }]
    });
    <span class="hljs-keyword">return</span> response.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>].<span class="hljs-property">message</span>.<span class="hljs-property">content</span>;
  }
}
</code></pre>
<h3 data-id="heading-30">扩展机制</h3>
<h4 data-id="heading-31">插件系统</h4>
<p>Folo 支持插件扩展（如果已实现）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 插件接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">FoloPlugin</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">version</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-title function_">init</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">PluginContext</span>): <span class="hljs-built_in">void</span>;
  onFeedUpdate?(<span class="hljs-attr">feed</span>: <span class="hljs-title class_">Feed</span>): <span class="hljs-built_in">void</span>;
  onItemRead?(<span class="hljs-attr">item</span>: <span class="hljs-title class_">Item</span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 插件示例：自动标签</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AutoTagPlugin</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FoloPlugin</span> {
  name = <span class="hljs-string">'auto-tag'</span>;
  version = <span class="hljs-string">'1.0.0'</span>;
  
  <span class="hljs-title function_">init</span>(<span class="hljs-params">context: PluginContext</span>) {
    context.<span class="hljs-title function_">onItemRead</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> tags = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">extractTags</span>(item);
      context.<span class="hljs-title function_">addTags</span>(item.<span class="hljs-property">id</span>, tags);
    });
  }
  
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">extractTags</span>(<span class="hljs-attr">item</span>: <span class="hljs-title class_">Item</span>): <span class="hljs-built_in">string</span>[] {
    <span class="hljs-comment">// 使用 AI 或规则提取标签</span>
    <span class="hljs-keyword">return</span> [];
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-32">项目地址与资源</h2>
<h3 data-id="heading-33">官方资源</h3>
<ul>
<li>🌟 <strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FRSSNext%2FFolo" target="_blank" title="https://github.com/RSSNext/Folo" ref="nofollow noopener noreferrer">github.com/RSSNext/Fol…</a></li>
<li>🌐 <strong>官网</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fapp.folo.is" target="_blank" title="https://app.folo.is" ref="nofollow noopener noreferrer">app.folo.is</a></li>
<li>📱 <strong>iOS App Store</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fus%2Fapp%2Ffolo-follow-everything%2Fid6739802604" target="_blank" title="https://apps.apple.com/us/app/folo-follow-everything/id6739802604" ref="nofollow noopener noreferrer">apps.apple.com/us/app/folo…</a></li>
<li>🤖 <strong>Android Google Play</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.google.com%2Fstore%2Fapps%2Fdetails%3Fid%3Dis.follow" target="_blank" title="https://play.google.com/store/apps/details?id=is.follow" ref="nofollow noopener noreferrer">play.google.com/store/apps/…</a></li>
<li>🪟 <strong>Windows Microsoft Store</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.microsoft.com%2Fdetail%2F9nvfzpv0v0ht" target="_blank" title="https://apps.microsoft.com/detail/9nvfzpv0v0ht" ref="nofollow noopener noreferrer">apps.microsoft.com/detail/9nvf…</a></li>
</ul>
<h3 data-id="heading-34">同类项目对比</h3>
<p>如果你想了解更多 RSS 阅读器和信息聚合工具：</p>
<ul>
<li><strong>Feedly</strong>：商业 RSS 阅读器，功能丰富但需付费</li>
<li><strong>Inoreader</strong>：老牌 RSS 阅读器，功能强大</li>
<li><strong>NetNewsWire</strong>：macOS/iOS 开源 RSS 阅读器</li>
<li><strong>FreshRSS</strong>：可自托管的 RSS 阅读器</li>
<li><strong>Miniflux</strong>：极简的 RSS 阅读器，可自托管</li>
</ul>
<h3 data-id="heading-35">适用人群</h3>
<p>Folo 适合以下开发者：</p>
<ul>
<li><strong>前端开发者</strong>：学习 Monorepo 架构、多端代码复用、React 生态</li>
<li><strong>全栈开发者</strong>：了解 SSR、API 设计、数据库操作</li>
<li><strong>移动开发者</strong>：学习 React Native、跨平台开发</li>
<li><strong>产品设计师</strong>：了解信息聚合产品的设计思路</li>
<li><strong>开源贡献者</strong>：参与大型开源项目的开发和维护</li>
<li><strong>RSS 阅读器用户</strong>：寻找现代化、AI 增强的阅读工具</li>
</ul>
<p><strong>学习价值</strong>：</p>
<ul>
<li>✅ Monorepo 架构设计和实践</li>
<li>✅ 多端代码复用策略</li>
<li>✅ AI 功能集成和实现</li>
<li>✅ 实时同步和冲突解决</li>
<li>✅ 现代化前端技术栈</li>
<li>✅ 开源项目协作和社区建设</li>
</ul>
<hr/>
<p><em>欢迎来我中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">个人主页</a>找到更多有用的知识和有趣的产品</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Code OAuth 403 错误解决方案]]></title>    <link>https://juejin.cn/post/7604769326223769636</link>    <guid>https://juejin.cn/post/7604769326223769636</guid>    <pubDate>2026-02-10T06:13:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604769326223769636" data-draft-id="7604757482004217919" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Code OAuth 403 错误解决方案"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2026-02-10T06:13:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="云舟吖"/> <meta itemprop="url" content="https://juejin.cn/user/360295546233959"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Code OAuth 403 错误解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/360295546233959/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    云舟吖
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T06:13:24.000Z" title="Tue Feb 10 2026 06:13:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    37
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">📢 重要说明</h2>
<p><strong>本文档专门解决 OAuth 403 认证错误。</strong> 如果您是第一次使用 Claude Code，建议先阅读：</p>
<p>👉 <strong><a href="https://juejin.cn/spost/7604853010163138623" target="_blank" title="https://juejin.cn/spost/7604853010163138623">Claude Code macOS 通用安装指南</a></strong></p>
<hr/>
<h3 data-id="heading-1">本文档适用场景</h3>
<p><strong>✅ 适用：</strong></p>
<ul>
<li>企业内网环境（需要配置公司代理服务器）</li>
<li>教育机构网络</li>
<li>需要通过 HTTP 代理访问互联网</li>
<li>遇到 <code>OAuth error: Failed to fetch user roles: 403</code> 错误</li>
<li>遇到 <code>OAuth error: connect ECONNREFUSED</code> 错误</li>
</ul>
<p><strong>❌ 不适用：</strong></p>
<ul>
<li>首次安装和基础使用 → 请看<a href="https://juejin.cn/spost/7604853010163138623" target="_blank" title="https://juejin.cn/spost/7604853010163138623">通用安装指南</a></li>
<li>普通家庭网络环境 → 请看<a href="https://juejin.cn/spost/7604853010163138623" target="_blank" title="https://juejin.cn/spost/7604853010163138623">通用安装指南</a></li>
</ul>
<hr/>
<h2 data-id="heading-2">问题诊断</h2>
<h3 data-id="heading-3">典型错误信息</h3>
<p>如果您在登录时看到以下错误之一：</p>
<pre><code class="hljs language-vbscript" lang="vbscript">OAuth <span class="hljs-keyword">error</span>: Failed <span class="hljs-keyword">to</span> fetch user roles: <span class="hljs-built_in">Request</span> failed <span class="hljs-keyword">with</span> status code <span class="hljs-number">403</span>
</code></pre>
<p>或</p>
<pre><code class="hljs language-arduino" lang="arduino">OAuth error: connect ECONNREFUSED <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:PORT
</code></pre>
<p>这通常是网络代理配置问题。</p>
<h3 data-id="heading-4">根本原因</h3>
<p>Claude Code 使用 OAuth 进行身份认证，需要访问 <code>api.anthropic.com</code>。在企业或教育网络中，通常需要通过 HTTP 代理服务器访问外部网络。</p>
<p><strong>关键信息：</strong> Claude Code 仅支持 <strong>HTTP/HTTPS 代理</strong>，不支持 <strong>SOCKS 代理</strong>。</p>
<h3 data-id="heading-5">快速自检</h3>
<p>在终端运行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查系统代理配置</span>
scutil --proxy

<span class="hljs-comment"># 2. 测试网络连通性</span>
curl -I https://api.anthropic.com
</code></pre>
<p>如果第二个命令失败，说明网络配置有问题。</p>
<hr/>
<h2 data-id="heading-6">解决方案</h2>
<h3 data-id="heading-7">第一步：检查网络配置</h3>
<h4 data-id="heading-8">1.1 查看系统代理设置</h4>
<pre><code class="hljs language-css" lang="css">scutil <span class="hljs-attr">--proxy</span>
</code></pre>
<p><strong>输出示例：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">&lt;dictionary&gt;</span> {
  <span class="hljs-attr">HTTPEnable :</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">HTTPPort :</span> <span class="hljs-number">7890</span>
  <span class="hljs-attr">HTTPProxy :</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
  <span class="hljs-attr">HTTPSEnable :</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">HTTPSPort :</span> <span class="hljs-number">7890</span>
  <span class="hljs-attr">HTTPSProxy :</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
}
</code></pre>
<p><strong>重点关注：</strong></p>
<ul>
<li><code>HTTPPort</code> - HTTP 代理端口（例如：7890）</li>
<li><code>HTTPProxy</code> - 代理服务器地址（通常是 127.0.0.1）</li>
</ul>
<blockquote>
<p>💡 记下这个端口号，下一步会用到。</p>
</blockquote>
<h4 data-id="heading-9">1.2 测试代理连通性</h4>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 测试代理是否工作（替换 7890 为您的实际端口）</span>
curl -<span class="hljs-keyword">x</span> http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0</span>.<span class="hljs-number">1</span>:<span class="hljs-number">7890</span> -I https:<span class="hljs-regexp">//api</span>.anthropic.com
</code></pre>
<p>如果看到 <code>HTTP/2 200</code>，说明代理配置正确。</p>
<hr/>
<h3 data-id="heading-10">第二步：配置 CLI 环境</h3>
<h4 data-id="heading-11">2.1 清理旧配置</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 清除环境变量</span>
<span class="hljs-built_in">unset</span> HTTP_PROXY
<span class="hljs-built_in">unset</span> HTTPS_PROXY
<span class="hljs-built_in">unset</span> http_proxy
<span class="hljs-built_in">unset</span> https_proxy

<span class="hljs-comment"># 删除旧凭证</span>
<span class="hljs-built_in">rm</span> -rf ~/.anthropic
</code></pre>
<h4 data-id="heading-12">2.2 设置代理环境变量</h4>
<blockquote>
<p>⚠️ <strong>重要：</strong> 将下面的 <code>7890</code> 替换为您在第一步中找到的实际端口号。</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini">export <span class="hljs-attr">HTTP_PROXY</span>=<span class="hljs-string">"http://127.0.0.1:7890"</span>
export <span class="hljs-attr">HTTPS_PROXY</span>=<span class="hljs-string">"http://127.0.0.1:7890"</span>
export <span class="hljs-attr">NO_PROXY</span>=<span class="hljs-string">"localhost,127.0.0.1"</span>
</code></pre>
<h4 data-id="heading-13">2.3 验证配置</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 验证环境变量</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$HTTP_PROXY</span>

<span class="hljs-comment"># 测试连接</span>
curl -I https://api.anthropic.com
</code></pre>
<p>应该看到 <code>HTTP/2 200</code> 响应。</p>
<h4 data-id="heading-14">2.4 重新登录</h4>
<pre><code class="hljs language-bash" lang="bash">claude /login
</code></pre>
<p>浏览器会打开，完成登录流程。</p>
<hr/>
<h3 data-id="heading-15">第三步：配置 VS Code</h3>
<p>VS Code 扩展需要单独配置代理环境变量。</p>
<h4 data-id="heading-16">3.1 清理 VS Code 扩展</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除旧扩展</span>
<span class="hljs-built_in">rm</span> -rf ~/.vscode/extensions/anthropic.claude-code*

<span class="hljs-comment"># 清除缓存</span>
<span class="hljs-built_in">rm</span> -rf ~/Library/Application\ Support/Code/CachedData
<span class="hljs-built_in">rm</span> -rf ~/Library/Application\ Support/Code/CachedExtensionVSIXs
</code></pre>
<p>在 VS Code 中卸载 Claude Code 扩展，然后完全退出（<code>Cmd+Q</code>）。</p>
<h4 data-id="heading-17">3.2 配置代理</h4>
<ol>
<li>重新打开 VS Code</li>
<li>按 <code>Cmd+Shift+P</code></li>
<li>输入：<code>Preferences: Open User Settings (JSON)</code></li>
<li>添加以下配置：</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"claudeCode.environmentVariables"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"HTTP_PROXY"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://127.0.0.1:7890"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"HTTPS_PROXY"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://127.0.0.1:7890"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"NO_PROXY"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"localhost,127.0.0.1"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<blockquote>
<p>⚠️ 记得替换 <code>7890</code> 为您的实际端口。</p>
</blockquote>
<h4 data-id="heading-18">3.3 重新安装扩展</h4>
<ol>
<li>保存 <code>settings.json</code></li>
<li>按 <code>Cmd+Q</code> 完全退出 VS Code</li>
<li>重新打开 VS Code</li>
<li>安装 Claude Code 扩展</li>
<li>点击左侧 Claude 图标，应该可以直接使用</li>
</ol>
<hr/>
<h3 data-id="heading-19">第四步：永久配置</h3>
<p>避免每次打开终端都要重新设置环境变量。</p>
<h4 data-id="heading-20">4.1 添加到 Shell 配置文件</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 添加到 ~/.zshrc（macOS 默认 shell）</span>
<span class="hljs-built_in">cat</span> &gt;&gt; ~/.zshrc &lt;&lt; <span class="hljs-string">'EOF'</span>

<span class="hljs-comment"># Claude Code 代理配置</span>
<span class="hljs-built_in">export</span> HTTP_PROXY=<span class="hljs-string">"http://127.0.0.1:7890"</span>
<span class="hljs-built_in">export</span> HTTPS_PROXY=<span class="hljs-string">"http://127.0.0.1:7890"</span>
<span class="hljs-built_in">export</span> NO_PROXY=<span class="hljs-string">"localhost,127.0.0.1"</span>
EOF
</code></pre>
<p>如果使用 bash：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> &gt;&gt; ~/.bash_profile &lt;&lt; <span class="hljs-string">'EOF'</span>

<span class="hljs-comment"># Claude Code 代理配置</span>
<span class="hljs-built_in">export</span> HTTP_PROXY=<span class="hljs-string">"http://127.0.0.1:7890"</span>
<span class="hljs-built_in">export</span> HTTPS_PROXY=<span class="hljs-string">"http://127.0.0.1:7890"</span>
<span class="hljs-built_in">export</span> NO_PROXY=<span class="hljs-string">"localhost,127.0.0.1"</span>
EOF
</code></pre>
<blockquote>
<p>⚠️ 记得替换端口号。</p>
</blockquote>
<h4 data-id="heading-21">4.2 重新加载配置</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># zsh</span>
<span class="hljs-built_in">source</span> ~/.zshrc

<span class="hljs-comment"># bash</span>
<span class="hljs-built_in">source</span> ~/.bash_profile
</code></pre>
<h4 data-id="heading-22">4.3 验证永久配置</h4>
<p>打开<strong>新的终端窗口</strong>，运行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$HTTP_PROXY</span>
</code></pre>
<p>应该显示：<code>http://127.0.0.1:7890</code></p>
<hr/>
<h2 data-id="heading-23">常见代理工具配置</h2>
<p>不同的代理工具有不同的默认端口，这里列出常见工具的配置方法。</p>
<h3 data-id="heading-24">Clash / ClashX</h3>
<p><strong>默认端口：</strong> 7890</p>
<p><strong>查看端口：</strong></p>
<ol>
<li>打开 Clash</li>
<li>设置 → 端口设置</li>
<li>查看 "HTTP 端口" 或 "Port"</li>
</ol>
<h3 data-id="heading-25">V2RayU</h3>
<p><strong>默认端口：</strong> 1087</p>
<p><strong>查看端口：</strong></p>
<ol>
<li>打开 V2RayU</li>
<li>偏好设置</li>
<li>查看 "HTTP 监听端口"</li>
</ol>
<h3 data-id="heading-26">Shadowsocks</h3>
<p><strong>默认端口：</strong> 1087 或 8118</p>
<p><strong>查看端口：</strong></p>
<ol>
<li>打开 Shadowsocks</li>
<li>偏好设置</li>
<li>HTTP 代理设置</li>
</ol>
<h3 data-id="heading-27">Surge</h3>
<p><strong>默认端口：</strong> 6152</p>
<p><strong>查看端口：</strong></p>
<ol>
<li>打开 Surge</li>
<li>设置</li>
<li>查看 HTTP Proxy Port</li>
</ol>
<h3 data-id="heading-28">企业代理服务器</h3>
<p>如果使用企业提供的代理服务器：</p>
<ol>
<li>联系 IT 部门获取代理地址和端口</li>
<li>配置格式：<code>http://代理地址:端口</code></li>
<li>例如：<code>http://proxy.company.com:8080</code></li>
</ol>
<hr/>
<h2 data-id="heading-29">故障排除</h2>
<h3 data-id="heading-30">问题 1：ECONNREFUSED 错误</h3>
<p><strong>错误信息：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">OAuth error: connect ECONNREFUSED <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">8118</span>
</code></pre>
<p><strong>原因：</strong> 端口号不正确。</p>
<p><strong>解决方案：</strong></p>
<ol>
<li>运行 <code>scutil --proxy</code> 查找正确端口</li>
<li>更新环境变量中的端口号</li>
<li>重新登录</li>
</ol>
<hr/>
<h3 data-id="heading-31">问题 2：代理工具未运行</h3>
<p><strong>诊断：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查端口是否在监听（替换为您的端口）</span>
lsof -i :7890
</code></pre>
<p><strong>解决方案：</strong></p>
<ol>
<li>启动您的代理工具</li>
<li>确认 HTTP 代理已启用</li>
<li>重新测试连接</li>
</ol>
<hr/>
<h3 data-id="heading-32">问题 3：仍然无法连接</h3>
<p><strong>可能原因：</strong></p>
<ul>
<li>代理工具只启用了 SOCKS 代理，未启用 HTTP 代理</li>
<li>防火墙阻止了连接</li>
<li>代理服务器地址错误</li>
</ul>
<p><strong>解决方案：</strong></p>
<ol>
<li>确认代理工具中 <strong>HTTP 代理</strong> 已启用（不只是 SOCKS）</li>
<li>检查防火墙设置</li>
<li>如果使用企业代理，联系 IT 部门确认配置</li>
</ol>
<hr/>
<h3 data-id="heading-33">问题 4：网络环境切换</h3>
<p><strong>场景：</strong> 在公司和家里使用不同网络。</p>
<p><strong>解决方案：</strong> 创建快速切换函数</p>
<p>添加到 <code>~/.zshrc</code>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启用代理</span>
<span class="hljs-function"><span class="hljs-title">proxy_on</span></span>() {
  <span class="hljs-built_in">export</span> HTTP_PROXY=<span class="hljs-string">"http://127.0.0.1:7890"</span>
  <span class="hljs-built_in">export</span> HTTPS_PROXY=<span class="hljs-string">"http://127.0.0.1:7890"</span>
  <span class="hljs-built_in">export</span> NO_PROXY=<span class="hljs-string">"localhost,127.0.0.1"</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"✓ Proxy enabled"</span>
}

<span class="hljs-comment"># 禁用代理</span>
<span class="hljs-function"><span class="hljs-title">proxy_off</span></span>() {
  <span class="hljs-built_in">unset</span> HTTP_PROXY HTTPS_PROXY
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"✓ Proxy disabled"</span>
}
</code></pre>
<p>使用：</p>
<pre><code class="hljs language-bash" lang="bash">proxy_on   <span class="hljs-comment"># 在公司网络时</span>
proxy_off  <span class="hljs-comment"># 在家时</span>
</code></pre>
<hr/>
<h2 data-id="heading-34">验证配置</h2>
<h3 data-id="heading-35">CLI 验证</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查环境变量</span>
<span class="hljs-built_in">echo</span> <span class="hljs-variable">$HTTP_PROXY</span>

<span class="hljs-comment"># 2. 测试网络</span>
curl -I https://api.anthropic.com

<span class="hljs-comment"># 3. 测试 Claude Code</span>
claude --version
</code></pre>
<h3 data-id="heading-36">VS Code 验证</h3>
<ol>
<li>打开 VS Code</li>
<li>点击 Claude 图标</li>
<li>发送测试消息</li>
<li>应该正常回复</li>
</ol>
<hr/>
<h2 data-id="heading-37">诊断脚本</h2>
<p>将以下内容保存为 <code>diagnose.sh</code>，快速诊断问题：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Claude Code 网络诊断 ==="</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"1. 系统代理设置："</span>
scutil --proxy | grep -E <span class="hljs-string">"HTTP|HTTPS"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"2. 环境变量："</span>
<span class="hljs-built_in">env</span> | grep -i proxy
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"3. 监听的端口："</span>
<span class="hljs-keyword">for</span> port <span class="hljs-keyword">in</span> 7890 7891 1087 8118 6152; <span class="hljs-keyword">do</span>
  <span class="hljs-keyword">if</span> lsof -i :<span class="hljs-variable">$port</span> 2&gt;/dev/null | grep -q LISTEN; <span class="hljs-keyword">then</span>
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ Port <span class="hljs-variable">$port</span> is active"</span>
  <span class="hljs-keyword">fi</span>
<span class="hljs-keyword">done</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"4. 测试连接："</span>
<span class="hljs-keyword">if</span> curl -s -I https://api.anthropic.com | grep -q <span class="hljs-string">"HTTP/2 200"</span>; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ 可以访问 Anthropic API"</span>
<span class="hljs-keyword">else</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"❌ 无法访问 Anthropic API"</span>
<span class="hljs-keyword">fi</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"5. Claude Code 版本："</span>
claude --version 2&gt;&amp;1
<span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"诊断完成！"</span>
</code></pre>
<p>运行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x diagnose.sh
./diagnose.sh
</code></pre>
<hr/>
<h2 data-id="heading-38">总结</h2>
<h3 data-id="heading-39">核心步骤</h3>
<ol>
<li>✅ 查找 HTTP 代理端口：<code>scutil --proxy</code></li>
<li>✅ 设置环境变量：<code>export HTTP_PROXY=...</code></li>
<li>✅ 配置 VS Code：在 <code>settings.json</code> 中添加配置</li>
<li>✅ 永久配置：写入 <code>~/.zshrc</code></li>
</ol>
<h3 data-id="heading-40">关键点</h3>
<ul>
<li><strong>只支持 HTTP/HTTPS 代理</strong>，不支持 SOCKS</li>
<li><strong>CLI 和 VS Code 需要分别配置</strong></li>
<li><strong>端口号因工具而异</strong>，需要具体查看</li>
</ul>
<hr/>
<h2 data-id="heading-41">参考资源</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs" target="_blank" title="https://code.claude.com/docs" ref="nofollow noopener noreferrer">Claude Code 官方文档</a></li>
<li><a href="https://juejin.cn/post/7604853010163138623" target="_blank" title="https://juejin.cn/post/7604853010163138623">通用安装指南</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-code%2Fissues" target="_blank" title="https://github.com/anthropics/claude-code/issues" ref="nofollow noopener noreferrer">GitHub Issues</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.claude.com%2F" target="_blank" title="https://support.claude.com/" ref="nofollow noopener noreferrer">Anthropic 支持</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[10万人都在用的 top10 skills，我帮你试了]]></title>    <link>https://juejin.cn/post/7604757482005053503</link>    <guid>https://juejin.cn/post/7604757482005053503</guid>    <pubDate>2026-02-10T08:26:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604757482005053503" data-draft-id="7604801893530173483" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="10万人都在用的 top10 skills，我帮你试了"/> <meta itemprop="keywords" content="前端,后端,AI编程"/> <meta itemprop="datePublished" content="2026-02-10T08:26:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员码歌"/> <meta itemprop="url" content="https://juejin.cn/user/764915820529831"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            10万人都在用的 top10 skills，我帮你试了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/764915820529831/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员码歌
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T08:26:13.000Z" title="Tue Feb 10 2026 08:26:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cd54f27d1dc484597bf022e52a0a85e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=C01u3bWMyXaUXkt8RHxVwxztACc%3D" alt="图片" loading="lazy"/></p>
<p><strong>大家好，我是码歌，一个被Skills掏空了的码哥。</strong></p>
<p>最近skills.sh（<a href="https://link.juejin.cn?target=https%3A%2F%2Fskills.sh%2F%25EF%25BC%2589" target="_blank" title="https://skills.sh/%EF%BC%89" ref="nofollow noopener noreferrer">skills.sh/）</a> 上最火的10个Skills，安装量加起来已经超过10万了。我花了几天时间，把这Top 10全装了一遍，挨个测试，结果只能用一句话形容：</p>
<p><strong>有些确实牛逼，有些就是凑数的！但总体来说，跟着社区选不会错，实打实的用户下载安装！</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66ce70796ecf40f981a13f4678db7015~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=Axo8fHENCl9jxUQwCWXvWI%2Bqg7I%3D" alt="图片" loading="lazy"/></p>
<p>关于Skills的前世今生，如果还不熟悉的同学推荐看下我之前的的几篇文章，这里不再展开说明，传送门：<br/>
1、<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3ODQzNDQ3MA%3D%3D%26mid%3D2247484809%26idx%3D1%26sn%3D0ceb0ba04e2fd12a2c6eb3920e4afacb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI3ODQzNDQ3MA==&amp;mid=2247484809&amp;idx=1&amp;sn=0ceb0ba04e2fd12a2c6eb3920e4afacb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">火爆全网的Skills，看这一篇就够了！</a><br/>
2、<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzI3ODQzNDQ3MA%3D%3D%26mid%3D2247484825%26idx%3D1%26sn%3D5965f6a06197b62e78c6df8e713ff5f2%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzI3ODQzNDQ3MA==&amp;mid=2247484825&amp;idx=1&amp;sn=5965f6a06197b62e78c6df8e713ff5f2&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">谁还手动管技能？Vercel 开源 add-skill + skills.sh，一行命令搞定所有</a></p>
<p><strong>注意！注意！注意！</strong><br/>
最新版cursor(mac 2.5.0)默认读取的全局skills目录是 /.cursor/skills-cursor，而skills add安装命令默认为cursor添加的目录是/.cursor/skills，我们只需要手动再次添加下符号链接就行，以后每次安装也会同步到skills-cursor目录，命令如下：<br/>
mac:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> ~/.cursor
<span class="hljs-built_in">ln</span> -s skills skills-cursor
</code></pre>
<p>windows:</p>
<pre><code class="hljs language-arduino" lang="arduino">cd %USERPROFILE%.cursor
rmdir /s /q skills-cursor
mklink /D skills-cursor skills
</code></pre>
<h2 data-id="heading-0">一、为什么Top 10值得关注？  </h2>
<h4 data-id="heading-1">skills.sh上的安装量都是实打实的。几十w+安装不是刷的，是真有这么多人在用（就像B站播放量，虽然可能有水分，但大部分都是真用户）。</h4>
<h4 data-id="heading-2"/>
<p>这些人天天用Claude Code写代码、做产品，他们愿意装，说明确实有用。跟着装就行，不用自己判断"这玩意到底行不行"，社区已经帮你筛过一遍了（群众的眼睛是雪亮的）。</p>
<p>废话不多说，直接上干货。我会把<strong>每个Skill的实际使用效果、适合谁、值不值得装</strong>都告诉你（不画饼，只讲实话）。</p>
<h2 data-id="heading-3">二、Top 10 Skills完整拆解（干货来了）  </h2>
<p>先说个整体情况：Top 10里7个是给开发者的（程序员果然是AI的主力用户），3个对产品、运营、设计师也有用（终于不是程序员专属了）。</p>
<p>我把值得详细说的挑出来讲，其他的列个表就行（重点突出，不浪费大家时间）。</p>
<h5 data-id="heading-4">开发者专用的（7个）（程序员福利）</h5>
<p>这7个都是给写代码的人用的，非开发者可以直接跳到下一节（别看了，看了也看不懂）。</p>





























































<table><thead><tr><th>排名</th><th>Skill</th><th>安装量</th><th>干嘛用的</th><th>值不值得装</th></tr></thead><tbody><tr><td>1</td><td>vercel-react-best-practices</td><td>37600+</td><td>React/Next.js性能优化，57条规则</td><td>⭐⭐⭐⭐⭐ 前端必装</td></tr><tr><td>2</td><td>web-design-guidelines</td><td>28500+</td><td>检查网页是否符合设计规范</td><td>⭐⭐⭐⭐ UI返工多的人必装</td></tr><tr><td>3</td><td>remotion-best-practices</td><td>18800+</td><td>用代码做视频的最佳实践</td><td>⭐⭐⭐ 做视频的才需要</td></tr><tr><td>5</td><td>skill-creator</td><td>3700+</td><td>官方出的，教你怎么创建Skill</td><td>⭐⭐⭐ 想自己做Skill的装</td></tr><tr><td>6</td><td>building-native-ui</td><td>2700+</td><td>Expo手机App开发指南</td><td>⭐⭐⭐ 做移动端的装</td></tr><tr><td>8</td><td>better-auth-best-practices</td><td>2300+</td><td>登录认证系统最佳实践</td><td>⭐⭐⭐⭐ 做登录的必装</td></tr><tr><td>10</td><td>upgrading-expo</td><td>2200+</td><td>Expo框架升级指南</td><td>⭐⭐ 升级时才用</td></tr></tbody></table>
<p><strong>实际测试感受：</strong></p>
<p>1、<strong>vercel-react-best-practices</strong>：这个确实牛逼。我叫他使用这个skills分析下我之前的项目“AI灯塔导航”，它直接指出了几个性能问题：Re-render 优化、事件监听器、1渲染性能等。改完之后性能提升明显。前端开发必装。<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6442dc43f70549fdab1909ff458def1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=nz5PBgGTzyGBso1XG7%2BOM%2FA%2BK58%3D" alt="图片" loading="lazy"/></p>
<p><strong>2、web-design-guidelines</strong>：UI审查很细致（比设计师还严格）。我让cursor用这个skill检查下项目“AI灯塔导航”UI相关问题，它指出了可访问性缺少、语义化HTML问题、焦点管理缺失等不符合规范等10多个问题（就像找了个严格的老师，一点小问题都不放过）。产品经理和设计师协作多的，这个很有用（终于不用再因为设计规范问题吵架了）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5feddef87fcd4698b600d289a4b27ad5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=Ayd2%2FuL2BieZxERcnq7biLcSQKs%3D" alt="图片" loading="lazy"/></p>
<p><strong>3、better-auth-best-practices</strong>：登录认证这块踩坑多（就像过雷区，一不小心就炸），这个Skill把常见问题都覆盖了：密码加密、JWT过期处理、CSRF防护、OAuth流程等（就像给了你一张"避雷地图"）。做登录系统的，装了这个能少踩很多坑（终于不用再因为安全问题被用户投诉了）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccf3e005865e4fbca7fffa1de755a011~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=yiWmoJ1PqWBfsPg74y6BFM%2BpS3g%3D" alt="图片" loading="lazy"/></p>
<h5 data-id="heading-5"/>
<h5 data-id="heading-6">所有人都能用的（3个）⭐（重点来了）</h5>
<p>这3个是我觉得Top 10里最值得说的，不写代码也能用（终于不用再羡慕程序员了）。</p>
<p><strong>1、frontend-design（45.5k +安装）</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/feffe9e82701409d8cd0f3f9ce1b81ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=RP8lMsp5y4wSqmdq4sieQALiTiU%3D" alt="图片" loading="lazy"/></p>
<p>来自Anthropic官方。目标很简单：<strong>让Claude做出来的东西别那么"AI味"</strong> 。</p>
<p>你可能有过这种体验——让Claude帮忙做个网页或PPT，出来的东西能用，但没特色，一眼就知道是AI做的（就像穿了校服，虽然整齐但毫无个性）。这个Skill就是治这个的，专门给AI的设计"整容"。</p>
<p>它明确告诉Claude不要用什么：</p>
<ul>
<li>
<p>不要用Inter、Roboto、Arial这些"标准字体"（太没个性）</p>
</li>
<li>
<p>不要用紫色渐变配白底（AI最爱用，已经烂大街了）</p>
</li>
<li>
<p>不要用对称布局（打破常规才有设计感）</p>
</li>
</ul>
<p>同时告诉Claude应该怎么做：</p>
<ul>
<li>选择有个性的字体</li>
<li>配色要有主次，主色大胆、强调色锐利</li>
<li>动效要克制，一个精心设计的页面加载动画，比到处都在动更高级</li>
</ul>
<p><strong>实际测试：</strong>  我让Claude用这个Skill帮我设计一个部署平台原型，确实比之前有设计感多了。虽然还是能看出是AI做的（毕竟AI的"审美"还是有迹可循），但至少不那么"标准"了，至少从"一眼AI"变成了"需要仔细看才能发现是AI"。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2f6707a20f84d5bbbcd5db49ec82d0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=kdNMShRMMtxrecdUSHUMJYfk2Dw%3D" alt="图片" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e39b24d103d3458e9f6cb46c5282b835~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=spPajKe%2BWLbp%2B0eXR1UpoX1YfIg%3D" alt="图片" loading="lazy"/></p>
<p><strong>安装命令：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">npx skills <span class="hljs-keyword">add</span> https:<span class="hljs-comment">//github.com/anthropics/skills --skill frontend-design</span>
</code></pre>
<p><strong>2、agent-browser（24.1k+安装）</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92094f11608141dc89029265ec3064c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=%2FOJmgngd0qQxzNyjg9XeU7O0Pu4%3D" alt="图片" loading="lazy"/></p>
<p>这个Skill不太一样，它不是"知识库"，而是"工具"（就像给Claude装了个机械臂）。装上之后，Claude可以帮你操作浏览器：</p>
<ul>
<li>自动打开网页、点击按钮、填写表单（终于不用自己点点点了）</li>
<li>批量截图（再也不用一张一张手动截）</li>
<li>自动登录网站（保存登录状态，下次直接用，懒人福音）</li>
<li>录制操作过程（以后可以回放，看看AI是怎么"思考"的）</li>
</ul>
<p><strong>实际测试：</strong>  我让Claude帮我登录5个平台查数据，它真的自动完成了。虽然有些网站需要验证码会卡住（AI再聪明也过不了"你是人类吗"这关），但大部分操作都能自动化。运营、测试、产品都能用得上，特别是那些重复性的"点点点"工作。</p>
<p><strong>安装命令：</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">npx skills <span class="hljs-keyword">add</span> https:<span class="hljs-comment">//github.com/vercel-labs/agent-browser --skill agent-browser</span>
</code></pre>
<p><strong>3、seo-audit（13k+安装）</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1052a849be34adca0d5b59de6220115~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=RHF39oh3uTxN%2FDGGQ%2Fuw2mZ1aRE%3D" alt="图片" loading="lazy"/></p>
<p>终于来了一个纯运营向的Skill（程序员终于不用再被问"为什么网站搜不到"了）。</p>
<p>这是一个完整的SEO审计框架，让Claude帮你检查网站的SEO健康度（就像给网站做体检）：</p>
<ul>
<li>能被Google找到吗？（爬虫能不能访问、有没有被收录，别做"隐形网站"）</li>
<li>网站快不快？（加载速度影响排名，慢得像蜗牛可不行）</li>
<li>内容优化了吗？（标题、描述、关键词布局，别让搜索引擎"看不懂"）</li>
<li>内容质量够不够？（是否值得被推荐，别写一堆废话）</li>
<li>有没有可信度？（外链、权威性，别让人家觉得你是"野鸡网站"）</li>
</ul>
<p><strong>实际测试：</strong>  我让Claude审计了一下我的项目“AI灯塔导航”，它给出了多个真实存在的问题，每个都标明了影响程度和修复优先级（就像医生开药方，告诉你先治什么后治什么）。做网站的都能用，不需要懂技术（终于不用再求程序员了）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e7266d66f38406193659911b6397272~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=5ocCSGfqH%2B4mWKjY978Cr8fjf2E%3D" alt="图片" loading="lazy"/></p>
<p><strong>安装命令：</strong></p>
<pre><code class="hljs language-bash" lang="bash">npx skills add https://github.com/coreyhaines31/marketingskills --skill seo-audit
</code></pre>
<h2 data-id="heading-7">三、额外收获：23个营销Skills  </h2>
<p>Top 10里大部分是开发向的，但别急（程序员也有春天）。</p>
<p>我在安装过程中发现了一个宝藏仓库：<strong>coreyhaines31/marketingskills</strong></p>
<p>这个仓库有23个营销相关的Skill，从文案到定价到投放都有（一站式营销工具箱，比瑞士军刀还全）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbe56daff5674b5da974e46d44bee078~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=BvlxM%2FNymxL0Pv4citz%2BmOcFzbo%3D" alt="图片" loading="lazy"/></p>











































































<table><thead><tr><th>Skill</th><th>功能</th><th>适合谁</th></tr></thead><tbody><tr><td>copywriting</td><td>营销文案写作</td><td>市场、运营</td></tr><tr><td>copy-editing</td><td>文案润色修改</td><td>市场、运营</td></tr><tr><td>pricing-strategy</td><td>定价策略设计</td><td>产品、创业者</td></tr><tr><td>launch-strategy</td><td>产品发布策略</td><td>产品、市场</td></tr><tr><td>seo-audit</td><td>SEO诊断</td><td>运营、独立开发者</td></tr><tr><td>ab-test-setup</td><td>A/B测试设计</td><td>产品、运营</td></tr><tr><td>page-cro</td><td>落地页转化优化</td><td>运营、增长</td></tr><tr><td>signup-flow-cro</td><td>注册流程优化</td><td>产品、增长</td></tr><tr><td>email-sequence</td><td>邮件营销序列</td><td>市场、运营</td></tr><tr><td>social-content</td><td>社交媒体内容</td><td>市场、运营</td></tr><tr><td>paid-ads</td><td>付费广告投放</td><td>市场</td></tr><tr><td>referral-program</td><td>推荐计划设计</td><td>增长、产品</td></tr><tr><td>marketing-psychology</td><td>营销心理学</td><td>市场、产品</td></tr></tbody></table>
<p><strong>安装命令：</strong></p>
<pre><code class="hljs language-bash" lang="bash">npx skills add coreyhaines31/marketingskills --<span class="hljs-built_in">yes</span>
</code></pre>
<p>一次性装23个。</p>
<p><strong>我的看法：</strong>  做产品、运营、市场的，这个仓库比Top 10更值得装（就像找到了组织，终于不用再自己摸索了）。</p>
<h2 data-id="heading-8">四、熟悉的宝玉老师的Skills</h2>
<p>翻Top 100的时候，发现了一些熟悉的名字——宝玉老师（@dotey）的Skills（就像在异国他乡遇到了老乡，亲切感爆棚）。</p>
<p>宝玉老师是X上的AI大V，经常分享Claude Code的使用心得。他把自己的工作流打包成了一堆Skills，放在 <strong>jimliu/baoyu-skills</strong> 仓库（这就是传说中的"授人以渔不如授人以鱼"）：</p>


















































<table><thead><tr><th>Skill</th><th>功能</th><th>安装量</th></tr></thead><tbody><tr><td>baoyu-slide-deck</td><td>幻灯片生成</td><td>972</td></tr><tr><td>baoyu-article-illustrator</td><td>文章配图</td><td>938</td></tr><tr><td>baoyu-cover-image</td><td>封面图生成</td><td>868</td></tr><tr><td>baoyu-xhs-images</td><td>小红书图片</td><td>841</td></tr><tr><td>baoyu-comic</td><td>漫画生成</td><td>822</td></tr><tr><td>baoyu-post-to-wechat</td><td>发布到微信</td><td>752</td></tr><tr><td>baoyu-post-to-x</td><td>发布到X</td><td>725</td></tr><tr><td>baoyu-infographic</td><td>信息图生成</td><td>480</td></tr></tbody></table>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c34e35ffab5644a6bf2ca1b39a346920~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=NkcLcW24p42WDnhttVQy3plRgjI%3D" alt="图片" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc4acc86dc2c408f8d3f59359dab7e59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=wmRhW%2BUVPaGq8fmL6tXBNopkagg%3D" alt="图片" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/281a350be02f4fd9a4dd3c9fe69c4495~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=xY1aZrezo1CpiaQpGSXgl%2FBD4lc%3D" alt="图片" loading="lazy"/></p>
<p>这些Skills对中文用户特别友好——小红书图片、发微信、文章配图，都是我们平时会用到的（终于不用再自己手动P图了，AI帮你搞定一切）。</p>
<p><strong>安装命令：</strong></p>
<pre><code class="hljs language-bash" lang="bash">npx skills add jimliu/baoyu-skills --<span class="hljs-built_in">yes</span>
</code></pre>
<h2 data-id="heading-9">五、文档处理四件套</h2>
<p>Anthropic官方仓库（<strong>anthropics/skills</strong>）里有4个文档处理Skill（就像Office套件，但这次是AI版的）：</p>
<ul>
<li><strong>pdf</strong> —— PDF读取、提取、合并（再也不用装各种PDF工具了）</li>
<li><strong>docx</strong> —— Word文档处理（写文档、改格式，AI帮你搞定）</li>
<li><strong>pptx</strong> —— PPT生成和编辑（做PPT终于不用熬夜了）</li>
<li><strong>xlsx</strong> —— Excel处理（数据分析、公式计算，AI比你算得还快）<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92111edf66fd4f368ae70995684f173c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY56CB5q2M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771316777&amp;x-signature=S9PWrPbVHF0hdpz%2FLt4Me79r%2FP4%3D" alt="图片" loading="lazy"/></li>
</ul>
<p>这几个所有人都能用。装上之后让Claude帮你处理文档，会顺手很多（就像给AI装了个Office，但它比Office还聪明）。</p>
<p><strong>安装命令：</strong></p>
<pre><code class="hljs language-bash" lang="bash">npx skills add anthropics/skills --<span class="hljs-built_in">yes</span>
</code></pre>
<h2 data-id="heading-10">六、为什么你应该去看看skills.sh  </h2>
<p>说两个实际的好处（不画饼，都是大实话）。</p>
<p><strong>第一，这些Skill确实有用（不是智商税）。</strong></p>
<p>skills.sh上排名靠前的，都是被大量vibe coder实际装过、用过的。37000+安装不是刷的，是真有人在用（就像淘宝好评，虽然可能有刷的，但大部分都是真用户）。</p>
<p>这些人天天用Claude Code写代码、做产品，他们愿意装，说明确实有用。跟着装就行，不用自己判断"这玩意到底行不行"，社区已经帮你筛过一遍了（就像跟着大众点评选餐厅，虽然不一定最好，但至少不会踩雷）。</p>
<p><strong>第二，这是学习Skills最好的方式（比看文档强多了）。</strong></p>
<p>很多人看了我之前的文章，知道Skills是啥了，但还是不知道怎么下手——自己的Skill该怎么写？（就像知道怎么吃，但不知道怎么做）</p>
<p>最好的学习方式不是啃文档，是看别人怎么写的（就像学做菜，看视频比看菜谱快）。</p>
<p>装几个热门Skill之后，让Claude Code或者cursor等agent帮你解读：</p>
<pre><code class="hljs language-javascript" lang="javascript">帮我读取并解释 ~<span class="hljs-regexp">/.agents/</span>skills/seo-audit/<span class="hljs-variable constant_">SKILL</span>.<span class="hljs-property">md</span> 的实现逻辑
</code></pre>
<p>Claude会告诉你（就像找了个老师，手把手教你）：</p>
<ul>
<li>这个Skill的触发条件是怎么写的（什么时候AI会"想起来"用这个Skill）</li>
<li>指令是怎么组织的（怎么让AI"听话"）</li>
<li>为什么要这样分层（为什么这样设计更合理）</li>
<li>哪些设计可以借鉴（哪些可以"抄作业"）</li>
</ul>
<p>看3-5个写得好的，你就知道了（就像看了几部好电影，就知道怎么拍电影了）：</p>
<ul>
<li>Skill该怎么组织（结构怎么搭）</li>
<li>好的Skill长啥样（标准是什么）</li>
<li>自己的工作流怎么打包（怎么把自己的经验变成Skill）</li>
</ul>
<p>从模仿开始，比从零开始容易多了（站在巨人的肩膀上，总比自己造轮子强）。</p>
<p>所以我建议：<strong>先装、先用、先看，再想自己要不要做（实践出真知，别光想不做）</strong> 。</p>
<h2 data-id="heading-11">七、几个实际建议</h2>
<p><strong>1. 根据你的岗位选择（别乱装）</strong></p>
<ul>
<li><strong>开发者</strong>：vercel-react-best-practices、anthropics/skills（写代码的，装这些就够了）</li>
<li><strong>产品经理</strong>：seo-audit、marketingskills仓库、agent-browser（做产品的，这些能帮你省很多事）</li>
<li><strong>设计师</strong>：frontend-design、web-design-guidelines（做设计的，让AI帮你检查规范）</li>
<li><strong>运营/市场</strong>：marketingskills仓库（23个全装上，一站式解决所有营销问题）</li>
</ul>
<p><strong>2. 别贪多（装太多会卡）</strong></p>
<p>我装了50+个是为了写这篇文章。平时用的话，选3-5个高频的就够了</p>
<p>装太多，Claude启动时要加载的东西多，还是会影响上下文的。</p>
<p><strong>3. 注意来源（安全第一）</strong></p>
<p>Skills可以包含可执行脚本，所以要看谁发的（别什么Skill都装，小心被"钓鱼"）：</p>
<ul>
<li>✅ anthropics/skills（Anthropic官方，官方出品，必属精品）</li>
<li>✅ vercel-labs（Vercel官方，大厂出品，值得信赖）</li>
<li>✅ 框架官方（expo/skills等，官方维护，更新及时）</li>
<li>⚠️ 个人仓库谨慎点（就像下载软件，别从不明来源下载）</li>
</ul>
<p><strong>4. 先用再说（实践是检验真理的唯一标准）</strong></p>
<p>不用完全搞懂原理，先装一两个用起来。用过才知道好不好（就像买衣服，不试穿怎么知道合不合适）。</p>
<h2 data-id="heading-12">八、最后，别光看，快去试  </h2>
<p>skills.sh出来之后，用Skills变简单了，以前得自己写，现在直接装别人的就行（站在巨人的肩膀上，真香）。而且不只是程序员能用——营销、产品、运营，都有对应的Skills（AI终于不只是程序员的玩具了）。</p>
<p>去skills.sh看看，找一两个和你工作相关的装上试试（别光看，动手试试，又不会怀孕）。</p>
<p>比如你是运营，装个seo-audit，然后问Claude："帮我审计一下我们的官网SEO"（终于不用再求程序员了）。</p>
<p>比如你是产品，装个pricing-strategy，然后问Claude："帮我分析一下我们产品的定价策略"（终于不用再拍脑袋定价了）。</p>
<p>试过就知道好不好使了（实践出真知，别光听我说）。</p>
<p>哦对，虽然上面给了你怎么安装这些skills的代码，但其实最佳实践还是你直接把这篇文章，以及把skills.sh的网址丢给Claude Code 或者 Cursor，用自然语言让他帮你选择及安装就好了（让AI帮你装AI的Skill，这就是AI的"自举"）。</p>
<blockquote>
<p>我是”<strong>程序员码歌</strong>“，<strong>全网昵称统一</strong>，10+年大厂程序员，专注AI工具落地与AI编程实战输出，在职场，玩转副业，目标副业年收入百万，探索可复利、可复制的一人企业成长模式，<strong>可去gzh围观</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[3分钟快速掌握 skills 核心原理]]></title>    <link>https://juejin.cn/post/7605041451327586347</link>    <guid>https://juejin.cn/post/7605041451327586347</guid>    <pubDate>2026-02-10T13:36:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605041451327586347" data-draft-id="7604853010171609129" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="3分钟快速掌握 skills 核心原理"/> <meta itemprop="keywords" content="AI编程,Claude"/> <meta itemprop="datePublished" content="2026-02-10T13:36:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大虫小呓"/> <meta itemprop="url" content="https://juejin.cn/user/4257765628844654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            3分钟快速掌握 skills 核心原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4257765628844654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大虫小呓
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T13:36:46.000Z" title="Tue Feb 10 2026 13:36:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">Skills 是什么？</h3>
<p>Claude Code 中的 Skills 是一种强大的功能扩展机制，它允许你将专业知识、工作流程和最佳实践封装成可复用的模块，让 AI 助手能更精准地理解并执行特定任务。</p>
<p>下面这个表格可以帮助你快速把握其核心概念。</p>



































<table><thead><tr><th>特性维度</th><th>传统一次性提示词 (Prompt)</th><th>Claude Skills</th></tr></thead><tbody><tr><td><strong>知识载体</strong></td><td>对话上下文，易丢失</td><td>文件系统中的标准化文件夹，持久化存储</td></tr><tr><td><strong>复用性</strong></td><td>低，每次新对话需重新解释</td><td>高，一次创建，多次调用，跨项目共享</td></tr><tr><td><strong>知识管理</strong></td><td>知识散落，难以维护和迭代</td><td>模块化管理，不同领域知识独立封装，易于更新</td></tr><tr><td><strong>上下文使用</strong></td><td>所有指令一次性全量加载，占用大量 Token</td><td><strong>渐进式披露</strong>，按需分层加载，极大节省 Token</td></tr><tr><td><strong>执行能力</strong></td><td>依赖模型生成代码或文本</td><td>可捆绑<strong>可执行脚本</strong>，直接运行，结果确定且高效</td></tr></tbody></table>
<h3 data-id="heading-1">核心机制：渐进式披露</h3>
<p>Skills 的关键优势在于其“渐进式披露”的智能加载策略，这类似于查字典时先看目录，再找章节，最后查阅附录，而不是背诵整本字典。其加载过程分为三层：</p>
<ol>
<li>
<ol>
<li><strong>元数据层</strong>：每个 Skill 的 <code>SKILL.md</code> 文件顶部包含简短的 <code>name</code> 和 <code>description</code>。Claude 在启动时会加载所有 Skills 的元数据（每个约100 Tokens），形成一个“技能目录”，用于快速匹配用户请求。</li>
</ol>
</li>
<li>
<ol start="2">
<li><strong>核心指令层</strong>：当 Claude 根据元数据判断某个 Skill 与当前任务相关时，才会加载 <code>SKILL.md</code> 文件的主体内容，获取详细的工作流程和规则。</li>
</ol>
</li>
<li>
<ol start="3">
<li><strong>扩展资源层</strong>：只有在核心指令明确要求时，Claude 才会去读取 <code>scripts/</code> 目录下的脚本或 <code>references/</code> 目录下的详细参考文档。不需要的资源完全不占用上下文。</li>
</ol>
</li>
</ol>
<p>这种机制有效解决了上下文窗口有限的问题，使得安装大量 Skills 成为可能，而不会影响核心对话的流畅性。</p>
<h3 data-id="heading-2">创建与管理 Skills</h3>
<p>一个标准的 Skill 在物理上是一个文件夹，其典型结构如下所示：</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-keyword">my</span>-skill/
├── SKILL.md          <span class="hljs-comment"># 必需：核心指令文件，包含元数据和详细指南</span>
├── scripts/          <span class="hljs-comment"># 可选：可执行脚本（Python、Shell等）</span>
│   └── helper.py
├── references/       <span class="hljs-comment"># 可选：补充参考文档（API文档、规范等）</span>
│   └── api.md
└── assets/           <span class="hljs-comment"># 可选：模板、配置文件等静态资源</span>
</code></pre>
<p>创建 Skill 的核心是编写 <code>SKILL.md</code> 文件，它采用 <strong>YAML Frontmatter + Markdown 内容</strong>的结构：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-string">name:</span> <span class="hljs-string">my-skill</span>  <span class="hljs-comment"># 技能名称，也将作为斜杠命令</span>
<span class="hljs-string">description:</span> <span class="hljs-string">这个技能用于...</span> <span class="hljs-string">当用户需要...时使用。</span> <span class="hljs-comment"># 关键：清晰描述功能和触发场景</span>
<span class="hljs-string">disable-model-invocation:</span> <span class="hljs-literal">false</span>  <span class="hljs-comment"># 可选：是否允许Claude自动调用</span>
<span class="hljs-meta">---</span>
<span class="hljs-comment"># 技能详细指南</span>

<span class="hljs-comment">## 工作流程</span>
<span class="hljs-number">1</span><span class="hljs-string">.</span>  <span class="hljs-string">第一步...</span>
<span class="hljs-number">2</span><span class="hljs-string">.</span>  <span class="hljs-string">第二步...</span>
<span class="hljs-string">...</span>
</code></pre>
<p>根据使用范围，Skills 可以存放在不同位置：</p>
<ul>
<li><strong>个人 Skills</strong> (<code>~/.claude/skills/</code>)：仅限当前用户使用，适合个人工作习惯。</li>
<li><strong>项目 Skills</strong> (<code>项目根目录/.claude/skills/</code>)：项目团队成员共享，适合团队编码规范、项目特定流程。</li>
<li><strong>插件 Skills</strong>：通过 Claude Code Plugin 安装和分发，适合通用工具能力。</li>
</ul>
<h3 data-id="heading-3">应用场景与最佳实践</h3>
<p>Skills 能广泛应用于各种场景，例如：</p>
<ul>
<li><strong>规范团队流程</strong>：将代码审查清单、Git 提交规范、部署流程封装成 Skill，确保团队输出一致性。</li>
<li><strong>处理特定文件</strong>：使用官方或社区的 <code>pptx</code>、<code>xlsx</code>、<code>pdf</code> 等 Skills，让 Claude 能够专业地处理办公文档。</li>
<li><strong>封装业务逻辑</strong>：将公司内部的数据查询、API 调用规范等特定业务知识打包，让 AI 成为懂业务的专家助手。</li>
</ul>
<p>创建高质量 Skill 的几个最佳实践包括：</p>
<ul>
<li><strong>保持聚焦</strong>：一个 Skill 只解决一类明确的问题，避免创建“万能”Skill。</li>
<li><strong>描述清晰</strong>：<code>description</code> 字段务必写明具体功能和触发关键词，帮助 Claude 准确识别。</li>
<li><strong>提供示例</strong>：在 Skill 中包含输入和输出的正反示例，能显著提升效果。</li>
</ul>
<h3 data-id="heading-4">与其他技术的关系</h3>
<p>需要区分 Skills 和另外两种常见技术：</p>
<ul>
<li><strong>MCP</strong>：它好比 <strong>USB 协议</strong>，主要负责让 AI <strong>安全连接外部工具和服务</strong>（如数据库、GitHub），解决的是“连接”问题。</li>
<li><strong>Function Calling</strong>：它相当于 <strong>工具按钮</strong>，是 AI 触发<strong>单个具体操作</strong>的机制，解决的是“执行”问题。</li>
</ul>
<p>而 <strong>Skills 则像是完整的操作手册</strong>，它利用 MCP 建立连接，通过 Function Calling 执行步骤，<strong>指挥 AI 如何思考、如何组合步骤以完成一个复杂任务</strong>。三者是互补关系，协同工作。</p>
<p>希望本文能帮助你更好地理解和使用 Claude Code Skills！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenCode使用入门]]></title>    <link>https://juejin.cn/post/7604741630449106978</link>    <guid>https://juejin.cn/post/7604741630449106978</guid>    <pubDate>2026-02-10T05:33:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604741630449106978" data-draft-id="7604779604125237248" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenCode使用入门"/> <meta itemprop="keywords" content="笔记"/> <meta itemprop="datePublished" content="2026-02-10T05:33:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户93135600274"/> <meta itemprop="url" content="https://juejin.cn/user/1250582629717883"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenCode使用入门
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1250582629717883/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户93135600274
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T05:33:46.000Z" title="Tue Feb 10 2026 05:33:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>[TOC]</p>
<h2 data-id="heading-0">Opencode</h2>
<p>OpenCode 是一个开源的 AI 编程代理（AI coding agent），支持在终端（Terminal）、桌面应用和主流 IDE（如 VS Code）中与 AI 交互完成代码相关任务。</p>
<p>OpenCode 可以帮助我们理解代码库、编写新功能、重构代码、修复 Bug 等，大幅提升开发效率。</p>
<p><strong>关键特性：</strong></p>
<p>两种内置 Agent 模式：</p>
<ul>
<li>Build 模式： 全权限，可直接编辑文件、执行命令。</li>
<li>Plan 模式： 只读规划，默认拒绝编辑，需要确认。</li>
</ul>
<p>工具集： bash 执行、文件读写、 grep 搜索、 LSP 诊断等。</p>
<p>上下文感知： 自动分析项目结构，生成 AGENTS.md 指南。</p>
<p>分享与协作： 一键生成会话分享链接。</p>
<h3 data-id="heading-1">下载与安装</h3>
<ol>
<li>
<p>下载编译器 nodejs</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fzh-cn%2Fdownload" target="_blank" title="https://nodejs.org/zh-cn/download" ref="nofollow noopener noreferrer">Node.js — 下载 Node.js®</a></p>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8924f06c34814b49b062a4626c0195f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=%2Fw5AbffoH1eH1Myab27TRR8XTr4%3D" alt="image-20260204215648691.png" loading="lazy"/></p>
<p>此处要勾选：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7d47e6f3d6c4a8fb0643f7ca4899c9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=n8XpZIriCqB99%2BNlKMsYXLhnAYs%3D" alt="72439f8f-757a-4e6d-bc07-c437acc54db6.png" loading="lazy"/></p>
<ol start="2">
<li>
<p>执行下面命令一键安装：</p>
<pre><code class="hljs">npm install -g opencode-ai
</code></pre>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f492285b49f744cabcddce20f344c5a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=hElcCe9XaOkpKfeq%2FrJpmYOvVwQ%3D" alt="image-20260204215907372.png" loading="lazy"/></p>
<ol start="3">
<li>
<p>验证安装：</p>
<pre><code class="hljs">opencode -version
</code></pre>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c97662760abb4097b5c154685693db63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=WnoNUGHwNQm2bwvsSa75EyGIHOg%3D" alt="image-20260204215947500.png" loading="lazy"/>
如果输出类似 1.1.19 这种的版本号信息表示安装成功。</p>
<h3 data-id="heading-2">启动与使用</h3>
<p>启动 OpenCode 只需要终端输入启动命令：</p>
<pre><code class="hljs">opencode
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8908cbfb1f942d183e3f31f54844cb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=%2FdCihCtZ1eDJCyWWhwi77UfPEdY%3D" alt="image-20260204222126742.png" loading="lazy"/></p>
<p>（标题因为win10系统和opencode艺术字渲染不兼容导致乱码，暂时无法解决）</p>
<p>首次启动会引导完成基础配置：</p>
<ul>
<li>模型选择： 默认展示可用模型列表，可直接选择标注 Free 的免费模型（如 MiniMax M2.1、 GLM-4.7），无需 API Key 即可使用。</li>
<li>登录选项： 可选择跳过登录，后续需对接商业模型时再配置 API Key，也可登录 Claude Code Pro账号调用专属模型。</li>
</ul>
<p>启动成功后进入 TUI 界面，即可开始使用核心功能。</p>
<p>我们可以在终端输入 /models 查看可用的免费模型：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1bf1387523e4a03b93a1ad1d499593c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=DcnVDR0%2FcUCT0u18iex447Yz%2Bl0%3D" alt="image-20260204222312632.png" loading="lazy"/></p>
<p>配置 API 密钥与模型</p>
<p>如果你连接一个 AI 提供商的 API 密钥，例如 OpenAI 或 Anthropic Claude，运行：</p>
<pre><code class="hljs">opencode auth login
</code></pre>
<p>或者在终端启动后输入：</p>
<pre><code class="hljs language-arduino" lang="arduino">/connect
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/457ed73833a34c95a4dd334a2d198bb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=yKK%2Bww9J7OVI3cCC%2BqsaTobn4fo%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">基本使用</h4>
<p>进入你想处理的项目目录：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /path/to/your/project
opencode
</code></pre>
<h4 data-id="heading-4">项目初始化</h4>
<p>在 OpenCode 界面中，运行：</p>
<pre><code class="hljs language-bash" lang="bash">/init
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cabf50d577704aa5be46bb7b8613c7a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=GL9JFlI4r%2FgEmc1HkPhzjospEc4%3D" alt="image-20260205143848614.png" loading="lazy"/></p>
<h3 data-id="heading-5">OpenCode TUI 常用 Slash 命令速查表</h3>


























































































<table><thead><tr><th>命令</th><th>描述</th><th>别名/快捷键</th></tr></thead><tbody><tr><td>/connect</td><td>添加或配置 LLM 提供商（API Key）</td><td>无</td></tr><tr><td>/init</td><td>创建或更新项目 AGENTS.md 文件（分析代码库）</td><td>Ctrl+X I</td></tr><tr><td>/models</td><td>列出可用模型并切换</td><td>Ctrl+X M</td></tr><tr><td>/new</td><td>开始新会话（清除当前）</td><td>/clear / Ctrl+X N</td></tr><tr><td>/sessions</td><td>列出并切换会话</td><td/></tr><tr><td>/share</td><td>分享当前会话（生成链接）</td><td>Ctrl+X S</td></tr><tr><td>/unshare</td><td>取消分享当前会话</td><td/></tr><tr><td>/compact</td><td>压缩/总结当前会话</td><td/></tr><tr><td>/undo</td><td>撤销最后操作（需 Git 仓库，支持文件变更回滚</td><td>Ctrl+X U</td></tr><tr><td>/redo</td><td>重做已撤销的操作（需 Git 仓库）</td><td>Ctrl+X R</td></tr><tr><td>/details</td><td>切换工具执行详情显示</td><td>Ctrl+X D</td></tr><tr><td>/thinking</td><td>切换思考/推理过程可见性</td><td/></tr><tr><td>/theme</td><td>列出并切换主题</td><td/></tr><tr><td>/help</td><td>显示帮助对话框</td><td>Ctrl+X H</td></tr><tr><td>/export</td><td>导出当前对话为 Markdown 并打开编辑</td><td/></tr><tr><td>/exit</td><td>退出 OpenCode</td><td>/quit / /q / Ctrl+X Q</td></tr></tbody></table>
<h2 data-id="heading-6">Agent Skills</h2>
<p>Agent Skills 是一个由 Anthropic 牵头维护的 开放标准，通过定义特定任务执行规范，能便捷地将个人经验转化为技能，快速构建轻量级的智能体。</p>
<h3 data-id="heading-7">技能商店</h3>
<p>推荐使用 Vercel 出品的<a href="https://link.juejin.cn?target=https%3A%2F%2Fskills.sh%2F" target="_blank" title="https://skills.sh/" ref="nofollow noopener noreferrer">The Agent Skills Directory</a> 排行榜，可以直观查看当前最受欢迎的 Skills 仓库和单个 Skill 的使用情况。还可以辅助使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fskillsmp.com%2Fzh" target="_blank" title="https://skillsmp.com/zh" ref="nofollow noopener noreferrer">Agent Skills 市场 - Claude、Codex 和 ChatGPT Skills | SkillsMP</a> 商店，该商店中自动抓取了 Github 上的所有的 Skills 项目，并按照分类、更新时间、 Star 数量等标签进行了整理。</p>
<p>其他特色 Agent Skills 商店还有：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fskillstore.io%2Fzh-hans" target="_blank" title="https://skillstore.io/zh-hans" ref="nofollow noopener noreferrer">Skillstore - 面向 Claude、Codex 与 Claude Code 的 AI 技能市场</a>：对 Skill 进行了安全审计的中文商店</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fagentskills.me%2F" target="_blank" title="https://agentskills.me/" ref="nofollow noopener noreferrer">Discover Agent Skills - Agent Skills</a>：提供了云端 Skill 运行环境的商店</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fskills.rest%2F" target="_blank" title="https://skills.rest/" ref="nofollow noopener noreferrer">Agent skills Library | skills.rest</a>：提供 Skill 分析和安全审查的商店</li>
</ul>
<h3 data-id="heading-8">编程工具</h3>
<p>要在编程工具中安装 Agent Skills，只需要将 Skill 文件夹放入对应的路径即可。</p>
<p>建议使用 Vercel 官方出品的 npx skills add &lt;owner/repo&gt; 命令行工具快速添加，具体参数参见<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fskills" target="_blank" title="https://www.npmjs.com/package/skills" ref="nofollow noopener noreferrer">skills - npm</a>。</p>
<h3 data-id="heading-9">精选技能</h3>
<h4 data-id="heading-10">网络安全</h4>
<ul>
<li>tanweai/wooyun-legacy：基于 WooYun 2010-2016 年间收录的 88,636 个真实漏洞案例，提炼出的安全知识库。装上这个 Skill 后， Claude/opencode 能像资深安全专家一样思考漏洞问题。（下面这种方式是全局配置）</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">npx skills add tanweai/wooyun-legacy
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc70a6db942642d6a81c67b6abb43f7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=lIpb6PlqXS5MWC13xtWtDFe6xHY%3D" alt="image-20260205162256726.png" loading="lazy"/></p>
<p>（可以让AI帮你执行安装命令并分析错误）</p>
<h4 data-id="heading-11">技能创建</h4>
<ul>
<li>
<p>anthropics/skills/skill-creator: Anthropic 官方出品用于创建 skill 的元技能，可快速创建和迭代个人专属的 skill</p>
</li>
<li>
<p>yusufkaraaslan/Skill_Seekers: 自动化抓取文档网站、 GitHub 仓库和 PDF 文件转换为 Agent Skills</p>
</li>
</ul>
<h4 data-id="heading-12">文档处理</h4>
<ul>
<li>docx：创建和编辑 Word 文档的 Skill</li>
<li>pptx：创建和编辑 PowerPoint 的 Skill</li>
<li>xlsx：创建和编辑 Excel 的 Skill</li>
<li>pdf：创建和编辑 PDF 的 Skill</li>
</ul>
<h4 data-id="heading-13">官方项目</h4>
<ul>
<li>anthropics/skills： Anthropic 出品的 Skills 集合</li>
<li>vercel-labs/agent-skills： Vercel 出品的 React Skills 集合</li>
<li>expo/skills： Expo 出品的 React Native Skills 集合</li>
<li>supabase/agent-skills： Supabase 出品的 PostgreSQL 最佳实践</li>
<li>remotion-dev/skills： Remotion 出品的使用 Remotion 创建视频内容</li>
<li>langgenius/dify： Dify 出品的多功能 Skills 集合</li>
<li>huggingface/skills： HuggingFace 出品使用 Skill 训练大模型</li>
<li>kepano/obsidian-skills： Obsidian CEO 出品增强 Obsidian 功能的 Skills 集合</li>
</ul>
<h4 data-id="heading-14">内容创作</h4>
<ul>
<li>JimLiu/baoyu-skills：宝玉的自用 SKills 集合，包括公众号写作、 PPT 制作等</li>
<li>github.com/op7418)：歸藏制作的一系列 Skills 集合，包括 PPT 制作、 Youtube 分析等</li>
<li>wshuyi/x-article-publisher-skill: 王树义发布 X 文章的 Skillhuangserva/skill-prompt-generator： huangserva 使用 Skill 生成和优化 AI 人像文生图提示词的Skill</li>
</ul>
<h4 data-id="heading-15">编程辅助</h4>
<ul>
<li>obra/superpowers：涵盖完整编程项目工作流程的 Skills 集合</li>
<li>ComposioHQ/awesome-claude-skills：涵盖多个编程类任务的优质 Skills 集合</li>
<li>nextlevelbuilder/ui-ux-pro-max-skill：面向 UI/UX 设计的 Skills 集合</li>
<li>OthmanAdi/planning-with-files：使用文件规划实现长期 Plan 效果的 Skill</li>
<li>hyf0/vue-skills：面向 Vue.js 开发的 Skills 集合</li>
</ul>
<h4 data-id="heading-16">产品使用</h4>
<ul>
<li>teng-lin/notebooklm-py：操控 NotebookLM 的Skill</li>
<li>czlonkowski/n8n-skills：创建 n8n 工作流的 Skills 集合</li>
<li>cloudai-x/threejs-skills： 面向 Three.js 开发的 Skills 集合</li>
</ul>
<h4 data-id="heading-17">配套工具</h4>
<ul>
<li>openskills: Skills 全局加载工具，支持多种 Agent 工具</li>
<li>skild.sh：在多个工具中安装、管理和同步 Skills 的命令行工具</li>
<li>agent-skills-guard： Agent skills 可视化管理+精选仓库+安全扫描</li>
<li>skillmaster：通过终端管理、安装和使用 Agent Skills</li>
</ul>
<h2 data-id="heading-18">利用AI工具实现前端绕过</h2>
<h3 data-id="heading-19">前端明文加密绕过</h3>
<p>启用 encrypt 靶场，添加断点调试：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df1de798ba234578aef8fc9091dc48df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=4x7vX1wE9LSvP2X82R00FR3jj%2BU%3D" alt="image-20260205152811556.png" loading="lazy"/></p>
<p>将整段加密函数复制到opencode目录下，并将发包信息和服务端模板一起丢给AI</p>
<p>app.py：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> hmac

app = Flask(__name__)

secret_key = <span class="hljs-string">"be56e057f20f883e"</span>

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/encode'</span>,methods=[<span class="hljs-string">"POST"</span>]</span>)  </span><span class="hljs-comment"># base64加密</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">encrypt</span>():
	param = request.form.get(<span class="hljs-string">'dataBody'</span>)

	

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/decode'</span>,methods=[<span class="hljs-string">"POST"</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">decrypt</span>():
	param = request.form.get(<span class="hljs-string">'dataBody'</span>)

	<span class="hljs-keyword">return</span> param

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
	app.run(host=<span class="hljs-string">"0.0.0.0"</span>,port=<span class="hljs-string">"5000"</span>)
</code></pre>
<p>最后让AI完善代码，用 <code>python3 appp.py</code> 启动服务端，利用burp的插件调用服务端：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8e51b8e3c174d019f774f3e7e885396~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=IUN0Z2Tc0E8wBg5Pva6dJUx0D44%3D" alt="image-20260206160728916.png" loading="lazy"/></p>
<p>成功实现前端明文加密绕过。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b99abf51929945c5ae71e4398b908f4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=C%2F9uoP6hcii9Vl1qjr1h4j819uM%3D" alt="image-20260206160809705.png" loading="lazy"/></p>
<h3 data-id="heading-20">服务端请求加签 key 绕过</h3>
<p>这里需要明确把服务端加签 key 请求包和响应包发给AI，再把登陆包也发给AI</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dccf1fe20c994cc99c7ea574e69c6d00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=5wD76%2FNBBpdjQhiI9L45jHRwfmY%3D" alt="image-20260206174446510.png" loading="lazy"/></p>
<p>再明确告诉AI，需要再app.py中复现前端加密过程，而不是实现签名生成或签名验证。</p>
<p>最后告诉 AI 需要用 <code>param = request.form.get('dataBody')</code> 固定的接受方式，不然无法兼容burp发包。</p>
<p>最后漏洞复现成功：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6d10c9b7b1c44fe9cba494cdceb44e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=LjXBkw2vz7Qf7FdqbiRwQE6S76s%3D" alt="image-20260206174914501.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e64339f5fd5e4b938c44a55a6c1cd92a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=jAI68dbWzqE8xSOIs4980wTOaX8%3D" alt="image-20260206174900046.png" loading="lazy"/></p>
<h3 data-id="heading-21">时间戳加密的禁止重放绕过</h3>
<p>时间戳加密的key是经过混淆的，也在前端代码中。先将一部分直接执行的代码喂给AI，让AI指导我们去找到相关函数。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05f82cf239d74680bca44d01d2cf22fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=fbkobwm%2FW2AbYu9JnetxpDQuitU%3D" alt="image-20260206213723534.png" loading="lazy"/></p>
<p>最好不要把全部前端都喂给一个AI。这样很容易误导AI的下一步操作。手动找到混淆过后的key后喂给AI看。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ad4f3cf73cd436582b6edbbcb6e2db9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=1l1phr%2BdOlbZg8eI9bTGTxQWU3U%3D" alt="image-20260206213953221.png" loading="lazy"/>
再让AI判断前端加密验证的类型，正确后让AI在app.py中复现加密过程。</p>
<p>最后复现成功：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e16b7cdbde014d81a31c0eb47bce4c1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=VyaKhrJUSXEd3aSwbTZENCbNAZw%3D" alt="image-20260206214143671.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7e6673687424515a1d6d9e54f798414~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=yLyupE9pvfpYBthwT6h4sg4aPc8%3D" alt="image-20260206214158399.png" loading="lazy"/></p>
<h2 data-id="heading-22">用roocode编写表单爆破工具</h2>
<h3 data-id="heading-23">burp插件</h3>
<p>copy as python-requets插件，可以直接将http请求转化成python代码</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d20d4ff690db4973953aa1d0190cc941~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=XO6d7clQgckZzWR%2F9UlkwHdmAjw%3D" alt="image-20260210125534217.png" loading="lazy"/></p>
<p>安装即可使用：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd082debe8634fb3a757204ec8df7116~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=iUfQCZTIqvwd6o1LBAaLzITKb7c%3D" alt="image-20260210125814619.png" loading="lazy"/></p>
<p>粘贴并让AI在这个基础上进行编写</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f05e9c685b6047dda497b388bc0c6d59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=cj8AVbwaovi%2BUaFKBb97AqmZ0GM%3D" alt="image-20260210125926527.png" loading="lazy"/></p>
<h3 data-id="heading-24">RooCode使用方法</h3>
<p>配置API密钥：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa0c5f277e7a4a1bb92ebc6d52ee58bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=7nfCiFMJXkSu1T90VgGHS%2BuDIP8%3D" alt="image-20260210131956551.png" loading="lazy"/></p>
<p>角色用法：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b2747b18fab4df0bfcb7748f5c9f5ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=rkuFIcg1O4lnUptbKWzle2kDiYo%3D" alt="image-20260210130135061.png" loading="lazy"/></p>
<p>编写后自动执行，结果爆破成功：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f7e95ad4c9d42cca8c3b3538e852e5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=EAdlkofiKA3%2BcylhHPYyeoJja5c%3D" alt="image-20260210132158377.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87f4aea94c6940c18ff18287a8acc3df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3OTMxMzU2MDAyNzQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771306433&amp;x-signature=qDaB%2F%2BAyqdvJa6c83QPtK%2FFBZ9c%3D" alt="image-20260210132246435.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙多线程 taskpool 的简单使用]]></title>    <link>https://juejin.cn/post/7604671453453451279</link>    <guid>https://juejin.cn/post/7604671453453451279</guid>    <pubDate>2026-02-10T01:27:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604671453453451279" data-draft-id="7604685644684623924" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙多线程 taskpool 的简单使用"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2026-02-10T01:27:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xym"/> <meta itemprop="url" content="https://juejin.cn/user/1662117313789751"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙多线程 taskpool 的简单使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1662117313789751/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xym
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:27:22.000Z" title="Tue Feb 10 2026 01:27:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p> 
鸿蒙线程间并发，数据通信的方式采用的是消息通信模式;在 java 中采用的是内存共享模式；这是两者线程间并发的主要区别；</p>
<p>鸿蒙解释文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides%2Fmulti-thread-concurrency-overview" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/multi-thread-concurrency-overview" ref="nofollow noopener noreferrer">文档中心</a></p>
<h3 data-id="heading-0">1.多线程 taskpool 的创建和使用</h3>
<p>          首先定义一个 function 方法，并在方式上添加@Concurrent注解；这个地方注意function方法创建是在在 struct 外部定义的；代码如下</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserModel</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">string</span>

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age
  }


  <span class="hljs-title function_">printUserInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'当前 用户的信息是 name '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> + <span class="hljs-string">" age "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>)
  }
}
</code></pre>

<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Concurrent</span>
function <span class="hljs-title function_">showInfo</span><span class="hljs-params">(info: UserModel)</span> {
<span class="hljs-comment">//方法里面就是执行的子线程代码</span>
<span class="hljs-keyword">return</span> <span class="hljs-string">''</span><span class="hljs-comment">//返回子线程执行的结果值</span>
}
</code></pre>
<p>            开启子线程通过 taskpool ;开启方式有几种方式，一种是通过创建 task,一种是将 task 放到 taskGroup 中，一种是通过taskpool 直接执行；代码如下：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">第一种方式：
<span class="hljs-keyword">let</span> info = <span class="hljs-built_in">new</span> UserModel(<span class="hljs-comment">'小明', '20')</span>
<span class="hljs-keyword">let</span> task = <span class="hljs-built_in">new</span> taskpool.Task(showInfo, info)
taskpool.execute(task).<span class="hljs-keyword">catch</span>(() =&gt; {})

第二种方式：
<span class="hljs-keyword">let</span> <span class="hljs-keyword">group</span> = <span class="hljs-built_in">new</span> taskpool.TaskGroup()
<span class="hljs-keyword">try</span> {
   <span class="hljs-keyword">group</span>.addTask(task)
    //  <span class="hljs-keyword">group</span>.addTask(showInfo, info)//或者通过 <span class="hljs-keyword">group</span>添加方法
} <span class="hljs-keyword">catch</span> (<span class="hljs-keyword">error</span>) {}
taskpool.execute(<span class="hljs-keyword">group</span>).<span class="hljs-keyword">catch</span>(() =&gt; {})

第三种方案
taskpool.execute(showInfo，info).<span class="hljs-keyword">catch</span>(() =&gt; { })
</code></pre>
<p>    通过上述简单步骤就开启了子线程；</p>
<h3 data-id="heading-1">2.taskpool 传递数据；</h3>
<p>宿主线程和子线程之间传递数据，在宿主线程调用方法时直接将参数传递即可，宿主线程获取子线程数据，通过返回值获取即可；代码如下；</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//调用方法showInfo，传递，这个时候在子线程就能获取到数据</span>
<span class="hljs-keyword">let</span> info = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserModel</span>(<span class="hljs-string">'小明'</span>, <span class="hljs-string">'20'</span>)
taskpool.<span class="hljs-title function_">execute</span>(showInfo, info)

<span class="hljs-comment">//在宿主线程获取到数据</span>
  taskpool.<span class="hljs-title function_">execute</span>(showInfo, info).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {}).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
                <span class="hljs-comment">//在 then 中就可以获取到子线程返回的数据</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'--------- &gt; taskpool  then .. '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result))
          })

<span class="hljs-comment">//另一种方式 借助await+async 通过等待的方式获取到子线程返回的结果；</span>
<span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> taskpool.<span class="hljs-title function_">execute</span>(showInfo, info).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {})
</code></pre>
<p>结果如下：</p>
<pre><code class="hljs language-json" lang="json">--------- &gt; taskpool  then ..<span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"小明"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"age"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"20"</span><span class="hljs-punctuation">}</span>
</code></pre>
<p>    虽然能够实现宿主线程和子线程之间的数据传递，但是验证会发现宿主线程的对象和主线程的对象并不是同一个；原因：鸿蒙的线程并发采用的是消息通信并发模式；每一个线程都有独立的内存空间；在传递值的时候采用了将 创建对象-&gt;数据序列化-&gt;反序列化 赋值的操作；也就是在子线程中的对象是新的；同时无法调用类实例中的自定义方法；</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/283dbfbc5b46457f86e6e6f88f66ff38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeHlt:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297515&amp;x-signature=mu6%2BwLQvxUGexdFBJBfhjgWO%2B04%3D" alt="image.png" loading="lazy"/></p>
<p>    鸿蒙官网描述：Actor模型中，不同角色之间并不共享内存，生产者线程和UI线程都有自己的虚拟机实例，两个虚拟机实例之间拥有独占的内存，相互隔离。生产者生产出结果后，通过序列化通信将结果发送给UI线程。UI线程消费结果后，再发送新的生产任务给生产者线程。（<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides%2Fmulti-thread-concurrency-overview" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/multi-thread-concurrency-overview" ref="nofollow noopener noreferrer">文档中心</a>）</p>
<p>验证方式通过打印 hashcode值，进行分辨</p>
<pre><code class="hljs language-scss" lang="scss">util<span class="hljs-selector-class">.getHash</span>(info)<span class="hljs-selector-class">.toString</span>()
</code></pre>
<p>验证代码如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> info = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserModel</span>(<span class="hljs-string">'小明'</span>, <span class="hljs-string">'20'</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`--------- &gt; taskpool 宿主线程 hash <span class="hljs-subst">${util.getHash(info)
  .toString()}</span> ... <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(info)}</span>`</span>)
taskpool.<span class="hljs-title function_">execute</span>(userinfo,info).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {}).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>)=&gt;</span>{
  <span class="hljs-keyword">if</span> (result) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`--------- &gt; taskpool 宿主线程  hash <span class="hljs-subst">${util.getHash(result)
      .toString()}</span> ... <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(result)}</span>`</span>)
    }
})


<span class="hljs-comment">//子线程方法</span>
@<span class="hljs-title class_">Concurrent</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">userinfo</span>(<span class="hljs-params">info:  UserModel</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`--------- &gt; taskpool 子线程 hash <span class="hljs-subst">${util.getHash(info)
    .toString()}</span> ... <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(info)}</span>`</span>) <span class="hljs-comment">//  1218349983</span>
  info.<span class="hljs-property">name</span> = <span class="hljs-string">'大明'</span>
  <span class="hljs-keyword">return</span> info
}
</code></pre>
<p>打印结果：</p>
<pre><code class="hljs language-bash" lang="bash">--------- &gt; taskpool 宿主线程 <span class="hljs-built_in">hash</span> 126564622 ... {<span class="hljs-string">"name"</span>:<span class="hljs-string">"小明"</span>,<span class="hljs-string">"age"</span>:<span class="hljs-string">"20"</span>}
--------- &gt; taskpool 子线程 <span class="hljs-built_in">hash</span> 1181217180 ... {<span class="hljs-string">"name"</span>:<span class="hljs-string">"小明"</span>,<span class="hljs-string">"age"</span>:<span class="hljs-string">"20"</span>}
--------- &gt; taskpool 宿主线程  <span class="hljs-built_in">hash</span> 1015499472 ... {<span class="hljs-string">"name"</span>:<span class="hljs-string">"大明"</span>,<span class="hljs-string">"age"</span>:<span class="hljs-string">"20"</span>}
</code></pre>
<h3 data-id="heading-2">3.taskpool 实现数据的共享，以及满足类方法 可使用；</h3>
<p>    为了避免在类实例中创建的方法<strong>不可用</strong>，以及将对象传递到子线程中经过序列化过程（因此如果大量数据在经过序列化和反序列化是很耗费性能的）；可以借助@Sendable注解，进行避免。在引入该注解后，就从传递序列化数据变成了传递指针地址；定义类如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Sendable</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age
  }
  <span class="hljs-title function_">getNameInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`名字 .... <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>
  }
}
</code></pre>
<p> 在验证时注意：如果传递的UserInfo 如果没有加@Sendable 时；如果调用的getNameInfo方法，在调用点添加 try catch，避免找不到问题原因；</p>
<h3 data-id="heading-3">4.taskpool 子线程中使用单例；</h3>
<p>    那么在子线程和宿主线程中使用单例模式，能保证单例对象的唯一性吗？</p>
<p>不能；原因还是鸿蒙的多线程并发属于消息通信并发模式；每个线程会有自己的内存空间；</p>
<p>单例在子线程调用的时候，会再次创建一个对象实例；验证代码如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//验证用户单例在线程中的使用</span>
@<span class="hljs-title class_">Concurrent</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">userSingleton</span>(<span class="hljs-params">info: UserInfo</span>) {

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`--------- &gt; taskpool 单例信息  <span class="hljs-subst">${util.getHash(info)
    .toString()}</span> ... <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(info)}</span>`</span>) 

  <span class="hljs-comment">//调用新的实例</span>
  <span class="hljs-keyword">let</span> newInfo = userInfo
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`--------- &gt; taskpool 单例信息  <span class="hljs-subst">${util.getHash(newInfo)
    .toString()}</span>  ... info <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(newInfo)}</span>}`</span>) 
  }
</code></pre>
<p>结果：(验证发现，在子线程中调用单例，会重新创建一个新的实例)</p>
<pre><code class="hljs language-json" lang="json"> --------- &gt; taskpool 单例信息  <span class="hljs-number">1037896672</span> ... <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"小明"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"age"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"20"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"money"</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lock"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
 --------- &gt; taskpool 单例信息  <span class="hljs-number">740780191</span>  ... info <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"age"</span><span class="hljs-punctuation">:</span><span class="hljs-string">""</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"money"</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lock"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
</code></pre>
<p> 单例代码：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Sendable</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">UserInfo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfo</span>()

  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">UserInfo</span>.<span class="hljs-property">instance</span>
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">userInfo</span>: <span class="hljs-title class_">UserInfo</span> = <span class="hljs-title class_">UserInfo</span>.<span class="hljs-title function_">getInstance</span>()
</code></pre>
<p>    那么如何保证多线程条件下，内存的持有的对象是唯一的呢？其实就是在类上方添加如下字符串 "use shared"；代码如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-string">"use shared"</span><span class="hljs-comment">//就这个</span>
<span class="hljs-meta">@Sendable</span>
export <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span> {
}
</code></pre>
<p>添加后的结果日志：</p>
<pre><code class="hljs language-json" lang="json">--------- &gt; taskpool 单例信息  <span class="hljs-number">1198219253</span> ... <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"小明"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"age"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"20"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"money"</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lock"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
--------- &gt; taskpool 单例信息  <span class="hljs-number">1198219253</span>  ... info <span class="hljs-punctuation">{</span><span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"小明"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"age"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"20"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"money"</span><span class="hljs-punctuation">:</span><span class="hljs-number">0</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"lock"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
</code></pre>
<p>    再次通过方法验证就会发现 hashcode 是一致的了；那么既然这么共享内存了，就涉及到另一个问题；就是如何保证内存中数据的安全性，避免多线程并发出现脏数据呢？</p>
<p>    其实就是通过锁来避免的，ArkTSUtils.locks.AsyncLock；简易代码如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-string">"use shared"</span>
<span class="hljs-meta">@Sendable</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>
  <span class="hljs-attr">age</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>
  <span class="hljs-attr">money</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>
  <span class="hljs-comment">//添加异步锁</span>
  <span class="hljs-attr">lock</span>: <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLock</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">AsyncLock</span>()
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">UserInfo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfo</span>()

  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">UserInfo</span>.<span class="hljs-property">instance</span>
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
  }

  <span class="hljs-title function_">getNameInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`名字 .... <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>
  }

  <span class="hljs-title function_">addMoney</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lock</span>.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">money</span>++
    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {
    })
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">userInfo</span>: <span class="hljs-title class_">UserInfo</span> = <span class="hljs-title class_">UserInfo</span>.<span class="hljs-title function_">getInstance</span>()
</code></pre>
<p>验证代码如下：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//验证多个线程执行累加任务。是否存在脏数据</span>
<span class="hljs-keyword">@Concurrent</span>
function asyncAdd(<span class="hljs-attribute">info</span>: UserInfo) {
  info<span class="hljs-selector-class">.addMoney</span>()
  return userInfo<span class="hljs-selector-class">.money</span>
}

<span class="hljs-comment">//在点击的时候触发</span>
  for (let i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
    taskpool<span class="hljs-selector-class">.execute</span>(asyncAdd, userInfo)<span class="hljs-selector-class">.catch</span>(() =&gt; {
 })
 }
 <span class="hljs-built_in">setTimeout</span>(() =&gt; {
  console<span class="hljs-selector-class">.log</span>('--------- &gt; taskpool time ' + userInfo.money)
 }, <span class="hljs-number">1000</span>)
</code></pre>
<p>结果：</p>
<pre><code class="hljs language-css" lang="css">--------- &gt; taskpool <span class="hljs-selector-tag">time</span> <span class="hljs-number">1000</span>
</code></pre>
<h3 data-id="heading-4">5.taskpool 传递容器数据；</h3>
<p>    其实线程并发传递容器，分为非 collections下的容器，和 collections.下的容器；其中在 collections 下的容器支持地址传递；也就是在子线程更新容器的值，在主线程同样能够相应；验证代码如下：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//传递普通的容器</span>
<span class="hljs-meta">@Concurrent</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">transmitArray</span>(<span class="hljs-params">arr: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;</span>) {
  <span class="hljs-comment">//传递过来的值</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'--------- &gt; taskpool '</span> + arr.<span class="hljs-title function_">toString</span>())
  arr.<span class="hljs-title function_">push</span>(<span class="hljs-number">10</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'--------- &gt; taskpool push '</span> + arr.<span class="hljs-title function_">toString</span>())
  <span class="hljs-keyword">return</span> arr
}

<span class="hljs-comment">//collections 容器</span>
<span class="hljs-meta">@Concurrent</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">transmitArrays</span>(<span class="hljs-params">arr: collections.<span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;</span>) {
  <span class="hljs-comment">//传递过来的值</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'--------- &gt; taskpool '</span> + arr)
  <span class="hljs-keyword">try</span> {
    arr.<span class="hljs-title function_">push</span>(<span class="hljs-number">10</span>)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'--------- &gt; taskpool arr '</span> + arr)
  } <span class="hljs-keyword">catch</span> (error) {}
  <span class="hljs-keyword">return</span> arr
}
</code></pre>
<p>调用代码：</p>
<pre><code class="hljs language-typescript" lang="typescript">
 <span class="hljs-comment">//采用Array进行传递</span>
<span class="hljs-keyword">let</span> arr = <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
 taskpool.<span class="hljs-title function_">execute</span>(transmitArray, arr).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {
 }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
   <span class="hljs-comment">//结论：使用 array 进行数据传递。在子线程中，对数据改变后，并无法改变主线程中的数据</span>
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'--------- &gt; taskpool arr '</span> + arr + <span class="hljs-string">" result "</span> + result)
 })


 <span class="hljs-comment">//采用collections.Array进行参数传递</span>
 <span class="hljs-keyword">let</span> arr = <span class="hljs-keyword">new</span> collections.<span class="hljs-property">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>)
 taskpool.<span class="hljs-title function_">execute</span>(transmitArrays, arr).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {
 }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
   <span class="hljs-comment">//使用collections 下的集合，在更改值后，对应的主线程的集合也会改变</span>
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'--------- &gt; taskpool arr '</span> + arr + <span class="hljs-string">" result "</span> + result)
 })
</code></pre>
<p>结果：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">Array</span>集合执行结果
<span class="hljs-comment">--------- &gt; taskpool 0,1,2,3,4,5</span>
<span class="hljs-comment">--------- &gt; taskpool push 0,1,2,3,4,5,10</span>
<span class="hljs-comment">--------- &gt; taskpool arr 0,1,2,3,4,5 result 0,1,2,3,4,5,10</span>

collections.Array执行结果
<span class="hljs-comment">--------- &gt; taskpool 0,1,2,3,4,5</span>
<span class="hljs-comment">--------- &gt; taskpool push 0,1,2,3,4,5,10</span>
<span class="hljs-comment">--------- &gt; taskpool arr 0,1,2,3,4,5,10 result 0,1,2,3,4,5,10</span>
</code></pre>
<p>结论：通过Array 作为参数传递。容器在子线程更改数据后，在宿主线程的容器值并不会改变；通过collections.Array进行传递，宿主线程 的容器会跟随子线程改变而改变；</p>
<h5 data-id="heading-5">6.taskpool 实现依赖执行</h5>
<p>    如果子线程之间需要项目依赖执行，taskpool 也支持现场之间的依赖关系，注意 ：添加依赖关系之后，可能出现死锁情况，一定要注意线程的执行顺序；代码如下</p>
<pre><code class="hljs language-javascript" lang="javascript">  <span class="hljs-keyword">let</span> task = <span class="hljs-keyword">new</span> taskpool.<span class="hljs-title class_">Task</span>(showInfo, info)
  <span class="hljs-keyword">let</span> task2 = <span class="hljs-keyword">new</span> taskpool.<span class="hljs-title class_">Task</span>(update, info)
  task2.<span class="hljs-title function_">addDependency</span>(task)
  taskpool.<span class="hljs-title function_">execute</span>(task).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {}).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {})
  taskpool.<span class="hljs-title function_">execute</span>(task2).<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {}).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {}
</code></pre>
<p>如果有问题，各位大佬欢迎指正；</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java多线程神器——ThreadForge ，让多线程从此简单]]></title>    <link>https://juejin.cn/post/7604779604126138368</link>    <guid>https://juejin.cn/post/7604779604126138368</guid>    <pubDate>2026-02-10T07:45:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604779604126138368" data-draft-id="7604715051462770703" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java多线程神器——ThreadForge ，让多线程从此简单"/> <meta itemprop="keywords" content="后端,Java,性能优化"/> <meta itemprop="datePublished" content="2026-02-10T07:45:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一只叫煤球的猫"/> <meta itemprop="url" content="https://juejin.cn/user/1732486058745054"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java多线程神器——ThreadForge ，让多线程从此简单
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1732486058745054/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一只叫煤球的猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T07:45:35.000Z" title="Tue Feb 10 2026 07:45:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">别再让多线程代码折磨自己了</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ba00f11caf64fdd9352d2290d364660~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5Y-q5Y-r54Wk55CD55qE54yr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771314339&amp;x-signature=lbyXXfr3HBQtditFsp3Ge1KzxT8%3D" alt="jimeng-2026-02-10-3757-「ThreadForge」 这是我新开发的开源项目，帮我做一个logo。Java....png" loading="lazy"/></p>
<h3 data-id="heading-1">从场景切入</h3>
<p>产品说：「用户详情页太慢了，能不能优化一下？」</p>
<p>你一看代码，三个接口串行调用：先查用户信息，再查订单列表，最后查积分余额。每个接口 200ms，加起来 600ms。</p>
<p>「简单，改成并发调用就行。」你心想。</p>
<p>于是你创建了一个线程池，用 <code>Future</code> 提交了三个任务。</p>
<p>写完提测，QA 说偶尔会超时。</p>
<p>你加了个 <code>future.get(500, MILLISECONDS)</code>。</p>
<p>又过了几天，测试环境出现了线程泄漏，你赶紧补了个 <code>finally { executor.shutdown() }</code>。</p>
<p>上线前，tech lead 问：「如果用户服务挂了，另外两个任务会取消吗？」你愣了一下，又加了一堆 cancel 逻辑和异常处理。</p>
<p><strong>这时候你发现，一个简单的「并发调用三个接口」，代码已经写了 50 多行。</strong></p>
<p>并且下次遇到类似场景，还得把这些逻辑再写一遍：超时、取消、异常传播、资源清理……每次都要重新思考一遍边界条件。</p>
<p>传统的 <code>ExecutorService</code>、<code>Future</code>、<code>CompletableFuture</code> 确实非常强大，但也足够啰嗦：</p>
<ul>
<li>线程池要手动创建和关闭</li>
<li>超时逻辑每个任务都要写一遍</li>
<li>失败了要不要取消其他任务？得自己判断</li>
<li>异常怎么传播？要么吞掉，要么手动包装</li>
<li>想知道任务跑了多久？自己打日志</li>
</ul>
<p>某一天，我猛然惊醒：<strong>写并发代码，不应该这么费脑子。</strong></p>
<h3 data-id="heading-2">ThreadForge：把复杂度收敛到一个可推理的模型里</h3>
<p>ThreadForge 的设计哲学很简单：<strong>先降低认知成本，再追求性能。</strong></p>
<p>可以把它理解成一个<strong>结构化并发框架</strong>——让你用写同步代码的思维写并发代码，同时自动处理那些容易遗漏的边界情况。</p>
<p>也可以把它理解成对于 Java 内置并发工具的二次包装，目标是让Java并发更简单、更清晰。</p>
<h4 data-id="heading-3">什么是结构化？</h4>
<p>看一个最简单的例子：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> (<span class="hljs-type">ThreadScope</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> ThreadScope.open()) {
    Task&lt;String&gt; user = scope.submit(<span class="hljs-string">"load-user"</span>, () -&gt; fetchUser());
    Task&lt;Integer&gt; orders = scope.submit(<span class="hljs-string">"load-orders"</span>, () -&gt; fetchOrders());
    
    scope.await(user, orders);
    
    <span class="hljs-comment">// 到这里,两个任务肯定都结束了（成功、失败或超时）</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> user.await() + <span class="hljs-string">":"</span> + orders.await();
}
<span class="hljs-comment">// scope 关闭时,所有任务自动取消、资源自动清理</span>
</code></pre>
<p>这段代码有几个关键点：</p>
<ol>
<li><strong>所有任务都绑定在 <code>ThreadScope</code> 内</strong>，生命周期有边界，不会泄漏</li>
<li><strong>默认就是安全的</strong>：默认超时、默认失败传播、自动取消</li>
<li><strong>代码结构就是任务关系</strong>：读代码的人一眼就能看出两个任务是并发的，且必须都完成才能继续</li>
</ol>
<p>对比传统写法，你需要：</p>
<ul>
<li>创建线程池，配置核心线程数、队列大小</li>
<li>提交任务，手动处理 Future</li>
<li>写 try-finally 确保 shutdown</li>
<li>手动处理超时和异常传播</li>
</ul>
<p><strong>ThreadForge 让你省掉这些重复劳动，专注业务逻辑。</strong></p>
<h3 data-id="heading-4">五个让你省脑力的设计</h3>
<h4 data-id="heading-5">1. 默认行为就是正确的</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 默认:FAIL_FAST + 30秒超时 + 自动取消其他任务</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">ThreadScope</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> ThreadScope.open()) {
    Task&lt;Integer&gt; a = scope.submit(() -&gt; riskyRpc());
    Task&lt;Integer&gt; b = scope.submit(() -&gt; anotherRpc());
    scope.await(a, b);
} <span class="hljs-keyword">catch</span> (ScopeTimeoutException timeout) {
    <span class="hljs-comment">// 超时了,所有任务已被自动取消</span>
    fallback();
} <span class="hljs-keyword">catch</span> (FailurePropagationException failed) {
    <span class="hljs-comment">// 某个任务失败了,其他任务已被自动取消</span>
    handleError(failed);
}
</code></pre>
<p>不需要配置，不需要思考，开箱即用。</p>
<h4 data-id="heading-6">2. 失败策略明确且统一</h4>
<p>不同场景对失败的容忍度不同，ThreadForge 提供了 5 种明确的策略：</p>
<ul>
<li><code>FAIL_FAST</code>：快速失败，立即取消其他任务（默认）</li>
<li><code>COLLECT_ALL</code>：等所有任务结束，汇总所有失败</li>
<li><code>SUPERVISOR</code>：不自动取消，失败信息收集到 <code>Outcome</code></li>
<li><code>CANCEL_OTHERS</code>：失败后取消其余任务，但不抛异常</li>
<li><code>IGNORE_ALL</code>：忽略失败，只返回成功的结果</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 场景:批量导入,即使部分失败也要知道哪些成功了</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">ThreadScope</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> ThreadScope.open()
        .withFailurePolicy(FailurePolicy.SUPERVISOR)) {
    
    List&lt;Task&lt;Void&gt;&gt; tasks = ids.stream()
        .map(id -&gt; scope.submit(() -&gt; importData(id)))
        .collect(toList());
    
    <span class="hljs-type">Outcome</span> <span class="hljs-variable">outcome</span> <span class="hljs-operator">=</span> scope.await(tasks);
    
    <span class="hljs-comment">// 明确知道哪些成功、哪些失败</span>
    log.info(<span class="hljs-string">"成功: {}, 失败: {}"</span>, 
        outcome.successCount(), outcome.failureCount());
}
</code></pre>
<h4 data-id="heading-7">3. 并发度控制不再需要手动管理队列</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 场景:调用外部 API,最多同时50个请求</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">ThreadScope</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> ThreadScope.open()
        .withConcurrencyLimit(<span class="hljs-number">50</span>)) {
    
    List&lt;Task&lt;Result&gt;&gt; tasks = hugeIdList.stream()
        .map(id -&gt; scope.submit(() -&gt; externalApi.call(id)))
        .collect(toList());
    
    List&lt;Result&gt; results = scope.awaitAll(tasks);
}
<span class="hljs-comment">// 自动限流,不会把外部服务打爆</span>
</code></pre>
<p>不需要自己写信号量，不需要手动分批，框架自动处理。</p>
<h4 data-id="heading-8">4. 生命周期观测统一收口</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ThreadScope</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> ThreadScope.open()
    .withHook(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadHook</span>() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onStart</span><span class="hljs-params">(TaskInfo info)</span> {
            metrics.taskStarted(info.name());
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onSuccess</span><span class="hljs-params">(TaskInfo info, Duration duration)</span> {
            metrics.taskSuccess(info.name(), duration.toMillis());
        }
        
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">(TaskInfo info, Throwable error, Duration duration)</span> {
            log.error(<span class="hljs-string">"Task {} failed after {}"</span>, info.name(), duration, error);
            metrics.taskFailed(info.name());
        }
    });
</code></pre>
<p><strong>一处埋点，全局生效。</strong></p>
<p>不需要在每个任务里重复写日志和监控代码。</p>
<h4 data-id="heading-9">5. 跨 JDK 版本的一致体验</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 同一套 API</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">ThreadScope</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> ThreadScope.open()) {
    <span class="hljs-comment">// JDK 21+: 自动使用虚拟线程</span>
    <span class="hljs-comment">// JDK 8-20: 自动降级到线程池</span>
    Task&lt;String&gt; task = scope.submit(() -&gt; longRunningTask());
    <span class="hljs-keyword">return</span> task.await();
}
</code></pre>
<p>不需要分叉代码，不需要写 <code>if-else</code>，框架自动适配。</p>
<h3 data-id="heading-10">适用场景</h3>
<p>ThreadForge 特别适合这些场景：</p>
<p><strong>并发 RPC 聚合</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> (<span class="hljs-type">ThreadScope</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> ThreadScope.open()) {
    Task&lt;User&gt; user = scope.submit(() -&gt; userService.get(uid));
    Task&lt;List&lt;Order&gt;&gt; orders = scope.submit(() -&gt; orderService.list(uid));
    Task&lt;Profile&gt; profile = scope.submit(() -&gt; profileService.get(uid));
    
    scope.await(user, orders, profile);
    
    <span class="hljs-keyword">return</span> buildResponse(user.await(), orders.await(), profile.await());
}
</code></pre>
<p><strong>批量数据处理</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> (<span class="hljs-type">ThreadScope</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> ThreadScope.open()
        .withConcurrencyLimit(<span class="hljs-number">100</span>)
        .withDeadline(Duration.ofMinutes(<span class="hljs-number">5</span>))) {
    
    List&lt;Task&lt;Void&gt;&gt; tasks = records.stream()
        .map(r -&gt; scope.submit(() -&gt; process(r)))
        .collect(toList());
    
    scope.awaitAll(tasks);
}
</code></pre>
<p><strong>生产者-消费者模式</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> (<span class="hljs-type">ThreadScope</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> ThreadScope.open()) {
    Channel&lt;Data&gt; channel = Channel.bounded(<span class="hljs-number">1000</span>);
    
    scope.submit(() -&gt; {
        <span class="hljs-keyword">for</span> (Data d : datasource) {
            channel.send(d);
        }
        channel.close();
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    });
    
    List&lt;Task&lt;Void&gt;&gt; consumers = IntStream.range(<span class="hljs-number">0</span>, <span class="hljs-number">4</span>)
        .mapToObj(i -&gt; scope.submit(() -&gt; {
            <span class="hljs-keyword">for</span> (Data d : channel) {
                process(d);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }))
        .collect(toList());
    
    scope.awaitAll(consumers);
}
</code></pre>
<h3 data-id="heading-11">开始使用</h3>
<p><strong>Maven:</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>pub.lighting<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>threadforge-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>Gradle:</strong></p>
<pre><code class="hljs language-gradle" lang="gradle">implementation("pub.lighting:threadforge-core:1.0.1")
</code></pre>
<p><strong>最小示例:</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> (<span class="hljs-type">ThreadScope</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> ThreadScope.open()) {
    Task&lt;String&gt; task = scope.submit(() -&gt; <span class="hljs-string">"Hello, ThreadForge"</span>);
    System.out.println(task.await());
}
</code></pre>
<h3 data-id="heading-12">写在最后</h3>
<p>ThreadForge 的目标不是取代所有并发工具，而是让 80% 的常见场景变得简单、安全、可维护。</p>
<p>当你还在调试并发问题时，当新人看不懂老代码里的线程逻辑时，当你想加个超时却不知道从哪儿改起时——不妨试试 ThreadForge。</p>
<p><strong>让并发回归简单，让代码重新可读。</strong></p>
<hr/>
<p>📦 GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FwuuJiawei%2FThreadForge" target="_blank" title="https://github.com/wuuJiawei/ThreadForge" ref="nofollow noopener noreferrer">github.com/wuuJiawei/T…</a><br/>
📖 文档: 见项目 <code>docs/api/README.md</code><br/>
📄 License: MIT</p>
<p>欢迎 Star、提 Issue、贡献代码。如果 ThreadForge 帮你省了时间，也欢迎分享给更多人。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL的10种高级SQL，性能起飞]]></title>    <link>https://juejin.cn/post/7604493165329203234</link>    <guid>https://juejin.cn/post/7604493165329203234</guid>    <pubDate>2026-02-10T02:10:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604493165329203234" data-draft-id="7604685644685017140" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL的10种高级SQL，性能起飞"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-10T02:10:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三说技术"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL的10种高级SQL，性能起飞
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三说技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T02:10:56.000Z" title="Tue Feb 10 2026 02:10:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    63
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>很多小伙伴在工作中，可能只把MySQL当作一个简单的“数据存储箱”，用了它80%的基础功能，却不知道它还有另外20%的、能解决90%复杂问题的“高级用法”。</p>
<p>今天，我不谈基础的增删改查，就和你深入聊聊，在实际高性能、高并发、大数据量的场景下，那些真正能让你和团队生产力倍增、性能飞升的10种MySQL高级实战技巧。</p>
<p>希望对你会有所帮助。</p>
<h2 data-id="heading-1">01 执行计划</h2>
<p>在优化任何查询之前，<strong>读懂<code>EXPLAIN</code>的输出是你的第一门必修课</strong>。</p>
<p>它就像SQL的“X光片”，能告诉你MySQL究竟打算如何执行你的查询，瓶颈在哪里。</p>
<h3 data-id="heading-2">核心用法与实战</h3>
<p>执行<code>EXPLAIN</code>后，你需要重点关注以下几个关键字段：</p>
<ul>
<li><strong>type</strong>：访问类型，从最优到最差大致是：<code>system</code> &gt; <code>const</code> &gt; <code>eq_ref</code> &gt; <code>ref</code> &gt; <code>range</code> &gt; <code>index</code> &gt; <code>ALL</code>。看到<code>ALL</code>（全表扫描）就要警惕了。</li>
<li><strong>key</strong>：实际使用的索引。如果为<code>NULL</code>，说明没用上索引。</li>
<li><strong>rows</strong>：MySQL预估要扫描的行数。这个数字越接近实际需要的数据行数越好。</li>
<li><strong>Extra</strong>：包含非常丰富的信息，例如<code>Using filesort</code>（需要额外排序）、<code>Using temporary</code>（使用了临时表），这通常是性能杀手。</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 一个需要优化的查询示例</span>
EXPLAIN 
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders 
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">10086</span> 
  <span class="hljs-keyword">AND</span> create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2024-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2024-01-31'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> amount <span class="hljs-keyword">DESC</span>;
</code></pre>
<p>假设这个查询的<code>type</code>是<code>ALL</code>，<code>key</code>是<code>NULL</code>。这意味着它在<code>orders</code>表上进行了全表扫描，性能极差。优化方法通常是创建一个复合索引：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建覆盖了WHERE和ORDER BY的复合索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_user_time_amount <span class="hljs-keyword">ON</span> orders(user_id, create_time, amount);
<span class="hljs-comment">-- 再次使用EXPLAIN，你会看到type变成了range，key显示了新索引，性能天差地别。</span>
</code></pre>
<p><strong>深度剖析</strong>：<code>EXPLAIN</code>是基于表的统计信息来估算成本的。如果表数据变化很大而统计信息未更新，优化器可能会选错索引。</p>
<p>这时，可以用<code>ANALYZE TABLE table_name;</code>来手动更新统计信息。</p>
<p>有些小伙伴在工作中写的SQL本身不复杂，但执行很慢，第一步就应该祭出<code>EXPLAIN</code>。</p>
<h2 data-id="heading-3">02 高级索引策略</h2>
<p>索引是性能的基石，但错误的索引比没有索引更糟糕。</p>
<h3 data-id="heading-4">高级索引策略</h3>
<ol>
<li><strong>覆盖索引（Covering Index）</strong>：如果索引包含了查询需要的所有字段，引擎就无需回表查询数据行，速度极快。</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 假设常用查询是获取用户的姓名和邮箱</span>
<span class="hljs-keyword">SELECT</span> name, email <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">20</span>;
<span class="hljs-comment">-- 为这个查询设计覆盖索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_age_name_email <span class="hljs-keyword">ON</span> users(age, name, email);
<span class="hljs-comment">-- age用于查询，name和email本身就在索引页中，无需查找数据行。</span>
</code></pre>
<ol start="2">
<li>
<p><strong>索引下推（Index Condition Pushdown， ICP）</strong>：这是MySQL 5.6引入的重大优化。对于复合索引<code>(a, b)</code>，查询<code>WHERE a = ? AND b LIKE ‘%xxx’</code>。在旧版本中，即使<code>a</code>命中了索引，引擎也会将所有<code>a=?</code>的记录回表，再去过滤<code>b</code>。而ICP允许将<code>b LIKE ‘%xxx’</code>这个条件下推到存储引擎层，在索引扫描时就过滤，大大减少回表次数。</p>
</li>
<li>
<p><strong>前缀索引（Prefix Index）</strong>：对于超长文本字段（如<code>VARCHAR(500)</code>），为整个字段建索引非常臃肿。可以只对前N个字符建立索引，在空间和效率间取得平衡。</p>
</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 为content字段前100个字符创建索引</span>
<span class="hljs-keyword">CREATE</span> INDEX idx_content_prefix <span class="hljs-keyword">ON</span> articles (content(<span class="hljs-number">100</span>));
<span class="hljs-comment">-- 缺点是前缀索引无法用于GROUP BY和ORDER BY操作。</span>
</code></pre>
<p><strong>深度剖析</strong>：索引是一把双刃剑，加速查询的同时，会降低写操作（INSERT/UPDATE/DELETE）的速度，因为索引树也需要维护。</p>
<p>一个表上创建十几个索引是常见的设计误区。</p>
<p>你需要定期使用<code>SHOW INDEX FROM table_name;</code>审查索引的基数（Cardinality，唯一值数量），删除使用率极低的冗余索引。</p>
<h2 data-id="heading-5">03 窗口函数</h2>
<p>这是MySQL 8.0带来的“神兵利器”，用于进行<strong>跨行计算</strong>，完美解决复杂排名、累加、移动平均等问题。</p>
<h3 data-id="heading-6">核心场景与语法</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 经典场景：计算每个部门内员工的薪水排名</span>
<span class="hljs-keyword">SELECT</span> 
    name,
    department,
    salary,
    <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">as</span> dept_salary_rank,
    <span class="hljs-comment">-- 同时计算公司整体排名</span>
    <span class="hljs-built_in">RANK</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> salary <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">as</span> company_rank,
    <span class="hljs-comment">-- 计算部门内薪水累计占比</span>
    <span class="hljs-built_in">SUM</span>(salary) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department) <span class="hljs-keyword">as</span> dept_total,
    salary <span class="hljs-operator">/</span> <span class="hljs-built_in">SUM</span>(salary) <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> department) <span class="hljs-keyword">as</span> salary_ratio
<span class="hljs-keyword">FROM</span> employees;
</code></pre>
<p><code>PARTITION BY</code>类似于<code>GROUP BY</code>，但不会将行合并，而是定义窗口范围。</p>
<p><code>ORDER BY</code>决定窗口内的排序。</p>
<p><strong>深度剖析</strong>：在MySQL 8.0之前，要实现上述查询，你需要写复杂的自连接或效率极低的子查询。窗口函数在数据库内部进行了深度优化，性能提升可达几个数量级。</p>
<p>它特别适用于<strong>分析报表、实时排行榜、计算同比环比</strong>等OLAP型场景。</p>
<h2 data-id="heading-7">04 通用表表达式（CTE）</h2>
<p>CTE（WITH子句）是另一个MySQL 8.0的重要特性，它<strong>允许你定义临时的命名结果集</strong>，在后续查询中像普通表一样引用。</p>
<h3 data-id="heading-8">优势与示例</h3>
<ol>
<li><strong>提升可读性</strong>：将复杂查询分解成逻辑清晰的步骤。</li>
<li><strong>支持递归</strong>：这是CTE的杀手级功能，可以轻松查询树形或图状数据。</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 示例1：分解复杂查询（非递归）</span>
<span class="hljs-keyword">WITH</span> 
  high_value_orders <span class="hljs-keyword">AS</span> ( <span class="hljs-comment">-- 找出高价值订单</span>
    <span class="hljs-keyword">SELECT</span> user_id, <span class="hljs-built_in">SUM</span>(amount) <span class="hljs-keyword">as</span> total_spent 
    <span class="hljs-keyword">FROM</span> orders 
    <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'completed'</span>
    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id 
    <span class="hljs-keyword">HAVING</span> total_spent <span class="hljs-operator">&gt;</span> <span class="hljs-number">10000</span>
  ),
  active_users <span class="hljs-keyword">AS</span> ( <span class="hljs-comment">-- 找出活跃用户</span>
    <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> user_id 
    <span class="hljs-keyword">FROM</span> user_logs 
    <span class="hljs-keyword">WHERE</span> last_active_date <span class="hljs-operator">&gt;</span> DATE_SUB(NOW(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">30</span> <span class="hljs-keyword">DAY</span>)
  )
<span class="hljs-comment">-- 最终查询：既是高价值又是活跃的用户</span>
<span class="hljs-keyword">SELECT</span> u.name, u.email, h.total_spent
<span class="hljs-keyword">FROM</span> users u
<span class="hljs-keyword">JOIN</span> high_value_orders h <span class="hljs-keyword">ON</span> u.id <span class="hljs-operator">=</span> h.user_id
<span class="hljs-keyword">JOIN</span> active_users a <span class="hljs-keyword">ON</span> u.id <span class="hljs-operator">=</span> a.user_id;

<span class="hljs-comment">-- 示例2：递归CTE，查询部门树</span>
<span class="hljs-keyword">WITH</span> <span class="hljs-keyword">RECURSIVE</span> department_tree <span class="hljs-keyword">AS</span> (
    <span class="hljs-comment">-- 锚点：找到根部门</span>
    <span class="hljs-keyword">SELECT</span> id, name, parent_id, <span class="hljs-number">1</span> <span class="hljs-keyword">as</span> level 
    <span class="hljs-keyword">FROM</span> departments 
    <span class="hljs-keyword">WHERE</span> parent_id <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>
    <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
    <span class="hljs-comment">-- 递归成员：连接父部门和子部门</span>
    <span class="hljs-keyword">SELECT</span> d.id, d.name, d.parent_id, dt.level <span class="hljs-operator">+</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">FROM</span> departments d
    <span class="hljs-keyword">INNER</span> <span class="hljs-keyword">JOIN</span> department_tree dt <span class="hljs-keyword">ON</span> d.parent_id <span class="hljs-operator">=</span> dt.id
)
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> department_tree <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> level, id;
</code></pre>
<p><strong>深度剖析</strong>：递归CTE极大地简化了<strong>组织架构、分类目录、评论嵌套</strong>等层次数据的查询。</p>
<p>在旧版本中，这通常需要在应用层进行多次查询或在数据库中使用存储过程，递归CTE在数据库内核完成遍历，效率更高。</p>
<h2 data-id="heading-9">05 JSON类型与函数</h2>
<p>MySQL 5.7+原生支持JSON数据类型，让你能够在关系型数据库中灵活地存储和查询半结构化数据，这在处理<strong>动态字段、配置信息或第三方API返回的数据</strong>时非常有用。</p>
<h3 data-id="heading-10">核心操作</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 创建包含JSON列的表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> products (
    id <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
    attributes JSON COMMENT <span class="hljs-string">'存储颜色、尺寸等动态属性'</span>
);

<span class="hljs-comment">-- 2. 插入JSON数据</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> products <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1</span>, <span class="hljs-string">'T-Shirt'</span>, <span class="hljs-string">'{"color": "red", "size": ["M", "L"], "tags": ["casual", "cotton"]}'</span>);

<span class="hljs-comment">-- 3. 查询 (使用 -&gt; 和 -&gt;&gt; 操作符)</span>
<span class="hljs-comment">-- -&gt; 返回JSON类型， -&gt;&gt; 返回纯文本字符串</span>
<span class="hljs-keyword">SELECT</span> 
    name,
    attributes<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">'$.color'</span> <span class="hljs-keyword">as</span> color, <span class="hljs-comment">-- 提取color值</span>
    attributes<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">'$.size'</span> <span class="hljs-keyword">as</span> size_array <span class="hljs-comment">-- 提取size数组（仍为JSON）</span>
<span class="hljs-keyword">FROM</span> products 
<span class="hljs-keyword">WHERE</span> attributes<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">'$.color'</span> <span class="hljs-operator">=</span> <span class="hljs-string">'red'</span> 
   <span class="hljs-keyword">OR</span> JSON_CONTAINS(attributes<span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span><span class="hljs-string">'$.tags'</span>, <span class="hljs-string">'"cotton"'</span>);

<span class="hljs-comment">-- 4. 更新部分JSON</span>
<span class="hljs-keyword">UPDATE</span> products 
<span class="hljs-keyword">SET</span> attributes <span class="hljs-operator">=</span> JSON_SET(attributes, <span class="hljs-string">'$.color'</span>, <span class="hljs-string">'blue'</span>, <span class="hljs-string">'$.new_field'</span>, <span class="hljs-string">'value'</span>) 
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>深度剖析</strong>：JSON列同样可以建立索引（通过函数索引），加速查询。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_color <span class="hljs-keyword">ON</span> products( (attributes<span class="hljs-operator">-</span><span class="hljs-operator">&gt;&gt;</span><span class="hljs-string">'$.color'</span>) );
</code></pre>
<p>这允许你在保持灵活性的同时，不丧失对关键字段的查询性能。</p>
<p>它完美填补了关系模型在应对<strong>多变业务需求</strong>时的短板。</p>
<h2 data-id="heading-11">06 分区表（Partitioning）</h2>
<p>当单表数据量巨大（如数亿行）时，分区可以将一张大表在物理上分割为多个更小、更易管理的部分，而逻辑上仍是一张表。</p>
<h3 data-id="heading-12">分区策略与示例</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 按时间范围(RANGE)分区，非常适合日志、订单表</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> sales (
    id <span class="hljs-type">INT</span>,
    sale_date <span class="hljs-type">DATE</span>,
    amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>)
)
<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> COLUMNS(sale_date) (
    <span class="hljs-keyword">PARTITION</span> p2023q1 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-string">'2023-04-01'</span>),
    <span class="hljs-keyword">PARTITION</span> p2023q2 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-string">'2023-07-01'</span>),
    <span class="hljs-keyword">PARTITION</span> p2023q3 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-string">'2023-10-01'</span>),
    <span class="hljs-keyword">PARTITION</span> p2023q4 <span class="hljs-keyword">VALUES</span> LESS THAN (<span class="hljs-string">'2024-01-01'</span>),
    <span class="hljs-keyword">PARTITION</span> p_future <span class="hljs-keyword">VALUES</span> LESS THAN MAXVALUE
);

<span class="hljs-comment">-- 查询时，优化器会自动定位到特定分区（分区裁剪，Partition Pruning）</span>
EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sales <span class="hljs-keyword">WHERE</span> sale_date <span class="hljs-operator">=</span> <span class="hljs-string">'2023-05-15'</span>;
<span class="hljs-comment">-- 你会看到partitions: p2023q2，意味着只扫描了2023年Q2的分区。</span>
</code></pre>
<p>除了<code>RANGE</code>，还有<code>LIST</code>（按列表值）、<code>HASH</code>（按哈希值均匀分布）等分区方式。</p>
<p><strong>深度剖析</strong>：分区的核心优势在于<strong>维护性</strong>和<strong>查询性能</strong>。</p>
<p>你可以快速删除或归档整个旧分区（<code>ALTER TABLE sales DROP PARTITION p2023q1;</code>），这比<code>DELETE</code>操作快得多，且不产生碎片。对于按分区键过滤的查询，性能提升显著。</p>
<p>但注意，分区键选择不当或跨分区查询，性能可能反而下降。</p>
<h2 data-id="heading-13">07 连接（JOIN）与子查询</h2>
<p>多表关联是业务常态，但写得不好就是性能灾难。</p>
<h3 data-id="heading-14">高级技巧</h3>
<ol>
<li><strong>控制连接顺序</strong>：MySQL优化器通常会选择它认为最佳的顺序，但你可以在复杂场景下用<code>STRAIGHT_JOIN</code>强制指定顺序。</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> ... 
<span class="hljs-keyword">FROM</span> small_table s
STRAIGHT_JOIN large_table l <span class="hljs-keyword">ON</span> s.id <span class="hljs-operator">=</span> l.s_id; <span class="hljs-comment">-- 强制先查小表</span>
</code></pre>
<ol start="2">
<li><strong>利用衍生表（Derived Table）下推条件</strong>：有时将子查询或过滤条件提前，能极大地减少中间结果集。</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 优化前：先连接两个大表，再过滤</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> A <span class="hljs-keyword">JOIN</span> B <span class="hljs-keyword">ON</span> A.id <span class="hljs-operator">=</span> B.aid <span class="hljs-keyword">WHERE</span> A.create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'...'</span>;

<span class="hljs-comment">-- 优化后：先过滤A表，再连接</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> A <span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'...'</span>) filtered_A
<span class="hljs-keyword">JOIN</span> B <span class="hljs-keyword">ON</span> filtered_A.id <span class="hljs-operator">=</span> B.aid;
</code></pre>
<ol start="3">
<li><strong><code>EXISTS</code> vs <code>IN</code></strong>：对于“是否存在”的查询，特别是子查询结果集较大时，<code>EXISTS</code>（关联子查询）通常比<code>IN</code>（非关联子查询）性能更好，因为它找到第一个匹配项就会停止。</li>
</ol>
<p><strong>深度剖析</strong>：所有的JOIN优化，其核心思想都是 <strong>“尽早过滤，减少中间数据量”</strong> 。熟练使用<code>EXPLAIN</code>查看连接类型（如<code>eq_ref</code>很好，<code>Using join buffer</code>说明可能需要索引）是关键。</p>
<h2 data-id="heading-15">08 用户自定义变量</h2>
<p>MySQL允许你定义用户变量（如<code>@rank</code>），这在一些需要<strong>跨行计算或记录中间状态</strong>的分析中非常有用。</p>
<h3 data-id="heading-16">实战案例：计算行间差值</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 计算每日销售额的日环比增长率</span>
<span class="hljs-keyword">SELECT</span> 
    sale_date,
    daily_amount,
    <span class="hljs-comment">-- 使用变量记录前一天的值</span>
    <span class="hljs-variable">@prev</span>_amount <span class="hljs-keyword">as</span> prev_day_amount,
    ROUND( (daily_amount <span class="hljs-operator">-</span> <span class="hljs-variable">@prev</span>_amount) <span class="hljs-operator">/</span> <span class="hljs-variable">@prev</span>_amount <span class="hljs-operator">*</span> <span class="hljs-number">100</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> growth_rate,
    <span class="hljs-comment">-- 将当前值赋给变量，供下一行使用</span>
    <span class="hljs-variable">@prev</span>_amount :<span class="hljs-operator">=</span> daily_amount
<span class="hljs-keyword">FROM</span> 
    daily_sales_summary,
    (<span class="hljs-keyword">SELECT</span> <span class="hljs-variable">@prev</span>_amount :<span class="hljs-operator">=</span> <span class="hljs-number">0</span>) init <span class="hljs-comment">-- 初始化变量</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sale_date;
</code></pre>
<p><strong>深度剖析</strong>：用户变量提供了过程式编程的能力，可以模拟窗口函数的部分功能（在MySQL 8.0之前）。</p>
<p>但它<strong>不是SQL标准</strong>，执行顺序有时反直觉，需谨慎使用。</p>
<p>在复杂的会话或事务中，变量的生命周期和作用域也需要仔细考量。</p>
<h2 data-id="heading-17">09 在线DDL与无锁变更</h2>
<p>在业务7x24小时运行的时代，给大表加字段、改索引再也不能随意停服务了。</p>
<p>MySQL 5.6+提供了<code>ALGORITHM</code>和<code>LOCK</code>选项，实现<strong>在线DDL</strong>（Online Data Definition）。</p>
<h3 data-id="heading-18">安全操作指南</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 添加一个可为空且有默认值的新列，使用INPLACE算法和尽量低的锁级别</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> huge_table 
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> new_column <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">''</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
ALGORITHM<span class="hljs-operator">=</span>INPLACE, <span class="hljs-comment">-- 尽量使用INPLACE（原地重建），避免COPY（锁表复制）</span>
LOCK<span class="hljs-operator">=</span><span class="hljs-keyword">NONE</span>; <span class="hljs-comment">-- 目标：不加锁，或共享锁</span>

<span class="hljs-comment">-- 修改列类型（某些情况需要COPY，会锁表）</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> huge_table 
MODIFY <span class="hljs-keyword">COLUMN</span> old_column <span class="hljs-type">BIGINT</span>,
ALGORITHM<span class="hljs-operator">=</span><span class="hljs-keyword">COPY</span>, <span class="hljs-comment">-- 注意：这里可能必须用COPY</span>
LOCK<span class="hljs-operator">=</span>SHARED;
</code></pre>
<p><strong>深度剖析</strong>：<code>ALGORITHM=INPLACE</code>意味着大部分工作（如重建索引）在引擎内部完成，允许并发DML操作。</p>
<p>而<code>ALGORITHM=COPY</code>会创建新表并复制数据，全程锁表。</p>
<p>执行前务必用<code>ALGORITHM=DEFAULT</code>先测试一下。</p>
<p><strong>pt-online-schema-change</strong> 是Percona提供的第三方工具，通过触发器实现真正的全程无锁，是更稳妥的选择。</p>
<h2 data-id="heading-19">10 利用生成列与函数索引</h2>
<p>生成列的值由表中其他列计算而来，可分为<strong>虚拟列（VIRTUAL，不存储，读取时计算）和存储列（STORED，持久化存储）</strong>。</p>
<p>这为建立高效的函数索引铺平了道路。</p>
<h3 data-id="heading-20">应用场景</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 场景：经常需要根据 `first_name` 和 `last_name` 进行全名搜索</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users 
<span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> full_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) 
GENERATED ALWAYS <span class="hljs-keyword">AS</span> (CONCAT(first_name, <span class="hljs-string">' '</span>, last_name)) STORED, <span class="hljs-comment">-- 创建存储的生成列</span>
<span class="hljs-keyword">ADD</span> INDEX idx_full_name (full_name); <span class="hljs-comment">-- 在生成列上建立索引</span>

<span class="hljs-comment">-- 现在，以下查询可以高效使用索引</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> full_name <span class="hljs-operator">=</span> <span class="hljs-string">'John Doe'</span>;
</code></pre>
<p><strong>深度剖析</strong>：这解决了直接在表达式（如<code>CONCAT(first_name, ‘ ‘, last_name)</code>）上建立函数索引的难题。</p>
<p>虚拟列节省空间但增加CPU计算开销；存储列反之。</p>
<p>更多项目实战在项目实战网：<a href="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" title="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" target="_blank">java突击队</a></p>
<h2 data-id="heading-21">总结：从“会用”到“精通”的跃迁</h2>
<p>好了，一口气聊了11个MySQL的高级用法。让我们最后再梳理一下，这些技巧并非孤立存在，它们构成了一个应对不同场景挑战的工具箱。</p>




























































<table><thead><tr><th align="left">高级用法</th><th align="left">核心解决痛点</th><th align="left">推荐适用场景</th></tr></thead><tbody><tr><td align="left"><strong>执行计划(EXPLAIN)</strong></td><td align="left">性能瓶颈可视化</td><td align="left"><strong>所有</strong>慢查询优化前的第一步</td></tr><tr><td align="left"><strong>高级索引策略</strong></td><td align="left">查询速度慢，写操作重</td><td align="left">高频查询、大表性能优化</td></tr><tr><td align="left"><strong>窗口函数(Window)</strong></td><td align="left">复杂跨行计算效率低</td><td align="left">排行榜、数据分析、报表</td></tr><tr><td align="left"><strong>通用表表达式(CTE)</strong></td><td align="left">复杂SQL难读写，树查询难</td><td align="left">复杂业务逻辑拆分，层次数据查询</td></tr><tr><td align="left"><strong>JSON类型</strong></td><td align="left">动态、半结构化数据存储与查询</td><td align="left">配置、动态属性、API数据存储</td></tr><tr><td align="left"><strong>分区表</strong></td><td align="left">超大表维护难，历史数据清理慢</td><td align="left">时间序列数据（日志、订单）</td></tr><tr><td align="left"><strong>JOIN/子查询优化</strong></td><td align="left">多表关联性能低下</td><td align="left">涉及多个业务实体的复杂查询</td></tr><tr><td align="left"><strong>用户自定义变量</strong></td><td align="left">需行间计算或状态保持（8.0前）</td><td align="left">自定义序列、差值计算（有窗口函数后优先级降低）</td></tr><tr><td align="left"><strong>在线DDL</strong></td><td align="left">业务不中断变更表结构</td><td align="left">7x24小时系统表结构变更</td></tr><tr><td align="left"><strong>生成列/函数索引</strong></td><td align="left">无法直接对表达式建索引</td><td align="left">基于JSON字段、计算字段的高效查询</td></tr></tbody></table>
<p>有些小伙伴在工作中可能会有这样的疑问：“我知道它们好，但该从哪里开始学起呢？”</p>
<p>我的建议是：<strong>从<code>EXPLAIN</code>和<code>索引优化</code>开始</strong>。</p>
<p>这是性能问题的根本。</p>
<p>然后，根据你的业务需求，引入<code>窗口函数</code>或<code>CTE</code>来简化复杂查询。当数据量上来后，考虑<code>分区</code>。</p>
<p>对于动态数据结构，尝试<code>JSON</code>类型。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS-流光特效]]></title>    <link>https://juejin.cn/post/7604694326518825011</link>    <guid>https://juejin.cn/post/7604694326518825011</guid>    <pubDate>2026-02-10T03:00:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604694326518825011" data-draft-id="7604672395627642907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS-流光特效"/> <meta itemprop="keywords" content="前端,CSS,HTML"/> <meta itemprop="datePublished" content="2026-02-10T03:00:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS-流光特效
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:00:46.000Z" title="Tue Feb 10 2026 03:00:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在 UI 设计中，合理的动效能极大地提升产品的科技感与交互体验。本文将分享两种高频使用的流光特效：<strong>旋转边框流光</strong>（常用于 VIP 会员卡片）与<strong>线性扫描流光</strong>（常用于加载状态或按钮高亮）。</p>
<h2 data-id="heading-1">一、 旋转边框流光 (Border Rotating Glow)</h2>
<h3 data-id="heading-2">1. 实现效果：</h3>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b2f81d62c5745ebb35576b571c3bdaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297249&amp;x-signature=Hq4jfP1Fbb0D7jXRCLxuejFOgy8%3D" alt="流光边框.gif" loading="lazy"/></p>
<h3 data-id="heading-3">2. 实现原理：背景旋转裁剪</h3>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37cb9aa5de494dcd9a5aee5737805786~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297249&amp;x-signature=I8IFfEt%2BuobW1mdR%2BG1fcjhkZXE%3D" alt="流光边框原理.gif" loading="lazy"/></p>
很多同学第一反应是会尝试直接给 `border` 设置渐变，但 CSS 原生 `border` 并不支持动画旋转。 
<p><strong>核心黑科技</strong>：</p>
<ol>
<li>底层放一个<strong>巨大的、旋转的渐变色块</strong>（通常用伪元素实现）。</li>
<li>上层盖一个<strong>略小的容器</strong>（按钮主体）。</li>
<li>父容器设置 <code>overflow: hidden</code>。 这样，转动的渐变色块被裁剪后，露出的那一圈边缘看起来就像流光在游走。</li>
</ol>
<h3 data-id="heading-4">3. 实现代码</h3>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-comment">&lt;!-- 外层容器包裹按钮 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glow-wrapper"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glow-button"</span>&gt;</span>流光按钮<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>


/* 外层容器：负责流光效果 */
.glow-wrapper {
  position: relative; 
  display: inline-block;
  padding: 4px; /* 控制流光边框的宽度 */
  border-radius: 12px;
  overflow: hidden; /* 关键：裁剪旋转的渐变层 */
}

/* 伪元素：旋转的渐变框 */
.glow-wrapper::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  background: linear-gradient(
    45deg,
    #0066ff,
    #00ccff,
    #ccff00,
    #ff9900,
    #ff00cc
  );
  border-radius: 12px;
  z-index: -1;
  animation: rotateGlow 3s linear infinite;
}

/* 内部真实按钮 */
.glow-button {
  height: 42px;
  width: 122px;
  line-height: 42px;
  font-size: 18px;
  color: white;
  background: #121212;
  border-radius: 8px; /* 略小于 wrapper 的圆角 */
}
@keyframes rotateGlow {
  0% {
    transform: rotate(0deg);
  }
  40% {
    transform: rotate(180deg);
  }
  60% {
    transform: rotate(180deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-5">二、 线性扫描流光 (Linear Scanning Glow)</h2>
<h3 data-id="heading-6">1. 实现效果：</h3>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddf3f5700fc34a3294b5bd9e47c186f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-R546w5LiA5Y-q5aSn5ZGG55Oc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771297249&amp;x-signature=MTdoDA5oYKlv3HLfoY2uXm14UGU%3D" alt="扫描流光.gif" loading="lazy"/></p>
### 2. 实现原理：背景位移
<p>这种效果模拟了光束扫过物体的视觉感，常用于骨架屏或高级按钮。</p>
<p><strong>核心思路</strong>：</p>
<ul>
<li><strong>渐变设计</strong>：设计一个“暗-亮-暗”的 <code>linear-gradient</code>。</li>
<li><strong>尺寸放大</strong>：将 <code>background-size</code> 设为 <code>200%</code> 或更大，让“亮点”隐藏在视口之外。</li>
<li><strong>位置动画</strong>：通过改变 <code>background-position</code>，让亮色条从左至右水平穿过。</li>
</ul>
<h3 data-id="heading-7">3. 实现代码</h3>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"glow-wrapper"</span>&gt;</span>扫描流光<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

.glow-wrapper {
  position: relative;
  padding: 20px 40px; /* 边框厚度 */
  color: white;
  border-radius: 10px;
  font-weight: 800;
  background: linear-gradient(90deg, transparent, #00dbde, transparent);
  background-size: 200% 100%;
  animation: scan 2s linear infinite;
}

@keyframes scan {
  0% {
    background-position: -200% 0%;
  }
  100% {
    background-position: 200% 0%;
  }
}

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀99% 前端都用错了 flatMap！把 “映射扁平” 用成高级 for 循环？20 个高阶用法一次性讲透]]></title>    <link>https://juejin.cn/post/7604666872128356371</link>    <guid>https://juejin.cn/post/7604666872128356371</guid>    <pubDate>2026-02-10T04:58:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604666872128356371" data-draft-id="7604757482003923007" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀99% 前端都用错了 flatMap！把 “映射扁平” 用成高级 for 循环？20 个高阶用法一次性讲透"/> <meta itemprop="keywords" content="前端,JavaScript,TypeScript"/> <meta itemprop="datePublished" content="2026-02-10T04:58:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iDao技术魔方"/> <meta itemprop="url" content="https://juejin.cn/user/166781496080782"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀99% 前端都用错了 flatMap！把 “映射扁平” 用成高级 for 循环？20 个高阶用法一次性讲透
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/166781496080782/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iDao技术魔方
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T04:58:16.000Z" title="Tue Feb 10 2026 04:58:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    103
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>我在 3 个项目里用 flatMap 重构了 50+ 处代码，总结了这些经验。今天全部教给你。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">开篇：为什么要专门学 flatMap？</h2>
<p>去年我接手一个电商后台项目，代码里到处都是这样的写法：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 性能杀手：两次遍历 + 中间数组</span>
<span class="hljs-keyword">const</span> result = orders
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> order.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> order.<span class="hljs-property">items</span>)
  .<span class="hljs-title function_">flat</span>();
</code></pre>
<p>重构后用 flatMap：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 一次遍历，代码更简洁</span>
<span class="hljs-keyword">const</span> result = orders.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span> 
  order.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span> ? order.<span class="hljs-property">items</span> : []
);
</code></pre>
<p><strong>性能提升 40%，代码量减少 30%</strong>。这就是 flatMap 的威力。</p>
<hr/>
<h2 data-id="heading-1">第一部分：基础技巧（1-5）</h2>
<h3 data-id="heading-2">技巧 1：替代 filter + map</h3>
<p><strong>场景</strong>：提取所有已付款订单的商品</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> orders = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'paid'</span>, <span class="hljs-attr">items</span>: [<span class="hljs-string">'iPhone'</span>, <span class="hljs-string">'AirPods'</span>] },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span>, <span class="hljs-attr">items</span>: [<span class="hljs-string">'iPad'</span>] },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'paid'</span>, <span class="hljs-attr">items</span>: [<span class="hljs-string">'MacBook'</span>] }
];

<span class="hljs-comment">// ❌ 传统写法：两次遍历</span>
<span class="hljs-keyword">const</span> items1 = orders
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">items</span>)
  .<span class="hljs-title function_">flat</span>();

<span class="hljs-comment">// ✅ flatMap：一次遍历</span>
<span class="hljs-keyword">const</span> items2 = orders.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">order</span> =&gt;</span>
  order.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span> ? order.<span class="hljs-property">items</span> : []
);
<span class="hljs-comment">// ['iPhone', 'AirPods', 'MacBook']</span>
</code></pre>
<p><strong>为什么更好</strong>：减少一次遍历，大数据量时性能优势明显。</p>
<hr/>
<h3 data-id="heading-3">技巧 2：处理嵌套数组（树形结构扁平化）</h3>
<p><strong>场景</strong>：菜单树转平级列表</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> menuTree = [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'系统管理'</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'用户管理'</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'/users'</span> },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'角色管理'</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'/roles'</span> }
    ]
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'业务管理'</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'订单管理'</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'/orders'</span> }
    ]
  }
];

<span class="hljs-comment">// 提取所有菜单项，保留父级信息</span>
<span class="hljs-keyword">const</span> flatMenu = menuTree.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">parent</span> =&gt;</span>
  parent.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> ({
    ...child,
    <span class="hljs-attr">parentName</span>: parent.<span class="hljs-property">name</span>
  }))
);

<span class="hljs-comment">/*
[
  { name: '用户管理', path: '/users', parentName: '系统管理' },
  { name: '角色管理', path: '/roles', parentName: '系统管理' },
  { name: '订单管理', path: '/orders', parentName: '业务管理' }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-4">技巧 3：字符串拆分与合并</h3>
<p><strong>场景</strong>：处理多行输入的关键词</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> userInput = [
  <span class="hljs-string">'apple, banana, orange'</span>,
  <span class="hljs-string">'react, vue, angular'</span>,
  <span class="hljs-string">'frontend, backend'</span>
];

<span class="hljs-comment">// 拆分成所有关键词并去重</span>
<span class="hljs-keyword">const</span> keywords = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(
  userInput.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">line</span> =&gt;</span> 
    line.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-title function_">trim</span>())
  )
)];
<span class="hljs-comment">// ['apple', 'banana', 'orange', 'react', 'vue', 'angular', 'frontend', 'backend']</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">技巧 4：根据数量展开元素</h3>
<p><strong>场景</strong>：购物车根据商品数量生成明细</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cart = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">2</span> },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'AirPods'</span>, <span class="hljs-attr">quantity</span>: <span class="hljs-number">1</span> }
];

<span class="hljs-comment">// 展开成独立项（用于库存检查）</span>
<span class="hljs-keyword">const</span> items = cart.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span>
  <span class="hljs-title class_">Array</span>(product.<span class="hljs-property">quantity</span>).<span class="hljs-title function_">fill</span>(product.<span class="hljs-property">name</span>)
);
<span class="hljs-comment">// ['iPhone', 'iPhone', 'AirPods']</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">技巧 5：过滤 null/undefined（但要注意坑）</h3>
<p><strong>场景</strong>：清理接口返回的数据</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> apiResponse = [<span class="hljs-number">1</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-number">3</span>, <span class="hljs-literal">null</span>, <span class="hljs-number">4</span>];

<span class="hljs-comment">// ✅ 正确写法</span>
<span class="hljs-keyword">const</span> clean = apiResponse.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> 
  x != <span class="hljs-literal">null</span> ? [x] : []
);
<span class="hljs-comment">// [1, 2, 3, 4]</span>

<span class="hljs-comment">// ❌ 错误写法（会误删 0 和空字符串）</span>
<span class="hljs-comment">// const wrong = apiResponse.flatMap(x =&gt; x || []);</span>
<span class="hljs-comment">// const wrong2 = apiResponse.flatMap(x =&gt; x ?? []);</span>
</code></pre>
<p><strong>坑点警示</strong>：<code>x || []</code> 或 <code>x ?? []</code> 会把 <code>0</code>、<code>''</code>、<code>false</code> 也过滤掉！</p>
<hr/>
<h2 data-id="heading-7">第二部分：进阶技巧（6-12）</h2>
<h3 data-id="heading-8">技巧 6：递归扁平化树结构</h3>
<p><strong>场景</strong>：无限极分类转平级</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> categoryTree = [
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'电子产品'</span>,
    <span class="hljs-attr">children</span>: [
      {
        <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
        <span class="hljs-attr">name</span>: <span class="hljs-string">'手机'</span>,
        <span class="hljs-attr">children</span>: [
          { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">children</span>: [] }
        ]
      }
    ]
  }
];

<span class="hljs-keyword">function</span> <span class="hljs-title function_">flattenTree</span>(<span class="hljs-params">nodes, depth = <span class="hljs-number">0</span></span>) {
  <span class="hljs-keyword">return</span> nodes.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">node</span> =&gt;</span> [
    { ...node, depth, <span class="hljs-attr">children</span>: <span class="hljs-literal">undefined</span> },
    ...<span class="hljs-title function_">flattenTree</span>(node.<span class="hljs-property">children</span> || [], depth + <span class="hljs-number">1</span>)
  ]);
}

<span class="hljs-keyword">const</span> flatList = <span class="hljs-title function_">flattenTree</span>(categoryTree);
<span class="hljs-comment">/*
[
  { id: 1, name: '电子产品', depth: 0 },
  { id: 2, name: '手机', depth: 1 },
  { id: 3, name: 'iPhone', depth: 2 }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-9">技巧 7：笛卡尔积生成（SKU 组合）</h3>
<p><strong>场景</strong>：电商 SKU 生成</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> colors = [<span class="hljs-string">'深空灰'</span>, <span class="hljs-string">'银色'</span>];
<span class="hljs-keyword">const</span> sizes = [<span class="hljs-string">'128GB'</span>, <span class="hljs-string">'256GB'</span>];
<span class="hljs-keyword">const</span> editions = [<span class="hljs-string">'标准版'</span>, <span class="hljs-string">'Pro版'</span>];

<span class="hljs-comment">// 生成所有 SKU 组合</span>
<span class="hljs-keyword">const</span> skus = colors.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">color</span> =&gt;</span>
  sizes.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">size</span> =&gt;</span>
    editions.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">edition</span> =&gt;</span> ({
      <span class="hljs-attr">sku</span>: <span class="hljs-string">`PHONE-<span class="hljs-subst">${color}</span>-<span class="hljs-subst">${size}</span>-<span class="hljs-subst">${edition}</span>`</span>,
      color,
      size,
      edition,
      <span class="hljs-attr">price</span>: <span class="hljs-title function_">calculatePrice</span>(color, size, edition)
    }))
  )
);

<span class="hljs-comment">// 生成 2×2×2=8 个 SKU</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">技巧 8：分页数据合并</h3>
<p><strong>场景</strong>：合并多个分页接口返回的数据</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> pages = [
  { <span class="hljs-attr">items</span>: [{ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> }, { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span> }], <span class="hljs-attr">hasMore</span>: <span class="hljs-literal">true</span> },
  { <span class="hljs-attr">items</span>: [{ <span class="hljs-attr">id</span>: <span class="hljs-number">3</span> }], <span class="hljs-attr">hasMore</span>: <span class="hljs-literal">false</span> }
];

<span class="hljs-comment">// 合并所有 items，并标记来源页</span>
<span class="hljs-keyword">const</span> allItems = pages.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function">(<span class="hljs-params">page, pageIndex</span>) =&gt;</span>
  page.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> ({
    ...item,
    pageIndex,
    <span class="hljs-attr">isLastPage</span>: !page.<span class="hljs-property">hasMore</span>
  }))
);

<span class="hljs-comment">/*
[
  { id: 1, pageIndex: 0, isLastPage: false },
  { id: 2, pageIndex: 0, isLastPage: false },
  { id: 3, pageIndex: 1, isLastPage: true }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-11">技巧 9：表单验证错误收集</h3>
<p><strong>场景</strong>：收集所有表单字段的验证错误</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fields = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'email'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'invalid'</span>, <span class="hljs-attr">validators</span>: [isEmail, isRequired] },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">validators</span>: [isAdult, isRequired] }
];

<span class="hljs-keyword">const</span> errors = fields.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">field</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> fieldErrors = field.<span class="hljs-property">validators</span>
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span> <span class="hljs-title function_">v</span>(field.<span class="hljs-property">value</span>))
    .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> error !== <span class="hljs-literal">null</span>);
  
  <span class="hljs-keyword">return</span> fieldErrors.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> ({
    <span class="hljs-attr">field</span>: field.<span class="hljs-property">name</span>,
    <span class="hljs-attr">message</span>: msg
  }));
});

<span class="hljs-comment">/*
[
  { field: 'email', message: '邮箱格式不正确' },
  { field: 'age', message: '年龄必须大于18岁' }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-12">技巧 10：标签系统展开</h3>
<p><strong>场景</strong>：文章标签反向索引</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> articles = [
  { <span class="hljs-attr">title</span>: <span class="hljs-string">'React Hooks'</span>, <span class="hljs-attr">tags</span>: [<span class="hljs-string">'react'</span>, <span class="hljs-string">'frontend'</span>] },
  { <span class="hljs-attr">title</span>: <span class="hljs-string">'Vue 3'</span>, <span class="hljs-attr">tags</span>: [<span class="hljs-string">'vue'</span>, <span class="hljs-string">'frontend'</span>] }
];

<span class="hljs-comment">// 展开成 "标签-文章" 映射</span>
<span class="hljs-keyword">const</span> tagIndex = articles.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">article</span> =&gt;</span>
  article.<span class="hljs-property">tags</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">tag</span> =&gt;</span> ({ tag, <span class="hljs-attr">title</span>: article.<span class="hljs-property">title</span> }))
);

<span class="hljs-comment">// 统计每个标签的文章数</span>
<span class="hljs-keyword">const</span> tagCount = tagIndex.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, { tag }</span>) =&gt;</span> {
  acc[tag] = (acc[tag] || <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;
  <span class="hljs-keyword">return</span> acc;
}, {});
<span class="hljs-comment">// { react: 1, frontend: 2, vue: 1 }</span>
</code></pre>
<hr/>
<h3 data-id="heading-13">技巧 11：权限菜单过滤</h3>
<p><strong>场景</strong>：根据权限过滤可见菜单</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> menuTree = [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'系统管理'</span>,
    <span class="hljs-attr">children</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'用户管理'</span>, <span class="hljs-attr">permission</span>: <span class="hljs-string">'user:view'</span>, <span class="hljs-attr">visible</span>: <span class="hljs-literal">true</span> },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'配置管理'</span>, <span class="hljs-attr">permission</span>: <span class="hljs-string">'config:view'</span>, <span class="hljs-attr">visible</span>: <span class="hljs-literal">false</span> }
    ]
  }
];

<span class="hljs-keyword">const</span> userPermissions = [<span class="hljs-string">'user:view'</span>, <span class="hljs-string">'order:view'</span>];

<span class="hljs-comment">// 过滤出用户有权限的菜单</span>
<span class="hljs-keyword">const</span> visibleMenus = menuTree.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">menu</span> =&gt;</span>
  menu.<span class="hljs-property">children</span>.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span>
    child.<span class="hljs-property">visible</span> &amp;&amp; userPermissions.<span class="hljs-title function_">includes</span>(child.<span class="hljs-property">permission</span>)
      ? [{ ...child, <span class="hljs-attr">parent</span>: menu.<span class="hljs-property">name</span> }]
      : []
  )
);
</code></pre>
<hr/>
<h3 data-id="heading-14">技巧 12：矩阵转置</h3>
<p><strong>场景</strong>：表格行列转换</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> matrix = [
  [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>],
  [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>],
  [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]
];

<span class="hljs-comment">// 矩阵转置</span>
<span class="hljs-keyword">const</span> transposed = matrix[<span class="hljs-number">0</span>].<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, colIndex</span>) =&gt;</span>
  matrix.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[colIndex] !== <span class="hljs-literal">undefined</span> ? [row[colIndex]] : [])
);

<span class="hljs-comment">/*
[
  [1, 4, 7],
  [2, 5, 8],
  [3, 6, 9]
]
*/</span>
</code></pre>
<hr/>
<h2 data-id="heading-15">第三部分：高阶技巧（13-20）</h2>
<h3 data-id="heading-16">技巧 13：动态条件展开</h3>
<p><strong>场景</strong>：根据数据类型决定展开策略</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> data = [
  { <span class="hljs-attr">type</span>: <span class="hljs-string">'batch'</span>, <span class="hljs-attr">items</span>: [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>] },
  { <span class="hljs-attr">type</span>: <span class="hljs-string">'single'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'d'</span> }
];

<span class="hljs-keyword">const</span> result = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-string">'batch'</span>) {
    <span class="hljs-keyword">return</span> item.<span class="hljs-property">items</span>; <span class="hljs-comment">// 展开数组</span>
  }
  <span class="hljs-keyword">return</span> [item.<span class="hljs-property">value</span>]; <span class="hljs-comment">// 包装成数组</span>
});
<span class="hljs-comment">// ['a', 'b', 'c', 'd']</span>
</code></pre>
<hr/>
<h3 data-id="heading-17">技巧 14：深度路径提取</h3>
<p><strong>场景</strong>：提取嵌套对象的所有叶子节点</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> nested = {
  <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: { <span class="hljs-attr">c</span>: <span class="hljs-number">1</span> } },
  <span class="hljs-attr">d</span>: { <span class="hljs-attr">e</span>: <span class="hljs-number">2</span> }
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getPaths</span>(<span class="hljs-params">obj, prefix = <span class="hljs-string">''</span></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(obj).<span class="hljs-title function_">flatMap</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> path = prefix ? <span class="hljs-string">`<span class="hljs-subst">${prefix}</span>.<span class="hljs-subst">${key}</span>`</span> : key;
    
    <span class="hljs-keyword">if</span> (value &amp;&amp; <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span> &amp;&amp; !<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value)) {
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">getPaths</span>(value, path);
    }
    
    <span class="hljs-keyword">return</span> [{ path, value }];
  });
}

<span class="hljs-title function_">getPaths</span>(nested);
<span class="hljs-comment">/*
[
  { path: 'a.b.c', value: 1 },
  { path: 'd.e', value: 2 }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-18">技巧 15：分组报表生成</h3>
<p><strong>场景</strong>：销售数据透视表预处理</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> sales = [
  { <span class="hljs-attr">month</span>: <span class="hljs-string">'1月'</span>, <span class="hljs-attr">region</span>: <span class="hljs-string">'东'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">100</span> },
  { <span class="hljs-attr">month</span>: <span class="hljs-string">'1月'</span>, <span class="hljs-attr">region</span>: <span class="hljs-string">'西'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">200</span> },
  { <span class="hljs-attr">month</span>: <span class="hljs-string">'2月'</span>, <span class="hljs-attr">region</span>: <span class="hljs-string">'东'</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">150</span> }
];

<span class="hljs-keyword">const</span> months = [...<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(sales.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">month</span>))];

<span class="hljs-keyword">const</span> report = months.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">month</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> monthData = sales.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> s.<span class="hljs-property">month</span> === month);
  <span class="hljs-keyword">const</span> total = monthData.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, s</span>) =&gt;</span> sum + s.<span class="hljs-property">amount</span>, <span class="hljs-number">0</span>);
  
  <span class="hljs-keyword">return</span> [{
    month,
    <span class="hljs-attr">details</span>: monthData,
    total,
    <span class="hljs-attr">average</span>: total / monthData.<span class="hljs-property">length</span>
  }];
});
</code></pre>
<hr/>
<h3 data-id="heading-19">技巧 16：全选功能展开</h3>
<p><strong>场景</strong>：下拉框全选展开成子项</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> options = [
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'水果'</span>, <span class="hljs-attr">children</span>: [<span class="hljs-string">'苹果'</span>, <span class="hljs-string">'香蕉'</span>] },
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'蔬菜'</span>, <span class="hljs-attr">children</span>: [<span class="hljs-string">'白菜'</span>] },
  { <span class="hljs-attr">label</span>: <span class="hljs-string">'全选'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'all'</span> }
];

<span class="hljs-keyword">const</span> flattened = options.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">opt</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (opt.<span class="hljs-property">value</span> === <span class="hljs-string">'all'</span>) {
    <span class="hljs-comment">// 全选展开成所有子项</span>
    <span class="hljs-keyword">return</span> options
      .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">children</span>)
      .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">children</span>);
  }
  
  <span class="hljs-keyword">return</span> opt.<span class="hljs-property">children</span>
    ? opt.<span class="hljs-property">children</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> ({ <span class="hljs-attr">label</span>: child, <span class="hljs-attr">group</span>: opt.<span class="hljs-property">label</span> }))
    : [opt];
});
</code></pre>
<hr/>
<h3 data-id="heading-20">技巧 17：自定义深度扁平化</h3>
<p><strong>场景</strong>：指定深度的数组扁平化</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> deepArray = [<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>, [<span class="hljs-number">3</span>, [<span class="hljs-number">4</span>]]], <span class="hljs-number">5</span>];

<span class="hljs-keyword">function</span> <span class="hljs-title function_">flatMapDeep</span>(<span class="hljs-params">arr, depth = <span class="hljs-number">1</span></span>) {
  <span class="hljs-keyword">if</span> (depth === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> arr;
  
  <span class="hljs-keyword">return</span> arr.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span>
    <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(item)
      ? <span class="hljs-title function_">flatMapDeep</span>(item, depth - <span class="hljs-number">1</span>)
      : [item]
  );
}

<span class="hljs-title function_">flatMapDeep</span>(deepArray, <span class="hljs-number">1</span>); <span class="hljs-comment">// [1, 2, [3, [4]], 5]</span>
<span class="hljs-title function_">flatMapDeep</span>(deepArray, <span class="hljs-number">2</span>); <span class="hljs-comment">// [1, 2, 3, [4], 5]</span>
<span class="hljs-title function_">flatMapDeep</span>(deepArray, <span class="hljs-number">3</span>); <span class="hljs-comment">// [1, 2, 3, 4, 5]</span>
</code></pre>
<hr/>
<h3 data-id="heading-21">技巧 18：数据转换管道</h3>
<p><strong>场景</strong>：多阶段数据处理</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> rawData = [
  { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">items</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>], <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">items</span>: [<span class="hljs-number">30</span>], <span class="hljs-attr">active</span>: <span class="hljs-literal">false</span> },
  { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">items</span>: [<span class="hljs-number">40</span>, <span class="hljs-number">50</span>], <span class="hljs-attr">active</span>: <span class="hljs-literal">true</span> }
];

<span class="hljs-comment">// 管道：过滤 -&gt; 展开 -&gt; 转换</span>
<span class="hljs-keyword">const</span> processed = rawData
  .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">active</span> ? [item] : [])           <span class="hljs-comment">// 过滤</span>
  .<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> ({             <span class="hljs-comment">// 展开</span>
    <span class="hljs-attr">id</span>: item.<span class="hljs-property">id</span>, 
    <span class="hljs-attr">value</span>: val 
  })))
  .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">{ id, value }</span>) =&gt;</span> ({                             <span class="hljs-comment">// 转换</span>
    id,
    value,
    <span class="hljs-attr">doubled</span>: value * <span class="hljs-number">2</span>
  }));

<span class="hljs-comment">/*
[
  { id: 1, value: 10, doubled: 20 },
  { id: 1, value: 20, doubled: 40 },
  { id: 3, value: 40, doubled: 80 },
  { id: 3, value: 50, doubled: 100 }
]
*/</span>
</code></pre>
<hr/>
<h3 data-id="heading-22">技巧 19：多重条件过滤与展开</h3>
<p><strong>场景</strong>：复杂条件的数据筛选</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> products = [
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'手机'</span>, <span class="hljs-attr">variants</span>: [<span class="hljs-string">'128GB'</span>, <span class="hljs-string">'256GB'</span>] },
  { <span class="hljs-attr">name</span>: <span class="hljs-string">'T恤'</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'服装'</span>, <span class="hljs-attr">variants</span>: [<span class="hljs-string">'M'</span>, <span class="hljs-string">'L'</span>, <span class="hljs-string">'XL'</span>] }
];

<span class="hljs-comment">// 只展开指定类别的商品变体</span>
<span class="hljs-keyword">const</span> variants = products.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (product.<span class="hljs-property">category</span> !== <span class="hljs-string">'手机'</span>) <span class="hljs-keyword">return</span> [];
  
  <span class="hljs-keyword">return</span> product.<span class="hljs-property">variants</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">variant</span> =&gt;</span> ({
    <span class="hljs-attr">name</span>: <span class="hljs-string">`<span class="hljs-subst">${product.name}</span> <span class="hljs-subst">${variant}</span>`</span>,
    <span class="hljs-attr">basePrice</span>: <span class="hljs-number">5999</span>,
    variant
  }));
});
</code></pre>
<hr/>
<h3 data-id="heading-23">技巧 20：实战综合案例（购物车系统）</h3>
<p><strong>场景</strong>：完整的购物车数据处理流程</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> cart = [
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'bundle'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'苹果套装'</span>,
    <span class="hljs-attr">items</span>: [
      { <span class="hljs-attr">sku</span>: <span class="hljs-string">'IPHONE'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'iPhone'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">5999</span>, <span class="hljs-attr">stock</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'手机'</span> },
      { <span class="hljs-attr">sku</span>: <span class="hljs-string">'AIRPODS'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'AirPods'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">1999</span>, <span class="hljs-attr">stock</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">category</span>: <span class="hljs-string">'配件'</span> }
    ]
  },
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'single'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'MacBook'</span>,
    <span class="hljs-attr">sku</span>: <span class="hljs-string">'MACBOOK'</span>,
    <span class="hljs-attr">price</span>: <span class="hljs-number">14999</span>,
    <span class="hljs-attr">stock</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">category</span>: <span class="hljs-string">'电脑'</span>,
    <span class="hljs-attr">options</span>: { <span class="hljs-attr">colors</span>: [<span class="hljs-string">'深空灰'</span>, <span class="hljs-string">'银色'</span>], <span class="hljs-attr">sizes</span>: [<span class="hljs-string">'14寸'</span>, <span class="hljs-string">'16寸'</span>] }
  },
  {
    <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'single'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'鼠标'</span>,
    <span class="hljs-attr">sku</span>: <span class="hljs-string">'MOUSE'</span>,
    <span class="hljs-attr">price</span>: <span class="hljs-number">299</span>,
    <span class="hljs-attr">stock</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">category</span>: <span class="hljs-string">'配件'</span>
  }
];

<span class="hljs-comment">// 步骤1：展开所有商品（包括套装）</span>
<span class="hljs-keyword">const</span> expanded = cart.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (item.<span class="hljs-property">type</span> === <span class="hljs-string">'bundle'</span>) {
    <span class="hljs-keyword">return</span> item.<span class="hljs-property">items</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">sub</span> =&gt;</span> ({ 
      ...sub, 
      <span class="hljs-attr">bundleId</span>: item.<span class="hljs-property">id</span>,
      <span class="hljs-attr">bundleName</span>: item.<span class="hljs-property">name</span> 
    }));
  }
  <span class="hljs-keyword">return</span> [item];
});

<span class="hljs-comment">// 步骤2：过滤库存为0的商品</span>
<span class="hljs-keyword">const</span> available = expanded.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span>
  product.<span class="hljs-property">stock</span> &gt; <span class="hljs-number">0</span> ? [product] : []
);

<span class="hljs-comment">// 步骤3：生成 SKU 组合</span>
<span class="hljs-keyword">const</span> withSkus = available.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">product</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (product.<span class="hljs-property">options</span>) {
    <span class="hljs-keyword">const</span> { colors, sizes } = product.<span class="hljs-property">options</span>;
    <span class="hljs-keyword">return</span> colors.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">color</span> =&gt;</span>
      sizes.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">size</span> =&gt;</span> ({
        ...product,
        <span class="hljs-attr">sku</span>: <span class="hljs-string">`<span class="hljs-subst">${product.sku}</span>-<span class="hljs-subst">${color}</span>-<span class="hljs-subst">${size}</span>`</span>,
        <span class="hljs-attr">variant</span>: <span class="hljs-string">`<span class="hljs-subst">${color}</span> <span class="hljs-subst">${size}</span>`</span>,
        <span class="hljs-attr">unitPrice</span>: product.<span class="hljs-property">price</span>
      }))
    );
  }
  <span class="hljs-keyword">return</span> [product];
});

<span class="hljs-comment">// 步骤4：按分类分组</span>
<span class="hljs-keyword">const</span> byCategory = withSkus.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">acc, item</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> cat = item.<span class="hljs-property">category</span>;
  <span class="hljs-keyword">if</span> (!acc[cat]) acc[cat] = [];
  acc[cat].<span class="hljs-title function_">push</span>(item);
  <span class="hljs-keyword">return</span> acc;
}, {});

<span class="hljs-comment">// 步骤5：生成订单摘要</span>
<span class="hljs-keyword">const</span> orderSummary = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(byCategory).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[category, items]</span>) =&gt;</span> ({
  category,
  <span class="hljs-attr">count</span>: items.<span class="hljs-property">length</span>,
  <span class="hljs-attr">items</span>: items.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">i</span> =&gt;</span> ({
    <span class="hljs-attr">name</span>: i.<span class="hljs-property">name</span>,
    <span class="hljs-attr">sku</span>: i.<span class="hljs-property">sku</span>,
    <span class="hljs-attr">price</span>: i.<span class="hljs-property">unitPrice</span> || i.<span class="hljs-property">price</span>
  })),
  <span class="hljs-attr">subtotal</span>: items.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, i</span>) =&gt;</span> sum + (i.<span class="hljs-property">unitPrice</span> || i.<span class="hljs-property">price</span>), <span class="hljs-number">0</span>)
}));

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'订单摘要:'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(orderSummary, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
</code></pre>
<p><strong>输出结果</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">[</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"手机"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"iPhone"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"IPHONE"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5999</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"subtotal"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5999</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"电脑"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MacBook"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MACBOOK-深空灰-14寸"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14999</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MacBook"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MACBOOK-深空灰-16寸"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14999</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MacBook"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MACBOOK-银色-14寸"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14999</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MacBook"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MACBOOK-银色-16寸"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14999</span> <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"subtotal"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">59996</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"配件"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"鼠标"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MOUSE"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">299</span> <span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"subtotal"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">299</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">]</span>
</code></pre>
<hr/>
<h2 data-id="heading-24">第四部分：性能对比与最佳实践</h2>
<h3 data-id="heading-25">性能测试</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 测试数据：10000 条订单</span>
<span class="hljs-keyword">const</span> orders = <span class="hljs-title class_">Array</span>(<span class="hljs-number">10000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({
  <span class="hljs-attr">status</span>: i % <span class="hljs-number">2</span> === <span class="hljs-number">0</span> ? <span class="hljs-string">'paid'</span> : <span class="hljs-string">'pending'</span>,
  <span class="hljs-attr">items</span>: [<span class="hljs-string">`item-<span class="hljs-subst">${i}</span>-a`</span>, <span class="hljs-string">`item-<span class="hljs-subst">${i}</span>-b`</span>]
}));

<span class="hljs-comment">// 方法1：filter + map + flat</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'filter-map-flat'</span>);
<span class="hljs-keyword">const</span> r1 = orders
  .<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span>)
  .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> o.<span class="hljs-property">items</span>)
  .<span class="hljs-title function_">flat</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'filter-map-flat'</span>); <span class="hljs-comment">// ~2.5ms</span>

<span class="hljs-comment">// 方法2：flatMap</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'flatMap'</span>);
<span class="hljs-keyword">const</span> r2 = orders.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span>
  o.<span class="hljs-property">status</span> === <span class="hljs-string">'paid'</span> ? o.<span class="hljs-property">items</span> : []
);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'flatMap'</span>); <span class="hljs-comment">// ~1.2ms</span>

<span class="hljs-comment">// flatMap 快 2 倍！</span>
</code></pre>
<h3 data-id="heading-26">使用口诀</h3>
<ol>
<li><strong>能一次遍历做完，绝不用两次</strong>（filter + map → flatMap）</li>
<li><strong>需要条件过滤 + 转换 → flatMap</strong></li>
<li><strong>需要展开嵌套数组 → flatMap</strong></li>
<li><strong>flatMap 只扁平一层，深度扁平需要递归</strong></li>
<li><strong>大数据量优先用 flatMap 减少中间数组创建</strong></li>
</ol>
<hr/>
<h2 data-id="heading-27">第五部分：常见踩坑记录</h2>
<h3 data-id="heading-28">坑 1：误用 ?? 或 || 导致数据丢失</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> data = [<span class="hljs-number">0</span>, <span class="hljs-string">''</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">undefined</span>];

<span class="hljs-comment">// ❌ 错误：会过滤掉 0、''、false</span>
<span class="hljs-keyword">const</span> wrong = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x || []); <span class="hljs-comment">// []</span>
<span class="hljs-keyword">const</span> wrong2 = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> (x ?? [])[<span class="hljs-number">0</span>] ? [x] : []); 

<span class="hljs-comment">// ✅ 正确：只过滤 null/undefined</span>
<span class="hljs-keyword">const</span> right = data.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x != <span class="hljs-literal">null</span> ? [x] : []); 
<span class="hljs-comment">// [0, '', false]</span>
</code></pre>
<h3 data-id="heading-29">坑 2：async 函数不能直接用于 flatMap</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> ids = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];

<span class="hljs-comment">// ❌ 错误：flatMap 不会等待 Promise</span>
<span class="hljs-keyword">const</span> wrong = ids.<span class="hljs-title function_">flatMap</span>(<span class="hljs-keyword">async</span> id =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/<span class="hljs-subst">${id}</span>`</span>);
  <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>();
});
<span class="hljs-comment">// 返回的是 [Promise, Promise, Promise]</span>

<span class="hljs-comment">// ✅ 正确：先通过 Promise.all 等待所有异步操作完成，再用 flatMap 扁平数据</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchAndProcess</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 第一步：等待所有接口请求 + json 解析完成</span>
  <span class="hljs-keyword">const</span> dataList = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
    ids.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">async</span> id =&gt; {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/<span class="hljs-subst">${id}</span>`</span>);
        <span class="hljs-keyword">if</span> (!res.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`请求失败：<span class="hljs-subst">${res.status}</span>`</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>(); <span class="hljs-comment">// 关键：等待 json 解析（原示例遗漏 await）</span>
      } <span class="hljs-keyword">catch</span> (err) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`处理 id=<span class="hljs-subst">${id}</span> 失败：`</span>, err);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">items</span>: [] }; <span class="hljs-comment">// 异常兜底，避免 flatMap 出错</span>
      }
    })
  );

  <span class="hljs-comment">// 第二步：用 flatMap 扁平 items 数组</span>
  <span class="hljs-keyword">const</span> results = dataList.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">items</span> || []);
  <span class="hljs-keyword">return</span> results;
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-title function_">fetchAndProcess</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"最终结果："</span>, results);
});
</code></pre>
<h3 data-id="heading-30">坑 3：返回非数组会报错</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> nums = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];

<span class="hljs-comment">// ❌ 错误：回调返回非数组（数字），flatMap 会抛出 TypeError</span>
<span class="hljs-comment">// const wrong = nums.flatMap(n =&gt; n * 2); </span>
<span class="hljs-comment">// 报错信息：TypeError: Iterator value 2 is not an entry object</span>

<span class="hljs-comment">// ✅ 正确：回调必须返回数组，flatMap 会自动扁平单层数组</span>
<span class="hljs-keyword">const</span> right = nums.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> [n * <span class="hljs-number">2</span>]); <span class="hljs-comment">// [2, 4, 6]</span>

<span class="hljs-comment">// 拓展：如果需要多层扁平（比如返回嵌套数组），可用 flatMap + flat</span>
<span class="hljs-keyword">const</span> nestedRight = nums.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">n</span> =&gt;</span> [[n * <span class="hljs-number">2</span>]]).<span class="hljs-title function_">flat</span>(); <span class="hljs-comment">// [2, 4, 6]</span>
</code></pre>
<hr/>
<h2 data-id="heading-31">总结</h2>
<p>经过 3 个项目的实战检验，flatMap 是我使用频率最高的数组方法之一。它的核心优势：</p>

























<table><thead><tr><th>优势</th><th>说明</th></tr></thead><tbody><tr><td>性能</td><td>减少遍历次数，大数据量时优势明显</td></tr><tr><td>简洁</td><td>filter + map 合并成一行代码</td></tr><tr><td>灵活</td><td>支持条件展开、动态返回 0/1/N 个元素</td></tr><tr><td>组合</td><td>可链式调用，构建数据处理管道</td></tr></tbody></table>
<p><strong>记住核心心法</strong>：</p>
<ul>
<li>需要「条件过滤 + 转换」→ flatMap</li>
<li>需要「展开嵌套」→ flatMap</li>
<li>能一次遍历 → 绝不用两次</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么删除 node_modules 这么慢？原因和解决方案一次讲清]]></title>    <link>https://juejin.cn/post/7604881286036979764</link>    <guid>https://juejin.cn/post/7604881286036979764</guid>    <pubDate>2026-02-10T07:53:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604881286036979764" data-draft-id="7603588665568641064" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么删除 node_modules 这么慢？原因和解决方案一次讲清"/> <meta itemprop="keywords" content="前端,Node.js"/> <meta itemprop="datePublished" content="2026-02-10T07:53:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么删除 node_modules 这么慢？原因和解决方案一次讲清
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T07:53:37.000Z" title="Tue Feb 10 2026 07:53:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是大华！</p>
<p>经常写前端的朋友一定很熟悉，每次删除 <code>node_modules</code> 文件夹的时候都特别慢，甚至有时候还会提示权限不足。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/340b585c2b65484398a1671b532fbff6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771314817&amp;x-signature=3O5DvYurzoyO28Zm9HbY3dMBtTk%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">node_modules 是什么？</h2>
<p>简单来说，<code>node_modules</code> 就是项目里存放所有依赖包的地方。每当你用 <code>npm install</code> 或 <code>yarn</code> 安装依赖时，所有依赖和它们的依赖，都会被下载到这个文件夹里。</p>
<p>它是 Node.js 项目中非常核心的一个文件夹，没有它，项目无法运行。</p>
<hr/>
<h2 data-id="heading-1">node_modules 的作用</h2>
<p><code>node_modules</code> 的作用就是存放项目依赖。
举个例子，我的项目用到了 <code>lodash</code>、<code>axios</code>、<code>vue</code>，对应的依赖安装后，这些包都会放到 <code>node_modules</code> 文件夹里，在代码里有用 <code>import</code> 或 <code>require</code> 引入的时候，Node 都会去 <code>node_modules</code> 里寻找对应的模块。</p>
<p>可以理解为，它是项目的一个依赖仓库，所有功能模块都靠它支撑。</p>
<hr/>
<h2 data-id="heading-2">为什么 node_modules 会这么大？</h2>
<p>如果你打开一个前端项目，依赖安装后，你发现 <code>node_modules</code> 可能会有几百 MB 或者几 GB 的大小，这有几个原因：</p>
<h3 data-id="heading-3">1. 依赖嵌套</h3>
<p>每个包都有自己的依赖，npm 或 yarn 会把它们都下载下来。例如 <code>vue-router</code> 依赖 <code>vue</code>，<code>axios</code> 依赖 <code>follow-redirects</code>，它们又有自己的依赖，一层层叠加，导致文件数量和体积剧增。</p>
<h3 data-id="heading-4">2. 大量小文件</h3>
<p>Node 包里通常会包含源码、文档、测试文件等大量小文件。虽然每个文件不大，但数量非常多，文件总数动不动就几十万，操作系统处理这么多小文件非常耗时。</p>
<h3 data-id="heading-5">3. 版本兼容问题</h3>
<p>有时候同一个依赖会出现多个版本共存，每个版本都会占用额外空间，进一步膨胀 <code>node_modules</code>。</p>
<h3 data-id="heading-6">示例：一个Vue项目的依赖规模</h3>
<pre><code class="hljs language-scss" lang="scss">├── vue
├── vue-router
├── vuex
├── axios
├── webpack (及其<span class="hljs-number">15</span>+个直接依赖)
├── babel (及其<span class="hljs-number">20</span>+个插件)
└── 其他工具链...
</code></pre>
<p>实际安装后可能包含300-1000+个目录，占用数百MB甚至GB级空间。</p>
<hr/>
<h2 data-id="heading-7">为什么删除 node_modules 文件夹这么耗时？</h2>
<p>我自己在 Windows 或 macOS 上都有过这样的体验：右键删除或者用命令 <code>rm -rf node_modules</code>，都可能卡上几分钟甚至十几分钟。</p>
<p>原因主要有：</p>
<h3 data-id="heading-8">1. 文件数量巨大</h3>
<p>node_modules通常包含成千上万个小文件，操作系统删除大量小文件比删除单个大文件慢得多</p>
<h3 data-id="heading-9">2. 目录结构深</h3>
<p>深层嵌套的目录结构需要递归遍历，增加I/O操作</p>
<h3 data-id="heading-10">3. Windows的特殊性</h3>
<p>NTFS文件系统处理大量小文件效率较低，防病毒软件实时扫描每个删除操作，路径长度限制（260字符）导致额外处理</p>
<h3 data-id="heading-11">4. 磁盘I/O瓶颈</h3>
<p>机械硬盘（HDD）在随机读写小文件时性能较差，SSD稍好但仍受限制</p>
<h2 data-id="heading-12">删除node_modules文件夹的几种方案</h2>
<h3 data-id="heading-13">方案1：原生命令行删除（跨平台）</h3>
<p><strong>Windows (PowerShell):</strong></p>
<pre><code class="hljs language-powershell" lang="powershell"># 方法1：使用Remove-Item
Remove-Item -Path .\node_modules -Recurse -Force

# 方法2：使用rd命令（更快）
rd /s /q node_modules
</code></pre>
<p>也可以写个脚本，创建一个<code>clean.bat</code>文件</p>
<pre><code class="hljs language-bash" lang="bash">@<span class="hljs-built_in">echo</span> off
<span class="hljs-built_in">echo</span> 开始清理node_modules，可以去摸鱼了...
rd /s /q node_modules
<span class="hljs-built_in">echo</span> 清理完成！可以继续干活了
pause
</code></pre>
<p>然后双击运行就可以。</p>
<p><strong>macOS/Linux:</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用rm命令</span>
<span class="hljs-built_in">rm</span> -rf node_modules
</code></pre>
<h3 data-id="heading-14">方案2：使用专用删除工具</h3>
<p><strong>rimraf（Node.js工具）：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 全局安装</span>
npm install -g rimraf

<span class="hljs-comment"># 在项目目录使用</span>
rimraf node_modules

<span class="hljs-comment"># 或使用npx（无需安装）</span>
npx rimraf node_modules
</code></pre>
<p><strong>快速删除脚本（Windows批处理）：</strong></p>
<pre><code class="hljs language-batch" lang="batch">@echo off
echo 正在删除node_modules...
rmdir /s /q node_modules
echo 删除完成！
pause
</code></pre>
<h3 data-id="heading-15">方案3：使用包管理器的清理功能</h3>
<p><strong>使用npm：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># npm v6.5+ 新增的清理命令</span>
npm clean-install

<span class="hljs-comment"># 或先删除再安装</span>
npm ci
</code></pre>
<p><strong>使用yarn：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># yarn的自动清理</span>
yarn clean

<span class="hljs-comment"># 使用Plug'n'Play模式（避免node_modules）</span>
yarn --pnp
</code></pre>
<p><strong>使用pnpm：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm使用硬链接，删除更快</span>
pnpm store prune  <span class="hljs-comment"># 清理存储</span>
pnpm install
</code></pre>
<h3 data-id="heading-16">方案4：操作系统级优化</h3>
<p><strong>Windows优化：</strong></p>
<ol>
<li>临时禁用防病毒软件</li>
<li>使用管理员权限运行命令行</li>
<li>使用快速删除工具（如FastDelete）</li>
</ol>
<p><strong>macOS/Linux优化：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用rsync技巧（有时更快）</span>
rsync -a --delete empty_dir/ node_modules/
</code></pre>
<h3 data-id="heading-17">方案5：避免频繁删除</h3>
<ol>
<li><strong>使用Docker容器</strong>：在容器内开发，删除容器即可</li>
<li><strong>使用虚拟机或WSL2</strong>：隔离环境</li>
<li><strong>依赖缓存策略</strong>：合理配置npm/yarn缓存</li>
</ol>
<h3 data-id="heading-18">方案6：现代包管理器的优势</h3>
<p><strong>pnpm解决方案：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm使用符号链接和内容寻址存储</span>
<span class="hljs-comment"># node_modules很小，主要文件在全局存储</span>
pnpm install  <span class="hljs-comment"># 安装快，删除也快</span>
</code></pre>
<p><strong>Yarn Plug'n'Play：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"installConfig"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"pnp"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
<span class="hljs-comment">// 无需node_modules目录</span>
</code></pre>
<hr/>
<h2 data-id="heading-19">写在最后</h2>
<p><code>node_modules</code> 删除慢，并不是你电脑的问题，也不是你操作不对，而是 Node 生态本身的历史包袱。</p>
<p>如果你只是偶尔删一次，用命令行或者 rimraf 就够了；
如果你经常重装依赖、切分支、拉项目，那我会强烈建议你试试 pnpm 或 Yarn PnP，真的能明显改善体验。</p>
<blockquote>
<p>本文首发于公众号：程序员大华，专注前端、Java开发，AI应用和工具的分享。关注我，少走弯路，一起进步！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你可能从未用过的浏览器 API：IndexedDB 实战入门]]></title>    <link>https://juejin.cn/post/7604694326518431795</link>    <guid>https://juejin.cn/post/7604694326518431795</guid>    <pubDate>2026-02-10T01:59:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604694326518431795" data-draft-id="7604694326518415411" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你可能从未用过的浏览器 API：IndexedDB 实战入门"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-10T01:59:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员_June"/> <meta itemprop="url" content="https://juejin.cn/user/395479916219517"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你可能从未用过的浏览器 API：IndexedDB 实战入门
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/395479916219517/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员_June
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:59:23.000Z" title="Tue Feb 10 2026 01:59:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前端开发这几年，localStorage 和 sessionStorage 用得最多，cookie 偶尔也要打打交道。但说到 IndexedDB，很多人的反应是：“听说过，但没用过。”</p>
<p>今天聊聊这个被低估的浏览器内置数据库。</p>
<h2 data-id="heading-0">一、为什么需要另一个存储方案？</h2>
<p>先看个实际场景。朋友公司做电商后台，产品经理要求：“能不能在列表页缓存 5000 条商品数据，让筛选和搜索快一点？”</p>
<p>第一版用 localStorage：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 存储</span>
<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'products'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(products)) <span class="hljs-comment">// 5000条数据，页面卡了2秒</span>

<span class="hljs-comment">// 搜索</span>
<span class="hljs-keyword">const</span> keyword = <span class="hljs-string">'手机'</span>
<span class="hljs-keyword">const</span> allProducts = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'products'</span>)) <span class="hljs-comment">// 又卡1秒</span>
<span class="hljs-keyword">const</span> results = allProducts.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> p.<span class="hljs-property">name</span>.<span class="hljs-title function_">includes</span>(keyword)) <span class="hljs-comment">// 遍历5000次</span>
</code></pre>
<p>上线后用户反馈：“筛选时浏览器像卡住了一样。”</p>
<p>问题在哪？localStorage 有硬伤：</p>
<ul>
<li>同步操作，数据量大就阻塞页面</li>
<li>只能存字符串，对象要序列化</li>
<li>容量小（通常 5-10MB）</li>
<li>只能全量读取，无法高效查询</li>
</ul>
<h2 data-id="heading-1">二、IndexedDB 是什么？</h2>
<p>简单说，<strong>它是浏览器里的 NoSQL 数据库</strong>。2011 年就出现了，但很多人不知道或觉得“用不上”。</p>
<p>几个关键特点：</p>
<ol>
<li><strong>容量大</strong>：通常能占硬盘 50%，几个 GB 没问题</li>
<li><strong>异步操作</strong>：不卡页面</li>
<li><strong>支持索引</strong>：查询速度快</li>
<li><strong>能存多种类型</strong>：对象、文件、二进制数据都行</li>
</ol>
<h2 data-id="heading-2">三、一个简单示例</h2>
<p>如果你没用过，先看看基本用法：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 打开数据库</span>
<span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'myDB'</span>, <span class="hljs-number">1</span>)

<span class="hljs-comment">// 2. 创建表结构（第一次或升级时）</span>
request.<span class="hljs-property">onupgradeneeded</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>
  
  <span class="hljs-comment">// 创建对象存储（类似表）</span>
  <span class="hljs-keyword">const</span> store = db.<span class="hljs-title function_">createObjectStore</span>(<span class="hljs-string">'products'</span>, {
    <span class="hljs-attr">keyPath</span>: <span class="hljs-string">'id'</span>,      <span class="hljs-comment">// 主键</span>
    <span class="hljs-attr">autoIncrement</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 自动生成ID</span>
  })
  
  <span class="hljs-comment">// 创建索引（加速查询的关键）</span>
  store.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'name'</span>)      <span class="hljs-comment">// 按名称查</span>
  store.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">'price'</span>, <span class="hljs-string">'price'</span>)    <span class="hljs-comment">// 按价格查</span>
  store.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">'category'</span>, <span class="hljs-string">'category'</span>) <span class="hljs-comment">// 按分类查</span>
}

<span class="hljs-comment">// 3. 数据库就绪</span>
request.<span class="hljs-property">onsuccess</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'数据库已就绪'</span>)
}
</code></pre>
<h2 data-id="heading-3">四、核心优势：查询性能</h2>
<p>这是 IndexedDB 真正厉害的地方。同样的 5000 条商品数据，查询完全不同：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用索引查，不需要遍历所有数据</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">searchProducts</span>(<span class="hljs-params">keyword</span>) {
  <span class="hljs-keyword">const</span> transaction = db.<span class="hljs-title function_">transaction</span>([<span class="hljs-string">'products'</span>], <span class="hljs-string">'readonly'</span>)
  <span class="hljs-keyword">const</span> store = transaction.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'products'</span>)
  <span class="hljs-keyword">const</span> index = store.<span class="hljs-title function_">index</span>(<span class="hljs-string">'name'</span>) <span class="hljs-comment">// 使用索引</span>
  
  <span class="hljs-comment">// 只搜索相关范围</span>
  <span class="hljs-keyword">const</span> range = <span class="hljs-title class_">IDBKeyRange</span>.<span class="hljs-title function_">bound</span>(keyword, keyword + <span class="hljs-string">'\uffff'</span>)
  <span class="hljs-keyword">const</span> request = index.<span class="hljs-title function_">openCursor</span>(range)
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> results = []
    request.<span class="hljs-property">onsuccess</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
      <span class="hljs-keyword">const</span> cursor = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>
      <span class="hljs-keyword">if</span> (cursor) {
        results.<span class="hljs-title function_">push</span>(cursor.<span class="hljs-property">value</span>)
        cursor.<span class="hljs-title function_">continue</span>() <span class="hljs-comment">// 继续下一个</span>
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-title function_">resolve</span>(results) <span class="hljs-comment">// 搜索完成</span>
      }
    }
  })
}

<span class="hljs-comment">// 毫秒级响应，不卡页面</span>
<span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title function_">searchProducts</span>(<span class="hljs-string">'手机'</span>)
</code></pre>
<p>你可以创建多个索引，实现各种复杂查询：</p>
<ul>
<li>价格区间筛选</li>
<li>多条件组合查询</li>
<li>分类统计</li>
<li>模糊搜索</li>
</ul>
<h2 data-id="heading-4">五、适用场景</h2>
<p>什么情况下该考虑 IndexedDB？</p>
<h3 data-id="heading-5">1. 离线应用</h3>
<p>邮件客户端、文档编辑器、笔记应用。数据先存本地，有网再同步。</p>
<h3 data-id="heading-6">2. 大数据缓存</h3>
<p>电商商品目录、大量配置项、历史数据。替代接口频繁请求。</p>
<h3 data-id="heading-7">3. 文件管理</h3>
<p>图片、PDF、音视频的本地缓存。不用每次都下载。</p>
<h3 data-id="heading-8">4. 游戏数据</h3>
<p>存档、配置、资源文件。支持离线游戏。</p>
<h3 data-id="heading-9">5. 分析数据</h3>
<p>收集用户行为，批量上传。避免频繁网络请求。</p>
<h2 data-id="heading-10">六、实用建议</h2>
<h3 data-id="heading-11">1. 用封装库简化开发</h3>
<p>原生 API 确实有点繁琐。推荐这些库：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 用 idb 库（推荐）</span>
<span class="hljs-keyword">import</span> { openDB } <span class="hljs-keyword">from</span> <span class="hljs-string">'idb'</span>

<span class="hljs-keyword">const</span> db = <span class="hljs-keyword">await</span> <span class="hljs-title function_">openDB</span>(<span class="hljs-string">'my-db'</span>, <span class="hljs-number">1</span>, {
  <span class="hljs-title function_">upgrade</span>(<span class="hljs-params">db</span>) {
    db.<span class="hljs-title function_">createObjectStore</span>(<span class="hljs-string">'products'</span>)
  }
})

<span class="hljs-comment">// 操作简单多了</span>
<span class="hljs-keyword">await</span> db.<span class="hljs-title function_">add</span>(<span class="hljs-string">'products'</span>, { <span class="hljs-attr">name</span>: <span class="hljs-string">'商品1'</span>, <span class="hljs-attr">price</span>: <span class="hljs-number">100</span> })
<span class="hljs-keyword">const</span> products = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">getAll</span>(<span class="hljs-string">'products'</span>)
</code></pre>
<h3 data-id="heading-12">2. 渐进增强</h3>
<p>先判断支持性，不支持就降级：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getStorage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-string">'indexedDB'</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">window</span>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'indexedDB'</span>,
      <span class="hljs-attr">save</span>: saveToIndexedDB,
      <span class="hljs-attr">load</span>: loadFromIndexedDB
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'降级到 localStorage'</span>)
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'localStorage'</span>,
      <span class="hljs-attr">save</span>: saveToLocalStorage,
      <span class="hljs-attr">load</span>: loadFromLocalStorage
    }
  }
}
</code></pre>
<h3 data-id="heading-13">3. 注意版本迁移</h3>
<p>修改表结构需要升级版本：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> request = indexedDB.<span class="hljs-title function_">open</span>(<span class="hljs-string">'myDB'</span>, <span class="hljs-number">2</span>) <span class="hljs-comment">// 版本号+1</span>

request.<span class="hljs-property">onupgradeneeded</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> db = event.<span class="hljs-property">target</span>.<span class="hljs-property">result</span>
  <span class="hljs-keyword">const</span> oldVersion = event.<span class="hljs-property">oldVersion</span>
  
  <span class="hljs-keyword">if</span> (oldVersion &lt; <span class="hljs-number">1</span>) {
    <span class="hljs-comment">// 初始版本逻辑</span>
  }
  
  <span class="hljs-keyword">if</span> (oldVersion &lt; <span class="hljs-number">2</span>) {
    <span class="hljs-comment">// 版本2的升级逻辑</span>
    <span class="hljs-comment">// 比如添加新索引</span>
    <span class="hljs-keyword">const</span> store = event.<span class="hljs-property">currentTarget</span>.<span class="hljs-property">transaction</span>.<span class="hljs-title function_">objectStore</span>(<span class="hljs-string">'products'</span>)
    store.<span class="hljs-title function_">createIndex</span>(<span class="hljs-string">'createdAt'</span>, <span class="hljs-string">'createdAt'</span>)
  }
}
</code></pre>
<h2 data-id="heading-14">七、什么时候不用？</h2>
<p>IndexedDB 虽好，但也不是万能：</p>
<ul>
<li>存个用户 token → 用 localStorage 或 cookie</li>
<li>会话级临时数据 → 用 sessionStorage</li>
<li>简单配置项 → localStorage 更方便</li>
<li>需要服务端读取 → cookie</li>
</ul>
<p>记住：<strong>技术选型要看具体需求</strong>，不是越高级越好。</p>
<h2 data-id="heading-15">八、开始尝试</h2>
<p>如果你从没用过 IndexedDB，可以从这些开始：</p>
<ol>
<li><strong>缓存接口数据</strong>：把频繁请求的 API 结果缓存起来</li>
<li><strong>离线收藏功能</strong>：用户收藏的内容存本地</li>
<li><strong>图片懒加载缓存</strong>：看过的图片存起来</li>
<li><strong>表单草稿</strong>：复杂的表单数据实时保存</li>
</ol>
<p>不需要一开始就大动干戈。找个合适的场景，先试试水。</p>
<h2 data-id="heading-16">写在最后</h2>
<p>IndexedDB 在前端领域存在感不强，可能因为它解决的问题不是每个项目都会遇到。但当你真的需要处理大量客户端数据时，它会是个很好的选择。</p>
<p><strong>技术没有绝对的好坏，只有合适与否</strong>。知道它的存在，了解它的能力，当合适的需求出现时，你就能做出更好的选择。</p>
<hr/>
<p>看完有点兴趣了？可以在个人项目里试试 IndexedDB，遇到问题欢迎交流。如果你已经在用，有什么经验或踩坑故事？评论区聊聊。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[秒杀系统如何避免账户余额扣减的竞态条件？]]></title>    <link>https://juejin.cn/post/7604672395627118619</link>    <guid>https://juejin.cn/post/7604672395627118619</guid>    <pubDate>2026-02-10T01:00:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604672395627118619" data-draft-id="7604672395626545179" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="秒杀系统如何避免账户余额扣减的竞态条件？"/> <meta itemprop="keywords" content="后端,Java,Redis"/> <meta itemprop="datePublished" content="2026-02-10T01:00:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨中飘荡的记忆"/> <meta itemprop="url" content="https://juejin.cn/user/694547077666606"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            秒杀系统如何避免账户余额扣减的竞态条件？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/694547077666606/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨中飘荡的记忆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T01:00:41.000Z" title="Tue Feb 10 2026 01:00:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">秒杀系统如何避免账户余额扣减的竞态条件？</h2>
<blockquote>
<p>从理论到实践，深入解析并发控制机制在秒杀场景中的应用</p>
</blockquote>
<h3 data-id="heading-1">一、什么是竞态条件？</h3>
<h4 data-id="heading-2">1.1 定义与场景</h4>
<p>在并发编程中，当多个线程或进程同时访问和修改共享资源时，最终的执行结果依赖于执行顺序的现象称为<strong>竞态条件（Race Condition）</strong>。</p>
<h4 data-id="heading-3">1.2 一个真实的例子</h4>
<p>想象这样的场景：用户账户余额100元，两个线程同时扣减50元。</p>
<p><strong>期望结果</strong>：100 - 50 - 50 = 0元</p>
<p><strong>实际结果</strong>：账户余额还剩50元，丢失了50元的更新！</p>
<h4 data-id="heading-4">1.3 问题分析</h4>
<p><strong>原因</strong>：</p>
<ol>
<li>线程A读取余额：100元</li>
<li>线程B读取余额：100元（此时线程A还未提交）</li>
<li>线程A计算并更新：100 - 50 = 50元</li>
<li>线程B计算并更新：100 - 50 = 50元</li>
<li>线程B的更新覆盖了线程A的更新</li>
</ol>
<p>这就是典型的**丢失更新（Lost Update）**问题。</p>
<h4 data-id="heading-5">1.4 竞态条件流程图</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b2448a1d96c4eaf838ad799e1c266ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=VW7mVSLhCeRyyaqxUFJZpwQGvD4%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-6">二、解决方案一：悲观锁</h3>
<h4 data-id="heading-7">2.1 什么是悲观锁？</h4>
<p>悲观锁假设会发生并发冲突，因此在访问数据前先获取锁。</p>
<p><strong>核心思想</strong>：先获取锁，再操作数据</p>
<h4 data-id="heading-8">2.2 数据库实现方式</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询时加排他锁</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;

<span class="hljs-comment">-- 更新余额</span>
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">50</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- 提交事务释放锁</span>
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h4 data-id="heading-9">2.3 Java代码实现</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductBalancePessimistic</span><span class="hljs-params">(Long userId, Long amount)</span> {
    <span class="hljs-comment">// 1. 查询并加锁</span>
    <span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> accountMapper.selectById(userId);

    <span class="hljs-comment">// 2. 检查余额</span>
    <span class="hljs-keyword">if</span> (account.getBalance().compareTo(amount) &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

    <span class="hljs-comment">// 3. 扣减余额</span>
    account.setBalance(account.getBalance().subtract(amount));
    <span class="hljs-keyword">return</span> accountMapper.updateById(account) &gt; <span class="hljs-number">0</span>;
}
</code></pre>
<h4 data-id="heading-10">2.4 悲观锁的优缺点</h4>
<p><strong>优点</strong>：</p>
<ul>
<li>实现简单，逻辑直观</li>
<li>强一致性保证</li>
<li>适合高冲突场景</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>并发性能低，线程阻塞等待</li>
<li>数据库压力大</li>
<li>可能发生死锁</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>并发量不高的场景</li>
<li>强一致性要求的场景</li>
<li>冲突率高的写操作</li>
</ul>
<h4 data-id="heading-11">2.5 生产环境最佳实践</h4>
<p><strong>缩小锁粒度</strong>：只锁定必要的数据，避免锁定整个用户对象</p>
<p><strong>控制事务时间</strong>：事务内只做数据库操作，远程调用放到事务外</p>
<p><strong>批量操作</strong>：合并多个单次更新为批量更新，减少锁竞争</p>
<hr/>
<h3 data-id="heading-12">三、解决方案二：乐观锁</h3>
<h4 data-id="heading-13">3.1 什么是乐观锁？</h4>
<p>乐观锁假设不会发生并发冲突，只在提交时检查。</p>
<p><strong>核心思想</strong>：假设无冲突，提交时检查版本号</p>
<h4 data-id="heading-14">3.2 版本号机制实现</h4>
<p><strong>数据库表设计</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> account (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    user_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    balance <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">20</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    version <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,  <span class="hljs-comment">-- 乐观锁版本号</span>
    update_time DATETIME <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);
</code></pre>
<p><strong>SQL更新语句</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- CAS更新</span>
<span class="hljs-keyword">UPDATE</span> account
<span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">50</span>, version <span class="hljs-operator">=</span> version <span class="hljs-operator">+</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> version <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
</code></pre>
<h4 data-id="heading-15">3.3 Java代码实现（带重试）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductBalanceOptimistic</span><span class="hljs-params">(Long userId, Long amount)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
    <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">while</span> (retryCount &lt; maxRetries) {
        <span class="hljs-comment">// 1. 查询账户（获取当前版本号）</span>
        <span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> accountMapper.selectById(userId);

        <span class="hljs-keyword">if</span> (account.getBalance().compareTo(amount) &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// 2. CAS更新（比较并交换）</span>
        <span class="hljs-type">Account</span> <span class="hljs-variable">updateAccount</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Account</span>();
        updateAccount.setId(account.getId());
        updateAccount.setBalance(account.getBalance().subtract(amount));
        updateAccount.setVersion(account.getVersion());

        <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> accountMapper.updateById(updateAccount);

        <span class="hljs-keyword">if</span> (rows &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 更新成功</span>
        }

        <span class="hljs-comment">// 3. 更新失败，版本号已变化，重试</span>
        retryCount++;
        Thread.sleep(Math.min(<span class="hljs-number">100L</span> * (<span class="hljs-number">1L</span> &lt;&lt; retryCount), <span class="hljs-number">1000L</span>));
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h4 data-id="heading-16">3.4 乐观锁的优缺点</h4>
<p><strong>优点</strong>：</p>
<ul>
<li>并发性能高，无锁操作</li>
<li>不会发生死锁</li>
<li>数据库压力小</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>高冲突下频繁重试，性能下降</li>
<li>可能ABA问题（可加版本号解决）</li>
<li>需要处理重试逻辑</li>
</ul>
<p><strong>适用场景</strong>：</p>
<ul>
<li>并发量高的场景</li>
<li>冲突率低的场景</li>
<li>读多写少的场景</li>
</ul>
<h4 data-id="heading-17">3.5 生产环境最佳实践</h4>
<p><strong>动态重试次数</strong>：根据历史冲突率动态调整重试次数（3-10次）</p>
<p><strong>快速失败策略</strong>：第一次冲突后立即返回错误，让调用方决定是否重试</p>
<p><strong>指数退避</strong>：重试等待时间按指数增长（100ms → 200ms → 400ms...）</p>
<hr/>
<h3 data-id="heading-18">四、解决方案三：Redis分布式锁</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7b7264ed4d94780ac78c2dad041ea08~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=HmRZO0JY%2FfUBmy2cMXtkMBr79Eg%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-19">4.1 为什么需要分布式锁？</h4>
<p>在分布式系统中，JVM锁只能锁住当前JVM实例，无法跨服务节点。</p>
<h4 data-id="heading-20">4.2 Redis SET命令实现</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 加锁命令</span>
SET lock_key unique_value NX PX 30000

<span class="hljs-comment"># 参数说明：</span>
<span class="hljs-comment"># NX: 不存在才设置</span>
<span class="hljs-comment"># PX: 过期时间（毫秒）</span>
<span class="hljs-comment"># unique_value: 唯一标识，防止误删</span>
</code></pre>
<h4 data-id="heading-21">4.3 解锁Lua脚本（保证原子性）</h4>
<pre><code class="hljs language-lua" lang="lua"><span class="hljs-keyword">if</span> redis.call(<span class="hljs-string">"get"</span>, KEYS[<span class="hljs-number">1</span>]) == ARGV[<span class="hljs-number">1</span>] <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">return</span> redis.call(<span class="hljs-string">"del"</span>, KEYS[<span class="hljs-number">1</span>])
<span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h4 data-id="heading-22">4.4 Java代码实现（Redisson）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> RedissonClient redissonClient;

<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductBalanceWithDistributedLock</span><span class="hljs-params">(Long userId, Long amount)</span> {
    <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"account:lock:"</span> + userId;
    <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(lockKey);

    <span class="hljs-type">boolean</span> <span class="hljs-variable">acquired</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 尝试获取锁</span>
        acquired = lock.tryLock(<span class="hljs-number">10</span>, <span class="hljs-number">30</span>, TimeUnit.SECONDS);

        <span class="hljs-keyword">if</span> (!acquired) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        <span class="hljs-comment">// 执行业务逻辑</span>
        <span class="hljs-type">Account</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> accountMapper.selectById(userId);
        <span class="hljs-keyword">if</span> (account.getBalance().compareTo(amount) &lt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }

        account.setBalance(account.getBalance().subtract(amount));
        <span class="hljs-keyword">return</span> accountMapper.updateById(account) &gt; <span class="hljs-number">0</span>;

    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (acquired &amp;&amp; lock.isHeldByCurrentThread()) {
            lock.unlock();
        }
    }
}
</code></pre>
<h4 data-id="heading-23">4.5 Redis分布式锁的关键点</h4>
<ol>
<li><strong>NX参数</strong>：只有key不存在时才设置，防止覆盖</li>
<li><strong>PX参数</strong>：设置过期时间，防止死锁</li>
<li><strong>unique_value</strong>：唯一标识，防止误删其他线程的锁</li>
<li><strong>Lua脚本</strong>：保证解锁操作的原子性</li>
<li><strong>看门狗</strong>：Redisson自动续期，防止业务未执行完锁过期</li>
<li><strong>RedLock</strong>：多节点部署，提高可用性</li>
</ol>
<h4 data-id="heading-24">4.6 生产环境最佳实践</h4>
<p><strong>超时时间设置</strong>：根据业务类型设置合理的超时时间（通常为历史平均执行时间的3-5倍）</p>
<p><strong>可重入性</strong>：同一线程可多次获取同一把锁，避免死锁</p>
<p><strong>监控告警</strong>：监控锁持有时间、等待时间，设置告警阈值</p>
<hr/>
<h3 data-id="heading-25">五、三种锁的详细对比</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3423497cec804a72989043b70008d028~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=CI89AwGCCvvfAEOWOEE4lKOmra8%3D" alt="" loading="lazy"/></p>

































































<table><thead><tr><th>对比维度</th><th>悲观锁</th><th>乐观锁</th><th>分布式锁</th></tr></thead><tbody><tr><td>低并发场景</td><td>性能接近</td><td>性能接近</td><td>性能接近</td></tr><tr><td>高并发场景</td><td>锁竞争严重</td><td>性能更优</td><td>性能较好</td></tr><tr><td>冲突率高</td><td>适合</td><td>频繁重试</td><td>适合</td></tr><tr><td>冲突率低</td><td>浪费锁资源</td><td>最佳选择</td><td>性能好</td></tr><tr><td>CPU消耗</td><td>低</td><td>高(CAS自旋)</td><td>中</td></tr><tr><td>实现复杂度</td><td>简单</td><td>中等</td><td>中等</td></tr><tr><td>分布式支持</td><td>不支持</td><td>需额外处理</td><td>原生支持</td></tr><tr><td>死锁风险</td><td>有</td><td>无</td><td>无（带过期时间）</td></tr><tr><td>一致性保证</td><td>强</td><td>最终一致</td><td>强</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-26">六、秒杀系统架构设计</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7796fc36dc14e4c9c4ac612b2e9da11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=P2nj8WPLsyUwBNSLlUEnVi0YHJM%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-27">6.1 核心设计思路</h4>
<ol>
<li><strong>Redis预扣库存</strong>：使用DECR原子操作，内存级别响应速度</li>
<li><strong>MQ异步处理</strong>：削峰填谷，订单创建异步化</li>
<li><strong>乐观锁扣减</strong>：版本号CAS机制，保证数据一致性</li>
<li><strong>分库分表</strong>：按user_id分片，水平扩展</li>
<li><strong>读写分离</strong>：1主2从，查询压力分散</li>
<li><strong>限流降级</strong>：Sentinel保护系统稳定性</li>
</ol>
<h4 data-id="heading-28">6.2 秒杀核心流程</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> SeckillResult <span class="hljs-title function_">doSeckill</span><span class="hljs-params">(Long userId, Long activityId, Integer quantity)</span> {
    <span class="hljs-comment">// 1. 检查活动状态</span>
    <span class="hljs-type">SeckillActivity</span> <span class="hljs-variable">activity</span> <span class="hljs-operator">=</span> getActivityFromCache(activityId);

    <span class="hljs-comment">// 2. 检查用户限购</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">limitKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:limit:"</span> + activityId + <span class="hljs-string">":"</span> + userId;
    <span class="hljs-type">Integer</span> <span class="hljs-variable">userBought</span> <span class="hljs-operator">=</span> (Integer) redisTemplate.opsForValue().get(limitKey);
    <span class="hljs-keyword">if</span> (userBought != <span class="hljs-literal">null</span> &amp;&amp; userBought + quantity &gt; activity.getLimitPerUser()) {
        <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"超过限购数量"</span>);
    }

    <span class="hljs-comment">// 3. Redis预扣库存（原子递减）</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">stockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:stock:"</span> + activityId;
    <span class="hljs-type">Long</span> <span class="hljs-variable">remainingStock</span> <span class="hljs-operator">=</span> redisTemplate.opsForValue().decrement(stockKey, quantity);

    <span class="hljs-keyword">if</span> (remainingStock == <span class="hljs-literal">null</span> || remainingStock &lt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 库存不足，回滚</span>
        redisTemplate.opsForValue().increment(stockKey, quantity);
        <span class="hljs-keyword">return</span> SeckillResult.fail(<span class="hljs-string">"库存不足"</span>);
    }

    <span class="hljs-comment">// 4. 记录用户购买数量</span>
    redisTemplate.opsForValue().set(limitKey, userBought + quantity, <span class="hljs-number">1</span>, TimeUnit.HOURS);

    <span class="hljs-comment">// 5. 发送MQ消息（异步创建订单）</span>
    sendOrderMessage(userId, activity, quantity);

    <span class="hljs-comment">// 6. 返回秒杀结果</span>
    <span class="hljs-keyword">return</span> SeckillResult.success(<span class="hljs-string">"秒杀成功，请等待支付"</span>);
}
</code></pre>
<h4 data-id="heading-29">6.3 秒杀流程时序图</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41908935e4fb4362bc59b2fca3ef72ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=S%2FmcWjHjG3LDFWfbf%2Fjqq6Jc1m0%3D" alt="" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-30">七、高性能架构设计</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/660673ca31ae432aae8bf4fa5c3b6651~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=kfFfPeU92dc9hFsTwwq4KYG2KMc%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-31">7.1 多级缓存架构</h4>
<ul>
<li><strong>L1本地缓存</strong>：Caffeine缓存，1秒过期，减少Redis访问</li>
<li><strong>L2分布式缓存</strong>：Redis缓存，5分钟过期，共享数据</li>
<li><strong>L3数据库</strong>：MySQL持久化存储</li>
</ul>
<h4 data-id="heading-32">7.2 库存分桶策略</h4>
<p>将总库存分到多个Redis桶中，秒杀时随机选择桶扣减，降低竞争热度：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 库存预热：分10个桶</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
    <span class="hljs-type">String</span> <span class="hljs-variable">bucketKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:stock:"</span> + activityId + <span class="hljs-string">":bucket:"</span> + i;
    redisTemplate.opsForValue().set(bucketKey, totalStock / <span class="hljs-number">10</span>);
}

<span class="hljs-comment">// 秒杀扣减：随机选择桶</span>
<span class="hljs-type">int</span> <span class="hljs-variable">bucketIndex</span> <span class="hljs-operator">=</span> ThreadLocalRandom.current().nextInt(<span class="hljs-number">10</span>);
<span class="hljs-type">String</span> <span class="hljs-variable">bucketKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"seckill:stock:"</span> + activityId + <span class="hljs-string">":bucket:"</span> + bucketIndex;
redisTemplate.opsForValue().decrement(bucketKey, quantity);
</code></pre>
<h4 data-id="heading-33">7.3 限流保护</h4>
<ul>
<li><strong>QPS限流</strong>：Guava RateLimiter限制总请求量</li>
<li><strong>用户级限流</strong>：Redis + Lua实现用户维度的限流</li>
<li><strong>库存预热</strong>：提前将库存加载到Redis</li>
</ul>
<hr/>
<h3 data-id="heading-34">八、最佳实践</h3>
<h4 data-id="heading-35">8.1 高可用配置</h4>
<p><strong>数据库连接池配置</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">druid:</span>
      <span class="hljs-attr">initial-size:</span> <span class="hljs-number">10</span>
      <span class="hljs-attr">min-idle:</span> <span class="hljs-number">10</span>
      <span class="hljs-attr">max-active:</span> <span class="hljs-number">100</span>
      <span class="hljs-attr">max-wait:</span> <span class="hljs-number">5000</span>
      <span class="hljs-attr">test-while-idle:</span> <span class="hljs-literal">true</span>
      <span class="hljs-attr">time-between-eviction-runs-millis:</span> <span class="hljs-number">60000</span>
</code></pre>
<p><strong>Redis连接池配置</strong>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">lettuce:</span>
      <span class="hljs-attr">pool:</span>
        <span class="hljs-attr">max-active:</span> <span class="hljs-number">50</span>
        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">20</span>
        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">5</span>
        <span class="hljs-attr">max-wait:</span> <span class="hljs-string">3000ms</span>
</code></pre>
<h4 data-id="heading-36">8.2 监控告警</h4>
<p><strong>关键指标</strong>：</p>
<ul>
<li>秒杀成功率</li>
<li>库存扣减P99耗时</li>
<li>Redis连接池使用率</li>
<li>数据库连接池使用率</li>
<li>MQ消息堆积量</li>
</ul>
<p><strong>告警规则</strong>：</p>
<ul>
<li>秒杀成功率 &lt; 95%</li>
<li>库存扣减P99 &gt; 100ms</li>
<li>Redis连接池使用率 &gt; 90%</li>
</ul>
<h4 data-id="heading-37">8.3 熔断降级</h4>
<p>使用Resilience4j实现熔断降级：</p>
<ul>
<li><strong>失败率阈值</strong>：50%</li>
<li><strong>慢调用阈值</strong>：3秒</li>
<li><strong>半开状态允许调用数</strong>：5次</li>
<li><strong>降级策略</strong>：保存到待处理队列，异步处理</li>
</ul>
<h5 data-id="heading-38">8.3.1 熔断器工作原理</h5>
<p>熔断器模式（Circuit Breaker Pattern）是一种保护机制，用于防止系统在某个服务出现故障时持续调用导致雪崩效应。</p>
<p><strong>三种状态</strong>：</p>
<ol>
<li>
<p><strong>关闭状态（CLOSED）</strong>：正常情况下，熔断器关闭，请求正常通过。当失败率超过阈值时，熔断器打开。</p>
</li>
<li>
<p><strong>打开状态（OPEN）</strong>：熔断器打开后，所有请求直接被拒绝，执行降级逻辑。经过一段时间后进入半开状态。</p>
</li>
<li>
<p><strong>半开状态（HALF_OPEN）</strong>：允许少量请求通过，如果这些请求成功，则关闭熔断器；如果失败，则继续打开。</p>
</li>
</ol>
<h5 data-id="heading-39">8.3.2 监控指标实现</h5>
<p><strong>核心监控指标</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MetricsService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> MeterRegistry meterRegistry;

    <span class="hljs-comment">// 秒杀成功次数计数器</span>
    <span class="hljs-keyword">private</span> Counter seckillSuccessCounter;

    <span class="hljs-comment">// 秒杀失败次数计数器</span>
    <span class="hljs-keyword">private</span> Counter seckillFailureCounter;

    <span class="hljs-comment">// 余额扣减成功次数计数器</span>
    <span class="hljs-keyword">private</span> Counter balanceDeductSuccessCounter;

    <span class="hljs-comment">// 余额扣减失败次数计数器</span>
    <span class="hljs-keyword">private</span> Counter balanceDeductFailureCounter;

    <span class="hljs-comment">/**
     * 记录秒杀成功
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordSeckillSuccess</span><span class="hljs-params">(String activityId)</span> {
        seckillSuccessCounter.increment();
    }

    <span class="hljs-comment">/**
     * 记录余额扣减成功
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordBalanceDeductSuccess</span><span class="hljs-params">(String lockType, Long userId)</span> {
        balanceDeductSuccessCounter.increment();
    }

    <span class="hljs-comment">/**
     * 获取监控统计数据
     */</span>
    <span class="hljs-keyword">public</span> MetricsData <span class="hljs-title function_">getMetricsData</span><span class="hljs-params">()</span> {
        <span class="hljs-type">MetricsData</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MetricsData</span>();
        data.setSeckillSuccessCount(seckillSuccessCounter.count());
        data.setSeckillFailureCount(seckillFailureCounter.count());
        data.setBalanceDeductSuccessCount(balanceDeductSuccessCounter.count());
        data.setBalanceDeductFailureCount(balanceDeductFailureCounter.count());

        <span class="hljs-comment">// 计算成功率</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> data.getSeckillSuccessCount() + data.getSeckillFailureCount();
        <span class="hljs-keyword">if</span> (total &gt; <span class="hljs-number">0</span>) {
            data.setSeckillSuccessRate((<span class="hljs-type">double</span>) data.getSeckillSuccessCount() / total * <span class="hljs-number">100</span>);
        }

        <span class="hljs-keyword">return</span> data;
    }
}
</code></pre>
<h5 data-id="heading-40">8.3.3 熔断器配置实现</h5>
<p><strong>Resilience4j熔断器配置</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CircuitBreakerConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CircuitBreakerRegistry <span class="hljs-title function_">circuitBreakerRegistry</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> CircuitBreakerRegistry.of(
            CircuitBreakerConfig.custom()
                .slidingWindowSize(<span class="hljs-number">10</span>)  <span class="hljs-comment">// 滑动窗口大小</span>
                .failureRateThreshold(<span class="hljs-number">50</span>) <span class="hljs-comment">// 失败率阈值50%</span>
                .waitDurationInOpenState(Duration.ofSeconds(<span class="hljs-number">30</span>)) <span class="hljs-comment">// 开启后等待30秒</span>
                .permittedNumberOfCallsInHalfOpenState(<span class="hljs-number">5</span>) <span class="hljs-comment">// 半开状态允许5次调用</span>
                .slowCallRateThreshold(<span class="hljs-number">50</span>) <span class="hljs-comment">// 慢调用率阈值50%</span>
                .slowCallDurationThreshold(Duration.ofSeconds(<span class="hljs-number">3</span>)) <span class="hljs-comment">// 慢调用阈值3秒</span>
                .build(),
            <span class="hljs-string">"balanceDeduct"</span>,  <span class="hljs-comment">// 余额扣减熔断器</span>
            <span class="hljs-string">"seckillService"</span>   <span class="hljs-comment">// 秒杀服务熔断器</span>
        );
    }
}
</code></pre>
<h5 data-id="heading-41">8.3.4 带熔断保护的余额扣减</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeckillServiceWithCircuitBreaker</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CircuitBreakerRegistry circuitBreakerRegistry;

    <span class="hljs-comment">// 待处理队列（降级时保存请求）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Long, AtomicInteger&gt; pendingRequests = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

    <span class="hljs-comment">/**
     * 带熔断保护的余额扣减
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductBalanceWithCircuitBreaker</span><span class="hljs-params">(Long userId, Long amount, String lockType)</span> {
        <span class="hljs-type">CircuitBreaker</span> <span class="hljs-variable">circuitBreaker</span> <span class="hljs-operator">=</span> circuitBreakerRegistry.circuitBreaker(<span class="hljs-string">"balanceDeduct"</span>);

        <span class="hljs-keyword">return</span> Try.of(() -&gt; {
            <span class="hljs-comment">// 检查熔断器状态</span>
            <span class="hljs-keyword">if</span> (circuitBreaker.getState() == CircuitBreaker.State.OPEN) {
                log.warn(<span class="hljs-string">"熔断器已开启，执行降级策略"</span>);
                <span class="hljs-keyword">return</span> fallbackDeductBalance(userId, amount);
            }

            <span class="hljs-comment">// 正常业务逻辑</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> doDeductBalance(userId, amount);

            <span class="hljs-comment">// 记录成功指标</span>
            metricsService.recordBalanceDeductSuccess(lockType, userId);

            <span class="hljs-keyword">return</span> result;

        }).recover(throwable -&gt; {
            <span class="hljs-comment">// 熔断或异常时的降级处理</span>
            log.warn(<span class="hljs-string">"执行降级处理，用户: {}"</span>, userId);
            <span class="hljs-keyword">return</span> fallbackDeductBalance(userId, amount);
        }).get();
    }

    <span class="hljs-comment">/**
     * 降级处理：保存到待处理队列
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">fallbackDeductBalance</span><span class="hljs-params">(Long userId, Long amount)</span> {
        log.info(<span class="hljs-string">"执行降级策略，保存到待处理队列，用户: {}, 金额: {}"</span>, userId, amount);
        pendingRequests.computeIfAbsent(userId, k -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>)).addAndGet(amount.intValue());
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 返回true表示已接受请求（异步处理）</span>
    }

    <span class="hljs-comment">/**
     * 处理待处理队列中的请求
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processPendingRequests</span><span class="hljs-params">()</span> {
        log.info(<span class="hljs-string">"开始处理待处理队列，待处理用户数: {}"</span>, pendingRequests.size());

        pendingRequests.forEach((userId, amount) -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> doDeductBalance(userId, amount.longValue());
                <span class="hljs-keyword">if</span> (success) {
                    pendingRequests.remove(userId);
                    log.info(<span class="hljs-string">"待处理请求处理成功，用户: {}"</span>, userId);
                }
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(<span class="hljs-string">"待处理请求处理失败，用户: {}"</span>, userId, e);
            }
        });
    }
}
</code></pre>
<h5 data-id="heading-42">8.3.5 前端监控面板实现</h5>
<p><strong>实时监控面板</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c617fe602774312946e8558e97debfd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo5Lit6aOY6I2h55qE6K6w5b-G:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771290044&amp;x-signature=Hgc8n5bV75iqwtwhONIbf%2Bg8wOA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-43">九、总结</h3>
<h4 data-id="heading-44">9.1 三种锁的选择建议</h4>






























<table><thead><tr><th>场景</th><th>推荐方案</th><th>理由</th></tr></thead><tbody><tr><td>单机低并发</td><td>悲观锁</td><td>实现简单，数据一致性强</td></tr><tr><td>单机高并发</td><td>乐观锁</td><td>无锁竞争，性能最优</td></tr><tr><td>分布式系统</td><td>Redis分布式锁</td><td>跨节点互斥，可靠性高</td></tr><tr><td>秒杀场景</td><td>Redis + MQ + 乐观锁</td><td>结合各自优势</td></tr></tbody></table>
<h4 data-id="heading-45">9.2 性能对比数据（测试环境：8核16G，100并发线程）</h4>

































<table><thead><tr><th>锁类型</th><th>成功率</th><th>平均耗时(ms)</th><th>吞吐量(ops/s)</th><th>P99耗时(ms)</th></tr></thead><tbody><tr><td>悲观锁</td><td>100%</td><td>245.32</td><td>408</td><td>512</td></tr><tr><td>乐观锁</td><td>100%</td><td>78.21</td><td>1278</td><td>187</td></tr><tr><td>分布式锁</td><td>100%</td><td>156.45</td><td>639</td><td>321</td></tr></tbody></table>
<blockquote>
<p>本文介绍了秒杀系统中账户余额扣减的竞态条件问题，以及三种解决方案的详细对比。通过实际代码示例和架构图，帮助你理解不同锁机制的适用场景，设计出高性能高可用的秒杀系统。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026年JavaScript重大更新：ES2026新特性详解及实战指南]]></title>    <link>https://juejin.cn/post/7604805226696867878</link>    <guid>https://juejin.cn/post/7604805226696867878</guid>    <pubDate>2026-02-10T07:39:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604805226696867878" data-draft-id="7604784281957466150" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026年JavaScript重大更新：ES2026新特性详解及实战指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-10T07:39:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026年JavaScript重大更新：ES2026新特性详解及实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T07:39:47.000Z" title="Tue Feb 10 2026 07:39:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">引言</h2>
<p>作为现代Web开发的基石，JavaScript自1995年诞生以来，始终伴随前端工程化、全栈开发、跨端应用的演进持续迭代。2026年，ECMAScript 2026（简称ES2026）正式落地，带来了一系列针对性更新——从彻底解决日期处理混乱、浮点精度丢失等长期痛点，到优化异步编程、强化类型安全、提升资源管理可靠性，全方位适配AI协作、边缘计算等新兴场景。对于前端、全栈开发者而言，掌握这些新变化不仅能简化代码、减少bug，更能跟上技术趋势，提升工程效率。本文将从背景、技术实现、优缺点及应用建议等维度，全面拆解2026年JavaScript的核心变化，助力开发者快速上手实践。</p>
<h2 data-id="heading-1">一、背景：JavaScript长期痛点与ES2026的迭代初衷</h2>
<p>多年来，JavaScript在广泛应用中逐渐暴露诸多原生缺陷，这些痛点往往迫使开发者依赖第三方库，增加代码体积与维护成本，同时限制了其在高可靠性、高精度场景的应用，主要集中在以下4个方面：</p>
<ul>
<li>日期时间处理：原生Date对象时区转换不精确、国际化支持有限，解析字符串时易出现异常行为，开发者需依赖Moment.js、Luxon等库规避问题；</li>
<li>浮点精度问题：采用IEEE 754 64位浮点标准，简单累加、循环计算时易丢失精度（如0.1+0.2≠0.3），在财务、科学计算场景尤为棘手；</li>
<li>资源管理繁琐：文件句柄、数据库连接等资源需依赖try-finally手动释放，易遗漏导致资源泄漏，垃圾回收的不可预测性无法满足确定性资源管理需求；</li>
<li>异步与类型优化不足：异步代码嵌套冗余、并行处理不便，原生类型检查能力薄弱，需依赖TypeScript或第三方校验库保障代码健壮性。</li>
</ul>
<p>基于此，TC39委员会结合开发者实践反馈，推动多项提案成熟落地，ES2026以“解决长期痛点、提升开发效率、适配新兴场景”为核心，实现了JavaScript语言能力的全方位升级，让原生JS更适配全栈、AI协作、边缘计算等复杂场景需求。</p>
<h2 data-id="heading-2">二、2026年JavaScript核心变化：技术实现与代码示例</h2>
<p>ES2026的更新聚焦“实用性、可靠性、高效性”，核心变化集中在日期处理、浮点计算、资源管理、异步编程、类型安全5大方向，以下将详细阐述每项特性的技术实现，并提供可直接复用的代码示例。</p>
<h3 data-id="heading-3">2.1 核心特性1：Temporal API——日期时间处理的现代标准</h3>
<p>Temporal API是ES2026最受关注的更新，作为原生Date对象的全面替代方案，它采用“显式性、精确性”设计原则，支持时区、日历、时长的精准处理，无缝适配国际化场景，从根本上解决了Date对象的诸多缺陷。</p>
<p>技术实现：Temporal API包含多个核心对象，分别对应不同的日期时间场景，核心设计是“区分本地时间与带时区时间”，避免隐式转换引发的错误，同时支持伊斯兰历、日本历等多种文化日历，内置格式化、计算方法。</p>
<p>核心对象说明：</p>
<ul>
<li>Temporal.PlainDate：无时区的日期（如2026-02-10）；</li>
<li>Temporal.PlainTime：无时区的时间（如15:30:00）；</li>
<li>Temporal.ZonedDateTime：带时区的日期时间（如2026-02-10T15:30:00+08:00(Asia/Shanghai)）；</li>
<li>Temporal.Duration：时长（如30天、2小时）；</li>
<li>Temporal.Calendar：日历系统（默认公历，可切换其他日历）。</li>
</ul>
<p>代码示例：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 1. 解析带时区的日期时间并计算时长</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">start</span> = Temporal.ZonedDateTime.<span class="hljs-keyword">from</span>(<span class="hljs-string">'2026-02-10T00:00:00+08:00(Asia/Shanghai)'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">end</span> = Temporal.ZonedDateTime.<span class="hljs-keyword">from</span>(<span class="hljs-string">'2026-02-17T21:30:00+08:00(Asia/Shanghai)'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">duration</span> = end.<span class="hljs-title function_ invoke__">since</span>(start);
console.<span class="hljs-title function_ invoke__">log</span>(`从${start.<span class="hljs-title function_ invoke__">toLocaleString</span>()}到${end.<span class="hljs-title function_ invoke__">toLocaleString</span>()}，共过去${duration.days}天${duration.hours}小时`);
<span class="hljs-comment">// 输出：从2026-02-10 00:00:00到2026-02-17 21:30:00，共过去7天21小时</span>

<span class="hljs-comment">// 2. 无时区日期计算（增加30天）</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">plainDate</span> = Temporal.PlainDate.<span class="hljs-keyword">from</span>(<span class="hljs-string">'2026-02-10'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">nextMonthDate</span> = plainDate.<span class="hljs-title function_ invoke__">add</span>({ <span class="hljs-attr">days</span>: <span class="hljs-number">30</span> });
console.<span class="hljs-title function_ invoke__">log</span>(nextMonthDate.<span class="hljs-title function_ invoke__">toString</span>()); <span class="hljs-comment">// 输出：2026-03-12（自动处理2月天数）</span>

<span class="hljs-comment">// 3. 国际化格式化（适配中文场景）</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">formatted</span> = start.<span class="hljs-title function_ invoke__">toLocaleString</span>({
  <span class="hljs-attr">year</span>: <span class="hljs-string">'numeric'</span>,
  <span class="hljs-attr">month</span>: <span class="hljs-string">'long'</span>,
  <span class="hljs-attr">day</span>: <span class="hljs-string">'numeric'</span>,
  <span class="hljs-attr">hour</span>: <span class="hljs-string">'2-digit'</span>,
  <span class="hljs-attr">minute</span>: <span class="hljs-string">'2-digit'</span>,
  <span class="hljs-attr">timeZoneName</span>: <span class="hljs-string">'long'</span>
});
console.<span class="hljs-title function_ invoke__">log</span>(formatted); <span class="hljs-comment">// 输出：2026年2月10日 15:30 中国标准时间</span>

<span class="hljs-comment">// 4. 切换日历系统（伊斯兰历）</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">islamicDate</span> = plainDate.<span class="hljs-title function_ invoke__">withCalendar</span>(<span class="hljs-string">'islamic-umalqura'</span>);
console.<span class="hljs-title function_ invoke__">log</span>(islamicDate.<span class="hljs-title function_ invoke__">toString</span>()); <span class="hljs-comment">// 输出：1447-07-13</span>
</code></pre>
<h3 data-id="heading-4">2.2 核心特性2：Math.sumPrecise——解决浮点求和精度问题</h3>
<p>针对JavaScript长期存在的浮点精度丢失问题，ES2026新增Math.sumPrecise方法，采用Kahan变体精确求和算法，可精准累加数组中的浮点数，无需修改底层浮点表示，大幅简化财务、科学计算场景的开发。</p>
<p>技术实现：Math.sumPrecise接收一个可迭代对象（如数组），内部通过误差补偿机制，修正浮点累加过程中的精度偏差，相较于传统reduce求和，无需手动编写精度修正函数，且性能更优。</p>
<p>代码示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 传统求和（精度丢失问题）</span>
<span class="hljs-keyword">const</span> transactions = [<span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.3</span>, <span class="hljs-number">0.4</span>, <span class="hljs-number">0.5</span>];
<span class="hljs-keyword">const</span> normalSum = transactions.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`传统求和结果：<span class="hljs-subst">${normalSum}</span>`</span>); <span class="hljs-comment">// 输出：1.4999999999999998（不符合预期）</span>

<span class="hljs-comment">// Math.sumPrecise精确求和</span>
<span class="hljs-keyword">const</span> preciseSum = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sumPrecise</span>(transactions);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`精确求和结果：<span class="hljs-subst">${preciseSum}</span>`</span>); <span class="hljs-comment">// 输出：1.5（符合预期）</span>

<span class="hljs-comment">// 实际财务场景应用（计算订单总金额）</span>
<span class="hljs-keyword">const</span> orderAmounts = [<span class="hljs-number">19.99</span>, <span class="hljs-number">29.98</span>, <span class="hljs-number">9.99</span>, <span class="hljs-number">39.95</span>];
<span class="hljs-keyword">const</span> totalAmount = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sumPrecise</span>(orderAmounts);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`订单总金额：<span class="hljs-subst">${totalAmount.toFixed(<span class="hljs-number">2</span>)}</span>`</span>); <span class="hljs-comment">// 输出：99.91</span>
</code></pre>
<h3 data-id="heading-5">2.3 核心特性3：显式资源管理——using声明与自动释放</h3>
<p>ES2026引入using声明和Symbol.dispose/Symbol.asyncDispose接口，实现了资源的确定性释放，替代传统try-finally写法，大幅减少资源泄漏风险，尤其适用于文件操作、数据库连接、网络请求等场景，类似C#的using或Python的with语句。</p>
<p>技术实现：通过实现Symbol.dispose（同步资源）或Symbol.asyncDispose（异步资源）接口，标记需要释放的资源；using声明将资源绑定到代码块，当代码块执行完毕（无论正常结束还是抛出异常），自动调用dispose方法释放资源，无需手动干预。</p>
<p>代码示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 同步资源释放（模拟文件操作）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FileHandler</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">filePath</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">filePath</span> = filePath;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">file</span> = <span class="hljs-literal">null</span>;
  }

  <span class="hljs-comment">// 实现同步释放接口</span>
  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">dispose</span>]() {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">file</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">file</span>.<span class="hljs-title function_">close</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`文件<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.filePath}</span>已自动关闭`</span>);
    }
  }

  <span class="hljs-title function_">open</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">file</span> = { <span class="hljs-attr">close</span>: <span class="hljs-function">() =&gt;</span> {} }; <span class="hljs-comment">// 模拟文件打开</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`文件<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.filePath}</span>已打开`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-title function_">read</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`文件<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.filePath}</span>内容`</span>;
  }
}

<span class="hljs-comment">// using声明自动释放文件资源</span>
using fileHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileHandler</span>(<span class="hljs-string">'data.txt'</span>).<span class="hljs-title function_">open</span>();
<span class="hljs-keyword">const</span> content = fileHandler.<span class="hljs-title function_">read</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(content);
<span class="hljs-comment">// 代码块结束后，自动调用Symbol.dispose，输出：文件data.txt已自动关闭</span>

<span class="hljs-comment">// 2. 异步资源释放（模拟数据库连接）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DbConnection</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">connStr</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">connStr</span> = connStr;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span> = <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">connect</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span> = { <span class="hljs-attr">close</span>: <span class="hljs-keyword">async</span> () =&gt; {} }; <span class="hljs-comment">// 模拟数据库连接</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`数据库<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.connStr}</span>已连接`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }

  <span class="hljs-comment">// 实现异步释放接口</span>
  <span class="hljs-keyword">async</span> [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">asyncDispose</span>]() {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span>) {
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">connection</span>.<span class="hljs-title function_">close</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`数据库<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.connStr}</span>已自动断开`</span>);
    }
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">query</span>(<span class="hljs-params">sql</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`执行SQL：<span class="hljs-subst">${sql}</span>，返回结果`</span>;
  }
}

<span class="hljs-comment">// 异步using声明（配合await）</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">queryData</span>(<span class="hljs-params"/>) {
  using dbConn = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DbConnection</span>(<span class="hljs-string">'mysql://localhost:3306/test'</span>).<span class="hljs-title function_">connect</span>();
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> dbConn.<span class="hljs-title function_">query</span>(<span class="hljs-string">'SELECT * FROM users'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);
}
<span class="hljs-title function_">queryData</span>();
<span class="hljs-comment">// 执行完毕后，自动调用Symbol.asyncDispose，输出：数据库mysql://localhost:3306/test已自动断开</span>
</code></pre>
<h3 data-id="heading-6">2.4 核心特性4：异步编程优化——行内Await与并行简化</h3>
<p>ES2026对async/await语法进行了升级，支持行内async表达式（行内Await代码块），打破传统异步代码的嵌套冗余，可将多个异步任务聚合为一个await操作，大幅提升异步代码的可读性与开发效率。</p>
<p>技术实现：行内Await允许在非async函数的表达式中使用await，通过“对象字面量+await”的方式，并行执行多个异步任务，无需手动使用Promise.all，简化异步并行处理逻辑。</p>
<p>代码示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 传统异步写法（嵌套冗余，并行处理繁琐）</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserDataOld</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/user/1'</span>);
  <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/user/<span class="hljs-subst">${user.id}</span>/posts`</span>);
  <span class="hljs-keyword">const</span> comments = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/post/<span class="hljs-subst">${posts[<span class="hljs-number">0</span>].id}</span>/comments`</span>);
  <span class="hljs-keyword">return</span> { user, posts, comments };
}

<span class="hljs-comment">// ES2026行内Await写法（并行执行，简洁清晰）</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserDataNew</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 行内async表达式，并行执行3个异步任务，统一await结果</span>
  <span class="hljs-keyword">const</span> userData = <span class="hljs-keyword">await</span> {
    <span class="hljs-attr">user</span>: <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/user/1'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>()),
    <span class="hljs-attr">posts</span>: <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/user/1/posts'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>()),
    <span class="hljs-attr">comments</span>: <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/post/1/comments'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
  };
  <span class="hljs-keyword">return</span> userData;
}

<span class="hljs-comment">// 执行结果：3个请求并行发起，大幅缩短执行时间</span>
<span class="hljs-title function_">getUserDataNew</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data));

<span class="hljs-comment">// 复杂场景：条件性异步任务并行</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCombinedData</span>(<span class="hljs-params">isVip</span>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> {
    <span class="hljs-attr">user</span>: <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/user/1'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>()),
    ...(isVip ? { <span class="hljs-attr">vipInfo</span>: <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/user/1/vip'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>()) } : {})
  };
  <span class="hljs-keyword">return</span> data;
}
</code></pre>
<h3 data-id="heading-7">2.5 核心特性5：类型安全增强——原生Type Guard</h3>
<p>为减少类型错误，ES2026引入原生Type Guard（类型守卫）语法，无需依赖TypeScript或第三方校验库，即可在原生JS中实现简洁的类型检查，支持对象结构、属性约束的精准校验，提升代码健壮性。</p>
<p>技术实现：Type Guard通过“value is Type”的语法，在条件判断中直接定义类型约束，支持基础类型、对象结构、属性范围的校验，校验通过后，代码块内自动推断变量类型，无需手动类型断言。</p>
<p>代码示例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 传统类型检查（繁琐，易遗漏）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printUserOld</span>(<span class="hljs-params">user</span>) {
  <span class="hljs-keyword">if</span> (user &amp;&amp; <span class="hljs-keyword">typeof</span> user.<span class="hljs-property">name</span> === <span class="hljs-string">'string'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> user.<span class="hljs-property">age</span> === <span class="hljs-string">'number'</span> &amp;&amp; user.<span class="hljs-property">age</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${user.name}</span>，<span class="hljs-subst">${user.age}</span>岁`</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'用户信息格式错误'</span>);
  }
}

<span class="hljs-comment">// ES2026原生Type Guard（简洁，精准）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printUserNew</span>(<span class="hljs-params">user</span>) {
  <span class="hljs-comment">// 行内Type Guard，校验user的结构与属性约束</span>
  <span class="hljs-keyword">if</span> (user is { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> &gt; <span class="hljs-number">0</span> }) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${user.name}</span>，<span class="hljs-subst">${user.age}</span>岁`</span>); <span class="hljs-comment">// 代码块内自动推断user类型</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'用户信息格式错误'</span>);
  }
}

<span class="hljs-comment">// 实际应用：接口返回数据校验</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUser</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/user/1'</span>);
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();
  <span class="hljs-comment">// 校验接口返回数据类型</span>
  <span class="hljs-keyword">if</span> (!(user is { <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>, email?: <span class="hljs-built_in">string</span> })) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'接口返回数据格式异常'</span>);
  }
  <span class="hljs-keyword">return</span> user;
}
</code></pre>
<h3 data-id="heading-8">2.6 其他实用更新（补充）</h3>
<p>除上述核心特性外，ES2026还包含多项细节优化，进一步提升开发效率：</p>
<ul>
<li>Uint8Array base64编解码：内置二进制与base64的转换方法，无需依赖第三方库，提升性能；</li>
<li>Error.isError：跨上下文可靠检查错误对象，解决不同执行环境下错误类型判断不准确的问题；</li>
<li>Array.fromAsync：从异步迭代器创建数组，适配现代异步迭代场景；</li>
<li>Map Upsert：简化Map对象的插入/更新操作，无需手动判断键是否存在。</li>
</ul>
<h2 data-id="heading-9">三、ES2026新特性的优缺点分析及应用建议</h2>
<p>ES2026的更新虽针对性解决了诸多长期痛点，但部分特性仍存在学习成本与兼容性问题，以下结合实际开发场景，分析核心特性的优缺点，并给出可落地的应用建议。</p>
<h3 data-id="heading-10">3.1 核心特性优缺点汇总</h3>



































<table><thead><tr><th>特性</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>Temporal API</td><td>1. 日期时间处理精准，支持时区与国际化；2. 替代第三方日期库，减少代码体积；3. 语法清晰，易维护。</td><td>1. 学习成本较高，需熟悉多个核心对象；2. 与Date对象不兼容，需逐步迁移；3. 部分旧浏览器未完全支持。</td></tr><tr><td>Math.sumPrecise</td><td>1. 彻底解决浮点求和精度问题；2. 语法简洁，无需手动编写精度修正函数；3. 性能优于自定义实现。</td><td>1. 仅支持求和场景，无法解决所有浮点问题（如乘法、除法精度）；2. 需注意与传统求和方法的区分。</td></tr><tr><td>显式资源管理（using）</td><td>1. 自动释放资源，减少泄漏风险；2. 简化代码，替代繁琐的try-finally；3. 支持同步/异步资源统一管理。</td><td>1. 需手动实现dispose接口，对现有代码有改造成本；2. 异步资源需注意asyncDispose的正确实现。</td></tr><tr><td>行内Await</td><td>1. 简化异步并行代码，提升可读性；2. 减少Promise.all的手动使用；3. 支持条件性异步任务聚合。</td><td>1. 需注意变量作用域，避免异步任务依赖问题；2. 部分旧版运行时（如旧Node.js版本）不支持。</td></tr><tr><td>原生Type Guard</td><td>1. 原生支持类型检查，无需依赖TS或第三方库；2. 语法简洁，提升代码健壮性；3. 支持复杂对象结构校验。</td><td>1. 不支持复杂schema校验（如嵌套对象深层校验）；2. 类型约束能力弱于TypeScript。</td></tr></tbody></table>
<h3 data-id="heading-11">3.2 实际应用建议</h3>
<p>结合特性优缺点，针对不同开发场景，给出以下应用建议，帮助开发者高效落地ES2026新特性：</p>
<ol>
<li>
<p>场景适配建议：</p>
<ol>
<li>财务、科学计算场景：优先使用Math.sumPrecise，避免浮点精度问题；</li>
<li>日期时间处理场景（如考勤、日程、国际化应用）：全面迁移至Temporal API，替代Date与第三方日期库；</li>
<li>文件、数据库、网络请求场景：强制使用using声明，确保资源确定性释放，减少泄漏风险；</li>
<li>多异步任务并行场景（如接口批量请求）：使用行内Await，简化代码结构；</li>
<li>中小型项目类型校验：使用原生Type Guard；大型项目建议结合TypeScript，提升类型约束能力。</li>
</ol>
</li>
<li>
<p>兼容性处理建议：</p>
<ol>
<li>浏览器端：目前Chrome 144+、Firefox、WebKit等主流浏览器已逐步支持ES2026核心特性，旧浏览器需使用Polyfill（如@js-temporal/polyfill）做兼容；</li>
<li>Node.js端：Node.js 20+版本支持大部分特性，建议升级至最新稳定版，或使用Babel转译；</li>
<li>项目迁移：采用“渐进式迁移”策略，先在新功能中使用新特性，逐步替代旧写法，避免一次性大规模改造带来的风险。</li>
</ol>
</li>
<li>
<p>避坑提醒：</p>
<ol>
<li>Temporal API：避免混用Temporal对象与Date对象，如需兼容旧代码，可使用Temporal.from(Date)进行转换；</li>
<li>using声明：异步资源必须实现Symbol.asyncDispose接口，且需配合await使用，否则会导致资源释放失败；</li>
<li>行内Await：多个异步任务若存在依赖关系（如A任务依赖B任务结果），不可使用行内并行写法，需保持顺序执行；</li>
<li>Math.sumPrecise：仅适用于求和场景，乘法、除法等浮点运算仍需手动处理精度（如使用decimal.js库）。</li>
</ol>
</li>
</ol>
<h2 data-id="heading-12">四、结论：2026年JavaScript的价值与未来发展</h2>
<p>2026年JavaScript的更新（ES2026），并非简单的语法新增，而是围绕“解决长期痛点、提升开发效率、适配新兴场景”的系统性升级——Temporal API终结了日期处理的混乱局面，Math.sumPrecise填补了原生浮点精度的空白，using声明解决了资源管理的顽疾，行内Await与Type Guard则进一步优化了异步编程与类型安全体验。这些变化的核心价值，在于让原生JavaScript摆脱对第三方库的过度依赖，变得更健壮、更高效、更适配全栈开发、AI协作、边缘计算等现代技术场景。</p>
<p>从未来发展来看，结合TC39的后续规划与行业趋势，JavaScript将继续朝着以下方向演进：一是类型系统持续深化，原生类型能力将进一步贴近TypeScript，实现“动态类型+静态类型”的灵活适配；二是性能持续优化，通过JIT编译、内存管理革新等技术，缩小与原生语言的性能差距；三是多范式融合，进一步强化异步编程、函数式编程能力，适配AI辅助开发、边缘计算等新兴场景；四是生态协同升级，与WebAssembly的协同将更加紧密，实现“JS负责业务编排、WASM负责高性能计算”的分层协作模式。</p>
<p>对于开发者而言，ES2026的落地意味着更高的开发效率、更可靠的代码质量，以及更低的维护成本。唯有主动学习并落地这些新特性，结合实际场景灵活运用，才能在快速迭代的技术浪潮中保持竞争力，充分发挥JavaScript在现代开发中的核心价值。</p>
<h2 data-id="heading-13">五、参考资料（可选）</h2>
<p>为帮助读者进一步学习ES2026新特性，整理以下权威参考资料：</p>
<ol>
<li>ECMAScript 2026 官方提案：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftc39%2Fproposals%2Fblob%2Fmain%2Ffinished-proposals.md" target="_blank" title="https://github.com/tc39/proposals/blob/main/finished-proposals.md" ref="nofollow noopener noreferrer">TC39 Finished Proposals</a>（包含所有ES2026落地特性的详细说明）；</li>
<li>Temporal API 官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fproposal-temporal%2Fdocs%2F" target="_blank" title="https://tc39.es/proposal-temporal/docs/" ref="nofollow noopener noreferrer">Temporal API Specification</a>（详细介绍Temporal API的设计理念与使用方法）；</li>
<li>MDN ES2026 新特性详解：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FNew_in_JavaScript%2FES2026" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/New_in_JavaScript/ES2026" ref="nofollow noopener noreferrer">JavaScript 2026 新特性</a>（含代码示例与浏览器兼容性说明）；</li>
<li>ES2026 实战指南：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Farticle%2Fdetails%2F156517739" target="_blank" title="https://blog.csdn.net/article/details/156517739" ref="nofollow noopener noreferrer">2026年JavaScript趋势分析</a>（结合实际项目的落地经验）；</li>
<li>显式资源管理提案：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftc39%2Fproposal-explicit-resource-management" target="_blank" title="https://github.com/tc39/proposal-explicit-resource-management" ref="nofollow noopener noreferrer">Explicit Resource Management</a>（using声明的详细设计与实现）。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端跨域全攻略：从 Vite 代理到 Nginx 生产环境配置实战]]></title>    <link>https://juejin.cn/post/7604761524976648201</link>    <guid>https://juejin.cn/post/7604761524976648201</guid>    <pubDate>2026-02-10T03:14:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604761524976648201" data-draft-id="7604665952321372211" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端跨域全攻略：从 Vite 代理到 Nginx 生产环境配置实战"/> <meta itemprop="keywords" content="前端,Nginx,面试"/> <meta itemprop="datePublished" content="2026-02-10T03:14:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="发现一只大呆瓜"/> <meta itemprop="url" content="https://juejin.cn/user/180747382561607"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端跨域全攻略：从 Vite 代理到 Nginx 生产环境配置实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/180747382561607/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    发现一只大呆瓜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T03:14:52.000Z" title="Tue Feb 10 2026 03:14:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>在前后端分离的架构中，跨域（CORS）是我们联调接口时遇到的第一个“拦路虎”。无论是本地开发还是线上部署，掌握跨域的解决手段是前端开发者的基本功。本文将结合 Vite 和 Nginx，深度解析跨域问题的终极解决方案。</p>
<h2 data-id="heading-1">一、 什么是跨域？</h2>
<p><strong>跨域</strong>是由浏览器的<strong>同源策略（Same-origin policy）引起的。当一个请求的协议、域名、端口</strong>三者中至少有一个不同时，浏览器就会拦截该请求的响应。</p>
<blockquote>
<p><strong>注意</strong>：跨域请求其实已经发到了服务器，服务器也正常返回了数据，只是浏览器在接收响应时，发现源不匹配，为了安全将其拦截了。</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">二、 开发环境方案：Vite 反向代理</h2>
<p>在开发阶段，我们无法要求后端频繁改动 CORS 配置。此时，利用 Vite 自带的 <code>http-proxy</code> 模块进行转发是最优解。</p>
<h3 data-id="heading-3">1. Vite 配置实战</h3>
<p>在 <code>vite.config.js</code> 中配置 <code>server</code> 对象，通过代理服务器绕过浏览器同源策略：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">port</span>: <span class="hljs-number">3000</span>,
    <span class="hljs-attr">cors</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启用并允许任何源（主要用于开发服务器的响应头）</span>
    <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 启动时自动打开浏览器</span>
    
    <span class="hljs-comment">// 反向代理配置</span>
    <span class="hljs-attr">proxy</span>: {
      <span class="hljs-comment">// 场景 A：不移除路径前缀</span>
      <span class="hljs-comment">// 例如请求 /aPath/login 会转发到 http://33.133.190.116:8100/aPath/login</span>
      <span class="hljs-string">"/aPath"</span>: {
        <span class="hljs-attr">target</span>: <span class="hljs-string">"http://33.133.190.116:8100"</span>, 
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 必须设置为 true，否则后端无法获取正确的 Host</span>
      },
      
      <span class="hljs-comment">// 场景 B：重写路径（移除前缀）</span>
      <span class="hljs-comment">// 例如请求 /bPath/list 会转发到 http://172.16.7.160:9022/list</span>
      <span class="hljs-string">"/bPath"</span>: {
        <span class="hljs-attr">target</span>: <span class="hljs-string">"http://172.16.7.160:9022"</span>,
        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">rewrite</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> path.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^/</span>bPath/, <span class="hljs-string">""</span>),
      },
    },
  },
})
</code></pre>
<hr/>
<h2 data-id="heading-4">三、 生产环境方案：Nginx 部署配置</h2>
<p>项目上线后，Vite 的代理就不起作用了。此时我们需要在 Nginx 中配置反向代理，让所有的请求由 Nginx 统一分发。</p>
<h3 data-id="heading-5">1. Nginx 核心配置文件解析 (<code>nginx.conf</code>)</h3>
<pre><code class="hljs language-Nginx" lang="Nginx"># 基础全局配置
user nginx;
worker_processes auto; # 自动适配 CPU 核心数
error_log /var/log/nginx/error.log notice;
pid /run/nginx.pid;

events {
    worker_connections 1024;
    use epoll; # 使用高性能事件驱动模型
}

http {
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    client_max_body_size 300m; # 支持大文件上传

    # 开启 Gzip 压缩，优化传输性能
    gzip on;
    gzip_comp_level 5;
    gzip_types text/plain text/css application/json application/javascript;

    server {
        listen 80 default_server;
        server_name _; 

        # 静态资源处理
        location / {
            root /usr/share/nginx/html;
            index index.html index.htm;
            try_files $uri $uri/ /index.html; # 适配单页面应用路由
        }

        # 代理方案 A：带前缀转发
        # 请求：/aPath/api -&gt; http://33.133.190.116:8100/aPath/api
        location ^~/aPath/ {
            proxy_pass http://33.133.190.116:8100/aPath/;
            proxy_set_header X-Forwarded-For $remote_addr;
            proxy_read_timeout 3600s;
            proxy_buffering off; # AI 对话场景需关闭缓冲
            chunked_transfer_encoding on;
        }

        # 代理方案 B：抹除前缀转发
        # 请求：/bPath/api -&gt; http://172.16.7.160:9022/api
        location ^~/bPath/ {
            proxy_pass http://172.16.7.160:9022/; 
            proxy_set_header X-Forwarded-For $remote_addr;
        }

        # 禁止访问 .ht 文件
        location ~ /.ht {
            deny all;
        }
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-6">四、 补充</h2>
<h3 data-id="heading-7">1. 后端 CORS 配置（简单请求与预检请求）</h3>
<p>后端通过在响应头中添加特定字段，告诉浏览器允许该源的访问：</p>
<ul>
<li><code>Access-Control-Allow-Origin: *</code></li>
<li><code>Access-Control-Allow-Methods: GET, POST, PUT, DELETE</code></li>
</ul>
<h3 data-id="heading-8">2. 为什么 Nginx 代理能解决跨域？</h3>
<p>因为 <strong>“跨域”仅存在于浏览器端</strong>。 当你的前端代码请求 Nginx 时，它们同源；Nginx 作为中转站再去请求后端接口，这是 <strong>服务器对服务器的通信</strong>，不受同源策略限制。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何让 MyBatis 批量插入从5分钟缩短到3秒？我的三个关键优化]]></title>    <link>https://juejin.cn/post/7604775190212673546</link>    <guid>https://juejin.cn/post/7604775190212673546</guid>    <pubDate>2026-02-10T05:52:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604775190212673546" data-draft-id="7604784281957154854" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何让 MyBatis 批量插入从5分钟缩短到3秒？我的三个关键优化"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-10T05:52:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神奇小汤圆"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何让 MyBatis 批量插入从5分钟缩短到3秒？我的三个关键优化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神奇小汤圆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T05:52:31.000Z" title="Tue Feb 10 2026 05:52:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上周接了个数据迁移的活，要把10万条数据从老系统导入新系统。</p>
<p>写了个简单的批量插入，跑起来一看——5分钟。</p>
<p>领导说太慢了，能不能快点？</p>
<p>折腾了一下午，最后优化到3秒，记录一下过程。</p>
<h3 data-id="heading-0"/>
<h3 data-id="heading-1"/>
<h3 data-id="heading-2">最初的代码（5分钟）</h3>
<p>最开始写的很简单，foreach循环插入：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 方式1：循环单条插入（最慢）</span>
for (User user : userList) {
    userMapper<span class="hljs-selector-class">.insert</span>(user);
}
</code></pre>
<p>10万条数据，每条都要走一次网络请求、一次SQL解析、一次事务提交。</p>
<p>算一下：假设每条插入需要3ms，10万条就是300秒 = 5分钟。</p>
<p><strong>这是最蠢的写法，但我见过很多项目都这么写。</strong></p>
<h3 data-id="heading-3"/>
<h3 data-id="heading-4"/>
<h3 data-id="heading-5">第一次优化：批量SQL（30秒）</h3>
<p>把循环插入改成批量SQL：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- Mapper.xml --&gt;</span>
&lt;insertid="batchInsert"&gt;
    INSERT INTO user (name, age, email) VALUES
    &lt;foreachcollection="list"item="item"separator=","&gt;
        (#{item.name}, #{item.age}, #{item.email})
    <span class="hljs-tag">&lt;/<span class="hljs-name">foreach</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
</code></pre>

<pre><code class="hljs language-ini" lang="ini">// 分批插入，每批1000条
int <span class="hljs-attr">batchSize</span> = <span class="hljs-number">1000</span><span class="hljs-comment">;</span>
for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; userList.size(); i += batchSize) {</span>
    int <span class="hljs-attr">end</span> = Math.min(i + batchSize, userList.size())<span class="hljs-comment">;</span>
    List&lt;User&gt; <span class="hljs-attr">batch</span> = userList.subList(i, end)<span class="hljs-comment">;</span>
    userMapper.batchInsert(batch)<span class="hljs-comment">;</span>
}
</code></pre>
<p>从5分钟降到30秒，提升10倍。</p>
<p>原理：一条SQL插入多条数据，减少网络往返次数。</p>
<p>但还有问题：30秒还是太慢。</p>
<h3 data-id="heading-6"/>
<h3 data-id="heading-7"/>
<h3 data-id="heading-8">第二次优化：JDBC批处理（8秒）</h3>
<p>MySQL有个参数叫<code>rewriteBatchedStatements</code>，开启后可以把多条INSERT合并成一条。</p>
<h5 data-id="heading-9">第一步：修改数据库连接URL</h5>
<pre><code class="hljs language-bash" lang="bash">jdbc:mysql://localhost:3306/test?rewriteBatchedStatements=<span class="hljs-literal">true</span>
</code></pre>
<h5 data-id="heading-10">第二步：使用MyBatis的批处理模式</h5>
<pre><code class="hljs language-ini" lang="ini">@Autowired
private SqlSessionFactory sqlSessionFactory<span class="hljs-comment">;</span>

publicvoidbatchInsertWithExecutor(List&lt;User&gt; userList){
    try (SqlSession <span class="hljs-attr">sqlSession</span> = sqlSessionFactory.openSession(ExecutorType.BATCH)) {
        UserMapper <span class="hljs-attr">mapper</span> = sqlSession.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
        
        int <span class="hljs-attr">batchSize</span> = <span class="hljs-number">1000</span><span class="hljs-comment">;</span>
        for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; userList.size(); i++) {</span>
            mapper.insert(userList.get(i))<span class="hljs-comment">;</span>
            
            if ((i + 1) % <span class="hljs-attr">batchSize</span> == <span class="hljs-number">0</span>) {
                sqlSession.flushStatements()<span class="hljs-comment">;</span>
                sqlSession.clearCache()<span class="hljs-comment">;</span>
            }
        }
        sqlSession.flushStatements()<span class="hljs-comment">;</span>
        sqlSession.commit()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>从30秒降到8秒。</p>
<p>原理：<code>ExecutorType.BATCH</code>模式下，MyBatis会缓存SQL，最后一次性发送给数据库执行。配合<code>rewriteBatchedStatements=true</code>，MySQL驱动会把多条INSERT合并。</p>
<h3 data-id="heading-11"/>
<h3 data-id="heading-12"/>
<h3 data-id="heading-13">第三次优化：多线程并行（3秒）</h3>
<p>8秒还是不够快，上多线程：</p>
<pre><code class="hljs language-ini" lang="ini">publicvoidparallelBatchInsert(List&lt;User&gt; userList){
    int <span class="hljs-attr">threadCount</span> = <span class="hljs-number">4</span><span class="hljs-comment">;  // 根据数据库连接池大小调整</span>
    int <span class="hljs-attr">batchSize</span> = userList.size() / threadCount<span class="hljs-comment">;</span>
    
    ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(threadCount)<span class="hljs-comment">;</span>
    List&lt;Future&lt;?&gt;&gt; <span class="hljs-attr">futures</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
    
    for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; threadCount; i++) {</span>
        int <span class="hljs-attr">start</span> = i * batchSize<span class="hljs-comment">;</span>
        int <span class="hljs-attr">end</span> = (i == threadCount - <span class="hljs-number">1</span>) ? userList.size() : (i + <span class="hljs-number">1</span>) * batchSize<span class="hljs-comment">;</span>
        List&lt;User&gt; <span class="hljs-attr">subList</span> = userList.subList(start, end)<span class="hljs-comment">;</span>
        
        futures.add(executor.submit(() -&gt; {
            batchInsertWithExecutor(subList)<span class="hljs-comment">;</span>
        }))<span class="hljs-comment">;</span>
    }
    
    // 等待所有任务完成
    for (Future&lt;?&gt; future : futures) {
        try {
            future.get()<span class="hljs-comment">;</span>
        } catch (Exception e) {
            thrownew RuntimeException(e)<span class="hljs-comment">;</span>
        }
    }
    
    executor.shutdown()<span class="hljs-comment">;</span>
}
</code></pre>
<p>从8秒降到3秒。</p>
<p>注意事项：</p>
<ul>
<li>线程数不要超过数据库连接池大小</li>
<li>如果需要事务一致性，这个方案不适用</li>
<li>要考虑主键冲突的问题</li>
</ul>
<h3 data-id="heading-14"/>
<h3 data-id="heading-15"/>
<h3 data-id="heading-16">优化效果对比</h3>
<h3 data-id="heading-17"/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6da9e695da64dcca1741bfe530658f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771307553&amp;x-signature=vMP1%2FFJVFxJLToBuBOFPs1sIl4w%3D" alt="图片" loading="lazy"/></p>
<h3 data-id="heading-18"/>
<h3 data-id="heading-19">踩过的坑</h3>
<h5 data-id="heading-20">坑1：foreach拼接SQL过长</h5>
<pre><code class="hljs language-ini" lang="ini">&lt;foreach <span class="hljs-attr">collection</span>=<span class="hljs-string">"list"</span> item=<span class="hljs-string">"item"</span> separator=<span class="hljs-string">","</span>&gt;
</code></pre>
<p>如果一次插入太多条，SQL会非常长，可能超过<code>max_allowed_packet</code>限制。</p>
<p><strong>解决：</strong>  分批插入，每批500-1000条。</p>
<h5 data-id="heading-21">坑2：rewriteBatchedStatements不生效</h5>
<p>检查几个点：</p>
<ul>
<li>URL参数是否正确：<code>rewriteBatchedStatements=true</code></li>
<li>是否使用了<code>ExecutorType.BATCH</code></li>
<li>MySQL驱动版本是否太旧</li>
</ul>
<h5 data-id="heading-22">坑3：自增主键返回问题</h5>
<p>批量插入时想获取自增主键：</p>
<pre><code class="hljs language-ini" lang="ini">&lt;<span class="hljs-attr">insertid</span>=<span class="hljs-string">"batchInsert"</span>useGeneratedKeys=<span class="hljs-string">"true"</span>keyProperty=<span class="hljs-string">"id"</span>&gt;
</code></pre>
<p>注意：<code>rewriteBatchedStatements=true</code>时，自增主键返回可能有问题，需要升级MySQL驱动到8.0.17+。</p>
<h5 data-id="heading-23">坑4：内存溢出</h5>
<p>10万条数据一次性加载到内存，可能OOM。</p>
<p>解决：分页读取 + 分批插入。</p>
<pre><code class="hljs language-ini" lang="ini">int <span class="hljs-attr">pageSize</span> = <span class="hljs-number">10000</span><span class="hljs-comment">;</span>
int <span class="hljs-attr">total</span> = countTotal()<span class="hljs-comment">;</span>
for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; total; i += pageSize) {</span>
    List&lt;User&gt; <span class="hljs-attr">page</span> = selectByPage(i, pageSize)<span class="hljs-comment">;</span>
    batchInsertWithExecutor(page)<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-24"/>
<h3 data-id="heading-25"/>
<h3 data-id="heading-26">最终方案代码</h3>
<pre><code class="hljs language-ini" lang="ini">@Service
publicclassBatchInsertService{
    
    @Autowired
    private SqlSessionFactory sqlSessionFactory<span class="hljs-comment">;</span>
    
    /**
     * 高性能批量插入
     * 10万条数据约3秒
     */
    publicvoidhighPerformanceBatchInsert(List&lt;User&gt; userList){
        if (<span class="hljs-attr">userList</span> == null || userList.isEmpty()) {
            return<span class="hljs-comment">;</span>
        }
        
        int <span class="hljs-attr">threadCount</span> = Math.min(<span class="hljs-number">4</span>, Runtime.getRuntime().availableProcessors())<span class="hljs-comment">;</span>
        int <span class="hljs-attr">batchSize</span> = (int) Math.ceil((double) userList.size() / threadCount)<span class="hljs-comment">;</span>
        
        ExecutorService <span class="hljs-attr">executor</span> = Executors.newFixedThreadPool(threadCount)<span class="hljs-comment">;</span>
        CountDownLatch <span class="hljs-attr">latch</span> = new CountDownLatch(threadCount)<span class="hljs-comment">;</span>
        
        for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; threadCount; i++) {</span>
            int <span class="hljs-attr">start</span> = i * batchSize<span class="hljs-comment">;</span>
            int <span class="hljs-attr">end</span> = Math.min((i + <span class="hljs-number">1</span>) * batchSize, userList.size())<span class="hljs-comment">;</span>
            
            if (start &gt;= userList.size()) {
                latch.countDown()<span class="hljs-comment">;</span>
                continue<span class="hljs-comment">;</span>
            }
            
            List&lt;User&gt; <span class="hljs-attr">subList</span> = new ArrayList&lt;&gt;(userList.subList(start, end))<span class="hljs-comment">;</span>
            
            executor.submit(() -&gt; {
                try {
                    doBatchInsert(subList)<span class="hljs-comment">;</span>
                } finally {
                    latch.countDown()<span class="hljs-comment">;</span>
                }
            })<span class="hljs-comment">;</span>
        }
        
        try {
            latch.await()<span class="hljs-comment">;</span>
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt()<span class="hljs-comment">;</span>
        }
        
        executor.shutdown()<span class="hljs-comment">;</span>
    }
    
    privatevoiddoBatchInsert(List&lt;User&gt; userList){
        try (SqlSession <span class="hljs-attr">sqlSession</span> = sqlSessionFactory.openSession(ExecutorType.BATCH, <span class="hljs-literal">false</span>)) {
            UserMapper <span class="hljs-attr">mapper</span> = sqlSession.getMapper(UserMapper.class)<span class="hljs-comment">;</span>
            
            for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; userList.size(); i++) {</span>
                mapper.insert(userList.get(i))<span class="hljs-comment">;</span>
                
                if ((i + 1) % <span class="hljs-attr">1000</span> == <span class="hljs-number">0</span>) {
                    sqlSession.flushStatements()<span class="hljs-comment">;</span>
                    sqlSession.clearCache()<span class="hljs-comment">;</span>
                }
            }
            
            sqlSession.flushStatements()<span class="hljs-comment">;</span>
            sqlSession.commit()<span class="hljs-comment">;</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-27"/>
<h3 data-id="heading-28"/>
<h3 data-id="heading-29">总结</h3>
<h3 data-id="heading-30"/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e270d75098d948998577c9c53d48202a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56We5aWH5bCP5rGk5ZyG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771307553&amp;x-signature=stAnw%2BdeTn6WdKl7fJhR0rlskdc%3D" alt="图片" loading="lazy"/></p>
<p><strong>核心原则：</strong>  减少网络往返 + 减少事务次数 + 并行处理。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[比官方还便宜！Riffusion 音乐 API 对接说明]]></title>    <link>https://juejin.cn/post/7604678037808168996</link>    <guid>https://juejin.cn/post/7604678037808168996</guid>    <pubDate>2026-02-10T00:05:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7604678037808168996" data-draft-id="7604678037808152612" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="比官方还便宜！Riffusion 音乐 API 对接说明"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-02-10T00:05:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            比官方还便宜！Riffusion 音乐 API 对接说明
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-10T00:05:52.000Z" title="Tue Feb 10 2026 00:05:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    37
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读31分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文将介绍一种 Riffusion Audios Generation API 对接说明，它是可以通过输入自定义参数来生成 Riffusion 官方的音乐。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 API，需要先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Friffusion-audios" target="_blank" title="https://platform.acedata.cloud/documents/riffusion-audios" ref="nofollow noopener noreferrer">Riffusion Audios Generation API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/q6ytrc.png" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>想些什么歌曲，可以任意输入一段文字，比如我想生成一个关于圣诞的歌曲，就可以输入 <code>a song for Christmas</code>，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/4i4ysn.png" width="600" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外 Request Body 的参数包括：</p>
<ul>
<li><code>action</code>：此次音乐生成任务的行为，生成歌曲是 <code>generate</code>。</li>
<li><code>model</code>：创建歌曲采用的模型，目前主要有：<strong>FUZZ-1.0</strong>、<strong>FUZZ-1.1</strong>、<strong>FUZZ-1.0 Pro</strong>、<strong>FUZZ-1.1 Pro</strong>。</li>
<li><code>lyric</code>：歌曲的歌词内容。</li>
<li><code>custom</code>：是否采用自定义方式生成歌曲。</li>
<li><code>prompt</code>：灵感模式下的提示词。</li>
<li><code>style</code>：歌曲风格参数。</li>
<li><code>title</code>：歌曲标题信息。</li>
<li><code>callback_url</code>：需要回调结果的 URL。</li>
<li><code>instrumental</code>：是否为无歌词模式。</li>
</ul>
<p>如上参数和官方的自定义生成的映射关系如下：</p>
<ul>
<li><code>model</code>：对应 Riffusion 账号设置页面的模型选择，如下图所示</li>
<li><code>lyric</code>：对应 Rifussion 自定义生成页面的「Lyrics」部分，如下图所示</li>
<li><code>style</code>：对应 Rifussion 自定义生成页面的「Sound」部分，实际上是指定一些风格，如下图所示</li>
<li><code>title</code>：对应 Rifussion 自定义生成页面的「Details」部分，用于指定歌曲标题，如下图所示</li>
<li><code>instrumental</code>：对应 Rifussion 自定义生成页面的「Instrumental」开关，用于设置无歌词模式，如下图所示</li>
</ul>
<p><img src="https://cdn.acedata.cloud/i68847.png" width="500" class="m-auto" loading="lazy"/></p>
<p><img src="https://cdn.acedata.cloud/eda26o.png" width="500" class="m-auto" loading="lazy"/></p>
<p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/0217zy.png" width="500" class="m-auto" loading="lazy"/></p>
<p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f45388a9-4169-41d4-aec8-fb8259c48d36"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1df9f664-fd74-476b-8038-b0b5f62ddf87"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"02702b40-272d-4838-8644-675105930658"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Vibe"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/e850008a-d9a1-4c8f-acbd-a37f228946bc/image/02702b40-272d-4838-8644-675105930658.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Intro]\nYeah, yeah\nKeep talking, keep talking\nI love the way you sound\n[Verse 1]\nYour voice is like a drug I can't put down\nEvery word you say just pulls me in\nI'm addicted to the way you laugh out loud\nAnd how you whisper when the room goes dim\nTell me 'bout your day, tell me 'bout your fears\nI could listen to you talk for years\n[Pre-Chorus]\nDon't stop now, don't you dare\nI need your voice filling up the air\n[Chorus]\nKeep talking, keep talking to me\nYour words are all I fucking need\nKeep talking, keep talking, I'm high\nOff every sound you make tonight\nKeep talking\n[Verse 2]\nYou could read the phone book, I don't care\nJust the rhythm of your breathing's enough\nWhen you say my name, it's like a prayer\nAnd your silence hits me twice as rough\nEvery conversation feels like home\nNever want to hear this dial tone\n[Pre-Chorus]\nDon't stop now, don't you dare\nI need your voice filling up the air\n[Chorus]\nKeep talking, keep talking to me\nYour words are all I fucking need\nKeep talking, keep talking, I'm high\nOff every sound you make tonight\nKeep talking\n[Bridge]\nWhen the world gets loud and crazy\nYour voice cuts through the noise\nYou're my favorite conversation\nYou're my drug of choice\nKeep talking, keep talking\nKeep talking, keep talking\nKeep talking, keep talking\nKeep talking, keep talking\n[Chorus]\nKeep talking, keep talking to me\nYour words are all I fucking need\nKeep talking, keep talking, I'm high\nOff every sound you make tonight\nKeep talking\n[Outro]\nYeah, yeah\nKeep talking, keep talking\nNever stop that sound"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/e850008a-d9a1-4c8f-acbd-a37f228946bc/audio/02702b40-272d-4838-8644-675105930658.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-18T15:47:54.705246Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-1.0"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Intro]"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          ...
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sound"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">179.84</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">180.48</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">63</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Pop, upbeat tempo, modern production"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">181.12</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"be3fe757-621e-4017-9056-20aa7f01919e"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Revive"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/e850008a-d9a1-4c8f-acbd-a37f228946bc/image/be3fe757-621e-4017-9056-20aa7f01919e.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse 1]\nI'm walking through the motions, moving day by day\nColors seem a little faded, nothing much to say\nFriends keep calling, asking if I'm doing fine\nBut I just smile and tell them everything's divine\n[Pre-Chorus]\nSomething's missing, can't quite name it\nFeels like I'm just going through the stages\n[Chorus]\nI'm barely breathing, barely feeling\nLike I'm floating through a life that isn't mine\nBarely breathing, barely healing\nSearching for a reason, searching for a sign\nTo feel alive again\nTo feel alive again\n[Verse 2]\nMorning coffee tastes like water, sunrise looks like rain\nEveryone around me laughs but I can't feel the same\nUsed to dance in silly moments, used to sing out loud\nNow I'm standing in the silence of a faceless crowd\n[Pre-Chorus]\nSomething's shifting, can't ignore it\nMaybe it's time to break these patterns\n[Chorus]\nI'm barely breathing, barely feeling\nLike I'm floating through a life that isn't mine\nBarely breathing, barely healing\nSearching for a reason, searching for a sign\nTo feel alive again\nTo feel alive again\n[Bridge]\nBut there's a beating in my chest\nA whisper saying \"don't give up yet\"\nMaybe tomorrow I'll remember\nHow to laugh and how to let\nMy heart wake up from this long sleep\nFind the fire I used to keep\n[Chorus]\nI'm barely breathing, barely feeling\nLike I'm floating through a life that isn't mine\nBarely breathing, barely healing\nSearching for a reason, searching for a sign\nTo feel alive again\nTo feel alive again\n[Outro]\nI'm gonna feel alive again\nI'm gonna feel alive again"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/e850008a-d9a1-4c8f-acbd-a37f228946bc/audio/be3fe757-621e-4017-9056-20aa7f01919e.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-18T15:48:01.139081Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-1.0"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          ...
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"again"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">202.88</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">211.84</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">54</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Pop, upbeat tempo, clean production, emotional vocals"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">211.84</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>success</code>，此时音乐生成任务的状态情况。
<ul>
<li><code>data</code>，此次音乐任务的结果 - <code>id</code>，此时音乐生成任务的 ID。
<ul>
<li><code>prompt</code>，此时音乐生成任务的提示词。</li>
<li><code>audio_url</code>，此时音乐生成任务的音频链接。</li>
<li><code>image_url</code>，此时音乐生成任务的封面链接。</li>
<li><code>state</code>，此时音乐生成任务的状态。</li>
<li><code>duration</code>，此时音乐的时长信息。</li>
<li><code>style</code>，此时音乐的风格信息。</li>
<li><code>model</code>，此时音乐生成任务采用的模型信息。</li>
<li><code>lyric</code>，此时音乐生成任务的歌词信息。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>可以看到我们得到了想生成的音乐信息，我们只需要根据结果中 <code>data</code> 的音乐链接地址获取生成的 Riffusion 音乐即可。</p>
<p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "model": "FUZZ-1.0",
  "action": "generate",
  "prompt": "A song for Christmas"
}'
</code></pre>
<h2 data-id="heading-2">自定义生成</h2>
<p>如果想自定义生成歌词，可以输入歌词：</p>
<p>这时候 <code>lyric</code> 字段可以传入类似如下内容：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">[Verse]Woke up <span class="hljs-keyword">with</span> the sun <span class="hljs-keyword">in</span> my eyesNo clouds above just blue <span class="hljs-keyword">in</span> the skiesShoes <span class="hljs-keyword">on</span> my feet I’m ready <span class="hljs-keyword">to</span> runEvery <span class="hljs-keyword">step</span> feels <span class="hljs-built_in">like</span> a loaded gun[Chorus]Happy days are rolling inLet the joy beneath my skinNo more <span class="hljs-keyword">shadows</span> no more liesJust the truth that lifts <span class="hljs-keyword">me</span> high[Verse <span class="hljs-number">2</span>]Dancing through the city streetsA rhythm pounding <span class="hljs-keyword">in</span> my heartbeatStrangers smile it’s catching onThis world’s a stage we’re all a song[Chorus]Happy days are rolling inLet the joy beneath my skinNo more <span class="hljs-keyword">shadows</span> no more liesJust the truth that lifts <span class="hljs-keyword">me</span> high[Bridge]<span class="hljs-keyword">Throw</span> your worries out the doorLet them sink <span class="hljs-keyword">to</span> the ocean floorWe’re alive <span class="hljs-built_in">and</span> it’s enoughLife <span class="hljs-built_in">is</span> messy but it’s love[Chorus]Happy days are rolling inLet the joy beneath my skinNo more <span class="hljs-keyword">shadows</span> no more liesJust the truth that lifts <span class="hljs-keyword">me</span> high
</code></pre>
<p>接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
<ul>
<li>lyric：歌词文本</li>
<li>custom：填写为 <code>true</code>，代表自定义生成，该参数默认为 false，代表使用 <code>prompt</code> 生成。</li>
<li>title：歌曲的标题。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://cdn.acedata.cloud/ny4n7m.png" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://cdn.acedata.cloud/hm9gtn.png" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "model": "FUZZ-1.0",
  "action": "generate",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "custom": true
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"978c2912-6a90-4048-b4c1-43f9cf18c28d"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"08dfbb99-43ce-4f65-8fd1-74b98f2b121a"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"eac9ab69-e210-490b-9f8d-095a6f074f40"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"VibeRise"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3f3e1354-52ad-4f5b-902c-5f83abd17def/image/eac9ab69-e210-490b-9f8d-095a6f074f40.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3f3e1354-52ad-4f5b-902c-5f83abd17def/audio/eac9ab69-e210-490b-9f8d-095a6f074f40.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T01:57:33.438644Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-1.0"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"funk vibes, raspy, raw vocal texture"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">158.08</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"64fffe1f-b1aa-46dc-8012-b80ba319cf35"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Pure Dawn"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3f3e1354-52ad-4f5b-902c-5f83abd17def/image/64fffe1f-b1aa-46dc-8012-b80ba319cf35.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3f3e1354-52ad-4f5b-902c-5f83abd17def/audio/64fffe1f-b1aa-46dc-8012-b80ba319cf35.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T01:57:33.963497Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-1.0"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Woke"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"contemporary country"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">175.36</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-3">翻唱歌曲</h2>
<p>如果想对已经生成的歌曲进行翻唱操作的操作，可以输入上文生成的歌曲进行翻唱，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续翻唱的话，可以将参数 <code>action</code> 设置为 <code>upload_cover</code> ，并且输入需要继续翻唱自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F76d79f86-39af-4034-8c6a-51e4a819308d%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/76d79f86-39af-4034-8c6a-51e4a819308d?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">Riffusion Upload API</a>来获取，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/z7r5fd.png" width="500" class="m-auto" loading="lazy"/></p>
<p>就可以指定如下内容：</p>
<ul>
<li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、upload_replace_section、swap_vocals、upload_swap_vocals、swap_sound、upload_swap_sound，此次翻唱使用<code>cover</code>参数。</li>
<li>lyric：歌词文本</li>
<li>title：歌曲的标题。</li>
<li>audio_id：需要翻唱歌曲的歌曲ID。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://cdn.acedata.cloud/e5egk2.png" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://cdn.acedata.cloud/u0ei5u.png" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "cover",
  "model": "FUZZ-1.0 Pro",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c"
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fe02997d-f58e-4886-9aa3-4074c9a430eb"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"997bde4c-6063-4fc2-9b03-d837f1efc72d"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"be254182-d4b7-42b3-9ee2-b86db086cff1"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Sunny Rise"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/c2f707a9-017d-4354-8bfa-436266dadbf6/image/be254182-d4b7-42b3-9ee2-b86db086cff1.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/c2f707a9-017d-4354-8bfa-436266dadbf6/audio/be254182-d4b7-42b3-9ee2-b86db086cff1.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T01:59:17.666629Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">237.44</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">236.8</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">239.46235827664398</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9b9d2810-eb2b-44d3-85c0-cb259afa13c3"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Uplift"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/c2f707a9-017d-4354-8bfa-436266dadbf6/image/9b9d2810-eb2b-44d3-85c0-cb259afa13c3.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/c2f707a9-017d-4354-8bfa-436266dadbf6/audio/9b9d2810-eb2b-44d3-85c0-cb259afa13c3.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T01:59:23.065712Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">236.16</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">225.28</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">239.5299546485261</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-4">续写歌曲</h2>
<p>如果想续写歌曲的话，我们需要传入<code>action</code>参数值为：<code>extend</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续续写的话，可以将参数 <code>action</code> 设置为 <code>upload_extend</code> ，并且输入需要继续续写自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F76d79f86-39af-4034-8c6a-51e4a819308d%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/76d79f86-39af-4034-8c6a-51e4a819308d?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">Riffusion Upload API</a>来获取，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/z7r5fd.png" width="500" class="m-auto" loading="lazy"/></p>
<p>就可以指定如下内容：</p>
<ul>
<li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、upload_replace_section、swap_vocals、upload_swap_vocals、swap_sound、upload_swap_sound，此次续写使用<code>extend</code>参数。</li>
<li>lyric：歌词文本</li>
<li>title：歌曲的标题。</li>
<li>audio_id：歌曲的ID。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://cdn.acedata.cloud/1im68k.png" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://cdn.acedata.cloud/yctbdk.png" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "extend",
  "model": "FUZZ-1.0 Pro",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c",
  "continue_at": 5
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6388a0aa-b5ab-4485-baad-f0e0b7a7848c"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"da143dbe-8263-45ac-b05a-1ed57dd4aa79"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"209e27e0-500c-44f3-9134-280690014920"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"City Rhythm"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3a8378d5-94d4-49b7-9c0a-8432c0c4a39d/image/209e27e0-500c-44f3-9134-280690014920.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3a8378d5-94d4-49b7-9c0a-8432c0c4a39d/audio/209e27e0-500c-44f3-9134-280690014920.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:00:53.473604Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4.48</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">4.48</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">179.2</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">178.56</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">197.00850340136054</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ff50012e-ad1b-4b71-8d0e-6a633428a54f"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bright"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3a8378d5-94d4-49b7-9c0a-8432c0c4a39d/image/ff50012e-ad1b-4b71-8d0e-6a633428a54f.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/3a8378d5-94d4-49b7-9c0a-8432c0c4a39d/audio/ff50012e-ad1b-4b71-8d0e-6a633428a54f.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:00:52.795796Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">186.88</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">186.24</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">213.85757369614512</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-5">替换片段</h2>
<p>如果想对歌曲进行替换片段的话，我们需要传入<code>action</code>参数值为：<code>replace_section</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续替换片段的话，可以将参数 <code>action</code> 设置为 <code>upload_replace_section</code> ，并且输入需要继续替换片段自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F76d79f86-39af-4034-8c6a-51e4a819308d%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/76d79f86-39af-4034-8c6a-51e4a819308d?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">Riffusion Upload API</a>来获取，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/z7r5fd.png" width="500" class="m-auto" loading="lazy"/></p>
<p>就可以指定如下内容：</p>
<ul>
<li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、upload_replace_section、swap_vocals、upload_swap_vocals、swap_sound、upload_swap_sound，此次续写使用<code>extend</code>参数。</li>
<li>lyric：需要替换后的歌词文本</li>
<li>title：歌曲的标题。</li>
<li>audio_id：歌曲的ID。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://cdn.acedata.cloud/gbxazr.png" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://cdn.acedata.cloud/yb4wr9.png" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "replace_section",
  "model": "FUZZ-1.0 Pro",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c",
  "replace_section_start": 3,
  "replace_section_end": 70
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"73defcbf-f876-4dd6-b60e-4c1c5ecd4565"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9f639389-7218-4cdb-ade9-b34228bb0f21"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"037f5e9d-9da4-4d79-b58f-1f433b40d54d"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Sunrise Joy"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/881ad27f-39c1-4c31-a789-ecc822e13b8c/image/037f5e9d-9da4-4d79-b58f-1f433b40d54d.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/881ad27f-39c1-4c31-a789-ecc822e13b8c/audio/037f5e9d-9da4-4d79-b58f-1f433b40d54d.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:18:43.031184Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.84</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.84</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          ...
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">159.36</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">159.36</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">199.2201133786848</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"97638295-068f-4cbc-b076-66f522449bd5"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Sunrise"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/881ad27f-39c1-4c31-a789-ecc822e13b8c/image/97638295-068f-4cbc-b076-66f522449bd5.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/881ad27f-39c1-4c31-a789-ecc822e13b8c/audio/97638295-068f-4cbc-b076-66f522449bd5.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:18:56.267775Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.84</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.84</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
          ...
          <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">159.36</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">159.36</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
          <span class="hljs-punctuation">}</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">199.2201133786848</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-6">SwapSound生成</h2>
<p>如果想使用官方的SwapSound操作，可以将<code>action</code>参数值设为：<code>swap_sound</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续SwapSound操作的话，可以将参数 <code>action</code> 设置为 <code>upload_swap_sound</code> ，并且输入需要继续SwapSound操作自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F76d79f86-39af-4034-8c6a-51e4a819308d%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/76d79f86-39af-4034-8c6a-51e4a819308d?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">Riffusion Upload API</a>来获取，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/z7r5fd.png" width="500" class="m-auto" loading="lazy"/></p>
<p>就可以指定如下内容：</p>
<p>接下来我们要根据歌词、标题、风格自定义生成歌曲，就可以指定如下内容：</p>
<ul>
<li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、upload_replace_section、swap_vocals、upload_swap_vocals、swap_sound、upload_swap_sound。</li>
<li>lyric：歌词文本</li>
<li>title：歌曲的标题。</li>
<li>audio_id：歌曲的ID。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://cdn.acedata.cloud/psf4rm.png" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://cdn.acedata.cloud/988rlq.png" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "swap_sound",
  "model": "FUZZ-1.0 Pro",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c"
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"93279260-5ca1-42d8-bde1-1fa62e0f5027"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bc4e28db-4897-4ffc-9e03-45f43da7a21c"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"242035c0-8ac2-4f0b-a19c-ac2fa49d4df3"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Brightside"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/36494e8a-eb82-4d89-bbfa-ec719e19572b/image/242035c0-8ac2-4f0b-a19c-ac2fa49d4df3.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/36494e8a-eb82-4d89-bbfa-ec719e19572b/audio/242035c0-8ac2-4f0b-a19c-ac2fa49d4df3.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:02:32.799561Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.28</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.28</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">195.84</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">195.84</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">197.2696371882086</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"594fe702-6c71-4b0c-abb6-21b58efc74a6"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Sunrise"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/36494e8a-eb82-4d89-bbfa-ec719e19572b/image/594fe702-6c71-4b0c-abb6-21b58efc74a6.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/36494e8a-eb82-4d89-bbfa-ec719e19572b/audio/594fe702-6c71-4b0c-abb6-21b58efc74a6.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:02:30.523279Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">192.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">192.64</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">196.7198866213152</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">SwapVocals 生成</h2>
<p>如果想使用官方的SwapVocals操作，可以将<code>action</code>参数值设为：<code>swap_vocals</code>，接下来我们要根据歌词、标题、风格自定义生成歌曲。</p>
<p>如果想对自己上传的歌曲进行继续SwapVocals操作的话，可以将参数 <code>action</code> 设置为 <code>upload_swap_vocals</code> ，并且输入需要继续SwapVocals操作自定义上传的歌曲 ID，歌曲 ID 的获取是使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2F76d79f86-39af-4034-8c6a-51e4a819308d%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6%3Finviter_id%3Db87f67c1-b04f-4332-99a1-7a5e651331c6" target="_blank" title="https://platform.acedata.cloud/documents/76d79f86-39af-4034-8c6a-51e4a819308d?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6?inviter_id=b87f67c1-b04f-4332-99a1-7a5e651331c6" ref="nofollow noopener noreferrer">Riffusion Upload API</a>来获取，如下图所示：</p>
<p><img src="https://cdn.acedata.cloud/z7r5fd.png" width="500" class="m-auto" loading="lazy"/></p>
<p>就可以指定如下内容：</p>
<ul>
<li>action：此次歌曲任务的行为，目前支持：generate、cover、extend、upload_cover、upload_extend、replace_section、upload_replace_section、swap_vocals、upload_swap_vocals、swap_sound、upload_swap_sound。</li>
<li>lyric：歌词文本</li>
<li>title：歌曲的标题。</li>
<li>audio_id：歌曲的ID。</li>
<li>style：歌曲的风格，选填。</li>
</ul>
<p>填写样例如下：</p>
<p><img src="https://cdn.acedata.cloud/n6k8wk.png" width="500" class="m-auto" loading="lazy"/></p>
<p>填写完毕之后自动生成了代码如下：</p>
<p><img src="https://cdn.acedata.cloud/3wg240.png" width="500" class="m-auto" loading="lazy"/></p>
<p>对应的代码：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/riffusion/audios' \
-H 'accept: application/json' \
-H 'authorization: Bearer {token}' \
-H 'content-type: application/json' \
-d '{
  "action": "swap_vocals",
  "model": "FUZZ-1.0 Pro",
  "lyric": "[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high",
  "audio_id": "b7376272-3902-49b4-a83b-62f7e6ab505c"
}'
</code></pre>
<p>测试允许，生成的效果是类似的。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"a6e0d456-189b-4c78-9232-2fe72166ab39"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ee5769d4-ae94-4e5a-a85f-b3c0ddc2e48e"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b8b1ed14-f43c-4738-a697-60ba24b6049d"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Uplift"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/25ce4ddd-e48c-42e2-9ea3-8e03380508f2/image/b8b1ed14-f43c-4738-a697-60ba24b6049d.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/25ce4ddd-e48c-42e2-9ea3-8e03380508f2/audio/b8b1ed14-f43c-4738-a697-60ba24b6049d.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:04:18.477032Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2.56</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2.56</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">186.88</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">171.52</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">195.55968253968254</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dfd6eb9c-a1f3-4e1f-bbf9-e0b9625e459f"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Vivid Rise"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/25ce4ddd-e48c-42e2-9ea3-8e03380508f2/image/dfd6eb9c-a1f3-4e1f-bbf9-e0b9625e459f.jpg"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/25ce4ddd-e48c-42e2-9ea3-8e03380508f2/audio/dfd6eb9c-a1f3-4e1f-bbf9-e0b9625e459f.m4a"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-23T02:04:27.140387Z"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"lyrics_timestamped"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"words"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.28</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1.28</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
                    ...
                    <span class="hljs-punctuation">{</span>
                        <span class="hljs-attr">"end"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">188.8</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"index_range"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"line_index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">29</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"start"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">188.16</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"text"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"high"</span><span class="hljs-punctuation">,</span>
                        <span class="hljs-attr">"wav2vec2_format"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span>
                    <span class="hljs-punctuation">}</span>
                <span class="hljs-punctuation">]</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">196.07185941043085</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-8">异步回调</h2>
<p>由于 Riffusion Audios Generation API 生成的时间有时候会相对较长，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
<p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成任务的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
<p>下面我们通过示例来了解下具体怎样操作。</p>
<p>首先，Webhook 回调是一个可以接收 HTTP 请求的服务，开发者应该替换为自己搭建的 HTTP 服务器的 URL。此处为了方便演示，使用一个公开的 Webhook 样例网站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F" target="_blank" title="https://webhook.site/" ref="nofollow noopener noreferrer">webhook.site/</a>，打开该网站即可得到一个 Webhook URL，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/tbcnai.png" alt="" loading="lazy"/></p>
<p>将此 URL 复制下来，就可以作为 Webhook 来使用，此处的样例为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F68368fc6-7f0a-425e-b63a-cc48631615fe" target="_blank" title="https://webhook.site/68368fc6-7f0a-425e-b63a-cc48631615fe" ref="nofollow noopener noreferrer">webhook.site/68368fc6-7f…</a>。</p>
<p>接下来，我们可以设置字段 <code>callback_url</code> 为上述 Webhook URL，同时填入相应的参数，具体的内容如图所示：</p>
<p><img src="https://cdn.acedata.cloud/kk7y6q.png" width="500" class="m-auto" loading="lazy"/></p>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9939767a-7f9c-4f43-aabf-ca68fe385f3c"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>稍等片刻，我们可以在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwebhook.site%2F68368fc6-7f0a-425e-b63a-cc48631615fe" target="_blank" title="https://webhook.site/68368fc6-7f0a-425e-b63a-cc48631615fe" ref="nofollow noopener noreferrer">webhook.site/68368fc6-7f…</a> 上观察到生成任务的结果，如图所示：</p>
<p><img src="https://cdn.acedata.cloud/bgujzg.png" alt="" loading="lazy"/></p>
<p>内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"9939767a-7f9c-4f43-aabf-ca68fe385f3c"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"13a86870-e705-45d0-8447-82a08701c0fa"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"72e6c476-0116-4da9-ae34-f78190020b35"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Rise"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/9b9f3281-6b47-44ac-8e4b-3b0d105e163d/image/72e6c476-0116-4da9-ae34-f78190020b35.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/9b9f3281-6b47-44ac-8e4b-3b0d105e163d/audio/72e6c476-0116-4da9-ae34-f78190020b35.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-15T15:43:22.432605Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-1.0"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"acoustic folk, finger picking"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">184.96</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7f4f5c20-4395-4583-9dbb-735b9bb86957"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Luminance"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"image_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/9b9f3281-6b47-44ac-8e4b-3b0d105e163d/image/7f4f5c20-4395-4583-9dbb-735b9bb86957.jpg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"lyric"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"[Verse]\nWoke up with the sun in my eyes\nNo clouds above just blue in the skies\nShoes on my feet I’m ready to run\nEvery step feels like a loaded gun\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Verse 2]\nDancing through the city streets\nA rhythm pounding in my heartbeat\nStrangers smile it’s catching on\nThis world’s a stage we’re all a song\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high\n[Bridge]\nThrow your worries out the door\nLet them sink to the ocean floor\nWe’re alive and it’s enough\nLife is messy but it’s love\n[Chorus]\nHappy days are rolling in\nLet the joy beneath my skin\nNo more shadows no more lies\nJust the truth that lifts me high"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"audio_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://storage.googleapis.com/corpusant-app-public/riffs/9b9f3281-6b47-44ac-8e4b-3b0d105e163d/audio/7f4f5c20-4395-4583-9dbb-735b9bb86957.m4a"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"created_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-06-15T15:43:21.574561Z"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"FUZZ-1.0"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"deep bass, ethereal electronic"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">165.12</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
<h2 data-id="heading-9">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-10">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-11">结论</h2>
<p>通过本文档，您已经了解了如何使用 Riffusion Audios Generation API 可通过输入提示词来生成音乐。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【oracle】oracle基于数据泵方式进行数据迁移]]></title>    <link>https://juejin.cn/post/7605214360085069860</link>    <guid>https://juejin.cn/post/7605214360085069860</guid>    <pubDate>2026-02-11T10:09:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605214360085069860" data-draft-id="7605214360084627492" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【oracle】oracle基于数据泵方式进行数据迁移"/> <meta itemprop="keywords" content="Oracle"/> <meta itemprop="datePublished" content="2026-02-11T10:09:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="叶甯"/> <meta itemprop="url" content="https://juejin.cn/user/55393274036894"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【oracle】oracle基于数据泵方式进行数据迁移
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/55393274036894/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    叶甯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T10:09:08.000Z" title="Wed Feb 11 2026 10:09:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>下面以windows下oracle操作为例</p>
<h2 data-id="heading-0">1. 使用数据泵备份</h2>
<ul>
<li>在D盘创建目录<code>yn</code>作为备份后的保存的的文件夹</li>
<li>使用dba用户在oracle服务器上登录sqlplus<code> sqlplus sys/sys@orcl as sysdba</code></li>
<li>在sys登录后的sql命令行中创建导出目录对象<code>create or replace directory exp_dir as 'D:\yn\'; </code></li>
<li>授权指定用户具有访问目录的权限
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 授予目录读写权限</span>
<span class="hljs-keyword">grant</span> read,write <span class="hljs-keyword">on</span> directory exp_dir <span class="hljs-keyword">to</span> test_user; 
<span class="hljs-comment">-- 授予数据泵操作权限</span>
<span class="hljs-keyword">grant</span> exp_full_database <span class="hljs-keyword">to</span> test_user;
<span class="hljs-comment">-- 预防用户权限不足</span>
<span class="hljs-keyword">grant</span> dba <span class="hljs-keyword">to</span> test_user; 

</code></pre>
</li>
<li>导出操作(在服务器<code>terminal</code>中执行)</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">expdp test_user/test_user_pass@orcl 
 directory=exp_dir 
 dumpfile=exp_user_20260211.dmp 
 logfile=exp_user_20260211.log
</code></pre>
<p>命令中各字段说明如下</p>
<blockquote>
<p>test_user：登录用户<br/>
test_user_pass：登录用户的密码<br/>
orcl：当前用户的 schema<br/>
exp_dir：前面设置的导出目录名称<br/>
dumpfile：导出的dmp文件名称<br/>
logfile：本次导出操作的日志</p>
</blockquote>
<h2 data-id="heading-1">2. 使用数据泵还原</h2>
<ul>
<li>在D盘创建目录<code>yn</code>作为导入时的保存数据的的文件夹，并将数据复制到这个文件夹下</li>
<li>使用dba用户在oracle服务器上登录sqlplus<code> sqlplus sys/sys@orcl as sysdba</code></li>
<li>在sys登录后的sql命令行中创建导入目录对象<code>create or replace directory imp_dir as 'D:\yn\'; </code></li>
<li>授权指定用户具有访问目录的权限
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 授予目录读写权限</span>
<span class="hljs-keyword">grant</span> read,write <span class="hljs-keyword">on</span> directory imp_dir <span class="hljs-keyword">to</span> test_user; 
<span class="hljs-comment">-- 授予数据泵操作权限</span>
<span class="hljs-keyword">grant</span> imp_full_database <span class="hljs-keyword">to</span> test_user;
<span class="hljs-comment">-- 预防用户权限不足</span>
<span class="hljs-keyword">grant</span> dba <span class="hljs-keyword">to</span> test_user; 
</code></pre>
</li>
<li>导入操作(在服务器<code>terminal</code>中执行)</li>
</ul>
<pre><code class="hljs language-shell" lang="shell">impdp test_user1/test_user_pass@orcl2 
 directory=imp_dir 
 dumpfile=exp_user_20260211.dmp 
 logfile=imp_user_20260211.log
 remap_schema=test_user:test_user1  
 remap_tablespace=orcl1:orcl2
</code></pre>
<p>命令中各字段说明如下</p>
<blockquote>
<p>test_user1：登录用户<br/>
test_user_pass：登录用户的密码<br/>
orcl2：当前用户的 schema<br/>
imp_dir：前面设置的导入目录名称<br/>
dumpfile：待导入的dmp文件名称<br/>
logfile：本次导入操作的日志
remap_schema：解决映射前后用户不一致的问题，前面为：源库用户，后面为：待导入库的用户<br/>
remap_tablespace： 解决表空间前后不一致的问题，前面：源表空间，后面：目标表空间</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建Unity(团结引擎)MCP+Trae/Cursor生产线]]></title>    <link>https://juejin.cn/post/7605401415856291890</link>    <guid>https://juejin.cn/post/7605401415856291890</guid>    <pubDate>2026-02-11T10:07:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605401415856291890" data-draft-id="7605173538418114570" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建Unity(团结引擎)MCP+Trae/Cursor生产线"/> <meta itemprop="keywords" content="MCP"/> <meta itemprop="datePublished" content="2026-02-11T10:07:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="cahoho"/> <meta itemprop="url" content="https://juejin.cn/user/1470480625172570"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建Unity(团结引擎)MCP+Trae/Cursor生产线
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1470480625172570/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    cahoho
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T10:07:02.000Z" title="Wed Feb 11 2026 10:07:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><em>注意：本文需要提前准备科学上网环境。</em><br/><br/>
本文参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FAN4dhT8JMmQv0GZQR6y1FA" target="_blank" title="https://mp.weixin.qq.com/s/AN4dhT8JMmQv0GZQR6y1FA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/AN4dhT8JM…</a><br/>
本文将梳理如何在unity2022.3或者团结引擎上准备UnityMCP，并预留AI接口交由第三方软件AI调用。在这里使用团结引擎1.8。在这里仅展示Trae CN，其他软件如Cursor方法一致。<br/></p>
<h2 data-id="heading-0">准备</h2>
<p>UnityMCP是一个开源项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCoplayDev%2Funity-mcp" target="_blank" title="https://github.com/CoplayDev/unity-mcp" ref="nofollow noopener noreferrer">github.com/CoplayDev/u…</a><br/>
新建unity工程后打开PackageManager，选择【Add package from git url】</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/468391ec8372467ba1591270b105b00c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fob2hv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771409222&amp;x-signature=kXlA2zPXgPW0tqnu2SQxURW574c%3D" alt="91ab815723113053d9e099e216d7a697.png" loading="lazy"/></p>
<p>首先键入<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCoplayDev%2Funity-mcp" target="_blank" title="https://github.com/CoplayDev/unity-mcp" ref="nofollow noopener noreferrer">github.com/CoplayDev/u…</a> ，获取mcp。<br/>接着键入<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fboxqkrtm%2Fcom.unity.ide.cursor.git" target="_blank" title="https://github.com/boxqkrtm/com.unity.ide.cursor.git" ref="nofollow noopener noreferrer">github.com/boxqkrtm/co…</a> 或者 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faerror2%2Fcom.unity.ide.trae.git" target="_blank" title="https://github.com/aerror2/com.unity.ide.trae.git" ref="nofollow noopener noreferrer">github.com/aerror2/com…</a> 分别对应cursor和trae的生产环境，加入之后即可在External Tools访问到这两个软件，并正确配置项目。<br/>
打开拓展窗口，下载插件【Claude Code Chat】【Claude Code for VS Code】【Cline MCP】<br/>
如果本身没有下载unity和C#环境，需要提前准备unity相关插件。C#可以使用【DotRush】</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8207d90b7fd046fa8eaf3dd9ee4246a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fob2hv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771409222&amp;x-signature=mlSymdrtkl6CHKiEqefa14KeTAo%3D" alt="6c57268d37ceab38c3491b0c87758c3f.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a8bc503c32b438a8f493355d30e2681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fob2hv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771409222&amp;x-signature=MBCUXnGEQZ0%2BBuwvPJYTKLmWskY%3D" alt="QQ_1770803657300.png" loading="lazy"/><br/></p>
<h2 data-id="heading-1">Unity端配置</h2>
<p>Unity下载后可以看到窗口要求配置环境。需要下载Python与uv</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 Python：https://www.python.org/downloads/</span>
<span class="hljs-comment">#安装的时候记得要勾选安装 pip 工具</span>


<span class="hljs-comment">#安装 uv（Python 工具链管理器）通过系统命令安装：# macOS / Linux</span>
curl -LsSf https://astral.sh/uv/install.sh | sh

<span class="hljs-comment"># Windows (PowerShell)</span>
winget install --<span class="hljs-built_in">id</span>=astral-sh.uv  -e

<span class="hljs-comment"># Docs: https://docs.astral.sh/uv/getting-started/installation/</span>
</code></pre>
<p>如果环境正确，那么在Unity客户端中逐菜单打开【Window-MCP for Unity-Setup window】将如下显示：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d088a9b149d4c00940167a7d0713298~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fob2hv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771409222&amp;x-signature=xBlmSGZVTwJFS7152U25W3B%2Fx%2FM%3D" alt="e6aa3d6355eb149d3ff5f195f971f41b.png" loading="lazy"/><br/>
接着打开另一个窗口【Toggle MCP Window】：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62b562bf7bae484387a1b809a622c2d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fob2hv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771409222&amp;x-signature=W2pnRnx15LmF7R%2BvRRdCCjJiNf0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fd4f4c348074b8a9e7f2ffc87e2aec0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fob2hv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771409222&amp;x-signature=Xaf5ZY5hSVIeil6Q2zp2YGkwtTo%3D" alt="QQ_1770804065806.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/478577893162451f949a4f5f83ea0e92~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fob2hv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771409222&amp;x-signature=vrwKH8hBk5GBhLwtn1j7KXhqr9c%3D" alt="4675ed1226984c431610a3d44bfd90fa.png" loading="lazy"/><br/></p>
<p>将连接切换为【STDIO】，client设置为自己的软件，复制下面的configuration部分。<br/></p>
<h2 data-id="heading-2">Client设置</h2>
<p>对于Trae，可以打开【设置】-找到【MCP】，选择添加</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5677e4b818d44d6a9a9900a56a59a17f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fob2hv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771409222&amp;x-signature=b439zuhu6KohJ5XpoNN8N5C5QHw%3D" alt="2ac2494944a77aecd794421554de2279.png" loading="lazy"/><br/>
将刚刚复制的文本粘贴过来即可</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e90e69390714f77a81f903c1e01092c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fob2hv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771409222&amp;x-signature=hPT40JxN2HAVgcRtHXryEGueIL8%3D" alt="e86559e6a3646ca2319c0db25ba56be0.png" loading="lazy"/><br/>
如果成功，可以打开cc窗口进行调用，大家可以自行测试一下是否可以进行使用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24625c1806094e20946ee245d5484eaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fob2hv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771409222&amp;x-signature=mmSBIktGLMGjEvtyWG4LX0AE5Cg%3D" alt="f5536fc369180b340145c1355219d209.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c2798c3227974ccab7623e17e7854ec4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY2Fob2hv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771409222&amp;x-signature=XF6ycD%2BM11ry7ymDluigQ6v9lAA%3D" alt="40d0939ab73d480376dcca1f7b8adafe.png" loading="lazy"/><br/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flask 入门指南]]></title>    <link>https://juejin.cn/post/7605150769009573931</link>    <guid>https://juejin.cn/post/7605150769009573931</guid>    <pubDate>2026-02-11T10:42:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605150769009573931" data-draft-id="7605401415856406578" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flask 入门指南"/> <meta itemprop="keywords" content="后端,Python,Flask"/> <meta itemprop="datePublished" content="2026-02-11T10:42:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小张说故事"/> <meta itemprop="url" content="https://juejin.cn/user/741501567509111"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flask 入门指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/741501567509111/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小张说故事
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T10:42:44.000Z" title="Wed Feb 11 2026 10:42:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 库的概览与核心价值</h2>
<p>想象一下,在搭建一个 Web 应用时,如果需要同时处理路由、模板、数据库、表单验证、用户认证等数十个复杂功能,就像试图在一天内盖好一栋摩天大楼——不仅容易迷失方向,还可能因为过度设计而拖垮开发效率。<code>Flask</code>正是为解决这个"选择困难症"而生的轻量级框架。</p>
<p>Flask被称为"微框架"(Microframework),它的核心哲学是"保持简单,按需扩展"。与Django这样自带全套装备的"全栈框架"不同,Flask只提供Web开发最基础的功能:路由分发和模板渲染,其他功能则通过丰富的扩展生态系统来实现。这种设计让开发者能够根据项目需求自主选择工具链,就像搭积木一样灵活组装自己的技术栈。</p>
<p>Flask的不可替代性体现在三个方面:极低的学习曲线让初学者能快速上手,高度的扩展性支持项目从原型到生产环境的平滑演进,而简洁的代码结构则为团队协作和代码维护提供了良好基础。无论是构建简单的API服务、个人博客,还是复杂的企业级应用,Flask都能提供一个优雅而高效的起点。</p>
<h2 data-id="heading-1">2. 环境搭建与 "Hello, World"</h2>
<h3 data-id="heading-2">安装说明</h3>
<p>安装Flask前,强烈建议先创建虚拟环境以隔离项目依赖:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建虚拟环境</span>
python3 -m venv venv

<span class="hljs-comment"># 激活虚拟环境</span>
<span class="hljs-comment"># macOS/Linux:</span>
<span class="hljs-built_in">source</span> venv/bin/activate
<span class="hljs-comment"># Windows:</span>
venv\Scripts\activate

<span class="hljs-comment"># 安装Flask</span>
pip install Flask
</code></pre>
<p>Flask会自动安装以下核心依赖:</p>
<ul>
<li><code>Werkzeug</code>: WSGI工具包,处理HTTP请求和响应</li>
<li><code>Jinja2</code>: 模板引擎,用于生成动态HTML</li>
<li><code>Click</code>: 命令行工具,提供<code>flask</code>命令</li>
<li><code>MarkupSafe</code>: 自动转义HTML,防止XSS攻击</li>
<li><code>ItsDangerous</code>: 数据签名工具,保护session安全</li>
</ul>
<h3 data-id="heading-3">最简示例</h3>
<p>创建一个<code>app.py</code>文件,写入以下代码:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask

<span class="hljs-comment"># 创建Flask应用实例</span>
app = Flask(__name__)

<span class="hljs-comment"># 使用装饰器定义路由</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_world</span>():
    <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;p&gt;Hello, World!&lt;/p&gt;'</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(debug=<span class="hljs-literal">True</span>)
</code></pre>
<h3 data-id="heading-4">逐行解释</h3>
<ul>
<li><code>from flask import Flask</code>: 导入Flask核心类,这是构建应用的起点</li>
<li><code>app = Flask(__name__)</code>: 创建应用实例。<code>__name__</code>参数帮助Flask定位模板和静态文件目录</li>
<li><code>@app.route('/')</code>: 路由装饰器,告诉Flask当用户访问根路径(<code>/</code>)时调用下面的函数</li>
<li><code>def hello_world():</code>: 视图函数,处理请求并返回响应内容</li>
<li><code>return '&lt;p&gt;Hello, World!&lt;/p&gt;'</code>: 返回HTML字符串,Flask会自动将其转换为HTTP响应</li>
<li><code>if __name__ == '__main__':</code>: 确保只有在直接运行脚本时才启动服务器</li>
<li><code>app.run(debug=True)</code>: 启动开发服务器。<code>debug=True</code>开启调试模式,代码修改后自动重载,并提供错误调试页面</li>
</ul>
<h3 data-id="heading-5">运行结果</h3>
<p>在终端执行:</p>
<pre><code class="hljs language-bash" lang="bash">flask --app app run
<span class="hljs-comment"># 或者</span>
python app.py
</code></pre>
<p>服务器启动后,访问 <a href="https://link.juejin.cn?target=http%3A%2F%2F127.0.0.1%3A5000%2F" target="_blank" title="http://127.0.0.1:5000/" ref="nofollow noopener noreferrer">http://127.0.0.1:5000/</a> 即可看到 "Hello, World!" 页面。</p>
<h2 data-id="heading-6">3. 核心概念解析</h2>
<p>Flask的三大核心概念:应用实例、路由系统和请求上下文,它们共同构成了Web应用的骨架。</p>
<h3 data-id="heading-7">应用实例(Application Instance)</h3>
<p>应用实例(<code>app = Flask(__name__)</code>)是Flask应用的中心,负责管理路由、配置和扩展。它通过<code>__name__</code>参数确定模块位置,以便正确查找<code>templates</code>和<code>static</code>目录。可以将应用实例理解为一个"中央指挥官",协调所有组件协同工作。</p>
<h3 data-id="heading-8">路由系统(Routing)</h3>
<p>路由使用装饰器<code>@app.route()</code>将URL路径映射到视图函数:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 基础路由</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/about'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">about</span>():
    <span class="hljs-keyword">return</span> <span class="hljs-string">'About Page'</span>

<span class="hljs-comment"># 动态路由</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/user/&lt;username&gt;'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">show_user</span>(<span class="hljs-params">username</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">f'User: <span class="hljs-subst">{username}</span>'</span>

<span class="hljs-comment"># 类型约束路由</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/post/&lt;int:post_id&gt;'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">show_post</span>(<span class="hljs-params">post_id</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">f'Post ID: <span class="hljs-subst">{post_id}</span>'</span>

<span class="hljs-comment"># 多HTTP方法支持</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/login'</span>, methods=[<span class="hljs-string">'GET'</span>, <span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():
    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">'POST'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'Processing login...'</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Login form'</span>
</code></pre>
<p>动态路由中的<code>&lt;username&gt;</code>和<code>&lt;int:post_id&gt;</code>是URL转换器,前者匹配任意字符串,后者只匹配整数。Flask还支持<code>float</code>、<code>path</code>(包含斜杠)、<code>uuid</code>等转换器。</p>
<h3 data-id="heading-9">请求上下文(Request Context)</h3>
<p>请求上下文包含两个关键代理对象:<code>request</code>和<code>session</code>。它们允许在视图函数中访问请求数据和会话信息,无需显式传递参数。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> request, session

<span class="hljs-comment"># 获取查询参数: /search?q=keyword</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/search'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>():
    keyword = request.args.get(<span class="hljs-string">'q'</span>, <span class="hljs-string">''</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">f'Searching for: <span class="hljs-subst">{keyword}</span>'</span>

<span class="hljs-comment"># 获取表单数据</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/submit'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">submit</span>():
    username = request.form.get(<span class="hljs-string">'username'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">f'Username: <span class="hljs-subst">{username}</span>'</span>

<span class="hljs-comment"># 获取JSON数据</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/api/data'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">api_data</span>():
    data = request.get_json()
    <span class="hljs-keyword">return</span> jsonify(data)

<span class="hljs-comment"># 使用session存储用户状态</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/set_session'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">set_session</span>():
    session[<span class="hljs-string">'user_id'</span>] = <span class="hljs-number">123</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Session set'</span>
</code></pre>
<h3 data-id="heading-10">概念关系图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[Flask应用实例] --&gt; B[路由系统]
    A --&gt; C[配置管理]
    A --&gt; D[扩展注册]
    B --&gt; E[视图函数]
    E --&gt; F[请求上下文]
    F --&gt; G[request对象]
    F --&gt; H[session对象]
    E --&gt; I[响应生成]
    I --&gt; J[字符串/JSON/模板]
    D --&gt; K[数据库扩展]
    D --&gt; L[表单验证扩展]
    D --&gt; M[认证扩展]
</code></pre>
<h2 data-id="heading-11">4. 实战演练:构建一个待办事项API</h2>
<p>让我们通过一个完整的迷你项目来掌握Flask的核心功能。我们将构建一个简单的待办事项管理API,支持增删改查(CRUD)操作。</p>
<h3 data-id="heading-12">需求分析</h3>
<p>我们需要创建一个RESTful API,允许用户:</p>
<ol>
<li>获取所有待办事项</li>
<li>创建新待办事项</li>
<li>更新待办事项状态</li>
<li>删除待办事项</li>
</ol>
<p>数据存储在内存中(列表),适合快速原型开发。</p>
<h3 data-id="heading-13">方案设计</h3>
<p>选择Flask的以下功能:</p>
<ul>
<li>路由系统:定义API端点</li>
<li><code>request</code>对象:解析JSON请求体</li>
<li><code>jsonify</code>:返回JSON格式响应</li>
<li>动态路由:处理特定ID的待办事项</li>
<li>HTTP方法:GET/POST/PUT/DELETE对应CRUD操作</li>
</ul>
<h3 data-id="heading-14">代码实现</h3>
<p>创建<code>todo_api.py</code>:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> flask <span class="hljs-keyword">import</span> Flask, request, jsonify

app = Flask(__name__)

<span class="hljs-comment"># 内存数据库</span>
todos = [
    {<span class="hljs-string">'id'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'title'</span>: <span class="hljs-string">'Learn Flask'</span>, <span class="hljs-string">'completed'</span>: <span class="hljs-literal">False</span>},
    {<span class="hljs-string">'id'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'title'</span>: <span class="hljs-string">'Build API'</span>, <span class="hljs-string">'completed'</span>: <span class="hljs-literal">False</span>}
]
next_id = <span class="hljs-number">3</span>

<span class="hljs-comment"># 获取所有待办事项</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/api/todos'</span>, methods=[<span class="hljs-string">'GET'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_todos</span>():
    <span class="hljs-keyword">return</span> jsonify(todos)

<span class="hljs-comment"># 创建新待办事项</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/api/todos'</span>, methods=[<span class="hljs-string">'POST'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_todo</span>():
    <span class="hljs-keyword">global</span> next_id
    data = request.get_json()
    
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> data <span class="hljs-keyword">or</span> <span class="hljs-string">'title'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> data:
        <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'error'</span>: <span class="hljs-string">'Title is required'</span>}), <span class="hljs-number">400</span>
    
    todo = {
        <span class="hljs-string">'id'</span>: next_id,
        <span class="hljs-string">'title'</span>: data[<span class="hljs-string">'title'</span>],
        <span class="hljs-string">'completed'</span>: data.get(<span class="hljs-string">'completed'</span>, <span class="hljs-literal">False</span>)
    }
    todos.append(todo)
    next_id += <span class="hljs-number">1</span>
    
    <span class="hljs-keyword">return</span> jsonify(todo), <span class="hljs-number">201</span>

<span class="hljs-comment"># 更新待办事项</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/api/todos/&lt;int:todo_id&gt;'</span>, methods=[<span class="hljs-string">'PUT'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">update_todo</span>(<span class="hljs-params">todo_id</span>):
    todo = <span class="hljs-built_in">next</span>((t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> todos <span class="hljs-keyword">if</span> t[<span class="hljs-string">'id'</span>] == todo_id), <span class="hljs-literal">None</span>)
    
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> todo:
        <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'error'</span>: <span class="hljs-string">'Todo not found'</span>}), <span class="hljs-number">404</span>
    
    data = request.get_json()
    todo[<span class="hljs-string">'title'</span>] = data.get(<span class="hljs-string">'title'</span>, todo[<span class="hljs-string">'title'</span>])
    todo[<span class="hljs-string">'completed'</span>] = data.get(<span class="hljs-string">'completed'</span>, todo[<span class="hljs-string">'completed'</span>])
    
    <span class="hljs-keyword">return</span> jsonify(todo)

<span class="hljs-comment"># 删除待办事项</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/api/todos/&lt;int:todo_id&gt;'</span>, methods=[<span class="hljs-string">'DELETE'</span>]</span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_todo</span>(<span class="hljs-params">todo_id</span>):
    <span class="hljs-keyword">global</span> todos
    todo = <span class="hljs-built_in">next</span>((t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> todos <span class="hljs-keyword">if</span> t[<span class="hljs-string">'id'</span>] == todo_id), <span class="hljs-literal">None</span>)
    
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> todo:
        <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'error'</span>: <span class="hljs-string">'Todo not found'</span>}), <span class="hljs-number">404</span>
    
    todos = [t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> todos <span class="hljs-keyword">if</span> t[<span class="hljs-string">'id'</span>] != todo_id]
    <span class="hljs-keyword">return</span> jsonify({<span class="hljs-string">'message'</span>: <span class="hljs-string">'Todo deleted'</span>})

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(debug=<span class="hljs-literal">True</span>)
</code></pre>
<h3 data-id="heading-15">运行说明</h3>
<ol>
<li>启动服务器:</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">python todo_api.py
</code></pre>
<ol start="2">
<li>使用curl或Postman测试API:</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 获取所有待办事项</span>
curl http://127.0.0.1:5000/api/todos

<span class="hljs-comment"># 创建新待办事项</span>
curl -X POST http://127.0.0.1:5000/api/todos \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"title": "Deploy to production"}'</span>

<span class="hljs-comment"># 更新待办事项</span>
curl -X PUT http://127.0.0.1:5000/api/todos/1 \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"completed": true}'</span>

<span class="hljs-comment"># 删除待办事项</span>
curl -X DELETE http://127.0.0.1:5000/api/todos/1
</code></pre>
<h3 data-id="heading-16">结果展示</h3>
<p>这个API完美展示了Flask的核心能力:</p>
<ul>
<li>清晰的路由定义(<code>/api/todos</code>, <code>/api/todos/&lt;id&gt;</code>)</li>
<li>HTTP方法处理(GET/POST/PUT/DELETE)</li>
<li>JSON请求解析(<code>request.get_json()</code>)</li>
<li>错误处理和状态码返回(400/404)</li>
<li>动态路由参数(<code>&lt;int:todo_id&gt;</code>)</li>
</ul>
<h2 data-id="heading-17">5. 最佳实践与常见陷阱</h2>
<h3 data-id="heading-18">常见错误及规避方法</h3>
<h4 data-id="heading-19">错误1: 直接使用<code>app.run()</code>部署到生产环境</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    app.run(host=<span class="hljs-string">'0.0.0.0'</span>, port=<span class="hljs-number">5000</span>)  <span class="hljs-comment"># 仅适合开发环境</span>
</code></pre>
<p>Flask内置服务器性能有限且不安全,生产环境应使用Gunicorn或uWSGI:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ✅ 正确做法: 使用Gunicorn部署</span>
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5000 app:app
</code></pre>
<h4 data-id="heading-20">错误2: 硬编码敏感信息</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法</span>
app.config[<span class="hljs-string">'SECRET_KEY'</span>] = <span class="hljs-string">'my-secret-key-123'</span>
app.config[<span class="hljs-string">'DATABASE_URI'</span>] = <span class="hljs-string">'postgresql://user:password@localhost/db'</span>
</code></pre>
<p>使用环境变量或配置文件:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ✅ 正确做法</span>
<span class="hljs-keyword">import</span> os

app.config[<span class="hljs-string">'SECRET_KEY'</span>] = os.environ.get(<span class="hljs-string">'SECRET_KEY'</span>) <span class="hljs-keyword">or</span> <span class="hljs-string">'dev-key'</span>
app.config[<span class="hljs-string">'DATABASE_URI'</span>] = os.environ.get(<span class="hljs-string">'DATABASE_URI'</span>)

<span class="hljs-comment"># 或者使用配置文件</span>
<span class="hljs-comment"># config.py</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
    SECRET_KEY = os.environ.get(<span class="hljs-string">'SECRET_KEY'</span>)
    SQLALCHEMY_DATABASE_URI = os.environ.get(<span class="hljs-string">'DATABASE_URI'</span>)

<span class="hljs-comment"># app.py</span>
<span class="hljs-keyword">from</span> config <span class="hljs-keyword">import</span> Config
app.config.from_object(Config)
</code></pre>
<h4 data-id="heading-21">错误3: 忘记设置<code>SECRET_KEY</code>导致session无法使用</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ❌ 错误做法</span>
<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/login'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():
    session[<span class="hljs-string">'user_id'</span>] = <span class="hljs-number">1</span>  <span class="hljs-comment"># 会报错: RuntimeError: The session is unavailable</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Logged in'</span>
</code></pre>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ✅ 正确做法</span>
app = Flask(__name__)
app.secret_key = <span class="hljs-string">'your-secret-key-here'</span>  <span class="hljs-comment"># 生产环境应从环境变量读取</span>

<span class="hljs-meta">@app.route(<span class="hljs-params"><span class="hljs-string">'/login'</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():
    session[<span class="hljs-string">'user_id'</span>] = <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'Logged in'</span>
</code></pre>
<h3 data-id="heading-22">最佳实践建议</h3>
<p><strong>1. 使用虚拟环境隔离依赖</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建并激活虚拟环境</span>
python3 -m venv venv
<span class="hljs-built_in">source</span> venv/bin/activate  <span class="hljs-comment"># Windows: venv\Scripts\activate</span>
pip install -r requirements.txt
</code></pre>
<p><strong>2. 生成依赖清单</strong></p>
<pre><code class="hljs language-bash" lang="bash">pip freeze &gt; requirements.txt
</code></pre>
<p><code>requirements.txt</code>文件示例:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Flask</span>==<span class="hljs-number">3.0</span>.<span class="hljs-number">0</span>
<span class="hljs-attr">Werkzeug</span>==<span class="hljs-number">3.0</span>.<span class="hljs-number">1</span>
<span class="hljs-attr">Jinja2</span>==<span class="hljs-number">3.1</span>.<span class="hljs-number">2</span>
</code></pre>
<p><strong>3. 项目结构组织</strong></p>
<p>对于小型项目,建议采用以下结构:</p>
<pre><code class="hljs language-csharp" lang="csharp">myproject/
├── app.py              <span class="hljs-meta"># 主应用文件</span>
├── requirements.txt     <span class="hljs-meta"># 依赖清单</span>
├── config.py           <span class="hljs-meta"># 配置文件</span>
├── templates/          <span class="hljs-meta"># 模板目录</span>
│   └── index.html
└── <span class="hljs-keyword">static</span>/             <span class="hljs-meta"># 静态文件</span>
    ├── css/
    └── js/
</code></pre>
<p>对于大型项目,使用蓝图(Blueprint)模块化:</p>
<pre><code class="hljs language-css" lang="css">myproject/
├── app<span class="hljs-selector-class">.py</span>
├── requirements<span class="hljs-selector-class">.txt</span>
├── blueprints/
│   ├── auth<span class="hljs-selector-class">.py</span>
│   ├── api<span class="hljs-selector-class">.py</span>
│   └── <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.py</span>
└── templates/
</code></pre>
<p><strong>4. 启用调试模式注意事项</strong></p>
<p>开发环境可启用调试模式:</p>
<pre><code class="hljs language-python" lang="python">app.run(debug=<span class="hljs-literal">True</span>)
</code></pre>
<p>但生产环境必须关闭:</p>
<pre><code class="hljs language-python" lang="python">app.run(debug=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># 或不指定,默认为False</span>
</code></pre>
<p>调试模式会暴露敏感信息并允许在浏览器中执行任意Python代码,存在严重安全风险。</p>
<h2 data-id="heading-23">6. 进阶指引</h2>
<p>Flask的简洁性不仅体现在核心功能上,更体现在其强大的扩展能力。当你的项目需要更复杂的功能时,以下扩展值得关注:</p>
<p><strong>数据库集成</strong></p>
<ul>
<li><code>Flask-SQLAlchemy</code>: 提供ORM功能,简化数据库操作</li>
<li><code>Flask-Migrate</code>: 数据库迁移工具,管理表结构变更</li>
</ul>
<p><strong>表单处理与验证</strong></p>
<ul>
<li><code>Flask-WTF</code>: 集成WTForms,提供表单验证和CSRF保护</li>
</ul>
<p><strong>用户认证与授权</strong></p>
<ul>
<li><code>Flask-Login</code>: 管理用户会话和认证状态</li>
<li><code>Flask-Security</code>: 提供完整的认证、角色管理和密码加密</li>
</ul>
<p><strong>API开发</strong></p>
<ul>
<li><code>Flask-RESTful</code>: 快速构建RESTful API</li>
<li><code>Flask-Marshmallow</code>: 序列化/反序列化数据</li>
</ul>
<p><strong>任务队列与异步处理</strong></p>
<ul>
<li><code>Celery</code>: 处理耗时任务(如发送邮件、图片处理)</li>
<li><code>Flask-Celery-Helper</code>: 简化Celery与Flask的集成</li>
</ul>
<h3 data-id="heading-24">学习路径建议</h3>
<ol>
<li><strong>掌握基础</strong>(当前阶段): 理解路由、请求/响应、模板渲染</li>
<li><strong>扩展技能</strong>: 学习3-5个常用扩展,构建功能完整的应用</li>
<li><strong>深入原理</strong>: 研究Flask的上下文机制、信号系统、中间件</li>
<li><strong>生产部署</strong>: 掌握Gunicorn/Nginx部署、Docker容器化</li>
<li><strong>性能优化</strong>: 了解缓存策略、数据库优化、异步处理</li>
</ol>
<h3 data-id="heading-25">学习资源</h3>
<ul>
<li><strong>官方文档</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fflask.palletsprojects.com%2F" target="_blank" title="https://flask.palletsprojects.com/" ref="nofollow noopener noreferrer">flask.palletsprojects.com/</a> (最权威的学习资源)</li>
<li><strong>中文文档</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fflask.github.net.cn%2F" target="_blank" title="https://flask.github.net.cn/" ref="nofollow noopener noreferrer">flask.github.net.cn/</a> (适合中文读者)</li>
<li><strong>GitHub仓库</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpallets%2Fflask" target="_blank" title="https://github.com/pallets/flask" ref="nofollow noopener noreferrer">github.com/pallets/fla…</a> (源码和Issue讨论)</li>
<li><strong>Stack Overflow</strong>: 使用<code>flask</code>标签搜索问题和解决方案</li>
</ul>
<p>Flask的学习曲线平缓,但要精通它需要实践和耐心。建议从简单项目开始,逐步引入新功能和技术,在实践中深化理解。记住,Flask的力量不在于它提供了什么,而在于它不限制你做什么——这正是"微框架"哲学的精髓所在。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[链表核心算法精讲：反转系列+回文判断（迭代+递归双实现）]]></title>    <link>https://juejin.cn/post/7605401415856504882</link>    <guid>https://juejin.cn/post/7605401415856504882</guid>    <pubDate>2026-02-11T11:00:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605401415856504882" data-draft-id="7605150769009590315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="链表核心算法精讲：反转系列+回文判断（迭代+递归双实现）"/> <meta itemprop="keywords" content="后端,JavaScript,算法"/> <meta itemprop="datePublished" content="2026-02-11T11:00:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="颜酱"/> <meta itemprop="url" content="https://juejin.cn/user/905653309941495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            链表核心算法精讲：反转系列+回文判断（迭代+递归双实现）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/905653309941495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    颜酱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T11:00:33.000Z" title="Wed Feb 11 2026 11:00:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">链表核心算法精讲：反转系列+回文判断（迭代+递归双实现）</h2>
<p>在链表算法中，「反转」和「回文判断」是高频基础考点，也是后续解决复杂链表问题（如K个一组反转、区间反转）的核心铺垫。本文将基于力扣经典真题，从「基础反转」到「进阶分组反转」，再到「回文判断最优解」，用 <strong>迭代+递归双实现</strong> 拆解思路，结合代码注释和易错点分析，帮你彻底吃透每一个细节，避免踩坑。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba2055ba7d9c4e3d8d3d94de9ac9da63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aKc6YWx:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771412433&amp;x-signature=tL%2F0CjMNOGma4mLVxjLQeEMN%2F3Y%3D" alt="reverse_link.png" loading="lazy"/></p>
<h3 data-id="heading-1">一、前置基础：链表节点结构</h3>
<p>所有示例基于单链表，节点结构如下（可直接用于测试）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 链表节点构造函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ListNode</span>(<span class="hljs-params">val, next</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">val</span> = (val === <span class="hljs-literal">undefined</span> ? <span class="hljs-number">0</span> : val);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">next</span> = (next === <span class="hljs-literal">undefined</span> ? <span class="hljs-literal">null</span> : next);
}
</code></pre>
<p><strong>示例</strong>：构造链表 1→2→3→4→5</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> head = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(<span class="hljs-number">1</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(<span class="hljs-number">2</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(<span class="hljs-number">3</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(<span class="hljs-number">4</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListNode</span>(<span class="hljs-number">5</span>)))));

</code></pre>
<h3 data-id="heading-2">二、核心算法一：链表反转（3种场景，双实现）</h3>
<p>链表反转的核心逻辑：<strong>改变节点的next指向</strong>，从「往后指」改为「往前指」，需注意保存后续节点（避免断链）。以下分「反转全部节点」「反转前n个节点」「K个一组反转」三种场景，分别实现迭代和递归解法。</p>
<h4 data-id="heading-3">场景1：反转链表的所有节点（力扣206题）</h4>
<p>题目要求：给你单链表的头节点head，请你反转链表，并返回反转后的链表头节点。</p>
<h5 data-id="heading-4">解法1：迭代实现（最优解，空间O(1)）</h5>
<p>迭代思路：用三个指针（prev、cur、next）遍历链表，逐个修改节点指向。核心三步：<strong>保存next → 反转cur指向 → 移动指针</strong>。结合以下详细示例，可直观看到每一步指针变化，完美对应下方代码逻辑。</p>
<p><strong>详细示例</strong>：以链表 1→2→3→4→5 为例，逐步演示迭代反转过程（对应上述代码）：</p>
<ol>
<li>
<p><strong>初始状态</strong>：prev = null，cur = 1（head），链表：1→2→3→4→5</p>
</li>
<li>
<p><strong>第1次循环（cur=1）</strong></p>
<ul>
<li><code>next = cur.next</code> → next = 2（保存下一节点，避免断链）</li>
<li><code>cur.next = prev</code> → 1→null</li>
<li><code>prev = cur, cur = next</code> → prev=1，cur=2</li>
<li>当前链表：null←1　2→3→4→5</li>
</ul>
</li>
<li>
<p><strong>第2次循环（cur=2）</strong></p>
<ul>
<li>next=3；2.next=1；prev=2，cur=3</li>
<li>当前链表：null←1←2　3→4→5</li>
</ul>
</li>
<li>
<p><strong>第3次循环（cur=3）</strong></p>
<ul>
<li>next=4；3.next=2；prev=3，cur=4</li>
<li>当前链表：null←1←2←3　4→5</li>
</ul>
</li>
<li>
<p><strong>第4次循环（cur=4）</strong></p>
<ul>
<li>next=5；4.next=3；prev=4，cur=5</li>
<li>当前链表：null←1←2←3←4　5</li>
</ul>
</li>
<li>
<p><strong>第5次循环（cur=5）</strong></p>
<ul>
<li>next=null；5.next=4；prev=5，cur=null</li>
<li>当前链表：null←1←2←3←4←5（全部反转完成）</li>
</ul>
</li>
<li>
<p><strong>循环终止</strong>：cur = null，返回prev = 5（反转后的新头节点），最终反转结果：5→4→3→2→1。</p>
</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 迭代法反转全部节点（最优版）
 * 时间O(n)，空间O(1)
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode</span>} head 
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">ListNode</span>} 反转后的新头节点
 */</span>
<span class="hljs-keyword">var</span> reverseList = <span class="hljs-keyword">function</span>(<span class="hljs-params">head</span>) {
    <span class="hljs-comment">// 边界条件：空链表或单节点，无需反转，直接返回</span>
    <span class="hljs-keyword">if</span>(head === <span class="hljs-literal">null</span> || head.<span class="hljs-property">next</span> === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> head;
    
    <span class="hljs-keyword">let</span> prev = <span class="hljs-literal">null</span>;  <span class="hljs-comment">// 前驱节点：反转后的尾节点（初始为null）</span>
    <span class="hljs-keyword">let</span> cur = head;   <span class="hljs-comment">// 当前节点：从原链表头开始遍历</span>
    
    <span class="hljs-keyword">while</span>(cur) {
        <span class="hljs-comment">// 步骤1：保存当前节点的下一个节点（关键！避免反转后丢失后续链表）</span>
        <span class="hljs-keyword">const</span> next = cur.<span class="hljs-property">next</span>;
        <span class="hljs-comment">// 步骤2：反转当前节点指向（让cur指向prev，而非next）</span>
        cur.<span class="hljs-property">next</span> = prev;
        <span class="hljs-comment">// 步骤3：移动指针，准备下一次反转</span>
        prev = cur;    <span class="hljs-comment">// prev后移到当前节点（已完成反转）</span>
        cur = next;    <span class="hljs-comment">// cur后移到未反转的下一个节点</span>
    }
    
    <span class="hljs-comment">// 循环结束：cur为null，prev指向原链表最后一个节点（反转后的新头）</span>
    <span class="hljs-keyword">return</span> prev;
};

</code></pre>
<h5 data-id="heading-5">解法2：递归实现（逻辑优雅，空间O(n)）</h5>
<p>递归思路：<strong>先递后归</strong>。先递归反转「当前节点的下一个节点开始的链表」，再修改当前节点与下一个节点的指向，实现局部反转。</p>
<p>核心理解：递归的「递」是走到链表末尾（找到反转后的新头），「归」是从末尾往回，逐个修改节点指向。以下示例全程对应下方递归代码，清晰呈现「递」和「归」的每一步操作。</p>
<p><strong>详细示例</strong>：仍以链表 1→2→3→4→5 为例，演示递归反转的「递」和「归」全过程（对应上述代码）：</p>
<ol>
<li>
<p><strong>递的过程</strong>（找终止条件，走到链表末尾）</p>
<ul>
<li>reverseList(1)→reverseList(2)→…→reverseList(5)；</li>
<li>reverseList(5) 时 5.next=null，返回 newHead=5（新头，之后不变）。</li>
</ul>
</li>
<li>
<p><strong>归的过程</strong>（从末尾往回，改指向）</p>
<ul>
<li><strong>归1</strong> reverseList(4)：<code>4.next.next=4</code> → 5→4，<code>4.next=null</code>；链表 4→null，5→4。</li>
<li><strong>归2</strong> reverseList(3)：4→3，3→null；链表 3→null，4→3，5→4。</li>
<li><strong>归3</strong> reverseList(2)：3→2，2→null。</li>
<li><strong>归4</strong> reverseList(1)：2→1，1→null；链表 1→null，2→1，3→2，4→3，5→4。</li>
</ul>
</li>
<li>
<p><strong>最终结果</strong>：返回 newHead=5，反转后的链表为 5→4→3→2→1，与迭代结果一致。</p>
</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 递归法反转全部节点
 * 时间O(n)，空间O(n)（递归栈深度=链表长度）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode</span>} head 
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">ListNode</span>} 反转后的新头节点
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverseList</span>(<span class="hljs-params">head</span>) {
    <span class="hljs-comment">// 终止条件：空链表或单节点，直接返回（反转后的新头就是自身）</span>
    <span class="hljs-keyword">if</span>(head === <span class="hljs-literal">null</span> || head.<span class="hljs-property">next</span> === <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> head;
    }
    
    <span class="hljs-comment">// 递：反转当前节点的下一个节点开始的链表，得到新头newHead</span>
    <span class="hljs-keyword">let</span> newHead = <span class="hljs-title function_">reverseList</span>(head.<span class="hljs-property">next</span>);
    
    <span class="hljs-comment">// 归：修改当前节点与下一个节点的指向，实现局部反转</span>
    <span class="hljs-keyword">const</span> oldHead = head;
    oldHead.<span class="hljs-property">next</span>.<span class="hljs-property">next</span> = oldHead;  <span class="hljs-comment">// 让下一个节点指向当前节点（反转指向）</span>
    oldHead.<span class="hljs-property">next</span> = <span class="hljs-literal">null</span>;          <span class="hljs-comment">// 让当前节点指向null（避免环）</span>
    
    <span class="hljs-comment">// 始终返回反转后的新头（递归全程不变，就是原链表最后一个节点）</span>
    <span class="hljs-keyword">return</span> newHead;
}

</code></pre>
<h5 data-id="heading-6">迭代 vs 递归对比</h5>

























<table><thead><tr><th>维度</th><th>迭代</th><th>递归</th></tr></thead><tbody><tr><td>空间</td><td>O(1)</td><td>O(n) 栈深</td></tr><tr><td>适用</td><td>长链表、面试首选</td><td>逻辑清晰，注意栈限制（如 JS 约 1e3 层）</td></tr><tr><td>共性</td><td>都是改 <code>next</code> 指向，都要先保存 next 避免断链</td><td>同上</td></tr></tbody></table>
<h5 data-id="heading-7">易错点（高频踩坑）</h5>
<ul>
<li>漏判边界：空链表 / 单节点要直接返回。</li>
<li>反转写反：应是 <code>cur.next = prev</code>，不是 <code>prev.next = next</code>。</li>
<li>返回值：循环结束应返回 <code>prev</code>（新头），不是 <code>cur</code>（已为 null）。</li>
<li>递归成环：归时必须 <code>oldHead.next = null</code>，否则形成环。</li>
</ul>
<h4 data-id="heading-8">场景2：反转链表的前n个节点</h4>
<p>题目要求：给定链表头节点head和整数n，反转从head开始的前n个节点，剩余节点保持不变，返回反转后的新头节点。</p>
<p>示例：1→2→3→4→5，n=2 → 2→1→3→4→5</p>
<h5 data-id="heading-9">解法1：迭代实现（空间O(1)）</h5>
<p>迭代思路：在「反转全部节点」的基础上，增加「循环n次」的限制，反转n个节点后，将原head（反转后的尾）接回未反转的节点（n+1个节点）。以下示例以题目给出的案例为准，逐步演示每一步操作，对应下方代码，帮你理清「循环n次」和「拼接未反转部分」的核心逻辑。</p>
<p><strong>详细示例</strong>：以链表 1→2→3→4→5、n=2 为例（对应题目示例），逐步演示迭代反转前2个节点：</p>
<ol>
<li>
<p><strong>初始状态</strong>：prev = null，cur = 1（head），next = 2，n=2；链表：1→2→3→4→5</p>
</li>
<li>
<p><strong>第1次循环（n=2）</strong>：1.next=null，prev=1，cur=2，next=3，n=1；当前：null←1　2→3→4→5</p>
</li>
<li>
<p><strong>第2次循环（n=1）</strong>：2.next=1，prev=2，cur=3，next=4，n=0；当前：null←1←2　3→4→5</p>
</li>
<li>
<p><strong>循环终止（n=0）</strong>：<code>head.next = cur</code> → 1.next=3（尾接回未反转部分）；返回 prev=2。<strong>结果</strong>：2→1→3→4→5。</p>
</li>
</ol>
<blockquote>
<p><strong>补充</strong>：n=3 时循环 3 次后 prev=3，cur=4，head.next=4，结果 3→2→1→4→5。注意 n 超过链表长度时需在循环中判空（如 <code>cur</code> 为 null 则提前结束）。</p>
</blockquote>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 迭代版反转前n个节点
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode</span>} <span class="hljs-variable">head</span> - 起始节点
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">n</span> - 要反转的节点数
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">ListNode</span>} 反转后的新头节点
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverseListN</span>(<span class="hljs-params">head, n</span>) {
    <span class="hljs-comment">// 边界条件：空链表/单节点，或n≤1（无需反转）</span>
    <span class="hljs-keyword">if</span>(head === <span class="hljs-literal">null</span> || head.<span class="hljs-property">next</span> === <span class="hljs-literal">null</span> || n &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> head;
    
    <span class="hljs-keyword">let</span> prev = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">let</span> cur = head;
    
    <span class="hljs-comment">// 循环n次，只反转前n个节点</span>
    <span class="hljs-keyword">while</span> (n &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">const</span> next = cur.<span class="hljs-property">next</span>; 
        cur.<span class="hljs-property">next</span> = prev;  <span class="hljs-comment">// 反转当前节点指向</span>
        prev = cur;       <span class="hljs-comment">// prev后移</span>
        cur = next;       <span class="hljs-comment">// cur后移</span>
        
        n--;  <span class="hljs-comment">// 剩余反转节点数减1</span>
    }
    
    <span class="hljs-comment">// 关键：将反转后的尾节点（原head）接回未反转的节点（cur）</span>
    head.<span class="hljs-property">next</span> = cur;
    
    <span class="hljs-comment">// prev指向反转后的新头（原第n个节点）</span>
    <span class="hljs-keyword">return</span> prev;
};

</code></pre>
<h5 data-id="heading-10">解法2：递归实现（只遍历一次，空间O(n)）</h5>
<p>递归思路：用全局变量保存「未反转部分的第一个节点（n+1个节点）」，递归到第n个节点后，往回修改指向，同时拼接未反转部分。</p>
<p>核心优势：只遍历一次链表，无需提前找到第n个节点，逻辑更简洁。以下示例仍沿用题目案例，与下方递归代码一一对应，清晰呈现「递」「归」过程中「保存未反转节点」和「拼接」的操作。</p>
<p><strong>详细示例</strong>：仍以链表 1→2→3→4→5、n=2 为例，演示递归版反转前n个节点（对应上述代码）：</p>
<ol>
<li>
<p><strong>初始状态</strong>：全局变量 next = null；调用 reverseListN(1, 2)；链表：1→2→3→4→5</p>
</li>
<li>
<p><strong>递</strong>：reverseListN(1,2) → reverseListN(2,1)；n≤1 时 next=2.next=3，返回 newHead=2。</p>
</li>
<li>
<p><strong>归</strong>：回到 reverseListN(1,2)；<code>head.next.next=head</code> → 2→1；<code>head.next=next</code> → 1→3；返回 newHead=2。<strong>结果</strong>：2→1→3→4→5。</p>
</li>
</ol>
<p><strong>核心理解</strong>：递归到第n个节点时，保存未反转的节点（next），归的过程中同时完成「反转指向」和「拼接未反转部分」，无需额外遍历。这一逻辑正好对应下方代码中全局变量next的作用，以及归过程中的两次指向修改。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 全局变量：保存未反转部分的第一个节点（n+1个节点），避免递归中丢失</span>
<span class="hljs-keyword">let</span> next = <span class="hljs-literal">null</span>;

<span class="hljs-comment">/**
 * 递归版反转前n个节点（只遍历一次）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode</span>} <span class="hljs-variable">head</span> - 起始节点
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">n</span> - 要反转的节点数
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">ListNode</span>} 反转后的新头节点
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverseListN</span>(<span class="hljs-params">head, n</span>) {
    <span class="hljs-comment">// 边界条件：空链表/单节点</span>
    <span class="hljs-keyword">if</span>(head === <span class="hljs-literal">null</span> || head.<span class="hljs-property">next</span> === <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> head;
    }
    
    <span class="hljs-comment">// 终止条件：n≤1（走到第n个节点）</span>
    <span class="hljs-keyword">if</span>(n &lt;= <span class="hljs-number">1</span>) {
        next = head.<span class="hljs-property">next</span>;  <span class="hljs-comment">// 保存未反转部分的第一个节点</span>
        <span class="hljs-keyword">return</span> head;       <span class="hljs-comment">// 第n个节点就是反转后的新头</span>
    }
    
    <span class="hljs-comment">// 递：反转head.next开始的前n-1个节点，得到新头</span>
    <span class="hljs-keyword">let</span> newHead = <span class="hljs-title function_">reverseListN</span>(head.<span class="hljs-property">next</span>, n - <span class="hljs-number">1</span>);
    
    <span class="hljs-comment">// 归：修改当前节点与下一个节点的指向，拼接未反转部分</span>
    head.<span class="hljs-property">next</span>.<span class="hljs-property">next</span> = head;  <span class="hljs-comment">// 下一个节点指向当前节点（反转）</span>
    head.<span class="hljs-property">next</span> = next;       <span class="hljs-comment">// 当前节点指向未反转部分（拼接）</span>
    
    <span class="hljs-keyword">return</span> newHead;
}

</code></pre>
<h4 data-id="heading-11">场景3：K个一组反转链表（力扣25题，进阶）</h4>
<p>题目要求：给你链表的头节点head，每k个节点一组进行反转，请你返回修改后的链表。如果链表的节点数不是k的整数倍，那么最后剩余的节点保持原有顺序。</p>
<p>示例：1→2→3→4→5，k=2 → 2→1→4→3→5</p>
<h5 data-id="heading-12">核心思路（递归+迭代结合）</h5>
<p>结合「反转前n个节点」的迭代实现，用递归处理分组：</p>
<ol>
<li>
<p>找到当前组的末尾节点end（从head开始数k个），不足k个则直接返回原head（不反转）；</p>
</li>
<li>
<p>保存下一组的起始节点nextStart，避免反转后丢失；</p>
</li>
<li>
<p>迭代反转当前组（head到end），得到新头newHead；</p>
</li>
<li>
<p>递归处理下一组，将当前组的尾节点（原head）接上下一组的头；</p>
</li>
<li>
<p>返回当前组的新头newHead。</p>
</li>
</ol>
<p><strong>详细示例</strong>：以链表 1→2→3→4→5、k=2 为例（对应题目示例），逐步演示K个一组反转，每一步均对应下方代码逻辑，清晰呈现「分组→反转→递归→拼接」的完整流程：</p>
<ol>
<li><strong>第一组 1→2</strong>：end=2，nextStart=3；reverseListN(1,2) → newHead=2（2→1）；递归 reverseKGroup(3,2)。</li>
<li><strong>第二组 3→4</strong>：end=4，nextStart=5；reverseListN(3,2) → newHead=4（4→3）；递归 reverseKGroup(5,2)。</li>
<li><strong>第三组 5</strong>：从 5 数 2 个时 end=5.next=null，不足 k 个，直接返回 head=5。</li>
<li><strong>回溯拼接</strong>：第二组 head=3，head.next=5；第一组 head=1，head.next=4。</li>
<li><strong>结果</strong>：2→1→4→3→5。</li>
</ol>
<blockquote>
<p><strong>补充</strong>：k=3 时前 3 个反转为 3→2→1，后 2 个不足 k 不反转，结果 3→2→1→4→5。对应代码中 <code>end===null</code> 时返回原 head。</p>
</blockquote>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * K个一组反转链表（力扣25题最优解）
 * 时间O(n)，空间O(n)（递归栈深度=链表长度/k）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode</span>} <span class="hljs-variable">head</span> - 链表头节点
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">k</span> - 每组反转的节点数
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">ListNode</span>} 反转后的链表头节点
 */</span>
<span class="hljs-keyword">var</span> reverseKGroup = <span class="hljs-keyword">function</span>(<span class="hljs-params">head, k</span>) {
    <span class="hljs-comment">// 边界条件：空链表/单节点，直接返回</span>
    <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span> || head.<span class="hljs-property">next</span> === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> head;

    <span class="hljs-comment">// 步骤1：找到当前组的末尾节点end（从head开始数k个）</span>
    <span class="hljs-keyword">let</span> end = head;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= k - <span class="hljs-number">1</span>; i++) {
        end = end.<span class="hljs-property">next</span>;
        <span class="hljs-comment">// 易错点：不足k个节点，直接返回原head（不反转）</span>
        <span class="hljs-keyword">if</span> (end === <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> head;
        }
    }

    <span class="hljs-comment">// 步骤2：保存下一组的起始节点（避免反转后丢失）</span>
    <span class="hljs-keyword">const</span> nextStart = end.<span class="hljs-property">next</span>;
    <span class="hljs-comment">// 步骤3：迭代反转当前组（head到end，共k个节点）</span>
    <span class="hljs-keyword">let</span> newHead = <span class="hljs-title function_">reverseListN</span>(head, k);
    <span class="hljs-comment">// 步骤4：递归处理下一组，拼接当前组和下一组</span>
    head.<span class="hljs-property">next</span> = <span class="hljs-title function_">reverseKGroup</span>(nextStart, k);
    <span class="hljs-comment">// 步骤5：返回当前组的新头（原end节点）</span>
    <span class="hljs-keyword">return</span> newHead;
};

<span class="hljs-comment">// 复用场景2的「迭代版反转前n个节点」（循环内取 next，避免 n 超长时空指针）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">reverseListN</span>(<span class="hljs-params">head, n</span>) {
    <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span> || head.<span class="hljs-property">next</span> === <span class="hljs-literal">null</span> || n &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> head;
    <span class="hljs-keyword">let</span> prev = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">let</span> cur = head;
    <span class="hljs-keyword">while</span> (n &gt; <span class="hljs-number">0</span> &amp;&amp; cur) {
        <span class="hljs-keyword">const</span> next = cur.<span class="hljs-property">next</span>;
        cur.<span class="hljs-property">next</span> = prev;
        prev = cur;
        cur = next;
        n--;
    }
    head.<span class="hljs-property">next</span> = cur;
    <span class="hljs-keyword">return</span> prev;
}

</code></pre>
<h5 data-id="heading-13">易错点总结</h5>
<ul>
<li>
<p>未判空end（不足k个节点时），导致空指针错误；</p>
</li>
<li>
<p>忘记保存nextStart，反转当前组后丢失下一组节点；</p>
</li>
<li>
<p>递归拼接时，错误地将end.next接上下一组，正确拼接的是head.next（原head是当前组的尾）。</p>
</li>
</ul>
<h3 data-id="heading-14">三、核心算法二：回文链表判断（力扣234题，最优解）</h3>
<p>题目要求：给你一个单链表的头节点head，请你判断该链表是否为回文链表。如果是，返回true；否则，返回false。</p>
<p>回文的核心定义：链表从前到后读，和从后到前读，节点值完全一致（如1→2→2→1、1→2→3→2→1）。</p>
<h4 data-id="heading-15">核心思路（空间O(1)最优解）</h4>
<p>结合「找中点」和「链表反转」，避免使用额外空间存储节点值，步骤如下：</p>
<ol>
<li>
<p>找中点：用快慢指针找到链表前半段的最后一个节点，将链表拆分为前半段和后半段；</p>
</li>
<li>
<p>反转后半段：将后半段链表反转，使其与前半段链表方向一致；</p>
</li>
<li>
<p>前后对比：同步遍历前半段和反转后的后半段，若所有节点值相等，则是回文；</p>
</li>
<li>
<p>恢复链表（可选，面试加分）：将反转后的后半段再反转一次，还原原链表结构（体现鲁棒性）。</p>
</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 判断单链表是否为回文链表（空间O(1)最优解）
 * 时间O(n)，空间O(1)
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode</span>} <span class="hljs-variable">head</span> - 链表头节点
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>} 是否为回文链表
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isPalindrome</span>(<span class="hljs-params">head</span>) {
    <span class="hljs-comment">// 易错点1：边界条件（空链表/单节点直接是回文）</span>
    <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span> || head.<span class="hljs-property">next</span> === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

    <span class="hljs-comment">// 初始化前半段遍历指针：从链表头开始</span>
    <span class="hljs-comment">// 易错点2：必须用let声明（要后移），不能用const（const不可修改）</span>
    <span class="hljs-keyword">let</span> leftStart = head;
    <span class="hljs-comment">// 步骤1：找链表「前半段最后一个节点」（关键！为了拆分前后段）</span>
    <span class="hljs-keyword">const</span> leftEnd = <span class="hljs-title function_">findMid</span>(head);
    <span class="hljs-comment">// 步骤2：记录后半段的原始头节点（反转的起始点）</span>
    <span class="hljs-keyword">const</span> oldRightStart = leftEnd.<span class="hljs-property">next</span>;

    <span class="hljs-comment">// 步骤3：反转后半段链表，得到反转后的后半段头节点</span>
    <span class="hljs-keyword">let</span> rightStart = <span class="hljs-title function_">reverseList</span>(oldRightStart);
    <span class="hljs-comment">// 保存反转后的后半段头节点（用于后续恢复链表，避免反转后指针丢失）</span>
    <span class="hljs-comment">// 易错点3：必须提前保存，否则遍历rightStart后会指向null，无法恢复</span>
    <span class="hljs-keyword">const</span> lastNode = rightStart;

    <span class="hljs-comment">// 初始化结果标记：默认是回文</span>
    <span class="hljs-keyword">let</span> res = <span class="hljs-literal">true</span>;

    <span class="hljs-comment">// 步骤4：对比前半段 和 反转后的后半段</span>
    <span class="hljs-comment">// 循环条件：后半段没遍历完 且 结果还是回文（提前终止，优化性能）</span>
    <span class="hljs-comment">// 易错点4：循环条件用rightStart（后半段长度≤前半段），不用leftStart（避免越界）</span>
    <span class="hljs-keyword">while</span> (rightStart &amp;&amp; res) {
        <span class="hljs-comment">// 对比当前节点值</span>
        <span class="hljs-keyword">if</span> (rightStart.<span class="hljs-property">val</span> !== leftStart.<span class="hljs-property">val</span>) {
            res = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 有一个值不等，直接标记为非回文</span>
        }
        <span class="hljs-comment">// 前半段指针后移</span>
        leftStart = leftStart.<span class="hljs-property">next</span>;
        <span class="hljs-comment">// 后半段指针后移</span>
        rightStart = rightStart.<span class="hljs-property">next</span>;
    }

    <span class="hljs-comment">// 步骤5：恢复链表（面试加分项！体现鲁棒性，不破坏原链表结构）</span>
    <span class="hljs-comment">// 易错点5：必须用保存的lastNode，不能用rightStart（已遍历到null）</span>
    leftEnd.<span class="hljs-property">next</span> = <span class="hljs-title function_">reverseList</span>(lastNode);

    <span class="hljs-comment">// 返回最终结果</span>
    <span class="hljs-keyword">return</span> res;

    <span class="hljs-comment">/**
     * 辅助函数：找链表「前半段最后一个节点」（慢指针法）
     * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode</span>} <span class="hljs-variable">head</span> - 链表头节点
     * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">ListNode</span>} 前半段最后一个节点
     */</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">findMid</span>(<span class="hljs-params">head</span>) {
        <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span> || head.<span class="hljs-property">next</span> === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> head;
        <span class="hljs-keyword">let</span> slow = head; <span class="hljs-comment">// 慢指针：每次走1步</span>
        <span class="hljs-keyword">let</span> fast = head; <span class="hljs-comment">// 快指针：每次走2步</span>

        <span class="hljs-comment">// 易错点6：循环条件（核心！决定slow的最终位置）</span>
        <span class="hljs-comment">// 错误写法：while(fast &amp;&amp; fast.next) → slow会走到后半段第一个节点</span>
        <span class="hljs-comment">// 正确写法：while(fast.next &amp;&amp; fast.next.next) → slow停在前半段最后一个节点</span>
        <span class="hljs-keyword">while</span> (fast.<span class="hljs-property">next</span> &amp;&amp; fast.<span class="hljs-property">next</span>.<span class="hljs-property">next</span>) {
            slow = slow.<span class="hljs-property">next</span>;
            fast = fast.<span class="hljs-property">next</span>.<span class="hljs-property">next</span>;
        }
        <span class="hljs-keyword">return</span> slow;
    }

    <span class="hljs-comment">/**
     * 辅助函数：迭代法反转单链表（复用之前的最优版）
     * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode</span>} <span class="hljs-variable">head</span> - 要反转的链表头节点
     * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">ListNode</span>} 反转后的新头节点
     */</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">reverseList</span>(<span class="hljs-params">head</span>) {
        <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span> || head.<span class="hljs-property">next</span> === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> head;
        <span class="hljs-keyword">let</span> prev = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">let</span> cur = head;
        <span class="hljs-keyword">while</span> (cur) {
            <span class="hljs-keyword">const</span> next = cur.<span class="hljs-property">next</span>;
            cur.<span class="hljs-property">next</span> = prev;
            prev = cur;
            cur = next;
        }
        <span class="hljs-keyword">return</span> prev;
    }
}

</code></pre>
<h4 data-id="heading-16">补充：递归版回文判断（易懂但空间O(n)）</h4>
<p>思路：利用递归「后序遍历」的特性（从后往前遍历节点），同时用一个指针从前往后遍历，逐一对比前后节点值。</p>
<p><strong>先说说后序遍历</strong>（链表 1→2→3 时，先递到末尾再在「归」时打印，输出顺序为 3→2→1）：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">traverse</span>(<span class="hljs-params">head</span>) {
  <span class="hljs-keyword">if</span> (head === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;
  <span class="hljs-title function_">traverse</span>(head.<span class="hljs-property">next</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(head.<span class="hljs-property">val</span>);  <span class="hljs-comment">// 放在递归调用之后 → 归的时候才执行</span>
}
</code></pre>


















































<table><thead><tr><th>阶段</th><th>执行动作</th><th>是否「归」</th></tr></thead><tbody><tr><td>递 1</td><td>调用 traverse(1) → 先执行 traverse(2)</td><td>❌ 递</td></tr><tr><td>递 2</td><td>调用 traverse(2) → 先执行 traverse(3)</td><td>❌ 递</td></tr><tr><td>递 3</td><td>调用 traverse(3) → 先执行 traverse(null)</td><td>❌ 递</td></tr><tr><td>终止</td><td>traverse(null) 触发返回</td><td>递的终点</td></tr><tr><td>归 1</td><td>回到 traverse(3) → 执行 console.log(3)</td><td>✅ 归</td></tr><tr><td>归 2</td><td>回到 traverse(2) → 执行 console.log(2)</td><td>✅ 归</td></tr><tr><td>归 3</td><td>回到 traverse(1) → 执行 console.log(1)</td><td>✅ 归</td></tr><tr><td>结束</td><td>traverse(1) 执行完，递归结束</td><td>—</td></tr></tbody></table>
<p>基于「归」时从后往前的特性，回文判断代码可以这样写：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 递归版回文判断（易懂但空间O(n)）
 * 时间O(n)，空间O(n)（递归栈深度=链表长度）
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">ListNode</span>} head 
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>}
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isPalindrome</span>(<span class="hljs-params">head</span>) {
    <span class="hljs-keyword">if</span>(head === <span class="hljs-literal">null</span> || head.<span class="hljs-property">next</span> === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    
    <span class="hljs-keyword">let</span> p = head; <span class="hljs-comment">// 前向指针：从前往后遍历</span>
    <span class="hljs-keyword">let</span> res = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 结果标记</span>
    
    <span class="hljs-comment">// 递归后序遍历：从后往前遍历节点</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">traverse</span>(<span class="hljs-params">node</span>) {
        <span class="hljs-keyword">if</span>(node === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-title function_">traverse</span>(node.<span class="hljs-property">next</span>); <span class="hljs-comment">// 递：走到链表末尾</span>
        
        <span class="hljs-comment">// 归：从后往前对比（node是后向节点，p是前向节点）</span>
        <span class="hljs-keyword">if</span> (p.<span class="hljs-property">val</span> !== node.<span class="hljs-property">val</span>) {
            res = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 提前终止当前递归层，无法终止整个递归</span>
        }
        p = p.<span class="hljs-property">next</span>; <span class="hljs-comment">// 前向指针后移，准备下一次对比</span>
    }
    
    <span class="hljs-title function_">traverse</span>(head);
    <span class="hljs-keyword">return</span> res;
};

</code></pre>
<h4 data-id="heading-17">两种回文判断对比</h4>

























<table><thead><tr><th>解法</th><th>空间</th><th>特点</th></tr></thead><tbody><tr><td>找中点+反转后半段</td><td>O(1)</td><td>面试首选，需掌握找中点和反转细节</td></tr><tr><td>递归后序对比</td><td>O(n)</td><td>好理解，适合入门；面试可作口述思路</td></tr><tr><td>共性</td><td>—</td><td>都是「前后对撞对比」，区别在是否用额外空间</td></tr></tbody></table>
<h3 data-id="heading-18">四、总结与刷题建议</h3>
<h4 data-id="heading-19">1. 核心知识点梳理</h4>
<ul>
<li>
<p>反转系列：核心是「修改节点next指向」，迭代优先（空间优），递归为辅（逻辑优）；</p>
</li>
<li>
<p>回文判断：最优解是「找中点+反转后半段」，兼顾空间和效率，体现算法思维；</p>
</li>
<li>
<p>递归关键：理解「先递后归」，递是找终止条件，归是做具体操作（反转/对比）。</p>
</li>
</ul>
<h4 data-id="heading-20">2. 易错点汇总（必背）</h4>
<ol>
<li>
<p>边界条件：空链表、单节点、n≤1、不足k个节点，需提前判空/终止；</p>
</li>
<li>
<p>指针操作：反转时先保存next，避免断链；遍历指针用let声明，便于后移；</p>
</li>
<li>
<p>拼接操作：反转前n个节点、K个一组反转、回文判断，需注意拼接未反转部分；</p>
</li>
<li>
<p>返回值：反转后返回prev（新头），而非cur或head；回文判断需返回全局结果标记。</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【2025】加入 uniapp 的一年]]></title>    <link>https://juejin.cn/post/7605174711181951039</link>    <guid>https://juejin.cn/post/7605174711181951039</guid>    <pubDate>2026-02-11T09:04:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605174711181951039" data-draft-id="7605150769008558123" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【2025】加入 uniapp 的一年"/> <meta itemprop="keywords" content="前端,uni-app"/> <meta itemprop="datePublished" content="2026-02-11T09:04:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="笨笨狗吞噬者"/> <meta itemprop="url" content="https://juejin.cn/user/245921884145240"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【2025】加入 uniapp 的一年
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/245921884145240/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    笨笨狗吞噬者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:04:48.000Z" title="Wed Feb 11 2026 09:04:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>本文主要分享过去一年自己入职 uniapp 的经历。</p>
<h2 data-id="heading-1">经历</h2>
<h3 data-id="heading-2">未雨绸缪的离职</h3>
<p>2025 年过完年之后，因为各种原因，我打定了离职的想法。经历了一段时间的折腾，拿到了一个 offer，当时感觉还可以，已经打算去了。</p>
<p>后面，耗子哥联系我说 uniapp 在招人，问我要不要试试，当时也没多想，反正试试又不要钱，走了朋友的内推，顺利通过了两轮面试，四月初就入职了。</p>
<h3 data-id="heading-3">压力山大的实习</h3>
<p>情况并没有我想象的那么好，甚至可以说是相当糟糕。</p>
<p>公司要做的东西不是常规业务，加上自己对 vue 的编译时、运行时等等也不熟悉，想修复社区的问题也是相当难受，因为我压根不了解 uniapp 的使用，上家公司用 uniapp vue2 做了微信小程序，对它的印象糟糕透了，也就没花功夫去学习下。</p>
<p>不过，对我而言，还是有些好的消息。</p>
<ul>
<li>内推我的同事对我很好，不懂的内容都可以去请教他；前端组的同事实力很强，也必较耐心</li>
<li>之前写过 rollup、vite、eslint 和 vscode 插件，维护过不少开源项目，不至于对于 node、编译相关的东西一窍不通</li>
</ul>
<p>大概入职一周左右，我开始尝试提交第一个pr，这个修复成为了我那几天的噩梦，uniapp 还是挺复杂的，很多东西我根本就不明白，设计，实现，修复和验证的流程等等。</p>
<p>我花了不少时间，可是还没解决那个app端的问题，当时很沮丧，都有点打退堂鼓的意思了。</p>
<p>后面我开始尝试其他端问题的修复，领导也跟我说让我解决小程序相关的问题，我就开始了打怪升级之路。</p>
<p>试用期是三个月，大概六月底，就开始了转正答辩，中间也是折腾了很久，这里就不赘述了（说多了都是泪）。</p>
<p>我的答辩 md 文件我是存储在了 github 上，截一部分当时做的内容。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ab4cd8781fd43b4827c43fe0ef63dd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56yo56yo54uX5ZCe5Zms6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771405488&amp;x-signature=doVxRiOpZeSdvTF1R1auKYVPRwk%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-4">慢慢成长的转正</h3>
<p>转正之后，随着工作的进行，对于 uniapp 也越来越熟悉，自己的能力也得到了不少提升，在掘金和uniapp的ask社区也写了一些小程序相关的文章。</p>
<p>上家公司当时写小程序被包体积超出的问题来回折磨，回头想想，自己目前会的应该能极大地缓解这个问题。</p>
<p>github 的 uniapp 仓库我刚刚查了一下，大概有 400 多次提交（包含 dev分支 (vue2)、next分支 （vue3）），不知道什么时候能超过前面的辛宝哥。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83a81073286b432fac5e0bf0fade41f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56yo56yo54uX5ZCe5Zms6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771405488&amp;x-signature=zGioiR1XAfLKKBSLNrz7rTkE2cc%3D" alt="image.png" loading="lazy"/></p>
<p>因为自己主要负责小程序方面，这段时间对于 uniapp 和 小程序有了更多的了解，还荣幸地加入了 uni-helper 社区。</p>
<p>除了技术，终于在年底拿到了驾照。</p>
<p>我大概在7-8月份报考了海淀驾校，那个时候顶着炎炎烈日去驾校练车，基本都是周末的时间，真的太遭罪了。</p>
<p>每学一次车，一天的时间都要花费在这上面了，不过好在结局不错，顺利一把过，拿到了驾照。</p>
<h2 data-id="heading-5">结语</h2>
<p>新的一年，希望大家都能更好。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java学习第36天 - 响应式编程、虚拟线程与现代化技术栈]]></title>    <link>https://juejin.cn/post/7605214360084398116</link>    <guid>https://juejin.cn/post/7605214360084398116</guid>    <pubDate>2026-02-11T09:04:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605214360084398116" data-draft-id="7605214360084348964" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java学习第36天 - 响应式编程、虚拟线程与现代化技术栈"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-02-11T09:04:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="浮游本尊"/> <meta itemprop="url" content="https://juejin.cn/user/2533726710668696"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java学习第36天 - 响应式编程、虚拟线程与现代化技术栈
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2533726710668696/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    浮游本尊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:04:53.000Z" title="Wed Feb 11 2026 09:04:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">一、学习目标</h3>
<ul>
<li>掌握 <strong>Reactor</strong> 的核心概念与常用操作符（Mono、Flux、背压、map/flatMap/zip/then 等）。</li>
<li>掌握 <strong>Spring WebFlux</strong> 的基本使用：响应式 Controller、R2DBC、WebClient。</li>
<li>理解 <strong>虚拟线程（Virtual Threads，Java 21+）</strong> 与 <strong>结构化并发（Structured Concurrency）</strong> 的基本用法。</li>
<li>理解并实践 <strong>可观测性</strong>：指标（Metrics）、链路追踪（Tracing）、结构化日志（Logging）。</li>
<li>能够在现有 Spring MVC 项目中，逐步引入 WebFlux、虚拟线程和可观测性，完成现代化改造雏形。</li>
</ul>
<hr/>
<h3 data-id="heading-1">二、响应式编程基础（Reactor）</h3>
<h4 data-id="heading-2">2.1 核心概念：Publisher / Subscriber / 背压</h4>
<ol>
<li>
<p>响应式流标准（Reactive Streams）包含四个核心接口：</p>
<ul>
<li><code>Publisher</code>：数据发布者</li>
<li><code>Subscriber</code>：数据订阅者</li>
<li><code>Subscription</code>：订阅关系</li>
<li><code>Processor</code>：既是 Publisher 又是 Subscriber</li>
</ul>
</li>
<li>
<p>Reactor 中常用类型：</p>
<ul>
<li><code>Mono&lt;T&gt;</code>：0 或 1 个元素</li>
<li><code>Flux&lt;T&gt;</code>：0 到 N 个元素</li>
</ul>
</li>
<li>
<p>基本示例：</p>
</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> reactor.core.publisher.Mono;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-keyword">import</span> java.util.Optional;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactorBasics</span> {

    <span class="hljs-comment">// Mono：0 或 1 个元素</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Mono&lt;String&gt; <span class="hljs-title function_">monoExample</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Mono.just(<span class="hljs-string">"Hello"</span>)
                .map(String::toUpperCase)
                .doOnNext(s -&gt; System.out.println(<span class="hljs-string">"Mono: "</span> + s))
                .doOnSuccess(s -&gt; System.out.println(<span class="hljs-string">"Mono 完成"</span>));
    }

    <span class="hljs-comment">// Flux：0~N 个元素</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Flux&lt;Integer&gt; <span class="hljs-title function_">fluxExample</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)
                .map(i -&gt; i * <span class="hljs-number">2</span>)
                .doOnNext(i -&gt; System.out.println(<span class="hljs-string">"Flux: "</span> + i))
                .doOnComplete(() -&gt; System.out.println(<span class="hljs-string">"Flux 完成"</span>));
    }

    <span class="hljs-comment">// 从 Optional 创建 Mono</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Mono&lt;String&gt; <span class="hljs-title function_">fromOptional</span><span class="hljs-params">(Optional&lt;String&gt; opt)</span> {
        <span class="hljs-keyword">return</span> Mono.justOrEmpty(opt);
    }

    <span class="hljs-comment">// 背压示例</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">backpressureExample</span><span class="hljs-params">()</span> {
        Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>)
                .log()
                .limitRate(<span class="hljs-number">10</span>) <span class="hljs-comment">// 每次最多请求 10 个</span>
                .subscribe(
                        i -&gt; System.out.println(<span class="hljs-string">"onNext: "</span> + i),
                        err -&gt; err.printStackTrace(),
                        () -&gt; System.out.println(<span class="hljs-string">"完成"</span>)
                );
    }

    <span class="hljs-comment">// 错误处理：onErrorResume / onErrorReturn</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Mono&lt;String&gt; <span class="hljs-title function_">errorHandlingExample</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Mono.&lt;String&gt;error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"模拟错误"</span>))
                .onErrorResume(e -&gt; {
                    System.out.println(<span class="hljs-string">"发生错误: "</span> + e.getMessage());
                    <span class="hljs-keyword">return</span> Mono.just(<span class="hljs-string">"降级值"</span>);
                })
                .onErrorReturn(<span class="hljs-string">"默认值"</span>);
    }
}
</code></pre>
<h4 data-id="heading-3">2.2 常用操作符：map、flatMap、zip、then、buffer</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> reactor.core.publisher.Mono;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-keyword">import</span> java.time.Duration;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactorOperators</span> {

    <span class="hljs-comment">// map：同步转换</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Flux&lt;String&gt; <span class="hljs-title function_">mapExample</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Flux.just(<span class="hljs-string">"a"</span>, <span class="hljs-string">"b"</span>, <span class="hljs-string">"c"</span>)
                .map(String::toUpperCase);
    }

    <span class="hljs-comment">// flatMap：异步转换</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Flux&lt;String&gt; <span class="hljs-title function_">flatMapExample</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Flux.just(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
                .flatMap(i -&gt;
                        Mono.just(<span class="hljs-string">"item-"</span> + i)
                                .delayElement(Duration.ofMillis(<span class="hljs-number">100</span>))
                );
    }

    <span class="hljs-comment">// zip：组合多个 Publisher</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Mono&lt;String&gt; <span class="hljs-title function_">zipExample</span><span class="hljs-params">()</span> {
        Mono&lt;String&gt; first = Mono.just(<span class="hljs-string">"Hello"</span>);
        Mono&lt;String&gt; second = Mono.just(<span class="hljs-string">"Reactor"</span>);
        <span class="hljs-keyword">return</span> Mono.zip(first, second)
                .map(tuple -&gt; tuple.getT1() + <span class="hljs-string">" "</span> + tuple.getT2());
    }

    <span class="hljs-comment">// then：只关心前面完成信号，不关心值</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Mono&lt;Void&gt; <span class="hljs-title function_">thenExample</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Mono.just(<span class="hljs-string">"step1"</span>)
                .doOnNext(System.out::println)
                .then(Mono.just(<span class="hljs-string">"step2"</span>).doOnNext(System.out::println))
                .then();
    }

    <span class="hljs-comment">// merge / concat：合并流</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Flux&lt;Integer&gt; <span class="hljs-title function_">mergeExample</span><span class="hljs-params">()</span> {
        Flux&lt;Integer&gt; even = Flux.just(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>);
        Flux&lt;Integer&gt; odd = Flux.just(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>);
        <span class="hljs-keyword">return</span> Flux.merge(even, odd);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Flux&lt;Integer&gt; <span class="hljs-title function_">concatExample</span><span class="hljs-params">()</span> {
        Flux&lt;Integer&gt; first = Flux.just(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
        Flux&lt;Integer&gt; second = Flux.just(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>);
        <span class="hljs-keyword">return</span> Flux.concat(first, second);
    }

    <span class="hljs-comment">// buffer：缓冲</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Flux&lt;List&lt;Integer&gt;&gt; <span class="hljs-title function_">bufferExample</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>).buffer(<span class="hljs-number">3</span>); <span class="hljs-comment">// [1,2,3], [4,5,6], [7,8,9], [10]</span>
    }
}
</code></pre>
<h4 data-id="heading-4">2.3 调度器（Scheduler）与线程模型</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> reactor.core.publisher.Flux;
<span class="hljs-keyword">import</span> reactor.core.scheduler.Schedulers;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactorSchedulers</span> {

    <span class="hljs-comment">// subscribeOn：影响数据源执行线程</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Flux&lt;Integer&gt; <span class="hljs-title function_">subscribeOnBoundedElastic</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)
                .subscribeOn(Schedulers.boundedElastic())
                .map(i -&gt; {
                    System.out.println(<span class="hljs-string">"subscribeOn 线程: "</span> + Thread.currentThread().getName());
                    <span class="hljs-keyword">return</span> i;
                });
    }

    <span class="hljs-comment">// publishOn：影响后续操作符执行线程</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Flux&lt;Integer&gt; <span class="hljs-title function_">publishOnParallel</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)
                .publishOn(Schedulers.parallel())
                .map(i -&gt; {
                    System.out.println(<span class="hljs-string">"publishOn 线程: "</span> + Thread.currentThread().getName());
                    <span class="hljs-keyword">return</span> i;
                });
    }

    <span class="hljs-comment">// 组合使用</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Flux&lt;Integer&gt; <span class="hljs-title function_">mixedSchedulers</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Flux.range(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>)
                .subscribeOn(Schedulers.boundedElastic())
                .map(i -&gt; i * <span class="hljs-number">2</span>)
                .publishOn(Schedulers.parallel())
                .map(i -&gt; i + <span class="hljs-number">1</span>);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-5">三、Spring WebFlux 与响应式 Web</h3>
<h4 data-id="heading-6">3.1 依赖与启动类</h4>
<p>（以 Maven 为例）</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 引入 WebFlux 与 R2DBC --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-r2dbc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebFluxApplication</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        SpringApplication.run(WebFluxApplication.class, args);
    }
}
</code></pre>
<h4 data-id="heading-7">3.2 响应式 Controller（使用 Mono / Flux）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;
<span class="hljs-keyword">import</span> org.springframework.http.MediaType;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;
<span class="hljs-keyword">import</span> org.springframework.web.server.ResponseStatusException;
<span class="hljs-keyword">import</span> reactor.core.publisher.Mono;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-keyword">import</span> javax.validation.Valid;
<span class="hljs-keyword">import</span> java.time.Duration;

<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/reactive")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveUserController</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReactiveUserService userService;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ReactiveUserController</span><span class="hljs-params">(ReactiveUserService userService)</span> {
        <span class="hljs-built_in">this</span>.userService = userService;
    }

    <span class="hljs-meta">@GetMapping("/users/{id}")</span>
    <span class="hljs-keyword">public</span> Mono&lt;UserDTO&gt; <span class="hljs-title function_">getById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-keyword">return</span> userService.findById(id)
                .switchIfEmpty(Mono.error(
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResponseStatusException</span>(HttpStatus.NOT_FOUND, <span class="hljs-string">"用户不存在"</span>)
                ));
    }

    <span class="hljs-meta">@GetMapping("/users")</span>
    <span class="hljs-keyword">public</span> Flux&lt;UserDTO&gt; <span class="hljs-title function_">list</span><span class="hljs-params">(
            <span class="hljs-meta">@RequestParam(defaultValue = "0")</span> <span class="hljs-type">int</span> page,
            <span class="hljs-meta">@RequestParam(defaultValue = "10")</span> <span class="hljs-type">int</span> size)</span> {
        <span class="hljs-keyword">return</span> userService.findAll(page, size);
    }

    <span class="hljs-meta">@PostMapping("/users")</span>
    <span class="hljs-keyword">public</span> Mono&lt;UserDTO&gt; <span class="hljs-title function_">create</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> <span class="hljs-meta">@Valid</span> UserCreateRequest request)</span> {
        <span class="hljs-keyword">return</span> userService.create(request);
    }

    <span class="hljs-comment">// SSE：流式推送用户数据</span>
    <span class="hljs-meta">@GetMapping(value = "/users/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)</span>
    <span class="hljs-keyword">public</span> Flux&lt;UserDTO&gt; <span class="hljs-title function_">stream</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> userService.findAllStream()
                .delayElements(Duration.ofSeconds(<span class="hljs-number">1</span>)); <span class="hljs-comment">// 模拟每秒推送一条</span>
    }
}
</code></pre>
<h4 data-id="heading-8">3.3 响应式 Service 与 R2DBC Repository</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.domain.PageRequest;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> reactor.core.publisher.Mono;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveUserService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReactiveUserRepository repository;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ReactiveUserService</span><span class="hljs-params">(ReactiveUserRepository repository)</span> {
        <span class="hljs-built_in">this</span>.repository = repository;
    }

    <span class="hljs-keyword">public</span> Mono&lt;UserDTO&gt; <span class="hljs-title function_">findById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> repository.findById(id).map(<span class="hljs-built_in">this</span>::toDTO);
    }

    <span class="hljs-keyword">public</span> Flux&lt;UserDTO&gt; <span class="hljs-title function_">findAll</span><span class="hljs-params">(<span class="hljs-type">int</span> page, <span class="hljs-type">int</span> size)</span> {
        <span class="hljs-keyword">return</span> repository
                .findAllBy(PageRequest.of(page, size))
                .map(<span class="hljs-built_in">this</span>::toDTO);
    }

    <span class="hljs-keyword">public</span> Mono&lt;UserDTO&gt; <span class="hljs-title function_">create</span><span class="hljs-params">(UserCreateRequest request)</span> {
        <span class="hljs-type">User</span> <span class="hljs-variable">entity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
        entity.setUsername(request.getUsername());
        entity.setEmail(request.getEmail());
        <span class="hljs-comment">// 其他字段...</span>

        <span class="hljs-keyword">return</span> repository.save(entity).map(<span class="hljs-built_in">this</span>::toDTO);
    }

    <span class="hljs-keyword">public</span> Flux&lt;UserDTO&gt; <span class="hljs-title function_">findAllStream</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> repository.findAll().map(<span class="hljs-built_in">this</span>::toDTO);
    }

    <span class="hljs-keyword">private</span> UserDTO <span class="hljs-title function_">toDTO</span><span class="hljs-params">(User user)</span> {
        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDTO</span>();
        dto.setId(user.getId());
        dto.setUsername(user.getUsername());
        dto.setEmail(user.getEmail());
        <span class="hljs-keyword">return</span> dto;
    }
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.data.domain.Pageable;
<span class="hljs-keyword">import</span> org.springframework.data.repository.reactive.ReactiveCrudRepository;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ReactiveUserRepository</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ReactiveCrudRepository</span>&lt;User, Long&gt; {

    Flux&lt;User&gt; <span class="hljs-title function_">findAllBy</span><span class="hljs-params">(Pageable pageable)</span>;
}
</code></pre>
<h4 data-id="heading-9">3.4 WebClient：替代 RestTemplate 的响应式 HTTP 客户端</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.http.HttpHeaders;
<span class="hljs-keyword">import</span> org.springframework.http.MediaType;
<span class="hljs-keyword">import</span> org.springframework.http.HttpStatusCode;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.web.reactive.function.client.WebClient;
<span class="hljs-keyword">import</span> reactor.core.publisher.Mono;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactiveOrderClient</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> WebClient webClient;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ReactiveOrderClient</span><span class="hljs-params">(WebClient.Builder builder)</span> {
        <span class="hljs-built_in">this</span>.webClient = builder
                .baseUrl(<span class="hljs-string">"http://order-service"</span>)
                .defaultHeader(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON_VALUE)
                .build();
    }

    <span class="hljs-keyword">public</span> Mono&lt;OrderDTO&gt; <span class="hljs-title function_">getOrderById</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-keyword">return</span> webClient.get()
                .uri(<span class="hljs-string">"/api/orders/{id}"</span>, id)
                .retrieve()
                .onStatus(HttpStatusCode::is4xxClientError,
                        resp -&gt; Mono.error(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"订单不存在"</span>)))
                .bodyToMono(OrderDTO.class);
    }

    <span class="hljs-keyword">public</span> Flux&lt;OrderDTO&gt; <span class="hljs-title function_">getOrdersByUserId</span><span class="hljs-params">(Long userId)</span> {
        <span class="hljs-keyword">return</span> webClient.get()
                .uri(uriBuilder -&gt; uriBuilder
                        .path(<span class="hljs-string">"/api/orders"</span>)
                        .queryParam(<span class="hljs-string">"userId"</span>, userId)
                        .build())
                .retrieve()
                .bodyToFlux(OrderDTO.class);
    }

    <span class="hljs-keyword">public</span> Mono&lt;OrderDTO&gt; <span class="hljs-title function_">createOrder</span><span class="hljs-params">(OrderCreateRequest request)</span> {
        <span class="hljs-keyword">return</span> webClient.post()
                .uri(<span class="hljs-string">"/api/orders"</span>)
                .bodyValue(request)
                .retrieve()
                .bodyToMono(OrderDTO.class);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-10">四、虚拟线程（Java 21+）与结构化并发</h3>
<h4 data-id="heading-11">4.1 虚拟线程的创建与使用</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.Executors;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VirtualThreadDemo</span> {

    <span class="hljs-comment">// 方式一：虚拟线程池</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">runWithVirtualThreads</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newVirtualThreadPerTaskExecutor()) {
            executor.submit(() -&gt;
                    System.out.println(<span class="hljs-string">"Task 1, virtual="</span> + Thread.currentThread().isVirtual()));
            executor.submit(() -&gt;
                    System.out.println(<span class="hljs-string">"Task 2, virtual="</span> + Thread.currentThread().isVirtual()));
        }
    }

    <span class="hljs-comment">// 方式二：直接创建虚拟线程</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">threadOfVirtual</span><span class="hljs-params">()</span> {
        Thread.ofVirtual()
                .name(<span class="hljs-string">"vt-"</span>, <span class="hljs-number">0</span>)
                .start(() -&gt;
                        System.out.println(<span class="hljs-string">"虚拟线程名称: "</span> + Thread.currentThread().getName()));
    }
}
</code></pre>
<h4 data-id="heading-12">4.2 结构化并发（StructuredTaskScope）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.StructuredTaskScope;
<span class="hljs-keyword">import</span> java.util.concurrent.StructuredTaskScope.ShutdownOnFailure;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StructuredConcurrencyDemo</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span> {
        String user;
        String order;
        String product;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Result <span class="hljs-title function_">fetchUserOrderProduct</span><span class="hljs-params">(<span class="hljs-type">long</span> userId, <span class="hljs-type">long</span> orderId, <span class="hljs-type">long</span> productId)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShutdownOnFailure</span>()) {
            <span class="hljs-type">var</span> <span class="hljs-variable">userTask</span> <span class="hljs-operator">=</span> scope.fork(() -&gt; fetchUser(userId));
            <span class="hljs-type">var</span> <span class="hljs-variable">orderTask</span> <span class="hljs-operator">=</span> scope.fork(() -&gt; fetchOrder(orderId));
            <span class="hljs-type">var</span> <span class="hljs-variable">productTask</span> <span class="hljs-operator">=</span> scope.fork(() -&gt; fetchProduct(productId));

            scope.join();          <span class="hljs-comment">// 等待所有子任务完成</span>
            scope.throwIfFailed(); <span class="hljs-comment">// 任一失败则抛异常</span>

            <span class="hljs-type">Result</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>();
            r.user = userTask.get();
            r.order = orderTask.get();
            r.product = productTask.get();
            <span class="hljs-keyword">return</span> r;
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">fetchUser</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        Thread.sleep(<span class="hljs-number">100</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"User-"</span> + id;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">fetchOrder</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        Thread.sleep(<span class="hljs-number">150</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Order-"</span> + id;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">fetchProduct</span><span class="hljs-params">(<span class="hljs-type">long</span> id)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        Thread.sleep(<span class="hljs-number">80</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Product-"</span> + id;
    }
}
</code></pre>
<h4 data-id="heading-13">4.3 Spring Boot 中启用虚拟线程</h4>
<p><code>application.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">threads:</span>
    <span class="hljs-attr">virtual:</span>
      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
</code></pre>
<p>自定义异步任务使用虚拟线程：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;
<span class="hljs-keyword">import</span> org.springframework.scheduling.annotation.Async;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.util.concurrent.CompletableFuture;
<span class="hljs-keyword">import</span> java.util.concurrent.Executor;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VirtualThreadConfig</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">virtualThreadExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> Executors.newVirtualThreadPerTaskExecutor();
    }
}

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncService</span> {

    <span class="hljs-meta">@Async("virtualThreadExecutor")</span>
    <span class="hljs-keyword">public</span> CompletableFuture&lt;String&gt; <span class="hljs-title function_">asyncTask</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> CompletableFuture.completedFuture(
                <span class="hljs-string">"run on: "</span> + Thread.currentThread().getName() +
                        <span class="hljs-string">", virtual="</span> + Thread.currentThread().isVirtual()
        );
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-14">五、可观测性：指标、链路追踪与结构化日志</h3>
<h4 data-id="heading-15">5.1 Micrometer + Prometheus 指标</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.micrometer.core.instrument.Counter;
<span class="hljs-keyword">import</span> io.micrometer.core.instrument.Timer;
<span class="hljs-keyword">import</span> io.micrometer.core.instrument.MeterRegistry;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.time.Duration;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderMetricsService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Counter orderCreatedCounter;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Timer orderCreateTimer;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderMetricsService</span><span class="hljs-params">(MeterRegistry registry)</span> {
        <span class="hljs-built_in">this</span>.orderCreatedCounter = registry.counter(<span class="hljs-string">"order.created"</span>, <span class="hljs-string">"env"</span>, <span class="hljs-string">"dev"</span>);
        <span class="hljs-built_in">this</span>.orderCreateTimer = registry.timer(<span class="hljs-string">"order.create.duration"</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordOrderCreated</span><span class="hljs-params">()</span> {
        orderCreatedCounter.increment();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordOrderCreateDuration</span><span class="hljs-params">(Runnable runnable)</span> {
        orderCreateTimer.record(runnable);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">recordOrderCreateDuration</span><span class="hljs-params">(Duration duration)</span> {
        orderCreateTimer.record(duration);
    }
}
</code></pre>
<p><code>application.yml</code> 配置：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-attr">include:</span> <span class="hljs-string">health,info,prometheus</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">prometheus:</span>
      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">metrics:</span>
    <span class="hljs-attr">tags:</span>
      <span class="hljs-attr">application:</span> <span class="hljs-string">${spring.application.name}</span>
</code></pre>
<h4 data-id="heading-16">5.2 链路追踪：Micrometer Tracing + Zipkin</h4>
<p>依赖示例：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.micrometer<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>micrometer-tracing-bridge-brave<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.zipkin.reporter2<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>zipkin-reporter-brave<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>配置示例：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">management:</span>
  <span class="hljs-attr">tracing:</span>
    <span class="hljs-attr">sampling:</span>
      <span class="hljs-attr">probability:</span> <span class="hljs-number">1.0</span>
  <span class="hljs-attr">zipkin:</span>
    <span class="hljs-attr">tracing:</span>
      <span class="hljs-attr">endpoint:</span> <span class="hljs-string">http://localhost:9411/api/v2/spans</span>
</code></pre>
<p>在业务代码中打 Span：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.micrometer.tracing.Tracer;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Tracer tracer;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderService</span><span class="hljs-params">(Tracer tracer)</span> {
        <span class="hljs-built_in">this</span>.tracer = tracer;
    }

    <span class="hljs-keyword">public</span> OrderDTO <span class="hljs-title function_">createOrder</span><span class="hljs-params">(CreateOrderRequest request)</span> {
        <span class="hljs-type">var</span> <span class="hljs-variable">span</span> <span class="hljs-operator">=</span> tracer.nextSpan().name(<span class="hljs-string">"createOrder"</span>).start();
        <span class="hljs-keyword">try</span> (Tracer.<span class="hljs-type">SpanInScope</span> <span class="hljs-variable">ws</span> <span class="hljs-operator">=</span> tracer.withSpan(span)) {
            span.tag(<span class="hljs-string">"order.userId"</span>, String.valueOf(request.getUserId()));
            <span class="hljs-comment">// 订单创建逻辑...</span>
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderDTO</span>();
        } <span class="hljs-keyword">finally</span> {
            span.end();
        }
    }
}
</code></pre>
<h4 data-id="heading-17">5.3 结构化日志（JSON + MDC）</h4>
<p><code>logback-spring.xml</code> 简化示例：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"org/springframework/boot/logging/logback/defaults.xml"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">appender</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"JSON"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"ch.qos.logback.core.ConsoleAppender"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">encoder</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"net.logstash.logback.encoder.LogstashEncoder"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">includeMdcKeyName</span>&gt;</span>traceId<span class="hljs-tag">&lt;/<span class="hljs-name">includeMdcKeyName</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">encoder</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">appender</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"INFO"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"JSON"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<p>在拦截器中写入 traceId：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.slf4j.MDC;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;

<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;
<span class="hljs-keyword">import</span> java.util.UUID;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MdcInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TRACE_ID</span> <span class="hljs-operator">=</span> <span class="hljs-string">"traceId"</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">traceId</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"X-Trace-Id"</span>);
        <span class="hljs-keyword">if</span> (traceId == <span class="hljs-literal">null</span> || traceId.isEmpty()) {
            traceId = UUID.randomUUID().toString();
        }
        MDC.put(TRACE_ID, traceId);
        response.setHeader(<span class="hljs-string">"X-Trace-Id"</span>, traceId);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response,
                                Object handler, Exception ex)</span> {
        MDC.remove(TRACE_ID);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-18">六、综合实战：MVC + WebFlux + 虚拟线程混合</h3>
<h4 data-id="heading-19">6.1 在传统 MVC 项目中引入 WebClient</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> reactor.core.publisher.Mono;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderFacadeService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderService orderService;           <span class="hljs-comment">// 传统阻塞 service</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReactiveOrderClient reactiveClient;  <span class="hljs-comment">// 响应式 HTTP 客户端</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">OrderFacadeService</span><span class="hljs-params">(OrderService orderService,
                              ReactiveOrderClient reactiveClient)</span> {
        <span class="hljs-built_in">this</span>.orderService = orderService;
        <span class="hljs-built_in">this</span>.reactiveClient = reactiveClient;
    }

    <span class="hljs-comment">// 阻塞式接口内部使用 WebClient（建议放在虚拟线程中）</span>
    <span class="hljs-keyword">public</span> OrderAggregateDTO <span class="hljs-title function_">getOrderWithDetails</span><span class="hljs-params">(Long orderId)</span> {
        <span class="hljs-type">OrderDTO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderService.getById(orderId);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> order.getUserId();
        <span class="hljs-type">Long</span> <span class="hljs-variable">productId</span> <span class="hljs-operator">=</span> order.getProductId();

        Mono&lt;UserDTO&gt; userMono = reactiveClient.getUserById(userId);
        Mono&lt;ProductDTO&gt; productMono = reactiveClient.getProductById(productId);

        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMono.block();       <span class="hljs-comment">// 在虚拟线程中阻塞开销更小</span>
        <span class="hljs-type">ProductDTO</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productMono.block();

        <span class="hljs-type">OrderAggregateDTO</span> <span class="hljs-variable">agg</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderAggregateDTO</span>();
        agg.setOrder(order);
        agg.setUser(user);
        agg.setProduct(product);
        <span class="hljs-keyword">return</span> agg;
    }
}
</code></pre>
<h4 data-id="heading-20">6.2 健康检查与就绪探针</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.boot.actuate.health.Health;
<span class="hljs-keyword">import</span> org.springframework.boot.actuate.health.HealthIndicator;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> javax.sql.DataSource;
<span class="hljs-keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomHealthIndicator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HealthIndicator</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DataSource dataSource;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RedisConnectionFactory redisConnectionFactory;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CustomHealthIndicator</span><span class="hljs-params">(DataSource dataSource,
                                 RedisConnectionFactory redisConnectionFactory)</span> {
        <span class="hljs-built_in">this</span>.dataSource = dataSource;
        <span class="hljs-built_in">this</span>.redisConnectionFactory = redisConnectionFactory;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Health <span class="hljs-title function_">health</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            dataSource.getConnection().close();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> Health.down().withException(e).build();
        }
        <span class="hljs-keyword">try</span> {
            redisConnectionFactory.getConnection().ping();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> Health.down().withException(e).build();
        }
        <span class="hljs-keyword">return</span> Health.up().build();
    }
}
</code></pre>
<p><code>application.yml</code>：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoint:</span>
    <span class="hljs-attr">health:</span>
      <span class="hljs-attr">probes:</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">health:</span>
    <span class="hljs-attr">livenessState:</span>
      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">readinessState:</span>
      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[射线法判断一个坐标点（经纬度）是否在一个多边形区域内部]]></title>    <link>https://juejin.cn/post/7605173538417917962</link>    <guid>https://juejin.cn/post/7605173538417917962</guid>    <pubDate>2026-02-11T09:06:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605173538417917962" data-draft-id="7605173538417885194" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="射线法判断一个坐标点（经纬度）是否在一个多边形区域内部"/> <meta itemprop="keywords" content="后端,算法"/> <meta itemprop="datePublished" content="2026-02-11T09:06:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="深紫色的三北六号"/> <meta itemprop="url" content="https://juejin.cn/user/4101625032221256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            射线法判断一个坐标点（经纬度）是否在一个多边形区域内部
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4101625032221256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    深紫色的三北六号
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:06:10.000Z" title="Wed Feb 11 2026 09:06:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、问题</h2>
<p>在 GIS、无人机巡检、电子围栏、地图系统等场景中，经常需要判断：</p>
<p><code>一个点是否位于某个多边形区域内？</code></p>
<p>关于这一问题，可以使用射线法判断。</p>
<h2 data-id="heading-1">二、射线法核心思想</h2>
<ol>
<li>从待判断的点出发，向右画一条水平射线；</li>
<li>统计这条射线与多边形边的交点个数；</li>
<li>如果交点数为奇数 → 点在多边形内部；</li>
<li>如果交点数为偶数 → 点在多边形外部。</li>
</ol>
<h2 data-id="heading-2">三、代码实现</h2>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">/**
     * 判断一个点是否在一个区域中
     * <span class="hljs-doctag">@param</span> point
     * <span class="hljs-doctag">@param</span> polygon
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isPointInPolygon</span><span class="hljs-params">(Point point, List&lt;Point&gt; polygon)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">inside</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> polygon.size();

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, j = n - <span class="hljs-number">1</span>; i &lt; n; j = i++) {
            <span class="hljs-type">double</span> <span class="hljs-variable">xi</span> <span class="hljs-operator">=</span> polygon.get(i).getLongitude();
            <span class="hljs-type">double</span> <span class="hljs-variable">yi</span> <span class="hljs-operator">=</span> polygon.get(i).getLatitude();
            <span class="hljs-type">double</span> <span class="hljs-variable">xj</span> <span class="hljs-operator">=</span> polygon.get(j).getLongitude();
            <span class="hljs-type">double</span> <span class="hljs-variable">yj</span> <span class="hljs-operator">=</span> polygon.get(j).getLatitude();

            <span class="hljs-type">boolean</span> <span class="hljs-variable">intersect</span> <span class="hljs-operator">=</span>
                    ((yi &gt; point.getLatitude()) != (yj &gt; point.getLatitude())) &amp;&amp;
                            (point.getLongitude() &lt;
                                    (xj - xi) * (point.getLatitude() - yi) / (yj - yi) + xi);

            <span class="hljs-keyword">if</span> (intersect) {
                inside = !inside;
            }
        }
        <span class="hljs-keyword">return</span> inside;
    }
</code></pre>
<h2 data-id="heading-3">四、代码说明</h2>
<p>这段代码的核心在于判断：
<code>射线是否与当前边产生一次有效交点。</code>
关键逻辑如下：</p>
<pre><code class="hljs language-java" lang="java">((yi &gt; point.getLatitude()) != (yj &gt; point.getLatitude()))
</code></pre>
<p>这一步用于判断：</p>
<ul>
<li>边的两个端点是否一个在点的上方，一个在点的下方。</li>
<li>如果两个端点都在射线同一侧，则一定不会相交。</li>
</ul>
<hr/>
<pre><code class="hljs language-java" lang="java">(xj - xi) * (point.getLatitude() - yi) / (yj - yi) + xi
</code></pre>
<p>这一公式用于计算：
<code>射线与当前边的交点的 x 坐标。</code>
其推导来自线性插值公式：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">x</span> = xi + (xj - xi) * (y - yi) / (yj - yi)
</code></pre>
<p>最后比较：</p>
<pre><code class="hljs language-java" lang="java">point.getLongitude() &lt; 交点x坐标
</code></pre>
<p>表示：
<code>交点是否在点的右侧。</code>
如果满足条件，则说明发生了一次有效相交。</p>
<hr/>
<p>每遇到一次相交：</p>
<pre><code class="hljs language-java" lang="java">inside = !inside;
</code></pre>
<p>进行一次布尔翻转。</p>
<ul>
<li>第 1 次相交 → true</li>
<li>第 2 次相交 → false</li>
<li>第 3 次相交 → true
最终得到奇偶结果。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WebGL 初探：让你的网页拥有3D魔法]]></title>    <link>https://juejin.cn/post/7605136148593131547</link>    <guid>https://juejin.cn/post/7605136148593131547</guid>    <pubDate>2026-02-11T09:10:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605136148593131547" data-draft-id="7605157203591544859" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WebGL 初探：让你的网页拥有3D魔法"/> <meta itemprop="keywords" content="WebGL,前端"/> <meta itemprop="datePublished" content="2026-02-11T09:10:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王校长"/> <meta itemprop="url" content="https://juejin.cn/user/2295436010076631"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WebGL 初探：让你的网页拥有3D魔法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436010076631/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王校长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:10:55.000Z" title="Wed Feb 11 2026 09:10:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">WebGL的前世今生：从插件时代到开放标准</h2>
<p>还记得那些年我们用过的Flash吗？在WebGL出现之前，如果想在网页上展示3D效果，我们不得不依赖Adobe Flash、微软SilverLight这些浏览器插件。就像过去我们想要听音乐必须安装专门的播放器一样，这些插件就像一道门槛，限制了3D网页的发展。</p>
<p>但是，聪明的程序员们不甘于此！他们联手打造了一个开放标准——WebGL，让我们的浏览器原生支持3D图形渲染，再也不需要额外安装任何插件了。</p>
<h2 data-id="heading-1">WebGL到底是什么？用最简单的话说清楚</h2>
<p>想象一下，你正在玩一个3D游戏，那些栩栩如生的场景、流畅的角色动作，背后都是GPU（显卡）在默默工作。WebGL就是一座桥梁，让你可以用JavaScript直接和GPU对话，告诉它"嘿，帮我渲染一个红色的三角形"或者"给我一个旋转的立方体"。</p>
<p><strong>简单来说：</strong></p>
<ul>
<li>WebGL是一套3D图形API（应用程序接口）</li>
<li>它让你的JavaScript代码可以直接控制GPU</li>
<li>你可以用它创建3D图表、网页游戏、3D地图、虚拟现实等精彩应用</li>
</ul>
<h2 data-id="heading-2">WebGL的工作原理：就像工厂的流水线</h2>
<p>想象一下汽车制造厂的流水线：</p>
<ol>
<li>工人准备好零件（顶点数据）</li>
<li>每个工位对零件进行加工（顶点着色器）</li>
<li>零件被组装成车门（图元装配）</li>
<li>车门表面涂漆（光栅化）</li>
<li>最后贴上标志（片元着色器）</li>
</ol>
<p>WebGL的渲染过程也是这样：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 这是JavaScript部分，准备数据</span>
<span class="hljs-keyword">const</span> vertices = [
  -<span class="hljs-number">0.5</span>, -<span class="hljs-number">0.5</span>,  <span class="hljs-comment">// 三角形左下角</span>
   <span class="hljs-number">0.5</span>, -<span class="hljs-number">0.5</span>,  <span class="hljs-comment">// 三角形右下角</span>
   <span class="hljs-number">0.0</span>,  <span class="hljs-number">0.5</span>   <span class="hljs-comment">// 三角形顶部</span>
];

<span class="hljs-comment">// 这是顶点着色器，告诉GPU如何放置顶点</span>
<span class="hljs-keyword">const</span> vertexShaderSource = <span class="hljs-string">`
attribute vec2 a_position;  // 接收顶点位置
void main() {
  gl_Position = vec4(a_position, 0.0, 1.0);  // 设置顶点位置
}
`</span>;

<span class="hljs-comment">// 这是片元着色器，告诉GPU如何上色</span>
<span class="hljs-keyword">const</span> fragmentShaderSource = <span class="hljs-string">`
void main() {
  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);  // 设置为红色
}
`</span>;
</code></pre>
<p><strong>渲染管线的四个关键步骤：</strong></p>
<ol>
<li><strong>顶点着色器</strong>：处理每个顶点的位置</li>
<li><strong>图元装配</strong>：把顶点连成三角形</li>
<li><strong>光栅化</strong>：把三角形变成像素</li>
<li><strong>片元着色器</strong>：给每个像素上色</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d45948e6597f453199b6abf610c9cac5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5qCh6ZW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771406047&amp;x-signature=jaiTqW6mCb%2FSWOdo907NxKhuA5g%3D" alt="wechat_2026-02-11_164451_306.png" loading="lazy"/></p>
<h2 data-id="heading-3">WebGL开发需要掌握的技能</h2>
<p>如果你已经会HTML、CSS、JavaScript，那么恭喜你，你已经完成了80%的准备工作！WebGL开发还需要：</p>
<h3 data-id="heading-4">1. HTML基础（你已经有了）</h3>
<p>只需要知道怎么使用<code>&lt;canvas&gt;</code>标签就够了：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"webgl-canvas"</span> <span class="hljs-attr">width</span>=<span class="hljs-string">"800"</span> <span class="hljs-attr">height</span>=<span class="hljs-string">"600"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">2. JavaScript（你已经精通了）</h3>
<p>负责：</p>
<ul>
<li>获取WebGL上下文</li>
<li>处理顶点数据（坐标、颜色、法向量等）</li>
<li>将数据传递给GPU</li>
<li>加载和解析模型文件</li>
</ul>
<h3 data-id="heading-6">3. GLSL着色器语言（新的挑战）</h3>
<p>这是运行在GPU上的小程序，语法类似C语言，但专门为图形处理设计：</p>
<pre><code class="hljs language-glsl" lang="glsl">// 顶点着色器示例
attribute vec4 position;
uniform mat4 u_matrix;
void main() {
  gl_Position = u_matrix * position;  // 矩阵变换
}
</code></pre>
<h3 data-id="heading-7">4. 3D数学知识（最重要的基础）</h3>
<ul>
<li>向量：表示方向和距离</li>
<li>矩阵：进行坐标变换（平移、旋转、缩放）</li>
<li>这是WebGL的核心，理解了数学原理，你就掌握了3D世界的钥匙</li>
</ul>
<h2 data-id="heading-8">着色器程序：让GPU听懂你的话</h2>
<p>WebGL中有两种着色器：</p>
<h3 data-id="heading-9">顶点着色器（Vertex Shader）</h3>
<ul>
<li>处理每个顶点的位置信息</li>
<li>执行坐标变换（移动、旋转、缩放等）</li>
</ul>
<h3 data-id="heading-10">片元着色器（Fragment Shader）</h3>
<ul>
<li>决定每个像素的颜色</li>
<li>处理光照、纹理等效果</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 完整的简单示例</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">initWebGL</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'webgl-canvas'</span>);
  <span class="hljs-keyword">const</span> gl = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'webgl'</span>);
  
  <span class="hljs-keyword">if</span> (!gl) {
    <span class="hljs-title function_">alert</span>(<span class="hljs-string">'你的浏览器不支持WebGL'</span>);
    <span class="hljs-keyword">return</span>;
  }
  
  <span class="hljs-comment">// 创建着色器程序...</span>
  <span class="hljs-comment">// 绘制图形...</span>
}
</code></pre>
<h2 data-id="heading-11">WebGL的魅力在哪里？</h2>
<p><strong>想象一下你能做到的事情：</strong></p>
<ul>
<li>创建震撼的3D数据可视化</li>
<li>开发浏览器内的3D游戏</li>
<li>构建虚拟现实体验</li>
<li>实现复杂的图像处理效果</li>
<li>优化传统2D应用性能</li>
</ul>
<h2 data-id="heading-12">总结：开启3D世界的大门</h2>
<p>WebGL不仅仅是技术，更是创造力的延伸。它让你有能力：</p>
<ul>
<li>用JavaScript控制GPU的强大计算能力</li>
<li>将数学知识转化为视觉艺术</li>
<li>为用户提供沉浸式的3D体验</li>
<li>在浏览器中实现以前不可能的效果</li>
</ul>
<p>记住，WebGL的学习曲线虽然陡峭，但一旦掌握，你就能创造出令人惊叹的视觉效果。让我们一起踏上这段精彩的3D之旅吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用搜搜果GEO工具批量监测品牌AI表现：国产ProFound实战Python教程]]></title>    <link>https://juejin.cn/post/7605174711181967423</link>    <guid>https://juejin.cn/post/7605174711181967423</guid>    <pubDate>2026-02-11T09:05:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605174711181967423" data-draft-id="7605214360084381732" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用搜搜果GEO工具批量监测品牌AI表现：国产ProFound实战Python教程"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2026-02-11T09:05:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户81329210265"/> <meta itemprop="url" content="https://juejin.cn/user/555681661333802"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用搜搜果GEO工具批量监测品牌AI表现：国产ProFound实战Python教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/555681661333802/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户81329210265
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:05:06.000Z" title="Wed Feb 11 2026 09:05:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着AI搜索逐渐成为信息入口，品牌在AI回答中的呈现直接影响用户认知和决策。如何量化品牌在AI搜索平台的表现，成为企业品牌管理的新需求。</p>
<p>**搜搜果GEO工具（<a href="https://link.juejin.cn?target=https%3A%2F%2Fsousougeo.com" target="_blank" title="https://sousougeo.com" ref="nofollow noopener noreferrer">sousougeo.com</a>）**是国产版ProFound逻辑的数据工具代表，可以帮助企业：</p>
<ul>
<li>监测品牌在AI平台的引用次数</li>
<li>批量分析竞品表现</li>
<li>检测关键词调用和正面比例</li>
<li>构建品牌认知画像和口碑风险</li>
<li>生成可视化分析报告</li>
</ul>
<p>本文演示如何用Python调用搜搜果GEO工具API进行批量品牌监测，并生成可视化数据。</p>
<hr/>
<h2 data-id="heading-0">1. 安装依赖</h2>
<pre><code class="hljs">pip install requests pandas matplotlib
</code></pre>
<ul>
<li><code>requests</code>：API请求</li>
<li><code>pandas</code>：数据处理</li>
<li><code>matplotlib</code>：可视化</li>
</ul>
<hr/>
<h2 data-id="heading-1">2. 获取单个品牌数据</h2>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd

api_url = <span class="hljs-string">"https://api.sousougeo.com/v1/brand_monitor"</span>
params = {
    <span class="hljs-string">"brand"</span>: <span class="hljs-string">"示例品牌"</span>,
    <span class="hljs-string">"platforms"</span>: [<span class="hljs-string">"deepseek"</span>, <span class="hljs-string">"豆包"</span>, <span class="hljs-string">"千问"</span>, <span class="hljs-string">"元宝"</span>, <span class="hljs-string">"文心"</span>]
}

response = requests.<span class="hljs-keyword">get</span>(api_url, params=params)
<span class="hljs-keyword">data</span> = response.json()
print(<span class="hljs-keyword">data</span>)
</code></pre>
<p>返回示例：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"示例品牌"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"platforms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"deepseek"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"引用次数"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">120</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"正面比例"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.82</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"豆包"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"引用次数"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">95</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"正面比例"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.78</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"千问"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"引用次数"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">110</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"正面比例"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.8</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"元宝"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"引用次数"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">85</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"正面比例"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.72</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"文心"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span><span class="hljs-attr">"引用次数"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">105</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"正面比例"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0.79</span><span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-2">3. 数据处理与可视化</h2>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">platforms</span> = data[<span class="hljs-string">'platforms'</span>]
<span class="hljs-attr">df</span> = pd.DataFrame(platforms).T
df<span class="hljs-section">['品牌']</span> = data<span class="hljs-section">['brand']</span>
print(df)

import matplotlib.pyplot as plt

<span class="hljs-comment"># 引用次数柱状图</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">8</span>,<span class="hljs-number">4</span>))
plt.bar(df.index, df<span class="hljs-section">['引用次数']</span>, <span class="hljs-attr">color</span>=<span class="hljs-string">'skyblue'</span>)
plt.title(f"{data<span class="hljs-section">['brand']</span>} 在AI平台的引用次数")
plt.ylabel("引用次数")
plt.show()

<span class="hljs-comment"># 正面比例柱状图</span>
plt.figure(<span class="hljs-attr">figsize</span>=(<span class="hljs-number">8</span>,<span class="hljs-number">4</span>))
plt.bar(df.index, df<span class="hljs-section">['正面比例']</span>, <span class="hljs-attr">color</span>=<span class="hljs-string">'lightgreen'</span>)
plt.title(f"{data<span class="hljs-section">['brand']</span>} 在AI平台的正面比例")
plt.ylabel("正面比例")
plt.ylim(0,1)
plt.show()
</code></pre>
<hr/>
<h2 data-id="heading-3">4. 批量监测多个品牌</h2>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">brands</span> = [<span class="hljs-string">"品牌A"</span>, <span class="hljs-string">"品牌B"</span>, <span class="hljs-string">"品牌C"</span>]
<span class="hljs-attr">all_results</span> = []

for brand in brands:
    params<span class="hljs-section">['brand']</span> = brand
    <span class="hljs-attr">resp</span> = requests.get(api_url, params=params).json()
    <span class="hljs-attr">df_temp</span> = pd.DataFrame(resp[<span class="hljs-string">'platforms'</span>]).T
    df_temp<span class="hljs-section">['品牌']</span> = brand
    all_results.append(df_temp)

<span class="hljs-attr">df_all</span> = pd.concat(all_results)
print(df_all)
</code></pre>
<p>通过批量监测，可以快速分析多个品牌在AI平台的表现，便于竞品对比和策略优化。</p>
<hr/>
<p>使用国产ProFound逻辑的数据工具——<strong>搜搜果GEO工具（<a href="https://link.juejin.cn?target=https%3A%2F%2Fsousougeo.com" target="_blank" title="https://sousougeo.com" ref="nofollow noopener noreferrer">sousougeo.com</a>）</strong> ，企业可以实现：</p>
<ul>
<li>品牌在AI搜索平台表现量化</li>
<li>竞品横向对比</li>
<li>关键词调用与口碑风险分析</li>
<li>可视化报告生成</li>
</ul>
<p>在AI搜索时代，品牌竞争不仅是流量，更是<strong>在AI回答中被正确理解和呈现</strong>。<br/>
使用搜搜果GEO工具，企业可以让品牌管理更数据化、更智能。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenCode + oh-my-opencode 体验（使用自搭建模型）]]></title>    <link>https://juejin.cn/post/7605187300134027299</link>    <guid>https://juejin.cn/post/7605187300134027299</guid>    <pubDate>2026-02-11T09:04:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605187300134027299" data-draft-id="7604881286037766196" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenCode + oh-my-opencode 体验（使用自搭建模型）"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-02-11T09:04:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="juejin_cn"/> <meta itemprop="url" content="https://juejin.cn/user/3016715636324125"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenCode + oh-my-opencode 体验（使用自搭建模型）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3016715636324125/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    juejin_cn
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:04:18.000Z" title="Wed Feb 11 2026 09:04:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body cache result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">安装oh-my-opencode</h2>
<pre><code class="hljs language-perl" lang="perl">npm install oh-<span class="hljs-keyword">my</span>-opencode-windows-x64 -g
bunx oh-<span class="hljs-keyword">my</span>-opencode install
</code></pre>
<h2 data-id="heading-1">配置自搭建模型</h2>
<p><code>.config\opencode\opencode.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"$schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://opencode.ai/config.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"plugin"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"oh-my-opencode@3.5.1"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"AIX-code"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"npm"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@ai-sdk/openai-compatible"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX Code"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"options"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"baseURL"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://localhost:8000"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"apiKey"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"xxx"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"models"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"AIX_CODER"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-Coder-Self"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX_CODER"</span> <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

</code></pre>
<h2 data-id="heading-2">设置模型</h2>
<p><code>AIX-code/AIX-Coder-Self</code></p>
<p><code>AIX-code</code> 是 provider key，<code>AIX-Coder-Self</code> 是模型 id</p>
<p><code>.config\opencode\oh-my-opencode.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"$schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://raw.githubusercontent.com/code-yeongyu/oh-my-opencode/master/assets/oh-my-opencode.schema.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"agents"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"sisyphus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"hephaestus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"oracle"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"librarian"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"explore"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"multimodal-looker"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prometheus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"metis"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"momus"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"atlas"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"categories"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"visual-engineering"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ultrabrain"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"deep"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"artistry"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"quick"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"unspecified-low"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"unspecified-high"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"writing"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"AIX-code/AIX-Coder-Self"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-3">运行</h2>
<p><code>opencode web</code> 打开 Web 网页，选择 <code>Sisyphus</code> 智能体和自搭建模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7fda99615114cf3affea39c17894418~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAganVlamluX2Nu:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771405458&amp;x-signature=HRJTnPzRaJGuwKHEv8JxYv%2Bp75Y%3D" alt="image.png" loading="lazy"/></p>
<p><code>oh-my-opencode</code> 是什么，直接问下它</p>
<ul>
<li><code>你调用的是哪个大模型</code></li>
</ul>
<blockquote>
<p>用户问我调用的是哪个大模型。根据系统提示中的信息，我使用的是 "AIX-Coder-Self" 模型，具体的模型 ID 是 "AIX-code/AIX-Coder-Self"。</p>
<p>我应该直接回答这个问题。 </p>
<p>AIX-code/AIX-Coder-Self</p>
</blockquote>
<ul>
<li><code>你有哪些能力</code></li>
</ul>
<blockquote>
<p>用户问我有哪些能力。这是一个关于我的能力的问题，我应该简洁地回答。</p>
<p>根据系统提示，我是"Sisyphus" - 一个具有编排能力的AI代理。我应该列出我的主要能力，但不要过于详细或夸大。</p>
<p>让我简洁地总结我的核心能力：</p>
<ol>
<li>代码编写和编辑</li>
<li>文件操作（读取、写入、搜索）</li>
<li>Git操作</li>
<li>执行bash命令</li>
<li>任务委托给子代理</li>
<li>Web搜索和信息获取</li>
<li>代码分析和重构</li>
<li>测试和验证</li>
</ol>
<p>我应该用简洁的方式回答这个问题。 </p>
<p>我是 Sisyphus，一个具有编排能力的 AI 编程助手。以下是我的核心能力：</p>
<p><strong>代码操作</strong></p>
<ul>
<li>读取、编写、编辑文件</li>
<li>代码搜索（grep、AST 搜索、LSP）</li>
<li>代码重构和修复</li>
<li>类型检查和 linting</li>
</ul>
<p><strong>执行能力</strong></p>
<ul>
<li>执行 bash 命令（安装、测试、构建）</li>
<li>Git 操作（提交、分支、PR）</li>
<li>运行测试套件</li>
</ul>
<p><strong>分析能力</strong></p>
<ul>
<li>理解项目结构和代码库</li>
<li>查找符号定义和引用</li>
<li>诊断代码问题</li>
</ul>
<p><strong>任务委托</strong></p>
<ul>
<li>调用专门的子代理（explore、librarian、oracle 等）</li>
<li>并行执行多个任务</li>
<li>使用用户安装的技能</li>
</ul>
<p><strong>信息获取</strong></p>
<ul>
<li>Web 搜索</li>
<li>获取文档（Context7）</li>
<li>GitHub 代码搜索</li>
</ul>
<p><strong>会话管理</strong></p>
<ul>
<li>跨会话保持上下文</li>
<li>跟踪待办事项</li>
<li>管理后台任务</li>
</ul>
<p>需要我帮你做什么？</p>
</blockquote>
<ul>
<li><code>你有哪些子代理，用处是什么</code></li>
</ul>
<blockquote>
<p>用户问我有哪些子代理以及它们的用途。根据系统提示中的信息，我应该详细介绍可用的子代理（agents）。</p>
<p>让我整理一下系统提示中提到的子代理：</p>
<ol>
<li><strong>explore</strong> - 上下文grep，用于搜索代码库</li>
<li><strong>librarian</strong> - 外部参考grep，搜索文档、OSS等</li>
<li><strong>oracle</strong> - 只读高智商顾问，用于调试和架构</li>
<li><strong>metis</strong> - 预规划顾问，分析请求识别隐藏意图</li>
<li><strong>momus</strong> - 专家评审员，评估工作计划</li>
</ol>
<p>还有通过 task() 函数可用的预定义类别：</p>
<ul>
<li>visual-engineering - 前端、UI/UX</li>
<li>ultrabrain - 困难逻辑任务</li>
<li>deep - 目标导向自主问题解决</li>
<li>artistry - 复杂创意问题解决</li>
<li>quick - 简单任务</li>
<li>unspecified-low/unspecified-high - 不适合其他类别</li>
<li>writing - 文档、技术写作</li>
</ul>
<p>以及技能：</p>
<ul>
<li>playwright - 浏览器自动化</li>
<li>frontend-ui-ux - UI/UX设计开发</li>
<li>git-master - Git操作</li>
<li>dev-browser - 浏览器自动化</li>
</ul>
<p>我应该清晰地列出这些子代理及其用途。 </p>
<p>我目前可用的子代理（Agents）如下：</p>
<h2 data-id="heading-4">核心子代理</h2>



































<table><thead><tr><th>子代理</th><th>用途</th><th>触发场景</th></tr></thead><tbody><tr><td><strong>explore</strong></td><td>上下文grep，搜索内部代码库</td><td>查找现有代码模式、结构、风格</td></tr><tr><td><strong>librarian</strong></td><td>外部参考grep，搜索文档/OSS/开源实现</td><td>不熟悉的库、最佳实践、官方文档</td></tr><tr><td><strong>oracle</strong></td><td>只读高智商顾问，用于调试和架构决策</td><td>复杂架构、2+次修复失败后、不熟悉的模式</td></tr><tr><td><strong>metis</strong></td><td>预规划顾问，分析请求识别隐藏意图</td><td>复杂任务、需要澄清范围、模糊需求</td></tr><tr><td><strong>momus</strong></td><td>专家评审员，评估工作计划</td><td>工作计划评审、质量保证、catch漏洞</td></tr></tbody></table>
<h2 data-id="heading-5">任务类别（Category）</h2>





































<table><thead><tr><th>类别</th><th>最佳用于</th></tr></thead><tbody><tr><td><strong>visual-engineering</strong></td><td>前端、UI/UX、设计、样式、动画</td></tr><tr><td><strong>ultrabrain</strong></td><td>真正困难的逻辑任务（仅此用途）</td></tr><tr><td><strong>deep</strong></td><td>目标导向的问题解决，需要深入研究</td></tr><tr><td><strong>artistry</strong></td><td>复杂创意问题解决，超出标准模式</td></tr><tr><td><strong>quick</strong></td><td>简单任务 - 单文件修改、拼写错误、简单修改</td></tr><tr><td><strong>unspecified-low/high</strong></td><td>不适合其他类别</td></tr><tr><td><strong>writing</strong></td><td>文档、散文、技术写作</td></tr></tbody></table>
<h2 data-id="heading-6">技能（Skills）</h2>

























<table><thead><tr><th>技能</th><th>用途</th></tr></thead><tbody><tr><td><strong>playwright</strong></td><td>浏览器自动化 - 验证、浏览、信息抓取、测试、截图</td></tr><tr><td><strong>frontend-ui-ux</strong></td><td>设计驱动的UI/UX开发</td></tr><tr><td><strong>git-master</strong></td><td>Git操作 - 原子提交、rebase/squash、历史搜索</td></tr><tr><td><strong>dev-browser</strong></td><td>浏览器自动化 - 持续页面状态、导航、表单、截图</td></tr></tbody></table>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[synchronized]]></title>    <link>https://juejin.cn/post/7605213691910733850</link>    <guid>https://juejin.cn/post/7605213691910733850</guid>    <pubDate>2026-02-11T09:17:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605213691910733850" data-draft-id="7605135197167239218" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" synchronized"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-11T09:17:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="砍材农夫"/> <meta itemprop="url" content="https://juejin.cn/user/4126885865862187"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             synchronized
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4126885865862187/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    砍材农夫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:17:53.000Z" title="Wed Feb 11 2026 09:17:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jysemel.top%2Finterview%2Fjava%2Flock%2Fsynchronized.html%23%25E5%2587%25A0%25E7%25A7%258D%25E6%2596%25B9%25E5%25BC%258F" target="_blank" title="https://www.jysemel.top/interview/java/lock/synchronized.html#%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F" ref="nofollow noopener noreferrer">几种方式</a>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jysemel.top%2Finterview%2Fjava%2Flock%2Fsynchronized.html%23%25E4%25BF%25AE%25E9%25A5%25B0%25E6%2596%25B9%25E6%25B3%2595" target="_blank" title="https://www.jysemel.top/interview/java/lock/synchronized.html#%E4%BF%AE%E9%A5%B0%E6%96%B9%E6%B3%95" ref="nofollow noopener noreferrer">修饰方法</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jysemel.top%2Finterview%2Fjava%2Flock%2Fsynchronized.html%23%25E4%25BF%25AE%25E9%25A5%25B0%25E9%259D%2599%25E6%2580%2581%25E6%2596%25B9%25E6%25B3%2595" target="_blank" title="https://www.jysemel.top/interview/java/lock/synchronized.html#%E4%BF%AE%E9%A5%B0%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95" ref="nofollow noopener noreferrer">修饰静态方法</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jysemel.top%2Finterview%2Fjava%2Flock%2Fsynchronized.html%23%25E4%25BF%25AE%25E9%25A5%25B0%25E4%25BB%25A3%25E7%25A0%2581%25E5%259D%2597-%25E5%2590%258C%25E6%25AD%25A5%25E4%25BB%25A3%25E7%25A0%2581%25E5%259D%2597" target="_blank" title="https://www.jysemel.top/interview/java/lock/synchronized.html#%E4%BF%AE%E9%A5%B0%E4%BB%A3%E7%A0%81%E5%9D%97-%E5%90%8C%E6%AD%A5%E4%BB%A3%E7%A0%81%E5%9D%97" ref="nofollow noopener noreferrer">修饰代码块(同步代码块)</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jysemel.top%2Finterview%2Fjava%2Flock%2Fsynchronized.html%23%25E4%25BF%25AE%25E9%25A5%25B0%25E4%25BB%25A3%25E7%25A0%2581%25E5%259D%2597-this%25E5%2592%258C%25E7%25B1%25BB" target="_blank" title="https://www.jysemel.top/interview/java/lock/synchronized.html#%E4%BF%AE%E9%A5%B0%E4%BB%A3%E7%A0%81%E5%9D%97-this%E5%92%8C%E7%B1%BB" ref="nofollow noopener noreferrer">修饰代码块(this和类)</a></li>
</ul>
</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jysemel.top%2Finterview%2Fjava%2Flock%2Fsynchronized.html%23%25E9%2594%2581%25E5%258D%2587%25E7%25BA%25A7" target="_blank" title="https://www.jysemel.top/interview/java/lock/synchronized.html#%E9%94%81%E5%8D%87%E7%BA%A7" ref="nofollow noopener noreferrer">锁升级</a>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jysemel.top%2Finterview%2Fjava%2Flock%2Fsynchronized.html%23synchronized-%25E7%259A%2584%25E9%2594%2581%25E5%258D%2587%25E7%25BA%25A7%25E8%25BF%2587%25E7%25A8%258B%25E6%2580%25BB%25E7%25BB%2593" target="_blank" title="https://www.jysemel.top/interview/java/lock/synchronized.html#synchronized-%E7%9A%84%E9%94%81%E5%8D%87%E7%BA%A7%E8%BF%87%E7%A8%8B%E6%80%BB%E7%BB%93" ref="nofollow noopener noreferrer">synchronized 的锁升级过程总结</a></li>
</ul>
</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.jysemel.top%2Finterview%2Fjava%2Flock%2Fsynchronized.html%23%25E6%25BA%2590%25E7%25A0%2581" target="_blank" title="https://www.jysemel.top/interview/java/lock/synchronized.html#%E6%BA%90%E7%A0%81" ref="nofollow noopener noreferrer">源码</a></li>
</ul>
<h3 data-id="heading-0">几种方式</h3>
<h4 data-id="heading-1">修饰方法</h4>
<blockquote>
<p>同一个实例，同一时间只能有一个线程访问该方法 作用域是同一个实例</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.jysemel.java.basic.thread.lock;

<span class="hljs-keyword">import</span> lombok.SneakyThrows;

<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronizedDemo1</span> {

    <span class="hljs-meta">@SneakyThrows</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">say</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"static1 -------------"</span> + Thread.currentThread().getName());
        TimeUnit.SECONDS.sleep(<span class="hljs-number">10</span>);
        System.out.println(<span class="hljs-string">"static1-----------------end"</span> + Thread.currentThread().getName());
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 同一个实例</span>
        <span class="hljs-type">SynchronizedDemo1</span> <span class="hljs-variable">demo1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronizedDemo1</span>();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(demo1::say).start();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(demo1::say).start();

        <span class="hljs-comment">// 不同实例</span>
        <span class="hljs-type">SynchronizedDemo1</span> <span class="hljs-variable">demo2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronizedDemo1</span>();
        <span class="hljs-type">SynchronizedDemo1</span> <span class="hljs-variable">demo3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronizedDemo1</span>();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(demo2::say).start();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(demo3::say).start();

    }
}
</code></pre>
<h4 data-id="heading-2">修饰静态方法</h4>
<blockquote>
<p>作用域全局</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.jysemel.java.basic.thread.lock;

<span class="hljs-keyword">import</span> lombok.SneakyThrows;

<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronizedDemo2</span> {

    <span class="hljs-meta">@SneakyThrows</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">say</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"static1 -------------"</span> + Thread.currentThread().getName());
        TimeUnit.SECONDS.sleep(<span class="hljs-number">10</span>);
        System.out.println(<span class="hljs-string">"static1-----------------end"</span> + Thread.currentThread().getName());
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(SynchronizedDemo2::say).start();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(SynchronizedDemo2::say).start();
    }
}
</code></pre>
<h4 data-id="heading-3">修饰代码块(同步代码块)</h4>
<blockquote>
<p>同一个实例，同一时间只能有一个线程访问该方法 如果是静态对象，则作用域全局</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.jysemel.java.basic.thread.lock;

<span class="hljs-keyword">import</span> lombok.SneakyThrows;

<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronizedDemo3</span> {


    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Object</span> <span class="hljs-variable">staticObj</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();

    <span class="hljs-meta">@SneakyThrows</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">say</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-keyword">synchronized</span> (obj) {
            System.out.println(name + <span class="hljs-string">"say -------------"</span> + Thread.currentThread().getName());
            TimeUnit.SECONDS.sleep(<span class="hljs-number">10</span>);
            System.out.println(name + <span class="hljs-string">"say-----------------end "</span> + Thread.currentThread().getName());
        }
    }

    <span class="hljs-meta">@SneakyThrows</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">staticSay</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-keyword">synchronized</span> (staticObj) {
            System.out.println(name + <span class="hljs-string">"staticSay -------------"</span> + Thread.currentThread().getName());
            TimeUnit.SECONDS.sleep(<span class="hljs-number">10</span>);
            System.out.println(name + <span class="hljs-string">"staticSay-----------------end "</span> + Thread.currentThread().getName());
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
<span class="hljs-comment">//        // 同一个实例</span>
<span class="hljs-comment">//        SynchronizedDemo3 demo1 = new SynchronizedDemo3();</span>
<span class="hljs-comment">//        new Thread( () -&gt; demo1.say("thread1 ")).start();</span>
<span class="hljs-comment">//        new Thread( () -&gt; demo1.say("thread2 ")).start();</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">//        //不同实例</span>
<span class="hljs-comment">//        SynchronizedDemo3 demo2 = new SynchronizedDemo3();</span>
<span class="hljs-comment">//        SynchronizedDemo3 demo3 = new SynchronizedDemo3();</span>
<span class="hljs-comment">//        new Thread( () -&gt; demo2.say("thread3 ")).start();</span>
<span class="hljs-comment">//        new Thread( () -&gt; demo3.say("thread4 ")).start();</span>

        <span class="hljs-comment">//不同实例，静态对象</span>
        <span class="hljs-type">SynchronizedDemo3</span> <span class="hljs-variable">demo4</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronizedDemo3</span>();
        <span class="hljs-type">SynchronizedDemo3</span> <span class="hljs-variable">demo5</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronizedDemo3</span>();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>( () -&gt; demo4.staticSay(<span class="hljs-string">"thread4 "</span>)).start();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>( () -&gt; demo5.staticSay(<span class="hljs-string">"thread5 "</span>)).start();

        System.out.println(<span class="hljs-string">"finished"</span>);

    }

}
</code></pre>
<h4 data-id="heading-4">修饰代码块(this和类)</h4>
<blockquote>
<p>同一个实例，同一时间只能有一个线程访问该方法 类，则作用域全局</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.jysemel.java.basic.thread.lock;

<span class="hljs-keyword">import</span> lombok.SneakyThrows;

<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SynchronizedDemo4</span> {

    <span class="hljs-meta">@SneakyThrows</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">say</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) {
            System.out.println(name + <span class="hljs-string">"say -------------"</span> + Thread.currentThread().getName());
            TimeUnit.SECONDS.sleep(<span class="hljs-number">10</span>);
            System.out.println(name + <span class="hljs-string">"say-----------------end "</span> + Thread.currentThread().getName());
        }
    }

    <span class="hljs-meta">@SneakyThrows</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">staticSay</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-keyword">synchronized</span> (SynchronizedDemo4.class) {
            System.out.println(name + <span class="hljs-string">"staticSay -------------"</span> + Thread.currentThread().getName());
            TimeUnit.SECONDS.sleep(<span class="hljs-number">10</span>);
            System.out.println(name + <span class="hljs-string">"staticSay-----------------end "</span> + Thread.currentThread().getName());
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 同一个实例</span>
        <span class="hljs-type">SynchronizedDemo3</span> <span class="hljs-variable">demo1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronizedDemo3</span>();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>( () -&gt; demo1.say(<span class="hljs-string">"thread1 "</span>)).start();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>( () -&gt; demo1.say(<span class="hljs-string">"thread2 "</span>)).start();

        <span class="hljs-comment">//不同实例</span>
        <span class="hljs-type">SynchronizedDemo3</span> <span class="hljs-variable">demo2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronizedDemo3</span>();
        <span class="hljs-type">SynchronizedDemo3</span> <span class="hljs-variable">demo3</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronizedDemo3</span>();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>( () -&gt; demo2.say(<span class="hljs-string">"thread3 "</span>)).start();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>( () -&gt; demo3.say(<span class="hljs-string">"thread4 "</span>)).start();

        <span class="hljs-comment">//不同实例，静态对象</span>
<span class="hljs-comment">//        SynchronizedDemo4 demo4 = new SynchronizedDemo4();</span>
<span class="hljs-comment">//        SynchronizedDemo4 demo5 = new SynchronizedDemo4();</span>
<span class="hljs-comment">//        new Thread( () -&gt; demo4.staticSay("thread4 ")).start();</span>
<span class="hljs-comment">//        new Thread( () -&gt; demo5.staticSay("thread5 ")).start();</span>

        System.out.println(<span class="hljs-string">"finished"</span>);

    }

}
</code></pre>
<h3 data-id="heading-5">锁升级</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09bd72aa4b7e4237b111f0b61c3a1570~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CN5p2Q5Yac5aSr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771406272&amp;x-signature=jG%2BCY9RQs0BE0iVh9eYr4afn0OU%3D" alt="Image text" loading="lazy"/></p>
<h4 data-id="heading-6">synchronized 的锁升级过程总结</h4>
<ul>
<li>偏向锁</li>
</ul>
<blockquote>
<p>记录线程 ID，无竞争快速获取 单线程访问</p>
</blockquote>
<ul>
<li>轻量级锁</li>
</ul>
<blockquote>
<p>CAS 自旋，避免阻塞 低并发，短时间竞争</p>
</blockquote>
<ul>
<li>重量级锁</li>
</ul>
<blockquote>
<p>阻塞线程，性能低 高并发激烈竞争</p>
</blockquote>
<h3 data-id="heading-7">源码</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fjysemel-java%2Fjdk-series" target="_blank" title="https://gitee.com/jysemel-java/jdk-series" ref="nofollow noopener noreferrer">源码</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于 GPUI 实现 WebScoket 服务端之 UI 篇]]></title>    <link>https://juejin.cn/post/7605150769009164331</link>    <guid>https://juejin.cn/post/7605150769009164331</guid>    <pubDate>2026-02-11T09:19:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605150769009164331" data-draft-id="7605051886434598975" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于 GPUI 实现 WebScoket 服务端之 UI 篇"/> <meta itemprop="keywords" content="Rust"/> <meta itemprop="datePublished" content="2026-02-11T09:19:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Payton"/> <meta itemprop="url" content="https://juejin.cn/user/3342151211040622"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于 GPUI 实现 WebScoket 服务端之 UI 篇
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3342151211040622/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Payton
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:19:51.000Z" title="Wed Feb 11 2026 09:19:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、概述</h2>
<p>最近在学习 Rust 和 gpui，基于我学到的和遇到的问题，总结了一下，也顺便记录一下。</p>
<h3 data-id="heading-1">1、创建项目并用 Zed 打开</h3>
<pre><code class="hljs language-cmd" lang="cmd">cargo new ws-gpui
zed ws-gpui
</code></pre>
<h3 data-id="heading-2">2、安装依赖</h3>
<pre><code class="hljs language-cmd" lang="cmd">cargo add gpui
</code></pre>
<h3 data-id="heading-3">3、创建一个空窗口</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">use</span> gpui::{
    App, Application, Bounds, Empty, Entity, Window, WindowBounds, WindowOptions, prelude::*, px,
    size,
};

<span class="hljs-keyword">struct</span> <span class="hljs-title class_">WebSocketUi</span> {}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">WebSocketUi</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> {}
    }
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Render</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">WebSocketUi</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">render</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, _window: &amp;<span class="hljs-keyword">mut</span> Window, _cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-keyword">Self</span>&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">IntoElement</span> {
        Empty {}
    }
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">build_root_view</span>(_window: &amp;<span class="hljs-keyword">mut</span> Window, cx: &amp;<span class="hljs-keyword">mut</span> App) <span class="hljs-punctuation">-&gt;</span> Entity&lt;WebSocketUi&gt; {
    cx.<span class="hljs-title function_ invoke__">new</span>(|_cx| WebSocketUi::<span class="hljs-title function_ invoke__">new</span>())
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">on_finish_launching</span>(cx: &amp;<span class="hljs-keyword">mut</span> App) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">bounds</span> = Bounds::<span class="hljs-title function_ invoke__">centered</span>(<span class="hljs-literal">None</span>, <span class="hljs-title function_ invoke__">size</span>(<span class="hljs-title function_ invoke__">px</span>(<span class="hljs-number">500</span>.), <span class="hljs-title function_ invoke__">px</span>(<span class="hljs-number">250.0</span>)), cx);
    cx.<span class="hljs-title function_ invoke__">open_window</span>(
        WindowOptions {
            window_bounds: <span class="hljs-title function_ invoke__">Some</span>(WindowBounds::<span class="hljs-title function_ invoke__">Windowed</span>(bounds)),
            ..<span class="hljs-built_in">Default</span>::<span class="hljs-title function_ invoke__">default</span>()
        },
        build_root_view,
    )
    .<span class="hljs-title function_ invoke__">unwrap</span>();
}

<span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">app</span> = Application::<span class="hljs-title function_ invoke__">new</span>();
    app.<span class="hljs-title function_ invoke__">run</span>(on_finish_launching);
}
</code></pre>
<h2 data-id="heading-4">二、拆开来看看</h2>
<h3 data-id="heading-5">1、创建 app 并运行</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">app</span> = Application::<span class="hljs-title function_ invoke__">new</span>();
    app.<span class="hljs-title function_ invoke__">run</span>(on_finish_launching);
}
</code></pre>
<h3 data-id="heading-6">2、app 运行后，创建一个窗口。</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">on_finish_launching</span>(cx: &amp;<span class="hljs-keyword">mut</span> App) {
    <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">bounds</span> = Bounds::<span class="hljs-title function_ invoke__">centered</span>(<span class="hljs-literal">None</span>, <span class="hljs-title function_ invoke__">size</span>(<span class="hljs-title function_ invoke__">px</span>(<span class="hljs-number">500</span>.), <span class="hljs-title function_ invoke__">px</span>(<span class="hljs-number">250.0</span>)), cx);
    cx.<span class="hljs-title function_ invoke__">open_window</span>(
        WindowOptions {
            window_bounds: <span class="hljs-title function_ invoke__">Some</span>(WindowBounds::<span class="hljs-title function_ invoke__">Windowed</span>(bounds)),
            ..<span class="hljs-built_in">Default</span>::<span class="hljs-title function_ invoke__">default</span>()
        },
        build_root_view,
    )
    .<span class="hljs-title function_ invoke__">unwrap</span>();
}
</code></pre>
<p>创建一个在主显示器居中的，500px * 250px 的窗口，窗口的其它选项用默认的。</p>
<h3 data-id="heading-7">3、窗口打开后，实例化一个实体（Entity）, T -&gt; WebSocketUi</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">build_root_view</span>(_window: &amp;<span class="hljs-keyword">mut</span> Window, cx: &amp;<span class="hljs-keyword">mut</span> App) <span class="hljs-punctuation">-&gt;</span> Entity&lt;WebSocketUi&gt; {
    cx.<span class="hljs-title function_ invoke__">new</span>(|_cx| WebSocketUi::<span class="hljs-title function_ invoke__">new</span>())
}
</code></pre>
<h3 data-id="heading-8">4、WebScoketUi 需要实现 Render</h3>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Render</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">WebSocketUi</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">render</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, _window: &amp;<span class="hljs-keyword">mut</span> Window, _cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-keyword">Self</span>&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">IntoElement</span> {
        Empty {}
    }
}
</code></pre>
<p>render 方法现在是返回一个 <code>Empty</code> ，所以窗口里面什么内容都没有。</p>
<h3 data-id="heading-9">5、运行看看效果。</h3>
<pre><code class="hljs language-cmd" lang="cmd">cargo run
</code></pre>
<h3 data-id="heading-10">6、效果</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ea39ab2786f4d44a15512ceff452dfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGF5dG9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771406390&amp;x-signature=a88EJKc2isSJK7%2BjL94W%2F5ap3bg%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-11">三、实现业务需要的 UI</h2>
<h3 data-id="heading-12">1、创建一个简单示例。</h3>
<h4 data-id="heading-13">1.1、创建背景和示例文字</h4>
<p>需要创建一个内容撑满窗口的白色背景的内边距是 16px 的 UI。</p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Render</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">WebSocketUi</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">render</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, _window: &amp;<span class="hljs-keyword">mut</span> Window, _cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-keyword">Self</span>&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">IntoElement</span> {
        <span class="hljs-title function_ invoke__">div</span>()
            .<span class="hljs-title function_ invoke__">size_full</span>()
            .<span class="hljs-title function_ invoke__">p_4</span>()
            .<span class="hljs-title function_ invoke__">bg</span>(<span class="hljs-title function_ invoke__">rgb</span>(<span class="hljs-number">0xffffff</span>))
            .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-string">"Hello gpui"</span>)
    }
}
</code></pre>
<p>如果你熟悉 <code>Tailwind CSS</code>，你应该对这种语法很熟悉。请参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Ftailwindcss.com%2Fdocs%2Fstyling-with-utility-classes" target="_blank" title="https://tailwindcss.com/docs/styling-with-utility-classes" ref="nofollow noopener noreferrer">Tailwind CSS</a></p>
<h4 data-id="heading-14">1.2、看看效果</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1adce3f77b54db3a8e740fe3b828bf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGF5dG9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771406390&amp;x-signature=KaDjKa%2Bi765ve3RuoGwUz1tVNfg%3D" alt="2.png" loading="lazy"/></p>
<h3 data-id="heading-15">2、创建整体结构</h3>
<h4 data-id="heading-16">2.1、代码实现</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">impl</span> <span class="hljs-title class_">Render</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">WebSocketUi</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">render</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, _window: &amp;<span class="hljs-keyword">mut</span> Window, _cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-keyword">Self</span>&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">IntoElement</span> {
        <span class="hljs-title function_ invoke__">div</span>().<span class="hljs-title function_ invoke__">size_full</span>().<span class="hljs-title function_ invoke__">p_4</span>().<span class="hljs-title function_ invoke__">bg</span>(<span class="hljs-title function_ invoke__">rgb</span>(<span class="hljs-number">0xffffff</span>)).<span class="hljs-title function_ invoke__">child</span>(
            <span class="hljs-title function_ invoke__">div</span>()
                .<span class="hljs-title function_ invoke__">flex</span>()
                .<span class="hljs-title function_ invoke__">flex_col</span>()
                .<span class="hljs-title function_ invoke__">gap_4</span>()
                .<span class="hljs-title function_ invoke__">size_full</span>()
                .<span class="hljs-title function_ invoke__">justify_center</span>()
                .<span class="hljs-title function_ invoke__">items_center</span>()
                .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-string">"服务运行状态栏在这里"</span>)
                .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-string">"状态信息栏在这里"</span>)
                .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-string">"操作栏在这里"</span>),
        )
    }
}
</code></pre>
<p>这种代码对前端开发来说特别<code>亲切</code>。</p>
<h4 data-id="heading-17">2.2、看看效果</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f791dafc8e44f3384e62383e2767f2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGF5dG9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771406390&amp;x-signature=U5vJu6FSUqkaR3SNBTNkAEX7wXE%3D" alt="3.png" loading="lazy"/></p>
<h3 data-id="heading-18">3、实现服务运行状态栏。</h3>
<h4 data-id="heading-19">3.1、代码实现</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">WebSocketUi</span> {
    is_running: <span class="hljs-type">bool</span>, <span class="hljs-comment">// 组件状态，和 React 的 const [isRunning, setIsRunning] = useState(false) 有点像</span>
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">WebSocketUi</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> { is_running: <span class="hljs-literal">false</span> }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">status_bar</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, _window: &amp;<span class="hljs-keyword">mut</span> Window, _cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-keyword">Self</span>&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">IntoElement</span> {
        <span class="hljs-keyword">let</span> (connection_status, status_color) = <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.is_running {
            (<span class="hljs-string">"已开启"</span>, <span class="hljs-title function_ invoke__">rgb</span>(<span class="hljs-number">0x00ff00</span>))
        } <span class="hljs-keyword">else</span> {
            (<span class="hljs-string">"未开启"</span>, <span class="hljs-title function_ invoke__">rgb</span>(<span class="hljs-number">0xff0000</span>))
        };
        
        <span class="hljs-title function_ invoke__">div</span>()
            .<span class="hljs-title function_ invoke__">flex</span>()
            .<span class="hljs-title function_ invoke__">items_center</span>()
            .<span class="hljs-title function_ invoke__">gap_2</span>()
            .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-string">"服务状态:"</span>)
            .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-title function_ invoke__">div</span>().<span class="hljs-title function_ invoke__">w_4</span>().<span class="hljs-title function_ invoke__">h_4</span>().<span class="hljs-title function_ invoke__">rounded_full</span>().<span class="hljs-title function_ invoke__">bg</span>(status_color))
            .<span class="hljs-title function_ invoke__">child</span>(connection_status)
    }
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Render</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">WebSocketUi</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">render</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, window: &amp;<span class="hljs-keyword">mut</span> Window, cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-keyword">Self</span>&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">IntoElement</span> {
        <span class="hljs-title function_ invoke__">div</span>().<span class="hljs-title function_ invoke__">size_full</span>().<span class="hljs-title function_ invoke__">p_4</span>().<span class="hljs-title function_ invoke__">bg</span>(<span class="hljs-title function_ invoke__">rgb</span>(<span class="hljs-number">0xffffff</span>)).<span class="hljs-title function_ invoke__">child</span>(
            <span class="hljs-title function_ invoke__">div</span>()
                .<span class="hljs-title function_ invoke__">flex</span>()
                .<span class="hljs-title function_ invoke__">flex_col</span>()
                .<span class="hljs-title function_ invoke__">gap_4</span>()
                .<span class="hljs-title function_ invoke__">size_full</span>()
                .<span class="hljs-title function_ invoke__">justify_center</span>()
                .<span class="hljs-title function_ invoke__">items_center</span>()
                .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">status_bar</span>(window, cx))
                .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-string">"状态信息栏在这里"</span>)
                .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-string">"操作栏在这里"</span>),
        )
    }
}
</code></pre>
<h4 data-id="heading-20">3.2、看看效果</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/967ce4f37b074696bc7c72bed6c9c706~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGF5dG9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771406390&amp;x-signature=5sy5LiTytQZWW%2FXnjcRqLfef2Cw%3D" alt="4.png" loading="lazy"/></p>
<h3 data-id="heading-21">4、实现状态信息栏</h3>
<h4 data-id="heading-22">4.1、代码实现</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">WebSocketUi</span> {
    is_running: <span class="hljs-type">bool</span>,
    status_message: <span class="hljs-type">String</span>,
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">WebSocketUi</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">new</span>() <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">Self</span> {
        <span class="hljs-keyword">Self</span> {
            is_running: <span class="hljs-literal">false</span>,
            status_message: <span class="hljs-string">"未开启"</span>.<span class="hljs-title function_ invoke__">into</span>(),
        }
    }
    
    <span class="hljs-comment">// 省略了 status_bar 方法</span>
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Render</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">WebSocketUi</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">render</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, window: &amp;<span class="hljs-keyword">mut</span> Window, cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-keyword">Self</span>&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">IntoElement</span> {
        <span class="hljs-keyword">let</span> <span class="hljs-keyword"/><span class="hljs-variable">status_message</span> = <span class="hljs-keyword">self</span>.status_message.<span class="hljs-title function_ invoke__">clone</span>();

        <span class="hljs-title function_ invoke__">div</span>().<span class="hljs-title function_ invoke__">size_full</span>().<span class="hljs-title function_ invoke__">p_4</span>().<span class="hljs-title function_ invoke__">bg</span>(<span class="hljs-title function_ invoke__">rgb</span>(<span class="hljs-number">0xffffff</span>)).<span class="hljs-title function_ invoke__">child</span>(
            <span class="hljs-title function_ invoke__">div</span>()
                <span class="hljs-comment">// 省略了一些代码</span>
                .<span class="hljs-title function_ invoke__">child</span>(status_message)
                .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-string">"操作栏在这里"</span>),
        )
    }
}
</code></pre>
<h4 data-id="heading-23">4.2、看看效果</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9604f3d0a72b49a5beadef811ec19e33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGF5dG9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771406390&amp;x-signature=fxqG%2F8NyPSKFCJcvJKSJv4qqL%2Fc%3D" alt="5.png" loading="lazy"/></p>
<h3 data-id="heading-24">5、实现操作栏</h3>
<h4 data-id="heading-25">5.1、代码实现</h4>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-keyword">impl</span> <span class="hljs-title class_">WebSocketUi</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">start</span>(this: &amp;<span class="hljs-keyword">mut</span> WebSocketUi, _evt: &amp;ClickEvent, _win: &amp;<span class="hljs-keyword">mut</span> Window, cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-keyword">Self</span>&gt;) {
        <span class="hljs-keyword">if</span> !this.is_running {
            this.is_running = <span class="hljs-literal">true</span>;
            this.status_message = <span class="hljs-string">"已连接"</span>.<span class="hljs-title function_ invoke__">into</span>();
            cx.<span class="hljs-title function_ invoke__">notify</span>();
        }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">disconnect</span>(
        this: &amp;<span class="hljs-keyword">mut</span> WebSocketUi,
        _evt: &amp;ClickEvent,
        _win: &amp;<span class="hljs-keyword">mut</span> Window,
        cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-keyword">Self</span>&gt;,
    ) {
        <span class="hljs-keyword">if</span> this.is_running {
            this.is_running = <span class="hljs-literal">false</span>;
            this.status_message = <span class="hljs-string">"未连接"</span>.<span class="hljs-title function_ invoke__">into</span>();
            cx.<span class="hljs-title function_ invoke__">notify</span>();
        }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">send_test_message</span>(
        this: &amp;<span class="hljs-keyword">mut</span> WebSocketUi,
        _evt: &amp;ClickEvent,
        _win: &amp;<span class="hljs-keyword">mut</span> Window,
        cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-keyword">Self</span>&gt;,
    ) {
        <span class="hljs-keyword">if</span> this.is_running {
            this.status_message = <span class="hljs-string">"消息已发送"</span>.<span class="hljs-title function_ invoke__">into</span>();
            cx.<span class="hljs-title function_ invoke__">notify</span>();
        }
    }

    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">actions_bar</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, _window: &amp;<span class="hljs-keyword">mut</span> Window, cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-keyword">Self</span>&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">IntoElement</span> {
        <span class="hljs-keyword">let</span> (start_cursor, start_bg, stop_cursor, stop_bg) = <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.is_running {
            (
                CursorStyle::OperationNotAllowed,
                gpui::<span class="hljs-title function_ invoke__">black</span>().<span class="hljs-title function_ invoke__">opacity</span>(<span class="hljs-number">0.4</span>),
                CursorStyle::PointingHand,
                gpui::<span class="hljs-title function_ invoke__">black</span>(),
            )
        } <span class="hljs-keyword">else</span> {
            (
                CursorStyle::PointingHand,
                gpui::<span class="hljs-title function_ invoke__">black</span>(),
                CursorStyle::OperationNotAllowed,
                gpui::<span class="hljs-title function_ invoke__">black</span>().<span class="hljs-title function_ invoke__">opacity</span>(<span class="hljs-number">0.4</span>),
            )
        };

        <span class="hljs-title function_ invoke__">div</span>()
            .<span class="hljs-title function_ invoke__">flex</span>()
            .<span class="hljs-title function_ invoke__">gap_2</span>()
            .<span class="hljs-title function_ invoke__">child</span>(
                <span class="hljs-title function_ invoke__">div</span>()
                    .<span class="hljs-title function_ invoke__">id</span>(<span class="hljs-string">"connect"</span>) <span class="hljs-comment">// 这里要注意，和用户交互的 div 必须要加上 id，比如点击、滚动</span>
                    .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-string">"开启"</span>)
                    .<span class="hljs-title function_ invoke__">text_color</span>(gpui::<span class="hljs-title function_ invoke__">white</span>())
                    .<span class="hljs-title function_ invoke__">bg</span>(start_bg)
                    .<span class="hljs-title function_ invoke__">rounded_md</span>()
                    .<span class="hljs-title function_ invoke__">py_0p5</span>()
                    .<span class="hljs-title function_ invoke__">px_1</span>()
                    .<span class="hljs-title function_ invoke__">cursor</span>(start_cursor)
                    .<span class="hljs-title function_ invoke__">on_click</span>(cx.<span class="hljs-title function_ invoke__">listener</span>(<span class="hljs-keyword">Self</span>::start)),
            )
            .<span class="hljs-title function_ invoke__">child</span>(
                <span class="hljs-title function_ invoke__">div</span>()
                    .<span class="hljs-title function_ invoke__">id</span>(<span class="hljs-string">"disconnect"</span>)
                    .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-string">"关闭"</span>)
                    .<span class="hljs-title function_ invoke__">text_color</span>(gpui::<span class="hljs-title function_ invoke__">white</span>())
                    .<span class="hljs-title function_ invoke__">bg</span>(stop_bg)
                    .<span class="hljs-title function_ invoke__">rounded_md</span>()
                    .<span class="hljs-title function_ invoke__">py_0p5</span>()
                    .<span class="hljs-title function_ invoke__">px_1</span>()
                    .<span class="hljs-title function_ invoke__">cursor</span>(stop_cursor)
                    .<span class="hljs-title function_ invoke__">on_click</span>(cx.<span class="hljs-title function_ invoke__">listener</span>(<span class="hljs-keyword">Self</span>::disconnect)),
            )
            .<span class="hljs-title function_ invoke__">child</span>(
                <span class="hljs-title function_ invoke__">div</span>()
                    .<span class="hljs-title function_ invoke__">id</span>(<span class="hljs-string">"send"</span>)
                    .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-string">"发送测试消息"</span>)
                    .<span class="hljs-title function_ invoke__">text_color</span>(gpui::<span class="hljs-title function_ invoke__">white</span>())
                    .<span class="hljs-title function_ invoke__">bg</span>(stop_bg)
                    .<span class="hljs-title function_ invoke__">rounded_md</span>()
                    .<span class="hljs-title function_ invoke__">py_0p5</span>()
                    .<span class="hljs-title function_ invoke__">px_1</span>()
                    .<span class="hljs-title function_ invoke__">cursor</span>(stop_cursor)
                    .<span class="hljs-title function_ invoke__">on_click</span>(cx.<span class="hljs-title function_ invoke__">listener</span>(<span class="hljs-keyword">Self</span>::send_test_message)),
            )
    }
}

<span class="hljs-keyword">impl</span> <span class="hljs-title class_">Render</span> <span class="hljs-keyword">for</span> <span class="hljs-title class_">WebSocketUi</span> {
    <span class="hljs-keyword">fn</span> <span class="hljs-title function_">render</span>(&amp;<span class="hljs-keyword">mut</span> <span class="hljs-keyword">self</span>, window: &amp;<span class="hljs-keyword">mut</span> Window, cx: &amp;<span class="hljs-keyword">mut</span> Context&lt;<span class="hljs-keyword">Self</span>&gt;) <span class="hljs-punctuation">-&gt;</span> <span class="hljs-keyword">impl</span> <span class="hljs-title class_">IntoElement</span> {
        <span class="hljs-title function_ invoke__">div</span>().<span class="hljs-title function_ invoke__">size_full</span>().<span class="hljs-title function_ invoke__">p_4</span>().<span class="hljs-title function_ invoke__">bg</span>(<span class="hljs-title function_ invoke__">rgb</span>(<span class="hljs-number">0xffffff</span>)).<span class="hljs-title function_ invoke__">child</span>(
            <span class="hljs-title function_ invoke__">div</span>()
               <span class="hljs-comment">// 省略了一些代码</span>
                .<span class="hljs-title function_ invoke__">child</span>(<span class="hljs-keyword">self</span>.<span class="hljs-title function_ invoke__">actions_bar</span>(window, cx)),
        )
    }
}
</code></pre>
<h4 data-id="heading-26">5.2、看看效果</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8dffeb04c3e94eac83335009fc280fc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGF5dG9u:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771406390&amp;x-signature=IXrNt0ZXFdu9PuVY76ultR6exQo%3D" alt="6.png" loading="lazy"/></p>
<h2 data-id="heading-27">四、总结</h2>
<h3 data-id="heading-28">1、分清楚不同的 Context（cx）</h3>




















<table><thead><tr><th>上下文类型</th><th>线程</th><th>主要用途</th></tr></thead><tbody><tr><td>AppContext</td><td>主线程</td><td>应用启动、打开窗口</td></tr><tr><td>Context&lt;T&gt;</td><td>主线程</td><td>组件逻辑、UI 更新</td></tr></tbody></table>
<h3 data-id="heading-29">2、熟悉 <a href="https://link.juejin.cn?target=https%3A%2F%2Ftailwindcss.com%2Fdocs%2Fstyling-with-utility-classes" target="_blank" title="https://tailwindcss.com/docs/styling-with-utility-classes" ref="nofollow noopener noreferrer">Tailwind CSS</a></h3>
<h3 data-id="heading-30">3、熟悉 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzed-industries%2Fzed%2Ftree%2Fmain%2Fcrates%2Fgpui%2Fexamples" target="_blank" title="https://github.com/zed-industries/zed/tree/main/crates/gpui/examples" ref="nofollow noopener noreferrer">gpui 的例子</a></h3>
<p>对于做前端的我来说，实现 UI 还是很容易的，把它和 WebScoket 服务集成在一起，才是最有挑战的。</p>
<p>等我有空了，我再写另一篇文章记录一下我掉进的深坑（主要是不熟悉多线程、异步任务）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 与前端开发的对比：构建、调试与平台兼容性差异]]></title>    <link>https://juejin.cn/post/7605174711182262335</link>    <guid>https://juejin.cn/post/7605174711182262335</guid>    <pubDate>2026-02-11T09:28:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605174711182262335" data-draft-id="7605128056485888015" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 与前端开发的对比：构建、调试与平台兼容性差异"/> <meta itemprop="keywords" content="Flutter,前端"/> <meta itemprop="datePublished" content="2026-02-11T09:28:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="月亮有石头"/> <meta itemprop="url" content="https://juejin.cn/user/3526889032395613"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 与前端开发的对比：构建、调试与平台兼容性差异
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889032395613/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    月亮有石头
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:28:10.000Z" title="Wed Feb 11 2026 09:28:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为一个传统前端开发者，最近接手了一个老的flutter项目，说实话感觉并不容易。Flutter 不仅仅是一个 UI 框架，它涉及到原生开发的诸多细节，平台兼容性、构建流程和调试方式都与传统前端开发有很大不同。</p>
<p>这篇文章将对比<strong>Flutter</strong>与传统前端框架（特别是 Vue 和 React）在<strong>构建、调试和平台兼容性</strong>方面的差异。让你了解从前端转向 Flutter 开发时，需要调整的思维和工具。</p>
<h2 data-id="heading-0">构建流程：Flutter 与前端框架的不同</h2>
<p>Flutter 构建流程不仅要支持 Web，还支持原生平台（Android 和 iOS）。它的构建过程需要涉及原生代码的编译、资源打包等，以下是每一步 Flutter 构建流程与前端构建流程中相应步骤和命令的对比。</p>
<h3 data-id="heading-1"><strong>1. 构建命令</strong></h3>
<h4 data-id="heading-2"><strong>Flutter：</strong> <code>flutter build</code> 命令</h4>
<p>Flutter 构建应用时，使用 <code>flutter build</code> 命令来生成不同平台的输出。以下是常用的构建命令：</p>
<ul>
<li><strong><code>flutter build apk</code></strong>：构建 Android 应用，生成 APK 文件。</li>
<li><strong><code>flutter build ios</code></strong>：构建 iOS 应用，生成 IPA 文件。</li>
<li><strong><code>flutter build web</code></strong>：构建 Web 应用，生成浏览器可以使用的静态文件（HTML、CSS、JS）。</li>
</ul>
<h4 data-id="heading-3"><strong>对比前端构建：</strong> <code>npm run build</code>（以 Vue/React 为例）</h4>
<p>前端开发（如 Vue 或 React）的构建流程通常依赖于 Webpack、Vite 等构建工具。这些工具会将代码打包、压缩并生成静态文件，适合在浏览器中运行。</p>
<ul>
<li><strong><code>npm run build</code></strong>：通过 Webpack 或 Vite 将前端应用编译成静态文件。通常会生成 <code>dist/</code> 或 <code>build/</code> 文件夹，里面包含 HTML、CSS 和 JavaScript 文件。</li>
</ul>
<h3 data-id="heading-4"><strong>2. 原生代码编译与优化</strong></h3>
<h4 data-id="heading-5"><strong>Flutter：</strong> AOT 编译</h4>
<p>Flutter 将 Dart 代码通过 AOT（Ahead-of-Time）编译为原生代码，这意味着 Flutter 会将应用的代码在构建时转换为可以直接在 Android 或 iOS 上执行的机器码。</p>
<ul>
<li><strong><code>flutter build apk</code></strong>：通过 AOT 编译生成 Android 平台的原生代码（APK）。</li>
<li><strong><code>flutter build ios</code></strong>：通过 AOT 编译生成 iOS 平台的原生代码（IPA）。</li>
</ul>
<h4 data-id="heading-6"><strong>对比前端编译：</strong> 编译和压缩</h4>
<p>前端框架（如 Vue 或 React）将 JavaScript 代码进行编译和压缩，以优化加载速度和减少文件大小。这个过程通常包括代码分割、模块合并等，确保最终的静态文件可以高效运行。</p>
<ul>
<li>
<p><strong>Webpack/Vite 编译</strong>：通过 Webpack 或 Vite，将 JavaScript、CSS 和图片等资源进行优化，生成静态文件。</p>
<ul>
<li><strong>代码分割</strong>：前端项目会根据需要将代码拆分成多个模块，按需加载。</li>
<li><strong>压缩和混淆</strong>：压缩 JavaScript、CSS 和图片，减少资源体积，提升加载速度。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-7"><strong>3. 依赖管理</strong></h3>
<h4 data-id="heading-8"><strong>Flutter：</strong> <code>pubspec.yaml</code></h4>
<p>Flutter 使用 <code>pubspec.yaml</code> 文件来管理依赖，它与前端项目中的 <code>package.json</code> 文件类似。Flutter 项目的依赖不仅包括 Dart 包，还包括原生代码库的集成。</p>
<ul>
<li><strong><code>flutter pub get</code></strong>：安装 <code>pubspec.yaml</code> 中声明的依赖。</li>
<li><strong><code>flutter pub upgrade</code></strong>：升级依赖到最新版本。</li>
<li><strong><code>flutter pub outdated</code></strong>：查看过期的依赖，帮助进行版本管理。</li>
</ul>
<h4 data-id="heading-9"><strong>对比前端：</strong> <code>package.json</code> 和 <code>npm install</code></h4>
<p>前端项目通过 <code>package.json</code> 文件来管理 JavaScript 库和工具，类似于 Flutter 中的 <code>pubspec.yaml</code> 文件。<code>npm</code> 或 <code>yarn</code> 是前端项目的包管理工具，帮助安装和更新依赖。</p>
<ul>
<li><strong><code>npm install</code></strong>：安装 <code>package.json</code> 中列出的所有依赖。</li>
<li><strong><code>npm update</code></strong>：升级所有依赖到最新版本。</li>
<li><strong><code>npm outdated</code></strong>：查看过期的依赖和版本更新。</li>
</ul>
<h3 data-id="heading-10"><strong>4. 输出文件：平台特定的构建结果</strong></h3>
<h4 data-id="heading-11"><strong>Flutter：</strong> 原生应用（APK、IPA）和 Web 输出</h4>
<p>Flutter 会根据平台生成不同的输出文件：</p>
<ul>
<li><strong>Android：</strong> 生成 APK 文件，可以直接安装到 Android 设备上。</li>
<li><strong>iOS：</strong> 生成 IPA 文件，可以通过 Xcode 部署到 iOS 设备上。</li>
<li><strong>Web：</strong> 生成 HTML、CSS 和 JavaScript 文件，可以直接部署到 Web 服务器上。</li>
</ul>
<h4 data-id="heading-12"><strong>对比前端构建产物：</strong> 静态文件（HTML、CSS、JS）</h4>
<p>前端项目在构建后生成适用于浏览器的静态文件，包括：</p>
<ul>
<li><strong>HTML</strong>：基础页面结构。</li>
<li><strong>CSS</strong>：样式表，定义页面样式。</li>
<li><strong>JavaScript</strong>：行为脚本，控制页面交互。</li>
</ul>
<p>这些文件最终通过 HTTP 或其他协议加载并渲染在浏览器中。</p>
<h3 data-id="heading-13"><strong>总结对比：Flutter 与前端构建的差异</strong></h3>






























<table><thead><tr><th><strong>构建步骤</strong></th><th><strong>Flutter</strong></th><th><strong>前端（Vue/React）</strong></th></tr></thead><tbody><tr><td><strong>构建命令</strong></td><td><code>flutter build apk/ios/web</code></td><td><code>npm run build</code></td></tr><tr><td><strong>原生代码编译</strong></td><td>使用 AOT 编译 Dart 代码生成原生 APK/IPA</td><td>使用 Webpack/Vite 对 JS、CSS 进行编译和压缩</td></tr><tr><td><strong>依赖管理</strong></td><td><code>pubspec.yaml</code> 管理依赖，使用 <code>flutter pub get</code> 等命令</td><td><code>package.json</code> 管理依赖，使用 <code>npm install</code> 等命令</td></tr><tr><td><strong>输出文件</strong></td><td>输出 APK、IPA 或 Web 文件</td><td>输出静态文件（HTML、CSS、JS）</td></tr></tbody></table>
<ul>
<li><strong>构建工具</strong>：Flutter 的构建工具需要处理多个平台的构建（Android、iOS、Web），而前端框架的构建工具主要聚焦于 Web 构建（尽管有些框架支持静态网站生成等）。</li>
<li><strong>原生代码编译</strong>：Flutter 需要进行 AOT 编译，将 Dart 代码转化为原生代码，而前端框架主要依赖 JavaScript 打包和优化。</li>
<li><strong>依赖管理</strong>：Flutter 和前端项目都通过配置文件（<code>pubspec.yaml</code> 和 <code>package.json</code>）管理依赖，但 Flutter 还涉及到原生库和插件的集成，增加了依赖管理的复杂度。</li>
</ul>
<p>虽然 Flutter 和前端框架（如 Vue 和 React）在构建和依赖管理上有一些相似之处，但 Flutter 的构建流程涉及更多平台特定的操作，复杂度较高。</p>
<h2 data-id="heading-14">调试：Flutter 与前端框架的调试差异</h2>
<h4 data-id="heading-15"><strong>前端框架调试（Vue/React）</strong></h4>
<p>在前端框架中，调试流程非常简便，主要依赖浏览器的开发者工具和热重载功能。</p>
<ul>
<li><strong>浏览器调试</strong>：前端开发中的调试，绝大多数依赖浏览器的开发者工具（DevTools）。通过查看控制台日志、断点调试和网络请求分析，我们可以轻松地调试 Vue 和 React 应用。</li>
<li><strong>热重载</strong>：前端框架的热重载非常快捷，修改代码后，开发服务器会自动刷新页面，立即看到效果。</li>
</ul>
<h4 data-id="heading-16"><strong>Flutter 调试</strong></h4>
<p>Flutter 的调试方式更为复杂，主要依赖于 Android Studio 或 Visual Studio Code 中的插件支持。</p>
<ul>
<li><strong>Flutter DevTools</strong>：Flutter 提供了专门的 DevTools，支持调试 Dart 代码、查看性能、内存使用情况、UI 渲染等。通过 Flutter DevTools，我们可以深入了解应用的行为，特别是在性能和资源管理方面。</li>
<li><strong>热重载</strong>：Flutter 也有热重载功能，当修改代码时，Flutter 会迅速重新加载应用的界面，保持应用状态，避免重新启动应用。</li>
<li><strong>原生调试</strong>：在调试 Android 和 iOS 应用时，我们还需要使用 Android Studio 或 Xcode，查看原生代码和日志，调试更为繁琐。</li>
</ul>
<h5 data-id="heading-17"><strong>总结</strong>：</h5>
<ul>
<li><strong>调试工具</strong>：前端框架的调试通常依赖于浏览器开发者工具，而 Flutter 调试则需要借助专门的 DevTools 和原生开发工具（Android Studio、Xcode）。</li>
<li><strong>调试体验</strong>：前端开发的调试过程相对简洁，而 Flutter 的调试不仅涉及到 Dart 代码，还涉及到原生平台的调试，因此调试过程更为复杂。</li>
</ul>
<h2 data-id="heading-18">平台兼容性：Flutter 与前端框架的差异</h2>
<h4 data-id="heading-19"><strong>前端框架的跨平台兼容性</strong></h4>
<p>前端框架（如 Vue 和 React）主要运行在 Web 浏览器中，其跨平台的核心在于浏览器的支持。浏览器已经高度标准化，现代浏览器对 HTML、CSS 和 JavaScript 的支持非常广泛，确保了 Web 应用能够在不同操作系统和设备上运行。</p>
<ul>
<li><strong>兼容性</strong>：前端框架通过响应式设计、CSS 媒体查询和现代 JavaScript 的特性来适配不同的屏幕尺寸和设备。</li>
<li><strong>限制</strong>：尽管前端框架可以跨平台，但它们只能运行在支持现代浏览器的设备上，且性能可能受限于浏览器引擎。</li>
</ul>
<h4 data-id="heading-20"><strong>Flutter 的跨平台兼容性</strong></h4>
<p>Flutter 的跨平台兼容性比前端框架复杂得多，因为它不仅支持 Web 端，还支持 Android 和 iOS 等原生平台。</p>
<ul>
<li><strong>跨平台编译</strong>：Flutter 通过 Dart 代码与平台之间的桥接，提供一次开发，多平台运行的能力。Flutter 会将代码编译成每个平台的原生代码，因此可以获得原生应用的性能。</li>
<li><strong>平台适配</strong>：Flutter 提供了大量的 Material 和 Cupertino 组件来帮助适配不同平台的 UI 样式，但开发者仍然需要关注不同平台间的差异，尤其是在 Android 和 iOS 之间。</li>
<li><strong>Web 支持</strong>：Flutter Web 虽然在不断发展，但相比原生 Android/iOS，Web 的性能和兼容性仍然存在差距，尤其是在处理大量动画和复杂 UI 时，性能可能不如原生应用。</li>
</ul>
<h5 data-id="heading-21"><strong>总结</strong>：</h5>
<ul>
<li><strong>兼容性</strong>：前端框架主要在浏览器中运行，平台兼容性问题较少；而 Flutter 需要在多个平台上进行编译和适配，尤其是 Android 和 iOS 的差异需要额外关注。</li>
<li><strong>跨平台实现</strong>：前端框架通过浏览器实现跨平台，而 Flutter 通过编译为原生代码实现跨平台，性能上可能优于纯 Web 应用，但开发成本和复杂度也较高。
是的，<strong>签名</strong>（尤其是在移动应用开发中）确实和传统前端开发有很大的不同，特别是在 Flutter 中，涉及到 <strong>Android</strong> 和 <strong>iOS</strong> 应用的 <strong>签名</strong> 配置。</li>
</ul>
<h2 data-id="heading-22">签名</h2>
<p>在传统的 <strong>前端开发</strong> 中，通常并不需要考虑签名问题，前端项目的发布主要是生成静态文件（如 HTML、CSS、JavaScript）并部署到服务器上，这个过程通常不涉及到身份认证、签名等操作。签名在前端更多地出现在 API 调用的身份验证中，比如使用 JWT（Json Web Token）进行请求授权。</p>
<p>而在 <strong>Flutter</strong> 中，特别是涉及 <strong>Android</strong> 和 <strong>iOS</strong> 原生应用的构建时，<strong>签名</strong> 是必须要处理的步骤之一。签名的主要作用是确保应用的安全性，防止应用被恶意篡改，并保证应用发布的身份可信。</p>
<h3 data-id="heading-23"><strong>1. Android 签名</strong></h3>
<p>对于 <strong>Android</strong> 应用，签名是发布应用到 <strong>Google Play Store</strong> 或直接安装到设备的必要步骤。签名确保了 APK 文件的完整性和安全性。</p>
<ul>
<li><strong>debug.keystore</strong>：Flutter 项目默认提供了一个 <strong>debug</strong> 签名（<code>debug.keystore</code>），用于开发过程中调试应用。</li>
<li><strong>release.keystore</strong>：发布应用时，必须使用发布版的 <strong>release.keystore</strong> 进行签名。这是一个包含私钥的文件，只有正确的私钥才能签署 APK 文件，使其能够被安装和分发。</li>
</ul>
<p>签名配置通常在 <strong>Android</strong> 项目的 <code>build.gradle</code> 文件中进行设置。例如：</p>
<pre><code class="hljs language-js" lang="js">android {
    signingConfigs {
        release {
            storeFile <span class="hljs-title function_">file</span>(<span class="hljs-string">'path_to_your_keystore_file/release.keystore'</span>)
            storePassword <span class="hljs-string">'your_keystore_password'</span>
            keyAlias <span class="hljs-string">'your_key_alias'</span>
            keyPassword <span class="hljs-string">'your_key_password'</span>
        }
    }

    buildTypes {
        release {
            signingConfig signingConfigs.<span class="hljs-property">release</span>
        }
    }
}
</code></pre>
<p>通过上述配置，Flutter 会在构建发布版 APK 时自动使用配置中的签名信息。</p>
<h3 data-id="heading-24"><strong>2. iOS 签名</strong></h3>
<p>在 <strong>iOS</strong> 平台上，签名过程更加严格，所有的 iOS 应用都必须通过 <strong>Apple</strong> 的签名机制进行签名，否则无法安装到设备上，且不能在 <strong>App Store</strong> 上发布。</p>
<p><strong>iOS 签名流程</strong>：</p>
<ul>
<li><strong>开发者证书</strong>：需要通过 <strong>Apple Developer Program</strong> 注册并获取一个开发者证书。</li>
<li><strong>Provisioning Profile</strong>：为应用创建一个有效的 Provisioning Profile，关联应用标识符、设备和证书。</li>
<li><strong>Xcode 配置</strong>：在 <strong>Xcode</strong> 中配置签名信息，确保应用使用正确的证书和 Profile。</li>
</ul>
<p>在 <strong>Flutter</strong> 中，构建 <strong>iOS</strong> 应用时，你需要配置好证书、签名文件（如 <code>*.p12</code>）和 <strong>Provisioning Profile</strong>。签名设置通常通过 <strong>Xcode</strong> 来完成。配置文件在 <strong>Flutter</strong> 项目中 <code>ios/Runner.xcodeproj</code> 下进行处理。</p>
<h3 data-id="heading-25"><strong>3. 签名与前端开发的不同</strong></h3>
<h4 data-id="heading-26"><strong>前端开发：</strong></h4>
<p>在前端项目中，<strong>签名</strong> 不涉及应用的发布和安装过程。前端应用的发布通常是将文件上传到服务器（如 <strong>Netlify</strong>、<strong>Vercel</strong> 或传统服务器），并通过 <strong>HTTPS</strong> 安全传输。前端的“签名”更多是在 <strong>API</strong> 调用中使用 <strong>OAuth</strong> 或 <strong>JWT</strong> 等令牌进行身份认证和授权。</p>
<h4 data-id="heading-27"><strong>Flutter 开发：</strong></h4>
<p>在 <strong>Flutter</strong> 中，尤其是发布 <strong>Android</strong> 和 <strong>iOS</strong> 应用时，签名是必须处理的步骤。它涉及：</p>
<ul>
<li><strong>生成签名文件</strong>（如 <code>debug.keystore</code> 或 <code>release.keystore</code>，以及 iOS 的开发者证书）。</li>
<li><strong>配置签名文件</strong>，确保只有合法的密钥才能对应用进行签名和发布。</li>
<li><strong>签名的验证</strong>：签名文件确保应用的完整性，防止恶意篡改和伪造，尤其是对于 Android 和 iOS 平台，只有经过签名的 APK 或 IPA 文件才能在设备上安装。</li>
</ul>
<p><strong>签名</strong> 是 Flutter 开发中与传统前端开发最显著的差异之一。在 <strong>前端开发</strong> 中，签名通常出现在 <strong>API 认证</strong> 上，而在 <strong>Flutter</strong> 中，签名更重要的是涉及到 <strong>应用的发布与分发</strong>，特别是对于 <strong>Android</strong> 和 <strong>iOS</strong> 应用。</p>
<p>理解这些签名机制及其配置方式，对从传统前端转向 <strong>Flutter</strong> 开发的开发者至关重要。</p>
<h2 data-id="heading-28">Flutter 开发中的核心术语</h2>
<ul>
<li>
<p><strong>Dart</strong>：Flutter 使用的编程语言，面向对象，支持并发和异步操作，专为客户端开发设计。</p>
</li>
<li>
<p><strong>Kotlin</strong>：用于 <strong>Android</strong> 开发的现代编程语言，Flutter 与原生 <strong>Android</strong> 交互时常用。</p>
</li>
<li>
<p><strong>AOT 编译（Ahead-of-Time 编译）</strong> ：在构建时将 <strong>Dart</strong> 代码编译为原生机器码，提升应用启动速度和运行性能。</p>
</li>
<li>
<p><strong>JIT 编译（Just-in-Time 编译）</strong> ：运行时动态编译代码，支持开发模式下的热重载。</p>
</li>
<li>
<p><strong>Flutter Engine</strong>：Flutter 的底层渲染引擎，负责 UI 渲染、事件处理、平台交互等核心功能。</p>
</li>
<li>
<p><strong>Flutter SDK</strong>：开发者使用的工具包，包含 <strong>Flutter Engine</strong>、Dart SDK 和构建工具，支持跨平台开发。</p>
</li>
<li>
<p><strong>Flutter DevTools</strong>：Flutter 提供的调试工具，帮助开发者分析性能、内存使用、UI 渲染等。</p>
</li>
<li>
<p><strong>Hot Reload</strong>：Flutter 的开发模式功能，修改代码后无需重启应用即可即时更新 UI，保持应用状态。</p>
</li>
<li>
<p><strong>Hot Restart</strong>：完全重新启动应用并丢失当前状态，适用于需要清除应用状态的场景。</p>
</li>
<li>
<p><strong>Platform Channels</strong>：Flutter 与原生平台（Android/iOS）交互的通信机制，支持双向数据传递。</p>
</li>
<li>
<p><strong>pubspec.yaml</strong>：Flutter 项目的配置文件，类似于前端的 <code>package.json</code>，用于管理依赖、资源等。管理 <strong>Dart 包</strong> 和 <strong>Flutter 插件</strong>，其中插件允许与 <strong>Android</strong> 和 <strong>iOS</strong> 的原生代码进行集成。</p>
</li>
<li>
<p><strong>Widget</strong>：Flutter 中的基本 UI 组件，所有的 UI 元素（如按钮、文本、布局等）都是通过 <strong>Widget</strong> 构建的。</p>
</li>
<li>
<p><strong>Flutter Build System</strong>：Flutter 用于构建应用的工具系统，支持生成 APK、IPA 或 Web 应用。</p>
</li>
<li>
<p><strong>Dart VM</strong>：Dart 的虚拟机，执行运行时的 <strong>Dart</strong> 代码，支持 JIT 编译和调试功能。</p>
</li>
<li>
<p><strong>fastlane</strong>：一个自动化构建和发布工具，广泛用于 <strong>iOS</strong> 和 <strong>Android</strong> 应用的构建、测试、发布和提交流程，简化了 CI/CD 流程。</p>
</li>
<li>
<p><strong>Flutter Plugin</strong>：一种 Flutter 插件，用于扩展 Flutter 的功能，通过与原生平台的代码进行交互，提供相机、定位、传感器等设备功能。</p>
</li>
<li>
<p><strong>Gradle</strong>：一个强大的构建自动化工具，Flutter 使用 <strong>Gradle</strong> 来构建 <strong>Android</strong> 应用，负责依赖管理、编译、打包等任务。</p>
</li>
<li>
<p><strong>Xcode</strong>：苹果公司开发的集成开发环境（IDE），用于开发 <strong>iOS</strong> 和 <strong>macOS</strong> 应用，Flutter 用来构建和部署 <strong>iOS</strong> 应用。</p>
</li>
<li>
<p><strong>Android Studio</strong>：Google 提供的官方 IDE，用于开发 <strong>Android</strong> 应用。</p>
</li>
<li>
<p><strong>DartPad</strong>：一个在线 Dart 代码编辑器，允许开发者在浏览器中快速编写和测试 <strong>Dart</strong> 代码，适合初学者和快速原型开发。</p>
</li>
<li>
<p><strong>App Bundle</strong>：一种 <strong>Android</strong> 应用的发布格式（<code>.aab</code> 文件），比 APK 文件更小，支持更高效的 APK 打包和分发。</p>
</li>
<li>
<p><strong>Flutter Channels</strong>：用于选择不同的开发版本，如 <strong>stable</strong>、<strong>beta</strong>、<strong>dev</strong> 和 <strong>master</strong>，以便根据不同渠道，选择稳定版或试验版。</p>
</li>
<li>
<p><strong>FlutterTest</strong>：Flutter 提供的单元测试框架，用于编写和运行 Dart 代码和 Flutter 应用的单元测试，确保代码质量和功能正确。</p>
</li>
<li>
<p><strong>Flutter Driver</strong> 允许开发者模拟用户与应用的交互，验证 UI 和用户体验方面的功能。</p>
</li>
<li>
<p><strong>Dart DevTools</strong>：Flutter 的调试工具，帮助开发者监控应用性能，分析内存和 CPU 使用情况，查看 UI 渲染和调试信息。</p>
</li>
<li>
<p><strong>CI/CD</strong>（Continuous Integration/Continuous Delivery）：持续集成和持续交付，是开发流程的一部分，旨在自动化代码构建、测试和发布的过程，<strong>Flutter</strong> 可以与工具如 <strong>Jenkins</strong>、<strong>GitLab CI</strong>、<strong>Bitrise</strong> 等集成实现自动化。</p>
</li>
<li>
<p><strong>Widget Tree</strong>：Flutter 中的 UI 组件是通过 <strong>Widget</strong> 组成的树形结构，称为 <strong>Widget Tree</strong>，通过树形结构管理视图层次关系。</p>
</li>
<li>
<p><strong>Skia</strong>：Flutter 使用的高性能渲染引擎，负责将 UI 绘制到屏幕上，确保 Flutter 应用能够在多个平台上渲染一致的 UI。</p>
</li>
<li>
<p><strong>Dart FFI</strong>（Foreign Function Interface）：Dart 提供的接口，使 Dart 代码能够与其他语言（如 <strong>C</strong>、<strong>C++</strong> ）编写的库进行交互，通常用于性能优化或访问低级平台功能。</p>
</li>
<li>
<p><strong>Hotfix</strong>：Flutter 支持在应用运行时热修复，即无需重新编译和发布，直接对应用进行快速修复，适用于修复小的 bug 或问题。</p>
</li>
</ul>
<h2 data-id="heading-29">结论：从前端到 Flutter，最需要调整的是思维</h2>
<ul>
<li><strong>构建差异</strong>：Flutter 需要涉及原生平台的构建和编译，而前端框架只关注浏览器端的构建。</li>
<li><strong>调试差异</strong>：前端开发依赖浏览器的开发者工具，Flutter 调试涉及 Dart 代码和原生代码的调试工具。</li>
<li><strong>平台兼容性</strong>：前端框架通过 Web 浏览器实现跨平台，而 Flutter 则通过原生代码实现跨平台，支持更多的原生功能，但也带来了更高的开发复杂度。</li>
</ul>
<p>对于从纯前端转向 Flutter 开发，最大的挑战是从浏览器端的简单构建转向涉及原生开发的构建流程，同时需要适应更多的原生平台差异。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🔥从"打补丁"到"换思路"：一次企业级 AI Agent 的架构拐点]]></title>    <link>https://juejin.cn/post/7605145921618362420</link>    <guid>https://juejin.cn/post/7605145921618362420</guid>    <pubDate>2026-02-11T09:36:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605145921618362420" data-draft-id="7605114266023968819" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🔥从&quot;打补丁&quot;到&quot;换思路&quot;：一次企业级 AI Agent 的架构拐点"/> <meta itemprop="keywords" content="Agent,前端,面试"/> <meta itemprop="datePublished" content="2026-02-11T09:36:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Sailing"/> <meta itemprop="url" content="https://juejin.cn/user/307518988100237"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🔥从"打补丁"到"换思路"：一次企业级 AI Agent 的架构拐点
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/307518988100237/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Sailing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:36:44.000Z" title="Wed Feb 11 2026 09:36:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在做企业级 AI Agent 时，我踩过一个非常典型的坑。</p>
<p>一开始我以为只是个“小逻辑问题”。后来我发现，那是一次<strong>架构认知的分水岭</strong>。</p>
<p>这篇文章，讲的不是“消息补全”。讲的是一个更重要的问题：</p>
<blockquote>
<p>当规则开始打补丁时，你是不是已经选错了工具？</p>
</blockquote>
<div align="center">
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e63cb79f09a43df977a5c4aa646456e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2FpbGluZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771407403&amp;x-signature=H6D3Oc6P5ekWOaJvhFtXRLDWbuU%3D" width="100%" loading="lazy"/>
</div>
<h2 data-id="heading-0">问题很简单：AI 听不懂 “...这个呢”</h2>
<p>我们在做一个企业内部智能运维助手 LUI Agent。能力很清晰：</p>
<ul>
<li>查询域名状态</li>
<li>查询 Pod 数</li>
<li>搜索内部文档</li>
<li>......</li>
</ul>
<p>在实现多轮对话时，出现了一个极其常见的问题：</p>
<pre><code class="hljs language-text" lang="text">用户：查询域名 bbb.com 的状态
AI：该域名 QPS 为 120，P99 为 45ms...

用户：yyy.com 这个呢
AI：？？？
</code></pre>
<p>第二句话——</p>
<blockquote>
<p>“yyy.com 这个呢”</p>
</blockquote>
<p>从人类视角看，毫无歧义。<br/>
但从工具调用视角看，这是一个<strong>不完整的句子</strong>。</p>
<p>下游网关服务根本不知道用户要干什么。</p>
<p>所以我们需要一个能力：</p>
<blockquote>
<p>在调用工具前，把“不完整的问题”补全为完整问题。</p>
</blockquote>
<h2 data-id="heading-1">第一反应：规则一定能搞定（踩坑之路）</h2>
<p>作为一个开发者，我的第一反应非常自然：这不就是模式匹配吗？</p>
<p>于是写了第一版规则:</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">private</span> <span class="hljs-title function_">isIncompleteMessage</span>(<span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">const</span> trimmed = message.<span class="hljs-title function_">trim</span>();

  <span class="hljs-keyword">if</span> (trimmed.<span class="hljs-property">length</span> &lt; <span class="hljs-number">8</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/呢[？?]?$/</span>.<span class="hljs-title function_">test</span>(trimmed)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/吗[？?]?$/</span>.<span class="hljs-title function_">test</span>(trimmed)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^(这个|那个|这|那)/</span>.<span class="hljs-title function_">test</span>(trimmed)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;

  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<p>看起来很优雅：</p>
<ul>
<li>短消息？拦截。</li>
<li>追问句式？拦截。</li>
<li>指代开头？拦截。</li>
</ul>
<p>覆盖三大类问题。我当时甚至觉得设计得挺漂亮。</p>
<div align="center">
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/221389664956484d94725b1b37b2f4dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2FpbGluZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771407403&amp;x-signature=mlwfXs9hd2e82K%2BN2zd%2FxfdyN5s%3D" width="45%" loading="lazy"/>
</div>
<h2 data-id="heading-2">然后，规则开始失控</h2>
<p>测试几轮后，问题很快暴露：</p>
<h3 data-id="heading-3">Case 1</h3>
<pre><code class="hljs">yyy.com这个呢
</code></pre>
<p>长度 19,不符合 <code>&lt; 8</code>。</p>
<p>规则顺序导致被判定为“完整问题”。</p>
<p>我开始加补丁。</p>
<h3 data-id="heading-4">Case 2</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">b</span><span class="hljs-selector-class">.com</span>也查一下
</code></pre>
<p>好，加一个“也 + 动词”规则。</p>
<h3 data-id="heading-5">Case 3</h3>
<pre><code class="hljs">yyy.com呢
</code></pre>
<p>好，再扩展域名 + 呢。</p>
<h3 data-id="heading-6">Case 4</h3>
<pre><code class="hljs">这个应用有几个pod
</code></pre>
<p>以“这个”开头，但其实是完整问题。误判。</p>
<h3 data-id="heading-7">Case 5</h3>
<pre><code class="hljs">这个功能很好用
</code></pre>
<p>被误判为“不完整问题”。假阳性。</p>
<hr/>
<p>那一刻我突然意识到：</p>
<blockquote>
<p>我已经开始写“例外规则”了。</p>
</blockquote>
<p>而当你开始写例外规则的时候，你已经失去了规则系统的简洁性。</p>
<p>规则不再是“设计”，它开始变成“修修补补”。（越来越不好维护！）</p>
<div align="center">
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/981451833f854abfac1026d7fc9ded26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2FpbGluZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771407403&amp;x-signature=oAmvr6AercCRw4%2BQo3BbRRKrXK4%3D" width="40%" loading="lazy"/>
</div>
<h2 data-id="heading-8">真正的问题：这不是字符串问题</h2>
<p>我突然意识到一个更本质的问题：我在用规则解决一个语义问题。</p>
<ol>
<li>“这个呢” 不是句法问题，是指代问题。</li>
<li>不是字符串匹配问题，是上下文理解问题。</li>
</ol>
<p>这本质上是一个<strong>语义理解任务</strong>。而我在用规则解决语义，这就像用 if/else 写一个自然语言理解系统，注定会崩。</p>
<p>相反，正是 LLM 天生擅长的领域。</p>
<h2 data-id="heading-9">意图识别</h2>
<h3 data-id="heading-10">换思路：让 LLM 做意图补全</h3>
<p>我加了一层“消息预处理”。在真正调用 agent 工具前，让 LLM 判断：</p>
<ul>
<li>当前问题是否完整？</li>
<li>是否是追问？</li>
<li>是否需要结合历史补全？</li>
</ul>
<p>核心逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * 预处理消息：使用 LLM 判断并补全不完整的问题
 */</span>
private <span class="hljs-keyword">async</span> <span class="hljs-title function_">preprocessMessage</span>(
  <span class="hljs-attr">message</span>: string, 
  <span class="hljs-attr">history</span>: <span class="hljs-title class_">BaseMessage</span>[], 
  <span class="hljs-attr">agentId</span>: string, 
  requestId?: string
): <span class="hljs-title class_">Promise</span>&lt;string&gt; {
  <span class="hljs-comment">// 没有历史对话，无需补全</span>
  <span class="hljs-keyword">if</span> (history.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> message;
  }
  
  <span class="hljs-keyword">const</span> llm = <span class="hljs-title function_">getLLM</span>();
  
  <span class="hljs-comment">// 取最近的对话历史</span>
  <span class="hljs-keyword">const</span> recentHistory = history.<span class="hljs-title function_">slice</span>(-<span class="hljs-number">6</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">msg</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> role = msg <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">HumanMessage</span> ? <span class="hljs-string">'用户'</span> : <span class="hljs-string">'助手'</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${role}</span>: <span class="hljs-subst">${<span class="hljs-built_in">String</span>(msg.content).substring(<span class="hljs-number">0</span>, <span class="hljs-number">200</span>)}</span>`</span>;
  }).<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>);
  
  <span class="hljs-keyword">const</span> prompt = <span class="hljs-string">`你是一个意图分析助手。判断用户当前输入是否需要根据对话历史补全。

## 对话历史
<span class="hljs-subst">${recentHistory}</span>

## 用户当前输入
<span class="hljs-subst">${message}</span>

## 任务
1. 判断当前输入是否是一个完整、独立的问题
2. 如果是完整问题，直接返回原文
3. 如果是追问、指代、省略句式（如"这个呢"、"xxx也查一下"、"状态如何"），结合历史补全为完整问题

## 输出
只返回最终的问题（补全后或原文），不要任何解释。`</span>;

  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> llm.<span class="hljs-title function_">invoke</span>(prompt);
  <span class="hljs-keyword">const</span> completed = <span class="hljs-keyword">typeof</span> response.<span class="hljs-property">content</span> === <span class="hljs-string">'string'</span> 
    ? response.<span class="hljs-property">content</span>.<span class="hljs-title function_">trim</span>() 
    : message;
  
  <span class="hljs-comment">// 记录是否进行了补全</span>
  <span class="hljs-keyword">if</span> (completed !== message) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'消息已补全'</span>, { <span class="hljs-attr">original</span>: message, completed });
  }
  
  <span class="hljs-keyword">return</span> completed || message;
}
</code></pre>
<p>核心 Prompt 起了很大作用：</p>
<pre><code class="hljs language-md" lang="md">你是一个意图分析助手。判断用户当前输入是否需要根据对话历史补全。

<span class="hljs-section">## 任务</span>
<span class="hljs-bullet">1.</span> 判断当前输入是否是一个完整、独立的问题
<span class="hljs-bullet">2.</span> 如果是完整问题，直接返回原文
<span class="hljs-bullet">3.</span> 如果是追问、指代、省略句式（如"这个呢"、"xxx也查一下"、"状态如何"），结合历史补全为完整问题
</code></pre>
<h3 data-id="heading-11">效果对比：规则 vs 语义</h3>
<p>对话历史：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">用户: 查询域名 xxx.com 的状态</span>
<span class="hljs-section">助手: 该域名 QPS 为 120，响应时间 P99 为 45ms...</span>

<span class="hljs-section">用户输入: yyy.com这个呢</span>
LLM 补全: 查询域名 yyy.com 的状态 ✅
</code></pre>
<p>对话历史：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">用户: 这个应用有几个pod</span>
<span class="hljs-section">助手: 当前应用 yyy.com 有 3 个 Pod...</span>

<span class="hljs-section">用户输入: 这个应用呢（切换了应用）</span>
LLM 补全: 这个应用有几个pod ✅
</code></pre>
<p>对话历史：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">用户: 查询 xxx.com 的 QPS</span>
<span class="hljs-section">助手: xxx.com 的 QPS 为 50...</span>

<span class="hljs-section">用户输入: yyy.com 也查一下</span>
LLM 补全: 查询 yyy.com 的 QPS ✅
</code></pre>
<p>完美！LLM 能够理解语义，自动处理各种追问句式。</p>
<ul>
<li>没有新增规则。</li>
<li>没有顺序依赖。</li>
<li>没有边界爆炸。</li>
</ul>
<p>它理解了语义。</p>
<h3 data-id="heading-12">但 LLM 不是银弹</h3>
<p>LLM 问题也随之而来：</p>
<ul>
<li>延迟增加 500ms ~ 1s。</li>
<li>Token 成本增加。</li>
<li>输出不可 100% 可控。</li>
</ul>
<p>所以，我没有“全盘 LLM 化”。而是做了一个分层架构。</p>
<div align="center">
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/85f96f9266af4be89eaaff162757646a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2FpbGluZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771407403&amp;x-signature=5TGmlGnOLIEJZbuicbKEavy2YfY%3D" width="60%" loading="lazy"/>
</div>
<h2 data-id="heading-13">混合架构：规则前置，LLM兜底</h2>
<p>在实际项目中，采用了"规则快速拦截 + LLM 深度分析"的混合策略：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 意图分析流程</span>
<span class="hljs-keyword">async</span> <span class="hljs-title function_">analyzeIntent</span>(<span class="hljs-params">message: string, history: BaseMessage[]</span>) {
  <span class="hljs-comment">// 1. 规则快速拦截（&lt; 1ms）</span>
  <span class="hljs-keyword">const</span> quickResult = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">quickIntercept</span>(message);
  <span class="hljs-keyword">if</span> (quickResult.<span class="hljs-property">confident</span>) {
    <span class="hljs-keyword">return</span> quickResult;
  }
  
  <span class="hljs-comment">// 2. LLM 深度分析（500ms - 3s）</span>
  <span class="hljs-keyword">const</span> llmResult = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">llmAnalyze</span>(message, history);
  <span class="hljs-keyword">return</span> llmResult;
}

<span class="hljs-comment">// 规则快速拦截</span>
private <span class="hljs-title function_">quickIntercept</span>(<span class="hljs-params">message: string</span>) {
  <span class="hljs-comment">// 问候语</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^(你好|hi|hello|嗨)/i</span>.<span class="hljs-title function_">test</span>(message)) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">agentId</span>: <span class="hljs-string">'general'</span>, <span class="hljs-attr">confident</span>: <span class="hljs-literal">true</span> };
  }
  <span class="hljs-comment">// 身份询问</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/你是谁|你叫什么/</span>.<span class="hljs-title function_">test</span>(message)) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">agentId</span>: <span class="hljs-string">'general'</span>, <span class="hljs-attr">confident</span>: <span class="hljs-literal">true</span> };
  }
  <span class="hljs-comment">// 导航意图（明确的跳转词）</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^(跳转|打开|进入|去)(到)?/</span>.<span class="hljs-title function_">test</span>(message)) {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">agentId</span>: <span class="hljs-string">'navigation'</span>, <span class="hljs-attr">confident</span>: <span class="hljs-literal">true</span> };
  }
  <span class="hljs-comment">// 不确定，交给 LLM</span>
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">confident</span>: <span class="hljs-literal">false</span> };
}
</code></pre>
<h3 data-id="heading-14">规则适合：</h3>
<ul>
<li>问候语（例如：你好、你是）</li>
<li>明确跳转（例如：打开**、跳转**）</li>
<li>格式校验</li>
<li>固定关键词</li>
</ul>
<h3 data-id="heading-15">LLM 适合：</h3>
<ul>
<li>指代</li>
<li>追问</li>
<li>模糊表达</li>
<li>语义补全</li>
</ul>
<p>规则保证速度，LLM 保证理解。<strong>这才是企业级 Agent 的现实架构。</strong></p>
<h2 data-id="heading-16">更隐蔽的一次教训：历史丢失</h2>
<p>后来，我还踩了一个更隐蔽的坑。</p>
<p>日志显示：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable constant_">API</span> <span class="hljs-attr">historyLength</span>: <span class="hljs-number">10</span>
<span class="hljs-title class_">MasterAgent</span> <span class="hljs-attr">historyLength</span>: <span class="hljs-number">6</span>
</code></pre>
<p>丢了 4 条。原因：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-literal">undefined</span>) <span class="hljs-comment">// -&gt; undefined</span>
</code></pre>
<p>某些结构化消息没有 content 字段，被我写的代码逻辑给过滤掉了。</p>
<p><strong>修复方式：</strong> 直接 stringify 化</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getMessageContent</span>(<span class="hljs-params">msg</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> msg.<span class="hljs-property">content</span> === <span class="hljs-string">'string'</span>) <span class="hljs-keyword">return</span> msg.<span class="hljs-property">content</span>;

  <span class="hljs-keyword">const</span> { role, timestamp, ...rest } = msg;
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(rest);
}
</code></pre>
<p><strong>让 LLM 自己理解结构化数据</strong>。</p>
<p>这件事让我学到一个重要认知：</p>
<blockquote>
<p>不要低估 LLM 对结构化信息的理解能力。<br/>
信息别丢，比格式完美更重要。</p>
</blockquote>
<h2 data-id="heading-17">总结</h2>
<p>这不是一个“补全功能优化”的故事，这是一个架构边界判断问题：</p>
<ul>
<li>规则系统适合确定性边界</li>
<li>语义系统适合模糊边界</li>
</ul>
<p>当你发现：</p>
<ul>
<li>规则在不断打补丁</li>
<li>误判越来越多</li>
<li>例外规则越来越复杂</li>
</ul>
<p>那很可能 —— <strong>你在用规则解决语义问题</strong>。</p>
<p>很多人做 Agent，沉迷 Prompt。但真正重要的不是 Prompt 写多长。而是学会判断：</p>
<blockquote>
<p>什么时候该用规则；<br/>
什么时候该交给语义（LLM 意图识别）。</p>
</blockquote>
<p>如果你也在做 Agent，你现在的系统，是规则在膨胀？还是语义在进化？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccb41d45c44842c28dc48967f9b71cef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2FpbGluZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771407403&amp;x-signature=TAvkg%2FXN2BNh4fwnqmCR6Nls4SY%3D" alt="WX20230928-110017@2x.png" loading="lazy"/></p>
<p><strong>note：</strong> 我最近一直在做 <strong>前端转全栈</strong>、<strong>前端转 AI Agent</strong> 开发方向的工作，后续我会持续分享这两方面的文章。欢迎大家随时来交流～～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[先建“语义基座”，再谈运维智能！阿里云以 Operation Intelligence 定义 AIOps 新范式]]></title>    <link>https://juejin.cn/post/7605150769009492011</link>    <guid>https://juejin.cn/post/7605150769009492011</guid>    <pubDate>2026-02-11T09:46:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605150769009492011" data-draft-id="7605140481488977961" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="先建“语义基座”，再谈运维智能！阿里云以 Operation Intelligence 定义 AIOps 新范式"/> <meta itemprop="keywords" content="云原生"/> <meta itemprop="datePublished" content="2026-02-11T09:46:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            先建“语义基座”，再谈运维智能！阿里云以 Operation Intelligence 定义 AIOps 新范式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:46:34.000Z" title="Wed Feb 11 2026 09:46:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作者：鸢玮</p>
<p>大模型的出现，给许多行业带来了颠覆性的改变，运维这个向来被视为稳定、保守的领域也不例外。虽然“AIOps”这个概念早在 2016 年由 Gartner 提出，但早期的智能运维更多是利用大数据和机器学习对传统运维流程进行效率上的提升。十年后的今天，大模型的强大能力，正推动着 AIOps 从辅助工具，演进为数智化转型中不可或缺的核心基础设施，让运维真正迈入智能化的深水区。</p>
<p><strong>阿里云云原生应用平台事业部总经理、资深技术专家周琦</strong>作为这一变革的深度参与者，对 AIOps 的本质有着深刻洞察。“AIOps 这个词已经被广泛使用，但我更倾向于用 Operation Intelligence 来定义它。”周琦在采访中强调，“它的核心是发现与沉淀运维操作中的智慧，让工程师从重复繁琐的劳动中解放出来，聚焦于更高价值的创造。”</p>
<h2 data-id="heading-0">十年演进，重塑 AIOps 底层逻辑</h2>
<p>在传统的运维时代，更多依赖人工被动处理故障，效率低下；而后进入到自动化运维时代，借助工具实现任务自动化，缩短了故障恢复时间；到了小模型运维时代，通过机器学习实现异常检测与根因分析，运维也初步具备智能化特征；如今进入到大模型时代，运维才真正开始走向真正的智能化。</p>
<p>回顾 AIOps 过去十年的发展，周琦认为有两个关键转折点重塑了其底层逻辑。<strong>第一个转折点是通用大模型的到来。</strong> 在此之前，所谓的智能运维更多是通过垂类 AI 模型来解决告警治理、异常检测等单一、点状的问题。这种方式虽然有用，但难以规模化。大模型的通用特性，像是一个巨大的杠杆，将 AIOps 的能力从“点状解决”扩展到“面状全域覆盖”，凭借其强大的泛化能力可以应对千变万化的碎片化运维任务。</p>
<p><strong>第二个转折点则在于数据整合技术的突破。</strong> 过去，运维工作呈现高度碎片化特征，数据和引擎往往由不同供应商提供，形成了天然的数据孤岛。周琦表示，想要建设统一的 AIOps 体系，首先就要跨过这道鸿沟。如今，存储、计算与分析技术的进步，实现了异构数据的关联与串联，将分散在各个系统中的数据整合在一起，为全域智能运维奠定了坚实基础。</p>
<p>技术的演进也推动了企业对 AIOps 认知的转变。周琦观察到，早期，企业引入 AIOps 的核心诉求只是保障系统的稳定性，关注的焦点集中在故障修复、告警处理等基础功能方面。但现在，企业的需求维度大大拓宽了，安全性、可扩展性、延时、用户体验等这些过去容易被忽略的“隐性成本”，正受到前所未有的关注。这种认知的升级带来需求的延伸，AIOps 不再仅是运维工程师的工具，还需要满足企业管理者对系统成熟度、跨模块依赖关系等深层因素的考量，真正覆盖多角色、多维度的运营需求。<strong>真正的 AIOps，不是让人去适应工具，而是让工具主动理解人、服务人、成就人。</strong></p>
<h2 data-id="heading-1">能力跃迁，让系统“能感知、会思考、可行动”</h2>
<p>大模型时代的到来，让 AIOps 具备了前所未有的智能化能力。那么，大模型究竟为运维领域带来了哪些质变？周琦用一个生动的比喻来解释，给 AI 装上“摄像头”。传统运维在很大程度上依赖于工程师的个体经验，一位经验丰富的老师傅心中通常有一张无形的系统拓扑图，知道哪里容易出问题、该如何分析。但这种宝贵的经验附着于个体，难以沉淀、复制和规模化。大模型的出现，结合阿里云构建的实时数据采集与分析引擎，相当于为 AI 赋予了感知能力，使其能够真正能“看懂”系统、“理解”故障、“思考”方案。</p>
<p>这带来了运维能力的根本性跃迁。机器不再是机械地匹配预设规则、触发阈值告警，而是开始能够“读懂”告警信息背后的语义，“理解”系统当前真实的运行状态，甚至能“归纳”历史故障的复杂模式，并主动生成可供执行的修复建议。为此，<strong>阿里云提出 Operation Intelligence 理念</strong>，把人的经验变成系统的智慧，把个体的直觉转化为组织的资产，让系统具备“类人决策”能力，周琦将阿里云践行的 Operation Intelligence 理念概括为三个层面的能力进化。</p>
<ul>
<li><strong>在感知层面</strong>，目标是突破传统监控中常见的“数据孤岛”，构建从终端设备到业务流程的全链路感知网络。</li>
<li><strong>在认知层面</strong>，关键在于融合大模型的通用理解能力与专用领域算法，将海量、原始的观测数据转化为可解释、可推理的系统关系图谱。</li>
<li>最终，<strong>在行动层面</strong>，通过模型与算法的协同驱动，实现自动化的处置闭环，推动运维从“人工救火”向“系统自愈”转变，通过高效的人机协同大幅提升整体运营效能。</li>
</ul>
<p>当然，大模型并非万能，针对大模型“幻觉”问题，阿里云设计了一套双重保障机制。周琦介绍说，在技术层面，通过强化多源数据的交叉验证，将数据采集、清洗、预处理等基础但繁重的工作交由传统工具完成，让大模型聚焦在最核心的推理环节，从源头减少幻觉产生的可能性。在应用层面，系统支持企业外挂自身的私有知识库，利用行业或企业特有的领域知识来补充和修正通用大模型可能存在的认知盲区，确保建议的准确性与合规性。</p>
<h2 data-id="heading-2">构建智能运维新范式，解放人力聚焦高价值</h2>
<p>理想与现实之间总是存在挑战。周琦坦言，阿里云在自身的大规模实践中深刻体会到两大核心难题。其一是数据层面的挑战，包括异构系统形成的数据孤岛、数据洪流带来的存储与算力压力。其二是认知层面的挑战，不同团队、不同系统之间存在的“语义鸿沟”，以及对系统拓扑、故障根因逻辑链的理解不一致问题。</p>
<p>为了系统性地解决这些问题，<strong>阿里云将内部的实践经验产品化，形成了一套帮助企业在大模型时代构建智能运维新范式，并且在可观测产品中落地。</strong></p>
<p>这套架构分为三层，底层是以<strong>日志服务 SLS</strong> 为核心引擎构建的统一可观测数据平台，实现日志、指标、链路、事件等多类型数据的统一接入与存储。该引擎具备 EB 级存储规模和秒级千亿行查询能力，能轻松应对每天数百 PB 数据，在保障数据完整性的同时，综合成本较自建方案降低 50% 以上。更重要的是，它支持全栈、实时、无侵入的数据接入，覆盖从移动端到基础设施的 200 多种组件，让企业无需重构现有系统即可完成数据整合。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b4f8f40c5d24957a6bed5a4c053d657~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771407994&amp;x-signature=ENYmfx9XmrCN%2FpMxITFKECxtALs%3D" alt="图片" loading="lazy"/></p>
<p>中层通过 <strong>UModel 统一模型</strong>构建 IT 系统的 “数字孪生”，这是阿里云可观测性产品的核心建模框架。UModel 基于本体论，提供了一套观测实体及实体关系的定义，覆盖从用户体验、应用服务、容器到底层基础设施的每一层表征。UModel 就像给整个 IT 系统建立一套通用语言词典，让应用、容器、网络等不同组件能用同一套语义对话，彻底告别“你说你的指标，我说我的日志”的沟通困境。周琦表示，这套标准化建模彻底消除了语义歧义，让不同部门、不同系统之间的协作更高效，也让运维人员的经验得以沉淀为可复用的组织资产，而非随人员流动流失。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b785d2f281d40e5abf36eba597ea514~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771407994&amp;x-signature=5vLJirqGJBHxf6xqxmFBgpaBwG0%3D" alt="图片" loading="lazy"/></p>
<p>上层则是以 AI Agent 为智能核心，实现“工具适应人”的新范式。Agent 采用自然语言交互方式，支持全场景上下文感知，用户可在任意界面随时召唤，直接通过自然语言提问，无需掌握复杂的查询指令。AIOps Agent 基于阿里云可观测平台的多源数据采集、存储、分析能力，采用“统一数据平台 + UModel + 传统算法 + 生成式 AI”的混合处理架构，能够自主规划、调用工具、执行分析并反思优化，可以提供从自然语言交互到自动化巡检的全流程运维辅助能力，解决各类开放和未知的运维难题，将运维人员从重复的查询、分析工作中解放出来。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c4c5918d5554617b9137a8fcabd1731~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771407994&amp;x-signature=ir1U1ioZyER6pxyCbV5SzafwFw0%3D" alt="图片" loading="lazy"/></p>
<blockquote>
<p><strong>周琦形象地说，</strong> “希望运维未来可以高度自动化，让 AIOps 把那些又脏又累的活儿做了。”这意味着，企业客户无需再投入大量宝贵的人力资源去完成数据采集、清洗、对齐等基础且繁琐的工程工作，阿里云的平台已经将这些“隐形工程”承担下来。</p>
</blockquote>
<p>如今，阿里云 AIOps Agent 已在 6000 多家企业落地，帮助大型企业客户实现故障 MTTR 从小时级降至小于 15 分钟。</p>
<p>对于企业而言，部署 AIOps 的终极价值远不止于减轻运维团队的负担，而是它能释放出宝贵的研发与创新资源，让技术人才能够专注于业务价值创造。同时，它也能帮助企业系统性地管理那些以往容易被忽视的隐性成本与合规风险，从长远角度优化 IT 投资的整体回报。</p>
<h2 data-id="heading-3">开源引领生态共建，推动“技术平权”愿景</h2>
<p>阿里云深知，“语义基座”的价值在于普及，而开源与生态建设是实现“技术平权”的关键，更能让全行业运维人员共同成长。为此，阿里云在开源布局、标准建设和生态协同上持续发力，推动 AIOps 行业整体进步。</p>
<p><strong>在开源布局方面</strong>，阿里云计划将 UModel 统一语义语言开源至社区，并向 OpenTelemetry 社区贡献了探针、采集器等核心工具。这些工具已被滴滴等公司开发人员广泛采用，大幅降低了行业重复开发成本。其中，无侵入探针的代码已开源在 GitHub 上，经过众多企业实战验证，在安全性和稳定性上备受认可，让中小企业无需自行研发即可获得高质量的数据采集能力。</p>
<p><strong>在标准建设方面</strong>，阿里云正在构建 AIOps 成熟度 Benchmark 榜单，构建了从数据分析到复杂异常检测的分级标准，涵盖基础任务处理、异常发现、根因分析、隐形问题挖掘、自主修复等不同阶段，让企业能够清晰评估自身能力水平，找到明确的进阶路径。周琦表示，希望可以和业界一起共创，攻克智能运维领域的难题，推动 AIOps 标准落地，促进整个可观测性领域的快速发展。</p>
<p><strong>在生态协同方面</strong>，阿里云通过大赛联动高校、企业，将工业界高频问题转化为赛题，促进产学研深度融合。通过大赛的方式，阿里云将标准 Benchmark 和真实场景赛题提供给参赛者，让高校学生、企业开发者都能在实战中提升能力，同时为行业贡献创新方案。</p>
<p>周琦表示，阿里云通过开放共建的模式，打破技术壁垒，让不同规模、不同行业的企业都可以落地 AIOps，实现“技术平权”，让中小企业也能调用顶级“隐形工程师团队”，让每个运维人员都能借助智能工具发挥更大价值，向“智能运营专家”演进。</p>
<h2 data-id="heading-4">未来趋势：自主 Agent 协同，运维能力重构</h2>
<p>展望未来，周琦从不同时间维度来做出判断。短期来看，低风险任务将实现全自动化闭环，如 IP 封禁、简单扩容等操作可由 AI 自主完成，而重要操作仍保留人机协同决策模式，确保系统安全。同时，多角色 Agent 协同雏形将逐步显现，运维、安全、成本控制等不同领域的 Agent 将共享统一数据视图，提升跨域运营效率。</p>
<p>中长期来看，AIOps 将与 AI Coding、测试等环节深度打通，最终形成开发、测试到运维的全生命周期智能闭环。周琦解释道，AI Coding 目前在开发态做的非常有效，但从一个演示应用到企业级系统，部署后能稳定运行，还需要很长时间。“我们希望能够将 AI Coding 和 AIOps 串联，实现全局优化。让应用系统不光能跑起来，还能跑得更好、更稳，把运行态的状况实时反馈给 AI Coding。”</p>
<p>技术的演进必然带来运维人员角色与能力的重构。周琦表示，过去，运维人员是“救火队员”，整天忙于处理各类故障；未来，他们将转变为“系统教练”，而他们的核心能力不再是重复的操作经验，而是架构设计、业务理解、多维度决策等高阶能力。未来的运维人员需要平衡安全、成本、合规、可扩展性等多重诉求，专注于系统长期价值的优化。</p>
<h2 data-id="heading-5">结语</h2>
<p>在阿里云可观测团队的定义中，智能运维是一场深刻的范式转移。它以大模型为驱动，基于统一的数据平台与领域知识模型，实现了从“人适应工具”到“将人类创造力注入系统智能之中”的本质转变，最终构建起数据、认知与行动闭环融合的智能体系。</p>
<p>纵观这场由 Operation Intelligence 引领的变革，其核心在于将运维智慧从依赖个人的隐性经验，沉淀为可复制、可迭代的组织数字资产，推动工程师从重复劳作中解放，实现价值的创造性升维。</p>
<p>阿里云始终致力于通过自身实践与生态共建，让任何规模的企业都能获得顶级“隐形工程师”团队的支持，在数智化浪潮中聚焦核心创造，实现个人与企业的共同成长。</p>
<p>正如周琦所言，“未来的运维竞争，将不再是工具的竞争，而是人的创造力与战略眼光的竞争”。当统一语言打通系统与智能的鸿沟，技术真正服务于人的价值释放，这场变革便不止于运维效率的提升，更将成为企业创新加速、行业持续进步的核心动力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深度解析Kratos服务注册：从框架入口到Consul落地实现]]></title>    <link>https://juejin.cn/post/7605326543686975497</link>    <guid>https://juejin.cn/post/7605326543686975497</guid>    <pubDate>2026-02-11T09:35:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605326543686975497" data-draft-id="7605213691910799386" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深度解析Kratos服务注册：从框架入口到Consul落地实现"/> <meta itemprop="keywords" content="Go,后端"/> <meta itemprop="datePublished" content="2026-02-11T09:35:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="下次一定x"/> <meta itemprop="url" content="https://juejin.cn/user/3722294009017404"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深度解析Kratos服务注册：从框架入口到Consul落地实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3722294009017404/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    下次一定x
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:35:17.000Z" title="Wed Feb 11 2026 09:35:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>在微服务架构中，服务注册是实现服务发现、负载均衡的基础前提，其稳定性直接决定了整个微服务集群的可用性。<code>Kratos</code> 作为开源的高性能微服务框架，其服务注册机制遵循“简洁、解耦、可扩展”的设计理念，深度融合框架自身的函数选项模式，形成了一套从入口初始化到注册中心落地的完整闭环。要彻底理解 <code>Kratos</code> 的服务注册逻辑，我们需从框架入口出发，逐层拆解App实例初始化、服务实例构建、注册接口实现到 <code>Consul</code> 具体落地的每一个核心环节，下文将结合源码逐点剖析，帮你吃透 <code>Kratos</code> 服务注册的底层逻辑（函数选项模式我之前的文章已详细讲解，本文不再赘述）。</p>
<h2 data-id="heading-1">App结构体：服务注册的核心载体</h2>
<p><code>Kratos</code> 的服务注册逻辑并非孤立存在，而是围绕App实例展开，<code>App</code> 作为主程序返回的核心实例，封装了服务注册所需的全部配置、上下文、互斥锁及服务实例信息，是串联整个注册流程的“中枢”。其核心设计思路是将配置逻辑与目标结构体解耦，通过内嵌<code>options</code>结构体存放所有注册相关配置，同时通过<code>instance</code>字段存储注册到注册中心的服务实例，为后续注册操作提供数据支撑。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 主程序返回的实例</span>
<span class="hljs-keyword">type</span> App <span class="hljs-keyword">struct</span> {
	opts     options   <span class="hljs-comment">// 这里的 options 是一个结构体 用于存放配置 本质上是让配置逻辑与目标结构体解耦</span>
	ctx      context.Context
	cancel   context.CancelFunc <span class="hljs-comment">// 上下文取消函数</span>
	mu       sync.Mutex       <span class="hljs-comment">// 互斥锁保护 instance 的并发读写</span>
	instance *registry.ServiceInstance <span class="hljs-comment">// 重要 注册到注册中心的服务实例信息 是 kratos 自己定义的 方便自己使用</span>
}

<span class="hljs-comment">// 创建 App 实例</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">(opts ...Option)</span></span> *App {
    <span class="hljs-comment">// 默认值</span>
	o := options{
		ctx:              context.Background(),
		sigs:             []os.Signal{syscall.SIGTERM, syscall.SIGQUIT, syscall.SIGINT}, <span class="hljs-comment">// 优雅退出</span>
		registrarTimeout: <span class="hljs-number">10</span> * time.Second,  <span class="hljs-comment">// 注册超时时间</span>
	}
    <span class="hljs-comment">// 生成 唯一 ID 比如注册到 Consul 上的唯一 ID</span>
	<span class="hljs-keyword">if</span> id, err := uuid.NewUUID(); err == <span class="hljs-literal">nil</span> {
		o.id = id.String()
	}
    <span class="hljs-comment">// 我们用户 调用 New 函数 自己加的配置 可覆盖默认值 提高灵活性</span>
	<span class="hljs-keyword">for</span> _, opt := <span class="hljs-keyword">range</span> opts {
		opt(&amp;o)
	}
    <span class="hljs-comment">// 用户是否传入自己的 log 传了就使用用户的 log</span>
	<span class="hljs-keyword">if</span> o.logger != <span class="hljs-literal">nil</span> {
		log.SetLogger(o.logger)
	}
    <span class="hljs-comment">// 全局 cancel </span>
	ctx, cancel := context.WithCancel(o.ctx)
    
    <span class="hljs-comment">// 返回 主程序的实例</span>
	<span class="hljs-keyword">return</span> &amp;App{
		ctx:    ctx,
		cancel: cancel,
		opts:   o,
	}
}

</code></pre>
<h3 data-id="heading-2"><code>Run()</code> 函数</h3>
<p><code>Run</code> 函数是 <code>Kratos</code> 主程序的入口，也是服务注册逻辑的核心执行环节。该函数串联起“服务实例构建、前置钩子执行、服务启动、服务注册、信号监听、优雅退出”的全流程，其中服务注册是该函数的核心步骤之一，在所有服务（<code>HTTP</code> / <code>gRPC</code> 等）启动完成后，通过调用注册中心的 <code>Register</code> 方法，将服务实例注册到指定注册中心。同时，该函数通过 <code>errgroup</code> 管理协程、<code>sync.WaitGroup</code> 保证服务启动顺序、上下文控制优雅退出，全方位保障服务注册的稳定性和可靠性。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *App)</span></span> Run() <span class="hljs-type">error</span> {
	<span class="hljs-comment">// 构建服务注册实例 后续有代码讲解</span>
	instance, err := a.buildInstance()
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err
	}
	a.mu.Lock()
	a.instance = instance <span class="hljs-comment">// 保存实例信息  供后续使用</span>
	a.mu.Unlock()

	<span class="hljs-comment">/* 
	函数内容是 context.WithValue(ctx, appKey{}, a)
	本质上让应用的任意层级代码都能获取 App 的核心信息，而不需要显式传递 App 实例。
	如果显式的去传 App 实例的话，每个函数的形参都要多一个，导致参数膨胀
	*/</span>
	sctx := NewContext(a.ctx, a) <span class="hljs-comment">// 将 app 例存入上下文</span>

	<span class="hljs-comment">// 初始化 errgroup 我之前文章介绍过</span>
	eg, ctx := errgroup.WithContext(sctx) 
	wg := sync.WaitGroup{} <span class="hljs-comment">//这个就为了应对 没有 goroutine 给到 servers 一直阻塞 但主程序一直向下走是不行的</span>

	<span class="hljs-comment">// 执行启动前置钩子   比如说 数据库的初始化，redis 的初始化等 用户传入</span>
	<span class="hljs-keyword">for</span> _, fn := <span class="hljs-keyword">range</span> a.opts.beforeStart {
		<span class="hljs-keyword">if</span> err = fn(sctx); err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> err <span class="hljs-comment">// 钩子执行失败，直接退出 比如数据库的初始化都失败了 程序没必要执行</span>
		}
	}

	<span class="hljs-comment">// 启动所有服务  HTTP / gRPC 等 </span>
	octx := NewContext(a.opts.ctx, a)  <span class="hljs-comment">// 这里要分开 App 生命周期上下文 和 Server 生命周期上下文</span>
	<span class="hljs-keyword">for</span> _, srv := <span class="hljs-keyword">range</span> a.opts.servers {
		server := srv <span class="hljs-comment">// 循环变量捕获问题 避免 goroutine 中使用同一个变量</span>
        
		<span class="hljs-comment">// 子goroutine 监听停止信号，优雅停止服务</span>
		eg.Go(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">error</span> {
			&lt;-ctx.Done() <span class="hljs-comment">// 等待停止信号</span>
			<span class="hljs-comment">// 构建停止上下文</span>
			stopCtx := context.WithoutCancel(octx)
			<span class="hljs-comment">// 设置停止超时时间 防止服务卡死</span>
			<span class="hljs-keyword">if</span> a.opts.stopTimeout &gt; <span class="hljs-number">0</span> {
				<span class="hljs-keyword">var</span> cancel context.CancelFunc
				stopCtx, cancel = context.WithTimeout(stopCtx, a.opts.stopTimeout)
				<span class="hljs-keyword">defer</span> cancel() <span class="hljs-comment">// 确保超时后释放资源</span>
			}
			<span class="hljs-keyword">return</span> server.Stop(stopCtx) <span class="hljs-comment">// 停止当前服务</span>
		})

		<span class="hljs-comment">// 子 goroutine 启动当前服务</span>
		wg.Add(<span class="hljs-number">1</span>)
		eg.Go(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">error</span> {
			wg.Done() <span class="hljs-comment">// 标记启动逻辑已开始 防止 goroutine 阻塞 然后程序向下执行</span>
			<span class="hljs-keyword">return</span> server.Start(octx) <span class="hljs-comment">// 启动服务</span>
		})
	}
	wg.Wait() <span class="hljs-comment">// 等待所有服务的启动 goroutine 开始执行</span>
	
	<span class="hljs-comment">// 重点 注册服务到注册中心</span>
	<span class="hljs-keyword">if</span> a.opts.registrar != <span class="hljs-literal">nil</span> {
		<span class="hljs-comment">// 注册超时控制</span>
		rctx, rcancel := context.WithTimeout(ctx, a.opts.registrarTimeout)
		<span class="hljs-keyword">defer</span> rcancel()
        <span class="hljs-comment">// 重要函数 后续讲解</span>
		<span class="hljs-keyword">if</span> err = a.opts.registrar.Register(rctx, instance); err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> err <span class="hljs-comment">// 注册失败，直接退出</span>
		}
	}

	<span class="hljs-comment">// 执行启动后置钩子 比如缓存预热等</span>
	<span class="hljs-keyword">for</span> _, fn := <span class="hljs-keyword">range</span> a.opts.afterStart {
		<span class="hljs-keyword">if</span> err = fn(sctx); err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> err
		}
	}

	<span class="hljs-comment">// 监听系统信号，处理优雅退出</span>
	c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> os.Signal, <span class="hljs-number">1</span>)
	signal.Notify(c, a.opts.sigs...) <span class="hljs-comment">// 监听指定的系统信号</span>
	eg.Go(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-type">error</span> {
		<span class="hljs-keyword">select</span> {
		<span class="hljs-keyword">case</span> &lt;-ctx.Done(): <span class="hljs-comment">// 其他 goroutine 出错，ctx 被取消</span>
			<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
		<span class="hljs-keyword">case</span> &lt;-c: 			  <span class="hljs-comment">// 收到系统停止信号 </span>
			<span class="hljs-keyword">return</span> a.Stop() 	<span class="hljs-comment">// 触发应用停止流程</span>
		}
	})

	<span class="hljs-comment">// 等待所有 goroutine 执行完成</span>
	<span class="hljs-keyword">if</span> err = eg.Wait(); err != <span class="hljs-literal">nil</span> &amp;&amp; !errors.Is(err, context.Canceled) {
		<span class="hljs-keyword">return</span> err 
	}

	<span class="hljs-comment">// 执行停止后置钩子  清理服务运行过程中占用的资源</span>
	err = <span class="hljs-literal">nil</span>
	<span class="hljs-keyword">for</span> _, fn := <span class="hljs-keyword">range</span> a.opts.afterStop {
		err = fn(sctx) 		<span class="hljs-comment">// 即使一个钩子出错，也执行完所有钩子</span>
	}
	<span class="hljs-keyword">return</span> err
}
</code></pre>
<h3 data-id="heading-3"><code> buildInstance()</code> 函数</h3>
<p><code>buildInstance</code> 函数是 <code>kratos</code> 框架中<strong>服务注册到注册中心的核心数据构造函数</strong>，它的唯一目的是构建 <code>registry.ServiceInstance</code> 实例 注册中心识别服务的身份凭证，核心逻辑是优先使用用户显式配置的端点，无显式配置则从服务实例自动提取，保证服务注册信息的准确性和灵活性。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(a *App)</span></span> buildInstance() (*registry.ServiceInstance, <span class="hljs-type">error</span>) {

    <span class="hljs-comment">// 预分配容量：len(a.opts.endpoints)，减少切片扩容的内存开销</span>
    endpoints := <span class="hljs-built_in">make</span>([]<span class="hljs-type">string</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(a.opts.endpoints))
    <span class="hljs-comment">// 遍历用户显式配置的 endpoints，转为字符串格式</span>
    <span class="hljs-keyword">for</span> _, e := <span class="hljs-keyword">range</span> a.opts.endpoints {
        endpoints = <span class="hljs-built_in">append</span>(endpoints, e.String())
    }

    <span class="hljs-comment">// 如果用户未显式配置 endpoints，从 servers 自动提取</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(endpoints) == <span class="hljs-number">0</span> {
        <span class="hljs-comment">// 遍历所有已注册的 Server（HTTP/gRPC 等）</span>
        <span class="hljs-keyword">for</span> _, srv := <span class="hljs-keyword">range</span> a.opts.servers {
            <span class="hljs-comment">// 接口断言：判断当前 Server 是否实现了 Endpointer 接口  kratos 内置 Server 都实现了</span>
            <span class="hljs-keyword">if</span> r, ok := srv.(transport.Endpointer); ok {
                <span class="hljs-comment">// 调用 Endpoint() 方法，获取该 Server 的端点信息（如 HTTP 服务的 8080 端口）</span>
                e, err := r.Endpoint()
                <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
                    <span class="hljs-comment">// 提取端点失败直接返回错误：注册中心必须有正确的端点，否则注册无意义</span>
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
                }
                <span class="hljs-comment">// 将端点转为标准字符串，加入切片</span>
                endpoints = <span class="hljs-built_in">append</span>(endpoints, e.String())
            }
      
        }
    }

    <span class="hljs-comment">// 构造并返回注册中心需要的 ServiceInstance</span>
    <span class="hljs-keyword">return</span> &amp;registry.ServiceInstance{
        ID:        a.opts.id,       <span class="hljs-comment">// 应用唯一 ID（UUID，New 函数中生成）</span>
        Name:      a.opts.name,     <span class="hljs-comment">// 服务名称（如 "order-service"）</span>
        Version:   a.opts.version,  <span class="hljs-comment">// 服务版本（如 "v1.0.0"）</span>
        Metadata:  a.opts.metadata, <span class="hljs-comment">// 服务元数据（如 env:prod、region:cn-beijing）</span>
        Endpoints: endpoints,       <span class="hljs-comment">// 核心：服务的访问端点</span>
    }, <span class="hljs-literal">nil</span>
}
</code></pre>
<h2 data-id="heading-4"><code>Kratos</code> 服务注册的接口设计与 <code>Consul</code> 实现</h2>
<p><code>Kratos</code> 采用“接口定义+具体实现”的设计模式，将服务注册的核心逻辑抽象为Registrar接口，屏蔽了不同注册中心（<code>Consul</code>、<code>Etcd</code> 、<code>Nacos</code> 等）的实现差异，实现了注册逻辑与注册中心解耦，让用户可以根据业务需求灵活切换注册中心。其中，<code>Consul</code> 作为主流的服务注册与发现工具，是<code>Kratos</code> 最常用的注册中心落地方案，<code>Kratos</code> 通过 <code>Registry</code> 结构体封装 <code>Consul</code> 客户端、健康检查配置、服务缓存等信息，实现了<code>Registrar</code> 接口的 <code>Register</code> 和 <code>Deregister</code> 方法，完成服务在 <code>Consul</code> 中的注册与注销。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 服务注册 </span>
<span class="hljs-keyword">type</span> Registrar <span class="hljs-keyword">interface</span> {

	Register(ctx context.Context, service *ServiceInstance) <span class="hljs-type">error</span>

	Deregister(ctx context.Context, service *ServiceInstance) <span class="hljs-type">error</span>
}

<span class="hljs-comment">// 服务发现</span>
<span class="hljs-keyword">type</span> Discovery <span class="hljs-keyword">interface</span> {
    
	GetService(ctx context.Context, serviceName <span class="hljs-type">string</span>) ([]*ServiceInstance, <span class="hljs-type">error</span>)
    
	Watch(ctx context.Context, serviceName <span class="hljs-type">string</span>) (Watcher, <span class="hljs-type">error</span>)
    
}
</code></pre>
<h3 data-id="heading-5">consul 实现细节</h3>
<p><code>Kratos</code> 通过New函数创建 <code>Consul</code> 的 <code>Registry</code> 实例，初始化 <code>Consul</code> 客户端、默认健康检查配置、服务缓存等信息，并支持用户通过函数选项模式覆盖默认配置，适配不同的 <code>Consul</code> 集群环境。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> Registry <span class="hljs-keyword">struct</span> {
	cli               *Client   <span class="hljs-comment">// consul 客户端</span>
	enableHealthCheck <span class="hljs-type">bool</span>      <span class="hljs-comment">// 是否为注册的服务启用健康检查</span>
	registry          <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*serviceSet <span class="hljs-comment">// 服务注册缓存  key=服务名称，value=该服务的实例集合</span>
	lock              sync.RWMutex          <span class="hljs-comment">// 保护registry缓存的读写安全</span>
	timeout           time.Duration         <span class="hljs-comment">// 超时时间</span>
}
<span class="hljs-comment">// 用该函数去创建 kratos 声明接口的实现类 ( consul )</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">New</span><span class="hljs-params">(apiClient *api.Client, opts ...Option)</span></span> *Registry {
	<span class="hljs-comment">// 初始化Registry默认值</span>
	r := &amp;Registry{
		registry:          <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*serviceSet), <span class="hljs-comment">// 初始化服务缓存 map</span>
		enableHealthCheck: <span class="hljs-literal">true</span>,                         <span class="hljs-comment">// 默认开启健康检查</span>
		timeout:           <span class="hljs-number">10</span> * time.Second,             <span class="hljs-comment">// 默认超时10秒</span>
		<span class="hljs-comment">// 初始化内部的Consul Client</span>
		cli: &amp;Client{
			dc:                             SingleDatacenter, <span class="hljs-comment">// 默认单数据中心</span>
			cli:                            apiClient,        <span class="hljs-comment">// 外部传入的Consul原生API Client  解耦</span>
			resolver:                       defaultResolver,  <span class="hljs-comment">// 默认地址解析器（解析端点为Consul可识别的格式）</span>
			healthcheckInterval:            <span class="hljs-number">10</span>,               <span class="hljs-comment">// 默认健康检查间隔10秒</span>
			heartbeat:                      <span class="hljs-literal">true</span>,             <span class="hljs-comment">// 默认启用TTL心跳</span>
			deregisterCriticalServiceAfter: <span class="hljs-number">600</span>,              <span class="hljs-comment">// 异常后600秒  注销服务</span>
			cancelers:                      <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]*canceler), <span class="hljs-comment">// goroutine 的取消器缓存</span>
		},
	}
	<span class="hljs-comment">//  应用用户自定义Option  覆盖默认配置</span>
	<span class="hljs-keyword">for</span> _, o := <span class="hljs-keyword">range</span> opts {
		o(r)
	}
	<span class="hljs-keyword">return</span> r
}

<span class="hljs-comment">// 重点  这个就是 Run() 函数中调用的 Register  前提是你要传入 Consul 的实例</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *Registry)</span></span> Register(ctx context.Context, svc *registry.ServiceInstance) <span class="hljs-type">error</span> {
	<span class="hljs-keyword">return</span> r.cli.Register(ctx, svc, r.enableHealthCheck)
}

<span class="hljs-comment">// 注销</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *Registry)</span></span> Deregister(ctx context.Context, svc *registry.ServiceInstance) <span class="hljs-type">error</span> {
	<span class="hljs-keyword">return</span> r.cli.Deregister(ctx, svc.ID)
}
</code></pre>
<h3 data-id="heading-6"><code>Register()</code> 函数</h3>
<p><code>Register</code> 函数是 <code>Consul</code> 注册的最终执行环节，也是整个服务注册流程的“最后一公里”。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *Client)</span></span> Register(_ context.Context, svc *registry.ServiceInstance, enableHealthCheck <span class="hljs-type">bool</span>) <span class="hljs-type">error</span> {
    
	<span class="hljs-comment">// 地址格式转换  kratos → Consul  把 ServiceInstance 类型 变成 consul 需要的类型</span>
	addresses := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]api.ServiceAddress, <span class="hljs-built_in">len</span>(svc.Endpoints))
	<span class="hljs-comment">// checkAddresses：存储所有需要做健康检查的地址（host:port格式）</span>
	checkAddresses := <span class="hljs-built_in">make</span>([]<span class="hljs-type">string</span>, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(svc.Endpoints))

	<span class="hljs-comment">// 遍历 kratos 服务实例的所有端点 比如 "http://127.0.0.1:8080", "grpc://127.0.0.1:9090"]</span>
	<span class="hljs-keyword">for</span> _, endpoint := <span class="hljs-keyword">range</span> svc.Endpoints { 
		<span class="hljs-comment">// 解析端点URL：把 "http://127.0.0.1:8080" 解析为 url.URL 对象 Scheme=http, Host=127.0.0.1:8080等</span>
		raw, err := url.Parse(endpoint) 
		<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
			<span class="hljs-keyword">return</span> err <span class="hljs-comment">// 解析失败直接返回，注册流程终止</span>
		}
		<span class="hljs-comment">// 提取主机名</span>
		addr := raw.Hostname()         
		<span class="hljs-comment">// 提取端口并转换为uint16</span>
		port, _ := strconv.ParseUint(raw.Port(), <span class="hljs-number">10</span>, <span class="hljs-number">16</span>) 

		<span class="hljs-comment">// 拼接健康检查地址（格式：host:port，如127.0.0.1:8080），用于TCP健康检查</span>
		checkAddresses = <span class="hljs-built_in">append</span>(checkAddresses, net.JoinHostPort(addr, strconv.FormatUint(port, <span class="hljs-number">10</span>)))
		<span class="hljs-comment">// 填充 Addresses  它的key 当作 tag 用于筛选</span>
		addresses[raw.Scheme] = api.ServiceAddress{Address: endpoint, Port: <span class="hljs-type">int</span>(port)} 
	}

	<span class="hljs-comment">// 构造 Consul 核心注册对象 </span>
	asr := &amp;api.AgentServiceRegistration{
		ID:              svc.ID,               <span class="hljs-comment">// 服务唯一ID  kratos生成的UUID</span>
		Name:            svc.Name,             <span class="hljs-comment">// 服务名称	如"order-service"，Consul按名称分组服务</span>
		Meta:            svc.Metadata,         <span class="hljs-comment">// 服务元数据</span>
		Tags:            []<span class="hljs-type">string</span>{fmt.Sprintf(<span class="hljs-string">"version=%s"</span>, svc.Version)}, 
		TaggedAddresses: addresses,            <span class="hljs-comment">//   标签化地址</span>
	}

	<span class="hljs-comment">// 设置Consul UI展示的基础地址 拿第一个</span>
	<span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(checkAddresses) &gt; <span class="hljs-number">0</span> {
		<span class="hljs-comment">// 拆分host和port（如127.0.0.1:8080 → host=127.0.0.1, portRaw=8080）</span>
		host, portRaw, _ := net.SplitHostPort(checkAddresses[<span class="hljs-number">0</span>])
		port, _ := strconv.ParseInt(portRaw, <span class="hljs-number">10</span>, <span class="hljs-number">32</span>)
		asr.Address = host <span class="hljs-comment">// 主地址</span>
		asr.Port = <span class="hljs-type">int</span>(port) <span class="hljs-comment">// 主端口</span>
	}

	<span class="hljs-comment">// 配置Consul健康检查</span>
	<span class="hljs-keyword">if</span> enableHealthCheck {
		<span class="hljs-comment">// TCP 健康检查 检测端口是否存活</span>
		<span class="hljs-keyword">for</span> _, address := <span class="hljs-keyword">range</span> checkAddresses {
			asr.Checks = <span class="hljs-built_in">append</span>(asr.Checks, &amp;api.AgentServiceCheck{
				TCP:                            address, <span class="hljs-comment">//  检查地址</span>
				Interval:                       fmt.Sprintf(<span class="hljs-string">"%ds"</span>, c.healthcheckInterval), <span class="hljs-comment">// 检查间隔</span>
                <span class="hljs-comment">// 异常后多久注销</span>
				DeregisterCriticalServiceAfter: fmt.Sprintf(<span class="hljs-string">"%ds"</span>, c.deregisterCriticalServiceAfter), 
				Timeout:                        <span class="hljs-string">"5s"</span>, <span class="hljs-comment">// 超时时间</span>
			})
		}
	}
    
	<span class="hljs-keyword">if</span> c.heartbeat {
		<span class="hljs-comment">// 上报健康状态</span>
		asr.Checks = <span class="hljs-built_in">append</span>(asr.Checks, &amp;api.AgentServiceCheck{
			CheckID:                        <span class="hljs-string">"service:"</span> + svc.ID,  <span class="hljs-comment">// 检查唯一 ID</span>
			<span class="hljs-comment">// TTL 设为检查间隔的2倍：给网络抖动留缓冲，避免一次调度延迟就误判服务异常</span>
			TTL:                            fmt.Sprintf(<span class="hljs-string">"%ds"</span>, c.healthcheckInterval*<span class="hljs-number">2</span>), 
			DeregisterCriticalServiceAfter: fmt.Sprintf(<span class="hljs-string">"%ds"</span>, c.deregisterCriticalServiceAfter),
		})
	}
    
	<span class="hljs-comment">// 追加用户自定义检查</span>
	asr.Checks = <span class="hljs-built_in">append</span>(asr.Checks, c.serviceChecks...)

	<span class="hljs-comment">// 调用 Consul API 完成服务注册 </span>
	err := c.cli.Agent().ServiceRegister(asr)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err <span class="hljs-comment">// 注册失败直接返回</span>
	}

	<span class="hljs-comment">// 启动 goroutine 主动上报健康状态</span>
	<span class="hljs-keyword">if</span> c.heartbeat {
		<span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
			<span class="hljs-comment">// 延迟1秒：避免 Consul 还没完成注册，就更新 TTL 导致失败</span>
			time.Sleep(time.Second) 
			<span class="hljs-comment">// 首次更新 TTL 为 "pass"</span>
			err = c.cli.Agent().UpdateTTL(<span class="hljs-string">"service:"</span>+svc.ID, <span class="hljs-string">"pass"</span>, <span class="hljs-string">"pass"</span>)
			<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
				log.Errorf(<span class="hljs-string">"[Consul]update ttl heartbeat to consul failed!err:=%v"</span>, err)
			}
			<span class="hljs-comment">// 创建定时器   每隔 healthcheckInterval 秒更新一次 TTL</span>
			ticker := time.NewTicker(time.Second * time.Duration(c.healthcheckInterval))
			<span class="hljs-keyword">defer</span> ticker.Stop() 	<span class="hljs-comment">// goroutine 退出时停止定时器（避免内存泄漏）</span>
			<span class="hljs-keyword">for</span> {
				<span class="hljs-keyword">select</span> {
				<span class="hljs-keyword">case</span> &lt;-ticker.C: 		<span class="hljs-comment">// 定时触发TTL更新</span>
					err = c.cli.Agent().UpdateTTL(<span class="hljs-string">"service:"</span>+svc.ID, <span class="hljs-string">"pass"</span>, <span class="hljs-string">"pass"</span>)
					<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
						log.Errorf(<span class="hljs-string">"[Consul]update ttl heartbeat to consul failed!err:=%v"</span>, err)
					}
				<span class="hljs-keyword">case</span> &lt;-c.ctx.Done(): 		<span class="hljs-comment">// 上下文取消 </span>
					<span class="hljs-keyword">return</span> 			<span class="hljs-comment">// 退出 goroutine，停止心跳</span>
				}
			}
		}()
	}
	<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h2 data-id="heading-7">总结</h2>
<p>综上，<code>kratos</code>的服务注册机制是一套入口统一、配置灵活、接口解耦、落地可靠的完整体系，其核心流程可概括为：通过 <code>New</code> 函数初始化App实例及注册配置，然后通过 <code>Run</code> 函数启动服务并触发注册逻辑，再通过 <code>buildInstance</code> 函数构建服务实例身份凭证，之后再通过 <code>Registrar</code> 接口调用 <code>Consul</code> 实现类，最后通过 <code>Register</code> 函数完成格式转换、健康配置及最终注册，形成从初始化到落地的全闭环。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入解析Spring Boot中的@ConfigurationProperties注解]]></title>    <link>https://juejin.cn/post/7605140481489190953</link>    <guid>https://juejin.cn/post/7605140481489190953</guid>    <pubDate>2026-02-11T09:38:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605140481489190953" data-draft-id="7605174711182327871" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入解析Spring Boot中的@ConfigurationProperties注解"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-11T09:38:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="java进阶之路2023"/> <meta itemprop="url" content="https://juejin.cn/user/954805959001486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入解析Spring Boot中的@ConfigurationProperties注解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/954805959001486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    java进阶之路2023
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:38:39.000Z" title="Wed Feb 11 2026 09:38:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h5 data-id="heading-0">深入解析Spring Boot中的@ConfigurationProperties注解</h5>
<p>在Spring Boot框架中，配置管理是一个核心功能。Spring Boot提供了多种方式来处理外部配置，其中<code>@ConfigurationProperties</code>注解是一个非常强大且灵活的工具。本文将深入探讨<code>@ConfigurationProperties</code>注解的概念、用法、工作原理、配置绑定、类型安全以及如何在实际开发中应用它。</p>
<h6 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>什么是@ConfigurationProperties？</h6>
<p><code>@ConfigurationProperties</code>是Spring Boot提供的一个注解，用于将外部配置属性绑定到Java对象上。通过使用这个注解，开发者可以将配置文件（如<code>application.properties</code>或<code>application.yml</code>）中的属性值自动映射到Java类的字段上，从而实现配置的集中管理和类型安全。</p>
<h6 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>@ConfigurationProperties的作用</h6>
<ol>
<li><strong>配置绑定</strong>：将配置文件中的属性值绑定到Java类的字段上，实现配置的自动映射。</li>
<li><strong>类型安全</strong>：提供类型安全的配置绑定，避免类型转换错误。</li>
<li><strong>复杂配置</strong>：支持复杂配置结构的绑定，如嵌套对象、集合、Map等。</li>
<li><strong>配置校验</strong>：结合<code>@Valid</code>注解，实现配置属性的校验。</li>
</ol>
<h6 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>@ConfigurationProperties的基本用法</h6>
<h6 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 定义配置类</h6>
<p>首先，定义一个Java类，用于绑定配置属性。使用<code>@ConfigurationProperties</code>注解标记该类，并指定前缀（prefix）。</p>
<p><strong>示例代码：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">yicrm</span>.<span class="hljs-property">biz</span>.<span class="hljs-property">config</span>;


<span class="hljs-keyword">import</span> lombok.<span class="hljs-property">Data</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">context</span>.<span class="hljs-property">properties</span>.<span class="hljs-property">ConfigurationProperties</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;

<span class="hljs-comment">/**
 * &lt;p&gt;
 * uops-service配置
 * &lt;/p&gt;
 *
 * <span class="hljs-doctag">@author</span> <span class="hljs-variable">zhaozhijun</span>
 * <span class="hljs-doctag">@since</span> 2026-01-07
 */</span>

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"media-service"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MediaServiceConfig</span> {

    <span class="hljs-comment">//短视频路径</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> path;

    <span class="hljs-comment">//短视频路径-特殊租户</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> path2;

    <span class="hljs-comment">//直播路径</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> broadcastPath;
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> broadcastPath2;
    <span class="hljs-comment">//token</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> token;

    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> userId;

    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> companyId;
}
</code></pre>
<p><strong>解释：</strong></p>
<ul>
<li><code>@ConfigurationProperties(prefix = "app")</code>：指定配置属性的前缀为<code>app</code>。</li>
<li><code>@Component</code>：将该类注册为Spring Bean，使其可以被Spring容器管理。</li>
</ul>
<h6 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. 配置文件</h6>
<p>在<code>application.properties</code>或<code>application.yml</code>文件中定义配置属性。</p>
<p><strong>示例代码（application.properties）：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">media-service:</span>
  <span class="hljs-attr">path:</span> <span class="hljs-string">https://***.ai/media-service/internal/dataApi/video/getCompanyCoreMetrics</span>
  <span class="hljs-attr">token:</span> <span class="hljs-string">a5a6ae52b97f08e6847bbaf9bc054c13af797525</span>
  <span class="hljs-attr">userId:</span> <span class="hljs-number">3569</span>
  <span class="hljs-attr">companyId:</span> <span class="hljs-number">311</span>
</code></pre>
<h6 data-id="heading-6">3. 启用配置属性支持</h6>
<p>在Spring Boot应用的主类或配置类上，使用<code>@EnableConfigurationProperties</code>注解启用配置属性支持。</p>
<pre><code class="hljs language-arduino" lang="arduino">
package com.yicrm;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration;
<span class="hljs-keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;

<span class="hljs-comment">/**
 * 启动程序
 */</span>
@<span class="hljs-built_in">SpringBootApplication</span>(exclude = {DataSourceAutoConfiguration.<span class="hljs-keyword">class</span>})
@<span class="hljs-built_in">EnableConfigurationProperties</span>(AppProperties.<span class="hljs-keyword">class</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YiCrmApplication</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>{
        <span class="hljs-comment">// System.setProperty("spring.devtools.restart.enabled", "false");</span>
        <span class="hljs-comment">// 关闭 PageHelper banner</span>
        System.<span class="hljs-built_in">setProperty</span>(<span class="hljs-string">"pagehelper.banner"</span>, <span class="hljs-string">"false"</span>);
<span class="hljs-comment">//        // 设置无头模式，避免在无图形界面的服务器环境中出现 X11FontManager 初始化错误</span>
<span class="hljs-comment">//        System.setProperty("java.awt.headless", "true");</span>
        SpringApplication.<span class="hljs-built_in">run</span>(YiCrmApplication.<span class="hljs-keyword">class</span>, args);
        System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"(♥◠‿◠)ﾉﾞ  YI-CRM启动成功   ლ(´ڡ`ლ)ﾞ"</span>);
    }
}

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从AWS SDK for Java 2.x 调用 AWS 服务]]></title>    <link>https://juejin.cn/post/7605214360084987940</link>    <guid>https://juejin.cn/post/7605214360084987940</guid>    <pubDate>2026-02-11T09:53:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605214360084987940" data-draft-id="7605140481489207337" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从AWS SDK for Java 2.x 调用 AWS 服务"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-02-11T09:53:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="java进阶之路2023"/> <meta itemprop="url" content="https://juejin.cn/user/954805959001486"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从AWS SDK for Java 2.x 调用 AWS 服务
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/954805959001486/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    java进阶之路2023
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:53:49.000Z" title="Wed Feb 11 2026 09:53:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>从AWS SDK for Java 2.x 调用 AWS 服务</p>
<h2 data-id="heading-0">1、JAR包引入</h2>
<pre><code class="hljs language-xml" lang="xml">
<span class="hljs-comment">&lt;!-- AWS SDK v2 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>software.amazon.awssdk<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>s3<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.20.162<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>software.amazon.awssdk<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>auth<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.20.162<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>software.amazon.awssdk<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>apache-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.20.162<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

</code></pre>
<h2 data-id="heading-1">2、配置</h2>
<pre><code class="hljs language-yaml" lang="yaml">
<span class="hljs-comment">#上传配置</span>
<span class="hljs-attr">upload:</span>
  <span class="hljs-attr">aws:</span> <span class="hljs-comment">#aws上传</span>
    <span class="hljs-attr">secretId:</span> <span class="hljs-string">AKIA6666</span>
    <span class="hljs-attr">secretKey:</span> <span class="hljs-string">daEiuKneDT1111</span>
    <span class="hljs-attr">bucket:</span> <span class="hljs-string">live</span>
    <span class="hljs-attr">region:</span> <span class="hljs-string">ap-4544-1</span>
    <span class="hljs-attr">rootPath:</span>  <span class="hljs-string">/crm-drd</span>  <span class="hljs-comment"># 文件存储根路径</span>
    <span class="hljs-attr">days:</span> <span class="hljs-number">7</span>   <span class="hljs-comment"># 预签名URL有效期（天数）</span>
    <span class="hljs-attr">awsHost:</span> <span class="hljs-string">https://45454545-1.amazonaws.com</span>
    <span class="hljs-attr">proxyHost:</span> <span class="hljs-string">https://wewewet.ai</span>
    <span class="hljs-attr">enabled :</span> <span class="hljs-literal">true</span>
</code></pre>
<h2 data-id="heading-2">3、读取配置</h2>
<pre><code class="hljs language-arduino" lang="arduino">package com.yicrm.common.config;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-comment">/**
 * AWS S3 配置属性
 *
 * @author yicrm
 * @since 2026-01-29
 */</span>
@Data
@Component
@<span class="hljs-built_in">ConfigurationProperties</span>(prefix = <span class="hljs-string">"upload.aws"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AwsProperties</span> {

    <span class="hljs-comment">/**
     * 是否启用 AWS S3
     */</span>
    <span class="hljs-keyword">private</span> Boolean enabled = <span class="hljs-literal">false</span>;

    <span class="hljs-comment">/**
     * Access Key ID
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> secretId;

    <span class="hljs-comment">/**
     * Secret Access Key
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> secretKey;

    <span class="hljs-comment">/**
     * 区域
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> region = <span class="hljs-string">"ap-southeast-1"</span>;

    <span class="hljs-comment">/**
     * 存储桶名称
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> bucket;

    <span class="hljs-comment">/**
     * 根路径前缀
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> rootPath = <span class="hljs-string">""</span>;

    <span class="hljs-comment">/**
     * aws域名
     * */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> awsHost;

    <span class="hljs-comment">/**
     * 代理域名（用于替换 S3 URL 的域名）
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> proxyHost;

    <span class="hljs-comment">/**
     * 预签名 URL 有效期（天数）
     */</span>
    <span class="hljs-keyword">private</span> Integer days = <span class="hljs-number">7</span>;

    <span class="hljs-comment">/**
     * 端点 URL（用于兼容 S3 兼容的存储服务）
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> endpoint;
}
</code></pre>
<h2 data-id="heading-3">4、AwsUtils方法实现</h2>
<pre><code class="hljs language-scss" lang="scss">
package com<span class="hljs-selector-class">.yicrm</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.utils</span><span class="hljs-selector-class">.aws</span>;

import com<span class="hljs-selector-class">.yicrm</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.config</span><span class="hljs-selector-class">.AwsProperties</span>;
import lombok<span class="hljs-selector-class">.extern</span><span class="hljs-selector-class">.slf4j</span><span class="hljs-selector-class">.Slf4j</span>;
import org<span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.commons</span><span class="hljs-selector-class">.lang3</span><span class="hljs-selector-class">.StringUtils</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.stereotype</span><span class="hljs-selector-class">.Component</span>;
import org<span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.multipart</span><span class="hljs-selector-class">.MultipartFile</span>;
import software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.auth</span><span class="hljs-selector-class">.credentials</span><span class="hljs-selector-class">.AwsBasicCredentials</span>;
import software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.auth</span><span class="hljs-selector-class">.credentials</span><span class="hljs-selector-class">.StaticCredentialsProvider</span>;
import software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.ResponseInputStream</span>;
import software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.sync</span><span class="hljs-selector-class">.RequestBody</span>;
import software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.http</span><span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.ApacheHttpClient</span>;
import software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.regions</span><span class="hljs-selector-class">.Region</span>;
import software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.services</span><span class="hljs-selector-class">.s3</span><span class="hljs-selector-class">.S3Client</span>;
import software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.services</span><span class="hljs-selector-class">.s3</span><span class="hljs-selector-class">.model</span>.*;
import software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.services</span><span class="hljs-selector-class">.s3</span><span class="hljs-selector-class">.presigner</span><span class="hljs-selector-class">.S3Presigner</span>;
import software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.services</span><span class="hljs-selector-class">.s3</span><span class="hljs-selector-class">.presigner</span><span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.GetObjectPresignRequest</span>;
import software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.services</span><span class="hljs-selector-class">.s3</span><span class="hljs-selector-class">.presigner</span><span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.PresignedGetObjectRequest</span>;
import software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.services</span><span class="hljs-selector-class">.s3</span><span class="hljs-selector-class">.presigner</span><span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.PresignedPutObjectRequest</span>;
import software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.services</span><span class="hljs-selector-class">.s3</span><span class="hljs-selector-class">.presigner</span><span class="hljs-selector-class">.model</span><span class="hljs-selector-class">.PutObjectPresignRequest</span>;

import javax<span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.PostConstruct</span>;
import javax<span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.PreDestroy</span>;
import java<span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.File</span>;
import java<span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.FileOutputStream</span>;
import java<span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.InputStream</span>;
import java<span class="hljs-selector-class">.net</span><span class="hljs-selector-class">.URL</span>;
import java<span class="hljs-selector-class">.net</span><span class="hljs-selector-class">.URLEncoder</span>;
import java<span class="hljs-selector-class">.nio</span><span class="hljs-selector-class">.file</span><span class="hljs-selector-class">.Files</span>;
import java<span class="hljs-selector-class">.nio</span><span class="hljs-selector-class">.file</span><span class="hljs-selector-class">.StandardCopyOption</span>;
import java<span class="hljs-selector-class">.time</span><span class="hljs-selector-class">.Duration</span>;
import java<span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.UUID</span>;

<span class="hljs-comment">/**
 * AWS S3 工具类
 *
 * @author yicrm
 * @since 2026-01-29
 */</span>
<span class="hljs-keyword">@Slf</span>4j
<span class="hljs-keyword">@Component</span>
public class AwsUtils {

    <span class="hljs-keyword">@Autowired</span>(required = false)
    private AwsProperties awsProperties;

    private S3Client s3Client;
    private S3Presigner s3Presigner;

    <span class="hljs-keyword">@PostConstruct</span>
    public void init() {
        if (awsProperties != null &amp;&amp; Boolean.TRUE.equals(awsProperties.getEnabled())) {
            try {
                AwsBasicCredentials awsCreds = AwsBasicCredentials<span class="hljs-selector-class">.create</span>(
                        awsProperties.getSecretId(),
                        awsProperties<span class="hljs-selector-class">.getSecretKey</span>()
                );

                software<span class="hljs-selector-class">.amazon</span><span class="hljs-selector-class">.awssdk</span><span class="hljs-selector-class">.services</span><span class="hljs-selector-class">.s3</span><span class="hljs-selector-class">.S3ClientBuilder</span> s3ClientBuilder = S3Client<span class="hljs-selector-class">.builder</span>()
                        <span class="hljs-selector-class">.region</span>(Region.of(awsProperties.getRegion()))
                        <span class="hljs-selector-class">.credentialsProvider</span>(StaticCredentialsProvider.create(awsCreds))
                        <span class="hljs-selector-class">.httpClient</span>(ApacheHttpClient.builder()<span class="hljs-selector-class">.build</span>());

                <span class="hljs-comment">// 如果配置了自定义端点，使用自定义端点</span>
                if (StringUtils.isNotBlank(awsProperties.getEndpoint())) {
                    s3ClientBuilder<span class="hljs-selector-class">.endpointOverride</span>(new URL(awsProperties.getEndpoint())<span class="hljs-selector-class">.toURI</span>());
                }

                s3Client = s3ClientBuilder<span class="hljs-selector-class">.build</span>();

                S3Presigner<span class="hljs-selector-class">.Builder</span> presignerBuilder = S3Presigner<span class="hljs-selector-class">.builder</span>()
                        <span class="hljs-selector-class">.region</span>(Region.of(awsProperties.getRegion()))
                        <span class="hljs-selector-class">.credentialsProvider</span>(StaticCredentialsProvider.create(awsCreds));

                if (StringUtils.isNotBlank(awsProperties.getEndpoint())) {
                    presignerBuilder<span class="hljs-selector-class">.endpointOverride</span>(new URL(awsProperties.getEndpoint())<span class="hljs-selector-class">.toURI</span>());
                }

                s3Presigner = presignerBuilder<span class="hljs-selector-class">.build</span>();

                log<span class="hljs-selector-class">.info</span>("AWS S3 客户端初始化成功");
            } catch (Exception e) {
                log<span class="hljs-selector-class">.error</span>("AWS S3 客户端初始化失败", e);
            }
        }
    }

    <span class="hljs-keyword">@PreDestroy</span>
    public void destroy() {
        if (s3Client != null) {
            s3Client<span class="hljs-selector-class">.close</span>();
        }
        if (s3Presigner != null) {
            s3Presigner<span class="hljs-selector-class">.close</span>();
        }
    }

    <span class="hljs-comment">/**
     * 检查 AWS 是否启用
     */</span>
    public boolean <span class="hljs-built_in">isEnabled</span>() {
        return awsProperties != null &amp;&amp; Boolean<span class="hljs-selector-class">.TRUE</span><span class="hljs-selector-class">.equals</span>(awsProperties.getEnabled()) &amp;&amp; s3Client != null;
    }

    <span class="hljs-comment">/**
     * 上传文件到 S3
     *
     * @param file 文件
     * @return 上传结果
     */</span>
    public AwsUploadResult <span class="hljs-built_in">uploadFile</span>(MultipartFile file) {
        if (!isEnabled()) {
            throw new <span class="hljs-built_in">IllegalStateException</span>("AWS S3 未启用或未正确配置");
        }

        try {
            String originalFilename = file<span class="hljs-selector-class">.getOriginalFilename</span>();
            String fileExtension = "";
            if (originalFilename != null &amp;&amp; originalFilename.contains(".")) {
                fileExtension = originalFilename<span class="hljs-selector-class">.substring</span>(originalFilename.lastIndexOf(".") + <span class="hljs-number">1</span>)<span class="hljs-selector-class">.toLowerCase</span>();
            }

            String key = UUID<span class="hljs-selector-class">.randomUUID</span>()<span class="hljs-selector-class">.toString</span>()<span class="hljs-selector-class">.replace</span>("-", "");
            String newFileName = key + (StringUtils.isNotBlank(fileExtension) ? "." + fileExtension : <span class="hljs-string">""</span>);

            <span class="hljs-comment">// 构建对象键</span>
            String rootPath = StringUtils<span class="hljs-selector-class">.isNotBlank</span>(awsProperties.getRootPath()) 
                    ? awsProperties<span class="hljs-selector-class">.getRootPath</span>()<span class="hljs-selector-class">.endsWith</span>("/") 
                        ? awsProperties<span class="hljs-selector-class">.getRootPath</span>() 
                        : awsProperties.<span class="hljs-built_in">getRootPath</span>() + <span class="hljs-string">"/"</span>
                    : <span class="hljs-string">""</span>;
            String objectKey = rootPath + newFileName;

            <span class="hljs-comment">// 创建临时文件</span>
            File tempFile = File<span class="hljs-selector-class">.createTempFile</span>(key, StringUtils.isNotBlank(fileExtension) ? "." + fileExtension : <span class="hljs-string">""</span>);
            try {
                Files<span class="hljs-selector-class">.copy</span>(file.getInputStream(), tempFile<span class="hljs-selector-class">.toPath</span>(), StandardCopyOption<span class="hljs-selector-class">.REPLACE_EXISTING</span>);

                <span class="hljs-comment">// 上传到 S3</span>
                PutObjectRequest putObjectRequest = PutObjectRequest<span class="hljs-selector-class">.builder</span>()
                        <span class="hljs-selector-class">.bucket</span>(awsProperties.getBucket())
                        <span class="hljs-selector-class">.key</span>(objectKey)
                        <span class="hljs-selector-class">.contentType</span>("application/octet-stream")
                        <span class="hljs-selector-class">.contentDisposition</span>("attachment")
                        <span class="hljs-selector-class">.contentLength</span>(file.getSize())
                        <span class="hljs-selector-class">.build</span>();

                s3Client<span class="hljs-selector-class">.putObject</span>(putObjectRequest, RequestBody.fromFile(tempFile));

                <span class="hljs-comment">// 生成文件访问 URL</span>
                String fileUrl = <span class="hljs-built_in">generatePresignedUrl</span>(objectKey, true);

                AwsUploadResult result = new <span class="hljs-built_in">AwsUploadResult</span>();
                result<span class="hljs-selector-class">.setKey</span>(objectKey);
                result<span class="hljs-selector-class">.setUrl</span>(fileUrl);
                result<span class="hljs-selector-class">.setOriginalFilename</span>(originalFilename);
                result<span class="hljs-selector-class">.setSize</span>(file.getSize());
                result<span class="hljs-selector-class">.setContentType</span>(file.getContentType());
                log<span class="hljs-selector-class">.info</span>("AWS S3 文件上传成功: key={}, url={}", objectKey, fileUrl);
                return result;
            } finally {
                <span class="hljs-comment">// 删除临时文件</span>
                if (tempFile.exists()) {
                    tempFile<span class="hljs-selector-class">.delete</span>();
                }
            }
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("AWS S3 文件上传失败", e);
            throw new <span class="hljs-built_in">RuntimeException</span>("文件上传失败: " + e.getMessage(), e);
        }
    }

    <span class="hljs-comment">/**
     * 上传文件到 S3（使用文件对象）
     *
     * @param file 文件
     * @param objectKey 对象键
     * @return 上传结果
     */</span>
    public AwsUploadResult <span class="hljs-built_in">uploadFile</span>(File file, String objectKey) {
        if (!isEnabled()) {
            throw new <span class="hljs-built_in">IllegalStateException</span>("AWS S3 未启用或未正确配置");
        }

        try {
            PutObjectRequest putObjectRequest = PutObjectRequest<span class="hljs-selector-class">.builder</span>()
                    <span class="hljs-selector-class">.bucket</span>(awsProperties.getBucket())
                    <span class="hljs-selector-class">.key</span>(objectKey)
                    <span class="hljs-selector-class">.contentLength</span>(file.length())
                    <span class="hljs-selector-class">.build</span>();

            s3Client<span class="hljs-selector-class">.putObject</span>(putObjectRequest, RequestBody.fromFile(file));

            String fileUrl = <span class="hljs-built_in">generatePresignedUrl</span>(objectKey, true);

            AwsUploadResult result = new <span class="hljs-built_in">AwsUploadResult</span>();
            result<span class="hljs-selector-class">.setKey</span>(objectKey);
            result<span class="hljs-selector-class">.setUrl</span>(fileUrl);
            result<span class="hljs-selector-class">.setOriginalFilename</span>(file.getName());
            result<span class="hljs-selector-class">.setSize</span>(file.length());

            log<span class="hljs-selector-class">.info</span>("AWS S3 文件上传成功: key={}, url={}", objectKey, fileUrl);
            return result;
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("AWS S3 文件上传失败: key={}", objectKey, e);
            throw new <span class="hljs-built_in">RuntimeException</span>("文件上传失败: " + e.getMessage(), e);
        }
    }

    <span class="hljs-comment">/**
     * 下载文件
     *
     * @param objectKey 对象键
     * @param targetPath 目标文件路径
     * @return 下载的文件
     */</span>
    public File <span class="hljs-built_in">downloadFile</span>(String objectKey, String targetPath) {
        if (!isEnabled()) {
            throw new <span class="hljs-built_in">IllegalStateException</span>("AWS S3 未启用或未正确配置");
        }

        try {
            GetObjectRequest getObjectRequest = GetObjectRequest<span class="hljs-selector-class">.builder</span>()
                    <span class="hljs-selector-class">.bucket</span>(awsProperties.getBucket())
                    <span class="hljs-selector-class">.key</span>(objectKey)
                    <span class="hljs-selector-class">.build</span>();

            ResponseInputStream&lt;GetObjectResponse&gt; response = s3Client<span class="hljs-selector-class">.getObject</span>(getObjectRequest);
            File targetFile = new <span class="hljs-built_in">File</span>(targetPath);

            <span class="hljs-comment">// 确保目标文件的父目录存在</span>
            File parentDir = targetFile<span class="hljs-selector-class">.getParentFile</span>();
            if (parentDir != null &amp;&amp; !parentDir.exists()) {
                parentDir<span class="hljs-selector-class">.mkdirs</span>();
            }

            <span class="hljs-comment">// 将响应流写入文件</span>
            try (FileOutputStream fos = new FileOutputStream(targetFile);
                 InputStream inputStream = response) {
                byte<span class="hljs-selector-attr">[]</span> buffer = new byte<span class="hljs-selector-attr">[8192]</span>;
                int bytesRead;
                while ((bytesRead = inputStream.read(buffer)) != -<span class="hljs-number">1</span>) {
                    fos<span class="hljs-selector-class">.write</span>(buffer, <span class="hljs-number">0</span>, bytesRead);
                }
            }

            log<span class="hljs-selector-class">.info</span>("AWS S3 文件下载成功: key={}, path={}", objectKey, targetPath);
            return targetFile;
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("AWS S3 文件下载失败: key={}, path={}", objectKey, targetPath, e);
            throw new <span class="hljs-built_in">RuntimeException</span>("文件下载失败: " + e.getMessage(), e);
        }
    }

    <span class="hljs-comment">/**
     * 获取文件输入流
     *
     * @param objectKey 对象键
     * @return 文件输入流
     */</span>
    public InputStream <span class="hljs-built_in">getFileInputStream</span>(String objectKey) {
        if (!isEnabled()) {
            throw new <span class="hljs-built_in">IllegalStateException</span>("AWS S3 未启用或未正确配置");
        }

        try {
            GetObjectRequest getObjectRequest = GetObjectRequest<span class="hljs-selector-class">.builder</span>()
                    <span class="hljs-selector-class">.bucket</span>(awsProperties.getBucket())
                    <span class="hljs-selector-class">.key</span>(objectKey)
                    <span class="hljs-selector-class">.build</span>();

            ResponseInputStream&lt;GetObjectResponse&gt; response = s3Client<span class="hljs-selector-class">.getObject</span>(getObjectRequest);
            log<span class="hljs-selector-class">.info</span>("AWS S3 文件流获取成功: key={}", objectKey);
            return response;
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("AWS S3 文件流获取失败: key={}", objectKey, e);
            throw new <span class="hljs-built_in">RuntimeException</span>("文件流获取失败: " + e.getMessage(), e);
        }
    }

    <span class="hljs-comment">/**
     * 删除文件
     *
     * @param objectKey 对象键
     */</span>
    public void <span class="hljs-built_in">deleteFile</span>(String objectKey) {
        if (!isEnabled()) {
            throw new <span class="hljs-built_in">IllegalStateException</span>("AWS S3 未启用或未正确配置");
        }

        try {
            DeleteObjectRequest deleteObjectRequest = DeleteObjectRequest<span class="hljs-selector-class">.builder</span>()
                    <span class="hljs-selector-class">.bucket</span>(awsProperties.getBucket())
                    <span class="hljs-selector-class">.key</span>(objectKey)
                    <span class="hljs-selector-class">.build</span>();

            s3Client<span class="hljs-selector-class">.deleteObject</span>(deleteObjectRequest);
            log<span class="hljs-selector-class">.info</span>("AWS S3 文件删除成功: key={}", objectKey);
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("AWS S3 文件删除失败: key={}", objectKey, e);
            throw new <span class="hljs-built_in">RuntimeException</span>("文件删除失败: " + e.getMessage(), e);
        }
    }

    <span class="hljs-comment">/**
     * 检查文件是否存在
     *
     * @param objectKey 对象键
     * @return 是否存在
     */</span>
    public boolean <span class="hljs-built_in">fileExists</span>(String objectKey) {
        if (!isEnabled()) {
            return false;
        }

        try {
            HeadObjectRequest headObjectRequest = HeadObjectRequest<span class="hljs-selector-class">.builder</span>()
                    <span class="hljs-selector-class">.bucket</span>(awsProperties.getBucket())
                    <span class="hljs-selector-class">.key</span>(objectKey)
                    <span class="hljs-selector-class">.build</span>();

            s3Client<span class="hljs-selector-class">.headObject</span>(headObjectRequest);
            return true;
        } catch (NoSuchKeyException e) {
            return false;
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("AWS S3 检查文件存在性失败: key={}", objectKey, e);
            return false;
        }
    }

    <span class="hljs-comment">/**
     * 生成预签名 URL（用于下载）
     *
     * @param objectKey 对象键
     * @param forceInline 是否强制内联显示（用于预览）
     * @return 预签名 URL
     */</span>
    public String <span class="hljs-built_in">generatePresignedUrl</span>(String objectKey, boolean forceInline) {
        if (!isEnabled()) {
            throw new <span class="hljs-built_in">IllegalStateException</span>("AWS S3 未启用或未正确配置");
        }

        try {
            GetObjectRequest<span class="hljs-selector-class">.Builder</span> requestBuilder = GetObjectRequest<span class="hljs-selector-class">.builder</span>()
                    <span class="hljs-selector-class">.bucket</span>(awsProperties.getBucket())
                    <span class="hljs-selector-class">.key</span>(objectKey);

            if (forceInline) {
                requestBuilder<span class="hljs-selector-class">.responseContentDisposition</span>("inline");
            }

            GetObjectRequest objectRequest = requestBuilder<span class="hljs-selector-class">.build</span>();

            GetObjectPresignRequest presignRequest = GetObjectPresignRequest<span class="hljs-selector-class">.builder</span>()
                    <span class="hljs-selector-class">.signatureDuration</span>(Duration.ofDays(awsProperties.getDays()))
                    <span class="hljs-selector-class">.getObjectRequest</span>(objectRequest)
                    <span class="hljs-selector-class">.build</span>();

            PresignedGetObjectRequest presignedRequest = s3Presigner<span class="hljs-selector-class">.presignGetObject</span>(presignRequest);
            String url = presignedRequest<span class="hljs-selector-class">.url</span>()<span class="hljs-selector-class">.toString</span>();

            <span class="hljs-comment">// 如果配置了代理域名，替换 URL 中的域名</span>
            if (StringUtils.isNotBlank(awsProperties.getProxyHost())) {
                url = <span class="hljs-built_in">replaceUrlDomain</span>(url, awsProperties.getProxyHost());
            }

            log<span class="hljs-selector-class">.info</span>("生成预签名 URL: key={}, url={}", objectKey, url);
            return url;
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("生成预签名 URL 失败: key={}", objectKey, e);
            throw new <span class="hljs-built_in">RuntimeException</span>("生成预签名 URL 失败: " + e.getMessage(), e);
        }
    }

    <span class="hljs-comment">/**
     * 生成预签名下载 URL（用于文件下载）
     *
     * @param objectKey 对象键
     * @return 预签名下载 URL
     */</span>
    public String <span class="hljs-built_in">generatePresignedDownloadUrl</span>(String objectKey) {
        return <span class="hljs-built_in">generatePresignedDownloadUrl</span>(objectKey, null, null);
    }

    <span class="hljs-comment">/**
     * 生成预签名下载 URL（用于文件下载，支持自定义文件名）
     *
     * @param objectKey 对象键
     * @param filename 下载时的文件名（可选）
     * @return 预签名下载 URL
     */</span>
    public String <span class="hljs-built_in">generatePresignedDownloadUrl</span>(String objectKey, String filename) {
        return <span class="hljs-built_in">generatePresignedDownloadUrl</span>(objectKey, filename, null);
    }

    <span class="hljs-comment">/**
     * 生成预签名下载 URL（用于文件下载，支持自定义文件名和有效期）
     *
     * @param objectKey 对象键
     * @param filename 下载时的文件名（可选，如果为空则使用默认文件名）
     * @param days 有效期（天数，如果为空则使用配置的默认值）
     * @return 预签名下载 URL
     */</span>
    public String <span class="hljs-built_in">generatePresignedDownloadUrl</span>(String objectKey, String filename, Integer days) {
        if (!isEnabled()) {
            throw new <span class="hljs-built_in">IllegalStateException</span>("AWS S3 未启用或未正确配置");
        }

        try {
            GetObjectRequest<span class="hljs-selector-class">.Builder</span> requestBuilder = GetObjectRequest<span class="hljs-selector-class">.builder</span>()
                    <span class="hljs-selector-class">.bucket</span>(awsProperties.getBucket())
                    <span class="hljs-selector-class">.key</span>(objectKey);

            <span class="hljs-comment">// 如果指定了文件名，设置下载时的文件名</span>
            if (StringUtils.isNotBlank(filename)) {
                requestBuilder<span class="hljs-selector-class">.responseContentDisposition</span>("attachment; filename="" + filename + """);
            } else {
                <span class="hljs-comment">// 默认设置为附件下载</span>
                requestBuilder<span class="hljs-selector-class">.responseContentDisposition</span>("attachment");
            }

            GetObjectRequest objectRequest = requestBuilder<span class="hljs-selector-class">.build</span>();

            <span class="hljs-comment">// 使用指定的有效期或配置的默认值</span>
            int signatureDays = days != null ? days : awsProperties.<span class="hljs-built_in">getDays</span>();
            GetObjectPresignRequest presignRequest = GetObjectPresignRequest<span class="hljs-selector-class">.builder</span>()
                    <span class="hljs-selector-class">.signatureDuration</span>(Duration.ofDays(signatureDays))
                    <span class="hljs-selector-class">.getObjectRequest</span>(objectRequest)
                    <span class="hljs-selector-class">.build</span>();

            PresignedGetObjectRequest presignedRequest = s3Presigner<span class="hljs-selector-class">.presignGetObject</span>(presignRequest);
            String url = presignedRequest<span class="hljs-selector-class">.url</span>()<span class="hljs-selector-class">.toString</span>();

            <span class="hljs-comment">// 如果配置了代理域名，替换 URL 中的域名</span>
            if (StringUtils.isNotBlank(awsProperties.getProxyHost())) {
                url = <span class="hljs-built_in">replaceUrlDomain</span>(url, awsProperties.getProxyHost());
            }

            log<span class="hljs-selector-class">.info</span>("生成预签名下载 URL: key={}, filename={}, days={}, url={}", objectKey, filename, signatureDays, url);
            return url;
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("生成预签名下载 URL 失败: key={}, filename={}", objectKey, filename, e);
            throw new <span class="hljs-built_in">RuntimeException</span>("生成预签名下载 URL 失败: " + e.getMessage(), e);
        }
    }

    <span class="hljs-comment">/**
     * 生成预签名上传 URL
     *
     * @param objectKey 对象键
     * @return 预签名上传 URL
     */</span>
    public String <span class="hljs-built_in">generatePresignedPutUrl</span>(String objectKey) {
        if (!isEnabled()) {
            throw new <span class="hljs-built_in">IllegalStateException</span>("AWS S3 未启用或未正确配置");
        }

        try {
            PutObjectRequest putObjectRequest = PutObjectRequest<span class="hljs-selector-class">.builder</span>()
                    <span class="hljs-selector-class">.bucket</span>(awsProperties.getBucket())
                    <span class="hljs-selector-class">.key</span>(objectKey)
                    <span class="hljs-selector-class">.build</span>();

            PutObjectPresignRequest presignRequest = PutObjectPresignRequest<span class="hljs-selector-class">.builder</span>()
                    <span class="hljs-selector-class">.signatureDuration</span>(Duration.ofDays(awsProperties.getDays()))
                    <span class="hljs-selector-class">.putObjectRequest</span>(putObjectRequest)
                    <span class="hljs-selector-class">.build</span>();

            PresignedPutObjectRequest presignedRequest = s3Presigner<span class="hljs-selector-class">.presignPutObject</span>(presignRequest);
            String url = presignedRequest<span class="hljs-selector-class">.url</span>()<span class="hljs-selector-class">.toString</span>();

            log<span class="hljs-selector-class">.info</span>("生成预签名上传 URL: key={}, url={}", objectKey, url);
            return url;
        } catch (Exception e) {
            log<span class="hljs-selector-class">.error</span>("生成预签名上传 URL 失败: key={}", objectKey, e);
            throw new <span class="hljs-built_in">RuntimeException</span>("生成预签名上传 URL 失败: " + e.getMessage(), e);
        }
    }

    <span class="hljs-comment">/**
     * 替换 URL 中的域名
     *
     * @param originalUrl 原始 URL
     * @param targetDomain 目标域名
     * @return 替换后的 URL
     */</span>
    private String <span class="hljs-built_in">replaceUrlDomain</span>(String originalUrl, String targetDomain) {
        try {
            URL url = new <span class="hljs-built_in">URL</span>(originalUrl);
            String targetDomainClean = targetDomain<span class="hljs-selector-class">.replaceAll</span>("^https?://", "")<span class="hljs-selector-class">.replaceAll</span>("/$", "");
            String protocol = url<span class="hljs-selector-class">.getProtocol</span>();
            String newUrl = protocol + "://<span class="hljs-string">" + targetDomainClean + url.getPath();
            if (url.getQuery() != null) {
                newUrl += "</span>?<span class="hljs-string">" + url.getQuery();
            }
            return newUrl;
        } catch (Exception e) {
            log.warn("</span>替换 URL 域名失败: originalUrl={}, targetDomain={}", originalUrl, targetDomain, e);
            return originalUrl;
        }
    }
}

</code></pre>
<h2 data-id="heading-4">5、文件上传限制</h2>
<pre><code class="hljs language-kotlin" lang="kotlin">

file:
  upload:
    formatList: pdf
    size: <span class="hljs-number">52428800</span>


<span class="hljs-keyword">package</span> com.yicrm.common.config;

<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-comment">/**
 * 文件上传配置属性
 *
 * <span class="hljs-doctag">@author</span> yicrm
 * <span class="hljs-doctag">@since</span> 2026-01-29
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@ConfigurationProperties(prefix = <span class="hljs-string">"file.upload"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileUploadProperties</span> {

    <span class="hljs-comment">/**
     * 允许的文件格式列表（逗号分隔，如：pdf,doc,docx）
     */</span>
    <span class="hljs-keyword">private</span> String formatList = <span class="hljs-string">""</span>;

    <span class="hljs-comment">/**
     * 文件大小限制（字节），默认 50MB
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> size = <span class="hljs-number">50</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024L</span>;
}
</code></pre>
<h2 data-id="heading-5">6、AWS实现类</h2>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.yicrm.biz.service.business;

<span class="hljs-keyword">import</span> com.yicrm.common.config.FileUploadProperties;
<span class="hljs-keyword">import</span> com.yicrm.common.core.domain.AjaxResult;
<span class="hljs-keyword">import</span> com.yicrm.common.utils.aws.AwsUploadResult;
<span class="hljs-keyword">import</span> com.yicrm.common.utils.aws.AwsUtils;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.apache.commons.lang3.StringUtils;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;

<span class="hljs-keyword">import</span> javax.<span class="hljs-keyword">annotation</span>.Resource;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Arrays;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * 文件上传下载业务服务
 *
 * <span class="hljs-doctag">@author</span> yicrm
 * <span class="hljs-doctag">@since</span> 2026-01-29
 */</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileUploadBusinessService</span> {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> AwsUtils awsUtils;

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> FileUploadProperties fileUploadProperties;

    <span class="hljs-comment">/**
     * AWS S3 文件上传（单个）
     *
     * <span class="hljs-doctag">@param</span> file 文件
     * <span class="hljs-doctag">@return</span> 上传结果
     */</span>
    <span class="hljs-keyword">public</span> AjaxResult uploadFile(MultipartFile file) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (file == <span class="hljs-literal">null</span> || file.isEmpty()) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"文件不能为空"</span>);
            }

            <span class="hljs-comment">// 验证文件格式和大小</span>
            AjaxResult validationResult = validateFile(file);
            <span class="hljs-keyword">if</span> (validationResult != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> validationResult;
            }

            <span class="hljs-keyword">if</span> (!awsUtils.isEnabled()) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"AWS S3 未启用或未正确配置"</span>);
            }

            AwsUploadResult result = awsUtils.uploadFile(file);

            Map&lt;String, Object&gt; <span class="hljs-keyword">data</span> = new HashMap&lt;&gt;();
            <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"key"</span>, result.getKey());
            <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"url"</span>, result.getUrl());
            <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"fileName"</span>, result.getKey());
            <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"originalFilename"</span>, result.getOriginalFilename());
            <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"size"</span>, result.getSize());
            <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"contentType"</span>, result.getContentType());
<span class="hljs-comment">//            data.put("contentType", "application/octet-stream");</span>
<span class="hljs-comment">//            data.put("Content-Disposition", "attachment; filename="+result.getOriginalFilename());</span>

            <span class="hljs-keyword">return</span> AjaxResult.success(<span class="hljs-string">"文件上传成功"</span>, <span class="hljs-keyword">data</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"AWS S3 文件上传失败"</span>, e);
            <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"文件上传失败: "</span> + e.getMessage());
        }
    }

    <span class="hljs-comment">/**
     * AWS S3 文件上传（多个）
     *
     * <span class="hljs-doctag">@param</span> files 文件列表
     * <span class="hljs-doctag">@return</span> 上传结果
     */</span>
    <span class="hljs-keyword">public</span> AjaxResult uploadFiles(List&lt;MultipartFile&gt; files) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (files == <span class="hljs-literal">null</span> || files.isEmpty()) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"文件列表不能为空"</span>);
            }

            <span class="hljs-keyword">if</span> (!awsUtils.isEnabled()) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"AWS S3 未启用或未正确配置"</span>);
            }

            List&lt;Map&lt;String, Object&gt;&gt; results = new ArrayList&lt;&gt;();
            List&lt;String&gt; keys = new ArrayList&lt;&gt;();
            List&lt;String&gt; urls = new ArrayList&lt;&gt;();
            List&lt;String&gt; fileNames = new ArrayList&lt;&gt;();
            List&lt;String&gt; originalFilenames = new ArrayList&lt;&gt;();

            <span class="hljs-keyword">for</span> (MultipartFile file : files) {
                <span class="hljs-keyword">if</span> (file.isEmpty()) {
                    <span class="hljs-keyword">continue</span>;
                }

                <span class="hljs-comment">// 验证文件格式和大小</span>
                AjaxResult validationResult = validateFile(file);
                <span class="hljs-keyword">if</span> (validationResult != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// 如果验证失败，返回错误信息</span>
                    <span class="hljs-keyword">return</span> validationResult;
                }

                AwsUploadResult result = awsUtils.uploadFile(file);

                Map&lt;String, Object&gt; <span class="hljs-keyword">data</span> = new HashMap&lt;&gt;();
                <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"key"</span>, result.getKey());
                <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"url"</span>, result.getUrl());
                <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"fileName"</span>, result.getKey());
                <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"originalFilename"</span>, result.getOriginalFilename());
                <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"size"</span>, result.getSize());
                <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"contentType"</span>, result.getContentType());

                results.add(<span class="hljs-keyword">data</span>);
                keys.add(result.getKey());
                urls.add(result.getUrl());
                fileNames.add(result.getKey());
                originalFilenames.add(result.getOriginalFilename());
            }

            Map&lt;String, Object&gt; responseData = new HashMap&lt;&gt;();
            responseData.put(<span class="hljs-string">"results"</span>, results);
            responseData.put(<span class="hljs-string">"keys"</span>, StringUtils.join(keys, <span class="hljs-string">","</span>));
            responseData.put(<span class="hljs-string">"urls"</span>, StringUtils.join(urls, <span class="hljs-string">","</span>));
            responseData.put(<span class="hljs-string">"fileNames"</span>, StringUtils.join(fileNames, <span class="hljs-string">","</span>));
            responseData.put(<span class="hljs-string">"originalFilenames"</span>, StringUtils.join(originalFilenames, <span class="hljs-string">","</span>));

            <span class="hljs-keyword">return</span> AjaxResult.success(<span class="hljs-string">"文件上传成功"</span>, responseData);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"AWS S3 批量文件上传失败"</span>, e);
            <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"文件上传失败: "</span> + e.getMessage());
        }
    }

    <span class="hljs-comment">/**
     * 生成 AWS S3 预签名下载 URL
     *
     * <span class="hljs-doctag">@param</span> key 对象键（S3 中的文件路径）
     * <span class="hljs-doctag">@param</span> filename 下载时的文件名（可选）
     * <span class="hljs-doctag">@param</span> days 有效期（天数，可选，默认使用配置值）
     * <span class="hljs-doctag">@return</span> 预签名下载 URL
     */</span>
    <span class="hljs-keyword">public</span> AjaxResult generateDownloadUrl(String key, String filename, Integer days) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (StringUtils.isBlank(key)) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"对象键不能为空"</span>);
            }

            <span class="hljs-keyword">if</span> (!awsUtils.isEnabled()) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"AWS S3 未启用或未正确配置"</span>);
            }

            String downloadUrl;
            <span class="hljs-keyword">if</span> (filename != <span class="hljs-literal">null</span> &amp;&amp; days != <span class="hljs-literal">null</span>) {
                downloadUrl = awsUtils.generatePresignedDownloadUrl(key, filename, days);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (filename != <span class="hljs-literal">null</span>) {
                downloadUrl = awsUtils.generatePresignedDownloadUrl(key, filename);
            } <span class="hljs-keyword">else</span> {
                downloadUrl = awsUtils.generatePresignedDownloadUrl(key);
            }

            Map&lt;String, Object&gt; <span class="hljs-keyword">data</span> = new HashMap&lt;&gt;();
            <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"url"</span>, downloadUrl);
            <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"key"</span>, key);
            <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"filename"</span>, filename);

            <span class="hljs-keyword">return</span> AjaxResult.success(<span class="hljs-string">"生成下载 URL 成功"</span>, <span class="hljs-keyword">data</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"生成 AWS S3 下载 URL 失败: key={}"</span>, key, e);
            <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"生成下载 URL 失败: "</span> + e.getMessage());
        }
    }

    <span class="hljs-comment">/**
     * 生成 AWS S3 预签名预览 URL
     *
     * <span class="hljs-doctag">@param</span> key 对象键（S3 中的文件路径）
     * <span class="hljs-doctag">@return</span> 预签名预览 URL
     */</span>
    <span class="hljs-keyword">public</span> AjaxResult generatePreviewUrl(String key) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (StringUtils.isBlank(key)) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"对象键不能为空"</span>);
            }

            <span class="hljs-keyword">if</span> (!awsUtils.isEnabled()) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"AWS S3 未启用或未正确配置"</span>);
            }

            String previewUrl = awsUtils.generatePresignedUrl(key, <span class="hljs-literal">true</span>);

            Map&lt;String, Object&gt; <span class="hljs-keyword">data</span> = new HashMap&lt;&gt;();
            <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"url"</span>, previewUrl);
            <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"key"</span>, key);

            <span class="hljs-keyword">return</span> AjaxResult.success(<span class="hljs-string">"生成预览 URL 成功"</span>, <span class="hljs-keyword">data</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"生成 AWS S3 预览 URL 失败: key={}"</span>, key, e);
            <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"生成预览 URL 失败: "</span> + e.getMessage());
        }
    }

    <span class="hljs-comment">/**
     * 删除 AWS S3 文件
     *
     * <span class="hljs-doctag">@param</span> key 对象键（S3 中的文件路径）
     * <span class="hljs-doctag">@return</span> 删除结果
     */</span>
    <span class="hljs-keyword">public</span> AjaxResult deleteFile(String key) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (StringUtils.isBlank(key)) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"对象键不能为空"</span>);
            }

            <span class="hljs-keyword">if</span> (!awsUtils.isEnabled()) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"AWS S3 未启用或未正确配置"</span>);
            }

            awsUtils.deleteFile(key);

            <span class="hljs-keyword">return</span> AjaxResult.success(<span class="hljs-string">"文件删除成功"</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"删除 AWS S3 文件失败: key={}"</span>, key, e);
            <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"文件删除失败: "</span> + e.getMessage());
        }
    }

    <span class="hljs-comment">/**
     * 检查 AWS S3 文件是否存在
     *
     * <span class="hljs-doctag">@param</span> key 对象键（S3 中的文件路径）
     * <span class="hljs-doctag">@return</span> 是否存在
     */</span>
    <span class="hljs-keyword">public</span> AjaxResult checkFileExists(String key) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (StringUtils.isBlank(key)) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"对象键不能为空"</span>);
            }

            <span class="hljs-keyword">if</span> (!awsUtils.isEnabled()) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"AWS S3 未启用或未正确配置"</span>);
            }

            boolean exists = awsUtils.fileExists(key);

            Map&lt;String, Object&gt; <span class="hljs-keyword">data</span> = new HashMap&lt;&gt;();
            <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"exists"</span>, exists);
            <span class="hljs-keyword">data</span>.put(<span class="hljs-string">"key"</span>, key);

            <span class="hljs-keyword">return</span> AjaxResult.success(<span class="hljs-string">"检查完成"</span>, <span class="hljs-keyword">data</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"检查 AWS S3 文件存在性失败: key={}"</span>, key, e);
            <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"检查失败: "</span> + e.getMessage());
        }
    }

    <span class="hljs-comment">/**
     * 验证文件格式和大小
     *
     * <span class="hljs-doctag">@param</span> file 文件
     * <span class="hljs-doctag">@return</span> 验证失败返回错误结果，验证成功返回 null
     */</span>
    <span class="hljs-keyword">private</span> AjaxResult validateFile(MultipartFile file) {
        <span class="hljs-comment">// 验证文件大小</span>
        <span class="hljs-keyword">if</span> (fileUploadProperties.getSize() != <span class="hljs-literal">null</span> &amp;&amp; file.getSize() &gt; fileUploadProperties.getSize()) {
            long maxSizeMB = fileUploadProperties.getSize() / <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>;
            <span class="hljs-keyword">return</span> AjaxResult.error(String.format(<span class="hljs-string">"文件大小超出限制，允许的最大文件大小为：%d MB"</span>, maxSizeMB));
        }

        <span class="hljs-comment">// 验证文件格式</span>
        <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(fileUploadProperties.getFormatList())) {
            String originalFilename = file.getOriginalFilename();
            <span class="hljs-keyword">if</span> (StringUtils.isBlank(originalFilename)) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"文件名不能为空"</span>);
            }

            <span class="hljs-comment">// 获取文件扩展名</span>
            String extension = getFileExtension(originalFilename);
            <span class="hljs-keyword">if</span> (StringUtils.isBlank(extension)) {
                <span class="hljs-keyword">return</span> AjaxResult.error(<span class="hljs-string">"文件格式不支持，无法识别文件类型"</span>);
            }

            <span class="hljs-comment">// 解析允许的格式列表</span>
            String[] allowedFormats = fileUploadProperties.getFormatList().split(<span class="hljs-string">","</span>);
            List&lt;String&gt; allowedFormatList = new ArrayList&lt;&gt;();
            <span class="hljs-keyword">for</span> (String format : allowedFormats) {
                String trimmedFormat = format.trim().toLowerCase();
                <span class="hljs-keyword">if</span> (StringUtils.isNotBlank(trimmedFormat)) {
                    allowedFormatList.add(trimmedFormat);
                }
            }

            <span class="hljs-comment">// 检查文件格式是否在允许列表中</span>
            <span class="hljs-keyword">if</span> (!allowedFormatList.isEmpty() &amp;&amp; !allowedFormatList.contains(extension.toLowerCase())) {
                <span class="hljs-keyword">return</span> AjaxResult.error(String.format(<span class="hljs-string">"文件格式不支持，允许的格式为：%s，当前文件格式：%s"</span>,
                        fileUploadProperties.getFormatList(), extension));
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// 验证通过</span>
    }

    <span class="hljs-comment">/**
     * 获取文件扩展名
     *
     * <span class="hljs-doctag">@param</span> filename 文件名
     * <span class="hljs-doctag">@return</span> 扩展名（不包含点）
     */</span>
    <span class="hljs-keyword">private</span> String getFileExtension(String filename) {
        <span class="hljs-keyword">if</span> (StringUtils.isBlank(filename)) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
        int lastDotIndex = filename.lastIndexOf(<span class="hljs-string">'.'</span>);
        <span class="hljs-keyword">if</span> (lastDotIndex &gt; <span class="hljs-number">0</span> &amp;&amp; lastDotIndex &lt; filename.length() - <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> filename.substring(lastDotIndex + <span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
}
</code></pre>
<h2 data-id="heading-6">7、controller实现</h2>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.yicrm</span><span class="hljs-selector-class">.biz</span><span class="hljs-selector-class">.controller</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.yicrm</span><span class="hljs-selector-class">.biz</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-class">.business</span><span class="hljs-selector-class">.FileUploadBusinessService</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.yicrm</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.domain</span><span class="hljs-selector-class">.AjaxResult</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.Operation</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.media</span><span class="hljs-selector-class">.Content</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.media</span><span class="hljs-selector-class">.Schema</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.responses</span><span class="hljs-selector-class">.ApiResponse</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.responses</span><span class="hljs-selector-class">.ApiResponses</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.v3</span><span class="hljs-selector-class">.oas</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.tags</span><span class="hljs-selector-class">.Tag</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.security</span><span class="hljs-selector-class">.access</span><span class="hljs-selector-class">.prepost</span><span class="hljs-selector-class">.PreAuthorize</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.multipart</span><span class="hljs-selector-class">.MultipartFile</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">javax</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Resource</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.util</span><span class="hljs-selector-class">.List</span>;

<span class="hljs-comment">/**
 * 文件上传下载控制器
 *
 * @author yicrm
 * @since 2026-01-29
 */</span>
@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/file"</span>)
@<span class="hljs-selector-tag">Tag</span>(name = <span class="hljs-string">"文件上传下载"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">FileUploadController</span> {

    <span class="hljs-variable">@Resource</span>
    private FileUploadBusinessService fileUploadBusinessService;

    <span class="hljs-comment">/**
     * AWS S3 文件上传（单个）
     *
     * @param file 文件
     * @return 上传结果
     */</span>
    <span class="hljs-variable">@Operation</span>(summary = <span class="hljs-string">"AWS S3 文件上传（单个）"</span>, description = <span class="hljs-string">"上传单个文件到 AWS S3"</span>)
    <span class="hljs-variable">@ApiResponses</span>({
            <span class="hljs-variable">@ApiResponse</span>(responseCode = <span class="hljs-string">"200"</span>, description = <span class="hljs-string">"上传成功"</span>,
                    content = <span class="hljs-variable">@Content</span>(schema = <span class="hljs-variable">@Schema</span>(implementation = AjaxResult.class))),
            <span class="hljs-variable">@ApiResponse</span>(responseCode = <span class="hljs-string">"500"</span>, description = <span class="hljs-string">"上传失败"</span>)
    })
    <span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/aws/upload"</span>)
<span class="hljs-comment">//    @PreAuthorize("@ss.hasPermi('file:upload')")</span>
    public AjaxResult <span class="hljs-built_in">uploadFileToAws</span>(<span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"file"</span>) MultipartFile file) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">fileUploadBusinessService</span><span class="hljs-selector-class">.uploadFile</span>(file);
    }

    <span class="hljs-comment">/**
     * AWS S3 文件上传（多个）
     *
     * @param files 文件列表
     * @return 上传结果
     */</span>
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"AWS S3 文件上传（多个）"</span>, description = <span class="hljs-string">"批量上传多个文件到 AWS S3"</span>)
    @<span class="hljs-selector-tag">ApiResponses</span>({
            <span class="hljs-variable">@ApiResponse</span>(responseCode = <span class="hljs-string">"200"</span>, description = <span class="hljs-string">"上传成功"</span>,
                    content = <span class="hljs-variable">@Content</span>(schema = <span class="hljs-variable">@Schema</span>(implementation = AjaxResult.class))),
            <span class="hljs-variable">@ApiResponse</span>(responseCode = <span class="hljs-string">"500"</span>, description = <span class="hljs-string">"上传失败"</span>)
    })
    @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/aws/uploads"</span>)
<span class="hljs-comment">//    @PreAuthorize("@ss.hasPermi('file:upload')")</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">AjaxResult</span> <span class="hljs-selector-tag">uploadFilesToAws</span>(<span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"files"</span>) List&lt;MultipartFile&gt; files) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">fileUploadBusinessService</span><span class="hljs-selector-class">.uploadFiles</span>(files);
    }

    <span class="hljs-comment">/**
     * 生成 AWS S3 预签名下载 URL
     *
     * @param key 对象键（S3 中的文件路径）
     * @param filename 下载时的文件名（可选）
     * @param days 有效期（天数，可选，默认使用配置值）
     * @return 预签名下载 URL
     */</span>
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"生成 AWS S3 预签名下载 URL"</span>, description = <span class="hljs-string">"生成用于文件下载的预签名 URL"</span>)
    @<span class="hljs-selector-tag">ApiResponses</span>({
            <span class="hljs-variable">@ApiResponse</span>(responseCode = <span class="hljs-string">"200"</span>, description = <span class="hljs-string">"生成成功"</span>,
                    content = <span class="hljs-variable">@Content</span>(schema = <span class="hljs-variable">@Schema</span>(implementation = AjaxResult.class))),
            <span class="hljs-variable">@ApiResponse</span>(responseCode = <span class="hljs-string">"500"</span>, description = <span class="hljs-string">"生成失败"</span>)
    })
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/aws/download/url"</span>)
<span class="hljs-comment">//    @PreAuthorize("@ss.hasPermi('file:download')")</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">AjaxResult</span> <span class="hljs-selector-tag">generateDownloadUrl</span>(
            <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"key"</span>) String key,
            <span class="hljs-variable">@RequestParam</span>(value = <span class="hljs-string">"filename"</span>, required = false) String filename,
            <span class="hljs-variable">@RequestParam</span>(value = <span class="hljs-string">"days"</span>, required = false) Integer days) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">fileUploadBusinessService</span><span class="hljs-selector-class">.generateDownloadUrl</span>(key, filename, days);
    }

    <span class="hljs-comment">/**
     * 生成 AWS S3 预签名预览 URL
     *
     * @param key 对象键（S3 中的文件路径）
     * @return 预签名预览 URL
     */</span>
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"生成 AWS S3 预签名预览 URL"</span>, description = <span class="hljs-string">"生成用于文件预览的预签名 URL"</span>)
    @<span class="hljs-selector-tag">ApiResponses</span>({
            <span class="hljs-variable">@ApiResponse</span>(responseCode = <span class="hljs-string">"200"</span>, description = <span class="hljs-string">"生成成功"</span>,
                    content = <span class="hljs-variable">@Content</span>(schema = <span class="hljs-variable">@Schema</span>(implementation = AjaxResult.class))),
            <span class="hljs-variable">@ApiResponse</span>(responseCode = <span class="hljs-string">"500"</span>, description = <span class="hljs-string">"生成失败"</span>)
    })
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/aws/preview/url"</span>)
<span class="hljs-comment">//    @PreAuthorize("@ss.hasPermi('file:preview')")</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">AjaxResult</span> <span class="hljs-selector-tag">generatePreviewUrl</span>(<span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"key"</span>) String key) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">fileUploadBusinessService</span><span class="hljs-selector-class">.generatePreviewUrl</span>(key);
    }

    <span class="hljs-comment">/**
     * 删除 AWS S3 文件
     *
     * @param key 对象键（S3 中的文件路径）
     * @return 删除结果
     */</span>
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"删除 AWS S3 文件"</span>, description = <span class="hljs-string">"从 AWS S3 删除指定文件"</span>)
    @<span class="hljs-selector-tag">ApiResponses</span>({
            <span class="hljs-variable">@ApiResponse</span>(responseCode = <span class="hljs-string">"200"</span>, description = <span class="hljs-string">"删除成功"</span>,
                    content = <span class="hljs-variable">@Content</span>(schema = <span class="hljs-variable">@Schema</span>(implementation = AjaxResult.class))),
            <span class="hljs-variable">@ApiResponse</span>(responseCode = <span class="hljs-string">"500"</span>, description = <span class="hljs-string">"删除失败"</span>)
    })
    @<span class="hljs-selector-tag">DeleteMapping</span>(<span class="hljs-string">"/aws/delete"</span>)
<span class="hljs-comment">//    @PreAuthorize("@ss.hasPermi('file:delete')")</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">AjaxResult</span> <span class="hljs-selector-tag">deleteFileFromAws</span>(<span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"key"</span>) String key) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">fileUploadBusinessService</span><span class="hljs-selector-class">.deleteFile</span>(key);
    }

    <span class="hljs-comment">/**
     * 检查 AWS S3 文件是否存在
     *
     * @param key 对象键（S3 中的文件路径）
     * @return 是否存在
     */</span>
    @<span class="hljs-selector-tag">Operation</span>(summary = <span class="hljs-string">"检查 AWS S3 文件是否存在"</span>, description = <span class="hljs-string">"检查指定文件是否存在于 AWS S3"</span>)
    @<span class="hljs-selector-tag">ApiResponses</span>({
            <span class="hljs-variable">@ApiResponse</span>(responseCode = <span class="hljs-string">"200"</span>, description = <span class="hljs-string">"检查完成"</span>,
                    content = <span class="hljs-variable">@Content</span>(schema = <span class="hljs-variable">@Schema</span>(implementation = AjaxResult.class))),
            <span class="hljs-variable">@ApiResponse</span>(responseCode = <span class="hljs-string">"500"</span>, description = <span class="hljs-string">"检查失败"</span>)
    })
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/aws/exists"</span>)
<span class="hljs-comment">//    @PreAuthorize("@ss.hasPermi('file:query')")</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">AjaxResult</span> <span class="hljs-selector-tag">checkFileExists</span>(<span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"key"</span>) String key) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">fileUploadBusinessService</span><span class="hljs-selector-class">.checkFileExists</span>(key);
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【NestJs】如何使用Prisma实现@Transactional装饰器开启事务并且跨Service传递]]></title>    <link>https://juejin.cn/post/7605213691910930458</link>    <guid>https://juejin.cn/post/7605213691910930458</guid>    <pubDate>2026-02-11T09:57:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605213691910930458" data-draft-id="7605173538417360906" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【NestJs】如何使用Prisma实现@Transactional装饰器开启事务并且跨Service传递"/> <meta itemprop="keywords" content="NestJS"/> <meta itemprop="datePublished" content="2026-02-11T09:57:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="None321"/> <meta itemprop="url" content="https://juejin.cn/user/2663468644966576"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【NestJs】如何使用Prisma实现@Transactional装饰器开启事务并且跨Service传递
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2663468644966576/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    None321
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:57:53.000Z" title="Wed Feb 11 2026 09:57:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在NestJs中我们要开启Prisma事务要这样</p>
<pre><code class="hljs language-ts" lang="ts">    <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.$transaction(<span class="hljs-function"><span class="hljs-params">tx</span>=&gt;</span>{
        <span class="hljs-comment">//通过tx传递使用事务 </span>
        tx.<span class="hljs-property">user</span>.<span class="hljs-property">update</span> ... 
        <span class="hljs-comment">//当我这样调用transaction还无法进行事务传递 当然这个可以通过Proxy代理实现 这里就不做演示了</span>
        ts.<span class="hljs-property">$transaction</span>
    })
</code></pre>
<p>传统的事务开启方式非常复杂，而且当我们跨方法时需要重复的去开启事务，导致数据库事务开关导致一定的消耗，并且业务代码看的也不是很舒服。</p>
<pre><code class="hljs language-typescript" lang="typescript">    <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestService</span> {
        <span class="hljs-meta">@Inject</span>(prisma)
        <span class="hljs-keyword">private</span> <span class="hljs-attr">prisma</span>:<span class="hljs-title class_">PrismaService</span>
        <span class="hljs-title function_">updateUser</span>(<span class="hljs-params"/>){
           <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.$transaction(<span class="hljs-function"><span class="hljs-params">tx</span>=&gt;</span>{
               <span class="hljs-comment">//开启事务</span>
               <span class="hljs-comment">//...模拟user中进行了很多操作</span>
               tx.<span class="hljs-property">user</span>.<span class="hljs-property">update</span>...
               tx.<span class="hljs-property">user</span>.<span class="hljs-property">create</span>...
               <span class="hljs-comment">//接着需要在order中执行操作</span>
               <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateOrder</span>()
           
           })
        }
        
        <span class="hljs-title function_">updateOrder</span>(<span class="hljs-params"/>){
            <span class="hljs-comment">//order执行操作必须得重新开启事务</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.$transaction(<span class="hljs-function"><span class="hljs-params">tx</span>=&gt;</span>{
                tx.<span class="hljs-property">order</span>.<span class="hljs-property">update</span> ...
            })
        }
    }
    
</code></pre>
<p>从代码中可以看出我们在跨方法或者跨Service中去执行事务数据库操作需要通过Prisma重复的去开启事务。
我现在期望这样实现事务</p>
<pre><code class="hljs language-typescript" lang="typescript">    <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestService</span> {
        <span class="hljs-meta">@Inject</span>(prisma)
        <span class="hljs-keyword">private</span> <span class="hljs-attr">prisma</span>:<span class="hljs-title class_">PrismaService</span>
        
        <span class="hljs-meta">@Transaction</span>() <span class="hljs-comment">//加入@Transaction()装饰器一键开启事务 并且可跨服务传递</span>
        <span class="hljs-title function_">updateUser</span>(<span class="hljs-params"/>){
               <span class="hljs-comment">//无需手动开启事务 直接使用prisma实例</span>
               <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.<span class="hljs-property">user</span>.<span class="hljs-property">update</span>...
               <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.<span class="hljs-property">user</span>.<span class="hljs-property">create</span>...
               <span class="hljs-comment">//接着需要在order中执行操作</span>
               <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateOrder</span>()

        }
        
        <span class="hljs-title function_">updateOrder</span>(<span class="hljs-params"/>){
            <span class="hljs-comment">//直接调用prisma执行</span>
            tthis.<span class="hljs-property">prisma</span>.<span class="hljs-property">order</span>.<span class="hljs-property">update</span> ...
        }
    }
    
</code></pre>
<p>如何实现呢？</p>
<p>最简单的方式是可以通过第三方包<code>nestjs-cls + @nestjs-cls/transactional-adapter-prisma </code>实现，这里通过第三方包实现就不做讲解了 有兴趣可以自己去npm上查看，秉持着学习的心态我想自己去了解如何实现这样的功能。</p>
<p>首先要使用到<code>AsyncLocalStorage</code> 是 Node.js 提供的重要的异步上下文管理工具，<code>AsyncLocalStorage</code> 让上下文像“线程本地变量”（ThreadLocal）一样跟随异步执行上下文自动传播。
让我们出创建第一个文件</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// transaction/transaction-context.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">AsyncLocalStorage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:async_hooks'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrismaClient</span>, <span class="hljs-title class_">Prisma</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@prisma/client'</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PrismaTx</span> = <span class="hljs-title class_">Prisma</span>.<span class="hljs-property">TransactionClient</span>;<span class="hljs-comment">//定义类型</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">TransactionOptions</span> = { maxWait?: <span class="hljs-built_in">number</span>, timeout?: <span class="hljs-built_in">number</span>, isolationLevel?: <span class="hljs-title class_">Prisma</span>.<span class="hljs-property">TransactionIsolationLevel</span> };
<span class="hljs-keyword">const</span> storage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncLocalStorage</span>&lt;{ <span class="hljs-attr">tx</span>: <span class="hljs-title class_">PrismaTx</span> }&gt;();<span class="hljs-comment">//创建context 保存事务tx的prisma实例</span>

<span class="hljs-comment">/**
 * 在事务context中执行代码
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> runInTransaction&lt;T&gt;(
  <span class="hljs-attr">prisma</span>: <span class="hljs-title class_">PrismaClient</span>,
  <span class="hljs-attr">fn</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;T&gt;,
  options?: <span class="hljs-title class_">TransactionOptions</span>,
): <span class="hljs-title class_">Promise</span>&lt;T&gt; {
  <span class="hljs-keyword">return</span> prisma.$transaction(<span class="hljs-keyword">async</span> (tx) =&gt; {
    <span class="hljs-keyword">return</span> storage.<span class="hljs-title function_">run</span>({ tx }, fn);
  }, options);
}

<span class="hljs-comment">/**
 * 获取当前事务上下文中的 Prisma TransactionClient
 * 如果不在事务中，返回 null
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getCurrentTx</span>(<span class="hljs-params"/>): <span class="hljs-title class_">PrismaTx</span> | <span class="hljs-literal">null</span> {
  <span class="hljs-keyword">const</span> store = storage.<span class="hljs-title function_">getStore</span>();
  <span class="hljs-keyword">return</span> store?.<span class="hljs-property">tx</span> ?? <span class="hljs-literal">null</span>;
}
</code></pre>
<p>创建装饰器</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// transaction/transactional.decorator.ts</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SetMetadata</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Prisma</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@prisma/client'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TransactionOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./transaction-context'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TRANSACTIONAL_KEY</span> = <span class="hljs-string">'transactional'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">Transactional</span> = (<span class="hljs-params">options: TransactionOptions = {}</span>) =&gt;
  <span class="hljs-title class_">SetMetadata</span>(<span class="hljs-variable constant_">TRANSACTIONAL_KEY</span>, options);
</code></pre>
<p>接下来肯定是要通过拦截器去拦截请求，然后通过Reflect去获取元数据拿到事务的options，最后再通过<code>runInTransaction</code>这个方法去调用就可以了</p>
<p>Interceptor拦截器实现</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// transaction/transaction.interceptor.ts</span>
<span class="hljs-keyword">import</span> {
  <span class="hljs-title class_">CallHandler</span>,
  <span class="hljs-title class_">ExecutionContext</span>,
  <span class="hljs-title class_">Injectable</span>,
  <span class="hljs-title class_">NestInterceptor</span>,
} <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Reflector</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/core'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Observable</span>, <span class="hljs-keyword">from</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'rxjs'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">TRANSACTIONAL_KEY</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./transactional.decorator'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrismaService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../prisma/prisma.service'</span>; <span class="hljs-comment">// 调整路径</span>
<span class="hljs-keyword">import</span> { runInTransaction } <span class="hljs-keyword">from</span> <span class="hljs-string">'./transaction-context'</span>;

<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NestInterceptor</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> reflector: Reflector,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> prisma: PrismaService,
  </span>) {}

  <span class="hljs-title function_">intercept</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">ExecutionContext</span>, <span class="hljs-attr">next</span>: <span class="hljs-title class_">CallHandler</span>): <span class="hljs-title class_">Observable</span>&lt;<span class="hljs-built_in">any</span>&gt; {
    <span class="hljs-keyword">const</span> options = <span class="hljs-variable language_">this</span>.<span class="hljs-property">reflector</span>.<span class="hljs-property">getAllAndOverride</span>&lt;<span class="hljs-title class_">Prisma</span>.<span class="hljs-property">TransactionOptions</span> | <span class="hljs-literal">true</span>&gt;(
      <span class="hljs-variable constant_">TRANSACTIONAL_KEY</span>,
      [context.<span class="hljs-title function_">getHandler</span>(), context.<span class="hljs-title function_">getClass</span>()],
    );

    <span class="hljs-comment">// 没有装饰器 → 直接放行</span>
    <span class="hljs-keyword">if</span> (!options) {
      <span class="hljs-keyword">return</span> next.<span class="hljs-title function_">handle</span>();
    }

    <span class="hljs-keyword">const</span> txOptions = options === <span class="hljs-literal">true</span> ? <span class="hljs-literal">undefined</span> : options;

    <span class="hljs-comment">// 用 runInTransaction 包裹整个方法</span>
    <span class="hljs-keyword">const</span> promise = <span class="hljs-title function_">runInTransaction</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>, <span class="hljs-keyword">async</span> () =&gt; {
      <span class="hljs-keyword">return</span> next.<span class="hljs-title function_">handle</span>().<span class="hljs-property">toPromise</span>?.() ?? next.<span class="hljs-title function_">handle</span>();
    }, txOptions);

    <span class="hljs-keyword">return</span> <span class="hljs-title function_">from</span>(promise);
  }
}
</code></pre>
<p>传统的拦截器通过在请求响应的生命周期中获取到元数据执行了我们需要的transaction逻辑，但是我们这个事务的执行本身并不强行依赖HTTP上下文，如果在未开启<code>@Transactional()</code>的情况下依旧会重复的在HTTP生命周期中请求这个拦截器。</p>
<p>Prisma事务开启本身是业务方法级别的需求，且不限于HTTP接口，也可能是定时任务或者消息队列的消费者等等，所以这里我学习到了另外一种Injector的方法，采用的是<code>Module Init + Proxy </code>的方式实现，来自于一个开源项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyikart%2FAiToEarn" target="_blank" title="https://github.com/yikart/AiToEarn" ref="nofollow noopener noreferrer">github.com/yikart/AiTo…</a>
接下来我们完成<code>transaction.injector.ts</code>的实现吧</p>
<p>Injector实现</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Injectable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common/interfaces'</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">InstanceWrapper</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/core/injector/instance-wrapper'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Injectable</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">InjectableDec</span>, <span class="hljs-title class_">Logger</span>, <span class="hljs-title class_">OnModuleInit</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">MetadataScanner</span>, <span class="hljs-title class_">ModulesContainer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/core'</span>
<span class="hljs-keyword">import</span> { runInTransaction, <span class="hljs-title class_">TransactionOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./transaction-context'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">TRANSACTIONAL_KEY</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./transactional.decorator'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrismaService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../prisma.service'</span>
<span class="hljs-comment">/**
 * 事务注入器
 * 在模块初始化时扫描所有带有 <span class="hljs-doctag">@Transactional</span> 装饰器的方法，
 * 并为这些方法注入事务处理逻辑
 */</span>
<span class="hljs-meta">@InjectableDec</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TransactionalInjector</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OnModuleInit</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> logger = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Logger</span>(<span class="hljs-title class_">TransactionalInjector</span>.<span class="hljs-property">name</span>)
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-attr">metadataScanner</span>: <span class="hljs-title class_">MetadataScanner</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MetadataScanner</span>()
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> prisma: PrismaService,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> modulesContainer: ModulesContainer,
  </span>) {}

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onModuleInit</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> provider <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getProviders</span>()) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">injectToProvider</span>(provider)
    }
  }

  <span class="hljs-keyword">private</span>* <span class="hljs-title function_">getProviders</span>(): <span class="hljs-title class_">Generator</span>&lt;<span class="hljs-title class_">InstanceWrapper</span>&lt;<span class="hljs-title class_">Injectable</span>&gt;&gt; {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">modulesContainer</span>.<span class="hljs-title function_">values</span>()) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> provider <span class="hljs-keyword">of</span> <span class="hljs-variable language_">module</span>.<span class="hljs-property">providers</span>.<span class="hljs-title function_">values</span>()) {
        <span class="hljs-keyword">if</span> (provider &amp;&amp; provider.<span class="hljs-property">metatype</span>?.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>) {
          <span class="hljs-keyword">yield</span> provider <span class="hljs-keyword">as</span> <span class="hljs-title class_">InstanceWrapper</span>&lt;<span class="hljs-title class_">Injectable</span>&gt;
        }
      }
    }
  }

  <span class="hljs-keyword">private</span> <span class="hljs-title function_">injectToProvider</span>(<span class="hljs-attr">wrapper</span>: <span class="hljs-title class_">InstanceWrapper</span>&lt;<span class="hljs-title class_">Injectable</span>&gt;): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> { metatype } = wrapper
    <span class="hljs-keyword">if</span> (!metatype)
      <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">const</span> prototype = metatype.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
    <span class="hljs-keyword">const</span> methodNames = <span class="hljs-variable language_">this</span>.<span class="hljs-property">metadataScanner</span>.<span class="hljs-title function_">getAllMethodNames</span>(prototype)

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> methodName <span class="hljs-keyword">of</span> methodNames) {
      <span class="hljs-keyword">const</span> method = prototype[methodName]
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isDecorated</span>(method)) {
        <span class="hljs-keyword">const</span> options = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDecoratorOptions</span>(method)
        <span class="hljs-keyword">const</span> wrappedMethod = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">wrapMethod</span>(method, methodName, prototype.<span class="hljs-property">constructor</span>.<span class="hljs-property">name</span>, options)
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reDecorate</span>(method, wrappedMethod)
        prototype[methodName] = wrappedMethod
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Injected transaction to <span class="hljs-subst">${prototype.constructor.name}</span>.<span class="hljs-subst">${methodName}</span>`</span>)
      }
    }
  }

  <span class="hljs-comment">/**
   * 判断方法是否携带了Transactional装饰器
   * <span class="hljs-doctag">@param</span> target 方法
   * <span class="hljs-doctag">@returns</span> 是否携带了Transactional装饰器
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">isDecorated</span>(<span class="hljs-attr">target</span>: <span class="hljs-built_in">object</span>): <span class="hljs-built_in">boolean</span> { 
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">hasMetadata</span>(<span class="hljs-variable constant_">TRANSACTIONAL_KEY</span>, target)
  }
  
  <span class="hljs-comment">/**
   * 获取携带的Transactional的options
   * <span class="hljs-doctag">@param</span> target 方法
   * <span class="hljs-doctag">@returns</span> Transactional的options
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">getDecoratorOptions</span>(<span class="hljs-attr">target</span>: <span class="hljs-built_in">object</span>): <span class="hljs-title class_">TransactionOptions</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getMetadata</span>(<span class="hljs-variable constant_">TRANSACTIONAL_KEY</span>, target)
  }

  <span class="hljs-comment">/**
   * 重新装饰方法
   * <span class="hljs-doctag">@param</span> source 源方法
   * <span class="hljs-doctag">@param</span> destination 目标方法
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">reDecorate</span>(<span class="hljs-attr">source</span>: <span class="hljs-built_in">object</span>, <span class="hljs-attr">destination</span>: <span class="hljs-built_in">object</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getMetadataKeys</span>(source)
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">of</span> keys) {
      <span class="hljs-keyword">const</span> meta = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getMetadata</span>(key, source)
      <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineMetadata</span>(key, meta, destination)
    }
  }

  <span class="hljs-comment">/**
   * 包装方法
   * <span class="hljs-doctag">@param</span> originalMethod 原方法
   * <span class="hljs-doctag">@param</span> methodName 方法名
   * <span class="hljs-doctag">@param</span> className 类名
   * <span class="hljs-doctag">@param</span> options 选项
   * <span class="hljs-doctag">@returns</span> 包装后的方法
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">wrapMethod</span>(
    <span class="hljs-attr">originalMethod</span>: <span class="hljs-function">(<span class="hljs-params">...args: <span class="hljs-built_in">unknown</span>[]</span>) =&gt;</span> <span class="hljs-built_in">unknown</span>,
    <span class="hljs-attr">methodName</span>: <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">className</span>: <span class="hljs-built_in">string</span>,
    <span class="hljs-attr">options</span>: <span class="hljs-title class_">TransactionOptions</span>,
  ): <span class="hljs-function">(<span class="hljs-params">...args: <span class="hljs-built_in">unknown</span>[]</span>) =&gt;</span> <span class="hljs-built_in">unknown</span> {
    <span class="hljs-comment">// 创建一个代理对象，用于包装原始方法，实现对方法的拦截和增强</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(originalMethod, {
      <span class="hljs-comment">// 定义代理对象的行为，特别是 apply 方法，用于拦截对原始方法的调用</span>
      <span class="hljs-attr">apply</span>: <span class="hljs-keyword">async</span> (target, thisArg, <span class="hljs-attr">args</span>: <span class="hljs-built_in">unknown</span>[]) =&gt; {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-string">`Executing transactional method: <span class="hljs-subst">${className}</span>.<span class="hljs-subst">${methodName}</span>`</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">runInTransaction</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>, <span class="hljs-keyword">async</span> () =&gt; {
          <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">apply</span>(target, thisArg, args) <span class="hljs-keyword">as</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">unknown</span>&gt;
        }, options);
      },
    })
  }
}
</code></pre>
<p>最后我们修改PrismaService中的get current方法，让在调用this.prisma的时候返回正确实例。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">OnModuleInit</span>, <span class="hljs-title class_">OnModuleDestroy</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrismaClient</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'prismaClients'</span>;
<span class="hljs-keyword">import</span> { getCurrentTx } <span class="hljs-keyword">from</span> <span class="hljs-string">'./transaction/transaction-context'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrismaService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">PrismaClient</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OnModuleInit</span>, <span class="hljs-title class_">OnModuleDestroy</span> {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">onModuleInit</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Prisma连接配置: DATABASE_URL=<span class="hljs-subst">${process.env.DATABASE_URL}</span>`</span>);
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.$connect();
    }
    
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">onModuleDestroy</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.$disconnect();
    }

    <span class="hljs-comment">/**
     * 修改获取当前PrismaClient实例方法，支持事务。
     */</span>
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">current</span>(){
        <span class="hljs-keyword">const</span> tx = <span class="hljs-title function_">getCurrentTx</span>();
        <span class="hljs-keyword">if</span>(!tx)<span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
        <span class="hljs-comment">// 返回一个 Proxy，让调用自动转发到 tx</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(<span class="hljs-variable language_">this</span>, {
            <span class="hljs-title function_">get</span>(<span class="hljs-params">target, prop: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">symbol</span>, receiver</span>) {
                <span class="hljs-comment">// 如果 tx 有这个方法/属性，优先使用 tx 的（绑定 this 为 tx）</span>
                <span class="hljs-keyword">if</span> (prop <span class="hljs-keyword">in</span> tx) {
                    <span class="hljs-keyword">const</span> value = (tx <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>)[prop];
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'function'</span>) {
                        <span class="hljs-keyword">return</span> value.<span class="hljs-title function_">bind</span>(tx);
                    }
                    <span class="hljs-keyword">return</span> value;
                }
                <span class="hljs-comment">// 否则 fallback 到原始 PrismaClient（$connect、$on 等）</span>
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, prop, receiver);
            },
            }) <span class="hljs-keyword">as</span> <span class="hljs-built_in">unknown</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">PrismaClient</span>, <span class="hljs-string">"$connect"</span> | <span class="hljs-string">"$disconnect"</span> | <span class="hljs-string">"$on"</span> | <span class="hljs-string">"$transaction"</span> | <span class="hljs-string">"$use"</span> | <span class="hljs-string">"$extends"</span>&gt;;
        }
    }

</code></pre>
<p>到这里整体的代码就编写完成了
接下来在PrismaModule中正常导入注册Providers</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Global</span>, <span class="hljs-title class_">Module</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PrismaService</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./prisma.service'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TransactionalInjector</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./transaction/transactional.injector'</span>;

<span class="hljs-meta">@Global</span>()
<span class="hljs-meta">@Module</span>({
  <span class="hljs-attr">providers</span>: [<span class="hljs-title class_">PrismaService</span>, <span class="hljs-title class_">TransactionalInjector</span>],
  <span class="hljs-attr">exports</span>:[<span class="hljs-title class_">PrismaService</span>]
})
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PrismaModule</span> {}
</code></pre>
<p>测试代码</p>
<pre><code class="hljs language-typescript" lang="typescript">
<span class="hljs-meta">@Injectable</span>()
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span>{
    <span class="hljs-meta">@Injecet</span>(<span class="hljs-title class_">PrismaSerivce</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-attr">prisma</span>:<span class="hljs-title class_">PrismaService</span>;
    
    <span class="hljs-meta">@Transactional</span>({
        <span class="hljs-attr">maxWait</span>:<span class="hljs-number">10</span>,<span class="hljs-comment">//这里我们设置10ms超时</span>
        <span class="hljs-attr">timeout</span>:<span class="hljs-number">10</span>
    })
    <span class="hljs-title function_">updateUser</span>(<span class="hljs-params"/>){
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">prisma</span>.<span class="hljs-property">user</span>.<span class="hljs-property">update</span>... <span class="hljs-comment">//调用更新user方法</span>
    }
}

</code></pre>
<p>通过上述代码测试得到了报错信息 也就是Prisma的事务执行超时报错 也证明我们的事务已经正常开启了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00031cef9d3949ac85b6c789c0b6adf6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTm9uZTMyMQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771408795&amp;x-signature=ov1%2FWsZmt4mMyCV%2F%2FDAIw5bsEcU%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WebGL 从零开始：绘制你的第一个3D点]]></title>    <link>https://juejin.cn/post/7605326543687008265</link>    <guid>https://juejin.cn/post/7605326543687008265</guid>    <pubDate>2026-02-11T09:36:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605326543687008265" data-draft-id="7605401415855964210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WebGL 从零开始：绘制你的第一个3D点"/> <meta itemprop="keywords" content="前端,WebGL"/> <meta itemprop="datePublished" content="2026-02-11T09:36:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端王校长"/> <meta itemprop="url" content="https://juejin.cn/user/2295436010076631"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WebGL 从零开始：绘制你的第一个3D点
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2295436010076631/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端王校长
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T09:36:05.000Z" title="Wed Feb 11 2026 09:36:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">WebGL程序的两大核心组件</h2>
<p>WebGL程序就像一台精密的机器，需要两个关键部件协同工作才能正常运行：</p>
<p><strong>JavaScript程序</strong> - 负责控制和数据处理</p>
<p><strong>着色器程序</strong> - 负责图形渲染</p>
<p>这两个部分缺一不可，就像汽车需要发动机和方向盘一样。</p>
<h2 data-id="heading-1">从最简单的红点开始</h2>
<p>我们的第一个目标很明确：在屏幕中心绘制一个红色的点，大小为10像素。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bfa2408c3b2f44b991d3dcd24fba04c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv546L5qCh6ZW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771407531&amp;x-signature=ioJ4IqCmpKIyDuvRcENWUa5O2mY%3D" alt="ScreenShot_2026-02-11_173444_693.png" loading="lazy"/></p>
<h3 data-id="heading-2">顶点着色器：告诉GPU在哪里画点</h3>
<pre><code class="hljs language-glsl" lang="glsl">void main(){
    // 告诉GPU在裁剪坐标系原点画点
    gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
    // 设置点的大小为10像素
    gl_PointSize = 10.0;
}
</code></pre>
<p>这里用到了GLSL语言的几个重要概念：</p>
<ul>
<li><code>gl_Position</code>是内置变量，用来设置顶点位置</li>
<li><code>gl_PointSize</code>专门控制点的大小</li>
<li><code>vec4</code>是包含4个浮点数的向量容器</li>
</ul>
<h3 data-id="heading-3">片元着色器：告诉GPU用什么颜色画</h3>
<pre><code class="hljs language-glsl" lang="glsl">void main(){
    // 设置像素颜色为红色
    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0); 
}
</code></pre>
<p>注意颜色值的表示方法：</p>
<ul>
<li>WebGL中颜色分量范围是0-1，不是0-255</li>
<li>红色表示为(1.0, 0.0, 0.0, 1.0)</li>
<li>对应CSS中的rgb(255, 0, 0)</li>
</ul>
<h2 data-id="heading-4">完整的HTML结构</h2>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 顶点着色器源码 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"shader-source"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"vertexShader"</span>&gt;</span><span class="javascript">
     <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>){
        gl_Position = <span class="hljs-title function_">vec4</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);
        gl_PointSize = <span class="hljs-number">10.0</span>;
    }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- 片元着色器源码 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"shader-source"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"fragmentShader"</span>&gt;</span><span class="javascript">
     <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>){
        gl_FragColor = <span class="hljs-title function_">vec4</span>(<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>); 
    }
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
</code></pre>
<h2 data-id="heading-5">JavaScript核心代码实现</h2>
<h3 data-id="heading-6">第一步：获取WebGL绘图环境</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 获取canvas元素</span>
<span class="hljs-keyword">var</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#canvas'</span>);
<span class="hljs-comment">// 获取WebGL上下文（兼容处理）</span>
<span class="hljs-keyword">var</span> gl = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'webgl'</span>) || canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"experimental-webgl"</span>);
</code></pre>
<h3 data-id="heading-7">第二步：创建和编译着色器</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 获取顶点着色器源码</span>
<span class="hljs-keyword">var</span> vertexShaderSource = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#vertexShader'</span>).<span class="hljs-property">innerHTML</span>;
<span class="hljs-comment">// 创建顶点着色器对象</span>
<span class="hljs-keyword">var</span> vertexShader = gl.<span class="hljs-title function_">createShader</span>(gl.<span class="hljs-property">VERTEX_SHADER</span>);
<span class="hljs-comment">// 将源码分配给着色器对象</span>
gl.<span class="hljs-title function_">shaderSource</span>(vertexShader, vertexShaderSource);
<span class="hljs-comment">// 编译顶点着色器程序</span>
gl.<span class="hljs-title function_">compileShader</span>(vertexShader);

<span class="hljs-comment">// 片元着色器创建过程类似</span>
<span class="hljs-keyword">var</span> fragmentShaderSource = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#fragmentShader'</span>).<span class="hljs-property">innerHTML</span>;
<span class="hljs-keyword">var</span> fragmentShader = gl.<span class="hljs-title function_">createShader</span>(gl.<span class="hljs-property">FRAGMENT_SHADER</span>);
gl.<span class="hljs-title function_">shaderSource</span>(fragmentShader, fragmentShaderSource);
gl.<span class="hljs-title function_">compileShader</span>(fragmentShader);
</code></pre>
<h3 data-id="heading-8">第三步：创建和链接着色器程序</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建着色器程序</span>
<span class="hljs-keyword">var</span> program = gl.<span class="hljs-title function_">createProgram</span>();
<span class="hljs-comment">// 将顶点着色器挂载到程序上</span>
gl.<span class="hljs-title function_">attachShader</span>(program, vertexShader); 
<span class="hljs-comment">// 将片元着色器挂载到程序上</span>
gl.<span class="hljs-title function_">attachShader</span>(program, fragmentShader);
<span class="hljs-comment">// 链接着色器程序</span>
gl.<span class="hljs-title function_">linkProgram</span>(program);
<span class="hljs-comment">// 启用着色器程序</span>
gl.<span class="hljs-title function_">useProgram</span>(program);
</code></pre>
<h3 data-id="heading-9">第四步：执行绘制操作</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 设置清空画布颜色为黑色</span>
gl.<span class="hljs-title function_">clearColor</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>);
<span class="hljs-comment">// 用设置的颜色清空画布</span>
gl.<span class="hljs-title function_">clear</span>(gl.<span class="hljs-property">COLOR_BUFFER_BIT</span>);
<span class="hljs-comment">// 绘制点图元</span>
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">POINTS</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
</code></pre>
<h2 data-id="heading-10">让点动起来：交互式绘制</h2>
<p>静态点不够有趣，让我们实现点击画布就在点击位置绘制彩色点的功能。</p>
<h3 data-id="heading-11">改进的着色器程序</h3>
<pre><code class="hljs language-glsl" lang="glsl">// 顶点着色器 - 接收外部数据
precision mediump float;
// 接收点在canvas坐标系上的坐标
attribute vec2 a_Position;
// 接收canvas的宽高尺寸
attribute vec2 a_Screen_Size;

void main(){
    // 将屏幕坐标转换为裁剪坐标
    vec2 position = (a_Position / a_Screen_Size) * 2.0 - 1.0; 
    position = position * vec2(1.0, -1.0);
    gl_Position = vec4(position, 0, 1);
    gl_PointSize = 10.0;
}

// 片元着色器 - 接收颜色数据
precision mediump float;
// 接收JavaScript传过来的颜色值
uniform vec4 u_Color;

void main(){
    // 将颜色值转换为WebGL格式
    vec4 color = u_Color / vec4(255, 255, 255, 1);
    gl_FragColor = color; 
}
</code></pre>
<h3 data-id="heading-12">交互式JavaScript实现</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 获取着色器变量位置</span>
<span class="hljs-keyword">var</span> a_Position = gl.<span class="hljs-title function_">getAttribLocation</span>(program, <span class="hljs-string">'a_Position'</span>);
<span class="hljs-keyword">var</span> a_Screen_Size = gl.<span class="hljs-title function_">getAttribLocation</span>(program, <span class="hljs-string">'a_Screen_Size'</span>);
<span class="hljs-keyword">var</span> u_Color = gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">'u_Color'</span>);

<span class="hljs-comment">// 传递canvas尺寸信息</span>
gl.<span class="hljs-title function_">vertexAttrib2f</span>(a_Screen_Size, canvas.<span class="hljs-property">width</span>, canvas.<span class="hljs-property">height</span>);

<span class="hljs-comment">// 存储点击位置的数组</span>
<span class="hljs-keyword">var</span> points = [];

<span class="hljs-comment">// 绑定点击事件</span>
canvas.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
    <span class="hljs-keyword">var</span> x = e.<span class="hljs-property">pageX</span>;
    <span class="hljs-keyword">var</span> y = e.<span class="hljs-property">pageY</span>;
    <span class="hljs-keyword">var</span> color = {<span class="hljs-attr">r</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()*<span class="hljs-number">255</span>, <span class="hljs-attr">g</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()*<span class="hljs-number">255</span>, <span class="hljs-attr">b</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>()*<span class="hljs-number">255</span>, <span class="hljs-attr">a</span>: <span class="hljs-number">255</span>};
    points.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">x</span>: x, <span class="hljs-attr">y</span>: y, <span class="hljs-attr">color</span>: color });
    
    <span class="hljs-comment">// 清空画布并重新绘制所有点</span>
    gl.<span class="hljs-title function_">clearColor</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1.0</span>);
    gl.<span class="hljs-title function_">clear</span>(gl.<span class="hljs-property">COLOR_BUFFER_BIT</span>);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; points.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-comment">// 传递颜色数据</span>
        gl.<span class="hljs-title function_">uniform4f</span>(u_Color, points[i].<span class="hljs-property">color</span>.<span class="hljs-property">r</span>, points[i].<span class="hljs-property">color</span>.<span class="hljs-property">g</span>, points[i].<span class="hljs-property">color</span>.<span class="hljs-property">b</span>, points[i].<span class="hljs-property">color</span>.<span class="hljs-property">a</span>);
        <span class="hljs-comment">// 传递位置数据</span>
        gl.<span class="hljs-title function_">vertexAttrib2f</span>(a_Position, points[i].<span class="hljs-property">x</span>, points[i].<span class="hljs-property">y</span>);
        <span class="hljs-comment">// 绘制点</span>
        gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">POINTS</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);
    }
});
</code></pre>
<h2 data-id="heading-13">核心知识点总结</h2>
<h3 data-id="heading-14">GLSL语言基础</h3>
<ul>
<li><code>attribute</code>变量：只能在顶点着色器中使用，接收顶点数据</li>
<li><code>uniform</code>变量：可在顶点和片元着色器中使用，接收全局数据</li>
<li><code>varying</code>变量：在顶点着色器和片元着色器间传递插值数据</li>
<li>向量运算：vec2、vec3、vec4等容器类型的运算规则</li>
</ul>
<h3 data-id="heading-15">WebGL API核心方法</h3>
<ul>
<li><code>createShader()</code>：创建着色器对象</li>
<li><code>shaderSource()</code>：提供着色器源码</li>
<li><code>compileShader()</code>：编译着色器</li>
<li><code>createProgram()</code>：创建着色器程序</li>
<li><code>attachShader()</code>：绑定着色器到程序</li>
<li><code>linkProgram()</code>：链接着色器程序</li>
<li><code>useProgram()</code>：启用着色器程序</li>
<li><code>drawArrays()</code>：执行绘制操作</li>
</ul>
<h3 data-id="heading-16">坐标系转换</h3>
<p>从canvas坐标系到裁剪坐标系的转换公式：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">position</span> = (canvas_position / canvas_size) * <span class="hljs-number">2.0</span> - <span class="hljs-number">1.0</span>
</code></pre>
<p>这个转换将浏览器坐标映射到WebGL的标准化设备坐标系(NDC)，其中x、y坐标范围都是[-1, 1]。</p>
<h2 data-id="heading-17">性能优化提示</h2>
<p>直接使用<code>gl.vertexAttrib2f</code>逐个传递数据效率较低。后续章节我们会学习使用缓冲区(Buffer)来批量传递顶点数据，这能显著提升渲染性能。</p>
<p>现在你已经掌握了WebGL的基础绘制技能，准备好迎接更复杂的三角形绘制挑战了吗？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Visual Studio Code 1.109 版本更新总结（总览）]]></title>    <link>https://juejin.cn/post/7605114266024460339</link>    <guid>https://juejin.cn/post/7605114266024460339</guid>    <pubDate>2026-02-11T07:44:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605114266024460339" data-draft-id="7605135197166633010" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Visual Studio Code 1.109 版本更新总结（总览）"/> <meta itemprop="keywords" content="Visual Studio Code"/> <meta itemprop="datePublished" content="2026-02-11T07:44:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一只叁木Meow"/> <meta itemprop="url" content="https://juejin.cn/user/231371762837604"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Visual Studio Code 1.109 版本更新总结（总览）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/231371762837604/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一只叁木Meow
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T07:44:26.000Z" title="Wed Feb 11 2026 07:44:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>💡 更多技术分享，欢迎访问我的博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsanmu7.com%2F" target="_blank" title="https://sanmu7.com/" ref="nofollow noopener noreferrer">叁木の小屋</a></p>
</blockquote>
<blockquote>
<p><strong>发布日期</strong>：2026年2月4日</p>
<p><strong>主题</strong>：多智能体开发的家园（Home for Multi-Agent Development）</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一句话总结</h2>
<p>VS Code 1.109 是一个里程碑版本，标志着 VS Code 演进为<strong>统一的多智能体开发平台</strong>，核心围绕 AI 智能体的全生命周期管理展开。</p>
<hr/>
<h2 data-id="heading-1">核心更新速览表</h2>

































































<table><thead><tr><th>类别</th><th>核心更新</th><th>关键亮点</th></tr></thead><tbody><tr><td><strong>聊天体验</strong></td><td>Anthropic 思维令牌、Mermaid 图表、Plan Agent</td><td>四阶段工作流、<code>/plan</code> 快捷命令</td></tr><tr><td><strong>会话管理</strong></td><td>智能体类型切换、子智能体并行运行</td><td>本地/后台/云端统一视图、状态指示器</td></tr><tr><td><strong>智能体定制</strong></td><td><code>/init</code> 命令、Agent Skills 正式发布</td><td>组织级说明、技能文件夹管理</td></tr><tr><td><strong>扩展性</strong></td><td>Claude Agent 支持、智能体编排</td><td>MCP Apps、Anthropic Messages API</td></tr><tr><td><strong>优化</strong></td><td>Copilot Memory、外部索引</td><td>非 GitHub 工作区远程索引、并行依赖任务</td></tr><tr><td><strong>安全</strong></td><td>终端沙盒、自动审批规则</td><td>文件/网络访问限制、安全命令白名单</td></tr><tr><td><strong>终端</strong></td><td>Kitty 键盘协议、粘性滚动</td><td>选择性忽略命令、移除 winpty</td></tr><tr><td><strong>编辑器</strong></td><td>括号匹配颜色、双击选择</td><td>幽灵文本虚线下划线、shebang 检测</td></tr><tr><td><strong>工作台</strong></td><td>集成浏览器（预览）</td><td>持久化存储、完整 DevTools、元素发送到聊天</td></tr><tr><td><strong>API</strong></td><td>Quick Input 按钮位置 API、Chat 配置</td><td>模型提供程序配置架构、提示文件 API</td></tr><tr><td><strong>工程</strong></td><td>macOS DMG、Windows 安装布局重设计</td><td>Copilot 扩展弃用、codicons npm 包</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">分篇阅读指南</h2>
<p>本系列共分为 5 篇，涵盖 VS Code 1.109 的所有更新内容：</p>



































<table><thead><tr><th>篇目</th><th>地址</th><th>内容概览</th></tr></thead><tbody><tr><td><strong>第一篇</strong></td><td><a href="https://juejin.cn/post/7605135197166731314" target="_blank" title="https://juejin.cn/post/7605135197166731314">VS Code 1.109 更新解读（一）：聊天体验与会话管理</a></td><td>聊天 UX、智能体会话管理</td></tr><tr><td><strong>第二篇</strong></td><td><a href="https://juejin.cn/post/7605135197166747698" target="_blank" title="https://juejin.cn/post/7605135197166747698">VS Code 1.109 更新解读（二）：智能体定制与扩展性</a></td><td>智能体定制、扩展性、编排</td></tr><tr><td><strong>第三篇</strong></td><td><a href="https://juejin.cn/post/7605401415855259698" target="_blank" title="https://juejin.cn/post/7605401415855259698">VS Code 1.109 更新解读（三）：智能体优化与安全</a></td><td>Copilot Memory、终端沙盒、安全与信任</td></tr><tr><td><strong>第四篇</strong></td><td><a href="https://juejin.cn/post/7605173538417442826" target="_blank" title="https://juejin.cn/post/7605173538417442826">VS Code 1.109 更新解读（四）：终端、编辑器与工作台</a></td><td>终端增强、编码与编辑器、工作台生产力</td></tr><tr><td><strong>第五篇</strong></td><td><a href="https://juejin.cn/post/7605157203591282715" target="_blank" title="https://juejin.cn/post/7605157203591282715">VS Code 1.109 更新解读（五）：API 与工程改进</a></td><td>扩展 API、工程改进、值得注意的修复</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-3">精简分项总结</h2>
<h3 data-id="heading-4">一、聊天体验（Chat UX）</h3>





































<table><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>Anthropic 思维令牌</td><td>显示模型推理过程，支持详细/紧凑两种风格</td></tr><tr><td>Mermaid 图表</td><td>聊天中渲染交互式流程图、序列图</td></tr><tr><td>提问工具</td><td>Agent 可主动提出澄清问题</td></tr><tr><td>Plan Agent</td><td>四阶段工作流：发现→对齐→设计→完善</td></tr><tr><td>上下文窗口指示器</td><td>实时显示令牌使用情况</td></tr><tr><td>终端命令输出增强</td><td>语法高亮、工作目录、流式输出</td></tr><tr><td>新主题实验</td><td>VS Code Light/Dark 实验性主题</td></tr></tbody></table>
<h3 data-id="heading-5">二、智能体会话管理</h3>

































<table><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>类型切换器</td><td>本地/后台/云端智能体一键切换</td></tr><tr><td>状态指示器</td><td>显示进行中/未读/需关注的会话</td></tr><tr><td>子智能体并行</td><td>显著加快多任务处理速度</td></tr><tr><td>搜索子智能体</td><td>隔离循环中迭代优化搜索</td></tr><tr><td>云智能体</td><td>支持模型选择、第三方智能体</td></tr><tr><td>后台智能体</td><td>每轮自动提交、支持附加图片</td></tr></tbody></table>
<h3 data-id="heading-6">三、智能体定制</h3>

































<table><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td><code>/init</code> 命令</td><td>根据代码库自动生成工作区说明</td></tr><tr><td>Agent Skills</td><td>正式发布，默认启用</td></tr><tr><td>组织级说明</td><td>GitHub 组织范围的自定义指导</td></tr><tr><td>调用控制</td><td><code>user-invokable</code>、<code>disable-model-invocation</code> 等属性</td></tr><tr><td>多模型支持</td><td>指定多个模型作为回退选项</td></tr><tr><td>定制诊断</td><td>右键查看所有加载的定制文件状态</td></tr></tbody></table>
<h3 data-id="heading-7">四、智能体扩展性</h3>





























<table><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>智能体编排</td><td>多个专业智能体协作完成复杂任务</td></tr><tr><td>Claude Agent</td><td>使用 Anthropic 官方 SDK，预览中</td></tr><tr><td>Anthropic 增强</td><td>Messages API 交错思考、工具搜索</td></tr><tr><td>MCP Apps</td><td>服务器显示丰富交互式 UI</td></tr><tr><td>自定义注册表</td><td>支持私有/替代包注册表</td></tr></tbody></table>
<h3 data-id="heading-8">五、智能体优化</h3>

























<table><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>Copilot Memory</td><td>跨会话存储和检索重要信息</td></tr><tr><td>外部索引</td><td>非 GitHub 工作区远程语义索引</td></tr><tr><td>读取工作区外文件</td><td>获得许可后可访问外部文件</td></tr><tr><td>性能改进</td><td>大型聊天更流畅、并行依赖任务处理</td></tr></tbody></table>
<h3 data-id="heading-9">六、智能体安全与信任</h3>





















<table><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>终端沙盒</td><td>限制文件系统/网络访问（macOS/Linux）</td></tr><tr><td>终端生命周期</td><td><code>timeout</code>、<code>awaitTerminal</code>、<code>killTerminal</code> 工具</td></tr><tr><td>自动审批</td><td>安全命令如 <code>npm</code>、<code>docker</code> 自动审批</td></tr></tbody></table>
<h3 data-id="heading-10">七、终端增强</h3>

























<table><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>选择性忽略粘性滚动</td><td>可自定义忽略的命令列表</td></tr><tr><td>移除 winpty</td><td>不再支持 Win10 1809 之前版本</td></tr><tr><td>Kitty 键盘协议</td><td>修复击键编码限制，实验性</td></tr><tr><td>Win32 输入模式</td><td>针对 Windows 和 ConPTY 优化，实验性</td></tr></tbody></table>
<h3 data-id="heading-11">八、编码与编辑器</h3>

































<table><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>括号匹配前景色</td><td>可自定义匹配括号的文本颜色</td></tr><tr><td>双击选择内容</td><td>括号或字符串内容快速选择</td></tr><tr><td>TypeScript 重命名建议</td><td>输入覆盖时也能触发重命名建议</td></tr><tr><td>幽灵文本可见性</td><td>短建议显示虚线下划线</td></tr><tr><td>代码段文件模式</td><td><code>include</code>/<code>exclude</code> 控制出现范围</td></tr><tr><td>shebang 检测</td><td>改进 <code>/usr/bin/env</code> 支持</td></tr></tbody></table>
<h3 data-id="heading-12">九、工作台与生产力</h3>

































<table><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>集成浏览器（预览）</td><td>完整浏览器体验，支持 DevTools</td></tr><tr><td>恢复编辑器控制</td><td>可选择是否恢复上次打开的编辑器</td></tr><tr><td>高级设置</td><td>始终显示高级设置选项</td></tr><tr><td>拖放导入配置文件</td><td><code>.code-profile</code> 文件拖放导入</td></tr><tr><td>问题过滤</td><td>按来源过滤诊断信息</td></tr><tr><td>无障碍改进</td><td>屏幕阅读器支持增强</td></tr></tbody></table>
<h3 data-id="heading-13">十、扩展与 API</h3>





























<table><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>Quick Input 按钮</td><td>位置 API、切换 API 正式确定</td></tr><tr><td>Chat Model Provider</td><td>配置架构声明 API</td></tr><tr><td>Chat Prompt Files</td><td>动态聊天资源提供 API</td></tr><tr><td>Chat Item Controller</td><td>新的基于控制器的 API</td></tr><tr><td>Portable Mode 检测</td><td><code>env.isAppPortable</code> 属性</td></tr></tbody></table>
<h3 data-id="heading-14">十一、工程改进</h3>





























<table><thead><tr><th>功能</th><th>说明</th></tr></thead><tbody><tr><td>macOS DMG 镜像</td><td>原生拖放安装体验</td></tr><tr><td>Windows 安装重设计</td><td>版本化包路径，提高更新可靠性</td></tr><tr><td>避免连续更新</td><td>使旧更新无效，应用新更新</td></tr><tr><td>Copilot 扩展弃用</td><td>功能整合到 Copilot Chat 扩展</td></tr><tr><td>codicons npm 包</td><td>从 <code>@vscode/codicons</code> 包消费</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Repo 撤销当前修改]]></title>    <link>https://juejin.cn/post/7605114376803729448</link>    <guid>https://juejin.cn/post/7605114376803729448</guid>    <pubDate>2026-02-11T07:51:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605114376803729448" data-draft-id="7605114376803713064" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Repo 撤销当前修改"/> <meta itemprop="keywords" content="C++,Android"/> <meta itemprop="datePublished" content="2026-02-11T07:51:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sTone87375"/> <meta itemprop="url" content="https://juejin.cn/user/2946346894764584"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Repo 撤销当前修改
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2946346894764584/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sTone87375
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T07:51:42.000Z" title="Wed Feb 11 2026 07:51:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>repo</code> 提供了快速撤销所有仓库修改的命令，以下是几种常用方式：</p>
<hr/>
<h2 data-id="heading-0">一键撤销所有修改</h2>
<h3 data-id="heading-1">方式一：最常用（推荐）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 撤销所有仓库的所有修改（包括暂存区和工作区）</span>
repo forall -c <span class="hljs-string">'git reset --hard HEAD &amp;&amp; git clean -fdx'</span>
</code></pre>





















<table><thead><tr><th>命令</th><th>作用</th></tr></thead><tbody><tr><td><code>repo forall</code></td><td>对所有仓库执行命令</td></tr><tr><td><code>git reset --hard HEAD</code></td><td>强制回退到最新提交，丢弃所有修改</td></tr><tr><td><code>git clean -fdx</code></td><td>删除所有未跟踪的文件和目录</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-2">方式二：分步执行（更安全，可先检查）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 先查看哪些仓库有修改</span>
repo status

<span class="hljs-comment"># 2. 只撤销特定仓库（示例：frameworks/base）</span>
repo forall frameworks/base -c <span class="hljs-string">'git reset --hard HEAD'</span>

<span class="hljs-comment"># 3. 撤销所有仓库</span>
repo forall -c <span class="hljs-string">'git reset --hard HEAD'</span>
repo forall -c <span class="hljs-string">'git clean -fdx'</span>
</code></pre>
<hr/>
<h3 data-id="heading-3">方式三：保留未跟踪文件（仅撤销修改）</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 只撤销跟踪文件的修改，保留新建的文件</span>
repo forall -c <span class="hljs-string">'git checkout -- .'</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">对比：不同清理强度</h2>






























<table><thead><tr><th>命令</th><th>效果</th><th>适用场景</th></tr></thead><tbody><tr><td><code>git checkout -- .</code></td><td>撤销跟踪文件的修改</td><td>保留新文件，只恢复旧文件</td></tr><tr><td><code>git reset --hard HEAD</code></td><td>回退到 HEAD，丢弃所有提交</td><td>彻底回退到最新提交</td></tr><tr><td><code>git clean -fd</code></td><td>删除未跟踪的文件/目录</td><td>清理编译生成的文件</td></tr><tr><td><code>git clean -fdx</code></td><td>删除未跟踪文件 + 忽略的文件</td><td><strong>最彻底清理</strong>（推荐）</td></tr></tbody></table>
<blockquote>
<p><code>-f</code> = 强制，<code>-d</code> = 包含目录，<code>-x</code> = 包含 <code>.gitignore</code> 忽略的文件</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">常用组合命令</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 完整清理（最常用）</span>
repo forall -c <span class="hljs-string">'git reset --hard HEAD &amp;&amp; git clean -fdx'</span>

<span class="hljs-comment"># 简写形式</span>
repo forall -c <span class="hljs-string">'git reset --hard &amp;&amp; git clean -fdx'</span>

<span class="hljs-comment"># 清理后重新同步</span>
repo forall -c <span class="hljs-string">'git reset --hard HEAD &amp;&amp; git clean -fdx'</span> &amp;&amp; repo <span class="hljs-built_in">sync</span> -c
</code></pre>
<hr/>
<h2 data-id="heading-6">注意事项</h2>





















<table><thead><tr><th>⚠️ 警告</th><th>说明</th></tr></thead><tbody><tr><td><strong>不可恢复</strong></td><td><code>reset --hard</code> 和 <code>clean -fdx</code> 删除的文件<strong>无法找回</strong></td></tr><tr><td><strong>先备份</strong></td><td>如有重要修改，先 <code>repo diff</code> 导出补丁</td></tr><tr><td><strong>子模块</strong></td><td>如需清理子模块，加 <code>--recursive</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">导出修改（清理前备份）</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 导出所有修改到补丁文件</span>
repo diff &gt; my_changes.patch

<span class="hljs-comment"># 之后可以重新应用</span>
git apply my_changes.patch
</code></pre>
<hr/>
<p><strong>总结</strong>：日常开发最常用的是：</p>
<pre><code class="hljs language-bash" lang="bash">repo forall -c <span class="hljs-string">'git reset --hard HEAD &amp;&amp; git clean -fdx'</span>
</code></pre>
<p>一键回到干净状态，然后重新 <code>repo sync</code>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[「2025 年终总结」在所有失去的人中，我最怀念我自己]]></title>    <link>https://juejin.cn/post/7605174711181410367</link>    <guid>https://juejin.cn/post/7605174711181410367</guid>    <pubDate>2026-02-11T08:03:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605174711181410367" data-draft-id="7605142381152747583" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="「2025 年终总结」在所有失去的人中，我最怀念我自己"/> <meta itemprop="keywords" content="后端,前端,年终总结"/> <meta itemprop="datePublished" content="2026-02-11T08:03:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Coredump"/> <meta itemprop="url" content="https://juejin.cn/user/1654082381026734"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            「2025 年终总结」在所有失去的人中，我最怀念我自己
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1654082381026734/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Coredump
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T08:03:24.000Z" title="Wed Feb 11 2026 08:03:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读27分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 2026 的开始，我并没有许下什么新年愿望，似乎每一年都没有，但每一年都会经历很多难忘的事情。</p>
<p>这一年终究要过去了，我对 2025 的唯一感觉就是：<strong>年费会员快要到期了，该交钱了</strong>。</p>
<p>今年比往年要好很多，烟花凌空绽放，整座城市隆隆作响，极尽所能地宣告新年的到来，往年只有电视机里主持人带着职业假笑，高声呐喊这的倒计时，现在打开窗户，迎面扑来的是久违的焰火气息，让我想起遥远的过去。</p>
<p>尤记得初春，微雨悄然而至，零星的雨滴中，傍晚树下自行车的铃声随风轻轻荡漾，街角的灯光微黄，宛如一位老友向我低语，有些东西，永远的遗留在了过去。可能是在留在了初高中，或者本科，亦或者是研究生，无从知晓。</p>
<p>那时西边红霞满天，我却只顾东行。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94923f296f1a4349915c66b32dcd8702~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=e8QUaTPtrHp0mKj9Evev0LCMBso%3D" alt="7623766c8e19a6e0cbd1497c97a4b53e" loading="lazy"/></p>
<h2 data-id="heading-0">#01 夏</h2>
<p>暑期实习挺不顺利的，人很丧，没自信，没目标，也错过了很多机会...</p>
<p>想回到暑期前重新开始，但没办法，回不去了，这就是人生，只有错过点什么，你才学得会珍惜</p>
<p>就好像我这辈子也回不到大一大二的学习状态一样，或者说，人这一生，都不能走回头路</p>
<p>很多年来，我一直持续在问自己一个问题，怎么就变成这样了呢？</p>
<p>最近，这个问题变成了，害，那又能有什么办法呢 😮‍💨</p>
<p>暑期最有希望也是最想去的华子也泡死在池子里了，那个组的方向我是真感兴趣，可惜最后还是没能等来 offer。</p>
<p>看到一个北大的哥们，比我晚入池，过几天就开奖了，HR 和我说，或许这就是北大的魅力吧。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49386daf91f5446c97fc89ed6ce84156~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=Zw3Ep4MrXstP3Qcpvvf22%2BERlhI%3D" alt="image-20250628032513786" loading="lazy"/></p>
<p>也不知道为什么，这些年，身边的人总会有种觉得我很厉害的错觉，拜托，我要是真厉害，我还用发愁这些毕业、就业的事么，这样我就不用吃生活的苦了</p>
<p>有时候就觉得自己活得很荒谬，三天两头垂头丧气跟失恋似的</p>
<p>朋友问我怎么情绪不对，我总不能告诉他最近暑期挂麻了，看不到未来吧</p>
<p>突然想明白了为什么互联网公司互相称呼同学，国企互相称呼老师，<strong>因为同学会毕业，早晚而已</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fd5898f6d7840e1b3b97e8c242c60a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=efkFDs%2FM8ceRr8HxPtS0MTQj8NA%3D" alt="94628a820e12dc46f30efd54d788a640" loading="lazy"/></p>
<p><strong>这并不是一份多么值得让人羡慕和追逐的工作</strong></p>
<p><strong>在这里，人也并没有太多的时间想以前和以后</strong></p>
<p>那段颓废在宿舍刷视频的时间，经常刷到蜡笔小新和海绵宝宝，不得不说在那个年代，做得是真好</p>
<p>小学的时候是最应该看蜡笔小新的时候</p>
<p>高中的时候是最应该看斗破苍穹的时候</p>
<p>但我研究生的时候才开始沉迷这俩玩意</p>
<p>不过仔细一想，我现在和高中时候确实有点不一样了，比如高中时候我玩英雄联盟宁死不投，现在我看打不过了 15 分钟就上票了，不能让对面虐菜爽</p>
<p><strong>能打过我的人，我不给他们打</strong> ...</p>
<p>人总应该是有点变化的，但我最近又有些新的理解了，成长是一件很难的事，它甚至意味着从头去修改你的一部分人生意义</p>
<p>打个比方：你连体重都控制不了，怎么能控制自己的人生呢？</p>
<p>朋友说没办法，现在大伙都找着了工作，体重确实不好减</p>
<p>真不好减，最近东子、团子和阿里打外卖价格战，快给我喝出糖尿病了</p>
<p>暑期有个好朋友跑北京实习了，还有一个去了杭州，读书时哥几个总是经常打哈哈，不过一到上班，感受又不一样了</p>
<p>出发前几天，我说了一句“今日一别，小半年又见不到了，不过咱们的学生生涯好像也就一年多了”，他们没说话，也许是我们经历这寻常的分别太多了，本来早就习惯了，这时候突然来了个人对你说：</p>
<p>嘿，你已经和这么多人走散了呀</p>
<p>大多数人分开后就不会再见了，而有些人或许还有再见的机会</p>
<p>回忆会陪你一生，即使再模糊，你还是忘不掉</p>
<p><strong>聚散离合，此乃常态，你要习惯</strong></p>
<p>纵观个人的命运，当然要靠自我奋斗，但也要考虑到历史的行程，但不幸的是，现在历史的进程并不乐观。</p>
<p>在比较小的时候，大约就是初中高中吧，我对自己人生结果充满幻想和期待。但慢慢长大之后，方才意识到生活是如此复杂，我不得不学着对内心的期望放手，曾经的梦想在残酷的现实面前变得褪色。慢慢发现有些事并不是一件需要被解决的事情，而是一件需要被接受的事情，或者说，绝大多数的事情，都只是需要接受的事情，你解决不了。</p>
<p>比如在地球 online 度过的这二十几年来看，改变的话起码要拿年来衡量，或者十年来衡量。</p>
<p>此时，怜悯自己显得很重要，或许你可以对自己说“我也想要做得更好”以及“就让它这样吧，其实这样也好”。</p>
<p>是的，我已经做得足够好了，因为至少现在我还爱着自己｡</p>
<h2 data-id="heading-1">#02 秋</h2>
<p>其实，我从来没想过要如何准备才能在秋招拿到大厂的 offer，或是白菜，或是 SP、SSP</p>
<p>我一直以来去实习，一是想顺道去别的城市看一看，二来，也是一直都想真正的写出一些好的代码，被重视的代码，听起来很理想化，但这也让我阴差阳错的实习了不少段</p>
<p><strong>在我过往的十年中，凡是我努力追逐的事，往往都无法实现，而那些真正实现的，其实都是意料之外</strong></p>
<p>所以我觉得如果一件事有 100% 的把握，就没有去做的兴致了</p>
<p>🧑‍💻面试官：这就是你笔试只做出来一半的原因吗？</p>
<blockquote>
<p>后来看到个段子，很后悔没给面试官发：</p>
<p>“这代码我有三不写”</p>
<ul>
<li>第一：不能复制的我不写，因为别人的轮子写好了我干嘛不用</li>
<li>第二：不让我用 ChatGPT "辅助"的我不写，因为基础的东西我都会，写了没意义</li>
<li>第三：太难写的我不写，因为我还没有到那个境界，写不明白</li>
</ul>
</blockquote>
<p>现实就是这么残酷，还没来得及从暑期实习的失落中走出来，秋招就开始了，比 emo 更难受的事情是，不能 emo 太久。</p>
<p>朋友说，当一个人过得不好时，才会怀念过去。难怪秋天刚开始，我就已经在怀念夏天了。</p>
<blockquote>
<p>这过日子就是问题叠着问题，我唯一能做的，就是迎接这些问题。  ——《士兵突击》</p>
</blockquote>
<p>几十年前，似乎呢群领图灵奖的巨佬总会在领奖的时候很自豪的说，我是一名程序员</p>
<p>但现在提起程序员，我总会想到 CSDN 上那只秃头虚弱无力的猿猴趴在电脑前，用巨大的手敲打着键盘</p>
<p>所以我很不喜欢 CSDN，当然 CSDN 也确实做的很烂，也算没有辜负我的感情</p>
<p>我没那么喜欢互联网，互联网是一种很割裂的存在，特别是在国内，比如互联网的 OKR，很有意思的是，在互联网 OKR 本来就是要完不成的，如果有一天你完成了你的 OKR，不是说你超出预期，而是说明你的 OKR 制定的有问题</p>
<p>我很想说这个行业病了，但其实我也改变不了啥，唯一改变的就是工作越来越难找了，同龄人之间要更卷了而已</p>
<p>没有乌托邦，只有维也纳在等我们</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d0518cc58074c2fad7013ce556698ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=wh0RW4svuXR0GhpK5HMKGCJQeIM%3D" alt="Screenshot 2025-08-10 at 15.42.18" loading="lazy"/></p>
<p>但我喜欢编程，我就想工作得能开心点，从来没想过在互联网待一辈子，<strong>而且即使我想，我的老板可能也不想</strong></p>
<p>面试很短，这几十钟其实是看不出来我的优点的，我每次面完都感觉没有发挥得尽兴，没有展示出来给面试官最好的一面</p>
<p>但我的缺点还是一览无余的</p>
<p>有一次面 HR 面的时候，HR 让我给一个词来形容自己，我说的是重感情</p>
<p>HR 说第一次见到这样的回答，让我举个例子</p>
<p>我想了想，说如果你司招我，那我会先考虑你司</p>
<p>也不知道 HR 满不满意这个回答</p>
<p>想起来本科的老学长，从闲鱼跳去了美团，换了个 base，最近经常加班，有人问是为了什么</p>
<p>学长说是为了爱情，真好，那时候有那么一瞬间，我很羡慕，似乎这一切都和技术没有关系，与世俗的荣誉，权力都没有关系</p>
<p><strong>我喜欢纯粹的东西，面试也是</strong></p>
<p>我如果觉得一个面试官不真诚，我就不会去这家公司，如果我有选择的话</p>
<p>以前觉得做选择时兴趣没有那么重要，但现在看来，那一点平日里微不足道的热爱，会成为在动摇时至关重要的那一份权重</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67e7e3c7c9f94a17ba8327556ffcb6a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=oq6Fe%2FO4Ot6XskJTJyYXBzvxbqo%3D" alt="image-20260206171454503" loading="lazy"/></p>
<p>有时候想毕业直接回到老家，又觉得辜负了自己的初心和一身技术</p>
<p>朋友说不对，<strong>你现在没啥技术，谈不上辜负</strong></p>
<p>说的也对，走一步看一步算了😄</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5aa37161c8e40f4af5c03a57b00f122~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=dgmyWhfkt2dA31J3IC5q1lgGi00%3D" alt="img" loading="lazy"/></p>
<p>不过程序员有一大悲哀就是，成为了程序员就会只把自己当成程序员，因为身在这个环境中，但其实如<strong>果跳出这个环境，发现还是正常生活的人多</strong>。</p>
<p>计算机是严格理性与规范的学科，但我觉得也很浪漫，我们穷尽所有去提高技术，无论是设计模式，还是渐渐的模块化，微服务化，容器化，<strong>都是为了在未来一天，我们可以更好的被取代</strong>，这个工作，在一开始，便注定了悲壮和浪漫。</p>
<p>但有时我会想，这个行业，值不值得我投入如此的热忱，我是个没有梦想也能生存的人，高中的朋友总喜欢找一个梦想中的学校，一个梦想中追赶的人，一个梦想中的行业。但我这些都没有，朋友总觉得我是靠意志力撑过高三那段艰苦的岁月，其实不是，有没有梦想对我来说并不是那么重要。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c44abc56ec824475b0394da7c65bfdeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=fZzpUaq6YInt0Ckh%2BOLEj1QA%2FTc%3D" alt="img" loading="lazy"/></p>
<p>朋友说，假设阳的挂掉一半，全国会失去大概 50% 的人口，不过很快又会恢复如初（生物小知识嗷：种群数量达到环境容纳量一半，即 K / 2 时，种群的增长速率最大），最终无数人的喜怒哀乐，生死离别，成为历史书上的轻如鸿毛的一笔，无论描写的多么惨绝人寰，也只是一笔罢了，而地球上所有惊天动地的大事，也不及宇宙中的一粒尘埃。</p>
<p>有时候在想生命的意义是什么，我想不明白，就像高三老师问我的梦想一样，问我想要当一个什么职业，成为一个什么样的人，我说我不知道，但一定不是以后拿 20w 年薪，30w 年薪，50w 年薪或者 100w 年薪。</p>
<p>因此不想卷了，是因为没有了卷的动力，其实最终不就是为了拿一份高薪的工作，我连对这个结果都没了兴致，又何谈过程，倒不是懒得奋斗，只不过什么时候奋斗渐渐的成了一种贬义词，我只是觉得途中的代价太大，不只是我一个人付出的，而是和我的朋友们一同付出的。</p>
<p><strong>无论是什么样的结果，我都觉得难以配得上这一路走来的失去</strong></p>
<p><strong>人行走江湖，就是不断的相遇和失去，第一次相遇是自己的生命，最后一次失去也是，有始有终</strong></p>
<p>我已经不喜欢再和别人卷了，但是到了一定程度后，身在其中，由不得我，不过，也算是一种磨练心境吧，倒也未必不是好事。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3997647fdc5748358f0b6dc09769e320~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=NVxcGWeZCOcs78mLmIwx0BZIggI%3D" alt="Screenshot 2025-08-10 at 15.37.42" loading="lazy"/></p>
<p>所以生命的意义是什么，我不知道，但是我会期待下一次和朋友相遇，在大学中遇到新的朋友，新的乒乓球友，我会和以前一样期待，但是不会再像以前一样严格规划我的人生了，比如某个时间点非做某件事不可，非要达到某个成就不可。</p>
<p>在学校的时候，如果不是很忙我就喜欢到外面去吃个鸡锅，如果忙的话就推到明天去吃，明天忙就推到后天，<strong>人总是寄希望于后来，也习惯把这辈子没有得到的人和事寄予到下辈子，总会说我下辈子要怎样怎样。可如果这辈子就是你上辈子说的下辈子，那怎么办呢</strong>？</p>
<p>所以我现在选择想吃鸡锅的时候就直接去吃😋</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11c3affdfcf548719d52c7bcf2aea815~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=mvvcM4s8LVMYwPjwDCrENrTLQMA%3D" alt="image-20260206182133446" loading="lazy"/></p>
<p>那我会呆在哪里呢？HR 也问过我这个问题。</p>
<p>我说大概是厦门吧，我的爱人、挚友都在那里，或者是在那里陪伴过我一段很长很长的时间，比我在杭州西安待的时间加起来还要长很多</p>
<p>面试官笑得有些深意</p>
<blockquote>
<p>几年后被末尾淘汰的那一天，一切都将作废，之前的加班作废，之前从池子中挣扎出来的惊喜作废，之前的领导同事作废，之前的薪资待遇也作废，鼠标也会作废，键盘也会作废，所有的承诺也统统作废。从那一天开始，我不再需要电脑，不再需要八股，我的人生不再有 hello world。我知道是秋招那年的那场大雪覆盖了我前半生的荒唐，覆盖了我本科的学历，我和 985 硕一起进入阿里，我仿佛从其中看到了希望，但生活在无边的大雪中又何尝不是一种荒唐，当我真正走出这片大雪后，我肚子有些饿了，此时我才意识到，原来码农烧烤才是人生的归属。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/898b60f4917546b08c17f4e9c4476c50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=rQP92X569EX9PC33lxHXAc3oJTs%3D" alt="IMG_8164" loading="lazy"/></p>
<p>其实我也经常黑厦门的，我很难喜欢上某个城市，比起城市的高低贵贱，电子博弈，我更在意的是我与谁一起经历过什么，到过哪里，见过哪里的风景</p>
<p>我经常说厦门那地方，典型的工资低，物价高</p>
<p>朋友说他不是本地人，每次买海鲜都感觉买的很贵很贵，听厦大的学长说去码头买能便宜很多</p>
<p>我说不是，码头有一定概率买到新鲜的，而且很难买到便宜的</p>
<p>为什么说有概率买到新鲜的，因为那海鲜，你不清楚是刚从海里拉上来的，还是昨天搁市场溜了一圈又拉回去的，反正在人看来，都是刚从船上拉下去，带着新鲜的海水和被折腾的半死不活的鱼</p>
<p>至于价格，人们一般都会吹鼓自己的是野生的，众所周知的道理，野生的更贵，<strong>也没有手段证明它是不是真的野生鱼，除了价格</strong></p>
<h2 data-id="heading-2">#03 厦</h2>
<p>读了好多年书，如果能顺利毕业的话我就要毕业了，<strong>这话看起来没什么信息量，和我读的硕士一样</strong>。</p>
<p>看树洞有人问保研和考研哪个更辛苦，我不用点开都知道评论区铁定开战了</p>
<p>一个老哥说的很有意思，差点看破防了</p>
<p><strong>读研更辛苦</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/507e271cdd05427db7b53d329c40b117~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=kmb34zq22PDdqFjfiQSspj5bAXA%3D" alt="b1aa7170df5fcb1ed7046ec6c77874fe" loading="lazy"/></p>
<p>记得有一天发研究生补助的时候我还在和朋友聊天</p>
<p>朋友说他感觉人生只剩下了银行卡里的一串串数字，收入和支出，感觉像是把灵魂卖给了社会，照镜子的时候感觉双眼都变得浑浊了</p>
<p>我看了眼屏幕里那一堆减号里面的醒目的“➕600”，还是国家赏饭，我应该是肉身和灵魂都卖给了学校，还是那种 19 世纪美国南方黑哥摘棉花的价格</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb09d2d1fbfb494aac60e52c3f88c57f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=HHHnK1cGSPsU4ekRXXyye1yRw1g%3D" alt="IMG_5800" loading="lazy"/></p>
<p>和朋友闲聊，如果能再选一次的话我一定不会读研，哈哈</p>
<p>人就是这样，总会在某个时期觉得自己曾经做的事情不正确，说不定再过几年我又觉得现在做的不正确了</p>
<p>不过话说回来，当年觉得自己能保研可厉害了，现在想想就和网上那种看着小时候一面墙的奖状一样，叹息之墙</p>
<p>人还是不要美化从未走过的那条路，不然就会一直纠结和后悔，然后发现这辈子然后很快就过去了</p>
<p>也慢慢觉得自己老了，因为回过头看，发现自己已经配不上过去的自己了</p>
<p>如果在当年知道未来是这样，或许根本撑不过高考那段时光</p>
<p>多年之后，我又梦到那天，画面遥远，仿佛回到高考那一天</p>
<p>感觉，稍微有点生不逢时罢了</p>
<p>想起来前段时间公司宣讲，说我们赶上了一个很好的时代，因为有 AI，可是 AI 并没有发挥它应有的作用，并没有让工作量减少，工作时长减少，也没有降低生活成本，房价物价，看病还是一样昂贵，大家的压力也都还是很大，甚至更焦虑了，我们并没有因此变得更幸福</p>
<p>长期来讲，我很看好 AI，但此时此刻，并不觉得这是一个多么好的时代，即使见证了从传统 CV、NLP 到大模型的蜕变。大模型发展得太快了，还记得 22 年刚出 GPT-3.5 的时候，有人感慨涌现就像宇宙给的礼物一样神奇，现在已经没有人再发出这种感慨了，默认大模型就存在和人类差不多甚至更强的智力了，没有上古时期 NLP 用 BERT 胡言乱语的折磨</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1677b05db35482cbff65058ee3ae914~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=RhB9cz8cw7ORToR4TQIta0vvMKA%3D" alt="33d3a6e6a7db04a50aead8040afc78b1" loading="lazy"/></p>
<p>想起个很好笑的事，以前研究生方向不是 CV 就是 NLP，现在 CV 还有点，感觉 NLP 已经绝迹了，虽然大模型也算是一种 NLP 吧，但已经没有哪个老师招生的时候会给你说：同学，我的研究方向是 NLP 🤣</p>
<p>现在已经到 AI Agent 时代了，国内外的 AI 产品层出不穷抢占市场，也不得不感叹国内 AI 大战的朴素，一代人有一代人的鸡蛋要领</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aed3c4a7a6b64877b33771be93454380~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=NJiBUua6zd%2BhRyllZLoh0GLjrkk%3D" alt="140c831cdcc83abd3e65bf054a050db3" loading="lazy"/></p>
<p>感觉我们的世界对慢节奏的人很不友好，那种田园牧歌的时代早就一去不复返了。我曾经对科研的憧憬完全来自于牛顿和苹果树，康德漫步于小径，梭罗隐居瓦尔登湖，而不是坐在电脑面前，脊柱侧弯、屁股很酸、眼睛散光，和计算机打交道，未来只有吃不完的苦。</p>
<p>我曾经觉得我是会喜欢科研的，在我想出老师也没想出来的课题的时候，提出不一样的见解的时候，在组会分享论文的时候，做出耳目一新的 PPT 的时候。</p>
<p>也许我确实是，但是我连打游戏都没法一天八小时持续一个月，社交不行，跑步不行，吉他也不行，唯一成功坚持过的看似也只有读书，读高中的时候，但也得考虑到咱们学六门课呢，而且真是差点就死了。</p>
<p><strong>我不喜欢科研，至少暂时不喜欢</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7e7d336a8b64f15930f1a65ac44b57b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=B%2F82IrtTeqV7gh2dBeRsOPKQheU%3D" alt="IMG_3128" loading="lazy"/></p>
<p>人擅长什么领域，就会在心中的价值天平上给它加码，以确保自己的价值在自己心中过得去。我想高考之于我几乎所有的意义就在于此了。我确认自己的才能、价值、潜力，我知道我的头脑不会背叛我。</p>
<p>不过我也因此发现，无论一篇论文写得多好，总能挑出来毛病，只要我想挑毛病</p>
<p>不是我有多么丰富的知识和见解，而是我必须得挑，因为组会轮到我分享论文了</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/72112686cd51449eb92a293a5727dfb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=c8fCfAru7%2BOx%2BSVQk6rLoViaqe0%3D" alt="IMG_2423" loading="lazy"/></p>
<p>我时常惊叹于我朋友的学习能力和科研水平，也惊叹于我朋友为人处事的八面玲珑。</p>
<p>从小到大我见过的成绩好的人太多了，然而天下英雄如过江之鲫，即使你万里挑一，在这里也有 14 万个，更何况世界不止中国。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42c9c3e34ec244a4bdf95438024619be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=vTqAkgrVK1Al%2FpbltG%2F%2Fao1ShN8%3D" alt="Screenshot 2025-08-10 at 15.34.22" loading="lazy"/></p>
<p>然而幸福是一种独立于客观存在的能力，就像物债二分法，所有权的变动无效并不意味着买卖合同无效 —— 你看到什么，听到什么，感受到什么，才是最重要的，跟客观世界是什么样的、跟别人怎么看你无关。</p>
<p>所以幸福不是那种一下被人流推到癫狂的短暂欢乐，而是一种长期平和的满足。就按一线城市人均寿命 80 岁来算，扣除最后几年没有质量的生命，再扣除已经过去的 18 年，以及 4 年本科、3 年硕士占据现有生命的份额，又能剩下多少年的人生呢？</p>
<p>既然人生永远没有岸，你的体验难道就不重要吗？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ecd40e9a5c04462fb6af820a73682881~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=Oa7j8PUBMSo%2BkLlViX1vLrDPmQo%3D" alt="Screenshot 2025-08-10 at 15.40.13" loading="lazy"/></p>
<p>有时会想，到底什么样的人生是幸福的人生呢？</p>
<p>有项研究表明，一个人在年老的时候身体和灵魂都很健康，还对自己很满意的话，他的人生就是幸福的。这里既包含了个人对自己的评估，也要考量医生和心理学家的评估。</p>
<p>这个研究的好处是把幸福的人生具体化了。不过，研究也表明，你可能等不及到退休的时候再来评估自己的一生。</p>
<p>所以朋友说他在犹豫交不交养老保险，他感觉活不到退休，即使活到了，按当前生育率推断，也是大概率没人给我们交养老金。</p>
<p>总觉得人生路很长，未来还可以做很多事，我想了想<strong>也未必很长，人很难说什么时候会死</strong>，朝生夕死也并非不可能</p>
<p>我们总是以对未来美好的憧憬，来假释当下的苦难，只是美好一直没有到来，竞争倒是永无止息</p>
<p>我不想这样，但有时候又没得选</p>
<h2 data-id="heading-3">#04 倒带人生</h2>
<p>从我记事起，就记得姥姥家的院子里，种着一颗大银杏树。每年春夏，枝头总是挂着一片绿意。等秋天一到，金灿灿的叶子就在风中招摇。风将落叶带去远方，天空飘着的云很是明亮。我只是安静地看着，邻居家那只爱趴在我家屋檐上，呼呼大睡的猫咪，就能虚度一下午的时光。</p>
<p>我这人很简单</p>
<p>如果有星巴克和瑞幸，我一定会去喝瑞幸，因为我喝不出他们有什么区别</p>
<p>但如果是瑞幸和库迪，我一定会去喝瑞幸，哪怕瑞幸十几块一瓶，因为我喝得出来区别</p>
<p>我喜欢没有意义的东西，或者说纯粹的东西，比如喜剧片或悬疑片，我不喜欢对我说教的，蕴含深刻道理的喜剧，这种还不如让我去看黑马程序员网课和国考 980 系统班</p>
<p>小时候我看了好几次东邪西毒，但当时看不懂，所以更喜欢东成西就这样纯粹的荒谬与欢笑，大话西游这样的刻骨铭心的感情</p>
<p>在王家卫的电影哲学里，武侠、江湖皆成摆设，唯有爱与孤独才是亘古不变的精神主题</p>
<p>父母总说长大后就能看懂，但我已经很久没有再看了，因为我觉得我还是看不懂</p>
<p>有些东西，我并不觉得会随着阅历或者经验的增长而改变</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10bb350ff4784eb4863e17859eb4536c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=lC09ahfDbgQQPTFGFUOcU952HKs%3D" alt="Screenshot 2025-08-10 at 15.39.55" loading="lazy"/></p>
<p>一次偶然，初中同学聊天，他说我变了，其实好多人也说过，到初中之后就开始了</p>
<p>不过他们总会对外貌成绩一类的感兴趣，或者感到惊讶</p>
<p>其实人真正改变的是内心，内心的改变是几乎不会表露在外的</p>
<p>所以我一般都把他们的话当耳旁风</p>
<p><strong>因为从来没有人问过我经历过什么</strong></p>
<p>我有时会想到一个高中时很好的朋友身前，一个和我在大大小小的考试中对于名次较劲的人</p>
<p>我曾经很想问问他，你看我有几分像从前</p>
<p>但是已经觉得有些意兴阑珊，坚如磐石的友谊也会在岁月下磨损，最终消逝</p>
<p>极少数人属于木桶中的美酒，岁月流逝后，反而越发醇香</p>
<p>很明显，即使是他，也属于前者</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c47a5f0abcbe48fc867dbfe9a457c39f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=lGzUYH57ID7JiCy6ph3vPEPpb9A%3D" alt="Screenshot 2025-08-10 at 15.34.59" loading="lazy"/></p>
<p>我一直觉得，我以前和现在，本质上并没有太大的变化，直到我看到曾经自己写的日寄</p>
<p>我需要承认，我和以前不一样了</p>
<p>我不再敢打敢拼，不再义无反顾，我会犹豫，会权衡利弊，会害怕未来，会怀疑自己</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef9a78845f994e47a2ebd458abde97e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=2fyiSUxs5mhYNeZZTKlcI5iNaB0%3D" alt="Screenshot 2025-08-10 at 15.31.15" loading="lazy"/></p>
<p>很久以前看 anlin 老师的文章，记得评论区有句话说，说是如果有一天 anlin 老师不再更新文章了，说不定不是一件坏事，因为这说明 anlin 老师在努力生活，或者过得不错，所以不再写日寄了</p>
<p><strong>可我不是</strong></p>
<p>我想把这句话改改，我的日寄大多数时候都很丧，其中虽然有我个人的原因在，但也有深夜写文章的 buff 加成，我希望有一天，大家都能过得不错，这样就不用看我的文章来找一些什么精神共鸣了，但我还是希望提供一些其他东西在，比如我的失败经历、我的踩坑经验，也希望对你有些帮助</p>
<p>有时候总在想人到底为了什么而活</p>
<p>我问家里一个长辈，他说是为了他女儿，我觉得太俗套</p>
<p>我问还在上高中快要高考的表妹，她说是为了自己，我觉得太热血</p>
<p>我问了不少人，大多说法都很千篇一律</p>
<p>我想到问一个大学时候很中二的朋友，他说我脑子是不是进水了</p>
<p>我说我在思考人生，这是个大事</p>
<p>他说福州有家日料自助打折了，准备找空去吃</p>
<p>我也在看自助，但是自助的价格总是很贵</p>
<p>但是要是能睡前买一张自助餐票，然后睡醒了去坐一段不长不短的地铁，狠狠地吃一顿</p>
<p>这样活着也还不错</p>
<p>但人总会告别这个世界，如果是生病的话，应该会有一个时间周期，如果真有这么一天，我不希望你遇到我时，和我说你有多舍不得我，什么没我不行，什么明明知道没有希望还鼓励我的话，什么没有你日子怎么过，你有什么事情还没有做，等你好了我们一起去怎样怎样...</p>
<p>我更想听的是，你有多么怀念我，我这辈子已经完成了什么，告诉我接下来的日子没有我你们仍然会好好过</p>
<p>这就足够了</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f48ccdb5a603468da441529dee154ea6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=UAgfYnwYj5eLexlxGZeEydKMD9I%3D" alt="image-20260207193109269" loading="lazy"/></p>
<p>最近贼有意思，朋友和对象吵架要分手，朋友的对象问：那我们之前的回忆算什么？</p>
<p>TA 说这算你记性好</p>
<p>女生又说：如果未来再相见呢？</p>
<p>TA 说那算你运气好</p>
<p>我的运气就挺点背的，说了再见的人基本没能再见过</p>
<p>有些缘分就像北平的秋雨，不贪心便是落叶轻覆的思念，过分执着就成了望不穿的绵绵水帘</p>
<p><strong>一生很长，很多人不会永远在我的生活里，但会永远在我的故事里</strong></p>
<p>朋友说酒是万能的，配什么都能喝，也没什么忌口</p>
<p>我说也不一定，和头孢就能起反应</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9089c51e340438da5ec47ee465d1a1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=vBEF5oRh5Y%2BtwFANeHePW6rkMkE%3D" alt="Screenshot 2025-08-10 at 15.38.56" loading="lazy"/></p>
<p>最近快放假了，我朋友说好久没来见过我了，问我有没有空，说是想我了</p>
<p>我发现人可以用懒这个词解释很多事情，特别是在现代社会</p>
<p>比如懒得起了，懒得学了，懒得卷了，懒得见了</p>
<p>摆烂这个词挺好，可以称得上是立体防御</p>
<p>什么时候等我摆明白了，或许就看开了</p>
<p>有时也会想在寒假去见一见多年未见的朋友，有时又觉得不值得</p>
<p>比如舍弃一些实习的机会，科研的时间</p>
<p><strong>为了所谓的正确、成功，人们不断失去</strong></p>
<p>我是那种会因为预料到将来的离别而去珍惜与当下朋友相处时间的人</p>
<p>但不是所有人都这样，所以大多数情况下我都是在浪费感情</p>
<p>这是一个流行离开的世界，但是我们都不擅长告别，时间不会抚平悲伤，只会让人淡然</p>
<p>我是个计划性比较强的人，但唯一不可能计划的便是生命的长度，我们往往在追寻其中忽视了它的宽度，忘记去创造更多的价值，我们不知道自己生命的长短，但我们现在还在这个世界上，就应该好好生活。生命本来就不长，焦虑也是一天，开心也是一天，为何不开开心心的过</p>
<p>最近看过一句话，不知道出自哪里，说是“今天可以死，明天也可以活”，这种境界是很高的</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b974f2769bc4898ae20e8f4e9d96bd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=xQTAF6X9IXhZAd8d4kI88JLPK%2FU%3D" alt="img" loading="lazy"/></p>
<p>当我在写这篇年终时，正在为学习和生活上的一地鸡毛而烦恼着。</p>
<p>不知你们会不会也像我一样，在过去或未来的某个时刻，也在怀念着那个无忧的年代。</p>
<p><strong>落叶随着风一阵摆动，家乡的银杏树一直都在，可是我已经回不去了</strong></p>
<h2 data-id="heading-4">#05 生活碎片</h2>
<p>人的烦恼就是记性太好，如果可以把所有事都忘掉，以后每一天都是个新开始，你说多好</p>
<p><strong>时间改变了太多东西了</strong></p>
<blockquote>
<p>总要做点什么自己认为正确的事</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aefb24def2154712a20d8df727975885~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=k0EDhpRy%2FsTAEWbYpjbryhYpgKU%3D" alt="IMG_8178" loading="lazy"/></p>
<blockquote>
<p>依旧 Eason</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1599e47c29245d5892cad8e40881a06~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=RPcXJhwDmxE5yvf5RRizvD3Fqj4%3D" alt="IMG_8174" loading="lazy"/></p>
<blockquote>
<p>JayChou 今年倒是听少了</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f3e5001b47649ffa620b4caf928cfd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=HLbJhggceaT5SETpGAL0iKoAlW4%3D" alt="IMG_8176" loading="lazy"/></p>
<blockquote>
<p>LeetCode 2025</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f7ac0d3e7694c1eaaaa2063cb6c3c00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=08KccyO5wWpv%2B7FdaaCnSps5WDo%3D" alt="IMG_6507" loading="lazy"/></p>
<blockquote>
<p>📷 摄影是我割舍不去的爱好</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cc0127d12d748448da1bfa1ae067bab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=bk8iDW3OgAfVHJeL7caoYTQ%2FN1g%3D" alt="6fba819e71870abe011e10ee428f6b07" loading="lazy"/></p>
<blockquote>
<p>略懂些游戏</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/725f4bc1dbd6491b91c04ad54ce837a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=nI0wumjcI%2B0hMJ230qg8rPG5xBg%3D" alt="e8bd49c009317151783585ea76dba568" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bffa5e86e0004c8a99b1a94afa109ba2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=hgwxQHzU%2BTVXAwAFCkKbeJy85Ug%3D" alt="858436270d98ea632151263fcf4daf5b" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67bf1e74508b409ea7dba074d54d18f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=Gjw%2FFFqN%2Fzx3JhBD7ok0AwoJ1Hk%3D" alt="IMG_8172" loading="lazy"/></p>
<blockquote>
<p>晚霞</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4227ccd5f044f67a3e891165bd824a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=7fnqgj8grBZz3lM6JjEYvd01Q6Y%3D" alt="8a743a6c20cd75acedb7908bfd0d1397" loading="lazy"/></p>
<blockquote>
<p>跨年晚会</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/518557190e9d4bd3b75e914eaf0b5ab0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=zN1IUVImVxC0cC7O91xKY9uuvdA%3D" alt="P1000439" loading="lazy"/></p>
<p>夜晚有风，但不冷，白天的余温还没散去，风吹来只觉得凉爽</p>
<p>很像大三刚保研完在湖边吹风的那个夜晚，意气风发</p>
<p>不过意气风发这个词仿佛永远都不再适合我了</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b29c54f0a1fe454898e8fbb26242afbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29yZWR1bXA=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1771401803&amp;x-signature=gKGvdqrD9fIR%2FWd%2B0pKuDQMbm0g%3D" alt="2e24ee37470ef4910e30365fd81c4659" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[设计模式-行为型]]></title>    <link>https://juejin.cn/post/7605174711181443135</link>    <guid>https://juejin.cn/post/7605174711181443135</guid>    <pubDate>2026-02-11T08:08:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7605174711181443135" data-draft-id="7605142381152763967" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="设计模式-行为型"/> <meta itemprop="keywords" content="前端,后端,设计模式"/> <meta itemprop="datePublished" content="2026-02-11T08:08:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="牛奶"/> <meta itemprop="url" content="https://juejin.cn/user/1169536100866487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            设计模式-行为型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1169536100866487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    牛奶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-02-11T08:08:48.000Z" title="Wed Feb 11 2026 08:08:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-02-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">设计模式-行为型</h2>
<blockquote>
<p>本文主要介绍下行为型设计模式，包括<code>策略模式</code>、<code>模板方法模式</code>、<code>观察者模式</code>、<code>迭代器模式</code>、<code>责任链模式</code>、<code>命令模式</code>、<code>备忘录模式</code>、<code>状态模式</code>、<code>访问者模式</code>、<code>中介者模式</code>和<code>解释器模式</code>，提供前端场景和 ES6 代码的实现过程。
供自己以后查漏补缺，也欢迎同道朋友交流学习。</p>
</blockquote>
<h3 data-id="heading-1">引言</h3>
<p>本文主要介绍下行为型设计模式，包括<code>策略模式</code>、<code>模板方法模式</code>、<code>观察者模式</code>、<code>迭代器模式</code>、<code>责任链模式</code>、<code>命令模式</code>、<code>备忘录模式</code>、<code>状态模式</code>、<code>访问者模式</code>、<code>中介者模式</code>和<code>解释器模式</code>，提供前端场景和 ES6 代码的实现过程。</p>
<h3 data-id="heading-2">什么是行为型</h3>
<p>行为型模式（<code>Behavioral Patterns</code>）主要关注对象之间的<code>通信</code>和<code>职责分配</code>。这些模式描述了对象之间如何<code>协作</code>共同完成任务，以及如何<code>分配职责</code>。行为型模式不仅关注类和对象的结构，更关注它们之间的<code>相互作用</code>，通过定义清晰的通信机制，解决系统中复杂的<code>控制流</code>问题，使得代码更加清晰、灵活和易于维护。</p>
<h3 data-id="heading-3">行为型模式</h3>
<h3 data-id="heading-4">策略模式（Strategy）</h3>
<p>策略模式（<code>Strategy Pattern</code>）定义一系列的算法，把它们一个个封装起来，并使它们可以<code>相互替换</code>。策略模式让算法独立于使用它的客户而变化。</p>
<h4 data-id="heading-5">前端中的策略模式场景</h4>
<ul>
<li><strong>表单验证</strong>：将不同的验证规则（如非空、邮箱格式、手机号格式）封装成策略，根据需要选择验证策略。</li>
<li><strong>不同业务逻辑处理</strong>：例如，根据用户权限（普通用户、VIP、管理员）展示不同的 UI 或执行不同的逻辑。</li>
<li><strong>缓动动画算法</strong>：在动画库中，提供多种缓动函数（如 <code>linear</code>、<code>ease-in</code>、<code>ease-out</code>）供用户选择。</li>
</ul>
<h4 data-id="heading-6">策略模式-JS实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 策略对象</span>
<span class="hljs-keyword">const</span> strategies = {
  <span class="hljs-string">"S"</span>: <span class="hljs-function">(<span class="hljs-params">salary</span>) =&gt;</span> salary * <span class="hljs-number">4</span>,
  <span class="hljs-string">"A"</span>: <span class="hljs-function">(<span class="hljs-params">salary</span>) =&gt;</span> salary * <span class="hljs-number">3</span>,
  <span class="hljs-string">"B"</span>: <span class="hljs-function">(<span class="hljs-params">salary</span>) =&gt;</span> salary * <span class="hljs-number">2</span>
};

<span class="hljs-comment">// 环境类（Context）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Bonus</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">salary, strategy</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">salary</span> = salary;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">strategy</span> = strategy;
  }

  <span class="hljs-title function_">getBonus</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> strategies[<span class="hljs-variable language_">this</span>.<span class="hljs-property">strategy</span>](<span class="hljs-variable language_">this</span>.<span class="hljs-property">salary</span>);
  }
}

<span class="hljs-comment">// 客户端调用</span>
<span class="hljs-keyword">const</span> bonusS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bonus</span>(<span class="hljs-number">10000</span>, <span class="hljs-string">"S"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bonusS.<span class="hljs-title function_">getBonus</span>()); <span class="hljs-comment">// 40000</span>

<span class="hljs-keyword">const</span> bonusA = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bonus</span>(<span class="hljs-number">10000</span>, <span class="hljs-string">"A"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bonusA.<span class="hljs-title function_">getBonus</span>()); <span class="hljs-comment">// 30000</span>
</code></pre>
<h3 data-id="heading-7">模板方法模式（Template Method）</h3>
<p>模板方法模式（<code>Template Method Pattern</code>）定义一个操作中的算法的<code>骨架</code>，而将一些步骤<code>延迟</code>到子类中实现。</p>
<p>模板方法使得子类可以在不改变算法结构的情况下，重新定义算法的某些步骤。</p>
<h4 data-id="heading-8">前端中的模板方法模式场景</h4>
<ul>
<li><strong>UI组件生命周期</strong>：<code>Vue</code> 或 <code>React</code> 组件的生命周期钩子（如 <code>componentDidMount</code>、<code>created</code>）就是模板方法模式的应用。框架定义了组件渲染的整体流程，开发者在特定的钩子中实现自定义逻辑。</li>
<li><strong>HTTP请求封装</strong>：定义一个基础的请求类，处理通用的配置（如 URL、Headers），子类实现具体的请求逻辑（如 GET、POST 参数处理）。</li>
</ul>
<h4 data-id="heading-9">模板方法模式-JS实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 抽象父类：饮料</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Beverage</span> {
  <span class="hljs-comment">// 模板方法，定义算法骨架</span>
  <span class="hljs-title function_">makeBeverage</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">boilWater</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">brew</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">pourInCup</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addCondiments</span>();
  }

  <span class="hljs-title function_">boilWater</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"煮沸水"</span>);
  }

  <span class="hljs-title function_">pourInCup</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"倒进杯子"</span>);
  }

  <span class="hljs-comment">// 抽象方法，子类必须实现</span>
  <span class="hljs-title function_">brew</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"抽象方法不能调用"</span>);
  }

  <span class="hljs-title function_">addCondiments</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"抽象方法不能调用"</span>);
  }
}

<span class="hljs-comment">// 具体子类：咖啡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Coffee</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Beverage</span> {
  <span class="hljs-title function_">brew</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"用沸水冲泡咖啡"</span>);
  }

  <span class="hljs-title function_">addCondiments</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"加糖和牛奶"</span>);
  }
}

<span class="hljs-comment">// 具体子类：茶</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Tea</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Beverage</span> {
  <span class="hljs-title function_">brew</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"用沸水浸泡茶叶"</span>);
  }

  <span class="hljs-title function_">addCondiments</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"加柠檬"</span>);
  }
}

<span class="hljs-comment">// 客户端调用</span>
<span class="hljs-keyword">const</span> coffee = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Coffee</span>();
coffee.<span class="hljs-title function_">makeBeverage</span>();
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 煮沸水</span>
<span class="hljs-comment">// 用沸水冲泡咖啡</span>
<span class="hljs-comment">// 倒进杯子</span>
<span class="hljs-comment">// 加糖和牛奶</span>

<span class="hljs-keyword">const</span> tea = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Tea</span>();
tea.<span class="hljs-title function_">makeBeverage</span>();
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 煮沸水</span>
<span class="hljs-comment">// 用沸水浸泡茶叶</span>
<span class="hljs-comment">// 倒进杯子</span>
<span class="hljs-comment">// 加柠檬</span>
</code></pre>
<h3 data-id="heading-10">观察者模式（Observer）</h3>
<p>观察者模式（<code>Observer Pattern</code>）定义对象间的一种<code>一对多</code>的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。</p>
<h4 data-id="heading-11">前端中的观察者模式场景</h4>
<ul>
<li><strong>DOM事件监听</strong>：<code>document.addEventListener</code> 就是最典型的观察者模式。</li>
<li><strong>Promise</strong>：<code>then</code> 方法也是一种观察者模式，当 Promise 状态改变时，执行相应的回调。</li>
<li><strong>Vue响应式系统</strong>：<code>Dep</code>（目标）和 <code>Watcher</code>（观察者）实现了数据的响应式更新。</li>
<li><strong>RxJS</strong>：基于观察者模式的响应式编程库。</li>
<li><strong>Event Bus</strong>：事件总线。</li>
</ul>
<h4 data-id="heading-12">观察者模式-JS实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 目标对象（Subject）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Subject</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span> = [];
  }

  <span class="hljs-title function_">addObserver</span>(<span class="hljs-params">observer</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">push</span>(observer);
  }

  <span class="hljs-title function_">removeObserver</span>(<span class="hljs-params">observer</span>) {
    <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">indexOf</span>(observer);
    <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
    }
  }

  <span class="hljs-title function_">notify</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">observer</span> =&gt;</span> {
      observer.<span class="hljs-title function_">update</span>(data);
    });
  }
}

<span class="hljs-comment">// 观察者对象（Observer）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Observer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-title function_">update</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> 收到通知: <span class="hljs-subst">${data}</span>`</span>);
  }
}

<span class="hljs-comment">// 客户端调用</span>
<span class="hljs-keyword">const</span> subject = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Subject</span>();
<span class="hljs-keyword">const</span> observer1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>(<span class="hljs-string">"观察者1"</span>);
<span class="hljs-keyword">const</span> observer2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>(<span class="hljs-string">"观察者2"</span>);

subject.<span class="hljs-title function_">addObserver</span>(observer1);
subject.<span class="hljs-title function_">addObserver</span>(observer2);

subject.<span class="hljs-title function_">notify</span>(<span class="hljs-string">"更新数据了！"</span>);
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 观察者1 收到通知: 更新数据了！</span>
<span class="hljs-comment">// 观察者2 收到通知: 更新数据了！</span>
</code></pre>
<h3 data-id="heading-13">迭代器模式（Iterator）</h3>
<p>迭代器模式（<code>Iterator Pattern</code>）提供一种方法<code>顺序访问</code>一个聚合对象中的各个元素，而又不暴露其内部的表示。</p>
<h4 data-id="heading-14">前端中的迭代器模式场景</h4>
<ul>
<li><strong>数组遍历</strong>：<code>forEach</code>、<code>map</code> 等数组方法。</li>
<li><strong>ES6 Iterator</strong>：<code>Symbol.iterator</code> 接口，使得对象可以使用 <code>for...of</code> 循环遍历。</li>
<li><strong>Generators</strong>：生成器函数可以生成迭代器。</li>
</ul>
<h4 data-id="heading-15">迭代器模式-JS实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 自定义迭代器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Iterator</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">items</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span> = items;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> = <span class="hljs-number">0</span>;
  }

  <span class="hljs-title function_">hasNext</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>;
  }

  <span class="hljs-title function_">next</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>++];
  }
}

<span class="hljs-comment">// 客户端调用</span>
<span class="hljs-keyword">const</span> items = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> iterator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Iterator</span>(items);

<span class="hljs-keyword">while</span> (iterator.<span class="hljs-title function_">hasNext</span>()) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(iterator.<span class="hljs-title function_">next</span>());
}
<span class="hljs-comment">// 输出：1 2 3</span>

<span class="hljs-comment">// ES6 Iterator 示例</span>
<span class="hljs-keyword">const</span> iterableObj = {
  <span class="hljs-attr">items</span>: [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>],
  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]() {
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">next</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>) {
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">items</span>[index++], <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> };
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span> };
        }
      }
    };
  }
};

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> iterableObj) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item);
}
<span class="hljs-comment">// 输出：10 20 30</span>
</code></pre>
<h3 data-id="heading-16">责任链模式（Chain of Responsibility）</h3>
<p>责任链模式（<code>Chain of Responsibility Pattern</code>）使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。</p>
<h4 data-id="heading-17">前端中的责任链模式场景</h4>
<ul>
<li><strong>事件冒泡</strong>：DOM 事件在 DOM 树中的冒泡机制就是责任链模式。</li>
<li><strong>中间件</strong>：<code>Express</code>、<code>Koa</code>、<code>Redux</code> 中的中间件机制。</li>
<li><strong>拦截器</strong>：<code>Axios</code> 的请求和响应拦截器。</li>
</ul>
<h4 data-id="heading-18">责任链模式-JS实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 处理器基类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Handler</span> {
  <span class="hljs-title function_">setNext</span>(<span class="hljs-params">handler</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">nextHandler</span> = handler;
    <span class="hljs-keyword">return</span> handler; <span class="hljs-comment">// 返回 handler 以支持链式调用</span>
  }

  <span class="hljs-title function_">handleRequest</span>(<span class="hljs-params">request</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">nextHandler</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">nextHandler</span>.<span class="hljs-title function_">handleRequest</span>(request);
    }
  }
}

<span class="hljs-comment">// 具体处理器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HandlerA</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Handler</span> {
  <span class="hljs-title function_">handleRequest</span>(<span class="hljs-params">request</span>) {
    <span class="hljs-keyword">if</span> (request === <span class="hljs-string">'A'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"HandlerA 处理了请求"</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">handleRequest</span>(request);
    }
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HandlerB</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Handler</span> {
  <span class="hljs-title function_">handleRequest</span>(<span class="hljs-params">request</span>) {
    <span class="hljs-keyword">if</span> (request === <span class="hljs-string">'B'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"HandlerB 处理了请求"</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">super</span>.<span class="hljs-title function_">handleRequest</span>(request);
    }
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">HandlerC</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Handler</span> {
  <span class="hljs-title function_">handleRequest</span>(<span class="hljs-params">request</span>) {
    <span class="hljs-keyword">if</span> (request === <span class="hljs-string">'C'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"HandlerC 处理了请求"</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"没有处理器处理该请求"</span>);
    }
  }
}

<span class="hljs-comment">// 客户端调用</span>
<span class="hljs-keyword">const</span> handlerA = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HandlerA</span>();
<span class="hljs-keyword">const</span> handlerB = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HandlerB</span>();
<span class="hljs-keyword">const</span> handlerC = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HandlerC</span>();

handlerA.<span class="hljs-title function_">setNext</span>(handlerB).<span class="hljs-title function_">setNext</span>(handlerC);

handlerA.<span class="hljs-title function_">handleRequest</span>(<span class="hljs-string">'A'</span>); <span class="hljs-comment">// HandlerA 处理了请求</span>
handlerA.<span class="hljs-title function_">handleRequest</span>(<span class="hljs-string">'B'</span>); <span class="hljs-comment">// HandlerB 处理了请求</span>
handlerA.<span class="hljs-title function_">handleRequest</span>(<span class="hljs-string">'C'</span>); <span class="hljs-comment">// HandlerC 处理了请求</span>
handlerA.<span class="hljs-title function_">handleRequest</span>(<span class="hljs-string">'D'</span>); <span class="hljs-comment">// 没有处理器处理该请求</span>
</code></pre>
<h3 data-id="heading-19">命令模式（Command）</h3>
<p>命令模式（<code>Command Pattern</code>）将一个<code>请求封装</code>为一个对象，从而使用户可用不同的请求对客户进行参数化；对请求排队或记录请求日志，以及支持可撤销的操作。</p>
<h4 data-id="heading-20">前端中的命令模式场景</h4>
<ul>
<li><strong>富文本编辑器</strong>：执行加粗、斜体、下划线等操作，并支持撤销（Undo）和重做（Redo）。</li>
<li><strong>菜单和按钮</strong>：将菜单项或按钮的操作封装成命令对象。</li>
</ul>
<h4 data-id="heading-21">命令模式-JS实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 接收者：执行实际命令</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Receiver</span> {
  <span class="hljs-title function_">execute</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"执行命令"</span>);
  }
}

<span class="hljs-comment">// 命令对象</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Command</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">receiver</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">receiver</span> = receiver;
  }

  <span class="hljs-title function_">execute</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">receiver</span>.<span class="hljs-title function_">execute</span>();
  }
}

<span class="hljs-comment">// 调用者：发起命令</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Invoker</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">command</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">command</span> = command;
  }

  <span class="hljs-title function_">invoke</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"调用者发起请求"</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">command</span>.<span class="hljs-title function_">execute</span>();
  }
}

<span class="hljs-comment">// 客户端调用</span>
<span class="hljs-keyword">const</span> receiver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Receiver</span>();
<span class="hljs-keyword">const</span> command = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Command</span>(receiver);
<span class="hljs-keyword">const</span> invoker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Invoker</span>(command);

invoker.<span class="hljs-title function_">invoke</span>();
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// 调用者发起请求</span>
<span class="hljs-comment">// 执行命令</span>
</code></pre>
<h3 data-id="heading-22">备忘录模式（Memento）</h3>
<p>备忘录模式（<code>Memento Pattern</code>）在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态。这样以后就可将该对象恢复到原先保存的状态。</p>
<h4 data-id="heading-23">前端中的备忘录模式场景</h4>
<ul>
<li><strong>状态管理</strong>：<code>Redux</code> 等状态管理库的时间旅行（Time Travel）功能。</li>
<li><strong>表单草稿</strong>：保存用户输入的表单内容，以便下次恢复。</li>
<li><strong>撤销/重做</strong>：编辑器中的撤销和重做功能。</li>
</ul>
<h4 data-id="heading-24">备忘录模式-JS实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 备忘录：保存状态</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Memento</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">state</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = state;
  }

  <span class="hljs-title function_">getState</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>;
  }
}

<span class="hljs-comment">// 发起人：需要保存状态的对象</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Originator</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = <span class="hljs-string">""</span>;
  }

  <span class="hljs-title function_">setState</span>(<span class="hljs-params">state</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = state;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`当前状态: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.state}</span>`</span>);
  }

  <span class="hljs-title function_">saveStateToMemento</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Memento</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>);
  }

  <span class="hljs-title function_">getStateFromMemento</span>(<span class="hljs-params">memento</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = memento.<span class="hljs-title function_">getState</span>();
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`恢复状态: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.state}</span>`</span>);
  }
}

<span class="hljs-comment">// 管理者：管理备忘录</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Caretaker</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mementos</span> = [];
  }

  <span class="hljs-title function_">add</span>(<span class="hljs-params">memento</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mementos</span>.<span class="hljs-title function_">push</span>(memento);
  }

  <span class="hljs-title function_">get</span>(<span class="hljs-params">index</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">mementos</span>[index];
  }
}

<span class="hljs-comment">// 客户端调用</span>
<span class="hljs-keyword">const</span> originator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Originator</span>();
<span class="hljs-keyword">const</span> caretaker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Caretaker</span>();

originator.<span class="hljs-title function_">setState</span>(<span class="hljs-string">"状态1"</span>);
originator.<span class="hljs-title function_">setState</span>(<span class="hljs-string">"状态2"</span>);
caretaker.<span class="hljs-title function_">add</span>(originator.<span class="hljs-title function_">saveStateToMemento</span>()); <span class="hljs-comment">// 保存状态2</span>

originator.<span class="hljs-title function_">setState</span>(<span class="hljs-string">"状态3"</span>);
caretaker.<span class="hljs-title function_">add</span>(originator.<span class="hljs-title function_">saveStateToMemento</span>()); <span class="hljs-comment">// 保存状态3</span>

originator.<span class="hljs-title function_">setState</span>(<span class="hljs-string">"状态4"</span>);

originator.<span class="hljs-title function_">getStateFromMemento</span>(caretaker.<span class="hljs-title function_">get</span>(<span class="hljs-number">0</span>)); <span class="hljs-comment">// 恢复到状态2</span>
originator.<span class="hljs-title function_">getStateFromMemento</span>(caretaker.<span class="hljs-title function_">get</span>(<span class="hljs-number">1</span>)); <span class="hljs-comment">// 恢复到状态3</span>
</code></pre>
<h3 data-id="heading-25">状态模式（State）</h3>
<p>状态模式（<code>State Pattern</code>）允许一个对象在其内部状态改变时改变它的行为。对象看起来似乎修改了它的类。</p>
<h4 data-id="heading-26">前端中的状态模式场景</h4>
<ul>
<li><strong>有限状态机（FSM）</strong>：例如，Promise 的状态（Pending, Fulfilled, Rejected）。</li>
<li><strong>组件状态管理</strong>：例如，一个按钮可能有 <code>loading</code>、<code>disabled</code>、<code>default</code> 等状态，不同状态下点击行为不同。</li>
<li><strong>游戏开发</strong>：角色的不同状态（如站立、奔跑、跳跃、攻击）。</li>
</ul>
<h4 data-id="heading-27">状态模式-JS实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 状态接口</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span> {
  <span class="hljs-title function_">handle</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"抽象方法不能调用"</span>);
  }
}

<span class="hljs-comment">// 具体状态A</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteStateA</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">State</span> {
  <span class="hljs-title function_">handle</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"当前是状态A"</span>);
    context.<span class="hljs-title function_">setState</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcreteStateB</span>());
  }
}

<span class="hljs-comment">// 具体状态B</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteStateB</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">State</span> {
  <span class="hljs-title function_">handle</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"当前是状态B"</span>);
    context.<span class="hljs-title function_">setState</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcreteStateA</span>());
  }
}

<span class="hljs-comment">// 上下文</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Context</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcreteStateA</span>();
  }

  <span class="hljs-title function_">setState</span>(<span class="hljs-params">state</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = state;
  }

  <span class="hljs-title function_">request</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-title function_">handle</span>(<span class="hljs-variable language_">this</span>);
  }
}

<span class="hljs-comment">// 客户端调用</span>
<span class="hljs-keyword">const</span> context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Context</span>();
context.<span class="hljs-title function_">request</span>(); <span class="hljs-comment">// 当前是状态A</span>
context.<span class="hljs-title function_">request</span>(); <span class="hljs-comment">// 当前是状态B</span>
context.<span class="hljs-title function_">request</span>(); <span class="hljs-comment">// 当前是状态A</span>
</code></pre>
<h3 data-id="heading-28">访问者模式（Visitor）</h3>
<p>访问者模式（<code>Visitor Pattern</code>）表示一个作用于某对象结构中的各元素的操作。它使你可以在不改变各元素的类的前提下定义作用于这些元素的新操作。</p>
<h4 data-id="heading-29">前端中的访问者模式场景</h4>
<ul>
<li><strong>AST遍历</strong>：<code>Babel</code> 插件开发中，通过访问者模式遍历和修改 AST（抽象语法树）节点。</li>
<li><strong>复杂数据结构处理</strong>：对树形结构或图形结构进行不同的操作（如渲染、序列化、验证）。</li>
</ul>
<h4 data-id="heading-30">访问者模式-JS实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 元素类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Element</span> {
  <span class="hljs-title function_">accept</span>(<span class="hljs-params">visitor</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"抽象方法不能调用"</span>);
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteElementA</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Element</span> {
  <span class="hljs-title function_">accept</span>(<span class="hljs-params">visitor</span>) {
    visitor.<span class="hljs-title function_">visitConcreteElementA</span>(<span class="hljs-variable language_">this</span>);
  }

  <span class="hljs-title function_">operationA</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ElementA"</span>;
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteElementB</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Element</span> {
  <span class="hljs-title function_">accept</span>(<span class="hljs-params">visitor</span>) {
    visitor.<span class="hljs-title function_">visitConcreteElementB</span>(<span class="hljs-variable language_">this</span>);
  }

  <span class="hljs-title function_">operationB</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"ElementB"</span>;
  }
}

<span class="hljs-comment">// 访问者类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Visitor</span> {
  <span class="hljs-title function_">visitConcreteElementA</span>(<span class="hljs-params">element</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`访问者访问 <span class="hljs-subst">${element.operationA()}</span>`</span>);
  }

  <span class="hljs-title function_">visitConcreteElementB</span>(<span class="hljs-params">element</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`访问者访问 <span class="hljs-subst">${element.operationB()}</span>`</span>);
  }
}

<span class="hljs-comment">// 客户端调用</span>
<span class="hljs-keyword">const</span> elementA = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcreteElementA</span>();
<span class="hljs-keyword">const</span> elementB = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcreteElementB</span>();
<span class="hljs-keyword">const</span> visitor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Visitor</span>();

elementA.<span class="hljs-title function_">accept</span>(visitor); <span class="hljs-comment">// 访问者访问 ElementA</span>
elementB.<span class="hljs-title function_">accept</span>(visitor); <span class="hljs-comment">// 访问者访问 ElementB</span>
</code></pre>
<h3 data-id="heading-31">中介者模式（Mediator）</h3>
<p>中介者模式（<code>Mediator Pattern</code>）用一个<code>中介对象</code>来封装一系列的对象交互。中介者使各对象不需要显式地相互引用，从而使其耦合松散，而且可以独立地改变它们之间的交互。</p>
<h4 data-id="heading-32">前端中的中介者模式场景</h4>
<ul>
<li><strong>MVC/MVVM框架</strong>：Controller 或 ViewModel 充当中介者，协调 View 和 Model 之间的交互。</li>
<li><strong>复杂表单交互</strong>：例如，选择省份后，城市下拉框需要更新；选择城市后，区县下拉框需要更新。使用中介者统一管理这些联动逻辑。</li>
<li><strong>聊天室</strong>：用户之间不直接发送消息，而是通过服务器（中介者）转发。</li>
</ul>
<h4 data-id="heading-33">中介者模式-JS实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 中介者</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChatMediator</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span> = [];
  }

  <span class="hljs-title function_">addUser</span>(<span class="hljs-params">user</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span>.<span class="hljs-title function_">push</span>(user);
    user.<span class="hljs-title function_">setMediator</span>(<span class="hljs-variable language_">this</span>);
  }

  <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params">message, user</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">u</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (u !== user) {
        u.<span class="hljs-title function_">receive</span>(message);
      }
    });
  }
}

<span class="hljs-comment">// 用户类</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mediator</span> = <span class="hljs-literal">null</span>;
  }

  <span class="hljs-title function_">setMediator</span>(<span class="hljs-params">mediator</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mediator</span> = mediator;
  }

  <span class="hljs-title function_">send</span>(<span class="hljs-params">message</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> 发送消息: <span class="hljs-subst">${message}</span>`</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mediator</span>.<span class="hljs-title function_">sendMessage</span>(message, <span class="hljs-variable language_">this</span>);
  }

  <span class="hljs-title function_">receive</span>(<span class="hljs-params">message</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> 收到消息: <span class="hljs-subst">${message}</span>`</span>);
  }
}

<span class="hljs-comment">// 客户端调用</span>
<span class="hljs-keyword">const</span> mediator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatMediator</span>();
<span class="hljs-keyword">const</span> user1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"User1"</span>);
<span class="hljs-keyword">const</span> user2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"User2"</span>);
<span class="hljs-keyword">const</span> user3 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"User3"</span>);

mediator.<span class="hljs-title function_">addUser</span>(user1);
mediator.<span class="hljs-title function_">addUser</span>(user2);
mediator.<span class="hljs-title function_">addUser</span>(user3);

user1.<span class="hljs-title function_">send</span>(<span class="hljs-string">"大家好！"</span>);
<span class="hljs-comment">// 输出：</span>
<span class="hljs-comment">// User1 发送消息: 大家好！</span>
<span class="hljs-comment">// User2 收到消息: 大家好！</span>
<span class="hljs-comment">// User3 收到消息: 大家好！</span>
</code></pre>
<h3 data-id="heading-34">解释器模式（Interpreter）</h3>
<p>解释器模式（<code>Interpreter Pattern</code>）给定一个语言，定义它的文法的一种表示，并定义一个解释器，该解释器用来解释语言中的句子。</p>
<h4 data-id="heading-35">前端中的解释器模式场景</h4>
<ul>
<li><strong>模板引擎</strong>：<code>Mustache</code>、<code>Handlebars</code> 等模板引擎，解析模板字符串并生成 HTML。</li>
<li><strong>编译器前端</strong>：将代码解析为 AST。</li>
<li><strong>数学表达式计算</strong>：解析并计算字符串形式的数学表达式。</li>
</ul>
<h4 data-id="heading-36">解释器模式-JS实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 抽象表达式</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Expression</span> {
  <span class="hljs-title function_">interpret</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"抽象方法不能调用"</span>);
  }
}

<span class="hljs-comment">// 终结符表达式：数字</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberExpression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Expression</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">number</span>) {
    <span class="hljs-variable language_">super</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">number</span> = number;
  }

  <span class="hljs-title function_">interpret</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">number</span>;
  }
}

<span class="hljs-comment">// 非终结符表达式：加法</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AddExpression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Expression</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">left, right</span>) {
    <span class="hljs-variable language_">super</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">left</span> = left;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">right</span> = right;
  }

  <span class="hljs-title function_">interpret</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">left</span>.<span class="hljs-title function_">interpret</span>(context) + <span class="hljs-variable language_">this</span>.<span class="hljs-property">right</span>.<span class="hljs-title function_">interpret</span>(context);
  }
}

<span class="hljs-comment">// 非终结符表达式：减法</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SubtractExpression</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Expression</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">left, right</span>) {
    <span class="hljs-variable language_">super</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">left</span> = left;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">right</span> = right;
  }

  <span class="hljs-title function_">interpret</span>(<span class="hljs-params">context</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">left</span>.<span class="hljs-title function_">interpret</span>(context) - <span class="hljs-variable language_">this</span>.<span class="hljs-property">right</span>.<span class="hljs-title function_">interpret</span>(context);
  }
}

<span class="hljs-comment">// 客户端调用：计算 10 + 5 - 2</span>
<span class="hljs-keyword">const</span> expression = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubtractExpression</span>(
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">AddExpression</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberExpression</span>(<span class="hljs-number">10</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberExpression</span>(<span class="hljs-number">5</span>)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberExpression</span>(<span class="hljs-number">2</span>)
);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(expression.<span class="hljs-title function_">interpret</span>()); <span class="hljs-comment">// 13</span>
</code></pre>
<h3 data-id="heading-37">项目地址</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fcangnaiwen%2Fdesign-patterns-study" target="_blank" title="https://gitee.com/cangnaiwen/design-patterns-study" ref="nofollow noopener noreferrer">design-patterns-study</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>