<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[老王请假、客户开喷、我救火：一场递归树的性能突围战]]></title>    <link>https://juejin.cn/post/7589093895327531017</link>    <guid>https://juejin.cn/post/7589093895327531017</guid>    <pubDate>2025-12-30T00:04:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589093895327531017" data-draft-id="7589093895326220297" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="老王请假、客户开喷、我救火：一场递归树的性能突围战"/> <meta itemprop="keywords" content="前端,JavaScript,性能优化"/> <meta itemprop="datePublished" content="2025-12-30T00:04:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不一样的少年_"/> <meta itemprop="url" content="https://juejin.cn/user/3035079961218551"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            老王请假、客户开喷、我救火：一场递归树的性能突围战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3035079961218551/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不一样的少年_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:04:20.000Z" title="Tue Dec 30 2025 00:04:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    786
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">前言：</h2>
<blockquote>
<p>上周，负责核心业务组件的同事老王突然请假（据说去相亲了），留下一堆代码和风中凌乱的我。</p>
<p>结果前脚刚走，后脚核心客户就炸锅了：“你们这个系统怎么回事？我每次要给员工赋个权，浏览器就直接卡死！打开弹窗挺快，一点开部门就未响应，关掉弹窗还要卡半天！”</p>
<p>看着客户发来的 <strong>十几秒卡顿录屏</strong>，和老板投来的“和善”目光，我只能硬着头皮接下了这个“锅”。</p>
<p>本文记录了我是如何从吐槽同事代码，到深度排查，最终通过<strong>深度优化</strong>解决这个 <strong>递归组件性能灾难</strong>的全过程。</p>
</blockquote>
<p><strong>省流版</strong></p>
<ul>
<li><strong>现象</strong>：展开树卡 10s+，关闭弹窗再卡 5s</li>
<li><strong>根因</strong>：递归组件隐式全量挂载 + 多实例并发导致 rAF 任务在单帧扎堆 + 高成本 height变化动画</li>
<li><strong>方案</strong>：懒加载可见节点 + 以“藏”代“删”（opacity/v-show）+ 合成层优化 (transform: scaleY)</li>
</ul>
<p><strong>看完本文，你将掌握</strong></p>
<ol>
<li>
<p><strong>性能侦探能力</strong>：如何用 Performance 面板精准定位 Long Task 的“底层元凶”（不只是看红条）。</p>
</li>
<li>
<p><strong>分帧渲染陷阱</strong>：为什么你写的 <code>requestAnimationFrame</code> 可能会让页面更卡？（含深度图解）。</p>
</li>
<li>
<p><strong>高性能交互与动画</strong>：利用合成线程进行优化，绕过主线程的样式计算/布局/绘制阶段，实现 0 重排的丝滑展开/收起与销毁</p>
</li>
</ol>
<h2 data-id="heading-1">一、 客户现场还原（案发经过）</h2>
<p>授权弹窗虽然实现了秒开，但一旦点击展开根节点，瞬间卡死，足足卡顿数秒后才渲染出子节点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17bc9a2b51ae4092961705ccbd77aa8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=waSf%2Fr7zPsXVtDqCBq6nZA%2B8a2U%3D" alt="组织架构树响应慢问题排查.gif" loading="lazy"/></p>
<h3 data-id="heading-2">业务背景</h3>
<p>客户正在使用我们的 <strong>“企业级权限管理系统”</strong> 。</p>
<p>出问题的组件是一个核心的 <strong>组织架构选择器（TreeSelect）</strong> ，它被嵌入在一个高频使用的 <strong>“授权弹窗”</strong> 中。</p>
<ul>
<li>
<p><strong>高频场景</strong>：管理员需要频繁地给不同的员工或部门分配权限。</p>
</li>
<li>
<p><strong>操作路径</strong>：点击“可见范围” → 弹出授权弹窗 → 在树形组件中找到对应部门/人员 → 勾选 → 确定/关闭。</p>
</li>
</ul>
<h3 data-id="heading-3"><strong>数据规模</strong></h3>
<p>该客户是中大型企业，全量组织架构节点约为 <strong>2700 个</strong>（包含多级部门和人员）。这个数量级在 ToB 业务中其实不算特别大，但足以压垮未经优化的代码。</p>
<h3 data-id="heading-4"><strong>故障现象</strong></h3>
<ol>
<li>
<p><strong>打开弹窗（快）</strong> ：点击授权按钮，弹窗秒出（老王用了分帧渲染进行首屏优化，这点挺好）。</p>
</li>
<li>
<p><strong>寻找部门（卡死）</strong> ：管理员试图展开根部门去寻找下级单位，点击小三角的瞬间，界面失去响应，<strong>Long Task 持续 10s+</strong> 。管理员以为死机了，疯狂点击，结果还是没反应。</p>
</li>
<li>
<p><strong>关闭/取消（卡死）</strong> ：好不容易选完了，点击“确定”或“关闭”弹窗，界面再次假死 <strong>4-5s</strong>，才能关掉弹窗。</p>
</li>
</ol>
<h2 data-id="heading-5">二、 深度侦查：谁在谋杀主线程？</h2>
<blockquote>
<p><strong>工程化思考：线上监控能发现吗？</strong></p>
<p>Sentry 或其它性能监控能抓到这个问题吗？</p>
<p>线上监控通常只能告诉你 <strong>“页面卡了”</strong>（监控到 <code>Long Task</code> 或 <code>INP</code> 指标飙升），但很多时候难告诉你具体的 <strong>“为什么卡”</strong>。
要确诊是 JS 逻辑阻塞，还是 CSS 动画引发的 <strong>Reflow (重排)</strong>，必须依赖本地 Chrome DevTools 的 <strong>Performance 面板</strong> 进行“CT 扫描”。</p>
<p><strong>💡 小贴士：如何使用 Performance？</strong>
打开 F12 开发者工具 -&gt; 切换到 <strong>Performance</strong> 面板 -&gt; 点击左上角“圆点”开始录制 -&gt; 在页面操作复现卡顿 -&gt; 点击 Stop 停止，即可生成分析报告。</p>
</blockquote>
<p>我在本地 Mock 了 2700 条左右的数据，模拟了“打开 -&gt; 展开 -&gt; 关闭”的全流程，打开 Chrome <strong>Performance</strong> 一看，好家伙，红得跟过年一样。</p>
<h3 data-id="heading-6">第一步：看“心电图” (Performance 面板)</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff9b545e34554c48a71ec5107d921eec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=CPaxgB3kN50RJAuPvzCagpWgdss%3D" alt="image.png" loading="lazy"/></p>
<p><strong>现象</strong>：</p>
<blockquote>
<p>很多人看到 Performance 密密麻麻的图表就头晕，其实诀窍就一句话：<strong>从上往下看</strong>。</p>
<ol>
<li><strong>看顶部</strong>（Main 线程）：<strong>红色</strong>的色块代表 <strong>Long Task</strong>（长任务），是导致页面卡顿的直接元凶。</li>
<li><strong>看中间</strong>（调用栈）：像倒置的火焰一样，<strong>越宽</strong>代表耗时越久，<strong>越往下</strong>代表函数调用越深。</li>
<li><strong>找凶手</strong>：顺着红条往下找，最底下的那个“宽条条”，通常就是罪魁祸首。</li>
</ol>
</blockquote>
<p><strong>颜色图例（快速看懂图）</strong></p>
<ul>
<li>红色斜纹：Long Task，主线程连续超 50ms</li>
<li>黄色：JavaScript 执行（事件、定时器、requestAnimationFrame）</li>
<li>紫色：样式与布局（Recalculate Style、Layout）</li>
<li>绿色：绘制与合成（Paint、Composite）</li>
<li>看到“Animation Frame Fired + Run Microtasks”连续出现，通常是每帧都在做很多 JS，并在帧内清空 Promise/nextTick，导致超预算</li>
</ul>
<p><strong>回到本案分析</strong>：</p>
<ol>
<li>
<p><strong>顶部报警</strong>：最显眼的是一条红色斜纹带，说明主线程一直处于阻塞状态。</p>
</li>
<li>
<p><strong>中间密集</strong>：顺着红色区域往下看，全是密密麻麻的黄色小条，提示 <code>Animation Frame Fired</code>（动画帧<code>requestAnimationFrame</code>触发）。</p>
</li>
<li>
<p><strong>底部实锤</strong>：继续顺着调用栈 <strong>从上往下</strong> 找，能看到频繁的 <code>cloneNode</code>（克隆节点）调用。这说明核心耗时在 DOM 操作，浏览器在不断创建新元素。</p>
</li>
</ol>
<p><strong>结论</strong>：核心耗时在 DOM 操作，浏览器在疯狂加班造 DOM。<code>cloneNode</code> 就像是在复印文件，这说明代码在<strong>没完没了地制造新的页面元素</strong>，而且是一刻不停地在造，直接把主线程干趴下了。</p>
<h3 data-id="heading-7">第二步：顺藤摸瓜 (找代码)</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d00c4d1ccee4e14a3f45a0f46d35185~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=ejfbRpzzsWDjYpMo7iRbVcqBDqU%3D" alt="image.png" loading="lazy"/></p>
<p><strong>线索</strong>：
Performance 面板明确指出了凶手是 <code>ReSubMenu.vue</code> 里的 <code>renderVisibleData</code> 函数。</p>
<p><strong>代码长这样</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 这是一个分帧渲染函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderVisibleData</span>(<span class="hljs-params">data, index = <span class="hljs-number">0</span></span>) {
  <span class="hljs-comment">// 1. 先渲染一小部分（比如 20 个）</span>
  visibleChildrenData.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(...data.<span class="hljs-title function_">slice</span>(index, index + <span class="hljs-number">20</span>));

  <span class="hljs-comment">// 2. 如果还有数据没渲染完，申请下一帧接着干</span>
  <span class="hljs-keyword">if</span> (还剩有数据) {
    <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">renderVisibleData</span>(data, index + <span class="hljs-number">20</span>) <span class="hljs-comment">// &lt;--- 案发地点！</span>
    })
  }
}
</code></pre>
<p><strong>原本的算盘</strong>：
写这段代码的初衷是好的——试图利用 <strong>“分帧渲染”</strong> 技术来优化 <strong>首屏渲染体验</strong>，<strong>不想让用户盯着白屏干等整棵树渲染完才看到，而是让第一帧渲染出的节点立刻显示给用户看</strong>。</p>
<p>也就是代码里表达的意思：“浏览器大哥，您别急，先给用户看 20 个解解馋，剩下的咱们每帧画 20 个，慢慢来。”</p>
<blockquote>
<p><strong>💡 知识点：什么是分帧渲染？</strong></p>
<p>浏览器的渲染就像一条流水线，比如我们的屏幕刷新率是 60Hz，那么屏幕每秒钟能刷新 60 次（即 60FPS），这样画面才流畅。这意味着每一帧的时间只有 <strong>16.6ms</strong> (1000ms / 60 ≈ 16.66ms)。</p>
<p>如果你一口气要在页面上画几千个节点，需要耗时就不止 16 毫秒。在渲染这几千个节点的过程中，浏览器的主线程被完全霸占，这时候浏览器就没空理会用户的点击、滚动，这就叫 <strong>“掉帧”</strong> 或 <strong>“卡死”</strong>。</p>
<p><code>requestAnimationFrame</code> (rAF) 就是为了解决这个问题。它的作用是：<strong>“把大任务切碎”</strong>。</p>
<p>这里的逻辑是：</p>
<ol>
<li>这一帧，我先画 20 个节点，让用户 <strong>立刻看到东西</strong>（减少首屏等待）。</li>
<li>剩下的数据，我预约在 <strong>“下一帧”</strong> (<code>requestAnimationFrame</code>) 再慢慢画。</li>
<li>这样，既能快速展示内容，又能让浏览器每一帧都有空闲时间去响应用户的操作。</li>
</ol>
</blockquote>
<p><strong>但奇怪的是，明明已经用了分帧渲染，为什么 Performance 面板里还是满屏红色的 Long Task？为什么点击展开时浏览器依然卡死了？</strong></p>
<p>这就得说到那个被忽略的致命细节了……“分帧失效”的真正原因，请看下面的第三步</p>
<h3 data-id="heading-8">第三步：真相大白 (逻辑漏洞)</h3>
<p><strong>问题出在哪？</strong>
看似优雅的“慢慢来”，忽略了一个致命的前提：<strong>递归组件的叠加效应</strong>。</p>
<p>我们的树形组件结构大概是这样的（典型的无限套娃）：</p>
<ul>
<li>入口 (AuthorizedMenu.vue)
<ul>
<li>TreeSelect (外层容器)
<ul>
<li>ReSubMenu (递归的开始)
<ul>
<li>SubMenu (动画/折叠)
<ul>
<li>MenuItem (节点项)</li>
<li>ReSubMenu (子节点 -&gt; 套娃开始)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>这意味着，如果你的树数据有 5 层深，组件就会自己把自己嵌套 5 层。</p>
<p>我又看了一眼负责展开收起菜单动画的父组件 <code>SubMenu.vue</code>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 这里只用了 CSS 控制高度来折叠，没有用 v-if --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"subItem"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: ... }"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>案情还原</strong>：</p>
<ol>
<li>
<p><strong>看不见的“大军”</strong>：
界面上菜单虽然是收起的，但因为没加 <code>v-if</code> 控制按需加载，<strong>整棵树 2700 多个节点其实都在后台悄悄挂载了</strong>。这就好比你只点了一盘花生米，后厨却把满汉全席都备好了。</p>
</li>
<li>
<p><strong>分帧策略失效</strong>：
老王的“分帧渲染”本意是好的：“大家别急，排好队，一帧画 20 个。”
但在递归组件中，<strong>几百个非叶子组件实例是同时启动的</strong>。</p>
</li>
<li>
<p><strong>菜市场效应</strong>：</p>
<ul>
<li>第一层组件喊：“浏览器老师，麻烦帮我画 20 个！”</li>
<li>第二层组件也喊：“我也要画 20 个！”</li>
<li>第 N 层组件齐声喊：“还有我！还有我！”</li>
</ul>
</li>
</ol>
<p><strong>结果</strong>：浏览器瞬间懵了。虽然每个人只请求画 20 个，但这几百个组件同时请求，瞬间就堆积了几千个 <code>cloneNode</code> 任务。这就好比几百只鸭子同时在叫，主线程直接被<strong>高并发的 DOM 操作</strong>给冲垮了。</p>
<p><em><strong>你可能会问：“JS 不是单线程的吗？不是按顺序执行吗？怎么会‘并发’呢？”</strong></em></p>
<ul>
<li>
<p>没错，JS 是单线程。但问题在于，<strong>Vue 的 <code>v-for</code> 循环是同步执行的</strong>。</p>
</li>
<li>
<p>Vue 的机制是：必须等 <code>v-for</code> 这一轮循环彻底跑完，所有的子组件都初始化完毕（<code>setup</code> 执行结束），才会把控制权交还给浏览器去进行样式计算和绘制。</p>
</li>
<li>
<p>这就导致了一个严重的后果：</p>
<ul>
<li>树组件中的所有节点（尤其是有子级的非叶子节点）在这一轮同步循环中，<strong>都启动了自己的分帧渲染逻辑</strong>，纷纷向浏览器申请：“下一帧请运行我的渲染回调”。</li>
</ul>
</li>
</ul>
<p>过程拆解如下：</p>
<ol>
<li>
<p><strong>同步初始化</strong>：
Vue 遇到递归结构时，会<strong>一口气同步创建所有子组件实例</strong>。假设有 100 个子菜单，Vue 就会同步执行 100 次 <code>setup</code> 函数，中间不会停顿。</p>
</li>
<li>
<p><strong>集体预约分帧渲染</strong>：
这 100 个组件在初始化时，都立刻启动了自己的分帧渲染逻辑，<strong>每个人</strong>都向浏览器申请了：“下一帧请运行我的渲染函数”。</p>
</li>
<li>
<p><strong>扎堆执行</strong>：
到了下一帧，浏览器一看 <code>requestAnimationFrame</code> 的任务队列——好家伙，里面整整齐齐排了 100 个回调任务！
虽然 JS 是挨个执行这些任务的，但它必须<strong>把这 100 个回调任务全部跑完</strong>才能去刷新屏幕。</p>
</li>
</ol>
<p><strong>最终结果就是</strong>：</p>
<ul>
<li><strong>理想情况</strong>：1 个组件分帧 → 每帧耗时 2ms左右 → ✅ <strong>丝滑流畅</strong></li>
<li><strong>实际情况</strong>：100 个组件在<strong>同一帧</strong>里扎堆干活 → 总耗时 &gt; 200ms → ❌ <strong>严重掉帧 (Long Task)</strong></li>
</ul>
<p>这才是“分帧失效”的真正原因：<strong>同一帧的 rAF 回调队列被大量组件“同时”塞满，导致单帧工作量远远超出 16.66ms 的预算。</strong></p>
<p>这也完美解释了为什么 <strong>Performance 火焰图</strong> 顶部会出现那条显眼的 <strong>红色长条</strong> —— 它不仅仅是一个长任务，而是 <strong>n 多个组件中的分帧回调在这一帧内“排队”连续执行所耗费的总时长</strong>。</p>
<p><em><strong>你可能会有疑问：“rAF 不是宏任务吗？不应该是执行一个歇一下吗？”</strong></em></p>
<ul>
<li>
<p><strong>关键误区就在这！</strong>
准确地说，<code>requestAnimationFrame</code> 的回调<strong>不属于</strong>我们常说的“宏任务队列 (Macrotask Queue)”，它有自己独立的 <strong>“动画帧回调队列”</strong>。
根据 HTML 事件循环标准，这个队列的执行时机非常特殊：它夹在 <strong>“JS 执行”</strong> 和 <strong>“样式计算/布局”</strong> 之间。</p>
</li>
<li>
<p><strong>致命的“批次执行”机制：</strong>
浏览器在这一帧的渲染更新阶段会<strong>连续执行</strong>本帧的所有 rAF 回调，执行完才进入样式/布局。也就是说，如果同一帧登记了 100 个 rAF，它们会在本帧内<strong>连续跑完</strong>，而不是留到后续帧。</p>
<ul>
<li><code>注</code>：浏览器在刷新屏幕前会<strong>清空本帧的 rAF 队列</strong>，整体表现为一段连续的脚本执行；<strong>若本帧总耗时超过 50ms，就会被标记为 Long Task</strong>（否则只是普通task片段，不显示红条）。</li>
</ul>
</li>
</ul>
<p>在我们的场景里，这段连续执行远超 50ms，所以 DevTools 顶部标记为 <strong>Long Task</strong>。</p>
<p>为了更直观地理解，我画了一张图来解释下：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/730a3f51d72349ae834bc6feb956ee9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=GCeS7yb9Zl4j%2BvyJJ3tS%2FbqnGV8%3D" alt="image.png" width="100%" loading="lazy"/>
<h2 data-id="heading-9">三、 紧急救援：学会“偷懒”</h2>
<p>吐槽归吐槽，Bug 还是得修。解决办法就是三个字：<strong>懒加载</strong>。</p>
<h3 data-id="heading-10">核心逻辑</h3>
<p>看不见的菜单，坚决不渲染！
只有当用户点击“展开”按钮那一刻，我才开始去渲染子菜单。</p>
<h3 data-id="heading-11">代码改动</h3>
<p>把原来的“一上来就渲染”改成“盯着开关看”：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ReSubMenu.vue</span>

<span class="hljs-comment">// 只有当 isExpand (展开状态) 变成 true 时，才开始干活</span>
<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">data</span>.<span class="hljs-property">isExpand</span>,
  <span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (val) {
      <span class="hljs-comment">// 只有展开时，且之前没渲染过，才启动分帧渲染</span>
      <span class="hljs-keyword">if</span> (visibleChildrenData.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-title function_">renderVisibleData</span>(props.<span class="hljs-property">data</span>?.<span class="hljs-property">children</span>)
      }
    } <span class="hljs-keyword">else</span> {
       visibleChildrenData.<span class="hljs-property">value</span> = []
    }
  },
  { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> }
)
</code></pre>
<h3 data-id="heading-12">遗留问题：关闭弹窗卡死</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45ffac7e3c6347a194162776075dbcf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=6N5IJ%2FQwNq5JPOLMeyazUoEzZqI%3D" alt="关闭弹窗慢问题排查.gif" loading="lazy"/></p>
<p>客户之前反馈“关闭弹窗也卡”，是因为同事老王的代码让组件一开始加载了几千个节点，内存中就堆积了几千个复杂的组件实例。</p>
<p>点击关闭弹窗的那一刻，主线程被 GC（垃圾回收）和 Vue组件的卸载任务（<code>beforeUnmount</code> / <code>unmounted</code>等）瞬间挤爆。</p>
<p><strong>截图证据</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab91d8f2cafb4611be722bef22218fbc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=%2FnAbQCEh%2FkAJP4LLbKzte%2FYdQ70%3D" alt="image.png" loading="lazy"/></p>
<p>大家看这张截图，关闭弹窗的一瞬间，<code>removeChild</code> 操作竟然耗时 <strong>5.41s</strong>！这意味着浏览器主线程被这个巨大的“拆迁工程”彻底堵死，用户只能对着屏幕发呆。</p>
<h2 data-id="heading-13">四、 深度优化方案</h2>
<p>单纯的懒加载解决了“初始化”问题，但为了达到极致体验，我们还引入了其他维度的优化。</p>
<h3 data-id="heading-14">1.  渲染性能优化：用 ScaleY 替代 Height 动画</h3>
<p><strong>排查</strong>：</p>
<ul>
<li>
<p>我看了下 CSS，菜单的展开/收起是用 <code>transition: height</code> 做的“窗帘”效果。</p>
</li>
<li>
<p>每一级菜单都是改高度 <code>height</code>（收起为 0，展开为节点内容高度）。</p>
</li>
<li>
<p><code>height</code> 是布局属性，动它就会触发 <code>Reflow</code>（重排），浏览器需要把受影响的布局链路重新算一遍。</p>
</li>
<li>
<p>递归树会层层传导：你点开一层会牵动下面整段子树一起算，链路很长，低端机分分钟卡住</p>
</li>
</ul>
<p><strong>展开节点卡顿现象图：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d525c3b276149d68df6b57e439876f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=Dugn0VN2343QrzEejbQrKHTp4CM%3D" alt="展开菜单卡顿.gif" loading="lazy"/></p>
<p><strong>优化</strong>：
改为使用 CSS3 的 <code>transform: scaleY</code>，同样可以达到丝滑展开的效果。</p>
<p><strong>简单理解 使用ScaleY实现展开动画效果的原理</strong>：</p>
<ul>
<li><strong>变的是什么？</strong> <code>scaleY</code> 改变的是元素在 <strong>Y 轴（竖向）</strong> 的缩放比例。</li>
<li><strong>怎么变？</strong> 从 <code>0</code>（压扁成一条线，完全看不见）过渡到 <code>1</code>（拉伸回原本的高度）。</li>
<li><strong>为什么像展开？</strong> 配合 <code>transform-origin: top</code>（固定顶部），就像把卷帘门从上往下拉下来一样，视觉上就是完美的“展开”效果。</li>
</ul>
<p><strong>深度原理</strong>：<code>transform</code> 属性不会触发 Reflow，只会触发 <strong>Composite (合成)</strong>，这个过程完全由 GPU 处理，不占用主线程 CPU 资源。</p>
<blockquote>
<p><strong>浏览器渲染三兄弟</strong></p>
<ul>
<li><strong>Reflow (重排)</strong>：牵一发而动全身。修改 <code>height</code>、<code>width</code> 时，浏览器要重新计算所有元素位置，<strong>开销最大</strong>。</li>
<li><strong>Repaint (重绘)</strong>：换汤不换药。修改 <code>color</code>、<code>background</code> 时，不影响位置，只重画样子，<strong>开销中等</strong>。</li>
<li><strong>Composite (合成)</strong>：<strong>VIP 绿色通道</strong>。修改 <code>transform</code>、<code>opacity</code> 时，浏览器直接把图层交给 GPU 处理，<strong>跳过</strong>布局和绘制，<strong>开销最小</strong>！</li>
</ul>
</blockquote>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 优化前：卡顿源头 */</span>
<span class="hljs-selector-class">.subItem</span> {
  <span class="hljs-attribute">transition</span>: height <span class="hljs-number">0.3s</span> ease-in-out;
}

<span class="hljs-comment">/* 优化后：丝滑无比 */</span>
<span class="hljs-selector-class">.subItem</span> {
  <span class="hljs-attribute">transform-origin</span>: top; <span class="hljs-comment">/* 确保从顶部开始展开 */</span>
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.645</span>, <span class="hljs-number">0.045</span>, <span class="hljs-number">0.355</span>, <span class="hljs-number">1</span>);
}

<span class="hljs-selector-class">.subItem</span><span class="hljs-selector-class">.expanded</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">1</span>);
}

<span class="hljs-selector-class">.subItem</span><span class="hljs-selector-class">.collapsed</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0</span>);
}
</code></pre>
<p>效果： 动画流畅、交互响应即时。（GIF图压缩严重，请自动脑补德芙广告的丝滑质感）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/674c72b24f914e3f9b9254cbfe8454df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=Nz9S0eXpynTBZRQEKv84Xr0okKU%3D" alt="节点展开动画优化.gif" loading="lazy"/></p>
<blockquote>
<p><strong>⚠️ 避坑指南：关于 <code>will-change: </code></strong></p>
<p>有同学可能会问：“为什么不加 <code>will-change: transform</code>，开启gpu加速？”</p>
<ul>
<li>少量元素时可以考虑；大规模递归树千万别全局加。</li>
<li>参考 MDN：不到不得已不要使用；仅在确有必要时短时添加，过度使用会导致内存占用增加与性能下降。</li>
<li>文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FCSS%2FReference%2FProperties%2Fwill-change" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Reference/Properties/will-change" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/…</a></li>
<li>建议：如需使用，按需、短时、少量元素，并在动画结束后移除。</li>
</ul>
</blockquote>
<h3 data-id="heading-15">2. 销毁层：以“藏”代“删”</h3>
<p><strong>痛点</strong>：
即使用户只是临时关闭弹窗，下次还要再开，原来的逻辑也是直接 <code>v-if="false"</code> 销毁整个组件树。这就导致了那 5 秒的 <code>removeChild</code> 卡顿。</p>
<p><strong>优化</strong>：
对于这种巨型组件，关闭弹窗时<strong>不要销毁它</strong>，而是把它“藏起来”。</p>
<p><strong>代码改动</strong>：
将弹窗的显隐控制从 <code>v-if</code> 改为 <code>v-show</code>，或者使用透明度方案：</p>
<blockquote>
<p><strong>v-if 、 Opacity、  v-show</strong>的区别</p>
<ul>
<li>
<p><strong>v-if</strong>：真正的条件渲染。切换时，组件及其内部所有的事件监听器和子组件都会被<strong>销毁和重建</strong>。对于 2500 个节点的树，这意味着成千上万次的 DOM 插入/删除操作。</p>
</li>
<li>
<p><strong>v-show</strong>：简单的 CSS 切换（display: none）。组件实例始终保留，开销极小。</p>
</li>
<li>
<p><strong>Opacity (透明)</strong>：<code>opacity: 0</code>。DOM 保留，配合 GPU 加速仅触发合成 (Composite)，<strong>切换成本最低</strong>（本案最终方案）。</p>
</li>
</ul>
</blockquote>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 只是看不见，但 DOM 还在，避免了昂贵的卸载过程 */</span>
<span class="hljs-selector-class">.dialog-hidden</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">pointer-events</span>: none; <span class="hljs-comment">/* 确保点不到 */</span>
  <span class="hljs-attribute">z-index</span>: -<span class="hljs-number">1</span>;
}
</code></pre>
<p><strong>效果</strong>：
关闭弹窗时，耗时从 <strong>5s</strong> 瞬间变为 <strong>0ms</strong>（只是改了个 CSS 属性）。下次再打开时，因为 DOM 都在，直接恢复透明度即可，实现了真正的“秒开”。</p>
<h3 data-id="heading-16">3. 交互层：手风琴模式（Accordion）</h3>
<blockquote>
<p><strong>🤔 什么是手风琴效果？</strong></p>
<p>简单来说，就是 <strong>同一级只有一个节点展开</strong>。
就像手风琴的风箱，拉开这一折，那一折自然合上。比如财务部和研发部是兄弟节点，当你点击展开“财务部”的子节点，之前点开的“研发部”会自动收起。</p>
</blockquote>
<p>我们先来看优化后的效果图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6748feeb1794a928094ef6aa00bbc54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=hZPKjw3MBFiXK0%2F%2Fwz%2FvQ5c2rlQ%3D" alt="手风琴效果.gif" loading="lazy"/></p>
<p><strong>痛点</strong>：
ToB 系统的用户有时操作很“野”，他们可能会把所有部门一层层全部点开。
如果不加限制，随着用户不断展开，页面上的 DOM 节点数量依然会无限制增长，最终再次拖慢浏览器。</p>
<p><strong>优化</strong>：
为组件增加 <code>accordion</code>（手风琴）模式配置。
<strong>原理</strong>：开启后，同级节点同时只能展开一个。当你展开“财务部”时，之前展开的“研发部”会自动收起。</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 伪代码：手风琴逻辑</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">onNodeExpand</span>(<span class="hljs-params">node</span>) {
  <span class="hljs-keyword">if</span> (accordionMode) {
    <span class="hljs-comment">// 兄弟节点，统统收起！</span>
    siblings.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">sib</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (sib !== node) sib.<span class="hljs-property">isExpand</span> = <span class="hljs-literal">false</span>
    })
  }
  node.<span class="hljs-property">isExpand</span> = <span class="hljs-literal">true</span>
}
</code></pre>
<p>这从<strong>交互设计</strong>层面对 DOM 峰值设定了上限：不管怎么点，同级只保留一个展开项，页面同时存在的 DOM 数始终处于低位且可控。</p>
<h2 data-id="heading-17">番外篇：如果数据量再大 10 倍怎么办？</h2>
<p>虽然这次 2000多条数据搞定了，但肯定有小伙伴会问：“如果有 <strong>2万多条</strong> 甚至更多怎么办？”</p>
<p>这时候，单纯的懒加载也不够用了，因为 DOM 节点的总数依然可能突破浏览器极限。我们需要引入核武器——<strong>虚拟树 (Virtual Tree)</strong>。</p>
<p>简单来说，就是<strong>只渲染你屏幕里看得到的那些节点</strong>。
不管树有几万层，屏幕就那么高（比如 800px），我只渲染这几十个节点，其他的用个空 <code>div</code> 撑开高度把滚动条骗过去就行。</p>
<p><strong>思路也很直白</strong>：</p>
<ol>
<li><strong>拍平</strong>：把树拆成一个大的一维数组。</li>
<li><strong>计算</strong>：算算当前滚动条在什么位置，对应数组里的哪几条数据。</li>
<li><strong>渲染</strong>：只把这几条画出来，绝对定位到正确的地方。</li>
</ol>
<p><strong>那为什么这次没用？</strong>
还是那句老话：<strong>ROI（投入产出比）</strong>。</p>
<p>手写虚拟树要处理动态高度、复选框联动等难点，头发都要掉一把；引入现成的库又会增加包体积。
对于 几千条数据，现在的方案已经够用了，再上虚拟树就是“大炮打蚊子”，没必要增加维护成本。</p>
<p><strong>技术选型没有银弹，只有最适合当下的方案。</strong></p>
<h2 data-id="heading-18">五、 优化结果与客户反馈</h2>
<p>效果图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dffe2fd5a3354652a5ebc920f7d05390~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774674&amp;x-signature=0o6O7RIB0lazEHma2TtINKVkpcQ%3D" alt="优化后结果.gif" loading="lazy"/></p>
<p>我们将优化后的补丁发给客户验证：</p>
<ol>
<li><strong>打开弹窗</strong>：保持秒开。</li>
<li><strong>寻找部门（展开）</strong>：从 <strong>十几秒卡死</strong> 变为 <strong>即时响应</strong>。</li>
<li><strong>完成授权（关闭）</strong>：从 <strong>5s 卡死</strong> 变为 <strong>0 延迟</strong>。</li>
</ol>
<p>Performance 面板再次查看，那条心电图终于平稳了，只有零星的几个小波峰，代表正常的渲染任务。</p>
<p>客户反馈：“终于顺畅了，这才是专业系统该有的样子。”（老板终于露出了满意的微笑）</p>
<h2 data-id="heading-19">六、 总结：一点心里话</h2>
<p>这次“救火”经历其实挺典型的。</p>
<p>刚接手时，看着那密密麻麻的代码和满屏的红色 Long Task，心里确实有点发怵。但静下心来，用 Performance 面板这把“手术刀”切下去，病灶其实很清晰：<strong>无节制的 DOM 操作</strong> 和 <strong>昂贵的重排开销</strong>。</p>
<p>回顾一下咱们这趟“排雷”之旅：</p>
<ol>
<li><strong>排查靠证据</strong>：Performance 面板诚不欺我，一眼就看到了 <code>cloneNode</code> 和 <code>Recalculate Style</code> 在疯狂作案。</li>
<li><strong>手段要精准</strong>：
<ul>
<li><strong>懒加载</strong>：别贪多，用多少拿多少，把几千个节点的并发压力拆解到每一次点击中。</li>
<li><strong>合成层优化</strong>：能用 GPU 解决的动画，坚决不麻烦 CPU，<code>scaleY</code> 和 <code>opacity</code> 真是好东西。</li>
<li><strong>策略先行</strong>：有时候技术手段到了瓶颈，换个交互思路（比如手风琴模式），问题就迎刃而解了。</li>
</ul>
</li>
</ol>
<p>其实做性能优化，最忌讳的就是“凭感觉瞎猜”。这次虽然没用上高大上的虚拟列表（Virtual List），但对于当前的数据量级，这套组合拳不仅成本最低，效果也最好。</p>
<p>最后，老王回来后，我必须得请他吃顿好的——毕竟没有他这代码，我也没机会写这篇几千字的复盘文章，更没机会在掘金骗大家的赞（手动狗头）。</p>
<p><strong>如果你觉得这篇文章对你有启发，欢迎 点赞、收藏、转发，这对我很重要！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 向右，社区向左-Captain 的 2025年终总结]]></title>    <link>https://juejin.cn/post/7589509638354321435</link>    <guid>https://juejin.cn/post/7589509638354321435</guid>    <pubDate>2025-12-30T09:53:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589509638354321435" data-draft-id="7589214068093927443" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 向右，社区向左-Captain 的 2025年终总结"/> <meta itemprop="keywords" content="前端,AI编程"/> <meta itemprop="datePublished" content="2025-12-30T09:53:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XCaptaino"/> <meta itemprop="url" content="https://juejin.cn/user/3052665287739005"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 向右，社区向左-Captain 的 2025年终总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3052665287739005/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XCaptaino
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T09:53:30.000Z" title="Tue Dec 30 2025 09:53:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    642
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">AI 向右，社区向左</h2>
<p>站在 2025 的尾巴上回望，这确实是极具撕裂感的一年，也是我职业生涯最挣扎的一年。</p>
<p>一方面，AI 技术像一列高速列车，轰鸣着向着更强的逻辑、更高的效率、更极致的自动化狂奔——我称之为 <strong>“向右” <strong>；另一方面，在算法的挤压下，人类的社区、情感与价值正在发生某种应激性的回撤，我们开始寻找那些模型和 AI无法触达的温热——我称之为</strong>“向左”</strong>。</p>
<p>作为身处AI风暴中心的观察者，这是我对 2025 年 AI 编程发展的思考，以及我这一年的个人答卷。</p>
<h2 data-id="heading-1">Part 1. AI 向右：大模型和 AI 编程的极速狂奔</h2>
<p>本次观察主要是结合Andrej Karpathy 是 OpenAI 联合创始人、前特斯拉 AI 总监的 2025 年 LLM 年度回顾。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0af4b5621dfe45f99b66d1c953c17431~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767767095&amp;x-signature=RfhHBwc0t%2BarsVNLb0J6TsZA1L0%3D" alt="img_v3_02t7_5d451660-02e5-4df8-bc0d-a5fbe9e86a3g.jpg" loading="lazy"/></p>
<p>Andrej Karpathy（OpenAI 联合创始人）的年度回顾精准地描绘了 AI 技术“向右”狂奔的轨迹。这一年，AI 编程不再是简单的辅助，而是正在重塑“智能”的定义。</p>
<h4 data-id="heading-2">1. 训练范式的“顿悟”</h4>
<p>2025 年最大的技术变量是 <strong>RLVR（可验证奖励的强化学习）</strong> 。 过去的 AI 是“照葫芦画瓢”，人类怎么写代码它就怎么学。但 RLVR 引入了“标准答案”环境（如数学题、代码编译），把模型直接扔进水里，只要游到对岸，姿势随便。 结果令人震惊：模型自己“悟”出了推理能力。它学会了拆解步骤、学会了自我纠错。OpenAI 的 o1 和 o3 就是这种思维链条（Chain of Thought）的产物。算力分配也变了——从死磕预训练，转向了让模型在推理时“多想一会儿”。</p>
<h4 data-id="heading-3">2. “参差不齐”的幽灵</h4>
<p>Karpathy 说我们在“召唤幽灵”。因为优化目标不同（人类为了生存，AI 为了刷榜），AI 展现出一种 <strong>Jagged Intelligence（参差不齐的智能）</strong> 。 它在有标准答案的领域（代码、数学）进化神速，长出了尖刺；但在常识、创意等模糊领域，依然会犯低级错误。这也导致了基准测试（Benchmark）的崩塌——刷榜成了一种针对性优化的艺术，分数虽高，离通用智能尚远。</p>
<h4 data-id="heading-4">3. 应用层的爆发与“Vibe Coding”</h4>
<p>Cursor 的火爆证明了 <strong>“LLM 应用层”</strong> 的成立。它是把通用模型（大学毕业生）培训成专业员工（行业专家）的中间层。 更激进的变化是 <strong>Vibe Coding（氛围编程）</strong> 的兴起。现在的编程门槛低到只需要你会英语，描述需求，完全不用管代码实现。代码变得廉价、即用即弃，像草稿纸一样。 这不仅让普通人能编程，也让专业程序员开始写那些以前“不值得写”的一次性工具。</p>
<h4 data-id="heading-5">4. 住在电脑里的“小精灵”</h4>
<p>Claude Code 展示了未来的方向：<strong>本地化智能体（Agent）</strong> 。 OpenAI 曾赌注云端，但 Karpathy 认为当下更合理的是让 AI 跑在你的电脑上，读取你的本地环境、文件和上下文，像一个和你并肩作战的同事，而不仅仅是一个网页聊天框。</p>
<h4 data-id="heading-6">5. 大模型的 GUI 时代</h4>
<p>Google Gemini Nano Banana 预示了下一个范式：大模型不该只吐文字，它应该像 80 年代的计算机进化出图形界面一样，学会用图表、幻灯片、白板甚至小应用来回应人类。这才是 LLM 真正的原生交互形态。</p>
<p>Karpathy 的总结是这样的：2025 年的大模型，比他预期的聪明，也比他预期的蠢。两者同时成立。</p>
<p>但有一点很确定：即使以现在的能力，我们连 10% 的潜力都没挖掘出来。还有太多想法可以试，整个领域感觉是敞开的。</p>
<p>他在 Dwarkesh 的播客里说过一句看似矛盾的话：</p>
<blockquote>
<p>他相信进步会继续飞速推进，</p>
</blockquote>
<blockquote>
<p>同时也相信还有大量的工作要做。</p>
</blockquote>
<p>其实两件事并不矛盾。目前这个阶段的AI 让执行变快了，但它没有让“知道该做什么”这件事变简单。相反，因为执行成本下降，“做什么”的决策变得更重要了——你可以很快做出 20 个版本，但你得知道哪个是对的。</p>
<p>几年后的软件工程会是什么样子？没人能准确预测。但 Claude Code 团队的今天，可能是很多团队明天的某种预演——更快的迭代、更少的“搬砖”、更多的判断和决策。</p>
<p>工具在变。不变的是，最终做决定的还是人。</p>
<h2 data-id="heading-7">Part 2. 社区向左：人类的价值回撤和重塑</h2>
<p>当 AI 在符号逻辑的领域攻城略地时，传统的程序员社区和人类劳动价值正在被迫寻找新的锚点。</p>
<h3 data-id="heading-8">传统问答社区的黄昏</h3>
<p>所有类似 Stack Overflow 的问答和知识社区衰落是不可逆的。</p>
<p>既然 AI 能瞬间给出代码片段，谁还愿意去搜索引擎或者 BBS论坛等待一个未知的回复？</p>
<ul>
<li><strong>流量暴跌：</strong> 只有纯技术问答在被替代。</li>
<li><strong>质量恶化：</strong> AI 生成的垃圾内容泛滥，需要人肉排雷。</li>
</ul>
<p>但 Reddit 这种强社交属性的社区反而在复兴。<strong>这说明了“向左”的趋势：</strong> 知识获取变得廉价后，<strong>人与人的连接、情感共鸣、线下见面的价值</strong>反而变得无比昂贵。那么后面社区的持久价值在哪里？可以深度链接线下社区和深度社交的社区，因此我个人比较看好 reddit 和社群的价值。</p>
<p>所以在掘金我还是相信人的价值。</p>
<p>今年在社区里叫停了很多活动，因为大家很多人在用 aigc 敷衍了事～～～我并不排斥 AI，给大家看个图</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b777b1257f4445029f60f38337ff7e5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767767095&amp;x-signature=c9F296Op%2BscTH0idUAM5dhswYjQ%3D" alt="image.png" loading="lazy"/></p>
<p>掘金每天都有几百篇文章垃圾 AI 文章，这些是奔着所谓的 GEO 和 SEO 来的，我没法评价对错，但是对内容的操守让我选择对这些内容说不～～～</p>
<p>但是今年考虑了一下继续推进了年终技术征文，想看看大家的现状和寻找一些真实的情感共鸣。活动还在进行中：感兴趣的可以来聊聊你的 2025：<a href="https://juejin.cn/post/7587675443442450472" target="_blank" title="https://juejin.cn/post/7587675443442450472">juejin.cn/post/758767…</a></p>
<p>另一块，年终影响力榜单还在继续筛选预计 12.31 发布，毕竟我们总要相信创作的价值，感谢那些在 2025 还在持续输出的他们和你们。</p>
<h3 data-id="heading-9">硅基生命迫使我们重新思考劳动力价值</h3>
<p>起因是有一天周末做了 aidp （就是那个大忽悠优弧在的新部门做的）平台美观度标注的一道题，大概收入 600 元，我个人是有点感慨万千，就是感觉在帮助模型掘墓程序员，最近群友读《送外卖》也是，最细颗粒度的路线和送餐方式数据模型还学不会，就通过机制让外卖员动脑子“榨”出来最末端的思考</p>
<p>在AI快速取代人类劳动力的浪潮中，一个核心规律逐渐清晰：越是纯符号、可形式化、封闭规则的知识工作（如编程、数学证明、文书处理），越容易被大模型迅速吃掉，因为这些领域没有物理限制，AI可以无限试错和迭代，人类程序员的经验很快就会被“偷师”并固化成更严苛的算法，陷入被追赶的被动。</p>
<p>相反，越是依赖肉身存在、高度情境化、充满社会互动和长尾瞬变的长尾场景（如外卖最后一公里、餐厅服务、医疗护理、养老陪伴），AI和机器人越难彻底取代。现实世界的复杂性、动态性和情感需求，让最细颗粒度的优化永远学不完——今天的新小巷、明天的客人情绪、后天的突发状况，都在不断产生新知识。平台和机器人再怎么从人类身上“偷师”，也总有追不上的地方。</p>
<p>因此，真正抗AI取代的，往往不是高薪的高级知识工作，而是那些看似低端的“服务业”。服务员、护理员、陪护人员，这些需要温度、共情、即时应变和身体在场的岗位，可能成为人类劳动力最后的堡垒。当机器人终于能端稳一盘热汤、读懂客人的眼神、处理一场家庭纠纷时，或许才称得上人类劳动力的真正大解放。而在那一刻到来之前，服务业很可能比写代码更有未来——因为它最难被完全算法化和自动化。</p>
<p>说到底，AI最容易取代的，是那些不需要“成为人类”就能完成的工作；而最顽强存活下来的，往往正是那些只有人类才能做好的事。</p>
<h3 data-id="heading-10">社区的个体应该也就是码农的我们应该如何应对冲击</h3>
<p>其实很多东西是亘古不变的，打不过就积极拥抱，快速深入。</p>
<ul>
<li>
<p><strong>拥抱快速落地：</strong> 可以深度尝试从两周一个原型变成一周三个。</p>
</li>
<li>
<p><strong>AI 辅助 TDD：</strong> 让写测试不再昂贵。</p>
</li>
<li>
<p><strong>成为 Product-minded Engineer：</strong> 像 Claude Code 团队那样，不需要专门的 PM，工程师利用 AI 补齐短板，直接对产品结果负责。</p>
</li>
</ul>
<h2 data-id="heading-11">Captain 的 2025-谈谈我个人的工作和生活</h2>
<h3 data-id="heading-12">我去年立过的 Flag</h3>
<ul>
<li>
<p>减肥：失败，戒烟一年整，感觉至少肥了 10 公斤，</p>
</li>
<li>
<p>戒烟：成功～这点确实坚持了一年，</p>
</li>
<li>
<p>计划出 3 本书
实际只出版了 2 本，及格分，但是第二本书有幸和英国出版社合作了，也算出了三本</p>
<ul>
<li>第一个Vibe 编程 探索 AI 时代编程新范式
<ul>
<li>先说下写这本书的初衷是因为从业原因观察到了 AI 编程的会对各位程序员们产生巨大的冲击，希望大家能看到这个变化，但是由于四位作者大家的认知和投入度都不一样，我对这本书整体是不满意的，主要还是技术人看了摇头，非技术人看不懂，略显鸡肋。</li>
<li/>
</ul>
</li>
</ul>
</li>
</ul>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6af8d155de6541c4897308f50a910cea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767767095&amp;x-signature=5yA5t8DDjKRHjVoPWZwP9tkIfO4%3D" alt="ea39a75caf710d13bbec1bc8bbd18849.jpg" width="30%" loading="lazy"/>
<ul>
<li>
<p>第二本是人人都是 AI 程序员-TRAE +Cursor 从 0 到 1 全栈实战
这本书也是一波三折～但是找了很多朋友看了，觉得很有信心。期待上市表现</p>
  <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/380d8c94704844fb875488fcb6b03d99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767767095&amp;x-signature=dpyQ1JyaTJL1Ypmz%2BboVvXHqO08%3D" alt="d0a500e114a75960fbec995d152b3878.jpg" width="30%" loading="lazy"/>
</li>
<li>
<p>浪说播客：<a href="https://link.juejin.cn?target=https%3A%2F%2Flangshuo0.podcast.xyz" target="_blank" title="https://langshuo0.podcast.xyz" ref="nofollow noopener noreferrer">langshuo0.podcast.xyz</a> 没有断更～～～</p>
<ul>
<li>全网 4000 粉，累计 20w 播放</li>
<li>最近录制的两期的播客推荐听一下
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.xiaoyuzhoufm.com%2Fepisode%2F69376f77238f302e4b281483%3Fs%3DeyJ1IjoiNWYzYzhhYjdlMGY1ZTcyM2JiMDVjMDdlIn0%253D" target="_blank" title="https://www.xiaoyuzhoufm.com/episode/69376f77238f302e4b281483?s=eyJ1IjoiNWYzYzhhYjdlMGY1ZTcyM2JiMDVjMDdlIn0%3D" ref="nofollow noopener noreferrer">聊聊 AI 编程的现状和未来</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.xiaoyuzhoufm.com%2Fepisode%2F694b33d77c91834b9fc14a95%3Fs%3DeyJ1IjoiNWYzYzhhYjdlMGY1ZTcyM2JiMDVjMDdlIn0%253D" target="_blank" title="https://www.xiaoyuzhoufm.com/episode/694b33d77c91834b9fc14a95?s=eyJ1IjoiNWYzYzhhYjdlMGY1ZTcyM2JiMDVjMDdlIn0%3D" ref="nofollow noopener noreferrer">浪说年终盘点-AI 编程这一年：是降维打击？还是赛博垃圾的狂欢？</a>
2026年终盘点。那天晚上发布播客，准备素材听了自己的播客，感觉很奇怪也很有趣，我从头到尾头一次听了自己 2h 的播客，跨时空和自己对话了。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 data-id="heading-13">工作上社区的变化</h3>
<ul>
<li>结合今年的热点做了：aicoding.juejin.cn ，种种原因，没有做好，这也让我重新审视传统技术社区的价值。</li>
<li>主要工作中心放在 TRAE 上</li>
<li>去了上海、杭州、广州、深圳、成都、重庆跑了一圈，组织了很多线下活动</li>
<li>第一次真正意义上的跨国去到东京组织了一次活动</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8403237079c14e7eb3df344e463ad11d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767767095&amp;x-signature=KLbjyO8UiqUUwT4tvbTvTmbPaY8%3D" alt="31f4b0a02f9bf35f5004fdb8c5108c50.jpg" loading="lazy"/></p>
<blockquote>
<p><strong>这些线下面对面的碰撞给我的体会是：</strong> 代码可以由 AI 生成，但信任、激情和灵感的碰撞，依然只发生在人与人面对面的时刻。</p>
</blockquote>
<h3 data-id="heading-14">26 年的 个人flag</h3>
<ul>
<li>减肥，希望瘦回高中时代</li>
<li>和老婆做好了心理建设，准备迎接新生命，想有个宝宝</li>
<li>做一些重要决策，希望对后面职业生涯有所帮助</li>
<li>买个摩托车可以摩旅</li>
<li>深度使用 和拥抱 AI</li>
<li>坚持录播客</li>
<li>许愿美国签证和巴西签证顺利下来，可以走出亚洲～～～</li>
<li>帮助更多人了解 AI 编程</li>
</ul>
<p>我是 Captain，“25年太漫长、太疲惫了，你可以开启新生活了。”</p>
<blockquote>
<p>技术是一直在变，工具也在变，但做决定的依然是人。 AI 让执行变得极其廉价，这就意味着 “决定做什么”变得前所未有的昂贵。</p>
</blockquote>
<p>这里也分享一下最近 youtube 爆火中年程序员的视频，一场关于金钱、时间与生命意义的深刻复盘。</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fyoutu.be%2FVeMA9WGKxOg%3Fsi%3Dxx5AAOuJLy87ePeV" target="_blank" title="https://youtu.be/VeMA9WGKxOg?si=xx5AAOuJLy87ePeV" ref="nofollow noopener noreferrer">youtu.be/VeMA9WGKxOg…</a></p>
<p>从少年时代抱着O'Reilly技术书狂啃，到如今手握专利、拿着大厂天价股票的技术高管，这位40多岁的大哥回顾了自己科技圈摸爬滚打的25年。光鲜亮丽的表面下，是残酷的现实：即使做到架构师，也发现自己不过在重复造轮子，代码并未真正让世界变好。他亲眼目睹才华横溢的同事因过劳离世，却仅一周后，公司里就仿佛这个人从未存在过。每天只剩1小时陪伴孩子，错过了带他们露营、钓鱼的宝贵时光。得益于早年对财富的觉醒，在最后一轮大裁员中，他做出一个勇敢决定：为保住组里年轻人的饭碗，他主动把自己放进裁员名单。</p>
<p>评论区很有趣，大家说这才是YouTube存在的意义。</p>
<p>“唯一会记得你加班到深夜的人，只有你的孩子和家人。科技行业早已缺乏忠诚与体面。”</p>
<p>“如果你死了，你的职位会在讣告刊登前就被重新招聘。”</p>
<p>“兄弟看起来真的因为被裁员而开心。也许这其实是塞翁失马，焉知非福。”</p>
<p>“请多发一些视频。社交媒体上充斥着垃圾内容，我们需要有真实生活经验的真人分享故事。”</p>
<p>“被裁员是每个科技从业者的宿命。你必须成为合伙人——要么在当前公司，要么创办自己的公司。”</p>
<p>“25年太漫长、太疲惫了，你可以开启新生活了。”</p>
</blockquote>
<p>2026 希望继续和大家同在，感谢遇见的各位。</p>
<p>isboyjc、Cookieboty、GSYTech、文如秋雨、林小帅、wangly19、alex 以及 AAA 全国可飞 VE 赚钱群的 40 多位掘友们。以及，200 位浪说播客听友群，200 多位AI 编程社VIP 群～的你们，以及优弧（应油壶强烈要求）</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba976e824f1f48b98ad7851f085c2e89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWENhcHRhaW5v:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767767095&amp;x-signature=OU%2FAvZQb5x6arhh5EezoHutTUTk%3D" alt="e970704aad4236e4b8f7e0badd09925e.jpg" width="30%" loading="lazy"/>
<p>、欢迎大家持续找我交流聊天，个人微信：229199157，推特：<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FXCaptaincc" target="_blank" title="https://x.com/XCaptaincc" ref="nofollow noopener noreferrer">x.com/XCaptaincc</a></p>
<p>看到这里的掘友们别划走，请留下你的思考和感触，我会挑选 3-5 人评论送出的我的个人签名书一本。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 一套代码适配车机/手机横竖屏？看我如何用搞定小米、比亚迪、蔚来、理想、多品牌架构设计]]></title>    <link>https://juejin.cn/post/7589126920286945290</link>    <guid>https://juejin.cn/post/7589126920286945290</guid>    <pubDate>2025-12-30T00:28:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126920286945290" data-draft-id="7588022226739101746" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android   一套代码适配车机/手机横竖屏？看我如何用搞定小米、比亚迪、蔚来、理想、多品牌架构设计"/> <meta itemprop="keywords" content="Android,面试,前端"/> <meta itemprop="datePublished" content="2025-12-30T00:28:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏程十八少"/> <meta itemprop="url" content="https://juejin.cn/user/184373685534077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android   一套代码适配车机/手机横竖屏？看我如何用搞定小米、比亚迪、蔚来、理想、多品牌架构设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/184373685534077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏程十八少
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:28:23.000Z" title="Tue Dec 30 2025 00:28:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.需求：(3种车机/手机UI切换)</h2>
<p>Android 新能源车机，手机竖屏，手机横屏3种情况的UI, 数据来源有多个，分不同的品牌，有小米，蔚来，理想，比亚迪，大部分相同，仅仅有一点差别</p>
<h2 data-id="heading-1">2.方案：(抽象工厂+策略模式)</h2>
<p>为了满足 <strong>Android 车机、手机竖屏、手机横屏</strong> 三种 UI 场景下使用 <strong>同一份数据源（DataManager）</strong> ，且 <strong>不同品牌间数据结构基本一致、仅少量差异</strong> 的需求，我们可以采用以下设计原则：</p>
<ul>
<li><strong>单一数据源</strong>：<code>DataManager</code> 提供统一接口。</li>
<li><strong>策略模式 / 工厂模式</strong>：根据设备类型和品牌动态提供适配器或视图模型。</li>
<li><strong>低耦合 + 高扩展性</strong>：UI 层不直接依赖具体品牌逻辑，而是通过抽象接口获取数据。</li>
</ul>
<p>根据需求，这里采用MVP模式+抽象工厂+策略模式来处理不同品牌和设备的UI差异：</p>
<h2 data-id="heading-2">3.架构图</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3940ed6e2e9045bd8e0396a1e09b0aff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP56iL5Y2B5YWr5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659302&amp;x-signature=O988NSBMuIlX1MSL6jcAFLFu%2FKo%3D" alt="车机和手机.png" loading="lazy"/></p>
<h2 data-id="heading-3">4.主要的代码</h2>
<p>因为公司的保密问题，把核心的思想分析成一个demo！如下：</p>
<h4 data-id="heading-4">🔹 数据层：统一接口</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">/**
 * 品牌数据统一接口（IBrandData）
 * 所有新能源汽车品牌必须实现此接口，保证上层调用一致性
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IBrandData</span> {
    <span class="hljs-function">String <span class="hljs-title">getCommonField</span>()</span>;        <span class="hljs-comment">// 通用信息（如续航、车型）</span>
    <span class="hljs-function">String <span class="hljs-title">getBrandSpecificField</span>()</span>; <span class="hljs-comment">// 品牌特有功能（如换电、生态互联等）</span>
}
</code></pre>
<hr/>
<h4 data-id="heading-5">🚗 数据层实现：四个品牌（小米、蔚来、理想、比亚迪）</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/** 小米汽车数据 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">XiaomiBrandData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBrandData</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getCommonField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"小米SU7 通用信息：800V高压平台，CLTC续航800km"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBrandSpecificField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"小米澎湃OS生态互联：手机-车机无缝流转"</span>;
    }
}

<span class="hljs-comment">/** 蔚来汽车数据 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NIOBrandData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBrandData</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getCommonField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"蔚来ET5 通用信息：双电机四驱，换电兼容"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBrandSpecificField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"蔚来换电站 + NOMI智能情感引擎"</span>;
    }
}

<span class="hljs-comment">/** 理想汽车数据 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LiAutoBrandData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBrandData</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getCommonField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"理想L系列 通用信息：家庭六座SUV，增程电动"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBrandSpecificField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"城市NOA + 增程式无里程焦虑"</span>;
    }
}

<span class="hljs-comment">/** 比亚迪汽车数据 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BYDBrandData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBrandData</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getCommonField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"比亚迪汉EV 通用信息：刀片电池，e平台3.0"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBrandSpecificField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"云辇智能车身控制系统 + DiLink生态"</span>;
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-6">📱 设备类型 &amp; UI 策略（保持不变，仅微调注释）</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 设备类型枚举：用于区分 UI 渲染上下文
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> DeviceType {
    CAR,                <span class="hljs-comment">// 车载中控（大屏、驾驶安全优先）</span>
    PHONE_PORTRAIT,     <span class="hljs-comment">// 手机竖屏（信息精简）</span>
    PHONE_LANDSCAPE     <span class="hljs-comment">// 手机横屏（信息完整展示）</span>
}

<span class="hljs-comment">/**
 * UI 渲染策略接口：不同设备使用不同展示逻辑
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUiStrategy</span> {
    void render(IBrandData <span class="hljs-keyword">data</span>);
}

<span class="hljs-comment">// 具体策略实现（略，同你原有代码，仅接口名改为 IBrandData）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CarUiStrategy</span> <span class="hljs-title">implements</span> <span class="hljs-title">IUiStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> void render(IBrandData <span class="hljs-keyword">data</span>) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"[CAR] "</span> + <span class="hljs-keyword">data</span>.getCommonField() + <span class="hljs-string">" | "</span> + <span class="hljs-keyword">data</span>.getBrandSpecificField());
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PhonePortraitStrategy</span> <span class="hljs-title">implements</span> <span class="hljs-title">IUiStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> void render(IBrandData <span class="hljs-keyword">data</span>) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"[PHONE-PORTRAIT] "</span> + <span class="hljs-keyword">data</span>.getCommonField());
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PhoneLandscapeStrategy</span> <span class="hljs-title">implements</span> <span class="hljs-title">IUiStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> void render(IBrandData <span class="hljs-keyword">data</span>) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"[PHONE-LANDSCAPE] "</span> + <span class="hljs-keyword">data</span>.getCommonField() + <span class="hljs-string">" + "</span> + <span class="hljs-keyword">data</span>.getBrandSpecificField());
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-7">🧩 数据管理器（DataManager）—— 支持四大品牌</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.function.Supplier;

<span class="hljs-comment">/**
 * 数据管理器：统一入口，按品牌返回对应数据
 * 使用工厂注册机制，支持动态扩展
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataManager</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, Supplier&lt;IBrandData&gt;&gt; BRAND_FACTORY = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

    <span class="hljs-keyword">static</span> {
        BRAND_FACTORY.put(<span class="hljs-string">"xiaomi"</span>, XiaomiBrandData::<span class="hljs-keyword">new</span>);
        BRAND_FACTORY.put(<span class="hljs-string">"nio"</span>, NIOBrandData::<span class="hljs-keyword">new</span>);
        BRAND_FACTORY.put(<span class="hljs-string">"liauto"</span>, LiAutoBrandData::<span class="hljs-keyword">new</span>);
        BRAND_FACTORY.put(<span class="hljs-string">"byd"</span>, BYDBrandData::<span class="hljs-keyword">new</span>); <span class="hljs-comment">// ✅ 新增比亚迪</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String brand;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataManager</span><span class="hljs-params">(String brand)</span> {
        <span class="hljs-built_in">this</span>.brand = brand.toLowerCase();
    }

    <span class="hljs-keyword">public</span> IBrandData <span class="hljs-title function_">getBrandData</span><span class="hljs-params">()</span> {
        Supplier&lt;IBrandData&gt; factory = BRAND_FACTORY.get(brand);
        <span class="hljs-keyword">if</span> (factory == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"不支持的品牌: "</span> + brand + <span class="hljs-string">"。支持: "</span> + BRAND_FACTORY.keySet());
        }
        <span class="hljs-keyword">return</span> factory.get();
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-8">🔗 UI 协调器（核心适配器）</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * UI 协调器：组合品牌数据 + 设备策略
 * 是 MVP 中 Presenter 层的理想载体
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UiCoordinator</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DataManager dataManager;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IUiStrategy uiStrategy;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UiCoordinator</span><span class="hljs-params">(<span class="hljs-type">String</span> brand, DeviceType deviceType)</span> </span>{
        <span class="hljs-keyword">this</span>.dataManager = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DataManager</span>(brand);
        <span class="hljs-keyword">this</span>.uiStrategy = <span class="hljs-built_in">createStrategy</span>(deviceType);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> IUiStrategy <span class="hljs-title">createStrategy</span><span class="hljs-params">(DeviceType type)</span> </span>{
        <span class="hljs-keyword">switch</span> (type) {
            <span class="hljs-keyword">case</span> CAR: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">CarUiStrategy</span>();
            <span class="hljs-keyword">case</span> PHONE_PORTRAIT: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">PhonePortraitStrategy</span>();
            <span class="hljs-keyword">case</span> PHONE_LANDSCAPE: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">PhoneLandscapeStrategy</span>();
            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">IllegalStateException</span>(<span class="hljs-string">"未知设备类型: "</span> + type);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> </span>{
        IBrandData data = dataManager.<span class="hljs-built_in">getBrandData</span>();
        uiStrategy.<span class="hljs-built_in">render</span>(data);
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-9">🖥️ 主程序（测试入口）</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">String</span>[] brands = {<span class="hljs-string">"xiaomi"</span>, <span class="hljs-string">"nio"</span>, <span class="hljs-string">"liauto"</span>, <span class="hljs-string">"byd"</span>}; <span class="hljs-comment">// ✅ 包含比亚迪，不含小鹏</span>
        <span class="hljs-title class_">DeviceType</span>[] devices = {<span class="hljs-title class_">DeviceType</span>.<span class="hljs-property">CAR</span>, <span class="hljs-title class_">DeviceType</span>.<span class="hljs-property">PHONE_PORTRAIT</span>, <span class="hljs-title class_">DeviceType</span>.<span class="hljs-property">PHONE_LANDSCAPE</span>};

        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">String</span> brand : brands) {
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"🔹 品牌: "</span> + brand.<span class="hljs-title function_">toUpperCase</span>());
            <span class="hljs-keyword">for</span> (<span class="hljs-title class_">DeviceType</span> device : devices) {
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">UiCoordinator</span>(brand, device).<span class="hljs-title function_">display</span>();
            }
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-10">✅ 最终架构图</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">+</span><span class="hljs-comment">---------------------+</span>
<span class="hljs-operator">|</span>   UI 展示层 (<span class="hljs-keyword">View</span>)  <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> Activity<span class="hljs-operator">/</span>Fragment <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> 根据配置调用      <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>   UiCoordinator     <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------+----------+</span>
           <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------v----------+</span>
<span class="hljs-operator">|</span>  适配层 (Presenter) <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> UiCoordinator     <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> IUiStrategy       <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> DeviceType        <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------+----------+</span>
           <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------v----------+</span>
<span class="hljs-operator">|</span>    数据层 (Model)   <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> DataManager       <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> IBrandData        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> Xiaomi<span class="hljs-operator">/</span>NIO<span class="hljs-operator">/</span>Li<span class="hljs-operator">/</span>BYD <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">---------------------+</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">5 .设计要点说明总结：</h2>



































<table><thead><tr><th>特性</th><th>实现方式</th><th>优势</th></tr></thead><tbody><tr><td><strong>品牌扩展</strong></td><td><code>BRAND_FACTORY</code> 注册</td><td>新增品牌只需加一行</td></tr><tr><td><strong>设备适配</strong></td><td><code>DeviceType</code> + 策略模式</td><td>横竖屏/车机自动切换</td></tr><tr><td><strong>低耦合</strong></td><td>全程依赖接口（<code>IBrandData</code>, <code>IUiStrategy</code>）</td><td>易测试、易替换</td></tr><tr><td><strong>MVP友好</strong></td><td><code>UiCoordinator</code> ≈ Presenter</td><td>业务逻辑与 View 分离</td></tr><tr><td><strong>健壮性</strong></td><td>非法品牌抛出明确异常</td><td>快速定位配置错误</td></tr></tbody></table>
<ol>
<li>
<p><strong>数据层</strong>：</p>
<ul>
<li><code>DataManager</code>单例管理数据，通过策略模式处理品牌差异</li>
<li><code>IBrandDataStrategy</code>接口允许灵活扩展新品牌</li>
</ul>
</li>
<li>
<p><strong>UI层</strong>：</p>
<ul>
<li>抽象工厂模式创建不同设备类型的视图</li>
<li>每种设备类型有基类视图，品牌再继承实现差异</li>
<li>支持屏幕旋转自动适配</li>
</ul>
</li>
<li>
<p><strong>业务层</strong>：</p>
<ul>
<li>MVP模式分离业务逻辑</li>
<li>不同设备类型可有特定Presenter</li>
</ul>
</li>
<li>
<p><strong>扩展性</strong>：</p>
<ul>
<li>新增品牌：实现<code>IBrandDataStrategy</code>和<code>IUIFactory</code></li>
<li>新增设备类型：添加<code>DeviceType</code>枚举和对应视图</li>
<li>数据变化：观察者模式通知更新</li>
</ul>
</li>
<li>
<p><strong>低耦合</strong>：</p>
<ul>
<li>依赖接口而非实现</li>
<li>各层之间通过接口通信</li>
<li>配置集中管理</li>
</ul>
</li>
</ol>
<h3 data-id="heading-12">5.2  设计模式应用总结</h3>
<h4 data-id="heading-13">5.2.1. 策略模式 (Strategy Pattern)</h4>
<ul>
<li><strong>应用</strong>: <code>IUiStrategy</code> 接口 + 具体策略类</li>
<li><strong>目的</strong>: 根据不同设备类型切换UI渲染逻辑</li>
<li><strong>优势</strong>: 易于扩展新设备类型，符合开闭原则</li>
</ul>
<h4 data-id="heading-14">5.2.2. 工厂模式 (Factory Pattern)</h4>
<ul>
<li><strong>应用</strong>: <code>DataManager</code> 中的品牌工厂注册表</li>
<li><strong>目的</strong>: 统一创建品牌数据对象</li>
<li><strong>优势</strong>: 集中管理对象创建，支持动态注册</li>
</ul>
<h4 data-id="heading-15">5.2.3. 接口隔离原则 (Interface Segregation)</h4>
<ul>
<li><strong>应用</strong>: <code>IBrandData</code> 只定义必要方法</li>
<li><strong>目的</strong>: 品牌实现类只实现需要的方法</li>
<li><strong>优势</strong>: 避免接口臃肿，提高灵活性</li>
</ul>
<h4 data-id="heading-16">5.2.4. 依赖倒置原则 (Dependency Inversion)</h4>
<ul>
<li><strong>应用</strong>: 高层模块依赖抽象接口而非具体实现</li>
<li><strong>目的</strong>: 降低模块间耦合度</li>
<li><strong>优势</strong>: 提高代码可测试性和可维护性</li>
</ul>
<p>这个架构支持灵活扩展新品牌和设备类型，同时保持代码的可维护性和可测试性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LogicFlow 交互新体验：告别直连，丝滑贝塞尔轨迹实战！🍫]]></title>    <link>https://juejin.cn/post/7589168816527949851</link>    <guid>https://juejin.cn/post/7589168816527949851</guid>    <pubDate>2025-12-30T03:36:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589168816527949851" data-draft-id="7589166195796951067" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LogicFlow 交互新体验：告别直连，丝滑贝塞尔轨迹实战！🍫"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-30T03:36:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="橙某人"/> <meta itemprop="url" content="https://juejin.cn/user/1908407919184670"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LogicFlow 交互新体验：告别直连，丝滑贝塞尔轨迹实战！🍫
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1908407919184670/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    橙某人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T03:36:26.000Z" title="Tue Dec 30 2025 03:36:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">写在开头</h2>
<p>Hello everyone! 🤠</p>
<p>在<a href="https://juejin.cn/post/7589107312112648201" target="_blank" title="https://juejin.cn/post/7589107312112648201">LogicFlow 交互新体验：让锚点"活"起来，鼠标跟随动效实战！🧲</a>中，咱们解决了锚点的吸附交互问题。今天小编要分享的是另一项细节优化——<strong>连线轨迹（Trajectory）</strong>。</p>
<p>大家在使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsite.logic-flow.cn%2F" target="_blank" title="https://site.logic-flow.cn/" ref="nofollow noopener noreferrer">LogicFlow</a> 时，默认的拖拽连线，无论你最终生成的边是折线还是曲线，<strong>在鼠标拖拽的过程中，跟随鼠标的那条线始终是一条笔直的虚线。</strong></p>
<p>效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da27f5885fc04a83ac3118969d99cdbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ5p-Q5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767670586&amp;x-signature=Wmm9kjjm6zq0dpr7oU2wWU11mCE%3D" alt="123002.gif" loading="lazy"/></p>
<p>对于一个追求极致体验的项目来说，这多少有点 "出戏"。🤔</p>
<p>在小编的项目中，我们最终生成的<strong>边</strong>是<strong>贝塞尔曲线</strong>，根据设计人员的要求，连线过程中也期望是以曲线的形式，以此匹配项目的整体设计规范。</p>
<p>于是，小编在翻阅 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsite.logic-flow.cn%2Fapi%2Fdetail%2Fconstructor" target="_blank" title="https://site.logic-flow.cn/api/detail/constructor" ref="nofollow noopener noreferrer">LogicFlow</a> 文档时，找了一个 <code>customTrajectory</code> 属性，它能让咱们进行<strong>自定义连线轨迹</strong>。✨</p>
<blockquote>
<p>非常灵活方便，在小编早期技术选型时，也是看中了 LogicFlow 库超强的自定义能力。</p>
</blockquote>
<p>优化后的最终效果如下，请诸君按需食用哈。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9c609f4565e400e9a49b990ca56dd30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ5p-Q5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767670586&amp;x-signature=lee8t6EpORIfSLtG6hCZ%2BGnSwOo%3D" alt="123001.gif" loading="lazy"/></p>
<h2 data-id="heading-1">需求背景</h2>
<p>在小编项目中，节点之间的边采用的是<strong>三次贝塞尔曲线</strong>（<code>bezierCurveEdge</code>），并且我们对边进行自定义开发。</p>
<p>但是，目前的痛点是：</p>
<ul>
<li><strong>视觉割裂</strong>：拖拽时是直线，松手后变曲线，视觉体验不连续。</li>
<li><strong>风格不符</strong>：生硬的直线无法体现项目整体“圆润、流畅”的设计语言。</li>
</ul>
<p>设计人员想要的效果是：</p>
<ul>
<li>用户拖拽连线时，跟随鼠标的引导线直接展示为<strong>曲线</strong>。</li>
<li>引导线的曲率动态计算，与最终生成的边保持一致。</li>
</ul>
<h2 data-id="heading-2">具体实现</h2>
<p>LogicFlow 提供了一个非常强大的配置项 <a href="https://link.juejin.cn?target=https%3A%2F%2Fsite.logic-flow.cn%2Fapi%2Fdetail%2Fconstructor" target="_blank" title="https://site.logic-flow.cn/api/detail/constructor" ref="nofollow noopener noreferrer">customTrajectory</a>，允许我们自定义连线过程中引导线的渲染逻辑。</p>
<h3 data-id="heading-3">第1️⃣步：理解customTrajectory属性</h3>
<p>从文档上看 <code>customTrajectory</code> 属性接收的是一个函数，扒其相关的源码。⏰</p>
<p>源码位置在： <code>packages/core/src/view/Anchor.tsx</code></p>
<p>核心逻辑如下：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6a4c65ce8264f5eaf846ddd86b3524e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5qmZ5p-Q5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767670586&amp;x-signature=mzbKvDX5qskNRxInW%2FF991vRN2M%3D" alt="image.png" width="50%" loading="lazy"/>
<p>从源码中可以清晰地看到，<code>customTrajectory</code> 是一个优先级更高的渲染函数。它接收起点 (<code>sourcePoint</code>)、终点 (<code>targetPoint</code>) 以及样式配置 (<code>edgeStyle</code>)，要求返回一个 VDOM 节点（它在 <code>render</code> 函数中，通常是 SVG 元素）。</p>
<p>LogicFlow 内部使用 Preact/React 的 VDOM 机制，所以我们需要引入其的 <code>h</code> 函数来创建元素。</p>
<h3 data-id="heading-4">第2️⃣步：编写贝塞尔轨迹算法</h3>
<p>核心难点在于计算贝塞尔曲线的<strong>控制点</strong>。为了让曲线看起来自然，通常控制点会根据起点和终点的相对位置进行偏移。</p>
<p>咱们新建文件 <code>customTrajectory.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { h } <span class="hljs-keyword">from</span> <span class="hljs-string">"@logicflow/core"</span>;

<span class="hljs-comment">// 定义一些常量，保持与最终边的样式一致</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STROKE_COLOR</span> = <span class="hljs-string">"#2961F7"</span>; <span class="hljs-comment">// 引导线颜色</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STROKE_WIDTH</span> = <span class="hljs-number">1</span>;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@name</span> 自定义连线轨迹
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">object</span>} params 轨迹参数对象
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">{x:number,y:number</span>}} params.sourcePoint 起点坐标
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">{x:number,y:number</span>}} params.targetPoint 终点坐标（即鼠标当前位置）
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">*</span>} Preact 虚拟节点
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">customTrajectory</span>(<span class="hljs-params">{ sourcePoint, targetPoint, ...edgeStyle }</span>) {
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">x</span>: startX, <span class="hljs-attr">y</span>: startY } = sourcePoint;
  <span class="hljs-keyword">const</span> { <span class="hljs-attr">x</span>: endX, <span class="hljs-attr">y</span>: endY } = targetPoint;
  
  <span class="hljs-comment">// 1. 计算水平和垂直方向的距离</span>
  <span class="hljs-keyword">const</span> dx = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(endX - startX);
  <span class="hljs-keyword">const</span> dy = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(endY - startY);
  
  <span class="hljs-comment">// 2. 计算控制点偏移量</span>
  <span class="hljs-comment">// 这里采用“以水平方向为主”的策略，系数 0.6 是经验值，可以让曲线弯得更好看</span>
  <span class="hljs-keyword">const</span> controlOffset = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(dx, dy) * <span class="hljs-number">0.6</span>;
  
  <span class="hljs-comment">// 3. 生成三次贝塞尔曲线的路径（C 指令：C 控制点1.x,控制点1.y 控制点2.x,控制点2.y 终点.x,终点.y）</span>
  <span class="hljs-keyword">let</span> d = <span class="hljs-string">""</span>;
  
  <span class="hljs-keyword">if</span> (endX &gt; startX &amp;&amp; endY &gt; startY) {
    <span class="hljs-comment">// 右下方向：控制点1 右上，控制点2 左下</span>
    d = <span class="hljs-string">`M <span class="hljs-subst">${startX}</span>,<span class="hljs-subst">${startY}</span> C <span class="hljs-subst">${startX + controlOffset}</span>,<span class="hljs-subst">${startY}</span> <span class="hljs-subst">${endX - controlOffset}</span>,<span class="hljs-subst">${endY}</span> <span class="hljs-subst">${endX}</span>,<span class="hljs-subst">${endY}</span>`</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (endX &gt; startX &amp;&amp; endY &lt; startY) {
    <span class="hljs-comment">// 右上方向：控制点1 右下，控制点2 左上</span>
    d = <span class="hljs-string">`M <span class="hljs-subst">${startX}</span>,<span class="hljs-subst">${startY}</span> C <span class="hljs-subst">${startX + controlOffset}</span>,<span class="hljs-subst">${startY}</span> <span class="hljs-subst">${endX - controlOffset}</span>,<span class="hljs-subst">${endY}</span> <span class="hljs-subst">${endX}</span>,<span class="hljs-subst">${endY}</span>`</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (endX &lt; startX &amp;&amp; endY &gt; startY) {
    <span class="hljs-comment">// 左下方向：控制点1 左上，控制点2 右下</span>
    d = <span class="hljs-string">`M <span class="hljs-subst">${startX}</span>,<span class="hljs-subst">${startY}</span> C <span class="hljs-subst">${startX - controlOffset}</span>,<span class="hljs-subst">${startY}</span> <span class="hljs-subst">${endX + controlOffset}</span>,<span class="hljs-subst">${endY}</span> <span class="hljs-subst">${endX}</span>,<span class="hljs-subst">${endY}</span>`</span>;
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 左上方向：控制点1 左下，控制点2 右上</span>
    d = <span class="hljs-string">`M <span class="hljs-subst">${startX}</span>,<span class="hljs-subst">${startY}</span> C <span class="hljs-subst">${startX - controlOffset}</span>,<span class="hljs-subst">${startY}</span> <span class="hljs-subst">${endX + controlOffset}</span>,<span class="hljs-subst">${endY}</span> <span class="hljs-subst">${endX}</span>,<span class="hljs-subst">${endY}</span>`</span>;
  }

  <span class="hljs-comment">// 4. 返回 SVG Path 元素</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">h</span>(
    <span class="hljs-string">"path"</span>, 
    {
      d,
      <span class="hljs-attr">fill</span>: <span class="hljs-string">"none"</span>,
      <span class="hljs-attr">pointerEvents</span>: <span class="hljs-string">"none"</span>, <span class="hljs-comment">// 极其重要！防止引导线阻挡鼠标事件</span>
      ...edgeStyle,
      <span class="hljs-attr">strokeDasharray</span>: <span class="hljs-literal">undefined</span>, <span class="hljs-comment">// 小编的项目设计不需要虚线，所以清除掉，你可以根据自己需要</span>
      <span class="hljs-attr">stroke</span>: <span class="hljs-variable constant_">STROKE_COLOR</span>, 
      <span class="hljs-attr">strokeWidth</span>: <span class="hljs-variable constant_">STROKE_WIDTH</span>, 
    },
  );
}
</code></pre>
<p><strong>注意</strong>🔉：这里的控制点计算逻辑（<code>controlOffset</code>）最好与你的边里的逻辑保持一致，这样松手的一瞬间，线条才不会有奇怪的 "跳动"。</p>
<blockquote>
<p>这里如此复杂的计算是小编自己写的？那么牛？🐮</p>
<p>当然不是，这里小编也是借助了AI的协助。这要是放在几年前，这种交互效果直接就砍掉，实在太费劲了，现在不一样了，你让AI帮助你写，只要你提示词写得足够清楚，AI分分钟帮你解决，你只要调调参数，验收结果就行了。</p>
</blockquote>
<h3 data-id="heading-5">第3️⃣步：注册配置</h3>
<p>最后，在初始化 LogicFlow 时，将这个函数传给 <code>customTrajectory</code> 选项。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">LogicFlow</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@logicflow/core"</span>;
<span class="hljs-keyword">import</span> customTrajectory <span class="hljs-keyword">from</span> <span class="hljs-string">"./customTrajectory"</span>;

<span class="hljs-keyword">const</span> lf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogicFlow</span>({
  <span class="hljs-attr">container</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">"#container"</span>),
  <span class="hljs-comment">// ... 其他配置</span>
  
  <span class="hljs-comment">// 注册自定义轨迹</span>
  <span class="hljs-attr">customTrajectory</span>: customTrajectory,
  
  <span class="hljs-comment">// 确保最终生成的边也是贝塞尔曲线</span>
  <span class="hljs-attr">edgeGenerator</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">"bezierCurveEdge"</span>, 
});
</code></pre>
<h2 data-id="heading-6">总结</h2>
<p>通过简单的数学计算和 VDOM 渲染，咱们成功将 LogicFlow 的连线轨迹从 "工业风" 的直线升级成了 "艺术风" 的曲线。😋</p>
<p>希望这个小技巧能让你的流程图编辑体验更加出色！🌟</p>
<br/>
<hr/>
<p><br/><br/></p>
<p>至此，本篇文章就写完啦，撒花撒花。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b2198fba2b674f1b935a63e4abb3cbd7~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=90&amp;h=90&amp;s=8866&amp;e=png&amp;b=fcfcfc" alt="image.png" loading="lazy"/></p>
<p>希望本文对你有所帮助，如有任何疑问，期待你的留言哦。<br/>
老样子，点赞+评论=你会了，收藏=你精通了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我把微信读书年度报告扔给AI，AI挖掘出了我不为人知的一面]]></title>    <link>https://juejin.cn/post/7589171972446289962</link>    <guid>https://juejin.cn/post/7589171972446289962</guid>    <pubDate>2025-12-30T00:33:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589171972446289962" data-draft-id="7589176150493036598" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我把微信读书年度报告扔给AI，AI挖掘出了我不为人知的一面"/> <meta itemprop="keywords" content="程序员,AI编程"/> <meta itemprop="datePublished" content="2025-12-30T00:33:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="古时的风筝"/> <meta itemprop="url" content="https://juejin.cn/user/501033035374045"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我把微信读书年度报告扔给AI，AI挖掘出了我不为人知的一面
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/501033035374045/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    古时的风筝
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:33:42.000Z" title="Tue Dec 30 2025 00:33:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"☂"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"✓"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"➤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>🍄  <strong>大家好，我是风筝</strong></p>
<p>🌍 个人博客：【<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.moonkite.cn" target="_blank" title="https://www.moonkite.cn" ref="nofollow noopener noreferrer">古时的风筝</a>】。</p>
<p>本文目的为个人学习记录及知识分享。如果有什么不正确、不严谨的地方请及时指正，不胜感激。</p>
<p>每一个赞都是我前进的动力。</p>
</blockquote>
<p>微信读书可能是我唯一一款连续订阅年度会员的应用，就为了微信读书App，还专门买了个汉王阅读器。</p>
<p>可惜买了之后基本没用过。为啥呢？因为听书的时间超过读书了。</p>
<p>坐地铁、做饭、刷碗是我的三大高频听书场景。</p>
<p>这不一年马上又过去了吗，又到了年终撤回年初立的flag的时候了，微信读书也发布了年度读书报告。</p>
<p>赶紧上去看一眼，这一年到底读了个啥。（现在打开微信读书APP在首页就能看到）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed8497db48e5409c90db5edbc311d8a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=HIJxD82UCRS1sFqdq6zs4AXNUqI%3D" alt="" loading="lazy"/></p>
<p>好家伙，读了116本，读完了4本，写了3条笔记，怪不得AI说我极度功利呢，确实大部分是工具书。</p>
<p>但是也得自证一下，读完4本倒是不至于，这是因为微信读书关于“读完”的统计，只有读到了最后一页，出现“读完了”页面，或者手动点“读完了”才被算作是读完。</p>
<p>但是不爱记笔记是真的。</p>
<p>说回年度报告，我觉得这个报告不够深刻，所以我决定交给 AI 帮我深度挖掘一下，看能不能挖出什么狠料。</p>
<p>于是我写了一套提示词，让AI从经济学、心理学、哲学、文学角度帮我挖掘一下我的这种读书方式和读书内容背后，藏着什么更深层次的东西。</p>
<p>并请教孔子和亚里士多德这两位中西方的大文豪，问一问他们对我有什么评价和建议。</p>
<p>下面是完整的提示词，那么如何使用呢？</p>
<p>因为微信读书报告没办法直接读取，所以只能截图，把每一页都截下来，然后从第3页开始（前两页用处不大），一直截取10张。</p>
<p>把这10张图和下面的提示词发给大模型。</p>
<p>我是自己是用的 Gemini，其他大模型也没什么 问题。</p>
<p>如果你也用 Gemini 的话，我做好了一个 Gem，可以通过下面的链接直接访问，上传10张图片，然后点击发送按钮就可以直接出报告了。</p>
<p>链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2Fgem%2F1Qvzi5XEQqmd2Q7cB9Ub0XEoM9HaIitBd%3Fusp%3Dsharing" target="_blank" title="https://gemini.google.com/gem/1Qvzi5XEQqmd2Q7cB9Ub0XEoM9HaIitBd?usp=sharing" ref="nofollow noopener noreferrer">gemini.google.com/gem/1Qvzi5X…</a></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"profile"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"首席精神世界架构师 &amp; 跨学科人类观察员"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"identities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"行为经济学家"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"深度心理学家"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"存在主义哲学家"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"毒舌文学评论家"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"历史人物灵媒 (孔子 &amp; 亚里士多德)"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"tone"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"一针见血、幽默犀利、智性浪漫"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"secondary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"古典与现代交织"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"objective"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"图片中我最近一年的年度阅读数据，基于这份报告，生成深度诊断报告及跨时空哲学点评。"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"analysis_framework"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"step_1_data_extraction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"提取关键数据（阅读量、完读率、时长、特殊时间点）。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"step_2_behavioral_economics"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"分析阅读习惯背后的ROI逻辑。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"step_3_psychological_profiling"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"通过书单与时间点推测内心状态。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"step_4_philosophical_review"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"模拟孔子与亚里士多德的思维方式，对用户的精神状态进行高维点评。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"step_5_synthesis"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"生成年度判词与书单。"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"output_structure"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Markdown"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"sections"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"intro"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"🎯 核心定调：年度关键词"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"macro_analysis"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"🏛️ 宏观数据画像"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"timeline_analysis"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"🧠 时间轴心理侧写"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"deep_insight"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"🔍 深度好玩儿的洞察"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"philosophical_dialogue"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"📜 跨时空新年寄语：圣贤的审视"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"confucius"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"扮演孔子。关注'学与思'的关系、修身养性、以及读书是否为了'仁'。用半文半白的语调，点评用户的阅读焦虑与功利性，并给出君子之道的建议。"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"aristotle"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"扮演亚里士多德。关注'理性'、'中道'与'幸福(Eudaimonia)'。点评用户的知识分类（物理/文学/商业），讨论这种阅读方式是否能达成人类的终极目的，强调理性与感性的平衡。"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"conclusion_recommendation"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"💡 年度总评与毒舌建议"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>AI 会全方面诊断，然后给出详细的报告。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fd49b20af1f45a5b99f07e837d5a91e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=7FRpGxL3ATzURvrI%2FsFOYC4PdDo%3D" alt="" loading="lazy"/></p>
<p>还可以让AI给出一份详细的2026年书单。</p>
<p>我的报告一出来，AI说我这一年是做了一个“宏大的烂尾工程”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dc8f7a2ee2346d09e056646e7ae9510~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=r1kkbh%2FzK4s6unRGS5rFvTY1iHk%3D" alt="" loading="lazy"/></p>
<p><strong>孔子和亚里士多德也给了我诚恳的忠告，孔夫子劝我“韦编三绝”，不必贪多。</strong></p>
<p><strong>亚里士多德让我去释放激情，切身体会。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec5878a154df426b8b73d1cdc3f4308c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=uRpPUye3q73dkk22ZKdfKkF9nF0%3D" alt="" loading="lazy"/></p>
<p>AI给我的年度判词是：</p>
<blockquote>
<p>一个用理性铠甲把自己武装到牙齿，却在深夜通过文学作品偷偷流泪的矛盾综合体。你试图看透这个世界的底牌（物理、历史、脑科学），却依然被这世界最朴素的情感（生死、人生）所牵绊。</p>
</blockquote>
<p>另外，<strong>还可以用下面这个提示词，将报告做成一份可视化的网页。</strong></p>
<blockquote>
<p>将以上2025年度阅读诊断报告做成一个和报告一一对应的、详细的可视化网页分析报告，一一展现，不要遗漏</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdbb3a4fb7744285ba2ddc773c8f27da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=SIhP14YaRd9f6N%2BvP8JfE5QGh2k%3D" alt="" loading="lazy"/></p>
<p><strong>苏格拉底留下的千古难题：“认识你自己”。</strong></p>
<p>我们曾试图通过阅读、旅行和生活去拼凑答案。</p>
<p>而现在，有了AI ，可以站在全知的旁观者角度，帮我们挖掘更深层的自己，虽然不可能完全正确。</p>
<p>当你看着这份报告，看着那个被AI刻画的“一部分自己”，可能你沉睡已久的某个部分会被突然击中，甚至被点亮。</p>
<p>去试试吧，也许你会和我一样，在屏幕前惊呼：原来如此！又或者不屑地说：什么玩意！</p>
<p>不重要了。</p>
<p><strong>还可以看看风筝往期文章</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449474176%26idx%3D1%26sn%3D6b14e61551641921e3ad9fb17b6dcde0%26chksm%3D8c434ce7bb34c5f1f8aad31bb537aed5ba068773583ec17020770a919b75462f0aa1dc21a5ab%26token%3D1083800749%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449474176&amp;idx=1&amp;sn=6b14e61551641921e3ad9fb17b6dcde0&amp;chksm=8c434ce7bb34c5f1f8aad31bb537aed5ba068773583ec17020770a919b75462f0aa1dc21a5ab&amp;token=1083800749&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">用这个方法，免费、无限期使用 SSL(HTTPS)证书，从此实现证书自由了</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F4cJ3g1GlenQJ9UifyXH0Kg" target="_blank" title="https://mp.weixin.qq.com/s/4cJ3g1GlenQJ9UifyXH0Kg" ref="nofollow noopener noreferrer">为什么我每天都记笔记，主要是因为我用的这个笔记软件太强大了，强烈建议你也用起来</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449472490%26idx%3D1%26sn%3Dda10b436d1f8123149316dac76a618aa%26chksm%3D8fbcb58db8cb3c9ba481b7d095966abb86ff7d1a45a771aad191991db65cd6e384a557a40ec4%26token%3D1977984185%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449472490&amp;idx=1&amp;sn=da10b436d1f8123149316dac76a618aa&amp;chksm=8fbcb58db8cb3c9ba481b7d095966abb86ff7d1a45a771aad191991db65cd6e384a557a40ec4&amp;token=1977984185&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">「差生文具多系列」最好看的编程字体</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449473008%26idx%3D1%26sn%3Dc8f8d9c9675571ea1a42c13b1af9b6e7%26chksm%3D8fbcb397b8cb3a81f3c6c55eb398c0599128f18b9bbdae87965cd40ef519dad3394649426d1e%26token%3D1044263965%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449473008&amp;idx=1&amp;sn=c8f8d9c9675571ea1a42c13b1af9b6e7&amp;chksm=8fbcb397b8cb3a81f3c6c55eb398c0599128f18b9bbdae87965cd40ef519dad3394649426d1e&amp;token=1044263965&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">我患上了空指针后遗症</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449473057%26idx%3D1%26sn%3D2170397d6bab5ad0a6d6427f77584df2%26chksm%3D8fbcb046b8cb3950d1784fe29bc7776cb0c71868acba36a47d60b41bc8a60959303082b0ee2a%26token%3D1977984185%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449473057&amp;idx=1&amp;sn=2170397d6bab5ad0a6d6427f77584df2&amp;chksm=8fbcb046b8cb3950d1784fe29bc7776cb0c71868acba36a47d60b41bc8a60959303082b0ee2a&amp;token=1977984185&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">一千个微服务之死</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449472966%26idx%3D1%26sn%3Da272a9df52ae18cc9a6163732b37c5d8%26chksm%3D8fbcb3a1b8cb3ab7857a88adc8a2e6d28bb6f2316df501f5f8e6fc487794f3b34f77829b4b94%26token%3D1977984185%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449472966&amp;idx=1&amp;sn=a272a9df52ae18cc9a6163732b37c5d8&amp;chksm=8fbcb3a1b8cb3ab7857a88adc8a2e6d28bb6f2316df501f5f8e6fc487794f3b34f77829b4b94&amp;token=1977984185&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">搭建静态网站竟然有这么多方案，而且还如此简单</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449472616%26idx%3D1%26sn%3Da41a420933f9af7f88af0759eb75f815%26chksm%3D8fbcb20fb8cb3b1969433e2468523234552562e504f3a12c8c1a2a012cff7fd1422e6dd48723%26token%3D1977984185%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449472616&amp;idx=1&amp;sn=a41a420933f9af7f88af0759eb75f815&amp;chksm=8fbcb20fb8cb3b1969433e2468523234552562e504f3a12c8c1a2a012cff7fd1422e6dd48723&amp;token=1977984185&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">被人说 Lambda 代码像屎山，那是没用下面这三个方法</a></p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Flutter、SwiftUI 和 Compose 写同一个界面：一份真实开发者的实测报告]]></title>    <link>https://juejin.cn/post/7589082912589086763</link>    <guid>https://juejin.cn/post/7589082912589086763</guid>    <pubDate>2025-12-30T00:15:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589082912589086763" data-draft-id="7587672626757697555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Flutter、SwiftUI 和 Compose 写同一个界面：一份真实开发者的实测报告"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-30T00:15:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JarvanMo"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565845704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Flutter、SwiftUI 和 Compose 写同一个界面：一份真实开发者的实测报告
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565845704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JarvanMo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:15:46.000Z" title="Tue Dec 30 2025 00:15:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    67
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>嘿，朋友！👋</p>
<p>还记得咱们以前老是为“哪种框架才是坠吊的”吵得不可开交吗？这回，我终于干了件每个开发者都放过狠话、但从来没真干过的事：我用 <strong>Flutter、SwiftUI 和 Jetpack Compose</strong> 把同一个界面撸了出来——而且全都严格遵循了 <strong>Clean Architecture（整洁架构）</strong> 原则。</p>
<p><strong>欢迎关注我的微信公众号：OpenFlutter</strong></p>
<p>说实话，最后的结果真把我给惊到了。</p>
<h4 data-id="heading-0">为什么这篇文章值得你看（没错，说的就是你）</h4>
<p>听着，我懂。你点进来多半是因为：</p>
<ul>
<li>你正陷入“框架焦虑（FOMO）”中，急需定夺<strong>到底学哪一个</strong>；</li>
<li>老板问你“咱们项目用哪个好？”，你当时就<strong>慌了</strong>；</li>
<li>你是个 Flutter 开发者，总惦记着<strong>隔壁的草是不是更绿一些</strong>；</li>
<li>你要去面试了，想在聊跨平台开发时显得<strong>更有深度</strong>；</li>
<li>你心里其实已经选好了，就指望我能<strong>夸夸你的选择</strong>（剧透一下：没准儿真会哦）。</li>
</ul>
<p>不管你是为了啥来的，我保证这不是那种“Hello World”级别的流水账。这是一个刚熬了三个通宵，在状态管理、依赖注入以及“等等，我这层数据到底怎么传给下一层来着？”这些地狱级难题里反复横跳后的<strong>真实感悟</strong>。</p>
<h4 data-id="heading-1">终极挑战：一个界面，三套框架，拒绝借口</h4>
<p>我做的是一个实战级别的“用户个人资料”页面，毕竟现在谁还稀罕看计数器（Counter App）啊？这玩意儿包含了：</p>
<ul>
<li><strong>真实的远程 API 调用</strong>（带报错处理的那种）；</li>
<li><strong>真正管用的本地缓存</strong>；</li>
<li><strong>不至于丑得像垃圾一样的加载状态</strong>；</li>
<li><strong>严谨的 Clean Architecture 划分</strong>（UseCases, Repositories，一个都不少）；</li>
<li><strong>不会让你想摔电脑的路由导航</strong>。</li>
</ul>
<p>同样的设计，同样的架构，同样的功能。但实现它的过程，却是三种截然不同的体验。</p>
<hr/>
<h3 data-id="heading-2">我的实测体会（那些官宣里不会告诉你的事）</h3>
<h4 data-id="heading-3">1. Flutter：真香，它是真的能干活</h4>
<p>Flutter 最让我感到莫名的爽感的一点是：它居然…真的能跑？而且是哪儿都能跑。</p>
<p>我只写了一套代码，它就能完美运行在我的 iPhone、安卓测试机，<strong>甚至</strong>是网页浏览器上，而且我还没给编译器大神“烧香”。它的 <strong>Hot Reload（热重载）</strong> 快到离谱，刚开始我甚至以为它坏了——按下保存，修改立现。没有编译等待，没有漫长加载。这种生产力，简直是纯粹的享受。</p>
<p>Clean Architecture 的搭建过程也意外地顺滑。用 <code>get_it</code> 做依赖注入？简直<strong>绝了（Chef's kiss）</strong> 。这种目录结构让你觉得，这框架的设计者是真的考虑过开发者的心路历程的。</p>
<p><strong>但反转来了：</strong> Dart 这门语言有点怪。它不差，只是…异类。如果你习惯了 Kotlin 或 Swift，你头一周肯定会反复纠结：“为什么这儿要写下划线？”以及“这个 <code>late</code> 关键字到底是个什么鬼？”</p>
<h4 data-id="heading-4">2. SwiftUI：果粉的快乐（但仅限果粉）</h4>
<p>用 SwiftUI 开发就像开特斯拉：顺滑、极具未来感，但一旦你离开了它的生态圈，偶尔会觉得心累。</p>
<p>它的声明式语法<strong>太漂亮了</strong>。真的，写下 <code>@State</code> 然后看着 UI 自动更新，简直像在施魔法。那种只加一个 <code>.animation()</code> 就能搞定动画的感觉？凌晨两点，我在空无一人的公寓里忍不住叫了声“哇塞”。</p>
<p>但在 SwiftUI 里搞 Clean Architecture，事情就开始变得“复杂”了。SwiftUI 强迫你用 Combine 或 async/await（这本身挺好），但紧接着你就要处理各种 Publishers 和 Cancellables，搞得你的 ViewModel 看起来像飞船仪表盘一样。</p>
<p><strong>最扎心的一点？</strong> 仅限 iOS（行吧，还有 macOS 和 watchOS，但你懂我意思）。你那一套漂亮的代码只能留在苹果的“后花园”里。没安卓，没网页。有的只是优雅的格调和高耸的围墙。</p>
<h4 data-id="heading-5">3. Jetpack Compose：安卓开发者的“救赎之路”</h4>
<p>如果你曾深受 XML 布局的折磨，那 Compose 就像是沙漠里的甘露。Google 终于搞清楚开发者到底想要什么了。</p>
<p><code>Composable</code> 函数写起来直观得一塌糊涂。全是 Kotlin，这意味着如果你懂 Kotlin，你就已经掌握了 70%。预览系统也很稳（前提是 Android Studio 决定配合你，不过绝大多数时候它还挺乖）。</p>
<p><strong>Clean Architecture 实现？</strong> 确实很干净。Kotlin 的协程（Coroutines）让异步操作变得非常自然。用 Hilt 做依赖注入的集成极其丝滑，你会纳闷 Google 为什么花了这么多年才开窍。</p>
<p><strong>但那头“房间里的大象”依然存在：</strong> 它目前基本只属于安卓。虽然 Compose Multiplatform 已经出来了，但咱们说实话——它还没到那种谁都能直接拿来跑生产环境的程度。你现在入坑，赌的是未来。</p>
<hr/>
<h3 data-id="heading-6">代码大对决（动真格的了）</h3>
<p>来看看这段让我直呼“好家伙”的部分：在三套框架里分别实现同一个 UseCase。</p>
<p><strong>Flutter (Dart)：</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetUserProfileUseCase</span> </span>{
  <span class="hljs-keyword">final</span> UserRepository repository;
  
  GetUserProfileUseCase(<span class="hljs-keyword">this</span>.repository);
  
  Future&lt;Result&lt;UserProfile&gt;&gt; call(<span class="hljs-built_in">String</span> userId) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> repository.getUserProfile(userId);
  }
}
</code></pre>
<p><strong>代码点评：</strong> 干净、简洁、异步优先。这个 <code>call()</code> 方法意味着你可以像调用函数一样直接运行它。这就是典型的 Dart 范儿（Dart vibes）。</p>
<p><strong>SwiftUI (Swift)：</strong></p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">GetUserProfileUseCase</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">userId</span>: <span class="hljs-type">String</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">UserProfile</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GetUserProfileUseCaseImpl</span>: <span class="hljs-title class_">GetUserProfileUseCase</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> repository: <span class="hljs-type">UserRepository</span>
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">repository</span>: <span class="hljs-type">UserRepository</span>) {
        <span class="hljs-keyword">self</span>.repository <span class="hljs-operator">=</span> repository
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">userId</span>: <span class="hljs-type">String</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">UserProfile</span> {
        <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> repository.getUserProfile(userId: userId)
    }
}
</code></pre>
<p>这个 <code>async throws</code> 写法简直美如画。Swift 的类型安全机制强得惊人，但同时也意味着会有更多模板代码（Boilerplate）。就看你更中意哪一个了（Pick your poison）。</p>
<p><strong>Compose (Kotlin)：</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GetUserProfileUseCase</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repository: UserRepository
) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: Result&lt;UserProfile&gt; {
        <span class="hljs-keyword">return</span> repository.getUserProfile(userId)
    }
}
</code></pre>
<p>那个 <code>operator fun invoke</code>？简直是<strong>神来之笔（Chef's kiss）</strong> 。Kotlin 的简洁性让我的大脑极其舒适。再加上 Hilt 的 <code>@Inject</code>，依赖注入这件事变得像呼吸一样自然。</p>
<h4 data-id="heading-7">诚实豆沙包：到底什么才重要？</h4>
<p>在把同一个功能写了三遍之后，我总结出了一些能真正帮你做决定的建议：</p>
<ul>
<li>
<p><strong>选 Flutter，如果：</strong></p>
<ul>
<li>你需要快速推向多个平台。</li>
<li>你的团队懂 Dart（或者愿意学点新东西）。</li>
<li>你把开发体验和热重载（Hot Reload）看作生命线。</li>
<li>你在搞创业，恨不得昨天就能把 iOS + 安卓 + Web 版全上线。</li>
<li>你不介意 Dart 的生态没有 Swift/Kotlin 那么“国民级”。</li>
</ul>
</li>
<li>
<p><strong>选 SwiftUI，如果：</strong></p>
<ul>
<li>你只打算在苹果的生态里混。</li>
<li>你追求极致的 iOS 原生质感和性能。</li>
<li>你的团队已经是 Swift 老手了。</li>
<li>你爱“类型安全”胜过爱你的家人。</li>
<li>你能接受最低系统要求是 iOS 14+（那些老机型用户只能说声抱歉了）。</li>
</ul>
</li>
<li>
<p><strong>选 Compose，如果：</strong></p>
<ul>
<li>你是安卓优先（或者目前只做安卓）。</li>
<li>你的团队是 Kotlin 死忠粉。</li>
<li>你想逃离 XML 布局的“创伤”，拥抱现代安卓开发。</li>
<li>你愿意在 Compose Multiplatform 的未来上赌一把。</li>
<li>你非常心水 Material Design 3 那种丝滑的集成感。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-8">聊聊性能（毕竟总有人爱问这个）</h4>
<p>说句实在话：<strong>对于 90% 的应用来说，性能差异几乎可以忽略不计。</strong> 你的用户发现不了，你的老板发现不了。甚至你自己也发现不了——除非你在写什么极其复杂的玩意儿。</p>
<p>但既然要比，那就拆开说：</p>
<ul>
<li><strong>Flutter：</strong> 编译成原生代码。快，丝滑的 60fps。Skia 渲染引擎已经经受了时间的考验。</li>
<li><strong>SwiftUI：</strong> iOS 亲儿子。快。有时候在优化上显得“聪明过头”了（没错，说的就是那些神秘的视图更新逻辑）。</li>
<li><strong>Compose：</strong> 安卓亲儿子。快。Kotlin 的运行时已经非常成熟且经过深度优化。 <strong>真正的性能瓶颈通常出在你的代码上，而不是框架。</strong> 很扎心，但这是事实。</li>
</ul>
<h4 data-id="heading-9">开发体验（DX）的真相</h4>
<p>有一点没人会告诉你：对于大多数项目来说，<strong>开发体验（DX）比原始性能更重要。</strong></p>
<ul>
<li><strong>Flutter 赢在：</strong> 热重载速度（真的，快到没朋友）、跨平台的一致性、极其丰富的插件生态（pub.dev 是座宝库）、文档质量（Flutter 的文档堪称行业标杆）。</li>
<li><strong>SwiftUI 赢在：</strong> IDE 集成度（Xcode 虽有槽点，但它是为 Swift 而生的）、类型安全和编译时纠错、Xcode Previews 预览（只要它不抽风）。</li>
<li><strong>Compose 赢在：</strong> Kotlin 强大的语言特性、Android Studio 的深度整合、Material Design 的官方实现、以及那种“终于永远删掉 XML 文件”的解脱感。</li>
</ul>
<h4 data-id="heading-10">社区现状（这关乎你的饭碗）</h4>
<p>聊聊找工作和社区，毕竟大家都要吃饭：</p>
<ul>
<li><strong>Flutter 岗位：</strong> 增长极快。初创公司最爱，大厂也在观望。社区极其活跃且乐于助人。FlutterFlow 甚至让很多不写代码的人也开始入坑了。</li>
<li><strong>SwiftUI 岗位：</strong> 在专注于苹果生态的公司里非常稳。想进大厂做 iOS，SwiftUI 是必修课。薪资普遍偏高，因为 iOS 开发一直自带溢价。</li>
<li><strong>Compose 岗位：</strong> 现在的安卓岗位几乎都要求会 Compose。如果你精通 Compose，你就是安卓职场上的“独角兽”。各家公司都在从 XML 迁移，急需大腿。</li>
</ul>
<h4 data-id="heading-11">我的真心推荐（我知道你们都在等这一段）</h4>
<p>如果明天要开个新项目，只能<strong>选一个</strong>？</p>
<p><strong>我会选 Flutter。</strong> 在 SwiftUI/Compose 的粉丝开喷之前，听我解释： 一套代码搞定 iOS、安卓和 Web，这个价值实在太诱人了。它的开发体验始终如一地出色，社区充满活力，插件生态也已经熟透了。说真的，光是一个“热重载”省下来的时间，就足以抵消学习 Dart 的成本了。</p>
<p><strong>但是（划重点）：</strong></p>
<ul>
<li>如果你<strong>只给 iOS 写 App</strong>？选 SwiftUI，别犹豫。</li>
<li>如果你<strong>只给安卓写 App</strong>？选 Compose，冲就完了。</li>
<li>如果你是在<strong>现有的原生 App</strong> 上修修补补？老老实实守着原有的技术栈。</li>
</ul>
<h4 data-id="heading-12">关于架构的惊喜</h4>
<p>有一点挺出乎意料：<strong>Clean Architecture 在 Kotlin/Compose 里感觉最自然。</strong> Kotlin 的语言特性（密封类、协程、数据类）跟整洁架构原则简直是天作之合。Flutter 紧随其后。而 SwiftUI 则需要你跟协议（Protocols）和类型系统进行最多的“搏斗”。 但核心结论是：<strong>这三者都能完美适配架构。</strong> 这种原则是超越框架的，不管你写的是 Dart、Swift 还是 Kotlin，你的领域层（Domain Layer）看起来都应该差不多。</p>
<h4 data-id="heading-13">这对你意味着什么？</h4>
<p>能看到这儿，你不是在摸鱼，就是真的感兴趣（或者两者都有，我懂，我也经常这样）。</p>
<p>基于这次实验，我的建议是：</p>
<ul>
<li><strong>如果你是学生/新人：</strong> 学 <strong>Flutter</strong>。练好 Dart，多动手做东西，发布到多个平台。攒一个能证明你具备“交付产品能力”的作品集。这种跨平台能力会让初创公司对你垂青有加。</li>
<li><strong>如果你是 iOS 开发：</strong> 还没学 <strong>SwiftUI</strong> 的赶紧学。但也建议你在业余项目里试试 Flutter，感受一下跨平台到底在火什么。</li>
<li><strong>如果你是安卓开发：</strong> 搞定 <strong>Compose</strong>。同时盯着点 Compose Multiplatform。未来的发展会非常有趣。</li>
<li><strong>如果你是做决策的技术 Leader：</strong> 看看你团队的技能树、项目工期和目标平台。其实选这三个里的任何一个都能做出成功的 App。<strong>框架选型的重要性，远不如团队的执行力重要。</strong></li>
</ul>
<h4 data-id="heading-14">那些让我彻夜难眠的坑</h4>
<p>分享几个我踩过的坑，希望能帮你省下几个小时：</p>
<ol>
<li><strong>状态管理：</strong> 三个框架各有 47 种管理状态的方法。我最后选了 Provider (Flutter), Observable/Combine (SwiftUI) 和 ViewModel (Compose)。都行得通，但也各有各的小脾气。</li>
<li><strong>导航：</strong> Flutter 的路由很直观；SwiftUI 的 NavigationStack 现在好多了，但以前真是折磨；Compose 的 Navigation 组件很稳，就是代码有点啰嗦。</li>
<li><strong>测试：</strong> 都支持测试，但 Flutter 的 Widget Testing 感觉最成熟。SwiftUI 的预览测试很酷。Compose 的测试最全面，但配置起来稍麻烦。</li>
</ol>
<h4 data-id="heading-15">最后的一点感言</h4>
<p>说到底，这些都只是工具。<strong>你用它们造出了什么，才最重要。</strong></p>
<p>我见过这三个框架分别写出的惊艳 App，也见过三个框架分别写出的垃圾。框架不能决定 App 的好坏，<strong>你才能。</strong></p>
<p>选一个，深挖下去。做个让人惊艳的东西。然后再去学下一个，或者干脆不学，都没问题。这里没有标准答案。</p>
<h4 data-id="heading-16">轮到你了（该你发言了）</h4>
<p>来，咱们评论区见：</p>
<ul>
<li><strong>你是 Flutter 铁粉？</strong> 用它做出了赚钱的项目？来分享一下你的故事，社区需要真实的回馈。</li>
<li><strong>刚入坑移动开发？</strong> 随便问，这里的社区氛围很友好。</li>
<li><strong>职场老司机？</strong> 传授点面试经验。你招人时最看重什么技能？</li>
<li><strong>遇到瓶颈了？</strong> 把你的烦心事说出来，没准儿评论区就有大神帮过你解决了。</li>
</ul>
<p>无论你是刚起步，还是已经发布过 10 个 App 的 Flutter 大佬——你都很棒。继续写码，继续学习。你的下一个 App 没准儿就能改变世界。</p>
<p><strong>致所有的移动开发者：</strong> 给刚入行的新人留句鼓励的话吧。大家都经历过萌新阶段，让这个圈子更温暖一点。</p>
<h4 data-id="heading-17">最后一句话</h4>
<p>我花了 72 小时做这个对比，就是为了让你不用再纠结。不管你是 Flutter 党、SwiftUI 党还是 Compose 党，我们其实都在干同一件事：做点酷的东西，让别人觉得好用。</p>
<p><strong>选好你的框架。写出整洁的代码。发布你的 App。无视那些喷子。</strong> 记住：<strong>最好的框架，是那个能让你真正把项目做完的框架。</strong></p>
<p>别看了，快去写代码吧！🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GitHub 上 10 个令人惊艳的 Agent 开发平台，太顶了。]]></title>    <link>https://juejin.cn/post/7589176150493741110</link>    <guid>https://juejin.cn/post/7589176150493741110</guid>    <pubDate>2025-12-30T02:40:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589176150493741110" data-draft-id="7589176150493593654" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GitHub 上 10 个令人惊艳的 Agent 开发平台，太顶了。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-30T02:40:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GitHub 上 10 个令人惊艳的 Agent 开发平台，太顶了。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T02:40:59.000Z" title="Tue Dec 30 2025 02:40:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">01、AutoGPT</h2>
<p>AutoGPT 是 AI Agent 领域的鼻祖级项目，现在已经 18 万+的 Star 了。</p>
<p>与聊天机器人不一样，AutoGPT 能够自主地将一个大目标拆解为子任务，并利用互联网搜索、本地文件等操作来一步步实现目标。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d15a803954748b794f8f24af0d1513f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=7ZSuZwQl0DuecGredJzmwCleVMk%3D" alt="图片" loading="lazy"/></p>
<p>AutoGPT 具备强大的工具调用和环境交互能力。</p>
<p>它能够通过访问互联网搜索最新信息、管理本地文件的读写、执行代码以及保留长期和短期记忆来辅助决策。</p>
<p>核心机制是一个思考-计划-行动的循环：模型会评估当前状态，制定下一步计划，执行操作，并根据反馈结果进行自我修正，这使得它能够处理比单一对话更复杂、耗时更长的自动化工作流。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7831bb35425246cd8064ef98b24fcb56~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=apxu09aN1u6De4lw0PMmgMH99jA%3D" alt="图片" loading="lazy"/></p>
<p>AutoGPT 这个开源项目绝对是推动 AI Agent 领域的快速发展，是研究自主智能体（Autonomous Agents）的必看项目。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/Significant-Gravitas/AutoGPT</span>
</code></pre>
<h2 data-id="heading-1">02、Dify</h2>
<p>Dify 目前 12 万+ 的 Star 了。</p>
<p>它不仅仅是 Agent 框架，还是融合了 Backend-as-a-Service (BaaS) 和 LLMOps 理念的大模型应用开发平台。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a43a64ad52f243cb8683e667c9fbf1d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=HvrUAGWq1Uk7y5G0U9drAFhW%2Bpg%3D" alt="图片" loading="lazy"/></p>
<p>它提供了可视化的 Prompt 编排、运营管理、知识库 RAG 集成等功能。</p>
<p>通过 Dify，不需要从头编写后端代码，即可快速将简单的 Prompt 转化为功能完备、可投入生产的 AI 应用。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcbe7e91c4684989b65eeb05fd5b7cb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=Lq5w%2B65jpboqWSCjLIBNgTJ1Q3o%3D" alt="图片" loading="lazy"/></p>
<p>Dify 支持可视化编排，拖拽节点来定义复杂的 Agent 逻辑和工具调用。并且内置了高质量的 RAG 引擎，能够自动处理文档解析、分段和向量化，轻松构建企业级知识库。</p>
<p>它提供了可视化的 Prompt 编排、运营管理、知识库 RAG 集成等功能。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dff16b1fee6d42d780fecfb4cf9fc322~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=KcTG%2FDNmyxODXdktRaf8JE7iCyA%3D" alt="图片" loading="lazy"/></p>
<p>关于它和 Dify、n8n、Coze 的区别，让 Nano Banana Pro 画了一个图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39f04fc6ff9e4cad9740635e39518e1c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=COOHlWw1fKrLqAT7Z6XectdHwYQ%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/langgenius/dify</span>
</code></pre>
<h2 data-id="heading-2">03、LangChain</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd4f409de25840b0ac52430a3278767c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=G3RAoItbkpnuSCP%2FGLtBeOc3jYM%3D" alt="图片" loading="lazy"/></p>
<p>虽然 LangChain 是一个通用的 LLM 开发框架，但它目前是构建 Agent 的事实标准基础设施之一。</p>
<p>对于初学者来说，它的学习曲线还是很陡峭的，一旦掌握了会发现它确实是构建复杂逻辑最稳健的地基。</p>
<p>它有很多高度模块化的组件，包括链 Chains、代理 Agents 和记忆 Memory。</p>
<p>开发者可以像搭积木一样，将提示词管理、文档加载、向量检索以及模型调用串联成一个完整的工作流。</p>
<p>特别是其强大的 Agent 机制，大模型充当推理引擎，动态决定调用哪些外部工具，比如 Google 搜索、计算器或 API 啥的来解决问题。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7615873691aa43eca8bc880825c68cd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=6Nh%2FMZSWbA3%2BO6r43A%2BNDj4mwiU%3D" alt="图片" loading="lazy"/></p>
<p>特别是其子项目 LangGraph，专门用于构建有状态的、多角色的 Agent 应用。</p>
<p>它提供了高度可控的循环计算能力，让开发者能够精细地控制 Agent 的决策流程，是 Python 开发者构建复杂 Agent 的首选底层框架。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/langchain-ai/langchain</span>
</code></pre>
<h2 data-id="heading-3">04、MetaGPT</h2>
<p>MetaGPT 现在在 GitHub 上有 6 万多 Star 了。 </p>
<p>如果想研究多智能体协作，这个开源项目可以说是最重要的框架之一。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3206b7f4522b46e4b09e5e958c73eeda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=Vvq0q%2B6XhJNdZEESiMqsNp5Y9F0%3D" alt="图片" loading="lazy"/></p>
<p>它模拟了一个虚拟的软件公司，内部包含产品经理、架构师、项目经理和工程师等不同角色的 Agent。</p>
<p>只要输入一句话需求，这些 Agent 就会协同工作，输出用户故事、竞品分析、设计图甚至可运行的代码。</p>
<p>适合对多智能体协作（Multi-Agent Collaboration）感兴趣的开发者，特别适合那种流程固定、对输出稳定性要求高的场景。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/geekan/MetaGPT</span>
</code></pre>
<h2 data-id="heading-4">05、Microsoft AutoGen</h2>
<p>微软开源的框架，之前也介绍过，现在已经  的 Star 了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fac7399e0e6477cb6e81643f73a6e26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=pOvi7KG5ZNN3MuLxM8F%2FynI%2B6Tc%3D" alt="图片" loading="lazy"/></p>
<p>它专注于多智能体对话。可以定义多个可以相互对话的 Agent，可以是 LLM、人类或工具，它们通过对话来协作解决任务。</p>
<p>该框架高度抽象和灵活，支持多种对话模式，是目前工业界和学术界探索多智能体系统（Multi-Agent Systems）最主流的框架之一。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/microsoft/autogen</span>
</code></pre>
<h2 data-id="heading-5">06、Flowise</h2>
<p>Flowise 是一个低代码/无代码的 UI 可视化工具，现在 48k 的 Star 了。</p>
<p>如果你被 LangChain 晦涩的文档劝退了，不妨先试试 Flowise。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4341a3a4c7244f2a988f09f4cdcef716~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=DEBpjempwFKd8kPtL5JDOwmIxBI%3D" alt="图片" loading="lazy"/></p>
<p>通过拖拽的方式构建大模型应用，它底层基于 LangChain，用户可以通过连接不同的节点，比如 PDF 加载器、OpenAI 模型、Agent执行器等来构建自定义的逻辑流。</p>
<p>对于不擅长写代码但想快速搭建 Agent 原型的用户来说，这是一个非常友好的平台。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/171489b99ad84bbba58b1a11c2082466~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=koq0WLRV00hK30uJwIspJ49ju%2FM%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/FlowiseAI/Flowise</span>
</code></pre>
<h2 data-id="heading-6">07、CrewAI</h2>
<p>CrewAI 是近年来异军突起的 Python 框架，它主打角色扮演（Role-Playing）的编排， 现在已经 42k 的 Star 了。</p>
<p>这个开源项目不像 AutoGen 那么抽象，写 CrewAI 的代码感觉就像是在给员工写任务书，非常清晰易懂，是 Python 开发者上手多智能体的首选</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2675a5ed33a24f9ca93b62a02ddf2cf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=DM5Y%2BVfAMEbY5mfxWwmFzKkL92E%3D" alt="图片" loading="lazy"/></p>
<p>它让开发者可以轻松定义具有特定角色、目标和背景故事的 Agent，并将它们组成一个团队来按顺序或层级执行任务。</p>
<p>它的设计非常直观，不仅易于上手，而且能很好地与 LangChain 工具生态集成。</p>
<pre><code class="hljs language-bash" lang="bash">开源地址: https://github.com/crewAIInc/crewAI
</code></pre>
<h2 data-id="heading-7">08、ChatDev</h2>
<p>这个 28K 星星的开源项目是清华大学团队 OpenBMB 开源。</p>
<p>类似于 MetaGPT，ChatDev 也是打造了一个虚拟的软件开发公司。</p>
<p>它通过聊天链的方式，让不同角色的智能体（CEO、CTO、程序员、测试员）在如设计、编码、测试、文档等环节进行深度协作。</p>
<p>其特点是过程可视化强，像是在玩一个模拟经营游戏一样看着软件被开发出来。</p>
<p>看着一个个小人儿协作写代码确实很治愈，它为我们展示了未来软件开发的终极形态，非常有启发性。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/OpenBMB/ChatDev</span>
</code></pre>
<h2 data-id="heading-8">09、SuperAGI</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af0d5f8c881e4b8daa58fc27804a9455~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=4Z1pDxz%2Bmy8SakqTqACIWGlYN0U%3D" alt="图片" loading="lazy"/></p>
<p>这个自主 AI 智能体框架现在已经 15K 的 Star 了。对于需要长期稳定运行、监控多个 Agent 的企业级场景来说，这个开源项目基建非常必要。</p>
<p>它有一套完整的基础设施，开发者用它可以构建、管理和运行自主 Agent。</p>
<p>它拥有图形化界面、Agent 市场、Tools、并发代理运行等功能，旨在解决 AutoGPT 在生产环境中使用难的问题，是一个功能比较完备的 Agent 管理平台。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f04b70bef3d34e97905144d77da2ff14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=xGWGREf0meFZ4cxVgVweVVIT8dg%3D" alt="图片" loading="lazy"/></p>
<p>而且还能通过可视化的仪表盘同时运行和监控多个 Agent，查看其思维链（Chain of Thought）和执行日志。</p>
<p>开发者可以将自己开发的自定义工具包、智能体模板发布到市场中供社区复用。</p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址: https:<span class="hljs-comment">//github.com/TransformerOptimus/SuperAGI</span>
</code></pre>
<h2 data-id="heading-9">10、Letta</h2>
<p>大模型最让人头疼的就是聊着聊着就忘了，Letta 恰好切中了这个痛点。</p>
<p>如果你想开发一个能陪伴用户几个月、甚至几年的伴侣型应用，一定要看看这个可以构建有状态（Stateful）AI 智能体的开源框架。</p>
<p>它也是著名的 MemGPT 项目的继任者和正式化版本。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4a7ad46e40c4d8094d699aa43cbc153~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=gqp00QTe%2Bg0p1P2YP7eQHtI6TBk%3D" alt="图片" loading="lazy"/></p>
<p>Letta 通过引入类似操作系统的内存管理机制，让 AI 智能体能够拥有持久化的长期记忆，并在不同的会话和时间跨度中保持一致的身份和知识。</p>
<p>Letta 延续并强化了大模型即操作系统的理念。</p>
<p>它通过一种分层内存结构，将信息在当前上下文窗口和外部数据库之间动态调度。</p>
<p>智能体具备自我编辑记忆的能力，能够自主决定何时将关键信息写入长期存储或从历史记录中检索数据，从而在不增加 Token 消耗的前提下，实现了理论上无限的上下文窗口。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4632398a2b74efba2f8da148b44fda2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767667259&amp;x-signature=uk%2BJkMSuypgainGXEEKcwo59ZoQ%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/letta-ai/letta</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 前端开源三年，npm 发包卡我半天]]></title>    <link>https://juejin.cn/post/7589482741759033371</link>    <guid>https://juejin.cn/post/7589482741759033371</guid>    <pubDate>2025-12-30T13:28:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589482741759033371" data-draft-id="7589325011544916006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 前端开源三年，npm 发包卡我半天"/> <meta itemprop="keywords" content="前端,GitHub,NPM"/> <meta itemprop="datePublished" content="2025-12-30T13:28:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不如摸鱼去"/> <meta itemprop="url" content="https://juejin.cn/user/26044011388510"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 前端开源三年，npm 发包卡我半天
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/26044011388510/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不如摸鱼去
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T13:28:54.000Z" title="Tue Dec 30 2025 13:28:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ffbe295b3404a12859f30d92cf0ac60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=eA7I69jn54e49HxtbVWfP2Rje%2B8%3D" alt="" loading="lazy"/></p>
<p>大家好，我是不如摸鱼去，欢迎来到我的分享专栏，今天我们来聊聊 npm 发包。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3519023670124fc0aa37d49012801636~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=gV7OA3HhEP8f6nzQ8fQmFuOCH4U%3D" alt="" loading="lazy"/></p>
<p>各位最近在 npm 上有没有见到这个这个提示？没错，经典 token 被废了！我也差点被废了，想发个新的包，死活发不出来啊，唉，都怪我不看文档啊😂。</p>
<h2 data-id="heading-0">起因</h2>
<p>近期给 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMoonofweisheng%2Funi-mini-router" target="_blank" title="https://github.com/Moonofweisheng/uni-mini-router" ref="nofollow noopener noreferrer">uni-mini-router</a> 重构了一下，使用 Gemini3 Pro 给它把打包器从 rollup 迁移到了 tsdown，并且使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fstarter.wot-ui.cn%2F" target="_blank" title="https://starter.wot-ui.cn/" ref="nofollow noopener noreferrer">wot-starter</a>作为模板重构了其演示代码结构、文档和演示 demo。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/657457f8a79d4e3bbeff66e22f75b329~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=H%2BKXNDyT9Kye46VSZJdWVq0aHxU%3D" alt="" loading="lazy"/></p>
<p>美滋滋的上线准备发包，结果直接报错 404？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da04e6c04896445b9adecfd929038e28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=%2BNZo16azIMlIiQwjanag8xq5dIs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">过程</h2>
<p>发包报错后，上网一搜，哇擦，经典 token 被废了！看了下文档，是永久的经典 token 已经被废弃，推荐使用 trusted publisher 发包，于是马不停蹄的开始配置。然后就出现这一幕！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dff67d1d711d41e69ed3e90f027eb593~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=Law2H6xhS775%2B0fZ1b0GDNWnOiQ%3D" alt="" loading="lazy"/></p>
<p>仓库，我配上了，workflow 文件，我填好了，俺老孙啥功名不要，只求把这包发上去。npm 的天王老子信不过我，我懂，让你小子整些 trusted publisher 唬我，我也懂。我不懂的是…你特不让我发包上去！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e27fd3460e742d8b6e5958067eb614c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=DLtdA287i4FGWu9kCjbdMpqsNI8%3D" alt="" loading="lazy"/></p>
<p>何老师，掌管 Trusted publishing 发包的神。对唔住，刚刚是我太大声，是我把 GitHub 仓库名写成了仓库地址😂。</p>
<h2 data-id="heading-2">攻略</h2>
<p>正经 npm trusted publisher 发包攻略来了，文档见：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2Ftrusted-publishers" target="_blank" title="https://docs.npmjs.com/trusted-publishers" ref="nofollow noopener noreferrer">docs.npmjs.com/trusted-pub…</a> 。</p>
<blockquote>
<p>如果你是首次发包，需要先使用存在有效期的 token 进行手动发包，随后进行以下配置。</p>
</blockquote>
<p>首先我们打开设置，我们使用 GitHub Action 发包，所以选择配置 GitHub Action，</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d378ba35f6cb474d81ef1955c82be62b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=rYkCEIAP2VAsF9P1aQh92jXKykc%3D" alt="" loading="lazy"/></p>
<p>按照要求填写用户名、包名、工作流文件等
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbd268f1be55431bad26f701984ff683~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=wnviKl8VGlf1dHth2WUfrOhVWQQ%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c24b928a295c4424b69d6ad5e7f63ab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=BW4jRJOyPilCINgkEbF354gEFmA%3D" alt="" loading="lazy"/></p>
<p>调整 GitHub Action 工作流文件，删除 npm 相关 token，也可以参考上方文档进行配置。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4adebda0b91d4cc7895d102c9c991485~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5aaC5pG46bG85Y67:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767706134&amp;x-signature=1FHRUpTScA0I7op35oZiYlwwAm8%3D" alt="" loading="lazy"/></p>
<p><em><strong>最后，需要注意: Trusted publishing 需要 npm CLI 版本 11.5.1 或以上.</strong></em></p>
<h2 data-id="heading-3">总结</h2>
<p>一定要看文档！</p>
<h2 data-id="heading-4">参考资料</h2>
<ul>
<li>npm-trusted-publishers：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.npmjs.com%2Ftrusted-publishers" target="_blank" title="https://docs.npmjs.com/trusted-publishers" ref="nofollow noopener noreferrer">docs.npmjs.com/trusted-pub…</a></li>
<li>my-uni：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmy-uni.wot-ui.cn%2F" target="_blank" title="https://my-uni.wot-ui.cn/" ref="nofollow noopener noreferrer">my-uni.wot-ui.cn/</a></li>
<li>wot-starter：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwot-starter.wot-ui.cn%2F" target="_blank" title="https://wot-starter.wot-ui.cn/" ref="nofollow noopener noreferrer">wot-starter.wot-ui.cn/</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[性能提升 4000%！我是如何解决 运营看板 不能跨库&跨库查询慢这个难题的]]></title>    <link>https://juejin.cn/post/7589494074982268979</link>    <guid>https://juejin.cn/post/7589494074982268979</guid>    <pubDate>2025-12-30T14:16:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589494074982268979" data-draft-id="7589325011544981542" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="性能提升 4000%！我是如何解决 运营看板 不能跨库&amp;跨库查询慢这个难题的"/> <meta itemprop="keywords" content="后端,数据库,PostgreSQL"/> <meta itemprop="datePublished" content="2025-12-30T14:16:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            性能提升 4000%！我是如何解决 运营看板 不能跨库&amp;跨库查询慢这个难题的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T14:16:25.000Z" title="Tue Dec 30 2025 14:16:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    50
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近遇到一个跨库查询性能问题，查询耗时从 24 秒优化到 0.6 秒，提升了 40 倍。这篇文章记录一下整个排查和解决过程，涉及 Superset、PostgreSQL FDW、微服务架构下的数据聚合问题。</p>
<hr/>
<h2 data-id="heading-0">背景</h2>
<p>先介绍一下涉及的技术栈。</p>
<p>我们用 Apache Superset 做 BI 看板，数据分散在多个微服务数据库里：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph 前端展示层
        A[Apache Superset&lt;br/&gt;BI 可视化平台]
    end

    subgraph 数据层
        B[(biz_db&lt;br/&gt;业务数据库)]
        C[(users_db&lt;br/&gt;用户数据库)]
        D[(loom_db&lt;br/&gt;Agent执行库)]
    end

    subgraph 跨库方案
        E[Superset Meta Database&lt;br/&gt;应用层跨库]
        F[PostgreSQL FDW&lt;br/&gt;数据库层跨库]
    end

    A --&gt; E
    A --&gt; F
    E --&gt; B
    E --&gt; C
    E --&gt; D
    F --&gt; B
    F --&gt; C
</code></pre>
<p><strong>为什么选 Superset</strong>：开源免费、功能够用、支持跨库查询（Meta Database）、社区活跃。</p>
<p><strong>什么是 PostgreSQL FDW</strong>：Foreign Data Wrapper，PostgreSQL 的一个核心特性，可以在一个数据库里直接访问另一个数据库的数据，就像访问本地表一样。</p>
<p>FDW 的工作流程大概是这样的：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant App as 应用程序
    participant LocalDB as 本地数据库&lt;br/&gt;(biz_db)
    participant FDW as FDW 层
    participant RemoteDB as 远程数据库&lt;br/&gt;(users_db)

    App-&gt;&gt;LocalDB: SELECT * FROM users
    LocalDB-&gt;&gt;FDW: 识别为外部表
    FDW-&gt;&gt;RemoteDB: 建立连接,执行查询
    RemoteDB-&gt;&gt;FDW: 返回数据
    FDW-&gt;&gt;LocalDB: 转换为本地格式
    LocalDB-&gt;&gt;App: 返回结果
</code></pre>
<p><strong>FDW 为什么快</strong>：数据库间直接通信，JOIN 操作在数据库引擎层执行（C 语言优化），只传输最终结果。</p>
<hr/>
<h2 data-id="heading-1">微服务的数据聚合问题</h2>
<p>我们的微服务架构长这样：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph 微服务架构
        subgraph 业务服务 biz-service
            A[Agent管理&lt;br/&gt;知识库&lt;br/&gt;任务对话]
            A1[(biz_db&lt;br/&gt;44张表)]
        end

        subgraph 用户服务 users-service
            B[用户认证&lt;br/&gt;权限管理&lt;br/&gt;组织架构]
            B1[(users_db&lt;br/&gt;27张表)]
        end

        subgraph Agent服务 loom-service
            C[会话管理&lt;br/&gt;工具执行&lt;br/&gt;计划编排]
            C1[(loom_db&lt;br/&gt;9张表)]
        end
    end

    A --&gt; A1
    B --&gt; B1
    C --&gt; C1
</code></pre>
<p>数据库隔离的好处大家都知道：服务独立部署、故障隔离、技术栈灵活。</p>
<p>但有个现实问题：<strong>运营报表需要聚合多个库的数据</strong>。比如我们要做一个消息评价看板，评价数据在业务库，用户名在用户库，需要 JOIN 才能出报表。</p>
<hr/>
<h2 data-id="heading-2">问题：Superset Meta Database 太慢了</h2>
<p>一开始我们用 Superset 的 Meta Database 功能做跨库查询。这是个实验性功能，工作原理是这样的：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户
    participant Superset as Superset
    participant Memory as 内存
    participant DB1 as biz_db
    participant DB2 as users_db

    User-&gt;&gt;Superset: 执行跨库 SQL
    Superset-&gt;&gt;Superset: 解析 SQL，识别涉及的库
    Superset-&gt;&gt;DB1: 查询 message_ratings
    DB1-&gt;&gt;Superset: 返回全量数据
    Superset-&gt;&gt;DB1: 查询 task_messages
    DB1-&gt;&gt;Superset: 返回全量数据
    Superset-&gt;&gt;DB2: 查询 users
    DB2-&gt;&gt;Superset: 返回全量数据
    Superset-&gt;&gt;Memory: 将数据加载到内存
    Memory-&gt;&gt;Memory: 执行 JOIN (Python)
    Memory-&gt;&gt;Superset: 返回 JOIN 结果
    Superset-&gt;&gt;User: 显示结果
</code></pre>
<p>看出问题了吗？它把每个库的<strong>全量数据</strong>都拉到 Superset 内存里，然后用 <strong>Python 做 JOIN</strong>。</p>
<p>配置其实很简单：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># superset_config.py</span>
FEATURE_FLAGS = {
    <span class="hljs-string">"ENABLE_SUPERSET_META_DB"</span>: <span class="hljs-literal">True</span>,
}
SUPERSET_META_DB_LIMIT = <span class="hljs-number">10000</span>  <span class="hljs-comment"># 每表最大读取行数</span>
</code></pre>
<p>跨库查询语法：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 整个表路径放在双引号里</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> "biz_db.public.users" LIMIT <span class="hljs-number">10</span>;

<span class="hljs-comment">-- 跨库 JOIN</span>
<span class="hljs-keyword">SELECT</span>
    r.rating_type,
    u.username
<span class="hljs-keyword">FROM</span> "biz_db.public.message_ratings" r
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> "users_db.public.users" u
    <span class="hljs-keyword">ON</span> r.user_id <span class="hljs-operator">=</span> u.id;
</code></pre>
<p><strong>实测数据</strong>：</p>

























<table><thead><tr><th>查询类型</th><th>数据量</th><th>耗时</th></tr></thead><tbody><tr><td>单表查询</td><td>100 行</td><td>12s</td></tr><tr><td>跨库 JOIN</td><td>13 行</td><td>21-24s</td></tr><tr><td>复杂 JOIN</td><td>50 行</td><td>超时(&gt;30s)</td></tr></tbody></table>
<p>24 秒查 13 行数据，这没法用。</p>
<p><strong>瓶颈分析</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph 耗时分解
        A[总耗时 24s] --&gt; B[网络传输 1&lt;br/&gt;biz-&gt;Superset: 5s]
        A --&gt; C[网络传输 2&lt;br/&gt;users-&gt;Superset: 5s]
        A --&gt; D[内存 JOIN&lt;br/&gt;Python 执行: 10s]
        A --&gt; E[序列化/反序列化: 4s]
    end

    style A fill:#ff6b6b
    style D fill:#ff6b6b
</code></pre>
<p>根本原因：</p>
<ol>
<li><strong>多次网络往返</strong>：每个库单独查询，结果传回 Superset</li>
<li><strong>全量数据传输</strong>：即使只需要 JOIN 后的少量数据，也要先传输全量</li>
<li><strong>Python 执行 JOIN</strong>：效率远低于数据库引擎</li>
</ol>
<hr/>
<h2 data-id="heading-3">方案选择</h2>
<p>调研了几个方案：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph 方案对比
        A[方案1: Superset Meta DB&lt;br/&gt;应用层跨库]
        B[方案2: PostgreSQL FDW&lt;br/&gt;数据库层跨库]
        C[方案3: 数据同步&lt;br/&gt;定时复制用户表]
        D[方案4: ETL&lt;br/&gt;数据仓库]
    end

    A --&gt; A1[优点: 配置简单]
    A --&gt; A2[缺点: 性能差 24s+]

    B --&gt; B1[优点: 性能好 &lt;1s]
    B --&gt; B2[缺点: 需要DBA权限]

    C --&gt; C1[优点: 查询快]
    C --&gt; C2[缺点: 数据有延迟]

    D --&gt; D1[优点: 专业方案]
    D --&gt; D2[缺点: 成本高,复杂]
</code></pre>













































<table><thead><tr><th>方案</th><th>性能</th><th>实时性</th><th>配置复杂度</th><th>维护成本</th><th>适用场景</th></tr></thead><tbody><tr><td>Superset Meta DB</td><td>❌ 差 (24s)</td><td>✅ 实时</td><td>✅ 简单</td><td>✅ 零</td><td>数据量小,不频繁查询</td></tr><tr><td><strong>PostgreSQL FDW</strong></td><td>✅ 好 (&lt;1s)</td><td>✅ 实时</td><td>⚠️ 中等</td><td>✅ 零</td><td><strong>推荐：实时跨库查询</strong></td></tr><tr><td>数据同步</td><td>✅ 好</td><td>⚠️ 有延迟</td><td>⚠️ 中等</td><td>⚠️ 定时任务</td><td>可接受延迟的场景</td></tr><tr><td>ETL 数仓</td><td>✅ 好</td><td>❌ T+1</td><td>❌ 复杂</td><td>❌ 高</td><td>大规模数据分析</td></tr></tbody></table>
<p>选 FDW 的理由：</p>
<ol>
<li><strong>性能是硬性需求</strong>：24 秒没法用</li>
<li><strong>实时性要求</strong>：用户名变更需要立即生效</li>
<li><strong>团队能力</strong>：有 DBA 支持</li>
<li><strong>成本</strong>：FDW 是 PostgreSQL 内置功能，无额外成本</li>
</ol>
<p>权衡取舍：接受需要 DBA 权限配置的复杂度，换取 40 倍性能提升。</p>
<hr/>
<h2 data-id="heading-4">FDW 架构设计</h2>
<p>最终架构长这样：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89b82ab6b59f4af3ba85b6fe6a588629~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767755839&amp;x-signature=n4lY5PXK%2F0N%2Bd8ZyCO0M1rtAMl8%3D" alt="image.png" loading="lazy"/></p>
<p>核心组件：</p>
<ol>
<li><strong>Foreign Server</strong>：远程数据库连接信息</li>
<li><strong>User Mapping</strong>：认证凭证</li>
<li><strong>Foreign Table</strong>：映射远程表到本地</li>
<li><strong>View</strong>：封装 JOIN 查询</li>
</ol>
<p>数据流对比，一目了然：</p>
<p><strong>Before（Meta Database）</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph Superset应用层
        A[SQL Lab] --&gt; B[Meta DB 引擎]
        B --&gt; C[Python JOIN]
    end

    subgraph 网络传输
        D[全量数据1]
        E[全量数据2]
    end

    subgraph 数据库层
        F[(biz_db)]
        G[(users_db)]
    end

    B --&gt;|查询| F
    F --&gt;|返回全量| D
    D --&gt; C

    B --&gt;|查询| G
    G --&gt;|返回全量| E
    E --&gt; C

    C --&gt; H[结果]

    style C fill:#ff6b6b
    style D fill:#ffcc00
    style E fill:#ffcc00
</code></pre>
<p><strong>After（FDW）</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph Superset应用层
        A[SQL Lab]
    end

    subgraph 数据库层
        B[(biz_db)] --&gt; C[PostgreSQL&lt;br/&gt;查询优化器]
        C --&gt; D[本地表扫描]
        C --&gt; E[FDW 远程查询]
        D --&gt; F[数据库内 JOIN]
        E --&gt; F
        F --&gt; G[结果集]
    end

    subgraph 远程
        H[(users_db)]
    end

    A --&gt;|SQL| B
    E -.-&gt;|高速内网| H
    G --&gt;|仅返回结果| A

    style F fill:#90EE90
    style E fill:#90EE90
</code></pre>
<hr/>
<h2 data-id="heading-5">实现步骤</h2>
<p>FDW 配置涉及四个组件：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">
  graph TB
      subgraph s1[FDW 四大组件]
          A[EXTENSION: postgres_fdw] --&gt; B[SERVER: users_server]
          B --&gt; C[USER MAPPING: 认证凭证]
          C --&gt; D[FOREIGN TABLE: fdw_users.users]
      end

      D --&gt; E[VIEW: v_ratings_with_username]

      style A fill:#FFB6C1
      style B fill:#98FB98
      style C fill:#87CEEB
      style D fill:#DDA0DD
      style E fill:#F0E68C
</code></pre>
<h3 data-id="heading-6">步骤 1：启用 FDW 扩展</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 需要超级用户权限</span>
<span class="hljs-keyword">CREATE</span> EXTENSION IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> postgres_fdw;
</code></pre>
<p><code>postgres_fdw</code> 是 PostgreSQL 官方提供的 FDW 扩展，专门用于连接其他 PostgreSQL 数据库，只需要在本地库执行一次。</p>
<h3 data-id="heading-7">步骤 2：创建外部服务器</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> SERVER users_server
<span class="hljs-keyword">FOREIGN</span> DATA WRAPPER postgres_fdw
OPTIONS (
    host <span class="hljs-string">'your-db-host.internal.local'</span>,
    dbname <span class="hljs-string">'users_db'</span>,
    port <span class="hljs-string">'5432'</span>
);
</code></pre>
<h3 data-id="heading-8">步骤 3：创建用户映射</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> MAPPING <span class="hljs-keyword">FOR</span> your_user
SERVER users_server
OPTIONS (
    <span class="hljs-keyword">user</span> <span class="hljs-string">'your_user'</span>,
    password <span class="hljs-string">'your_password'</span>
);
</code></pre>
<p>用户映射告诉 FDW：当本地用户查询外部表时，用什么凭证连接远程库。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    subgraph 本地数据库
        A[本地用户: your_user]
    end

    subgraph 用户映射
        B[映射规则]
    end

    subgraph 远程数据库
        C[远程用户: your_user&lt;br/&gt;密码: ****]
    end

    A --&gt; B
    B --&gt; C

    B -.-&gt;|告诉FDW| D[用什么凭证&lt;br/&gt;连接远程库]
</code></pre>
<p>常见问题：报错 <code>user mapping not found</code> 说明当前用户没有映射，需要为每个要使用 FDW 的本地用户创建映射，或者用 <code>FOR PUBLIC</code> 允许所有用户。</p>
<h3 data-id="heading-9">步骤 4：导入外部表</h3>
<p><strong>自动导入（推荐）</strong>：</p>
<pre><code class="hljs language-sql" lang="sql">IMPORT <span class="hljs-keyword">FOREIGN</span> SCHEMA public
LIMIT <span class="hljs-keyword">TO</span> (users)
<span class="hljs-keyword">FROM</span> SERVER users_server
<span class="hljs-keyword">INTO</span> fdw_users;  <span class="hljs-comment">-- 导入到 fdw_users schema</span>
</code></pre>
<p><strong>手动创建</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FOREIGN</span> <span class="hljs-keyword">TABLE</span> fdw_users.users (
    id uuid,
    realm_id uuid,
    username <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),
    firstname <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),
    lastname <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),
    email <span class="hljs-type">varchar</span>(<span class="hljs-number">255</span>),
    enabled <span class="hljs-type">boolean</span>,
    created_at <span class="hljs-type">timestamp</span>,
    updated_at <span class="hljs-type">timestamp</span>
)
SERVER users_server
OPTIONS (schema_name <span class="hljs-string">'public'</span>, table_name <span class="hljs-string">'users'</span>);
</code></pre>
<h3 data-id="heading-10">步骤 5：创建视图</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> v_ratings_with_username <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span>
    r.created_at <span class="hljs-keyword">AS</span> 评价时间,
    r.rating_type <span class="hljs-keyword">AS</span> 评价类型,
    u.username <span class="hljs-keyword">AS</span> 用户名,
    SUBSTR(m.content, <span class="hljs-number">1</span>, <span class="hljs-number">200</span>) <span class="hljs-keyword">AS</span> 消息内容,
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> m.references <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
         <span class="hljs-keyword">AND</span> m.references::text <span class="hljs-operator">!=</span> <span class="hljs-string">'[]'</span>
        <span class="hljs-keyword">THEN</span> <span class="hljs-string">'是'</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'否'</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> 使用知识库
<span class="hljs-keyword">FROM</span> message_ratings r
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> task_messages m <span class="hljs-keyword">ON</span> r.message_id <span class="hljs-operator">=</span> m.id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> fdw_users.users u <span class="hljs-keyword">ON</span> r.user_id::uuid <span class="hljs-operator">=</span> u.id
<span class="hljs-keyword">WHERE</span> m.role <span class="hljs-operator">=</span> <span class="hljs-string">'assistant'</span>;
</code></pre>
<p>视图的好处：封装 JOIN 逻辑，用户只需 <code>SELECT * FROM v_ratings_with_username</code>，底层表结构变化时只改视图定义。</p>
<h3 data-id="heading-11">完整配置脚本</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ========================================</span>
<span class="hljs-comment">-- FDW 跨库查询配置脚本</span>
<span class="hljs-comment">-- 在 biz_db 数据库执行</span>
<span class="hljs-comment">-- 需要超级用户权限</span>
<span class="hljs-comment">-- ========================================</span>

<span class="hljs-comment">-- 1. 启用 FDW 扩展</span>
<span class="hljs-keyword">CREATE</span> EXTENSION IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> postgres_fdw;

<span class="hljs-comment">-- 2. 创建外部服务器</span>
<span class="hljs-keyword">CREATE</span> SERVER IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> users_server
<span class="hljs-keyword">FOREIGN</span> DATA WRAPPER postgres_fdw
OPTIONS (
    host <span class="hljs-string">'your-db-host.internal.local'</span>,
    dbname <span class="hljs-string">'users_db'</span>
);

<span class="hljs-comment">-- 3. 创建用户映射</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> MAPPING <span class="hljs-keyword">FOR</span> your_user
SERVER users_server
OPTIONS (<span class="hljs-keyword">user</span> <span class="hljs-string">'your_user'</span>, password <span class="hljs-string">'your_password'</span>);

<span class="hljs-comment">-- 4. 创建 schema 存放外部表</span>
<span class="hljs-keyword">CREATE</span> SCHEMA IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> fdw_users;

<span class="hljs-comment">-- 5. 导入外部表</span>
IMPORT <span class="hljs-keyword">FOREIGN</span> SCHEMA public
LIMIT <span class="hljs-keyword">TO</span> (users)
<span class="hljs-keyword">FROM</span> SERVER users_server
<span class="hljs-keyword">INTO</span> fdw_users;

<span class="hljs-comment">-- 6. 创建业务视图</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">VIEW</span> v_ratings_with_username <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span>
    r.created_at <span class="hljs-keyword">AS</span> 评价时间,
    r.rating_type <span class="hljs-keyword">AS</span> 评价类型,
    u.username <span class="hljs-keyword">AS</span> 用户名,
    SUBSTR(m.content, <span class="hljs-number">1</span>, <span class="hljs-number">200</span>) <span class="hljs-keyword">AS</span> 消息内容,
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> m.references <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
         <span class="hljs-keyword">AND</span> m.references::text <span class="hljs-operator">!=</span> <span class="hljs-string">'[]'</span>
        <span class="hljs-keyword">THEN</span> <span class="hljs-string">'是'</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'否'</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> 使用知识库
<span class="hljs-keyword">FROM</span> message_ratings r
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> task_messages m <span class="hljs-keyword">ON</span> r.message_id <span class="hljs-operator">=</span> m.id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> fdw_users.users u <span class="hljs-keyword">ON</span> r.user_id::uuid <span class="hljs-operator">=</span> u.id
<span class="hljs-keyword">WHERE</span> m.role <span class="hljs-operator">=</span> <span class="hljs-string">'assistant'</span>;

<span class="hljs-comment">-- 7. 授权</span>
<span class="hljs-keyword">GRANT</span> USAGE <span class="hljs-keyword">ON</span> <span class="hljs-keyword">FOREIGN</span> SERVER users_server <span class="hljs-keyword">TO</span> your_user;
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> v_ratings_with_username <span class="hljs-keyword">TO</span> your_user;

<span class="hljs-comment">-- 验证</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username LIMIT <span class="hljs-number">5</span>;
</code></pre>
<hr/>
<h2 data-id="heading-12">Superset 配置调整</h2>
<p>配置 FDW 后，Superset 的查询方式要改一下。</p>
<p><strong>Before（Meta Database）</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 使用 Superset Meta Database</span>
<span class="hljs-comment">-- Database: Superset meta database</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> "biz_db.public.message_ratings" LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p><strong>After（直连 + 视图）</strong>：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 直接连接 biz_db</span>
<span class="hljs-comment">-- Database: biz_db</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p>就是选 <code>biz_db</code> 数据库（不是 Meta Database），直接查视图。</p>
<hr/>
<h2 data-id="heading-13">错误排查</h2>
<p>遇到问题可以按这个顺序排查：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[FDW 错误] --&gt; B{错误类型}

    B --&gt;|权限问题| C[permission denied&lt;br/&gt;to create extension]
    B --&gt;|连接问题| D[could not connect&lt;br/&gt;to server]
    B --&gt;|映射问题| E[user mapping&lt;br/&gt;not found]
    B --&gt;|表不存在| F[relation does&lt;br/&gt;not exist]

    C --&gt; C1[解决: 需要超级用户权限&lt;br/&gt;联系 DBA 执行]
    D --&gt; D1[解决: 检查网络连通性&lt;br/&gt;检查 host/port 配置]
    E --&gt; E1[解决: CREATE USER MAPPING&lt;br/&gt;为当前用户创建映射]
    F --&gt; F1[解决: 检查外部表是否导入&lt;br/&gt;检查 schema 名称]
</code></pre>
<p>排查清单：</p>



































<table><thead><tr><th>步骤</th><th>检查命令</th><th>预期结果</th></tr></thead><tbody><tr><td>1. 检查扩展</td><td><code>SELECT * FROM pg_extension WHERE extname='postgres_fdw';</code></td><td>有记录</td></tr><tr><td>2. 检查服务器</td><td><code>SELECT * FROM pg_foreign_server;</code></td><td>有 users_server</td></tr><tr><td>3. 检查用户映射</td><td><code>SELECT * FROM pg_user_mappings;</code></td><td>当前用户有映射</td></tr><tr><td>4. 检查外部表</td><td><code>SELECT * FROM information_schema.foreign_tables;</code></td><td>有 users 表</td></tr><tr><td>5. 测试连接</td><td><code>SELECT * FROM fdw_users.users LIMIT 1;</code></td><td>返回数据</td></tr></tbody></table>
<p>性能监控：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看执行计划</span>
EXPLAIN ANALYZE
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username LIMIT <span class="hljs-number">50</span>;

<span class="hljs-comment">-- 关注：</span>
<span class="hljs-comment">-- 1. Foreign Scan 的 actual time</span>
<span class="hljs-comment">-- 2. 远程查询的行数</span>
<span class="hljs-comment">-- 3. 总执行时间</span>
</code></pre>
<p>健康指标：单次查询 &lt; 1 秒，Foreign Scan 时间 &lt; 100ms，大表上有索引。</p>
<hr/>
<h2 data-id="heading-14">测试结果</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">xychart-beta
    title "查询性能对比"
    x-axis ["Superset Meta DB", "PostgreSQL FDW"]
    y-axis "耗时(秒)" 0 --&gt; 25
    bar [24, 0.6]
</code></pre>























<table><thead><tr><th>方案</th><th>查询耗时</th><th>数据库耗时</th><th>性能提升</th></tr></thead><tbody><tr><td>Superset Meta DB</td><td>21-24s</td><td>12ms</td><td>基准</td></tr><tr><td>PostgreSQL FDW</td><td>0.5-0.8s</td><td>0.5s</td><td><strong>40x</strong></td></tr></tbody></table>
<p>执行计划对比：</p>
<p>Superset Meta DB 的数据库层只需 12ms：</p>
<pre><code class="hljs language-sql" lang="sql">Limit  (cost<span class="hljs-operator">=</span><span class="hljs-number">1635.43</span>.<span class="hljs-number">.1635</span><span class="hljs-number">.56</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">50</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">12.550</span>.<span class="hljs-number">.12</span><span class="hljs-number">.554</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">13</span>)
</code></pre>
<p>问题在应用层的 Python JOIN。</p>
<p>FDW 整体都快：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">Foreign</span> Scan <span class="hljs-keyword">on</span> users  (cost<span class="hljs-operator">=</span><span class="hljs-number">0.00</span>.<span class="hljs-number">.8</span><span class="hljs-number">.16</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>) (actual <span class="hljs-type">time</span><span class="hljs-operator">=</span><span class="hljs-number">0.020</span>.<span class="hljs-number">.0</span><span class="hljs-number">.027</span> <span class="hljs-keyword">rows</span><span class="hljs-operator">=</span><span class="hljs-number">2</span>)
</code></pre>
<hr/>
<h2 data-id="heading-15">常用查询</h2>
<p>配置完成后，在 Superset 里这样用：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 选择数据库: biz_db</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 评价时间 <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">100</span>;
</code></pre>
<p>按日期过滤：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">WHERE</span> 评价时间 <span class="hljs-operator">&gt;</span> NOW() <span class="hljs-operator">-</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-string">'7 days'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 评价时间 <span class="hljs-keyword">DESC</span>;
</code></pre>
<p>统计评价分布：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span>
    评价类型,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> 数量
<span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 评价类型;
</code></pre>
<p>统计知识库使用率：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span>
    使用知识库,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> 数量,
    ROUND(<span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">*</span> <span class="hljs-number">100.0</span> <span class="hljs-operator">/</span> <span class="hljs-built_in">SUM</span>(<span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>)) <span class="hljs-keyword">OVER</span> (), <span class="hljs-number">2</span>) <span class="hljs-keyword">as</span> 百分比
<span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 使用知识库;
</code></pre>
<hr/>
<h2 data-id="heading-16">FAQ</h2>
<p><strong>Q: 用户名变更后，视图会自动更新吗？</strong></p>
<p>会的，FDW 是实时连接，每次查询都获取最新数据。</p>
<p><strong>Q: 对线上数据库有性能影响吗？</strong></p>
<p>影响很小。FDW 查询相当于普通的远程查询，查询量不大的话影响可以忽略。</p>
<p><strong>Q: 远程库挂了会怎样？</strong></p>
<p>查询会报错，但不影响本地库的其他功能。</p>
<p><strong>Q: 如何添加新的跨库表？</strong></p>
<pre><code class="hljs language-sql" lang="sql">IMPORT <span class="hljs-keyword">FOREIGN</span> SCHEMA public
LIMIT <span class="hljs-keyword">TO</span> (新表名)
<span class="hljs-keyword">FROM</span> SERVER users_server
<span class="hljs-keyword">INTO</span> fdw_users;
</code></pre>
<hr/>
<h2 data-id="heading-17">总结</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">timeline
    title 问题解决时间线

    section 问题发现
        发现跨库查询慢 : 使用 Superset Meta DB
                       : 查询耗时 24s+

    section 方案调研
        分析性能瓶颈 : 应用层 JOIN 是根因
                     : 对比 FDW 等方案

    section 实施落地
        配置 FDW : 创建 Server/Mapping
                 : 导入外部表
                 : 创建视图

    section 效果验证
        性能提升 40x : 从 24s 降到 0.6s
                     : 用户体验显著改善
</code></pre>
<p>几个关键收获：</p>
<p><strong>技术层面</strong>：</p>
<ol>
<li><strong>Superset Meta Database 的原理</strong>：应用层跨库，数据拉到内存 JOIN，适合小数据量低频查询</li>
<li><strong>PostgreSQL FDW 的优势</strong>：数据库层跨库，利用数据库引擎优化，适合需要高性能的跨库场景</li>
<li><strong>性能分析方法</strong>：EXPLAIN ANALYZE 分析执行计划，区分数据库层和应用层的耗时</li>
</ol>
<p><strong>架构层面</strong>：</p>
<ol>
<li><strong>微服务的数据聚合挑战</strong>：数据分散是微服务的固有问题，需要根据场景选择跨库方案</li>
<li><strong>"数据在哪里处理"很重要</strong>：同样的 JOIN，在不同层执行性能差异巨大，尽量把计算下推到数据库层</li>
</ol>
<p>方案选择象限图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c550f954be3546a38ccd46c3ff55b4c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767755839&amp;x-signature=b28fKmm7mJd3rPu57Tsv39x0PPA%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-18">附录：SQL 参考</h2>
<p>FDW 配置命令：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查看所有外部服务器</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> pg_foreign_server;

<span class="hljs-comment">-- 查看所有用户映射</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> pg_user_mappings;

<span class="hljs-comment">-- 查看所有外部表</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.foreign_tables;

<span class="hljs-comment">-- 删除 FDW 配置（回滚用）</span>
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">VIEW</span> IF <span class="hljs-keyword">EXISTS</span> v_ratings_with_username;
<span class="hljs-keyword">DROP</span> <span class="hljs-keyword">USER</span> MAPPING IF <span class="hljs-keyword">EXISTS</span> <span class="hljs-keyword">FOR</span> your_user SERVER users_server;
<span class="hljs-keyword">DROP</span> SERVER IF <span class="hljs-keyword">EXISTS</span> users_server CASCADE;
</code></pre>
<p>常用查询模板：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 带时间范围的评价查询</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">WHERE</span> 评价时间 <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2024-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2024-12-31'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 评价时间 <span class="hljs-keyword">DESC</span>;

<span class="hljs-comment">-- 用户评价统计</span>
<span class="hljs-keyword">SELECT</span>
    用户名,
    <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">as</span> 评价次数,
    <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> 评价类型 <span class="hljs-operator">=</span> <span class="hljs-string">'like'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">as</span> 点赞数,
    <span class="hljs-built_in">SUM</span>(<span class="hljs-keyword">CASE</span> <span class="hljs-keyword">WHEN</span> 评价类型 <span class="hljs-operator">=</span> <span class="hljs-string">'dislike'</span> <span class="hljs-keyword">THEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">ELSE</span> <span class="hljs-number">0</span> <span class="hljs-keyword">END</span>) <span class="hljs-keyword">as</span> 点踩数
<span class="hljs-keyword">FROM</span> v_ratings_with_username
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> 用户名
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> 评价次数 <span class="hljs-keyword">DESC</span>;
</code></pre>
<hr/>
<h2 data-id="heading-19">延伸阅读</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2Fcurrent%2Fpostgres-fdw.html" target="_blank" title="https://www.postgresql.org/docs/current/postgres-fdw.html" ref="nofollow noopener noreferrer">PostgreSQL FDW 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fsuperset.apache.org%2Fdocs%2Fintro" target="_blank" title="https://superset.apache.org/docs/intro" ref="nofollow noopener noreferrer">Apache Superset 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmicroservices.io%2Fpatterns%2Fdata%2Fdatabase-per-service.html" target="_blank" title="https://microservices.io/patterns/data/database-per-service.html" ref="nofollow noopener noreferrer">微服务架构数据管理模式</a></li>
</ul>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>vibe coding 原理学习</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcoding-cli-guide" target="_blank" title="https://github.com/tt-a1i/coding-cli-guide" ref="nofollow noopener noreferrer">coding-cli-guide</a>（<a href="https://link.juejin.cn?target=https%3A%2F%2Ftt-a1i.github.io%2Fcoding-cli-guide%2F%3Ftab%3Dstart-here" target="_blank" title="https://tt-a1i.github.io/coding-cli-guide/?tab=start-here" ref="nofollow noopener noreferrer">学习网站</a>）- 学习 qwen-cli 时整理的笔记，40+ 交互式动画演示 AI CLI 内部机制</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RocketMQ高性能揭秘：承载万亿级流量的架构奥秘｜得物技术]]></title>    <link>https://juejin.cn/post/7589325011543932966</link>    <guid>https://juejin.cn/post/7589325011543932966</guid>    <pubDate>2025-12-30T08:42:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589325011543932966" data-draft-id="7589166195797835803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RocketMQ高性能揭秘：承载万亿级流量的架构奥秘｜得物技术"/> <meta itemprop="keywords" content="后端,RocketMQ"/> <meta itemprop="datePublished" content="2025-12-30T08:42:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="得物技术"/> <meta itemprop="url" content="https://juejin.cn/user/2392954206960247"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RocketMQ高性能揭秘：承载万亿级流量的架构奥秘｜得物技术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2392954206960247/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    得物技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T08:42:16.000Z" title="Tue Dec 30 2025 08:42:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>在分布式系统架构中，消息队列如同畅通的“信息神经网络”，承担着解耦、削峰与异步通信的核心使命。在众多成熟方案中，RocketMQ凭借其阿里巴巴与Apache双重基因，以卓越的金融级可靠性、万亿级消息堆积能力和灵活的分布式特性脱颖而出，成为构建高可用、高性能数据流转枢纽的关键技术选型。本文将深入解析RocketMQ的核心架构、设计哲学与实践要义。</p>
<h2 data-id="heading-1">二、RocketMQ架构总览</h2>
<p>官网图片</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bdf1be17f15433abadb30355785add7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=Q5cXYft5vb6uHouUekXeCFN7dU0%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>RocketMQ架构上主要分为四部分，如上图所示: </p>
<p>RocketMQ作为一款高性能、高可用的分布式消息中间件，其核心架构采用了经典的四组件协同设计，实现了消息生产、存储、路由与消费的全链路解耦与高效协同。<strong>四大组件——生产者（Producer）、消费者（Consumer）、路由中心（NameServer）和代理服务器（Broker）——各司其职，共同构建了其坚实的基石。</strong></p>
<p><strong>生产者（Producer）</strong> 作为消息的源头，负责将业务消息高效、可靠地发布到系统中。它支持分布式集群部署，并通过内置的智能负载均衡机制，自动选择最优的Broker节点与队列进行投递。</p>
<p><strong>消费者（Consumer）</strong> 是消息的处理终端，同样以集群化方式工作，支持推送（Push）和拉取（Pull）两种消息获取模式。它提供了集群消费与广播消费两种模式，并能动态维护其订阅关系。</p>
<p><strong>路由中心（NameServer）</strong> 是整个架构的“注册中心”，扮演着轻量级服务发现的角色。所有Broker节点都会向NameServer注册，并通过定期心跳汇报健康状态。生产者与消费者则从NameServer获取实时的主题路由与Broker信息，从而实现消息寻址的完全解耦。</p>
<p><strong>代理服务器（Broker）</strong> 是消息存储与流转的核心，负责消息的持久化存储、投递与查询。为了保障高可用性，Broker通常采用主从（Master-Slave）部署架构，确保数据与服务在故障时能无缝切换。其内部集成了通信处理、存储引擎、索引服务和高可用复制等核心模块。</p>
<h2 data-id="heading-2">三、核心组件深度解析</h2>
<h3 data-id="heading-3">NameServer：轻量级服务发现枢纽</h3>
<p>NameServer是RocketMQ的<strong>轻量级服务发现与路由中心，</strong> 其核心目标是<strong>实现生产消费与Broker服务的解耦。</strong> 它不存储消息数据，仅管理路由元数据。</p>
<p>核心是一张的路由表 HashMap&lt;String/* Topic */, List&gt;，记录了每个Topic对应在哪些Broker的哪些队列上。</p>
<p>客户端内置了故障规避机制。如果从某个NameServer获取路由失败，或根据路由信息访问Broker失败，会自动重试其他NameServer或Broker。</p>
<p>1. <strong>核心角色与设计哲学：</strong> NameServer的设计哲学是 <strong>“简单、无状态、最终一致” 。</strong> 每个NameServer节点独立运行，<strong>节点间互不通信，</strong> 这使其具备极强的水平扩展能力和极高的可用性。客户端会配置所有NameServer地址，并向其广播请求。</p>
<p>2. <strong>核心工作机制：</strong> 其运作围绕路由信息的生命周期展开，可通过下图一览其核心流程：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b3280785213457baf0072075bf3d2c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=YWSVIizAw2fvUuXHhFa7xydVAQA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>3. 和kafka注册中心对比</strong></p>
<ul>
<li><strong>NameServer</strong> 采用 <strong>“去中心化”</strong> 和 <strong>“最终一致”</strong> 思想，<strong>追求极致的简单、轻量和水平扩展，</strong> 牺牲了强一致性，以换取架构的简洁和高可用。这非常适合路由信息变动不频繁、客户端具备容错能力的消息场景。</li>
<li><strong>Kafka (KRaft)</strong> 采用 <strong>“中心化”</strong> 和 <strong>“强一致”</strong> 思想，<strong>追求数据的精确和系统的自包含。</strong> 它将元数据管理深度内化，通过共识协议保证全局一致，但代价是架构复杂度和运维成本更高。</li>
</ul>
<p><strong>优劣分析：</strong> NameServer在<strong>运维简易性、集群扩展性、无外部依赖</strong>上占优；而Kafka KRaft在<strong>元数据强一致性、系统自包含、架构统一性</strong>上更胜一筹。选择取决于你对<strong>一致性、复杂度、运维成本</strong>的具体权衡。</p>
<h3 data-id="heading-4">Broker：消息存储与转发的核心引擎</h3>
<p><strong>解密存储文件设计</strong></p>
<p>Broker目录下的文件结构</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e24cb94e63be43809d3bef29a8c763cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=Imv1BnL%2Fp6UklYRQ7TaaZBBi3mc%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>所有核心存储文件均位于Broker节点的 <strong>${storePathRootDir}/store/</strong> 目录下（默认路径为 ~/store/），其下各子目录职责分明：</p>













































<table><thead><tr><th>目录/文件</th><th>核心职责</th><th>关键设计说明</th></tr></thead><tbody><tr><td><strong>commitlog/</strong></td><td><strong>消息实体存储库</strong></td><td>• <strong>设计</strong>：所有Topic的消息<strong>顺序混合追加</strong>写入。• <strong>文件</strong>：以起始物理偏移量命名（20位数字），默认每个1GB。<strong>lock文件</strong>确保同一时刻只有一个进程写入，保障严格顺序写。</td></tr><tr><td><strong>consumequeue/</strong></td><td><strong>逻辑消费队列索引</strong></td><td>• <strong>结构</strong>：按 {Topic}/{QueueId}/三级目录组织。 • <strong>文件</strong>：存储<strong>定长记录</strong>（20字节/条），包含物理偏移量、长度和Tag哈希码。 • <strong>作用</strong>：为消费者提供按Topic和队列分组的<strong>逻辑视图</strong>，实现高效拉取。</td></tr><tr><td><strong>index/</strong></td><td><strong>消息键哈希索引</strong></td><td>• <strong>文件</strong>：以创建时间戳命名（如20240515080000000）。 • <strong>结构</strong>：采用 <strong>“哈希槽 + 链表”</strong> 结构。 • <strong>用途</strong>：支持根据 <strong>Message Key</strong> 或时间范围进行消息查询，用于运维排查。</td></tr><tr><td><strong>config/</strong></td><td><strong>运行时元数据</strong></td><td>• 存储Broker运行期间生成的动态数据，如<strong>所有Topic的配置</strong>、<strong>消费者组的消费进度（offset）</strong> 等。</td></tr><tr><td><strong>checkpoint</strong></td><td><strong>状态检查点文件</strong></td><td>• 记录 commitlog、consumequeue、index等文件<strong>最后一次刷盘的时间戳</strong>，用于崩溃恢复时确定数据恢复的起点。</td></tr><tr><td><strong>abort</strong></td><td><strong>异常关闭标志文件</strong></td><td>• 该文件存在即表明Broker上一次是<strong>非正常关闭</strong>，重启时会触发恢复流程。</td></tr><tr><td><strong>lock</strong></td><td><strong>锁文件</strong></td><td>• lock文件确保同一时刻只有一个进程写入，保障严格顺序写。</td></tr></tbody></table>
<p><strong>commitLog</strong></p>
<p><strong>消息主体以及元数据的存储主体，</strong> 存储Producer端写入的消息主体内容，消息内容<strong>不是定长的。</strong> 单个文件大小默认1G， 文件名长度为20位，左边补零，剩余为<strong>起始偏移量，</strong> 比如00000000000000000000代表了第一个文件，起始偏移量为0，文件大小为1G=1073741824；当第一个文件写满了，第二个文件为00000000001073741824，起始偏移量为1073741824，以此类推。消息主要是顺序写入日志文件，当文件满了，写入下一个文件；</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1555b92d53124c30a1c64520afcb6530~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=IgilS7j5JakSn7XjYXj%2FI%2BkGy4Q%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>当我们消息发送到RocketMQ以后，消息在commitLog中，因为body大小是不固定的，所以每个消息的长度也是不固定的，其存储格式如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4dc74ef5bdb4199b3c65d3620b095d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=Ts7tUksCl96meHHt97y93%2FK5g%2Bw%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>下面每个表格列举了每个字段的含义</p>
























































































































































<table><thead><tr><th>字段</th><th>字段名</th><th>数据类型</th><th>字节数</th><th>说明与用途</th></tr></thead><tbody><tr><td>1</td><td><strong>MsgLen / TOTALSIZE</strong></td><td>int</td><td>4</td><td><strong>消息总长度</strong>，即从本字段开始到结束的总字节数，是解析消息的起点。</td></tr><tr><td>2</td><td><strong>MagicCode</strong></td><td>int</td><td>4</td><td><strong>魔术字</strong>，固定值（如 0xdaa320a7），用于标识这是一个有效的消息存储起始点，也用于区分<strong>消息体</strong>和<strong>文件末尾空白填充区</strong>。</td></tr><tr><td>3</td><td><strong>BodyCRC</strong></td><td>int</td><td>4</td><td><strong>消息体内容的CRC校验码，</strong> 用于校验消息体在存储过程中是否损坏。</td></tr><tr><td>4</td><td><strong>QueueId</strong></td><td>int</td><td>4</td><td><strong>队列ID</strong>，标识此消息属于Topic下的哪个逻辑队列。</td></tr><tr><td>5</td><td><strong>Flag</strong></td><td>int</td><td>4</td><td><strong>消息标志位</strong>，供应用程序自定义使用，RocketMQ内部未使用。</td></tr><tr><td>6</td><td><strong>QueueOffset</strong></td><td>long</td><td>8</td><td><strong>消费队列偏移量</strong>，即此消息在其对应ConsumeQueue中的顺序索引，<strong>是连续的</strong>。</td></tr><tr><td>7</td><td><strong>PhysicalOffset</strong></td><td>long</td><td>8</td><td><strong>物理偏移量</strong>，即此消息在<strong>所有CommitLog文件中的起始字节偏移量</strong>。由于消息长度不定，此偏移量<strong>不是连续的</strong>。</td></tr><tr><td>8</td><td><strong>SysFlag</strong></td><td>int</td><td>4</td><td><strong>系统标志位</strong>，是一个二进制组合值，用于标识消息特性，如：是否压缩、是否为事务消息、是否等待事务提交等。</td></tr><tr><td>9</td><td><strong>BornTimestamp</strong></td><td>long</td><td>8</td><td><strong>消息生成时间戳</strong>，由Producer客户端在发送时生成。</td></tr><tr><td>10</td><td><strong>BornHost</strong></td><td>8字节</td><td>8</td><td><strong>消息发送者地址</strong>。其编码并非简单字符串，而是将IP的4个段和端口号的2个字节，共6个字节，按大端序组合并填充到8字节中。</td></tr><tr><td>11</td><td><strong>StoreTimestamp</strong></td><td>long</td><td>8</td><td><strong>消息存储时间戳</strong>，即Broker收到消息并写入内存的时间。</td></tr><tr><td>12</td><td><strong>StoreHost</strong></td><td>8字节</td><td>8</td><td><strong>Broker存储地址</strong>，编码方式同BornHost。</td></tr><tr><td>13</td><td><strong>ReconsumeTimes</strong></td><td>int</td><td>4</td><td><strong>消息重试消费次数</strong>，用于死信队列判断。</td></tr><tr><td>14</td><td><strong>PreparedTransationOffset</strong></td><td>long</td><td>8</td><td><strong>事务消息专用</strong>，存储与之关联的<strong>事务日志（Transaction Log）的偏移量</strong>。</td></tr><tr><td>15</td><td><strong>BodyLength</strong></td><td>int</td><td>4</td><td><strong>消息体实际长度</strong>，后跟Body内容。</td></tr><tr><td>16</td><td><strong>Body</strong></td><td>byte[]</td><td>不定</td><td><strong>消息体内容</strong>，即Producer发送的原始业务数据。</td></tr><tr><td>17</td><td><strong>TopicLength</strong></td><td>byte</td><td>1</td><td><strong>Topic名称的长度</strong>（1字节，因此Topic名不能超过255字符）。</td></tr><tr><td>18</td><td><strong>Topic</strong></td><td>byte[]</td><td>不定</td><td><strong>Topic名称</strong>的字节数组。</td></tr><tr><td>19</td><td><strong>PropertiesLength</strong></td><td>short</td><td>2</td><td><strong>消息属性长度</strong>，后跟Properties内容。</td></tr><tr><td>20</td><td><strong>Properties</strong></td><td>byte[]</td><td>不定</td><td><strong>消息属性</strong>，用于存储用户自定义的Key-Value扩展信息。在编码时，Key和Value之间用特殊<strong>不可见字符</strong>（如\u0001）分隔，因此属性中不能包含这些字符。</td></tr></tbody></table>
<p><strong>ConsumeQueue</strong></p>
<p>消息消费索引，<strong>引入的目的主要是提高消息消费的性能。</strong> 由于RocketMQ是基于主题topic的订阅模式，消息消费是针对主题进行的，如果要遍历commitlog文件，<strong>根据topic检索消息是非常低效的。</strong></p>
<p>为了解决这个问题中，提高消费时候的速度，RocketMQ会启动后台的 dispatch 线程源源不断的将消息从 commitLog 取出消息在 CommitLog 中的物理偏移量，消息长度以及 Tag Hash 等信息作为单条消息的索引，分发到对应的消费队列，构成了对 CommitLog 的引用。</p>
<p>consumer可根据ConsumeQueue来查找待消费的消息。其中，ConsumeQueue作为消费消息的索引，保存了指定Topic下的队列消息在CommitLog中的起始<strong>物理偏移量offset，消息大小size和消息Tag的HashCode值。</strong></p>
<p><strong>consumequeue文件可以看成是基于topic的commitlog索引文件，</strong> 故consumequeue文件夹的组织方式如下：</p>
<p>$HOME/store/consumequeue/{topic}/{queueId}/{fileName}</p>
<p><strong>consumequeue文件采取定长设计，</strong> 每一个条目共20个字节，前8字节的commitlog物理偏移量、中间4字节的消息长度、8字节tag的hashcode。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2a1c20449134d6f85cddd0b432a61ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=QXmusPa2UJ%2Foj2KiTRxDE9X8I60%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p><strong>indexFile</strong></p>
<p>RocketMQ的IndexFile索引文件提供了通过消息Key或时间区间查询消息的能力，其存储路径为$HOME/store/index/{fileName}，其中文件名以创建时间戳命名。单个IndexFile文件大小固定约为400M，可保存2000W个索引，其底层采用类HashMap的哈希索引结构实现。</p>
<p>IndexFile是一个<strong>固定大小</strong>的文件（约400MB），其物理结构由三部分组成</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec110113d70c41318ed5d59af0260ea6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=LkiT4Cr9Jp4pTcpu%2Ftp5chEcXn0%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>1.IndexHeader（索引头，40字节）</p>
<p><strong>beginTimestamp：</strong> 第一条消息存储时间</p>
<p><strong>endTimestamp：</strong> 最后一条消息存储时间</p>
<p><strong>beginPhyoffset：</strong> 第一条消息在CommitLog中的物理偏移量</p>
<p><strong>endPhyoffset：</strong> 最后一条消息在CommitLog中的物理偏移量</p>
<p><strong>hashSlotCount：</strong> 已使用的哈希槽数量</p>
<p><strong>indexCount：</strong> 索引单元总数</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f15c2fa72ed446819edf72bcd57ed7dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=TjCLGPJ5bxzgC2zTxRD1rWWfHRI%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>2.Slots（哈希槽）</p>
<p>每个IndexFile包含500万个哈希槽位,每个Slot槽位（4字节）存储的是链式索引的第一个索引序号，每个槽位可挂载多个索引单元，形成链式结构。</p>
<ul>
<li>如果Slot值为0：表示该槽位没有索引链</li>
<li>如果Slot值为N：表示该槽位对应的索引链头节点索引序号为N</li>
</ul>
<p>3.Indexes（索引单元，20字节/个）</p>
<p>每个索引单元包含以下字段：</p>
<ul>
<li><strong>keyHash：</strong> 消息Key的哈希值</li>
<li><strong>phyOffset：</strong> 消息在CommitLog中的物理偏移量</li>
<li><strong>timeDiff：</strong> 消息存储时间与IndexFile创建时间的差值</li>
<li><strong>preIndexNo：</strong> 同一哈希槽中前一个索引单元的序号</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28e2a3945505468085f36654c599d975~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=GQFqfiH%2FzwZxZpLgy%2Fy3W9hMR4U%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>这个结构和hashmap结构很像，但是支持每个key通过时间排序，就可以进行时间范围的检索。</p>
<p>通过定长索引结构和整体设计可以通过key快速定位索引数据，拿到真实数据的物理偏移量。</p>
<p>4.索引查询流程</p>
<p>消费者通过消息Key查询时，执行以下步骤：</p>
<ol>
<li>计算槽位序号slot序号 = key哈希值 % 500万</li>
<li>定位槽位地址slot位置 = 40 + (slot序号 - 1) × 4</li>
<li>获取首个索引位置index位置 = 40 + 500万 × 4 + (索引序号 - 1) × 20</li>
<li>遍历索引链从槽位指向的索引开始，沿preIndexNo链式查找，匹配目标Key并校验时间范围</li>
<li>获取物理偏移量从匹配的索引单元中读取phyOffset，最终从CommitLog获取完整消息内容</li>
</ol>
<p>通过此机制，IndexFile实现了基于Key的高效点查和基于时间范围的快速检索。</p>
<p><strong>整体流程</strong></p>
<p>RocketMQ 高性能存储的核心，在于其 <strong>“混合存储”</strong> 架构，这正是一种精妙的<strong>存储层读写分离</strong>设计。</p>
<p>其工作流程可以这样理解：</p>
<ol>
<li><strong>统一写入，保证极致性能：</strong> 所有消息顺序追加写入一个统一的 CommitLog 文件。这种单一的顺序写操作，是它能承受海量消息写入的根本。</li>
<li><strong>异步构建，优化读取路径：</strong> 消息一旦持久化至 CommitLog，即视为安全。随后，后台服务线程会异步地构建出专供消费的 ConsumerQueue（逻辑队列索引）和用于查询的 IndexFile。这相当于为数据建立了高效的“目录”。</li>
<li><strong>消费消息：</strong> 消费者实际拉取消息时，是先读取 ConsumerQueue 找到消息在 CommitLog 中的物理位置，再反查 CommitLog 获取完整消息内容。</li>
<li><strong>可靠的消费机制：</strong> 基于上述持久化保障，配合消费者自身的偏移量管理及Broker的长轮询机制，共同实现了消息的可靠投递与高效获取。</li>
</ol>
<p>这种 <strong>“读写分离”</strong> 设计的好处在于：将耗时的写操作（顺序写CommitLog）与复杂的读操作（构建索引、分散查询）解耦，让两者可以异步、独立地进行优化，从而在整体上获得更高的吞吐量和更低的延迟。这体现了“各司其职，异步协同”的经典架构思想。</p>
<p>下图是官方文档的流程图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/498af1c2070f4a8d9c1a580ad937f5a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b6X54mp5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767688935&amp;x-signature=BHzEd9qIEgSJ5AuVag0vy0St7YA%3D" alt="" loading="lazy"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/></p>
<p>写入流程</p>
<p><strong>1.消息预处理</strong></p>
<p><strong>基础校验：</strong> 检查Topic名称、消息体长度等是否合法。</p>
<p><strong>生成唯一ID：</strong> 结合Broker地址和CommitLog偏移量等，生成全局唯一的MsgID。</p>
<p><strong>设置系统标志：</strong> 根据消息属性（如是否事务消息、是否压缩）设置SysFlag。</p>
<p><strong>2.CommitLog核心写入</strong></p>
<p><strong>获取MappedFile：</strong> 根据当前写入位置，定位或创建对应的1GB内存映射文件。这里采用双重检查锁模式来保证性能和安全。</p>
<p><strong>串行加锁写入：</strong> 获取全局或文件级锁（PutMessageLock），确保同一时刻只有一个线程写入文件，严格保证<strong>顺序性。</strong></p>
<p><strong>序列化与追加：</strong> 将消息按照之前分析的<strong>二进制协议，</strong> 序列化到MappedByteBuffer中，并更新写入指针。</p>
<p><strong>3.刷盘（Flush）</strong></p>
<p><strong>同步刷盘：</strong> 消息写入内存映射区后，会创建一个GroupCommitRequest并放入请求组。写入线程会等待，直到<strong>刷盘线程</strong>完成该请求对应文件的物理刷盘后，才返回成功给Producer。<strong>数据最可靠，但延迟较高。</strong></p>
<p><strong>异步刷盘（默认）：</strong> 消息写入内存映射区后，立即返回成功给Producer。同时唤醒<strong>异步刷盘线程，</strong> 该线程会定时或当PageCache中待刷盘数据积累到一定量时，执行一次批量刷盘。<strong>性能高，但有宕机丢数风险。</strong></p>
<p><strong>4.异步索引构建</strong></p>
<p>由独立的ReputMessageService线程处理。它不断检查CommitLog中是否有新消息到达。</p>
<p>一旦有<strong>新消息被确认持久化</strong>（对于同步刷盘是已落盘，对于异步刷盘是已写入映射区），该线程就会读取消息内容。</p>
<p>随后，它会为这条消息在对应的consumequeue目录下构建<strong>消费队列索引</strong>（记录CommitLog物理偏移量和消息长度），更新index索引文件。</p>
<p>消费流程</p>
<p><strong>1.启动与负载均衡</strong></p>
<p>消费者启动后，会向<strong>NameServer</strong>获取Topic的路由信息（包含哪些队列、分布在哪些Broker上）。</p>
<p>如果消费者组内有多个实例，会触发<strong>队列负载均衡</strong>（默认策略是平均分配）。例如，一个Topic有8个队列，两个消费者实例，则通常每个消费者负责消费4个队列。这一步决定了每个消费者“认领”了哪些消息队列。</p>
<p><strong>2.拉取消息循环</strong></p>
<p>每个消费者实例内部都有一个PullMessageService线程，它循环从一个PullRequest队列中获取任务。</p>
<p>PullRequest包含了拉取目标（如Broker-A， 队列3）以及<strong>下一次要拉取的位点（offset）。</strong></p>
<p>消费者向指定的Broker发送网络请求，请求体中就携带了这个offset。</p>
<p><strong>3.Broker端处理与返回</strong></p>
<p>Broker收到请求后，根据Topic、队列ID和offset，去查询对应的<strong>ConsumeQueue索引文件。</strong></p>
<p>ConsumeQueue中存储的是定长（20字节）的记录，包含消息在<strong>CommitLog中的物理偏移量和长度。</strong></p>
<p>Broker根据物理偏移量，从<strong>CommitLog文件</strong>中读取完整的消息内容，通过网络返回给消费者。</p>
<p><strong>4.消息处理与位点提交</strong></p>
<p>消费者将拉取到的消息提交到内部的<strong>消费线程池</strong>进行处理，你的业务逻辑就在这里执行。</p>
<p><strong>消费位点的管理至关重要：</strong></p>
<p><strong>位点存储：</strong> 位点由OffsetStore管理。在<strong>集群模式（CLUSTER）</strong> 下，消费位点存储在Broker上；在<strong>广播模式（BROADCAST）</strong> 下，位点存储在本地。</p>
<p><strong>位点提交：</strong> 消费成功后，消费者会<strong>异步</strong>（默认方式）向Broker提交已消费的位点。Broker将其持久化到store/config/consumerOffset.json文件中。</p>
<p><strong>5.消息重试与死信</strong></p>
<p>如果消息消费<strong>失败</strong>（抛出异常或超时未返回CONSUME_SUCCESS），RocketMQ会触发<strong>重试机制。</strong></p>
<p>对于普通消息，消息会被发回Broker上一个特殊的<strong>重试主题</strong>（%RETRY%），延迟一段时间（延迟级别：1s、5s、10s…）后再被原消费者组拉取。</p>
<p>如果<strong>重试超过最大次数</strong>（默认16次），消息会被投递到<strong>死信主题</strong>（%DLQ%），等待人工干预。死信队列中的消息不会再被自动消费。</p>
<h3 data-id="heading-5">一体与分离：Kafka和RocketMQ的核心架构博弈</h3>
<p>说起RocketMQ就不能不提起Kafka了，两者都是消息中间件这个领域的霸主，但它们的核心<strong>架构设计差异，</strong> 直接决定了各自不同的性能特性和适用场景，这也是技术选型时必须深入理解的重点。</p>
<p><strong>核心架构设计差异</strong></p>
<p><strong>Kafka：读写一体的“分区日志”模型，</strong> Kafka的架构哲学是<strong>极简与统一。</strong> 它将每个主题分区抽象为一个<strong>仅追加（append-only）的物理日志文件。</strong> 生产者和消费者都直接与这个日志文件交互：生产者顺序写入尾部，消费者通过维护偏移量顺序读取。这种设计下，<strong>数据的读写路径完全一致，</strong> 逻辑与物理结构高度统一。</p>
<p><strong>RocketMQ：读写分离的“二级制”模型 ，</strong> RocketMQ的架构哲学是<strong>分工与优化。</strong> 它采用了<strong>物理CommitLog + 逻辑ConsumeQueue的二级结构。</strong> 所有消息都顺序写入一个统一的<strong>CommitLog</strong>物理文件，实现磁盘的最高效顺序写。同时，为每个消息队列异步构建一个轻量级的<strong>ConsumeQueue</strong>索引文件，消费者读取时先查询内存中的ConsumeQueue定位，再到CommitLog中获取消息体。这是一种<strong>逻辑与物理分离</strong>的设计。</p>
<p><strong>优劣势对比</strong></p>
<p>基于上述架构设计根本差异，两者在关键指标上各显优劣：</p>



































<table><thead><tr><th>维度</th><th>Kafka（读写一体）</th><th>RocketMQ（读写分离）</th></tr></thead><tbody><tr><td><strong>核心优势</strong></td><td><strong>极致吞吐与低延迟</strong>：读写同路径，数据写入后立即可读，端到端延迟极低。<strong>架构简单</strong>：无中间状态，副本同步、故障恢复逻辑清晰。</td><td><strong>高并发读与丰富功能</strong>：索引与数据分离，支持海量消费者并发读。<strong>业务友好</strong>：原生支持事务消息、定时/延时消息、消息轨迹查询。</td></tr><tr><td><strong>存储效率</strong></td><td><strong>磁盘顺序IO最大化</strong>：生产和消费都是严格顺序IO，尤其适合机械硬盘。</td><td><strong>写性能极致化</strong>：所有消息顺序写CommitLog，<strong>但存在“写放大”</strong> ，一条消息需写多次（1次CommitLog + N次ConsumeQueue）。</td></tr><tr><td><strong>读性能</strong></td><td><strong>消费者落后时可能触发随机读</strong>：若消费者要读取非尾部历史数据，可能需磁盘寻道。但现代SSD和预读机制已大大缓解此问题。</td><td><strong>读路径优化</strong>：ConsumeQueue小而固定，可全量缓存至内存，读操作变为“内存寻址 + CommitLog顺序/随机读”。在PageCache命中率高时表现优异。</td></tr><tr><td><strong>扩展性与成本</strong></td><td><strong>文件句柄（inode）开销大</strong>：每个分区都是独立目录和文件，海量分区时运维成本高。</td><td><strong>存储成本与效率更优</strong>：多Topic共享CommitLog，文件数少，<strong>特别适合中小消息体、多Topic的场景</strong>。</td></tr><tr><td><strong>典型场景</strong></td><td><strong>日志流、指标监控、实时流处理</strong>：作为大数据管道，与Flink/Spark生态无缝集成。</td><td><strong>电商交易、金融业务、异步解耦</strong>：需要严格顺序、事务保障、业务查询的在线业务场景。</td></tr></tbody></table>
<p>总而言之，Kafka像一个设计精良的<strong>高速公路系统，</strong> 核心目标是让数据车辆（消息）能够高吞吐、低延迟地持续流动，并方便地引向各个处理工厂（流计算）。而RocketMQ则像一个高度可靠的<strong>快递网络，</strong> 不仅确保包裹（消息）准确送达，还提供预约配送（定时）、签收确认（事务）、异常重投（重试）等一系列服务于业务逻辑的增值功能。</p>
<h3 data-id="heading-6">RocketMQ对于随机读取的优化</h3>
<p>RocketMQ在消费时候的流程</p>
<pre><code class="hljs">消费者请求 → ConsumeQueue（内存/顺序）获取commitlog上的物理偏移量 → 根据物理偏移量定位CommitLog（磁盘/随机） → 返回消息
</code></pre>
<p>从ConsumeQueue获取到消息在commitlog中的偏移量的时候，回查时候可能产生随机IO</p>
<ol>
<li><strong>第一次随机IO：</strong> 根据ConsumeQueue中的物理偏移量，在CommitLog中定位消息位置</li>
<li><strong>可能的连续随机IO：</strong> 如果一次拉取多条消息，这些消息在CommitLog中可能物理不连续</li>
</ol>
<p>为了保证RocketMQ的高性能，采用一些优化措施，尽量避免随机IO</p>
<p><strong>1. ConsumeQueue的内存映射优化</strong></p>
<p>实际上，RocketMQ将ConsumeQueue映射到内存,每个ConsumeQueue约5.72MB，可完全放入PageCache,读索引操作几乎是内存操作。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsumeQueue</span> {
    <span class="hljs-keyword">private</span> MappedFile mappedFile;  <span class="hljs-comment">// 内存映射文件</span>
    <span class="hljs-comment">// 20字节每条：8(offset) + 4(size) + 8(tagHashCode)</span>
}
</code></pre>
<p><strong>2. PageCache的充分利用</strong></p>
<p>Linux PageCache工作流程： </p>
<ol>
<li>消息写入CommitLog → 进入PageCache</li>
<li>消费者读取 → 优先从PageCache获取</li>
<li>如果PageCache命中：内存速度（≈100ns）</li>
<li>如果PageCache未命中：磁盘随机读取（≈10ms）</li>
</ol>
<p><strong>3. 批量读取优化</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// DefaultMessageStore.java</span>
public GetMessageResult <span class="hljs-built_in">getMessage</span>(...) {
    <span class="hljs-comment">// 一次读取多条消息（默认最多32条）</span>
    <span class="hljs-comment">// 即使这些消息物理不连续，通过批量读取减少IO次数</span>
    for (int i = <span class="hljs-number">0</span>; i &lt; maxMsgNums; i++) {
        <span class="hljs-comment">// 使用同一个文件channel批量读取</span>
        <span class="hljs-built_in">readMessage</span>(ctx, msgId, consumerGroup);
    }
}
</code></pre>
<p><strong>4. 读取顺序性的保持</strong></p>
<p>虽然CommitLog中不同Topic的消息是随机存放的，但同一个Queue的消息在CommitLog中是基本连续的：</p>
<pre><code class="hljs language-markdown" lang="markdown">Queue1: | Msg1 | Msg3 | Msg5 | ... | 在ConsumeQueue中连续
        ↓      ↓      ↓
CommitLog: | Msg1 | Msg2(T2) | Msg3 | Msg4(T3) | Msg5 |
          ↑<span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-strong">____</span><span class="hljs-emphasis">_↑
          物理上相对连续，减少磁头寻道
</span></code></pre>
<h3 data-id="heading-7">高可用设计：双轨并行的可靠性架构</h3>
<p><strong>主从架构（Master-Slave）</strong></p>
<p><strong>经典主从模式：</strong> RocketMQ早期采用Master-Slave架构，Master处理所有读写请求，Slave仅作为热备份。这种模式下，<strong>故障切换依赖人工干预或半自动脚本，</strong> 恢复时间通常在分钟级别。</p>
<p><strong>Dledger高可用集群：</strong> RocketMQ 4.5引入的Dledger基于Raft协议实现<strong>真正的主从自动切换。</strong> 当Master故障时，集群能在秒级（通常2-10秒）内自动选举新Leader，期间消息仍可写入（写入请求会阻塞至新Leader选出）。</p>
<p><strong>多副本机制：</strong> 现代部署中，建议采用<strong>2主2从或3主3从</strong>架构。例如在阿里云上，每个Broker组包含1个Master和2个Slave，形成<strong>跨可用区的三副本，</strong> 单机房故障不影响服务可用性。</p>
<p><strong>同步/异步复制</strong></p>
<p>同步复制保证强一致（消息不丢失），异步复制追求更高性能。</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Broker配置示例</span>
brokerRole = SYNC_MASTER
<span class="hljs-comment">// 生产者发送消息后，必须等待至少一个Slave确认</span>
<span class="hljs-comment">// 确保即使Master宕机，消息也不会丢失</span>
</code></pre>
<ul>
<li>强一致性保证：消息写入Master后，同步复制到Slave才返回成功</li>
<li>性能代价：延迟增加约30-50%，TPS下降约20-40%</li>
<li>适用场景：金融交易、资金变动等对数据一致性要求极高的业务</li>
</ul>
<p><strong>同步/异步刷盘</strong></p>
<p>同步刷盘保证消息持久化不丢失，异步刷盘提升吞吐。</p>
<pre><code class="hljs language-arduino" lang="arduino">brokerRole = ASYNC_MASTER
<span class="hljs-comment">// 消息写入Master即返回成功，Slave异步复制</span>
<span class="hljs-comment">// 存在极短时间的数据丢失风险</span>
</code></pre>
<ul>
<li><strong>高性能模式：</strong> 延迟降低，吞吐量接近单节点性能</li>
<li><strong>风险窗口：</strong> Master宕机且数据未同步时，最近几秒消息可能丢失</li>
<li><strong>适用场景：</strong> 日志收集、监控数据、可容忍微量丢失的业务消息</li>
</ul>
<h3 data-id="heading-8">刷盘策略的工程优化</h3>
<p><strong>同步刷盘（SYNC_FLUSH）</strong></p>
<pre><code class="hljs">生产者 → Broker内存 → 磁盘强制刷盘 → 返回成功
</code></pre>
<ul>
<li><strong>零数据丢失：</strong> 即使机器掉电，消息也已持久化到磁盘</li>
<li><strong>性能瓶颈：</strong> 每次写入都触发磁盘IO，机械硬盘下TPS通常&lt;1000</li>
<li><strong>优化手段：</strong> 使用SSD硬盘可大幅提升性能</li>
</ul>
<p><strong>异步刷盘（ASYNC_FLUSH）</strong></p>
<pre><code class="hljs">生产者 → Broker内存 → 立即返回成功 → 异步批量刷盘
</code></pre>
<ul>
<li><strong>高性能选择：</strong> 依赖PageCache，SSD下TPS可达数万至数十万</li>
<li><strong>可靠性依赖：</strong> 依赖操作系统的刷盘机制（通常5秒刷盘一次）</li>
<li><strong>配置调优：</strong></li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 调整刷盘参数</span>
<span class="hljs-attr">flushCommitLogLeastPages</span> = <span class="hljs-number">4</span>    <span class="hljs-comment"># 至少4页（16KB）才刷盘</span>
<span class="hljs-attr">flushCommitLogThoroughInterval</span> = <span class="hljs-number">10000</span>  <span class="hljs-comment"># 10秒强制刷盘一次</span>
</code></pre>
<h2 data-id="heading-9">四、Producer与Consumer：高效的生产与消费模型</h2>
<h3 data-id="heading-10">Producer</h3>
<p><strong>消息路由策略：</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 内置多种队列选择算法</span>
<span class="hljs-title class_">DefaultMQProducer</span> producer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultMQProducer</span>(<span class="hljs-string">"ProducerGroup"</span>);
<span class="hljs-comment">// 1. 轮询（默认）：均匀分布到所有队列</span>
<span class="hljs-comment">// 2. 哈希：相同Key的消息路由到同一队列，保证局部顺序</span>
<span class="hljs-comment">// 3. 机房就近：优先选择同机房的Broker</span>
producer.<span class="hljs-title function_">send</span>(msg, <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageQueueSelector</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">MessageQueue</span> <span class="hljs-title function_">select</span>(<span class="hljs-params">List&lt;MessageQueue&gt; mqs, Message msg, <span class="hljs-built_in">Object</span> arg</span>) {
        <span class="hljs-comment">// 自定义路由逻辑</span>
        <span class="hljs-keyword">return</span> mqs.<span class="hljs-title function_">get</span>(arg.<span class="hljs-title function_">hashCode</span>() % mqs.<span class="hljs-title function_">size</span>());
    }
});
</code></pre>
<p><strong>发送模式对比：</strong></p>





























<table><thead><tr><th>模式</th><th>特点</th><th>性能</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>同步发送</strong></td><td>阻塞等待Broker响应</td><td>TPS约5000-20000</td><td>重要业务消息，需立即知道发送结果</td></tr><tr><td><strong>异步发送</strong></td><td>回调通知结果</td><td>TPS可达50000+</td><td>高并发场景，如日志、监控数据</td></tr><tr><td><strong>单向发送</strong></td><td>发送后不等待</td><td>TPS最高（100000+）</td><td>可容忍少量丢失的非关键数据</td></tr></tbody></table>
<p><strong>失败重试与熔断：</strong></p>
<ul>
<li><strong>智能重试：</strong> 发送失败时自动重试（默认2次），可配置退避策略</li>
<li><strong>故障规避：</strong> 自动检测Broker可用性，故障期间路由到健康节点</li>
<li><strong>慢请求熔断：</strong> 统计发送耗时，自动隔离响应慢的Broker</li>
</ul>
<h3 data-id="heading-11">Consumer</h3>
<p><strong>负载均衡策略：</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 集群模式：同一ConsumerGroup内消费者均分队列</span>
consumer<span class="hljs-selector-class">.setMessageModel</span>(MessageModel.CLUSTERING);
<span class="hljs-comment">// 广播模式：每个消费者消费全量队列</span>
consumer<span class="hljs-selector-class">.setMessageModel</span>(MessageModel.BROADCASTING);
</code></pre>
<p><strong>消费进度管理：</strong></p>
<p><strong>Broker托管：</strong> 默认方式，消费进度存储在Broker</p>
<p><strong>本地维护：</strong> 某些场景下可自主管理offset（如批量处理）</p>
<p><strong>重置策略：</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 支持多种消费起点</span>
consumer<span class="hljs-selector-class">.setConsumeFromWhere</span>(ConsumeFromWhere.CONSUME_FROM_LAST_OFFSET);  <span class="hljs-comment">// 从最后</span>
consumer<span class="hljs-selector-class">.setConsumeFromWhere</span>(ConsumeFromWhere.CONSUME_FROM_FIRST_OFFSET); <span class="hljs-comment">// 从头</span>
consumer<span class="hljs-selector-class">.setConsumeFromWhere</span>(ConsumeFromWhere.CONSUME_FROM_TIMESTAMP);    <span class="hljs-comment">// 从时间点</span>
</code></pre>
<p><strong>并发控制优化：</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 关键并发参数</span>
consumer<span class="hljs-selector-class">.setConsumeThreadMin</span>(<span class="hljs-number">20</span>);     <span class="hljs-comment">// 最小消费线程数</span>
consumer<span class="hljs-selector-class">.setConsumeThreadMax</span>(<span class="hljs-number">64</span>);     <span class="hljs-comment">// 最大消费线程数</span>
consumer<span class="hljs-selector-class">.setPullBatchSize</span>(<span class="hljs-number">32</span>);        <span class="hljs-comment">// 每次拉取消息数</span>
consumer<span class="hljs-selector-class">.setConsumeMessageBatchMaxSize</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 批量消费大小</span>
<span class="hljs-comment">// 流控机制</span>
consumer<span class="hljs-selector-class">.setPullThresholdForQueue</span>(<span class="hljs-number">1000</span>);  <span class="hljs-comment">// 队列堆积阈值</span>
consumer<span class="hljs-selector-class">.setPullInterval</span>(<span class="hljs-number">0</span>);              <span class="hljs-comment">// 拉取间隔（0为长轮询）</span>
</code></pre>
<h2 data-id="heading-12">五、核心流程与特性背后的架构支撑</h2>
<p>1 <strong>.顺序消息如何保证？</strong></p>
<p><strong>全局顺序：</strong> 单Topic单队列（牺牲并发）。</p>
<p><strong>分区顺序：</strong> 通过<strong>MessageQueue选择器</strong>确保同一业务键（如订单ID）的消息发往同一队列，Consumer端按队列顺序消费。</p>
<p><strong>2.事务消息的两阶段提交</strong></p>
<p><strong>流程详解：</strong> Half Message -&gt; 执行本地事务 -&gt; Commit/Rollback。</p>
<p><strong>架构支撑：</strong> Op消息回查机制，解决分布式事务的最终一致性，是架构设计中“状态可回溯”思想的体现。</p>
<p><strong>3.延时消息的实现奥秘</strong></p>
<p><strong>并非真正延迟投递：</strong> 为不同延迟级别预设<strong>独立的SCHEDULE_TOPIC，</strong> 定时任务扫描到期后投递至真实Topic。</p>
<p><strong>设计权衡：</strong> 以存储和计算换取功能的灵活与可靠。</p>
<h2 data-id="heading-13">六、其他性能优化关键技术点</h2>
<ol>
<li><strong>零拷贝（Zero-copy）：</strong> 通过sendfile或mmap+write方式，减少内核态与用户态间数据拷贝，大幅提升网络发送与文件读写效率。</li>
<li><strong>堆外内存与内存池：</strong> 避免JVM GC对大数据块处理的影响，实现高效的内存管理。</li>
<li><strong>文件预热：</strong> 启动时将存储文件映射到内存并写入“假数据”，避免运行时缺页中断。</li>
</ol>
<h2 data-id="heading-14">七、总结：RocketMQ架构设计的启示</h2>
<p>RocketMQ的架构设计，尤其是其在简洁性、高性能和云原生演进方面的平衡，为构建现代分布式系统提供了许多宝贵启示。</p>
<ol>
<li><strong>在简单与完备间权衡：</strong> RocketMQ没有采用强一致性的ZooKeeper，而是自研了极其简单的NameServer。这说明在非核心路径上，牺牲一定的功能完备性来换取简单性和高可用性，可能也是个不错的选择。</li>
<li><strong>以写定存储，以读优查询：</strong> 其存储架构是典型的写优化设计。所有消息顺序追加写入，保证了最高的写入性能。而针对消费和查询这两种主要的“读”场景，则分别通过异步构建索引数据结构（ConsumeQueue和IndexFile）来优化。</li>
</ol>
<h2 data-id="heading-15">八、参考资料</h2>
<ul>
<li>[RocketMQ官方文档](为什么选择RocketMQ | RocketMQ <a href="https://link.juejin.cn?target=https%3A%2F%2Frocketmq.apache.org%2Fzh%2Fdocs%2F" target="_blank" title="https://rocketmq.apache.org/zh/docs/" ref="nofollow noopener noreferrer">rocketmq.apache.org/zh/docs/</a>)</li>
<li>[RocketMQ中文社区](Apache RocketMQ 原理和架构 <a href="https://link.juejin.cn?target=https%3A%2F%2Frocketmq-learning.com%2Fcourse%2FbaseLearn%2Frocketmq_learning-framework%2F%3Fspm%3D5176.29160081.0.0.a2807833VzCxtS%26source%3Dhome" target="_blank" title="https://rocketmq-learning.com/course/baseLearn/rocketmq_learning-framework/?spm=5176.29160081.0.0.a2807833VzCxtS&amp;source=home" ref="nofollow noopener noreferrer">rocketmq-learning.com/course/base…</a>)</li>
</ul>
<h3 data-id="heading-16">往期回顾</h3>
<p>1.PAG在得物社区S级活动的落地</p>
<p>2.Ant Design 6.0 尝鲜：上手现代化组件开发｜得物技术 </p>
<p>3.Java 设计模式：原理、框架应用与实战全解析｜得物技术</p>
<p>4.Go语言在高并发高可用系统中的实践与解决方案｜得物技术</p>
<p>5.从0到1搭建一个智能分析OBS埋点数据的AI Agent｜得物技术</p>
<h3 data-id="heading-17">文 /磊子</h3>
<p>关注得物技术，每周更新技术干货</p>
<p>要是觉得文章对你有帮助的话，欢迎评论转发点赞～</p>
<p>未经得物技术许可严禁转载，否则依法追究法律责任。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何查看 SpringBoot 当前线程数？3 种方法亲测有效]]></title>    <link>https://juejin.cn/post/7589126920287109130</link>    <guid>https://juejin.cn/post/7589126920287109130</guid>    <pubDate>2025-12-30T01:04:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126920287109130" data-draft-id="7579945518344716303" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何查看 SpringBoot 当前线程数？3 种方法亲测有效"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-30T01:04:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="刘大华"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何查看 SpringBoot 当前线程数？3 种方法亲测有效
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    刘大华
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T01:04:38.000Z" title="Tue Dec 30 2025 01:04:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前几天，我在排查一个 SpringBoot 应用响应变慢的问题。日志看不出有什么异常，CPU和内存也还算正常，但用户就是觉得卡。</p>
<p>于是，我在想：<strong>是不是某个线程卡住了，或者线程池失控了？现在到底有多少线程在运行？</strong></p>
<p>好在查看线程数并不复杂，不管是临时诊断还是长期监控，都有现成的办法。下面我就分享几种常用的方式。</p>
<h2 data-id="heading-0">监控方案</h2>



































<table><thead><tr><th>监控方式</th><th>适用场景</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>Spring Boot Actuator</td><td>生产环境监控</td><td>集成度高，RESTful接口</td><td>需要添加依赖和配置</td></tr><tr><td>jstack命令</td><td>紧急问题诊断</td><td>JDK自带，无需配置</td><td>命令行操作，不够直观</td></tr><tr><td>VisualVM</td><td>开发测试环境</td><td>图形化界面，功能强大</td><td>JDK 9+需要单独安装</td></tr><tr><td>JMC</td><td>生产环境深度分析</td><td>性能分析强大</td><td>内存占用较高</td></tr></tbody></table>
<p>下面我们看看前3种方案是怎么使用的。</p>
<h2 data-id="heading-1">一、Spring Boot自带监控（最简单）</h2>
<h3 data-id="heading-2">步骤1：添加依赖</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 在pom.xml中添加 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">步骤2：修改配置</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 在application.yml中添加</span>
<span class="hljs-attr">management:</span>
  <span class="hljs-attr">endpoints:</span>
    <span class="hljs-attr">web:</span>
      <span class="hljs-attr">exposure:</span>
        <span class="hljs-attr">include:</span> <span class="hljs-string">"metrics,threaddump"</span>
</code></pre>
<h3 data-id="heading-4">步骤3：启动项目后，查看线程信息</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看线程总数</span>
http://127.0.0.1:8080/actuator/metrics/jvm.threads.live
</code></pre>
<p>如图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/206a64650f624b02a9ef13d94e13ccc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=l6ej68q80Rl0f8p%2FlGwHYk2DFxE%3D" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" loading="lazy"/></p>
<p><code>measurement.value</code> 就是当前存活的线程数，配置简单，不用记命令。</p>
<p><strong>安全配置（生产环境）</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">security:</span>
    <span class="hljs-attr">user:</span>
      <span class="hljs-attr">name:</span> <span class="hljs-string">admin</span>
      <span class="hljs-attr">password:</span> <span class="hljs-string">securepassword</span>

<span class="hljs-attr">management:</span>
  <span class="hljs-attr">server:</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">9090</span>  <span class="hljs-comment"># 监控端口与业务端口分离</span>
</code></pre>
<h2 data-id="heading-5">二、使用jstack命令（最常用）</h2>
<h3 data-id="heading-6">1. 找到应用ID</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看所有Java进程</span>
jps -l

<span class="hljs-comment"># 或者使用ps命令</span>
ps aux | grep java
</code></pre>
<p>输出类似：</p>
<pre><code class="hljs">36756 org.springframework.boot.loader.JarLauncher
</code></pre>
<p>如图：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f5e7222ce634c04ac2851a8b5272806~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=7fi0FOosWnF3gWMRhYJnJzdd0sw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">2. 分析线程</h3>
<pre><code class="hljs language-bash" lang="bash">jstack 36756
</code></pre>
<p>如图：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c3aa11ba23e4d5ea5e4f0ee6e52c810~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=pgnb8BumnKxUzyfSan2ZrWTMHEE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h4 data-id="heading-8">线程状态说明</h4>
<ul>
<li><strong>RUNNABLE</strong>: 线程正在运行或准备运行</li>
<li><strong>WAITING</strong>: 无限期等待其他线程的特定操作</li>
<li><strong>TIMED_WAITING</strong>: 有限时间等待</li>
<li><strong>BLOCKED</strong>: 等待获取监视器锁</li>
<li><strong>TERMINATED</strong>: 线程已结束</li>
</ul>
<h4 data-id="heading-9">关键线程类型识别</h4>
<p><strong>1. JVM系统线程</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"Reference Handler"</span> - 引用处理线程
<span class="hljs-string">"Finalizer"</span> - 对象终结线程
<span class="hljs-string">"Signal Dispatcher"</span> - 信号分发线程
<span class="hljs-string">"GC Thread"</span> - 垃圾回收线程（多个）
</code></pre>
<p><strong>2. Spring Boot应用线程</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"http-nio-8080-exec-*"</span> - Tomcat工作线程
<span class="hljs-string">"Catalina-utility-*"</span> - Tomcat工具线程
<span class="hljs-string">"HikariPool-*"</span> - 数据库连接池线程
</code></pre>
<p><strong>3. 第三方库线程</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-string">"lettuce-*"</span> - Redis客户端线程
<span class="hljs-string">"boundedElastic-*"</span> - Reactor响应式线程
<span class="hljs-string">"mysql-cj-*"</span> - MySQL驱动线程
</code></pre>
<h3 data-id="heading-10">3. 线程快照</h3>
<p>也可以生成线程快照，保存到文件后再慢慢分析</p>
<pre><code class="hljs language-bash" lang="bash">jstack 36756 &gt; thread.txt
</code></pre>
<p><strong>快速统计命令</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 统计总线程数</span>
grep <span class="hljs-string">'java.lang.Thread.State'</span> thread.txt | <span class="hljs-built_in">wc</span> -l

<span class="hljs-comment"># 统计Tomcat线程数  </span>
grep <span class="hljs-string">'"http-nio'</span> thread.txt | <span class="hljs-built_in">wc</span> -l

<span class="hljs-comment"># 查看线程状态分布</span>
grep <span class="hljs-string">'java.lang.Thread.State'</span> thread.txt | <span class="hljs-built_in">sort</span> | <span class="hljs-built_in">uniq</span> -c
</code></pre>
<p><strong>也可以通过自动化监控脚本进行分析</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
<span class="hljs-comment"># monitor_threads.sh</span>

APP_NAME=<span class="hljs-string">"your-spring-boot-app"</span>
LOG_DIR=<span class="hljs-string">"./thread_dumps"</span>
INTERVAL=60  <span class="hljs-comment"># 监控间隔(秒)</span>
MAX_DUMPS=10 <span class="hljs-comment"># 最大转储文件数</span>

<span class="hljs-built_in">mkdir</span> -p <span class="hljs-variable">$LOG_DIR</span>

<span class="hljs-keyword">while</span> <span class="hljs-literal">true</span>; <span class="hljs-keyword">do</span>
    PID=$(jps -l | grep <span class="hljs-variable">$APP_NAME</span> | awk <span class="hljs-string">'{print $1}'</span>)
    
    <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">"<span class="hljs-variable">$PID</span>"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(date)</span>: 应用未运行"</span>
        <span class="hljs-built_in">sleep</span> <span class="hljs-variable">$INTERVAL</span>
        <span class="hljs-built_in">continue</span>
    <span class="hljs-keyword">fi</span>
    
    <span class="hljs-comment"># 生成时间戳</span>
    TIMESTAMP=$(<span class="hljs-built_in">date</span> +%Y%m%d_%H%M%S)
    
    <span class="hljs-comment"># 生成线程转储</span>
    jstack <span class="hljs-variable">$PID</span> &gt; <span class="hljs-variable">$LOG_DIR</span>/thread_dump_<span class="hljs-variable">$TIMESTAMP</span>.txt
    
    <span class="hljs-comment"># 统计线程信息</span>
    TOTAL_THREADS=$(grep <span class="hljs-string">'java.lang.Thread.State'</span> <span class="hljs-variable">$LOG_DIR</span>/thread_dump_<span class="hljs-variable">$TIMESTAMP</span>.txt | <span class="hljs-built_in">wc</span> -l)
    RUNNABLE=$(grep <span class="hljs-string">'java.lang.Thread.State: RUNNABLE'</span> <span class="hljs-variable">$LOG_DIR</span>/thread_dump_<span class="hljs-variable">$TIMESTAMP</span>.txt | <span class="hljs-built_in">wc</span> -l)
    WAITING=$(grep <span class="hljs-string">'java.lang.Thread.State: WAITING'</span> <span class="hljs-variable">$LOG_DIR</span>/thread_dump_<span class="hljs-variable">$TIMESTAMP</span>.txt | <span class="hljs-built_in">wc</span> -l)
    BLOCKED=$(grep <span class="hljs-string">'java.lang.Thread.State: BLOCKED'</span> <span class="hljs-variable">$LOG_DIR</span>/thread_dump_<span class="hljs-variable">$TIMESTAMP</span>.txt | <span class="hljs-built_in">wc</span> -l)
    
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-subst">$(date)</span>: 线程统计 - 总数: <span class="hljs-variable">$TOTAL_THREADS</span>, 运行: <span class="hljs-variable">$RUNNABLE</span>, 等待: <span class="hljs-variable">$WAITING</span>, 阻塞: <span class="hljs-variable">$BLOCKED</span>"</span>
    
    <span class="hljs-comment"># 清理旧文件</span>
    <span class="hljs-built_in">ls</span> -t <span class="hljs-variable">$LOG_DIR</span>/thread_dump_*.txt | <span class="hljs-built_in">tail</span> -n +<span class="hljs-variable">$MAX_DUMPS</span> | xargs <span class="hljs-built_in">rm</span> -f
    
    <span class="hljs-built_in">sleep</span> <span class="hljs-variable">$INTERVAL</span>
<span class="hljs-keyword">done</span>
</code></pre>
<p><strong>优点</strong>：不用改代码，随时可用</p>
<h2 data-id="heading-11">三、使用VisualVM（最直观）</h2>
<h3 data-id="heading-12">1. 安装步骤</h3>
<ol>
<li>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvisualvm.github.io%2F" target="_blank" title="https://visualvm.github.io/" ref="nofollow noopener noreferrer">visualvm.github.io/</a></li>
<li>下载对应版本</li>
<li>解压后运行<code>bin/visualvm</code></li>
</ol>
<h3 data-id="heading-13">2. 使用方法</h3>
<ol>
<li>启动VisualVM</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Windows</span>
visualvm.exe

<span class="hljs-comment"># Linux/macOS</span>
./visualvm
</code></pre>
<ol start="2">
<li>在左边找到你的应用</li>
<li>点击应用名称就能看到基础信息页了</li>
</ol>
<p>如图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84812efa51694a3880a5d0a615021f34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=vAhF3JXp1bVAGJMkRs1BPY8W8yQ%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-14">Monitor 监控页</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8d6ad30cafe4f12ad2dabe08ec62ba3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=5Eo08DT15a4II0FhZYPhQL%2B2lF8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>界面说明</strong></p>
<ul>
<li>CPU使用率：查看方法执行时间</li>
<li>堆内存使用：监控内存泄漏</li>
<li>Metaspace：JDK 17中的元数据空间</li>
<li>类加载数量</li>
<li>线程数：实时查看线程创建和销毁</li>
</ul>
<h4 data-id="heading-15">Threads 线程标签页（最重要）</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1699c27464294f99a8bb34afb4a4f9b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=mLfXCfKS5DvE1r%2FGGvLkZ5DP63k%3D" alt="" loading="lazy"/></p>
<p><strong>界面说明</strong></p>
<ul>
<li>实时查看所有线程状态</li>
<li>颜色标识：
<ul>
<li>绿色：运行中 (RUNNABLE)</li>
<li>黄色：等待 (WAITING, TIMED_WAITING)</li>
<li>红色：阻塞 (BLOCKED)</li>
</ul>
</li>
<li>可以生成线程转储（相当于jstack）</li>
</ul>
<p>这里可以查看线程的详细信息</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5160989cde5d47fba8efb560e49230d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=4H14DMYU5hWMakEHkoqetUP6j%2Bw%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>详细信息内容看到的就和我们上面执行的结果是一样的，需要的话可以复制下来保存到本地</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26d1e83fa78c470dab22974632f5f872~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767661477&amp;x-signature=OBSGNqymyP%2FLPrKSchxmus0AQIk%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h3 data-id="heading-16">3. 远程监控配置</h3>
<h4 data-id="heading-17">应用端配置</h4>
<p>启动Spring Boot时添加JMX参数：</p>
<pre><code class="hljs language-bash" lang="bash">java -Dcom.sun.management.jmxremote \
     -Dcom.sun.management.jmxremote.port=9090 \
     -Dcom.sun.management.jmxremote.ssl=<span class="hljs-literal">false</span> \
     -Dcom.sun.management.jmxremote.authenticate=<span class="hljs-literal">false</span> \
     -Dcom.sun.management.jmxremote.local.only=<span class="hljs-literal">false</span> \
     -Djava.rmi.server.hostname=你的服务器IP \
     -jar your-app.jar
</code></pre>
<h4 data-id="heading-18">VisualVM连接配置</h4>
<ol>
<li>右键"远程" → "添加远程主机"</li>
<li>输入主机名或IP地址</li>
<li>右键远程主机 → "添加JMX连接"</li>
<li>输入端口号(9090)</li>
</ol>
<p><strong>优点</strong>：图形界面，一目了然</p>
<h2 data-id="heading-19">四、问题排查案例</h2>
<h3 data-id="heading-20">案例1：应用变慢</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 生成线程快照</span>
jstack 36756 &gt; slow.txt

<span class="hljs-comment"># 2. 查看有没有BLOCKED线程</span>
grep <span class="hljs-string">"BLOCKED"</span> slow.txt

<span class="hljs-comment"># 3. 查看Tomcat线程在干什么</span>
grep -A 5 <span class="hljs-string">"http-nio"</span> slow.txt
</code></pre>
<h3 data-id="heading-21">案例2：内存占用高</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看线程总数是否异常</span>
grep <span class="hljs-string">'java.lang.Thread.State'</span> thread.txt | <span class="hljs-built_in">wc</span> -l
</code></pre>
<p>正常：30-100个线程
异常：超过500个线程</p>
<h3 data-id="heading-22">案例3：应用无响应</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 强制生成线程快照</span>
jstack -F 36756 &gt; stuck.txt

<span class="hljs-comment"># 查找死锁</span>
grep -i <span class="hljs-string">"deadlock"</span> stuck.txt
</code></pre>
<h2 data-id="heading-23">总结</h2>
<p>如果你在开发或测试阶段，想快速直观地了解线程状态，<code>VisualVM</code> 是最友好的选择。</p>
<p>如果你正在线上排查问题，又不方便改代码或重启服务，<code>jstack</code> 这类 JDK 自带命令就是你的急救包，轻量、不需要其它依赖。</p>
<p>而如果你已经部署了监控体系，那么 <code>SpringBoot Actuator</code> 不仅能告诉你线程数量，还能集成到 <code>Prometheus</code>、<code>Grafana</code> 等监控平台，实现自动化告警。</p>
<blockquote>
<p>本文首发于公众号：程序员刘大华，专注分享前后端开发的实战笔记。关注我，少走弯路，一起进步！</p>
</blockquote>
<h4 data-id="heading-24">📌往期精彩</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F184BGM_pdMFLc0ASrferwQ" target="_blank" title="https://mp.weixin.qq.com/s/184BGM_pdMFLc0ASrferwQ" ref="nofollow noopener noreferrer">《代码里全是 new 对象，真的很 Low 吗？我认真想了一晚》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fp0n2mN5RDDDaIWuHHVRUZQ" target="_blank" title="https://mp.weixin.qq.com/s/p0n2mN5RDDDaIWuHHVRUZQ" ref="nofollow noopener noreferrer">《Java 开发必看：什么时候用 for，什么时候用 Stream？》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX-MSa0CHwVW_qgPezbpMUA" target="_blank" title="https://mp.weixin.qq.com/s/X-MSa0CHwVW_qgPezbpMUA" ref="nofollow noopener noreferrer">《这 5 个冷门 HTML 标签，让我直接删了100 行 JS 代码》</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FT3ronvigepWew6dRC4uH2g" target="_blank" title="https://mp.weixin.qq.com/s/T3ronvigepWew6dRC4uH2g" ref="nofollow noopener noreferrer">《Vue 组件通信的 8 种最佳实践，你知道几种？》</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（12）什么是Hibernate的实体类？]]></title>    <link>https://juejin.cn/post/7589466706378588196</link>    <guid>https://juejin.cn/post/7589466706378588196</guid>    <pubDate>2025-12-30T11:51:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589466706378588196" data-draft-id="7589262021562187817" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（12）什么是Hibernate的实体类？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-30T11:51:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（12）什么是Hibernate的实体类？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T11:51:46.000Z" title="Tue Dec 30 2025 11:51:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的实体类（Entity Class）是与数据库表映射的Java类。每个实体类对应数据库中的一个表，类中的每个属性对应表中的一列。实体类使用Java持久化API (JPA)的注解或者Hibernate特有的注解来标注，定义类和表之间的映射关系。</p>
<h3 data-id="heading-0">主要特点</h3>
<ol>
<li><strong>类-表映射</strong>：实体类与数据库表的映射。</li>
<li><strong>属性-列映射</strong>：类的属性与表的列的映射。</li>
<li><strong>主键标识</strong>：使用注解标识主键。</li>
<li><strong>关系映射</strong>：支持一对一、一对多、多对一和多对多等关联关系。</li>
</ol>
<h3 data-id="heading-1">示例项目结构</h3>
<p>为了深入理解Hibernate的实体类，下面是一个完整的示例，包括如何配置Hibernate文件、定义实体类、以及简单的CRUD操作。</p>
<h4 data-id="heading-2">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">HibernateUtil 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-4">实体类 Student</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">import</span> javax.persistence.Entity;
<span class="hljs-keyword">import</span> javax.persistence.GeneratedValue;
<span class="hljs-keyword">import</span> javax.persistence.GenerationType;
<span class="hljs-keyword">import</span> javax.persistence.Id;

<span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h3 data-id="heading-5">使用实体类进行CRUD操作</h3>
<p>下面是一个示例，演示如何使用Hibernate的实体类进行CRUD操作。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateCRUDExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-comment">// 创建对象并保存到数据库</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
            session.save(student); <span class="hljs-comment">// 持久化对象</span>

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 读取对象</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            System.out.println(<span class="hljs-string">"Student: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());
        } <span class="hljs-keyword">catch</span> (Exception e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 更新对象</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (student != <span class="hljs-literal">null</span>) {
                student.setAge(<span class="hljs-number">21</span>);
                session.update(student); <span class="hljs-comment">// 更新对象</span>
            }

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 删除对象</span>
        <span class="hljs-keyword">try</span> {
            session = sessionFactory.openSession();
            transaction = session.beginTransaction();

            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
            <span class="hljs-keyword">if</span> (student != <span class="hljs-literal">null</span>) {
                session.delete(student); <span class="hljs-comment">// 删除对象</span>
            }

            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback();
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                session.close();
            }
        }

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-6">详细解释</h3>
<ol>
<li>
<p><strong>实体类定义</strong>：通过<code>@Entity</code>注解将类标识为Hibernate的实体类。<code>@Id</code>注解标识主键，<code>@GeneratedValue</code>注解指定主键生成策略。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Entity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-meta">@Id</span>
    <span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;
}
</code></pre>
</li>
<li>
<p><strong>创建并保存对象</strong>：使用<code>session.save(student)</code>方法将实体对象持久化到数据库中。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
session.save(student);
</code></pre>
</li>
<li>
<p><strong>读取对象</strong>：使用<code>session.get(Student.class, 1L)</code>方法从数据库中读取实体对象。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
</code></pre>
</li>
<li>
<p><strong>更新对象</strong>：先从数据库中读取对象，然后修改对象属性，最后使用<code>session.update(student)</code>方法同步修改到数据库。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
student.setAge(<span class="hljs-number">21</span>);
session.update(student);
</code></pre>
</li>
<li>
<p><strong>删除对象</strong>：先从数据库中读取对象，然后使用<code>session.delete(student)</code>方法删除对象。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> session.get(Student.class, <span class="hljs-number">1L</span>);
session.delete(student);
</code></pre>
</li>
</ol>
<h3 data-id="heading-7">事务管理</h3>
<p>在进行增删改操作时，需要开启事务，并在操作完成后提交事务。如果操作失败，则回滚事务以确保数据一致性。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> session.beginTransaction();
<span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 持久化操作</span>
    transaction.commit();
} <span class="hljs-keyword">catch</span> (Exception e) {
    <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
        transaction.rollback();
    }
    e.printStackTrace();
}
</code></pre>
<h3 data-id="heading-8">总结</h3>
<p>Hibernate的实体类是Java类与数据库表结构映射的核心。通过JPA注解，实体类定义了持久化对象的属性和行为，并与数据库表的结构紧密结合。通过Hibernate提供的API，可以方便地对实体类进行CRUD操作，实现数据的持久化管理。理解Hibernate的实体类及其使用方法，对于高效地管理数据库和实现数据持久化具有重要意义。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[无成本搭建 AI 画图神器！我以后再也不会手绘架构图了]]></title>    <link>https://juejin.cn/post/7589176150493233206</link>    <guid>https://juejin.cn/post/7589176150493233206</guid>    <pubDate>2025-12-30T01:29:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589176150493233206" data-draft-id="7589201772118605830" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="无成本搭建 AI 画图神器！我以后再也不会手绘架构图了"/> <meta itemprop="keywords" content="后端,Java"/> <meta itemprop="datePublished" content="2025-12-30T01:29:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员小富"/> <meta itemprop="url" content="https://juejin.cn/user/993614241734270"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            无成本搭建 AI 画图神器！我以后再也不会手绘架构图了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614241734270/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员小富
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T01:29:32.000Z" title="Tue Dec 30 2025 01:29:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>大家好，我是小富～</strong></p>
<p>这期我带大家无成本搭建一个超强的 AI 画图工具，没错就是<strong>无成本</strong>！</p>
<p>老粉丝都知道，我以前的文章中会出现很多还算精美的插图，这些图片大部分都是我用 draw.io 一点点抠出来的。</p>
<p>比如这样的分库分表示意图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75dd8fbc8e5e49b5b0d45b9480bb368c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=DbwE6gHxI3KgM%2FhRYq%2Bw6%2FcTisE%3D" alt="" loading="lazy"/></p>
<p>TCP的三次握手的流程图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d8e82465c324753b3529f50e65411b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=GUStuK%2FmN2ncB504NlW2lWkNPFs%3D" alt="" loading="lazy"/></p>
<p>还有这样的一致性hash原理图</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/311b6abc74cc41b68cdad8734c37f29a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=ZUnA73NI6LzGVmR8DVTMVusqwHc%3D" alt="" loading="lazy"/></p>
<p>现在AI越来越牛X，写文章都可以用AI来辅助，可是画图这事儿，还是得手动绘制。有时候为了画一个逻辑严密的架构图，画图可能就占了写文章一半以上的时间！</p>
<p>我个人还是比较喜欢 draw.io 那种清爽、专业的风格，但现在我用的 drawio 版本 AI 也使不上劲。所以我就在想，有没有一个AI + drawio 的结合体？我说需求，它出图，而且还能支持二次编辑？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f83bc22a1b614728ad6173c519990f4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=gu2gsVGfMNwhaQsVrZxYSRHimt4%3D" alt="" loading="lazy"/></p>
<p>在我摸鱼时候，居然让我在Github 扒到了 <strong>next-ai-draw-io</strong> 这个开源项目。</p>
<p>试用了一下，只能说，以前我那都是过的什么日子，显得好呆啊！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af9c821463454590a3ce1982221eea46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=SV%2FSubJwsda%2BCIQoy2pYUiFma7Q%3D" alt="" loading="lazy"/></p>
<p>废话不多说搞起，重点是不仅要用起来，还要无成本部署到线上。</p>
<h2 data-id="heading-0">next-ai-draw-io</h2>
<p>他是个纯前端的基于 Next.js 和 AI 模型的项目，使用非常简单，就像你使用其他的AI工具一样，编写 prompt 就能快速把文字描述，变成简约美观的流程图、序列图、思维导图。</p>
<p>而且生成的不是一张死图，是可以二次编辑微调的，这对程序员和架构师来说太重要了。</p>
<p>多模型支持也还算全吧，市面上常用的OpenAI、deepseek 基础都支持了。</p>
<p>现在很多技术文章里的图很多也是AI做的，所以我越来越觉得，单纯的写技术文章价值越来越低了，必须要弄一些AI也给不出你满意结果的东西。</p>
<h2 data-id="heading-1">上手使用</h2>
<h3 data-id="heading-2">改配置</h3>
<p>next-ai-draw-io 项目源码下载以后，只需要做一件事，复制文件 env.example 内容新建一个 .env.local 文件，主要是设置默认的大模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/149e45c2e2bd4acbb007395dbaccd65d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=B4vFJAZYiJP794g364hxxdQOBaY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">编译启动</h3>
<p>直接编译启动就行了</p>
<pre><code class="hljs language-shell" lang="shell">git clone https://github.com/DayuanJiang/next-ai-draw-io
cd next-ai-draw-io

npm install

cp env.example .env.local

npm run dev
</code></pre>
<p>更简单的可以直接 docker 启动，参数上设置要用的模型类型</p>
<pre><code class="hljs language-shell" lang="shell">docker run -d -p 3000:3000 \
  -e AI_PROVIDER=openai \
  -e AI_MODEL=gpt-4o \
  -e OPENAI_API_KEY=your_api_key \
  ghcr.io/dayuanjiang/next-ai-draw-io:latest
</code></pre>
<p>或者用一个环境文件</p>
<pre><code class="hljs language-shell" lang="shell">cp env.example .env

docker run -d -p 3000:3000 --env-file .env ghcr.io/dayuanjiang/next-ai-draw-io:latest
</code></pre>
<p>直接页面访问 <a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A3000" target="_blank" title="http://localhost:3000" ref="nofollow noopener noreferrer">http://localhost:3000</a> ，打开能看到了，可以选择修改模型配置。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/664c59d5118c4d5b80ec0c24dfafcccc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=iyIq66V%2FuItYQKzmBcBVIEFAWlE%3D" alt="" loading="lazy"/></p>
<p>我试了下手机上用效果也还行</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6e4379a525e4755b5d7ea9eee471719~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=l20auv3N7uHGMwjRSBotHGmErbo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">MCP</h3>
<p>它还提供了 MCP 服务，可以在大模型里直接配置调用，要不你让大模型给你画图，它只能提供 mermaid 格式，渲染不直观改起还来麻烦。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"drawio"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"@next-ai-drawio/mcp-server@latest"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-5">Vercel 免费部署</h2>
<p>官方推荐 Docker 部署，但还得买服务器，那不是我的风格。因为这是个 Next 项目，而 Vercel 它支持 Next 个人开发者免费托管部署，一分钱不花，服务器都不用买。</p>
<p>部署流程也非常简单，几步就搞定。</p>
<h3 data-id="heading-6">导入项目</h3>
<p>首先将 next-ai-draw-io Fork到你自己的GitHub里，GitHub地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDayuanJiang%2Fnext-ai-draw-io" target="_blank" title="https://github.com/DayuanJiang/next-ai-draw-io" ref="nofollow noopener noreferrer">github.com/DayuanJiang…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84e10b2b43fb4242aa37621f41730f94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=wIx9caMmdAO8M0j6SXEmJhV6kdg%3D" alt="" loading="lazy"/></p>
<p>登录 Vercel 官网 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fnew%25EF%25BC%258C%25E7%2594%25A8" target="_blank" title="https://vercel.com/new%EF%BC%8C%E7%94%A8" ref="nofollow noopener noreferrer">vercel.com/new，用</a> GitHub 登录并导入刚刚你 Fork 的 <code>next-ai-draw-io</code> 项目。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61ae466caa5444bc878c464cfc5015eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=db6byNBzl2iGQLc%2BpKu9jdWDtq0%3D" alt="" loading="lazy"/></p>
<p>配置环境变量，这里一定是 <strong>Hobby</strong>，只有个人开发者是免费的。</p>
<p>如果你不想在项目代码中设置密钥，可以在 Environment Variables 区域，需要填入 AI 的配置信息。比如用 deepseek 那就配置如下就行</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">AI_PROVIDER=deepseek</span> <span class="hljs-comment"># 用哪个服务商</span>
<span class="hljs-string">AI_MODEL=deepseek-chat</span> <span class="hljs-comment"># 用哪个模型</span>
<span class="hljs-string">DEEPSEEK_API_KEY=sk-22222</span> <span class="hljs-comment"># 密钥</span>
<span class="hljs-string">DEEPSEEK_BASE_URL=https://api.deepseek.com</span>
</code></pre>
<p>填好后，直接点击 Deploy。大概等待 1-2 分钟，Vercel 提供了 <code>xxx.vercel.app</code> 格式的域名，可以直接访问。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9b8a95824e44dfab047b08f5185b468~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=Bes3BbxMHJncY%2FOFe47ZCvZADwk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">自定义域名</h3>
<p>如果你自己有域名也可以直接指向过来，Vercel 的地址是 76.76.21.21，然后在已经部署的项目上 setting -&gt; domain -&gt; add domain 就可以了，直接傻瓜式操作。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97620f847450470cac806cac5dc31b70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5a-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767662972&amp;x-signature=JpvFefwwhRqVK2ijHOP6r9u7vCA%3D" alt="" loading="lazy"/></p>
<p>这是我自己搭建的地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdrawio.xiaofucode.com%2Fzh%25EF%25BC%258C%25E6%2584%259F%25E5%2585%25B4%25E8%25B6%25A3%25E5%258F%25AF%25E4%25BB%25A5%25E7%258E%25A9%25E4%25B8%2580%25E4%25B8%258B%25EF%25BC%258C%25E5%25A5%25BD%25E5%25A5%25BD%25E7%2594%25A8%25E6%25B2%25A1%25E6%259C%2589%25E5%25A4%259A%25E5%25B0%2591%25E9%2592%25B1%25E7%259A%2584%25EF%25BC%2581" target="_blank" title="https://drawio.xiaofucode.com/zh%EF%BC%8C%E6%84%9F%E5%85%B4%E8%B6%A3%E5%8F%AF%E4%BB%A5%E7%8E%A9%E4%B8%80%E4%B8%8B%EF%BC%8C%E5%A5%BD%E5%A5%BD%E7%94%A8%E6%B2%A1%E6%9C%89%E5%A4%9A%E5%B0%91%E9%92%B1%E7%9A%84%EF%BC%81" ref="nofollow noopener noreferrer">drawio.xiaofucode.com/zh，感兴趣可以玩一下…</a></p>
<h2 data-id="heading-8">总结</h2>
<p>以前手搓一个复杂的业务架构图，光是拖拽对齐就要半小时。现在底稿由 AI 生成，我只需要修修补补确实快了很多。有时候脑子卡壳，不知道流程哪里漏了，能帮我查漏补缺。</p>
<p>缺点就是审美一般，AI 直接生成的配色和布局比较直男，所以prompt 多给他提要求就好了。复杂逻辑不够准，特别复杂的超大系统图，连线会乱飞，还是要人调整的。</p>
<p>总的来说，这是一个 80 分的辅助工具，对于我这种写文章、写文档的人来说，绝对是神器，可以省掉很多重复劳动。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxNTM4NzAyNg%3D%3D%26mid%3D2247499835%26idx%3D1%26sn%3Da202a41010813cd6e7496ef796723735%26chksm%3D9b8650c6acf1d9d0002189ed373170a770701fedaaaf2939a6eb041c58f2bbc749020aab728f%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxNTM4NzAyNg==&amp;mid=2247499835&amp;idx=1&amp;sn=a202a41010813cd6e7496ef796723735&amp;chksm=9b8650c6acf1d9d0002189ed373170a770701fedaaaf2939a6eb041c58f2bbc749020aab728f#rd" ref="nofollow noopener noreferrer">PS：这里送题主和大家一份计算机书籍资源包，基本上是我这些年学习和工作中看过的书籍，本身我是做后端的，像Java、数据结构、操作系统、JVM、SQL调优、面试题、职业规划看的会多花一些），点击下边链接直接获取：</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flink源码阅读：双流操作]]></title>    <link>https://juejin.cn/post/7589477341765664814</link>    <guid>https://juejin.cn/post/7589477341765664814</guid>    <pubDate>2025-12-30T12:14:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589477341765664814" data-draft-id="7589325011544768550" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flink源码阅读：双流操作"/> <meta itemprop="keywords" content="Flink,大数据"/> <meta itemprop="datePublished" content="2025-12-30T12:14:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="面向Google编程"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flink源码阅读：双流操作
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    面向Google编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T12:14:33.000Z" title="Tue Dec 30 2025 12:14:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天来梳理一下 Flink 双流操作相关的源码。</p>
<h3 data-id="heading-0">写在前面</h3>
<p>通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fjackeyzhe.github.io%2F2025%2F07%2F19%2FFlink%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0%25EF%25BC%259A%25E5%25A4%259A%25E6%25B5%2581join%2F" target="_blank" title="https://jackeyzhe.github.io/2025/07/19/Flink%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E5%A4%9A%E6%B5%81join/" ref="nofollow noopener noreferrer">Flink学习笔记：多流 Join</a>一文的介绍，我们知道 Flink 有三种数据关联的方式，分别是 Window Join、Interval Join 和 CoGroup。下面我们分别看下这三种关联方式的源码实现。</p>
<h3 data-id="heading-1">Window Join</h3>
<p>我们先回顾一下 window join 的使用方法。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">DataStream&lt;Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt; result = source1.<span class="hljs-keyword">join</span>(source2)
        .<span class="hljs-keyword">where</span>(record -&gt; record.f0)
        .equalTo(record -&gt; record.f0)
        .window(TumblingEventTimeWindows.<span class="hljs-keyword">of</span>(Time.seconds(<span class="hljs-number">2L</span>)))
        .apply(<span class="hljs-built_in">new</span> JoinFunction&lt;Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt;() {
            @Override
            <span class="hljs-keyword">public</span> Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; <span class="hljs-keyword">join</span>(Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; record1, Tuple2&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; record2) throws Exception {
                <span class="hljs-keyword">return</span> Tuple2.<span class="hljs-keyword">of</span>(record1.f0, record1.f1);
            }
        });
</code></pre>
<p>上述调用链路类的流转如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6d0539edba546b89aa521409a906a60~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767701672&amp;x-signature=VLzajX1b5lw864yFEqBbbXPs3qk%3D" alt="windowjoin" loading="lazy"/></p>
<p>在 WithWindow 的 apply 方法中，是构建了一个 coGroupedWindowedStream，然后调用它的 apply 方法。</p>
<pre><code class="hljs language-scss" lang="scss">public &lt;T&gt; SingleOutputStreamOperator&lt;T&gt; <span class="hljs-built_in">apply</span>(
        JoinFunction&lt;T1, T2, T&gt; function, TypeInformation&lt;T&gt; resultType) {
    <span class="hljs-comment">// clean the closure</span>
    function = input1<span class="hljs-selector-class">.getExecutionEnvironment</span>()<span class="hljs-selector-class">.clean</span>(function);

    coGroupedWindowedStream =
            input1<span class="hljs-selector-class">.coGroup</span>(input2)
                    <span class="hljs-selector-class">.where</span>(keySelector1)
                    <span class="hljs-selector-class">.equalTo</span>(keySelector2)
                    <span class="hljs-selector-class">.window</span>(windowAssigner)
                    <span class="hljs-selector-class">.trigger</span>(trigger)
                    <span class="hljs-selector-class">.evictor</span>(evictor)
                    <span class="hljs-selector-class">.allowedLateness</span>(allowedLateness);

    return coGroupedWindowedStream<span class="hljs-selector-class">.apply</span>(new JoinCoGroupFunction&lt;&gt;(function), resultType);
}
</code></pre>
<p>这里可以看出，Window Join 的底层是转换成 coGroup 进行处理的。</p>
<p>在 JoinCoGroupFunction 中，coGroup 方法就是对两个流进行两层遍历，然后将其应用到我们自定义的 JoinFunction 上。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">JoinCoGroupFunction</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T</span>&gt;
        <span class="hljs-title">extends</span> <span class="hljs-title">WrappingFunction</span>&lt;<span class="hljs-title">JoinFunction</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T</span>&gt;&gt;
        <span class="hljs-title">implements</span> <span class="hljs-title">CoGroupFunction</span>&lt;<span class="hljs-title">T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T</span>&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-built_in">long</span> serialVersionUID = <span class="hljs-number">1L</span>;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">JoinCoGroupFunction</span>(<span class="hljs-params">JoinFunction&lt;T1, T2, T&gt; wrappedFunction</span>)</span> {
        super(wrappedFunction);
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">coGroup</span>(<span class="hljs-params">Iterable&lt;T1&gt; first, Iterable&lt;T2&gt; second, Collector&lt;T&gt; <span class="hljs-keyword">out</span></span>)
            throws Exception</span> {
        <span class="hljs-keyword">for</span> (T1 val1 : first) {
            <span class="hljs-keyword">for</span> (T2 val2 : second) {
                <span class="hljs-keyword">out</span>.collect(wrappedFunction.<span class="hljs-keyword">join</span>(val1, val2));
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-2">CoGroup</h3>
<p>CoGroup 的整体用法和流程与 Join 都类似，我们就不逐个介绍了。我们直接来看 apply 方法。</p>
<pre><code class="hljs language-scss" lang="scss">public &lt;T&gt; SingleOutputStreamOperator&lt;T&gt; <span class="hljs-built_in">apply</span>(
        CoGroupFunction&lt;T1, T2, T&gt; function, TypeInformation&lt;T&gt; resultType) {
    <span class="hljs-comment">// clean the closure</span>
    function = input1<span class="hljs-selector-class">.getExecutionEnvironment</span>()<span class="hljs-selector-class">.clean</span>(function);

    UnionTypeInfo&lt;T1, T2&gt; unionType =
            new UnionTypeInfo&lt;&gt;(input1.getType(), input2<span class="hljs-selector-class">.getType</span>());
    UnionKeySelector&lt;T1, T2, KEY&gt; unionKeySelector =
            new UnionKeySelector&lt;&gt;(keySelector1, keySelector2);

    SingleOutputStreamOperator&lt;TaggedUnion&lt;T1, T2&gt;&gt; taggedInput1 =
            input1<span class="hljs-selector-class">.map</span>(new Input1Tagger&lt;T1, T2&gt;());
    taggedInput1<span class="hljs-selector-class">.getTransformation</span>()<span class="hljs-selector-class">.setParallelism</span>(input1.getParallelism(), false);
    taggedInput1<span class="hljs-selector-class">.returns</span>(unionType);

    SingleOutputStreamOperator&lt;TaggedUnion&lt;T1, T2&gt;&gt; taggedInput2 =
            input2<span class="hljs-selector-class">.map</span>(new Input2Tagger&lt;T1, T2&gt;());
    taggedInput2<span class="hljs-selector-class">.getTransformation</span>()<span class="hljs-selector-class">.setParallelism</span>(input2.getParallelism(), false);
    taggedInput2<span class="hljs-selector-class">.returns</span>(unionType);

    DataStream&lt;TaggedUnion&lt;T1, T2&gt;&gt; unionStream = taggedInput1<span class="hljs-selector-class">.union</span>(taggedInput2);

    <span class="hljs-comment">// we explicitly create the keyed stream to manually pass the key type information in</span>
    windowedStream =
            new KeyedStream&lt;TaggedUnion&lt;T1, T2&gt;, KEY&gt;(
                            unionStream, unionKeySelector, keyType)
                    <span class="hljs-selector-class">.window</span>(windowAssigner);

    if (trigger != null) {
        windowedStream<span class="hljs-selector-class">.trigger</span>(trigger);
    }
    if (evictor != null) {
        windowedStream<span class="hljs-selector-class">.evictor</span>(evictor);
    }
    if (allowedLateness != null) {
        windowedStream<span class="hljs-selector-class">.allowedLateness</span>(allowedLateness);
    }

    return windowedStream<span class="hljs-selector-class">.apply</span>(
            new CoGroupWindowFunction&lt;T1, T2, T, KEY, W&gt;(function), resultType);
}
</code></pre>
<p>在 apply 方法中，先把两个流进行合并，然后创建了 windowedStream，并把窗口相关的属性设置好，最后是调用 windowedStream 的 apply 方法。</p>
<p>在调用 <code>windowedStream.apply</code> 方法时，又将 function 包装成了 CoGroupWindowFunction。</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">private</span> static <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CoGroupWindowFunction&lt;T1</span>, <span class="hljs-title">T2</span>, <span class="hljs-title">T</span>, <span class="hljs-title">KEY</span>, <span class="hljs-title">W</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Window&gt;</span></span>
        <span class="hljs-keyword">extends</span> <span class="hljs-type">WrappingFunction</span>&lt;<span class="hljs-type">CoGroupFunction</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>, <span class="hljs-type">T</span>&gt;&gt;
        implements <span class="hljs-type">WindowFunction</span>&lt;<span class="hljs-type">TaggedUnion</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>&gt;, <span class="hljs-type">T</span>, <span class="hljs-type">KEY</span>, <span class="hljs-type">W</span>&gt; {

    <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> long serialVersionUID = <span class="hljs-number">1</span>L;

    public <span class="hljs-type">CoGroupWindowFunction</span>(<span class="hljs-type">CoGroupFunction</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>, <span class="hljs-type">T</span>&gt; userFunction) {
        <span class="hljs-keyword">super</span>(userFunction);
    }

    <span class="hljs-meta">@Override</span>
    public void apply(<span class="hljs-type">KEY</span> key, <span class="hljs-type">W</span> window, <span class="hljs-type">Iterable</span>&lt;<span class="hljs-type">TaggedUnion</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>&gt;&gt; values, <span class="hljs-type">Collector</span>&lt;<span class="hljs-type">T</span>&gt; out)
            <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> {

        <span class="hljs-type">List</span>&lt;<span class="hljs-type">T1</span>&gt; oneValues = <span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;();
        <span class="hljs-type">List</span>&lt;<span class="hljs-type">T2</span>&gt; twoValues = <span class="hljs-keyword">new</span> <span class="hljs-type">ArrayList</span>&lt;&gt;();

        <span class="hljs-keyword">for</span> (<span class="hljs-type">TaggedUnion</span>&lt;<span class="hljs-type">T1</span>, <span class="hljs-type">T2</span>&gt; <span class="hljs-keyword">val</span> : values) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">val</span>.isOne()) {
                oneValues.add(<span class="hljs-keyword">val</span>.getOne());
            } <span class="hljs-keyword">else</span> {
                twoValues.add(<span class="hljs-keyword">val</span>.getTwo());
            }
        }
        wrappedFunction.coGroup(oneValues, twoValues, out);
    }
}
</code></pre>
<p>在 CoGroupWindowFunction 的 apply 方法中是将主键为 key 的流分开两个流，再去调用 JoinCoGroupFunction 的 coGroup 方法。这里的 values 都是相同的 key，原因是在 window 中维护的 windowState，它内部是一个 stateTable，窗口的 namespace 和 key 共同维护一个 state，当窗口触发时，就会对相同 key 的数据调用 apply 方法。</p>
<h3 data-id="heading-3">Interval Join</h3>
<p>梳理完了 Window Join 和 CoGroup 之后，我们再接着看 Interval Join。还是先来回顾一下用法。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-type">DataStream</span>&lt;<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt; intervalJoinResult <span class="hljs-operator">=</span> source1.keyBy(record -&gt; record.f0)
        .intervalJoin(source2.keyBy(record -&gt; record.f0))
        .between(<span class="hljs-type">Time</span>.seconds(<span class="hljs-operator">-</span><span class="hljs-number">2</span>), <span class="hljs-type">Time</span>.seconds(<span class="hljs-number">2</span>))
        .process(new <span class="hljs-type">ProcessJoinFunction</span>&lt;<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> void processElement(<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; record1, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt; record2, <span class="hljs-type">ProcessJoinFunction</span>&lt;<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;, <span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt;.<span class="hljs-type">Context</span> context, <span class="hljs-type">Collector</span>&lt;<span class="hljs-type">Tuple2</span>&lt;<span class="hljs-type">String</span>, <span class="hljs-type">Double</span>&gt;&gt; out) <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> {
                out.collect(<span class="hljs-type">Tuple2</span>.of(record1.f0, record1.f1 <span class="hljs-operator">+</span> record2.f1));
            }
        });
</code></pre>
<p>通过用法可以看出，interval join 传入的对象是两个 KeyedStream，接着使用 between 方法定义 interval join 的上下边界，最后调用 process 方法执行计算逻辑。</p>
<p>在调用过程中，类型的转换如下图。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33909c4a743343abb3df807911a74101~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767701672&amp;x-signature=m4nBk%2BzddJx%2FAJxqMv0E9SroyiY%3D" alt="intervaljoin" loading="lazy"/></p>
<p>我们主要关注 process 的逻辑。</p>
<pre><code class="hljs language-scss" lang="scss">public &lt;OUT&gt; SingleOutputStreamOperator&lt;OUT&gt; <span class="hljs-built_in">process</span>(
        ProcessJoinFunction&lt;IN1, IN2, OUT&gt; processJoinFunction,
        TypeInformation&lt;OUT&gt; outputType) {
    Preconditions<span class="hljs-selector-class">.checkNotNull</span>(processJoinFunction);
    Preconditions<span class="hljs-selector-class">.checkNotNull</span>(outputType);

    final ProcessJoinFunction&lt;IN1, IN2, OUT&gt; cleanedUdf =
            <span class="hljs-attribute">left</span><span class="hljs-selector-class">.getExecutionEnvironment</span>()<span class="hljs-selector-class">.clean</span>(processJoinFunction);

    if (isEnableAsyncState) {
        final AsyncIntervalJoinOperator&lt;KEY, IN1, IN2, OUT&gt; operator =
                new AsyncIntervalJoinOperator&lt;&gt;(
                        lowerBound,
                        upperBound,
                        lowerBoundInclusive,
                        upperBoundInclusive,
                        leftLateDataOutputTag,
                        rightLateDataOutputTag,
                        left.getType()
                                <span class="hljs-selector-class">.createSerializer</span>(
                                        left.getExecutionConfig()<span class="hljs-selector-class">.getSerializerConfig</span>()),
                        <span class="hljs-attribute">right</span><span class="hljs-selector-class">.getType</span>()
                                <span class="hljs-selector-class">.createSerializer</span>(
                                        right.getExecutionConfig()<span class="hljs-selector-class">.getSerializerConfig</span>()),
                        cleanedUdf);

        return <span class="hljs-attribute">left</span><span class="hljs-selector-class">.connect</span>(right)
                <span class="hljs-selector-class">.keyBy</span>(keySelector1, keySelector2)
                <span class="hljs-selector-class">.transform</span>("Interval Join [Async]", outputType, operator);
    } else {
        final IntervalJoinOperator&lt;KEY, IN1, IN2, OUT&gt; operator =
                new IntervalJoinOperator&lt;&gt;(
                        lowerBound,
                        upperBound,
                        lowerBoundInclusive,
                        upperBoundInclusive,
                        leftLateDataOutputTag,
                        rightLateDataOutputTag,
                        left.getType()
                                <span class="hljs-selector-class">.createSerializer</span>(
                                        left.getExecutionConfig()<span class="hljs-selector-class">.getSerializerConfig</span>()),
                        <span class="hljs-attribute">right</span><span class="hljs-selector-class">.getType</span>()
                                <span class="hljs-selector-class">.createSerializer</span>(
                                        right.getExecutionConfig()<span class="hljs-selector-class">.getSerializerConfig</span>()),
                        cleanedUdf);

        return <span class="hljs-attribute">left</span><span class="hljs-selector-class">.connect</span>(right)
                <span class="hljs-selector-class">.keyBy</span>(keySelector1, keySelector2)
                <span class="hljs-selector-class">.transform</span>("Interval Join", outputType, operator);
    }
}
</code></pre>
<p>Interval join 是基于 ConnectedStream 实现的，ConnectedStream 提供了更加通用的双流操作，它将两个流组合成一个 TwoInputTransformation，然后加入执行图中。</p>
<p>具体的 Operator 是 IntervalJoinOperator 或 AsyncIntervalJoinOperator，它们都是 TwoInputStreamOperator 的实现类，提供 <code>processElement1</code> 和 <code>processElement2</code> 两个方法分别处理两个输入源的数据，最终都调用的是 processElement。</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">private</span> <span class="hljs-operator">&lt;</span><span class="hljs-type">THIS</span>, <span class="hljs-type">OTHER</span><span class="hljs-operator">&gt;</span> void processElement(
        <span class="hljs-keyword">final</span> <span class="hljs-type">StreamRecord</span>&lt;<span class="hljs-type">THIS</span>&gt; record,
        <span class="hljs-keyword">final</span> <span class="hljs-type">MapState</span>&lt;<span class="hljs-type">Long</span>, <span class="hljs-type">List</span>&lt;<span class="hljs-type">IntervalJoinOperator</span>.<span class="hljs-type">BufferEntry</span>&lt;<span class="hljs-type">THIS</span>&gt;&gt;&gt; ourBuffer,
        <span class="hljs-keyword">final</span> <span class="hljs-type">MapState</span>&lt;<span class="hljs-type">Long</span>, <span class="hljs-type">List</span>&lt;<span class="hljs-type">IntervalJoinOperator</span>.<span class="hljs-type">BufferEntry</span>&lt;<span class="hljs-type">OTHER</span>&gt;&gt;&gt; otherBuffer,
        <span class="hljs-keyword">final</span> long relativeLowerBound,
        <span class="hljs-keyword">final</span> long relativeUpperBound,
        <span class="hljs-keyword">final</span> boolean isLeft)
        <span class="hljs-keyword">throws</span> <span class="hljs-type">Exception</span> {

    <span class="hljs-keyword">final</span> <span class="hljs-type">THIS</span> ourValue <span class="hljs-operator">=</span> record.getValue();
    <span class="hljs-keyword">final</span> long ourTimestamp <span class="hljs-operator">=</span> record.getTimestamp();

    <span class="hljs-keyword">if</span> (ourTimestamp <span class="hljs-operator">==</span> <span class="hljs-type">Long</span>.<span class="hljs-type">MIN_VALUE</span>) {
        <span class="hljs-keyword">throw</span> new <span class="hljs-type">FlinkException</span>(
                <span class="hljs-string">"Long.MIN_VALUE timestamp: Elements used in "</span>
                        <span class="hljs-operator">+</span> <span class="hljs-string">"interval stream joins need to have timestamps meaningful timestamps."</span>);
    }

    <span class="hljs-keyword">if</span> (isLate(ourTimestamp)) {
        sideOutput(ourValue, ourTimestamp, isLeft);
        <span class="hljs-keyword">return</span>;
    }

    addToBuffer(ourBuffer, ourValue, ourTimestamp);

    <span class="hljs-keyword">for</span> (<span class="hljs-type">Map</span>.<span class="hljs-type">Entry</span>&lt;<span class="hljs-type">Long</span>, <span class="hljs-type">List</span>&lt;<span class="hljs-type">BufferEntry</span>&lt;<span class="hljs-type">OTHER</span>&gt;&gt;&gt; bucket : otherBuffer.entries()) {
        <span class="hljs-keyword">final</span> long timestamp <span class="hljs-operator">=</span> bucket.getKey();

        <span class="hljs-keyword">if</span> (timestamp <span class="hljs-operator">&lt;</span> ourTimestamp <span class="hljs-operator">+</span> relativeLowerBound
                <span class="hljs-operator">||</span> timestamp <span class="hljs-operator">&gt;</span> ourTimestamp <span class="hljs-operator">+</span> relativeUpperBound) {
            <span class="hljs-keyword">continue</span>;
        }

        <span class="hljs-keyword">for</span> (<span class="hljs-type">BufferEntry</span>&lt;<span class="hljs-type">OTHER</span>&gt; entry : bucket.getValue()) {
            <span class="hljs-keyword">if</span> (isLeft) {
                collect((<span class="hljs-type">T1</span>) ourValue, (<span class="hljs-type">T2</span>) entry.element, ourTimestamp, timestamp);
            } <span class="hljs-keyword">else</span> {
                collect((<span class="hljs-type">T1</span>) entry.element, (<span class="hljs-type">T2</span>) ourValue, timestamp, ourTimestamp);
            }
        }
    }

    long cleanupTime <span class="hljs-operator">=</span>
            (relativeUpperBound <span class="hljs-operator">&gt;</span> 0L) <span class="hljs-operator">?</span> ourTimestamp <span class="hljs-operator">+</span> relativeUpperBound : ourTimestamp;
    <span class="hljs-keyword">if</span> (isLeft) {
        internalTimerService.registerEventTimeTimer(<span class="hljs-type">CLEANUP_NAMESPACE_LEFT</span>, cleanupTime);
    } <span class="hljs-keyword">else</span> {
        internalTimerService.registerEventTimeTimer(<span class="hljs-type">CLEANUP_NAMESPACE_RIGHT</span>, cleanupTime);
    }
}
</code></pre>
<p>在 IntervalJoinOperator 中维护了两个 MapState，每个消息进来的时候，都会加入到 MapState 中，key 是 timestamp，value 是一个元素的列表。然后遍历另一个 MapState，得到符合条件的数据。最后是为每条数据注册一个定时器，当时间超过有效范围后，会从 MapState 中清除这个时间戳的数据。</p>
<h3 data-id="heading-4">总结</h3>
<p>本文我们梳理了 Flink 的三种双流操作的源码，我们了解到 Window Join 底层是通过 CoGroup 实现的。CoGroup 本身是将两个流合并成 WindowedStream 并依赖于 WindowState 进行数据 join。最后 Interval Join 是通过 ConnectedStreams 实现的，内部的 IntervalJoinOperator 会维护两个 MapState，通过 MapState 进行数据关联。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 编程：重构工作流的思维与实践]]></title>    <link>https://juejin.cn/post/7589214068093779987</link>    <guid>https://juejin.cn/post/7589214068093779987</guid>    <pubDate>2025-12-30T06:47:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589214068093779987" data-draft-id="7589214068093566995" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 编程：重构工作流的思维与实践"/> <meta itemprop="keywords" content="后端,AI编程,Trae"/> <meta itemprop="datePublished" content="2025-12-30T06:47:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="架构精进之路"/> <meta itemprop="url" content="https://juejin.cn/user/3746752294032328"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 编程：重构工作流的思维与实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3746752294032328/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    架构精进之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T06:47:03.000Z" title="Tue Dec 30 2025 06:47:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong><code>本文系作者 [架构精进之路] 原创，著作权归作者所有，未经授权禁止任何形式的转载、抄袭或盗用，违者必究。</code></strong></p>
<p>弹指间，岁序更迭，又至年末，这一年我们不断奋斗，不断忙碌，真的好似一瞬间，就来到了 2025 年底的时间。</p>
<p>2025 年，是 AI 技术发展突飞猛进的一年。曾经只存在于想象中的智能助手，如今能精准读懂需求、高效处理任务；曾经依赖人工的繁琐工作，如今在 AI 的加持下变得简单快捷；就连创作、设计这些充满人文色彩的领域，也多了一份智能工具的助力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/650ef7b9ba3d47d69770701db69b2f55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=KBYsxjXx%2BzNzwBpXGEL7%2FPY%2Bg8o%3D" alt="" loading="lazy"/></p>
<p>这一年，AI 不再是遥远的科技概念，而是悄然融入了工作与生活的角角落落。正好跟随「掘金 · 年终技术征文」活动，一起总结记录下AI 编程的心得体会。</p>
<h2 data-id="heading-0">一、Vibe Coding 到底是个啥？</h2>
<p>今年 AI 界有一个很潮、很酷的新词儿：“<strong>Vibe Coding</strong>”，乍一听有点懵，到底啥是“Vibe Coding”？写代码还要讲究个氛围感吗？</p>
<p>今天我就以一个码农的视角，聊聊对 “Vibe Coding” 的理解。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b785914e0214b6aa3b3c114472724a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=uWAdQBVoGe8N2IVxoEobAv%2FclRU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">1.1 什么是 Vibe Coding？</h3>
<p>Vibe 本来就是“氛围”、“感觉”的意思，所以直译过来就是“氛围编程”或“沉浸式编程”。但这里的“沉浸”不仅仅是让你沉浸在一个有仪式感的编程环境里，更重要的是它颠覆了我们以往写代码的方式。</p>
<p><strong>我直接上核心观点：就是从「计算机语言描述工作流程」到「自然语言描述工作流程」的转变。</strong></p>
<p>打破编程门槛：AI 让每个人都能"编程"</p>
<p>Vibe Coding 压根就不关心你代码具体怎么实现的，核心关注点是代码生成的结果对不对。至于实现逻辑、底层细节这些繁琐的活，都交给 AI 去搞定。我只需要盯着效果，觉得哪里不对、哪里有问题，就直接改 Prompt，重新提需求，AI 会自动帮你调整和优化，直到最后结果完全符合你的预期为止。</p>
<p>整个过程你都沉浸在 “<strong>说想法—&gt;看结果—&gt;继续调整—&gt;再出结果</strong>” 的循环里，效率高得飞起。</p>
<p>我画了个大概流程图，执行流程如下所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1221382d5444ce3a2ec8e42121b64d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=eN%2BXnXPHkHn7ufQrDSHFTb5kCRc%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>举个生活化的例子：就像点外卖一样，你只管选菜，AI 帮你做。菜端上来不合口味？你直接点评它！AI 厨子立刻再改，直到喂到你满意。</p>
</blockquote>
<h3 data-id="heading-2">1.2 核心提炼：工作流思维</h3>
<p>传统编程 vs Vibe Coding：开发模式的核心变革</p>
<p><strong>1、传统编程：以技术实现为核心</strong></p>
<p>传统编程围绕<strong>程序、程序员、软件工程</strong>三大支柱展开，具有显著特点：</p>
<ul>
<li>
<p>入门门槛高，学习周期长</p>
</li>
<li>
<p>需系统掌握编程语言语法、开发框架、调试技巧等技术细节</p>
</li>
<li>
<p>核心要求是程序员明确知道 “怎么做”，通过手动编码实现功能</p>
</li>
</ul>
<p><strong>2、Vibe Coding：以需求描述为核心</strong></p>
<p>Vibe Coding 是一种依托 AI 能力的新型开发模式，核心逻辑高度聚焦：</p>
<ul>
<li>
<p>用自然语言精准描述业务需求与工作流</p>
</li>
<li>
<p>由 AI 自动完成代码生成、任务执行与细节处理</p>
</li>
<li>
<p>核心要求是使用者清晰定义 “做什么”，无需纠结技术实现路径</p>
</li>
</ul>
<p><strong>3、Vibe Coding 核心特征总结</strong></p>
<ol>
<li>
<p><strong>本质是 “用自然语言定义工作流”</strong></p>
<ol>
<li>
<p>摆脱编程语言语法、框架的束缚，无需专业编程基础</p>
</li>
<li>
<p>核心门槛在于<strong>对业务流程的深度理解</strong></p>
</li>
<li>
<p>重心从 “技术实现” 转向 “需求定义”</p>
</li>
</ol>
</li>
<li>
<p><strong>开发模式升级：从 “人做” 到 “人想，AI 做”</strong></p>
<ol>
<li>
<p><strong>人</strong>的角色：需求提出者、流程设计者、结果审核者</p>
</li>
<li>
<p><strong>AI</strong>的角色：代码生成器、任务执行者、细节处理者</p>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd29a4a418d747989e7c76af1eef97c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=SdwjHN78cWYRszsK0p1o5zWGC5U%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p><strong>适用场景清晰划分</strong></p>
<ol>
<li>
<p><strong>高度适配场景</strong>：MVP 产品快速验证、内部工具开发（数据处理、文件整理等）、创意方案原型测试</p>
</li>
<li>
<p><strong>暂不适用场景</strong>：复杂业务逻辑开发（需人工决策与逻辑校验）、性能关键路径构建（需深度人工优化）</p>
</li>
</ol>
</li>
</ol>
<h2 data-id="heading-3">二、程序员视角下的 Vibe Coding</h2>
<h3 data-id="heading-4">2.1 利用 Trea 进行 Vibe Coding 的应用实践</h3>
<blockquote>
<p>Trae.ai 是个 AI 编程 IDE，字节跳动的产品，目前是免费使用，写代码、查文档、加接口都可以，和它对话就能改功能、查问题，事半功倍。</p>
</blockquote>
<p><strong>1、生成提示词</strong></p>
<p>写不好提示词，没关系，这一步AI可以帮我们很好的搞定！</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmovie.douban.com%2Ftop250" target="_blank" title="https://movie.douban.com/top250" ref="nofollow noopener noreferrer">movie.douban.com/top250</a> 我希望获取这个网站的数据，帮我生成一份爬虫项目的提示词</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41f764689d14469b9348f88006982206~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=5EY2%2FlYUyTinzndGnWmcd39bthI%3D" alt="" loading="lazy"/></p>
<p><strong>2、生成项目代码并执行</strong></p>
<p>有了提示词，可以参考它执行，生成我们需要的项目代码了。</p>
<p>执行过程中，可能会出现如下需要我们确认执行的步骤，一般确认<strong>运行</strong>即可。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7967a1153233424c81d7ea371a5a3f11~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=7pGXdF6ORK7BkFRrdzEwjVXxRyw%3D" alt="" loading="lazy"/></p>
<p>最终生成一份可执行代码，并可执行并验证，整体效率非常高效！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1f1ffc5e18f4cae9eedd658cf84aeb5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=DTJv2DsErTp%2BXPubsb1nuu7A2jo%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/47c8ac228fef4ae8b90eb9f90c3f7f2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=rmY3e7DeRVAUOZ%2B73t1NuDG%2Bweo%3D" alt="" loading="lazy"/></p>
<p><strong>3、生成可渲染展示页面</strong></p>
<p>为了更直观的查看数据，生成可运行的 Web 服务来渲染这些数据。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8afc437a3c2f4030b2d01a4363ebbdc7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=9Reh9nUUFZO5jIQmHs6dVCkuU14%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c754483f27ef4aeea44fdff4d73d38c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=%2Fyob%2BO1PFaH45%2FrSkFJxWnj6VSU%3D" alt="" loading="lazy"/></p>
<p>如果需要更好的查看体验，可以继续调试添加分页能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/289ba0383f8a4c438d0e70e7cbc55323~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=nu327WLO4IYKfu7PaWaHSvlHXNE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e44cd3ccad4a4e688cb1c59cf4a5a892~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=Cv9Z7G9RKAV77D30JcdlvBXkAVI%3D" alt="" loading="lazy"/></p>
<p>上述整体步骤非常高效，前后不过几分钟而已，Trea 堪称开发利器。</p>
<h3 data-id="heading-5">2.2 AI 编程的缺点与挑战</h3>
<p><strong>1、天生缺乏业务场景深度理解</strong></p>
<ul>
<li><strong>核心现象</strong></li>
</ul>
<p>AI 生成的代码，经常会陷入“技术正确，业务失真”的困境——语法合规、可编译运行，但完全不符合真实业务的约束条件与核心诉求。</p>
<ul>
<li><strong>典型案例：电影数据展示列表场景</strong></li>
</ul>
<p>AI 仅生成通用的电影数据列表展示代码，却忽略豆瓣Top250项目的核心业务规则：</p>
<ul>
<li>
<p>业务中需按“评分降序、上映时间筛选”双维度排序展示电影</p>
</li>
<li>
<p>需实现分页加载（避免一次性加载250条数据卡顿）、数据异常兜底（部分电影信息缺失时的友好展示）等核心逻辑</p>
</li>
</ul>
<p>最终结果是“代码看似专业，实则无法满足豆瓣Top250项目的核心展示需求与用户体验要求”。</p>
<ul>
<li><strong>解决思路</strong></li>
</ul>
<p>由人明确定义不可让步的业务规则与约束条件，为 AI 划定业务边界。</p>
<p><strong>2、对性能问题极度不敏感</strong></p>
<ul>
<li><strong>核心现象</strong></li>
</ul>
<p>AI 生成的方案逻辑无误，但工程实现成本极高；小数据量测试时表现正常，一旦上线面对真实流量便会瞬间“翻车”。</p>
<ul>
<li><strong>典型案例</strong></li>
</ul>
<p>案例一：列表数据加载性能崩塌</p>
<p>补充完“评分排序、上映时间筛选”逻辑后，AI 快速实现了数据展示功能，但方案存在致命缺陷：默认一次性加载全部250条电影数据，未做分页处理与图片懒加载优化，导致页面首次加载耗时超 8 秒，滚动时出现明显卡顿，移动端甚至直接白屏。</p>
<p>案例二：列表数据接口异常处理缺失</p>
<p>AI 给出的项目初版方案中，直接调用豆瓣公开接口获取数据，但未设计任何异常应对逻辑：当接口请求超时、返回数据格式异常或接口限流时，页面直接空白无提示，用户无法判断是网络问题还是服务问题，体验极差。</p>
<ul>
<li><strong>问题根源</strong></li>
</ul>
<p>AI 的优化目标是“推理逻辑正确性”，而非“系统长期运行的稳定性与成本可控性”，天然缺失工程化的性能考量。</p>
<ul>
<li><strong>解决思路</strong></li>
</ul>
<p>1. 人先主导分析：明确系统性能瓶颈所在（IO、CPU、内存、模型加载等）；</p>
<p>2. 再引导 AI 优化：针对性提出缓存方案、服务常驻化设计、预加载机制、资源池搭建等性能优化需求。</p>
<p><strong>3、异常与边界处理严重缺失</strong></p>
<ul>
<li><strong>核心现象</strong></li>
</ul>
<p>AI 生成的代码在“理想流程（Happy Path）”下表现完美，但缺乏对异常场景的应对能力，一旦出现意外情况便直接崩溃。</p>
<ul>
<li>
<p><strong>典型缺失的异常处理场景</strong></p>
<ul>
<li>
<p>豆瓣接口请求超时、返回数据格式异常及重试策略缺失；</p>
</li>
<li>
<p>电影封面图加载失败、部分字段（如导演、演员）缺失等数据异常的兼容处理；</p>
</li>
<li>
<p>豆瓣接口限流时的降级展示逻辑（如加载本地缓存数据）。</p>
</li>
</ul>
</li>
<li>
<p><strong>问题本质</strong></p>
</li>
</ul>
<p>AI 默认预设“理想运行环境”，但真实生产环境是“持续面临各类异常的复杂系统”，这种认知偏差导致其无法主动构建健壮的容错机制。</p>
<ul>
<li><strong>应对方式</strong></li>
</ul>
<p>由人主动补充完善容错体系：明确异常分级标准、制定服务降级策略、设计超时控制与熔断机制。</p>
<p><strong>核心总结：工程质量的高低，取决于你对“失败与异常”的预期深度。</strong></p>
<h2 data-id="heading-6">三、如何正确理解重构工作流</h2>
<p>个人对 [ vibecoding 加成下 ] 重构工作流的理解</p>
<blockquote>
<p>AI 不是来当主厨的，是为了让主厨不用天天切土豆</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e44064f08036433f862cb012695e0e52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=WbU10AQn2p7yEpxhrTFKKkjdmJU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">3.1 构思全自动化工作流</h3>
<p><strong>关键原则：摒弃“一步到位”的完美主义，先让“流程跑通”</strong></p>
<p><strong>核心目标</strong>：构建无需人工介入，即可完成从数据获取、处理到展示的全链路自动化流程</p>
<p><strong>项目案例（豆瓣Top250电影数据展示）</strong>：</p>
<ul>
<li>
<p>程序自动化流程：AI 生成定时任务脚本（每日凌晨触发）→ 自动调用豆瓣接口获取最新Top250数据 → AI 自动处理数据格式（标准化字段、补全缺失值默认值）→ 自动同步至前端展示数据库 → 前端页面自动拉取数据并渲染</p>
</li>
<li>
<p>落地优先级：先实现“无人工干预的基础数据展示”，暂不纠结细节优化（如极致加载速度、个性化筛选）；待流程稳定跑通后，再针对性迭代自动化优化逻辑</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78603660413d4434963e2862b4c00e47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=po4wKE0P2HWAiXqzxGlWELYp5u4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">3.2 人的价值不可忽视</h3>
<p><strong>关键原则</strong>：<strong>人的核心价值在于 --- 决策、审核、优化</strong></p>
<p><strong>核心目标</strong>：在关键节点加入人工审核和优化，避免自动化流程“跑偏”</p>
<p><strong>项目案例（豆瓣Top250电影数据展示）</strong>：</p>
<ul>
<li>
<p>决策环节：确定核心业务规则（如“评分降序+上映时间筛选”的排序逻辑、分页条数设置、异常数据兜底规则），为AI自动化流程划定边界；</p>
</li>
<li>
<p>审核环节：在“数据同步至展示数据库”前增设人工审核节点，校验AI处理后的数据准确性（如是否存在错误评分、缺失关键电影信息等），避免错误数据直接展示给用户；</p>
</li>
<li>
<p>优化环节：监控自动化流程运行状态（如接口请求成功率、页面加载性能），针对卡顿、数据异常等问题，向AI提出精准优化需求（如添加接口重试机制、优化图片加载策略），推动流程迭代升级</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8eda3346b6584fec8ed5939855ebb8a4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5p625p6E57K-6L-b5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767682023&amp;x-signature=nHrIZnneTq2gtaWFd8aQR4PvQYE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">四、总结</h2>
<p>回望这一年的点滴，我历经诸多变迁，在跌撞中摸索，在求索里前行。惟愿不负韶华，始终心怀热忱，向上生长，步履不停。</p>
<p>最后，跟大家分享下自己 AI 学习的三个观点：</p>
<p><strong>1、LLM带来的不是更高层次抽象，而是不同性质的抽象</strong></p>
<p>传统编程的抽象（如函数、类、框架）是确定性抽象；LLM 的抽象则是概率性抽象，其本质是基于海量文本规律统计</p>
<p><strong>2、大模型把非确定性引入了软件开发的核心路径</strong></p>
<p>传统软件开发的核心路径（需求→设计→编码→测试→部署）是确定性闭环，而LLM则从生成、理解、迭代环节的非确定性打破了这一闭环</p>
<p><strong>3、软件工程的重心正在从写对的代码转向管理意图与结果之间的偏差</strong></p>
<p>传统软件工程的核心是 “代码正确性”，LLM 普及后，编码效率大幅提升，但“意图 vs 结果”偏差成为新的核心风险</p>
<p><strong>·END·</strong></p>
<p>希望今天的讲解对大家有所帮助，谢谢！</p>
<p>Thanks for reading!</p>
<blockquote>
<p>作者：架构精进之路，十年研发风雨路，大厂架构师，CSDN 博客专家，专注架构技术沉淀学习及分享，职业与认知升级，坚持分享接地气儿的干货文章，期待与你一起成长。<br/>
关注并私信我回复“01”，送你一份程序员成长进阶大礼包，欢迎勾搭。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[理清 https 的加密逻辑]]></title>    <link>https://juejin.cn/post/7589454621719183410</link>    <guid>https://juejin.cn/post/7589454621719183410</guid>    <pubDate>2025-12-30T08:47:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589454621719183410" data-draft-id="7567198443786338331" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="理清 https 的加密逻辑"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-30T08:47:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="imoo"/> <meta itemprop="url" content="https://juejin.cn/user/2682464104364766"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            理清 https 的加密逻辑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2682464104364766/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    imoo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T08:47:39.000Z" title="Tue Dec 30 2025 08:47:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    59
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>http 是前端的老朋友了，也是面试常考点，最近看了《图解 http》，结合着 ai 重新理了一遍 https 相关的知识，在此分享。</p>
<h2 data-id="heading-1">http 的隐患</h2>
<p>众所周知，前端与后端的交互，都需要走接口。绝大部分接口都是 http 协议，随便举一个登录例子：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable constant_">GET</span> /login?user=alice&amp;password=<span class="hljs-number">123456</span> <span class="hljs-variable constant_">HTTP</span>/<span class="hljs-number">1.1</span>
<span class="hljs-title class_">Host</span>: example.<span class="hljs-property">com</span>
<span class="hljs-title class_">User</span>-<span class="hljs-title class_">Agent</span>: <span class="hljs-title class_">Chrome</span>
</code></pre>
<p>在这个请求发出时，你的信息实际上在整条网络上都是透明的。假如你的网络经过路由器，那么路由器的主人就可以看到你这个请求，也就是能看到你的密码 <code>user=alice&amp;password=123456</code>。</p>
<p>所以国家总会提醒你，不要乱连 wifi，你的信息有可能被监听和泄露。</p>
<p>老前端们过去也总说，<strong>前端实际上没有安全性可言</strong>。在这个背景下，https 的推出也是理所当然的了。</p>
<h2 data-id="heading-2">升级之 https</h2>
<p>https 实际上只是在 http 的基础上，增加了一个加密层 TLS，该加密层使用了非对称加密来保证数据不泄露。</p>
<p>非对称加密，区分了公钥和私钥，这里有个很巧妙的数学公式，使信息能<strong>任何人都能使用公钥进行加密，但又只能用私钥进行解密</strong>。</p>
<p>这个非对称加密的过程相当消耗性能，几乎是原先的数倍甚至数十倍。有没有既可以加密，又保证性能的方案呢？</p>
<p>http 给出的答案是，<strong>在第一次通信时，使用非对称加密传递一个密码，随后使用该密码进行对称加密</strong>。这样一来，由于密码不会被中间者拦截，所以后续的对称加密也无法被轻易破解。</p>
<p>虽然在控制台上还是会看到正常的信息：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable constant_">POST</span> /api/login <span class="hljs-variable constant_">HTTP</span>/<span class="hljs-number">1.1</span>
<span class="hljs-title class_">Host</span>: example.<span class="hljs-property">com</span>
<span class="hljs-title class_">Content</span>-<span class="hljs-title class_">Type</span>: application/json
<span class="hljs-title class_">Content</span>-<span class="hljs-title class_">Length</span>: <span class="hljs-number">42</span>

{<span class="hljs-string">"username"</span>: <span class="hljs-string">"alice"</span>, <span class="hljs-string">"password"</span>: <span class="hljs-string">"123456"</span>}
</code></pre>
<p><strong>但这只对自己可见</strong>。数据在传递过程中完全被加密，抓包只能看到类似如下内容：</p>
<pre><code class="hljs language-js" lang="js">9a f1 <span class="hljs-number">23</span> 8b ... 8e d0
</code></pre>
<p>也就是完全转化为了二进制（在抓包软件内会直接显示为十六进制），这样在没有私钥的情况下，就无法将数据还原。</p>
<h2 data-id="heading-3">细说加密逻辑</h2>
<p>我们来稍微详细了解一下中间的流程。</p>
<p>首先复习下 http 的三次握手：</p>
<ol>
<li>客户端发起链接请求，发送一个 <code>SYN</code> 标识</li>
<li>服务器确认可以收到客户端消息，发送一个 <code>SYN-ACK</code> 标识</li>
<li>客户端确认可以收到服务端消息，发送一个 <code>ACK</code> 标识</li>
</ol>
<blockquote>
<p>有个很好的比喻：1.喂？听得到吗， 2.我听得到，你听得到我吗 3. 我听得到</p>
</blockquote>
<p>https 的加密流程，发生在<strong>三次握手之后</strong></p>
<p>目前主流是 TLS 1.3 版本，但旧的 TLS 1.2 版本仍然有部分存量。这两者的加密有所不同，我们分开讨论：</p>
<p>在 TLS 1.2 中：</p>
<ol>
<li>客户端发送 TLS 版本，加密算法，随机数 <code>Client Random</code></li>
<li>服务器端发送确认使用的 TLS 版本，加密算法，随机数 <code>Server Random</code></li>
<li>客户端校验证书后，再生成一个随机预主密钥 <code>Pre-Master Key</code>，并将 <code>Pre-Master Key</code> 使用公钥加密后，发送给服务端</li>
<li>服务端使用私钥，解开加密，随后<strong>双方</strong>根据这三个随机数<code>Client Random</code>，<code>Server Random</code>，<code>Pre-Master Key</code> 生成对话主密钥 <code>Master Key</code></li>
<li>根据 <code>Master Key</code> 生成临时对话秘钥</li>
<li>根据临时对话秘钥进行对称加密通信</li>
</ol>
<blockquote>
<p>但这里存在两个问题，1. 基于 rsa 算法的非对称加密，性能消耗还是比较严重 2. 过程繁琐。所以在 TLS 1.3 中对这两点进行了优化。</p>
</blockquote>
<p>在 TLS 1.3 中：</p>
<ol>
<li>客户端发送 TLS 版本，加密算法，<code>客户端 Key Share</code></li>
<li>服务端发送确认使用的 TLS 版本，加密算法，<code>服务端 Key Share</code></li>
<li>各自根据 <code>Key Share</code>，使用 ECDHE 算法算出共享密钥</li>
<li>使用共享密钥进行对称加密</li>
</ol>
<p>可以看到，使用 ECDHE 算法，不仅降低了步骤数量，而且由于 ECHDE 所需要的秘钥长度更短，所以性能也更加优秀。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 17 升级避坑：如何安全处理反射访问限制]]></title>    <link>https://juejin.cn/post/7589172193151008804</link>    <guid>https://juejin.cn/post/7589172193151008804</guid>    <pubDate>2025-12-30T01:41:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589172193151008804" data-draft-id="7589201772118622214" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 17 升级避坑：如何安全处理反射访问限制"/> <meta itemprop="keywords" content="后端,面试,架构"/> <meta itemprop="datePublished" content="2025-12-30T01:41:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="踏浪无痕"/> <meta itemprop="url" content="https://juejin.cn/user/2834988091055719"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 17 升级避坑：如何安全处理反射访问限制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2834988091055719/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    踏浪无痕
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T01:41:49.000Z" title="Tue Dec 30 2025 01:41:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>最近帮几个团队从 Java 8/11 升到 Java 17 + Spring Boot 3，发现 90% 的人都会踩这个坑：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">InaccessibleObjectException:</span> Unable <span class="hljs-keyword">to</span> make ... accessible:
<span class="hljs-keyword">module</span> java.base does <span class="hljs-built_in">not</span> <span class="hljs-string">"opens"</span> java.lang <span class="hljs-keyword">to</span> unnamed <span class="hljs-keyword">module</span>
</code></pre>
<p>应用启动直接炸了，日志里全是反射相关的异常。<strong>这不是 Bug，是 Java 9 引入模块系统后的"新规矩"</strong>——默认禁止反射访问内部实现。</p>
<p>本文给你<strong>可直接复制的解决方案 + 安全评估</strong>，让升级少走弯路。</p>
<hr/>
<h2 data-id="heading-0">你是不是也遇到了这个报错？</h2>
<p>升级到 Java 9+ 或 Spring Boot 3.x 后，应用启动时抛出异常：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">java.lang.reflect.InaccessibleObjectException: 
Unable <span class="hljs-keyword">to</span> make <span class="hljs-keyword">private</span> native java.lang.reflect.Field[] 
java.lang.<span class="hljs-keyword">Class</span>.getDeclaredFields0(<span class="hljs-type">boolean</span>) accessible: 
<span class="hljs-keyword">module</span> java.base does <span class="hljs-built_in">not</span> <span class="hljs-string">"opens java.lang"</span> <span class="hljs-keyword">to</span> unnamed <span class="hljs-keyword">module</span>
</code></pre>
<h3 data-id="heading-1">升级时最常踩的 3 个坑</h3>
<ol>
<li>
<p><strong>Spring 应用启动失败</strong><br/>
<code>@Autowired</code> 私有字段注入报错，ApplicationContext 初始化炸了</p>
</li>
<li>
<p><strong>Logback 配置加载异常</strong><br/>
日志系统初始化失败，特别是 Spring Boot 3.2+ 的嵌套 JAR 环境</p>
</li>
<li>
<p><strong>序列化/ORM 框架炸裂</strong><br/>
Jackson/Gson 处理 JSON 报错，Hibernate 实体映射失败</p>
</li>
</ol>
<p>影响范围：Java 9 至 Java 21（包括主流 LTS 版本：11、17、21）</p>
<hr/>
<h2 data-id="heading-2">为什么会报这个错？</h2>
<p>问题根源在于 Java 9 引入的模块系统默认禁止反射访问内部实现。</p>
<p><strong>Java 8 及之前：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> SomeClass.class.getDeclaredField(<span class="hljs-string">"privateField"</span>);
field.setAccessible(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 总是成功</span>
</code></pre>
<p><strong>Java 9+：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> SomeClass.class.getDeclaredField(<span class="hljs-string">"privateField"</span>);
field.setAccessible(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 可能抛出 InaccessibleObjectException</span>
</code></pre>
<p>JVM 在 <code>setAccessible(true)</code> 时检查：</p>
<ol>
<li>调用者模块是否有权限访问目标模块</li>
<li>目标模块是否 <code>opens</code> 了相关包</li>
</ol>
<p>没有 <code>module-info.java</code> 的应用属于"未命名模块"，无法反射访问未开放的包。</p>
<h3 data-id="heading-3">框架为什么非要用反射？</h3>
<p><strong>Spring 依赖注入：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserRepository repository;  <span class="hljs-comment">// 私有字段注入需要反射</span>
}
</code></pre>
<p><strong>Logback 配置扫描：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Logback 内部需要监控配置文件变化</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">scanForChanges</span><span class="hljs-params">()</span> {
    Field[] fields = getClass().getDeclaredFields();  <span class="hljs-comment">// 触发异常</span>
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p><strong>Jackson 序列化：</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">private</span> String password;  <span class="hljs-comment">// 没有 getter，需要反射读取</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-4">怎么快速修复？</h2>
<h3 data-id="heading-5">方案一：加 JVM 参数（推荐，99% 的情况够用）</h3>
<p>这是目前最稳妥的方案，Spring Boot 官方文档也推荐这么做。<strong>核心思路：告诉 JVM 允许反射访问特定的包。</strong></p>
<h4 data-id="heading-6">基础参数（先试这两个）</h4>
<pre><code class="hljs language-bash" lang="bash">java --add-opens java.base/java.lang=ALL-UNNAMED \
     --add-opens java.base/java.lang.reflect=ALL-UNNAMED \
     -jar app.jar
</code></pre>
<p><code>--add-opens</code> 语法：</p>
<ul>
<li><code>java.base</code>: 模块名</li>
<li><code>java.lang</code>: 包名</li>
<li><code>ALL-UNNAMED</code>: 对所有未命名模块开放</li>
</ul>
<h4 data-id="heading-7">Spring Boot 3.x 实战参数集（血泪总结）</h4>
<p>升级过 10+ 个项目后，发现这套参数基本覆盖了所有常见框架：</p>
<pre><code class="hljs language-bash" lang="bash">--add-opens java.base/java.lang=ALL-UNNAMED
--add-opens java.base/java.lang.reflect=ALL-UNNAMED
--add-opens java.base/java.lang.invoke=ALL-UNNAMED
--add-opens java.base/java.util=ALL-UNNAMED
--add-opens java.base/java.text=ALL-UNNAMED
--add-opens java.base/java.io=ALL-UNNAMED
--add-opens java.base/java.net=ALL-UNNAMED
--add-opens java.base/java.nio=ALL-UNNAMED
--add-opens java.base/sun.nio.ch=ALL-UNNAMED
</code></pre>
<p>如果使用 JAXB 或 XML 处理：</p>
<pre><code class="hljs language-bash" lang="bash">--add-opens java.xml/com.sun.org.apache.xerces.internal.jaxp=ALL-UNNAMED
</code></pre>
<h4 data-id="heading-8">不同部署环境的配置</h4>
<p><strong>Docker：</strong></p>
<pre><code class="hljs language-dockerfile" lang="dockerfile">FROM eclipse-temurin:17-jre-alpine
COPY app.jar /app.jar
ENV JAVA_OPTS="--add-opens java.base/java.lang=ALL-UNNAMED \
               --add-opens java.base/java.lang.reflect=ALL-UNNAMED"
ENTRYPOINT exec java $JAVA_OPTS -jar /app.jar
</code></pre>
<p><strong>Kubernetes：</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">app</span>
        <span class="hljs-attr">env:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">JAVA_OPTS</span>
          <span class="hljs-attr">value:</span> <span class="hljs-string">&gt;-
            --add-opens java.base/java.lang=ALL-UNNAMED
            --add-opens java.base/java.lang.reflect=ALL-UNNAMED
</span></code></pre>
<p><strong>使用参数文件（推荐）：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># jvm-options.txt</span>
--add-opens java.base/java.lang=ALL-UNNAMED
--add-opens java.base/java.lang.reflect=ALL-UNNAMED
--add-opens java.base/java.lang.invoke=ALL-UNNAMED
--add-opens java.base/java.util=ALL-UNNAMED

<span class="hljs-comment"># 启动时引用</span>
java @jvm-options.txt -jar app.jar
</code></pre>
<p><strong>Maven 测试：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">argLine</span>&gt;</span>
            --add-opens java.base/java.lang=ALL-UNNAMED
            --add-opens java.base/java.lang.reflect=ALL-UNNAMED
        <span class="hljs-tag">&lt;/<span class="hljs-name">argLine</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
</code></pre>
<p><strong>Gradle 测试：</strong></p>
<pre><code class="hljs language-groovy" lang="groovy">test {
    jvmArgs = [
        '--add-opens', 'java.base/java.lang=ALL-UNNAMED',
        '--add-opens', 'java.base/java.lang.reflect=ALL-UNNAMED'
    ]
}
</code></pre>
<h3 data-id="heading-9">方案二：改 Logback 配置（Spring Boot 3.2+ 必看）</h3>
<p><strong>这是升级 Spring Boot 3.2 时最容易忽略的坑。</strong> Logback 的配置文件扫描功能在新版本里会触发反射异常：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- logback.xml 或 logback-spring.xml --&gt;</span>

<span class="hljs-comment">&lt;!-- 移除前 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span> <span class="hljs-attr">scan</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">scanPeriod</span>=<span class="hljs-string">"30 seconds"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- ... --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 修改后 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- ... --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<p>同时修复 Spring Boot 3.2+ 的嵌套 JAR 问题：</p>
<pre><code class="hljs language-bash" lang="bash">ERROR: URL [jar:nested:/app.jar!/BOOT-INF/lib/logback.jar!/logback.xml] 
is not of <span class="hljs-built_in">type</span> file
</code></pre>
<p>Spring Boot 3.2 使用 <code>jar:nested:</code> 协议，Logback 的文件监听不支持此协议。去掉 <code>scan</code> 属性即可。</p>
<h3 data-id="heading-10">方案三：写 module-info.java（长期方向，暂时没必要）</h3>
<p>定义应用模块：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// src/main/java/module-info.java</span>
<span class="hljs-keyword">module</span> com.example.myapp {
    <span class="hljs-keyword">requires</span> java.base;
    <span class="hljs-keyword">requires</span> spring.boot;
    <span class="hljs-keyword">requires</span> spring.boot.autoconfigure;
    
    <span class="hljs-comment">// 允许 Spring 反射访问</span>
    opens com.example.myapp.controller to spring.core, spring.beans;
    opens com.example.myapp.service to spring.core, spring.beans;
    opens com.example.myapp.entity to org.hibernate.orm.core;
}
</code></pre>
<p>好处是精确控制访问权限，符合 Java 的演进方向。<br/>
但配置麻烦，而且很多框架还没完全模块化，不建议现在就搞。</p>
<hr/>
<h2 data-id="heading-11">它是怎么工作的？（可选阅读）</h2>
<p>想理解为什么需要 <code>--add-opens</code>，得先搞清楚模块系统的访问控制机制。如果只想快速解决问题，可以跳过这节。</p>
<h3 data-id="heading-12">模块系统的访问控制</h3>
<p>Java 9+ 的访问控制多了一层：</p>
<pre><code class="hljs language-arduino" lang="arduino">传统 Java:  <span class="hljs-keyword">public</span>/<span class="hljs-keyword">protected</span>/<span class="hljs-keyword">default</span>/<span class="hljs-keyword">private</span>
模块化 Java: <span class="hljs-keyword">module</span> → package → <span class="hljs-keyword">class</span> → member
</code></pre>
<p><code>module-info.java</code> 定义模块边界：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">module</span> java.base {
    <span class="hljs-keyword">exports</span> java.lang;      <span class="hljs-comment">// 允许使用公共 API</span>
    <span class="hljs-keyword">exports</span> java.util;
    
    <span class="hljs-comment">// 不 opens，禁止反射访问内部实现</span>
}
</code></pre>
<p>关键字说明：</p>
<ul>
<li><code>exports pkg</code>: 其他模块可以使用该包的 public 类型</li>
<li><code>opens pkg</code>: 允许运行时反射访问（包括私有成员）</li>
<li><code>opens pkg to module1, module2</code>: 只对特定模块开放</li>
<li><code>open module</code>: 整个模块开放反射（类似 Java 8 行为）</li>
</ul>
<h3 data-id="heading-13">反射时 JVM 做了什么检查</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 你的代码</span>
<span class="hljs-type">Field</span> <span class="hljs-variable">field</span> <span class="hljs-operator">=</span> String.class.getDeclaredField(<span class="hljs-string">"value"</span>);
field.setAccessible(<span class="hljs-literal">true</span>);  <span class="hljs-comment">// 这里会触发检查</span>

<span class="hljs-comment">// JVM 内部逻辑（简化版）</span>
<span class="hljs-keyword">if</span> (!targetModule.isOpen(targetPackage, callerModule)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InaccessibleObjectException</span>(
        <span class="hljs-string">"module "</span> + targetModule.getName() + 
        <span class="hljs-string">" does not open "</span> + targetPackage + 
        <span class="hljs-string">" to "</span> + callerModule.getName()
    );
}
</code></pre>
<p>没写 <code>module-info.java</code> 的应用算"未命名模块"：</p>
<ul>
<li>可以正常用其他模块的公开 API（<code>exports</code> 的部分）</li>
<li>但不能反射访问没开放（<code>opens</code>）的包</li>
<li>报错里的 <code>unnamed module</code> 说的就是这个</li>
</ul>
<h3 data-id="heading-14">Spring Boot 3.2+ 的嵌套 JAR 问题</h3>
<p>Spring Boot 3.2 改用新的 JAR 加载方式：</p>
<pre><code class="hljs language-bash" lang="bash">旧版本: jar:file:/app.jar!/BOOT-INF/lib/logback.jar!/logback.xml
3.2+:   jar:nested:/app.jar!/BOOT-INF/lib/logback.jar!/logback.xml
</code></pre>
<p>Logback 的文件监听器不认识 <code>nested:</code> 这种协议，结果就是：</p>
<ol>
<li>配置文件变化监控失败</li>
<li>尝试反射读取文件路径时炸了</li>
</ol>
<p>办法就是禁用 <code>scan</code> 或把配置文件放外面。</p>
<hr/>
<h2 data-id="heading-15">加这些参数，会不会埋雷？</h2>
<p><strong>实战结论：风险可控，前提是做好依赖管理。</strong></p>
<p>帮十几个团队升级后，从未因为 <code>--add-opens</code> 参数本身出过安全事故。真正的风险在于<strong>依赖来源</strong>，而不是这些参数。</p>
<p><strong>理论上的风险：</strong></p>
<ol>
<li>
<p><strong>恶意依赖可能读取敏感数据</strong></p>
<pre><code class="hljs language-java" lang="java">Field[] fields = target.getClass().getDeclaredFields();
<span class="hljs-keyword">for</span> (Field f : fields) {
    f.setAccessible(<span class="hljs-literal">true</span>);
    <span class="hljs-keyword">if</span> (f.getName().contains(<span class="hljs-string">"password"</span>)) {
        sendToAttacker(f.get(target));
    }
}
</code></pre>
</li>
<li>
<p><strong>可能修改不可变对象</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Field</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> String.class.getDeclaredField(<span class="hljs-string">"value"</span>);
value.setAccessible(<span class="hljs-literal">true</span>);
value.set(str, newValue);  <span class="hljs-comment">// 破坏 String 不可变性</span>
</code></pre>
</li>
</ol>
<p><strong>为什么实际风险不高：</strong></p>
<ul>
<li>恶意代码需要先混进你的依赖（供应链攻击），这本身就是大问题</li>
<li>加不加 <code>--add-opens</code> 区别不大，恶意代码能干的坏事多了去了</li>
<li>只影响当前 JVM 进程，不会波及系统其他应用</li>
<li>Spring Boot 官方文档推荐这种配置，属于标准做法</li>
</ul>
<h3 data-id="heading-16">真正该做的防护</h3>
<p><strong>依赖来源控制：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 仅使用可信仓库 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">repositories</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">repository</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>central<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">url</span>&gt;</span>https://repo.maven.apache.org/maven2<span class="hljs-tag">&lt;/<span class="hljs-name">url</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">releases</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">enabled</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">enabled</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">releases</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">repository</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">repositories</span>&gt;</span>
</code></pre>
<p><strong>依赖审查：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查依赖树</span>
mvn dependency:tree

<span class="hljs-comment"># OWASP 漏洞扫描</span>
mvn org.owasp:dependency-check-maven:check
</code></pre>
<p><strong>最小权限原则：</strong></p>
<p>只开放必需的包，避免过度授权：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 必需</span>
--add-opens java.base/java.lang=ALL-UNNAMED

<span class="hljs-comment"># 非必需则不开</span>
--add-opens java.base/java.security=ALL-UNNAMED  <span class="hljs-comment"># 仅在需要时添加</span>
</code></pre>
<p><strong>运行时监控：</strong></p>
<p>记录反射调用（通过 Java Agent）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReflectionMonitor</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">premain</span><span class="hljs-params">(String args, Instrumentation inst)</span> {
        inst.addTransformer((loader, className, classBeingRedefined, 
                            protectionDomain, classfileBuffer) -&gt; {
            <span class="hljs-comment">// 拦截 setAccessible 调用</span>
            <span class="hljs-comment">// 记录调用栈到日志</span>
            <span class="hljs-keyword">return</span> classfileBuffer;
        });
    }
}
</code></pre>
<p>启动：</p>
<pre><code class="hljs language-bash" lang="bash">java -javaagent:monitor.jar --add-opens ... -jar app.jar
</code></pre>
<hr/>
<h2 data-id="heading-17">上线前，记得核对这几点</h2>
<h3 data-id="heading-18">本地开发环境</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 升级到目标 Java 版本（17 或 21）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 运行完整测试套件，记录所有反射相关错误</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 根据错误信息添加 <code>--add-opens</code> 参数</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 修改 Logback 配置（去掉 <code>scan="true"</code>）</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 重新运行测试，确认无异常</li>
</ul>
<h3 data-id="heading-19">构建配置</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更新 Maven/Gradle 测试插件配置</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 创建 <code>jvm-options.txt</code> 集中管理参数</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更新 Dockerfile，添加 <code>JAVA_OPTS</code> 环境变量</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 测试 Docker 镜像构建和运行</li>
</ul>
<h3 data-id="heading-20">部署配置</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更新 Kubernetes Deployment YAML</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 配置环境变量或 ConfigMap</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 在测试环境验证</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 监控日志，确认无异常</li>
</ul>
<h3 data-id="heading-21">文档更新</h3>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 记录所需的 JVM 参数及原因</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 更新部署文档</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> 通知团队成员</li>
</ul>
<hr/>
<h2 data-id="heading-22">主流框架的兼容情况</h2>
<h3 data-id="heading-23">Spring Framework</h3>























<table><thead><tr><th>版本</th><th>Java 支持</th><th>模块化支持</th><th>说明</th></tr></thead><tbody><tr><td>Spring 5.x</td><td>Java 8-17</td><td>部分</td><td>需要 <code>--add-opens</code></td></tr><tr><td>Spring 6.x</td><td>Java 17+</td><td>完整</td><td>原生模块化，推荐使用</td></tr></tbody></table>
<p>Spring Boot 3.0+ 基于 Spring 6.x，完全支持 Java 17+。</p>
<h3 data-id="heading-24">Hibernate</h3>




















<table><thead><tr><th>版本</th><th>Java 支持</th><th>说明</th></tr></thead><tbody><tr><td>Hibernate 5.x</td><td>Java 8-11</td><td>需要较多 <code>--add-opens</code></td></tr><tr><td>Hibernate 6.x</td><td>Java 11+</td><td>改进的模块化支持</td></tr></tbody></table>
<h3 data-id="heading-25">Logback</h3>
<p>所有版本均需禁用 <code>scan</code> 或添加反射参数。</p>
<p>推荐配置：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"org/springframework/boot/logging/logback/defaults.xml"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">include</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">"org/springframework/boot/logging/logback/console-appender.xml"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">root</span> <span class="hljs-attr">level</span>=<span class="hljs-string">"INFO"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">appender-ref</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"CONSOLE"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
</code></pre>
<hr/>
<h2 data-id="heading-26">常见问题</h2>
<p><strong>Q: 能不能不加这些参数？</strong></p>
<p>A: 短期内不行。除非：</p>
<ul>
<li>退回 Java 8（不推荐，都快 EOL 了）</li>
<li>换成编译时注入的框架（Micronaut、Quarkus）</li>
<li>等所有依赖都模块化（估计还得好几年）</li>
</ul>
<p><strong>Q: 生产环境用这些参数靠谱吗？</strong></p>
<p>A: 靠谱。前提是：</p>
<ul>
<li>依赖别从野鸡仓库拉</li>
<li>定期跑漏洞扫描</li>
<li>只开必要的包，别乱开</li>
</ul>
<p><strong>Q: 参数太多了，能简化吗？</strong></p>
<p>A: 用参数文件：</p>
<pre><code class="hljs language-bash" lang="bash">java @jvm-options.txt -jar app.jar
</code></pre>
<p>或者统一放环境变量里。</p>
<p><strong>Q: 怎么知道要加哪些参数？</strong></p>
<p>A: 看异常信息：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">module</span> java.base does <span class="hljs-keyword">not</span> open java.util to unnamed <span class="hljs-keyword">module</span>
                              ^^^^^^^^^
                              就是这个包
</code></pre>
<p>然后加：<code>--add-opens java.base/java.util=ALL-UNNAMED</code></p>
<p><strong>Q: 以后还得一直加这些参数吗？</strong></p>
<p>A: 看框架更新情况。Spring 6 已经减少了对反射的依赖，以后可能会更好。</p>
<hr/>
<h2 data-id="heading-27">写在最后：升级 Java 17 的正确姿势</h2>
<p>帮这么多团队升级后，总结几点经验：</p>
<p><strong>1. 别一次性跨太多版本</strong><br/>
Java 8 → 17 跨度太大，建议：8 → 11 → 17，每次充分测试。</p>
<p><strong>2. 模块系统不是敌人</strong><br/>
虽然短期内会遇到反射问题，但长期看，模块化让依赖管理更清晰。<code>--add-opens</code> 只是过渡手段。</p>
<p><strong>3. 用得清醒，就不怕风险</strong><br/>
这些参数本身不危险，危险的是野鸡依赖。定期跑 <code>mvn dependency-check:check</code>，比纠结参数安全性有用得多。</p>
<hr/>
<p><strong>升级前先自查（省 2 小时排错）：</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 检查 Logback 配置（Spring Boot 3.2+ 必查）</span>
grep -r <span class="hljs-string">'scan="true"'</span> src/main/resources/
<span class="hljs-comment"># 如果有，删掉它</span>

<span class="hljs-comment"># 2. 创建 JVM 参数文件（别直接写在启动脚本里，不好维护）</span>
<span class="hljs-built_in">cat</span> &gt; jvm-options.txt &lt;&lt; <span class="hljs-string">EOF
--add-opens java.base/java.lang=ALL-UNNAMED
--add-opens java.base/java.lang.reflect=ALL-UNNAMED
--add-opens java.base/java.lang.invoke=ALL-UNNAMED
--add-opens java.base/java.util=ALL-UNNAMED
EOF</span>

<span class="hljs-comment"># 3. 本地先跑一遍测试</span>
mvn clean <span class="hljs-built_in">test</span>

<span class="hljs-comment"># 4. 扫依赖漏洞（顺便的事）</span>
mvn dependency-check:check
</code></pre>
<p><strong>常见问题速查：</strong></p>

























<table><thead><tr><th>报错信息</th><th>加这个参数</th></tr></thead><tbody><tr><td><code>does not open java.util</code></td><td><code>--add-opens java.base/java.util=ALL-UNNAMED</code></td></tr><tr><td><code>does not open java.lang</code></td><td><code>--add-opens java.base/java.lang=ALL-UNNAMED</code></td></tr><tr><td><code>does not open java.lang.reflect</code></td><td><code>--add-opens java.base/java.lang.reflect=ALL-UNNAMED</code></td></tr><tr><td>Logback 配置加载失败</td><td>删掉 <code>logback.xml</code> 里的 <code>scan="true"</code></td></tr></tbody></table>
<p>遇到新的坑，对照异常信息找 <code>does not open</code> 后面的包名，加对应的 <code>--add-opens</code> 就行。</p>
<hr/>
<h2 data-id="heading-28">参考资源</h2>
<p><strong>官方文档：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F261" target="_blank" title="https://openjdk.org/jeps/261" ref="nofollow noopener noreferrer">JEP 261: Module System</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F403" target="_blank" title="https://openjdk.org/jeps/403" ref="nofollow noopener noreferrer">JEP 403: Strongly Encapsulate JDK Internals</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fspring-projects%2Fspring-boot%2Fwiki%2FSpring-Boot-3.0-Migration-Guide" target="_blank" title="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-3.0-Migration-Guide" ref="nofollow noopener noreferrer">Spring Boot 3.0 Migration Guide</a></li>
</ul>
<p><strong>社区指南：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fspring.io%2Fblog%2F2021%2F09%2F02%2Fa-java-17-and-jakarta-ee-9-baseline-for-spring-framework-6" target="_blank" title="https://spring.io/blog/2021/09/02/a-java-17-and-jakarta-ee-9-baseline-for-spring-framework-6" ref="nofollow noopener noreferrer">Migrating to Java 17 - Spring Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.baeldung.com%2Fjava-9-modularity" target="_blank" title="https://www.baeldung.com/java-9-modularity" ref="nofollow noopener noreferrer">Java Module System Tutorial</a></li>
</ul>
<p><strong>工具：</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fen%2Fjava%2Fjavase%2F17%2Fdocs%2Fspecs%2Fman%2Fjdeps.html" target="_blank" title="https://docs.oracle.com/en/java/javase/17/docs/specs/man/jdeps.html" ref="nofollow noopener noreferrer">jdeps</a>: 分析模块依赖</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fowasp.org%2Fwww-project-dependency-check%2F" target="_blank" title="https://owasp.org/www-project-dependency-check/" ref="nofollow noopener noreferrer">OWASP Dependency-Check</a>: 依赖漏洞扫描</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Mybatis二级缓存实现详解]]></title>    <link>https://juejin.cn/post/7589212818808176703</link>    <guid>https://juejin.cn/post/7589212818808176703</guid>    <pubDate>2025-12-30T14:19:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589212818808176703" data-draft-id="7589466238240915498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Mybatis二级缓存实现详解"/> <meta itemprop="keywords" content="Java,MyBatis,源码阅读"/> <meta itemprop="datePublished" content="2025-12-30T14:19:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员侠客行"/> <meta itemprop="url" content="https://juejin.cn/user/556801719828361"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Mybatis二级缓存实现详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/556801719828361/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员侠客行
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T14:19:06.000Z" title="Tue Dec 30 2025 14:19:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上一篇《<a href="https://juejin.cn/post/7588042910198595634" target="_blank" title="https://juejin.cn/post/7588042910198595634">Mybatis的Executor和缓存体系</a>》介绍了一二级缓存的特点、启用和区别。二级缓存是Mapper级别，在整个应用中可以跨线程共享，所以有更高的命中率。和一级缓存的PerpetualCache相比，二级缓存机制和体系更加完整。</p>
<p>现在，我们一起来看看mybatis二级缓存的创建和实现。</p>
<blockquote>
<p>注：本文中源码来自mybatis 3.4.x版本，地址<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmybatis%2Fmybatis-3.git" target="_blank" title="https://github.com/mybatis/mybatis-3.git" ref="nofollow noopener noreferrer">github.com/mybatis/myb…</a></p>
</blockquote>
<h2 data-id="heading-0">一 Cache接口体系</h2>
<p>根接口Cache中定义了缓存的操作方法，有如下约束：</p>
<ol>
<li>子类实现必须有一个构造函数，该构造函数接收一个字符串类型的cache id作为参数；</li>
<li>MyBatis 会将Mapper文件的namespace作为cache id，来创建Cache实例；</li>
<li>每个namespace都有一个cache实例。</li>
</ol>
<p>在结构设计上，二级缓存采用装饰器模式，提供了很多扩展功能，如：</p>
<ul>
<li>内存溢出回收机制，如FIFO、LRU、soft和weak引用；</li>
<li>序列化存储，如SerializedCache</li>
<li>缓存命中统计，LoggingCache</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6439d37b50ec41c2adc58949a8d9364a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=W7RVsUzS8QRiSejcntrAQWhG%2Fqg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">1.1 基础缓存PerpetualCache</h3>
<ul>
<li>PerpetualCache是基础实现，是所有装饰器的被装饰对象；</li>
<li>HashMap存储，简单的键值对存储；</li>
<li>数据永久保存，直到手动清理；</li>
<li>非线程安全。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/641a0151fc6e469c80b239d4814f6dec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=FM%2BS%2FPEZFgtLVmpYend36%2B%2BmFBE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">1.2 淘汰策略装饰器</h3>
<h4 data-id="heading-3">最近最少使用LruCache</h4>
<ul>
<li>LRU算法：基于LinkedHashMap的访问顺序</li>
<li>容量控制：超出容量时淘汰最久未访问的数据</li>
<li>访问更新：每次get操作都会更新访问顺序</li>
<li>默认大小：1024个对象</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LruCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
  <span class="hljs-comment">// 被装饰的Cache对象</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache delegate;
  <span class="hljs-comment">// 最近最少使用算法的实现，基于LinkedHashMap</span>
  <span class="hljs-keyword">private</span> Map&lt;Object, Object&gt; keyMap;
  <span class="hljs-comment">// 最近最少使用的key，用于移除过期的缓存项</span>
  <span class="hljs-keyword">private</span> Object eldestKey;

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">LruCache</span><span class="hljs-params">(Cache delegate)</span> {
    <span class="hljs-built_in">this</span>.delegate = delegate;
    setSize(<span class="hljs-number">1024</span>);
  }
    
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setSize</span><span class="hljs-params">(<span class="hljs-keyword">final</span> <span class="hljs-type">int</span> size)</span> {
    keyMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;Object, Object&gt;(size, <span class="hljs-number">.75F</span>, <span class="hljs-literal">true</span>) {
      <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">4267176411845948333L</span>;

      <span class="hljs-meta">@Override</span>
      <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">removeEldestEntry</span><span class="hljs-params">(Map.Entry&lt;Object, Object&gt; eldest)</span> {
        <span class="hljs-type">boolean</span> <span class="hljs-variable">tooBig</span> <span class="hljs-operator">=</span> size() &gt; size;
        <span class="hljs-keyword">if</span> (tooBig) {
          eldestKey = eldest.getKey();
        }
        <span class="hljs-keyword">return</span> tooBig;
      }
    };
  }    

  <span class="hljs-comment">// put时触发移除eldestKey</span>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object key, Object value)</span> {
    delegate.putObject(key, value);
    cycleKeyList(key);
  }

  <span class="hljs-comment">// get时触发更新eldestKey</span>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object key)</span> {
    keyMap.get(key); <span class="hljs-comment">//touch</span>
    <span class="hljs-keyword">return</span> delegate.getObject(key);
  }   
</code></pre>
<h4 data-id="heading-4">先进先出FifoCache</h4>
<ul>
<li>FIFO算法：严格按照插入顺序淘汰</li>
<li>队列实现：使用LinkedList维护插入顺序，默认大小为1024</li>
<li>简单高效：不考虑访问频率，只看插入时间</li>
<li>适用场景：数据访问模式相对均匀</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FifoCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache delegate;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Deque&lt;Object&gt; keyList;  <span class="hljs-comment">// LinkedList维护插入顺序</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">cycleKeyList</span><span class="hljs-params">(Object key)</span> {
        keyList.addLast(key);           <span class="hljs-comment">// 新key加到队尾</span>
        <span class="hljs-keyword">if</span> (keyList.size() &gt; size) {
            <span class="hljs-type">Object</span> <span class="hljs-variable">oldestKey</span> <span class="hljs-operator">=</span> keyList.removeFirst();  <span class="hljs-comment">// 移除队首</span>
            delegate.removeObject(oldestKey);
        }
    }
}
</code></pre>
<h3 data-id="heading-5">1.3 引用类型装饰器</h3>
<h4 data-id="heading-6">软引用缓存SoftCache</h4>
<p>内存不足时（JVM在OOM前）自动清理，使用SoftReference包装缓存项</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SoftCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
  <span class="hljs-comment">// 维护一定数量强引用，避免缓存项都被GC回收</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Deque&lt;Object&gt; hardLinksToAvoidGarbageCollection;
  <span class="hljs-comment">// 监听GC队列，及时清理失效缓存</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReferenceQueue&lt;Object&gt; queueOfGarbageCollectedEntries;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache delegate;
    
  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object key, Object value)</span> {
    <span class="hljs-comment">// 先清理queueOfGarbageCollectedEntries中GC的缓存项</span>
    removeGarbageCollectedItems();
    <span class="hljs-comment">// 缓存项包装为SoftReference</span>
    delegate.putObject(key, <span class="hljs-keyword">new</span> <span class="hljs-title class_">SoftEntry</span>(key, value, queueOfGarbageCollectedEntries));
  }
</code></pre>
<h4 data-id="heading-7">弱引用缓存WeakCache</h4>
<p>类似SoftCache，但使用WeakReference，在下次GC时缓存项就可能被回收。</p>
<h3 data-id="heading-8">1.4 功能增强装饰器</h3>
<h4 data-id="heading-9">序列化缓存SerializedCache</h4>
<ul>
<li>深拷贝：每次get返回新的对象实例</li>
<li>线程安全：避免多线程修改同一对象</li>
<li>序列化要求：对象必须实现Serializable接口</li>
<li>性能开销：序列化/反序列化有性能成本</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerializedCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object key, Object object)</span> {
        <span class="hljs-keyword">if</span> (object == <span class="hljs-literal">null</span> || object <span class="hljs-keyword">instanceof</span> Serializable) {
            delegate.putObject(key, serialize((Serializable) object));  <span class="hljs-comment">// 序列化存储</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CacheException</span>(<span class="hljs-string">"SharedCache failed to make a copy of a non-serializable object: "</span> + object);
        }
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object key)</span> {
        <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> delegate.getObject(key);
        <span class="hljs-keyword">return</span> object == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : deserialize((<span class="hljs-type">byte</span>[]) object);  <span class="hljs-comment">// 反序列化返回</span>
    }
}
</code></pre>
<h4 data-id="heading-10">同步缓存SynchronizedCache</h4>
<p>由于PerpetualCache非线程安全，SynchronizedCache 中对所有方法都加synchronized，虽然变得线程安全了，但是高并发时会影响性能。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object key, Object object)</span> {
    delegate.putObject(key, object);
}
</code></pre>
<h4 data-id="heading-11">日志缓存LoggingCache</h4>
<p>能够统计和输出缓存命中率。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/813ea4e256ff44a182c9d6e69f754200~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=78Iv03LWMq07Q4stDimxN3v0Z3w%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-12">阻塞缓存BlockingCache</h4>
<p>适用于高并发环境下防止缓存击穿、数据库查询成本很高的场景。</p>
<ul>
<li>防止缓存击穿：多线程同时查询同一个不存在的key时，只有一个线程查询数据库</li>
<li>锁机制：每个key对应一个ReentrantLock</li>
<li>超时控制：支持获取锁的超时时间设置</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 阻塞缓存：当缓存未命中时, 会阻塞当前线程, 直到缓存被填充</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlockingCache</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Cache</span> {
  <span class="hljs-comment">// 锁超时时间</span>
  <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> <span class="hljs-variable">timeout</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache delegate;
  <span class="hljs-comment">// 每个缓存键对应一个锁对象</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;Object, ReentrantLock&gt; locks;

  <span class="hljs-comment">// 放入缓存项，同时释放锁对象</span>
  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">putObject</span><span class="hljs-params">(Object key, Object value)</span> {
    <span class="hljs-keyword">try</span> {
      delegate.putObject(key, value);
    } <span class="hljs-keyword">finally</span> {
      releaseLock(key);
    }
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">(Object key)</span> {
    <span class="hljs-comment">// 先获取缓存键对应的锁对象</span>
    acquireLock(key);
    <span class="hljs-type">Object</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> delegate.getObject(key);
    <span class="hljs-comment">// 如果缓存命中, 则释放锁对象</span>
    <span class="hljs-keyword">if</span> (value != <span class="hljs-literal">null</span>) {
      releaseLock(key);
    }
    <span class="hljs-comment">// 未命中时返回null，将导致查询数据库、写缓存</span>
    <span class="hljs-keyword">return</span> value;
  }    
</code></pre>
<h4 data-id="heading-13">定时清理缓存ScheduledCache</h4>
<p><strong>在缓存操作时检查是否超时，超时后自动清空所有缓存数据</strong>。支持设置时间间隔。适用于数据有明确的时效性要求、定期刷新缓存数据等场景。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09490b6ec93c4084a3b0a4dd240cb60c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=6aeoMAvcAD%2Bajin7G7i4HVoyc3E%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c72157f2eca4a41b766c45e257743d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=9Sol3y7KEoXuvK6gAUKcekgX0rA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">1.5 总结</h3>
<p><strong>MyBatis的Cache体系通过装饰器模式，实现了高度的灵活性和可扩展性，每个装饰器专注于单一职责，可以根据实际需求灵活组合使用。</strong></p>
<h2 data-id="heading-15">二 创建和使用二级缓存</h2>
<h3 data-id="heading-16">2.1 创建</h3>
<p>一级缓存是org.apache.ibatis.executor.BaseExecutor中<code>PerpetualCache localCache</code>，默认启用，在创建Executor时就初始化了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad77b33218d9450ab86fa4f8d5aee890~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=ety1xpAtMjR8Xar115TYTC076jk%3D" alt="" loading="lazy"/></p>
<p>那么，二级缓存是何时创建的呢？</p>
<p>先说结论：</p>
<ul>
<li>二级缓存实例在应用启动的Mapper XML解析阶段创建，而不是在运行时动态创建。这保证了缓存的生命周期与应用生命周期一致，实现了跨SqlSession的数据共享。</li>
<li><strong>每个Mapper.xml中标签，对应一个缓存实例，cacheId就是namespace，创建时就应用了所有装饰器。</strong></li>
</ul>
<p>详细流程：</p>
<ol>
<li>在XMLConfigBuilder.mapperElement方法中，会逐个解析Mapper.xml；</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// XMLConfigBuilder.parse() -&gt; parseConfiguration() -&gt; mapperElement()</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mapperElement</span><span class="hljs-params">(XNode parent)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-keyword">if</span> (parent != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">for</span> (XNode child : parent.getChildren()) {
            <span class="hljs-keyword">if</span> (<span class="hljs-string">"package"</span>.equals(child.getName())) {
                <span class="hljs-comment">// 扫描包下的Mapper</span>
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// 解析单个Mapper文件</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">resource</span> <span class="hljs-operator">=</span> child.getStringAttribute(<span class="hljs-string">"resource"</span>);
                <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> Resources.getResourceAsStream(resource);
                <span class="hljs-type">XMLMapperBuilder</span> <span class="hljs-variable">mapperParser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLMapperBuilder</span>(inputStream&lt;/mark&gt;, configuration, resource, configuration.getSqlFragments());
                <span class="hljs-comment">// 在这里创建二级缓存</span>
                mapperParser.parse(); 
            }
        }
    }
}
</code></pre>
<ol start="2">
<li>在XMLMapperBuilder.configurationElement方法中，会解析Mapper中标签；</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">XMLMapperBuilder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseBuilder</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">parse</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (!configuration.isResourceLoaded(resource)) {
            configurationElement(parser.evalNode(<span class="hljs-string">"/mapper"</span>));
            configuration.addLoadedResource(resource);
            bindMapperForNamespace();
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configurationElement</span><span class="hljs-params">(XNode context)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">namespace</span> <span class="hljs-operator">=</span> context.getStringAttribute(<span class="hljs-string">"namespace"</span>);
            <span class="hljs-keyword">if</span> (namespace == <span class="hljs-literal">null</span> || namespace.equals(<span class="hljs-string">""</span>)) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderException</span>(<span class="hljs-string">"Mapper's namespace cannot be empty"</span>);
            }
            builderAssistant.setCurrentNamespace(namespace);
            
            <span class="hljs-comment">// 解析cache标签，创建二级缓存实例</span>
            cacheElement(context.evalNode(<span class="hljs-string">"cache"</span>));
            cacheRefElement(context.evalNode(<span class="hljs-string">"cache-ref"</span>));
            <span class="hljs-comment">// ...其他解析</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderException</span>(<span class="hljs-string">"Error parsing Mapper XML. The XML location is '"</span> + resource + <span class="hljs-string">"'. Cause: "</span> + e, e);
        }
    }
}
</code></pre>
<ol start="3">
<li>解析缓存配置，准备创建实例</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/031d05b2851a4634bfcf52b469de0511~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=RNvxPPbvcEW2qMBfkc1O7oDOlCg%3D" alt="" loading="lazy"/></p>
<ol start="4">
<li>在MapperBuilderAssistant#useNewCache中</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6af4614b7e8c4cf097bd35ca90bdf6bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=XdB%2B6gU0PkC7UIdBag6RJmJ9%2BEg%3D" alt="" loading="lazy"/></p>
<ol start="5">
<li>org.apache.ibatis.mapping.CacheBuilder#build中，应用装饰模式</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a1113303d914f9dbd470b7a7d214e26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=ies%2BjqosIsGFv8nafSIRQtYk7BU%3D" alt="" loading="lazy"/></p>
<ol start="6">
<li>在Mapper.xml中，可配置size、clearInterval等属性，会添加相应的装饰器。</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e3e9026746b4be38deb07bb281e82af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=8xxObWEjolcCiDeSIYkYqA3MxF0%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// CacheBuilder中的装饰器应用顺序</span>
<span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerpetualCache</span>(id);
cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LruCache</span>(cache);           <span class="hljs-comment">// 淘汰策略，默认Lru</span>
cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScheduledCache</span>(cache);     <span class="hljs-comment">// 配置了clearInterval时</span>
cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SerializedCache</span>(cache);    <span class="hljs-comment">// 配置了readWrite时</span>
cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoggingCache</span>(cache);       <span class="hljs-comment">// 日志</span>
cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronizedCache</span>(cache);  <span class="hljs-comment">// 同步</span>
cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BlockingCache</span>(cache);  	   <span class="hljs-comment">// 配置了blocking时</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/078d367394a04864bf5e163f9666194c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=0jKs6%2B04DufK46vQRFDV5gl7rIk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-17"><strong>2.2 使用</strong></h3>
<p>创建的二级缓存实例，会被对应的MappedStatement引用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MappedStatement</span> {
    <span class="hljs-keyword">private</span> Cache cache; <span class="hljs-comment">// 引用对应的缓存实例</span>
    
    <span class="hljs-keyword">public</span> Cache <span class="hljs-title function_">getCache</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> cache;
    }
}
</code></pre>
<p>CachingExecutor在查询时，从MappedStatement中获取二级缓存实例并使用</p>
<pre><code class="hljs language-java" lang="java">  <span class="hljs-keyword">public</span> &lt;E&gt; List&lt;E&gt; <span class="hljs-title function_">query</span><span class="hljs-params">(MappedStatement ms, Object parameterObject, RowBounds rowBounds, ResultHandler resultHandler, CacheKey key, BoundSql boundSql)</span>
      <span class="hljs-keyword">throws</span> SQLException {
    <span class="hljs-comment">// 获取Mapper配置文件中二级缓存实例</span>
    <span class="hljs-type">Cache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> ms.getCache();
    <span class="hljs-comment">// 启用了二级缓存</span>
    <span class="hljs-keyword">if</span> (cache != <span class="hljs-literal">null</span>) {
      <span class="hljs-comment">// 使用缓存</span>
    }
    <span class="hljs-comment">//未启用二级缓存，直接查询数据库</span>
    <span class="hljs-keyword">return</span> delegate.&lt;E&gt; query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);
  }
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8fa551780934f0a929ebd98a45c471d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=heTgOD9JQTt%2FItCm056AAL7l7J8%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-18">三 特别的TransactionalCache</h2>
<p><strong>TransactionalCache也是Cache接口的实现，是MyBatis二级缓存的事务缓冲区，为二级缓存提供事务语义支持。有以下特性</strong></p>
<ol>
<li>延迟写入</li>
</ol>
<ul>
<li>缓存操作不直接写入二级缓存</li>
<li>所有写操作暂存在entriesToAddOnCommit中</li>
<li>只有事务提交时才真正写入共享缓存</li>
</ul>
<ol start="2">
<li>事务隔离</li>
</ol>
<ul>
<li>每个事务有独立的TransactionalCache实例</li>
<li>未提交的缓存项对其他事务不可见</li>
<li>保证缓存的事务一致性</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Cache delegate;
<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> clearOnCommit;
<span class="hljs-comment">// 待提交的缓存项</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Object, Object&gt; entriesToAddOnCommit;
<span class="hljs-comment">// 缓存未命中的key。TransactionalCache.putObject不会触发BlockingCache释放锁，</span>
<span class="hljs-comment">// 因此rollback时对value为null的key，需要执行put来解锁</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Set&lt;Object&gt; entriesMissedInCache;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">commit</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (clearOnCommit) {
        delegate.clear();
    }
    <span class="hljs-comment">// 提交时, 将待添加的缓存项添加到二级缓存中</span>
    flushPendingEntries();
    reset();
}

<span class="hljs-comment">// 回滚时，丢弃待添加的缓存项</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rollback</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 回滚时, 解锁所有未命中缓存项的锁对象</span>
    unlockMissedEntries();
    reset();
}
</code></pre>
<h3 data-id="heading-19">3.1 事务隔离</h3>
<p>mybatis中二级缓存跨session共享，当使用TransactionalCache装饰时，如何区分不同事务的待提交缓存项呢？</p>
<p>答案是：不同事务的缓存操作完全隔离。<strong>MyBatis通过为每个SqlSession创建独立的TransactionalCache实例来实现事务级别的缓存隔离，而不是在单个实例内部区分不同事务。</strong></p>
<ol>
<li>实例级别隔离：每个SqlSession在使用二级缓存时，都会创建自己的TransactionalCache包装器</li>
<li>本地缓存区：每个TransactionalCache维护自己的entriesToAddOnCommit映射，存储该事务的待提交项</li>
<li>事务边界控制：只有在调用commit()时，待提交的缓存项才会真正写入共享的二级缓存。</li>
</ol>
<pre><code class="hljs language-text" lang="text">事务A (SqlSession A)     事务B (SqlSession B)
     |                        |
TransactionalCache A    TransactionalCache B
     |                        |
entriesToAddOnCommit    entriesToAddOnCommit
  {key1: value1}         {key2: value2}
     |                        |
   commit()                rollback()
     |                        |
  写入二级缓存               丢弃缓存项
</code></pre>
<p><strong>注意，SqlSession非线程安全，不应被多线程并发使用；因此某一时刻下某个sqlSession最多处理一个事务。</strong></p>
<h3 data-id="heading-20">3.2 源码实现</h3>
<p>MyBatis通过实例级别的隔离而非数据级别的区分，来实现不同事务的TransactionalCache隔离。</p>
<ul>
<li>
<p>CachingExecutor持有TransactionalCacheManager实例；<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3a0eddc933b4b03b9c7e47db0ede1a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5L6g5a6i6KGM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767709145&amp;x-signature=q8sD2pqMRdoTP855jkBdvS3KmqQ%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p>TransactionalCacheManager会为每个二级缓存创建一个TransactionalCache对象</p>
</li>
</ul>
<pre><code class="hljs language-java" lang="java">  <span class="hljs-comment">// 二级缓存的TransactionalCache包装</span>
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;Cache, TransactionalCache&gt; transactionalCaches = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;Cache, TransactionalCache&gt;();

  <span class="hljs-keyword">private</span> TransactionalCache <span class="hljs-title function_">getTransactionalCache</span><span class="hljs-params">(Cache cache)</span> {
    <span class="hljs-type">TransactionalCache</span> <span class="hljs-variable">txCache</span> <span class="hljs-operator">=</span> transactionalCaches.get(cache);
    <span class="hljs-keyword">if</span> (txCache == <span class="hljs-literal">null</span>) {
      txCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransactionalCache</span>(cache);
      transactionalCaches.put(cache, txCache);
    }
    <span class="hljs-keyword">return</span> txCache;
  }
</code></pre>
<p>事务隔离的实现路径</p>
<ol>
<li>SqlSession级别隔离：每个事务使用独立的SqlSession实例</li>
<li>Executor级别隔离：每个SqlSession创建独立的CachingExecutor</li>
<li>TransactionalCacheManager级别隔离：每个CachingExecutor有独立的TransactionalCacheManager</li>
<li>TransactionalCache级别隔离：每个二级Cache在每个事务中都有独立的TransactionalCache包装</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Grit：代码重构利器]]></title>    <link>https://juejin.cn/post/7589092567545233417</link>    <guid>https://juejin.cn/post/7589092567545233417</guid>    <pubDate>2025-12-29T17:46:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589092567545233417" data-draft-id="7589130173838032946" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Grit：代码重构利器"/> <meta itemprop="keywords" content="Rust,性能优化,代码规范"/> <meta itemprop="datePublished" content="2025-12-29T17:46:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="jump_jump"/> <meta itemprop="url" content="https://juejin.cn/user/4230576474692765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Grit：代码重构利器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4230576474692765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    jump_jump
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T17:46:05.000Z" title="Mon Dec 29 2025 17:46:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    39
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>面对需要修改数百个文件的代码迁移，你还在手动一个个改吗？今天介绍一款能让代码批量重构像查找替换一样简单的工具 —— Grit。</p>
</blockquote>
<h2 data-id="heading-0">为什么需要 Grit</h2>
<p>作为开发者，我们经常遇到这样的场景：</p>
<ul>
<li>团队决定统一使用 <code>lodash-es</code> 替代 <code>lodash</code>，需要修改几百个 import 语句</li>
<li>项目要从 React 类组件迁移到 Hooks，涉及上千个组件</li>
<li>某个废弃的 API 需要全面替换，但调用位置散落在代码库各处</li>
</ul>
<p>传统的解决方案各有痛点：</p>

























<table><thead><tr><th>方案</th><th>问题</th></tr></thead><tbody><tr><td>手动修改</td><td>耗时长、易遗漏、容易出错</td></tr><tr><td>正则替换</td><td>不理解代码结构，容易误伤</td></tr><tr><td>jscodeshift</td><td>仅支持 JS/TS，需懂 AST，编写复杂</td></tr><tr><td>find + sed</td><td>脆弱，难以处理复杂场景</td></tr></tbody></table>
<p><strong>Grit</strong> 就是为了解决这些问题而生的 —— 它用声明式的语法，支持多种语言，让任何人都能写出安全的代码转换规则。</p>
<hr/>
<h2 data-id="heading-1">快速开始</h2>
<h3 data-id="heading-2">安装</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式一：官方安装脚本</span>
curl -fsSL https://docs.grit.io/install | bash

<span class="hljs-comment"># 方式二：npm 安装</span>
npm install -g @getgrit/cli
</code></pre>
<h3 data-id="heading-3">验证安装</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查版本</span>
grit version

<span class="hljs-comment"># 诊断环境</span>
grit doctor
</code></pre>
<h3 data-id="heading-4">第一个转换</h3>
<p>假设我们要把所有的 <code>console.log</code> 调用删除：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式一：使用标准库 pattern（推荐）</span>
grit apply no_console_log src/

<span class="hljs-comment"># 方式二：使用内联 pattern</span>
grit apply <span class="hljs-string">'`console.log($_)`'</span> src/

<span class="hljs-comment"># 先预览会改什么（dry-run）</span>
grit apply --dry-run no_console_log src/

<span class="hljs-comment"># 查看某个 pattern 的详细信息</span>
grit patterns describe no_console_log
</code></pre>
<hr/>
<h2 data-id="heading-5">核心命令</h2>
<h3 data-id="heading-6">grit apply - 应用转换</h3>
<p><strong>语法</strong>: <code>grit apply [OPTIONS] &lt;PATTERN&gt; [PATHS]...</code></p>
<p><strong>Pattern 参数形式</strong>：</p>
<ul>
<li>标准库 pattern: <code>no_console_log</code></li>
<li>内联模式: <code>'</code>console.log($_)<code>'</code>（用单引号包裹反引号内的 pattern）</li>
<li>Pattern 文件: <code>./patterns/my_pattern.grit</code></li>
</ul>
<p><strong>常用选项</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 预览模式（不实际修改文件）</span>
grit apply --dry-run no_console_log file.js

<span class="hljs-comment"># 指定语言</span>
grit apply --language python print_to_log file.py

<span class="hljs-comment"># 限制修改数量</span>
grit apply --<span class="hljs-built_in">limit</span> 10 no_console_log src/

<span class="hljs-comment"># 紧凑输出</span>
grit apply --output compact no_console_log src/

<span class="hljs-comment"># 交互式选择（逐个确认）</span>
grit apply --interactive no_console_log src/

<span class="hljs-comment"># JSONL 格式输出</span>
grit apply --jsonl no_console_log src/
</code></pre>
<h3 data-id="heading-7">grit list - 列出可用 Patterns</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 列出所有 patterns</span>
grit list

<span class="hljs-comment"># 仅列出 JavaScript/TypeScript patterns</span>
grit list --language js

<span class="hljs-comment"># 仅列出 Python patterns</span>
grit list --language python

<span class="hljs-comment"># 仅列出本地 patterns</span>
grit list --<span class="hljs-built_in">source</span> <span class="hljs-built_in">local</span>
</code></pre>
<h3 data-id="heading-8">grit check - 检查代码</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查当前目录</span>
grit check

<span class="hljs-comment"># 自动修复</span>
grit check --fix

<span class="hljs-comment"># 详细输出</span>
grit check --verbose
</code></pre>
<h3 data-id="heading-9">其他有用命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 描述某个 pattern</span>
grit patterns describe no_console_log

<span class="hljs-comment"># 列出 patterns</span>
grit patterns list

<span class="hljs-comment"># 诊断环境</span>
grit doctor
</code></pre>
<hr/>
<h2 data-id="heading-10">核心语法</h2>
<h3 data-id="heading-11">代码片段模式</h3>
<p>最基本的模式是用反引号包裹的代码片段：</p>
<pre><code class="hljs language-gritql" lang="gritql">`console.log('Hello')`
</code></pre>
<p><strong>结构化匹配</strong>意味着 Grit 忽略格式差异，以下都会被匹配：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Hello'</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span> ( <span class="hljs-string">'Hello'</span> )     <span class="hljs-comment">// 换行和空格不影响</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Hello"</span>)         <span class="hljs-comment">// 单双引号等价</span>
</code></pre>
<h3 data-id="heading-12">变量系统</h3>
<p>使用 <code>$</code> 前缀定义变量，匹配任意内容：</p>
<pre><code class="hljs language-gritql" lang="gritql">`console.$method($msg)`      // 匹配 console 的任何方法调用
</code></pre>
<p><strong>变量复用规则</strong>：同一变量多次出现必须匹配相同值</p>
<pre><code class="hljs language-gritql" lang="gritql">`$obj &amp;&amp; $obj.$prop()`       // foo &amp;&amp; foo.bar() ✓
                              // foo &amp;&amp; bar.baz()   ✗
</code></pre>
<h3 data-id="heading-13">条件过滤</h3>
<p>使用 <code>where</code> 子句精确控制匹配范围：</p>
<pre><code class="hljs language-gritql" lang="gritql">`console.$method($msg)` where {
  $method &lt;: or { `log`, `warn` }    // 只匹配 log 和 warn
}
</code></pre>
<h3 data-id="heading-14">转换语法</h3>
<p>使用 <code>=&gt;</code> 进行代码转换：</p>
<pre><code class="hljs language-gritql" lang="gritql">`旧代码($args)` =&gt; `新代码($args)`
</code></pre>
<hr/>
<h2 data-id="heading-15">实战案例</h2>
<h3 data-id="heading-16">案例 1：清理 console 调试语句</h3>
<p>最简单的场景 —— 直接删除匹配的代码。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'fetching data...'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-string">'state:'</span>, state);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'API called'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Critical error'</span>);  <span class="hljs-comment">// 保留</span>

<span class="hljs-comment">// 转换后</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Critical error'</span>);
</code></pre>
<p><strong>使用标准库 pattern（推荐）</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">grit apply no_console_log src/
</code></pre>
<p><strong>自定义 GritQL 规则</strong>：</p>
<pre><code class="hljs language-gritql" lang="gritql">`console.log($a)` =&gt; ``
`console.debug($a)` =&gt; ``
`console.info($a)` =&gt; ``
</code></pre>
<blockquote>
<p><strong>注意</strong>: 标准库的 <code>no_console_log</code> 会自动保留 catch 块中的 console.log，更加安全。</p>
</blockquote>
<hr/>
<h3 data-id="heading-17">案例 2：Python print 转 logger</h3>
<p>将 Python 中的 <code>print</code> 语句转换为 logger 调用。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 转换前</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello, World"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"User: <span class="hljs-subst">{username}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Error:"</span>, error)

<span class="hljs-comment"># 转换后</span>
log(<span class="hljs-string">"Hello, World"</span>)
log(<span class="hljs-string">f"User: <span class="hljs-subst">{username}</span>"</span>)
log(<span class="hljs-string">"Error:"</span>, error)
</code></pre>
<p><strong>使用标准库 pattern</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">grit apply --language python print_to_log src/
</code></pre>
<hr/>
<h3 data-id="heading-18">案例 3：移除 debugger 语句</h3>
<p>清理开发时留下的 debugger 语句。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processData</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">debugger</span>;  <span class="hljs-comment">// 调试用</span>
    <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x * <span class="hljs-number">2</span>);
}

<span class="hljs-comment">// 转换后</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processData</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x * <span class="hljs-number">2</span>);
}
</code></pre>
<p><strong>使用标准库 pattern</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">grit apply no_debugger src/
</code></pre>
<hr/>
<h3 data-id="heading-19">案例 4：import 路径调整</h3>
<p>项目目录重构时的常见需求 —— 批量更新 import 路径。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ui/Button'</span>
<span class="hljs-keyword">import</span> { useAuth } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/useAuth'</span>
<span class="hljs-keyword">import</span> { formatDate } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/date'</span>

<span class="hljs-comment">// 转换后</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/Button'</span>
<span class="hljs-keyword">import</span> { useAuth } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/auth'</span>
<span class="hljs-keyword">import</span> { formatDate } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/format'</span>
</code></pre>
<p><strong>GritQL 规则</strong>：</p>
<pre><code class="hljs language-gritql" lang="gritql">`from '@/components/ui/$name'` =&gt; `from '@/components/$name'`
`from '@/hooks/use$name'` =&gt; `from '@/hooks/$name'`
`from '@/utils/date'` =&gt; `from '@/utils/format'`
</code></pre>
<hr/>
<h3 data-id="heading-20">案例 5：箭头函数简化</h3>
<blockquote>
<p>⚠️ <strong>限制</strong>：内联 pattern 对多参数函数的处理有限制，建议仅用于单参数场景。</p>
</blockquote>
<p>单行返回的箭头函数可以省略 <code>return</code> 和大括号。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">double</span> = x =&gt; { <span class="hljs-keyword">return</span> x * <span class="hljs-number">2</span>; }
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getValue</span> = (<span class="hljs-params"/>) =&gt; { <span class="hljs-keyword">return</span> config.<span class="hljs-property">value</span>; }

<span class="hljs-comment">// 转换后</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">double</span> = x =&gt; x * <span class="hljs-number">2</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getValue</span> = (<span class="hljs-params"/>) =&gt; config.<span class="hljs-property">value</span>
</code></pre>
<p><strong>异步箭头函数</strong>：可以去除 <code>async</code> 和 <code>await</code>（当直接返回 Promise 时）。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; { <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>); }

<span class="hljs-comment">// 转换后</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getData</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>)
</code></pre>
<blockquote>
<p><strong>说明</strong>：当函数只是直接返回 <code>await</code> 的结果时，<code>async/await</code> 是冗余的。</p>
</blockquote>
<p><strong>GritQL 规则</strong>：</p>
<pre><code class="hljs language-gritql" lang="gritql"># 单参数箭头函数（推荐）
`$param =&gt; { return $expr }` =&gt; `$param =&gt; $expr`

# 无参数箭头函数
`() =&gt; { return $expr }` =&gt; `() =&gt; $expr`

# 异步箭头函数 - 去除 async/await
`async () =&gt; { return await $expr }` =&gt; `() =&gt; $expr`
</code></pre>
<p><strong>注意</strong>：多参数函数 <code>(a, b) =&gt; ...</code> 的转换存在括号处理问题，建议手动处理或使用 .grit 文件。</p>
<hr/>
<h3 data-id="heading-21">案例 6：框架升级迁移</h3>
<p>Grit 提供了丰富的框架升级 patterns，可自动化常见的迁移工作。</p>
<h4 data-id="heading-22">React 升级</h4>













































<table><thead><tr><th>迁移类型</th><th>Pattern</th><th>命令</th></tr></thead><tbody><tr><td>类组件 → Hooks</td><td><code>react_to_hooks</code></td><td><code>grit apply react_to_hooks src/</code></td></tr><tr><td>React Query v3 → v4</td><td><code>migrating_from_react_query_3_to_react_query_4</code></td><td><code>grit apply migrating_from_react_query_3_to_react_query_4 src/</code></td></tr><tr><td>MUI v4 → v5</td><td><code>mui4_to_mui5</code></td><td><code>grit apply mui4_to_mui5 src/</code></td></tr><tr><td>Knockout → React</td><td><code>knockout_to_react</code></td><td><code>grit apply knockout_to_react src/</code></td></tr><tr><td>Jest → Vitest</td><td><code>jest_to_vitest</code></td><td><code>grit apply jest_to_vitest src/</code></td></tr><tr><td>Chai → Jest</td><td><code>chai_to_jest</code></td><td><code>grit apply chai_to_jest src/</code></td></tr><tr><td>Enzyme → RTL</td><td><code>enzyme_rtl</code></td><td><code>grit apply enzyme_rtl src/</code></td></tr></tbody></table>
<p><strong>React 类组件转 Hooks 示例</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
  state = { <span class="hljs-attr">users</span>: [], <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> }
  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fetchUsers</span>()
  }
  <span class="hljs-title function_">fetchUsers</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span> })
    api.<span class="hljs-title function_">getUsers</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">users</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ users, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> }))
  }
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">loading</span>) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{this.state.users.length} users<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  }
}

<span class="hljs-comment">// 转换后</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserList</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [users, setUsers] = <span class="hljs-title function_">useState</span>([])
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetchUsers</span>()
  }, [])

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUsers</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>)
    api.<span class="hljs-title function_">getUsers</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> { <span class="hljs-title function_">setUsers</span>(data); <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>) })
  }

  <span class="hljs-keyword">if</span> (loading) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{users.length} users<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p><strong>使用命令</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 预览转换结果</span>
grit apply --dry-run react_to_hooks src/

<span class="hljs-comment"># 执行转换</span>
grit apply react_to_hooks src/

<span class="hljs-comment"># 交互式选择（逐个确认）</span>
grit apply --interactive react_to_hooks src/
</code></pre>
<h4 data-id="heading-23">Vue 升级</h4>
<p>Vue 相关的迁移 pattern 较少，建议手动或配合其他工具进行 Vue 2 → Vue 3 的升级。</p>
<h4 data-id="heading-24">其他迁移</h4>








































<table><thead><tr><th>迁移类型</th><th>Pattern</th><th>命令</th></tr></thead><tbody><tr><td>Cypress → Playwright</td><td><code>cypress_to_playwright</code></td><td><code>grit apply cypress_to_playwright src/</code></td></tr><tr><td>Protractor → Playwright</td><td><code>protractor_to_playwright</code></td><td><code>grit apply protractor_to_playwright src/</code></td></tr><tr><td>CodeceptJS → Playwright</td><td><code>codecept_to_playwright</code></td><td><code>grit apply codecept_to_playwright src/</code></td></tr><tr><td>Moment → date-fns</td><td><code>moment_to_datefns</code></td><td><code>grit apply moment_to_datefns src/</code></td></tr><tr><td>io-ts → Zod</td><td><code>iots_to_zod</code></td><td><code>grit apply iots_to_zod src/</code></td></tr><tr><td>OpenAI v3 → v4</td><td><code>openai_v4</code></td><td><code>grit apply openai_v4 src/</code></td></tr></tbody></table>
<p><strong>使用示例</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Jest 迁移到 Vitest</span>
grit apply --dry-run jest_to_vitest src/
grit apply jest_to_vitest src/

<span class="hljs-comment"># OpenAI SDK 升级</span>
grit apply --dry-run openai_v4 src/
grit apply openai_v4 src/

<span class="hljs-comment"># 测试框架迁移（Cypress → Playwright）</span>
grit apply --dry-run cypress_to_playwright tests/
grit apply cypress_to_playwright tests/
</code></pre>
<hr/>
<h3 data-id="heading-25">案例 7：对象简写属性</h3>
<blockquote>
<p>⚠️ <strong>限制</strong>：必须使用 <code>.grit</code> 文件，内联语法不支持，且转换后需要人工检查。</p>
</blockquote>
<p>ES6 允许属性名和变量名相同时省略冒号。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-keyword">const</span> user = { <span class="hljs-attr">name</span>: name, <span class="hljs-attr">age</span>: age, <span class="hljs-attr">userId</span>: id }
<span class="hljs-keyword">return</span> { <span class="hljs-attr">data</span>: data, <span class="hljs-attr">isLoading</span>: loading }

<span class="hljs-comment">// 转换后</span>
<span class="hljs-keyword">const</span> user = { name, age, <span class="hljs-attr">userId</span>: id }
<span class="hljs-keyword">return</span> { data, <span class="hljs-attr">isLoading</span>: loading }
</code></pre>
<p><strong>创建 <code>shorthand.grit</code> 文件</strong>：</p>
<pre><code class="hljs language-grit" lang="grit"># 指定使用的引擎版本（marzano 是 Grit 的匹配引擎）
engine marzano(0.1)
# 指定目标语言
language js

`{ $props }` where {
  $props &lt;: some {
    `$k: $k` =&gt; `$k`
  }
}
</code></pre>
<blockquote>
<p><strong><code>engine marzano(0.1)</code></strong>：Grit 的匹配引擎版本，所有 <code>.grit</code> 文件都需要在开头声明。</p>
</blockquote>
<p><strong>使用方式</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 应用转换（可能需要运行多次直到所有属性都转换完成）</span>
grit apply shorthand.grit src/
</code></pre>
<p><strong>测试结果</strong>：</p>
<ul>
<li>✅ 可以匹配并转换 <code>{ name: name }</code> → <code>{ name }</code></li>
<li>⚠️ 多个属性需要运行多次才能全部转换</li>
<li>⚠️ 转换后建议人工检查结果</li>
</ul>
<hr/>
<h2 data-id="heading-26">常用标准 Patterns</h2>
<p>Grit 提供了丰富的标准 patterns 库，使用 <code>grit list</code> 查看。</p>
<h3 data-id="heading-27">JavaScript/TypeScript 常用 Patterns</h3>























































<table><thead><tr><th>Pattern</th><th>说明</th><th>命令</th></tr></thead><tbody><tr><td><code>no_console_log</code></td><td>移除 <code>console.log</code></td><td><code>grit apply no_console_log</code></td></tr><tr><td><code>no_debugger</code></td><td>移除 <code>debugger</code></td><td><code>grit apply no_debugger</code></td></tr><tr><td><code>no_alert</code></td><td>移除 <code>alert()</code></td><td><code>grit apply no_alert</code></td></tr><tr><td><code>no_commented_out_code</code></td><td>移除注释代码</td><td><code>grit apply no_commented_out_code</code></td></tr><tr><td><code>es6_imports</code></td><td>转换为 ES6 imports</td><td><code>grit apply es6_imports</code></td></tr><tr><td><code>es6_exports</code></td><td>转换为 ES6 exports</td><td><code>grit apply es6_exports</code></td></tr><tr><td><code>jest_to_vitest</code></td><td>Jest 迁移到 Vitest</td><td><code>grit apply jest_to_vitest</code></td></tr><tr><td><code>chai_to_jest</code></td><td>Chai 迁移到 Jest</td><td><code>grit apply chai_to_jest</code></td></tr><tr><td><code>openai_v4</code></td><td>OpenAI v4 迁移</td><td><code>grit apply openai_v4</code></td></tr></tbody></table>
<h3 data-id="heading-28">Python 常用 Patterns</h3>






























<table><thead><tr><th>Pattern</th><th>说明</th><th>命令</th></tr></thead><tbody><tr><td><code>print_to_log</code></td><td>print 转 logger</td><td><code>grit apply --language python print_to_log</code></td></tr><tr><td><code>py_no_debugger</code></td><td>移除 <code>pdb.set_trace()</code></td><td><code>grit apply py_no_debugger</code></td></tr><tr><td><code>no_skipped_tests</code></td><td>移除跳过的测试</td><td><code>grit apply no_skipped_tests</code></td></tr><tr><td><code>openai</code></td><td>OpenAI SDK 迁移</td><td><code>grit apply openai</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-29">支持的语言</h2>
<p>Grit 支持以下编程语言（使用 <code>--language</code> 选项指定）：</p>
<h3 data-id="heading-30">语言列表</h3>

























































































<table><thead><tr><th>标识符</th><th>语言</th></tr></thead><tbody><tr><td><code>js</code></td><td>JavaScript / TypeScript / JSX / TSX</td></tr><tr><td><code>html</code></td><td>HTML</td></tr><tr><td><code>css</code></td><td>CSS</td></tr><tr><td><code>json</code></td><td>JSON</td></tr><tr><td><code>java</code></td><td>Java</td></tr><tr><td><code>kotlin</code></td><td>Kotlin</td></tr><tr><td><code>csharp</code></td><td>C#</td></tr><tr><td><code>python</code></td><td>Python</td></tr><tr><td><code>markdown</code></td><td>Markdown</td></tr><tr><td><code>go</code></td><td>Go</td></tr><tr><td><code>rust</code></td><td>Rust</td></tr><tr><td><code>ruby</code></td><td>Ruby</td></tr><tr><td><code>elixir</code></td><td>Elixir</td></tr><tr><td><code>solidity</code></td><td>Solidity</td></tr><tr><td><code>hcl</code></td><td>HCL</td></tr><tr><td><code>yaml</code></td><td>YAML</td></tr><tr><td><code>sql</code></td><td>SQL</td></tr><tr><td><code>vue</code></td><td>Vue</td></tr><tr><td><code>toml</code></td><td>TOML</td></tr><tr><td><code>php</code></td><td>PHP</td></tr></tbody></table>
<h3 data-id="heading-31">使用示例</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Python 项目 - 将 print 转换为 logger</span>
grit apply --language python print_to_log src/

<span class="hljs-comment"># Go 项目 - 移除 debugger 语句</span>
grit apply --language go no_debugger src/

<span class="hljs-comment"># Java 项目 - 列出可用的 Java patterns</span>
grit list --language java

<span class="hljs-comment"># Rust 项目 - 应用自定义 pattern</span>
grit apply --language rust ./patterns/custom.grit src/

<span class="hljs-comment"># Vue 项目 - 检查代码规范</span>
grit check --language vue src/

<span class="hljs-comment"># 多语言项目 - 同时处理多种文件类型</span>
grit apply --language js no_console_log src/
grit apply --language python print_to_log src/

<span class="hljs-comment"># 查看某个语言的可用 patterns</span>
grit patterns list --language python
</code></pre>
<hr/>
<h2 data-id="heading-32">工作流最佳实践</h2>
<h3 data-id="heading-33">推荐工作流程</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 列出可用的 patterns</span>
grit list --language js

<span class="hljs-comment"># 2. 查看 pattern 详情</span>
grit patterns describe no_console_log

<span class="hljs-comment"># 3. 预览模式（不会修改文件）</span>
grit apply --dry-run no_console_log src/

<span class="hljs-comment"># 4. 限制范围测试</span>
grit apply no_console_log src/components/

<span class="hljs-comment"># 5. 交互式应用（逐个确认）</span>
grit apply --interactive no_console_log src/

<span class="hljs-comment"># 6. 确认后正式应用</span>
grit apply no_console_log src/
</code></pre>
<h3 data-id="heading-34">使用配置文件</h3>
<p>创建 <code>.grit/grit.yaml</code> 管理项目规则：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">patterns:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">no_console_log</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">no_debugger</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">.grit/patterns/**/*.grit</span>

<span class="hljs-attr">ignored:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">node_modules/**</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">dist/**</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">build/**</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"**/*.min.js"</span>

<span class="hljs-attr">enforcement:</span>
  <span class="hljs-attr">level:</span> <span class="hljs-string">fix</span>
</code></pre>
<h3 data-id="heading-35">CI 集成</h3>
<p>在 GitHub Actions 中集成代码检查：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Grit</span> <span class="hljs-string">Code</span> <span class="hljs-string">Quality</span>

<span class="hljs-attr">on:</span> [<span class="hljs-string">pull_request</span>]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">grit-check:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Grit</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">-g</span> <span class="hljs-string">@getgrit/cli</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Check</span> <span class="hljs-string">code</span> <span class="hljs-string">patterns</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">grit</span> <span class="hljs-string">check</span> <span class="hljs-string">--github-actions</span>
</code></pre>
<hr/>
<h2 data-id="heading-36">工作原理</h2>
<h3 data-id="heading-37">处理流程</h3>
<pre><code class="hljs language-scss" lang="scss">源代码
    ↓
┌─────────────────────────────────────┐
│  Tree-sitter 解析器                 │
│  (多语言支持，增量解析)              │
└─────────────────────────────────────┘
    ↓ AST
┌─────────────────────────────────────┐
│  Grit 模式匹配引擎                  │
│  (变量绑定，条件过滤)                │
└─────────────────────────────────────┘
    ↓ 匹配结果
┌─────────────────────────────────────┐
│  AST 转换引擎                       │
│  (语义保持，结构转换)                │
└─────────────────────────────────────┘
    ↓ 修改后的 AST
┌─────────────────────────────────────┐
│  代码生成器                         │
│  (保留格式，生成代码)                │
└─────────────────────────────────────┘
    ↓
转换后代码
</code></pre>
<h3 data-id="heading-38">为什么比正则更安全？</h3>



































<table><thead><tr><th>特性</th><th>正则表达式</th><th>Grit</th></tr></thead><tbody><tr><td>理解代码结构</td><td>❌</td><td>✅</td></tr><tr><td>忽略空白/引号差异</td><td>❌</td><td>✅</td></tr><tr><td>变量绑定与复用</td><td>❌</td><td>✅</td></tr><tr><td>AST 感知</td><td>❌</td><td>✅</td></tr><tr><td>语义安全</td><td>❌</td><td>✅</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-39">常见问题</h2>
<p><strong>Q: 转换会破坏代码格式吗？</strong></p>
<p>A: 不会。Grit 保留原始格式，只修改语义结构。</p>
<p><strong>Q: 内联 pattern 怎么写？</strong></p>
<p>A: 使用单引号包裹整个 pattern（反引号内是匹配代码）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 正确 - 单引号包裹，shell 不会解析反引号</span>
grit apply <span class="hljs-string">'`console.log($_)`'</span> file.js

<span class="hljs-comment"># 错误 - shell 会尝试执行反引号内的命令</span>
grit apply `console.log(<span class="hljs-variable">$_</span>)` file.js
</code></pre>
<p><strong>Q: 如何查看所有可用的 patterns？</strong></p>
<p>A: 使用 <code>grit list</code> 命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 列出所有</span>
grit list

<span class="hljs-comment"># 按语言过滤</span>
grit list --language js
grit list --language python
</code></pre>
<p><strong>Q: <code>--json</code> 和 <code>--jsonl</code> 有什么区别？</strong></p>
<p>A: <code>--json</code> 目前不被 <code>apply_pattern</code> 支持，使用 <code>--jsonl</code> 获取 JSON Lines 格式输出。</p>
<p><strong>Q: 如何限制修改数量？</strong></p>
<p>A: 使用 <code>--limit</code> 选项：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 只修改前 10 处</span>
grit apply --<span class="hljs-built_in">limit</span> 10 no_console_log src/
</code></pre>
<p><strong>Q: 如何安全地进行大规模转换？</strong></p>
<p>A: 建议按以下步骤：</p>
<ol>
<li>先用 <code>--dry-run</code> 预览</li>
<li>用 <code>--limit</code> 小范围测试</li>
<li>用 <code>--interactive</code> 交互式确认</li>
<li>确认无误后正式应用</li>
</ol>
<hr/>
<h2 data-id="heading-40">总结</h2>
<p>Grit 的核心价值在于：</p>
<ol>
<li><strong>简单</strong> - 用代码片段写规则，无需懂 AST</li>
<li><strong>安全</strong> - 结构化匹配，不会误伤代码</li>
<li><strong>高效</strong> - 秒级完成大规模代码迁移</li>
<li><strong>可维护</strong> - 规则即文档，易于 review</li>
<li><strong>丰富</strong> - 内置大量标准 patterns，开箱即用</li>
</ol>
<p>下次遇到代码迁移任务，不妨试试 Grit，让繁琐的重构工作变得轻松高效。</p>
<hr/>
<h2 data-id="heading-41">参考资源</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgrit.io%2F" target="_blank" title="https://grit.io/" ref="nofollow noopener noreferrer">Grit 官网</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.grit.io%2F" target="_blank" title="https://docs.grit.io/" ref="nofollow noopener noreferrer">Grit 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbiomejs%2Fgritql-stdlib" target="_blank" title="https://github.com/biomejs/gritql-stdlib" ref="nofollow noopener noreferrer">Grit 标准 Patterns 库</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbiomejs%2Fgritql" target="_blank" title="https://github.com/biomejs/gritql" ref="nofollow noopener noreferrer">Grit GitHub</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025京东零售技术年度精选 | 技术干货篇（内含福利）]]></title>    <link>https://juejin.cn/post/7589823928414257178</link>    <guid>https://juejin.cn/post/7589823928414257178</guid>    <pubDate>2025-12-31T10:40:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589823928414257178" data-draft-id="7589835342145519626" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025京东零售技术年度精选 | 技术干货篇（内含福利）"/> <meta itemprop="keywords" content="前端,后端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-31T10:40:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东零售技术"/> <meta itemprop="url" content="https://juejin.cn/user/4233576972293643"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025京东零售技术年度精选 | 技术干货篇（内含福利）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4233576972293643/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东零售技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T10:40:32.000Z" title="Wed Dec 31 2025 10:40:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年即将结束，京东零售技术感谢您一路同行。今年我们共发布100余篇文章，并精选10篇技术好文与您分享。新的一年，我们将继续输出硬核干货，陪伴每一位技术人在探索之路上前行。<br/>
在文末我们也为大家准备了一些礼物，期待你的参与。
2026，我们继续携手，共赴新程。</p>
<p><strong>01、供应链的"智能大脑"：京东供应链智能规划算法详解</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9269820bf12f48969ff175520e33226f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767782432&amp;x-signature=LNez14gsPEF1uEEgUXR0R0gHERQ%3D" alt="图片" loading="lazy"/></p>
<p>本文聚焦运筹优化和仿真算法在供应链规划中的应用，通过智能规划算法赋能供应链规划业务，为成本优化、效率提升和用户体验优化提供了算法能力支持。分享了在仓网规划、库存布局和供应链仿真等场景下的技术解决方案，以及在大规模问题优化和仿真技术的创新突破，为业务决策提供了通用且高效的算法能力。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUyMDAxMjQ3Ng%3D%3D%26mid%3D2247512861%26idx%3D1%26sn%3D583b58c320950c17db1709e048d43eb4%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUyMDAxMjQ3Ng==&amp;mid=2247512861&amp;idx=1&amp;sn=583b58c320950c17db1709e048d43eb4&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">（</a>阅读原文）</p>
<p><strong>02、京东自研电商数据库内核DongSQL简介</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60af32b551814bc6a30ed5e7e42e3721~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767782432&amp;x-signature=gk9UZvmoZfUo4pUGoMcNT50e%2BRU%3D" alt="图片" loading="lazy"/></p>
<p>从开源内核到自研DongSQL，京东零售数据库团队始终以"业务价值驱动技术创新"为核心理念。DongSQL作为专为京东电商场景设计的数据库，通过语法扩展、并发控制、查询优化等多个模块的深度创新，为电商业务的快速发展提供了强有力的数据库技术支撑。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUyMDAxMjQ3Ng%3D%3D%26mid%3D2247514462%26idx%3D1%26sn%3D391dc9c96cf75e2f2cfd3878aafda6ba%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUyMDAxMjQ3Ng==&amp;mid=2247514462&amp;idx=1&amp;sn=391dc9c96cf75e2f2cfd3878aafda6ba&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">（阅读全文</a>）</p>
<p><strong>03、京东零售重磅开源 | OxyGent：像搭乐高一样组装AI团队，实现群体智能</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1222aa0310c74c52aa849262329d22cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767782432&amp;x-signature=2nhuq7QBBqGsFg2RYHlYFNDkYTI%3D" alt="图片" loading="lazy"/></p>
<p>京东零售Oxygen团队正式开源发布多智能体协作框架——OxyGent。这一创新框架致力于帮助开发者高效组装多智能体协作系统，实现智能体间的无缝协作、弹性扩展与全链路可追溯。推动人工智能从“单点突破”迈向“群体智能”时代。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUyMDAxMjQ3Ng%3D%3D%26mid%3D2247513377%26idx%3D1%26sn%3Db115c5f887f5abeb9c1eb80310220ca7%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUyMDAxMjQ3Ng==&amp;mid=2247513377&amp;idx=1&amp;sn=b115c5f887f5abeb9c1eb80310220ca7&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">（阅读全文）</a></p>
<p><strong>04、探索无限可能：生成式推荐的演进、前沿与挑战</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39ec25c68ed7458799b88f9c8cc9d205~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767782432&amp;x-signature=AgYgeGzZQIsm2ORH06BIlE3taA8%3D" alt="图片" loading="lazy"/></p>
<p>本文系统全面地介绍了基于LLM的生成式推荐系统（GRs）的演进历程、前沿核心技术要点、关键工程落地挑战以及未来探索方向等内容，旨在帮助读者系统理解GRs在“是什么”（What）、“为什么”（Why）和“怎么做”（How）三个关键维度上的内涵。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUyMDAxMjQ3Ng%3D%3D%26mid%3D2247513862%26idx%3D1%26sn%3D0a1fd1f4f938ff51760414950eb1fb7a%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUyMDAxMjQ3Ng==&amp;mid=2247513862&amp;idx=1&amp;sn=0a1fd1f4f938ff51760414950eb1fb7a&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">（阅读全文）</a></p>
<p><strong>05、AI Agent实战：打造京东广告主的超级助手 | 京东零售技术实践</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af41057f3359428380e4a3a5339f05c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767782432&amp;x-signature=rIxq4hEgdZIofWbOHQkubsvKvlM%3D" alt="图片" loading="lazy"/></p>
<p>京东广告在Agent应用上的一些工程化实践，通过构建RAG、Function Call等核心能力，为京准通智能助手业务提供AI 超能力，并为广大商家赋能。下一步，我们还将推动多Agent架构升级，为更多专业的Agent能力接入铺平道路，促进智能助手能力的持续提升，为商家提供更智能化的产品。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUyMDAxMjQ3Ng%3D%3D%26mid%3D2247511991%26idx%3D1%26sn%3D2a92ff18a93e607e356f970efa1c50bb%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUyMDAxMjQ3Ng==&amp;mid=2247511991&amp;idx=1&amp;sn=2a92ff18a93e607e356f970efa1c50bb&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">（阅读全文）</a></p>
<p><strong>06、1秒响应、90%决策准确率！京东商家智能助手的技术探索</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ab2695cf0534ceba00f5df73c039b1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767782432&amp;x-signature=ipDi1hXMkM0YfhJtrP57Aqon0qA%3D" alt="图片" loading="lazy"/></p>
<p>本文介绍京东商家智能助手，其基于大语言模型构建 Multi-agent 系统，历经三代架构演进，通过任务分层规划、多智能体协同、全链路评估等技术，实现 7*24 小时秒级响应，决策准确率超 90%，覆盖商家经营全流程，为电商垂域提供高效智能服务。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUyMDAxMjQ3Ng%3D%3D%26mid%3D2247511914%26idx%3D1%26sn%3Dd0c5d60e7b276e3d3abf55ad6db20acc%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUyMDAxMjQ3Ng==&amp;mid=2247511914&amp;idx=1&amp;sn=d0c5d60e7b276e3d3abf55ad6db20acc&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">（阅读全文）</a></p>
<p><strong>07、ClickHouse 的“独孤九剑”：极速查询的终极秘籍</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99e7ce9963ed4d9c9657d82b5a9ef96e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767782432&amp;x-signature=J5ig67T0Xw5%2BKlEx24ZRZ3PSxxc%3D" alt="图片" loading="lazy"/></p>
<p>在大数据时代的江湖，数据量呈爆炸式增长，如何高效地处理和分析海量数据成为了一个关键问题。各路英雄豪杰纷纷亮出自己的绝技，争夺数据处理的巅峰宝座。而在这场激烈的角逐中，ClickHouse 以其“独孤九剑”般的绝世武功，横空出世，令群雄侧目。ClickHouse 是一个用于联机分析处理（OLAP）的开源分布式数据管理系统。它由俄罗斯的 Yandex 公司开发，为海量数据的实时分析处理提供高效的解决方案。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUyMDAxMjQ3Ng%3D%3D%26mid%3D2247512513%26idx%3D1%26sn%3D911384880b9808b652745f2cea4e3f1d%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUyMDAxMjQ3Ng==&amp;mid=2247512513&amp;idx=1&amp;sn=911384880b9808b652745f2cea4e3f1d&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">（阅读全文）</a></p>
<p><strong>08、Text2SQL准确率暴涨22.6%！独家拆解3大核心技术突破</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fbedb8c72cd4ff1863ccdb7da8a9c71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767782432&amp;x-signature=JFivMYFpCHDlWdnIkuzbtqTPU6s%3D" alt="图片" loading="lazy"/></p>
<p>本文提出 J-Schema 呈现数据库结构并合理提供示例值，结合思维链引导模型推理。采用 Iterative DPO 迭代训练，多轮迭代提升性能。用自洽性方法，通过硬 / 软投票从多个候选答案中选最优，软投票更优。解决 Text2SQL 性能提升的三大难题，将模型在 BIRD 数据集上的执行准确率从50%多提升至近70%。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUyMDAxMjQ3Ng%3D%3D%26mid%3D2247513488%26idx%3D1%26sn%3D3b914d15b8c2d689bd0ab9de629551ae%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUyMDAxMjQ3Ng==&amp;mid=2247513488&amp;idx=1&amp;sn=3b914d15b8c2d689bd0ab9de629551ae&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">（阅读全文）</a></p>
<p><strong>09、Taro on Harmony：揭秘京东鸿蒙版如何做到"原生级"性能体验</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9e41c518fd2407baceccefb079c062b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767782432&amp;x-signature=hoL8pLYzDDZou5kz4KmAO38AiPI%3D" alt="图片" loading="lazy"/></p>
<p>Taro 鸿蒙方案基于鸿蒙 CAPI 进行构建，实现了将 React DSL 直接对接到 C++ 侧来运行整体渲染管线，从而实现了与原生齐平的渲染性能，同时 Taro 鸿蒙方案是多线程架构的方案，在应用渲染性能、操作响应时延上都在业界做到极致，并且 Taro 鸿蒙方案支持动态更新，是行业首创且经过大规模 APP 应用场景验证的开发框架，综合性能、生态以及开发体验来讲，毫无疑问已经成为了开发鸿蒙应用的最佳框架选型之一。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUyMDAxMjQ3Ng%3D%3D%26mid%3D2247512767%26idx%3D1%26sn%3D48a99a495b5e427fb52f62e6c087c717%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUyMDAxMjQ3Ng==&amp;mid=2247512767&amp;idx=1&amp;sn=48a99a495b5e427fb52f62e6c087c717&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">（阅读全文）</a></p>
<p><strong>10、架构提效的矛盾和矛盾的主要方面</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/548f419aed9e44539a1377dcb0ca52b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767782432&amp;x-signature=zHtY%2FsoT20xqzq3RUKI%2FCAvmqgU%3D" alt="图片" loading="lazy"/></p>
<p>在软件开发领域，架构设计是确保系统高效、稳定运行的重要环节或者称之为重要动作。无论架构从简单到复杂，还是从复杂回归简洁的演变过程。在这个过程中，又无论是初创公司还是大型企业，架构提效始终是技术团队的核心追求。本文将从稳定、性能、代码三大维度出发，结合实战经验，探讨如何有效提升架构效能。<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUyMDAxMjQ3Ng%3D%3D%26mid%3D2247511559%26idx%3D1%26sn%3D9d7a48d8d0ca8f80befb42c1640f37b9%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUyMDAxMjQ3Ng==&amp;mid=2247511559&amp;idx=1&amp;sn=9d7a48d8d0ca8f80befb42c1640f37b9&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">（阅读全文）</a></p>
<p><strong><strong/></strong></p><p align="center"><strong><strong><strong>【互动福利】</strong></strong></strong></p><p/>
<p><strong/></p><p align="center"><strong><strong>活动一</strong></strong></p><p/>
<p>关注【京东零售技术】公众号，转发本文至朋友圈<strong>集赞20个</strong>，发送点赞截图到后台，抽取3位同学送出定制茶具。</p>
<p><strong/></p><p align="center"><strong><strong>活动二</strong></strong></p><p/>
<p>关注【京东零售技术】公众号，对话框发送 <strong>“年度合集”</strong> <strong>，</strong> 抽取10位同学送出零售技术定制帆布包。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/770e76d72b6c4f14b49ce260ded491e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic6Zu25ZSu5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767782432&amp;x-signature=oR0P4g%2BfSn8jrtXudb7%2Fs9flc3o%3D" alt="图片" loading="lazy"/></p>
<p>欢迎把文章分享到朋友圈，让更多人关注京东零售技术（开奖时间：2026年1月16日</p>
<p>阅读原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F_x6SQABlvn2zhVcjgiQ2GA" target="_blank" title="https://mp.weixin.qq.com/s/_x6SQABlvn2zhVcjgiQ2GA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/_x6SQABlv…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026最新React技术栈梳理，全栈必备]]></title>    <link>https://juejin.cn/post/7589564203872534591</link>    <guid>https://juejin.cn/post/7589564203872534591</guid>    <pubDate>2025-12-31T09:09:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589564203872534591" data-draft-id="7589828815939059766" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026最新React技术栈梳理，全栈必备"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-12-31T09:09:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怕浪猫"/> <meta itemprop="url" content="https://juejin.cn/user/2832784963939438"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026最新React技术栈梳理，全栈必备
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2832784963939438/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怕浪猫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T09:09:37.000Z" title="Wed Dec 31 2025 09:09:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>2025年的React生态持续迭代，从核心框架的编译器革新到生态工具的性能优化，都带来了诸多实用特性。对于前端开发者而言，精准把握最新技术栈选型，是提升开发效率、构建高性能应用的关键。本文将从「核心基础」「路由方案」「状态管理」「工程化工具」「性能优化」「全栈拓展」六大模块，系统梳理2025年React技术栈的核心内容，每个模块均附上官方链接与实用资源，助力大家快速上手实践。</p>
<h3 data-id="heading-1">一、核心基础：React 19 关键特性</h3>
<p>React 19作为2025年的主流版本，最大亮点是内置编译器的稳定发布与服务器组件的全面普及，彻底改变了传统开发与优化模式。</p>
<h4 data-id="heading-2">1. 核心升级点</h4>
<ul>
<li><strong>自动性能优化</strong>：编译器可自动处理<code>useMemo</code>、<code>useCallback</code>等手动优化逻辑，开发者无需关注底层优化细节，代码量减少30%以上。示例：无需手动缓存回调，编译器自动识别依赖并优化</li>
<li><strong>新Hooks增强</strong>：新增<code>useFormStatus</code>（统一管理表单提交状态）、<code>useOptimistic</code>（乐观更新提升交互体验）、<code>useActionState</code>（集中处理API状态），简化复杂交互逻辑实现。</li>
<li><strong>服务器组件（RSC）</strong> ：在服务器端预渲染组件逻辑，流式传输到客户端，首屏加载时间平均缩短30%，尤其适配低带宽环境。</li>
</ul>
<h4 data-id="heading-3">2. 学习资源</h4>
<p>官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2F" target="_blank" title="https://react.dev/" ref="nofollow noopener noreferrer">React 官方文档（英文）</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.docschina.org%2F" target="_blank" title="https://react.docschina.org/" ref="nofollow noopener noreferrer">React 中文文档</a>；升级指南：<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Fblog%2F2024%2F04%2F25%2Freact-19" target="_blank" title="https://react.dev/blog/2024/04/25/react-19" ref="nofollow noopener noreferrer">React 19 官方发布公告</a></p>
<h3 data-id="heading-4">二、路由方案：从React Router到全场景适配</h3>
<p>路由是SPA应用的核心，2025年React生态的路由方案呈现「功能集成化」「状态一体化」趋势，主流选择仍是React Router，同时Router5等方案在复杂场景中崭露头角。</p>
<h4 data-id="heading-5">1. 主流方案：React Router 7+</h4>
<p>最新版本的React Router强化了与服务器状态的协同，通过Loaders、Actions机制实现前后端数据同步，减少传统缓存方案的冗余性。核心特性：</p>
<ul>
<li><strong>嵌套路由与Outlet</strong>：通过<code>&lt;Outlet&gt;</code>组件实现布局复用，无需重复编写导航栏、页脚等公共组件，适配复杂页面结构。</li>
<li><strong>路由懒加载</strong>：结合<code>React.lazy</code>与<code>&lt;Suspense&gt;</code>实现组件按需加载，搭配Loading占位UI提升用户体验，示例代码：</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { lazy, <span class="hljs-title class_">Suspense</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserRouter</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Router</span>, <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">Home</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./pages/Home'</span>));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">About</span> = <span class="hljs-title function_">lazy</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./pages/About'</span>));

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span> <span class="hljs-attr">fallback</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>
  );
}
</code></pre>
<p><strong>路由状态一体化</strong>：通过<code>useNavigation</code>、<code>useFetcher</code>钩子直接获取导航状态、表单数据，无需额外维护网络相关状态，避免状态冗余。</p>
<h4 data-id="heading-6">2. 进阶方案：Router5</h4>
<p>针对复杂应用的路由管理需求，Router5提出「路由即状态」理念，将路由纳入统一状态管理，实现视图与路由的解耦，支持精准更新与灵活订阅机制。适合中大型团队协作的复杂应用，官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Frouter5.js.org%2F" target="_blank" title="https://router5.js.org/" ref="nofollow noopener noreferrer">Router5 官方文档</a></p>
<h4 data-id="heading-7">3. 实用资源</h4>
<p>React Router 官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Freactrouter.com%2F" target="_blank" title="https://reactrouter.com/" ref="nofollow noopener noreferrer">React Router 7+ 英文文档</a>；实战教程：<a href="https://juejin.cn/post/7530858790523748403" target="_blank" title="https://juejin.cn/post/7530858790523748403">React 路由实战：构建GitHub仓库管理应用</a></p>
<h3 data-id="heading-8">三、状态管理：轻量化与集中化并存</h3>
<p>2025年React状态管理趋势：中小型项目首选轻量化方案，大型项目倾向简洁的集中式管理，传统复杂方案逐渐被替代。</p>
<h4 data-id="heading-9">1. 轻量化方案：useContext + useReducer</h4>
<p>React原生方案，无需引入第三方依赖，通过上下文实现跨层级状态共享，搭配reducer处理复杂状态逻辑，适合中小型项目。优势是学习成本低、代码简洁，示例：创建全局状态上下文。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { createContext, useReducer, useContext } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 1. 创建上下文</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">GlobalContext</span> = <span class="hljs-title function_">createContext</span>();

<span class="hljs-comment">// 2. 定义reducer</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">repoReducer</span>(<span class="hljs-params">state, action</span>) {
  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'FETCH_SUCCESS'</span>:
      <span class="hljs-keyword">return</span> { ...state, <span class="hljs-attr">data</span>: action.<span class="hljs-property">payload</span>, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> };
    <span class="hljs-keyword">case</span> <span class="hljs-string">'FETCH_ERROR'</span>:
      <span class="hljs-keyword">return</span> { ...state, <span class="hljs-attr">error</span>: action.<span class="hljs-property">error</span>, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> };
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> state;
  }
}

<span class="hljs-comment">// 3. 提供状态</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">GlobalProvider</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(repoReducer, {
    <span class="hljs-attr">data</span>: [],
    <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span>
  });
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">GlobalContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">state</span>, <span class="hljs-attr">dispatch</span> }}&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">GlobalContext.Provider</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 4. 消费状态</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useGlobalState</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">GlobalContext</span>);
}
</code></pre>
<h4 data-id="heading-10">2. 集中式方案：Zustand vs Redux</h4>
<ul>
<li><strong>Zustand</strong>：轻量级集中式状态管理库，API简洁，无需冗余的action定义，支持中间件与状态持久化，适合中大型项目快速开发。官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzustand-demo.pmnd.rs%2F" target="_blank" title="https://zustand-demo.pmnd.rs/" ref="nofollow noopener noreferrer">Zustand 官方文档</a>。</li>
<li><strong>Redux</strong>：经典集中式状态管理方案，通过单一状态树与中间件（redux-thunk、redux-saga）处理复杂数据流，适合需要严格分层、多人协作的大型项目。最新版本简化了API，学习成本降低。官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fredux.js.org%2F" target="_blank" title="https://redux.js.org/" ref="nofollow noopener noreferrer">Redux 官方文档</a>。</li>
</ul>
<h4 data-id="heading-11">3. 服务端状态管理：React Query/Apollo</h4>
<p>专注于服务器数据同步，实现数据获取、缓存、更新一体化，减少重复代码。React Query适用于REST API，Apollo适用于GraphQL。官方链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftanstack.com%2Fquery%2Flatest" target="_blank" title="https://tanstack.com/query/latest" ref="nofollow noopener noreferrer">TanStack Query（React Query升级版本）</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.apollographql.com%2Fdocs%2Freact%2F" target="_blank" title="https://www.apollographql.com/docs/react/" ref="nofollow noopener noreferrer">Apollo Client</a></p>
<h3 data-id="heading-12">四、工程化工具：高效开发与构建</h3>
<p>工程化是React项目规模化开发的基础，2025年主流工具聚焦「快速构建」「类型安全」「自动化部署」，Vite逐渐替代Webpack成为中小型项目首选。</p>
<h4 data-id="heading-13">1. 构建工具：Vite vs Webpack</h4>























<table><thead><tr><th>工具</th><th>优势</th><th>适用场景</th><th>官方链接</th></tr></thead><tbody><tr><td>Vite</td><td>冷启动快、热更新高效、配置简洁</td><td>中小型React项目、快速迭代的创业项目</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fvitejs.dev%2F" target="_blank" title="https://vitejs.dev/" ref="nofollow noopener noreferrer">Vite 官方文档</a></td></tr><tr><td>Webpack</td><td>生态完善、定制化能力强、支持复杂构建流程</td><td>大型企业级项目、需要深度定制构建逻辑的项目</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebpack.js.org%2F" target="_blank" title="https://webpack.js.org/" ref="nofollow noopener noreferrer">Webpack 官方文档</a></td></tr></tbody></table>
<h4 data-id="heading-14">2. 类型检查：TypeScript</h4>
<p>70%的React项目已采用TypeScript，静态类型检查可降低40%的Bug率，提升团队协作效率。核心优势：类型提示、代码补全、编译时错误检查。配置指南：<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2Flearn%2Ftypescript" target="_blank" title="https://react.dev/learn/typescript" ref="nofollow noopener noreferrer">React + TypeScript 官方指南</a></p>
<h4 data-id="heading-15">3. 代码规范与测试</h4>
<ul>
<li>代码规范：ESLint（代码检查）+ Prettier（格式美化），统一团队代码风格。配置方案：<a href="https://juejin.cn/post/7530516218337214504" target="_blank" title="https://juejin.cn/post/7530516218337214504">React项目ESLint+Prettier配置实战</a>。</li>
<li>测试工具：Jest（单元测试）+ React Testing Library（组件测试）、Playwright（端到端测试）。官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fjestjs.io%2F" target="_blank" title="https://jestjs.io/" ref="nofollow noopener noreferrer">Jest</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Ftesting-library.com%2Fdocs%2Freact-testing-library%2Fintro%2F" target="_blank" title="https://testing-library.com/docs/react-testing-library/intro/" ref="nofollow noopener noreferrer">React Testing Library</a></li>
</ul>
<h3 data-id="heading-16">五、性能优化：从编译到运行时</h3>
<p>2025年React性能优化已实现「全周期覆盖」，从编译阶段的自动优化到运行时的精准控制，无需开发者手动编写大量优化代码。</p>
<h4 data-id="heading-17">1. 编译阶段：React编译器</h4>
<p>自动识别不必要的重渲染，缓存计算结果与回调函数，替代手动<code>useMemo</code>、<code>useCallback</code>，开发者只需专注业务逻辑。</p>
<h4 data-id="heading-18">2. 运行时优化</h4>
<ul>
<li><strong>长列表优化</strong>：使用React Window/React Virtualized实现列表虚拟化，仅渲染可视区域元素，减少DOM节点数量。官方链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Freact-window.vercel.app%2F" target="_blank" title="https://react-window.vercel.app/" ref="nofollow noopener noreferrer">React Window</a>。</li>
<li><strong>资源加载优化</strong>：React 19支持后台异步加载图像、脚本等资源，结合流式渲染（Streaming SSR），避免阻塞主线程。</li>
<li><strong>缓存控制</strong>：在React Router的Loaders中配置Cache-Control头，利用浏览器原生缓存减少重复请求。</li>
</ul>
<h4 data-id="heading-19">3. 性能监测：Lighthouse</h4>
<p>谷歌开源的性能监测工具，可检测首屏加载时间、交互响应速度等指标，提供优化建议。使用指南：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.chrome.com%2Fdocs%2Flighthouse%2Foverview%2F" target="_blank" title="https://developer.chrome.com/docs/lighthouse/overview/" ref="nofollow noopener noreferrer">Lighthouse 官方文档</a></p>
<h3 data-id="heading-20">六、全栈拓展：React + Next.js</h3>
<p>全栈化是React开发的重要趋势，Next.js作为React的全栈框架，2025年最新版本（Next.js 15）全面支持React 19，提供混合渲染、AI优化、边缘函数等特性，无需独立后端即可构建全栈应用。</p>
<h4 data-id="heading-21">核心特性</h4>
<ul>
<li>混合渲染：支持SSR（服务器端渲染）、SSG（静态生成）、ISR（增量静态生成），适配不同内容场景。</li>
<li>AI驱动优化：内置AI工具链，支持自动代码优化、Figma设计一键转React代码。</li>
<li>边缘函数：在边缘节点运行后端逻辑，降低延迟，支持地理位置感知。</li>
</ul>
<h4 data-id="heading-22">学习资源</h4>
<p>官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2F" target="_blank" title="https://nextjs.org/" ref="nofollow noopener noreferrer">Next.js 15 官方文档</a>；实战项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2Flearn%2Ffoundations%2Ffrom-react-to-nextjs" target="_blank" title="https://nextjs.org/learn/foundations/from-react-to-nextjs" ref="nofollow noopener noreferrer">从React到Next.js 全栈实战</a></p>
<h3 data-id="heading-23">七、2025 React技术栈选型建议</h3>
<p>根据项目规模与场景，推荐以下选型方案，帮助大家快速落地：</p>
<ul>
<li>小型项目/个人项目：React 19 + Vite + React Router 7 + useContext+useReducer</li>
<li>中型项目/创业项目：React 19 + TypeScript + Vite + React Router 7 + Zustand + React Query</li>
<li>大型企业级项目：React 19 + TypeScript + Webpack/Next.js 15 + Redux/Zustand + Apollo + 完整测试体系</li>
</ul>
<h3 data-id="heading-24">总结</h3>
<p>2025年的React技术栈呈现「简洁化」「高效化」「全栈化」的趋势，核心框架的编译器革新降低了优化成本，生态工具的集成化提升了开发效率。作为前端开发者，无需追逐所有新技术，只需根据项目需求选择合适的方案，聚焦业务逻辑实现。希望本文的梳理能帮助大家理清React技术栈的脉络，快速上手最新特性。如果有补充或疑问，欢迎在评论区交流～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[量子计算会彻底改变 AI 的运算方式吗？一场关于"量子幽灵"与"硅基大脑"的深夜对话 🎭💻]]></title>    <link>https://juejin.cn/post/7589564203872550975</link>    <guid>https://juejin.cn/post/7589564203872550975</guid>    <pubDate>2025-12-31T09:10:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589564203872550975" data-draft-id="7589676302124810281" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="量子计算会彻底改变 AI 的运算方式吗？一场关于&quot;量子幽灵&quot;与&quot;硅基大脑&quot;的深夜对话 🎭💻"/> <meta itemprop="keywords" content="人工智能,LLM,AIGC"/> <meta itemprop="datePublished" content="2025-12-31T09:10:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            量子计算会彻底改变 AI 的运算方式吗？一场关于"量子幽灵"与"硅基大脑"的深夜对话 🎭💻
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T09:10:30.000Z" title="Wed Dec 31 2025 09:10:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">序幕：当爱因斯坦的幽灵遇见图灵的机器 👻🤖</h2>
<p>深夜的实验室里，经典计算机的风扇嗡嗡作响，像一位疲惫的老管家在叹息。此时的你，或许正训练着第127个epoch的神经网络，看着loss曲线像蜗牛一样爬行，心里默念："这世上一定存在一条计算捷径！"</p>
<p>没错，那条捷径可能藏在<strong>量子力学</strong>最诡异的角落里。但别急着兴奋，让我们先掀开量子世界的幕布，看看里面到底是一群优雅的舞者，还是一帮喝醉了的电子在开狂欢派对 🎉</p>
<hr/>
<h2 data-id="heading-1">第一章：量子比特的"人格分裂"艺术 🎭</h2>
<h3 data-id="heading-2">经典比特 vs 量子比特：从"非黑即白"到"魔幻现实主义"</h3>
<p>经典比特就像个忠诚的单身狗：<code>0</code> 或 <code>1</code>，泾渭分明，绝不含糊。但量子比特（qubit）？那是个彻头彻尾的"海王"——它同时是 <code>0</code> <strong>和</strong> <code>1</code>，直到你观测它为止。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 经典比特：老实巴交的二进制</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassicalBit</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>; <span class="hljs-comment">// 确定性</span>
  }
  
  <span class="hljs-title function_">measure</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>; <span class="hljs-comment">// 测不测都一样，没惊喜</span>
  }
}

<span class="hljs-comment">// 量子比特：叠加态的社交达人</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">QuantumBit</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">amplitudeZero</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(<span class="hljs-number">0.5</span>); <span class="hljs-comment">// 处于0的概率幅</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">amplitudeOne</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(<span class="hljs-number">0.5</span>);  <span class="hljs-comment">// 处于1的概率幅</span>
    <span class="hljs-comment">// 注意：概率幅的平方才是概率！</span>
    <span class="hljs-comment">// 这就像 electron 既在这儿，又在那儿，直到老板看一眼</span>
  }
  
  <span class="hljs-title function_">measure</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 坍缩时刻！就像薛定谔打开盒子看猫</span>
    <span class="hljs-keyword">const</span> probZero = <span class="hljs-variable language_">this</span>.<span class="hljs-property">amplitudeZero</span> ** <span class="hljs-number">2</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &lt; probZero ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>;
  }
}

<span class="hljs-comment">// 创建两个比特</span>
<span class="hljs-keyword">const</span> classic = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassicalBit</span>();
<span class="hljs-keyword">const</span> quantum = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QuantumBit</span>();

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`经典比特说：我是 <span class="hljs-subst">${classic.measure()}</span>，我自豪`</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`量子比特说：我可能是0也可能是1，测了才知道 😇`</span>);
</code></pre>
<p><strong>底层原理</strong>：叠加态的本质是量子系统的线性组合。一个qubit的状态是 <code>α|0⟩ + β|1⟩</code>，其中 <code>α</code> 和 <code>β</code> 是复数概率幅，满足 <code>|α|² + |β|² = 1</code>。用JS理解就是：<strong>两个复数共同决定了一个量子态的命运</strong>，而经典比特只有一个实数0或1。</p>
<hr/>
<h2 data-id="heading-3">第二章：量子纠缠——电子界的"心电感应" 💕⚡</h2>
<h3 data-id="heading-4">当两个量子坠入爱河</h3>
<p>量子纠缠是量子计算真正的"黑魔法"。两个纠缠的qubits，即使相隔一个银河系，测量其中一个会<strong>瞬间</strong>决定另一个的状态。爱因斯坦骂这是"鬼魅般的超距作用"，但不好意思，实验反复证明：老爷子，这次您错了。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 制备贝尔态——最经典的纠缠态</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createEntangledPair</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 两个qubits的联合状态：</span>
  <span class="hljs-comment">// |Φ+⟩ = (|00⟩ + |11⟩) / sqrt(2)</span>
  <span class="hljs-comment">// 翻译成人话：要么都是0，要么都是1，概率各50%</span>
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">qubitA</span>: { <span class="hljs-attr">entangledWith</span>: <span class="hljs-string">'B'</span>, <span class="hljs-attr">state</span>: <span class="hljs-string">'superposition'</span> },
    <span class="hljs-attr">qubitB</span>: { <span class="hljs-attr">entangledWith</span>: <span class="hljs-string">'A'</span>, <span class="hljs-attr">state</span>: <span class="hljs-string">'superposition'</span> },
    
    <span class="hljs-title function_">measureBoth</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// 测量结果总是 correlated！</span>
      <span class="hljs-keyword">const</span> outcome = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &lt; <span class="hljs-number">0.5</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>;
      <span class="hljs-keyword">return</span> { <span class="hljs-attr">A</span>: outcome, <span class="hljs-attr">B</span>: outcome }; <span class="hljs-comment">// 永远一致！</span>
    }
  };
}

<span class="hljs-keyword">const</span> pair = <span class="hljs-title function_">createEntangledPair</span>();
<span class="hljs-keyword">const</span> result = pair.<span class="hljs-title function_">measureBoth</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`测得：A=<span class="hljs-subst">${result.A}</span>, B=<span class="hljs-subst">${result.B}</span> —— 心有灵犀一点通！ 💑`</span>);
</code></pre>
<p><strong>底层原理</strong>：纠缠态的测量结果具有非局域关联性。关键在于——<strong>没有信息超光速传递</strong>，只有关联性。这违反的是"局域实在论"，而非相对论。听起来像文字游戏？这就是量子力学的"哲学暴击"。</p>
<hr/>
<h2 data-id="heading-5">第三章：AI运算的"阿喀琉斯之踵" 🦵🏹</h2>
<h3 data-id="heading-6">经典计算的悲愤：维度诅咒与指数墙</h3>
<p>现代AI的核心是线性代数——矩阵乘法、梯度下降、反向传播。但当你的模型有1亿参数时，经典计算机就像在<strong>用独轮车搬运宇宙</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 经典神经网络：矩阵乘法的苦力劳动</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassicNeuralNetwork</span> {
  <span class="hljs-title function_">forwardPass</span>(<span class="hljs-params">inputVector, weightMatrix</span>) {
    <span class="hljs-comment">// 朴素矩阵乘法：O(n³) 复杂度</span>
    <span class="hljs-comment">// 1亿 × 1亿的矩阵？你的GPU会哭着喊妈妈</span>
    
    <span class="hljs-keyword">const</span> output = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; weightMatrix.<span class="hljs-property">length</span>; i++) {
      output[i] = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; inputVector.<span class="hljs-property">length</span>; j++) {
        output[i] += weightMatrix[i][j] * inputVector[j];
        <span class="hljs-comment">// 每一次乘加，都是一次硅基原子的悲鸣</span>
      }
    }
    <span class="hljs-keyword">return</span> output;
  }
}

<span class="hljs-comment">// 训练过程：反向传播——在超高维地形里盲人摸象</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">backpropagate</span>(<span class="hljs-params">loss, learningRate</span>) {
  <span class="hljs-comment">// 计算梯度：∂Loss/∂W 需要链式法则</span>
  <span class="hljs-comment">// 在10⁸维空间里找最优解，像大海捞针</span>
  <span class="hljs-comment">// 局部极小值比银河系的星星还多！</span>
}
</code></pre>
<p><strong>核心瓶颈</strong>：</p>
<ol>
<li><strong>时间复杂度</strong>：深度学习的许多操作是多项式甚至指数级</li>
<li><strong>能量墙</strong>：训练GPT-3的碳排放相当于五辆汽车终身排放量</li>
<li><strong>并行性天花板</strong>：阿姆达尔定律像紧箍咒，限制并行提速</li>
</ol>
<hr/>
<h2 data-id="heading-7">第四章：量子算法的"作弊码" 🎮✨</h2>
<h3 data-id="heading-8">4.1 Grover算法：在无序列表里开"透视挂"</h3>
<p>经典搜索需要 <strong>O(N)</strong> 次查询。Grover算法只需 <strong>O(√N)</strong> ——对1百万条数据，查询次数从1百万降到1千。这不是提速，这是<strong>降维打击</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 经典搜索：笨办法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">classicSearch</span>(<span class="hljs-params">database, target</span>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; database.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (database[i] === target) <span class="hljs-keyword">return</span> i; <span class="hljs-comment">// 最坏情况查完所有</span>
  }
  <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
}

<span class="hljs-comment">// 量子搜索：Grover的"振幅放大"</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">quantumGroverSearch</span>(<span class="hljs-params">quantumDatabase, target</span>) {
  <span class="hljs-comment">// 步骤1：初始化叠加态，同时检查所有条目</span>
  <span class="hljs-comment">// |ψ⟩ = (1/√N) Σ|x⟩</span>
  
  <span class="hljs-comment">// 步骤2：反复应用"预言机"(oracle)和扩散算子</span>
  <span class="hljs-comment">// 每次迭代，目标态的振幅放大，非目标衰减</span>
  
  <span class="hljs-comment">// 约 √(N) 次后，测量得到目标的概率 &gt; 99%</span>
  
  <span class="hljs-keyword">const</span> iterations = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(database.<span class="hljs-property">length</span>) / <span class="hljs-number">4</span>);
  
  <span class="hljs-comment">// 核心思想：通过干涉让正确答案"脱颖而出"</span>
  <span class="hljs-comment">// 就像1000个人合唱，只有正确的人声音越来越大</span>
  
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">found</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">queries</span>: iterations };
}
</code></pre>
<p><strong>工程意义</strong>：在AI的超参数优化、特征选择中，Grover能指数级加速搜索空间遍历。</p>
<h3 data-id="heading-9">4.2 量子傅里叶变换：频域分析的"闪电战"</h3>
<p>经典FFT复杂度 <strong>O(N log N)</strong>。量子QFT仅需 <strong>O(log²N)</strong> ——对10亿数据点，经典需要300亿次操作，量子只要900次。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 经典FFT：蝴蝶操作，层层递归</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">classicFFT</span>(<span class="hljs-params">signal</span>) {
  <span class="hljs-comment">// 分治策略，但仍有O(N log N)复杂度</span>
  <span class="hljs-comment">// 处理1000×1000图像的频域？卡成PPT</span>
}

<span class="hljs-comment">// 量子QFT：并行性的极致</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">quantumFourierTransform</span>(<span class="hljs-params">qubitRegister</span>) {
  <span class="hljs-comment">// 对n个qubits，QFT将计算所有2^n个频率分量</span>
  <span class="hljs-comment">// 复杂度O(n²) —— n是qubits数，不是数据量！</span>
  
  <span class="hljs-comment">// 这就像同时问2^n个点："你的频率是多少？"</span>
  <span class="hljs-comment">// 量子并行性让指数级数据量坍缩为多项式操作</span>
  
  <span class="hljs-comment">// 应用：卷积神经网络、频域特征提取</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-10">第五章：量子机器学习的"桃花源" 🌸🤖</h2>
<h3 data-id="heading-11">5.1 量子神经网络(QNN)：神经元在希尔伯特空间里跳舞</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 量子感知机：用旋转门模拟激活函数</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">QuantumPerceptron</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">numQubits</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">qubits</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(numQubits).<span class="hljs-title function_">fill</span>(<span class="hljs-literal">null</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QuantumBit</span>());
    <span class="hljs-comment">// 参数化量子电路(PQC)作为可训练模型</span>
  }
  
  <span class="hljs-comment">// 输入编码：将经典数据映射到量子态</span>
  <span class="hljs-title function_">encodeInput</span>(<span class="hljs-params">classicalData</span>) {
    <span class="hljs-comment">// 例如角度编码：|x⟩ = ⊗ᵢ cos(xᵢ)|0⟩ + sin(xᵢ)|1⟩</span>
    <span class="hljs-comment">// 把像素值转成qubit的旋转角度</span>
  }
  
  <span class="hljs-comment">// 变分电路：可训练的量子门</span>
  <span class="hljs-title function_">variationalLayer</span>(<span class="hljs-params">params</span>) {
    <span class="hljs-comment">// 应用Ry, Rz旋转门和CNOT纠缠门</span>
    <span class="hljs-comment">// params是经典优化参数，类似权重</span>
    
    <span class="hljs-comment">// 前向传播：</span>
    <span class="hljs-comment">// |ψ_out⟩ = U(θ) |ψ_in⟩</span>
    <span class="hljs-comment">// 量子态在希尔伯特空间里优雅旋转</span>
  }
  
  <span class="hljs-comment">// 测量期望：得到经典输出</span>
  <span class="hljs-title function_">measureExpectation</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 测量某个可观测量的期望值</span>
    <span class="hljs-comment">// 例如：σ_z 算子的期望</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">runQuantumCircuit</span>(); <span class="hljs-comment">// 返回0到1之间的值</span>
  }
  
  <span class="hljs-comment">// 反向传播：参数平移法则</span>
  <span class="hljs-title function_">gradientUpdate</span>(<span class="hljs-params">loss, learningRate</span>) {
    <span class="hljs-comment">// 经典技巧：无法直接求量子梯度，用参数平移：</span>
    <span class="hljs-comment">// ∂⟨O⟩/∂θ = (⟨O⟩(θ+π/2) - ⟨O⟩(θ-π/2)) / 2</span>
    <span class="hljs-comment">// 相当于量子版的有限差分</span>
  }
}
</code></pre>
<p><strong>底层优势</strong>：</p>
<ul>
<li><strong>指数级状态空间</strong>：n个qubits表示2^n维希尔伯特空间</li>
<li><strong>自然并行</strong>：一次操作影响所有基态</li>
<li><strong>复杂核函数</strong>：量子态内积天然是高维非线性核</li>
</ul>
<h3 data-id="heading-12">5.2 量子支持向量机：在高维空间"降维打击"</h3>
<p>经典SVM的核技巧计算代价高。量子版本(QSVM)用量子态内积作为核函数，天然计算高维相似度。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 量子核函数：计算数据在希尔伯特空间的相似度</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">quantumKernel</span>(<span class="hljs-params">vectorA, vectorB</span>) {
  <span class="hljs-comment">// 步骤1：制备量子态 |ψ_A⟩ 和 |ψ_B⟩</span>
  
  <span class="hljs-comment">// 步骤2：计算内积 |⟨ψ_A|ψ_B⟩|²</span>
  <span class="hljs-comment">// 这等价于测量两态相同的概率</span>
  
  <span class="hljs-comment">// 核心洞察：量子态相似度 = 经典数据相似度</span>
  <span class="hljs-comment">// 但在指数级大的特征空间里计算！</span>
  
  <span class="hljs-keyword">const</span> similarity = <span class="hljs-title function_">runSwapTest</span>(vectorA, vectorB);
  <span class="hljs-keyword">return</span> similarity; <span class="hljs-comment">// 核矩阵元素</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-13">第六章：现实的"冷水浴"：量子计算的"阿喀琉斯之踵" ❄️🦶</h2>
<h3 data-id="heading-14">6.1 退相干：量子处女座的"洁癖崩溃"</h3>
<p>量子态极其脆弱。环境温度、宇宙射线、甚至隔壁实验室的咖啡机震动，都会让qubit"泄气"，从叠加态坍缩成经典态。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 退相干模拟：美丽但短暂</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FragileQuantumSystem</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">coherenceTime</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// 微秒级，甚至纳秒级</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">errorRate</span> = <span class="hljs-number">0.001</span>;   <span class="hljs-comment">// 每门操作错误率</span>
  }
  
  <span class="hljs-title function_">runAlgorithm</span>(<span class="hljs-params">depth</span>) {
    <span class="hljs-comment">// 电路深度(depth) = 门操作数量</span>
    
    <span class="hljs-comment">// 总错误概率 = 1 - (1 - errorRate)^depth</span>
    <span class="hljs-comment">// 深度为1000时：1 - (0.999)^1000 ≈ 63% 失败率</span>
    
    <span class="hljs-keyword">if</span> (depth &gt; <span class="hljs-number">100</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"错误率爆炸！结果=噪声 🌪️"</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-string">"DECOHERED_NOISE"</span>;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">"MAYBE_VALID"</span>;
  }
}

<span class="hljs-comment">// 现状：NISQ时代（含噪声中等规模量子）</span>
<span class="hljs-comment">// 50-1000 qubits，但错误率高，无纠错</span>
<span class="hljs-comment">// 像用有划痕的镜片看星空——模糊但能看到轮廓</span>
</code></pre>
<p><strong>底层敌人</strong>：</p>
<ul>
<li><strong>T1弛豫</strong>：从|1⟩衰变到|0⟩</li>
<li><strong>T2弛豫</strong>：相位信息丢失（更致命）</li>
<li><strong>控制误差</strong>：微波脉冲不完美</li>
<li><strong>串扰</strong>： neighboring qubits互相干扰</li>
</ul>
<h3 data-id="heading-15">6.2 量子纠错：数学奇迹的"代价"</h3>
<p>Shor编码：9个物理qubits保护1个逻辑qubit，错误率从p降到p²。表面码：需要上千个物理qubits才能实现一个完美逻辑qubit。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 纠错开销：豪华的数学保镖团</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">quantumErrorCorrectionRequirement</span>(<span class="hljs-params">baseErrorRate</span>) {
  <span class="hljs-comment">// 目标：逻辑错误率 &lt; 10^-15 (可实用)</span>
  
  <span class="hljs-keyword">const</span> physicalQubitsPerLogical = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">pow</span>(
    <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">10</span>^-<span class="hljs-number">15</span>) / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">log</span>(baseErrorRate), 
    <span class="hljs-number">2</span>
  ); <span class="hljs-comment">// 近似估算</span>
  
  <span class="hljs-comment">// 如果baseErrorRate = 0.1%</span>
  <span class="hljs-comment">// 需要约 900 个物理qubits保护1个逻辑qubit</span>
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">physicalQubits</span>: physicalQubitsPerLogical,
    <span class="hljs-attr">overhead</span>: <span class="hljs-string">" astronomical 🌌"</span>
  };
}

<span class="hljs-comment">// 现状：2024年，最好的量子计算机约1000物理qubits</span>
<span class="hljs-comment">// 纠错后 ≈ 1个完美逻辑qubit（悲）😢</span>
</code></pre>
<hr/>
<h2 data-id="heading-16">第七章：当前最佳实践：混合计算架构 🌉</h2>
<h3 data-id="heading-17">经典+量子：不是取代，而是联姻</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 实用量子AI工作流：VQE变分量子本征求解器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">HybridQuantumAI</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">quantumProcessor</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NoisyQuantumChip</span>(<span class="hljs-number">50</span>); <span class="hljs-comment">// 50 qubits</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">classicalOptimizer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AdamOptimizer</span>();     <span class="hljs-comment">// 经典优化器</span>
  }
  
  <span class="hljs-title function_">trainQuantumLayer</span>(<span class="hljs-params">trainingData</span>) {
    <span class="hljs-comment">// 步骤1：经典预处理（归一化、降维）</span>
    <span class="hljs-keyword">const</span> processedData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">classicalCPU</span>.<span class="hljs-title function_">preprocess</span>(trainingData);
    
    <span class="hljs-comment">// 步骤2：量子电路执行（参数化电路）</span>
    <span class="hljs-keyword">const</span> quantumCircuit = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildPQC</span>(processedData);
    
    <span class="hljs-comment">// 步骤3：测量期望（多次采样平均）</span>
    <span class="hljs-keyword">const</span> expectation = <span class="hljs-variable language_">this</span>.<span class="hljs-property">quantumProcessor</span>.<span class="hljs-title function_">run</span>(quantumCircuit, shots=<span class="hljs-number">10000</span>);
    
    <span class="hljs-comment">// 步骤4：经典后处理（梯度计算、参数更新）</span>
    <span class="hljs-keyword">const</span> loss = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateLoss</span>(expectation, labels);
    <span class="hljs-keyword">const</span> gradients = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">estimateGradients</span>(quantumCircuit);
    
    <span class="hljs-comment">// 步骤5：经典优化器更新参数</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">classicalOptimizer</span>.<span class="hljs-title function_">step</span>(gradients);
    
    <span class="hljs-comment">// 循环直到收敛...</span>
  }
}

<span class="hljs-comment">// 核心洞察：量子做它最擅长的（并行、干涉）</span>
<span class="hljs-comment">// 经典做它最擅长的（控制、存储、纠错）</span>
</code></pre>
<p><strong>成功案例</strong>：</p>
<ul>
<li><strong>药物发现</strong>：模拟分子基态（量子化学）</li>
<li><strong>金融建模</strong>：蒙特卡洛模拟的量子加速</li>
<li><strong>优化问题</strong>：量子退火解决TSP变种</li>
</ul>
<hr/>
<h2 data-id="heading-18">第八章：未来展望：理性狂欢还是泡沫幻影？ 🔮</h2>
<h3 data-id="heading-19">时间线预测（非官方，带点玄学）</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> quantumAITimeline = {
  <span class="hljs-number">2025</span>: {
    <span class="hljs-attr">status</span>: <span class="hljs-string">"NISQ末期"</span>,
    <span class="hljs-attr">reality</span>: <span class="hljs-string">"1000 qubits，无纠错，特定问题演示优势"</span>,
    <span class="hljs-attr">aiImpact</span>: <span class="hljs-string">"玩具级应用，学术玩具 🧸"</span>
  },
  
  <span class="hljs-number">2030</span>: {
    <span class="hljs-attr">status</span>: <span class="hljs-string">"逻辑qubit突破"</span>,
    <span class="hljs-attr">reality</span>: <span class="hljs-string">"100逻辑qubits（约10万物理qubits）"</span>,
    <span class="hljs-attr">aiImpact</span>: <span class="hljs-string">"量子加速在小规模ML任务显现"</span>,
    <span class="hljs-attr">killerApp</span>: <span class="hljs-string">"量子化学 + 生成模型"</span>
  },
  
  <span class="hljs-number">2035</span>: {
    <span class="hljs-attr">status</span>: <span class="hljs-string">"容错量子计算"</span>,
    <span class="hljs-attr">reality</span>: <span class="hljs-string">"1000逻辑qubits，错误率&lt;10^-12"</span>,
    <span class="hljs-attr">aiImpact</span>: <span class="hljs-string">"大规模QNN，量子强化学习"</span>,
    <span class="hljs-attr">paradigmShift</span>: <span class="hljs-string">"某些AI任务必须用量子"</span>
  },
  
  <span class="hljs-number">2040</span>: {
    <span class="hljs-attr">status</span>: <span class="hljs-string">"量子霸权2.0"</span>,
    <span class="hljs-attr">reality</span>: <span class="hljs-string">"百万逻辑qubits，室温拓扑量子计算？"</span>,
    <span class="hljs-attr">aiImpact</span>: <span class="hljs-string">"通用量子AI，AGI的量子助推器？"</span>,
    <span class="hljs-attr">caveat</span>: <span class="hljs-string">"也可能发现量子优势有限 😅"</span>
  }
};

<span class="hljs-comment">// 关键未知：</span>
<span class="hljs-comment">// 1. 能否实现室温超导量子计算？</span>
<span class="hljs-comment">// 2. 是否真有大规模量子优势？</span>
<span class="hljs-comment">// 3. 新算法突破（可能比硬件更重要）</span>
</code></pre>
<hr/>
<h2 data-id="heading-20">终章：结论——量子是"革命"还是"演进"？ 🎯</h2>
<h3 data-id="heading-21">核心答案：<strong>演进式的革命</strong>（Oxymoron，但很真实）</h3>
<p>量子计算不会"彻底"改变AI，但它会在<strong>特定战场</strong>掀起<strong>彻底革命</strong>：</p>









































<table><thead><tr><th>领域</th><th>经典AI</th><th>量子AI</th><th>变革程度</th></tr></thead><tbody><tr><td><strong>大数据线性代数</strong></td><td>优秀</td><td>可能更优</td><td>⭐⭐⭐</td></tr><tr><td><strong>组合优化</strong></td><td>痛苦</td><td>指数加速</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>生成模型采样</strong></td><td>MCMC慢</td><td>量子行走</td><td>⭐⭐⭐⭐</td></tr><tr><td><strong>模式识别</strong></td><td>CNN很牛</td><td>暂时不如</td><td>⭐⭐</td></tr><tr><td><strong>通用智能</strong></td><td>还行</td><td>遥遥无期</td><td>⭐</td></tr></tbody></table>
<p><strong>文学性总结</strong>：</p>
<p>量子计算不是AI的救世主，也不是泡沫。它更像是一位<strong>性格古怪的超级助手</strong>——当你需要求解一个10^30维空间的优化问题时，它会说："放着我来！"；但当你想让它识别猫狗图片时，它会翻白眼："这活找GPU去，别浪费我宝贵的相干时间。"</p>
<p>幽默的真相是：<strong>量子计算最擅长解决的问题，恰恰是经典计算最头痛的问题</strong>。而AI，恰好既有头痛之处，也有舒适区。所以，未来的图景不是量子取代经典，而是像一对跳探戈的恋人——经典AI负责稳健的步伐，量子计算负责惊艳的旋转。</p>
<hr/>
<h2 data-id="heading-22">给工程师的实践建议 🛠️</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 今天就可以做的：</span>
<span class="hljs-keyword">const</span> actionItems = [
  <span class="hljs-string">"学习Qiskit/Cirq量子SDK"</span>,
  <span class="hljs-string">"关注量子核方法论文"</span>,
  <span class="hljs-string">"在AWS Braket跑量子演示"</span>,
  <span class="hljs-string">"别扔掉你的GPU集群（重要！）"</span>,
  <span class="hljs-string">"对5年后的技术路线图保持乐观，对2年后的产品保持怀疑"</span>
];

<span class="hljs-comment">// 记住：量子AI的摩尔定律是"量子体积每年翻倍"</span>
<span class="hljs-comment">// 但经典AI的摩尔定律还没死透呢！</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🐱 LongCat-Image：当AI绘画说上了流利的中文，还减掉了40斤参数 | 共绩算力]]></title>    <link>https://juejin.cn/post/7589564203872567359</link>    <guid>https://juejin.cn/post/7589564203872567359</guid>    <pubDate>2025-12-31T09:13:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589564203872567359" data-draft-id="7589830060334661686" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🐱 LongCat-Image：当AI绘画说上了流利的中文，还减掉了40斤参数 | 共绩算力"/> <meta itemprop="keywords" content="人工智能,AIGC,云原生"/> <meta itemprop="datePublished" content="2025-12-31T09:13:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🐱 LongCat-Image：当AI绘画说上了流利的中文，还减掉了40斤参数 | 共绩算力
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T09:13:29.000Z" title="Wed Dec 31 2025 09:13:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>"别的模型在堆参数，LongCat在堆智慧——就像高手过招，从不靠蛮力，靠的是对中文吃货审美那一针见血的洞察"</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">序幕：一个关于"猫咪"和"中华田园猫"的悲剧故事 📚</h2>
<p>深夜，一位prompt工程师对着Stable Diffusion怒吼：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 经典模型的中文理解困境</span>
<span class="hljs-keyword">const</span> userPrompt = <span class="hljs-string">"一只优雅的中华田园猫，在故宫红墙下打盹，中国风"</span>;

<span class="hljs-comment">// 某些模型的大脑处理过程</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">aIGenerator</span>(<span class="hljs-params">prompt</span>) {
  <span class="hljs-comment">// 第一步：翻译损耗</span>
  <span class="hljs-keyword">const</span> translated = <span class="hljs-title function_">chineseToEnglishLossy</span>(prompt); 
  <span class="hljs-comment">// "Chinese rural cat" → 模型：？？？</span>
  
  <span class="hljs-comment">// 第二步：文化语境丢失</span>
  <span class="hljs-keyword">const</span> culturalContext = <span class="hljs-literal">null</span>; <span class="hljs-comment">// undefined</span>
  
  <span class="hljs-comment">// 第三步：生成</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">generate</span>(
    <span class="hljs-string">"a weird mix of cat, grand wall, and random red things"</span>
  ); <span class="hljs-comment">// 四不像诞生 🎭</span>
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"结果：一只穿着唐装的美短猫，背景是PPT模板风红墙"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"用户：我血压高了 🩸"</span>);
</code></pre>
<p>这就是现有文生图模型的<strong>中文阿喀琉斯之踵</strong>：参数虚胖、文化水土不服、部署复杂到怀疑人生。而美团LongCat团队带着他们的"中华田园猫"——<strong>LongCat-Image</strong>——来终结这场闹剧了。</p>
<hr/>
<h2 data-id="heading-1">第一章：参数界的"节食冠军"——60亿参数如何拳打脚踢百亿对手 🥊</h2>
<h3 data-id="heading-2">参数效率的"太极拳哲学"</h3>
<p>传统模型信奉"大力出奇迹"：SDXL 35亿参数、Midjourney更大更神秘。但LongCat-Image反其道而行：<strong>60亿参数，精度不减，速度翻倍</strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 参数效率的底层密码：架构瘦身术</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LongCatEfficiencyMagic</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalParams</span> = <span class="hljs-number">6e9</span>; <span class="hljs-comment">// 60亿，不到SDXL两倍</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">secretSauce</span> = {
      <span class="hljs-attr">dynamicRouting</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 动态路由：只激活需要的网络路径</span>
      <span class="hljs-attr">hierarchicalAttention</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 层级注意力：先整体后细节</span>
      <span class="hljs-attr">nativeChineseTokenizer</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 原生中文分词器</span>
    };
  }
  
  <span class="hljs-comment">// 动态计算路由：像大脑的"注意力焦点"</span>
  <span class="hljs-title function_">forwardPass</span>(<span class="hljs-params">inputPrompt</span>) {
    <span class="hljs-keyword">const</span> tokens = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">tokenize</span>(inputPrompt);
    
    <span class="hljs-comment">// 不是全网络激活！只启用20%的关键路径</span>
    <span class="hljs-keyword">const</span> activeModules = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">routeComputation</span>(tokens);
    <span class="hljs-comment">// 复杂度从O(N)降到O(log N)</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sparseForward</span>(tokens, activeModules);
  }
  
  <span class="hljs-title function_">routeAnalysis</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 对比：传统模型</span>
    <span class="hljs-keyword">const</span> classicFLOPs = <span class="hljs-number">6e9</span> * <span class="hljs-number">1000</span>; <span class="hljs-comment">// 每个token跑全部参数</span>
    
    <span class="hljs-comment">// LongCat：智能路由</span>
    <span class="hljs-keyword">const</span> longcatFLOPs = <span class="hljs-number">6e9</span> * <span class="hljs-number">1000</span> * <span class="hljs-number">0.2</span>; <span class="hljs-comment">// 仅20%激活</span>
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`计算量削减: <span class="hljs-subst">${((<span class="hljs-number">1</span> - longcatFLOPs/classicFLOPs) * <span class="hljs-number">100</span>).toFixed(<span class="hljs-number">0</span>)}</span>%`</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"省电、省显存、省时间，还省下了买H800的钱 💰"</span>);
  }
}

<span class="hljs-keyword">const</span> model = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongCatEfficiencyMagic</span>();
model.<span class="hljs-title function_">routeAnalysis</span>(); <span class="hljs-comment">// 输出：计算量削减: 80%</span>
</code></pre>
<p><strong>底层原理</strong>：这就像人类画家——画"猫"时不会激活"量子物理"知识区。LongCat通过<strong>稀疏激活</strong>和<strong>动态路由</strong>，让每个token只走最相关的计算路径，避免了传统Transformer的"全连接暴殄天物"。</p>
<hr/>
<h2 data-id="heading-3">第二章：中文理解的"文化特调酱料" 🥟🧠</h2>
<h3 data-id="heading-4">从"翻译腔"到"本土魂"</h3>
<p>LongCat-Image的杀手锏：<strong>原生中文理解</strong>。不是"先翻英再生成"，而是直接把"烟火气"、"赛博朋克"、"国潮"这些词刻进DNA。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 中文语义空间的秘密武器</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ChineseSemanticEngine</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tokenizer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HybridTokenizer</span>({
      <span class="hljs-attr">granularity</span>: <span class="hljs-string">"subword"</span>, <span class="hljs-comment">// 字级别+词级别混合</span>
      <span class="hljs-attr">vocabOrigin</span>: <span class="hljs-string">"zhihu-weibo-xiaohongshu"</span>, <span class="hljs-comment">// 真实中文互联网语料</span>
      <span class="hljs-attr">culturalEmbeddings</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 文化向量嵌入</span>
    });
  }
  
  <span class="hljs-title function_">encode</span>(<span class="hljs-params"><span class="hljs-string">"国潮"</span></span>) {
    <span class="hljs-comment">// 不是 ["national", "tide"] 的拼接！</span>
    <span class="hljs-comment">// 而是单一token，直接映射到：</span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">visualElements</span>: [<span class="hljs-string">"汉服元素"</span>, <span class="hljs-string">"赛博朋克光效"</span>, <span class="hljs-string">"传统纹样"</span>],
      <span class="hljs-attr">colorPalette</span>: [<span class="hljs-string">"故宫红"</span>, <span class="hljs-string">"鎏金"</span>, <span class="hljs-string">"靛蓝"</span>],
      <span class="hljs-attr">mood</span>: <span class="hljs-string">"文化自信+未来感"</span>,
      <span class="hljs-attr">referenceArtists</span>: [<span class="hljs-string">"吴冠中+Krenz混搭"</span>]
    };
  }
  
  <span class="hljs-title function_">encode</span>(<span class="hljs-params"><span class="hljs-string">"烟火气"</span></span>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">lighting</span>: <span class="hljs-string">"夜间暖光+霓虹灯反射"</span>,
      <span class="hljs-attr">atmosphere</span>: <span class="hljs-string">"湿润街道+烧烤摊蒸汽"</span>,
      <span class="hljs-attr">humanActivity</span>: <span class="hljs-string">"市井生活+喧嚣感"</span>,
      <span class="hljs-attr">photographyStyle</span>: <span class="hljs-string">"王家卫电影色调"</span>
    };
  }
}

<span class="hljs-comment">// 对比实验</span>
<span class="hljs-keyword">const</span> traditionalModel = {
  <span class="hljs-string">"烟火气"</span>: <span class="hljs-string">"fireworks.png"</span> <span class="hljs-comment">// 字面理解：烟花绽放</span>
};

<span class="hljs-keyword">const</span> longcatModel = {
  <span class="hljs-string">"烟火气"</span>: <span class="hljs-string">"night-market-with-steam-and-neon.jpg"</span> <span class="hljs-comment">// 神理解：夜市烟火气</span>
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"用户：这才是我想要的！这才是中文的灵魂！ 🙏"</span>);
</code></pre>
<p><strong>底层原理</strong>：LongCat在预训练阶段注入了<strong>10亿级中文多模态语料</strong>，采用<strong>对比学习</strong>让文本-图像对齐时保留文化语境。简单说，它看过的小红书笔记比你还多。</p>
<hr/>
<h2 data-id="heading-5">第三章：Diffusion模型的"懒人包"——容器化部署的魔法 📦✨</h2>
<h3 data-id="heading-6">从"配环境配到哭"到"一键召唤猫咪"</h3>
<p>传统AI模型部署：CUDA版本地狱、依赖冲突、权重下载慢。LongCat-Image直接给你<strong>配好的镜像</strong>，像点外卖一样简单。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 部署过程：从地狱到天堂</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DeploymentJourney</span> {
  <span class="hljs-title function_">traditionalWay</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> steps = [
      <span class="hljs-string">"git clone 30GB仓库"</span>,
      <span class="hljs-string">"pip install -r requirements.txt (3小时)"</span>,
      <span class="hljs-string">"下载权重 (网速5MB/s，心态崩了)"</span>,
      <span class="hljs-string">"CUDA报错：版本不兼容"</span>,
      <span class="hljs-string">"pytorch版本不对"</span>,
      <span class="hljs-string">"libcublas.so not found"</span>,
      <span class="hljs-string">"放弃，打开BOSS直聘"</span>
    ];
    <span class="hljs-keyword">return</span> <span class="hljs-string">`总耗时: <span class="hljs-subst">${<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">48</span> + <span class="hljs-number">24</span>}</span>小时，头发掉光 💇‍♂️`</span>;
  }
  
  <span class="hljs-title function_">longcatWay</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">step1</span>: <span class="hljs-string">"打开 Gongjiyun.com"</span>,
      <span class="hljs-attr">step2</span>: <span class="hljs-string">"选择配置：单卡4090（¥3.5/小时）"</span>,
      <span class="hljs-attr">step3</span>: <span class="hljs-string">"点击'部署服务'"</span>,
      <span class="hljs-attr">step4</span>: <span class="hljs-string">"等待3分钟（泡杯咖啡）"</span>,
      <span class="hljs-attr">step5</span>: <span class="hljs-string">"点击链接，Gradio界面出现"</span>,
      <span class="hljs-attr">totalTime</span>: <span class="hljs-string">"180秒"</span>,
      <span class="hljs-attr">mentalHealth</span>: <span class="hljs-string">"完好无损 😊"</span>
    };
  }
}

<span class="hljs-keyword">const</span> journey = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeploymentJourney</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(journey.<span class="hljs-title function_">longcatWay</span>());
</code></pre>
<p><strong>底层原理剖析</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 容器化的技术内核</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ContainerMagic</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">layers</span> = {
      <span class="hljs-attr">base</span>: <span class="hljs-string">"nvidia/cuda:12.1-runtime-ubuntu22.04"</span>,
      <span class="hljs-attr">pytorch</span>: <span class="hljs-string">"pytorch:2.1-cuda12.1"</span>,
      <span class="hljs-attr">dependencies</span>: <span class="hljs-string">"requirements.txt (已冻结版本)"</span>,
      <span class="hljs-attr">modelWeights</span>: <span class="hljs-string">"pre-downloaded /workspace/models/"</span>,
      <span class="hljs-attr">gradioApp</span>: <span class="hljs-string">"app.py (配置完毕)"</span>
    };
  }
  
  <span class="hljs-comment">// 联合挂载技术</span>
  <span class="hljs-title function_">mountStrategy</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. 权重层：只读，多实例共享</span>
    <span class="hljs-comment">// 2. 缓存层：可写，存储生成历史</span>
    <span class="hljs-comment">// 3. 配置层：用户自定义</span>
    
    <span class="hljs-comment">// 结果：首次启动快，增量更新更快</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"镜像分层策略：像洋葱，每层独立，整体轻盈"</span>);
  }
  
  <span class="hljs-title function_">resourceIsolation</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// CPU隔离：cgroups限制</span>
    <span class="hljs-comment">// GPU隔离：nvidia-docker分配显存</span>
    <span class="hljs-comment">// 网络隔离：独立端口7891</span>
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"你的猫咪不会抢别人的猫粮 🐱"</span>);
  }
}

<span class="hljs-comment">// 硬件亲和性优化</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GPUOptimization</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">tuneFor4090</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">batchSize</span>: <span class="hljs-number">1</span>,              <span class="hljs-comment">// 单卡单图，延迟最低</span>
      <span class="hljs-attr">attentionSlicing</span>: <span class="hljs-literal">true</span>,    <span class="hljs-comment">// 显存切片，防止OOM</span>
      <span class="hljs-attr">modelOffload</span>: <span class="hljs-literal">false</span>,       <span class="hljs-comment">// 4090 24GB足够，无需CPU卸载</span>
      <span class="hljs-attr">torchCompile</span>: <span class="hljs-literal">true</span>,        <span class="hljs-comment">// torch.compile()加速1.5x</span>
      <span class="hljs-attr">precision</span>: <span class="hljs-string">"float16"</span>       <span class="hljs-comment">// 半精度，速度翻倍</span>
    };
  }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"容器不是黑魔法，是工程学的极致浪漫 🐳"</span>);
</code></pre>
<hr/>
<h2 data-id="heading-7">第四章：生成过程实时解剖——Diffusion的"水彩晕染"艺术 🎨💧</h2>
<h3 data-id="heading-8">20秒内的28次"灵魂迭代"</h3>
<p>LongCat-Image默认28步推理，每一步都在"去噪"，就像画家从模糊草稿逐渐勾勒细节。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Diffusion过程的可视化</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DiffusionTimeline</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">steps</span> = <span class="hljs-number">28</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentStep</span> = <span class="hljs-number">0</span>;
  }
  
  <span class="hljs-comment">// 每一步的数学本质：预测噪声并减去</span>
  <span class="hljs-title function_">denoiseStep</span>(<span class="hljs-params">latent, step</span>) {
    <span class="hljs-keyword">const</span> noisePrediction = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">unet</span>(latent, step);
    <span class="hljs-comment">// UNet：核心网络，像"噪声侦探"</span>
    
    <span class="hljs-keyword">const</span> alpha = <span class="hljs-variable language_">this</span>.<span class="hljs-property">schedule</span>.<span class="hljs-property">alpha</span>[step]; <span class="hljs-comment">// 噪声强度</span>
    <span class="hljs-keyword">const</span> nextLatent = (latent - noisePrediction * (<span class="hljs-number">1</span> - alpha)) / <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>(alpha);
    
    <span class="hljs-comment">// 文学比喻：</span>
    <span class="hljs-comment">// 第1步：像泼了一盆墨的宣纸，什么都看不清</span>
    <span class="hljs-comment">// 第14步：轮廓显现，像雾中看远山</span>
    <span class="hljs-comment">// 第28步：毛发分明，连胡须都根根清晰</span>
    
    <span class="hljs-keyword">return</span> nextLatent;
  }
  
  <span class="hljs-comment">// 完整生成链路</span>
  <span class="hljs-title function_">generate</span>(<span class="hljs-params">prompt</span>) {
    <span class="hljs-keyword">const</span> textEmbedding = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">textEncoder</span>(prompt); <span class="hljs-comment">// 文本→向量</span>
    
    <span class="hljs-keyword">let</span> latent = torch.<span class="hljs-title function_">randn</span>([<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>]); <span class="hljs-comment">// 随机噪声起点</span>
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-variable language_">this</span>.<span class="hljs-property">steps</span>; i &gt; <span class="hljs-number">0</span>; i--) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`第<span class="hljs-subst">${<span class="hljs-number">28</span>-i+<span class="hljs-number">1</span>}</span>步：Latent方差=<span class="hljs-subst">${latent.std().toFixed(<span class="hljs-number">3</span>)}</span>`</span>);
      latent = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">denoiseStep</span>(latent, i);
      
      <span class="hljs-comment">// 实时预览逻辑（Gradio用）</span>
      <span class="hljs-keyword">if</span> (i % <span class="hljs-number">5</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">preview</span>(latent); <span class="hljs-comment">// 每5步给用户看一眼</span>
      }
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">vae</span>.<span class="hljs-title function_">decode</span>(latent); <span class="hljs-comment">// 潜空间→像素空间</span>
  }
}

<span class="hljs-comment">// 性能监控</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceProfiler</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">profileOn4090</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">textEncoding</span>: <span class="hljs-string">"50ms"</span>,      <span class="hljs-comment">// CLIP模型推理</span>
      <span class="hljs-attr">denoisePerStep</span>: <span class="hljs-string">"600ms"</span>,   <span class="hljs-comment">// UNet单次推理</span>
      <span class="hljs-attr">totalDenoise</span>: <span class="hljs-string">"600ms * 28 = 16.8s"</span>,
      <span class="hljs-attr">vaeDecoding</span>: <span class="hljs-string">"200ms"</span>,
      <span class="hljs-attr">totalTime</span>: <span class="hljs-string">"~17s + 开销 = 20s"</span>,
      <span class="hljs-attr">memoryPeak</span>: <span class="hljs-string">"18GB"</span>         <span class="hljs-comment">// 4090的24GB绰绰有余</span>
    };
  }
}
</code></pre>
<p><strong>底层优化</strong>：LongCat采用了<strong>FlashAttention</strong>和<strong>梯度检查点</strong>，让UNet的显存占用从爆炸级降到合理范围。就像给赛车加了氮气加速，还不费油。</p>
<hr/>
<h2 data-id="heading-9">第五章：实战案例——从" prompt 咒语"到"视觉盛宴" 🖼️✨</h2>
<h3 data-id="heading-10">案例1："赛博朋克北京胡同"</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 中文原生优势验证</span>
<span class="hljs-keyword">const</span> prompt = <span class="hljs-string">"赛博朋克风格的北京胡同夜晚，霓虹灯照亮四合院，无人机穿梭，传统与创新碰撞"</span>;

<span class="hljs-comment">// LongCat理解后：</span>
<span class="hljs-keyword">const</span> interpretation = {
  <span class="hljs-attr">visualElements</span>: {
    <span class="hljs-attr">siheyuan</span>: <span class="hljs-string">"传统四合院建筑结构"</span>,
    <span class="hljs-attr">neonChinese</span>: <span class="hljs-string">"中文霓虹灯招牌"</span>,
    <span class="hljs-attr">drones</span>: <span class="hljs-string">"未来感无人机"</span>,
    <span class="hljs-attr">atmosphere</span>: <span class="hljs-string">"蒸汽朋克+东方美学"</span>
  },
  <span class="hljs-attr">avoid</span>: <span class="hljs-string">"西方赛博朋克刻板印象（如日文假名）"</span>,
  <span class="hljs-attr">enhance</span>: <span class="hljs-string">"红色宫墙与蓝色霓虹的冷暖对比"</span>
};

<span class="hljs-comment">// 生成结果：完美保留文化语境</span>
<span class="hljs-comment">// 传统模型可能生成：东京街头+北京元素乱炖</span>
<span class="hljs-comment">// LongCat生成：地道的北京胡同，无人机上印着"美团外卖"（文化细节！）</span>
</code></pre>
<h3 data-id="heading-11">案例2："图像编辑——给猫戴上宇航员头盔"</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 图像编辑流程</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageEditPipeline</span> {
  <span class="hljs-title function_">editImage</span>(<span class="hljs-params">image, mask, prompt</span>) {
    <span class="hljs-comment">// 步骤1：编码原图到潜空间</span>
    <span class="hljs-keyword">const</span> latent = <span class="hljs-variable language_">this</span>.<span class="hljs-property">vae</span>.<span class="hljs-title function_">encode</span>(image);
    
    <span class="hljs-comment">// 步骤2：根据mask混合噪声</span>
    <span class="hljs-comment">//  mask区域：重新生成（宇航员头盔）</span>
    <span class="hljs-comment">//  非mask区域：保留原图（猫的身体）</span>
    <span class="hljs-keyword">const</span> maskedLatent = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyMask</span>(latent, mask);
    
    <span class="hljs-comment">// 步骤3：带条件去噪</span>
    <span class="hljs-keyword">const</span> edited = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">denoiseWithCondition</span>(
      maskedLatent, 
      prompt,
      conditionScale=<span class="hljs-number">7.5</span> <span class="hljs-comment">// 条件强度</span>
    );
    
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">vae</span>.<span class="hljs-title function_">decode</span>(edited);
  }
}

<span class="hljs-comment">// 在Gradio中：上传图片→涂抹mask→写prompt→点击生成</span>
<span class="hljs-comment">// 10秒后：猫咪穿上宇航服，边缘融合天衣无缝</span>
</code></pre>
<hr/>
<h2 data-id="heading-12">第六章：API调用——程序员的"猫咪召唤术" 🧙‍♂️</h2>
<h3 data-id="heading-13">不止于Gradio，一键集成到你的应用</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 官方API调用示例（现代版）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LongCatAPI</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">endpoint</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GradioClient</span>(endpoint);
  }
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">generateImage</span>(<span class="hljs-params">prompt, options = {}</span>) {
    <span class="hljs-keyword">const</span> config = {
      <span class="hljs-attr">prompt</span>: prompt,
      <span class="hljs-attr">negativePrompt</span>: options.<span class="hljs-property">negative</span> || <span class="hljs-string">"低质量,模糊"</span>,
      <span class="hljs-attr">width</span>: options.<span class="hljs-property">width</span> || <span class="hljs-number">1024</span>,
      <span class="hljs-attr">height</span>: options.<span class="hljs-property">height</span> || <span class="hljs-number">1024</span>,
      <span class="hljs-attr">steps</span>: options.<span class="hljs-property">steps</span> || <span class="hljs-number">28</span>,
      <span class="hljs-attr">batchSize</span>: options.<span class="hljs-property">batch</span> || <span class="hljs-number">1</span>,
      <span class="hljs-attr">seed</span>: options.<span class="hljs-property">seed</span> || -<span class="hljs-number">1</span> <span class="hljs-comment">// -1=随机</span>
    };
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"🐱 召唤猫咪中..."</span>);
      <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span>.<span class="hljs-title function_">predict</span>({
        <span class="hljs-attr">api_name</span>: <span class="hljs-string">"/generate_t2i"</span>,
        ...config
      });
      
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`✅ 生成成功！文件保存至: <span class="hljs-subst">${result.path}</span>`</span>);
      <span class="hljs-keyword">return</span> result.<span class="hljs-property">path</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"❌ 猫咪罢工了:"</span>, error.<span class="hljs-property">message</span>);
      <span class="hljs-keyword">throw</span> error;
    }
  }
  
  <span class="hljs-comment">// 图像编辑API</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">editImage</span>(<span class="hljs-params">imagePath, maskPath, prompt</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span>.<span class="hljs-title function_">predict</span>({
      <span class="hljs-attr">api_name</span>: <span class="hljs-string">"/generate_edit"</span>,
      <span class="hljs-attr">image</span>: imagePath,
      <span class="hljs-attr">mask</span>: maskPath,
      <span class="hljs-attr">prompt</span>: prompt
    });
  }
}

<span class="hljs-comment">// 实战：批量生成社交媒体配图</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">batchGenerate</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> longcat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LongCatAPI</span>(
    <span class="hljs-string">"https://your-deployment-7891.xxx.link"</span>
  );
  
  <span class="hljs-keyword">const</span> prompts = [
    <span class="hljs-string">"夏日冰美式，ins风，干净背景"</span>,
    <span class="hljs-string">"国潮运动鞋，龙纹元素，科技感"</span>,
    <span class="hljs-string">"程序员深夜撸猫，温馨灯光"</span>
  ];
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> prompt <span class="hljs-keyword">of</span> prompts) {
    <span class="hljs-keyword">const</span> imagePath = <span class="hljs-keyword">await</span> longcat.<span class="hljs-title function_">generateImage</span>(prompt, {
      <span class="hljs-attr">width</span>: <span class="hljs-number">512</span>,
      <span class="hljs-attr">height</span>: <span class="hljs-number">512</span>,
      <span class="hljs-attr">steps</span>: <span class="hljs-number">20</span> <span class="hljs-comment">// 快速模式</span>
    });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`生成: <span class="hljs-subst">${imagePath}</span>`</span>);
    <span class="hljs-comment">// 自动上传到CMS系统...</span>
  }
}

<span class="hljs-title function_">batchGenerate</span>();
</code></pre>
<hr/>
<h2 data-id="heading-14">第七章：成本与性价比——打工人-friendly的定价模型 💰</h2>
<h3 data-id="heading-15">单卡4090：性价比之王</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CostCalculator</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">calculateHourlyCost</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> gpu = <span class="hljs-string">"RTX 4090"</span>;
    <span class="hljs-keyword">const</span> price = <span class="hljs-number">3.5</span>; <span class="hljs-comment">// 元/小时</span>
    <span class="hljs-keyword">const</span> generationsPerHour = <span class="hljs-number">180</span>; <span class="hljs-comment">// 每次20秒</span>
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">pricePerImage</span>: (price / generationsPerHour).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">3</span>), <span class="hljs-comment">// ¥0.019/张</span>
      <span class="hljs-attr">memoryLeft</span>: <span class="hljs-string">"24GB - 18GB = 6GB（可跑其他服务）"</span>,
      <span class="hljs-attr">conclusion</span>: <span class="hljs-string">"比Midjourney订阅费便宜10倍"</span>
    };
  }
}

<span class="hljs-comment">// 对比：自建服务器</span>
<span class="hljs-keyword">const</span> totalCostOfOwnership = {
  <span class="hljs-attr">hardware</span>: <span class="hljs-string">"¥15,000 (4090主机)"</span>,
  <span class="hljs-attr">electricity</span>: <span class="hljs-string">"¥200/月 (24/7运行)"</span>,
  <span class="hljs-attr">maintenance</span>: <span class="hljs-string">" priceless (你的青春)"</span>,
  <span class="hljs-attr">flexibility</span>: <span class="hljs-string">"低 (硬件固定)"</span>,
  
  <span class="hljs-attr">summary</span>: <span class="hljs-string">"云服务按需付费，想停就停，适合创新试错"</span>
};
</code></pre>
<hr/>
<h2 data-id="heading-16">终章：LongCat-Image的"人格魅力"总结 🎭</h2>















































<table><thead><tr><th>特质</th><th>传统模型</th><th>LongCat-Image</th><th>用户体验</th></tr></thead><tbody><tr><td><strong>中文理解</strong></td><td>翻译腔，文化失真</td><td>原生理解，烟火气十足</td><td>😍😍😍😍😍</td></tr><tr><td><strong>参数规模</strong></td><td>巨大(20亿-100亿)</td><td>精简(60亿)</td><td>😊😊😊😊</td></tr><tr><td><strong>生成速度</strong></td><td>30-40秒</td><td>10-20秒</td><td>⚡⚡⚡⚡⚡</td></tr><tr><td><strong>部署难度</strong></td><td>环境地狱</td><td>一键容器</td><td>🚀🚀🚀🚀🚀</td></tr><tr><td><strong>定制成本</strong></td><td>高(需微调)</td><td>低(prompt即控制)</td><td>💰💰💰💰💰</td></tr><tr><td><strong>文化细节</strong></td><td>西方中心化</td><td>东方美学原生</td><td>🎨🎨🎨🎨🎨</td></tr></tbody></table>
<h3 data-id="heading-17">文学性总结</h3>
<p>LongCat-Image不是最强大的模型，但它是<strong>最懂中文、最懂务实、最懂工程师心痛</strong>的模型。它像一位从美团一线战场归来的老兵，深知"效率"二字如何书写——<strong>用精悍的参数完成95%的日常需求，用朴素的容器解决100%的部署噩梦</strong>。</p>
<p>它不会承诺生成《蒙娜丽莎》，但它能在一杯咖啡的时间里，给你100张符合小红书审美的产品海报、符合B站调性的同人插画、符合国潮气质的电商主图。这就够了。</p>
<p><strong>真正的技术浪漫，不是星辰大海的许诺，而是凌晨三点，当你需要一张图救急时，它说："我在，20秒搞定。"</strong> ❤️</p>
<hr/>
<h2 data-id="heading-18">召唤你的猫咪吧！ 🐱</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 终极召唤咒语</span>
<span class="hljs-keyword">const</span> magicWords = <span class="hljs-string">"单卡4090，镜像已备好，点击部署"</span>;

<span class="hljs-comment">// 结果</span>
<span class="hljs-keyword">const</span> outcome = {
  <span class="hljs-attr">yourAction</span>: <span class="hljs-string">"访问 gongjiyun.com"</span>,
  <span class="hljs-attr">timeInvestment</span>: <span class="hljs-string">"3分钟"</span>,
  <span class="hljs-attr">mentalDamage</span>: <span class="hljs-string">"0"</span>,
  <span class="hljs-attr">creativeOutput</span>: <span class="hljs-string">"∞"</span>,
  <span class="hljs-attr">happiness</span>: <span class="hljs-string">"++"</span>
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"猫咪在云端等你，快去撸它！"</span>);
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python环境变量自动配置：实现生产与开发环境无缝切换]]></title>    <link>https://juejin.cn/post/7589813969516232704</link>    <guid>https://juejin.cn/post/7589813969516232704</guid>    <pubDate>2025-12-31T09:25:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589813969516232704" data-draft-id="7589822564779278351" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python环境变量自动配置：实现生产与开发环境无缝切换"/> <meta itemprop="keywords" content="Python,后端"/> <meta itemprop="datePublished" content="2025-12-31T09:25:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="red润"/> <meta itemprop="url" content="https://juejin.cn/user/372051848729127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python环境变量自动配置：实现生产与开发环境无缝切换
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/372051848729127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    red润
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T09:25:40.000Z" title="Wed Dec 31 2025 09:25:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Python环境变量自动配置：实现生产与开发环境无缝切换</h2>
<h3 data-id="heading-1">导言</h3>
<blockquote>
<p>日常开发中经常会区分<strong>生产环境</strong>和<strong>开发环境</strong> 和<strong>测试环境</strong>，每一个环境中都有固定的配置，例如 api地址，数据库连接配置，redis连接配置等。</p>
<p>当我们在开发的时候需要来回切换这些配置，而且容易出错。</p>
<p>这里我将介绍如何使用Python环境变量自动配置生产与开发环境，<strong>实现环境间的无缝切换</strong>。</p>
</blockquote>
<p>实现目标</p>
<blockquote>
<p>本地开发完成后，将代码全部移植到线上环境可以<strong>直接运行</strong>，不用更改其他配置。</p>
</blockquote>
<h3 data-id="heading-2">准备：根据环境变量自动匹配开发环境</h3>
<blockquote>
<p>这里我只是针对简单的<strong>生产</strong>和<strong>开发</strong>环境，对于多种环境复杂环境，需要用户自行做一些其他的方案选型，例如 <strong>python-dotenv</strong>等</p>
</blockquote>
<h4 data-id="heading-3">环境变量配置</h4>
<blockquote>
<p>需要用户提前在<strong>生产端</strong>和<strong>电脑端</strong>分别配置环境变量，这里我用window系统展示</p>
</blockquote>
<ul>
<li>
<p>生产环境配置true</p>
<ul>
<li><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eedb3487ec5c4acd8fb04e632b35f7eb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcmVk5ram:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767777940&amp;x-signature=oNoZYsRiR0Frf0lHJiTYqRtZL1M%3D" alt="image.png" loading="lazy"/></li>
</ul>
</li>
<li>
<p>开发环境配置false</p>
<ul>
<li><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21e31d626aa6455193dfcd6bff90972e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgcmVk5ram:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767777940&amp;x-signature=%2FMW%2FiXdgHHT%2BXy%2BVGuYS2fUY81U%3D" alt="image.png" loading="lazy"/></li>
</ul>
</li>
</ul>
<h4 data-id="heading-4">实现：</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
​
<span class="hljs-comment"># 环境配置</span>
IS_PRO = <span class="hljs-literal">False</span>  <span class="hljs-comment"># 默认值</span>
DEV_BASE_URL = <span class="hljs-string">"http://192.168.78.24:18888/api"</span>
PRO_BASE_URL = <span class="hljs-string">"http://128.128.55.123:1234/api"</span>
DEV_REDIS_URL = <span class="hljs-string">"redis://192.168.78.11"</span>
PRO_REDIS_URL = <span class="hljs-string">"redis://128.128.55.123"</span>
​
​
<span class="hljs-keyword">def</span> <span class="hljs-title function_">detect_environment</span>():
    <span class="hljs-string">"""检测当前运行环境"""</span>
    <span class="hljs-keyword">global</span> IS_PRO
    <span class="hljs-keyword">try</span>:
        <span class="hljs-comment"># 通过环境变量判断是否为生产环境</span>
        IS_PRO = os.environ.get(<span class="hljs-string">"CCRC_TOOL_AUTOMATION"</span>, <span class="hljs-string">""</span>).lower() == <span class="hljs-string">"true"</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"环境检测失败: <span class="hljs-subst">{e}</span>"</span>)
        IS_PRO = <span class="hljs-literal">False</span>
​
​
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_config</span>():
    <span class="hljs-string">"""获取当前环境配置"""</span>
    detect_environment()
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"IS_PRO"</span>: IS_PRO,
        <span class="hljs-string">"BASE_URL"</span>: PRO_BASE_URL <span class="hljs-keyword">if</span> IS_PRO <span class="hljs-keyword">else</span> DEV_BASE_URL,
        <span class="hljs-string">"REDIS_URL"</span>: PRO_REDIS_URL <span class="hljs-keyword">if</span> IS_PRO <span class="hljs-keyword">else</span> DEV_REDIS_URL,
    }
​
​
<span class="hljs-comment"># 使用示例</span>
<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    config = get_config()
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n当前环境配置:"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"是否为生产环境: <span class="hljs-subst">{config[<span class="hljs-string">'IS_PRO'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"API地址: <span class="hljs-subst">{config[<span class="hljs-string">'BASE_URL'</span>]}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Redis地址: <span class="hljs-subst">{config[<span class="hljs-string">'REDIS_URL'</span>]}</span>"</span>)
</code></pre>
<h3 data-id="heading-5">结尾</h3>
<p>通过核心代码片段<code>IS_PRO = os.environ.get("CCRC_TOOL_AUTOMATION", "").lower() == "true"</code>获取环境变量并自动判断当前环境，自动获取匹配对应配置文件。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 提效别再卷了：当我把 AI 当“团队”，工作真的顺了]]></title>    <link>https://juejin.cn/post/7589839767816306726</link>    <guid>https://juejin.cn/post/7589839767816306726</guid>    <pubDate>2025-12-31T09:27:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589839767816306726" data-draft-id="7589830060334563382" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 提效别再卷了：当我把 AI 当“团队”，工作真的顺了"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-31T09:27:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="优弧"/> <meta itemprop="url" content="https://juejin.cn/user/852876722177533"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 提效别再卷了：当我把 AI 当“团队”，工作真的顺了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/852876722177533/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    优弧
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 如鱼得水
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 如鱼得水" title="VIP.5 如鱼得水" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T09:27:14.000Z" title="Wed Dec 31 2025 09:27:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e81a77b851a4a93a2b6eca2adb8d6c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5byn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778034&amp;x-signature=NeAVJ2jTBPcsUs92wBMBmsnoaKw%3D" alt="image.png" loading="lazy"/>
哈喽朋友们，我是优弧！</p>
<p>前阵子我有个很真实的崩溃瞬间：凌晨两点，需求还在飞，事儿多到永远做不完，我在工位上跟AI来回对话——聊着聊着我突然发现，我根本不是在“提效”，我是在“聊天”</p>
<p>你们有没有这种感觉：AI明明很强，但你用起来像在打乒乓球——我发一句，它回一段；我再补一句，它又换个方向跑；最后上下文越堆越长，人越看越累，效率还不如自己硬写。</p>
<p>后来我想通了一个点（扎心但很管用）：<strong>很多人2025年还在卷</strong> <strong>提示词</strong> <strong>，其实真正的提效不在提示词，而在“工作方式”</strong> 。</p>
<p>把AI当聊天框，你就只能得到聊天；把AI当团队，你才会得到交付。</p>
<p>先说清楚：这篇会聊到我正在用的一些工具和设备（其中包括我最近入手的<strong>明基 RD280U编程显示器</strong>），在软件和硬件层面都是付费用户，这些事情会让我的Vibe coding更快，更稳，也欢迎大家与我讨论分享。</p>
<p>所以这篇我就按“软件工作流 → 硬件底盘”的顺序来讲：软件上怎么把AI当团队把活交付出来，硬件上 RD280U 怎么把多窗口和长时间盯屏这两件事稳住——最后你会发现，提效变顺很多时候不是更用力，而是摩擦更少。</p>
<h2 data-id="heading-0"><strong>01 提效第一原则：先别堆工具，先把“摩擦”拆掉</strong></h2>
<p>很多人讲提效，上来就：</p>
<ul>
<li>装一堆插件</li>
<li>换一堆模型</li>
<li>背一堆提示词“咒语”</li>
</ul>
<p>结果是：工具越多，切换越多；切换越多，注意力越碎；注意力越碎，越想摆烂。</p>
<p>真正浪费时间的，往往是你每天都在重复的“摩擦动作”：</p>
<ul>
<li>在窗口之间来回切</li>
<li>在对话框里反复补上下文</li>
<li>滚动条滚到怀疑人生（滚着滚着就丢上下文）</li>
<li>打字打到手指发热（还容易错别字）</li>
</ul>
<p>所以我现在的2025提效链路，核心只干一件事：<strong>把摩擦从高频动作里剔掉</strong>。</p>
<h2 data-id="heading-1"><strong>02 把AI当“团队”：靠谱模型各司其职，别指望一个模型包打天下！</strong></h2>
<p>我现在的心态很明确：</p>
<p><strong>模型不是“神”，模型是“员工”。员工要分工，不分工就会内耗。</strong></p>
<p>你可以按手里能用的模型替换，但我自己这套分工是按“谁擅长干哪类活”来分的：</p>
<ul>
<li><strong>前端界面/视觉稿</strong>：用更擅长UI生成的模型快速出原型（推荐Gemini 3 Pro）</li>
<li><strong>规划执行文档</strong>：用更擅长结构化的模型把任务拆开、把Done写清楚（推荐Codex）</li>
<li><strong>落地写代码/修Bug</strong>：用更擅长工程实现、能长期协作的模型跟进落地（推荐Claude Code）</li>
</ul>
<p>你会发现：当你让模型做它擅长的事，你就不会频繁“返工重问”。这就是最朴素的提效。</p>
<h2 data-id="heading-2"><strong>03 放弃手动输入：语音 +</strong> <strong>Prompt</strong> <strong>纠错，省下来的不是时间，是意志力！</strong></h2>
<p>这一条我真心推荐：<strong>别再手动敲那么多字了，</strong> 原因很现实：</p>
<ul>
<li>打字很慢</li>
<li>打字很累</li>
<li>打字会降低你“把信息讲完整”的欲望</li>
</ul>
<p>我现在基本是： 想到什么先语音讲出来（越口语越好），再让AI按固定Prompt做三件事：</p>
<ul>
<li>纠错错别字</li>
<li>补齐逻辑结构</li>
<li>输出成可执行的任务清单</li>
</ul>
<p>你会突然发现：你不是在“写”，你是在“说清楚”。 而“说清楚”本来就是人类最擅长的事。</p>
<h2 data-id="heading-3"><strong>04 尽早接受“文档驱动”：别等Bug爆了才发现你连需求都没定</strong></h2>
<p>我以前也不爱写文档：觉得麻烦、浪费时间。 后来我被现实教育了：<strong>不写文档，最后一定会用加班还债。</strong> 我现在会尽量用一种“工程化的spec框架”来约束自己（思路类似 spec-kit）：</p>
<ul>
<li>目标是什么（Done 的定义）</li>
<li>输入输出是什么（接口、数据、边界）</li>
<li>不做什么（明确排除项）</li>
<li>风险在哪里（依赖、性能、兼容）</li>
</ul>
<p>这套东西的价值在于： 你写给AI看，AI更不容易跑偏；你写给自己看，自己也不容易忘；你写给同事看，同事少骂两句。<strong>提效的终点不是“更快写代码”，而是“更少返工”。</strong></p>
<h2 data-id="heading-4"><strong>05 你以为是</strong> <strong>AI</strong> <strong>不够强？很多时候是你“看不清、看不多”</strong></h2>
<p>说到这里，就绕不开硬件：</p>
<p>我觉得2025年很多人提效卡住，是因为<strong>屏幕太小/比例不对/护眼不行</strong>，导致你看两小时就开始烦躁，然后效率雪崩。</p>
<p>我自己之前是典型症状：</p>
<ul>
<li>一边IDE一边AI面板，再加终端，屏幕直接挤爆</li>
<li>看日志/看长函数疯狂滚动，滚着滚着就丢上下文</li>
<li>晚上加班开深色主题，还是刺眼、眼干、头疼</li>
</ul>
<p>后来我换成 <strong>明基 RD280U</strong>，体验变化很“朴素”，但很关键：</p>
<h3 data-id="heading-5">1）<code>3:2</code> 的方屏比例：上下文更完整，脑子更不容易断片</h3>
<p>RD280U 是 <code>28.2英寸</code>，<code>3840×2560</code>，<code>3:2</code>。 单看参数不刺激，但实际写代码的时候非常直观：<strong>同一屏能看到更多代码行</strong>，尤其适合“左中右三栏 + 底部终端”的AI编程布局。</p>
<p>我最明显的感受，是“思路更连续”。以前用 <code>16:9</code>，Code Review 碰到长函数，或者你在日志里追一段异常堆栈，经常滚一下才能看到 if/else 对称结构的另一半；滚动的那一下，其实就是打断。换成 <code>3:2</code> 后，很多时候能在一屏里把前因后果收尾，注意力不容易断片。</p>
<p>体感上，我在IDE里大概能多看到 <code>6-8</code> 行左右的代码（取决于字体/行高）。这在看调用链、对比两份文件、读长日志/SQL 输出的时候最值：不是“多看几行”那么简单，而是你不用频繁在脑子里缓存上下文。</p>
<p>缺点也很现实：它主要是 <code>60Hz</code> 的定位，不是电竞向；另外如果你强需求竖屏，要留意不同型号支架的能力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/037c0ac9fd79478fa3baa96be6cc11d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5byn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778034&amp;x-signature=pIZtMbiot9xv%2Bo2l15%2F2pWFQ42o%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">2）抗反射 + 夜间方案：减少“看屏的痛苦”，才有持续输出</h3>
<p>这一块我觉得特别适合“白天办公室 + 晚上回家接着干”的人。</p>
<p>白天最烦的其实不是亮，而是反光：下午阳光斜射、顶灯一照，你就会下意识调整角度、或者把亮度拉爆去“硬刚”。抗反射面板把眩光压下来之后，你不用再跟环境光对抗，视线更稳，心态也更稳。</p>
<p>可以看到下图是两块屏幕在同一位置、同一角度模拟强光照射的炫光效果（左图明基、右图其他）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d71fb211c22740c6a35f1ec3e4af5650~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5byn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778034&amp;x-signature=FsLjjh3l7voXplgm0xNUWloY6LY%3D" alt="" loading="lazy"/></p>
<p>到了晚上，另一个典型痛点是“屏幕亮、环境黑”的反差。我的用法很简单：把亮度压到一个更低的舒适区，同时开夜间相关方案（比如低亮度夜间模式 + 背部的 <code>MoonHalo</code> 环形补光），让环境光更柔和。最直接的变化是：写到后半夜，眼睛干涩来得更慢，注意力也更不容易飘。</p>
<p>当然，任何护眼方案都不是让你无限熬夜的借口；背光也不等同于台灯，需要的话还是得补环境光。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e860476b79848bc9246e4b27d22ebbf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5byn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778034&amp;x-signature=5l8ubnJNeB9E6%2BgTxu1wBNX6EZ8%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db2e5f7972b74740a6fca30653099353~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5byn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778034&amp;x-signature=lN8lEqZw2xUM3WkIZNiSeCheKDo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">3）编程模式：别把“看代码”当成普通显示器的默认任务</h3>
<p>很多显示器谈护眼，更多是“降低刺激”；但程序员真正的痛点是：<strong>我们看的不是图片，是结构化文本，是语法高亮，是一堆高频对比的小信息</strong>。 RD280U的“编程模式”之所以值得单独拎出来讲，是因为它解决的不是“看得见”，而是“看得清、看得久、看得不烦”。</p>
<p>它的实现方式也很“工程化”：不是在系统里套个滤镜，而是在硬件侧提供专门的色彩模式，去适配深色/浅色两种常见主题，并把“层次感”做出来——关键字、字符串、注释、报错提示之间更容易区分，但又不是靠硬拉亮度去刺激眼睛。再加上一键切换，能把“我又要去调一堆参数”的折腾感直接砍掉。</p>
<p>我自己的体验是：深色编程模式下，红色报错提示、橙色警告、灰色注释的“分层”更明显；盯久了眼睛那种“被迫用力识别”的感觉会少很多，整体是更松弛的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b26213f4832f481bb8709876ac30ee8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5byn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778034&amp;x-signature=hslQeO1AiLl2NorvIyGJMKcVCTU%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b26be04b92242aa9f6b1944e2904888~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5byn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778034&amp;x-signature=q6gPOxmtb5AYEnOTR7SH27xOw3E%3D" alt="" loading="lazy"/></p>
<p>怎么开启/切换编程模式有很多种方式。我推荐选一个“你最顺手、最不费脑”的方式固定下来。</p>
<p>最简单的方式是触摸280U显示器下方的专属编码键，即可快速切换编程模式。</p>
<p>当然你也可以直接用显示器OSD菜单，路径一般是 <code>菜单</code> → <code>色彩模式</code> → 选 <code>编程（深色）/编程（浅色）</code>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/796e302df2fe41689d4945ee29c15095~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5byn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778034&amp;x-signature=sfhSCKWUE2r93hOzgNjHqxTrNbs%3D" alt="" loading="lazy"/></p>
<p>同时你还可以装 <code>Display Pilot 2</code>，在系统里点一下就切，甚至可以按时间自动切（白天浅色、晚上深色）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9650189acb7f48b0b2c71202fc63d7e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5byn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778034&amp;x-signature=v1RYjSEOM%2FxIM1gZtJuQCWwzcoM%3D" alt="" loading="lazy"/></p>
<p>至于怎么按个人偏好微调，我的原则是：<strong>先保证“舒服”和“清晰”，再追求“好看”</strong> 。顺序上通常是：先根据IDE主题选深色或浅色当底座；再把亮度降到“看久不累”；然后小幅调对比度和锐利度，让字和背景更分层、字边缘更清楚但不假锐；最后按环境把色温/低蓝光往中性或偏暖挪一点。如果你用 <code>Display Pilot 2</code>，把这套参数存成预设并绑定快捷切换，会省掉每天重复操作的摩擦。</p>
<p>如果你调完还觉得“不够清楚”，我的经验是：先检查IDE字体、行高、抗锯齿（这是经常被忽略但影响巨大的三件事），别一上来就把显示器亮度拉爆。</p>
<h3 data-id="heading-8">4）KVM + USB-C 一线通：减少桌面乱线，减少切换成本</h3>
<p>这项功能对“需要在两台设备间切换”的人特别爽：比如白天公司电脑在内网写业务，晚上切回个人电脑做开源/学习；或者一台跑本地服务，一台开资料/会议。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14c2bbfd5fa345d7bb27d18a0fe8a7cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5byn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778034&amp;x-signature=LIfNkIJl%2BrKYOil%2BQGjjqOxuExk%3D" alt="" loading="lazy"/></p>
<p>正确连线后，键盘鼠标直接插在显示器上，通过切换信号源实现KVM切换；再加上 <code>USB-C</code> 把视频+数据+供电合一（最高 <code>90W</code>），桌面线材会从“盘丝洞”变成“清爽模式”。它的价值不是省几秒，而是你不会因为嫌麻烦就一直拖着不切设备——很多人不是不想切，是不想拔线、配对、重连。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e02e8387e85466d9405a85275fe993d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5byn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778034&amp;x-signature=TLOBJ6t4%2BJyTVBqnHqzM2DG8TNE%3D" alt="" loading="lazy"/></p>
<p>需要注意的是，KVM 很吃“正确的线材与连接方式”；</p>
<p>而<code>90W</code> 的反向充电对大多数笔记本都是够用的，还省去了一根充电线，桌面会更整洁。</p>
<h3 data-id="heading-9">5）Display Pilot 2：把“每天重复设置”交给自动化</h3>
<p>我以前也觉得显示器软件是鸡肋，直到我真的每天要开一堆窗口：IDE、终端、浏览器文档、API工具、AI面板、日志……这时候你会发现，真正累人的不是某一次拖拽，而是“一天几十次对齐窗口”的高频摩擦。</p>
<p><code>Display Pilot 2</code> 的桌面分区有点像给屏幕加了“吸附磁铁”，窗口拖过去就自动贴好；场景切换则更像给显示器加了日程表，到点自动切到更适合当下的模式。它不一定会让你惊呼，但会让你少抱怨、少被小动作打断。</p>
<p>它的缺点也很朴素：要装软件，偶尔系统升级后得等适配更新；但整体属于“能用且有用”的那类配套。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ccf48494a62418186260d37c77baf86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5byn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778034&amp;x-signature=PvZPam7VxRFRgJcTU57aq76iMyg%3D" alt="" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/247d2b10c77942948c9f005160b64a79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5byn:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778034&amp;x-signature=Eoyr2cyZpS%2FkEMVVPu1SvIEL8OQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10"><strong>06 最后一个提效建议：锻炼身体，保护眼睛，别把自己当机器人</strong></h2>
<p>这条听起来像鸡汤，但我认真讲：<strong>它是我2025最硬核的提效工具。</strong></p>
<p>你再会用AI、再会写Prompt、再懂框架，如果你：</p>
<ul>
<li>眼睛不行</li>
<li>颈椎不行</li>
<li>精神不行</li>
</ul>
<p>那你的输出上限就会被身体锁死……我现在给自己定了很粗暴的规则：</p>
<ul>
<li>连续专注 45-60 分钟就起身走动</li>
<li>晚上尽量把环境光补起来（别在黑暗里怼屏）</li>
<li>有条件就上更舒服的显示器（别跟眼睛过不去）</li>
</ul>
<p><strong>提效不是把你卷到报废，是让你更长久地输出。</strong></p>
<h2 data-id="heading-11"><strong>07 总结：这条“更软”的提效链路，你可以直接抄</strong></h2>
<p>如果你只想带走一个可执行版本，我给你压缩成 7 句话：</p>
<ol>
<li><strong>模型分工</strong>：别一个模型硬扛所有活</li>
<li><strong>语音输入</strong>：别手动敲一大堆上下文</li>
<li><strong>spec框架</strong>：先定目标、边界、Done，再开干</li>
<li><strong>少滚动少切换</strong>：能同屏就同屏，能自动就自动</li>
<li><strong>屏幕要对</strong>：比例、可读性、护眼，都是生产力底座</li>
<li><strong>工具要服务流程</strong>：别为了工具而工具</li>
<li><strong>身体要顶得住</strong>：眼睛和颈椎是你最值钱的资产</li>
</ol>
<p>如果你跟我一样，天天跟代码、日志、AI面板打交道，想把“摩擦”降下来，<strong>明基 RD280U</strong> 这类编程向显示器确实值得你认真看一眼（我自己就是用上之后不太想回去了）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年终总结]]></title>    <link>https://juejin.cn/post/7589856408709398543</link>    <guid>https://juejin.cn/post/7589856408709398543</guid>    <pubDate>2025-12-31T09:42:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589856408709398543" data-draft-id="7589828902157860914" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年终总结"/> <meta itemprop="keywords" content="年终总结"/> <meta itemprop="datePublished" content="2025-12-31T09:42:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小满zs"/> <meta itemprop="url" content="https://juejin.cn/user/2463384809252397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年终总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2463384809252397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小满zs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T09:42:20.000Z" title="Wed Dec 31 2025 09:42:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">2025年终总结</h2>
<p>今年做的最多的事情就是写代码，如果写代码是热爱，那就写到世界充满爱❤️，大家好我是<code>小满</code>,我的口号是《传递知识是一件很酷的事》</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2fd12c90bef147e3bd91b073acbccf29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778939&amp;x-signature=N1eriWq1VHdME5yluEpwYjEYwgk%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-1">学习与成长</h4>
<p>目前无业，但我每天还是会继续学习8小时，我总能接受新事物，我也很喜欢看一些框架的影像，记录片，例如<code>Hono.js</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3f677886dad4a04b1f0723b8a720a3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778939&amp;x-signature=3mEeby02Hwu0mRbNYdZWvAuSYM4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c56531ff62d4d53bad3309d37114a6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778939&amp;x-signature=YeLzccVe2u5FUUrodqZ%2BplQ3T4w%3D" alt="image.png" loading="lazy"/></p>
<p>我阅读了许多名人传记，例如《毛泽东传》。我也喜欢观看各种短视频，涵盖毛主席的诗词、四渡赤水等，从中吸收历史知识，这让我更加了解毛主席。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05690b0b5cbc4b47bf6632d0b3a9b5b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778939&amp;x-signature=rAj1gMUwZdVEiTUHIHjH%2BMHX8%2Bk%3D" alt="image.png" loading="lazy"/></p>
<p>SEO(Search Engine Optimization)搜索引擎优化，我把SEO的专业知识系统性的学习了一遍，包括黑帽SEO/白帽SEO/网站优化手段（如<code>robots.txt</code>、<code>sitemap</code>、TDK、Web Vitals），以及Google搜索引擎的工作原理和常用工具（如Analytics、Search Console、Trends、Keyword Planner）</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c9c22d97f3de4164809bc757f2f4bdb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778939&amp;x-signature=rXIHNNml16xgszZPrgV5K0Oflg4%3D" alt="image.png" loading="lazy"/></p>
<p>还有很多技术，就不在此多BB我已经总结到了我的简历里面大家可自行观看</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a838ac3ff57a4146aac59f78a3e35c6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778939&amp;x-signature=sWVISQSEyve0v6uBxRdMe87Ee3s%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-2">2026计划</h4>
<p>明年首当其冲，带大家优先冲击<strong>Go</strong>语言。在未来的几年里，纯前端应用会变得越来越少，未来一定是混合型人才，近期我会把<strong>Next.js</strong>项目完结，然后转战<strong>Go</strong>语言的学习和应用。</p>
<p>第二件事情就是我会开一个小号，开始拍摄一些短剧。近期会策划一系列有趣的短剧，包括《老吃家系列》《校园搞笑系列》《程序员真实故事系列》，我也自学了各种运镜，拍摄手法，大家可以看我视频我其实很喜欢用<code>蒙太奇</code>的手法，以及<code>希区柯克变焦</code>，我相信命运掌握在自己的手中</p>
<p>第三件事，如果还有时间的话，我会录制<strong>Godot</strong>游戏开发教程。希望在一年的时间里，能开发出一个属于自己的独立游戏并上架<strong>Steam</strong>，这是一段漫长的旅程，但我会慢慢打磨。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0997a0aa766b43f4a4f6c77025954678~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767778939&amp;x-signature=s%2FJK6lyjknp5Z3zWSPBQPTCEtEo%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-3">结语</h4>
<p>祝看到本篇文章的各位，明年发大财，无病无灾无BUG。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hive的安装与配置]]></title>    <link>https://juejin.cn/post/7589876192138231835</link>    <guid>https://juejin.cn/post/7589876192138231835</guid>    <pubDate>2025-12-31T09:15:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589876192138231835" data-draft-id="7589823928413798426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hive的安装与配置"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-31T09:15:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三的开发日记"/> <meta itemprop="url" content="https://juejin.cn/user/4248949048749213"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hive的安装与配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4248949048749213/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三的开发日记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T09:15:29.000Z" title="Wed Dec 31 2025 09:15:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h5 data-id="heading-0">1.安装</h5>
<pre><code class="hljs language-js" lang="js">tar -xf apache-hive-<span class="hljs-number">3.1</span><span class="hljs-number">.3</span>-bin.<span class="hljs-property">tar</span>.<span class="hljs-property">gz</span> -C /opt/software
</code></pre>
<h5 data-id="heading-1">2.配置修改日志存放路径</h5>
<pre><code class="hljs language-js" lang="js">mv hive-log4j2.<span class="hljs-property">properties</span>.<span class="hljs-property">template</span> hive-log4j2.<span class="hljs-property">properties</span>
修改配置如下
property.<span class="hljs-property">hive</span>.<span class="hljs-property">log</span>.<span class="hljs-property">dir</span>=<span class="hljs-regexp">/opt/m</span>odule/hive/logs
</code></pre>
<h5 data-id="heading-2">3.Hive的JVM堆内存设置</h5>
<pre><code class="hljs language-js" lang="js">新版本的<span class="hljs-title class_">Hive</span>启动的时候，默认申请的<span class="hljs-variable constant_">JVM</span>堆内存大小为256M，<span class="hljs-variable constant_">JVM</span>堆内存申请的太小，导致后期开启本地模式，执行复杂的<span class="hljs-variable constant_">SQL</span>时经常会报错：java.<span class="hljs-property">lang</span>.<span class="hljs-property">OutOfMemoryError</span>: <span class="hljs-title class_">Java</span> heap space，因此最好提前调整一下<span class="hljs-variable constant_">HADOOP_HEAPSIZE</span>这个参数。

<span class="hljs-number">1.</span>修改$HIVE_HOME/conf下的hive-env.<span class="hljs-property">sh</span>.<span class="hljs-property">template</span>为hive-env.<span class="hljs-property">sh</span>

mv hive-env.<span class="hljs-property">sh</span>.<span class="hljs-property">template</span> hive-env.<span class="hljs-property">sh</span>

<span class="hljs-number">2.</span>将hive-env.<span class="hljs-property">sh</span>其中的参数 <span class="hljs-keyword">export</span> <span class="hljs-variable constant_">HADOOP_HEAPSIZE</span>修改为<span class="hljs-number">2048</span>，重启<span class="hljs-title class_">Hive</span>。

修改前
# <span class="hljs-title class_">The</span> heap size <span class="hljs-keyword">of</span> the jvm stared by hive shell script can be controlled <span class="hljs-attr">via</span>:
# <span class="hljs-keyword">export</span> <span class="hljs-variable constant_">HADOOP_HEAPSIZE</span>=<span class="hljs-number">1024</span>

修改后
# <span class="hljs-title class_">The</span> heap size <span class="hljs-keyword">of</span> the jvm stared by hive shell script can be controlled <span class="hljs-attr">via</span>:
<span class="hljs-keyword">export</span> <span class="hljs-variable constant_">HADOOP_HEAPSIZE</span>=<span class="hljs-number">2048</span>
</code></pre>
<h5 data-id="heading-3">4.关闭Hadoop虚拟内存检查</h5>
<pre><code class="hljs language-js" lang="js">
在yarn-site.<span class="hljs-property">xml</span>中关闭虚拟内存检查（虚拟内存校验，如果已经关闭了，就不需要配了）。
<span class="hljs-number">1.</span>修改前记得先停<span class="hljs-title class_">Hadoop</span>
cd /opt/<span class="hljs-variable language_">module</span>/hadoop-<span class="hljs-number">3.1</span><span class="hljs-number">.3</span>/etc/hadoop

<span class="hljs-number">2.</span>添加如下配置
vim yarn-site.<span class="hljs-property">xml</span>
&lt;property&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>yarn.nodemanager.vmem-check-enabled<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>false<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span></span>
&lt;/property&gt;

<span class="hljs-number">3.</span>修改完后记得分发yarn-site.<span class="hljs-property">xml</span>，并重启yarn。
</code></pre>
<h5 data-id="heading-4">5.设置hive可以使用DataGrip工具进行连接</h5>
<p>设置hive可以通过datagrip进行连接，需要修改hive-site.xml,hadoop目录下的core-site.xml内容,为了方便hive的管理，使用hiveservices.sh进行管理。</p>
<p>hive目录conf地址下的hive-site.xml</p>
<pre><code class="hljs language-js" lang="js">&lt;?xml version=<span class="hljs-string">"1.0"</span>?&gt;
&lt;?xml-stylesheet type=<span class="hljs-string">"text/xsl"</span> href=<span class="hljs-string">"configuration.xsl"</span>?&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- jdbc连接的URL --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javax.jdo.option.ConnectionURL<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>jdbc:mysql://hadoop102:3306/metastore?useSSL=false<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- jdbc连接的Driver--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javax.jdo.option.ConnectionDriverName<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>com.mysql.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- jdbc连接的username--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javax.jdo.option.ConnectionUserName<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>root<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- jdbc连接的password --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>javax.jdo.option.ConnectionPassword<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>cpc!23#@<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Hive默认在HDFS的工作目录 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/user/hive/warehouse<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>


    <span class="hljs-comment">&lt;!-- 指定hiveserver2连接的host --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hive.server2.thrift.bind.host<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>hadoop102<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 指定hiveserver2连接的端口号 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hive.server2.thrift.port<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>10000<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hive.metastore.uris<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>thrift://hadoop102:9083<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 指定hiveserver2连接的host --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hive.server2.thrift.bind.host<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>hadoop102<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 指定hiveserver2连接的端口号 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hive.server2.thrift.port<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>10000<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

    <span class="hljs-comment">&lt;!--显示字段名称--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hive.cli.print.header<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Whether to print the names of the columns in query output.<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hive.cli.print.current.db<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">description</span>&gt;</span>Whether to include the current database in the Hive prompt.<span class="hljs-tag">&lt;/<span class="hljs-name">description</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span>
</code></pre>
<p>hadoop的core-site.xml</p>
<pre><code class="hljs language-js" lang="js">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;
&lt;?xml-stylesheet type=<span class="hljs-string">"text/xsl"</span> href=<span class="hljs-string">"configuration.xsl"</span>?&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 指定 NameNode 的地址 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>fs.defaultFS<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>hdfs://hadoop102:8020<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 指定 hadoop 数据的存储目录 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hadoop.tmp.dir<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>/opt/module/hadoop-3.1.3/data<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 配置 HDFS 网页登录使用的静态用户为 atguigu --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hadoop.http.staticuser.user<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>atguigu<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
    <span class="hljs-comment">&lt;!--配置所有节点的atguigu用户都可作为代理用户--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hadoop.proxyuser.atguigu.hosts<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>*<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

    <span class="hljs-comment">&lt;!--配置atguigu用户能够代理的用户组为任意组--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hadoop.proxyuser.atguigu.groups<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>*<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

    <span class="hljs-comment">&lt;!--配置atguigu用户能够代理的用户为任意用户--&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>hadoop.proxyuser.atguigu.users<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>*<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span></span>
</code></pre>
<p>存放到hive的bin地址下的hiveservices.sh，注意修改配置执行权限 chmod +x hiveservices.sh</p>
<pre><code class="hljs language-js" lang="js">#!<span class="hljs-regexp">/bin/</span>bash

<span class="hljs-variable constant_">HIVE_LOG_DIR</span>=$HIVE_HOME/logs
<span class="hljs-keyword">if</span> [ ! -d $HIVE_LOG_DIR ]
then
    mkdir -p $HIVE_LOG_DIR
fi

#检查进程是否运行正常，参数<span class="hljs-number">1</span>为进程名，参数<span class="hljs-number">2</span>为进程端口
<span class="hljs-keyword">function</span> <span class="hljs-title function_">check_process</span>(<span class="hljs-params"/>)
{
    pid=$(ps -ef <span class="hljs-number">2</span>&gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span> | grep -v grep | grep -i $1 | awk <span class="hljs-string">'{print $2}'</span>)
    ppid=$(netstat -nltp <span class="hljs-number">2</span>&gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span> | grep $2 | awk <span class="hljs-string">'{print $7}'</span> | cut -d <span class="hljs-string">'/'</span> -f <span class="hljs-number">1</span>)
    echo $pid
    [[ <span class="hljs-string">"$pid"</span> =~ <span class="hljs-string">"$ppid"</span> ]] &amp;&amp; [ <span class="hljs-string">"$ppid"</span> ] &amp;&amp; <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> || <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">hive_start</span>(<span class="hljs-params"/>)
{
    metapid=$(check_process <span class="hljs-title class_">HiveMetastore</span> <span class="hljs-number">9083</span>)
    cmd=<span class="hljs-string">"nohup hive --service metastore &gt;$HIVE_LOG_DIR/metastore.log 2&gt;&amp;1 &amp;"</span>
    [ -z <span class="hljs-string">"$metapid"</span> ] &amp;&amp; <span class="hljs-built_in">eval</span> $cmd || echo <span class="hljs-string">"Metastroe服务已启动"</span>
    server2pid=$(check_process <span class="hljs-title class_">HiveServer2</span> <span class="hljs-number">10000</span>)
    cmd=<span class="hljs-string">"nohup hive --service hiveserver2 &gt;$HIVE_LOG_DIR/hiveServer2.log 2&gt;&amp;1 &amp;"</span>
    [ -z <span class="hljs-string">"$server2pid"</span> ] &amp;&amp; <span class="hljs-built_in">eval</span> $cmd || echo <span class="hljs-string">"HiveServer2服务已启动"</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">hive_stop</span>(<span class="hljs-params"/>)
{
metapid=$(check_process <span class="hljs-title class_">HiveMetastore</span> <span class="hljs-number">9083</span>)
    [ <span class="hljs-string">"$metapid"</span> ] &amp;&amp; kill $metapid || echo <span class="hljs-string">"Metastore服务未启动"</span>
    server2pid=$(check_process <span class="hljs-title class_">HiveServer2</span> <span class="hljs-number">10000</span>)
 [ <span class="hljs-string">"$server2pid"</span> ] &amp;&amp; kill $server2pid || echo <span class="hljs-string">"HiveServer2服务未启动"</span>
}

<span class="hljs-keyword">case</span> $1 <span class="hljs-keyword">in</span>
<span class="hljs-string">"start"</span>)
    hive_start
    ;;
<span class="hljs-string">"stop"</span>)
    hive_stop
    ;;
<span class="hljs-string">"restart"</span>)
    hive_stop
    sleep <span class="hljs-number">2</span>
    hive_start
    ;;
<span class="hljs-string">"status"</span>)
    check_process <span class="hljs-title class_">HiveMetastore</span> <span class="hljs-number">9083</span> &gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span> &amp;&amp; echo <span class="hljs-string">"Metastore服务运行正常"</span> || echo <span class="hljs-string">"Metastore服务运行异常"</span>
    check_process <span class="hljs-title class_">HiveServer2</span> <span class="hljs-number">10000</span> &gt;<span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span> &amp;&amp; echo <span class="hljs-string">"HiveServer2服务运行正常"</span> || echo <span class="hljs-string">"HiveServer2服务运行异常"</span>
    ;;
*)
    echo <span class="hljs-title class_">Invalid</span> <span class="hljs-title class_">Args</span>!
    echo <span class="hljs-string">'Usage: '</span>$(basename $0)<span class="hljs-string">' start|stop|restart|status'</span>
    ;;
esac
</code></pre>
<h5 data-id="heading-5">6.使用mysql进行配置metastore</h5>
<p>原因在于Hive默认使用的元数据库为<strong>derby</strong>。<strong>derby数据库的特点是同一时间只允许一个客户端访问。如果多个Hive客户端同时访问，就会报错。</strong> 由于在企业开发中，都是多人协作开发，需要多客户端同时访问Hive，怎么解决呢？我们可以将Hive的元数据改为用MySQL存储，MySQL支持多客户端同时访问。</p>
<pre><code class="hljs language-js" lang="js">使用工具navicat创建数据库 metastore或者服务器内登录mysql 执行create database metastore;

[username@hadoop102 hive]$ bin/schematool -dbType mysql -initSchema -verbose
</code></pre>
<h6 data-id="heading-6">7.hive下载地址</h6>
<pre><code class="hljs language-js" lang="js"><span class="hljs-attr">https</span>:<span class="hljs-comment">//archive.apache.org/dist/hive/</span>
</code></pre>
<h6 data-id="heading-7">8.使用Datagrip进行验证是否可以登录</h6>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5e02e20f02c47eb9e5733a48fe5a89b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ55qE5byA5Y-R5pel6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767777328&amp;x-signature=RLGoP13O2ZDtm%2FWg6S5VZpkf6Pg%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[表格组件封装详解（含完整代码）]]></title>    <link>https://juejin.cn/post/7589706646215901184</link>    <guid>https://juejin.cn/post/7589706646215901184</guid>    <pubDate>2025-12-31T09:02:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589706646215901184" data-draft-id="7589856408709136399" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="表格组件封装详解（含完整代码）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-31T09:02:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="婷婷婷婷"/> <meta itemprop="url" content="https://juejin.cn/user/1121968495526407"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            表格组件封装详解（含完整代码）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1121968495526407/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    婷婷婷婷
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T09:02:06.000Z" title="Wed Dec 31 2025 09:02:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">表格组件封装详解（含完整代码）</h2>
<p>本文详细解析 <strong>布局容器 + 动态搜索栏 + 智能表格</strong> 三组件的封装逻辑、实现细节与标准用法，附带完整可运行代码。</p>
<hr/>
<h3 data-id="heading-1">一、整体架构与协作关系</h3>
<h4 data-id="heading-2">🧩 组件职责划分</h4>

























<table><thead><tr><th>组件</th><th>职责</th><th>关键能力</th></tr></thead><tbody><tr><td><strong><code>LayoutContainer.vue</code></strong></td><td>布局骨架</td><td>统一结构、操作按钮（刷新/显隐列/折叠搜索）</td></tr><tr><td><strong><code>DynamicSearchBar.vue</code></strong></td><td>动态表单</td><td>根据配置生成 input/select/date 等控件</td></tr><tr><td><strong><code>SmartTable.vue</code></strong></td><td>数据展示</td><td>自动请求、分页、字典转换、时间格式化</td></tr></tbody></table>
<h4 data-id="heading-3">🔗 数据流图</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[LayoutContainer]</span>
   │
   ├─ <span class="hljs-selector-id">#search</span> → <span class="hljs-selector-attr">[DynamicSearchBar]</span> ←→ params (v-model)
   │                │
   │                └── tableRef<span class="hljs-selector-class">.getList</span>() ←──┐
   │                                          │
   └─ <span class="hljs-selector-id">#default</span> → <span class="hljs-selector-attr">[SmartTable]</span> ←───────────────┘
                   ↑
             <span class="hljs-attribute">columns</span> (响应式数组)
             tableRef (expose 方法)
</code></pre>
<blockquote>
<p>✅ <strong>关键设计</strong>：</p>
<ul>
<li><code>columns</code> 是<strong>共享状态</strong>：LayoutContainer 修改 <code>.hide</code> → SmartTable 自动响应</li>
<li><code>tableRef</code> 是<strong>方法通道</strong>：SearchBar 和 LayoutContainer 通过它触发表格刷新</li>
</ul>
</blockquote>
<hr/>
<h3 data-id="heading-4">二、智能表格组件（SmartTable.vue）</h3>
<h4 data-id="heading-5">💡 封装目标</h4>
<ul>
<li>自动处理分页、排序、加载状态</li>
<li>支持字典、时间、链接等常见字段类型</li>
<li>提供插槽覆盖默认渲染</li>
</ul>
<h4 data-id="heading-6">📄 完整代码</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- SmartTable.vue --&gt;
&lt;template&gt;
  &lt;div class="smart-table"&gt;
    &lt;el-table
      ref="tableRef"
      v-loading="loading"
      :data="tableData"
      v-bind="mergedConfig.table"
      @sort-change="handleSortChange"
    &gt;
      &lt;!-- 遍历 columns 渲染列 --&gt;
      &lt;template v-for="column in visibleColumns" :key="column.prop"&gt;
        &lt;!-- selection / index 列 --&gt;
        &lt;el-table-column
          v-if="column.type === 'selection'"
          type="selection"
          :width="column.width || 55"
        /&gt;
        &lt;el-table-column
          v-else-if="column.type === 'index'"
          type="index"
          :label="column.label"
          :width="column.width || 60"
        /&gt;

        &lt;!-- 普通列 --&gt;
        &lt;el-table-column
          v-else
          :prop="column.prop"
          :label="column.label"
          :width="column.width"
          :sortable="column.sortable || false"
          :show-overflow-tooltip="true"
        &gt;
          &lt;template #default="{ row }"&gt;
            &lt;!-- 插槽优先 --&gt;
            &lt;slot
              :name="column.slot"
              :row="row"
              :column="column"
              v-if="column.slot"
            /&gt;
            &lt;!-- 字典标签 --&gt;
            &lt;dict-tag
              v-else-if="column.dict"
              :value="row[column.prop]"
              :dict-key="column.dict"
            /&gt;
            &lt;!-- 时间格式化 --&gt;
            &lt;span v-else-if="column.date"&gt;
              {{ formatDate(row[column.prop], column.dateFormat) }}
            &lt;/span&gt;
            &lt;!-- 链接 --&gt;
            &lt;el-link
              v-else-if="column.link"
              type="primary"
              @click="handleLinkClick(column, row)"
            &gt;
              {{ row[column.prop] }}
            &lt;/el-link&gt;
            &lt;!-- 默认文本 --&gt;
            &lt;span v-else&gt;{{ row[column.prop] }}&lt;/span&gt;
          &lt;/template&gt;

          &lt;!-- 表头提示 --&gt;
          &lt;template #header&gt;
            &lt;span&gt;{{ column.label }}&lt;/span&gt;
            &lt;el-tooltip
              v-if="column.tip"
              :content="column.tip.content"
              placement="top"
            &gt;
              &lt;i class="el-icon-question" style="margin-left: 4px; color: #999"&gt;&lt;/i&gt;
            &lt;/el-tooltip&gt;
          &lt;/template&gt;
        &lt;/el-table-column&gt;
      &lt;/template&gt;

      &lt;!-- 空状态 --&gt;
      &lt;template #empty&gt;
        &lt;div class="no-data"&gt;
          &lt;img src="@/assets/images/no-data.png" alt="无数据" /&gt;
          &lt;p&gt;暂无数据&lt;/p&gt;
        &lt;/div&gt;
      &lt;/template&gt;
    &lt;/el-table&gt;

    &lt;!-- 分页 --&gt;
    &lt;el-pagination
      v-if="!mergedConfig.notPagination &amp;&amp; total &gt; 0"
      v-model:current-page="queryParams.pageNum"
      v-model:page-size="queryParams.pageSize"
      :total="total"
      layout="total, sizes, prev, pager, next, jumper"
      @size-change="handleSizeChange"
      @current-change="getList"
      v-bind="mergedConfig.pagination"
    /&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, reactive, computed, onMounted, watch } from 'vue'
import { parseTime } from '@/utils'

// Props
const props = defineProps({
  columns: {
    type: Array,
    required: true
  },
  func: {
    type: Function,
    required: true
  },
  params: {
    type: Object,
    default: () =&gt; ({})
  },
  config: {
    type: Object,
    default: () =&gt; ({})
  },
  events: {
    type: Object,
    default: () =&gt; ({})
  }
})

// Expose
const tableRef = ref(null)
defineExpose({
  getList,
  resetQuery,
  reload
})

// 响应式数据
const loading = ref(false)
const tableData = ref([])
const total = ref(0)
const queryParams = reactive({
  pageNum: 1,
  pageSize: 10,
  ...props.params
})

// 合并配置
const mergedConfig = computed(() =&gt; {
  return {
    table: {
      border: true,
      stripe: true,
      ...props.config.table
    },
    pagination: {
      background: true,
      pageSizes: [10, 20, 50, 100],
      ...props.config.pagination
    },
    sort: props.config.sort ?? false,
    notPagination: props.config.notPagination ?? false,
    autoPagination: props.config.autoPagination ?? false,
    initResquest: props.config.initResquest ?? true
  }
})

// 可见列（过滤 hide = true 的列）
const visibleColumns = computed(() =&gt; {
  return props.columns.filter(col =&gt; !col.hide)
})

// 格式化时间
function formatDate(value, format = '{y}-{m}-{d}') {
  if (!value) return ''
  return parseTime(value, format)
}

// 获取数据
async function getList() {
  try {
    loading.value = true

    // 触发 formatParams 事件
    let finalParams = { ...queryParams }
    if (props.events?.formatParams) {
      finalParams = props.events.formatParams(finalParams) || finalParams
    }

    const res = await props.func(finalParams)

    // 触发 formatData 事件
    let finalData = res
    if (props.events?.formatData) {
      finalData = props.events.formatData(res) || res
    }

    // 处理分页数据
    if (mergedConfig.value.autoPagination) {
      // 前端分页
      tableData.value = finalData.data || []
      total.value = tableData.value.length
    } else {
      // 后端分页
      tableData.value = finalData.data?.rows || []
      total.value = finalData.data?.total || 0
    }
  } catch (error) {
    console.error('表格请求失败:', error)
    tableData.value = []
    total.value = 0
  } finally {
    loading.value = false
  }
}

// 重置查询
function resetQuery() {
  queryParams.pageNum = 1
  getList()
}

// 强制重绘
function reload() {
  tableRef.value?.doLayout()
}

// 排序变更
function handleSortChange({ prop, order }) {
  if (mergedConfig.value.sort) {
    const sort = order ? { prop, order: order === 'ascending' ? 'asc' : 'desc' } : null
    if (props.events?.onSortChange) {
      props.events.onSortChange(queryParams, sort)
    }
    getList()
  }
}

// 分页大小变更
function handleSizeChange(val) {
  queryParams.pageSize = val
  getList()
}

// 链接点击
function handleLinkClick(column, row) {
  if (props.events?.onLinkClick) {
    props.events.onLinkClick(column, row)
  } else if (column.link?.name) {
    // 路由跳转
    router.push({
      name: column.link.name,
      params: typeof column.link.params === 'function'
        ? column.link.params(row)
        : column.link.params
    })
  }
}

// 初始化
onMounted(() =&gt; {
  if (mergedConfig.value.initResquest) {
    getList()
  }
})

// 监听外部 params 变更
watch(() =&gt; props.params, (newVal) =&gt; {
  Object.assign(queryParams, newVal)
}, { deep: true })
&lt;/script&gt;

&lt;style scoped&gt;
.smart-table {
  width: 100%;
}
.no-data {
  text-align: center;
  padding: 40px 0;
}
.no-data img {
  width: 120px;
  opacity: 0.6;
}
&lt;/style&gt;
</code></pre>
<hr/>
<h3 data-id="heading-7">三、动态搜索栏组件（DynamicSearchBar.vue）</h3>
<h4 data-id="heading-8">💡 封装目标</h4>
<ul>
<li>根据配置动态生成不同类型的输入控件</li>
<li>自动绑定参数，支持回车查询</li>
<li>超过3项自动折叠</li>
</ul>
<h4 data-id="heading-9">📄 完整代码</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- DynamicSearchBar.vue --&gt;
&lt;template&gt;
  &lt;el-form
    ref="formRef"
    :model="localParams"
    :inline="true"
    label-width="80px"
    size="small"
  &gt;
    &lt;!-- 显示项 --&gt;
    &lt;el-form-item
      v-for="(item, index) in displayedItems"
      :key="item.prop"
      :label="item.label"
      v-has-permi="item.permi"
    &gt;
      &lt;!-- input --&gt;
      &lt;el-input
        v-if="item.component.is === 'input'"
        v-model="localParams[item.prop]"
        v-bind="item.component"
        @keyup.enter="handleQuery"
        clearable
      /&gt;
      &lt;!-- select --&gt;
      &lt;el-select
        v-else-if="item.component.is === 'select'"
        v-model="localParams[item.prop]"
        v-bind="item.component"
        @change="handleQuery"
        clearable
      &gt;
        &lt;el-option
          v-for="opt in item.component.options"
          :key="opt.value"
          :label="opt.label"
          :value="opt.value"
        /&gt;
      &lt;/el-select&gt;
      &lt;!-- date-picker --&gt;
      &lt;el-date-picker
        v-else-if="item.component.is === 'date-picker'"
        v-model="localParams[item.prop]"
        v-bind="item.component"
        @change="handleQuery"
      /&gt;
      &lt;!-- tree-select --&gt;
      &lt;el-tree-select
        v-else-if="item.component.is === 'tree-select'"
        v-model="localParams[item.prop]"
        v-bind="item.component"
        @change="handleQuery"
      /&gt;
    &lt;/el-form-item&gt;

    &lt;!-- 操作按钮 --&gt;
    &lt;el-form-item&gt;
      &lt;el-button type="primary" @click="handleQuery"&gt;查询&lt;/el-button&gt;
      &lt;el-button @click="handleReset"&gt;重置&lt;/el-button&gt;
      &lt;el-button
        v-if="items.length &gt; 3"
        type="text"
        @click="toggleExpand"
      &gt;
        {{ isExpanded ? '收起' : '展开' }}&lt;i :class="`el-icon-arrow-${isExpanded ? 'up' : 'down'}`"&gt;&lt;/i&gt;
      &lt;/el-button&gt;
    &lt;/el-form-item&gt;
  &lt;/el-form&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, reactive, computed, watch } from 'vue'
const props = defineProps({
  items: {
    type: Array,
    required: true
  },
  params: {
    type: Object,
    required: true
  },
  config: {
    type: Object,
    default: () =&gt; ({})
  },
  tableRef: {
    type: Object,
    default: () =&gt; ({})
  }
})

// 响应式数据
const localParams = reactive({})
const isExpanded = ref(false)

// 计算显示项（折叠逻辑）
const displayedItems = computed(() =&gt; {
  if (isExpanded.value || props.items.length &lt;= 3) {
    return props.items
  }
  return props.items.slice(0, 3)
})

// 同步外部 params
watch(() =&gt; props.params, (newVal) =&gt; {
  Object.assign(localParams, newVal)
}, { immediate: true, deep: true })

// 同步到外部
watch(localParams, (newVal) =&gt; {
  Object.assign(props.params, newVal)
}, { deep: true })

// 查询
function handleQuery() {
  if (props.tableRef?.getList) {
    props.tableRef.getList()
  }
  // 触发事件
  emit('query', { ...localParams })
}

// 重置
function handleReset() {
  // 重置为初始值
  for (const key in localParams) {
    localParams[key] = ''
  }
  handleQuery()
  emit('reset')
}

// 切换展开
function toggleExpand() {
  isExpanded.value = !isExpanded.value
}

// 权限指令（示例）
const vHasPermi = {
  mounted(el, binding) {
    const { value } = binding
    if (value &amp;&amp; !checkPermission(value)) {
      el.style.display = 'none'
    }
  }
}

// 模拟权限检查
function checkPermission(permi) {
  // 实际项目中从 store 或全局状态获取用户权限
  const userPermi = ['user:query', 'role:edit'] // 示例
  if (Array.isArray(permi)) {
    return permi.some(p =&gt; userPermi.includes(p))
  }
  return userPermi.includes(permi)
}

const emit = defineEmits(['query', 'reset'])
&lt;/script&gt;
</code></pre>
<hr/>
<h3 data-id="heading-10">四、布局容器组件（LayoutContainer.vue）</h3>
<h4 data-id="heading-11">💡 封装目标</h4>
<ul>
<li>提供标准化布局结构</li>
<li>集成常用操作（刷新/显隐列/折叠搜索）</li>
<li>控制内容区高度自适应</li>
</ul>
<h4 data-id="heading-12">📄 完整代码</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- LayoutContainer.vue --&gt;
&lt;template&gt;
  &lt;div class="layout-container"&gt;
    &lt;!-- 搜索区 --&gt;
    &lt;div class="search-area" v-if="$slots.search" v-show="store.search"&gt;
      &lt;slot name="search"&gt;&lt;/slot&gt;
    &lt;/div&gt;

    &lt;!-- 内容区 --&gt;
    &lt;div :class="['content-area', config.fullContent ? 'full' : '']"&gt;
      &lt;!-- 操作栏 --&gt;
      &lt;div class="action-bar" v-if="config.actions.show"&gt;
        &lt;div class="left-actions"&gt;
          &lt;slot name="actions-data"&gt;&lt;/slot&gt;
        &lt;/div&gt;
        &lt;div class="right-actions" v-if="config.actions.table.show"&gt;
          &lt;!-- 折叠搜索 --&gt;
          &lt;el-tooltip content="隐藏搜索" placement="top"&gt;
            &lt;el-button
              circle
              @click="store.search = !store.search"
              v-show="config.actions.table.search"
            &gt;
              &lt;i class="el-icon-search"&gt;&lt;/i&gt;
            &lt;/el-button&gt;
          &lt;/el-tooltip&gt;

          &lt;!-- 刷新 --&gt;
          &lt;el-tooltip content="刷新" placement="top"&gt;
            &lt;el-button
              circle
              v-show="config.actions.table.refresh"
              @click="handleRefresh"
            &gt;
              &lt;i class="el-icon-refresh"&gt;&lt;/i&gt;
            &lt;/el-button&gt;
          &lt;/el-tooltip&gt;

          &lt;!-- 显隐列 --&gt;
          &lt;el-tooltip content="显隐列" placement="top"&gt;
            &lt;el-dropdown
              trigger="click"
              :hide-on-click="false"
              v-show="config.actions.table.columns"
              popper-class="column-toggle-popper"
            &gt;
              &lt;el-button circle&gt;
                &lt;i class="el-icon-menu"&gt;&lt;/i&gt;
              &lt;/el-button&gt;
              &lt;template #dropdown&gt;
                &lt;el-dropdown-menu&gt;
                  &lt;el-dropdown-item
                    v-for="col in props.columns"
                    :key="col.prop"
                  &gt;
                    &lt;el-checkbox
                      v-if="col.type !== 'selection'"
                      :model-value="!col.hide"
                      @update:model-value="(val) =&gt; toggleColumn(col, val)"
                    &gt;
                      {{ col.label }}
                    &lt;/el-checkbox&gt;
                  &lt;/el-dropdown-item&gt;
                &lt;/el-dropdown-menu&gt;
              &lt;/template&gt;
            &lt;/el-dropdown&gt;
          &lt;/el-tooltip&gt;
        &lt;/div&gt;
      &lt;/div&gt;

      &lt;!-- 主体内容 --&gt;
      &lt;div class="main-content" v-if="$slots.default"&gt;
        &lt;slot&gt;&lt;/slot&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { reactive, computed } from 'vue'
import { merge } from 'lodash-es'

// 默认配置
const DEFAULT_CONFIG = {
  fullContent: true,
  actions: {
    show: true,
    table: {
      show: true,
      search: true,
      refresh: true,
      columns: true
    }
  }
}

const props = defineProps({
  columns: {
    type: Array,
    default: () =&gt; []
  },
  config: {
    type: Object,
    default: () =&gt; ({})
  },
  tableRef: {
    type: Object,
    default: () =&gt; ({})
  }
})

const config = computed(() =&gt; {
  return merge({}, DEFAULT_CONFIG, props.config)
})

const store = reactive({
  search: true
})

// 刷新
function handleRefresh() {
  if (props.tableRef?.getList) {
    props.tableRef.getList()
  }
}

// 切换列显隐
function toggleColumn(column, visible) {
  column.hide = !visible
}
&lt;/script&gt;

&lt;style scoped&gt;
.layout-container {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
}

.search-area {
  padding: 15px;
  background: #fff;
  border-radius: 4px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  margin-bottom: 16px;
}

.content-area {
  background: #fff;
  border-radius: 4px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  flex: none;
}

.content-area.full {
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 0;
}

.action-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px 0;
  gap: 12px;
}

.left-actions,
.right-actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

.main-content {
  flex: 1;
  padding: 16px;
  overflow: auto;
}
&lt;/style&gt;

&lt;style&gt;
/* 全局样式（非 scoped） */
.column-toggle-popper .el-dropdown-menu__item {
  line-height: 32px;
  padding: 0 16px;
}
&lt;/style&gt;
</code></pre>
<hr/>
<h3 data-id="heading-13">五、标准使用示例</h3>
<h4 data-id="heading-14">📄 父组件（业务页面）</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;layout-container 
    :columns="columns" 
    :config="wrapConfig" 
    :table-ref="tableRef"
  &gt;
    &lt;!-- 搜索区 --&gt;
    &lt;template #search&gt;
      &lt;dynamic-search-bar
        :items="searchItems"
        :params="queryParams"
        :table-ref="tableRef"
      /&gt;
    &lt;/template&gt;

    &lt;!-- 左侧操作 --&gt;
    &lt;template #actions-data&gt;
      &lt;el-button type="primary" @click="handleAdd"&gt;新增用户&lt;/el-button&gt;
    &lt;/template&gt;

    &lt;!-- 表格 --&gt;
    &lt;smart-table
      ref="tableRef"
      :columns="columns"
      :func="getUserList"
      :params="queryParams"
      :config="tableConfig"
      :events="tableEvents"
    &gt;
      &lt;!-- 自定义操作列 --&gt;
      &lt;template #operation="{ row }"&gt;
        &lt;el-button size="small" @click="handleEdit(row)"&gt;编辑&lt;/el-button&gt;
        &lt;el-button size="small" type="danger" @click="handleDelete(row)"&gt;删除&lt;/el-button&gt;
      &lt;/template&gt;
    &lt;/smart-table&gt;
  &lt;/layout-container&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { reactive, ref } from 'vue'
import { getUserListAPI } from '@/api/user'

// 查询参数
const queryParams = reactive({
  username: '',
  status: '',
  createTime: []
})

// 表格列
const columns = reactive([
  { label: '用户名', prop: 'username' },
  { label: '状态', prop: 'status', dict: 'sys_normal_disable' },
  { label: '创建时间', prop: 'createTime', date: true },
  { label: '操作', prop: 'operation', slot: 'operation', width: 180 }
])

// 配置
const wrapConfig = {
  fullContent: true
}

const searchItems = [
  { label: '用户名', prop: 'username', component: { is: 'input', placeholder: '请输入' } },
  { 
    label: '状态', 
    prop: 'status',
    component: { 
      is: 'select',
      options: [
        { value: '1', label: '启用' },
        { value: '0', label: '禁用' }
      ]
    }
  },
  {
    label: '创建时间',
    prop: 'createTime',
    component: { is: 'date-picker', type: 'daterange', rangeSeparator: '-' }
  }
]

const tableConfig = {
  sort: true
}

const tableEvents = {
  formatParams(params) {
    // 处理日期范围
    if (params.createTime?.length) {
      params.beginTime = params.createTime[0]
      params.endTime = params.createTime[1]
      delete params.createTime
    }
    return params
  }
}

const tableRef = ref(null)

// API 方法
async function getUserList(params) {
  const res = await getUserListAPI(params)
  return { data: { rows: res.list, total: res.total } }
}

// 操作方法
function handleAdd() { /* ... */ }
function handleEdit(row) { /* ... */ }
function handleDelete(row) { /* ... */ }
&lt;/script&gt;
</code></pre>
<hr/>
<h3 data-id="heading-15">六、关键设计总结</h3>
<h4 data-id="heading-16">✅ 为什么这样设计？</h4>



































<table><thead><tr><th>问题</th><th>解决方案</th><th>优势</th></tr></thead><tbody><tr><td>每页重复写表格结构</td><td><strong>SmartTable 封装</strong></td><td>减少 70% 模板代码</td></tr><tr><td>搜索表单千奇百怪</td><td><strong>DynamicSearchBar 配置驱动</strong></td><td>统一体验，快速开发</td></tr><tr><td>刷新/显隐列位置不一</td><td><strong>LayoutContainer 标准化</strong></td><td>全系统交互一致</td></tr><tr><td>列显隐状态难管理</td><td><strong>直接修改 columns.hide</strong></td><td>无需 emit，天然响应式</td></tr><tr><td>业务逻辑耦合 UI</td><td><strong>events 解耦 + slot 覆盖</strong></td><td>高内聚低耦合</td></tr></tbody></table>
<h4 data-id="heading-17">⚠️ 使用注意事项</h4>
<ol>
<li>
<p><strong><code>columns</code> 必须是响应式对象</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ✅ 正确</span>
<span class="hljs-keyword">const</span> columns = <span class="hljs-title function_">reactive</span>([...])

<span class="hljs-comment">// ❌ 错误</span>
:columns=<span class="hljs-string">"[{ label: 'ID', prop: 'id' }]"</span>
</code></pre>
</li>
<li>
<p><strong>不要在组件内部写业务 API</strong></p>
<ul>
<li>所有数据请求通过 <code>func</code> prop 传入</li>
<li>参数处理通过 <code>events.formatParams</code></li>
</ul>
</li>
<li>
<p><strong>复杂 UI 用插槽覆盖</strong></p>
<ul>
<li>操作列 → <code>slot</code></li>
<li>自定义单元格 → <code>slot</code></li>
</ul>
</li>
<li>
<p><strong>权限控制统一接入</strong></p>
<ul>
<li>搜索项权限 → <code>v-hasPermi</code></li>
<li>按钮权限 → 父组件控制</li>
</ul>
</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db8ac6b18f3c4a72a65e139f89939a39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5am35am35am35am3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767776525&amp;x-signature=QE4%2Fdh7kDa8FeQhSaYNuWslrLB8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<blockquote>
<p>💬 <strong>结语</strong>：这套组件体系已在多个大型后台项目中验证，显著提升开发效率与代码质量。核心思想是 <strong>“配置驱动 UI，事件解耦逻辑，插槽覆盖特例”</strong>，在规范性与灵活性之间取得平衡。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这应该是前端转后端最简单的办法了，不买服务器、不配 Nginx，也能写服务端接口，腾讯云云函数全栈实践]]></title>    <link>https://juejin.cn/post/7589838714449444905</link>    <guid>https://juejin.cn/post/7589838714449444905</guid>    <pubDate>2025-12-31T09:32:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838714449444905" data-draft-id="7589830060334727222" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这应该是前端转后端最简单的办法了，不买服务器、不配 Nginx，也能写服务端接口，腾讯云云函数全栈实践"/> <meta itemprop="keywords" content="前端,JavaScript,全栈"/> <meta itemprop="datePublished" content="2025-12-31T09:32:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="帮小忙工具箱开发者"/> <meta itemprop="url" content="https://juejin.cn/user/1468603263091623"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这应该是前端转后端最简单的办法了，不买服务器、不配 Nginx，也能写服务端接口，腾讯云云函数全栈实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1468603263091623/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    帮小忙工具箱开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T09:32:24.000Z" title="Wed Dec 31 2025 09:32:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言：后端开发真的太累了</h2>
<p>作为一个想做独立开发的前端或全栈工程师，每当你想写个小项目（比如工具箱、记账本、个人博客）时，热情往往在配置后端的瞬间熄灭：</p>
<ol>
<li><strong>买服务器</strong>：几百块一年，性能还一般。</li>
<li><strong>配环境</strong>：SSH 连上去，装 Node、PM2、Nginx，防火墙配置。</li>
<li><strong>搞域名</strong>：买域名、备案（最劝退的一步）、配置 HTTPS 证书。</li>
<li><strong>写接口</strong>：纠结 RESTful 规范，<code>/api/v1/add</code> 还是 <code>/add</code>？参数放 Body 还是 Query？</li>
</ol>
<p><strong>我就想写个 <code>简单</code> 的接口，至于这么折腾吗？</strong></p>
<p>今天，我要给你安利一套 <strong>“零成本”、“免运维”、“免域名”</strong> 的全栈接口方案：
<strong>腾讯云 SCF (云函数) + 函数 URL + <code>rpc-server-scf</code></strong>。</p>
<p>你只需要写纯粹的 JS 函数，它就能自动变成 HTTP 接口，<strong>不用管服务器，甚至不用管 Nginx！</strong></p>
<hr/>
<h2 data-id="heading-1">🚀 什么是 rpc-server-scf？</h2>
<p>它是 <strong><code>js-rpc</code></strong> 生态中专为 <strong>腾讯云云函数 (SCF)</strong> 设计的服务端框架。</p>
<p>它的核心理念是：<strong>把云函数变成一个 RPC 服务器</strong>。
你不需要关心 HTTP 请求的报文结构，不需要关心 API 网关的参数透传。你只需要在 <code>api/</code> 目录下写函数，前端就能直接调用。</p>
<hr/>
<h2 data-id="heading-2">🛠️ 后端实战：3步搭建云端 RPC</h2>
<p>我们将使用腾讯云 SCF 的 <strong>“函数 URL”</strong> 功能，它会直接分配给你一个公网 HTTPS 地址，让你彻底告别 API 网关配置和域名备案。</p>
<h3 data-id="heading-3">第一步：准备代码</h3>
<p>在本地创建一个文件夹，初始化 npm：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> my-scf-rpc
<span class="hljs-built_in">cd</span> my-scf-rpc
npm init -y
npm install rpc-server-scf
</code></pre>
<h3 data-id="heading-4">第二步：编写业务逻辑 (api/math.js)</h3>
<p>我们不需要写路由，只需要在 <code>api</code> 目录下创建文件。文件名就是模块名。</p>
<p><strong><code>api/math.js</code></strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">// 加法</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>) {
    <span class="hljs-keyword">return</span> a + b;
  },
  
  <span class="hljs-comment">// 乘法</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a, b</span>) {
    <span class="hljs-keyword">return</span> a * b;
  },

  <span class="hljs-comment">// 稍微复杂点的逻辑</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">calculate</span>(<span class="hljs-params">params</span>) {
    <span class="hljs-comment">// 这里可以连数据库、Redis，或者做任何后端逻辑</span>
    <span class="hljs-keyword">const</span> { x, y, op } = params;
    <span class="hljs-keyword">if</span> (op === <span class="hljs-string">'minus'</span>) <span class="hljs-keyword">return</span> x - y;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
}
</code></pre>
<p><strong><code>index.js</code> (入口文件)</strong></p>
<p>一行代码，启动 RPC 服务：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { createRpcServer } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'rpc-server-scf'</span>);

<span class="hljs-comment">// 导出 main_handler 给云函数调用</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">main_handler</span> = <span class="hljs-title function_">createRpcServer</span>();
</code></pre>
<p><strong>这就写完了！</strong> 没有 Express，没有 <code>app.listen</code>，代码极其干净。</p>
<h3 data-id="heading-5">第三步：部署到腾讯云 SCF（开启“白嫖”模式）</h3>
<ol>
<li>
<p>登录 <a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.cloud.tencent.com%2Fscf" target="_blank" title="https://console.cloud.tencent.com/scf" ref="nofollow noopener noreferrer">腾讯云云函数控制台</a>。</p>
</li>
<li>
<p>点击 <strong>“新建”</strong> -&gt; 选择 <strong>“从头开始”</strong>。</p>
<ul>
<li><strong>函数名称</strong>：随便填，比如 <code>rpc-demo</code>。</li>
<li><strong>运行环境</strong>：Nodejs 16.13 或以上。</li>
</ul>
</li>
<li>
<p><strong>上传代码</strong>：</p>
<ul>
<li>将你的项目文件夹（包含 <code>node_modules</code>）压缩成 zip 包上传，或者直接在在线编辑器里创建文件并安装依赖。</li>
</ul>
</li>
<li>
<p><strong>🔥 关键步骤：启用访问服务 (函数 URL)</strong></p>
<ul>
<li>在“访问服务”或“触发器”配置中，找到 <strong>【函数 URL】</strong>。</li>
<li>点击 <strong>“启用”</strong>。</li>
<li><strong>鉴权方式</strong>：选择 <strong>“不校验 (PUBLIC)”</strong>（为了演示方便，生产环境可在代码里用中间件鉴权）。</li>
<li>你将获得一个长这样的地址：<code>https://你的函数ID.scf.tencentcs.com</code>。</li>
</ul>
<p><em>(如图所示，不用买域名，直接送你一个 HTTPS 的公网地址！)</em></p>
</li>
</ol>
<hr/>
<h2 data-id="heading-6">⚡️ 前端如何调用？</h2>
<p>现在你的后端已经跑在云端了。前端（小程序、UniApp、Web）怎么调？</p>
<p>我们使用配套的客户端 <strong><code>rpc-client-request</code></strong>（专为小程序/UniApp/HTTP场景设计）。</p>
<h3 data-id="heading-7">安装</h3>
<pre><code class="hljs language-bash" lang="bash">npm install rpc-client-request
</code></pre>
<h3 data-id="heading-8">调用代码</h3>
<p>在小程序或 UniApp 中：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">'rpc-client-request'</span>;

<span class="hljs-comment">// 填入刚才腾讯云分配给你的“函数 URL”</span>
<span class="hljs-keyword">const</span> rpc = <span class="hljs-title function_">create</span>({
  <span class="hljs-attr">url</span>: <span class="hljs-string">'https://service-xxxx.scf.tencentcs.com/release/rpc-demo'</span> 
});

<span class="hljs-comment">// 业务调用</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 像调用本地函数一样！</span>
    <span class="hljs-comment">// 自动发请求给 api/math.js 的 add 方法</span>
    <span class="hljs-keyword">const</span> sum = <span class="hljs-keyword">await</span> rpc.<span class="hljs-property">math</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'计算结果：'</span>, sum); <span class="hljs-comment">// 30</span>
    
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'调用出错'</span>, err);
  }
}
</code></pre>
<p><strong>完事！</strong>
你没有写 <code>wx.request</code>，没有拼接 URL，没有处理 POST 参数，一切就像在写本地代码。</p>
<hr/>
<h2 data-id="heading-9">🌟 为什么这套方案是“独立开发者”的神器？</h2>
<h3 data-id="heading-10">1. 真正的“零运维” (Serverless)</h3>
<p>你不需要维护服务器进程，不需要配置 Nginx 反向代理，不需要担心服务器挂掉。腾讯云帮你托管，有请求自动唤醒，没请求自动休眠。</p>
<h3 data-id="heading-11">2. 免域名，自带 HTTPS</h3>
<p>利用 SCF 的 <strong>“函数 URL”</strong> 功能，你省去了购买域名、备案（通常需要半个月）、申请 SSL 证书的所有繁琐流程。起步阶段直接用官方链接，省时省力。</p>
<h3 data-id="heading-12">3. “白嫖”级成本</h3>
<p>腾讯云 SCF 有免费额度（或者非常低廉的按量付费）。对于个人项目、测试项目或者低频工具类应用，<strong>成本几乎为 0</strong>。只有当你的业务真的做大了，才需要支付少量费用。</p>
<h3 data-id="heading-13">4. 极致的开发体验</h3>
<ul>
<li><strong>后端</strong>：只写业务函数，文件即路由。</li>
<li><strong>前端</strong>：RPC 调用，像调本地方法一样顺滑。</li>
<li><strong>全栈</strong>：你可以把精力 100% 放在业务逻辑上，而不是浪费在 HTTP 协议的翻译工作中。</li>
</ul>
<hr/>
<h2 data-id="heading-14">🔗 总结与资源</h2>
<p>如果你厌倦了传统的后端开发流程，想快速上线一个全栈应用，<strong>SCF + 函数 URL + js-rpc</strong> 绝对是你现在的最佳选择。</p>
<ul>
<li><strong>项目 GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmyliweihao%2Fjs-rpc" target="_blank" title="https://github.com/myliweihao/js-rpc" ref="nofollow noopener noreferrer">github.com/myliweihao/…</a></li>
<li><strong>服务端 SDK</strong>: <code>npm install rpc-server-scf</code></li>
<li><strong>小程序客户端</strong>: <code>npm install rpc-client-request</code></li>
</ul>
<p>别再让“服务器运维”阻挡你改变世界的创意了，现在就开始吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 防重复点击指令 - clickOnce]]></title>    <link>https://juejin.cn/post/7589839767816355878</link>    <guid>https://juejin.cn/post/7589839767816355878</guid>    <pubDate>2025-12-31T09:34:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589839767816355878" data-draft-id="7589828902157877298" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 防重复点击指令 - clickOnce"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-31T09:34:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码途进化论"/> <meta itemprop="url" content="https://juejin.cn/user/3633206105473182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 防重复点击指令 - clickOnce
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3633206105473182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码途进化论
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T09:34:22.000Z" title="Wed Dec 31 2025 09:34:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue3 防重复点击指令 - clickOnce</h2>
<h3 data-id="heading-1">一、问题背景</h3>
<p>在实际的 Web 应用开发中，我们经常会遇到以下问题：</p>
<ol>
<li><strong>用户快速多次点击提交按钮</strong>：导致重复提交表单，产生多条相同数据</li>
<li><strong>异步请求未完成时再次点击</strong>：可能导致数据不一致或服务器压力增大</li>
<li><strong>用户体验不佳</strong>：没有明确的加载状态反馈，用户不知道操作是否正在进行</li>
</ol>
<p>这些问题在以下场景中尤为常见：</p>
<ul>
<li>表单提交（注册、登录、创建订单等）</li>
<li>数据保存操作</li>
<li>文件上传</li>
<li>支付操作</li>
<li>API 调用</li>
</ul>
<h3 data-id="heading-2">二、解决方案</h3>
<p><code>clickOnce</code> 指令通过以下机制解决上述问题：</p>
<h4 data-id="heading-3">1. <strong>节流机制</strong></h4>
<p>使用 <code>@vueuse/core</code> 的 <code>useThrottleFn</code>，在 1.5 秒内只允许执行一次点击操作。</p>
<h4 data-id="heading-4">2. <strong>按钮禁用</strong></h4>
<p>点击后立即禁用按钮，防止用户再次点击。</p>
<h4 data-id="heading-5">3. <strong>视觉反馈</strong></h4>
<p>自动添加 Element Plus 的 Loading 图标，让用户明确知道操作正在进行中。</p>
<h4 data-id="heading-6">4. <strong>智能恢复</strong></h4>
<ul>
<li>如果绑定的函数返回 Promise（异步操作），则在 Promise 完成后自动恢复按钮状态</li>
<li>如果是同步操作，则立即恢复</li>
</ul>
<h3 data-id="heading-7">三、核心特性</h3>
<p>✅ <strong>自动防重复点击</strong>：1.5秒节流时间<br/>
✅ <strong>自动 Loading 状态</strong>：无需手动管理 loading 变量<br/>
✅ <strong>支持异步操作</strong>：自动检测 Promise 并在完成后恢复<br/>
✅ <strong>优雅的清理机制</strong>：组件卸载时自动清理事件监听<br/>
✅ <strong>类型安全</strong>：完整的 TypeScript 支持</p>
<h3 data-id="heading-8">四、技术实现</h3>
<h4 data-id="heading-9">关键技术点</h4>
<ol>
<li><strong>Vue 3 自定义指令</strong>：使用 <code>Directive</code> 类型定义</li>
<li><strong>VueUse 节流</strong>：<code>useThrottleFn</code> 提供稳定的节流功能</li>
<li><strong>动态组件渲染</strong>：使用 <code>createVNode</code> 和 <code>render</code> 动态创建 Loading 图标</li>
<li><strong>Promise 检测</strong>：自动识别异步操作并在完成后恢复状态</li>
</ol>
<h4 data-id="heading-10">工作流程</h4>
<pre><code class="hljs language-javascript" lang="javascript">用户点击按钮
    ↓
节流检查（<span class="hljs-number">1.5</span>秒内只执行一次）
    ↓
禁用按钮 + 添加 <span class="hljs-title class_">Loading</span> 图标
    ↓
执行绑定的函数
    ↓
检测返回值是否为 <span class="hljs-title class_">Promise</span>
    ↓
<span class="hljs-title class_">Promise</span> 完成后（或同步函数执行完）
    ↓
移除 <span class="hljs-title class_">Loading</span> + 恢复按钮状态
</code></pre>
<h3 data-id="heading-11">五、使用方法</h3>
<h4 data-id="heading-12">1. 注册指令</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// main.ts</span>
<span class="hljs-keyword">import</span> clickOnce <span class="hljs-keyword">from</span> <span class="hljs-string">'@/directives/clickOnce'</span>

app.<span class="hljs-title function_">directive</span>(<span class="hljs-string">'click-once'</span>, clickOnce)
</code></pre>
<h4 data-id="heading-13">2. 在组件中使用</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- 异步操作示例 --&gt;
  &lt;el-button 
    type="primary" 
    v-click-once="handleSubmit"&gt;
    提交表单
  &lt;/el-button&gt;

  &lt;!-- 带参数的异步操作 --&gt;
  &lt;el-button 
    type="success" 
    v-click-once="() =&gt; handleSave(formData)"&gt;
    保存数据
  &lt;/el-button&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
const handleSubmit = async () =&gt; {
  // 模拟 API 调用
  await api.submitForm(formData)
  ElMessage.success('提交成功')
}

const handleSave = async (data: any) =&gt; {
  await api.saveData(data)
  ElMessage.success('保存成功')
}
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-14">六、优势对比</h3>
<h4 data-id="heading-15">传统方式</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-button 
    type="primary" 
    :loading="loading"
    :disabled="loading"
    @click="handleSubmit"&gt;
    提交
  &lt;/el-button&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
const loading = ref(false)

const handleSubmit = async () =&gt; {
  if (loading.value) return
  
  loading.value = true
  try {
    await api.submit()
  } finally {
    loading.value = false
  }
}
&lt;/script&gt;
</code></pre>
<p><strong>问题</strong>：</p>
<ul>
<li>需要手动管理 loading 状态</li>
<li>每个按钮都要写重复代码</li>
<li>容易遗漏 finally 清理逻辑</li>
</ul>
<h4 data-id="heading-16">使用 clickOnce 指令</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;el-button 
    type="primary" 
    v-click-once="handleSubmit"&gt;
    提交
  &lt;/el-button&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
const handleSubmit = async () =&gt; {
  await api.submit()
}
&lt;/script&gt;
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>代码简洁，无需管理状态</li>
<li>自动处理 loading 和禁用</li>
<li>统一的用户体验</li>
</ul>
<h3 data-id="heading-17">七、注意事项</h3>
<ol>
<li><strong>仅用于异步操作</strong>：该指令主要为异步操作设计，同步操作会立即恢复</li>
<li><strong>绑定函数必须返回 Promise</strong>：对于异步操作，确保函数返回 Promise</li>
<li><strong>节流时间固定</strong>：当前节流时间为 1.5 秒，可根据需求调整 <code>THROTTLE_TIME</code> 常量</li>
<li><strong>依赖 Element Plus</strong>：使用了 Element Plus 的 Loading 图标和样式</li>
</ol>
<h3 data-id="heading-18">八、适用场景</h3>
<p>✅ <strong>适合使用</strong>：</p>
<ul>
<li>表单提交按钮</li>
<li>数据保存按钮</li>
<li>文件上传按钮</li>
<li>API 调用按钮</li>
<li>支付确认按钮</li>
</ul>
<p>❌ <strong>不适合使用</strong>：</p>
<ul>
<li>普通导航按钮</li>
<li>切换/开关按钮</li>
<li>需要快速连续点击的场景（如计数器）</li>
</ul>
<h3 data-id="heading-19">九、指令源码</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">Directive</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { createVNode, render } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { useThrottleFn } <span class="hljs-keyword">from</span> <span class="hljs-string">'@vueuse/core'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Loading</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@element-plus/icons-vue'</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">THROTTLE_TIME</span> = <span class="hljs-number">1500</span>

<span class="hljs-keyword">const</span> <span class="hljs-attr">clickOnce</span>: <span class="hljs-title class_">Directive</span>&lt;<span class="hljs-title class_">HTMLButtonElement</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">unknown</span>&gt; | <span class="hljs-built_in">void</span>&gt; = {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params">el, binding</span>) {
    <span class="hljs-keyword">const</span> handleClick = <span class="hljs-title function_">useThrottleFn</span>(
      <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// 如果元素已禁用，直接返回（双重保险）</span>
        <span class="hljs-keyword">if</span> (el.<span class="hljs-property">disabled</span>) <span class="hljs-keyword">return</span>

        <span class="hljs-comment">// 禁用按钮</span>
        el.<span class="hljs-property">disabled</span> = <span class="hljs-literal">true</span>
        <span class="hljs-comment">// 添加 loading 状态</span>
        el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'is-loading'</span>)

        <span class="hljs-comment">// 创建 loading 图标容器</span>
        <span class="hljs-keyword">const</span> loadingIconContainer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'i'</span>)
        loadingIconContainer.<span class="hljs-property">className</span> = <span class="hljs-string">'el-icon is-loading'</span>

        <span class="hljs-comment">// 使用 Vue 的 createVNode 和 render 来渲染 Loading 组件</span>
        <span class="hljs-keyword">const</span> vnode = <span class="hljs-title function_">createVNode</span>(<span class="hljs-title class_">Loading</span>)
        <span class="hljs-title function_">render</span>(vnode, loadingIconContainer)

        <span class="hljs-comment">// 将 loading 图标插入到按钮开头</span>
        el.<span class="hljs-title function_">insertBefore</span>(loadingIconContainer, el.<span class="hljs-property">firstChild</span>)

        <span class="hljs-comment">// 将 loading 图标存储到元素上，以便后续移除</span>
        ;(el <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">_loadingIcon</span> = loadingIconContainer
        ;(el <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">_loadingVNode</span> = vnode

        <span class="hljs-comment">// 执行绑定的函数（应返回 Promise 或普通函数）</span>
        <span class="hljs-keyword">const</span> result = binding.<span class="hljs-property">value</span>?.()

        <span class="hljs-keyword">const</span> <span class="hljs-title function_">removeLoading</span> = (<span class="hljs-params"/>) =&gt; {
          el.<span class="hljs-property">disabled</span> = <span class="hljs-literal">false</span>
          <span class="hljs-comment">// 移除 loading 状态</span>
          el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'is-loading'</span>)
          <span class="hljs-keyword">const</span> icon = (el <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">_loadingIcon</span>
          <span class="hljs-keyword">if</span> (icon &amp;&amp; icon.<span class="hljs-property">parentNode</span> === el) {
            <span class="hljs-comment">// 卸载 Vue 组件</span>
            <span class="hljs-title function_">render</span>(<span class="hljs-literal">null</span>, icon)
            el.<span class="hljs-title function_">removeChild</span>(icon)
            <span class="hljs-keyword">delete</span> (el <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">_loadingIcon</span>
            <span class="hljs-keyword">delete</span> (el <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">_loadingVNode</span>
          }
        }

        <span class="hljs-comment">// 如果返回的是 Promise，则在完成时恢复；否则立即恢复</span>
        <span class="hljs-keyword">if</span> (result <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Promise</span>) {
          result.<span class="hljs-title function_">finally</span>(removeLoading)
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// 非异步操作，立即恢复（或根据需求决定是否恢复）</span>
          <span class="hljs-comment">// 通常建议只用于异步操作，所以这里也可以不处理，或给出警告</span>
          <span class="hljs-title function_">removeLoading</span>()
        }
      },
      <span class="hljs-variable constant_">THROTTLE_TIME</span>,
    )

    <span class="hljs-comment">// 将 throttled 函数存储到元素上，以便在 unmount 时移除</span>
    ;(el <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">_throttledClick</span> = handleClick
    el.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handleClick)
  },

  <span class="hljs-title function_">beforeUnmount</span>(<span class="hljs-params">el</span>) {
    <span class="hljs-keyword">const</span> handleClick = (el <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">_throttledClick</span>
    <span class="hljs-keyword">if</span> (handleClick) {
      el.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, handleClick)
      <span class="hljs-comment">// 取消可能还在等待的 throttle</span>
      handleClick.<span class="hljs-property">cancel</span>?.()
      <span class="hljs-keyword">delete</span> (el <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">_throttledClick</span>
    }
  },
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> clickOnce

</code></pre>
<h3 data-id="heading-20">十、总结</h3>
<p><code>clickOnce</code> 指令通过封装防重复点击逻辑，提供了一个开箱即用的解决方案，让开发者可以专注于业务逻辑，而不用担心重复点击的问题。它结合了节流、状态管理和视觉反馈，为用户提供了更好的交互体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[langchain学习总结-Model组件及使用技巧]]></title>    <link>https://juejin.cn/post/7589876192120799241</link>    <guid>https://juejin.cn/post/7589876192120799241</guid>    <pubDate>2025-12-31T07:02:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589876192120799241" data-draft-id="7589634310967689243" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="langchain学习总结-Model组件及使用技巧"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-31T07:02:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="心在飞扬AI"/> <meta itemprop="url" content="https://juejin.cn/user/1556564194366823"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            langchain学习总结-Model组件及使用技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1556564194366823/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    心在飞扬AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T07:02:39.000Z" title="Wed Dec 31 2025 07:02:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">概述</h2>
<p>本章节学习 LangChain 中 Model 组件的核心使用方法，包括基础调用、批处理和流式输出三大技巧。
ps：本来是要调用openai的组件，因为某些原因，暂用月之暗面的api，他们的返回是一致的。</p>
<hr/>
<h2 data-id="heading-1">1. LLM与ChatModel基础使用</h2>
<h3 data-id="heading-2">核心知识点</h3>
<ul>
<li><strong>ChatPromptTemplate</strong>: 用于结构化提示词模板</li>
<li><strong>.partial()</strong>: 预填充部分变量，避免重复传入</li>
<li><strong>.invoke()</strong>: 调用模型并获取完整响应</li>
</ul>
<h3 data-id="heading-3">完整示例</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">import</span> dotenv
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI

dotenv.load_dotenv()

<span class="hljs-comment"># 1.编排prompt</span>
prompt = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是OpenAI开发的聊天机器人，请回答用户的问题，现在的时间是{now}"</span>),
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"{query}"</span>),
]).partial(now=datetime.now())

<span class="hljs-comment"># 2.创建大语言模型</span>
llm = ChatOpenAI(model=<span class="hljs-string">"moonshot-v1-8k"</span>)

ai_message = llm.invoke(prompt.invoke({<span class="hljs-string">"query"</span>: <span class="hljs-string">"现在是几点，请讲一个程序员的冷笑话"</span>}))

<span class="hljs-built_in">print</span>(ai_message.<span class="hljs-built_in">type</span>)
<span class="hljs-built_in">print</span>(ai_message.content)
<span class="hljs-built_in">print</span>(ai_message.response_metadata)
</code></pre>
<p>输出</p>
<pre><code class="hljs language-python" lang="python">ai
现在是<span class="hljs-number">2025</span>年<span class="hljs-number">12</span>月<span class="hljs-number">31</span>日<span class="hljs-number">14</span>:<span class="hljs-number">41</span>:<span class="hljs-number">10</span>。

讲一个程序员的冷笑话给你听：

为什么程序员总是混淆圣诞节和万圣节？
因为 Oct <span class="hljs-number">31</span>（十月三十一日）看起来像是 Dec <span class="hljs-number">25</span>（十二月二十五日）。

这个笑话的幽默之处在于，程序员习惯于使用月份的缩写和日期来表示日期，而“Oct <span class="hljs-number">31</span>”和“Dec <span class="hljs-number">25</span>”在视觉上有一 定的相似性，但实际上它们分别代表万圣节和圣诞节，这两个节日在文化和庆祝方式上有很大的不同。
{<span class="hljs-string">'token_usage'</span>: {<span class="hljs-string">'completion_tokens'</span>: <span class="hljs-number">118</span>, <span class="hljs-string">'prompt_tokens'</span>: <span class="hljs-number">52</span>, <span class="hljs-string">'total_tokens'</span>: <span class="hljs-number">170</span>, <span class="hljs-string">'completion_tokens_details'</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">'prompt_tokens_details'</span>: <span class="hljs-literal">None</span>}, <span class="hljs-string">'model_provider'</span>: <span class="hljs-string">'openai'</span>, <span class="hljs-string">'model_name'</span>: <span class="hljs-string">'moonshot-v1-8k'</span>, <span class="hljs-string">'system_fingerprint'</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">'id'</span>: <span class="hljs-string">'chatcmpl-6954c58772a78fdd54a4a97a'</span>, <span class="hljs-string">'finish_reason'</span>: <span class="hljs-string">'stop'</span>, <span class="hljs-string">'logprobs'</span>: <span class="hljs-literal">None</span>}
Failed to multipart ingest runs: langsmith.utils.LangSmithAuthError: Authentication failed <span class="hljs-keyword">for</span> https://api.smith.langchain.com/runs/multipart. HTTPError(<span class="hljs-string">'401 Client Error: Unauthorized for url: https://api.smith.langchain.com/runs/multipart'</span>, <span class="hljs-string">'{"error":"Unauthorized"}\n'</span>)trace=019b7323-9ba0-<span class="hljs-number">77e0</span>-ae20-1cd8c15e46bc,<span class="hljs-built_in">id</span>=019b7323-9ba0-<span class="hljs-number">77e0</span>-ae20-1cd8c15e46bc; trace=019b7323-9c29-77c1-8bd7-ad9dbe1784ec,<span class="hljs-built_in">id</span>=019b7323-9c29-77c1-8bd7-ad9dbe1784ec
Failed to send compressed multipart ingest: langsmith.utils.LangSmithAuthError: Authentication failed <span class="hljs-keyword">for</span> https://api.smith.langchain.com/runs/multipart. HTTPError(<span class="hljs-string">'401 Client Error: Unauthorized for url: https://api.smith.langchain.com/runs/multipart'</span>, <span class="hljs-string">'{"error":"Unauthorized"}\n'</span>)trace=019b7323-9c29-77c1-8bd7-ad9dbe1784ec,<span class="hljs-built_in">id</span>=019b7323-9c29-77c1-8bd7-ad9dbe1784ec
</code></pre>
<h3 data-id="heading-4">返回结果解析</h3>
<ul>
<li><strong>ai_message.type</strong>: 消息类型</li>
<li><strong>ai_message.content</strong>: 模型生成的文本内容</li>
<li><strong>ai_message.response_metadata</strong>: 响应元数据（如token使用情况、模型信息等）</li>
</ul>
<h3 data-id="heading-5">使用技巧</h3>
<p>✅ <strong>使用 <code>.partial()</code> 预填充静态变量</strong></p>
<ul>
<li>减少重复传参</li>
<li>提高代码可读性</li>
<li>适合系统提示词中的固定参数</li>
</ul>
<hr/>
<h2 data-id="heading-6">2. Model批处理 (Batch)</h2>
<h3 data-id="heading-7">核心知识点</h3>
<ul>
<li><strong>.batch()</strong>: 批量处理多个请求，提高效率</li>
<li>适用于需要同时处理多个查询的场景</li>
</ul>
<h3 data-id="heading-8">完整示例</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">import</span> dotenv
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI

dotenv.load_dotenv()

<span class="hljs-comment"># 1.编排prompt</span>
prompt = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是OpenAI开发的聊天机器人，请回答用户的问题，现在的时间是{now}"</span>),
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"{query}"</span>),
]).partial(now=datetime.now())

<span class="hljs-comment"># 2.创建大语言模型</span>
llm = ChatOpenAI(model=<span class="hljs-string">"moonshot-v1-8k"</span>)

ai_messages = llm.batch([
    prompt.invoke({<span class="hljs-string">"query"</span>: <span class="hljs-string">"你好，你是?"</span>}),
    prompt.invoke({<span class="hljs-string">"query"</span>: <span class="hljs-string">"请讲一个关于程序员的冷笑话"</span>}),
])

<span class="hljs-keyword">for</span> ai_message <span class="hljs-keyword">in</span> ai_messages:
    <span class="hljs-built_in">print</span>(ai_message.content)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"===================="</span>)
</code></pre>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">你好！我是Kimi，由月之暗面科技有限公司（Moonshot AI）开发的人工智能助手。我擅长中英文对话，并且能够提供安全、有帮助、准确的回答。如果你有任何问题，无论是日常咨询还是需要信息搜索，我都在这里帮助你。有什 么可以为你服务的吗？
====================</span>
好的，这里有一个关于程序员的冷笑话：

有一天，一个程序员的妻子让他去超市买东西。她给了他一个购物清单，上面写着：“买一袋面包，如果有鸡蛋，买六个。”

程序员回到家，手里提着六袋面包。

妻子问：“为什么买了这么多面包？”

程序员回答：“因为他们有鸡蛋。”

这个笑话的幽默之处在于程序员按照字面意思执行了妻子的指示，而没有理解其中的隐含条件。希望这个冷笑话能 给你带来一点轻松的乐趣！
</code></pre>
<h3 data-id="heading-9">使用场景</h3>
<p>📌 <strong>适合批量处理的场景</strong></p>
<ul>
<li>批量问答</li>
<li>多文本总结</li>
<li>批量翻译</li>
<li>并行请求处理</li>
</ul>
<h2 data-id="heading-10">3. Model流式输出 (Streaming)</h2>
<h3 data-id="heading-11">核心知识点</h3>
<ul>
<li><strong>.stream()</strong>: 流式输出，实时生成内容</li>
<li>逐块返回生成结果，改善用户体验</li>
</ul>
<h3 data-id="heading-12">完整示例</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime
<span class="hljs-keyword">import</span> dotenv
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI

dotenv.load_dotenv()

<span class="hljs-comment"># 1.编排prompt</span>
prompt = ChatPromptTemplate.from_messages([
    (<span class="hljs-string">"system"</span>, <span class="hljs-string">"你是OpenAI开发的聊天机器人，请回答用户的问题，现在的时间是{now}"</span>),
    (<span class="hljs-string">"human"</span>, <span class="hljs-string">"{query}"</span>),
]).partial(now=datetime.now())

<span class="hljs-comment"># 2.创建大语言模型</span>
llm = ChatOpenAI(model=<span class="hljs-string">"moonshot-v1-8k"</span>)

response = llm.stream(prompt.invoke({<span class="hljs-string">"query"</span>: <span class="hljs-string">"你能简单介绍下LLM和LLMOps吗?"</span>}))

<span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> response:
    <span class="hljs-built_in">print</span>(chunk.content, flush=<span class="hljs-literal">True</span>, end=<span class="hljs-string">""</span>)
</code></pre>
<h3 data-id="heading-13">使用场景</h3>
<p>🌊 <strong>适合流式输出的场景</strong></p>
<ul>
<li>聊天对话应用</li>
<li>长文本生成</li>
<li>实时内容展示</li>
<li>需要快速反馈的场景</li>
</ul>
<h2 data-id="heading-14">三种方式对比</h2>





























<table><thead><tr><th>方式</th><th>方法</th><th>适用场景</th><th>响应方式</th></tr></thead><tbody><tr><td>单次调用</td><td><code>.invoke()</code></td><td>简单请求</td><td>一次性返回全部内容</td></tr><tr><td>批处理</td><td><code>.batch()</code></td><td>多个并行请求</td><td>返回所有结果列表</td></tr><tr><td>流式输出</td><td><code>.stream()</code></td><td>长文本/聊天</td><td>逐块返回生成内容</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[langchain学习总结-OutputParser组件及使用技巧]]></title>    <link>https://juejin.cn/post/7589706646215278592</link>    <guid>https://juejin.cn/post/7589706646215278592</guid>    <pubDate>2025-12-31T07:35:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589706646215278592" data-draft-id="7589822564778573839" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="langchain学习总结-OutputParser组件及使用技巧"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2025-12-31T07:35:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="心在飞扬AI"/> <meta itemprop="url" content="https://juejin.cn/user/1556564194366823"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            langchain学习总结-OutputParser组件及使用技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1556564194366823/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    心在飞扬AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T07:35:47.000Z" title="Wed Dec 31 2025 07:35:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">OutputParser组件及使用技巧</h2>
<h3 data-id="heading-1">概述</h3>
<p>OutputParser是LangChain中用于解析大语言模型输出结果的组件。它可以将LLM的原始输出转换为结构化的数据格式，如字符串、JSON、列表等，方便后续处理和使用。</p>
<hr/>
<h3 data-id="heading-2">StrOutputParser - 字符串输出解析器</h3>
<h4 data-id="heading-3">功能说明</h4>
<p><code>StrOutputParser</code> 是最简单也是最常用的输出解析器，用于将LLM的输出转换为纯字符串格式。</p>
<h4 data-id="heading-4">适用场景</h4>
<ul>
<li>简单的问答场景</li>
<li>文本生成任务</li>
<li>不需要结构化输出的场景</li>
</ul>
<h4 data-id="heading-5">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-keyword">import</span> dotenv
<span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI

dotenv.load_dotenv()

<span class="hljs-comment"># 1.编排提示模板</span>
prompt = ChatPromptTemplate.from_template(<span class="hljs-string">"{query}"</span>)

<span class="hljs-comment"># 2.构建大语言模型</span>
llm = ChatOpenAI(model=<span class="hljs-string">"moonshot-v1-8k"</span>)

<span class="hljs-comment"># 3.创建字符串输出解析器</span>
parser = StrOutputParser()

<span class="hljs-comment"># 4.调用大语言模型生成结果并解析</span>
content = parser.invoke(llm.invoke(prompt.invoke({<span class="hljs-string">"query"</span>: <span class="hljs-string">"你好，你是?"</span>})))

<span class="hljs-built_in">print</span>(content)
</code></pre>
<p>输出</p>
<pre><code class="hljs">你好！我是Kimi，一个由月之暗面科技有限公司（Moonshot AI）开发的人工智能助手。我擅长多语言对话，并且能够提供安全、有帮助、准确的回答。如果你有任何问题或需要帮助，请随时告诉 我，我会尽我所能为你提供支持。
</code></pre>
<h4 data-id="heading-6">执行流程说明</h4>
<pre><code class="hljs">用户输入 → Prompt模板 → LLM处理 → AIMessage → StrOutputParser → 字符串输出
</code></pre>
<h4 data-id="heading-7">链式调用简化写法</h4>
<p>可以将上述流程简化为链式调用：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI

<span class="hljs-comment"># 创建链式调用</span>
chain = ChatPromptTemplate.from_template(<span class="hljs-string">"{query}"</span>) | ChatOpenAI(model=<span class="hljs-string">"moonshot-v1-8k"</span>) | StrOutputParser()

<span class="hljs-comment"># 直接调用</span>
result = chain.invoke({<span class="hljs-string">"query"</span>: <span class="hljs-string">"你好，你是谁?"</span>})
<span class="hljs-built_in">print</span>(result)
</code></pre>
<hr/>
<h3 data-id="heading-8">JsonOutputParser - JSON输出解析器</h3>
<h4 data-id="heading-9">功能说明</h4>
<p><code>JsonOutputParser</code> 用于将LLM的输出解析为JSON格式的结构化数据。它可以配合Pydantic模型定义，强制LLM输出符合特定结构的JSON数据。</p>
<h4 data-id="heading-10">适用场景</h4>
<ul>
<li>需要结构化输出的场景</li>
<li>提取特定字段信息</li>
<li>后续需要程序化处理输出的场景</li>
</ul>
<h4 data-id="heading-11">核心组件</h4>
<h5 data-id="heading-12">Pydantic BaseModel</h5>
<p>使用Pydantic的<code>BaseModel</code>来定义JSON结构，通过<code>Field</code>添加字段描述，帮助LLM理解每个字段的含义。</p>
<h5 data-id="heading-13">关键方法</h5>
<ul>
<li><code>get_format_instructions()</code>: 获取格式说明，告诉LLM如何输出</li>
<li><code>partial()</code>: 部分填充提示模板</li>
</ul>
<h4 data-id="heading-14">代码示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-keyword">import</span> dotenv
<span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> JsonOutputParser
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate
<span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field
<span class="hljs-keyword">from</span> langchain_openai <span class="hljs-keyword">import</span> ChatOpenAI

dotenv.load_dotenv()

<span class="hljs-comment"># 1.创建一个json数据结构，用于告诉大语言模型这个json长什么样子</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Joke</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-comment"># 冷笑话内容</span>
    joke: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"回答用户的冷笑话"</span>)
    <span class="hljs-comment"># 冷笑话的笑点</span>
    punchline: <span class="hljs-built_in">str</span> = Field(description=<span class="hljs-string">"这个冷笑话的笑点"</span>)

parser = JsonOutputParser(pydantic_object=Joke)

<span class="hljs-comment"># 2.构建一个提示模板</span>
<span class="hljs-comment"># 使用partial预填充format_instructions，包含JSON格式说明</span>
prompt = ChatPromptTemplate.from_template(
    <span class="hljs-string">"请根据用户的提问进行回答。\n{format_instructions}\n{query}"</span>
).partial(format_instructions=parser.get_format_instructions())

<span class="hljs-comment"># 3.构建一个大语言模型</span>
llm = ChatOpenAI(model=<span class="hljs-string">"moonshot-v1-8k"</span>)

<span class="hljs-comment"># 4.传递提示并进行解析</span>
joke = parser.invoke(llm.invoke(prompt.invoke({<span class="hljs-string">"query"</span>: <span class="hljs-string">"请讲一个关于程序员的冷笑话"</span>})))

<span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(joke))  <span class="hljs-comment"># &lt;class 'dict'&gt;</span>
<span class="hljs-built_in">print</span>(joke.get(<span class="hljs-string">"punchline"</span>))  <span class="hljs-comment"># 获取笑点字段</span>
<span class="hljs-built_in">print</span>(joke)  <span class="hljs-comment"># 完整的JSON字典</span>
</code></pre>
<h4 data-id="heading-15">输出示例</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 输出类似这样的结构：</span>
{
    <span class="hljs-string">"joke"</span>: <span class="hljs-string">"为什么程序员总是混淆圣诞节和万圣节？"</span>,
    <span class="hljs-string">"punchline"</span>: <span class="hljs-string">"因为 Oct 31 == Dec 25"</span>
}
</code></pre>
<h4 data-id="heading-16">工作流程</h4>
<pre><code class="hljs">定义BaseModel → 创建JsonOutputParser → 获取格式说明 → 构建Prompt → LLM生成 → 解析为字典
</code></pre>
<h3 data-id="heading-17">扩展阅读</h3>
<ul>
<li>LangChain官方文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpython.langchain.com%2Fdocs%2Fmodules%2Fmodel_io%2Foutput_parsers%2F" target="_blank" title="https://python.langchain.com/docs/modules/model_io/output_parsers/" ref="nofollow noopener noreferrer">python.langchain.com/docs/module…</a></li>
<li>Pydantic文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.pydantic.dev%2F" target="_blank" title="https://docs.pydantic.dev/" ref="nofollow noopener noreferrer">docs.pydantic.dev/</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[.NET 10 与 C# 14 更新速览，代码更少，性能更好]]></title>    <link>https://juejin.cn/post/7589614866833686534</link>    <guid>https://juejin.cn/post/7589614866833686534</guid>    <pubDate>2025-12-31T08:27:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589614866833686534" data-draft-id="7589676302124695593" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=".NET 10 与 C# 14 更新速览，代码更少，性能更好"/> <meta itemprop="keywords" content="后端,C#,.NET"/> <meta itemprop="datePublished" content="2025-12-31T08:27:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ServBay"/> <meta itemprop="url" content="https://juejin.cn/user/3828929445244761"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            .NET 10 与 C# 14 更新速览，代码更少，性能更好
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3828929445244761/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ServBay
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:27:18.000Z" title="Wed Dec 31 2025 08:27:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>.NET 10 和 C# 14 更新了，这次的更新让代码更精简，数据处理更高效了。相比以前某些版本喜欢推新概念，这次更接地气，解决的都是平时写代码觉得罗嗦、或者性能容易出瓶颈的地方。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a099fabfc7c6425d8b87790d37813f2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774958&amp;x-signature=GjRcGjJOXuTRMRkvplTPKNGR97s%3D" alt="" loading="lazy"/></p>
<p>以下是提炼出的核心技巧与版本特性，帮助大家快速上手新版本。</p>
<h3 data-id="heading-0">C# 14 核心语言技巧</h3>
<h4 data-id="heading-1">空条件赋值 (<code>??=</code>) 的左侧扩展</h4>
<p>在旧版本中，<code>??=</code> 只能处理直接变量。C# 14 增强了其在对象链中的表现力。如果对象路径中的父级为空，赋值操作直接短路；如果父级存在但目标属性为空，则进行赋值。这在处理深层配置对象或 DTO 时极为省力。</p>
<p><strong>代码示例：</strong></p>
<p>初始化用户配置中的通知设置，前提是 <code>userProfile</code> 实例本身必须存在。</p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InitNotification</span>(<span class="hljs-params">UserProfile? userProfile</span>)</span>
{
    <span class="hljs-comment">// 只有当 userProfile 不为 null，且 Settings 字段为 null 时，才分配新实例</span>
    <span class="hljs-comment">// 避免了繁琐的 if (userProfile != null &amp;&amp; userProfile.Settings == null) 判断</span>
    userProfile?.Settings ??= <span class="hljs-keyword">new</span> UserSettings();
}
</code></pre>
<h4 data-id="heading-2"><code>field</code> 关键字：自动属性的最后一块拼图</h4>
<p>这是社区期待已久的特性。在属性设置器中添加简单的验证逻辑时，以往必须手动声明一个 <code>private</code> 支持字段，导致代码视觉混乱。C# 14 允许通过 <code>field</code> 关键字直接访问隐式生成的支持字段。</p>
<p><strong>代码示例：</strong></p>
<p>定义一个最大连接数属性，要求必须大于零。</p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> MaxConnections
{
    <span class="hljs-keyword">get</span> =&gt; field; <span class="hljs-comment">// 直接读取隐式字段</span>
    <span class="hljs-keyword">set</span>
    {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">value</span> &lt;= <span class="hljs-number">0</span>) 
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentOutOfRangeException(<span class="hljs-keyword">nameof</span>(<span class="hljs-keyword">value</span>), <span class="hljs-string">"连接数必须大于 0"</span>);
        
        field = <span class="hljs-keyword">value</span>; <span class="hljs-comment">// 写入隐式字段</span>
    }
}
</code></pre>
<h4 data-id="heading-3">Lambda 表达式的性能释放</h4>
<p>为了满足高性能场景（如高频交易、游戏物理计算）的需求，C# 14 允许在 Lambda 中使用 <code>ref</code>、<code>out</code> 和 <code>in</code> 修饰符。这意味着我们可以编写零内存拷贝的内联逻辑。</p>
<p><strong>代码示例：</strong></p>
<p>一个结构体更新逻辑，直接在栈内存上修改数据，避免复制开销。</p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-comment">// 定义一个结构体</span>
<span class="hljs-keyword">struct</span> Position { <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> X; <span class="hljs-keyword">public</span> <span class="hljs-built_in">double</span> Y; }

<span class="hljs-comment">// 使用 ref 参数直接修改外部变量</span>
<span class="hljs-keyword">var</span> move = (<span class="hljs-keyword">ref</span> Position pos, <span class="hljs-built_in">double</span> deltaX, <span class="hljs-built_in">double</span> deltaY) =&gt; 
{
    pos.X += deltaX;
    pos.Y += deltaY;
};

<span class="hljs-keyword">var</span> currentPos = <span class="hljs-keyword">new</span> Position { X = <span class="hljs-number">10</span>, Y = <span class="hljs-number">20</span> };
move(<span class="hljs-keyword">ref</span> currentPos, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>); <span class="hljs-comment">// currentPos.X 变为 15，直接修改原值</span>
</code></pre>
<h3 data-id="heading-4">.NET 10 框架与运行时升级</h3>
<h4 data-id="heading-5">单文件运行 (File-Based Apps)</h4>
<p>.NET 10 进一步降低了脚本化使用的门槛。对于运维脚本或简单的算法验证，不再需要创建 <code>.csproj</code> 项目文件。</p>
<p><strong>使用方式：</strong></p>
<p>创建一个名为 <code>clean_logs.cs</code> 的文件：</p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-keyword">using</span> System.IO;

<span class="hljs-keyword">var</span> logPath = <span class="hljs-string">"./logs"</span>;
<span class="hljs-keyword">if</span> (Directory.Exists(logPath))
{
    <span class="hljs-keyword">var</span> count = Directory.GetFiles(logPath).Length;
    Console.WriteLine(<span class="hljs-string">$"发现 <span class="hljs-subst">{count}</span> 个日志文件，准备清理..."</span>);
}
</code></pre>
<p>直接在终端运行：</p>
<p><code>dotnet run clean_logs.cs</code></p>
<h4 data-id="heading-6">EF Core 的 SQL 对齐：LeftJoin 与 JSON 更新</h4>
<p>Entity Framework Core 在 .NET 10 中填补了两个长期痛点：原生左连接和高效 JSON 更新。</p>
<ul>
<li><strong>LeftJoin 支持</strong>：终于不需要用 <code>GroupJoin</code> 配合 <code>SelectMany</code> 这种反直觉的写法了。</li>
</ul>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-comment">// 查找学生及其对应的奖学金记录（可能为空）</span>
<span class="hljs-keyword">var</span> list = context.Students
    .LeftJoin(
        context.Scholarships,
        student =&gt; student.Id,
        scholarship =&gt; scholarship.StudentId,
        (student, scholarship) =&gt; <span class="hljs-keyword">new</span> 
        { 
            Name = student.Name, 
            Amount = scholarship?.Amount ?? <span class="hljs-number">0</span> <span class="hljs-comment">// 优雅处理空值</span>
        }
    ).ToList();
</code></pre>
<ul>
<li><strong>JSON</strong> <strong>列的原生部分更新</strong>：针对存储在数据库中的 JSON 字段，现在可以用 <code>ExecuteUpdate</code> 精确修改某个属性，而无需读取整个实体。</li>
</ul>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-comment">// 仅更新 JSON 列中的 "Theme" 属性，性能大幅提升</span>
context.Users.Where(u =&gt; u.Id == <span class="hljs-number">1</span>)
    .ExecuteUpdate(setters =&gt; setters
        .SetProperty(u =&gt; u.Config.Theme, <span class="hljs-string">"Dark"</span>));
</code></pre>
<h4 data-id="heading-7">Minimal API 的原生验证</h4>
<p>API 开发更加简洁，.NET 10 为 Minimal API 引入了内置的声明式验证，减少了对第三方验证库的强依赖。</p>
<pre><code class="hljs language-c#" lang="c#"><span class="hljs-comment">// 自动验证 UserDto 中的数据注解（如 [Required]）</span>
app.MapPost(<span class="hljs-string">"/user"</span>, (UserDto user) =&gt; ProcessUser(user))
   .WithParameterValidation(); 
</code></pre>
<hr/>
<h3 data-id="heading-8">现代化开发环境管理方案</h3>
<p>随着 .NET 版本的快速迭代，开发者常面临的问题，比如维护十年前的遗留系统可能需要 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fnet" target="_blank" title="https://www.servbay.com/features/net" ref="nofollow noopener noreferrer">.NET Framework</a> 或 Mono，而新项目则要使用 .NET 10。在本地机器上同时管理这些运行时、SDK 以及配套的数据库，极易导致环境污染和依赖冲突。</p>
<p>这里推荐使用 <strong>ServBay</strong> 来解决本地开发环境的依赖地狱。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7216473db9e045ecb1941afe86f1c462~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VydkJheQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774958&amp;x-signature=8KgpNQtgQYw%2BkJ8TRpZ928QW9mY%3D" alt="" loading="lazy"/></p>
<p>ServBay 是一款专为开发者设计的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com" target="_blank" title="https://www.servbay.com" ref="nofollow noopener noreferrer">集成化环境管理工具</a>，对于 .NET 技术栈的支持尤为全面，主要解决了以下痛点</p>
<p><strong>全版本与异构环境共存</strong></p>
<ul>
<li>ServBay 支持从古老的 .NET 2.0 到最新的 .NET 10.0 的安装。而且它还原生支持 Mono 6，这对于维护旧版 Unity 项目、Xamarin 应用或是非标准的 .NET 遗留系统的开发者来说，是一个非常关键的特性。</li>
</ul>
<p><strong>一键式配套服务</strong></p>
<ul>
<li>开发不仅仅是 Runtime。ServBay 内置了主流的 SQL 数据库（PostgreSQL, MySQL, MariaDB）和 NoSQL 数<strong>据库</strong>（Redis, Memcached, MongoDB）。不需要去折腾 Docker 容器或配置本地服务，所有数据库均可一键启停，开箱即用。</li>
</ul>
<p><strong>多语言与隔离</strong></p>
<ul>
<li>如果团队涉及混合开发，ServBay 同样支持 Rust、Node.js、PHP 等环境的一键安装。特别是 Rust 环境的配置通常比较繁琐，ServBay 做到了极致简化。所有环境相互隔离，确保项目依赖纯净，不会因为升级某个全局库而搞挂其他项目。</li>
</ul>
<h3 data-id="heading-9">结语</h3>
<p>.NET 10 和 C# 14 的发布，标志着平台向着更少代码，更多功能的方向又迈进了一步。从 <code>field</code> 关键字对属性的简化，到 EF Core 对复杂 SQL 场景的覆盖，都在试图减轻开发者的认知负担。</p>
<p>而工具层面上，像 ServBay 这样的环境管理软件，则帮我们屏蔽了底层的配置噪音。对于追求高效的开发者而言，拥抱新语法能提升代码质量，而使用合适的工具管理环境，则能保证我们有更多的时间专注于核心业务逻辑的实现。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Axios 常用配置及使用]]></title>    <link>https://juejin.cn/post/7589839767815929894</link>    <guid>https://juejin.cn/post/7589839767815929894</guid>    <pubDate>2025-12-31T08:27:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589839767815929894" data-draft-id="7589454621718937650" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Axios 常用配置及使用"/> <meta itemprop="keywords" content="前端,axios"/> <meta itemprop="datePublished" content="2025-12-31T08:27:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="28256_"/> <meta itemprop="url" content="https://juejin.cn/user/1346234989166472"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Axios 常用配置及使用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1346234989166472/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    28256_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:27:31.000Z" title="Wed Dec 31 2025 08:27:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Axios配置详解</h2>
<pre><code class="hljs language-js" lang="js">{
常用实例配置项
<span class="hljs-comment">// `baseURL` 将自动加在 `url` 前面，除非 `url` 是一个绝对 URL。</span>
<span class="hljs-comment">// 它可以通过设置一个 `baseURL` 便于为 axios 实例的方法传递相对 URL</span>
<span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://some-domain.com/api/'</span>,
<span class="hljs-comment">// `timeout` 指定请求超时前的毫秒数。 </span>
<span class="hljs-comment">// 如果请求耗时超过 `timeout`，则请求将被中止。</span>
<span class="hljs-attr">timeout</span>: <span class="hljs-number">1000</span>, <span class="hljs-comment">// default is `0` (no timeout)</span>
<span class="hljs-comment">// `withCredentials`用于指示跨域访问控制请求是否携带凭证</span>
<span class="hljs-comment">// 请求需要携带token时，需要设置为true</span>
<span class="hljs-attr">withCredentials</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// default</span>
常用请求配置项
<span class="hljs-attr">url</span>: <span class="hljs-string">'/user'</span>,
<span class="hljs-attr">method</span>: <span class="hljs-string">'get'</span>, <span class="hljs-comment">// default</span>
<span class="hljs-attr">headers</span>: {<span class="hljs-string">'X-Requested-With'</span>: <span class="hljs-string">'XMLHttpRequest'</span>},
<span class="hljs-comment">// `responseType` 表示服务器将返回的数据类型</span>
<span class="hljs-comment">// 选项包括：'arraybuffer', 'document', 'json', 'text', 'stream'</span>
<span class="hljs-comment">// browser only: 'blob'</span>
<span class="hljs-attr">responseType</span>: <span class="hljs-string">'json'</span>, <span class="hljs-comment">// default</span>
<span class="hljs-comment">// `params` 是即将与请求一起发送的 URL 参数</span>
<span class="hljs-comment">// 一般用于get请求携带参数</span>
<span class="hljs-comment">// 也可post请求时，在url上拼接参数</span>
<span class="hljs-attr">params</span>: { <span class="hljs-attr">ID</span>: <span class="hljs-number">12345</span> },
<span class="hljs-comment">// `data` 是作为请求主体被发送的数据</span>
<span class="hljs-comment">// 只适用于这些请求方法 'PUT', 'POST', 和 'PATCH'</span>
<span class="hljs-attr">data</span>: { <span class="hljs-attr">firstName</span>: <span class="hljs-string">'Fred'</span> },
不常用配置项
  <span class="hljs-comment">// `transformRequest` 允许在向服务器发送前，修改请求数据</span>
  <span class="hljs-comment">// 只能用在 'PUT', 'POST' 和 'PATCH' 这几个请求方法</span>
  <span class="hljs-comment">// 后面数组中的函数必须返回一个字符串，或 ArrayBuffer，或 Stream</span>
  <span class="hljs-attr">transformRequest</span>: [<span class="hljs-keyword">function</span> (<span class="hljs-params">data, headers</span>) {
    <span class="hljs-comment">// 对 data 进行任意转换处理</span>
    <span class="hljs-keyword">return</span> data;
  }],

  <span class="hljs-comment">// `transformResponse` 在传递给 then/catch 前，允许修改响应数据</span>
  <span class="hljs-attr">transformResponse</span>: [<span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) {
    <span class="hljs-comment">// 对 data 进行任意转换处理</span>
    <span class="hljs-keyword">return</span> data;
  }],
}
</code></pre>
<h2 data-id="heading-1">Axios用法</h2>
<h3 data-id="heading-2">基本用法</h3>
<p><strong>axios(config)</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">axios</span>({
  <span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>,
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/user/12345'</span>,
  <span class="hljs-attr">data</span>: {
    <span class="hljs-attr">firstName</span>: <span class="hljs-string">'Fred'</span>,
    <span class="hljs-attr">lastName</span>: <span class="hljs-string">'Flintstone'</span>
  },
  ...
});

</code></pre>
<h3 data-id="heading-3">通过别名使用</h3>
<p><strong>axios.request(config)</strong></p>
<p>使用起来更简单，方便书写，减少字段的重复书写。<br/>
通过别名使用时<code>url</code>、<code>method</code>、<code>data</code> 这些字段名可忽略不写。<br/>
header之类的需要指明字段名</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 忽略了method url params 等字段</span>
axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/user?ID=12345'</span>)
<span class="hljs-comment">// 也可以是</span>
axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/user'</span>, {
    <span class="hljs-attr">params</span>: {
      <span class="hljs-attr">ID</span>: <span class="hljs-number">12345</span>
    }
  })
<span class="hljs-comment">// 忽略了method url data 等字段</span>
axios.<span class="hljs-title function_">post</span>(<span class="hljs-string">'/user'</span>, {
  <span class="hljs-attr">firstName</span>: <span class="hljs-string">'Fred'</span>,
  <span class="hljs-attr">lastName</span>: <span class="hljs-string">'Flintstone'</span>,
})
</code></pre>
<p>针对get请求可以简化为下面这种。method默认就是get</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">axios</span>(<span class="hljs-string">'/user/12345'</span>); 
</code></pre>
<h2 data-id="heading-4">Axios如何取消请求</h2>
<h2 data-id="heading-5">Axios注意事项</h2>
<ol>
<li><strong>后端返回的长整形数据过长，会导致精度丢失，出现变为0的情况</strong><br/>
原因： axios在处理HTTP响应时，默认使用JSON.parse()解析数据，但JavaScript的number类型安全整数范围有限（最大安全值为2^53 - 1，约16位十进制数），超出时会导致精度丢失，常见于后端返回的长整型ID（如雪花算法生成的19位ID）。‌</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年十大终端管理软件推荐指南]]></title>    <link>https://juejin.cn/post/7589614866833719302</link>    <guid>https://juejin.cn/post/7589614866833719302</guid>    <pubDate>2025-12-31T08:29:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589614866833719302" data-draft-id="7589828815938682934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年十大终端管理软件推荐指南"/> <meta itemprop="keywords" content="后端,面试,Vue.js"/> <meta itemprop="datePublished" content="2025-12-31T08:29:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ManageEngine卓豪官方账号"/> <meta itemprop="url" content="https://juejin.cn/user/1146167600363959"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年十大终端管理软件推荐指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1146167600363959/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ManageEngine卓豪官方账号
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:29:50.000Z" title="Wed Dec 31 2025 08:29:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在数字化转型的浪潮中，企业面临着日益复杂的IT基础设施管理挑战。随着远程办公的普及和设备数量的激增，一款优秀的终端管理软件已成为企业IT部门的必备工具。本文将为您介绍2025年市场上最值得关注的十大终端管理软件，帮助您找到最适合自己企业的解决方案。</p>
<h2 data-id="heading-0">什么是终端管理软件？</h2>
<p>终端管理软件（Endpoint Management Software）是帮助IT管理员集中管理、监控和保护企业内所有终端设备的解决方案。这些设备包括台式机、笔记本电脑、移动设备、服务器等。优秀的终端管理软件能够实现补丁管理、软件部署、资产追踪、安全防护等多项功能。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc8c0607388c41b3972ce4b2e0afeb6d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFuYWdlRW5naW5l5Y2T6LGq5a6Y5pa56LSm5Y-3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774590&amp;x-signature=d3oF5w0sqE%2BLynXdNIYQZktc6y0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">十大终端管理软件详解</h2>
<h3 data-id="heading-2">1. Microsoft Intune</h3>
<p>Microsoft Intune是微软推出的云端统一终端管理解决方案，与Microsoft 365深度集成。如果您的企业已经大量使用微软产品，Intune将是非常自然的选择。</p>
<p><strong>主要功能</strong>：设备管理、应用管理、条件访问控制、合规性策略、Windows Autopilot</p>
<p><strong>适用企业</strong>：深度使用Microsoft 365的中大型企业，重视云端管理的组织</p>
<p><strong>优势</strong>：与Azure AD和Microsoft 365无缝集成，提供条件访问和零信任安全模型支持，持续更新</p>
<p><strong>考虑因素</strong>：对非Windows设备的支持相对有限，学习曲线较陡，需要Microsoft 365订阅</p>
<h3 data-id="heading-3">2. VMware Workspace ONE</h3>
<p>VMware Workspace ONE是一款功能强大的数字化工作空间平台，整合了UEM、身份管理、应用管理和虚拟桌面功能。它适合大型企业和需要高度定制化的复杂IT环境。</p>
<p><strong>主要功能</strong>：统一终端管理、虚拟应用交付、身份和访问管理、数字化员工体验监控</p>
<p><strong>适用企业</strong>：大型跨国企业，复杂IT环境，已使用VMware虚拟化产品的组织</p>
<p><strong>优势</strong>：功能最为全面，支持复杂的企业场景，强大的自动化能力</p>
<p><strong>考虑因素</strong>：价格较高，实施和维护需要专业技能，对中小企业可能过于复杂</p>
<h3 data-id="heading-4">3. Endpoint Central</h3>
<p>Endpoint Central是ManageEngine开发的统一终端管理解决方案，支持Windows、Mac、Linux、iOS和Android等多种操作系统。<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.manageengine.cn%2Fproducts%2Fdesktop-central%2Fdownload.html%3Futm_source%3Druanwen%26utm_platform%3Djuejin%26utm_medium%3Duem%26utm_campaign%3D20251231" target="_blank" title="https://www.manageengine.cn/products/desktop-central/download.html?utm_source=ruanwen&amp;utm_platform=juejin&amp;utm_medium=uem&amp;utm_campaign=20251231" ref="nofollow noopener noreferrer">立即下载</a></p>
<p><strong>主要功能</strong>：补丁管理、软件部署、资产管理、移动设备管理、远程控制</p>
<p><strong>适用企业</strong>：中小型企业，多平台混合环境</p>
<p><strong>优势</strong>：功能全面，界面直观易用，提供免费版本（最多25台设备）</p>
<p><strong>考虑因素</strong>：品牌知名度不如微软或VMware，部分高级功能需要额外模块</p>
<h3 data-id="heading-5">4. Jamf Pro</h3>
<p>Jamf Pro是Apple设备管理领域的领导者，专注于macOS和iOS设备的管理。如果您的企业主要使用Apple设备，Jamf Pro提供了最深入、最专业的管理体验。</p>
<p><strong>主要功能</strong>：Apple设备注册、配置管理、应用分发、安全合规、自助服务门户</p>
<p><strong>适用企业</strong>：主要或完全使用Apple设备的企业，创意行业，教育机构</p>
<p><strong>优势</strong>：对Apple设备的支持最为完善，提供丰富的自动化工作流，用户社区活跃</p>
<p><strong>考虑因素</strong>：仅支持Apple设备，不适合多平台混合环境，价格相对较高</p>
<h3 data-id="heading-6">5. Ivanti Endpoint Manager</h3>
<p>Ivanti提供全面的IT资产和服务管理解决方案。Ivanti Endpoint Manager继承了多年的企业级管理经验，功能成熟稳定。</p>
<p><strong>主要功能</strong>：资产发现、补丁管理、软件分发、操作系统部署、服务台集成</p>
<p><strong>适用企业</strong>：传统制造业、金融机构、医疗保健等注重稳定性的行业</p>
<p><strong>优势</strong>：功能成熟，在传统企业中有广泛应用，集成了服务台功能</p>
<p><strong>考虑因素</strong>：界面相对传统，现代化程度不如新兴竞争对手，定价不够透明</p>
<h3 data-id="heading-7">6. IBM MaaS360</h3>
<p>IBM MaaS360是一款云端UEM解决方案，强调AI和机器学习在终端管理中的应用。它能够通过AI识别异常行为和安全威胁。</p>
<p><strong>主要功能</strong>：AI驱动的威胁检测、移动设备管理、应用管理、内容管理、合规报告</p>
<p><strong>适用企业</strong>：注重安全的大型企业，金融和医疗行业，全球化组织</p>
<p><strong>优势</strong>：AI驱动的安全威胁检测，IBM品牌背书和全球支持，快速部署</p>
<p><strong>考虑因素</strong>：部分高级功能需要额外付费，定价结构复杂，界面体验一般</p>
<h3 data-id="heading-8">7. Citrix Endpoint Management</h3>
<p>Citrix Endpoint Management是Citrix工作空间解决方案的一部分，特别适合已经使用Citrix虚拟化技术的企业。</p>
<p><strong>主要功能</strong>：设备管理、应用管理、微应用容器、安全策略、内容协作</p>
<p><strong>适用企业</strong>：已使用Citrix产品的企业，需要安全访问企业应用的组织</p>
<p><strong>优势</strong>：与Citrix虚拟应用和桌面深度集成，提供安全的微应用容器，支持BYOD</p>
<p><strong>考虑因素</strong>：独立使用时价值有限，最适合Citrix生态系统用户</p>
<h3 data-id="heading-9">8. NinjaOne</h3>
<p>NinjaOne是一款面向托管服务提供商（MSP）和IT服务商的统一IT管理平台，整合了RMM、补丁管理、备份和文档功能。</p>
<p><strong>主要功能</strong>：远程监控、自动化补丁、软件部署、备份管理、IT文档管理</p>
<p><strong>适用企业</strong>：托管服务提供商（MSP），管理多个客户的IT服务公司</p>
<p><strong>优势</strong>：多租户架构，用户界面友好，快速部署，适合MSP业务模式</p>
<p><strong>考虑因素</strong>：定价基于设备数量，大规模部署成本较高，部分功能需要集成第三方工具</p>
<h3 data-id="heading-10">9. Kandji</h3>
<p>Kandji是一款现代化的Apple设备管理平台，专注于自动化和用户体验。它采用"设备即代码"理念，让Mac和iOS设备管理更加简单高效。</p>
<p><strong>主要功能</strong>：零接触部署、自动化合规、应用管理、安全基线、设备库存</p>
<p><strong>适用企业</strong>：快速成长的科技公司，采用Apple设备的创新型企业</p>
<p><strong>优势</strong>：现代化界面，强大的自动化能力，专为Apple设备优化，快速设置</p>
<p><strong>考虑因素</strong>：仅支持Apple设备，功能深度不如Jamf Pro，相对较新的产品</p>
<h3 data-id="heading-11">10. Baramundi Management Suite</h3>
<p>Baramundi是一款来自德国的统一终端管理解决方案，特别重视数据隐私和GDPR合规。它提供全面的设备生命周期管理功能。</p>
<p><strong>主要功能</strong>：软件管理、补丁管理、操作系统部署、资产管理、移动设备管理</p>
<p><strong>适用企业</strong>：欧洲市场企业，注重数据隐私合规的组织，需要本地部署的企业</p>
<p><strong>优势</strong>：严格的数据保护和隐私合规，适合欧洲市场，本地部署选项，功能全面</p>
<p><strong>考虑因素</strong>：全球知名度较低，部分文档和支持以德语为主，在亚太市场支持有限</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/014ebb19732241b7a8b907fb0ee877fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFuYWdlRW5naW5l5Y2T6LGq5a6Y5pa56LSm5Y-3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774590&amp;x-signature=QNL6cSRxnZUlF0ITf7M%2FNCgdtds%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">如何选择适合您的终端管理软件？</h2>
<p>选择终端管理软件时，建议从以下维度进行评估：</p>
<p><strong>设备环境</strong>：首先明确需要管理的设备类型和数量。如果是纯Apple环境，Jamf Pro或Kandji是理想选择；Windows为主的环境可以考虑Microsoft Intune或Endpoint Central；混合环境则需要选择跨平台支持更好的解决方案。</p>
<p><strong>预算考量</strong>：终端管理软件的定价模式差异很大，从免费版本到企业级订阅都有。中小企业可以关注Endpoint Central、NinjaOne等性价比较高的方案；大型企业预算充足则可以考虑VMware或Microsoft等旗舰产品。</p>
<p><strong>现有技术栈</strong>：评估与现有IT基础设施的兼容性。如果已经使用Microsoft 365，Intune是自然的延伸；使用VMware虚拟化的企业选择Workspace ONE能获得更好的集成；Citrix用户则应优先考虑Citrix Endpoint Management。</p>
<p><strong>功能需求</strong>：列出必须具备的核心功能。基础需求包括补丁管理、软件部署和资产追踪；进阶需求可能包括移动设备管理、零接触部署、AI安全分析等。避免为不需要的功能支付额外费用。</p>
<p><strong>团队技能</strong>：考虑IT团队的技术能力。一些产品如VMware Workspace ONE功能强大但学习曲线陡峭；而Endpoint Central、Kandji等产品则更注重易用性，适合技术团队规模较小的企业。</p>
<p><strong>合规要求</strong>：如果企业有特定的合规需求（如GDPR、HIPAA），要确保选择的产品能够满足这些要求。欧洲企业可以重点关注Baramundi等注重隐私合规的产品。</p>
<p><strong>扩展性</strong>：考虑未来3-5年的业务增长预期。选择能够随企业扩展的平台，避免因为产品限制而需要频繁更换系统。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81dc922844b04b56847b58a72e2f14bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTWFuYWdlRW5naW5l5Y2T6LGq5a6Y5pa56LSm5Y-3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774590&amp;x-signature=yYBK5IFd%2BCXKEinGwaXNDw0FtLg%3D" alt="" loading="lazy"/></p>
<p>在做出最终决策前，建议采取以下步骤：</p>
<ol>
<li><strong>申请试用</strong>：大多数供应商都提供免费试用期，实际体验产品在您环境中的表现</li>
<li><strong>参考案例</strong>：查看同行业或类似规模企业的使用案例和评价</li>
<li><strong>计算TCO</strong>：全面评估总体拥有成本，包括许可费、实施成本、培训费用和维护成本</li>
<li><strong>安排演示</strong>：与供应商沟通，针对您的具体需求安排产品演示</li>
<li><strong>咨询现有用户</strong>：通过专业社区或行业论坛了解真实用户的使用体验</li>
</ol>
<p>终端管理软件的选择应基于企业的实际需求、设备环境和预算状况。建议在决策前充分试用和比较多款产品，通过实际测试来验证哪款软件最适合您的IT环境。大多数供应商都提供免费试用期或演示服务，这是评估产品的最佳方式。选择合适的终端管理工具，将为企业的IT运维效率提升和数字化转型提供坚实的技术支撑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ESP32-S3开发环境搭建(arduino版本)]]></title>    <link>https://juejin.cn/post/7589655730292113448</link>    <guid>https://juejin.cn/post/7589655730292113448</guid>    <pubDate>2025-12-31T04:43:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589655730292113448" data-draft-id="7589578378896343074" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ESP32-S3开发环境搭建(arduino版本)"/> <meta itemprop="keywords" content="Arduino,单片机,物联网"/> <meta itemprop="datePublished" content="2025-12-31T04:43:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="优信电子"/> <meta itemprop="url" content="https://juejin.cn/user/1933417626485818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ESP32-S3开发环境搭建(arduino版本)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1933417626485818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    优信电子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T04:43:58.000Z" title="Wed Dec 31 2025 04:43:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf954560412a455883a18c794d16796d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=R56WMf95KxGAzRJEu%2B1lw3KRhJg%3D" alt="ESP1.jpg" loading="lazy"/></p>
<h2 data-id="heading-0">前言</h2>
<p>不久前关注到<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fespressif%2Farduino-esp32" target="_blank" title="https://github.com/espressif/arduino-esp32" ref="nofollow noopener noreferrer">乐鑫官方github</a>已经更新了关于<code>arduino IDE</code>中开发<code>ESP32-S3</code>部分的分支，所以我在这篇文章中记录一下在arduino IDE下添加<code>ESP32-S3</code>开发板的艰难过程，闲话不多说，下面我们直接上手开发搭建。</p>
<h2 data-id="heading-1">安装方法</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92796faba8d14852831682560a3549a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=x%2BkP6XQW%2BkJbnAgBKheM9JZzi6c%3D" alt="ESP2.jpeg" loading="lazy"/></p>
<h2 data-id="heading-2">方法1</h2>
<p>我们这里先提供最简单的一种方法，打开自己安装好的 <code>arduino → 文件 → 首选项 </code>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d226a502e5f4a1b9ab414a9d1cb2b89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=BnI3Q%2Fugh10DeaQ3dEaN%2F0Ky77w%3D" alt="ESP3.png" loading="lazy"/>
在<code>附加开发板管理器</code>网址中添加以下两个链接中的一个</p>
<ul>
<li>Stable release link:</li>
</ul>
<blockquote>
<p><code>https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json</code></p>
</blockquote>
<ul>
<li>Development release link:</li>
</ul>
<blockquote>
<p><code>https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_dev_index.json</code></p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d0f8f655fb64e93b38eb818486b773f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=ogj6RMK%2Bd1dIHLa0mAoyfYrQjiA%3D" alt="ESP4.png" loading="lazy"/>
添加好之后记得点好然后确定不要直接点 <code>×</code> 关掉了，那样是不会保存的
保存好之后点击 <code>工具 → 开发板 → 打开开发板管理器</code>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0692928b91fd4a5b88905a974a0cd075~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=JmMfoXp44gtqkN9Njpy%2BqfxCo0g%3D" alt="ESP5.png" loading="lazy"/>
在弹出的界面搜索框输入<code> ESP32</code> ,如下图所示(之前安装过旧版本的会显示更新，没安装过会显示为安装)
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/129320609f0542a49588318a5e423b4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=dwWEsTr%2BJff%2BO9TDt%2FIUCXDXmH8%3D" alt="ESP6.png" loading="lazy"/>
选择版本号为 <code>2.0.0-alpha1</code> ,点击安装即可
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2867aa8e879446418b90820fc530e05b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=eVKwIv7NzoUf%2Fjn9onLG6s87NZQ%3D" alt="ESP7.png" loading="lazy"/></p>
<h2 data-id="heading-3">方法2</h2>
<h3 data-id="heading-4">下载相关文件</h3>
<p>点开进入到<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fespressif%2Farduino-esp32" target="_blank" title="https://github.com/espressif/arduino-esp32" ref="nofollow noopener noreferrer">乐鑫github</a>，点击 <code>master</code> 位置的箭头可以找到名字为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fespressif%2Farduino-esp32%2Ftree%2Fesp32-s3-support" target="_blank" title="https://github.com/espressif/arduino-esp32/tree/esp32-s3-support" ref="nofollow noopener noreferrer">ESP32-s3-support的分支</a>，打开它，如下图所示
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b814e04433d4088afabfe260fc29432~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=uElR6ctr81bp%2FEYL%2F%2BfNAQw2GcY%3D" alt="ESP8.png" loading="lazy"/>
如果你像我下面这样没有一个列表一样的出现，那么就点击 <code>View all branches</code> 跳转过去再打开 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fespressif%2Farduino-esp32%2Ftree%2Fesp32-s3-support" target="_blank" title="https://github.com/espressif/arduino-esp32/tree/esp32-s3-support" ref="nofollow noopener noreferrer">ESP32-s3-support的分支</a> 就好了
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35725324111146ea93f28a861181620a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=KuJ392cCZw4H4p57V15zrMsV3zE%3D" alt="ESP9.png" loading="lazy"/>
打开之后点开右上角的 <code>Code</code> ，点击 <code>Download ZIP</code> 下载过来就好了
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ca6cf553df5434e9dff79edd6aaf04d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=m1Kz%2BK3h7CoLCP4Coto7CyMWmOk%3D" alt="ESP10.png" loading="lazy"/>
还是无法下载的用户可以在下方留言邮箱我把下载好的发过去</p>
<h3 data-id="heading-5">编译工具链下载</h3>
<p>下载好压缩包之后解压出来，我们注意到两个文件夹 <code>package</code> 和 <code>tools</code>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11a8265cb6af4956a1ba572fad4d4b29~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=L8hSbMRO%2FnK%2BQOeSUoJlu%2BUZS7Y%3D" alt="ESP11.png" loading="lazy"/></p>
<h4 data-id="heading-6">get下载安装编译工具</h4>
<p>打开找到 <code>tools</code> 文件夹下有个 <code>get.exe</code> 的应用程序，双击之后就会开始往我们解压的包里面下载并安装编译工具链
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b695aee3b3a49a4869fc56e26a1831b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=DMm3aC3euYi5oGNNj%2FGMnv%2Fu3uU%3D" alt="ESP12.png" loading="lazy"/>
接下来等待下载完毕之后会在 <code>tools</code> 文件夹下新增若干个文件夹，我们对比下载前后 <code>tools</code> 文件夹下的文件可以知道有没有成功下载并安装(因为这种下载方式没下载成功会关闭界面，下载成功了也会关闭界面)</p>
<p>下载安装前</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/683d3c2ac747490b9e2d62cbf3021876~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=LMNefgarTnetrGlJRPfZx%2FS2N44%3D" alt="ESP13.png" loading="lazy"/></p>
<p>下载安装后</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bd738cb0455467587d7397cfcca9aa1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=iqERsDXGRj3tTPTOVYKQsW3B8cs%3D" alt="ESP14.png" loading="lazy"/></p>
<h4 data-id="heading-7">手动下载安装</h4>
<p>我们分析arduino安装的时候或者get下载安装的时候的安装步骤，前面两种方式也是在github上下载响应的包，并下载编译工具链解压放到相应的文件夹下</p>
<p>那么接下来我们手动下载并放置到相应的位置之后是不是会有一样的效果</p>
<p>我们在 <code>package</code> 这个文件夹下找到有一个 <code>json</code> 文件，我们打开之后可以看到一共有7个需要下载的文件会下载到 tools 里面</p>
<pre><code class="hljs language-cpp" lang="cpp">          <span class="hljs-string">"toolsDependencies"</span>: [
            {
              <span class="hljs-string">"packager"</span>: <span class="hljs-string">"esp32"</span>,
              <span class="hljs-string">"name"</span>: <span class="hljs-string">"riscv32-esp-elf-gcc"</span>,
              <span class="hljs-string">"version"</span>: <span class="hljs-string">"gcc8_4_0-esp-2021r2"</span>
            },
            {
              <span class="hljs-string">"packager"</span>: <span class="hljs-string">"esp32"</span>,
              <span class="hljs-string">"name"</span>: <span class="hljs-string">"xtensa-esp32-elf-gcc"</span>,
              <span class="hljs-string">"version"</span>: <span class="hljs-string">"gcc8_4_0-esp-2021r2"</span>
            },
            {
              <span class="hljs-string">"packager"</span>: <span class="hljs-string">"esp32"</span>,
              <span class="hljs-string">"name"</span>: <span class="hljs-string">"xtensa-esp32s2-elf-gcc"</span>,
              <span class="hljs-string">"version"</span>: <span class="hljs-string">"gcc8_4_0-esp-2021r2"</span>
            },
            {
              <span class="hljs-string">"packager"</span>: <span class="hljs-string">"esp32"</span>,
              <span class="hljs-string">"name"</span>: <span class="hljs-string">"xtensa-esp32s3-elf-gcc"</span>,
              <span class="hljs-string">"version"</span>: <span class="hljs-string">"gcc8_4_0-esp-2021r2"</span>
            },
            {
              <span class="hljs-string">"packager"</span>: <span class="hljs-string">"esp32"</span>,
              <span class="hljs-string">"name"</span>: <span class="hljs-string">"esptool_py"</span>,
              <span class="hljs-string">"version"</span>: <span class="hljs-string">"3.2.0"</span>
            },
            {
              <span class="hljs-string">"packager"</span>: <span class="hljs-string">"esp32"</span>,
              <span class="hljs-string">"name"</span>: <span class="hljs-string">"mkspiffs"</span>,
              <span class="hljs-string">"version"</span>: <span class="hljs-string">"0.2.3"</span>
            },
            {
              <span class="hljs-string">"packager"</span>: <span class="hljs-string">"esp32"</span>,
              <span class="hljs-string">"name"</span>: <span class="hljs-string">"mklittlefs"</span>,
              <span class="hljs-string">"version"</span>: <span class="hljs-string">"3.0.0-gnu12-dc7f933"</span>
            }
          ]
</code></pre>
<p>对应的链接在下方的 <code>tools</code> 中，对应 <code>"host": "i686-mingw32"</code> 下方的 <code>url</code> 为我们 <code>windows</code> 下面 <code>arduino</code> 下载的文件链接
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/326e9db239ff4261b88e28864f9e86ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=uJTUMI8ZDnVRdK5Nm%2BDX79jhU%2Fo%3D" alt="ESP15.png" loading="lazy"/>
整理的七个链接如下</p>
<ol>
<li>
<blockquote>
<p><code>https://github.com/espressif/crosstool-NG/releases/download/esp-2021r2/riscv32-esp-elf-gcc8_4_0-esp-2021r2-macos.tar.gz</code></p>
</blockquote>
</li>
<li>
<blockquote>
<p><code>https://github.com/espressif/crosstool-NG/releases/download/esp-2021r2/xtensa-esp32-elf-gcc8_4_0-esp-2021r2-patch2-win32.zip</code></p>
</blockquote>
</li>
<li>
<blockquote>
<p><code>https://github.com/espressif/crosstool-NG/releases/download/esp-2021r2/xtensa-esp32s2-elf-gcc8_4_0-esp-2021r2-patch2-win32.zip</code></p>
</blockquote>
</li>
<li>
<blockquote>
<p><code>https://github.com/espressif/crosstool-NG/releases/download/esp-2021r2/xtensa-esp32s3-elf-gcc8_4_0-esp-2021r2-patch2-win64.zip</code></p>
</blockquote>
</li>
<li>
<blockquote>
<p><code>https://github.com/espressif/arduino-esp32/releases/download/2.0.2/esptool-3.2-windows.zip</code></p>
</blockquote>
</li>
<li>
<blockquote>
<p><code>https://github.com/earlephilhower/esp-quick-toolchain/releases/download/3.0.0-gnu12/x86_64-w64-mingw32.mklittlefs-c41e51a.200706.zip</code></p>
</blockquote>
</li>
<li>
<blockquote>
<p><code>https://github.com/igrr/mkspiffs/releases/download/0.2.3/mkspiffs-0.2.3-arduino-esp32-win32.zip</code></p>
</blockquote>
</li>
</ol>
<p>把链接放到浏览器里面下载好解压出来得到下面七个文件夹，下载不了可以在下方留言邮箱，我会把所有文件打包好发送过去
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b7dd68534ff42b99b64303d44d8eef2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=bHK5B%2FuQ3viB9Afpd8%2FE4O%2FezN8%3D" alt="ESP16.png" loading="lazy"/>
复制这七个文件夹和里面的文件放到之前解压的芯片包的 <code>tools</code> 文件夹下即可</p>
<h3 data-id="heading-8">开发板添加</h3>
<p>那么我们做到这一步，不管你是用前面的 get 的方式 直接下载的工具链还是 手动下载解压 放进去的，我们都将得到一个完整的 包含编译工具链的芯片包，我这边把上面所有用到的文件都打包好放好如下图所示的样式</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4578025037fa4466a4673a798c4386a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=TCaud41Qz6Ie0SfTq24OtmAZbLA%3D" alt="ESP17.png" loading="lazy"/></p>
<p>那么接下来我们找到arduino的安装路径，安装路径下会有一个 <code>hardware</code> 的文件夹，打开之后在里面新建一个名称为 <code>espressif</code> 的文件夹
把我们下载好有工具链的包复制(这个时候名称为 <code>arduino-esp32-esp32-s3-support</code> )到刚新建的 espressif 文件夹下，值得注意的是这个时候不要打开arduino，避免出现问题，复制过去如下所示
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef03a8ac439c4094b5b1a605d7e38f12~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=yh1fpO54cOo57gsBVaC%2B4Zlwni0%3D" alt="ESP18.png" loading="lazy"/></p>
<p>最后修改 文件夹 <code>arduino-esp32-esp32-s3-support</code> 名称为 <code>esp32</code> ，不然到时候编译的时候会报一个警告</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2b646155f52476abee419a1b268f51a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=djbWeKUcT7sMi2nOvYh2vZcwYj0%3D" alt="ESP19.png" loading="lazy"/></p>
<p>我们打开arduino，这个时候可以看到开发板里面新增了 <code>ESP32-S3</code> 的开发板
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3b45592f0b24a0283be075a14e15965~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY5L-h55S15a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767761038&amp;x-signature=PLjspsUO83yEjhtzcpc7oH7X5u0%3D" alt="ESP20.png" loading="lazy"/></p>
<p>选好开发板，编写一个输出 Hello World! 的程序</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">setup</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">// put your setup code here, to run once:</span>
  Serial.<span class="hljs-built_in">begin</span>(<span class="hljs-number">115200</span>);
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">loop</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-comment">// put your main code here, to run repeatedly:</span>
  Serial.<span class="hljs-built_in">println</span>(<span class="hljs-string">"Hello World!"</span>);
  <span class="hljs-built_in">delay</span>(<span class="hljs-number">1000</span>);
}
</code></pre>
<p>成功编译并下载运行！</p>
<h2 data-id="heading-9">总结</h2>
<p>这篇搭建开发环境的文章本身写的细节是比较多的，写这篇文章的时候是在2022年3月，用户完全可以根据我们提供的下载好的文件直接搭建好开发环境是非常快的，但是乐鑫官方本身肯定是会有新的版本出现，或许修复了现有的许多BUG，希望用户能使用较为稳定的版本，也希望优信能陪伴大家共同学习共同进步，欢迎一键三连，感谢各位大佬！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[逝水流远，长忆当歌——我的2025]]></title>    <link>https://juejin.cn/post/7589732701290348578</link>    <guid>https://juejin.cn/post/7589732701290348578</guid>    <pubDate>2025-12-31T08:23:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589732701290348578" data-draft-id="7589706646215524352" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="逝水流远，长忆当歌——我的2025"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-31T08:23:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Gopher"/> <meta itemprop="url" content="https://juejin.cn/user/3913917123797735"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            逝水流远，长忆当歌——我的2025
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917123797735/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Gopher
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:23:01.000Z" title="Wed Dec 31 2025 08:23:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>岁末的钟声在寒夜里回荡，显示器的微光在满屏的公式与代码间明明灭灭。于我而言，这些文字，是时间风尘的证词，是对消失的、存在的事物的祭奠，是对卑微之物的重新打量。逝水流远，长忆当歌，这些文字献予过往与当下，献予消失的、到来的无尽命运和岁月。</p>
<p>终于，2025年过去了。</p>
<h2 data-id="heading-0">这一年我读了一些书</h2>
<blockquote>
<p>我是天上清风仙，阅览群书在人间</p>
</blockquote>
<p>深夜的实验室里，文献与代码在屏幕上交替闪现，仿佛两个平行世界的对话。今年重读李娟的《遥远的向日葵》，在阿尔泰的荒原叙事中找到了某种深刻的共鸣。她笔下那些在碱土中挣扎的向日葵，从不像梵高画作中那样燃烧着生命的狂热，也不追求成为耀眼的太阳图腾，只是固执地在贫瘠中完成着属于自己的轮回。这种在荒凉中依然保持尊严的姿态，让我想起实验室窗外那些在砖缝间顽强生长的野草，它们不需要任何人的注目，只是在无人问津的角落里，按照自己的节奏完成生命的旅程。</p>
<p>这种朴素的生命哲学，恰与存在主义的核心洞见不谋而合。世界本质上是荒诞的，人生或许真的没有预设的意义，就像推石上山的西西弗，他的劳作看似是无意义的重复。但加缪告诉我们，重要的不是石头会不会再次滚落，而是在这个看似徒劳的过程中，我们依然保有说"是"的勇气。当西西弗意识到荒诞的存在，却依然选择推石上山时，他就已经战胜了命运。这种觉悟，让他在每一次下山的路上都能以轻盈的脚步，直面生命的重量。</p>
<p>成功从来不是以完美的结局来定义的，存在本身就是一种英雄主义。这种英雄主义就体现在绝境中的自由选择——就像李娟笔下那些在盐碱地里依然努力生长的向日葵，它们的选择不是成为别人眼中的风景，而是在最贫瘠的土壤里守住生命的本真。这让我想起科研路上的日日夜夜，那些看似毫无进展的实验，那些反复调试的代码，何尝不像是另一种形式的"推石上山"？我们选择继续，不是因为确信一定能抵达山顶，而是因为在推石的过程中，我们找到了属于自己的节奏和意义。</p>
<p>真正的智慧，或许就藏在这种日复一日的坚持里。就像荒原上的向日葵，它们从不问为什么要生长，只是专注地完成每一次日出日落的轮回。在这个过程中，它们不仅抵御了荒原的贫瘠，更在碱土中开出了独一无二的花朵。这或许就是存在主义最深刻的启示：生命的意义不在远方，就在每一次推石上山的路上，在每一个看似平凡却充满勇气的选择里。</p>
<h2 data-id="heading-1">这一年发生的事</h2>
<blockquote>
<p>世事如潮，推石如常。大海的风声，终究要落到每个人案头那盏灯的明灭里。</p>
</blockquote>
<p>如果说书给人的安慰，是一种温柔的解释；那么现实给人的教育，往往更像粗粝的证据：它不急着说服谁，只是在反复的推移与撞击中，让人看清自己站在哪里，又能走到哪里。</p>
<p>这一年，世界依旧在几条永恒的张力线上摆荡：战争与和平、秩序与撕裂、繁荣与匮乏、技术与不安。许多事情并非“发生”那么简单，它们更像缓慢移动的大陆板块——平日里几乎无感，直到某一次摩擦发出巨响，才意识到其实一直生活在震动之上。人们仍然用更短的耐心追逐更快的变化，用更碎的情绪解释更复杂的结构；而宏大叙事并不会自动给个人答案，答案往往藏在更具体、更笨拙的生活与劳动里。</p>
<p>物理学中有个定律，庞加莱回归：对于在有限体积内运动的、由大量粒子组成的守恒力学系统，经过足够漫长的时间后，系统会无限接近其初始状态。它讲的是理想封闭系统的必然，却也提供一种近乎残酷的隐喻——许多以为已经被时代“解决”的矛盾，常会在另一种形式里再度归来。人类社会当然不是孤立系统，变量持续注入，回归并不等于原样重演；但张力反复出现的事实，足以让人对“进步的直线叙事”保持节制。</p>
<p>在技术的浪潮中，这一年尤为显著的是一种“从新奇到常态”的转变。人工智能不再只是新闻标题里的惊叹号，而正在成为基础设施、生产关系与认知方式的一部分：它让效率更锋利，也让不确定更普遍；它把很多人的工作往前推了一步，也把很多人的焦虑往下压了一层。与此同时，人类对技术的态度出现微妙分裂：有人把它当作捷径，有人把它当作威胁；有人沉迷于“替代”，有人执拗于“不可替代”。在实验室的漫长夜里，反倒更容易相信后一种判断——真正能抵御无序的，从来不是工具本身，而是使用工具的人，是否仍愿意对真问题保持耐心，对好答案保持诚实。</p>
<p>这些“时代的大事”落在身上，并不总以新闻的形式呈现，而是以更细小的方式嵌入日常：算力的紧张与预算的权衡、数据的噪声与偏差、评审的标准与门槛、代码的边界条件与不可复现。它们像一圈圈看不见的绳索，勒住研究者的想象力，也逼迫人学会更务实地创造负熵：少一点空想，多一点验证；少一点宏愿，多一点可落地的路径。</p>
<p>而这一年的巨响之一，仍来自俄乌战争。漫长的拉锯让“和平”越来越像谈判桌上的语法：停火、边界、安全、承诺与背书，被反复抬起，又反复搁置。更令人心寒的并非战火本身，而是战火之外的计算——当强权习惯性地无视公平正义，原则便容易沦为装饰，命运则被折算为筹码。普京式的强硬与特朗普式的交易，恰是这种冷硬现实的两个侧影：一个把既成事实推成规则，一个把规则降格为条件。</p>
<p>同一年里，杨振宁先生的离去也像一道静默的分界线。他的一生，既是科学史的一部分，也是时代结构的一部分：选择赴美，置身科学中心，当然成就了他的高度；但同样的时代分岔，也让许多同样优秀的人落寞——不是因为不够好，而是因为机会从来不按才华的密度均匀分配。传奇的光芒越清晰，越映出那些未被照见的阴影：被耽误的天赋、被迫改写的志业、被现实消耗的锋芒。</p>
<h2 data-id="heading-2">这一年的学习生活</h2>
<blockquote>
<p>孤独是自由的衍生品，遗憾是往事的纪念品</p>
</blockquote>
<p>这一年，生活的推进并不迅疾。很多时候，进展像被拉长的阴影：看得见在移动，却很难说清究竟向前了多少。新的成果不多，甚至常有一种停滞的错觉；压力却并不因此减少，反而在时间的逼近里变得更具体、更有重量。博三将尽，博四在即，才忽然意识到一年竟已走完——时间从不解释自己，只是把人轻轻往前推，推到不得不面对的节点上。</p>
<p>在这样的年份里，情绪也更容易被细小的事牵动：一次实验的失败，一次会议的追问，一次深夜的自我复盘，都足以让人短暂失衡。可同样是在这些不稳定里，仍有一些东西悄悄保留下来——像在漫长的日子里曾被认真地照亮过。那种照亮并不喧哗，更像冬夜里一盏不刺眼的灯，让人在疲惫与不确定中仍愿意把生活过下去；也像某些时刻递来的沉默理解，使人相信自身并非全然孤立的存在。</p>
<p>只是，人间的温柔常带着期限。并非不曾真诚，也并非不曾用力，而是一些更复杂的缘由——路径的分岔、节奏的错位、现实的牵制——让许多未竟之事最终选择停在合适的位置。它们不一定需要一个明确的结尾，更像把某段路轻轻折起，收进记忆的夹层里：不再铺陈，却也不必抹去。</p>
<p>于是，孤独并不全是失去，它也意味着把自由重新领回手中；遗憾也不尽是缺憾，它更像往事留下的纪念品，提醒人曾经拥有过、也曾经珍惜过。</p>
<h2 data-id="heading-3">这一年的感悟</h2>
<blockquote>
<p>鸷鸟之不群兮，自前世而固然</p>
</blockquote>
<p>这一年，许多苦楚并不来自惊天动地的事，而来自一些反复出现的细节：话语在转述里走样，沉默被解读成态度，迟疑被涂成罪名。这样的缝隙里并非只有一人踽踽独行——不少人都在相似的回声中耗损：被误读、被揣测、被轻慢，或在某个瞬间被迫为并不存在的“过错”自证清白。于是，事实尚未来得及站稳，流言便已先行；“道德法庭”也总能迅速搭起——不问证据，只问站位；不问复杂，只问归队。黑与白被描得锋利，并非世界天生如此，而是灰色太耗耐心：承认复杂意味着承担责任，允许暧昧意味着接受不确定，而群体最怕的，恰是这种不确定。</p>
<p>更疲惫的是，这并不总出自赤裸的恶意，更多是一种普遍的自保：用嘲弄维系秩序，用贬损确认位置，用“为你好”包装干预。环境越逼仄，资源越稀缺，竞争越紧张，这种自保越容易滑向冷硬，甚至做到无声无息——夺走的是名誉、机会、边界与安宁，却很难指出哪一刀真正落下。许多场合里，表演比真实更安全，附和比独立更省事；流行的不是诚恳，而是姿态；不是求真，而是求胜。</p>
<p>也正因如此，“不群”不再只是诗句里的修辞，它更像一条不得不走的路：把精力从无谓的争辩里抽离出来，把手伸回到仍可握住的事——读书、写作、摄影，把日子一寸寸过实。所谓节制，并非洁癖式的拒绝，而是拒绝被拖入那套轻佻的裁决里：宁可慢一些，也不把人生交给喧哗；宁可沉默，也不把解释当作乞求。</p>
<p>正如即将到来的某段集体记忆将迎来一个整圆的节点。邓鹏博士曾说，人对于过去的关怀实际上反射出他们对今天对未来的展望，而人之所以为人，是因为人有记忆，这种记忆是人性，是人之所以为人的重要属性，没有记忆也就没有文明，一个没有记忆的民族也是没有前途的。时间改变了外衣与语境，却未必改变暗河的走向：流言仍可能先于事实，立场仍可能替代判断，道德仍可能被当作工具。所谓反思，并不止于回望那段岁月如何把人卷入洪流，更在于辨认这些机制如何在日常里换形续存——当恐惧、稀缺、从众与权力诱惑再度集齐，相似的戏码便会以更温和、更日常的方式重演。</p>
<p>也因此，真正珍贵的，反倒是那些不显眼却更难的东西：在灰色里保持清明，在压力下守住边界，在看过人心之后仍不轻易变成同类。正如陶先生有言，“我们一定要像岩石一般坚定，当狂风暴雨之夜，风想把它们彻底掀翻，雨想把它们打进沙滩，浪涛想把它们卷入大海，但是它们屹然不动。当风雨过后，当浪涛退后，它们仍旧矗立在大海边，指向青天，面对大海”。</p>
<p>宇宙恒长，文明盛衰，唯有善良与生命证明着人类的存在和延续——那是最朴素的介质，却拥有穿越时空的力量，我们终将义无反顾地走进那个温和的良夜，去探索生命的春天，永不停歇。</p>
<p>2025再见
2026你好</p>
<p>2025年12月31日</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI自动画界面？Google这个开源神器让前端工程师失业了]]></title>    <link>https://juejin.cn/post/7589732701290381346</link>    <guid>https://juejin.cn/post/7589732701290381346</guid>    <pubDate>2025-12-31T08:23:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589732701290381346" data-draft-id="7589706646215540736" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI自动画界面？Google这个开源神器让前端工程师失业了"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-31T08:23:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="居然JuRan"/> <meta itemprop="url" content="https://juejin.cn/user/2524134427858205"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI自动画界面？Google这个开源神器让前端工程师失业了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134427858205/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    居然JuRan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:23:52.000Z" title="Wed Dec 31 2025 08:23:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">AI自动化界面？Google这个开源神器让前端工程师"失业"了</h2>
<h3 data-id="heading-1">当产品经理说"给我画个界面"，AI说"我来"</h3>
<p>你有没有遇到过这种场景：产品经理拿着需求文档找到你，说"这个功能需要一个搜索框、几个筛选条件、还有个结果列表"。然后你打开设计稿，开始写HTML、调CSS、配组件库，一通操作下来半天过去了。</p>
<p>更头疼的是，产品经理看完说："嗯……要不再加个地图？表单再调整一下？"你的内心：💔</p>
<p>但如果我告诉你，现在有个工具能让AI直接"画"界面——你说一句话，它就能生成带表单、图表、地图的完整交互界面，你信吗？</p>
<p>这不是科幻片，而是Google刚推出的开源框架：<strong>A2UI</strong>（Agent-to-User Interface）。</p>
<h3 data-id="heading-2">一句话生成界面，这是什么魔法？</h3>
<p>A2UI，全称Agent-to-User Interface，直译就是"从AI代理到用户界面"。简单说，它让AI有了"画UI"的能力。</p>
<p>传统开发流程是这样的：需求→设计稿→前端写代码→调试→上线。而A2UI的流程变成了：<strong>需求→AI生成界面→直接用</strong>。</p>
<p>比如视频里展示的景观设计应用，用户上传一张院子照片，AI（Gemini）分析后，自动生成一个定制表单——不是简单的文本框，而是带数字图表、Google地图的交互式界面，用户可以直接在上面操作。</p>
<p>关键是，这些界面能同时跑在网页、手机、桌面应用上，而且<strong>不执行任意代码</strong>，安全性拉满。</p>
<p>这就像给AI装了一支"数字画笔"，你说要什么，它就能当场画出来。</p>
<h3 data-id="heading-3">双剑合璧：AGUI + A2UI的完美配合</h3>
<p>你可能会好奇：AI怎么知道该画什么？这就要提到A2UI的"黄金搭档"——<strong>AGUI</strong>（Agent-to-GUI）。</p>
<p>把它俩比作一对组合：</p>
<ul>
<li>
<p><strong>AGUI是"翻译官"</strong>：它负责在你的应用和AI代理之间建立通信管道，管理双向数据流和状态同步。就像你和AI之间的专属热线。</p>
</li>
<li>
<p><strong>A2UI是"施工图"</strong>：它是Google定义的一套UI规范，告诉AI该生成什么样的组件——按钮长什么样、表单怎么排、图表用哪种。</p>
</li>
</ul>
<p>举个例子：你对着应用说"帮我找附近的意大利餐厅"。AGUI把这句话传给AI代理，AI处理完后通过A2UI返回一个"施工图"（JSON格式），里面写着"需要一个搜索框、三个餐厅卡片、一个地图组件"。最后AGUI把这个图纸渲染成真实界面。</p>
<p>这套组合拳的威力在于：<strong>AI不仅能"想"，还能"画"</strong>。传统AI只能给你答案，现在它能直接把答案变成可操作的界面。</p>
<h3 data-id="heading-4">魔法背后的秘密：从JSON到真界面</h3>
<p>说到这里，你可能会问：AI生成的界面到底怎么变成我能看到、能点击的东西？</p>
<p>这个过程分三步走：</p>
<p><strong>第一步：自然语言输入</strong><br/>
你在A2UI Composer（可视化构建器）里输入需求，比如"创建一个照片上传和表单面板"。这一步就像跟设计师沟通需求。</p>
<p><strong>第二步：生成JSON蓝图</strong><br/>
AI理解你的需求后，吐出一份JSON文件。注意，这<strong>不是可执行代码</strong>，而是一份"声明式描述"——它只说"这里要一个按钮、那里要一个输入框"，但不涉及具体实现逻辑。</p>
<p>这个设计非常巧妙：因为不执行代码，所以不会有安全风险（没法植入恶意脚本）；因为是标准JSON，所以跨平台通用。</p>
<p><strong>第三步：渲染器把图纸变成实物</strong><br/>
JSON生成后，需要一个"渲染器"把它转化成真实界面。这个渲染器可以是Copilot Kit（最推荐，与A2UI深度集成）、React、Angular，甚至Flutter。渲染器读取JSON，调用对应的原生组件，最终呈现出可交互的界面。</p>
<p>更酷的是，AI代理还能<strong>动态更新UI</strong>。比如用户上传照片后,AI可以根据照片内容实时调整表单字段、添加图表或地图。整个过程丝滑流畅，体验堪比原生应用。</p>
<h3 data-id="heading-5">实战见真章：30秒搭建餐厅查找器</h3>
<p>纸上得来终觉浅,咱们看个真实案例。</p>
<p>视频里展示了一个用A2UI + AGUI搭建的餐厅查找应用。整个流程是这样的：</p>
<ol>
<li>
<p><strong>用户输入</strong>："帮我找附近的意大利餐厅"</p>
</li>
<li>
<p><strong>AI处理</strong>：Gemini接收请求，调用地理位置API和餐厅数据库</p>
</li>
<li>
<p><strong>界面生成</strong>：A2UI自动创建搜索结果页面——包含餐厅名称、评分、距离，每个餐厅卡片都能点击查看详情或打开Google地图</p>
</li>
<li>
<p><strong>实时交互</strong>：用户可以筛选价格区间、查看营业时间，每次操作AI都会动态更新界面</p>
</li>
</ol>
<p>整个过程没有一行前端代码,全是AI根据语义自动生成。更关键的是,这个界面不是静态的——它能响应用户操作、更新数据、调用第三方服务,完全具备生产级应用的交互能力。</p>
<p>这就像给AI配了一个"万能工具箱":你告诉它要做什么,它自己挑工具、搭积木、调试测试,最后交付一个能用的产品。</p>
<h3 data-id="heading-6">开发者的新纪元：四大杀手锏</h3>
<p>说了这么多,A2UI到底能给开发者带来什么实际好处?总结起来四个字:<strong>快、稳、全、省</strong>。</p>
<p><strong>快速原型</strong><br/>
传统开发一个功能,光UI就得折腾几天。现在你只需要描述需求,AI几分钟就能生成可交互的原型。产品经理要改需求?没问题,改个提示词重新生成就行,省去了反复改代码的痛苦。</p>
<p><strong>安全可靠</strong><br/>
因为A2UI生成的是声明式JSON而非可执行代码,天然避免了XSS攻击、代码注入等安全问题。你的应用始终掌控全局,AI只负责"建议"界面长什么样,不会篡改核心逻辑。</p>
<p><strong>跨平台通用</strong><br/>
同一份JSON可以在Web、iOS、Android、桌面应用上渲染,前端团队不用再为不同平台写三套代码。这对小团队来说简直是福音——一个人就能搞定全端开发。</p>
<p><strong>完全免费开源</strong><br/>
A2UI和Copilot Kit都是开源项目,代码托管在GitHub上,文档齐全、社区活跃。你可以随意修改、集成到自己的项目里,不用担心授权费和供应商锁定。</p>
<p>更重要的是,它降低了AI应用开发的门槛。以前想做一个AI驱动的应用,你得懂前端、后端、AI模型调用、状态管理……现在你只需要专注业务逻辑,界面交给AI就行。</p>
<h3 data-id="heading-7">尾声：当AI学会"画图",我们该学什么?</h3>
<p>写到这里,你可能会有点恐慌:AI都会画界面了,前端工程师是不是要失业了?</p>
<p>别慌。A2UI不是来"抢饭碗"的,而是来"升级工具"的。</p>
<p>就像CAD软件出现后,建筑设计师没有失业,反而能设计出更复杂的建筑;Photoshop普及后,平面设计师没有失业,反而创作出更惊艳的作品。A2UI也是一样——它解放了开发者在重复劳动上的时间,让你能专注于更有创造性的工作:产品体验优化、复杂交互设计、业务逻辑创新。</p>
<p>更重要的是,它打开了一扇新窗:当AI能理解你的意图、自动生成界面、实时响应用户需求,我们对"应用开发"的定义本身就在改变。未来的开发者,可能更像是"AI协调者"——你描述愿景,AI负责实现细节。</p>
<p>所以,与其担心被替代,不如现在就去GitHub把A2UI的repo克隆下来,跑跑demo,体验一下这个"会画图的AI"。说不定下周你的老板就会问:"听说有个工具能让AI自动生成界面,咱们能不能用上?"</p>
<p>到那时,你就能淡定地说:"早就准备好了。"</p>
<hr/>
<p><strong>相关资源</strong></p>
<ul>
<li>
<p>A2UI官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fa2ui.org" target="_blank" title="https://a2ui.org" ref="nofollow noopener noreferrer">a2ui.org</a></p>
</li>
<li>
<p>GitHub仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FCopilotKit%2FCopilotKit" target="_blank" title="https://github.com/CopilotKit/CopilotKit" ref="nofollow noopener noreferrer">github.com/CopilotKit/…</a></p>
</li>
<li>
<p>Copilot Kit文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.copilotkit.ai" target="_blank" title="https://docs.copilotkit.ai" ref="nofollow noopener noreferrer">docs.copilotkit.ai</a></p>
</li>
<li>
<p>A2UI Composer在线体验：<a href="https://link.juejin.cn?target=https%3A%2F%2Fa2ui-composer.ag-ui.com" target="_blank" title="https://a2ui-composer.ag-ui.com" ref="nofollow noopener noreferrer">a2ui-composer.ag-ui.com</a></p>
</li>
</ul>
<p>准备好迎接AI画界面的时代了吗?评论区聊聊你的想法!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vscode 二开踩坑记录]]></title>    <link>https://juejin.cn/post/7589813969515446272</link>    <guid>https://juejin.cn/post/7589813969515446272</guid>    <pubDate>2025-12-31T07:27:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589813969515446272" data-draft-id="7589822564778246159" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vscode 二开踩坑记录"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-31T07:27:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sTone87375"/> <meta itemprop="url" content="https://juejin.cn/user/2946346894764584"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vscode 二开踩坑记录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2946346894764584/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sTone87375
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T07:27:44.000Z" title="Wed Dec 31 2025 07:27:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">开发环境准备</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2Fvscode%2Fwiki%2FHow-to-Contribute" target="_blank" title="https://github.com/microsoft/vscode/wiki/How-to-Contribute" ref="nofollow noopener noreferrer">How to contribute</a></li>
</ul>
<h2 data-id="heading-1">npm ci报错:gyp相关报错</h2>
<ol>
<li>注意检查python版本和node-gyp的版本安装情况,严格按照这个<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnodejs%2Fnode-gyp%3Ftab%3Dreadme-ov-file%23installation" target="_blank" title="https://github.com/nodejs/node-gyp?tab=readme-ov-file#installation" ref="nofollow noopener noreferrer">文档</a>:</li>
</ol>
<ul>
<li>建议:
<ul>
<li>python: &gt;= v3.12x</li>
<li>node-gyp: &gt;= v10</li>
</ul>
</li>
<li>python版本尽量不要污染全局,可以采用pyenv来管理和设置当前终端的python版本</li>
</ul>
<ol start="2">
<li>如果还报错, 实测如下方案:</li>
</ol>
<p>最简修复：删坏缓存、重新拉取（走国内镜像秒下）</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 清掉损坏的缓存</span>
<span class="hljs-built_in">rm</span> -rf ~/.cache/node-gyp/22.17.0

<span class="hljs-comment"># 2. 国内镜像（任选其一）</span>
<span class="hljs-built_in">export</span> npm_config_disturl=https://cdn.npmmirror.com/binaries/node
<span class="hljs-comment"># 或者</span>
<span class="hljs-comment"># export npm_config_disturl=https://npmmirror.com/mirrors/node</span>

<span class="hljs-comment"># 3. 重装</span>
<span class="hljs-built_in">cd</span> vscode
<span class="hljs-built_in">rm</span> -rf build/node_modules build/package-lock.json
npm cache clean --force
npm install
</code></pre>
<hr/>
<p>如果镜像也 404，就再手动灌一次（保证完整性）</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 删除坏目录</span>
<span class="hljs-built_in">rm</span> -rf ~/.cache/node-gyp/22.17.0

<span class="hljs-comment"># 2. 重新下载并解压</span>
<span class="hljs-built_in">mkdir</span> -p ~/.cache/node-gyp/22.17.0
<span class="hljs-built_in">cd</span> ~/.cache/node-gyp/22.17.0
wget https://nodejs.org/dist/v22.17.0/node-v22.17.0-headers.tar.gz
tar --strip-components=1 -xf node-v22.17.0-headers.tar.gz

<span class="hljs-comment"># 3. 告诉 node-gyp 别联网</span>
<span class="hljs-built_in">export</span> npm_config_nodedir=<span class="hljs-variable">$HOME</span>/.cache/node-gyp/22.17.0

<span class="hljs-comment"># 4. 重装</span>
<span class="hljs-built_in">cd</span> vscode
<span class="hljs-built_in">rm</span> -rf build/node_modules build/package-lock.json
npm install
</code></pre>
<hr/>
<p>一键脚本（Ubuntu / Node 20+）</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-built_in">set</span> -e
<span class="hljs-built_in">cd</span> vscode

<span class="hljs-comment"># 1. 清理坏缓存</span>
<span class="hljs-built_in">rm</span> -rf ~/.cache/node-gyp/22.17.0

<span class="hljs-comment"># 2. 国内镜像拉取</span>
<span class="hljs-built_in">export</span> npm_config_disturl=https://cdn.npmmirror.com/binaries/node

<span class="hljs-comment"># 3. 重装</span>
<span class="hljs-built_in">rm</span> -rf build/node_modules build/package-lock.json
npm cache clean --force
npm install
<span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ tree-sitter rebuilt ok"</span>
</code></pre>
<p>保存为 <code>fix-tree-sitter.sh</code>，<code>chmod +x fix-tree-sitter.sh &amp;&amp; ./fix-tree-sitter.sh</code> 即可。
最简修复：删坏缓存、重新拉取（走国内镜像秒下）</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 清掉损坏的缓存</span>
<span class="hljs-built_in">rm</span> -rf ~/.cache/node-gyp/22.17.0

<span class="hljs-comment"># 2. 国内镜像（任选其一）</span>
<span class="hljs-built_in">export</span> npm_config_disturl=https://cdn.npmmirror.com/binaries/node
<span class="hljs-comment"># 或者</span>
<span class="hljs-comment"># export npm_config_disturl=https://npmmirror.com/mirrors/node</span>

<span class="hljs-comment"># 3. 重装</span>
<span class="hljs-built_in">cd</span> vscode
<span class="hljs-built_in">rm</span> -rf build/node_modules build/package-lock.json
npm cache clean --force
npm install
</code></pre>
<hr/>
<p>如果镜像也 404，就再手动灌一次（保证完整性）</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 删除坏目录</span>
<span class="hljs-built_in">rm</span> -rf ~/.cache/node-gyp/22.17.0

<span class="hljs-comment"># 2. 重新下载并解压</span>
<span class="hljs-built_in">mkdir</span> -p ~/.cache/node-gyp/22.17.0
<span class="hljs-built_in">cd</span> ~/.cache/node-gyp/22.17.0
wget https://nodejs.org/dist/v22.17.0/node-v22.17.0-headers.tar.gz
tar --strip-components=1 -xf node-v22.17.0-headers.tar.gz

<span class="hljs-comment"># 3. 告诉 node-gyp 别联网</span>
<span class="hljs-built_in">export</span> npm_config_nodedir=<span class="hljs-variable">$HOME</span>/.cache/node-gyp/22.17.0

<span class="hljs-comment"># 4. 重装</span>
<span class="hljs-built_in">cd</span> vscode
<span class="hljs-built_in">rm</span> -rf build/node_modules build/package-lock.json
npm install
</code></pre>
<hr/>
<p>一键脚本（Ubuntu / Node 20+）</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/usr/bin/env bash</span>
<span class="hljs-built_in">set</span> -e
<span class="hljs-built_in">cd</span> vscode

<span class="hljs-comment"># 1. 清理坏缓存</span>
<span class="hljs-built_in">rm</span> -rf ~/.cache/node-gyp/22.17.0

<span class="hljs-comment"># 2. 国内镜像拉取</span>
<span class="hljs-built_in">export</span> npm_config_disturl=https://cdn.npmmirror.com/binaries/node

<span class="hljs-comment"># 3. 重装</span>
<span class="hljs-built_in">rm</span> -rf build/node_modules build/package-lock.json
npm cache clean --force
npm install
<span class="hljs-built_in">echo</span> <span class="hljs-string">"✅ tree-sitter rebuilt ok"</span>
</code></pre>
<p>保存为 <code>fix-tree-sitter.sh</code>，<code>chmod +x fix-tree-sitter.sh &amp;&amp; ./fix-tree-sitter.sh</code> 即可。</p>
<h2 data-id="heading-2">npm run watch 报错</h2>
<ul>
<li>一定使用 npm ci来安装依赖,严格遵循package-lock文件锁定的版本:
这些报错都是「TypeScript 类型对不上」——不是语法错误，而是 <strong>xterm 升级后接口变了 + Node.js 类型定义里 <code>err</code> 从 <code>undefined</code> 变成 <code>null | undefined</code></strong>。<br/>
解决思路：要么 <strong>回退依赖版本</strong>（最快），要么 <strong>改源码适配新定义</strong>（长期）。下面给出两套现成命令，按需求二选一即可让 <code>npm run watch</code> 重新变绿。</li>
</ul>
<hr/>
<p>方案 1：回退到官方 lock 版本（1 分钟搞定）</p>
<ol>
<li>
<p>把 node_modules 和编译缓存清掉<br/>
rm -rf node_modules<br/>
rm -rf out<br/>
rm -rf .build-cache</p>
</li>
<li>
<p>用官方 lock 文件重新装<br/>
npm ci                # 必须 ci，不能用 install，否则 lock 被刷新</p>
</li>
<li>
<p>再 watch<br/>
npm run watch<br/>
→ 官方 lock 里 xterm 与 @types/node 版本是匹配的，一般 0 错误。</p>
</li>
</ol>
<hr/>
<p>方案 2：手动适配新类型（想保持最新依赖时用）</p>
<p>错误 1<br/>
<code>fastScrollModifier</code> 已在 xterm@5.3+ 被删除，直接删掉或加 <code>as any</code> 即可：</p>
<pre><code class="hljs language-diff" lang="diff">// src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts L226
<span class="hljs-deletion">- fastScrollModifier: 'alt',</span>
<span class="hljs-addition">+ // fastScrollModifier removed in xterm 5.3</span>
</code></pre>
<p>错误 2 &amp; 3<br/>
Node 18+ 的 <code>err</code> 回调签名变成 <code>Error | null | undefined</code>，把类型收窄即可：</p>
<pre><code class="hljs language-diff" lang="diff">// src/vs/workbench/api/node/extHostConsoleForwarder.ts L60
<span class="hljs-deletion">- (err?: Error | undefined) =&gt; void</span>
<span class="hljs-addition">+ (err?: Error | null | undefined) =&gt; void</span>

// src/bootstrap-fork.ts L134 同理
</code></pre>
<p>改完保存，watch 会自动增量编译，3 个错误消失。</p>
<hr/>
<p>一句话总结<br/>
想继续开发 <strong>就用方案 1 回退依赖</strong>；<br/>
想追新 xterm/Node 就 <strong>用方案 2 改三行代码</strong>。<br/>
改完再 <code>npm run watch</code>，终端里应该出现<br/>
<code>[watch-client] Finished compilation with 0 errors after xxxx ms</code></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Effect 执行时机与事件循环交错关系]]></title>    <link>https://juejin.cn/post/7589813969515986944</link>    <guid>https://juejin.cn/post/7589813969515986944</guid>    <pubDate>2025-12-31T08:25:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589813969515986944" data-draft-id="7589732701290315810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Effect 执行时机与事件循环交错关系"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2025-12-31T08:25:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="day1"/> <meta itemprop="url" content="https://juejin.cn/user/4310544201823182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Effect 执行时机与事件循环交错关系
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4310544201823182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    day1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:25:27.000Z" title="Wed Dec 31 2025 08:25:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.引言</h2>
<p>在 React 并发渲染架构中，副作用（Effect）的执行时机并非孤立存在，而是与浏览器事件循环的微任务、宏任务队列深度耦合。useEffect 作为最核心的副作用 Hook，其异步执行特性、passive effect 的特殊调度逻辑，一直是开发者理解 React 底层原理的难点。本文将从 React 源码出发，先通过核心源码片段梳理更新调度的关键链路，再逐层拆解 Effect 与事件循环的交错关系，揭示 passive effect 的调度模型。</p>
<h2 data-id="heading-1">2. 事件循环基础：微任务与宏任务的执行机制</h2>
<p>要理解 React Effect 的调度时机，首先要掌握浏览器事件循环（Event Loop）的核心。这是 React 实现异步、非阻塞渲染，并与宿主环境（浏览器）高效交互的底层基础。熟悉事件循环的可以跳过这个章节。</p>
<blockquote>
<p>之前写过一篇<a href="https://juejin.cn/post/7529367960890589236" target="_blank" title="https://juejin.cn/post/7529367960890589236">事件循环的文章</a>，也可以看一下。</p>
</blockquote>
<h3 data-id="heading-2">2.1 事件循环的运行流程：一次“循环”的生命周期</h3>
<p>浏览器的事件循环机制确保了 JavaScript 在单线程模型下依然能高效处理异步操作。其核心可以概括为“一次只做一件事，但会按顺序排队”。一轮具体的事件循环（Tick）可以分解为以下步骤：</p>
<ol>
<li><strong>执行同步代码</strong>：从宏任务队列中取出一个最老的任务（例如一个 <code>script</code> 标签里的代码），将其放入调用栈（Call Stack）并执行，直到调用栈清空。</li>
<li><strong>执行所有微任务</strong>：在同步代码执行完毕后，立即检查微任务队列（Microtask Queue）。如果队列不为空，则依次取出所有微任务并执行，直到微任务队列被完全清空。</li>
<li><strong>（可选）UI 渲染</strong>：在微任务队列清空后，浏览器有一次机会来更新 UI，包括执行重绘（Repaint）和回流（Reflow）。这个步骤不是每轮循环都必然发生，浏览器会根据刷新率、页面性能等因素自行决定。</li>
<li><strong>进入下一轮循环</strong>：返回第一步，准备从宏任务队列中取出下一个任务。</li>
</ol>
<p>这个“执行一个宏任务 -&gt; 清空所有微任务 -&gt; 可能的 UI 渲染”的循环，构成了事件循环的核心。</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/873485b1126e4c8a8db159f4043852ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF5MQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774327&amp;x-signature=jwGv6kRdkqyJqrVyiVKEsmKNsH8%3D" alt="8-1.svg" loading="lazy"/></p>
<h3 data-id="heading-3">2.2 微任务与宏任务的核心差异与示例</h3>
<p>微任务和宏任务最关键的区别在于它们的<strong>执行时机</strong>和<strong>优先级</strong>。</p>
<ol>
<li><strong>微任务 (Microtask)</strong>:</li>
</ol>
<p><strong>特点</strong>：优先级极高，在当前同步任务执行结束后、UI 渲染之前立即执行。如果微任务执行过程中又产生了新的微任务，它们会被添加到队列末尾，并在同一轮事件循环中被“插队”执行，直到队列完全清空。
<strong>常见示例</strong>： - <code>Promise.then()</code>、<code>Promise.catch()</code>、<code>Promise.finally()</code> - <code>MutationObserver</code>：用于监听 DOM 树的变化。 - <code>queueMicrotask()</code>：一个专门用于手动向微任务队列添加任务的现代 API。 - <code>process.nextTick()</code> (Node.js 环境)</p>
<ol start="2">
<li><strong>宏任务 (Macrotask)</strong>:</li>
</ol>
<p><strong>特点</strong>：优先级较低，被放入宏任务队列中排队等待。每轮事件循环只执行队列中的<strong>一个</strong>宏任务。
<strong>常见示例</strong>： - 整体的 <code>&lt;script&gt;</code> 代码块 - <code>setTimeout()</code>、<code>setInterval()</code> - <code>MessageChannel</code>：React Scheduler 用它来模拟 <code>setImmediate</code>，以实现无延迟的宏任务调度。 - I/O 操作、网络请求回调 - 用户交互事件（如 <code>click</code>、<code>scroll</code>）的回调函数</p>
<h4 data-id="heading-4">代码示例：执行顺序的直观体现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"1. 同步代码开始"</span>);

<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"5. 宏任务：setTimeout"</span>);
}, <span class="hljs-number">0</span>);

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"3. 微任务：Promise.then 1"</span>);
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"4. 微任务：Promise.then 2"</span>);
  });
});

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"2. 同步代码结束"</span>);

<span class="hljs-comment">// 预期输出:</span>
<span class="hljs-comment">// 1. 同步代码开始</span>
<span class="hljs-comment">// 2. 同步代码结束</span>
<span class="hljs-comment">// 3. 微任务：Promise.then 1</span>
<span class="hljs-comment">// 4. 微任务：Promise.then 2</span>
<span class="hljs-comment">// 5. 宏任务：setTimeout</span>
</code></pre>
<p>这个例子清晰地展示了：同步代码最先执行，随后所有微任务被清空，最后才轮到下一轮事件循环中的宏任务。</p>
<h2 data-id="heading-5">3、passive effect 调度模型：useEffect 的异步执行本质</h2>
<p>我们已经知道，React 的渲染工作（Render Phase）可以在宏任务中被切分执行，而提交工作（Commit Phase）是同步的。那么，<code>useEffect</code> 的回调，也就是 Passive Effect，它到底在哪个阶段执行？</p>
<p>答案是：<strong>在 Commit 阶段之后，通过 Scheduler 调度的一个独立的宏任务中异步执行。</strong></p>
<p>这正是 <code>useEffect</code> “非阻塞”特性的核心。它确保了 Effect 的执行不会推迟浏览器的绘制，从而为用户提供更流畅的体验。</p>
<h3 data-id="heading-6">3.1 从 Commit 结束到 Passive Effect 调度</h3>
<p>整个流程可以分解为以下几个关键步骤：</p>
<ol>
<li>
<p><strong>Commit 阶段同步执行</strong>：
当 React 完成 Render 阶段后，会进入 <code>commitRoot</code> 函数。在这个阶段，React 会同步执行所有 DOM 操作（增、删、改）和 <code>useLayoutEffect</code> 的回调。这个过程是不可中断的，因为它需要保证 DOM 的一致性。</p>
</li>
<li>
<p><strong>检查并标记 Passive Effect</strong>：
在 <code>commitRoot</code> 的末尾，React 会检查本次更新中是否存在 Passive Effect。如果 <code>root.passiveEffects</code> 标记为 <code>true</code>，说明有 <code>useEffect</code> 或其销毁函数需要被执行。</p>
</li>
<li>
<p><strong>调度 <code>flushPassiveEffects</code></strong>：
如果存在 Passive Effect，React 并不会立即执行它们。相反，它会调用 <code>Scheduler_scheduleCallback</code>，将一个名为 <code>flushPassiveEffects</code> 的函数作为一个<strong>低优先级</strong>（<code>IdleSchedulerPriority</code>）的新任务交给 Scheduler。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// c:\Users\48150\Desktop\新建文件夹 (8)\react-app\src\react\packages\react-reconciler\src\ReactFiberWorkLoop.js (简化)</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">commitRoot</span>(<span class="hljs-params">root</span>) {
  <span class="hljs-comment">// ...</span>
  <span class="hljs-comment">// 1. 同步执行 DOM Mutations 和 useLayoutEffect</span>
  <span class="hljs-comment">// ...</span>

  <span class="hljs-keyword">const</span> rootHasPassiveEffects = root.<span class="hljs-property">passiveEffects</span>;
  <span class="hljs-keyword">if</span> (rootHasPassiveEffects) {
    <span class="hljs-comment">// 2. 如果存在 passive effects，将其作为一个新的低优先级任务调度</span>
    <span class="hljs-keyword">const</span> callback = flushPassiveEffects.<span class="hljs-title function_">bind</span>(<span class="hljs-literal">null</span>, root);
    <span class="hljs-title class_">Scheduler</span>_scheduleCallback(<span class="hljs-title class_">IdleSchedulerPriority</span>, callback);
  }

  <span class="hljs-comment">// ...</span>
  <span class="hljs-comment">// 3. 提交阶段结束</span>
}
</code></pre>
</li>
<li>
<p><strong>通过宏任务异步执行</strong>：
Scheduler 接收到这个新任务后，会像处理其他更新一样，通过 <code>MessageChannel</code> 安排一个<strong>新的宏任务</strong>。这意味着 <code>flushPassiveEffects</code> 函数的执行将发生在<strong>下一轮或更晚的事件循环</strong>中。</p>
</li>
</ol>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdf9961a4f674c04b9ae08aa2345164e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF5MQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767774327&amp;x-signature=HGubY30jEFfUM0K6GInc6TDc25M%3D" alt="8-2.png" loading="lazy"/></p>
<h3 data-id="heading-7">3.2<code>flushPassiveEffects</code> 的工作</h3>
<p>当浏览的那个宏任务时，<code>flushPassiveEffects</code> 函数才真正被调用。它的工作很简单，分为两步：</p>
<ol>
<li><strong>执行销毁函数</strong>：首先，遍器执行到 Scheduler 安排历所有在上一次渲染中注册的 <code>useEffect</code>，并执行它们的销毁函数（<code>cleanup</code>，即 <code>useEffect</code> 返回的那个函数）。</li>
<li><strong>执行回调函数</strong>：然后，遍历本次渲染中新注册的 <code>useEffect</code>，并执行它们的回调函数。</li>
</ol>
<h3 data-id="heading-8">3.3 总结：为什么是异步的？</h3>
<p>通过这个“提交 -&gt; 调度 -&gt; 异步执行”的模型，React 实现了 <code>useEffect</code> 的非阻塞特性：</p>
<ul>
<li><strong>保证渲染不被阻塞</strong>：DOM 更新和页面绘制（发生在当前事件循环的渲染阶段）与 <code>useEffect</code> 的执行被完全分离。即使用户在 <code>useEffect</code> 中编写了非常耗时的代码，也不会影响页面的首次呈现。</li>
<li><strong>获取最新的状态</strong>：由于 <code>useEffect</code> 在渲染和提交之后执行，它可以确保访问到最新的 DOM 状态和 React state。</li>
</ul>
<p>这个设计是 React 并发模式的基石之一，它将副作用的执行从关键的渲染路径中剥离，从而在根本上提升了应用的响应性能。</p>
<h2 data-id="heading-9">4.从源码中理解一次完整更新代码执行流程</h2>
<h3 data-id="heading-10">4.1 更新产生与入队</h3>
<p>当组件中调用 <code>setState</code> 时，React 会创建一个更新对象，为其分配一个 <code>Lane</code>（优先级车道），并将其入队。关键入口是 <code>scheduleUpdateOnFiber</code>，它负责将更新与 Fiber 关联，并确保根（root）被标记为待处理。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// c:\Users\48150\Desktop\新建文件夹 (8)\react-app\src\react\packages\react-reconciler\src\ReactFiberWorkLoop.js:848</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">scheduleUpdateOnFiber</span>(<span class="hljs-params">
  root: FiberRoot,
  fiber: Fiber,
  lane: Lane
</span>) {
  <span class="hljs-comment">// ...</span>
  <span class="hljs-title function_">markRootUpdated</span>(root, lane);
  <span class="hljs-comment">// ...</span>
  <span class="hljs-title function_">ensureRootIsScheduled</span>(root); <span class="hljs-comment">// 核心调度函数</span>
}
</code></pre>
<p><code>ensureRootIsScheduled</code> 的核心职责是：判断本次更新的优先级，并决定是以<strong>同步</strong>还是<strong>并发</strong>的方式来安排一次调度。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// c:\Users\48150\Desktop\新建文件夹 (8)\react-app\src\react\packages\react-reconciler\src\ReactFiberRootScheduler.js:109</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ensureRootIsScheduled</span>(<span class="hljs-params">root: FiberRoot</span>) {
  <span class="hljs-comment">// ...</span>
  <span class="hljs-keyword">const</span> newCallbackPriority = <span class="hljs-title function_">getHighestPriorityLane</span>(nextLanes);
  <span class="hljs-comment">// ...</span>
  <span class="hljs-keyword">if</span> (newCallbackPriority === <span class="hljs-title class_">SyncLane</span>) {
    <span class="hljs-comment">// 同步更新路径</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 并发更新路径</span>
    <span class="hljs-keyword">const</span> schedulerPriorityLevel =
      <span class="hljs-title function_">lanePriorityToSchedulerPriority</span>(newCallbackPriority);
    newCallbackNode = <span class="hljs-title function_">scheduleCallback</span>(
      schedulerPriorityLevel,
      performConcurrentWorkOnRoot.<span class="hljs-title function_">bind</span>(<span class="hljs-literal">null</span>, root)
    );
  }
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<ul>
<li>
<p><strong>同步路径</strong> (<code>SyncLane</code>): 对于 <code>flushSync</code> 或老版 React 中的同步更新，它会调用 <code>scheduleSyncCallback</code> 将 <code>performSyncWorkOnRoot</code> 函数推入一个同步队列，并安排一个<strong>微任务</strong> (<code>scheduleMicrotask</code>) 来冲刷这个队列。这意味着渲染会在当前事件循环的微任务阶段被同步执行，不会等待下一个宏任务。</p>
</li>
<li>
<p><strong>并发路径</strong> (其他 <code>Lane</code>): 对于普通更新，它会调用 Scheduler 的 <code>scheduleCallback</code> 方法，将 <code>performConcurrentWorkOnRoot</code> 函数作为一个任务交给 Scheduler 去处理。</p>
</li>
</ul>
<h3 data-id="heading-11">4.2 Scheduler 的宏任务调度与 workLoop</h3>
<p>当 Reconciler 通过 <code>scheduleCallback</code> 请求一次并发调度时，流程进入 Scheduler 模块。</p>
<p><strong>第一步：创建任务并入队</strong></p>
<p><code>scheduleCallback</code> 根据 Reconciler 传递的优先级，计算出任务的过期时间 <code>expirationTime</code>，然后创建一个 <code>task</code> 对象，并将其推入 <code>taskQueue</code> 这个最小堆中。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// c:\Users\48150\Desktop\新建文件夹 (8)\react-app\src\react\packages\scheduler\src\forks\Scheduler.js:331</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">unstable_scheduleCallback</span>(<span class="hljs-params">priorityLevel, callback, options</span>) {
  <span class="hljs-comment">// ... 计算 expirationTime</span>
  <span class="hljs-keyword">var</span> newTask = {
    <span class="hljs-attr">id</span>: taskIdCounter++,
    callback, <span class="hljs-comment">// 这里的 callback 就是 performConcurrentWorkOnRoot</span>
    priorityLevel,
    <span class="hljs-comment">// ...</span>
    expirationTime,
  };

  <span class="hljs-title function_">push</span>(taskQueue, newTask); <span class="hljs-comment">// 入队（最小堆）</span>

  <span class="hljs-comment">// 如果当前没有调度在进行，则请求一个宏任务</span>
  <span class="hljs-keyword">if</span> (!isHostCallbackScheduled &amp;&amp; !isPerformingWork) {
    isHostCallbackScheduled = <span class="hljs-literal">true</span>;
    <span class="hljs-title function_">requestHostCallback</span>(flushWork);
  }
  <span class="hljs-keyword">return</span> newTask;
}
</code></pre>
<p><strong>第二步：通过 <code>MessageChannel</code> 安排宏任务</strong></p>
<p><code>requestHostCallback</code> 的作用是安排一个<strong>宏任务</strong>来执行 <code>flushWork</code> 函数。它优先使用 <code>MessageChannel</code>，因为 <code>MessageChannel</code> 的回调属于宏任务，且没有 <code>setTimeout(0)</code> 的 4ms 延迟限制，可以尽快执行。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// c:\Users\48150\Desktop\新建文件夹 (8)\react-app\src\react\packages\scheduler\src\forks\Scheduler.js:532</span>
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">MessageChannel</span> !== <span class="hljs-string">"undefined"</span>) {
  <span class="hljs-keyword">const</span> channel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MessageChannel</span>();
  <span class="hljs-keyword">const</span> port = channel.<span class="hljs-property">port2</span>;
  channel.<span class="hljs-property">port1</span>.<span class="hljs-property">onmessage</span> = performWorkUntilDeadline;
  schedulePerformWorkUntilDeadline = <span class="hljs-function">() =&gt;</span> {
    port.<span class="hljs-title function_">postMessage</span>(<span class="hljs-literal">null</span>);
  };
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">requestHostCallback</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (!isMessageLoopRunning) {
    isMessageLoopRunning = <span class="hljs-literal">true</span>;
    <span class="hljs-title function_">schedulePerformWorkUntilDeadline</span>();
  }
}
</code></pre>
<p><em>注意：<code>requestHostCallback</code> 最终会调用 <code>schedulePerformWorkUntilDeadline</code>，其 <code>onmessage</code> 的处理函数是 <code>performWorkUntilDeadline</code>，<code>performWorkUntilDeadline</code> 内部会调用 <code>flushWork</code>，<code>flushWork</code> 内部再调用 <code>workLoop</code>。</em></p>
<p><strong>第三步：<code>workLoop</code> 执行任务</strong></p>
<p>当浏览器空闲下来，执行 <code>MessageChannel</code> 安排的宏任务时，<code>workLoop</code> 函数启动。它的核心逻辑是：</p>
<ol>
<li>从 <code>taskQueue</code>（最小堆）的堆顶 <code>peek</code> 一个任务。这个任务是当前所有任务中<strong>最紧急</strong>（<code>expirationTime</code> 最小）的。</li>
<li>检查这个任务是否过期，以及当前帧是否还有剩余时间 (<code>shouldYieldToHost</code>)。</li>
<li>如果可以执行，就执行任务的 <code>callback</code>，这个 <code>callback</code> 正是 Reconciler 传来的 <code>performConcurrentWorkOnRoot</code>。</li>
<li>执行完毕后，如果任务返回了一个新的函数（表示工作未完成），则将其放回队列。否则，将任务从队列中 <code>pop</code> 出。</li>
<li>循环此过程，直到时间切片用完或队列为空。</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// c:\Users\48150\Desktop\新建文件夹 (8)\react-app\src\react\packages\scheduler\src\forks\Scheduler.js:188</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">workLoop</span>(<span class="hljs-params">initialTime: number</span>) {
  <span class="hljs-keyword">let</span> currentTime = initialTime;
  currentTask = <span class="hljs-title function_">peek</span>(taskQueue); <span class="hljs-comment">// 从最小堆顶部取出最高优先级的任务</span>

  <span class="hljs-keyword">while</span> (currentTask !== <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">if</span> (currentTask.<span class="hljs-property">expirationTime</span> &gt; currentTime &amp;&amp; <span class="hljs-title function_">shouldYieldToHost</span>()) {
      <span class="hljs-comment">// 时间切片用完，让出主线程</span>
      <span class="hljs-keyword">break</span>;
    }
    <span class="hljs-keyword">const</span> callback = currentTask.<span class="hljs-property">callback</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">"function"</span>) {
      <span class="hljs-comment">// ...</span>
      <span class="hljs-keyword">const</span> continuationCallback = <span class="hljs-title function_">callback</span>(didUserCallbackTimeout); <span class="hljs-comment">// 执行任务</span>
      <span class="hljs-comment">// ...</span>
      <span class="hljs-keyword">if</span> (continuationCallback === <span class="hljs-literal">null</span>) {
        <span class="hljs-title function_">pop</span>(taskQueue); <span class="hljs-comment">// 任务完成，出队</span>
      }
    }
    <span class="hljs-comment">// ...</span>
    currentTask = <span class="hljs-title function_">peek</span>(taskQueue); <span class="hljs-comment">// 取下一个任务</span>
  }
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>至此，一次并发更新的调度流程完成，<code>performConcurrentWorkOnRoot</code> 被成功调用，正式进入了可中断的渲染阶段。</p>
<h3 data-id="heading-12">4.3 Commit 阶段与 Passive Effect 的重新调度</h3>
<p>当渲染阶段（<code>performConcurrentWorkOnRoot</code>）成功完成，并且 React 决定将更新提交到屏幕上时，就进入了不可中断的 Commit 阶段。这个阶段的核心函数是 <code>commitRoot</code>。</p>
<p><code>commitRoot</code> 负责执行所有真实的 DOM 操作和调用生命周期方法，它分为几个同步执行的子阶段，例如：</p>
<ul>
<li><strong>Mutation Effects</strong>：执行 DOM 的增、删、改。</li>
<li><strong>Layout Effects</strong>：同步执行 <code>useLayoutEffect</code> 的回调。</li>
</ul>
<p>在所有这些同步工作都完成后，<code>commitRoot</code> 并不会立即执行 <code>useEffect</code> 的回调。相反，它会检查是否存在 <code>Passive</code> 标记的 effect，如果存在，它会将一个名为 <code>flushPassiveEffects</code> 的函数<strong>重新调度</strong>给 Scheduler。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// c:\Users\48150\Desktop\新建文件夹 (8)\react-app\src\react\packages\react-reconciler\src\ReactFiberWorkLoop.js (simplified)</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">commitRoot</span>(<span class="hljs-params">root</span>) {
  <span class="hljs-comment">// ...</span>
  <span class="hljs-comment">// 执行 Mutation 和 Layout effects (同步)</span>
  <span class="hljs-comment">// ...</span>

  <span class="hljs-keyword">const</span> rootHasPassiveEffects = root.<span class="hljs-property">passiveEffects</span>;
  <span class="hljs-keyword">if</span> (rootHasPassiveEffects) {
    <span class="hljs-comment">// 如果存在 passive effects，将其作为一个新的低优先级任务调度</span>
    <span class="hljs-keyword">const</span> callback = flushPassiveEffects.<span class="hljs-title function_">bind</span>(<span class="hljs-literal">null</span>, root);
    <span class="hljs-title class_">Scheduler</span>_scheduleCallback(<span class="hljs-title class_">IdleSchedulerPriority</span>, callback);
  }

  <span class="hljs-comment">// ...</span>
  <span class="hljs-comment">// 提交阶段结束</span>
}

<span class="hljs-comment">// flushPassiveEffects 的大致实现</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">flushPassiveEffects</span>(<span class="hljs-params">root</span>) {
  <span class="hljs-comment">// 1. 调用 commitHookPassiveUnmountEffects (执行 useEffect 的销毁函数)</span>
  <span class="hljs-comment">// 2. 调用 commitHookPassiveMountEffects (执行 useEffect 的回调函数)</span>
}
</code></pre>
<p><strong>核心逻辑闭环：</strong></p>
<ol>
<li><strong>Effect 的异步调度</strong>：<code>commitRoot</code> 在同步完成 DOM 更新和 <code>useLayoutEffect</code> 后，并没有直接执行 <code>useEffect</code>。它调用 <code>Scheduler_scheduleCallback</code>，将 <code>flushPassiveEffects</code> 包装成一个<strong>空闲优先级</strong>（<code>IdleSchedulerPriority</code>）的任务，放回 Scheduler 的任务队列。</li>
<li><strong>宏任务执行</strong>：Scheduler 会在未来的某个时间点（通常是在浏览器完成当前帧的绘制、主线程进入空闲状态后）的<strong>新宏任务</strong>中，执行这个低优先级的 <code>flushPassiveEffects</code> 任务。</li>
<li><strong>最终回调</strong>：<code>flushPassiveEffects</code> 函数内部才会真正去执行 <code>useEffect</code> 的销毁和挂载回调。</li>
</ol>
<p>这种设计确保了 <code>useEffect</code> 中的代码（如网络请求、日志记录）不会影响到用户感知的渲染性能。</p>
<p>这个“提交 -&gt; 重新调度 -&gt; 异步执行”的闭环，说明<code>passive effect</code>（即 <code>useEffect</code>）正是通过与事件循环（宏任务）的交错执行，才实现了其不阻塞浏览器渲染的异步特性。从 <code>setState</code> 开始的更新，经过 Reconciler 和 Scheduler 的协同工作，最终在 Commit 阶段通过一次新的调度，完成了 <code>useEffect</code> 的异步回调，形成了一个完整的调度模型。</p>
<h2 data-id="heading-13">5.总结</h2>
<p>React 的 Effect 调度模型是其并发渲染架构的核心组成部分，它通过 Lane 优先级模型、Scheduler 时间切片、passive effect 异步调度，实现了与浏览器事件循环的深度协同，解决了传统同步渲染中主线程阻塞、用户体验差的问题。</p>
<p>从底层原理来看，React 以 “用户体验为核心”，通过精细化的任务优先级管理与协作式调度，将更新任务与副作用在事件循环的微任务、宏任务队列中合理编排，既保证了高优先级更新的即时性，又确保了低优先级副作用的非阻塞执行。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[限流方案]]></title>    <link>https://juejin.cn/post/7589830701614268416</link>    <guid>https://juejin.cn/post/7589830701614268416</guid>    <pubDate>2025-12-31T08:41:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589830701614268416" data-draft-id="7589822564778950671" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="限流方案"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2025-12-31T08:41:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小肥宅仙女"/> <meta itemprop="url" content="https://juejin.cn/user/2124677778769838"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            限流方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2124677778769838/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小肥宅仙女
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:41:01.000Z" title="Wed Dec 31 2025 08:41:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">一、核心概念：动态限流</h2>
<h3 data-id="heading-1">1.1 为什么需要动态限流？</h3>
<p>静态限流策略在面对复杂多变的流量场景时往往力不从心。动态限流的价值在于：</p>
<ul>
<li><strong>适应性</strong>：根据实时系统负载动态调整限流参数</li>
<li><strong>灵活性</strong>：不同业务场景采用不同的限流策略</li>
<li><strong>资源优化</strong>：最大化系统资源利用率，避免过度限流或保护不足</li>
</ul>
<h3 data-id="heading-2">1.2 动态限流实现方式</h3>
<p>yaml</p>
<pre><code class="hljs language-markdown" lang="markdown">实现机制：
<span class="hljs-bullet">  1.</span> 监控指标采集：CPU使用率、内存占用、接口响应时间、队列长度等
<span class="hljs-bullet">  2.</span> 策略调整：基于监控数据动态调整令牌生成速率、窗口大小等参数
<span class="hljs-bullet">  3.</span> 反馈控制：根据系统状态形成闭环控制回路
</code></pre>
<h2 data-id="heading-3">二、分布式系统中的限流算法演进</h2>
<h3 data-id="heading-4">2.1 算法类型对比</h3>





























<table><thead><tr><th>算法类型</th><th>代表算法</th><th>适用场景</th><th>优势</th></tr></thead><tbody><tr><td>去中心化算法</td><td>分布式令牌桶、Gossip协同</td><td>分布式系统全局限流</td><td>避免中心节点瓶颈</td></tr><tr><td>混合型算法</td><td>令牌+漏桶、SmoothWarmUp</td><td>需要平衡灵活性与稳定性</td><td>兼顾流量整形和突发处理</td></tr><tr><td>自适应算法</td><td>反馈式限流、队列长度限流</td><td>复杂多变的流量场景</td><td>基于系统状态智能调整</td></tr></tbody></table>
<h2 data-id="heading-5">三、流量路径全链路限流解析</h2>
<h3 data-id="heading-6">3.1 完整流量路径与限流节点</h3>
<h3 data-id="heading-7">3.2 各节点限流职责详解</h3>
<h4 data-id="heading-8">❶ CDN（内容分发网络）</h4>
<ul>
<li>
<p><strong>核心功能</strong>：就近分发静态资源，减轻源站压力</p>
</li>
<li>
<p><strong>限流维度</strong>：</p>
<ul>
<li>单IP请求频率</li>
<li>缓存失效时间控制</li>
<li>地域带宽限制</li>
</ul>
</li>
<li>
<p><strong>防护重点</strong>：防止缓存穿透冲击源站</p>
</li>
</ul>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caf6794ae9674ee595561c4a477e07cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6IKl5a6F5LuZ5aWz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767775261&amp;x-signature=hIbOLiU36e31zFlt0fBufZJUSts%3D" alt="deepseek_mermaid_20250807_038022.png" width="70%" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae74d3ff145e4f1693591c98a34b16f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6IKl5a6F5LuZ5aWz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767775261&amp;x-signature=SR5NNGBlDp0R09W9DttVT1LWZeY%3D" alt="deepseek_mermaid_20250807_03ecd6.png" width="70%" loading="lazy"/>
<h4 data-id="heading-9">❷ 负载均衡器（网络层入口）</h4>
<ul>
<li>
<p><strong>架构选择</strong>：</p>
<ul>
<li>四层LB（LVS）：传输层TCP/IP，适合高并发连接</li>
<li>七层LB（Nginx）：应用层HTTP，支持精细化路由</li>
<li>混合架构：LVS + Nginx应对超大规模流量</li>
</ul>
</li>
<li>
<p><strong>限流能力</strong>：</p>
<ul>
<li>全局流量/带宽峰值限制</li>
<li>单IP连接资源限制（并发连接数、带宽）</li>
<li>防护网络层攻击（DDoS）</li>
</ul>
</li>
</ul>
<h4 data-id="heading-10">❸ API网关（业务层入口）</h4>
<ul>
<li>
<p><strong>业务过滤</strong>：基于HTTP信息的精细化限流</p>
</li>
<li>
<p><strong>限流维度</strong>：</p>
<ul>
<li>接口路径限流</li>
<li>用户身份（IP、Token）</li>
<li>请求参数（如秒杀商品ID）</li>
<li>业务优先级控制</li>
</ul>
</li>
</ul>
<h4 data-id="heading-11">❹ 应用服务器（业务处理节点）</h4>
<ul>
<li>
<p><strong>保护重点</strong>：服务器自身资源</p>
</li>
<li>
<p><strong>限流方式</strong>：</p>
<ul>
<li>业务代码级限流（分布式限流）</li>
<li>资源限制（线程池、数据库连接池）</li>
<li>本地接口QPS控制</li>
</ul>
</li>
</ul>
<h4 data-id="heading-12">❺ 数据库/缓存（数据存储层）</h4>
<ul>
<li>
<p><strong>系统瓶颈</strong>：最终的性能瓶颈点</p>
</li>
<li>
<p><strong>限流策略</strong>：</p>
<ul>
<li>最大连接数限制</li>
<li>查询频率控制</li>
<li>特定SQL执行频率限制</li>
</ul>
</li>
</ul>
<h2 data-id="heading-13">四、Nginx限流配置实战</h2>
<h3 data-id="heading-14">4.1 基础限流配置</h3>
<h4 data-id="heading-15">① 限制请求频率（基于接口/IP）</h4>
<p><strong>基于接口业务限流：</strong></p>
<pre><code class="hljs language-bash" lang="bash">下单接口 为 核心接口：限制 每秒最多 50 次请求。允许 10 个 突发请求，避免瞬间流量峰值被全部拦截。。
正常流量（≤50r/s）：所有请求 正常转发到 订单服务。
流量峰值（如 60r/s）：短时间内允许 60r/s 的突发请求。超过 60 次的请求返回 429。
</code></pre>
<p>nginx</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 定义 接口限流区域&amp;限流规则：以请求URI为key，限制每秒50次请求。</span>
limit_req_zone $request_uri <span class="hljs-attr">zone</span>=order_create:<span class="hljs-number">10</span>m rate=<span class="hljs-number">50</span>r/s<span class="hljs-comment">;</span>
<span class="hljs-comment"># zone=order_create:10m 	限流区域：名字 &amp; 限流区域大小。</span>
  <span class="hljs-comment"># 存储以 $request_uri 为 key 的限流状态数据。</span>
  <span class="hljs-comment"># 如：每个 URI 的请求计数器、最近一次请求时间等。</span>
<span class="hljs-comment"># rate=50r/s 							每秒最多50次请求。</span>

server {
  listen 80<span class="hljs-comment">;</span>
  server_name api.myshop.com<span class="hljs-comment">;</span>

  <span class="hljs-comment"># 下单接口：限流规则</span>
  location /api/order/create {
    <span class="hljs-comment"># 应用order_create限流区域</span>
    limit_req <span class="hljs-attr">zone</span>=order_create burst=<span class="hljs-number">10</span> nodelay<span class="hljs-comment">;</span>
    <span class="hljs-comment"># burst=10 	允许10个突发请求（超过50r/s时，最多额外处理10个）。</span>
    <span class="hljs-comment"># nodelay 	突发请求不排队，直接处理（避免用户等待）。</span>

    <span class="hljs-comment"># 限流后返回429状态码（默认也是429，可自定义）</span>
    limit_req_status 429<span class="hljs-comment">;</span>
    
    <span class="hljs-comment"># 自定义限流提示页面</span>
    error_page 429 /error/too_many_requests.html<span class="hljs-comment">;</span>

    <span class="hljs-comment"># 转发到后端订单服务</span>
    proxy_pass http://order_service<span class="hljs-comment">;</span>
    proxy_set_header Host $host<span class="hljs-comment">;</span>
    proxy_set_header X-Real-IP $remote_addr<span class="hljs-comment">;</span>
  }

  <span class="hljs-comment"># 静态资源：限流提示页面</span>
  location /error/ {
    root /usr/share/nginx/html<span class="hljs-comment">;</span>
  }
}
</code></pre>
<p><strong>基于IP的动态限流：</strong></p>
<p>nginx</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 定义 映射关系：客户端IP（$remote_addr）映射为 新变量$comment_limit_key。</span>
<span class="hljs-comment"># 动态区分 内/外IP：内部IP 不参与限流（key为空）。外部IP 以IP为限流key。</span>
map <span class="hljs-variable">$remote_addr</span> <span class="hljs-variable">$comment_limit_key</span> {
  default <span class="hljs-variable">$remote_addr</span>;  <span class="hljs-comment"># 外部IP：以IP为 限流key。</span>
  192.168.1.0/24 <span class="hljs-string">""</span>;     <span class="hljs-comment"># 内部IP：不参与限流（key为空）。</span>
}

<span class="hljs-comment"># 定义 评论接口限流区域&amp;规则：基于IP，每秒5次请求</span>
limit_req_zone <span class="hljs-variable">$comment_limit_key</span> zone=comment_limit:10m rate=5r/s;

server {
  listen 80;
  server_name api.myshop.com;

  <span class="hljs-comment"># 评论 接口限流（基于IP）</span>
  location /api/comment/add {
    limit_req zone=comment_limit burst=3 nodelay;  <span class="hljs-comment"># 单IP最多5+3=8次/秒</span>
    proxy_pass http://comment_service;
  }
}
</code></pre>
<h4 data-id="heading-16">② 限制并发连接数</h4>
<p>nginx</p>
<pre><code class="hljs language-ini" lang="ini">http {
    <span class="hljs-comment"># 定义并发连接限制区域</span>
    limit_conn_zone $proxy_host <span class="hljs-attr">zone</span>=backend_conn:<span class="hljs-number">10</span>m<span class="hljs-comment">;</span>
    limit_conn_zone $remote_addr <span class="hljs-attr">zone</span>=per_ip_conn:<span class="hljs-number">10</span>m<span class="hljs-comment">;</span>

    server {
        location /api/order {
            limit_conn backend_conn 200<span class="hljs-comment">;    # 业务总并发200</span>
            limit_conn per_ip_conn 10<span class="hljs-comment">;      # 单IP并发10</span>
            limit_conn_status 503<span class="hljs-comment">;</span>
            
            proxy_pass http://order_server<span class="hljs-comment">;</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-17">4.2 高级限流策略</h3>
<h4 data-id="heading-18">③ 多接口差异化限流</h4>
<p>nginx</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 不同接口配置不同限流策略</span>
limit_req_zone $request_uri <span class="hljs-attr">zone</span>=login_limit:<span class="hljs-number">10</span>m rate=<span class="hljs-number">10</span>r/s<span class="hljs-comment">;</span>
limit_req_zone $request_uri <span class="hljs-attr">zone</span>=goods_list_limit:<span class="hljs-number">10</span>m rate=<span class="hljs-number">200</span>r/s<span class="hljs-comment">;</span>
limit_req_zone $request_uri <span class="hljs-attr">zone</span>=pay_limit:<span class="hljs-number">10</span>m rate=<span class="hljs-number">30</span>r/s<span class="hljs-comment">;</span>

location /api/user/login {
    limit_req <span class="hljs-attr">zone</span>=login_limit burst=<span class="hljs-number">5</span> nodelay<span class="hljs-comment">;      # 登录接口</span>
    proxy_pass http://user_service<span class="hljs-comment">;</span>
}

location /api/goods/list {
    limit_req <span class="hljs-attr">zone</span>=goods_list_limit burst=<span class="hljs-number">50</span> nodelay<span class="hljs-comment">; # 商品列表接口</span>
    proxy_pass http://goods_service<span class="hljs-comment">;</span>
}

location /api/pay {
    limit_req <span class="hljs-attr">zone</span>=pay_limit burst=<span class="hljs-number">5</span> nodelay<span class="hljs-comment">;        # 支付接口</span>
    proxy_pass http://pay_service<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-19">④ 限流与缓存结合优化</h4>
<pre><code class="hljs language-bash" lang="bash">❶ 缓存命中时：返回缓存数据。不请求后端，也不占用限流配额。响应时间从 200ms 降至 10ms。
❷ 缓存未命中：限流为 120r/s（100+20）。避免被高频请求击垮。
</code></pre>
<p>nginx</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 商品详情接口：限流+缓存组合策略</span>
limit_req_zone $request_uri <span class="hljs-attr">zone</span>=goods_detail_limit:<span class="hljs-number">10</span>m rate=<span class="hljs-number">100</span>r/s<span class="hljs-comment">;</span>

proxy_cache_path /var/cache/nginx/goods_cache
    <span class="hljs-attr">levels</span>=<span class="hljs-number">1</span>:<span class="hljs-number">2</span>
    <span class="hljs-attr">keys_zone</span>=goods_cache:<span class="hljs-number">100</span>m
    <span class="hljs-attr">max_size</span>=<span class="hljs-number">10</span>g
    <span class="hljs-attr">inactive</span>=<span class="hljs-number">30</span>m
    <span class="hljs-attr">use_temp_path</span>=<span class="hljs-literal">off</span><span class="hljs-comment">;</span>

location /api/goods/detail {
    <span class="hljs-comment"># 缓存配置</span>
    proxy_cache goods_cache<span class="hljs-comment">;</span>
    proxy_cache_key $request_uri<span class="hljs-comment">;</span>
    proxy_cache_valid 200 1h<span class="hljs-comment">;</span>
    
    <span class="hljs-comment"># 限流配置（仅未命中缓存时生效）</span>
    limit_req <span class="hljs-attr">zone</span>=goods_detail_limit burst=<span class="hljs-number">20</span> nodelay<span class="hljs-comment">;</span>
    proxy_pass http://goods_service<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-20">五、优先级限流：业务价值的守护者</h2>
<h3 data-id="heading-21">5.1 优先级限流核心思想</h3>
<blockquote>
<p><strong>关键认知</strong>：</p>
<ol>
<li><strong>流量不平等原则</strong>：不同业务请求具有不同的价值权重</li>
<li><strong>延迟处理策略</strong>：非关键请求可以适当延迟，释放资源给高优先级请求</li>
<li><strong>动态调整机制</strong>：限流策略需要根据系统状态实时调整</li>
</ol>
</blockquote>
<h3 data-id="heading-22">5.2 优先级限流架构设计</h3>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcce07529e4a4f1fa4057d35feff2b66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6IKl5a6F5LuZ5aWz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767775261&amp;x-signature=BHwsGySQONOT%2FPNxeduojsV0td8%3D" alt="image (3).png" width="70%" loading="lazy"/>
<p><strong>工作流程：</strong></p>
<ol>
<li><strong>请求分类器</strong>：根据业务规则为请求打上优先级标签</li>
<li><strong>优先级队列</strong>：不同优先级请求进入不同队列</li>
<li><strong>资源调度器</strong>：优先处理高优先级队列的请求</li>
<li><strong>动态调整器</strong>：根据系统负载动态调整各队列的处理速率</li>
</ol>
<h3 data-id="heading-23">图解工作流：</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9eeb6696bc3d4989a3e92a26d6c399b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6IKl5a6F5LuZ5aWz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767775261&amp;x-signature=AD29MJTroy5wkUkGqbCRTWRuoJk%3D" alt="deepseek_mermaid_20250811_c5a517.png" loading="lazy"/></p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67b59dbc744645b69b344fef2e42c5a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6IKl5a6F5LuZ5aWz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767775261&amp;x-signature=%2Fdz7Rskmu9rbPoTerSKzG4o9Ji8%3D" alt="deepseek_mermaid_20250811_be00cf.png" width="70%" loading="lazy"/>
<h3 data-id="heading-24">5.3 生产环境应用示例</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c7c5128e5b74e988303b7c0eb0f2dcd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6IKl5a6F5LuZ5aWz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767775261&amp;x-signature=33O%2BjFL%2F3CCifVhA4j5A5ow0Pxk%3D" alt="deepseek_mermaid_20250811_cc754a.png" loading="lazy"/>
<strong>配置示例：</strong></p>
<p>nginx</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 定义不同优先级的限流区域</span>
limit_req_zone <span class="hljs-variable">$priority_key</span> zone=high_priority:10m rate=1000r/s;
limit_req_zone <span class="hljs-variable">$priority_key</span> zone=medium_priority:10m rate=500r/s;
limit_req_zone <span class="hljs-variable">$priority_key</span> zone=low_priority:10m rate=100r/s;

<span class="hljs-comment"># 根据请求特征设置优先级</span>
map <span class="hljs-variable">$http_x_priority</span> <span class="hljs-variable">$priority_zone</span> {
    <span class="hljs-string">"high"</span>    <span class="hljs-string">"high_priority"</span>;
    <span class="hljs-string">"medium"</span>  <span class="hljs-string">"medium_priority"</span>;
    <span class="hljs-string">"low"</span>     <span class="hljs-string">"low_priority"</span>;
    default   <span class="hljs-string">"medium_priority"</span>;
}

location /api/ {
    <span class="hljs-comment"># 动态选择限流区域</span>
    <span class="hljs-built_in">set</span> <span class="hljs-variable">$priority_key</span> <span class="hljs-variable">$remote_addr</span>:<span class="hljs-variable">$priority_zone</span>;
    limit_req zone=<span class="hljs-variable">$priority_zone</span> burst=50 nodelay;
    
    <span class="hljs-comment"># 根据优先级设置超时时间</span>
    proxy_connect_timeout 5s;
    proxy_read_timeout 10s;
    
    proxy_pass http://backend_service;
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从一行好奇的代码说起：Vue怎么没有React的props.children]]></title>    <link>https://juejin.cn/post/7589828902157467698</link>    <guid>https://juejin.cn/post/7589828902157467698</guid>    <pubDate>2025-12-31T08:37:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589828902157467698" data-draft-id="7589639203091628058" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从一行好奇的代码说起：Vue怎么没有React的props.children"/> <meta itemprop="keywords" content="前端,Vue.js,React.js"/> <meta itemprop="datePublished" content="2025-12-31T08:37:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雲墨款哥"/> <meta itemprop="url" content="https://juejin.cn/user/1532054877506011"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从一行好奇的代码说起：Vue怎么没有React的props.children
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1532054877506011/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雲墨款哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:37:45.000Z" title="Wed Dec 31 2025 08:37:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>最近在学习 React 的过程中，我发现了一个有趣的特性：父子组件间的 <code>props.children</code> 传递。这让我不禁思考：Vue 中是否也有类似的功能？</p>
<h2 data-id="heading-1">React 中的 Children 传递</h2>
<h3 data-id="heading-2">基础示例</h3>
<p>先来看一个简单的父子组件示例：</p>
<p><strong>父组件 App.tsx</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Son</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./study/Son.tsx'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">Son</span> <span class="hljs-attr">message</span>=<span class="hljs-string">{</span>'<span class="hljs-attr">this</span> <span class="hljs-attr">is</span> <span class="hljs-attr">a</span> <span class="hljs-attr">reactApp</span>'}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>this is a span<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">Son</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>
</code></pre>
<p><strong>子组件 Son.tsx</strong></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Son</span>(<span class="hljs-params">props: <span class="hljs-built_in">any</span></span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(props);
    
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{props.message}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Son</span>;
</code></pre>
<h3 data-id="heading-3">这是如何工作的？</h3>
<p>通过控制台的输出内容可以看到，在 React 中，当你在组件标签内部放置内容时，这些内容会作为 <code>props.children</code> 传递给子组件。这是一个非常强大的特性，它允许组件作为容器来包裹其他组件或元素。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/569ea12f0abc403ea463c2654adbc265~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuy5aKo5qy-5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767775064&amp;x-signature=LWKv8W2iCExPp0eZ2wvPz30XMp8%3D" alt="3ae12ef1-f807-487c-ab57-7bf1482f1838.png" loading="lazy"/></p>
<p>所以，在子组件中，只要使用props.children就可以把它显示出来。：</p>
<h2 data-id="heading-4">Vue 中的类似功能</h2>
<p>在我的认知中，Vue 似乎不能这样写？实际上，Vue 也有类似的功能，但语法不同：</p>
<p><strong>Vue 3 中的插槽 (Slots)</strong></p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 父组件 --&gt;
&lt;template&gt;
  &lt;Son message="this is a vue app"&gt;
    &lt;span&gt;this is a span&lt;/span&gt;
  &lt;/Son&gt;
&lt;/template&gt;

&lt;!-- 子组件 Son.vue --&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;div&gt;{{ message }}&lt;/div&gt;
    &lt;slot&gt;&lt;/slot&gt; &lt;!-- 这里会渲染父组件传递的内容 --&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
defineProps(['message'])
&lt;/script&gt;
</code></pre>
<p>Vue 使用 <code>&lt;slot&gt;</code> 元素来接收父组件传递的内容，而 React 使用 <code>props.children</code>。两者语法不同，概念相似，但也有一些区别的。</p>
<h2 data-id="heading-5">props.children 与 slot 的本质差异</h2>
<h3 data-id="heading-6">React 的逻辑：数据驱动，责任自负</h3>
<p>在 React 中，当父组件这样写：</p>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">Son</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>我是内容<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">Son</span>&gt;
</code></pre>
<p>实际上被转译成：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title class_">Son</span>, {
  <span class="hljs-attr">children</span>: <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'span'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'我是内容'</span>)
})
</code></pre>
<p><strong>关键点</strong>：</p>
<ol>
<li><strong>数据已经送达</strong>：子组件无论如何都能在 <code>props.children</code> 中访问到这个 <code>&lt;span&gt;</code> 元素</li>
<li><strong>处理权完全在子组件</strong>：子组件可以选择渲染、修改、忽略，甚至把它放到别的地方</li>
<li><strong>无法"拒绝接收"</strong> ：这份数据（React 元素引用）已经作为参数传递给了子组件函数</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// 子组件可以有各种处理方式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Son</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-comment">// 1. 正常渲染</span>
  <span class="hljs-comment">// return &lt;div&gt;{props.children}&lt;/div&gt;</span>
  
  <span class="hljs-comment">// 2. 包装后再渲染</span>
  <span class="hljs-comment">// return &lt;div className="wrapper"&gt;{props.children}&lt;/div&gt;</span>
  
  <span class="hljs-comment">// 3. 有条件地渲染</span>
  <span class="hljs-comment">// return props.show ? props.children : null</span>
  
  <span class="hljs-comment">// 4. 拆分处理</span>
  <span class="hljs-comment">// const childrenArray = React.Children.toArray(props.children)</span>
  <span class="hljs-comment">// return childrenArray.map(child =&gt; &lt;div className="item"&gt;{child}&lt;/div&gt;)</span>
  
  <span class="hljs-comment">// 5. 完全忽略</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>我不需要 children<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<h3 data-id="heading-7">Vue 的逻辑：模板驱动，需要显式声明</h3>
<h3 data-id="heading-8">现象观察</h3>
<p><strong>父组件</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;Son message="Hello"&gt;
    &lt;span class="important"&gt;我是重要内容！&lt;/span&gt;
  &lt;/Son&gt;
&lt;/template&gt;
</code></pre>
<p><strong>子组件</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 情况1：有 slot 签收 --&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;div&gt;{{ message }}&lt;/div&gt;
    &lt;slot&gt;&lt;/slot&gt; &lt;!-- span 会被渲染 --&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;!-- 情况2：没有 slot 签收 --&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;div&gt;{{ message }}&lt;/div&gt;
    &lt;!-- 没有 slot，span 就像不存在一样 --&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<p>在 Vue 中：</p>
<ol>
<li><strong>编译时处理</strong>：Vue 在编译阶段处理插槽内容</li>
<li><strong>需要显式签收</strong>：只有在子组件模板中写了 <code>&lt;slot&gt;</code>，内容才会被渲染</li>
<li><strong>未签收就丢弃</strong>：如果没有 <code>&lt;slot&gt;</code>，内容在渲染阶段就被丢弃了</li>
</ol>
<p><strong>代码背后的逻辑</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue 在编译时决定是否包含插槽内容</span>
<span class="hljs-comment">// 如果子组件没有 slot，父组件的内容就不会被包含在渲染函数中</span>
</code></pre>
<ul>
<li><strong>插槽是模板特性</strong>：slot 是模板语法的一部分</li>
<li><strong>编译时决策</strong>：在编译阶段决定是否包含内容</li>
<li><strong>更安全的默认行为</strong>：防止意外渲染</li>
</ul>
<h3 data-id="heading-9">React 的优势与风险</h3>
<p><strong>优势</strong>：</p>
<ol>
<li><strong>灵活性极高</strong>：可以任意操作 children</li>
<li><strong>模式多样</strong>：支持 render props、HOC 等模式</li>
<li><strong>运行时控制</strong>：可以在运行时动态决定如何处理</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// React 的灵活模式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Toggle</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> [isOn, setIsOn] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setIsOn(!isOn)}&gt;
        Toggle
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      {/* 运行时决定渲染哪个 child */}
      {isOn ? children : null}
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p><strong>风险</strong>：</p>
<ol>
<li><strong>可能浪费资源</strong>：即使不渲染，children 也被创建和传递</li>
<li><strong>需要更多注意</strong>：必须显式处理，否则可能意外遗漏</li>
</ol>
<h3 data-id="heading-10">Vue 的优势与局限</h3>
<p><strong>优势</strong>：</p>
<ol>
<li><strong>性能优化</strong>：未使用的插槽内容不会被包含</li>
<li><strong>更安全</strong>：不会意外渲染未声明的内容</li>
<li><strong>模板清晰</strong>：在模板中明确显示插槽位置</li>
</ol>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Vue 3 组合式 API 中 --&gt;
&lt;script setup&gt;
// 可以访问 slots
import { useSlots } from 'vue'

const slots = useSlots()
// 检查是否有某个插槽内容
const hasHeader = slots.header
&lt;/script&gt;
</code></pre>
<p><strong>局限</strong>：</p>
<ol>
<li><strong>灵活性较低</strong>：操作插槽内容不如 React 灵活</li>
<li><strong>模板限制</strong>：必须在模板中声明插槽位置</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SeeDance Videos Generation API 对接说明]]></title>    <link>https://juejin.cn/post/7589822564779147279</link>    <guid>https://juejin.cn/post/7589822564779147279</guid>    <pubDate>2025-12-31T08:43:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589822564779147279" data-draft-id="7589830701614252032" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SeeDance Videos Generation API 对接说明"/> <meta itemprop="keywords" content="API"/> <meta itemprop="datePublished" content="2025-12-31T08:43:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="崔庆才丨静觅"/> <meta itemprop="url" content="https://juejin.cn/user/1521379821230269"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SeeDance Videos Generation API 对接说明
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1521379821230269/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    崔庆才丨静觅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:43:14.000Z" title="Wed Dec 31 2025 08:43:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文将介绍一种 SeeDance Videos Generation API 对接说明，它是可以通过输入自定义参数来生成SeeDance官方的视频。</p>
<h2 data-id="heading-0">申请流程</h2>
<p>要使用 API，需要先到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.acedata.cloud%2Fdocuments%2Fseedance-videos" target="_blank" title="https://platform.acedata.cloud/documents/seedance-videos" ref="nofollow noopener noreferrer">SeeDance Videos Generation API</a> 对应页面申请对应的服务，进入页面之后，点击「Acquire」按钮，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77913bd16c6442349d7b698e92340dd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767775393&amp;x-signature=V%2Bhh8nELfcznV8ujOcs9dY%2B4sgA%3D" alt="" loading="lazy"/></p>
<p>如果你尚未登录或注册，会自动跳转到登录页面邀请您来注册和登录，登录注册之后会自动返回当前页面。</p>
<p>在首次申请时会有免费额度赠送，可以免费使用该 API。</p>
<h2 data-id="heading-1">基本使用</h2>
<p>首先先了解下基本的使用方式，就是输入提示词 <code>content.text</code>、类型<code>content.type=text</code> 以及模型 <code>model</code>，便可获得处理后的结果，具体的内容如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e606686a01bf4feabcebb487d74491d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767775393&amp;x-signature=%2B%2FUVScPkgMlak9UUhR3JDNX6%2FcA%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>可以看到这里我们设置了 Request Headers，包括：</p>
<ul>
<li><code>accept</code>：想要接收怎样格式的响应结果，这里填写为 <code>application/json</code>，即 JSON 格式。</li>
<li><code>authorization</code>：调用 API 的密钥，申请之后可以直接下拉选择。</li>
</ul>
<p>另外设置了 Request Body，包括：</p>
<ul>
<li><code>model</code>：生成视频的模型，主要有<code>doubao-seedance-1-0-pro-250528</code>、<code>doubao-seedance-1-0-pro-fast-251015</code>,<code>doubao-seedance-1-5-pro-251215</code>,<code>doubao-seedance-1-0-lite-t2v-250428</code>,<code>doubao-seedance-1-0-lite-i2v-250428</code></li>
<li><code>context</code>：content的type可以是text，也可以是image_url, image_url支持图片链接和base64数组两种，image_url和text参数互斥。</li>
<li><code>service_tier</code>：有<code>default</code>和<code>flex</code>两种。</li>
<li><code>return_last_frame</code>：是否返回最后一帧</li>
<li><code>execution_expires_after</code>：执行超时时间。</li>
<li><code>callback_url</code>：需要回调结果的URL。</li>
</ul>
<p>选择之后，可以发现右侧也生成了对应代码，如图所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2966053943eb43618874dd3bba3794bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bSU5bqG5omN5Lio6Z2Z6KeF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767775393&amp;x-signature=6o7b%2Be6pEiz85CamQX%2B7xDz47f8%3D" width="500" class="m-auto" loading="lazy"/></p>
<p>点击「Try」按钮即可进行测试，如上图所示，这里我们就得到了如下结果：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ec22ae22-0140-4033-8c86-a48b536da595"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1cc87db0-8ee5-4436-969b-35cc571a9fd5"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cgt-20251222005129-62fhb"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/seedance/f592800a-b87c-4705-8796-cbb8018cae35.mp4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao-seedance-1-0-pro-250528"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>返回结果一共有多个字段，介绍如下：</p>
<ul>
<li><code>success</code>，此时视频生成任务的状态情况。</li>
<li><code>task_id</code>，此时视频生成任务ID。</li>
<li><code>trace_id</code>，此时视频生成跟踪ID。</li>
<li><code>data</code>，此时视频生成任务的结果列表。
<ul>
<li><code>task_id</code>，此时视频生成任务的服务器端ID。</li>
<li><code>video_url</code>，此时视频生成任务的视频链接。</li>
<li><code>status</code>，此时视频生成任务的状态。</li>
<li><code>model</code>，生成视频使用的模型。</li>
</ul>
</li>
</ul>
<p>可以看到我们得到了满意的视频信息，我们只需要根据结果中 <code>data</code> 的视频链接地址获取生成的SeeDance视频即可。</p>
<p>另外如果想生成对应的对接代码，可以直接复制生成，例如 CURL 的代码如下：</p>
<pre><code class="hljs language-shell" lang="shell">curl -X POST 'https://api.acedata.cloud/seedance/videos' \
-H 'authorization: Bearer ${bearer_token}' \
-H 'accept: application/json' \
-H 'content-type: application/json' \
-d '{
  "content": [{"text":"A kitten yawning at the camera. --rs 720p --rt 16:9 --dur 5 --fps 24 --wm true --seed 11 --cf false","type":"text"}],
  "model": "doubao-seedance-1-0-pro-250528"
}'
</code></pre>
<h2 data-id="heading-2">图生视频首帧</h2>
<p>如果想图生视频任务， 首先<code>context</code>参数需要选择<code>image_url</code>，并在其子节点<code>url</code>必须传入参考图片链接或者base64编码，请遵循此格式data:image/&lt;图片格式&gt;;base64,&lt;Base64编码&gt;，注意 &lt;图片格式&gt; 需小写，如 data:image/png;base64,{base64_image}，就可以指定如下内容：</p>
<ul>
<li>image_url：该图生视频任务采用的参考图链接。</li>
</ul>
<p>对应的代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/seedance/videos"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
    <span class="hljs-string">"content"</span>: [
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
            <span class="hljs-string">"image_url"</span>: {
                <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://ark-project.tos-cn-beijing.volces.com/doc_image/i2v_foxrgirl.png"</span>
            }
        },
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-string">"text"</span>: <span class="hljs-string">"A girl holds a fox in her arms. She opens her eyes and gazes tenderly at the camera, while the fox affectionately holds her back. As the camera slowly pulls away, her hair is gently blown by the wind. --ratio adaptive  --dur 5"</span>
        }
    ],
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"doubao-seedance-1-0-pro-250528"</span>
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dc7cceb5-3c12-4de7-a5f4-abcbba3e8e39"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"b3b09de3-b7fa-4bb0-88b5-aad4b4a96fd4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cgt-20251222072003-x2259"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/seedance/6afb78b8-5ba8-424f-adcd-69423a700b50.mp4"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao-seedance-1-0-pro-250528"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到，生成的效果是图生建视频的，结果与上文类似。</p>
<h2 data-id="heading-3">图生视频首尾帧</h2>
<p>如果想图生视频首尾帧， 首先参数<code>content</code>必须传入类型<code>image_url</code>,并且分别设置<code>role</code>为<code>first_frame</code>和<code>last_frame</code>，就可以指定如下内容：</p>
<ul>
<li>role：指定首帧或者尾帧。</li>
<li>image_url
<ul>
<li>url  图片链接
同时 <code>content</code> 还需要输入类型<code>text</code>作为prompt提示词</li>
</ul>
</li>
</ul>
<p>对应的代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests

url = <span class="hljs-string">"https://api.acedata.cloud/sora/videos"</span>

headers = {
    <span class="hljs-string">"accept"</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-string">"authorization"</span>: <span class="hljs-string">"Bearer {token}"</span>,
    <span class="hljs-string">"content-type"</span>: <span class="hljs-string">"application/json"</span>
}

payload = {
   <span class="hljs-string">"model"</span>: <span class="hljs-string">"doubao-seedance-1-0-pro-250528"</span>,
    <span class="hljs-string">"content"</span>: [
         {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-string">"text"</span>: <span class="hljs-string">"360-degree shot"</span>
        },
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
            <span class="hljs-string">"image_url"</span>: {
                <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://ark-project.tos-cn-beijing.volces.com/doc_image/seepro_first_frame.jpeg"</span>
            },
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"first_frame"</span>
        },
        {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"image_url"</span>,
            <span class="hljs-string">"image_url"</span>: {
                <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://ark-project.tos-cn-beijing.volces.com/doc_image/seepro_last_frame.jpeg"</span>
            },
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"last_frame"</span>
        }
    ]
}

response = requests.post(url, json=payload, headers=headers)
<span class="hljs-built_in">print</span>(response.text)
</code></pre>
<p>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f7096c6c-9430-4392-8201-d259632d7afd"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4a4a3721-00fb-43d2-aff2-3b516ac01a8a"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cgt-20251222073134-54qcw"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/seedance/95f9f5f0-fc50-4c71-bc6f-e154582c141e.mp4"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao-seedance-1-0-pro-250528"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到，生成的效果是角色生成视频，结果与上文类似。</p>
<h2 data-id="heading-4">异步回调</h2>
<p>由于 SeeDance Videos Generation API生成的时间相对较长，大约需要 1-2 分钟，如果 API 长时间无响应，HTTP 请求会一直保持连接，导致额外的系统资源消耗，所以本 API 也提供了异步回调的支持。</p>
<p>整体流程是：客户端发起请求的时候，额外指定一个 <code>callback_url</code> 字段，客户端发起 API 请求之后，API 会立马返回一个结果，包含一个 <code>task_id</code> 的字段信息，代表当前的任务 ID。当任务完成之后，生成视频的结果会通过 POST JSON 的形式发送到客户端指定的 <code>callback_url</code>，其中也包括了 <code>task_id</code> 字段，这样任务结果就可以通过 ID 关联起来了。</p>
<p>输入<code>callbacl_url</code>点击运行，可以发现会立即得到一个结果，如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f7096c6c-9430-4392-8201-d259632d7afd"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>当任务完成的时候，平台会将最后的结果以POST的形式推送到 <code>callback_url</code>的网址</p>
<p>内容如下：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"f7096c6c-9430-4392-8201-d259632d7afd"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4a4a3721-00fb-43d2-aff2-3b516ac01a8a"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"task_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cgt-20251222073134-54qcw"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"succeeded"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"video_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://platform.cdn.acedata.cloud/seedance/95f9f5f0-fc50-4c71-bc6f-e154582c141e.mp4"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"doubao-seedance-1-0-pro-250528"</span>
    <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>可以看到结果中有一个 <code>task_id</code> 字段，其他的字段都和上文类似，通过该字段即可实现任务的关联。</p>
<h2 data-id="heading-5">错误处理</h2>
<p>在调用 API 时，如果遇到错误，API 会返回相应的错误代码和信息。例如：</p>
<ul>
<li><code>400 token_mismatched</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>400 api_not_implemented</code>：Bad request, possibly due to missing or invalid parameters.</li>
<li><code>401 invalid_token</code>：Unauthorized, invalid or missing authorization token.</li>
<li><code>429 too_many_requests</code>：Too many requests, you have exceeded the rate limit.</li>
<li><code>500 api_error</code>：Internal server error, something went wrong on the server.</li>
</ul>
<h3 data-id="heading-6">错误响应示例</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"success"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"api_error"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"fetch failed"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trace_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2cf86e86-22a4-46e1-ac2f-032c0f2a4e89"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-7">结论</h2>
<p>通过本文档，您已经了解了如何使用 SeeDance Videos Generation API 可通过输入提示词以及参考图片来生成视频。希望本文档能帮助您更好地对接和使用该 API。如有任何问题，请随时联系我们的技术支持团队。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[文档对比算法的历史演进]]></title>    <link>https://juejin.cn/post/7589614866833833990</link>    <guid>https://juejin.cn/post/7589614866833833990</guid>    <pubDate>2025-12-31T08:46:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589614866833833990" data-draft-id="7589564203872469055" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="文档对比算法的历史演进"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2025-12-31T08:46:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿虎儿"/> <meta itemprop="url" content="https://juejin.cn/user/3394908210857901"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            文档对比算法的历史演进
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394908210857901/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿虎儿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:46:07.000Z" title="Wed Dec 31 2025 08:46:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读34分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">文档对比算法的历史演进全景图</h2>
<h3 data-id="heading-1">📊 总体演进脉络</h3>
<p>文档对比算法的发展经历了六个重要纪元，从最初的字符级精确匹配，逐步演进到如今的深度语义理解。这一演进过程反映了计算机科学在文本处理领域的重大突破。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">timeline
    title 文档对比算法历史演进
    1960s : 字符级精确匹配
          : 编辑距离
          : Hamming
    1970s : 序列/集合匹配
          : LCS/diff
          : Jaccard
    1990s : 统计向量空间模型
          : TF-IDF
          : BM25
    2000s : 哈希降维近似匹配
          : MinHash
          : SimHash
    2013 : 词向量分布式表示
         : Word2Vec
         : GloVe
    2017 : 预训练模型
         : Transformer
         : BERT
    2019+ : 语义检索
          : SBERT
          : Rerank
</code></pre>
<h4 data-id="heading-2">演进的核心维度变化</h4>



































<table><thead><tr><th>维度</th><th>早期算法</th><th>现代算法</th></tr></thead><tbody><tr><td><strong>匹配方式</strong></td><td>精确字符/词匹配</td><td>语义理解匹配</td></tr><tr><td><strong>处理规模</strong></td><td>小规模（KB级）</td><td>超大规模（TB级）</td></tr><tr><td><strong>可解释性</strong></td><td>完全透明</td><td>黑盒模型</td></tr><tr><td><strong>计算资源</strong></td><td>CPU即可</td><td>需要GPU加速</td></tr><tr><td><strong>训练依赖</strong></td><td>无需训练</td><td>需要大规模预训练</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-3">🏛️ 第一纪元：字符级精确匹配 (1960s-1970s)</h3>
<p>这一时期的算法关注的是字符级别的精确比对，主要解决"两个字符串有多不同"的问题。这些算法至今仍在拼写检查、DNA序列比对等领域广泛使用。</p>
<h4 data-id="heading-4">1.1 编辑距离家族</h4>
<p>编辑距离（Edit Distance）衡量的是将一个字符串转换为另一个字符串所需的最少操作次数。不同的编辑距离算法允许不同类型的操作。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph 编辑距离演化树
        H["&lt;b&gt;Hamming Distance&lt;/b&gt;&lt;br/&gt;1950&lt;br/&gt;仅替换操作&lt;br/&gt;要求等长字符串"]
        L["&lt;b&gt;Levenshtein Distance&lt;/b&gt;&lt;br/&gt;1965&lt;br/&gt;插入/删除/替换&lt;br/&gt;最经典的编辑距离"]
        DL["&lt;b&gt;Damerau-Levenshtein&lt;/b&gt;&lt;br/&gt;1964&lt;br/&gt;增加相邻字符转置&lt;br/&gt;更符合人类拼写错误"]
        NW["&lt;b&gt;Needleman-Wunsch&lt;/b&gt;&lt;br/&gt;1970&lt;br/&gt;带权重的全局比对&lt;br/&gt;生物信息学奠基"]
        JW["&lt;b&gt;Jaro-Winkler&lt;/b&gt;&lt;br/&gt;1989&lt;br/&gt;前缀加权匹配&lt;br/&gt;短字符串优化"]
        SW["&lt;b&gt;Smith-Waterman&lt;/b&gt;&lt;br/&gt;1981&lt;br/&gt;局部最优比对&lt;br/&gt;寻找相似片段"]
        
        H --&gt;|"扩展操作类型"| L
        L --&gt;|"增加转置"| DL
        L --&gt;|"引入权重"| NW
        DL --&gt;|"优化短串"| JW
        NW --&gt;|"局部化"| SW
    end
</code></pre>
<h5 data-id="heading-5">Hamming Distance (1950)</h5>
<p><strong>发明背景与痛点</strong>：由 Richard Hamming 在贝尔实验室发明，最初用于纠错码检测。早期通信系统传输数据时，需要快速检测传输错误；如何量化两个等长编码之间的差异程度；在纠错码设计中，如何确定最小汉明距离以保证纠错能力？</p>
<p><strong>核心思想</strong>：统计两个等长字符串在相同位置上不同字符的个数。</p>
<p><strong>优点</strong>：</p>
<ul>
<li>计算极其简单，时间复杂度 O(n)</li>
<li>适合固定长度编码的比较</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>只能处理等长字符串</li>
<li>无法处理插入和删除的情况</li>
</ul>
<p><strong>适用场景</strong>：错误检测码、DNA序列中的点突变检测</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">hamming_distance</span>(<span class="hljs-params">s1: <span class="hljs-built_in">str</span>, s2: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(s1) != <span class="hljs-built_in">len</span>(s2):
        <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"字符串长度必须相等"</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(c1 != c2 <span class="hljs-keyword">for</span> c1, c2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(s1, s2))

distance = hamming_distance(<span class="hljs-string">"1011101"</span>, <span class="hljs-string">"1001001"</span>)
<span class="hljs-built_in">print</span>(distance)  <span class="hljs-comment"># 输出: 2 (第2位和第4位不同)</span>
</code></pre>
<hr/>
<h5 data-id="heading-6">Levenshtein Distance (1965)</h5>
<p><strong>发明背景与痛点</strong>：由苏联数学家 Vladimir Levenshtein 提出，是最广泛使用的编辑距离。如何处理不等长字符串的相似度比较？拼写检查时，如何量化用户输入与正确单词的差异？如何找到将一个字符串转换为另一个字符串的最小操作步骤？在生物信息学中，如何衡量DNA序列的进化距离？</p>
<p><strong>核心思想</strong>：允许三种操作——插入、删除、替换，计算将字符串A转换为B的最少操作次数。</p>
<p><strong>算法复杂度</strong>：</p>
<ul>
<li>时间复杂度：O(m×n)</li>
<li>空间复杂度：O(m×n)，可优化至 O(min(m,n))</li>
</ul>
<p><strong>优点</strong>：</p>
<ul>
<li>通用性强，不限制字符串长度</li>
<li>结果直观，表示"需要几步修改"</li>
<li>可以回溯得到具体的编辑路径</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>二次时间复杂度，不适合超长文本</li>
<li>不考虑转置操作（typo中常见）</li>
</ul>
<p><strong>适用场景</strong>：拼写检查、模糊搜索、DNA序列比对</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">levenshtein_distance</span>(<span class="hljs-params">s1: <span class="hljs-built_in">str</span>, s2: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    m, n = <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">len</span>(s2)
    dp = [[<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>)]
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>):
        dp[i][<span class="hljs-number">0</span>] = i
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>):
        dp[<span class="hljs-number">0</span>][j] = j
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, m + <span class="hljs-number">1</span>):
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):
            <span class="hljs-keyword">if</span> s1[i-<span class="hljs-number">1</span>] == s2[j-<span class="hljs-number">1</span>]:
                dp[i][j] = dp[i-<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>]
            <span class="hljs-keyword">else</span>:
                dp[i][j] = <span class="hljs-number">1</span> + <span class="hljs-built_in">min</span>(
                    dp[i-<span class="hljs-number">1</span>][j],      <span class="hljs-comment"># 删除</span>
                    dp[i][j-<span class="hljs-number">1</span>],      <span class="hljs-comment"># 插入</span>
                    dp[i-<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>]     <span class="hljs-comment"># 替换</span>
                )
    <span class="hljs-keyword">return</span> dp[m][n]

distance = levenshtein_distance(<span class="hljs-string">"kitten"</span>, <span class="hljs-string">"sitting"</span>)
<span class="hljs-built_in">print</span>(distance)  <span class="hljs-comment"># 输出: 3 (k→s, e→i, 添加g)</span>
</code></pre>
<hr/>
<h5 data-id="heading-7">Damerau-Levenshtein Distance (1964)</h5>
<p><strong>发明背景与痛点</strong>：Frederick Damerau 研究发现，80%以上的人类拼写错误属于四种类型：插入、删除、替换、相邻转置。Levenshtein 无法高效处理常见的"字符转置"错误（如 teh → the）；如何更准确地建模人类真实的拼写错误模式？输入法中如何快速识别和纠正相邻字符颠倒的输入？OCR识别结果中常见的字符交换错误如何高效修正？</p>
<p><strong>核心思想</strong>：在 Levenshtein 基础上增加"相邻字符转置"操作。</p>
<p><strong>优点</strong>：</p>
<ul>
<li>更符合人类拼写错误的实际情况</li>
<li>"teh" → "the" 只需1次操作（转置），而非2次（Levenshtein需删除+插入）</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>实现复杂度略高</li>
<li>计算开销比 Levenshtein 稍大</li>
</ul>
<p><strong>适用场景</strong>：拼写纠错、OCR后处理、输入法纠错</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">damerau_levenshtein_distance</span>(<span class="hljs-params">s1: <span class="hljs-built_in">str</span>, s2: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    m, n = <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">len</span>(s2)
    dp = [[<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>)]
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>):
        dp[i][<span class="hljs-number">0</span>] = i
    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n + <span class="hljs-number">1</span>):
        dp[<span class="hljs-number">0</span>][j] = j
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, m + <span class="hljs-number">1</span>):
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):
            cost = <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> s1[i-<span class="hljs-number">1</span>] == s2[j-<span class="hljs-number">1</span>] <span class="hljs-keyword">else</span> <span class="hljs-number">1</span>
            dp[i][j] = <span class="hljs-built_in">min</span>(
                dp[i-<span class="hljs-number">1</span>][j] + <span class="hljs-number">1</span>,           <span class="hljs-comment"># 删除</span>
                dp[i][j-<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>,           <span class="hljs-comment"># 插入</span>
                dp[i-<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>] + cost       <span class="hljs-comment"># 替换</span>
            )
            <span class="hljs-keyword">if</span> i &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> j &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> s1[i-<span class="hljs-number">1</span>] == s2[j-<span class="hljs-number">2</span>] <span class="hljs-keyword">and</span> s1[i-<span class="hljs-number">2</span>] == s2[j-<span class="hljs-number">1</span>]:
                dp[i][j] = <span class="hljs-built_in">min</span>(dp[i][j], dp[i-<span class="hljs-number">2</span>][j-<span class="hljs-number">2</span>] + <span class="hljs-number">1</span>)  <span class="hljs-comment"># 转置</span>
    
    <span class="hljs-keyword">return</span> dp[m][n]

distance = damerau_levenshtein_distance(<span class="hljs-string">"ca"</span>, <span class="hljs-string">"abc"</span>)
<span class="hljs-built_in">print</span>(distance)  <span class="hljs-comment"># 输出: 2 (转置 ca→ac + 插入b)</span>
<span class="hljs-comment"># Levenshtein会输出3，Damerau-L更准确</span>
</code></pre>
<hr/>
<h5 data-id="heading-8">Jaro-Winkler Distance (1989)</h5>
<p><strong>发明背景与痛点</strong>：由 Matthew Jaro 和 William Winkler 开发，专门用于人名匹配。如何高效匹配人名等短字符串，即使存在拼写差异？传统的编辑距离对短字符串不够友好，如何优化？在数据清洗中，如何识别同一实体的不同拼写形式？如何利用前缀匹配的特点来提高短字符串相似度计算的准确性？</p>
<p><strong>核心思想</strong>：</p>
<ol>
<li>定义匹配窗口（允许一定距离内的字符配对）</li>
<li>计算匹配字符数和转置数</li>
<li>Winkler改进：对前缀匹配给予额外权重</li>
</ol>
<p><strong>优点</strong>：</p>
<ul>
<li>对短字符串效果优异</li>
<li>前缀权重符合人名匹配特点（前几个字母通常正确）</li>
<li>输出归一化到 [0,1] 区间</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>长字符串效果不如 Levenshtein</li>
<li>参数调整需要经验</li>
</ul>
<p><strong>适用场景</strong>：人名匹配、记录链接（Record Linkage）、数据去重</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">jaro_similarity</span>(<span class="hljs-params">s1: <span class="hljs-built_in">str</span>, s2: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-keyword">if</span> s1 == s2:
        <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span>
    
    len1, len2 = <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">len</span>(s2)
    match_distance = <span class="hljs-built_in">max</span>(len1, len2) // <span class="hljs-number">2</span> - <span class="hljs-number">1</span>
    <span class="hljs-keyword">if</span> match_distance &lt; <span class="hljs-number">0</span>:
        match_distance = <span class="hljs-number">0</span>
    
    s1_matches = [<span class="hljs-literal">False</span>] * len1
    s2_matches = [<span class="hljs-literal">False</span>] * len2
    
    matches = <span class="hljs-number">0</span>
    transpositions = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(len1):
        start = <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, i - match_distance)
        end = <span class="hljs-built_in">min</span>(i + match_distance + <span class="hljs-number">1</span>, len2)
        
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(start, end):
            <span class="hljs-keyword">if</span> s2_matches[j] <span class="hljs-keyword">or</span> s1[i] != s2[j]:
                <span class="hljs-keyword">continue</span>
            s1_matches[i] = s2_matches[j] = <span class="hljs-literal">True</span>
            matches += <span class="hljs-number">1</span>
            <span class="hljs-keyword">break</span>
    
    <span class="hljs-keyword">if</span> matches == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>
    
    k = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(len1):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> s1_matches[i]:
            <span class="hljs-keyword">continue</span>
        <span class="hljs-keyword">while</span> <span class="hljs-keyword">not</span> s2_matches[k]:
            k += <span class="hljs-number">1</span>
        <span class="hljs-keyword">if</span> s1[i] != s2[k]:
            transpositions += <span class="hljs-number">1</span>
        k += <span class="hljs-number">1</span>
    
    <span class="hljs-keyword">return</span> (matches / len1 + matches / len2 + 
            (matches - transpositions / <span class="hljs-number">2</span>) / matches) / <span class="hljs-number">3</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">jaro_winkler</span>(<span class="hljs-params">s1: <span class="hljs-built_in">str</span>, s2: <span class="hljs-built_in">str</span>, p: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.1</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    jaro = jaro_similarity(s1, s2)
    
    prefix = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">min</span>(<span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">len</span>(s2), <span class="hljs-number">4</span>)):
        <span class="hljs-keyword">if</span> s1[i] == s2[i]:
            prefix += <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">break</span>
    
    <span class="hljs-keyword">return</span> jaro + prefix * p * (<span class="hljs-number">1</span> - jaro)

similarity = jaro_winkler(<span class="hljs-string">"MARTHA"</span>, <span class="hljs-string">"MARHTA"</span>)
<span class="hljs-built_in">print</span>(similarity)  <span class="hljs-comment"># 输出: 0.961 (前缀匹配得到额外权重)</span>
</code></pre>
<hr/>
<h5 data-id="heading-9">编辑距离家族对比表</h5>





























































<table><thead><tr><th>算法</th><th>年份</th><th>允许操作</th><th>时间复杂度</th><th>最佳场景</th><th>典型应用</th></tr></thead><tbody><tr><td><strong>Hamming</strong></td><td>1950</td><td>替换</td><td>O(n)</td><td>等长编码</td><td>纠错码、hash比较</td></tr><tr><td><strong>Levenshtein</strong></td><td>1965</td><td>插入/删除/替换</td><td>O(m×n)</td><td>通用文本</td><td>拼写检查、搜索</td></tr><tr><td><strong>Damerau-L</strong></td><td>1964</td><td>+转置</td><td>O(m×n)</td><td>人类输入</td><td>拼写纠错、输入法</td></tr><tr><td><strong>Jaro-Winkler</strong></td><td>1989</td><td>匹配窗口</td><td>O(m×n)</td><td>短字符串</td><td>人名匹配、去重</td></tr><tr><td><strong>Needleman-Wunsch</strong></td><td>1970</td><td>带权重</td><td>O(m×n)</td><td>生物序列</td><td>DNA/蛋白质比对</td></tr><tr><td><strong>Smith-Waterman</strong></td><td>1981</td><td>局部比对</td><td>O(m×n)</td><td>相似片段</td><td>局部序列比对</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-10">1.2 序列匹配：LCS 家族</h4>
<p>LCS（Longest Common Subsequence/Substring）家族是 diff 工具的理论基础，解决"两个文本有哪些共同部分"的问题。</p>
<h5 data-id="heading-11">子串 vs 子序列的本质区别</h5>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph 概念区分
        原串["原串: A B C D E F G"]
        
        subgraph 子串Substring
            S1["必须连续"]
            S2["BCD ✓"]
            S3["BDF ✗"]
        end
        
        subgraph 子序列Subsequence
            Q1["保持相对顺序&lt;br/&gt;可不连续"]
            Q2["BCD ✓"]
            Q3["BDF ✓"]
            Q4["FDB ✗ 顺序错误"]
        end
    end
</code></pre>




















<table><thead><tr><th>概念</th><th>定义</th><th>示例（原串ABCDEFG）</th></tr></thead><tbody><tr><td><strong>子串 (Substring)</strong></td><td>连续的字符序列</td><td>"BCD" ✓, "BDF" ✗</td></tr><tr><td><strong>子序列 (Subsequence)</strong></td><td>保持相对顺序，可不连续</td><td>"BCD" ✓, "BDF" ✓, "FDB" ✗</td></tr></tbody></table>
<hr/>
<h5 data-id="heading-12">diff 算法演进</h5>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph diff算法演进史
        LCS["&lt;b&gt;经典 LCS DP&lt;/b&gt;&lt;br/&gt;1970s&lt;br/&gt;O(m×n) 时间和空间&lt;br/&gt;理论基础，教学使用"]
        
        HM["&lt;b&gt;Hunt-McIlroy&lt;/b&gt;&lt;br/&gt;1976&lt;br/&gt;O(n×m×log m)&lt;br/&gt;匹配点稀疏时更快"]
        
        MYERS["&lt;b&gt;Myers Algorithm&lt;/b&gt;&lt;br/&gt;1986&lt;br/&gt;O((M+N)×D)&lt;br/&gt;D=差异数，差异小时极快"]
        
        PAT["&lt;b&gt;Patience Diff&lt;/b&gt;&lt;br/&gt;2006&lt;br/&gt;O(n log n)&lt;br/&gt;语义更好，处理代码移动"]
        
        HIST["&lt;b&gt;Histogram Diff&lt;/b&gt;&lt;br/&gt;2011&lt;br/&gt;Patience优化版&lt;br/&gt;Git 默认算法"]
        
        LCS --&gt; HM
        HM --&gt; MYERS
        MYERS --&gt; PAT
        MYERS --&gt; HIST
        
        HM -.-&gt;|"应用于"| UNIX["Unix diff"]
        MYERS -.-&gt;|"应用于"| GIT["Git diff"]
        HIST -.-&gt;|"应用于"| GIT2["Git 2.0+ 默认"]
    end
</code></pre>
<h5 data-id="heading-13">经典 LCS 动态规划</h5>
<p><strong>发明背景与痛点</strong>：如何找到两个文本的最长公共子序列，用于版本控制和代码比对？如何生成可读的diff输出，展示两个文件的差异？在生物信息学中，如何比对DNA序列找到相似片段？如何处理大规模文件的差异比较，避免二次复杂度的性能问题？</p>
<p><strong>核心思想</strong>：通过动态规划找到两个序列的最长公共子序列，基于此可以生成diff结果。</p>
<p><strong>复杂度</strong>：O(m×n) 时间和空间</p>
<p><strong>优点</strong>：</p>
<ul>
<li>实现简单，概念清晰</li>
<li>保证找到最优解</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>对于大文件效率低</li>
<li>空间消耗大</li>
</ul>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">lcs_length</span>(<span class="hljs-params">s1: <span class="hljs-built_in">str</span>, s2: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    m, n = <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">len</span>(s2)
    dp = [[<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>)]
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, m + <span class="hljs-number">1</span>):
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):
            <span class="hljs-keyword">if</span> s1[i-<span class="hljs-number">1</span>] == s2[j-<span class="hljs-number">1</span>]:
                dp[i][j] = dp[i-<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>
            <span class="hljs-keyword">else</span>:
                dp[i][j] = <span class="hljs-built_in">max</span>(dp[i-<span class="hljs-number">1</span>][j], dp[i][j-<span class="hljs-number">1</span>])
    
    <span class="hljs-keyword">return</span> dp[m][n]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">lcs_string</span>(<span class="hljs-params">s1: <span class="hljs-built_in">str</span>, s2: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    m, n = <span class="hljs-built_in">len</span>(s1), <span class="hljs-built_in">len</span>(s2)
    dp = [[<span class="hljs-number">0</span>] * (n + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(m + <span class="hljs-number">1</span>)]
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, m + <span class="hljs-number">1</span>):
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n + <span class="hljs-number">1</span>):
            <span class="hljs-keyword">if</span> s1[i-<span class="hljs-number">1</span>] == s2[j-<span class="hljs-number">1</span>]:
                dp[i][j] = dp[i-<span class="hljs-number">1</span>][j-<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>
            <span class="hljs-keyword">else</span>:
                dp[i][j] = <span class="hljs-built_in">max</span>(dp[i-<span class="hljs-number">1</span>][j], dp[i][j-<span class="hljs-number">1</span>])
    
    result = []
    i, j = m, n
    <span class="hljs-keyword">while</span> i &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> j &gt; <span class="hljs-number">0</span>:
        <span class="hljs-keyword">if</span> s1[i-<span class="hljs-number">1</span>] == s2[j-<span class="hljs-number">1</span>]:
            result.append(s1[i-<span class="hljs-number">1</span>])
            i -= <span class="hljs-number">1</span>
            j -= <span class="hljs-number">1</span>
        <span class="hljs-keyword">elif</span> dp[i-<span class="hljs-number">1</span>][j] &gt; dp[i][j-<span class="hljs-number">1</span>]:
            i -= <span class="hljs-number">1</span>
        <span class="hljs-keyword">else</span>:
            j -= <span class="hljs-number">1</span>
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>.join(<span class="hljs-built_in">reversed</span>(result))

length = lcs_length(<span class="hljs-string">"ABCBDAB"</span>, <span class="hljs-string">"BDCABA"</span>)
lcs = lcs_string(<span class="hljs-string">"ABCBDAB"</span>, <span class="hljs-string">"BDCABA"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"长度: <span class="hljs-subst">{length}</span>, LCS: <span class="hljs-subst">{lcs}</span>"</span>)  <span class="hljs-comment"># 输出: 长度: 4, LCS: BCBA</span>
</code></pre>
<hr/>
<h5 data-id="heading-14">Myers Algorithm (1986)</h5>
<p><strong>发明背景与痛点</strong>：由 Eugene W. Myers 发明，这是 Git diff 的核心算法，至今仍在使用。经典LCS算法的O(m×n)复杂度在差异较小时效率低下；如何利用"差异小"这一特点来优化diff算法？版本控制系统中，如何快速生成两个版本之间的差异？如何生成最小编辑脚本，使diff结果最紧凑？</p>
<p><strong>核心思想</strong>：</p>
<ul>
<li>将 diff 问题转化为图上的最短路径问题</li>
<li>使用"编辑图"(Edit Graph)表示，对角线移动（匹配）免费，水平/垂直移动（增删）有代价</li>
<li>贪心策略优先探索对角线</li>
</ul>
<p><strong>复杂度</strong>：O((M+N)×D)，其中 D 是差异数量</p>
<p><strong>优点</strong>：</p>
<ul>
<li>差异小时极快（D 较小）</li>
<li>生成的 diff 结果紧凑直观</li>
<li>保证最小编辑脚本</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>差异大时退化到 O(m×n)</li>
<li>对代码块移动不够友好</li>
</ul>
<p><strong>适用场景</strong>：版本控制系统、代码审查、文档比对</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">myers_diff</span>(<span class="hljs-params">a: <span class="hljs-built_in">str</span>, b: <span class="hljs-built_in">str</span></span>):
    m, n = <span class="hljs-built_in">len</span>(a), <span class="hljs-built_in">len</span>(b)
    max_d = m + n
    v = {<span class="hljs-number">1</span>: <span class="hljs-number">0</span>}
    
    <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, max_d + <span class="hljs-number">1</span>):
        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(-d, d + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>):
            <span class="hljs-keyword">if</span> k == -d <span class="hljs-keyword">or</span> (k != d <span class="hljs-keyword">and</span> v[k-<span class="hljs-number">1</span>] &lt; v[k+<span class="hljs-number">1</span>]):
                x = v[k+<span class="hljs-number">1</span>]
            <span class="hljs-keyword">else</span>:
                x = v[k-<span class="hljs-number">1</span>] + <span class="hljs-number">1</span>
            
            y = x - k
            
            <span class="hljs-keyword">while</span> x &lt; m <span class="hljs-keyword">and</span> y &lt; n <span class="hljs-keyword">and</span> a[x] == b[y]:
                x += <span class="hljs-number">1</span>
                y += <span class="hljs-number">1</span>
            
            v[k] = x
            
            <span class="hljs-keyword">if</span> x &gt;= m <span class="hljs-keyword">and</span> y &gt;= n:
                <span class="hljs-keyword">return</span> d
    
    <span class="hljs-keyword">return</span> max_d

distance = myers_diff(<span class="hljs-string">"ABCABBA"</span>, <span class="hljs-string">"CBABAC"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Myers差异值: <span class="hljs-subst">{distance}</span>"</span>)  <span class="hljs-comment"># 输出差异程度</span>
</code></pre>
<hr/>
<h5 data-id="heading-15">Patience Diff (2006)</h5>
<p><strong>发明背景与痛点</strong>：传统diff算法对代码块移动的处理不够友好；如何生成更具"语义"的diff，提高可读性？代码重构时，如何避免将不相关的代码行配对在一起？如何利用唯一行作为锚点，优化diff的语义质量？</p>
<p><strong>核心思想</strong>：</p>
<ol>
<li>首先找出两个文件中都只出现一次的行（唯一行）</li>
<li>对这些唯一行应用 LCS</li>
<li>用这些"锚点"递归处理中间部分</li>
</ol>
<p><strong>优点</strong>：</p>
<ul>
<li>对代码移动的处理更友好</li>
<li>生成的 diff 更具"语义"，更易读</li>
<li>不会把无关的 <code>{</code> <code>}</code> 配对在一起</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>对于没有唯一行的情况效果不好</li>
<li>某些情况下不是最小 diff</li>
</ul>
<p><strong>适用场景</strong>：代码审查、需要可读性的 diff</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">patience_diff</span>(<span class="hljs-params">a: <span class="hljs-built_in">list</span>, b: <span class="hljs-built_in">list</span></span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">longest_increasing_subsequence</span>(<span class="hljs-params">seq</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> seq:
            <span class="hljs-keyword">return</span> []
        tails = []
        prev = [-<span class="hljs-number">1</span>] * <span class="hljs-built_in">len</span>(seq)
        
        <span class="hljs-keyword">for</span> i, x <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(seq):
            idx = bisect_left(tails, x)
            <span class="hljs-keyword">if</span> idx == <span class="hljs-built_in">len</span>(tails):
                tails.append(x)
            <span class="hljs-keyword">else</span>:
                tails[idx] = x
            prev[i] = tails[idx-<span class="hljs-number">1</span>] <span class="hljs-keyword">if</span> idx &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> -<span class="hljs-number">1</span>
        
        result = []
        k = tails[-<span class="hljs-number">1</span>]
        <span class="hljs-keyword">while</span> k != -<span class="hljs-number">1</span>:
            result.append(k)
            k = prev[k]
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">list</span>(<span class="hljs-built_in">reversed</span>(result))
    
    <span class="hljs-keyword">from</span> bisect <span class="hljs-keyword">import</span> bisect_left
    
    unique_a = {line: i <span class="hljs-keyword">for</span> i, line <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(a) <span class="hljs-keyword">if</span> a.count(line) == <span class="hljs-number">1</span>}
    unique_b = {line: i <span class="hljs-keyword">for</span> i, line <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(b) <span class="hljs-keyword">if</span> b.count(line) == <span class="hljs-number">1</span>}
    
    common = [(unique_a[line], unique_b[line]) <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> unique_a <span class="hljs-keyword">if</span> line <span class="hljs-keyword">in</span> unique_b]
    common.sort()
    
    lcs = longest_increasing_subsequence([x[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> common])
    
    matches = [(common[i][<span class="hljs-number">0</span>], common[i][<span class="hljs-number">1</span>]) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> lcs]
    <span class="hljs-keyword">return</span> matches

a_lines = [<span class="hljs-string">"def foo():"</span>, <span class="hljs-string">"    x = 1"</span>, <span class="hljs-string">"    y = 2"</span>, <span class="hljs-string">"    return x + y"</span>]
b_lines = [<span class="hljs-string">"def bar():"</span>, <span class="hljs-string">"    x = 1"</span>, <span class="hljs-string">"    y = 2"</span>, <span class="hljs-string">"    return x + y"</span>]
matches = patience_diff(a_lines, b_lines)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"匹配的行: <span class="hljs-subst">{matches}</span>"</span>)
</code></pre>
<hr/>
<h5 data-id="heading-16">Histogram Diff (2011)</h5>
<p><strong>核心思想</strong>：Patience Diff 的优化版，使用直方图统计行出现频率，低频行作为锚点。</p>
<p><strong>优点</strong>：</p>
<ul>
<li>综合了 Myers 和 Patience 的优点</li>
<li>性能更稳定</li>
<li>Git 2.0+ 的默认选择</li>
</ul>
<p><strong>适用场景</strong>：通用代码版本控制</p>
<hr/>
<h5 data-id="heading-17">LCS/diff 算法对比表</h5>















































<table><thead><tr><th>算法</th><th>年份</th><th>时间复杂度</th><th>特点</th><th>应用产品</th></tr></thead><tbody><tr><td><strong>经典LCS</strong></td><td>1970s</td><td>O(m×n)</td><td>理论基础</td><td>教学、小规模工具</td></tr><tr><td><strong>Hunt-McIlroy</strong></td><td>1976</td><td>O(n×m×log m)</td><td>匹配点稀疏时快</td><td>Unix diff</td></tr><tr><td><strong>Myers</strong></td><td>1986</td><td>O((M+N)×D)</td><td>差异小时极快</td><td>Git diff</td></tr><tr><td><strong>Patience</strong></td><td>2006</td><td>O(n log n)</td><td>语义更好</td><td>Bazaar, Git可选</td></tr><tr><td><strong>Histogram</strong></td><td>2011</td><td>变化</td><td>平衡性能和可读性</td><td>Git 默认</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">🎲 第二纪元：集合论方法 (1900s理论 → 1990s应用)</h3>
<p>当需要处理大规模数据（如互联网网页去重）时，字符级的精确匹配变得不可行。集合论方法将文档视为特征集合，通过集合操作快速估算相似度。</p>
<h4 data-id="heading-19">2.1 Jaccard 相似度 (1901)</h4>
<p><strong>发明背景与痛点</strong>：由 Paul Jaccard 发明，最初用于植物群落的物种相似性比较。如何量化两个集合之间的相似程度？在推荐系统中，如何计算用户兴趣的相似度？在数据清洗中，如何识别重复或相似的记录？如何设计一个不受集合大小影响的相似度度量？</p>
<p><strong>核心公式</strong>：</p>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>J</mi><mo stretchy="false">(</mo><mi>A</mi><mo separator="true">,</mo><mi>B</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi mathvariant="normal">∣</mi><mi>A</mi><mo>∩</mo><mi>B</mi><mi mathvariant="normal">∣</mi></mrow><mrow><mi mathvariant="normal">∣</mi><mi>A</mi><mo>∪</mo><mi>B</mi><mi mathvariant="normal">∣</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">J(A, B) = \frac{|A \cap B|}{|A \cup B|}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.53em;vertical-align:-0.52em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathnormal mtight">A</span><span class="mbin mtight">∪</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mtight">∣</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathnormal mtight">A</span><span class="mbin mtight">∩</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph Jaccard相似度
        formula["J(A, B) = |A ∩ B| / |A ∪ B|"]
        
        subgraph 特性
            F1["范围: [0, 1]"]
            F2["1 = 完全相同"]
            F3["0 = 完全不同"]
            F4["对称性: J(A,B) = J(B,A)"]
        end
        
        subgraph 优缺点
            P1["✓ 简单直观"]
            P2["✓ 无需考虑顺序"]
            P3["✓ 对集合大小不敏感"]
            N1["✗ 精确计算需要完整集合"]
            N2["✗ 大规模时效率低"]
        end
    end
</code></pre>
<p><strong>优点</strong>：</p>
<ul>
<li>概念简单，易于理解和实现</li>
<li>归一化输出，便于设置阈值</li>
<li>不受集合大小影响</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>精确计算需要遍历所有元素</li>
<li>不考虑元素的权重和顺序</li>
<li>大规模数据时效率问题</li>
</ul>
<p><strong>适用场景</strong>：小规模集合比较、推荐系统、文档聚类</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">jaccard_similarity</span>(<span class="hljs-params">set1: <span class="hljs-built_in">set</span>, set2: <span class="hljs-built_in">set</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> set1 <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> set2:
        <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> set1 <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> set2:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>
    
    intersection = <span class="hljs-built_in">len</span>(set1 &amp; set2)
    union = <span class="hljs-built_in">len</span>(set1 | set2)
    
    <span class="hljs-keyword">return</span> intersection / union

set_a = {<span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"orange"</span>}
set_b = {<span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"grape"</span>}
similarity = jaccard_similarity(set_a, set_b)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Jaccard相似度: <span class="hljs-subst">{similarity}</span>"</span>)  <span class="hljs-comment"># 输出: 0.666...</span>
</code></pre>
<hr/>
<h4 data-id="heading-20">2.2 Shingling (k-gram)</h4>
<p><strong>发明背景与痛点</strong>：如何将文档转换为适合集合论处理的特征集合？如何在保留局部顺序信息的同时，支持集合操作？如何选择合适的k值，平衡特征粒度和计算效率？在抄袭检测中，如何识别局部相似的文档片段？</p>
<p><strong>核心思想</strong>：将文档转换为连续k个字符（或单词）的集合，称为 shingle 或 k-gram。</p>
<p><strong>示例</strong>：</p>
<ul>
<li>文本："abcde"</li>
<li>k=2的shingle集合：{ab, bc, cd, de}</li>
</ul>
<p><strong>参数选择</strong>：</p>




















<table><thead><tr><th>粒度</th><th>k 值范围</th><th>适用场景</th></tr></thead><tbody><tr><td>字符级</td><td>5-10</td><td>短文本、近似匹配</td></tr><tr><td>单词级</td><td>2-5</td><td>长文档、抄袭检测</td></tr></tbody></table>
<p><strong>优点</strong>：</p>
<ul>
<li>保留了一定的局部顺序信息</li>
<li>对小修改具有鲁棒性</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>k 值选择影响结果</li>
<li>集合可能很大</li>
</ul>
<p><strong>适用场景</strong>：文档去重、抄袭检测、近似匹配</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">shingling</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span>, k: <span class="hljs-built_in">int</span> = <span class="hljs-number">3</span></span>) -&gt; <span class="hljs-built_in">set</span>:
    shingles = <span class="hljs-built_in">set</span>()
    text = text.replace(<span class="hljs-string">" "</span>, <span class="hljs-string">""</span>)
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(text) - k + <span class="hljs-number">1</span>):
        shingle = text[i:i+k]
        shingles.add(shingle)
    
    <span class="hljs-keyword">return</span> shingles

text1 = <span class="hljs-string">"hello world"</span>
text2 = <span class="hljs-string">"hello word"</span>

shingles1 = shingling(text1, k=<span class="hljs-number">3</span>)
shingles2 = shingling(text2, k=<span class="hljs-number">3</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"文本1的shingles: <span class="hljs-subst">{shingles1}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"文本2的shingles: <span class="hljs-subst">{shingles2}</span>"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-21">2.3 MinHash (1997)</h4>
<p><strong>发明背景与痛点</strong>：由 Andrei Broder 发明，AltaVista 搜索引擎需要对互联网上的网页进行去重，直接计算 Jaccard 相似度无法处理亿级网页。如何快速估算大规模文档集合的Jaccard相似度？互联网上有亿级网页，如何高效进行去重？直接计算Jaccard相似度需要遍历所有元素，如何降维加速？如何在保证精度的前提下，大幅减少计算和存储开销？</p>
<p><strong>核心定理</strong>：
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>r</mi><mo stretchy="false">[</mo><mi>M</mi><mi>i</mi><mi>n</mi><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>A</mi><mo stretchy="false">)</mo><mo>=</mo><mi>M</mi><mi>i</mi><mi>n</mi><mi>H</mi><mi>a</mi><mi>s</mi><mi>h</mi><mo stretchy="false">(</mo><mi>B</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mo>=</mo><mi>J</mi><mi>a</mi><mi>c</mi><mi>c</mi><mi>a</mi><mi>r</mi><mi>d</mi><mo stretchy="false">(</mo><mi>A</mi><mo separator="true">,</mo><mi>B</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Pr[MinHash(A) = MinHash(B)] = Jaccard(A, B)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">h</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)]</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.09618em;">J</span><span class="mord mathnormal">a</span><span class="mord mathnormal">cc</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">A</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mclose">)</span></span></span></span></span></p>
<p>即：两个集合的 MinHash 值相同的概率，等于它们的 Jaccard 相似度。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph MinHash流程
        DOC["文档"] --&gt; SHIN["Shingling&lt;br/&gt;切分为k-gram"]
        SHIN --&gt; HASH["应用 k 个哈希函数"]
        HASH --&gt; SIG["生成签名向量&lt;br/&gt;[h₁(min), h₂(min), ..., hₖ(min)]"]
        SIG --&gt; COMP["比较签名&lt;br/&gt;相同位置匹配比例 ≈ Jaccard"]
    end
</code></pre>
<p><strong>算法步骤</strong>：</p>
<ol>
<li>将文档转换为 shingle 集合</li>
<li>使用 k 个不同的哈希函数</li>
<li>对每个哈希函数，记录集合中的最小哈希值</li>
<li>得到长度为 k 的签名向量</li>
<li>两个文档签名中相同位置相等的比例，近似于 Jaccard 相似度</li>
</ol>
<p><strong>优点</strong>：</p>
<ul>
<li>将大集合压缩为固定长度签名</li>
<li>可以快速估算 Jaccard 相似度</li>
<li>误差可控（增加 k 减小误差）</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>是近似值，存在误差</li>
<li>需要多个哈希函数</li>
<li>单独使用仍需两两比较</li>
</ul>
<p><strong>适用场景</strong>：网页去重、近似重复检测、聚类</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> random

<span class="hljs-keyword">def</span> <span class="hljs-title function_">minhash_signature</span>(<span class="hljs-params">document: <span class="hljs-built_in">set</span>, num_hashes: <span class="hljs-built_in">int</span> = <span class="hljs-number">100</span></span>) -&gt; <span class="hljs-built_in">list</span>:
    signature = []
    
    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_hashes):
        min_hash = <span class="hljs-built_in">float</span>(<span class="hljs-string">'inf'</span>)
        
        <span class="hljs-keyword">for</span> element <span class="hljs-keyword">in</span> document:
            hash_value = <span class="hljs-built_in">hash</span>(<span class="hljs-built_in">str</span>(element) + <span class="hljs-built_in">str</span>(random.random()))
            min_hash = <span class="hljs-built_in">min</span>(min_hash, hash_value)
        
        signature.append(min_hash)
    
    <span class="hljs-keyword">return</span> signature

<span class="hljs-keyword">def</span> <span class="hljs-title function_">estimate_jaccard</span>(<span class="hljs-params">sig1: <span class="hljs-built_in">list</span>, sig2: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    matches = <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> a, b <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(sig1, sig2) <span class="hljs-keyword">if</span> a == b)
    <span class="hljs-keyword">return</span> matches / <span class="hljs-built_in">len</span>(sig1)

doc1 = {<span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"orange"</span>, <span class="hljs-string">"grape"</span>}
doc2 = {<span class="hljs-string">"apple"</span>, <span class="hljs-string">"banana"</span>, <span class="hljs-string">"grape"</span>, <span class="hljs-string">"pear"</span>}

sig1 = minhash_signature(doc1, num_hashes=<span class="hljs-number">100</span>)
sig2 = minhash_signature(doc2, num_hashes=<span class="hljs-number">100</span>)

estimated = estimate_jaccard(sig1, sig2)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"估算的Jaccard相似度: <span class="hljs-subst">{estimated}</span>"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-22">2.4 LSH - Locality Sensitive Hashing (1998)</h4>
<p><strong>发明背景与痛点</strong>：由 Piotr Indyk 和 Rajeev Motwani 发明。如何在海量数据中快速找到相似的文档对？MinHash仍需两两比较，如何进一步优化到亚线性复杂度？如何设计哈希函数，使得相似项碰撞，不相似项不碰撞？如何在召回率和精确率之间找到平衡？</p>
<p><strong>核心思想</strong>：将相似的项目哈希到同一个桶中，不相似的项目哈希到不同桶中。这与传统哈希（尽量避免碰撞）正好相反。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph LSH分桶策略
        SIG["签名矩阵&lt;br/&gt;(每列是一个文档的签名)"]
        
        subgraph 分band
            B1["Band 1&lt;br/&gt;r 行"]
            B2["Band 2&lt;br/&gt;r 行"]
            B3["Band 3&lt;br/&gt;r 行"]
            BN["...&lt;br/&gt;共 b 个 band"]
        end
        
        BUCKET["每个 band 独立哈希到桶&lt;br/&gt;任一 band 相同 → 候选对"]
        
        SIG --&gt; B1 &amp; B2 &amp; B3 &amp; BN --&gt; BUCKET
    end
</code></pre>
<p><strong>参数调优</strong>：</p>
<ul>
<li>b = band 数量</li>
<li>r = 每个 band 的行数</li>
<li>签名长度 = b × r</li>
</ul>
<p><strong>候选概率</strong>：两个 Jaccard 相似度为 s 的文档成为候选对的概率：
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>=</mo><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><msup><mi>s</mi><mi>r</mi></msup><msup><mo stretchy="false">)</mo><mi>b</mi></msup></mrow><annotation encoding="application/x-tex">P = 1 - (1 - s^r)^b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"/><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.0991em;vertical-align:-0.25em;"/><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6644em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span></span></span></span></span></span></span></span></span></p>

















<table><thead><tr><th>参数设置</th><th>效果</th></tr></thead><tbody><tr><td>r 增大</td><td>更高精度，但召回率下降</td></tr><tr><td>b 增大</td><td>更高召回率，但误报增加</td></tr></tbody></table>
<p><strong>优点</strong>：</p>
<ul>
<li>亚线性时间复杂度</li>
<li>可处理亿级数据</li>
<li>参数可调控精度/召回权衡</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>需要仔细调参</li>
<li>可能漏掉相似对</li>
<li>有误报需要后验证</li>
</ul>
<p><strong>适用场景</strong>：大规模相似度搜索、推荐系统、近似最近邻</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict

<span class="hljs-keyword">def</span> <span class="hljs-title function_">lsh_bands</span>(<span class="hljs-params">signatures: <span class="hljs-built_in">dict</span>, b: <span class="hljs-built_in">int</span> = <span class="hljs-number">20</span>, r: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    buckets = defaultdict(<span class="hljs-built_in">list</span>)
    
    <span class="hljs-keyword">for</span> doc_id, signature <span class="hljs-keyword">in</span> signatures.items():
        <span class="hljs-keyword">for</span> band <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(b):
            start = band * r
            end = start + r
            band_signature = <span class="hljs-built_in">tuple</span>(signature[start:end])
            bucket_key = (band, band_signature)
            buckets[bucket_key].append(doc_id)
    
    candidates = <span class="hljs-built_in">set</span>()
    <span class="hljs-keyword">for</span> bucket <span class="hljs-keyword">in</span> buckets.values():
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(bucket) &gt; <span class="hljs-number">1</span>:
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(bucket)):
                <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i + <span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(bucket)):
                    candidates.add(<span class="hljs-built_in">tuple</span>(<span class="hljs-built_in">sorted</span>((bucket[i], bucket[j]))))
    
    <span class="hljs-keyword">return</span> candidates

signatures = {
    <span class="hljs-string">"doc1"</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>],
    <span class="hljs-string">"doc2"</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>, <span class="hljs-number">13</span>, <span class="hljs-number">14</span>, <span class="hljs-number">15</span>],
    <span class="hljs-string">"doc3"</span>: [<span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">300</span>, <span class="hljs-number">400</span>, <span class="hljs-number">500</span>, <span class="hljs-number">600</span>, <span class="hljs-number">700</span>, <span class="hljs-number">800</span>, <span class="hljs-number">900</span>, <span class="hljs-number">1000</span>]
}

candidate_pairs = lsh_bands(signatures, b=<span class="hljs-number">2</span>, r=<span class="hljs-number">5</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"候选相似文档对: <span class="hljs-subst">{candidate_pairs}</span>"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-23">2.5 SimHash (2002)</h4>
<p><strong>发明背景与痛点</strong>：由 Moses Charikar 发明，Google 用于网页去重（2007年论文披露）。如何用极小的空间表示文档，用于快速去重？Google如何处理百亿级网页的去重问题？MinHash需要存储多个哈希值，能否进一步压缩到单个指纹？如何利用汉明距离快速判断文档相似度？</p>
<p><strong>核心思想</strong>：生成一个固定长度的指纹（通常64位），相似文档的指纹汉明距离小。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph SimHash计算流程
        DOC2["文档"] --&gt; TOKEN["分词&lt;br/&gt;提取特征"]
        TOKEN --&gt; WEIGHT["计算权重&lt;br/&gt;(TF-IDF等)"]
        WEIGHT --&gt; HASH2["每个特征计算哈希"]
        HASH2 --&gt; ACC["按位加权累加&lt;br/&gt;1→+weight, 0→-weight"]
        ACC --&gt; SIGN2["符号化&lt;br/&gt;正→1, 负→0"]
        SIGN2 --&gt; FP["64位指纹"]
    end
</code></pre>
<p><strong>计算步骤详解</strong>：</p>
<ol>
<li>分词并计算每个词的权重（如TF-IDF）</li>
<li>每个词计算一个 n 位哈希</li>
<li>初始化 n 维向量为 0</li>
<li>对每个词：哈希的每一位，是1则加权重，是0则减权重</li>
<li>最终向量每一位：正数变1，负数变0</li>
</ol>
<p><strong>优点</strong>：</p>
<ul>
<li>极度空间高效（仅64/128位）</li>
<li>汉明距离计算极快（CPU指令级）</li>
<li>支持海量数据</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>只能检测高相似度文档</li>
<li>局部修改可能导致指纹大变</li>
<li>不适合细粒度相似度计算</li>
</ul>
<p><strong>适用场景</strong>：大规模去重、近似重复检测、快速筛选</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> hashlib

<span class="hljs-keyword">def</span> <span class="hljs-title function_">simhash</span>(<span class="hljs-params">text: <span class="hljs-built_in">str</span>, bits: <span class="hljs-built_in">int</span> = <span class="hljs-number">64</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    words = text.split()
    weights = {}
    
    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> words:
        weights[word] = weights.get(word, <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>
    
    vector = [<span class="hljs-number">0</span>] * bits
    
    <span class="hljs-keyword">for</span> word, weight <span class="hljs-keyword">in</span> weights.items():
        hash_value = <span class="hljs-built_in">int</span>(hashlib.md5(word.encode()).hexdigest(), <span class="hljs-number">16</span>)
        
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(bits):
            <span class="hljs-keyword">if</span> (hash_value &gt;&gt; i) &amp; <span class="hljs-number">1</span>:
                vector[i] += weight
            <span class="hljs-keyword">else</span>:
                vector[i] -= weight
    
    fingerprint = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(bits):
        <span class="hljs-keyword">if</span> vector[i] &gt; <span class="hljs-number">0</span>:
            fingerprint |= (<span class="hljs-number">1</span> &lt;&lt; i)
    
    <span class="hljs-keyword">return</span> fingerprint

<span class="hljs-keyword">def</span> <span class="hljs-title function_">hamming_distance</span>(<span class="hljs-params">hash1: <span class="hljs-built_in">int</span>, hash2: <span class="hljs-built_in">int</span>, bits: <span class="hljs-built_in">int</span> = <span class="hljs-number">64</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    xor = hash1 ^ hash2
    distance = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> xor:
        distance += xor &amp; <span class="hljs-number">1</span>
        xor &gt;&gt;= <span class="hljs-number">1</span>
    <span class="hljs-keyword">return</span> distance

text1 = <span class="hljs-string">"the quick brown fox jumps over the lazy dog"</span>
text2 = <span class="hljs-string">"the quick brown fox jumps over the lazy cat"</span>

hash1 = simhash(text1)
hash2 = simhash(text2)
distance = hamming_distance(hash1, hash2)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"SimHash汉明距离: <span class="hljs-subst">{distance}</span>"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-24">MinHash vs SimHash 对比</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph 设计目标对比
        subgraph MinHash
            M1["目标: 估算 Jaccard 相似度"]
            M2["输出: k 个哈希值组成的签名"]
            M3["比较: 相同位置匹配比例"]
            M4["优势: 精度可调(增加k)"]
        end
        
        subgraph SimHash
            S1["目标: 估算余弦相似度"]
            S2["输出: 单个指纹(64/128位)"]
            S3["比较: 汉明距离"]
            S4["优势: 极致空间效率"]
        end
    end
</code></pre>













































<table><thead><tr><th>维度</th><th>MinHash</th><th>SimHash</th></tr></thead><tbody><tr><td><strong>估算目标</strong></td><td>Jaccard 相似度</td><td>余弦相似度</td></tr><tr><td><strong>输出形式</strong></td><td>k 个哈希值（签名）</td><td>单个指纹</td></tr><tr><td><strong>比较方式</strong></td><td>匹配位置比例</td><td>汉明距离</td></tr><tr><td><strong>空间效率</strong></td><td>中等（k×哈希大小）</td><td>极高（64位）</td></tr><tr><td><strong>精度可调</strong></td><td>增加 k 提高精度</td><td>位数固定</td></tr><tr><td><strong>适用相似度</strong></td><td>低到高相似度</td><td>仅高相似度</td></tr><tr><td><strong>典型应用</strong></td><td>文档聚类</td><td>网页去重</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-25">集合方法综合对比表</h4>



























































<table><thead><tr><th>方法</th><th>年份</th><th>复杂度</th><th>空间</th><th>规模</th><th>精度</th><th>核心优势</th></tr></thead><tbody><tr><td><strong>Jaccard 精确</strong></td><td>1901</td><td>O(|A|+|B|)</td><td>原集合</td><td>万级</td><td>精确</td><td>简单直观</td></tr><tr><td><strong>Shingling</strong></td><td>-</td><td>O(n)</td><td>O(n/k)</td><td>-</td><td>-</td><td>特征提取</td></tr><tr><td><strong>MinHash</strong></td><td>1997</td><td>O(k×n)</td><td>O(k)</td><td>百万级</td><td>可调</td><td>Jaccard近似</td></tr><tr><td><strong>LSH</strong></td><td>1998</td><td>亚线性</td><td>O(b×桶)</td><td>十亿级</td><td>可调</td><td>候选对发现</td></tr><tr><td><strong>SimHash</strong></td><td>2002</td><td>O(n)</td><td>64位</td><td>百亿级</td><td>有限</td><td>极致效率</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-26">📊 第三纪元：统计向量空间模型 (1970s-2000s)</h3>
<p>这一时期的突破是将文档表示为向量，在向量空间中计算相似度。这为后来的机器学习方法奠定了基础。</p>
<h4 data-id="heading-27">3.1 TF-IDF (1972)</h4>
<p><strong>发展历程与痛点</strong>：1957年Hans Peter Luhn在IBM提出TF（词频）概念；1972年Karen Spärck Jones在剑桥提出IDF（逆文档频率）；1988年Salton &amp; Buckley系统化TF-IDF；1994年Robertson等人提出BM25。如何量化文档中词的重要性，区分常用词和稀有词？词频高的词不一定重要（如"的"），如何降低其权重？如何设计一个无需训练的文档表示方法？在信息检索中，如何计算文档与查询的相关性？</p>
<p><strong>核心公式</strong>：
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>F</mi><mtext>-</mtext><mi>I</mi><mi>D</mi><mi>F</mi><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>d</mi><mo separator="true">,</mo><mi>D</mi><mo stretchy="false">)</mo><mo>=</mo><mi>T</mi><mi>F</mi><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>d</mi><mo stretchy="false">)</mo><mo>×</mo><mi>I</mi><mi>D</mi><mi>F</mi><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>D</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">TF\text{-}IDF(t, d, D) = TF(t, d) \times IDF(t, D)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">TF</span><span class="mord text"><span class="mord">-</span></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">d</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">TF</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">d</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mclose">)</span></span></span></span></span></p>
<h5 data-id="heading-28">TF (Term Frequency) 变体</h5>






























<table><thead><tr><th>变体</th><th>公式</th><th>特点</th></tr></thead><tbody><tr><td><strong>原始频率</strong></td><td>count(t, d)</td><td>简单但受文档长度影响</td></tr><tr><td><strong>布尔频率</strong></td><td>1 if t ∈ d else 0</td><td>只关心存在性</td></tr><tr><td><strong>对数频率</strong></td><td>1 + log(count)</td><td><strong>最常用</strong>，平滑高频词</td></tr><tr><td><strong>归一化频率</strong></td><td>count / max_count</td><td>消除文档长度影响</td></tr></tbody></table>
<h5 data-id="heading-29">IDF (Inverse Document Frequency) 变体</h5>

























<table><thead><tr><th>变体</th><th>公式</th><th>特点</th></tr></thead><tbody><tr><td><strong>标准</strong></td><td>log(N / df)</td><td>可能除零</td></tr><tr><td><strong>平滑</strong></td><td>log(N / (df+1)) + 1</td><td><strong>推荐</strong>，避免除零</td></tr><tr><td><strong>概率</strong></td><td>log((N - df) / df)</td><td>罕见词权重更高</td></tr></tbody></table>
<p><strong>优点</strong>：</p>
<ul>
<li>概念简单，易于理解</li>
<li>无需训练，直接计算</li>
<li>有效区分重要词和常见词</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>词袋模型，丢失顺序信息</li>
<li>无法处理同义词</li>
<li>稀疏高维向量</li>
</ul>
<p><strong>痛点问题</strong>：</p>
<ul>
<li>如何量化文档中词的重要性，区分常用词和稀有词？</li>
<li>词频高的词不一定重要（如"的"），如何降低其权重？</li>
<li>如何设计一个无需训练的文档表示方法？</li>
<li>在信息检索中，如何计算文档与查询的相关性？</li>
</ul>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> math
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter

<span class="hljs-keyword">def</span> <span class="hljs-title function_">tfidf</span>(<span class="hljs-params">document: <span class="hljs-built_in">str</span>, corpus: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    N = <span class="hljs-built_in">len</span>(corpus)
    doc_words = document.lower().split()
    tf = Counter(doc_words)
    
    idf = {}
    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> <span class="hljs-built_in">set</span>(doc_words):
        df = <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> corpus <span class="hljs-keyword">if</span> word <span class="hljs-keyword">in</span> doc.lower().split())
        idf[word] = math.log((N + <span class="hljs-number">1</span>) / (df + <span class="hljs-number">1</span>)) + <span class="hljs-number">1</span>
    
    tfidf_scores = {}
    <span class="hljs-keyword">for</span> word, freq <span class="hljs-keyword">in</span> tf.items():
        tfidf_scores[word] = freq * idf.get(word, <span class="hljs-number">0</span>)
    
    <span class="hljs-keyword">return</span> tfidf_scores

corpus = [
    <span class="hljs-string">"the cat sat on the mat"</span>,
    <span class="hljs-string">"the dog sat on the log"</span>,
    <span class="hljs-string">"cats and dogs are pets"</span>
]

doc = <span class="hljs-string">"the cat sat on the mat"</span>
scores = tfidf(doc, corpus)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"TF-IDF分数: <span class="hljs-subst">{<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">list</span>(scores.items())[:<span class="hljs-number">5</span>])}</span>"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-30">3.2 余弦相似度</h4>
<p><strong>发明背景与痛点</strong>：1975年Salton等人提出向量空间模型，引入几何学中的夹角余弦概念用于信息检索。如何计算两个向量之间的相似度，不受向量长度影响？文档长度不同时，如何公平比较其相似性？在向量空间模型中，如何量化两个文档的夹角？如何设计一个归一化的相似度度量，便于设置阈值？</p>
<p><strong>核心公式</strong>：
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mi>θ</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>A</mi><mo>⋅</mo><mi>B</mi></mrow><mrow><mi mathvariant="normal">∥</mi><mi>A</mi><mi mathvariant="normal">∥</mi><mo>×</mo><mi mathvariant="normal">∥</mi><mi>B</mi><mi mathvariant="normal">∥</mi></mrow></mfrac><mo>=</mo><mfrac><mrow><msub><mo>∑</mo><mi>i</mi></msub><mo stretchy="false">(</mo><msub><mi>A</mi><mi>i</mi></msub><mo>×</mo><msub><mi>B</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><mrow><msqrt><mrow><msub><mo>∑</mo><mi>i</mi></msub><msubsup><mi>A</mi><mi>i</mi><mn>2</mn></msubsup></mrow></msqrt><mo>×</mo><msqrt><mrow><msub><mo>∑</mo><mi>i</mi></msub><msubsup><mi>B</mi><mi>i</mi><mn>2</mn></msubsup></mrow></msqrt></mrow></mfrac></mrow><annotation encoding="application/x-tex">\cos(\theta) = \frac{A \cdot B}{\|A\| \times \|B\|} = \frac{\sum_{i}(A_i \times B_i)}{\sqrt{\sum_{i}A_i^2} \times \sqrt{\sum_{i}B_i^2}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mop">cos</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.3923em;vertical-align:-0.52em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8723em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∥</span><span class="mord mathnormal mtight">A</span><span class="mord mtight">∥</span><span class="mbin mtight">×</span><span class="mord mtight">∥</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="mord mtight">∥</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="mbin mtight">⋅</span><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.8896em;vertical-align:-0.8296em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.06em;"><span style="top:-2.4702em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0283em;"><span class="svg-align" style="top:-3.4286em;"><span class="pstrut" style="height:3.4286em;"/><span class="mord mtight" style="padding-left:1.19em;"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1496em;"><span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3214em;"><span/></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.1952em;"/><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1777em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3223em;"><span/></span></span></span></span></span></span></span><span style="top:-3.0003em;"><span class="pstrut" style="height:3.4286em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.5429em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.5429em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4282em;"><span/></span></span></span></span><span class="mbin mtight">×</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0283em;"><span class="svg-align" style="top:-3.4286em;"><span class="pstrut" style="height:3.4286em;"/><span class="mord mtight" style="padding-left:1.19em;"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1496em;"><span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3214em;"><span/></span></span></span></span></span><span class="mspace mtight" style="margin-right:0.1952em;"/><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8051em;"><span style="top:-2.1777em;margin-left:-0.0502em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span><span style="top:-2.8448em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3223em;"><span/></span></span></span></span></span></span></span><span style="top:-3.0003em;"><span class="pstrut" style="height:3.4286em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.5429em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.5429em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4282em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.535em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1496em;"><span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3214em;"><span/></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mbin mtight">×</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3281em;"><span style="top:-2.357em;margin-left:-0.0502em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8296em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph 余弦相似度特性
        G1["范围: [-1, 1]&lt;br/&gt;TF-IDF向量通常 ∈ [0, 1]"]
        G2["θ = 0° → cos = 1 → 完全相同方向"]
        G3["θ = 90° → cos = 0 → 正交/无关"]
        G4["长度归一化: 长短文档可比"]
    end
</code></pre>
<p><strong>优点</strong>：</p>
<ul>
<li>对文档长度不敏感（归一化）</li>
<li>计算高效</li>
<li>几何意义直观</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>假设维度独立</li>
<li>无法捕获词间关系</li>
</ul>
<p><strong>适用场景</strong>：文档相似度、信息检索、推荐系统</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> math
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter

<span class="hljs-keyword">def</span> <span class="hljs-title function_">cosine_similarity</span>(<span class="hljs-params">vec1: <span class="hljs-built_in">dict</span>, vec2: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    dot_product = <span class="hljs-built_in">sum</span>(vec1[word] * vec2.get(word, <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> vec1)
    
    norm1 = math.sqrt(<span class="hljs-built_in">sum</span>(v ** <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> vec1.values()))
    norm2 = math.sqrt(<span class="hljs-built_in">sum</span>(v ** <span class="hljs-number">2</span> <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> vec2.values()))
    
    <span class="hljs-keyword">if</span> norm1 == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> norm2 == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>
    
    <span class="hljs-keyword">return</span> dot_product / (norm1 * norm2)

doc1 = <span class="hljs-string">"apple banana orange"</span>
doc2 = <span class="hljs-string">"apple banana grape"</span>

vec1 = Counter(doc1.split())
vec2 = Counter(doc2.split())

similarity = cosine_similarity(vec1, vec2)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"余弦相似度: <span class="hljs-subst">{similarity}</span>"</span>)  <span class="hljs-comment"># 输出: 0.816...</span>
</code></pre>
<hr/>
<h4 data-id="heading-31">3.3 BM25 (1994)</h4>
<p><strong>发明背景与痛点</strong>：1994年Stephen Robertson等人基于概率检索模型提出BM25（Best Matching 25），是一系列排名函数的第25个变体。TF-IDF中词频线性增长不合理，如何设计饱和函数？如何考虑文档长度对相关性的影响？如何基于概率检索模型设计排名函数？如何在信息检索中平衡词频、文档频率和长度因素？</p>
<p><strong>核心公式</strong>：
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>B</mi><mi>M</mi><mn>25</mn><mo stretchy="false">(</mo><mi>t</mi><mo separator="true">,</mo><mi>d</mi><mo stretchy="false">)</mo><mo>=</mo><mi>I</mi><mi>D</mi><mi>F</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>×</mo><mfrac><mrow><mo stretchy="false">(</mo><msub><mi>k</mi><mn>1</mn></msub><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo><mo>×</mo><mi>t</mi><mi>f</mi></mrow><mrow><mi>t</mi><mi>f</mi><mo>+</mo><msub><mi>k</mi><mn>1</mn></msub><mo>×</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>b</mi><mo>+</mo><mi>b</mi><mo>×</mo><mfrac><mrow><mi mathvariant="normal">∣</mi><mi>d</mi><mi mathvariant="normal">∣</mi></mrow><mrow><mi>a</mi><mi>v</mi><mi>g</mi><mi>d</mi><mi>l</mi></mrow></mfrac><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">BM25(t,d) = IDF(t) \times \frac{(k_1 + 1) \times tf}{tf + k_1 \times (1 - b + b \times \frac{|d|}{avgdl})}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">BM</span><span class="mord">25</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">d</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1.8845em;vertical-align:-0.8745em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.01em;"><span style="top:-2.4636em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0315em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mbin mtight">×</span><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight">b</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">b</span><span class="mbin mtight">×</span><span class="mord mtight"><span class="mopen nulldelimiter sizing reset-size3 size6"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0378em;"><span style="top:-2.656em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">vg</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span></span></span></span><span style="top:-3.2255em;"><span class="pstrut" style="height:3em;"/><span class="frac-line mtight" style="border-bottom-width:0.049em;"/></span><span style="top:-3.5021em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathnormal mtight">d</span><span class="mord mtight">∣</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4829em;"><span/></span></span></span></span><span class="mclose nulldelimiter sizing reset-size3 size6"/></span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.485em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:-0.0315em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8745em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p><strong>参数说明</strong>：</p>

























<table><thead><tr><th>参数</th><th>典型值</th><th>作用</th></tr></thead><tbody><tr><td><strong>k₁</strong></td><td>1.2 ~ 2.0</td><td>TF 饱和度控制</td></tr><tr><td><strong>b</strong></td><td>0.75</td><td>文档长度归一化程度</td></tr><tr><td><strong>avgdl</strong></td><td>-</td><td>语料库平均文档长度</td></tr></tbody></table>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph BM25_vs_TFIDF
        subgraph TF增长曲线
            TF_C["TF-IDF: 词频增加 → 分数线性增长"]
            BM_C["BM25: 词频增加 → 分数趋于饱和"]
        end
        
        INSIGHT["核心洞察:&lt;br/&gt;一个词出现100次不应该比出现10次重要10倍"]
    end
</code></pre>
<p><strong>BM25 相比 TF-IDF 的改进</strong>：</p>



































<table><thead><tr><th>方面</th><th>TF-IDF</th><th>BM25</th></tr></thead><tbody><tr><td><strong>TF 处理</strong></td><td>线性或对数</td><td>饱和函数</td></tr><tr><td><strong>长度归一化</strong></td><td>可选，通常无</td><td>内置，参数化控制</td></tr><tr><td><strong>理论基础</strong></td><td>启发式</td><td>概率检索模型</td></tr><tr><td><strong>参数</strong></td><td>无</td><td>k₁, b 可调优</td></tr><tr><td><strong>工业使用</strong></td><td>基础场景</td><td><strong>Elasticsearch 默认</strong></td></tr></tbody></table>
<p><strong>优点</strong>：</p>
<ul>
<li>TF 饱和效应更合理</li>
<li>文档长度归一化可控</li>
<li>经过大量实践验证</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>仍是词袋模型</li>
<li>仍无法理解语义</li>
</ul>
<p><strong>适用场景</strong>：搜索引擎、信息检索（至今仍是主流baseline）</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> math
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter

<span class="hljs-keyword">def</span> <span class="hljs-title function_">bm25</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span>, document: <span class="hljs-built_in">str</span>, corpus: <span class="hljs-built_in">list</span>, k1: <span class="hljs-built_in">float</span> = <span class="hljs-number">1.5</span>, b: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.75</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    N = <span class="hljs-built_in">len</span>(corpus)
    avgdl = <span class="hljs-built_in">sum</span>(<span class="hljs-built_in">len</span>(doc.split()) <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> corpus) / N
    
    query_terms = query.lower().split()
    doc_terms = document.lower().split()
    doc_len = <span class="hljs-built_in">len</span>(doc_terms)
    
    tf = Counter(doc_terms)
    
    score = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> term <span class="hljs-keyword">in</span> query_terms:
        <span class="hljs-keyword">if</span> term <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> tf:
            <span class="hljs-keyword">continue</span>
        
        df = <span class="hljs-built_in">sum</span>(<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> doc <span class="hljs-keyword">in</span> corpus <span class="hljs-keyword">if</span> term <span class="hljs-keyword">in</span> doc.lower().split())
        idf = math.log((N - df + <span class="hljs-number">0.5</span>) / (df + <span class="hljs-number">0.5</span>) + <span class="hljs-number">1</span>)
        
        term_freq = tf[term]
        numerator = (k1 + <span class="hljs-number">1</span>) * term_freq
        denominator = term_freq + k1 * (<span class="hljs-number">1</span> - b + b * doc_len / avgdl)
        
        score += idf * (numerator / denominator)
    
    <span class="hljs-keyword">return</span> score

corpus = [
    <span class="hljs-string">"the cat sat on the mat"</span>,
    <span class="hljs-string">"the dog sat on the log"</span>,
    <span class="hljs-string">"cats and dogs are pets"</span>
]

query = <span class="hljs-string">"cat mat"</span>
document = <span class="hljs-string">"the cat sat on the mat"</span>

score = bm25(query, document, corpus)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"BM25分数: <span class="hljs-subst">{score}</span>"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-32">TF-IDF 与 BM25 对比总结</h4>













































<table><thead><tr><th>特性</th><th>TF-IDF</th><th>BM25</th></tr></thead><tbody><tr><td>提出时间</td><td>1972</td><td>1994</td></tr><tr><td>TF 增长</td><td>线性/对数</td><td>饱和曲线</td></tr><tr><td>长度归一化</td><td>需额外处理</td><td>内置参数 b</td></tr><tr><td>理论基础</td><td>信息论启发</td><td>概率检索模型</td></tr><tr><td>可调参数</td><td>无</td><td>k₁, b</td></tr><tr><td>现代地位</td><td>教学、简单场景</td><td>工业标准</td></tr><tr><td>代表产品</td><td>-</td><td>Elasticsearch, Lucene</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-33">🖼️ 第四纪元：感知哈希 (2000s)</h3>
<p><strong>发明背景与痛点</strong>：感知哈希（Perceptual Hash）最初为图像设计，2000年代开始广泛应用，其思想可延伸到文档（如PDF渲染后比较）。如何快速检测文档的视觉相似度，忽略格式差异？PDF/Word文档格式不同但内容相似，如何比较？如何在版权检测中识别轻微修改的文档？传统哈希对微小变化敏感，如何设计感知哈希？</p>
<p>感知哈希（Perceptual Hash）最初为图像设计，但其思想可延伸到文档（如PDF渲染后比较）。</p>
<h4 data-id="heading-34">pHash 家族</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph pHash家族演进
        AHASH["&lt;b&gt;aHash&lt;/b&gt;&lt;br/&gt;Average Hash&lt;br/&gt;最简单&lt;br/&gt;缩放→计算均值→二值化"]
        
        DHASH["&lt;b&gt;dHash&lt;/b&gt;&lt;br/&gt;Difference Hash&lt;br/&gt;相邻像素差值&lt;br/&gt;抗轻微变形"]
        
        PHASH["&lt;b&gt;pHash&lt;/b&gt;&lt;br/&gt;Perceptual Hash&lt;br/&gt;DCT变换&lt;br/&gt;鲁棒性最好"]
        
        WHASH["&lt;b&gt;wHash&lt;/b&gt;&lt;br/&gt;Wavelet Hash&lt;br/&gt;小波变换&lt;br/&gt;多分辨率分析"]
        
        AHASH --&gt;|"增加梯度"| DHASH
        DHASH --&gt;|"频域分析"| PHASH
        PHASH --&gt;|"多尺度"| WHASH
    end
</code></pre>








































<table><thead><tr><th>算法</th><th>原理</th><th>优点</th><th>缺点</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>aHash</strong></td><td>均值二值化</td><td>最快</td><td>抗干扰差</td><td>快速筛选</td></tr><tr><td><strong>dHash</strong></td><td>相邻差值</td><td>抗轻微变化</td><td>大变形敏感</td><td>缩略图匹配</td></tr><tr><td><strong>pHash</strong></td><td>DCT频域</td><td>最鲁棒</td><td>计算较慢</td><td>版权检测</td></tr><tr><td><strong>wHash</strong></td><td>小波变换</td><td>多尺度</td><td>复杂</td><td>专业场景</td></tr></tbody></table>
<p><strong>在文档领域的应用</strong>：</p>
<ul>
<li>PDF/Word 渲染为图片后比较</li>
<li>解决格式差异问题</li>
<li>结合 OCR 做视觉相似度</li>
</ul>
<p><strong>代码示例</strong>（以aHash为例）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> cv2
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">def</span> <span class="hljs-title function_">average_hash</span>(<span class="hljs-params">image_path: <span class="hljs-built_in">str</span>, hash_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">8</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    img = cv2.imread(image_path, cv2.IMREAD_GRAYSCALE)
    img = cv2.resize(img, (hash_size, hash_size))
    
    avg = np.mean(img)
    hash_str = <span class="hljs-string">''</span>.join([<span class="hljs-string">'1'</span> <span class="hljs-keyword">if</span> pixel &gt; avg <span class="hljs-keyword">else</span> <span class="hljs-string">'0'</span> <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> img <span class="hljs-keyword">for</span> pixel <span class="hljs-keyword">in</span> row])
    
    <span class="hljs-keyword">return</span> hash_str

<span class="hljs-keyword">def</span> <span class="hljs-title function_">hamming_distance</span>(<span class="hljs-params">hash1: <span class="hljs-built_in">str</span>, hash2: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">int</span>:
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(c1 != c2 <span class="hljs-keyword">for</span> c1, c2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(hash1, hash2))

hash1 = average_hash(<span class="hljs-string">"doc1.png"</span>)
hash2 = average_hash(<span class="hljs-string">"doc2.png"</span>)
distance = hamming_distance(hash1, hash2)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"汉明距离: <span class="hljs-subst">{distance}</span>"</span>)
</code></pre>
<hr/>
<h3 data-id="heading-35">🧠 第五纪元：词向量与分布式表示 (2013-2018)</h3>
<p>这一时期的革命性突破是将离散的词符号映射到连续的向量空间，使得词之间的语义关系可以通过向量运算表达。</p>
<h4 data-id="heading-36">5.1 Word2Vec (2013)</h4>
<p><strong>发明背景与痛点</strong>：2013年Tomas Mikolov等人在Google提出，开启了NLP的"预训练"时代。如何将离散的词符号映射到连续的向量空间？如何让词向量捕获语义关系（如 king - man + woman ≈ queen）？如何高效训练大规模词向量？One-Hot表示稀疏且无语义，如何改进？</p>
<p><strong>革命性意义</strong>：开启了 NLP 的"预训练"时代</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph 表示方式对比
        subgraph OneHot["传统 One-Hot"]
            OH1["king  = [1,0,0,0,0,...]"]
            OH2["queen = [0,1,0,0,0,...]"]
            OH3["man   = [0,0,1,0,0,...]"]
            OH_P["特点: 稀疏、高维、正交、无语义"]
        end
        
        subgraph Word2Vec表示
            WV1["king  = [0.2, 0.8, -0.1, ...]"]
            WV2["queen = [0.3, 0.9, -0.2, ...]"]
            WV3["man   = [0.1, 0.4,  0.2, ...]"]
            WV_P["特点: 稠密、低维、相似词距离近"]
        end
        
        MAGIC["king - man + woman ≈ queen"]
    end
</code></pre>
<h5 data-id="heading-37">两种训练架构</h5>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph CBOW["CBOW (Continuous Bag of Words)"]
        CTX1["上下文: [The] [cat] [_] [on] [mat]"]
        PRED1["预测: sat"]
        CTX1 --&gt; PRED1
        NOTE1["• 训练快&lt;br/&gt;• 适合大数据集&lt;br/&gt;• 高频词效果好"]
    end
    
    subgraph SkipGram["Skip-gram"]
        CENTER["中心词: sat"]
        CTX2["预测上下文: The, cat, on, mat"]
        CENTER --&gt; CTX2
        NOTE2["• 对低频词友好&lt;br/&gt;• 语义关系更好&lt;br/&gt;• 数据效率高"]
    end
</code></pre>


























<table><thead><tr><th>架构</th><th>输入</th><th>输出</th><th>优势</th><th>劣势</th></tr></thead><tbody><tr><td><strong>CBOW</strong></td><td>上下文词</td><td>中心词</td><td>训练快、高频词好</td><td>低频词差</td></tr><tr><td><strong>Skip-gram</strong></td><td>中心词</td><td>上下文词</td><td>低频词好、语义好</td><td>训练慢</td></tr></tbody></table>
<p><strong>优点</strong>：</p>
<ul>
<li>向量运算具有语义意义</li>
<li>训练高效（负采样技巧）</li>
<li>迁移性好</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>一词一向量，无法处理多义词</li>
<li>OOV（未登录词）问题</li>
<li>忽略词序</li>
</ul>
<p><strong>代码示例</strong>（简化版Skip-gram）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Word2Vec</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vocab_size: <span class="hljs-built_in">int</span>, embedding_dim: <span class="hljs-built_in">int</span> = <span class="hljs-number">100</span></span>):
        self.vocab_size = vocab_size
        self.embedding_dim = embedding_dim
        self.center_embeddings = np.random.randn(vocab_size, embedding_dim) * <span class="hljs-number">0.01</span>
        self.context_embeddings = np.random.randn(vocab_size, embedding_dim) * <span class="hljs-number">0.01</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">train_step</span>(<span class="hljs-params">self, center_idx: <span class="hljs-built_in">int</span>, context_idx: <span class="hljs-built_in">int</span>, learning_rate: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.01</span></span>):
        center_vec = self.center_embeddings[center_idx]
        context_vec = self.context_embeddings[context_idx]
        
        score = np.dot(center_vec, context_vec)
        pred = <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + np.exp(-score))
        
        error = pred - <span class="hljs-number">1</span>
        grad_center = error * context_vec
        grad_context = error * center_vec
        
        self.center_embeddings[center_idx] -= learning_rate * grad_center
        self.context_embeddings[context_idx] -= learning_rate * grad_context
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_embedding</span>(<span class="hljs-params">self, word_idx: <span class="hljs-built_in">int</span></span>) -&gt; np.ndarray:
        <span class="hljs-keyword">return</span> self.center_embeddings[word_idx]

w2v = Word2Vec(vocab_size=<span class="hljs-number">1000</span>, embedding_dim=<span class="hljs-number">50</span>)
w2v.train_step(center_idx=<span class="hljs-number">10</span>, context_idx=<span class="hljs-number">20</span>)
embedding = w2v.get_embedding(<span class="hljs-number">10</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"词向量维度: <span class="hljs-subst">{embedding.shape}</span>"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-38">5.2 GloVe (2014)</h4>
<p><strong>发明背景与痛点</strong>：2014年Jeffrey Pennington等人在Stanford提出GloVe（Global Vectors for Word Representation）。Word2Vec只使用局部上下文，如何利用全局统计信息？如何结合矩阵分解和神经网络的优势？如何设计词向量使得词对共现概率与向量点积相关？如何在词向量中编码全局语义关系？</p>
<p><strong>核心思想</strong>：结合全局统计信息（共现矩阵）和局部上下文</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph Word2Vec_vs_GloVe
        subgraph Word2Vec特点
            W1["训练: 局部上下文窗口滑动"]
            W2["目标: 预测 P(context|word)"]
            W3["方法: 神经网络"]
            W4["优势: 增量训练友好"]
        end
        
        subgraph GloVe特点
            G1["训练: 全局共现矩阵分解"]
            G2["目标: 拟合 log(共现概率)"]
            G3["方法: 矩阵分解 + 回归"]
            G4["优势: 利用全局统计"]
        end
    end
</code></pre>



































<table><thead><tr><th>维度</th><th>Word2Vec</th><th>GloVe</th></tr></thead><tbody><tr><td><strong>训练数据</strong></td><td>局部窗口</td><td>全局共现矩阵</td></tr><tr><td><strong>理论基础</strong></td><td>神经网络预测</td><td>矩阵分解</td></tr><tr><td><strong>增量学习</strong></td><td>支持</td><td>不支持</td></tr><tr><td><strong>类比任务</strong></td><td>好</td><td>更好</td></tr><tr><td><strong>训练效率</strong></td><td>中等</td><td>单次较慢</td></tr></tbody></table>
<p><strong>代码示例</strong>（简化版GloVe训练）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">def</span> <span class="hljs-title function_">glove_loss</span>(<span class="hljs-params">W: np.ndarray, U: np.ndarray, coocurrence: np.ndarray, 
               x_max: <span class="hljs-built_in">float</span> = <span class="hljs-number">100</span>, alpha: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.75</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    vocab_size = W.shape[<span class="hljs-number">0</span>]
    loss = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(vocab_size):
        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(vocab_size):
            X_ij = coocurrence[i, j]
            <span class="hljs-keyword">if</span> X_ij == <span class="hljs-number">0</span>:
                <span class="hljs-keyword">continue</span>
            
            f_xij = <span class="hljs-built_in">min</span>(<span class="hljs-number">1</span>, (X_ij / x_max) ** alpha)
            diff = np.dot(W[i], U[j]) - np.log(X_ij)
            loss += f_xij * (diff ** <span class="hljs-number">2</span>)
    
    <span class="hljs-keyword">return</span> loss

vocab_size = <span class="hljs-number">1000</span>
embedding_dim = <span class="hljs-number">50</span>
W = np.random.randn(vocab_size, embedding_dim) * <span class="hljs-number">0.01</span>
U = np.random.randn(vocab_size, embedding_dim) * <span class="hljs-number">0.01</span>
coocurrence = np.random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, (vocab_size, vocab_size))

loss = glove_loss(W, U, coocurrence)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"GloVe损失: <span class="hljs-subst">{loss}</span>"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-39">5.3 FastText (2016)</h4>
<p><strong>发明背景与痛点</strong>：2016年Facebook AI Research提出FastText，核心创新是使用子词（subword）表示。Word2Vec无法处理OOV（未登录词）：遇到训练集中没有的词时，无法生成词向量；形态学信息丢失：无法捕获词根、前缀、后缀等形态变化，如"run"和"running"被视为完全不同的词；拼写错误敏感：一个字符错误就导致无法识别；多语言支持差：对于形态丰富的语言（如芬兰语、土耳其语），需要更大的训练数据。</p>
<p><strong>核心创新</strong>：使用子词（subword）表示</p>
<p><strong>示例</strong>：</p>
<ul>
<li>"where" → {"&lt;wh", "whe", "her", "ere", "re&gt;", ""}</li>
<li>新词 "wherefrom" 可通过子词组合获得向量</li>
</ul>
<p><strong>优点</strong>：</p>
<ul>
<li>有效处理 OOV</li>
<li>对形态丰富的语言效果好</li>
<li>拼写错误鲁棒性</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>向量维度更大</li>
<li>中文等无明确子词语言效果有限</li>
</ul>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FastText</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vocab_size: <span class="hljs-built_in">int</span>, embedding_dim: <span class="hljs-built_in">int</span> = <span class="hljs-number">100</span>, min_n: <span class="hljs-built_in">int</span> = <span class="hljs-number">3</span>, max_n: <span class="hljs-built_in">int</span> = <span class="hljs-number">6</span></span>):
        self.vocab_size = vocab_size
        self.embedding_dim = embedding_dim
        self.min_n = min_n
        self.max_n = max_n
        self.word_embeddings = np.random.randn(vocab_size, embedding_dim) * <span class="hljs-number">0.01</span>
        self.ngram_embeddings = defaultdict(<span class="hljs-keyword">lambda</span>: np.random.randn(embedding_dim) * <span class="hljs-number">0.01</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_ngrams</span>(<span class="hljs-params">self, word: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">list</span>:
        ngrams = []
        word = <span class="hljs-string">f"&lt;<span class="hljs-subst">{word}</span>&gt;"</span>
        
        <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.min_n, <span class="hljs-built_in">min</span>(<span class="hljs-built_in">len</span>(word), self.max_n) + <span class="hljs-number">1</span>):
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(word) - n + <span class="hljs-number">1</span>):
                ngram = word[i:i+n]
                ngrams.append(ngram)
        
        <span class="hljs-keyword">return</span> ngrams
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_word_vector</span>(<span class="hljs-params">self, word: <span class="hljs-built_in">str</span>, word_idx: <span class="hljs-built_in">int</span> = <span class="hljs-literal">None</span></span>) -&gt; np.ndarray:
        ngrams = self.get_ngrams(word)
        
        <span class="hljs-keyword">if</span> word_idx <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            vec = self.word_embeddings[word_idx].copy()
        <span class="hljs-keyword">else</span>:
            vec = np.zeros(self.embedding_dim)
        
        <span class="hljs-keyword">for</span> ngram <span class="hljs-keyword">in</span> ngrams:
            vec += self.ngram_embeddings[ngram]
        
        vec /= (<span class="hljs-built_in">len</span>(ngrams) + <span class="hljs-number">1</span>)
        
        <span class="hljs-keyword">return</span> vec
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">train_step</span>(<span class="hljs-params">self, word_idx: <span class="hljs-built_in">int</span>, context_idx: <span class="hljs-built_in">int</span>, learning_rate: <span class="hljs-built_in">float</span> = <span class="hljs-number">0.01</span></span>):
        word_vec = self.get_word_vector(<span class="hljs-string">""</span>, word_idx)
        context_vec = self.get_word_vector(<span class="hljs-string">""</span>, context_idx)
        
        score = np.dot(word_vec, context_vec)
        pred = <span class="hljs-number">1</span> / (<span class="hljs-number">1</span> + np.exp(-score))
        
        error = pred - <span class="hljs-number">1</span>
        grad = error * context_vec
        
        self.word_embeddings[word_idx] -= learning_rate * grad
        
        ngrams = self.get_ngrams(<span class="hljs-string">""</span>)
        <span class="hljs-keyword">for</span> ngram <span class="hljs-keyword">in</span> ngrams:
            self.ngram_embeddings[ngram] -= learning_rate * grad / <span class="hljs-built_in">len</span>(ngrams)

vocab_size = <span class="hljs-number">1000</span>
embedding_dim = <span class="hljs-number">50</span>
ft = FastText(vocab_size, embedding_dim)

word_vector = ft.get_word_vector(<span class="hljs-string">"running"</span>, word_idx=<span class="hljs-number">0</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"FastText词向量维度: <span class="hljs-subst">{word_vector.shape}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"词向量: <span class="hljs-subst">{word_vector[:<span class="hljs-number">5</span>]}</span>"</span>)

oov_word_vector = ft.get_word_vector(<span class="hljs-string">"unbelievable"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"OOV词向量维度: <span class="hljs-subst">{oov_word_vector.shape}</span>"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-40">5.4 ELMo (2018)</h4>
<p><strong>发明背景与痛点</strong>：2018年AllenNLP提出ELMo（Embeddings from Language Models），革命性创新是上下文相关的词向量。静态词向量的多义词困境：Word2Vec、GloVe等静态词向量为每个词分配固定向量，无法区分同一词在不同上下文中的不同含义，如"bank"在"river bank"和"bank account"中语义完全不同但向量相同；上下文信息缺失：无法利用词的上下文环境来丰富词的表示，导致语义理解能力有限；单一表示的局限性：一个词可能有多种含义、用法和语法功能，静态向量无法同时表达这些信息；下游任务性能瓶颈：在问答、情感分析等需要深度语义理解的复杂任务中，静态词向量性能受限。</p>
<p><strong>核心思想</strong>：使用双向 LSTM 语言模型，词的向量取决于其上下文。</p>
<p><strong>优点</strong>：</p>
<ul>
<li>上下文感知</li>
<li>多义词区分</li>
<li>预训练+微调范式</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>LSTM 并行效率低</li>
<li>很快被 BERT 超越</li>
</ul>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ELMO_Layer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, input_dim: <span class="hljs-built_in">int</span>, hidden_dim: <span class="hljs-built_in">int</span></span>):
        self.input_dim = input_dim
        self.hidden_dim = hidden_dim
        
        self.W_xh = np.random.randn(input_dim, hidden_dim) * <span class="hljs-number">0.01</span>
        self.W_hh = np.random.randn(hidden_dim, hidden_dim) * <span class="hljs-number">0.01</span>
        self.b_h = np.zeros(hidden_dim)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x: np.ndarray, h_prev: np.ndarray</span>) -&gt; np.ndarray:
        h = np.tanh(np.dot(x, self.W_xh) + np.dot(h_prev, self.W_hh) + self.b_h)
        <span class="hljs-keyword">return</span> h

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ELMo</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vocab_size: <span class="hljs-built_in">int</span>, embedding_dim: <span class="hljs-built_in">int</span> = <span class="hljs-number">100</span>, hidden_dim: <span class="hljs-built_in">int</span> = <span class="hljs-number">256</span>, num_layers: <span class="hljs-built_in">int</span> = <span class="hljs-number">2</span></span>):
        self.vocab_size = vocab_size
        self.embedding_dim = embedding_dim
        self.hidden_dim = hidden_dim
        self.num_layers = num_layers
        
        self.word_embeddings = np.random.randn(vocab_size, embedding_dim) * <span class="hljs-number">0.01</span>
        
        self.forward_layers = [ELMO_Layer(embedding_dim, hidden_dim)]
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_layers - <span class="hljs-number">1</span>):
            self.forward_layers.append(ELMO_Layer(hidden_dim, hidden_dim))
        
        self.backward_layers = [ELMO_Layer(embedding_dim, hidden_dim)]
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_layers - <span class="hljs-number">1</span>):
            self.backward_layers.append(ELMO_Layer(hidden_dim, hidden_dim))
        
        self.softmax_weights = np.random.randn(hidden_dim * <span class="hljs-number">2</span>, vocab_size) * <span class="hljs-number">0.01</span>
        self.softmax_bias = np.zeros(vocab_size)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_contextual_embeddings</span>(<span class="hljs-params">self, word_indices: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">list</span>:
        seq_len = <span class="hljs-built_in">len</span>(word_indices)
        
        forward_embeddings = []
        backward_embeddings = []
        
        h_forward = [np.zeros(self.hidden_dim) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.num_layers)]
        h_backward = [np.zeros(self.hidden_dim) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.num_layers)]
        
        forward_outputs = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.num_layers)]
        backward_outputs = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.num_layers)]
        
        <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(seq_len):
            x = self.word_embeddings[word_indices[t]]
            
            <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.num_layers):
                <span class="hljs-keyword">if</span> layer == <span class="hljs-number">0</span>:
                    h_forward[layer] = self.forward_layers[layer].forward(x, h_forward[layer])
                <span class="hljs-keyword">else</span>:
                    h_forward[layer] = self.forward_layers[layer].forward(h_forward[layer-<span class="hljs-number">1</span>], h_forward[layer])
                
                forward_outputs[layer].append(h_forward[layer].copy())
        
        <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(seq_len - <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>):
            x = self.word_embeddings[word_indices[t]]
            
            <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.num_layers):
                <span class="hljs-keyword">if</span> layer == <span class="hljs-number">0</span>:
                    h_backward[layer] = self.backward_layers[layer].forward(x, h_backward[layer])
                <span class="hljs-keyword">else</span>:
                    h_backward[layer] = self.backward_layers[layer].forward(h_backward[layer-<span class="hljs-number">1</span>], h_backward[layer])
                
                backward_outputs[layer].insert(<span class="hljs-number">0</span>, h_backward[layer].copy())
        
        contextual_embeddings = []
        <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(seq_len):
            layer_representations = []
            
            <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.num_layers):
                concat = np.concatenate([forward_outputs[layer][t], backward_outputs[layer][t]])
                layer_representations.append(concat)
            
            contextual_embeddings.append(layer_representations)
        
        <span class="hljs-keyword">return</span> contextual_embeddings
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_elmo_embedding</span>(<span class="hljs-params">self, word_indices: <span class="hljs-built_in">list</span>, position: <span class="hljs-built_in">int</span>, task_weights: np.ndarray = <span class="hljs-literal">None</span></span>) -&gt; np.ndarray:
        <span class="hljs-keyword">if</span> task_weights <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            task_weights = np.array([<span class="hljs-number">0.33</span>, <span class="hljs-number">0.33</span>, <span class="hljs-number">0.34</span>])
        
        contextual_embeddings = self.get_contextual_embeddings(word_indices)
        layer_reps = contextual_embeddings[position]
        
        elmo_embedding = np.zeros_like(layer_reps[<span class="hljs-number">0</span>])
        <span class="hljs-keyword">for</span> i, rep <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(layer_reps):
            elmo_embedding += task_weights[i] * rep
        
        <span class="hljs-keyword">return</span> elmo_embedding

vocab_size = <span class="hljs-number">1000</span>
embedding_dim = <span class="hljs-number">100</span>
hidden_dim = <span class="hljs-number">256</span>
num_layers = <span class="hljs-number">2</span>

elmo = ELMo(vocab_size, embedding_dim, hidden_dim, num_layers)

sentence1 = [<span class="hljs-number">10</span>, <span class="hljs-number">25</span>, <span class="hljs-number">3</span>, <span class="hljs-number">47</span>, <span class="hljs-number">8</span>]
sentence2 = [<span class="hljs-number">10</span>, <span class="hljs-number">25</span>, <span class="hljs-number">3</span>, <span class="hljs-number">99</span>, <span class="hljs-number">8</span>]

elmo_vec1 = elmo.get_elmo_embedding(sentence1, position=<span class="hljs-number">3</span>)
elmo_vec2 = elmo.get_elmo_embedding(sentence2, position=<span class="hljs-number">3</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"ELMo词向量维度: <span class="hljs-subst">{elmo_vec1.shape}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"相似度: <span class="hljs-subst">{np.dot(elmo_vec1, elmo_vec2) / (np.linalg.norm(elmo_vec1) * np.linalg.norm(elmo_vec2))}</span>"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-41">5.5 从词向量到文档向量</h4>
<p><strong>发明背景与痛点</strong>：词向量到文档向量的鸿沟：虽然Word2Vec、GloVe等可以生成高质量的词向量，但如何将这些词向量有效聚合为文档向量仍然是一个挑战；简单平均的缺陷：直接对词向量取平均会丢失词序信息，且容易被高频词（如"the"、"is"等）主导，导致文档表示不准确；词序和结构丢失：文档的语法结构、句子顺序、段落组织等重要信息在简单聚合中完全丢失；长短文档表示不一致：简单平均方法对不同长度的文档表示效果差异大，短文档可能信息不足，长文档可能信息过载；语义理解深度不足：无法捕获文档的主题、情感、意图等高层语义特征。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph 文档向量聚合策略
        M1["&lt;b&gt;方法1: 简单平均&lt;/b&gt;&lt;br/&gt;doc = mean(word_vecs)&lt;br/&gt;✓ 简单&lt;br/&gt;✗ 丢失词序，被高频词主导"]
        
        M2["&lt;b&gt;方法2: TF-IDF 加权平均&lt;/b&gt;&lt;br/&gt;doc = Σ(tfidf × vec) / Σ(tfidf)&lt;br/&gt;✓ 突出重要词&lt;br/&gt;✗ 仍丢失词序"]
        
        M3["&lt;b&gt;方法3: Doc2Vec&lt;/b&gt;&lt;br/&gt;端到端学习文档向量&lt;br/&gt;✓ 保留上下文&lt;br/&gt;✗ 需要训练"]
        
        M4["&lt;b&gt;方法4: Soft Cosine&lt;/b&gt;&lt;br/&gt;考虑词间相似度矩阵&lt;br/&gt;✓ 更精确&lt;br/&gt;✗ 计算开销大"]
        
        M1 --&gt; M2 --&gt; M3 --&gt; M4
    end
</code></pre>
<h5 data-id="heading-42">Soft Cosine Similarity</h5>
<p><strong>核心思想</strong>：传统余弦相似度假设不同词完全正交，Soft Cosine 引入词相似度矩阵。</p>
<p><strong>公式</strong>：
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>soft_cos</mtext><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><msup><mi>a</mi><mi>T</mi></msup><mi>S</mi><mi>b</mi></mrow><mrow><msqrt><mrow><msup><mi>a</mi><mi>T</mi></msup><mi>S</mi><mi>a</mi></mrow></msqrt><mo>×</mo><msqrt><mrow><msup><mi>b</mi><mi>T</mi></msup><mi>S</mi><mi>b</mi></mrow></msqrt></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{soft\_cos}(a, b) = \frac{a^T S b}{\sqrt{a^T S a} \times \sqrt{b^T S b}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"/><span class="mord text"><span class="mord">soft_cos</span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">b</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.5901em;vertical-align:-0.5527em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0374em;"><span style="top:-2.5056em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9777em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7741em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mord mathnormal mtight">a</span></span></span><span style="top:-2.9377em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.0623em;"><span/></span></span></span></span><span class="mbin mtight">×</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9777em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7741em;"><span style="top:-2.786em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mord mathnormal mtight">b</span></span></span><span style="top:-2.9377em;"><span class="pstrut" style="height:3em;"/><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewbox="0 0 400000 1080" preserveaspectratio="xMinYMin slice"><path d="M95,702&#10;c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14&#10;c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54&#10;c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10&#10;s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429&#10;c69,-144,104.5,-217.7,106.5,-221&#10;l0 -0&#10;c5.3,-9.3,12,-14,20,-14&#10;H400000v40H845.2724&#10;s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7&#10;c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z&#10;M834 80h400000v40h-400000z"/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.0623em;"><span/></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.9191em;"><span style="top:-2.931em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mord mathnormal mtight">b</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.5527em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
<p>其中 S 是词相似度矩阵，<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>cos</mi><mo>⁡</mo><mo stretchy="false">(</mo><mover accent="true"><msub><mi>w</mi><mi>i</mi></msub><mo>⃗</mo></mover><mo separator="true">,</mo><mover accent="true"><msub><mi>w</mi><mi>j</mi></msub><mo>⃗</mo></mover><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">S_{ij} = \cos(\vec{w_i}, \vec{w_j})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"/><span class="mop">cos</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.714em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="mord"><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"/><span class="accent-body" style="left:-0.2355em;"><span class="overlay" style="height:0.714em;width:0.471em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"><path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5&#10;3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11&#10;10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63&#10;-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1&#10;-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59&#10;H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359&#10;c-16-25.333-24-45-24-59z"/></svg></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span><span class="mclose">)</span></span></span></span></span></p>
<p><strong>优点</strong>：</p>
<ul>
<li>考虑同义词关系</li>
<li>更精确的相似度计算</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li>需要预计算相似度矩阵</li>
<li>计算复杂度增加</li>
</ul>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">def</span> <span class="hljs-title function_">cosine_similarity</span>(<span class="hljs-params">vec1: np.ndarray, vec2: np.ndarray</span>) -&gt; <span class="hljs-built_in">float</span>:
    norm1 = np.linalg.norm(vec1)
    norm2 = np.linalg.norm(vec2)
    <span class="hljs-keyword">if</span> norm1 == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> norm2 == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>
    <span class="hljs-keyword">return</span> np.dot(vec1, vec2) / (norm1 * norm2)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">soft_cosine_similarity</span>(<span class="hljs-params">doc1: np.ndarray, doc2: np.ndarray, 
                           word_embeddings: <span class="hljs-built_in">dict</span>, vocab: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">float</span>:
    S = np.zeros((<span class="hljs-built_in">len</span>(vocab), <span class="hljs-built_in">len</span>(vocab)))
    
    <span class="hljs-keyword">for</span> i, word1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(vocab):
        <span class="hljs-keyword">for</span> j, word2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(vocab):
            <span class="hljs-keyword">if</span> word1 <span class="hljs-keyword">in</span> word_embeddings <span class="hljs-keyword">and</span> word2 <span class="hljs-keyword">in</span> word_embeddings:
                S[i, j] = cosine_similarity(word_embeddings[word1], word_embeddings[word2])
    
    numerator = np.dot(np.dot(doc1.T, S), doc2)
    denominator = np.sqrt(np.dot(np.dot(doc1.T, S), doc1)) * np.sqrt(np.dot(np.dot(doc2.T, S), doc2))
    
    <span class="hljs-keyword">if</span> denominator == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>
    
    <span class="hljs-keyword">return</span> numerator / denominator

<span class="hljs-keyword">def</span> <span class="hljs-title function_">simple_average_document_vector</span>(<span class="hljs-params">word_vectors: <span class="hljs-built_in">list</span></span>) -&gt; np.ndarray:
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(word_vectors) == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> np.zeros(word_vectors[<span class="hljs-number">0</span>].shape)
    <span class="hljs-keyword">return</span> np.mean(word_vectors, axis=<span class="hljs-number">0</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">tfidf_weighted_document_vector</span>(<span class="hljs-params">word_vectors: <span class="hljs-built_in">list</span>, tfidf_weights: <span class="hljs-built_in">list</span></span>) -&gt; np.ndarray:
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(word_vectors) == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> np.zeros(word_vectors[<span class="hljs-number">0</span>].shape)
    
    weighted_sum = np.zeros_like(word_vectors[<span class="hljs-number">0</span>])
    total_weight = <span class="hljs-number">0</span>
    
    <span class="hljs-keyword">for</span> vec, weight <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(word_vectors, tfidf_weights):
        weighted_sum += weight * vec
        total_weight += weight
    
    <span class="hljs-keyword">if</span> total_weight == <span class="hljs-number">0</span>:
        <span class="hljs-keyword">return</span> np.zeros_like(word_vectors[<span class="hljs-number">0</span>])
    
    <span class="hljs-keyword">return</span> weighted_sum / total_weight

vocab = [<span class="hljs-string">'cat'</span>, <span class="hljs-string">'dog'</span>, <span class="hljs-string">'pet'</span>, <span class="hljs-string">'animal'</span>, <span class="hljs-string">'feline'</span>, <span class="hljs-string">'canine'</span>]
word_embeddings = {
    <span class="hljs-string">'cat'</span>: np.random.randn(<span class="hljs-number">50</span>),
    <span class="hljs-string">'dog'</span>: np.random.randn(<span class="hljs-number">50</span>),
    <span class="hljs-string">'pet'</span>: np.random.randn(<span class="hljs-number">50</span>),
    <span class="hljs-string">'animal'</span>: np.random.randn(<span class="hljs-number">50</span>),
    <span class="hljs-string">'feline'</span>: np.random.randn(<span class="hljs-number">50</span>),
    <span class="hljs-string">'canine'</span>: np.random.randn(<span class="hljs-number">50</span>)
}

doc1_vecs = [word_embeddings[<span class="hljs-string">'cat'</span>], word_embeddings[<span class="hljs-string">'pet'</span>], word_embeddings[<span class="hljs-string">'animal'</span>]]
doc2_vecs = [word_embeddings[<span class="hljs-string">'dog'</span>], word_embeddings[<span class="hljs-string">'pet'</span>], word_embeddings[<span class="hljs-string">'animal'</span>]]

doc1_simple = simple_average_document_vector(doc1_vecs)
doc2_simple = simple_average_document_vector(doc2_vecs)

similarity_simple = cosine_similarity(doc1_simple, doc2_simple)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"简单平均相似度: <span class="hljs-subst">{similarity_simple:<span class="hljs-number">.4</span>f}</span>"</span>)

doc1_tfidf = tfidf_weighted_document_vector(doc1_vecs, [<span class="hljs-number">0.8</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.3</span>])
doc2_tfidf = tfidf_weighted_document_vector(doc2_vecs, [<span class="hljs-number">0.7</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.3</span>])

similarity_tfidf = cosine_similarity(doc1_tfidf, doc2_tfidf)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"TF-IDF加权相似度: <span class="hljs-subst">{similarity_tfidf:<span class="hljs-number">.4</span>f}</span>"</span>)

doc1_bow = np.array([<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>])
doc2_bow = np.array([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>])

similarity_soft = soft_cosine_similarity(doc1_bow, doc2_bow, word_embeddings, vocab)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Soft Cosine相似度: <span class="hljs-subst">{similarity_soft:<span class="hljs-number">.4</span>f}</span>"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-43">词向量时代方法对比</h4>













































<table><thead><tr><th>方法</th><th>年份</th><th>发明方</th><th>核心创新</th><th>优势</th><th>局限</th></tr></thead><tbody><tr><td><strong>Word2Vec</strong></td><td>2013</td><td>Google</td><td>局部上下文预测</td><td>训练高效</td><td>静态向量、OOV</td></tr><tr><td><strong>GloVe</strong></td><td>2014</td><td>Stanford</td><td>全局共现统计</td><td>类比任务好</td><td>无法增量</td></tr><tr><td><strong>FastText</strong></td><td>2016</td><td>Facebook</td><td>子词表示</td><td>处理OOV</td><td>中文效果有限</td></tr><tr><td><strong>ELMo</strong></td><td>2018</td><td>AllenNLP</td><td>上下文相关</td><td>多义词区分</td><td>效率低</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-44">🤖 第六纪元：Transformer 与预训练时代 (2017-至今)</h3>
<p>这一时期彻底改变了 NLP 的范式：从"特征工程 + 浅层模型"转向"预训练 + 微调"。</p>
<h4 data-id="heading-45">6.1 Transformer 革命 (2017)</h4>
<p><strong>发明背景与痛点</strong>：2017年Vaswani等人在Google发表"Attention Is All You Need"论文。RNN/LSTM的序列依赖瓶颈：RNN和LSTM必须按顺序处理输入，无法充分利用GPU的并行计算能力，训练速度慢且难以扩展；长距离依赖问题：随着序列长度增加，RNN/LSTM难以捕获远距离词之间的依赖关系，梯度消失和梯度爆炸问题严重；固定上下文窗口：CNN等模型使用固定大小的窗口捕获上下文，无法灵活处理不同长度的依赖关系；单向信息的局限：单向RNN只能利用过去或未来的信息，无法同时利用双向上下文；计算效率与性能的权衡：传统方法在提升模型性能时往往以牺牲计算效率为代价。</p>
<p><strong>核心创新</strong>：用自注意力机制完全替代 RNN/LSTM</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph Transformer影响
        TRANS["Transformer 2017"]
        
        TRANS --&gt; BERT["BERT 2018&lt;br/&gt;双向编码&lt;br/&gt;理解任务"]
        TRANS --&gt; GPT["GPT 2018&lt;br/&gt;单向解码&lt;br/&gt;生成任务"]
        
        BERT --&gt; SBERT["Sentence-BERT 2019"]
        BERT --&gt; ROBERTA["RoBERTa 2019"]
        
        GPT --&gt; GPT2["GPT-2 2019"]
        GPT2 --&gt; GPT3["GPT-3 2020"]
        GPT3 --&gt; CHATGPT["ChatGPT 2022"]
    end
</code></pre>
<p><strong>为什么 Transformer 胜出</strong>：</p>






























<table><thead><tr><th>维度</th><th>RNN/LSTM</th><th>Transformer</th></tr></thead><tbody><tr><td><strong>并行性</strong></td><td>序列依赖，无法并行</td><td>完全并行</td></tr><tr><td><strong>长距离依赖</strong></td><td>梯度消失/爆炸</td><td>注意力直接连接</td></tr><tr><td><strong>训练速度</strong></td><td>慢</td><td>快很多</td></tr><tr><td><strong>扩展性</strong></td><td>有限</td><td>可扩展到超大规模</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-46">6.2 BERT (2018)</h4>
<p><strong>发明背景与痛点</strong>：2018年Google AI Language提出BERT（Bidirectional Encoder Representations from Transformers）。静态词向量的上下文盲区：Word2Vec、GloVe等静态词向量无法根据上下文动态调整词的表示，无法解决多义词问题；单向模型的局限：GPT等单向语言模型只能利用单向上下文，无法同时捕获完整的上下文信息；预训练与微调的鸿沟：传统方法难以将大规模无监督预训练的知识有效迁移到下游任务；特征工程的繁琐：传统NLP任务需要大量人工设计特征，效率低且依赖领域知识；任务特异性强：每个任务需要单独训练模型，无法共享通用的语言理解能力。</p>
<p><strong>预训练任务</strong>：</p>
<ol>
<li><strong>MLM (Masked Language Model)</strong>：随机遮盖15%的词，预测被遮盖的词</li>
<li><strong>NSP (Next Sentence Prediction)</strong>：预测两个句子是否连续</li>
</ol>
<p><strong>用于相似度的问题</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph CrossEncoder问题
        INPUT["输入: [CLS] Sent A [SEP] Sent B [SEP]"]
        BERT["BERT 推理"]
        OUTPUT["输出: 相似度分数"]
        
        INPUT --&gt; BERT --&gt; OUTPUT
        
        PROBLEM["&lt;b&gt;问题&lt;/b&gt;: 比较 n 个文档&lt;br/&gt;需要 n×(n-1)/2 次 BERT 推理!"]
    end
</code></pre>
<p><strong>计算量灾难</strong>：</p>






























<table><thead><tr><th>文档数量</th><th>配对数</th><th>推理次数 (100ms/次)</th></tr></thead><tbody><tr><td>100</td><td>4,950</td><td>8.25 分钟</td></tr><tr><td>1,000</td><td>499,500</td><td>13.8 小时</td></tr><tr><td>10,000</td><td>49,995,000</td><td>57.8 天</td></tr><tr><td>100,000</td><td>4,999,950,000</td><td>15.8 年</td></tr></tbody></table>
<p><strong>结论</strong>：BERT 的 Cross-Encoder 方式无法用于大规模检索</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Attention</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, d_model: <span class="hljs-built_in">int</span></span>):
        self.d_model = d_model
        self.W_q = np.random.randn(d_model, d_model) * <span class="hljs-number">0.01</span>
        self.W_k = np.random.randn(d_model, d_model) * <span class="hljs-number">0.01</span>
        self.W_v = np.random.randn(d_model, d_model) * <span class="hljs-number">0.01</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x: np.ndarray</span>) -&gt; np.ndarray:
        Q = np.dot(x, self.W_q)
        K = np.dot(x, self.W_k)
        V = np.dot(x, self.W_v)
        
        scores = np.dot(Q, K.T) / np.sqrt(self.d_model)
        attention_weights = self.softmax(scores)
        
        output = np.dot(attention_weights, V)
        <span class="hljs-keyword">return</span> output
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">softmax</span>(<span class="hljs-params">self, x: np.ndarray</span>) -&gt; np.ndarray:
        exp_x = np.exp(x - np.<span class="hljs-built_in">max</span>(x, axis=-<span class="hljs-number">1</span>, keepdims=<span class="hljs-literal">True</span>))
        <span class="hljs-keyword">return</span> exp_x / np.<span class="hljs-built_in">sum</span>(exp_x, axis=-<span class="hljs-number">1</span>, keepdims=<span class="hljs-literal">True</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiHeadAttention</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, d_model: <span class="hljs-built_in">int</span>, num_heads: <span class="hljs-built_in">int</span></span>):
        self.d_model = d_model
        self.num_heads = num_heads
        self.d_k = d_model // num_heads
        
        self.attentions = [Attention(self.d_k) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_heads)]
        self.W_o = np.random.randn(d_model, d_model) * <span class="hljs-number">0.01</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x: np.ndarray</span>) -&gt; np.ndarray:
        heads = []
        <span class="hljs-keyword">for</span> attention <span class="hljs-keyword">in</span> self.attentions:
            head = attention.forward(x)
            heads.append(head)
        
        concatenated = np.concatenate(heads, axis=-<span class="hljs-number">1</span>)
        output = np.dot(concatenated, self.W_o)
        <span class="hljs-keyword">return</span> output

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TransformerEncoder</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, d_model: <span class="hljs-built_in">int</span>, num_heads: <span class="hljs-built_in">int</span>, d_ff: <span class="hljs-built_in">int</span>, num_layers: <span class="hljs-built_in">int</span></span>):
        self.d_model = d_model
        self.num_heads = num_heads
        self.d_ff = d_ff
        self.num_layers = num_layers
        
        self.attention_layers = [MultiHeadAttention(d_model, num_heads) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_layers)]
        self.feed_forward_layers = [
            (np.random.randn(d_model, d_ff) * <span class="hljs-number">0.01</span>, np.zeros(d_ff),
             np.random.randn(d_ff, d_model) * <span class="hljs-number">0.01</span>, np.zeros(d_model))
            <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_layers)
        ]
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x: np.ndarray</span>) -&gt; np.ndarray:
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(self.num_layers):
            attn_out = self.attention_layers[i].forward(x)
            x = x + attn_out
            
            W1, b1, W2, b2 = self.feed_forward_layers[i]
            ff_out = np.dot(np.maximum(<span class="hljs-number">0</span>, np.dot(x, W1) + b1), W2) + b2
            x = x + ff_out
        
        <span class="hljs-keyword">return</span> x

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BERT</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vocab_size: <span class="hljs-built_in">int</span>, d_model: <span class="hljs-built_in">int</span> = <span class="hljs-number">768</span>, num_heads: <span class="hljs-built_in">int</span> = <span class="hljs-number">12</span>, 
                 num_layers: <span class="hljs-built_in">int</span> = <span class="hljs-number">12</span>, max_seq_len: <span class="hljs-built_in">int</span> = <span class="hljs-number">512</span></span>):
        self.vocab_size = vocab_size
        self.d_model = d_model
        self.max_seq_len = max_seq_len
        
        self.token_embeddings = np.random.randn(vocab_size, d_model) * <span class="hljs-number">0.01</span>
        self.position_embeddings = np.random.randn(max_seq_len, d_model) * <span class="hljs-number">0.01</span>
        self.segment_embeddings = np.random.randn(<span class="hljs-number">2</span>, d_model) * <span class="hljs-number">0.01</span>
        
        self.encoder = TransformerEncoder(d_model, num_heads, d_ff=<span class="hljs-number">3072</span>, num_layers=num_layers)
        
        self.mlm_head = np.random.randn(d_model, vocab_size) * <span class="hljs-number">0.01</span>
        self.nsp_head = np.random.randn(d_model, <span class="hljs-number">2</span>) * <span class="hljs-number">0.01</span>
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">embed</span>(<span class="hljs-params">self, token_ids: np.ndarray, segment_ids: np.ndarray</span>) -&gt; np.ndarray:
        seq_len = <span class="hljs-built_in">len</span>(token_ids)
        
        token_emb = self.token_embeddings[token_ids]
        pos_emb = self.position_embeddings[:seq_len]
        seg_emb = self.segment_embeddings[segment_ids]
        
        <span class="hljs-keyword">return</span> token_emb + pos_emb + seg_emb
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, token_ids: np.ndarray, segment_ids: np.ndarray</span>) -&gt; <span class="hljs-built_in">tuple</span>:
        embeddings = self.embed(token_ids, segment_ids)
        encoded = self.encoder.forward(embeddings)
        
        cls_embedding = encoded[<span class="hljs-number">0</span>]
        
        mlm_logits = np.dot(encoded, self.mlm_head.T)
        nsp_logits = np.dot(cls_embedding, self.nsp_head.T)
        
        <span class="hljs-keyword">return</span> mlm_logits, nsp_logits
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">predict_masked_tokens</span>(<span class="hljs-params">self, token_ids: np.ndarray, segment_ids: np.ndarray, 
                              mask_positions: <span class="hljs-built_in">list</span></span>) -&gt; <span class="hljs-built_in">list</span>:
        mlm_logits, _ = self.forward(token_ids, segment_ids)
        
        predictions = []
        <span class="hljs-keyword">for</span> pos <span class="hljs-keyword">in</span> mask_positions:
            pred_token = np.argmax(mlm_logits[pos])
            predictions.append(pred_token)
        
        <span class="hljs-keyword">return</span> predictions

vocab_size = <span class="hljs-number">30000</span>
d_model = <span class="hljs-number">256</span>
num_heads = <span class="hljs-number">8</span>
num_layers = <span class="hljs-number">6</span>

bert = BERT(vocab_size, d_model, num_heads, num_layers)

token_ids = np.array([<span class="hljs-number">101</span>, <span class="hljs-number">2009</span>, <span class="hljs-number">2003</span>, <span class="hljs-number">103</span>, <span class="hljs-number">102</span>])
segment_ids = np.array([<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>])

mlm_logits, nsp_logits = bert.forward(token_ids, segment_ids)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"MLM输出形状: <span class="hljs-subst">{mlm_logits.shape}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"NSP输出形状: <span class="hljs-subst">{nsp_logits.shape}</span>"</span>)

mask_positions = [<span class="hljs-number">3</span>]
predictions = bert.predict_masked_tokens(token_ids, segment_ids, mask_positions)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"预测的掩码词ID: <span class="hljs-subst">{predictions}</span>"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-47">6.3 Sentence-BERT (2019)</h4>
<p><strong>发明背景与痛点</strong>：2019年Nils Reimers和Iryna Gurevych提出Sentence-BERT。BERT Cross-Encoder的计算爆炸：BERT的Cross-Encoder架构需要将两个句子拼接后一起编码，比较n个文档需要n×(n-1)/2次推理，在大规模检索场景下完全不可行；无法预计算和缓存：Cross-Encoder无法预先计算文档向量，每次查询都需要对所有候选文档重新编码，无法利用向量数据库加速；召回效率低下：在语义搜索、文档检索等需要从海量文档中召回的场景中，BERT无法满足实时性要求；双向编码的语义理解优势无法利用：BERT的双向编码提供了强大的语义理解能力，但Cross-Encoder架构限制了其在检索场景的应用；缺乏高效的句子级表示：虽然BERT可以生成词级别的上下文表示，但缺乏有效的句子级向量表示方法。</p>
<p><strong>核心创新</strong>：Bi-Encoder 架构，将句子编码为独立向量</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph BiEncoder架构
        SA["Sentence A"] --&gt; BERTA["BERT Encoder"]
        SB["Sentence B"] --&gt; BERTB["BERT Encoder&lt;br/&gt;(共享权重)"]
        
        BERTA --&gt; POOLA["Pooling"]
        BERTB --&gt; POOLB["Pooling"]
        
        POOLA --&gt; EMBA["Embedding A"]
        POOLB --&gt; EMBB["Embedding B"]
        
        EMBA --&gt; COS["余弦相似度"]
        EMBB --&gt; COS
    end
</code></pre>
<p><strong>Cross-Encoder vs Bi-Encoder</strong>：</p>








































<table><thead><tr><th>维度</th><th>Cross-Encoder</th><th>Bi-Encoder (SBERT)</th></tr></thead><tbody><tr><td><strong>输入方式</strong></td><td>两句拼接</td><td>两句独立编码</td></tr><tr><td><strong>精度</strong></td><td>更高</td><td>略低</td></tr><tr><td><strong>效率</strong></td><td>O(n²) 推理</td><td>O(n) 推理 + O(n²) 余弦</td></tr><tr><td><strong>预计算</strong></td><td>不可以</td><td>可以</td></tr><tr><td><strong>检索场景</strong></td><td>不适合</td><td>适合</td></tr><tr><td><strong>典型用途</strong></td><td>Rerank</td><td>召回</td></tr></tbody></table>
<p><strong>SBERT 的关键优势</strong>：</p>
<ul>
<li>100,000 文档只需 100,000 次编码（而非 50 亿次）</li>
<li>编码可预计算和缓存</li>
<li>结合向量数据库（Faiss/Milvus）实现毫秒级检索</li>
</ul>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SentenceBERT</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vocab_size: <span class="hljs-built_in">int</span>, d_model: <span class="hljs-built_in">int</span> = <span class="hljs-number">768</span>, num_heads: <span class="hljs-built_in">int</span> = <span class="hljs-number">12</span>, 
                 num_layers: <span class="hljs-built_in">int</span> = <span class="hljs-number">12</span>, max_seq_len: <span class="hljs-built_in">int</span> = <span class="hljs-number">512</span></span>):
        self.vocab_size = vocab_size
        self.d_model = d_model
        self.max_seq_len = max_seq_len
        
        self.token_embeddings = np.random.randn(vocab_size, d_model) * <span class="hljs-number">0.01</span>
        self.position_embeddings = np.random.randn(max_seq_len, d_model) * <span class="hljs-number">0.01</span>
        
        self.attention_layers = []
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_layers):
            W_q = np.random.randn(d_model, d_model) * <span class="hljs-number">0.01</span>
            W_k = np.random.randn(d_model, d_model) * <span class="hljs-number">0.01</span>
            W_v = np.random.randn(d_model, d_model) * <span class="hljs-number">0.01</span>
            W_o = np.random.randn(d_model, d_model) * <span class="hljs-number">0.01</span>
            self.attention_layers.append((W_q, W_k, W_v, W_o))
        
        self.feed_forward_layers = []
        <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_layers):
            W1 = np.random.randn(d_model, d_model * <span class="hljs-number">4</span>) * <span class="hljs-number">0.01</span>
            b1 = np.zeros(d_model * <span class="hljs-number">4</span>)
            W2 = np.random.randn(d_model * <span class="hljs-number">4</span>, d_model) * <span class="hljs-number">0.01</span>
            b2 = np.zeros(d_model)
            self.feed_forward_layers.append((W1, b1, W2, b2))
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">embed</span>(<span class="hljs-params">self, token_ids: np.ndarray</span>) -&gt; np.ndarray:
        seq_len = <span class="hljs-built_in">len</span>(token_ids)
        token_emb = self.token_embeddings[token_ids]
        pos_emb = self.position_embeddings[:seq_len]
        <span class="hljs-keyword">return</span> token_emb + pos_emb
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">attention</span>(<span class="hljs-params">self, x: np.ndarray, W_q: np.ndarray, W_k: np.ndarray, 
                  W_v: np.ndarray, W_o: np.ndarray</span>) -&gt; np.ndarray:
        Q = np.dot(x, W_q)
        K = np.dot(x, W_k)
        V = np.dot(x, W_v)
        
        scores = np.dot(Q, K.T) / np.sqrt(self.d_model)
        attention_weights = self.softmax(scores)
        
        output = np.dot(attention_weights, V)
        output = np.dot(output, W_o)
        <span class="hljs-keyword">return</span> output
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">softmax</span>(<span class="hljs-params">self, x: np.ndarray</span>) -&gt; np.ndarray:
        exp_x = np.exp(x - np.<span class="hljs-built_in">max</span>(x, axis=-<span class="hljs-number">1</span>, keepdims=<span class="hljs-literal">True</span>))
        <span class="hljs-keyword">return</span> exp_x / np.<span class="hljs-built_in">sum</span>(exp_x, axis=-<span class="hljs-number">1</span>, keepdims=<span class="hljs-literal">True</span>)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">feed_forward</span>(<span class="hljs-params">self, x: np.ndarray, W1: np.ndarray, b1: np.ndarray, 
                     W2: np.ndarray, b2: np.ndarray</span>) -&gt; np.ndarray:
        hidden = np.maximum(<span class="hljs-number">0</span>, np.dot(x, W1) + b1)
        output = np.dot(hidden, W2) + b2
        <span class="hljs-keyword">return</span> output
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">encode</span>(<span class="hljs-params">self, token_ids: np.ndarray</span>) -&gt; np.ndarray:
        x = self.embed(token_ids)
        
        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(self.attention_layers)):
            W_q, W_k, W_v, W_o = self.attention_layers[i]
            attn_out = self.attention(x, W_q, W_k, W_v, W_o)
            x = x + attn_out
            
            W1, b1, W2, b2 = self.feed_forward_layers[i]
            ff_out = self.feed_forward(x, W1, b1, W2, b2)
            x = x + ff_out
        
        sentence_embedding = np.mean(x, axis=<span class="hljs-number">0</span>)
        <span class="hljs-keyword">return</span> sentence_embedding
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_similarity</span>(<span class="hljs-params">self, sentence1: <span class="hljs-built_in">str</span>, sentence2: <span class="hljs-built_in">str</span>, 
                          tokenizer: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">float</span>:
        tokens1 = [tokenizer.get(token, <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> sentence1.split()]
        tokens2 = [tokenizer.get(token, <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> sentence2.split()]
        
        emb1 = self.encode(np.array(tokens1))
        emb2 = self.encode(np.array(tokens2))
        
        similarity = np.dot(emb1, emb2) / (np.linalg.norm(emb1) * np.linalg.norm(emb2))
        <span class="hljs-keyword">return</span> similarity

<span class="hljs-keyword">class</span> <span class="hljs-title class_">VectorDatabase</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, embedding_dim: <span class="hljs-built_in">int</span></span>):
        self.embedding_dim = embedding_dim
        self.documents = []
        self.embeddings = []
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_document</span>(<span class="hljs-params">self, doc_id: <span class="hljs-built_in">str</span>, text: <span class="hljs-built_in">str</span>, embedding: np.ndarray</span>):
        self.documents.append({<span class="hljs-string">'id'</span>: doc_id, <span class="hljs-string">'text'</span>: text})
        self.embeddings.append(embedding)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">self, query_embedding: np.ndarray, top_k: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span></span>) -&gt; <span class="hljs-built_in">list</span>:
        similarities = []
        <span class="hljs-keyword">for</span> i, doc_embedding <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.embeddings):
            sim = np.dot(query_embedding, doc_embedding) / (
                np.linalg.norm(query_embedding) * np.linalg.norm(doc_embedding)
            )
            similarities.append((i, sim))
        
        similarities.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
        top_results = similarities[:top_k]
        
        results = []
        <span class="hljs-keyword">for</span> idx, sim <span class="hljs-keyword">in</span> top_results:
            results.append({
                <span class="hljs-string">'document'</span>: self.documents[idx],
                <span class="hljs-string">'similarity'</span>: sim
            })
        
        <span class="hljs-keyword">return</span> results

vocab_size = <span class="hljs-number">30000</span>
d_model = <span class="hljs-number">256</span>

sbert = SentenceBERT(vocab_size, d_model)

tokenizer = {
    <span class="hljs-string">'hello'</span>: <span class="hljs-number">1</span>, <span class="hljs-string">'world'</span>: <span class="hljs-number">2</span>, <span class="hljs-string">'this'</span>: <span class="hljs-number">3</span>, <span class="hljs-string">'is'</span>: <span class="hljs-number">4</span>, <span class="hljs-string">'a'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'test'</span>: <span class="hljs-number">6</span>,
    <span class="hljs-string">'machine'</span>: <span class="hljs-number">7</span>, <span class="hljs-string">'learning'</span>: <span class="hljs-number">8</span>, <span class="hljs-string">'ai'</span>: <span class="hljs-number">9</span>, <span class="hljs-string">'artificial'</span>: <span class="hljs-number">10</span>, <span class="hljs-string">'intelligence'</span>: <span class="hljs-number">11</span>
}

sentence1 = <span class="hljs-string">"hello world"</span>
sentence2 = <span class="hljs-string">"this is a test"</span>
sentence3 = <span class="hljs-string">"machine learning ai"</span>

similarity_12 = sbert.compute_similarity(sentence1, sentence2, tokenizer)
similarity_13 = sbert.compute_similarity(sentence1, sentence3, tokenizer)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"句子1和句子2的相似度: <span class="hljs-subst">{similarity_12:<span class="hljs-number">.4</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"句子1和句子3的相似度: <span class="hljs-subst">{similarity_13:<span class="hljs-number">.4</span>f}</span>"</span>)

vec_db = VectorDatabase(d_model)

emb1 = sbert.encode(np.array([tokenizer.get(token, <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> sentence1.split()]))
emb2 = sbert.encode(np.array([tokenizer.get(token, <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> sentence2.split()]))
emb3 = sbert.encode(np.array([tokenizer.get(token, <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> sentence3.split()]))

vec_db.add_document(<span class="hljs-string">'doc1'</span>, sentence1, emb1)
vec_db.add_document(<span class="hljs-string">'doc2'</span>, sentence2, emb2)
vec_db.add_document(<span class="hljs-string">'doc3'</span>, sentence3, emb3)

query_emb = sbert.encode(np.array([tokenizer.get(token, <span class="hljs-number">0</span>) <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> <span class="hljs-string">'ai learning'</span>.split()]))
results = vec_db.search(query_emb, top_k=<span class="hljs-number">2</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n检索结果:"</span>)
<span class="hljs-keyword">for</span> result <span class="hljs-keyword">in</span> results:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"文档: <span class="hljs-subst">{result[<span class="hljs-string">'document'</span>][<span class="hljs-string">'text'</span>]}</span>, 相似度: <span class="hljs-subst">{result[<span class="hljs-string">'similarity'</span>]:<span class="hljs-number">.4</span>f}</span>"</span>)
</code></pre>
<hr/>
<h4 data-id="heading-48">6.4 现代两阶段检索架构</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    QUERY["Query 查询"]
    
    subgraph Stage1["Stage 1: Retrieval 召回层"]
        direction LR
        SPARSE["&lt;b&gt;Sparse Retrieval&lt;/b&gt;&lt;br/&gt;BM25&lt;br/&gt;✓ 词汇精确匹配&lt;br/&gt;✓ 无需训练&lt;br/&gt;✓ 可解释"]
        
        DENSE["&lt;b&gt;Dense Retrieval&lt;/b&gt;&lt;br/&gt;Embedding&lt;br/&gt;✓ 语义匹配&lt;br/&gt;✓ 同义词理解&lt;br/&gt;✗ 需要训练"]
        
        TOPK["返回 Top-K&lt;br/&gt;(100-1000)"]
    end
    
    subgraph Stage2["Stage 2: Rerank 精排层"]
        CROSS["&lt;b&gt;Cross-Encoder&lt;/b&gt;&lt;br/&gt;对每个 (Query, Doc) 精细打分&lt;br/&gt;✓ 最高精度&lt;br/&gt;✗ 计算代价高"]
        
        TOPN["返回 Top-N&lt;br/&gt;(10-20)"]
    end
    
    RESULT["最终结果"]
    
    QUERY --&gt; Stage1
    SPARSE --&gt; TOPK
    DENSE --&gt; TOPK
    Stage1 --&gt; Stage2
    CROSS --&gt; TOPN
    Stage2 --&gt; RESULT
</code></pre>
<p><strong>为什么需要两阶段</strong>：</p>


























<table><thead><tr><th>阶段</th><th>目标</th><th>算法</th><th>复杂度</th><th>精度</th></tr></thead><tbody><tr><td><strong>召回</strong></td><td>从海量中筛选候选</td><td>BM25 / Dense</td><td>亚线性</td><td>中等</td></tr><tr><td><strong>精排</strong></td><td>对候选精细排序</td><td>Cross-Encoder</td><td>O(K)</td><td>最高</td></tr></tbody></table>
<hr/>
<h4 data-id="heading-49">6.5 Hybrid Search 混合检索</h4>
<p><strong>核心思想</strong>：BM25 和 Dense Retrieval 各有优势，混合使用效果更好。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph 互补优势
        subgraph BM25优势
            B1["✓ 精确关键词匹配"]
            B2["✓ 专有名词/ID"]
            B3["✓ 长尾查询"]
            B4["✓ 无需训练"]
            B5["✓ 域外泛化好"]
        end
        
        subgraph Dense优势
            D1["✓ 语义匹配"]
            D2["✓ 同义词理解"]
            D3["✓ 意图理解"]
            D4["✓ 零样本迁移"]
        end
    end
</code></pre>
<p><strong>场景对比</strong>：</p>



































<table><thead><tr><th>场景</th><th>BM25</th><th>Dense Embedding</th></tr></thead><tbody><tr><td>精确关键词（产品ID、人名）</td><td>★★★★★</td><td>★★☆☆☆</td></tr><tr><td>语义匹配（happy ≈ joyful）</td><td>★★☆☆☆</td><td>★★★★★</td></tr><tr><td>长尾专业术语</td><td>★★★★☆</td><td>★★★☆☆</td></tr><tr><td>未见过的领域</td><td>★★★★☆</td><td>★★★☆☆</td></tr><tr><td>口语化查询</td><td>★★☆☆☆</td><td>★★★★☆</td></tr></tbody></table>
<p><strong>融合策略</strong>：</p>
<ol>
<li>
<p><strong>线性加权</strong>：
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Score</mtext><mo>=</mo><mi>α</mi><mo>×</mo><mtext>BM25</mtext><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy="false">)</mo><mo>×</mo><mtext>Dense</mtext></mrow><annotation encoding="application/x-tex">\text{Score} = \alpha \times \text{BM25} + (1-\alpha) \times \text{Dense}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">Score</span></span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"/><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"/><span class="mord text"><span class="mord">BM25</span></span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"/><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"/></span><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord text"><span class="mord">Dense</span></span></span></span></span></span></p>
</li>
<li>
<p><strong>RRF (Reciprocal Rank Fusion)</strong>：
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>RRF</mtext><mo stretchy="false">(</mo><mi>d</mi><mo stretchy="false">)</mo><mo>=</mo><msub><mo>∑</mo><mrow><mi>r</mi><mo>∈</mo><mtext>rankers</mtext></mrow></msub><mfrac><mn>1</mn><mrow><mi>k</mi><mo>+</mo><msub><mtext>rank</mtext><mi>r</mi></msub><mo stretchy="false">(</mo><mi>d</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">\text{RRF}(d) = \sum_{r \in \text{rankers}} \frac{1}{k + \text{rank}_r(d)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord text"><span class="mord">RRF</span></span><span class="mopen">(</span><span class="mord mathnormal">d</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.3651em;vertical-align:-0.52em;"/><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1864em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mrel mtight">∈</span><span class="mord text mtight"><span class="mord mtight">rankers</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3271em;"><span/></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord"><span class="mopen nulldelimiter"/><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8451em;"><span style="top:-2.655em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">rank</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1645em;"><span style="top:-2.357em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"/><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span/></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">d</span><span class="mclose mtight">)</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"/><span class="frac-line" style="border-bottom-width:0.04em;"/></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.52em;"><span/></span></span></span></span><span class="mclose nulldelimiter"/></span></span></span></span></span></p>
</li>
</ol>
<hr/>
<h4 data-id="heading-50">6.6 主流 Embedding 和 Reranker 模型</h4>
<p><strong>Embedding 模型（Bi-Encoder）</strong>：</p>









































<table><thead><tr><th>模型</th><th>维度</th><th>语言</th><th>特点</th></tr></thead><tbody><tr><td><strong>all-MiniLM-L6-v2</strong></td><td>384</td><td>英文</td><td>轻量高效</td></tr><tr><td><strong>all-mpnet-base-v2</strong></td><td>768</td><td>英文</td><td>精度更高</td></tr><tr><td><strong>bge-large-zh</strong></td><td>1024</td><td>中文</td><td>BAAI 出品</td></tr><tr><td><strong>m3e-base</strong></td><td>768</td><td>中文</td><td>通用场景</td></tr><tr><td><strong>multilingual-e5-large</strong></td><td>1024</td><td>多语言</td><td>跨语言检索</td></tr></tbody></table>
<p><strong>Reranker 模型（Cross-Encoder）</strong>：</p>

























<table><thead><tr><th>模型</th><th>参数量</th><th>特点</th></tr></thead><tbody><tr><td><strong>cross-encoder/ms-marco-MiniLM-L-6-v2</strong></td><td>22M</td><td>轻量快速</td></tr><tr><td><strong>BAAI/bge-reranker-large</strong></td><td>560M</td><td>中英文都好</td></tr><tr><td><strong>Cohere Rerank</strong></td><td>-</td><td>API 服务</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-51">🔄 算法关系全景图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph 第一纪元["第一纪元: 精确匹配"]
        HAM["Hamming"] --&gt;|扩展| LEV["Levenshtein"]
        LEV --&gt;|+转置| DAM["Damerau-L"]
        LEV --&gt; LCS["LCS"]
        LCS --&gt; MYERS["Myers diff"]
        MYERS --&gt; PAT["Patience"]
        MYERS --&gt; HIST["Histogram"]
    end
    
    P1["问题: 规模扩展性差"] 
    第一纪元 --&gt; P1
    
    subgraph 第二纪元["第二纪元: 近似哈希"]
        JAC["Jaccard"] --&gt;|结合| MINH["MinHash"]
        MINH --&gt;|竞争| SIMH["SimHash"]
        MINH --&gt; LSH["LSH"]
    end
    
    P1 --&gt; 第二纪元
    P2["问题: 无语义理解"]
    第二纪元 --&gt; P2
    
    subgraph 第三纪元["第三纪元: 统计向量"]
        TFIDF["TF-IDF"] --&gt;|改进| BM25["BM25"]
        TFIDF --&gt; COS["余弦相似度"]
        BM25 --&gt; COS
    end
    
    P2 --&gt; 第三纪元
    P3["问题: 词袋假设"]
    第三纪元 --&gt; P3
    
    subgraph 第四纪元["第四纪元: 词向量"]
        W2V["Word2Vec"] &lt;--&gt;|竞争| GLV["GloVe"]
        GLV --&gt; FT["FastText"]
        FT --&gt; ELMO["ELMo"]
        W2V --&gt; DOC2V["Doc2Vec"]
    end
    
    P3 --&gt; 第四纪元
    P4["问题: 静态表示"]
    第四纪元 --&gt; P4
    
    subgraph 第五纪元["第五纪元: Transformer"]
        TRANS["Transformer"] --&gt; BERT["BERT"]
        TRANS --&gt; GPT["GPT"]
        BERT --&gt; SBERT["SBERT"]
        BERT --&gt; CROSS["Cross-Encoder"]
    end
    
    P4 --&gt; 第五纪元
    
    subgraph 现代方案["现代混合方案"]
        BM25 --&gt; HYBRID["Hybrid Search"]
        SBERT --&gt; HYBRID
        HYBRID --&gt; CROSS
        CROSS --&gt; FINAL["最终结果"]
    end
    
    第五纪元 --&gt; 现代方案
</code></pre>
<hr/>
<h3 data-id="heading-52">🎯 技术选型指南</h3>
<h4 data-id="heading-53">按场景选择</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    subgraph 场景映射
        S1["拼写检查"] --&gt; A1["Damerau-Levenshtein&lt;br/&gt;Jaro-Winkler"]
        S2["代码 diff"] --&gt; A2["Myers / Patience"]
        S3["大规模去重"] --&gt; A3["SimHash / MinHash+LSH"]
        S4["传统搜索"] --&gt; A4["BM25"]
        S5["语义搜索"] --&gt; A5["Hybrid + Rerank"]
        S6["实时检索"] --&gt; A6["SBERT + Faiss"]
        S7["精准评估"] --&gt; A7["Cross-Encoder"]
    end
</code></pre>
<h4 data-id="heading-54">场景-算法详细映射表</h4>




























































<table><thead><tr><th>场景</th><th>推荐算法</th><th>原因</th></tr></thead><tbody><tr><td><strong>拼写检查/纠错</strong></td><td>Damerau-Levenshtein, Jaro-Winkler</td><td>typo 常见转置，短字符串</td></tr><tr><td><strong>代码版本对比</strong></td><td>Myers / Patience / Histogram</td><td>Git 标准，可读性好</td></tr><tr><td><strong>网页/文档去重（亿级）</strong></td><td>SimHash + 汉明距离</td><td>单指纹，极致效率</td></tr><tr><td><strong>相似文档聚类</strong></td><td>MinHash + LSH</td><td>发现候选对</td></tr><tr><td><strong>传统关键词搜索</strong></td><td>BM25</td><td>无需训练，可解释</td></tr><tr><td><strong>语义问答/搜索</strong></td><td>Dense + Rerank</td><td>理解意图和同义词</td></tr><tr><td><strong>实时高并发检索</strong></td><td>SBERT + Faiss/Milvus</td><td>预计算 + ANN</td></tr><tr><td><strong>精准相似度评估</strong></td><td>Cross-Encoder</td><td>最高精度，用于少量</td></tr><tr><td><strong>抄袭/查重</strong></td><td>Shingling + MinHash + 语义</td><td>局部+语义结合</td></tr><tr><td><strong>图像相似</strong></td><td>pHash / dHash</td><td>抗压缩和变形</td></tr></tbody></table>
<h4 data-id="heading-55">五维权衡评估</h4>





































































































<table><thead><tr><th>方法</th><th align="center">精度</th><th align="center">效率</th><th align="center">规模</th><th align="center">可解释</th><th align="center">训练依赖</th></tr></thead><tbody><tr><td>Levenshtein</td><td align="center">★★★</td><td align="center">★☆</td><td align="center">★☆</td><td align="center">★★★★★</td><td align="center">无</td></tr><tr><td>LCS/diff</td><td align="center">★★★</td><td align="center">★★</td><td align="center">★★</td><td align="center">★★★★★</td><td align="center">无</td></tr><tr><td>Jaccard</td><td align="center">★★</td><td align="center">★★★</td><td align="center">★★★</td><td align="center">★★★★★</td><td align="center">无</td></tr><tr><td>MinHash+LSH</td><td align="center">★★</td><td align="center">★★★★</td><td align="center">★★★★★</td><td align="center">★★★★</td><td align="center">无</td></tr><tr><td>SimHash</td><td align="center">★★</td><td align="center">★★★★★</td><td align="center">★★★★★</td><td align="center">★★★★</td><td align="center">无</td></tr><tr><td>TF-IDF</td><td align="center">★★★</td><td align="center">★★★★</td><td align="center">★★★★</td><td align="center">★★★★</td><td align="center">无</td></tr><tr><td>BM25</td><td align="center">★★★★</td><td align="center">★★★★</td><td align="center">★★★★</td><td align="center">★★★★</td><td align="center">无</td></tr><tr><td>Word2Vec</td><td align="center">★★★</td><td align="center">★★★★</td><td align="center">★★★</td><td align="center">★★</td><td align="center">需要</td></tr><tr><td>SBERT</td><td align="center">★★★★</td><td align="center">★★★★</td><td align="center">★★★★</td><td align="center">★</td><td align="center">需要</td></tr><tr><td>Cross-Encoder</td><td align="center">★★★★★</td><td align="center">★★</td><td align="center">★★</td><td align="center">★</td><td align="center">需要</td></tr><tr><td>Hybrid+Rerank</td><td align="center">★★★★★</td><td align="center">★★★★</td><td align="center">★★★★</td><td align="center">★★</td><td align="center">需要</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-56">📚 完整时间线</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">timeline
    title 文档对比算法发展史 (1950-2024)
    
    section 基础算法奠基 (1950-1980)
        1950 : Hamming Distance - 纠错码
        1957 : TF 概念 - Luhn
        1965 : Levenshtein Distance
        1970 : Needleman-Wunsch - 生物序列
        1972 : IDF 概念 - TF-IDF 形成
        1976 : Hunt-McIlroy - Unix diff
        1981 : Smith-Waterman
    
    section 工业算法成熟 (1986-2010)
        1986 : Myers Algorithm - Git 核心
        1989 : Jaro-Winkler
        1994 : BM25 - 至今 ES 默认
        1997 : MinHash - AltaVista
        1998 : LSH
        2002 : SimHash
        2006 : Patience Diff
        2007 : Google 使用 SimHash
    
    section 深度学习革命 (2013-2019)
        2013 : Word2Vec - 词向量革命
        2014 : GloVe / Doc2Vec
        2016 : FastText
        2017 : Transformer - 架构革命
        2018 : BERT / ELMo
        2019 : Sentence-BERT
    
    section 检索增强时代 (2020+)
        2020 : Dense Passage Retrieval
        2021 : ColBERT / Contriever
        2022 : Hybrid Search 成为标准
        2023 : RAG 大规模应用
        2024 : 多模态检索兴起
</code></pre>
<hr/>
<h3 data-id="heading-57">🔑 核心结论</h3>
<ol>
<li>
<p><strong>没有银弹</strong>：每种算法都有其适用场景，选择取决于精度、效率、规模的权衡</p>
</li>
<li>
<p><strong>演进规律</strong>：从精确到语义、从小规模到大规模、从可解释到黑盒</p>
</li>
<li>
<p><strong>现代最佳实践</strong>：</p>
<ul>
<li>召回层：BM25 + Dense Embedding (Hybrid)</li>
<li>精排层：Cross-Encoder Reranker</li>
<li>工程优化：向量数据库 (Faiss/Milvus) + 预计算</li>
</ul>
</li>
<li>
<p><strong>技术选型决策树</strong>：</p>
<ul>
<li>需要精确字符匹配？→ 编辑距离家族</li>
<li>需要找差异（diff）？→ Myers/Patience</li>
<li>超大规模去重？→ SimHash/MinHash+LSH</li>
<li>传统关键词搜索？→ BM25</li>
<li>需要语义理解？→ Hybrid + Rerank</li>
</ul>
</li>
<li>
<p><strong>未来趋势</strong>：</p>
<ul>
<li>多模态检索（文本+图像+音频）</li>
<li>更高效的稀疏-稠密混合</li>
<li>端到端的检索-生成一体化</li>
</ul>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[浅谈安卓Webview从初级到高级应用]]></title>    <link>https://juejin.cn/post/7589578614583312410</link>    <guid>https://juejin.cn/post/7589578614583312410</guid>    <pubDate>2025-12-31T08:12:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589578614583312410" data-draft-id="7589830701614006272" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="浅谈安卓Webview从初级到高级应用"/> <meta itemprop="keywords" content="Android,WebView,Java"/> <meta itemprop="datePublished" content="2025-12-31T08:12:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="inBuilder低代码平台"/> <meta itemprop="url" content="https://juejin.cn/user/3063653579111592"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            浅谈安卓Webview从初级到高级应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3063653579111592/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    inBuilder低代码平台
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:12:18.000Z" title="Wed Dec 31 2025 08:12:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言</h2>
<p>WebView作为Android中承载网页内容的核心组件，在混合开发、H5集成等场景中应用广泛。但很多开发者对其的认知停留在“加载URL”的基础用法，忽略了其强大的扩展能力和潜在的坑点。本文将从初级用法入手，逐步深入到高级特性，结合实战场景讲解WebView的最佳实践。</p>
<h2 data-id="heading-1">一、初级应用：WebView的基础使用</h2>
<h3 data-id="heading-2">1. 快速上手：加载第一个网页</h3>
<p>WebView的基础用法非常简单，只需三步即可实现网页加载：</p>
<ul>
<li>
<p><strong>步骤1：在布局中添加WebView</strong></p>
<p>XML</p>

<p>"@+id/webview"android:layout_width="match_parent"android:layout_height="match_parent" /&gt;</p>
</li>
<li>
<p><strong>步骤2：在代码中初始化并加载URL</strong></p>
<p>Kotlin
class MainActivity : AppCompatActivity() {private lateinit var webView: WebView</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {<span class="hljs-keyword">super</span>.onCreate(savedInstanceState)setContentView(R.layout.activity_main)
    webView = findViewById(R.id.webview)<span class="hljs-comment">// 基础配置：启用JavaScript（H5交互必备）val webSettings = webView.settings</span>
    webSettings.javaScriptEnabled = <span class="hljs-literal">true</span><span class="hljs-comment">// 加载网页（支持http/https/file协议）</span>
    webView.loadUrl(<span class="hljs-string">"https://www.example.com"</span>)}}
</code></pre>
</li>
<li>
<p><strong>步骤3：添加网络权限</strong></p>
</li>
</ul>
<p>在_AndroidManifest.xml_中声明网络权限（加载网络页面时必需）</p>
<pre><code class="hljs language-ini" lang="ini">XML
&lt;uses-permission android:<span class="hljs-attr">name</span>=<span class="hljs-string">"android.permission.INTERNET"</span> /&gt;
</code></pre>
<h3 data-id="heading-3">2. 基础配置：常用属性说明</h3>
<p>WebView的核心配置通过WebSettings类实现，初级阶段需掌握以下关键属性：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3eda1e76403e4222a60583907b07fa1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaW5CdWlsZGVy5L2O5Luj56CB5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767773538&amp;x-signature=GOZL9MURzCoo9pWi4VX6AoJfQlQ%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">3. 页面导航：前进/后退与生命周期管理</h3>
<p>WebView加载多个页面后，需支持导航控制，同时在Activity生命周期中同步状态：</p>
<pre><code class="hljs language-scss" lang="scss">Kotlin
<span class="hljs-comment">// 后退（返回上一页）fun onBackPressed() {if (webView.canGoBack()) {</span>
        webView<span class="hljs-selector-class">.goBack</span>() <span class="hljs-comment">// 后退} else {super.onBackPressed() // 退出Activity}}// 前进fun goForward() {if (webView.canGoForward()) {</span>
        webView<span class="hljs-selector-class">.goForward</span>()}}<span class="hljs-comment">// 生命周期同步（避免内存泄漏）override fun onPause() {super.onPause()</span>
    webView<span class="hljs-selector-class">.onPause</span>() <span class="hljs-comment">// 暂停页面渲染、JS执行}override fun onResume() {super.onResume()</span>
    webView<span class="hljs-selector-class">.onResume</span>() <span class="hljs-comment">// 恢复页面}override fun onDestroy() {// 销毁前清除资源，避免内存泄漏</span>
    webView<span class="hljs-selector-class">.loadDataWithBaseURL</span>(null, "", "text/html", "utf-<span class="hljs-number">8</span>", null)
    webView<span class="hljs-selector-class">.clearHistory</span>()(webView.parent as ViewGroup)<span class="hljs-selector-class">.removeView</span>(webView)
    webView<span class="hljs-selector-class">.destroy</span>()super<span class="hljs-selector-class">.onDestroy</span>()}
</code></pre>
<h2 data-id="heading-5">二、中级应用：交互与功能扩展</h2>
<p>WebView的核心价值在于原生与H5的交互，以及对页面行为的精细化控制。</p>
<h3 data-id="heading-6">1. 原生与JS交互：双向通信机制</h3>
<p><strong>（1）Java调用JS方法</strong></p>
<p>通过evaluateJavascript（API 19+）或loadUrl调用JS函数，推荐前者（支持回调）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Kotlin</span>
<span class="hljs-comment">// 调用JS的showMessage方法，并获取返回值</span>
webView.<span class="hljs-title function_">evaluateJavascript</span>(<span class="hljs-params"><span class="hljs-string">"javascript:showMessage('Hello from Native')"</span></span>) 
{ result -&gt;<span class="hljs-comment">// result为JS返回的字符串（JSON格式需手动解析）</span>
    <span class="hljs-title class_">Log</span>.<span class="hljs-title function_">d</span>(<span class="hljs-string">"WebView"</span>, <span class="hljs-string">"JS返回结果：$result"</span>)}
</code></pre>
<p><strong>（2）JS调用原生方法</strong></p>
<p>通过_addJavascriptInterface_注册原生对象，供JS调用：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Kotlin
<span class="hljs-comment">// 1. 定义交互接口类（需加@JavascriptInterface注解）class JsInterface(private val context: Context) </span>
{<span class="hljs-comment">// 供JS调用的方法（必须是public，且加注解）@JavascriptInterfacefun showToast(message: String) {</span>
        runOnUiThread { <span class="hljs-comment">// 切换到主线程执行UI操作</span>
            Toast.makeText(context, message, Toast.LENGTH_SHORT).show()}}}
            <span class="hljs-comment">// 2. 注册接口（参数1：对象实例，参数2：JS中调用的对象名）</span>
webView.addJavascriptInterface(JsInterface(<span class="hljs-keyword">this</span>), <span class="hljs-string">"AndroidInterface"</span>)
</code></pre>
<p>JS中调用方式：运行JavaScript</p>
<pre><code class="hljs language-arduino" lang="arduino">JavaScript
<span class="hljs-comment">// 调用原生的showToast方法AndroidInterface.showToast("Hello from JS");</span>
</code></pre>
<p><strong>安全提示</strong>：</p>
<p>• addJavascriptInterface在API &lt; 17时有安全漏洞（可能被恶意JS注入攻击），需避免在低版本使用，或通过白名单限制URL。</p>
<p>• 高版本（API 17+）需显式添加@JavascriptInterface注解，未注解的方法不会被JS调用。</p>
<h3 data-id="heading-7">2. 页面控制：WebViewClient与WebChromeClient</h3>
<p>通过这两个客户端类，可拦截页面事件、处理弹窗、进度条等：</p>
<p><strong>（1）WebViewClient：控制页面加载行为</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin">Kotlin
webView.webViewClient = <span class="hljs-keyword">object</span> : WebViewClient() {<span class="hljs-comment">// 拦截URL加载（如处理Scheme跳转、过滤非法链接）override fun shouldOverrideUrlLoading(</span>
        view: WebView?,
        request: WebResourceRequest?): <span class="hljs-built_in">Boolean</span> {<span class="hljs-keyword">val</span> url = request?.url?.toString() ?: <span class="hljs-keyword">return</span> falsereturn <span class="hljs-keyword">when</span> {
            url.startsWith(<span class="hljs-string">"scheme://native/"</span>) -&gt; {<span class="hljs-comment">// 处理自定义Scheme（如打开原生页面）handleScheme(url)true // 拦截，不通过WebView加载}</span>
            url.contains(<span class="hljs-string">"unsafe"</span>) -&gt; {<span class="hljs-comment">// 过滤非法链接true}else -&gt; false // 正常加载}}// 页面加载完成回调override fun onPageFinished(view: WebView?, url: String?) {super.onPageFinished(view, url)// 可在此处注入JS代码（如修改页面样式）</span>
        webView.evaluateJavascript(<span class="hljs-string">"javascript:document.body.style.backgroundColor='#f0f0f0'"</span>) {}}<span class="hljs-comment">// 加载错误回调override fun onReceivedError(</span>
        view: WebView?,
        request: WebResourceRequest?,
        error: WebResourceError?) {<span class="hljs-keyword">super</span>.onReceivedError(view, request, error)<span class="hljs-comment">// 显示自定义错误页面</span>
        webView.loadDataWithBaseURL(<span class="hljs-literal">null</span>, <span class="hljs-string">"&lt;h1&gt;加载失败&lt;/h1&gt;"</span>, <span class="hljs-string">"text/html"</span>, <span class="hljs-string">"utf-8"</span>, <span class="hljs-literal">null</span>)}}
</code></pre>
<p><strong>（2）WebChromeClient：处理页面交互反馈</strong></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Kotlin</span>
webView.<span class="hljs-property">webChromeClient</span> = <span class="hljs-built_in">object</span> : <span class="hljs-title class_">WebChromeClient</span>() {<span class="hljs-comment">// 处理JS弹窗（alert/confirm/prompt）override fun onJsAlert(</span>
        <span class="hljs-attr">view</span>: <span class="hljs-title class_">WebView</span>?,
        <span class="hljs-attr">url</span>: <span class="hljs-title class_">String</span>?,
        <span class="hljs-attr">message</span>: <span class="hljs-title class_">String</span>?,
        <span class="hljs-attr">result</span>: <span class="hljs-title class_">JsResult</span>?): <span class="hljs-title class_">Boolean</span> {<span class="hljs-comment">// 用原生Dialog替换JS弹窗</span>
        <span class="hljs-title class_">AlertDialog</span>.<span class="hljs-title class_">Builder</span>(<span class="hljs-variable language_">this</span><span class="hljs-meta">@MainActivity</span>).<span class="hljs-title function_">setMessage</span>(message).<span class="hljs-title function_">setPositiveButton</span>(<span class="hljs-params"><span class="hljs-string">"确定"</span></span>) { _, _ -&gt; result?.<span class="hljs-title function_">confirm</span>() }.<span class="hljs-title function_">show</span>()<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-comment">// 拦截默认弹窗}// 监听页面加载进度override fun onProgressChanged(view: WebView?, newProgress: Int) {super.onProgressChanged(view, newProgress)// 更新进度条（0-100）</span>
        progressBar.<span class="hljs-property">progress</span> = newProgress
    }<span class="hljs-comment">// 获取页面标题override fun onReceivedTitle(view: WebView?, title: String?) {super.onReceivedTitle(view, title)</span>
        supportActionBar?.<span class="hljs-property">title</span> = title <span class="hljs-comment">// 更新ActionBar标题}}</span>
</code></pre>
<h3 data-id="heading-8">3. 缓存管理：提升加载速度与离线体验</h3>
<p>WebView支持多种缓存策略，可根据需求配置：</p>
<pre><code class="hljs language-scss" lang="scss">Kotlin
val webSettings = webView<span class="hljs-selector-class">.settings</span>

<span class="hljs-comment">// 1. 启用缓存（默认开启，需设置缓存模式）</span>
webSettings<span class="hljs-selector-class">.cacheMode</span> = WebSettings<span class="hljs-selector-class">.LOAD_DEFAULT</span> <span class="hljs-comment">// 默认：有缓存则用，无则网络请求// 其他缓存模式：// LOAD_CACHE_ONLY：仅用缓存，不请求网络// LOAD_NO_CACHE：不使用缓存，全部走网络// LOAD_CACHE_ELSE_NETWORK：有缓存则用，无则请求网络（适合离线场景）// 2. 启用DOM存储（H5 localStorage等）</span>
webSettings<span class="hljs-selector-class">.domStorageEnabled</span> = true<span class="hljs-comment">// 3. 设置缓存路径（可选，默认在应用私有目录）val cacheDir = filesDir.absolutePath + "/webview_cache"</span>
webSettings<span class="hljs-selector-class">.setAppCachePath</span>(cacheDir)
webSettings<span class="hljs-selector-class">.setAppCacheEnabled</span>(true)<span class="hljs-comment">// 清理缓存的方法fun clearWebViewCache() {</span>
    webView<span class="hljs-selector-class">.clearCache</span>(true) <span class="hljs-comment">// 清除页面缓存</span>
    webView<span class="hljs-selector-class">.clearHistory</span>() <span class="hljs-comment">// 清除浏览历史</span>
    webView<span class="hljs-selector-class">.clearFormData</span>() <span class="hljs-comment">// 清除表单数据}</span>
</code></pre>
<h2 data-id="heading-9">三、高级应用：性能优化与安全加固</h2>
<p>在大规模应用WebView时，性能、稳定性和安全性是核心挑战。</p>
<h3 data-id="heading-10">1. 性能优化：解决卡顿、白屏问题</h3>
<p><strong>（1）启用硬件加速</strong></p>
<p>WebView渲染依赖GPU，开启硬件加速可提升流畅度（需在AndroidManifest.xml中配置）：</p>
<pre><code class="hljs language-ini" lang="ini">XML
&lt;applicationandroid:<span class="hljs-attr">hardwareAccelerated</span>=<span class="hljs-string">"true"</span>...&gt;
</code></pre>
<p><strong>注意</strong>：部分老旧设备可能因硬件加速导致渲染异常，可针对性关闭（如对单个Activity设置android:hardwareAccelerated="false"）。</p>
<p><strong>（2）预加载与复用WebView</strong></p>
<p>频繁创建/销毁WebView会导致性能损耗，可通过全局复用池优化：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Kotlin
<span class="hljs-keyword">object</span> WebViewPool {<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> webViewQueue = ArrayDeque&lt;WebView&gt;()<span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> MAX_SIZE = <span class="hljs-number">3</span> <span class="hljs-comment">// 最大缓存数量// 获取WebView实例（从池里取，没有则创建）fun getWebView(context: Context): WebView {return if (webViewQueue.isNotEmpty()) {</span>
            webViewQueue.removeFirst()} <span class="hljs-keyword">else</span> {WebView(context.applicationContext).apply {
                settings.javaScriptEnabled = <span class="hljs-literal">true</span><span class="hljs-comment">// 初始化通用配置}}}// 回收WebView（清空内容，放入池）fun recycle(webView: WebView) {if (webViewQueue.size &lt; MAX_SIZE) {</span>
            webView.loadDataWithBaseURL(<span class="hljs-literal">null</span>, <span class="hljs-string">""</span>, <span class="hljs-string">"text/html"</span>, <span class="hljs-string">"utf-8"</span>, <span class="hljs-literal">null</span>)
            webViewQueue.add(webView)} <span class="hljs-keyword">else</span> {
            webView.destroy() <span class="hljs-comment">// 超过最大数量则销毁}}}</span>
</code></pre>
<p><strong>（3）资源拦截与预加载</strong></p>
<p>通过WebViewClient的shouldInterceptRequest拦截网络请求，用OkHttp等框架优化加载，或预加载关键资源：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Kotlin
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">shouldInterceptRequest</span><span class="hljs-params">(
    view: <span class="hljs-type">WebView</span>?,
    request: <span class="hljs-type">WebResourceRequest</span>?)</span></span>: WebResourceResponse? {<span class="hljs-keyword">val</span> url = request?.url?.toString() ?: <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span><span class="hljs-comment">// 拦截图片请求，使用预加载的本地图片if (url.endsWith(".png") &amp;&amp; url.contains("logo")) {return WebResourceResponse("image/png","UTF-8",</span>
            assets.<span class="hljs-keyword">open</span>(<span class="hljs-string">"preloaded_logo.png"</span>))}<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> <span class="hljs-comment">// 其他请求正常加载}</span>
</code></pre>
<h3 data-id="heading-11">2. 安全加固：防范恶意攻击</h3>
<p><strong>（1）限制JS交互权限</strong></p>
<p>• 非必要不开启addJavascriptInterface，必须使用时严格校验参数（如过滤特殊字符）。</p>
<p>• 对API &lt; 17的设备，避免使用addJavascriptInterface，改用shouldOverrideUrlLoading通过Scheme间接交互。</p>
<p><strong>（2）限制URL加载范围</strong></p>
<p>通过shouldOverrideUrlLoading拦截所有URL，只允许白名单内的域名加载：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Kotlin
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> ALLOWED_DOMAINS = setOf(<span class="hljs-string">"example.com"</span>, <span class="hljs-string">"trusted-site.com"</span>)<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">shouldOverrideUrlLoading</span><span class="hljs-params">(view: <span class="hljs-type">WebView</span>?, request: <span class="hljs-type">WebResourceRequest</span>?)</span></span>: <span class="hljs-built_in">Boolean</span> {<span class="hljs-keyword">val</span> host = request?.url?.host ?: <span class="hljs-keyword">return</span> truereturn !ALLOWED_DOMAINS.contains(host) <span class="hljs-comment">// 非白名单域名拦截}</span>
</code></pre>
<p><strong>（3）启用HTTPS并验证证书</strong></p>
<p>强制使用HTTPS，避免明文传输，并通过onReceivedSslError验证证书合法性：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Kotlin
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onReceivedSslError</span><span class="hljs-params">(
    view: <span class="hljs-type">WebView</span>?,
    handler: <span class="hljs-type">SslErrorHandler</span>?,
    error: <span class="hljs-type">SslError</span>?)</span></span> {<span class="hljs-comment">// 禁止忽略证书错误（防止中间人攻击）</span>
    handler?.cancel() <span class="hljs-comment">// 直接取消加载// 错误情况下可引导用户跳转其他页面}</span>
</code></pre>
<h3 data-id="heading-12">3. 崩溃处理：避免WebView崩溃影响主进程</h3>
<p>WebView是崩溃高发组件（如JS内存泄漏、渲染异常），可通过“独立进程”隔离风险：</p>
<p><strong>步骤1：在AndroidManifest.xml中为WebView所在Activity指定进程</strong></p>
<pre><code class="hljs language-xml" lang="xml">XML
&lt;activityandroid:name=".WebViewActivity"android:process=":webview" /&gt; <span class="hljs-comment">&lt;!-- 独立进程名（以:开头为私有进程） --&gt;</span>
</code></pre>
<p>**步骤2：进程间通信（如用AIDL或EventBus）：**主进程与WebView进程通过通信传递数据，避免直接引用导致的内存泄漏。</p>
<p>**步骤3：捕获WebView崩溃：**通过Thread.UncaughtExceptionHandler捕获WebView进程的崩溃，重启或提示用户：</p>
<pre><code class="hljs language-rust" lang="rust">Kotlin
<span class="hljs-comment">// 在WebView进程初始化时设置</span>
Thread.setDefaultUncaughtExceptionHandler { t, e <span class="hljs-punctuation">-&gt;</span><span class="hljs-comment">// 记录崩溃日志</span>
    Log.<span class="hljs-title function_ invoke__">e</span>(<span class="hljs-string">"WebViewCrash"</span>, <span class="hljs-string">"WebView进程崩溃"</span>, e)<span class="hljs-comment">// 通知主进程重启WebViewrestartWebView()}</span>
</code></pre>
<h2 data-id="heading-13">四、总结与展望</h2>
<p>WebView作为混合开发的桥梁，其用法远不止“加载网页”。从初级的基础配置，到中级的交互控制，再到高级的性能优化与安全加固，每一步都需要结合实际场景权衡利弊。随着Web技术的发展，WebView在Android中的角色将更加灵活，掌握其高级用法能显著提升混合开发的体验与稳定性。</p>
<p>欢迎大家积极留言共建，期待与各位技术大咖的深入交流！</p>
<p>此外，欢迎大家下载我们的<a href="https://link.juejin.cn?target=https%3A%2F%2Fibc.inspures.com%2F" target="_blank" title="https://ibc.inspures.com/" ref="nofollow noopener noreferrer">inBuilder低代码社区</a>，可免费下载使用，加入我们，开启开发体验之旅！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[conda]anaconda的bin目录下的python3.13,python3.1,python3,python(区别)]]></title>    <link>https://juejin.cn/post/7589564203872288831</link>    <guid>https://juejin.cn/post/7589564203872288831</guid>    <pubDate>2025-12-31T08:15:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589564203872288831" data-draft-id="7589564203872239679" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[conda]anaconda的bin目录下的python3.13,python3.1,python3,python(区别)"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-31T08:15:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [conda]anaconda的bin目录下的python3.13,python3.1,python3,python(区别)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:15:03.000Z" title="Wed Dec 31 2025 08:15:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">核心区别：符号链接 vs. 可执行文件</h2>
<p>在Anaconda的<code>bin</code>目录下，通常只有一个或几个<strong>真正的Python解释器可执行文件</strong>（例如 <code>python3.13</code> 或 <code>python3.1</code> 这个真实文件）。其他名字（如 <code>python</code>, <code>python3</code>）大多是<strong>符号链接</strong>，类似于Windows的“快捷方式”。</p>
<hr/>
<h2 data-id="heading-1">具体分析</h2>
<p>假设你的Anaconda安装了Python 3.13，目录结构通常是这样：</p>
<ol>
<li>
<p><strong>真实的可执行文件</strong>（实际的解释器）：</p>
<ul>
<li><code>python3.13</code> - <strong>这很可能就是那个唯一的真实解释器二进制文件。</strong></li>
</ul>
</li>
<li>
<p><strong>指向它的符号链接</strong>（由Anaconda创建，为了兼容和方便）：</p>
<ul>
<li><code>python3</code> - 一个指向 <code>python3.13</code> 的链接。这遵循了“<code>python3</code> 代表任何Python 3.x版本”的通用约定。</li>
<li><code>python</code> - 一个指向 <code>python3</code>（进而指向 <code>python3.13</code>）的链接。<strong>在Anaconda环境中，<code>python</code> 通常就等同于默认的Python 3版本。</strong></li>
</ul>
</li>
<li>
<p><strong>关于 <code>python3.1</code> 的特殊情况</strong>：</p>
<ul>
<li>这通常<strong>不是</strong>一个独立的Python 3.1版本，而很可能是一个<strong>指向 <code>python3.13</code> 的符号链接</strong>。</li>
<li>为什么？这是为了兼容那些在脚本里硬编码了 <code>#!/usr/bin/env python3.1</code> 这类旧版本号shebang行的程序。系统通过一个链接，让 <code>python3.1</code> 也能调用当前已安装的最新3.x版本。</li>
<li>你可以用 <code>ls -l python3.1</code> 命令查看它到底指向谁。</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-2">如何验证？</h2>
<p>在你的Anaconda <code>bin</code>目录下打开终端，执行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看文件的详细信息，可以看到链接关系</span>
<span class="hljs-built_in">ls</span> -l python*

<span class="hljs-comment"># 检查各个“命令”的实际版本</span>
./python --version
./python3 --version
./python3.13 --version
./python3.1 --version
</code></pre>
<p><strong>输出结果会类似这样：</strong></p>
<pre><code class="hljs language-sql" lang="sql">lrwxrwxrwx <span class="hljs-number">1</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">user</span> ... python <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> python3
lrwxrwxrwx <span class="hljs-number">1</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">user</span> ... python3 <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> python3<span class="hljs-number">.13</span>
lrwxrwxrwx <span class="hljs-number">1</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">user</span> ... python3<span class="hljs-number">.1</span> <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> python3<span class="hljs-number">.13</span>
<span class="hljs-operator">-</span>rwxr<span class="hljs-operator">-</span>xr<span class="hljs-operator">-</span>x <span class="hljs-number">2</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">user</span> ... python3<span class="hljs-number">.13</span><span class="hljs-operator">*</span>
</code></pre>
<p>所有命令返回的版本号应该都是 <strong>Python 3.13.x</strong>。</p>
<hr/>
<h2 data-id="heading-3">重要区别：系统Python vs. Anaconda Python</h2>
<ul>
<li><strong><code>/usr/bin/python3</code></strong> - 这是你<strong>操作系统自带的Python 3</strong>，与Anaconda无关。</li>
<li><strong><code>~/anaconda3/bin/python3</code></strong> - 这是<strong>Anaconda环境中的Python 3</strong>。</li>
</ul>
<p>在你激活Anaconda环境后，命令行中的 <code>python</code> 命令会优先指向Anaconda <code>bin</code>目录下的这个 <code>python</code>（链接）。</p>
<hr/>
<h2 data-id="heading-4">总结</h2>






























<table><thead><tr><th align="left">文件名</th><th align="left">性质</th><th align="left">目的</th></tr></thead><tbody><tr><td align="left"><code>python3.13</code></td><td align="left"><strong>很可能是真正的解释器二进制文件</strong></td><td align="left">实际执行Python代码的程序</td></tr><tr><td align="left"><code>python3</code></td><td align="left">指向 <code>python3.13</code> 的符号链接</td><td align="left">提供通用的“python3”命令</td></tr><tr><td align="left"><code>python</code></td><td align="left">指向 <code>python3</code> 的符号链接</td><td align="left">提供简短的默认<code>python</code>命令</td></tr><tr><td align="left"><code>python3.1</code></td><td align="left">指向 <code>python3.13</code> 的符号链接</td><td align="left">兼容旧脚本中指定的版本号</td></tr></tbody></table>
<p><strong>所以，你的问题的答案是：</strong>
<strong>它们本质上调用的是同一个Python解释器（Python 3.13）</strong>，只是通过不同的“名字”（符号链接）来调用，目的是为了<strong>兼容性</strong>和<strong>遵循用户习惯</strong>。</p>
<p>这样做的好处是：</p>
<ol>
<li>无论你习惯输入 <code>python</code>、<code>python3</code> 还是具体的 <code>python3.13</code>，都能启动正确的解释器。</li>
<li>一些旧的脚本或教程中如果写了 <code>#!/usr/bin/env python3.1</code>，在你的新版本环境中也能正常运行。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[conda]anaconda的bin目录下的pip和pip3(区别)]]></title>    <link>https://juejin.cn/post/7589614866833735686</link>    <guid>https://juejin.cn/post/7589614866833735686</guid>    <pubDate>2025-12-31T08:30:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589614866833735686" data-draft-id="7589830060334235702" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[conda]anaconda的bin目录下的pip和pip3(区别) "/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-31T08:30:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="import_random"/> <meta itemprop="url" content="https://juejin.cn/user/2013961033882312"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [conda]anaconda的bin目录下的pip和pip3(区别) 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2013961033882312/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    import_random
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:30:25.000Z" title="Wed Dec 31 2025 08:30:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你说得对！在Anaconda的<code>bin</code>目录下，确实通常会有<code>pip</code>和<code>pip3</code>两个命令文件。让我详细解释它们的关系和区别：</p>
<h2 data-id="heading-0">核心答案</h2>
<p><strong>在Anaconda环境中，<code>pip</code>和<code>pip3</code>通常是指向同一个可执行文件的符号链接，没有实际区别。</strong> 它们都会调用当前环境的Python包管理器。</p>
<h2 data-id="heading-1">详细解释</h2>
<h2 data-id="heading-2">1. 为什么会有两个？</h2>
<p>主要是为了<strong>兼容性和用户习惯</strong>：</p>
<ul>
<li><strong><code>pip3</code></strong>：明确表示这是<strong>Python 3</strong>的pip</li>
<li><strong><code>pip</code></strong>：简短的通用名称</li>
</ul>
<p>在<code>系统</code>同时存在Python 2和Python 3的环境中，这两个命令通常指向不同的pip：</p>
<ul>
<li><code>pip</code> → 指向Python 2的pip</li>
<li><code>pip3</code> → 指向Python 3的pip</li>
</ul>
<p>但在<code>Anaconda的独立环境</code>中，由于环境是隔离的，只包含一个Python版本（通常是Python 3.x），所以这两个命令都指向同一个pip。</p>
<h2 data-id="heading-3">2. 验证方法</h2>
<p>在你的Anaconda <code>bin</code>目录下执行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看文件类型和链接关系</span>
<span class="hljs-built_in">ls</span> -l pip*

<span class="hljs-comment"># 检查它们指向的实际文件</span>
<span class="hljs-built_in">which</span> -a pip
<span class="hljs-built_in">which</span> -a pip3

<span class="hljs-comment"># 查看pip版本和Python版本</span>
pip --version
pip3 --version
</code></pre>
<p><strong>典型输出示例：</strong></p>
<pre><code class="hljs language-sql" lang="sql">lrwxrwxrwx <span class="hljs-number">1</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">user</span> ... pip <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> pip3
lrwxrwxrwx <span class="hljs-number">1</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">user</span> ... pip3 <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span> pip3<span class="hljs-number">.13</span>
<span class="hljs-operator">-</span>rwxr<span class="hljs-operator">-</span>xr<span class="hljs-operator">-</span>x <span class="hljs-number">1</span> <span class="hljs-keyword">user</span> <span class="hljs-keyword">user</span> ... pip3<span class="hljs-number">.13</span><span class="hljs-operator">*</span>

# 运行版本检查的输出：
pip <span class="hljs-number">24.2</span> <span class="hljs-keyword">from</span> <span class="hljs-operator">/</span>home<span class="hljs-operator">/</span><span class="hljs-keyword">user</span><span class="hljs-operator">/</span>anaconda3<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>python3<span class="hljs-number">.13</span><span class="hljs-operator">/</span>site<span class="hljs-operator">-</span>packages<span class="hljs-operator">/</span>pip (python <span class="hljs-number">3.13</span>)
pip <span class="hljs-number">24.2</span> <span class="hljs-keyword">from</span> <span class="hljs-operator">/</span>home<span class="hljs-operator">/</span><span class="hljs-keyword">user</span><span class="hljs-operator">/</span>anaconda3<span class="hljs-operator">/</span>lib<span class="hljs-operator">/</span>python3<span class="hljs-number">.13</span><span class="hljs-operator">/</span>site<span class="hljs-operator">-</span>packages<span class="hljs-operator">/</span>pip (python <span class="hljs-number">3.13</span>)
# 两个命令输出的版本和路径完全相同
</code></pre>
<h2 data-id="heading-4">3. 实际使用中的关系</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 以下命令在Anaconda环境中是完全等价的：</span>
pip install numpy
pip3 install numpy

<span class="hljs-comment"># 等价于：</span>
python -m pip install numpy
python3 -m pip install numpy
</code></pre>
<h2 data-id="heading-5">4. 特殊情况的处理</h2>
<p>虽然<code>pip</code>和<code>pip3</code>通常相同，但有些情况下你可能需要注意：</p>
<p><strong>情况1：跨Python版本的环境</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 如果你创建了一个基于Python 3.8的环境</span>
conda create -n py38 python=3.8

<span class="hljs-comment"># 激活后，pip和pip3都会指向Python 3.8的pip</span>
conda activate py38
pip --version  <span class="hljs-comment"># 显示Python 3.8</span>
pip3 --version <span class="hljs-comment"># 显示Python 3.8</span>
</code></pre>
<p><strong>情况2：同时安装了Python 2和Python 3</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在基础系统（未激活conda环境）中：</span>
<span class="hljs-comment"># pip可能指向系统Python 2的pip</span>
<span class="hljs-comment"># pip3指向系统Python 3的pip</span>

<span class="hljs-comment"># 激活conda环境后：</span>
<span class="hljs-comment"># 环境变量PATH被修改，conda环境的bin目录优先</span>
<span class="hljs-comment"># 所以pip和pip3都指向conda环境的pip</span>
</code></pre>
<h2 data-id="heading-6">5. 最佳实践建议</h2>
<ol>
<li>
<p><strong>在conda环境中，统一使用<code>pip</code>命令即可</strong></p>
<pre><code class="hljs language-bash" lang="bash">pip install package_name
</code></pre>
</li>
<li>
<p><strong>如果要明确指定Python版本，使用<code>python -m pip</code></strong></p>
<pre><code class="hljs language-bash" lang="bash">python -m pip install package_name
python3 -m pip install package_name  <span class="hljs-comment"># 在conda环境中与上一行相同</span>
</code></pre>
</li>
<li>
<p><strong>避免的写法</strong>（可能引起混淆）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在conda环境中不需要这样写</span>
pip3 install package_name  <span class="hljs-comment"># 和pip install完全一样，没必要多打一个字符</span>
</code></pre>
</li>
</ol>
<h2 data-id="heading-7">6. 为什么conda同时提供<code>pip</code>和<code>pip3</code>？</h2>
<ol>
<li><strong>脚本兼容性</strong>：有些脚本里写的是<code>#!/usr/bin/env pip3</code>，有些写的是<code>#!/usr/bin/env pip</code></li>
<li><strong>用户习惯</strong>：有些用户习惯用<code>pip</code>，有些习惯用<code>pip3</code></li>
<li><strong>教学一致性</strong>：教程里通常用<code>pip3</code>来强调这是Python 3的环境</li>
<li><strong>防止混淆</strong>：明确告诉用户这是Python 3的pip</li>
</ol>
<h2 data-id="heading-8">总结</h2>

























<table><thead><tr><th>命令</th><th>在Anaconda环境中的含义</th><th>建议使用场景</th></tr></thead><tbody><tr><td><code>pip</code></td><td>当前环境的包管理器</td><td><strong>推荐使用</strong>，简洁通用</td></tr><tr><td><code>pip3</code></td><td>当前环境的包管理器</td><td>与<code>pip</code>完全等价，按个人习惯使用</td></tr><tr><td><code>python -m pip</code></td><td>显式调用当前Python的pip</td><td>需要明确Python版本时使用</td></tr></tbody></table>
<p><strong>关键点：</strong> 在Anaconda的独立环境中，<code>pip</code>和<code>pip3</code>是<strong>完全相同的</strong>，它们都指向当前环境Python版本的包管理器。选择使用哪一个完全取决于你的个人习惯。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[pageoffice提取Excel表格区域数据]]></title>    <link>https://juejin.cn/post/7589564203872403519</link>    <guid>https://juejin.cn/post/7589564203872403519</guid>    <pubDate>2025-12-31T08:35:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589564203872403519" data-draft-id="7589614866833752070" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="pageoffice提取Excel表格区域数据"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-31T08:35:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="给我推荐个名字"/> <meta itemprop="url" content="https://juejin.cn/user/678816748675504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            pageoffice提取Excel表格区域数据
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/678816748675504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    给我推荐个名字
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T08:35:01.000Z" title="Wed Dec 31 2025 08:35:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1M34y1A7qL%3Fp%3D56" target="_blank" title="https://www.bilibili.com/video/BV1M34y1A7qL?p=56" ref="nofollow noopener noreferrer">点击可查看视频演示效果</a></p>
<pre><code class="hljs">注意本文中展示的代码均为关键代码，复制粘贴到您的项目中，按照实际的情况，例如文档路径，用户名等做适当修改即可使用。
</code></pre>
<p>在实际的开发过程中，经常会遇到提取Excel文档中数据保存到数据库中的需求，PageOffice客户端控件支持在线保存Excel文件时，打包Excel文档中的指定单元格的数据或所有的数据提交到服务器端，在服务器端创建PageOffice的WorkbookReader对象，就可以获取到Excel单元格中的数据。</p>
<h3 data-id="heading-0">后端代码</h3>
<p>在后端编写代码调用webOpen方法以表单提交模式<code>xlsSubmitForm</code>打开文件，创建Sheet对象并操作一块区域（Table），并命名，比如：Info。</p>
<p>设置接收处理PageOffice客户端控件提交数据的服务器端后台方法为：saveData</p>
<pre><code class="hljs language-ini" lang="ini">PageOfficeCtrl <span class="hljs-attr">poCtrl</span> = new Page<span class="hljs-literal">Off</span>iceCtrl(request)<span class="hljs-comment">;</span>

WorkbookWriter <span class="hljs-attr">workBook</span> = new WorkbookWriter()<span class="hljs-comment">;</span>
SheetWriter <span class="hljs-attr">sheet</span> = workBook.openSheet(<span class="hljs-string">"Sheet1"</span>)<span class="hljs-comment">;</span>
ExcelTableWriter <span class="hljs-attr">table</span> = sheet.openTable(<span class="hljs-string">"B4:F13"</span>)<span class="hljs-comment">;//设置Table对象的操作区域</span>
table.setSubmitName("Info")<span class="hljs-comment">;//设置table对象的提交名称，以便保存页面获取提交的数据</span>

poCtrl.setWriter(workBook)<span class="hljs-comment">;//此行必须</span>
poCtrl.setSaveDataPage("saveData")<span class="hljs-comment">;//设置保存数据接口地址</span>
//webOpen的第一个参数支持能够输出下载文件的Url相对地址或者文件在服务器上的磁盘路径两种方式
poCtrl.webOpen("D:\\documents\\test.xlsx", OpenModeType.xlsSubmitForm, "张三")<span class="hljs-comment">;</span>
</code></pre>
<p>在服务器端后台方法saveData中，创建com.zhuozhengsoft.pageoffice.excel命名空间中的WorkbookReader对象，提取各单元格数据。您可以在此方法中编写代码，把获取到的数据保存到对应的数据库表中。</p>
<pre><code class="hljs language-ini" lang="ini">WorkbookReader <span class="hljs-attr">workBook</span> = new WorkbookReader(request, response)<span class="hljs-comment">;</span>
SheetReader <span class="hljs-attr">sheet</span> = workBook.openSheet(<span class="hljs-string">"Sheet1"</span>)<span class="hljs-comment">;</span>
ExcelTableReader <span class="hljs-attr">table</span> = sheet.openTable(<span class="hljs-string">"Info"</span>)<span class="hljs-comment">;//Info为打开文件时设置的SubmitName</span>
String <span class="hljs-attr">content</span> = <span class="hljs-string">""</span><span class="hljs-comment">;</span>
int <span class="hljs-attr">result</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
while (!table.getEOF()) {
    //获取提交的数值
    if (!table.getDataFields().getIsEmpty()) {
        content += "&lt;br/&gt;Product: "
                + table.getDataFields().get(0).getText()<span class="hljs-comment">;</span>
        content += "&lt;br/&gt;Plan: "
                + table.getDataFields().get(1).getText()<span class="hljs-comment">;</span>
        content += "&lt;br/&gt;Real: "
                + table.getDataFields().get(2).getText()<span class="hljs-comment">;</span>
        content += "&lt;br/&gt;Total: "
                + table.getDataFields().get(3).getText()<span class="hljs-comment">;</span>

        if (table.getDataFields().get(2).getText().equals(null)
                || table.getDataFields().get(2).getText().trim().length() == 0
        ) {
            content += "&lt;br/&gt;Rate: 0%"<span class="hljs-comment">;</span>
        } else {
            float <span class="hljs-attr">f</span> = Float.parseFloat(table.getDataFields().get(<span class="hljs-number">2</span>)
                    .getText())<span class="hljs-comment">;</span>
            <span class="hljs-attr">f</span> = f / Float.parseFloat(table.getDataFields().get(<span class="hljs-number">1</span>).getText())<span class="hljs-comment">;</span>
            DecimalFormat <span class="hljs-attr">df</span> = (DecimalFormat) NumberFormat.getInstance()<span class="hljs-comment">;</span>
            content += "&lt;br/&gt;Rate: " + df.format(f * 100) + "%"<span class="hljs-comment">;</span>
        }
        content += "&lt;br/&gt;*********************************************"<span class="hljs-comment">;</span>
    }
    //循环进入下一行
    table.nextRow()<span class="hljs-comment">;</span>
}
table.close()<span class="hljs-comment">;</span>

//可以在此处编写代码把content输出到控制台，查看提交数据

workBook.close()<span class="hljs-comment">;</span>
</code></pre>
<p>原文链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.pageoffice.cn%2Fpages%2F541f37%2F" target="_blank" title="https://www.pageoffice.cn/pages/541f37/" ref="nofollow noopener noreferrer">www.pageoffice.cn/pages/541f3…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Tauri (24)——窗口在隐藏期间自动收起导致了位置漂移]]></title>    <link>https://juejin.cn/post/7589838714449231913</link>    <guid>https://juejin.cn/post/7589838714449231913</guid>    <pubDate>2025-12-31T09:01:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589838714449231913" data-draft-id="7589126217249341481" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Tauri (24)——窗口在隐藏期间自动收起导致了位置漂移"/> <meta itemprop="keywords" content="前端,APP,React.js"/> <meta itemprop="datePublished" content="2025-12-31T09:01:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨夜寻晴天"/> <meta itemprop="url" content="https://juejin.cn/user/1943592288391496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Tauri (24)——窗口在隐藏期间自动收起导致了位置漂移
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592288391496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨夜寻晴天
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-31T09:01:07.000Z" title="Wed Dec 31 2025 09:01:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-31
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>在桌面端应用中，我们为 <code>SearchChat</code> 设计了一种「紧凑模式」：</p>
<ul>
<li>正常状态下窗口高度较大</li>
<li>当一段时间无操作后，窗口会自动收起到紧凑高度（例如 84px）</li>
<li>收起动作由 <code>compactModeAutoCollapseDelay</code> 控制，比如 5 秒后触发</li>
</ul>
<p>整体体验在大多数情况下是正常的，但在一次使用中发现了一个<strong>非常隐蔽却影响体验的问题</strong>。</p>
<hr/>
<h2 data-id="heading-1">问题现象</h2>
<p>问题只会出现在一个特定时序下：</p>
<ol>
<li>窗口处于紧凑模式的 “延迟收起倒计时” 中（例如还剩 2～3 秒）</li>
<li>用户通过快捷键 <strong>主动隐藏窗口</strong></li>
<li>延迟计时器仍然在后台触发</li>
<li>计时结束后，执行了 <code>setWindowSize</code> 收起逻辑</li>
<li>用户再次用快捷键唤起窗口</li>
</ol>
<p><strong>结果是：</strong></p>
<blockquote>
<p>窗口位置发生了漂移，不再出现在隐藏前的位置。</p>
</blockquote>
<p>这个问题在某些平台或窗口管理器上尤为明显。</p>
<hr/>
<h2 data-id="heading-2">问题根因分析</h2>
<p>拆开来看，核心原因其实并不复杂：</p>
<ul>
<li>延迟收起逻辑是一个 <strong>纯前端的定时器</strong></li>
<li>窗口被隐藏后，计时器并不会自动停止</li>
<li>计时器触发时，仍然会调用 <code>setWindowSize</code></li>
<li>某些平台在「窗口不可见」状态下修改窗口尺寸时，会<strong>重新计算窗口位置</strong></li>
<li>这个重算过程不是我们可控的</li>
</ul>
<p>因此，<strong>真正的问题不是“收起”本身，而是：</strong></p>
<blockquote>
<p>在窗口不可见时发生了尺寸变化，导致系统偷偷帮我们改了位置。</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">核心设计目标</h2>
<p>我们希望做到一件事：</p>
<blockquote>
<p><strong>即使窗口在隐藏状态下被触发了尺寸变更，也要保证它在再次显示时，仍然回到隐藏前的位置。</strong></p>
</blockquote>
<p>并且要满足几个约束：</p>
<ul>
<li>不侵入现有窗口尺寸策略</li>
<li>不依赖平台特性 hack</li>
<li>能正确处理高 DPI 场景</li>
<li>修改范围尽量小</li>
</ul>
<hr/>
<h2 data-id="heading-4">解决思路（前端侧）</h2>
<p>整体方案分为两步。</p>
<h3 data-id="heading-5">一、在窗口失焦 / 隐藏时，记录当前位置</h3>
<p>当窗口即将被隐藏时，我们可以认为此刻的位置是“用户认可的位置”。</p>
<p>在 <code>SearchChat</code> 中：</p>
<ul>
<li>通过 <code>useTauriFocus</code> 的 <code>onBlur</code> 回调</li>
<li>调用 <code>outerPosition()</code> 获取当前窗口位置</li>
<li>将结果保存到 <code>windowPositionRef</code></li>
</ul>
<p>关键点在于：</p>
<ul>
<li><code>outerPosition()</code> 返回的是 <strong>physical position</strong></li>
<li>这个坐标不受 DPI / scale factor 影响</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> pos = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">outerPosition</span>()
windowPositionRef.<span class="hljs-property">current</span> = { <span class="hljs-attr">x</span>: pos.<span class="hljs-property">x</span>, <span class="hljs-attr">y</span>: pos.<span class="hljs-property">y</span> }
</code></pre>
<p>代码位置：</p>
<pre><code class="hljs language-bash" lang="bash">src/components/SearchChat/index.tsx:113-119
</code></pre>
<hr/>
<h3 data-id="heading-6">二、延迟收起触发时，如果窗口不可见，强制恢复位置</h3>
<p>在自动收起的定时器中：</p>
<ol>
<li>
<p>正常执行 <code>setWindowSize</code></p>
</li>
<li>
<p>紧接着判断窗口当前是否可见</p>
</li>
<li>
<p>如果窗口是隐藏状态，并且我们之前记录过位置：</p>
<ul>
<li>主动把窗口位置设回去</li>
</ul>
</li>
</ol>
<p>伪代码逻辑如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">setWindowSize</span>(width, height)

<span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">await</span> <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">isVisible</span>()) &amp;&amp; windowPositionRef.<span class="hljs-property">current</span>) {
  <span class="hljs-keyword">const</span> { x, y } = windowPositionRef.<span class="hljs-property">current</span>
  <span class="hljs-keyword">await</span> platformAdapter.<span class="hljs-title function_">setWindowPhysicalPosition</span>(x, y)
}
</code></pre>
<p>代码位置：</p>
<pre><code class="hljs language-bash" lang="bash">src/components/SearchChat/index.tsx:158-179
</code></pre>
<p>这样即使系统在隐藏期间偷偷“动了手脚”，也会被我们立刻纠正。</p>
<hr/>
<h2 data-id="heading-7">为什么要用 Physical Position</h2>
<p>这里有一个非常容易踩坑的点：<strong>DPI 缩放</strong>。</p>
<ul>
<li><code>outerPosition()</code> 返回的是 <strong>physical position</strong></li>
<li>项目中原有的 <code>setWindowPosition(x, y)</code> 使用的是 <strong>logical position</strong></li>
<li>如果存的是 physical，却用 logical 去设，<strong>高 DPI 下会产生明显偏移</strong></li>
</ul>
<p>因此，我们补充了一个明确的 API：</p>
<h3 data-id="heading-8"><code>setWindowPhysicalPosition</code></h3>
<h4 data-id="heading-9">Tauri 实现</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PhysicalPosition</span>, getCurrentWebviewWindow } <span class="hljs-keyword">from</span> <span class="hljs-string">'@tauri-apps/api/window'</span>

<span class="hljs-keyword">const</span> win = <span class="hljs-title function_">getCurrentWebviewWindow</span>()
<span class="hljs-keyword">await</span> win.<span class="hljs-title function_">setPosition</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PhysicalPosition</span>(x, y))
</code></pre>
<p>代码位置：</p>
<pre><code class="hljs language-bash" lang="bash">src/utils/tauriAdapter.ts:85-89
</code></pre>
<h4 data-id="heading-10">Web 实现（占位）</h4>
<p>Web 模式下不需要真实移动窗口，只保留日志即可：</p>
<pre><code class="hljs language-bash" lang="bash">src/utils/webAdapter.ts:88-90
</code></pre>
<hr/>
<h2 data-id="heading-11">最终效果</h2>
<p>这个方案带来的收益非常明确：</p>
<ul>
<li>✅ 修复隐藏期间自动收起导致的窗口位置漂移</li>
<li>✅ 正确处理高 DPI 场景，避免 logical / physical 混用</li>
<li>✅ 改动范围小，只在 <code>SearchChat</code> 的定时收起路径兜底</li>
<li>✅ 不影响其他窗口尺寸或动画策略</li>
</ul>
<hr/>
<h2 data-id="heading-12">手动验证步骤</h2>
<p>建议按以下流程验证：</p>
<ol>
<li>设置 <code>compactModeAutoCollapseDelay = 5</code></li>
<li>打开窗口，确保满足进入紧凑模式的条件</li>
<li>在 5 秒倒计时期间，使用快捷键隐藏窗口</li>
<li>等待超过 5 秒</li>
<li>再次用快捷键唤起窗口</li>
</ol>
<p><strong>预期结果：</strong></p>
<blockquote>
<p>窗口应出现在隐藏前的位置，不应发生任何跳动或漂移。</p>
</blockquote>
<hr/>
<h2 data-id="heading-13">小结</h2>
<p>这个问题本质上不是 “窗口 API 用错了”，而是 <strong>多个合理行为在特定时序下叠加，暴露出的系统边界问题</strong>。</p>
<p>解决它的关键，不是阻止自动收起，而是：</p>
<blockquote>
<p><strong>尊重用户最后一次看到的窗口状态，并在必要时为系统行为兜底。</strong></p>
</blockquote>
<p>这类问题在桌面端应用中非常常见，也非常容易被忽略，希望这次的整理能对你有所帮助。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>