<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[typescriptæ³›å‹æšä¸¾ä»¥åŠNaNä¼ æŸ“å¤„ç†]]></title>    <link>https://juejin.cn/post/7585463258691338249</link>    <guid>https://juejin.cn/post/7585463258691338249</guid>    <pubDate>2025-12-20T13:34:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585463258691338249" data-draft-id="7585484081435983923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="typescriptæ³›å‹æšä¸¾ä»¥åŠNaNä¼ æŸ“å¤„ç†"/> <meta itemprop="keywords" content="å‰ç«¯,TypeScript"/> <meta itemprop="datePublished" content="2025-12-20T13:34:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xfq"/> <meta itemprop="url" content="https://juejin.cn/user/1781679823010728"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            typescriptæ³›å‹æšä¸¾ä»¥åŠNaNä¼ æŸ“å¤„ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1781679823010728/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xfq
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:34:26.000Z" title="Sat Dec 20 2025 13:34:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æ³›å‹</h2>
<p>ä¸é¢„å…ˆæŒ‡å®šå…·ä½“çš„ç±»å‹ï¼Œè€Œæ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™å†æŒ‡å®šç±»å‹ï¼ˆç±»å‹å‚æ•°åŒ–ï¼‰</p>
<p>è¯­æ³•ï¼šä½¿ç”¨<code>&lt;T&gt;</code>å®šä¹‰æ³›å‹å˜é‡</p>
<ul>
<li>T åªæ˜¯å ä½ç¬¦ï¼Œå¸¸ç”¨å•å­—æ¯ Tï¼ˆtypeï¼‰Kï¼ˆkeyï¼‰Vï¼ˆvalueï¼‰Eï¼ˆelementï¼‰Pï¼ˆpropsï¼‰ç­‰ï¼Œå¦‚æœç±»å‹é€»è¾‘è¾ƒå¤æ‚ï¼Œå»ºè®®ä½¿ç”¨â€œä»¥ T å¼€å¤´çš„æè¿°æ€§åç§°â€ï¼Œæ¯”å¦‚ï¼š<code>send&lt;TRequest, TResponse&gt;</code></li>
<li>æ³›å‹å¯ä»¥æœ‰é»˜è®¤å€¼ï¼š<code>&lt;T = unknown&gt;</code></li>
<li>æ³›å‹å¯ä»¥æœ‰çº¦æŸï¼š<code>&lt;T, K extends keyof T&gt;</code> =&gt; è¡¨ç¤º K å¿…é¡»æ˜¯ T çš„é”®åä¹‹ä¸€</li>
</ul>
<p>ä½¿ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>åœ¨å‡½æ•°ä¸Šå®šä¹‰çš„æ³›å‹ï¼Œå¯ä»¥æ”¾åˆ°å‡½æ•°å‚æ•°ä¸Šæˆ–ä½œä¸ºè¿”å›ç±»å‹ï¼Œä½œç”¨ï¼šè¾“å…¥è¾“å‡ºç±»å‹å…³è”</li>
<li>åœ¨ interface ä¸Šå®šä¹‰çš„æ³›å‹ï¼Œå¯ä»¥ä½œä¸ºå†…éƒ¨å­ç±»å‹ï¼Œä½œç”¨ï¼šå®šä¹‰é€šç”¨çš„å¯¹è±¡ç»“æ„</li>
<li>åœ¨ type ä¸Šå®šä¹‰çš„æ³›å‹ï¼Œä½œç”¨ï¼šåˆ›å»ºé€šç”¨å·¥å…·ç±»å‹</li>
<li>åœ¨ class ä¸Šå®šä¹‰çš„æ³›å‹ï¼Œä½œç”¨ï¼šæ³›å‹ç±»</li>
</ol>
<p>ç¤ºä¾‹ 1ï¼šç±»å‹æ¨å¯¼</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> wrap&lt;T&gt;(<span class="hljs-attr">value</span>: T): T {
  <span class="hljs-keyword">return</span> value;
}

<span class="hljs-keyword">const</span> s1 = <span class="hljs-title function_">wrap</span>(<span class="hljs-string">'hello'</span>); <span class="hljs-comment">// s1: "hello"</span>
<span class="hljs-keyword">const</span> s2 = wrap&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'hello'</span>); <span class="hljs-comment">// s2: string</span>
</code></pre>
<p>ç¤ºä¾‹ 2ï¼šé€šè¿‡æ³›å‹è®©å¤–å±‚ç»“æ„å›ºå®šï¼Œå†…éƒ¨æ•°æ®ç»“æ„åŠ¨æ€å˜åŒ–</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiRes</span>&lt;T&gt; {
  <span class="hljs-attr">msg</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">data</span>: T;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Order</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">function</span> request&lt;T = <span class="hljs-built_in">unknown</span>&gt;(<span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ApiRes</span>&lt;T&gt;&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(url).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> res.<span class="hljs-title function_">json</span>());
}

<span class="hljs-keyword">const</span> res1 = <span class="hljs-keyword">await</span> request&lt;<span class="hljs-title class_">User</span>&gt;(<span class="hljs-string">'/api1'</span>); <span class="hljs-comment">// res1: ApiRes&lt;User&gt;</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res1.<span class="hljs-property">data</span>.<span class="hljs-property">name</span>);

<span class="hljs-keyword">const</span> res2 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">request</span>(<span class="hljs-string">'/api2'</span>); <span class="hljs-comment">// res2: ApiRes&lt;{ a: 1 }&gt;</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res2.<span class="hljs-property">data</span>.<span class="hljs-property">a</span>);
</code></pre>
<p>ç¤ºä¾‹ 3ï¼šæ³›å‹çº¦æŸ</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> getProp&lt;T, K <span class="hljs-keyword">extends</span> keyof T&gt;(<span class="hljs-attr">obj</span>: T, <span class="hljs-attr">key</span>: K) {
  <span class="hljs-keyword">return</span> obj[key];
}

<span class="hljs-keyword">const</span> user = { <span class="hljs-attr">name</span>: <span class="hljs-string">'å¼ ä¸‰'</span> };

<span class="hljs-keyword">const</span> value = <span class="hljs-title function_">getProp</span>(user, <span class="hljs-string">'name'</span>); <span class="hljs-comment">// value: string</span>
</code></pre>
<p>ç¤ºä¾‹ 4ï¼šé€šç”¨å·¥å…·ç±»å‹</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">OrNull</span>&lt;T&gt; = T | <span class="hljs-literal">null</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">x</span>: <span class="hljs-title class_">OrNull</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-number">1</span>;
</code></pre>
<h2 data-id="heading-1">äºŒã€æšä¸¾</h2>
<p>ä½¿ç”¨ as const + keyof typeof æ›¿ä»£ enum</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 1. å®šä¹‰å¸¸é‡å¯¹è±¡</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Colors</span> = {
  <span class="hljs-attr">RED</span>: <span class="hljs-string">'red'</span>,
  <span class="hljs-attr">BLUE</span>: <span class="hljs-string">'blue'</span>,
  <span class="hljs-attr">GREEN</span>: <span class="hljs-string">'green'</span>,
} <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-comment">// 2. å¯¼å‡ºç±»å‹</span>
<span class="hljs-comment">// è§£é‡Šï¼š</span>
<span class="hljs-comment">// typeof Colors è·å–å¯¹è±¡ç±»å‹</span>
<span class="hljs-comment">// keyof typeof Colors è·å–é”® "RED" | "BLUE" | "GREEN"</span>
<span class="hljs-comment">// typeof Colors[keyof typeof Colors] è·å–å€¼ "red" | "blue" | "green"</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Colors</span> = (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Colors</span>)[keyof <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Colors</span>];

<span class="hljs-comment">// 3. ä½¿ç”¨</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">paint</span>(<span class="hljs-params">color: Colors</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(color);
}

<span class="hljs-title function_">paint</span>(<span class="hljs-string">'red'</span>); <span class="hljs-comment">// å¯ä»¥ä¼ å­—é¢é‡</span>
<span class="hljs-title function_">paint</span>(<span class="hljs-title class_">Colors</span>.<span class="hljs-property">RED</span>); <span class="hljs-comment">// å¯ä»¥ä¼ å¸¸é‡</span>
<span class="hljs-comment">// paint('yellow'); // æŠ¥é”™</span>
</code></pre>
<h2 data-id="heading-2">ä¸‰ã€è§£å†³ NaN çš„ä¼ æŸ“æ€§</h2>
<p>æ ¸å¿ƒæ€æƒ³ï¼šâ€œå°†è¿è¡Œæ—¶çš„æ½œåœ¨é”™è¯¯ï¼Œæå‰åˆ°ç¼–è¯‘æ—¶æ¥è§£å†³â€</p>
<p>NaN çš„ä¼ æŸ“æ€§ï¼šå¦‚æœä¸€ä¸ªå€¼ä¸º NaNï¼Œä¸ç®¡å®ƒå’Œè°è®¡ç®—ç»“æœè¿˜æ˜¯ NaNï¼Œå¹¶ä¸” NaN ä¹Ÿä¸èƒ½ç”¨â€œ===â€æ£€æŸ¥ï¼Œæ‰€ä»¥è¦é¿å…å®ƒåœ¨ä»£ç ä¸­ä¼ æ’­</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è§£å†³é—®é¢˜ï¼šä¸‹è¡Œä»£ç æ²¡æœ‰ä»»ä½•è­¦å‘Šï¼Œä½†å®ƒç»“æœNaN</span>
<span class="hljs-title class_">Number</span>(<span class="hljs-string">'a1'</span>) + <span class="hljs-number">3</span>;

<span class="hljs-comment">// å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼Œå¹¶ç»™å‡ºå¯èƒ½çš„è­¦å‘Šï¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">stringToNumber</span>(<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span> {
  <span class="hljs-comment">// Numberå¯¹ä¸æ˜¯æ•°å­—çš„å‚æ•°ä¼šè¿”å›NaN</span>
  <span class="hljs-keyword">const</span> n = <span class="hljs-title class_">Number</span>(s);
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(n)) <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
  <span class="hljs-keyword">return</span> n;
}

<span class="hljs-comment">// ç¼–è¯‘å™¨ä¼šè­¦å‘ŠstringToNumberå¯èƒ½ä¸ºundefind</span>
<span class="hljs-keyword">const</span> n1 = <span class="hljs-title function_">stringToNumber</span>(<span class="hljs-string">'a1'</span>) + <span class="hljs-number">1</span>;

<span class="hljs-comment">// å¤„ç†è­¦å‘Šï¼Œä»è€Œé¿å…æœªçŸ¥é”™è¯¯ï¼ˆæ­£ç¡®ä½¿ç”¨æ–¹æ³•ï¼‰</span>
<span class="hljs-keyword">const</span> n2 = (<span class="hljs-title function_">stringToNumber</span>(<span class="hljs-string">'a1'</span>) ?? <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;
</code></pre>
<h2 data-id="heading-3">äº”ã€æœ«å°¾</h2>
<p>è§‰å¾—æœ‰å¸®åŠ©å¯ä»¥ç‚¹ç‚¹èµã€‚</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2025</span><span class="hljs-string">/12/20ï¼šå‘å¸ƒæ–‡ç« </span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€å§‹æ­å»ºç¬¬ä¸€ä¸ªReacté¡¹ç›®å§ï½]]></title>    <link>https://juejin.cn/post/7585686247285293107</link>    <guid>https://juejin.cn/post/7585686247285293107</guid>    <pubDate>2025-12-20T15:22:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585686247285293107" data-draft-id="7585534343561461810" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€å§‹æ­å»ºç¬¬ä¸€ä¸ªReacté¡¹ç›®å§ï½"/> <meta itemprop="keywords" content="å‰ç«¯,React.js"/> <meta itemprop="datePublished" content="2025-12-20T15:22:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯å¤§èƒ–"/> <meta itemprop="url" content="https://juejin.cn/user/2791009059353722"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€å§‹æ­å»ºç¬¬ä¸€ä¸ªReacté¡¹ç›®å§ï½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2791009059353722/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯å¤§èƒ–
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T15:22:36.000Z" title="Sat Dec 20 2025 15:22:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ReactåŸºç¡€ï¼ˆä¸€ï¼‰</h2>
<p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å§‹è¿›è¡Œé¡¹ç›®æ­å»ºï¼Œå…ˆæœ‰ä¸ªå¤§æ¦‚çš„æ¡†æ¶ã€‚ç›®å‰Reactæ¥åˆ°React19ã€‚</p>
<h5 data-id="heading-1">é¡¹ç›®æ­å»º</h5>
<p>å®˜ç½‘æœ‰å¾ˆå¤šæ„å»ºé¡¹ç›®çš„æ–¹å¼ï¼Œè¿™è¾¹ç›´æ¥ä½¿ç”¨ä¸€ç§æ¡†æ¶éƒ½é€šç”¨çš„æ–¹å¼è¿›è¡Œæ„å»ºã€‚</p>
<h6 data-id="heading-2">ç¬¬ä¸€æ­¥ï¼šåˆå§‹åŒ–</h6>
<p>â€‹<code>npm init -y</code>â€‹æ„å»ºå‡º<code>package.json</code>æ–‡ä»¶ï¼Œæ·»åŠ éœ€è¦ç”¨åˆ°çš„ä¾èµ–ï¼Œè¿™é‡Œéœ€è¦ä¾èµ–è¿™äº›å†…å®¹ä»¥åŠéœ€è¦æ‰§è¡Œçš„è„šæœ¬ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
<span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
 <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"19.2.3"</span><span class="hljs-punctuation">,</span> 
    <span class="hljs-attr">"react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"19.2.3"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7.2.7"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5.9.3"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// ts é¡¹ç›®å¿…é¡» ï¼</span>
    <span class="hljs-attr">"@types/react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"19.2.7"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// ts é¡¹ç›®å¿…é¡» ï¼</span>
    <span class="hljs-attr">"@types/react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"19.2.3"</span> <span class="hljs-comment">// ts é¡¹ç›®å¿…é¡» ï¼</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h6 data-id="heading-3">ç¬¬äºŒæ­¥ï¼šå®‰è£…ä¾èµ–</h6>
<p>â€‹<code>pnpm i</code>å®‰è£…æ‰€æœ‰éœ€è¦ç”¨åˆ°çš„ä¾èµ–ï¼Œå®‰è£…å®Œä¾èµ–åçš„é¡¹ç›®æ–‡ä»¶ç»“æ„æ˜¯è¿™æ ·å­çš„ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfd775009cf54e11ace5cd04fed7d6ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5aSn6IOW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766848956&amp;x-signature=Qig%2F5H4%2FiIyaPQ8WAJLKljzL7Dg%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-4">ç¬¬ä¸‰æ­¥ï¼šåˆå§‹åŒ–tsé…ç½®</h6>
<p>â€‹<code>npx tsc --init</code>â€‹åˆ›å»º<code>tsconfig.json</code>æ–‡ä»¶ã€‚è¿™é‡Œä½¿ç”¨npxæ˜¯ä½¿ç”¨äº†å®‰è£…ä¸‹æ¥çš„tsä¾èµ–â€”â€”å¸¦æœ‰reacté…ç½®çš„ï¼Œæ‰€ä»¥å‡ºæ¥çš„æ–‡ä»¶ä¸­å…·æœ‰Reactæ‰€éœ€è¦çš„ä¸€äº›é…ç½®ã€‚å‡ºæ¥çš„å†…å®¹å¦‚ä¸‹å›¾ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-comment">// Visit https://aka.ms/tsconfig to read more about this file</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// File Layout</span>
    <span class="hljs-comment">// "rootDir": "./src",</span>
    <span class="hljs-comment">// "outDir": "./dist",</span>

    <span class="hljs-comment">// Environment Settings</span>
    <span class="hljs-comment">// See also https://aka.ms/tsconfig/module</span>
    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nodenext"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"esnext"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-comment">// For nodejs:</span>
    <span class="hljs-comment">// "lib": ["esnext"],</span>
    <span class="hljs-comment">// "types": ["node"],</span>
    <span class="hljs-comment">// and npm install -D @types/node</span>

    <span class="hljs-comment">// Other Outputs</span>
    <span class="hljs-attr">"sourceMap"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"declaration"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"declarationMap"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>

    <span class="hljs-comment">// Stricter Typechecking Options</span>
    <span class="hljs-attr">"noUncheckedIndexedAccess"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"exactOptionalPropertyTypes"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>

    <span class="hljs-comment">// Style Options</span>
    <span class="hljs-comment">// "noImplicitReturns": true,</span>
    <span class="hljs-comment">// "noImplicitOverride": true,</span>
    <span class="hljs-comment">// "noUnusedLocals": true,</span>
    <span class="hljs-comment">// "noUnusedParameters": true,</span>
    <span class="hljs-comment">// "noFallthroughCasesInSwitch": true,</span>
    <span class="hljs-comment">// "noPropertyAccessFromIndexSignature": true,</span>

    <span class="hljs-comment">// Recommended Options</span>
    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"jsx"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"react-jsx"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"verbatimModuleSyntax"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"isolatedModules"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"noUncheckedSideEffectImports"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"moduleDetection"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"force"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"skipLibCheck"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

</code></pre>
<h6 data-id="heading-5">ç¬¬å››æ­¥ï¼šæ­å»ºæ ¹æ–‡ä»¶</h6>
<p>è¿™é‡Œçš„æ ¹æ–‡ä»¶åŒ…æ‹¬<code>index.html</code>â€‹å’Œ <code>main.tsx</code>â€‹ã€‚<code>tsx</code>â€‹æ˜¯tsç‰ˆæœ¬çš„<code>jsx</code>â€‹ï¼Œ<code>jsx</code>æ˜¯ä»€ä¹ˆåé¢ä¼šçŸ¥é“ï¼Œå¾€åç»§ç»­æ­å»ºå§ï½</p>
<ul>
<li>
<p>â€‹<code>index.html</code></p>
<p>éœ€è¦å¼•å…¥<code>main.tsx</code>â€‹ä»¥åŠè®¾ç½®å¯¼å…¥å¯¼å‡ºæ–¹å¼ä¸º<code>esModule</code>çš„æ–¹å¼å¼•å…¥ã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Hello React<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./main.tsx"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
</li>
<li>
<p>â€‹<code>main.tsx</code></p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { createRoot } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-dom/client"</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createRoot</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"app"</span>)!);

app.<span class="hljs-title function_">render</span>(
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Hello React<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
);
</code></pre>
</li>
</ul>
<p>è‡³æ­¤ï¼Œæ‰§è¡Œè„šæœ¬<code>npm run dev</code>ï¼Œæ‰“å¼€å¼€å‘åœ°å€ï¼Œå°±èƒ½æƒŠå–œçš„å‘ç°ï¼Œä½ å’Œ Hello React è§ä¸Šé¢äº†ã€‚é‚£ä¹ˆæ­å–œä½ ï¼Œå®Œæˆäº†ä¸€ä¸ªæœ€æœ€æœ€åŸºç¡€çš„Reacté¡¹ç›®ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œä½ ä¼šæƒ³åˆ°ï¼Œcsså“ªå»äº†ï¼Œè¦å»å“ªé‡Œæ·»åŠ cssï¼Ÿ</p>
<p>é€šè¿‡æ¨¡å—åŒ–çš„æ¦‚å¿µï¼Œæˆ‘ä»¬ä¼šæŠŠcssæ–‡ä»¶å•ç‹¬å¼•å…¥åˆ°é¡¹ç›®ä¸­ï¼Œ<code>main.tsx</code>åˆæ˜¯æˆ‘ä»¬çš„æ ¹æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå¼•å…¥å…¨å±€cssæ˜¯æœ€é€‚åˆä¸è¿‡çš„ã€‚</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-string">"./main.css"</span>
</code></pre>
<p>åé¢ä¼šå‡ºç°è¿™æ ·çš„æŠ¥é”™ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1585c8a330bb4640bf36acada6c5372d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5aSn6IOW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766848956&amp;x-signature=uh5L6X2gDS35aWj5tk58S1Q8twM%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œæ˜¯å› ä¸ºviteæ„å»ºçš„tsé¡¹ç›®ï¼Œè¿˜éœ€è¦åšä¸€ä¸ªå£°æ˜æ–‡ä»¶<code>vite-env.d.ts</code>ï¼Œè¿™æ˜¯viteä¸­è§„å®šçš„ç±»å‹å£°æ˜æ–‡ä»¶ã€‚</p>
<pre><code class="hljs language-d.ts" lang="d.ts">/// &lt;reference types="vite/client" /&gt;
</code></pre>
<p>æ·»åŠ ä¸Šåï¼Œå…¨å±€csså°±èƒ½æ­£å¸¸ä½¿ç”¨å•¦ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œæˆ‘æƒ³ä¼šæœ‰ä¸å°‘æœ‰ç–‘æƒ‘çš„åœ°æ–¹ï¼Œæ¯”å¦‚ä¸ºä»€ä¹ˆåœ¨jsæ–‡ä»¶ä¸­å†™æ ‡ç­¾ä»–æ²¡æœ‰æŠ¥é”™ï¼ŸcreateRootå’Œrenderéƒ½åšäº†ä»€ä¹ˆï¼Ÿç­‰ç­‰ã€‚åé¢æˆ‘ä»¬ä¸€ä¸€è§£å¼€é¢çº±ï¼Œäº†è§£Reactçš„æ ¸å¿ƒã€‚</p>
<p>æœ€åï¼Œæˆ‘ä»¬çš„é¡¹ç›®ç»“æ„æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a753ce300294f72bd432860b7aaebdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5aSn6IOW:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766848956&amp;x-signature=qZEKNigwWQZAuVAbiE4KnBZj2Gw%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScriptæ‰“åŒ…å™¨å¤§å¥–èµ›ï¼šè°æ˜¯æ„å»ºé€Ÿåº¦ä¹‹ç‹ï¼Ÿ ğŸš€]]></title>    <link>https://juejin.cn/post/7585485074038210566</link>    <guid>https://juejin.cn/post/7585485074038210566</guid>    <pubDate>2025-12-20T15:54:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485074038210566" data-draft-id="7585474459777024036" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScriptæ‰“åŒ…å™¨å¤§å¥–èµ›ï¼šè°æ˜¯æ„å»ºé€Ÿåº¦ä¹‹ç‹ï¼Ÿ ğŸš€"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-12-20T15:54:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Yanni4Night"/> <meta itemprop="url" content="https://juejin.cn/user/4089838983724520"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScriptæ‰“åŒ…å™¨å¤§å¥–èµ›ï¼šè°æ˜¯æ„å»ºé€Ÿåº¦ä¹‹ç‹ï¼Ÿ ğŸš€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4089838983724520/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Yanni4Night
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T15:54:00.000Z" title="Sat Dec 20 2025 15:54:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fredmonk.com%2Fkholterhoff%2F2025%2F12%2F16%2Fjavascript-bundler-grand-prix%2F" target="_blank" title="https://redmonk.com/kholterhoff/2025/12/16/javascript-bundler-grand-prix/" ref="nofollow noopener noreferrer">redmonk.com/kholterhoffâ€¦</a></p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8f4c2bc8d3e447c82d97d3d3478a84a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgWWFubmk0TmlnaHQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766850839&amp;x-signature=B6M%2BnEDTV7gDbIKzksktEqpv7L0%3D" alt="image.png" loading="lazy"/></p>
<p>ä½ æœ‰æ²¡æœ‰è¿‡è¿™ç§ç»å†ï¼Ÿæ—©ä¸Šåˆ°å…¬å¸ï¼Œæ»¡æ€€æ¿€æƒ…åœ°æ‰“å¼€ä»£ç ç¼–è¾‘å™¨ï¼Œä¿®æ”¹äº†ä¸€è¡Œä»£ç ï¼Œç„¶åæ‰§è¡Œæ„å»ºå‘½ä»¤...ç»“æœå°±æ˜¯â€”â€”ç­‰å•Šç­‰ï¼Œç­‰åˆ°èŒ¶éƒ½å‡‰äº†ï¼Œæ„å»ºè¿˜æ²¡å®Œæˆï¼Ÿ</p>
<p>å¯¹JavaScriptå¼€å‘è€…æ¥è¯´ï¼Œ"å¦‚ä½•è®©æ„å»ºé€Ÿåº¦å¿«å“ªæ€•å‡ æ¯«ç§’"ä¸€ç›´æ˜¯ä¸ªæ‰§å¿µï¼Œä½†è¿›å±•å´å¦‚åŒèœ—ç‰›çˆ¬ã€‚ä¸è¿‡æœ€è¿‘ï¼Œå‡ å®¶å¤§å‚ç»ˆäºåä¸ä½äº†ï¼Œçº·çº·ç»™è‡ªå®¶çš„æ‰“åŒ…å™¨"æ‰“äº†é¸¡è¡€"ï¼š</p>
<ul>
<li>Vercelï¼ˆäº‘å¹³å°å·¨å¤´ï¼‰</li>
<li>VoidZeroï¼ˆVue.jsä½œè€…å°¤é›¨æºªçš„æ–°å…¬å¸ï¼Œä¸“æ³¨JSç”Ÿæ€åŸºå»ºï¼‰</li>
<li>ByteDanceï¼ˆå­—èŠ‚è·³åŠ¨ï¼Œæ²¡é”™å°±æ˜¯åšTikTokçš„é‚£å®¶ï¼‰</li>
</ul>
<p>ä»Vite+åˆ°Rspack 1.6ï¼Œå†åˆ°Next 16 betaé»˜è®¤å¯ç”¨Turbopackï¼ŒJavaScriptæ‰“åŒ…å™¨çš„ç«äº‰å·²ç»è¿›å…¥äº†ç™½çƒ­åŒ–é˜¶æ®µã€‚ä»Šå¤©å’±ä»¬å°±æ¥èŠèŠè¿™ä¸ªè¯é¢˜â€”â€”ä¸ä»…è¦çœ‹çœ‹æ‰“åŒ…å™¨çš„ç°çŠ¶ï¼Œè¿˜è¦æ·±æŒ–ä¸ºä»€ä¹ˆè¿™äº›å¤§å‚æ„¿æ„ç ¸é’±åœ¨è¿™ä¸Šé¢ã€‚</p>
<h2 data-id="heading-0">æ‰“åŒ…å™¨åˆ°åº•æ˜¯å¹²å˜›çš„ï¼Ÿ</h2>
<p>ç®€å•æ¥è¯´ï¼Œæ‰“åŒ…å™¨å°±æ˜¯æŠŠä½ é¡¹ç›®é‡Œæ•£è½çš„Nå¤šä¸ªJavaScriptæ–‡ä»¶ï¼ˆè¿˜æœ‰å®ƒä»¬çš„ä¾èµ–ï¼‰åˆå¹¶æˆä¸€ä¸ªä¼˜åŒ–è¿‡çš„å¤§æ–‡ä»¶ã€‚è¿™æ ·æµè§ˆå™¨åŠ è½½èµ·æ¥æ›´å¿«ï¼Œä¸ç”¨é¢‘ç¹å‘èµ·HTTPè¯·æ±‚ã€‚</p>
<p>ä¸è¿‡ç°åœ¨ï¼Œæ‰“åŒ…å™¨å·²ç»æˆäº†JavaScriptç”Ÿæ€é‡Œçš„"Formula 1èµ›è½¦"â€”â€”å„å¤§å‚å•†ç ¸å·¨èµ„ï¼Œåªä¸ºåœ¨æ„å»ºé€Ÿåº¦ä¸Šå¿«é‚£ä¹ˆä¸€ç‚¹ç‚¹ã€‚è¿™å¬èµ·æ¥æœ‰ç‚¹ç–¯ç‹‚ï¼Œä½†æƒ³æƒ³å¼€å‘è€…æ¯å¤©èŠ±åœ¨ç­‰æ„å»ºä¸Šçš„æ—¶é—´ï¼Œè¿™äº›æŠ•èµ„å…¶å®å¾ˆåˆç†ã€‚</p>
<p><strong>ä½†è¿™é‡Œæœ‰ä¸ªæ‰å¿ƒçš„äº‹å®ï¼š</strong> å¤§å®¶éƒ½åœ¨è¿½æ±‚æ›´å¿«çš„æ„å»ºé€Ÿåº¦ï¼Œå´å¾ˆå°‘æœ‰äººå…³æ³¨ç”¨æˆ·ä½“éªŒâ€”â€”ä¹Ÿå°±æ˜¯æœ€ç»ˆæ‰“åŒ…å‡ºæ¥çš„ä»£ç åœ¨æµè§ˆå™¨é‡Œè·‘èµ·æ¥æœ‰å¤šå¿«ã€‚è‡ƒè‚¿çš„JavaScriptä¾ç„¶æ˜¯ç”¨æˆ·çš„å™©æ¢¦ï¼Œé¡µé¢åŠ è½½æ…¢å¾—è®©äººæƒ³æ‘”æ‰‹æœºã€‚</p>
<p>çœŸæ­£çš„å¥–æ¯ä¸åº”è¯¥æ˜¯"æ›´å¿«çš„æ„å»ºé€Ÿåº¦"ï¼Œè€Œåº”è¯¥æ˜¯"æ›´å°çš„æ‰“åŒ…ä½“ç§¯ã€æ›´å°‘çš„æ— ç”¨ä»£ç ã€æ›´å¿«çš„é¡µé¢åŠ è½½"ã€‚è¦å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæ‰“åŒ…å™¨å’Œç¼–è¯‘å™¨å¾—æ›´ç´§å¯†åœ°åˆä½œï¼Œå®ç°è·¨æ¨¡å—çš„æ™ºèƒ½ä¼˜åŒ–ã€‚</p>
<h2 data-id="heading-1">æ‰“åŒ…å™¨ç”Ÿæ€ç³»ç»Ÿï¼šç¾¤é›„é€é¹¿</h2>
<p>JavaScriptæ‰“åŒ…å™¨çš„æ±Ÿæ¹–å¯è°“æ˜¯é—¨æ´¾æ—ç«‹ï¼Œå„æœ‰åƒç§‹ï¼š</p>
<ul>
<li><strong>Webpack</strong>ï¼šè€å¤§å“¥çº§åˆ«ï¼Œå¤æ‚é¡¹ç›®çš„é¦–é€‰ï¼Œä½†é€Ÿåº¦å˜›...ä½ æ‡‚çš„</li>
<li><strong>Rollup</strong>ï¼šåº“ä½œè€…çš„æœ€çˆ±ï¼Œæ ‘æ‘‡ï¼ˆtree-shakingï¼‰èƒ½åŠ›ä¸€æµï¼Œå¯¼å‡ºæ ¼å¼çµæ´»</li>
<li><strong>Browserify</strong>ï¼š2011å¹´å°±å‡ºé“çš„"è€å‰è¾ˆ"ï¼Œè®©Node.jsæ¨¡å—èƒ½åœ¨æµè§ˆå™¨é‡Œè·‘</li>
<li><strong>Microbundle</strong>ï¼šå°è€Œç¾ï¼Œé€‚åˆç®€å•çš„å°åº“</li>
<li><strong>ESBuild</strong>ï¼šç”¨Goå†™çš„é«˜æ€§èƒ½æ‰“åŒ…å™¨ï¼Œé€Ÿåº¦å¿«åˆ°é£èµ·</li>
<li><strong>Parcel</strong>ï¼š"é›¶é…ç½®"æ˜¯å®ƒçš„æ‹›ç‰Œï¼Œå¼€ç®±å³ç”¨</li>
<li><strong>Rolldown</strong>ï¼šVoidZeroå‡ºå“çš„Rustç‰ˆRollupï¼Œå…¼å®¹Rollupçš„API</li>
<li><strong>Bun</strong>ï¼šç”¨Zigå†™çš„å…¨èƒ½é€‰æ‰‹ï¼Œé›†è¿è¡Œæ—¶ã€æ‰“åŒ…å™¨ã€åŒ…ç®¡ç†å™¨ã€æµ‹è¯•æ¡†æ¶äºä¸€èº«</li>
<li><strong>Rspack</strong>ï¼šå­—èŠ‚è·³åŠ¨çš„Rustç‰ˆWebpackï¼Œå·ç§°æ¯”Webpackæ›´å¿«</li>
<li><strong>Turbopack</strong>ï¼šVercelçš„"ä¸‹ä¸€ä»£æ‰“åŒ…å™¨"ï¼Œé»˜è®¤å¯ç”¨åœ¨Next 16 betaé‡Œ</li>
</ul>
<p><strong>ä½ å‘ç°è§„å¾‹äº†å—ï¼Ÿ</strong> æ–°ä¸€ä»£æ‰“åŒ…å™¨è¶Šæ¥è¶Šå¤šåœ°ç”¨Rustï¼ˆæˆ–Goï¼‰é‡å†™ï¼Œç”¨JavaScriptçš„çµæ´»æ€§æ¢æ¥äº†çº¯çº¯çš„é€Ÿåº¦ã€‚è€Œæ‰€æœ‰è¿™äº›åŠªåŠ›çš„æ ¸å¿ƒç›®æ ‡åªæœ‰ä¸€ä¸ªï¼š<strong>æ›´å¿«çš„æ„å»ºæ—¶é—´</strong>ã€‚</p>
<h2 data-id="heading-2">ä¸ºä»€ä¹ˆRustæˆäº†æ‰“åŒ…å™¨çš„æ–°å® ï¼Ÿ</h2>
<p>ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œä¸ºä»€ä¹ˆå¤§å®¶çªç„¶éƒ½å¼€å§‹ç”¨Rustå†™æ‰“åŒ…å™¨äº†ï¼Ÿè¿™é‡Œé¢æœ‰å‡ ä¸ªå…³é”®åŸå› ï¼š</p>
<ol>
<li><strong>æ€§èƒ½çˆ†ç‚¸</strong>ï¼šRustçš„æ€§èƒ½å¯ä»¥å’ŒC/C++åª²ç¾ï¼Œä½†å†…å­˜å®‰å…¨æ€§æ›´é«˜ï¼Œä¸ä¼šå‡ºç°ä»¤äººå¤´ç–¼çš„æ®µé”™è¯¯</li>
<li><strong>å¹¶å‘å‹å¥½</strong>ï¼šRustçš„æ‰€æœ‰æƒæ¨¡å‹è®©å¹¶å‘ç¼–ç¨‹å˜å¾—å®‰å…¨åˆç®€å•ï¼Œæ‰“åŒ…å™¨å¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸CPU</li>
<li><strong>ç”Ÿæ€æˆç†Ÿ</strong>ï¼šRustæœ‰ä¸°å¯Œçš„å·¥å…·é“¾å’Œåº“æ”¯æŒï¼Œç‰¹åˆ«æ˜¯åœ¨ç³»ç»Ÿç¼–ç¨‹å’Œé«˜æ€§èƒ½è®¡ç®—é¢†åŸŸ</li>
<li><strong>è·¨å¹³å°</strong>ï¼šRustç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥åœ¨å„ç§å¹³å°ä¸Šè¿è¡Œï¼Œæ— éœ€ä¾èµ–è¿è¡Œæ—¶</li>
</ol>
<p>ç®€å•æ¥è¯´ï¼Œç”¨Rustå†™æ‰“åŒ…å™¨ï¼Œå°±åƒæ˜¯ç»™æ‰“åŒ…å™¨æ¢ä¸Šäº†"V8å‘åŠ¨æœº"â€”â€”æ€§èƒ½ç›´æ¥èµ·é£ï¼</p>
<h2 data-id="heading-3">ä¸ºä»€ä¹ˆå¤§å®¶è¿™ä¹ˆçœ‹é‡æ‰“åŒ…å™¨ï¼Ÿ</h2>
<p>JavaScriptæ‰“åŒ…å™¨ç”Ÿæ€çš„ç¹è£ï¼Œä¸ä»…ä»…æ˜¯ä¸ºäº†åˆ›æ–°è€Œåˆ›æ–°ï¼Œæ›´æ˜¯å¯¹å¼€å‘è€…ä»¬çš„é›†ä½“åæ§½çš„å›åº”â€”â€”"æ„å»ºå¤ªæ…¢äº†ï¼ä»£ç å¤ªè‡ƒè‚¿äº†ï¼"</p>
<p>æŠ•èµ„æ‰“åŒ…å™¨çš„åŠ¨æœºæœ‰å¾ˆå¤šï¼š</p>
<ol>
<li><strong>æé«˜ç”Ÿäº§åŠ›</strong>ï¼šå°‘ç­‰ä¸€åˆ†é’Ÿæ„å»ºï¼Œå°±èƒ½å¤šå†™ä¸€åˆ†é’Ÿä»£ç </li>
<li><strong>æå‡é€Ÿåº¦</strong>ï¼šå¿«å°±æ˜¯ç”Ÿäº§åŠ›</li>
<li><strong>é©¯æœå¤æ‚æ€§</strong>ï¼šJavaScriptçš„å¤æ‚åº¦å·²ç»å¿«å¤±æ§äº†ï¼Œæ‰“åŒ…å™¨æ˜¯å”¯ä¸€èƒ½ç®¡ä½å®ƒçš„å·¥å…·</li>
</ol>
<p>éšç€Webé¡¹ç›®è¶Šåšè¶Šå¤§ï¼Œä¾èµ–è¶Šæ¥è¶Šå¤šï¼Œæ‰“åŒ…å™¨æˆäº†å¿…éœ€å“ã€‚å®ƒä»¬æ˜¯SPAæ—¶ä»£ä»¥æ¥JavaScriptä¾èµ–è†¨èƒ€é—®é¢˜çš„è‡ªç„¶ç»“æœã€‚</p>
<p>æŸç§ç¨‹åº¦ä¸Šï¼Œæ•´ä¸ªè¡Œä¸šå¯¹æ›´å¿«æ„å»ºå·¥å…·çš„æ‰§ç€ï¼Œå¯èƒ½åªæ˜¯åœ¨ç»™JavaScripté‡å‹æ¡†æ¶çš„æ·±å±‚ç»“æ„é—®é¢˜è´´åˆ›å¯è´´ã€‚ä½†ä¸ç®¡æ€æ ·ï¼Œèƒ½è®©å¼€å‘è€…å°‘ç­‰ä¸€ä¼šå„¿æ„å»ºï¼Œæ€»æ˜¯å¥½çš„ã€‚</p>
<h2 data-id="heading-4">åŸºå‡†æµ‹è¯•ï¼šåˆ«å¤ªå½“çœŸ</h2>
<p><strong>åŸºå‡†æµ‹è¯•ä¸å¯é ï¼</strong> è¿™æ˜¯äº˜å¤ä¸å˜çš„çœŸç†ï¼Œä½†è¿™å¹¶ä¸å¦¨ç¢å‚å•†ä»¬ç ¸é’±è¯æ˜è‡ªå·±çš„å·¥å…·æ›´å¿«ã€‚</p>
<p>æ¯”å¦‚Vercelçš„Next.jså›¢é˜Ÿï¼Œä¸ºäº†ä¼˜åŒ–æ‰“åŒ…å™¨ï¼Œä¸ä»…èŠ±äº†å¥½å‡ å¹´æ—¶é—´ï¼Œè¿˜æŒ–æ¥äº†Webpackçš„åˆ›å§‹äººTobias Koppersã€‚ä»–ä»¬çš„åŠªåŠ›ç¡®å®æœ‰æˆæ•ˆï¼Œä½†åŸºå‡†æµ‹è¯•çš„ç»“æœ...çœ‹çœ‹å°±å¥½ã€‚</p>
<p>å°±åƒå½“å¹´çš„TPC-Cæ•°æ®åº“åŸºå‡†æµ‹è¯•ä¸€æ ·ï¼Œæ•´ä¸ªè¡Œä¸šéƒ½å›´ç»•ç€è¿™äº›æ ‡å‡†ä¼˜åŒ–ï¼Œä½†çœŸå®ä¸–ç•Œçš„æƒ…å†µå¾€å¾€å¤æ‚å¾—å¤šã€‚</p>
<h2 data-id="heading-5">ä»é€Ÿåº¦åˆ°æ•ˆç‡ï¼šæ‰“åŒ…å™¨çš„æœªæ¥æ–¹å‘</h2>
<p>è™½ç„¶ç›®å‰å¤§å®¶éƒ½åœ¨æ¯”æ‹¼æ„å»ºé€Ÿåº¦ï¼Œä½†è¿™ç§"å†›å¤‡ç«èµ›"å¯èƒ½å¾ˆå¿«å°±ä¼šè½¬å‘æ›´æœ‰æ„ä¹‰çš„æ–¹å‘ã€‚æ­£å¦‚F1èµ›è½¦ä»å•çº¯è¿½æ±‚é€Ÿåº¦è½¬å‘ç©ºæ°”åŠ¨åŠ›å­¦æ•ˆç‡ä¸€æ ·ï¼Œæ‰“åŒ…å™¨ä¹Ÿå¼€å§‹ä»"æ›´å¿«"è½¬å‘"æ›´æ™ºèƒ½"ã€‚</p>
<h3 data-id="heading-6">æ¶æ„çš„æ¼”å˜</h3>
<p>Tobias Koppersï¼ˆWebpackåˆ›å§‹äººï¼‰æè¿°äº†æ‰“åŒ…å™¨æ¶æ„çš„æ¼”å˜ï¼šä»å•ä¸€çš„ç®¡é“å¼å¤„ç†ï¼Œåˆ°åˆ†å¸ƒå¼çš„å¢é‡è®¡ç®—ã€‚è¿™æ„å‘³ç€æ‰“åŒ…å™¨ä¸å†æ˜¯"ä¸€æ¬¡å¤„ç†æ‰€æœ‰æ–‡ä»¶"ï¼Œè€Œæ˜¯å˜å¾—æ›´åŠ æ™ºèƒ½åŒ–ï¼Œå¯ä»¥åªå¤„ç†å˜æ›´çš„éƒ¨åˆ†ï¼Œå¹¶ä¸”å……åˆ†åˆ©ç”¨å¤šæ ¸CPUçš„ä¼˜åŠ¿ã€‚</p>
<h3 data-id="heading-7">çœŸæ­£çš„ç”¨æˆ·ä½“éªŒä¼˜åŒ–</h3>
<p>å½“Rspackå’ŒSWCè¿™æ ·çš„å·¥å…·åœ¨è·¨æ¨¡å—åˆ†æä¸Šæ›´æ·±å…¥åœ°åˆä½œæ—¶ï¼Œå½“æ‰“åŒ…å™¨ç»ˆäºèƒ½å¤Ÿå‰¥ç¦»æ‰é‚£50%æœªä½¿ç”¨çš„"æ­»ä»£ç "æ—¶ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°ç”¨æˆ·ä½“éªŒçš„çœŸæ­£æå‡ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨å¼€å‘è€…æ„å»ºæ—¶é—´ä¸ŠèŠ‚çœå‡ æ¯«ç§’ã€‚è¿™æ‰æ˜¯çœŸæ­£é‡è¦çš„"å‡é˜»"ã€‚</p>
<h3 data-id="heading-8">JavaScriptç”Ÿæ€çš„æˆç†Ÿ</h3>
<p>æ‰“åŒ…å™¨ç”Ÿæ€ç³»ç»Ÿçš„æˆç†Ÿåæ˜ äº†æ›´å¹¿æ³›çš„JavaScriptç¤¾åŒºçš„æ¼”å˜â€”â€”ä»"å¿«é€Ÿè¿­ä»£ï¼Œæ‰“ç ´ä¸€åˆ‡"åˆ°"å¯æŒç»­åœ°å¤§è§„æ¨¡æ„å»º"ã€‚å…¬å¸ä»¬åœ¨è¿™äº›å·¥å…·ä¸ŠæŠ•å…¥èµ„æºï¼Œä¸ä»…æ˜¯ä¸ºäº†å‡å°‘"åœˆé€Ÿ"ï¼Œæ›´æ˜¯å› ä¸ºæ‰“åŒ…å™¨å·²ç»æˆä¸ºç°ä»£Webçš„å…³é”®åŸºç¡€è®¾æ–½ã€‚</p>
<h2 data-id="heading-9">ç»“è¯­</h2>
<p>JavaScriptæ‰“åŒ…å™¨çš„ç«äº‰è¿˜åœ¨ç»§ç»­ï¼ŒRustå’ŒGoæ­£åœ¨å–ä»£JavaScriptæˆä¸ºæ‰“åŒ…å™¨çš„æ–°å® ã€‚ä½†æ— è®ºæŠ€æœ¯å¦‚ä½•å˜åŒ–ï¼Œæœ‰ä¸€ç‚¹æ˜¯è‚¯å®šçš„ï¼šå¼€å‘è€…ä»¬å—å¤Ÿäº†æ…¢æ„å»ºï¼Œä»–ä»¬éœ€è¦æ›´å¿«ã€æ›´é«˜æ•ˆçš„å·¥å…·ã€‚</p>
<p>ä¸è¿‡ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥åæ€ä¸€ä¸‹ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬çš„ä»£ç åº“ä¼šå˜å¾—å¦‚æ­¤åºå¤§ï¼Ÿä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å¦‚æ­¤å¤æ‚çš„æ„å»ºå·¥å…·ï¼Ÿè¿™å°±åƒF1èµ›è½¦ä¸€æ ·â€”â€”æˆ‘ä»¬æŠ•å…¥äº†å·¨å¤§çš„å·¥ç¨‹èµ„æºæ¥è§£å†³ä¸€ä¸ªæ”¶ç›Šé€’å‡çš„é—®é¢˜ã€‚</p>
<p>å¥½æ¶ˆæ¯æ˜¯ï¼Œéšç€æ‰“åŒ…å™¨æ€§èƒ½è¶‹äºä¸€è‡´ï¼Œå…³æ³¨ç‚¹è‡ªç„¶ä¼šè½¬ç§»åˆ°å¯¹ç»ˆç«¯ç”¨æˆ·çœŸæ­£é‡è¦çš„ä¸œè¥¿ä¸Šï¼šæ›´å°çš„æ‰“åŒ…ä½“ç§¯ã€æ›´å¿«çš„è¿è¡Œæ—¶æ€§èƒ½ã€æ›´æ™ºèƒ½çš„ä»£ç æ¶ˆé™¤ã€‚</p>
<p>æ‰“åŒ…å™¨ä¹‹æˆ˜å¯èƒ½å³å°†æ¥è¿‘ç»ˆç‚¹ï¼Œä½†JavaScriptçš„"ç†æ™ºä¹‹æˆ˜"æ‰åˆšåˆšå¼€å§‹ã€‚æœ€ç»ˆçš„å† å†›ä¸ä¼šæ˜¯åœ¨åˆæˆåŸºå‡†æµ‹è¯•ä¸­è·‘å¾—æœ€å¿«çš„é‚£ä¸ªï¼Œè€Œæ˜¯èƒ½åœ¨æä¾›æœ€æ™ºèƒ½ã€æœ€å¯ç»´æŠ¤ã€æœ€å®ç”¨çš„å¼€å‘è€…ä½“éªŒçš„åŒæ—¶ï¼Œç”Ÿæˆæœ€ç²¾ç®€çš„ç”Ÿäº§ä»£ç çš„é‚£ä¸ªã€‚</p>
<p>ä½ ç°åœ¨ç”¨çš„æ˜¯å“ªä¸ªæ‰“åŒ…å™¨ï¼Ÿå¿«åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ä½¿ç”¨ä½“éªŒå§ï¼ğŸ‘‡</p>
<hr/>
<p><em>å¤´å›¾ï¼šæ‘©çº³å“¥å¤§å¥–èµ›çš„è´¹å°”è’™å‘å¤¹å¼¯ï¼ˆThe Fairmont Hairpin at the Monaco Grand Prixï¼‰</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Data å±‚è®¾è®¡çš„å››æ¡çº¢çº¿ï¼šä¸ºä»€ä¹ˆå¿…é¡»åšæŒã€å¦‚ä½•è½åœ°]]></title>    <link>https://juejin.cn/post/7585476892975988770</link>    <guid>https://juejin.cn/post/7585476892975988770</guid>    <pubDate>2025-12-20T11:30:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585476892975988770" data-draft-id="7585446706326601737" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Data å±‚è®¾è®¡çš„å››æ¡çº¢çº¿ï¼šä¸ºä»€ä¹ˆå¿…é¡»åšæŒã€å¦‚ä½•è½åœ°"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-12-20T11:30:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ½œé¾™å‹¿ç”¨ä¹‹åŒ–éª¨é¾™"/> <meta itemprop="url" content="https://juejin.cn/user/2313028195058471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Data å±‚è®¾è®¡çš„å››æ¡çº¢çº¿ï¼šä¸ºä»€ä¹ˆå¿…é¡»åšæŒã€å¦‚ä½•è½åœ°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028195058471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ½œé¾™å‹¿ç”¨ä¹‹åŒ–éª¨é¾™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T11:30:08.000Z" title="Sat Dec 20 2025 11:30:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç°ä»£ Android æ¶æ„ä¸­ï¼ŒData å±‚æ˜¯æ•´ä¸ªç³»ç»Ÿç¨³å®šæ€§ä¸å¯ç»´æŠ¤æ€§çš„åŸºçŸ³ã€‚æ— è®ºæ˜¯ Clean Architectureã€MVVMã€MVIï¼Œè¿˜æ˜¯æ¨¡å—åŒ–æ¶æ„ï¼ŒData å±‚éƒ½æ‰¿æ‹…ç€â€œçœŸå®ä¸–ç•Œ â†’ é¢†åŸŸé€»è¾‘â€çš„å…³é”®èŒè´£ã€‚<br/>
ç„¶è€Œï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼ŒData å±‚å¾€å¾€æœ€å®¹æ˜“å‡ºç°éšæ€§é£é™©ï¼šé˜»å¡ã€é”™è¯¯çš„å¹¶å‘æ¨¡å‹ã€æ¥å£ä¸ä¸€è‡´ã€ä¼ªå¼‚æ­¥ç­‰é—®é¢˜ä¼šåœ¨åæœŸæ¼”å˜æˆæ€§èƒ½ç“¶é¢ˆã€çº¿ç¨‹æ­»é”ã€ä¸å¯æ§çš„å¼‚å¸¸ï¼Œç”šè‡³å½±å“ä¸šåŠ¡ç¨³å®šæ€§ã€‚</p>
<p>ä¸ºäº†è®© Data å±‚å…·å¤‡å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§ä¸é«˜å¹¶å‘å®‰å…¨æ€§ï¼Œæˆ‘ä»¬æ€»ç»“å‡º å››æ¡ç»å¯¹ä¸èƒ½è§¦ç¢°çš„çº¢çº¿ã€‚è¿™äº›çº¢çº¿ä¸æ˜¯â€œæœ€ä½³å®è·µâ€ï¼Œè€Œæ˜¯â€œåº•çº¿è¦æ±‚â€ã€‚</p>
<hr/>
<p>çº¢çº¿ä¸€ï¼šæ¥å£è¿”å›ç±»å‹å¿…é¡»æ˜¯ Flow æˆ– suspendï¼Œç¦æ­¢å‡ºç°å…¶ä»–å¼‚æ­¥å½¢å¼</p>
<p>âŒ é”™è¯¯ç¤ºä¾‹</p>
<ul>
<li>å›è°ƒ callback</li>
<li>LiveData</li>
<li>RxJavaï¼ˆé™¤éå†å²åŒ…è¢±ï¼‰</li>
<li>è‡ªå®šä¹‰ Listener</li>
<li>Future / CompletableFuture</li>
</ul>
<p>âœ”ï¸ æ­£ç¡®åšæ³•</p>
<ul>
<li>å•æ¬¡ç»“æœ â†’ suspend fun</li>
<li>è¿ç»­æ•°æ®æµ â†’ Flow</li>
</ul>
<p>ä¸ºä»€ä¹ˆè¿™æ˜¯çº¢çº¿ï¼Ÿ</p>
<ul>
<li>Data å±‚æ˜¯æœ€åº•å±‚ï¼Œå¿…é¡»ä¿æŒæœ€å°ä¾èµ–ä¸æœ€çº¯ç²¹çš„ Kotlin å¹¶å‘æ¨¡å‹ã€‚</li>
<li>Flow + suspend æ˜¯ Kotlin å®˜æ–¹å¹¶å‘ä½“ç³»çš„æ ¸å¿ƒï¼Œå…·å¤‡ç»“æ„åŒ–å¹¶å‘ã€å–æ¶ˆä¼ æ’­ã€èƒŒå‹ã€çº¿ç¨‹è°ƒåº¦ç­‰èƒ½åŠ›ã€‚</li>
<li>ç»Ÿä¸€æ¥å£é£æ ¼èƒ½æå¤§é™ä½ä¸Šå±‚å¤æ‚åº¦ï¼Œè®© UseCaseã€ViewModelã€UI å±‚çš„åç¨‹æ¨¡å‹ä¿æŒä¸€è‡´ã€‚</li>
</ul>
<p>é¢å¤–å»ºè®®</p>
<ul>
<li>Repository å±‚æ¥å£å¿…é¡»ç»Ÿä¸€ä¸º Flow æˆ– suspendï¼Œä¸å…è®¸æ··ç”¨ã€‚</li>
<li>å¦‚æœæ˜¯ Flowï¼Œå¿…é¡»æ˜ç¡®å†·æµ/çƒ­æµè¯­ä¹‰ï¼Œé¿å…è¯¯ç”¨ã€‚</li>
</ul>
<p>å¦‚ä½•é€‰æ‹© flow æˆ–è€…sunpend è¯·æŸ¥çœ‹<a href="https://juejin.cn/post/758356765825376258" target="_blank" title="https://juejin.cn/post/758356765825376258"># Repository æ–¹æ³•è®¾è®¡ï¼šsuspend ä¸ Flow çš„å†³é€‰æ‹©æŒ‡å—ï¼ˆä»¥æœ‹å‹åœˆä¸ºä¾‹ï¼‰</a></p>
<p>çº¢çº¿äºŒï¼šç¦æ­¢ä½¿ç”¨é˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueã€LinkedBlockingQueue ç­‰ï¼‰</p>
<p>ä¸ºä»€ä¹ˆç¦æ­¢ï¼Ÿ
é˜»å¡é˜Ÿåˆ—å±äº Java çº¿ç¨‹æ¨¡å‹ï¼Œä¸ Kotlin åç¨‹çš„ç»“æ„åŒ–å¹¶å‘å®Œå…¨ä¸å…¼å®¹ï¼Œä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>é˜»å¡çº¿ç¨‹æ± ï¼Œå¯¼è‡´ Dispatchers.IO é¥±å’Œ</li>
<li>æ— æ³•å–æ¶ˆï¼Œåç¨‹å–æ¶ˆä¸ä¼šä¸­æ–­é˜»å¡é˜Ÿåˆ—</li>
<li>éšæ€§æ­»é”ï¼ˆå°¤å…¶æ˜¯ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å‹ï¼‰</li>
<li>æ€§èƒ½ä¸å¯æ§ï¼Œéš¾ä»¥æµ‹è¯•</li>
</ul>
<p>æ›¿ä»£æ–¹æ¡ˆ</p>

























<table><thead><tr><th>éœ€æ±‚</th><th>æ­£ç¡®æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>ç”Ÿäº§è€…/æ¶ˆè´¹è€…</td><td>Channel</td></tr><tr><td>å•å€¼å…±äº«</td><td>MutableStateFlow</td></tr><tr><td>å¤šå€¼äº‹ä»¶</td><td>SharedFlow</td></tr><tr><td>èƒŒå‹æ§åˆ¶</td><td>Flow + buffer()</td></tr></tbody></table>
<p>å…³é”®ç‚¹
Data å±‚å¿…é¡»ä½¿ç”¨ åç¨‹åŸç”Ÿå¹¶å‘å·¥å…·ï¼Œè€Œä¸æ˜¯ Java å¹¶å‘å·¥å…·ã€‚</p>
<p>çº¢çº¿ä¸‰ï¼šç¦æ­¢ä½¿ç”¨ Java é‡é”ï¼ˆReentrantLockã€synchronizedã€wait/notifyï¼‰</p>
<p>ä¸ºä»€ä¹ˆç¦æ­¢ï¼Ÿ
Java é‡é”å±äºâ€œé˜»å¡å¼é”â€ï¼Œä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>é˜»å¡çº¿ç¨‹ â†’ ç ´ååç¨‹è°ƒåº¦</li>
<li>æ— æ³•å–æ¶ˆ â†’ åç¨‹å–æ¶ˆä¸ä¼šé‡Šæ”¾é”</li>
<li>å®¹æ˜“æ­»é” â†’ ç‰¹åˆ«æ˜¯åœ¨å¤š Repository å¹¶å‘è®¿é—®æ—¶</li>
<li>éš¾ä»¥æµ‹è¯• â†’ å•å…ƒæµ‹è¯•ä¸­çº¿ç¨‹è°ƒåº¦ä¸å¯æ§</li>
</ul>
<p>æ­£ç¡®æ›¿ä»£æ–¹æ¡ˆ</p>

























<table><thead><tr><th>åœºæ™¯</th><th>æ¨èå·¥å…·</th></tr></thead><tbody><tr><td>ä¸´ç•ŒåŒºä¿æŠ¤</td><td>Mutex</td></tr><tr><td>åŸå­æ“ä½œ</td><td>Atomic*</td></tr><tr><td>å¤šåç¨‹åŒæ­¥</td><td>Channel / Flow</td></tr><tr><td>èµ„æºè®¿é—®é¡ºåºæ§åˆ¶</td><td>Semaphore</td></tr></tbody></table>
<p>å…³é”®åŸåˆ™</p>
<blockquote>
<p>Data å±‚å¿…é¡»ä½¿ç”¨ åç¨‹å‹å¥½çš„åŒæ­¥åŸè¯­ï¼Œç¡®ä¿ä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚</p>
</blockquote>
<p>è¯·å‚è€ƒ <a href="https://link.juejin.cn?target=http%3A%2F%2F172.27.35.22%3A8080%2F%23table%3Dsqlite_sequence" target="_blank" title="http://172.27.35.22:8080/#table=sqlite_sequence" ref="nofollow noopener noreferrer"># å¹¶å‘ç¼–ç¨‹çš„æ–°ç¯‡ç« ï¼šä»¥Kotlinåç¨‹å‘Šåˆ«JUCçš„é‡é”ä¸æ­»é”é£é™©</a></p>
<p>çº¢çº¿å››ï¼šsuspend æ–¹æ³•å†…éƒ¨å¿…é¡»æ˜¯çœŸæ­£çš„å¼‚æ­¥ï¼Œç¦æ­¢ä¼ªå¼‚æ­¥</p>
<p>âŒ é”™è¯¯ç¤ºä¾‹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edf34cc03e744e83a63a45bfa991ac50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835008&amp;x-signature=wUV8xl9NGh%2BijIghYC%2FjqLPL8i0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cad8e99c9fc4fa3bd7ff5440596e34b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835008&amp;x-signature=fR3NYHIvYV3%2BkSQLvfrBIFw%2B5uQ%3D" alt="image.png" loading="lazy"/></p>
<p>âœ”ï¸ æ­£ç¡®ç¤ºä¾‹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f85556c3bc364e1890838d8cf8b8bab8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5r2c6b6Z5Yu_55So5LmL5YyW6aqo6b6Z:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835008&amp;x-signature=MKo0l4TJ%2B4GFi2WKo%2FrirumAF5E%3D" alt="image.png" loading="lazy"/></p>
<p>ä¸ºä»€ä¹ˆè¿™æ˜¯çº¢çº¿ï¼Ÿ</p>
<ul>
<li>suspend ä¸æ˜¯â€œå¼‚æ­¥â€çš„ä»£åè¯ï¼Œå®ƒåªæ˜¯â€œå¯æŒ‚èµ·â€ã€‚</li>
<li>å¦‚æœå†…éƒ¨ä»ç„¶é˜»å¡çº¿ç¨‹ï¼Œåç¨‹å°±å¤±å»æ„ä¹‰ã€‚</li>
<li>ä¼ªå¼‚æ­¥ä¼šå¯¼è‡´ï¼š
<ul>
<li>IO çº¿ç¨‹æ± è¢«å æ»¡</li>
<li>UI å¡é¡¿</li>
<li>å–æ¶ˆä¸ç”Ÿæ•ˆ</li>
<li>æ€§èƒ½ä¸‹é™</li>
</ul>
</li>
</ul>
<p>å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ˜¯çœŸå¼‚æ­¥ï¼Ÿ</p>
<ul>
<li>æ˜¯å¦ä½¿ç”¨äº† withContext(Dispatchers.IO)ï¼Ÿ</li>
<li>æ˜¯å¦è°ƒç”¨äº†çœŸæ­£çš„å¼‚æ­¥ APIï¼ˆå¦‚ Retrofit suspendã€Room suspendï¼‰ï¼Ÿ</li>
<li>æ˜¯å¦é¿å…äº†é˜»å¡å¼ APIï¼ˆFileã€Socketã€Java IOï¼‰ï¼Ÿ</li>
</ul>
<p>æ€»ç»“ï¼šData å±‚çš„å››æ¡çº¢çº¿ä¸æ˜¯å»ºè®®ï¼Œè€Œæ˜¯åº•çº¿</p>






























<table><thead><tr><th>çº¢çº¿</th><th>æ ¸å¿ƒé—®é¢˜</th><th>æ­£ç¡®åšæ³•</th></tr></thead><tbody><tr><td>1. æ¥å£å¿…é¡»æ˜¯ Flow æˆ– suspend</td><td>æ¥å£é£æ ¼æ··ä¹±ã€å¹¶å‘æ¨¡å‹ä¸ç»Ÿä¸€</td><td>ç»Ÿä¸€ Kotlin å¹¶å‘æ¨¡å‹</td></tr><tr><td>2. ç¦æ­¢é˜»å¡é˜Ÿåˆ—</td><td>é˜»å¡çº¿ç¨‹ã€æ­»é”é£é™©</td><td>ä½¿ç”¨ Channel / Flow</td></tr><tr><td>3. ç¦æ­¢ Java é‡é”</td><td>é˜»å¡å¼é”ç ´ååç¨‹</td><td>ä½¿ç”¨ Mutex / atomic</td></tr><tr><td>4. suspend å†…å¿…é¡»æ˜¯çœŸå¼‚æ­¥</td><td>ä¼ªå¼‚æ­¥å¯¼è‡´æ€§èƒ½é—®é¢˜</td><td>withContext + çœŸå¼‚æ­¥ API</td></tr></tbody></table>
<p>è¯·å‚è€ƒ
<a href="https://juejin.cn/post/7527881245238263846" target="_blank" title="https://juejin.cn/post/7527881245238263846"># Kotlin åç¨‹çš„äº”å¤§å¸¸è§é”™è¯¯ç”¨æ³•åŠæœ€ä½³å®è·µ</a></p>
<p>ç»“è¯­ï¼šData å±‚çš„ç¨³å®šæ€§å†³å®šæ•´ä¸ªç³»ç»Ÿçš„ç¨³å®šæ€§</p>
<p>Data å±‚æ˜¯æ‰€æœ‰ä¸šåŠ¡çš„æ ¹åŸºã€‚<br/>
ä¸€æ—¦åº•å±‚å‡ºç°é˜»å¡ã€æ­»é”ã€ä¼ªå¼‚æ­¥ç­‰é—®é¢˜ï¼Œè¶Šå¾€ä¸Šå±‚å½±å“è¶Šå¤§ï¼Œæœ€ç»ˆä¼šæ¼”å˜æˆéš¾ä»¥æ’æŸ¥çš„çº¿ä¸Šé—®é¢˜ã€‚</p>
<p>åšæŒè¿™å››æ¡çº¢çº¿ï¼Œå°±æ˜¯åœ¨ä¸ºæ•´ä¸ªç³»ç»Ÿçš„é•¿æœŸå¯ç»´æŠ¤æ€§è´Ÿè´£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutterå¸¸è§é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7585476892976611362</link>    <guid>https://juejin.cn/post/7585476892976611362</guid>    <pubDate>2025-12-20T15:30:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585476892976611362" data-draft-id="7585485284152868899" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutterå¸¸è§é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="Flutter,Dart,å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T15:30:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ— çŸ¥çš„å‰ç«¯"/> <meta itemprop="url" content="https://juejin.cn/user/2410561882569933"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutterå¸¸è§é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2410561882569933/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ— çŸ¥çš„å‰ç«¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T15:30:32.000Z" title="Sat Dec 20 2025 15:30:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. æ€§èƒ½é—®é¢˜ï¼šå¡é¡¿å’Œæ‰å¸§</h2>
<h3 data-id="heading-1">é—®é¢˜è¡¨ç°</h3>
<ul>
<li>å¤æ‚UIæ»šåŠ¨æ—¶å¡é¡¿</li>
<li>åŠ¨ç”»ä¸æµç•…</li>
<li>é¡µé¢è·³è½¬å»¶è¿Ÿ</li>
</ul>
<h3 data-id="heading-2">è§£å†³æ–¹æ³•</h3>
<p>dart</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. ä½¿ç”¨constæ„é€ å™¨</span>
class MyWidget extends StatelessWidget {
  <span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹</span>
  Widget <span class="hljs-built_in">build</span>() =&gt; <span class="hljs-built_in">Container</span>(color: Colors.red);
  
  <span class="hljs-comment">// æ­£ç¡®ç¤ºä¾‹ - ä½¿ç”¨const</span>
  Widget <span class="hljs-built_in">build</span>() =&gt; const <span class="hljs-built_in">SizedBox</span>(width: <span class="hljs-number">50</span>);
}

<span class="hljs-comment">// 2. åˆ—è¡¨ä¼˜åŒ–</span>
ListView<span class="hljs-selector-class">.builder</span>(
  itemCount: <span class="hljs-number">1000</span>,
  itemBuilder: (context, index) {
    return <span class="hljs-built_in">ListTile</span>(
      key: ValueKey(index), <span class="hljs-comment">// ä½¿ç”¨Keyæé«˜æ€§èƒ½</span>
      title: <span class="hljs-built_in">Text</span>(<span class="hljs-string">'Item $index'</span>),
    );
  },
  <span class="hljs-comment">// æ·»åŠ ä»¥ä¸‹ä¼˜åŒ–é€‰é¡¹</span>
  addAutomaticKeepAlives: false,
  addRepaintBoundaries: false, // å¯¹ç®€å•é¡¹å¯ç¦ç”¨
);

<span class="hljs-comment">// 3. ä½¿ç”¨RepaintBoundaryéš”ç¦»é‡ç»˜</span>
<span class="hljs-built_in">RepaintBoundary</span>(
  child: ExpensiveWidget(),
);

<span class="hljs-comment">// 4. å¼‚æ­¥åŠ è½½å›¾ç‰‡</span>
Image<span class="hljs-selector-class">.network</span>(
  'url',
  loadingBuilder: (context, child, progress) {
    return progress == null ? child : <span class="hljs-built_in">CircularProgressIndicator</span>();
  },
);
</code></pre>
<h3 data-id="heading-3">æ€§èƒ½å·¥å…·</h3>
<p>bash</p>
<pre><code class="hljs language-arduino" lang="arduino"># æ€§èƒ½åˆ†æ
flutter run --profile
flutter run --trace-skia

# æŸ¥çœ‹æ€§èƒ½é¢æ¿
flutter run --enable-impeller  # æ–°çš„æ¸²æŸ“å¼•æ“
</code></pre>
<h2 data-id="heading-4">2. çŠ¶æ€ç®¡ç†é—®é¢˜</h2>
<h3 data-id="heading-5">é—®é¢˜è¡¨ç°</h3>
<ul>
<li>çŠ¶æ€ä¸åŒæ­¥</li>
<li>ä¸å¿…è¦çš„é‡å»º</li>
<li>å†…å­˜æ³„æ¼</li>
</ul>
<h3 data-id="heading-6">è§£å†³æ–¹æ³•</h3>
<p>dart</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// 1. é€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆ</span>
<span class="hljs-comment">// ç®€å•åº”ç”¨ï¼šProvider + ChangeNotifier</span>
<span class="hljs-comment">// ä¸­ç­‰åº”ç”¨ï¼šRiverpod</span>
<span class="hljs-comment">// å¤æ‚åº”ç”¨ï¼šBloc/Cubit</span>

<span class="hljs-comment">// 2. Provideræœ€ä½³å®è·µ</span>
<span class="hljs-keyword">final</span> counterProvider = <span class="hljs-type">StateProvider</span>&lt;int&gt;((ref) =&gt; <span class="hljs-number">0</span>);

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ConsumerWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context, <span class="hljs-type">WidgetRef</span> ref) {
    <span class="hljs-keyword">final</span> count = ref.watch(counterProvider);
    
    <span class="hljs-keyword">return</span> <span class="hljs-type">Text</span>('$count');
  }
}

<span class="hljs-comment">// 3. é¿å…çŠ¶æ€æ»¥ç”¨</span>
<span class="hljs-comment">// ä½¿ç”¨StateNotifieræ›¿ä»£ChangeNotifier</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CounterNotifier</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StateNotifier&lt;int&gt;</span> </span>{
  <span class="hljs-type">CounterNotifier</span>() : <span class="hljs-keyword">super</span>(<span class="hljs-number">0</span>);
  
  void increment() =&gt; state++;
}

<span class="hljs-comment">// 4. ä½¿ç”¨Equatableé¿å…é‡å¤æ„å»º</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Equatable</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> id;
  <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> name;
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-type">List</span>&lt;<span class="hljs-type">Object</span>&gt; get props =&gt; [id, name];
}
</code></pre>
<h2 data-id="heading-7">3. ä¾èµ–åŒ…å†²çª</h2>
<h3 data-id="heading-8">é—®é¢˜è¡¨ç°</h3>
<ul>
<li><code>pub get</code>å¤±è´¥</li>
<li>è¿è¡Œæ—¶é”™è¯¯</li>
<li>åŠŸèƒ½å¼‚å¸¸</li>
</ul>
<h3 data-id="heading-9">è§£å†³æ–¹æ³•</h3>
<p>yaml</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># pubspec.yamlé…ç½®æŠ€å·§</span>
<span class="hljs-attr">dependencies:</span>
  <span class="hljs-comment"># 1. ä½¿ç”¨èŒƒå›´ç‰ˆæœ¬è€Œéå›ºå®šç‰ˆæœ¬</span>
  <span class="hljs-attr">http:</span> <span class="hljs-string">^1.0.0</span>  <span class="hljs-comment"># è€Œä¸æ˜¯ 1.0.0</span>
  
  <span class="hljs-comment"># 2. æ‰‹åŠ¨è§£å†³å†²çª</span>
  <span class="hljs-attr">package_a:</span> <span class="hljs-string">^2.0.0</span>
  <span class="hljs-attr">package_b:</span> 
    <span class="hljs-attr">version:</span> <span class="hljs-string">^2.1.0</span>
    <span class="hljs-comment"># æ’é™¤å†²çªçš„ä¾èµ–</span>
    <span class="hljs-attr">dependency_overrides:</span>
      <span class="hljs-attr">shared_dependency:</span> <span class="hljs-string">^3.0.0</span>

<span class="hljs-comment"># 3. ä½¿ç”¨anyç‰ˆæœ¬ï¼ˆè°¨æ…ï¼‰</span>
  <span class="hljs-attr">controversial_package:</span> <span class="hljs-string">any</span>
</code></pre>
<h3 data-id="heading-10">å‘½ä»¤è¡Œå·¥å…·</h3>
<p>bash</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 1. åˆ†æä¾èµ–æ ‘</span>
flutter pub deps
flutter pub dependency_overrides

<span class="hljs-meta"># 2. å‡çº§ä¾èµ–</span>
flutter pub upgrade --major-versions

<span class="hljs-meta"># 3. è§£å†³å†²çªæ­¥éª¤</span>
flutter clean
rm pubspec.<span class="hljs-keyword">lock</span>
flutter pub <span class="hljs-keyword">get</span>

<span class="hljs-meta"># 4. æŸ¥çœ‹ä¾èµ–å›¾è¡¨</span>
flutter pub deps --style=tree
</code></pre>
<h2 data-id="heading-11">4. å¹³å°ç‰¹å®šé—®é¢˜</h2>
<h3 data-id="heading-12">iOSé—®é¢˜è§£å†³</h3>
<p>bash</p>
<pre><code class="hljs language-lua" lang="lua"># iOSæ„å»ºé—®é¢˜
cd ios
pod install <span class="hljs-comment">--repo-update</span>
pod update

# ä¿®æ”¹Podfile
post_install <span class="hljs-keyword">do</span> |installer|
  installer.pods_project.targets.each <span class="hljs-keyword">do</span> |target|
    target.build_configurations.each <span class="hljs-keyword">do</span> |<span class="hljs-built_in">config</span>|
      # è§£å†³bitcodeé—®é¢˜
      <span class="hljs-built_in">config</span>.build_settings[<span class="hljs-string">'ENABLE_BITCODE'</span>] = <span class="hljs-string">'NO'</span>
      
      # è§£å†³æ¶æ„é—®é¢˜
      <span class="hljs-built_in">config</span>.build_settings[<span class="hljs-string">'EXCLUDED_ARCHS[sdk=iphonesimulator*]'</span>] = <span class="hljs-string">'arm64'</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h3 data-id="heading-13">Androidé—®é¢˜è§£å†³</h3>
<p>groovy</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// android/app/build.gradle</span>
android {
    defaultConfig {
        <span class="hljs-comment">// è§£å†³64ä½æ”¯æŒ</span>
        ndk {
            abiFilters <span class="hljs-string">'armeabi-v7a'</span>, <span class="hljs-string">'arm64-v8a'</span>, <span class="hljs-string">'x86'</span>, <span class="hljs-string">'x86_64'</span>
        }
        
        <span class="hljs-comment">// è§£å†³multidex</span>
        multiDexEnabled <span class="hljs-literal">true</span>
    }
    
    <span class="hljs-comment">// è§£å†³ç¼–è¯‘ç‰ˆæœ¬</span>
    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
}
</code></pre>
<h3 data-id="heading-14">å¹³å°ç‰¹å®šä»£ç </h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'dart:io'</span> <span class="hljs-keyword">show</span> Platform;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PlatformUtils</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isIOS =&gt; Platform.isIOS;
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isAndroid =&gt; Platform.isAndroid;
  
  <span class="hljs-comment">// å¹³å°ç‰¹å®šçš„UI</span>
  <span class="hljs-keyword">static</span> Widget getPlatformWidget() {
    <span class="hljs-keyword">if</span> (Platform.isIOS) {
      <span class="hljs-keyword">return</span> CupertinoButton(...);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> MaterialButton(...);
    }
  }
}
</code></pre>
<h2 data-id="heading-15">5. æ„å»ºå’Œå‘å¸ƒé—®é¢˜</h2>
<h3 data-id="heading-16">æ„å»ºå¤±è´¥è§£å†³</h3>
<p>bash</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. æ¸…ç†ç¼“å­˜</span>
flutter clean
<span class="hljs-built_in">rm</span> -rf ios/Pods
<span class="hljs-built_in">rm</span> -rf ios/.symlinks

<span class="hljs-comment"># 2. é‡ç½®ç¯å¢ƒ</span>
flutter doctor
flutter doctor --android-licenses

<span class="hljs-comment"># 3. åˆ†ææ„å»ºæ—¥å¿—</span>
flutter build apk --verbose 2&gt;&amp;1 | <span class="hljs-built_in">tee</span> build.log

<span class="hljs-comment"># 4. ä½¿ç”¨ç‰¹å®šæ¸ é“</span>
flutter channel stable
flutter upgrade

<span class="hljs-comment"># 5. æ£€æŸ¥Flutterç¯å¢ƒ</span>
<span class="hljs-built_in">which</span> flutter
flutter --version
</code></pre>
<h3 data-id="heading-17">å¸¸è§æ„å»ºé…ç½®</h3>
<p>yaml</p>
<pre><code class="hljs language-arduino" lang="arduino"># flutter_app/android/app/build.gradle
android {
    signingConfigs {
        release {
            <span class="hljs-function">storeFile <span class="hljs-title">file</span><span class="hljs-params">(<span class="hljs-string">"keystore.jks"</span>)</span>
            storePassword System.<span class="hljs-title">getenv</span><span class="hljs-params">(<span class="hljs-string">"KEYSTORE_PASSWORD"</span>)</span>
            keyPassword System.<span class="hljs-title">getenv</span><span class="hljs-params">(<span class="hljs-string">"KEY_PASSWORD"</span>)</span>
            keyAlias "key_alias"
        }
    }
    
    buildTypes </span>{
        release {
            signingConfig signingConfigs.release
            <span class="hljs-comment">// å¯ç”¨ä»£ç å‹ç¼©</span>
            <span class="hljs-function">minifyEnabled <span class="hljs-literal">true</span>
            shrinkResources <span class="hljs-literal">true</span>
            proguardFiles <span class="hljs-title">getDefaultProguardFile</span><span class="hljs-params">(
                <span class="hljs-string">'proguard-android.txt'</span>)</span>,
                'proguard-rules.pro'
        }
    }
}
</span></code></pre>
<h2 data-id="heading-18">6. ç½‘ç»œè¯·æ±‚å’Œæ•°æ®å¤„ç†</h2>
<h3 data-id="heading-19">ç½‘ç»œé—®é¢˜è§£å†³</h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 1. ä½¿ç”¨Dioæ›¿ä»£HttpClient</span>
<span class="hljs-keyword">final</span> dio = Dio(BaseOptions(
  baseUrl: <span class="hljs-string">'https://api.example.com'</span>,
  connectTimeout: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">5</span>),
  receiveTimeout: <span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">3</span>),
));

<span class="hljs-comment">// 2. æ·»åŠ æ‹¦æˆªå™¨</span>
dio.interceptors.add(InterceptorsWrapper(
  onRequest: (options, handler) {
    <span class="hljs-comment">// æ·»åŠ token</span>
    options.headers[<span class="hljs-string">'Authorization'</span>] = <span class="hljs-string">'Bearer <span class="hljs-subst">$token</span>'</span>;
    <span class="hljs-keyword">return</span> handler.next(options);
  },
  onError: (DioError e, handler) {
    <span class="hljs-comment">// é”™è¯¯å¤„ç†</span>
    <span class="hljs-keyword">if</span> (e.type == DioErrorType.connectTimeout) {
      <span class="hljs-comment">// é‡è¯•é€»è¾‘</span>
    }
    <span class="hljs-keyword">return</span> handler.next(e);
  },
));

<span class="hljs-comment">// 3. ä½¿ç”¨retryæœºåˆ¶</span>
Future&lt;T&gt; retryRequest&lt;T&gt;(Future&lt;T&gt; <span class="hljs-built_in">Function</span>() request) <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> request();
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">if</span> (i == <span class="hljs-number">2</span>) <span class="hljs-keyword">rethrow</span>;
      <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(seconds: <span class="hljs-number">1</span> &lt;&lt; i));
    }
  }
  <span class="hljs-keyword">throw</span> Exception(<span class="hljs-string">'Max retries exceeded'</span>);
}

<span class="hljs-comment">// 4. ç¦»çº¿å¤„ç†</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NetworkService</span> </span>{
  <span class="hljs-keyword">final</span> Connectivity _connectivity = Connectivity();
  
  Future&lt;<span class="hljs-built_in">bool</span>&gt; <span class="hljs-keyword">get</span> isConnected <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> _connectivity.checkConnectivity();
    <span class="hljs-keyword">return</span> result != ConnectivityResult.none;
  }
}
</code></pre>
<h3 data-id="heading-20">æ•°æ®å¤„ç†</h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 1. ä½¿ç”¨freezedç”Ÿæˆä¸å¯å˜æ¨¡å‹</span>
<span class="hljs-meta">@freezed</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-title">with</span> <span class="hljs-title">_</span>$<span class="hljs-title">User</span> </span>{
  <span class="hljs-keyword">factory</span> User({
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> id,
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> name,
    <span class="hljs-built_in">String?</span> email,
  }) = _User;
  
  <span class="hljs-keyword">factory</span> User.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) =&gt; _$UserFromJson(json);
}

<span class="hljs-comment">// 2. ä½¿ç”¨json_serializable</span>
<span class="hljs-meta">@JsonSerializable</span>()
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Product</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> name;
  
  Product({<span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.name});
  
  <span class="hljs-keyword">factory</span> Product.fromJson(<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; json) =&gt; 
      _$ProductFromJson(json);
  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toJson() =&gt; _$ProductToJson(<span class="hljs-keyword">this</span>);
}

<span class="hljs-comment">// 3. é”™è¯¯è¾¹ç•Œå¤„ç†</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ErrorBoundary</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> Widget child;
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> ErrorWidget.builder((FlutterErrorDetails details) {
      <span class="hljs-comment">// è®°å½•é”™è¯¯</span>
      FirebaseCrashlytics.instance.recordError(
        details.exception,
        details.stack,
      );
      
      <span class="hljs-comment">// æ˜¾ç¤ºå‹å¥½é”™è¯¯é¡µé¢</span>
      <span class="hljs-keyword">return</span> ErrorScreen(details.exception);
    });
  }
}
</code></pre>
<h2 data-id="heading-21">7. å¯¼èˆªå’Œè·¯ç”±é—®é¢˜</h2>
<h3 data-id="heading-22">é—®é¢˜è¡¨ç°</h3>
<ul>
<li>é¡µé¢è·³è½¬åŠ¨ç”»å¡é¡¿</li>
<li>è¿”å›æ ˆç®¡ç†æ··ä¹±</li>
<li>å‚æ•°ä¼ é€’ä¸¢å¤±</li>
<li>è·¯ç”±å®ˆå«éš¾ä»¥å®ç°</li>
</ul>
<h3 data-id="heading-23">è§£å†³æ–¹æ³•</h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 1. ä½¿ç”¨å‘½åè·¯ç”±å¹¶ç»Ÿä¸€ç®¡ç†</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppRoutes</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> home = <span class="hljs-string">'/'</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> detail = <span class="hljs-string">'/detail'</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> settings = <span class="hljs-string">'/settings'</span>;
  
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, WidgetBuilder&gt; <span class="hljs-keyword">get</span> routes {
    <span class="hljs-keyword">return</span> {
      home: (context) =&gt; HomePage(),
      detail: (context) =&gt; DetailPage(),
      settings: (context) =&gt; SettingsPage(),
    };
  }
}

<span class="hljs-comment">// 2. å®‰å…¨çš„å‚æ•°ä¼ é€’</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DetailPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> routeName = <span class="hljs-string">'/detail'</span>;
  
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> title;
  
  <span class="hljs-keyword">const</span> DetailPage({
    Key? key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.title,
  }) : <span class="hljs-keyword">super</span>(key: key);
  
  <span class="hljs-comment">// è·¯ç”±å‚æ•°æ£€æŸ¥</span>
  <span class="hljs-keyword">static</span> Route&lt;<span class="hljs-built_in">dynamic</span>&gt; route(RouteSettings settings) {
    <span class="hljs-keyword">final</span> args = settings.arguments <span class="hljs-keyword">as</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;?;
    
    <span class="hljs-keyword">if</span> (args == <span class="hljs-keyword">null</span> || args[<span class="hljs-string">'id'</span>] == <span class="hljs-keyword">null</span>) {
      <span class="hljs-keyword">return</span> MaterialPageRoute(
        builder: (_) =&gt; ErrorPage(message: <span class="hljs-string">'ç¼ºå°‘å¿…è¦å‚æ•°'</span>),
      );
    }
    
    <span class="hljs-keyword">return</span> MaterialPageRoute(
      builder: (_) =&gt; DetailPage(
        id: args[<span class="hljs-string">'id'</span>],
        title: args[<span class="hljs-string">'title'</span>] ?? <span class="hljs-string">''</span>,
      ),
    );
  }
}

<span class="hljs-comment">// 3. ä½¿ç”¨ GoRouter æˆ– AutoRoute ç®¡ç†å¤æ‚è·¯ç”±</span>
dependencies:
  go_router: ^<span class="hljs-number">6.0</span><span class="hljs-number">.0</span>
  auto_route: ^<span class="hljs-number">4.0</span><span class="hljs-number">.0</span>

<span class="hljs-comment">// 4. å¯¼èˆªå®ˆå«/ä¸­é—´ä»¶</span>
<span class="hljs-keyword">final</span> router = GoRouter(
  routes: [
    GoRoute(
      path: <span class="hljs-string">'/'</span>,
      builder: (context, state) =&gt; HomePage(),
      redirect: (context, state) {
        <span class="hljs-comment">// æ£€æŸ¥ç™»å½•çŠ¶æ€</span>
        <span class="hljs-keyword">final</span> isLoggedIn = authProvider.isLoggedIn;
        <span class="hljs-keyword">if</span> (!isLoggedIn) <span class="hljs-keyword">return</span> <span class="hljs-string">'/login'</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
      },
    ),
  ],
  errorBuilder: (context, state) =&gt; ErrorPage(
    error: state.error,
  ),
);
</code></pre>
<h2 data-id="heading-24">8. å›½é™…åŒ– (i18n) å’Œæœ¬åœ°åŒ–</h2>
<h3 data-id="heading-25">é—®é¢˜è¡¨ç°</h3>
<ul>
<li>å¤šè¯­è¨€åˆ‡æ¢ä¸åŠæ—¶æ›´æ–°</li>
<li>æ–‡æ¡ˆç¡¬ç¼–ç </li>
<li>RTLï¼ˆä»å³åˆ°å·¦ï¼‰å¸ƒå±€é—®é¢˜</li>
<li>æ—¥æœŸ/æ•°å­—æ ¼å¼åŒ–ä¸ä¸€è‡´</li>
</ul>
<h3 data-id="heading-26">è§£å†³æ–¹æ³•</h3>
<p>dart</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// 1. ä½¿ç”¨ intl åŒ…å’Œ ARB æ–‡ä»¶</span>
dependencies:
  flutter_localizations:
    sdk: flutter
  intl: ^<span class="hljs-number">0.18</span><span class="hljs-number">.0</span>
  flutter_localized_locales: ^<span class="hljs-number">2.0</span><span class="hljs-number">.0</span>

<span class="hljs-comment">// 2. ç”Ÿæˆæœ¬åœ°åŒ–ä»£ç </span>
# åœ¨ pubspec.yaml ä¸­æ·»åŠ 
flutter:
  generate: <span class="hljs-literal">true</span>

# åˆ›å»º l10n.yaml
arb-dir: lib/l10n
template-arb-file: app_en.arb
output-localization-file: app_localizations.dart

<span class="hljs-comment">// 3. ä½¿ç”¨ç”Ÿæˆçš„æœ¬åœ°åŒ–ç±»</span>
<span class="hljs-type">MaterialApp</span>(
  localizationsDelegates: const [
    <span class="hljs-type">AppLocalizations</span>.delegate,
    <span class="hljs-type">GlobalMaterialLocalizations</span>.delegate,
    <span class="hljs-type">GlobalWidgetsLocalizations</span>.delegate,
    <span class="hljs-type">GlobalCupertinoLocalizations</span>.delegate,
  ],
  supportedLocales: const [
    <span class="hljs-type">Locale</span>('en', ''), <span class="hljs-comment">// English</span>
    <span class="hljs-type">Locale</span>('zh', '<span class="hljs-type">CN</span>'), <span class="hljs-comment">// ç®€ä½“ä¸­æ–‡</span>
    <span class="hljs-type">Locale</span>('ar', ''), <span class="hljs-comment">// Arabic (RTL)</span>
  ],
  locale: _currentLocale,
  localeResolutionCallback: (locale, supportedLocales) {
    <span class="hljs-comment">// æ”¯æŒçš„è¯­è¨€å›è°ƒ</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> supportedLocale in supportedLocales) {
      <span class="hljs-keyword">if</span> (supportedLocale.languageCode == locale?.languageCode) {
        <span class="hljs-keyword">return</span> supportedLocale;
      }
    }
    <span class="hljs-keyword">return</span> supportedLocales.first;
  },
);

<span class="hljs-comment">// 4. RTL å¸ƒå±€å¤„ç†</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RTLWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-type">Widget</span> child;
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-type">Widget</span> build(<span class="hljs-type">BuildContext</span> context) {
    <span class="hljs-keyword">final</span> isRTL = <span class="hljs-type">Localizations</span>.localeOf(context).languageCode == 'ar';
    
    <span class="hljs-keyword">return</span> <span class="hljs-type">Directionality</span>(
      textDirection: isRTL ? <span class="hljs-type">TextDirection</span>.rtl : <span class="hljs-type">TextDirection</span>.ltr,
      child: child,
    );
  }
}

<span class="hljs-comment">// 5. åŠ¨æ€åˆ‡æ¢è¯­è¨€</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LocaleProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ChangeNotifier</span> </span>{
  <span class="hljs-type">Locale</span>? _locale;
  
  <span class="hljs-type">Locale</span>? get locale =&gt; _locale;
  
  void setLocale(<span class="hljs-type">Locale</span> locale) {
    <span class="hljs-keyword">if</span> (!_supportedLocales.contains(locale)) <span class="hljs-keyword">return</span>;
    
    _locale = locale;
    notifyListeners();
  }
  
  static const _supportedLocales = [
    <span class="hljs-type">Locale</span>('en'),
    <span class="hljs-type">Locale</span>('zh'),
    <span class="hljs-type">Locale</span>('ar'),
  ];
}
</code></pre>
<h2 data-id="heading-27">9. ä¸»é¢˜å’Œæ ·å¼ç®¡ç†</h2>
<h3 data-id="heading-28">é—®é¢˜è¡¨ç°</h3>
<ul>
<li>ä¸»é¢˜åˆ‡æ¢æ€§èƒ½é—®é¢˜</li>
<li>æš—é»‘æ¨¡å¼å®ç°å¤æ‚</li>
<li>æ ·å¼ä¸ä¸€è‡´</li>
<li>åŠ¨æ€ä¸»é¢˜æ”¯æŒå›°éš¾</li>
</ul>
<h3 data-id="heading-29">è§£å†³æ–¹æ³•</h3>
<p>dart</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 1. ä½¿ç”¨ Provider ç®¡ç†ä¸»é¢˜</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ThemeProvider</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ChangeNotifier</span> </span>{
  ThemeMode _themeMode = ThemeMode.system;
  
  ThemeMode get themeMode =&gt; _themeMode;
  
  <span class="hljs-keyword">void</span> <span class="hljs-title function_ invoke__">setThemeMode</span>(ThemeMode mode) {
    _themeMode = mode;
    <span class="hljs-title function_ invoke__">notifyListeners</span>();
  }
}

<span class="hljs-comment">// 2. åˆ›å»ºè‡ªå®šä¹‰ä¸»é¢˜æ•°æ®ç±»</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AppTheme</span> </span>{
  <span class="hljs-built_in">static</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">_fontFamily</span> = <span class="hljs-string">'Roboto'</span>;
  
  <span class="hljs-built_in">static</span> ThemeData get lightTheme {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">ThemeData</span>(
      <span class="hljs-attr">brightness</span>: Brightness.light,
      <span class="hljs-attr">primaryColor</span>: Colors.blue,
      <span class="hljs-attr">fontFamily</span>: _fontFamily,
      <span class="hljs-attr">textTheme</span>: <span class="hljs-title function_ invoke__">TextTheme</span>(
        <span class="hljs-attr">headline1</span>: <span class="hljs-title function_ invoke__">TextStyle</span>(<span class="hljs-attr">fontSize</span>: <span class="hljs-number">32</span>, <span class="hljs-attr">fontWeight</span>: FontWeight.bold),
        <span class="hljs-attr">bodyText1</span>: <span class="hljs-title function_ invoke__">TextStyle</span>(<span class="hljs-attr">fontSize</span>: <span class="hljs-number">16</span>),
      ),
      <span class="hljs-attr">colorScheme</span>: ColorScheme.<span class="hljs-title function_ invoke__">light</span>(
        <span class="hljs-attr">primary</span>: Colors.blue,
        <span class="hljs-attr">secondary</span>: Colors.orange,
      ),
    );
  }
  
  <span class="hljs-built_in">static</span> ThemeData get darkTheme {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">ThemeData</span>(
      <span class="hljs-attr">brightness</span>: Brightness.dark,
      <span class="hljs-attr">primaryColor</span>: Colors.blueGrey,
      <span class="hljs-attr">fontFamily</span>: _fontFamily,
      <span class="hljs-attr">colorScheme</span>: ColorScheme.<span class="hljs-title function_ invoke__">dark</span>(
        <span class="hljs-attr">primary</span>: Colors.blueGrey,
        <span class="hljs-attr">secondary</span>: Colors.orange,
      ),
    );
  }
}

<span class="hljs-comment">// 3. å“åº”ç³»ç»Ÿä¸»é¢˜å˜åŒ–</span>
WidgetsBinding.instance.platformDispatcher.onPlatformBrightnessChanged = () {
  <span class="hljs-keyword">final</span> brightness = WidgetsBinding.instance.platformDispatcher.platformBrightness;
  <span class="hljs-comment">// å¤„ç†ä¸»é¢˜å˜åŒ–</span>
};

<span class="hljs-comment">// 4. ä½¿ç”¨ Extension ç®€åŒ–æ ·å¼è®¿é—®</span>
extension ThemeExtension on BuildContext {
  Color get primaryColor =&gt; Theme.<span class="hljs-title function_ invoke__">of</span>(this).primaryColor;
  TextTheme get textTheme =&gt; Theme.<span class="hljs-title function_ invoke__">of</span>(this).textTheme;
  <span class="hljs-keyword">double</span> get paddingMedium =&gt; <span class="hljs-number">16.0</span>;
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-title function_ invoke__">Text</span>(
  <span class="hljs-string">'Hello'</span>,
  <span class="hljs-attr">style</span>: context.textTheme.headline1,
  <span class="hljs-attr">color</span>: context.primaryColor,
);
</code></pre>
<h2 data-id="heading-30">10. æ–‡ä»¶å­˜å‚¨å’Œç¼“å­˜</h2>
<h3 data-id="heading-31">é—®é¢˜è¡¨ç°</h3>
<ul>
<li>æ–‡ä»¶è¯»å†™æƒé™é—®é¢˜</li>
<li>ç¼“å­˜æ¸…ç†å›°éš¾</li>
<li>å¤§æ–‡ä»¶å¤„ç†æ•ˆç‡ä½</li>
<li>è·¨å¹³å°è·¯å¾„å·®å¼‚</li>
</ul>
<h3 data-id="heading-32">è§£å†³æ–¹æ³•</h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 1. ä½¿ç”¨ path_provider è·å–è·¯å¾„</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:path_provider/path_provider.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">StorageService</span> </span>{
  Future&lt;<span class="hljs-built_in">String</span>&gt; <span class="hljs-keyword">get</span> _localPath <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> directory = <span class="hljs-keyword">await</span> getApplicationDocumentsDirectory();
    <span class="hljs-keyword">return</span> directory.path;
  }
  
  Future&lt;File&gt; <span class="hljs-keyword">get</span> _localFile(<span class="hljs-built_in">String</span> filename) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> path = <span class="hljs-keyword">await</span> _localPath;
    <span class="hljs-keyword">return</span> File(<span class="hljs-string">'<span class="hljs-subst">$path</span>/<span class="hljs-subst">$filename</span>'</span>);
  }
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; writeData(<span class="hljs-built_in">String</span> data, <span class="hljs-built_in">String</span> filename) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> file = <span class="hljs-keyword">await</span> _localFile(filename);
    <span class="hljs-keyword">await</span> file.writeAsString(data);
  }
}

<span class="hljs-comment">// 2. ä½¿ç”¨ shared_preferences å­˜å‚¨ç®€å•æ•°æ®</span>
<span class="hljs-keyword">final</span> prefs = <span class="hljs-keyword">await</span> SharedPreferences.getInstance();
<span class="hljs-keyword">await</span> prefs.setString(<span class="hljs-string">'token'</span>, <span class="hljs-string">'jwt_token'</span>);
<span class="hljs-keyword">final</span> token = prefs.getString(<span class="hljs-string">'token'</span>);

<span class="hljs-comment">// 3. ä½¿ç”¨ hive æˆ– sqflite å­˜å‚¨ç»“æ„åŒ–æ•°æ®</span>
dependencies:
  hive: ^<span class="hljs-number">2.2</span><span class="hljs-number">.0</span>
  hive_flutter: ^<span class="hljs-number">1.1</span><span class="hljs-number">.0</span>
  sqflite: ^<span class="hljs-number">2.2</span><span class="hljs-number">.0</span>

<span class="hljs-comment">// 4. å›¾ç‰‡ç¼“å­˜ç®¡ç†</span>
CachedNetworkImage(
  imageUrl: <span class="hljs-string">'https://example.com/image.jpg'</span>,
  placeholder: (context, url) =&gt; CircularProgressIndicator(),
  errorWidget: (context, url, error) =&gt; Icon(Icons.error),
  cacheManager: DefaultCacheManager(),
  maxHeight: <span class="hljs-number">200</span>,
  maxWidth: <span class="hljs-number">200</span>,
);

<span class="hljs-comment">// 5. è‡ªå®šä¹‰ç¼“å­˜ç­–ç•¥</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SmartCacheManager</span> </span>{
  <span class="hljs-keyword">final</span> CacheManager _cacheManager = CacheManager(
    Config(
      <span class="hljs-string">'custom_cache_key'</span>,
      maxNrOfCacheObjects: <span class="hljs-number">100</span>,
      stalePeriod: <span class="hljs-built_in">Duration</span>(days: <span class="hljs-number">7</span>),
    ),
  );
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; clearOldCache() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> _cacheManager.emptyCache();
  }
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; clearExpired() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> _cacheManager.removeStale();
  }
}
</code></pre>
<h2 data-id="heading-33">11. æƒé™ç®¡ç†</h2>
<h3 data-id="heading-34">é—®é¢˜è¡¨ç°</h3>
<ul>
<li>æƒé™ç”³è¯·è¢«æ‹’ç»</li>
<li>åŠ¨æ€æƒé™å¤„ç†å¤æ‚</li>
<li>ä¸åŒå¹³å°æƒé™å·®å¼‚</li>
<li>æƒé™çŠ¶æ€ç®¡ç†å›°éš¾</li>
</ul>
<h3 data-id="heading-35">è§£å†³æ–¹æ³•</h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 1. ä½¿ç”¨ permission_handler</span>
dependencies:
  permission_handler: ^<span class="hljs-number">10.0</span><span class="hljs-number">.0</span>

<span class="hljs-comment">// 2. æƒé™æœåŠ¡å°è£…</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PermissionService</span> </span>{
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-built_in">bool</span>&gt; requestCameraPermission() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> status = <span class="hljs-keyword">await</span> Permission.camera.request();
    
    <span class="hljs-keyword">if</span> (status.isGranted) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status.isDenied) {
      <span class="hljs-comment">// å¯å†æ¬¡è¯·æ±‚</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (status.isPermanentlyDenied) {
      <span class="hljs-comment">// éœ€è¦å¼•å¯¼ç”¨æˆ·å»è®¾ç½®</span>
      <span class="hljs-keyword">await</span> openAppSettings();
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
  }
  
  <span class="hljs-comment">// 3. æ‰¹é‡è¯·æ±‚æƒé™</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-built_in">Map</span>&lt;Permission, PermissionStatus&gt;&gt; requestMultiple(
    <span class="hljs-built_in">List</span>&lt;Permission&gt; permissions,
  ) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> permissions.request();
  }
  
  <span class="hljs-comment">// 4. æ£€æŸ¥æƒé™çŠ¶æ€</span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-built_in">bool</span>&gt; checkPermission(Permission permission) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> status = <span class="hljs-keyword">await</span> permission.status;
    <span class="hljs-keyword">return</span> status.isGranted;
  }
}

<span class="hljs-comment">// 5. å¹³å°ç‰¹å®šçš„æƒé™å¤„ç†</span>
Future&lt;<span class="hljs-keyword">void</span>&gt; requestIOSPermissions() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">if</span> (Platform.isIOS) {
    <span class="hljs-comment">// iOS ç‰¹å®šæƒé™é€»è¾‘</span>
    <span class="hljs-keyword">final</span> status = <span class="hljs-keyword">await</span> Permission.photos.request();
    <span class="hljs-keyword">if</span> (!status.isGranted) {
      <span class="hljs-comment">// å¤„ç†æ‹’ç»é€»è¾‘</span>
    }
  }
}

<span class="hljs-comment">// 6. æƒé™è¯·æ±‚ UI å°è£…</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PermissionRequestDialog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> title;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> message;
  <span class="hljs-keyword">final</span> VoidCallback onGranted;
  
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> AlertDialog(
      title: Text(title),
      content: Text(message),
      actions: [
        TextButton(
          onPressed: () =&gt; Navigator.pop(context),
          child: Text(<span class="hljs-string">'å–æ¶ˆ'</span>),
        ),
        ElevatedButton(
          onPressed: () {
            onGranted();
            Navigator.pop(context);
          },
          child: Text(<span class="hljs-string">'å»è®¾ç½®'</span>),
        ),
      ],
    );
  }
}
</code></pre>
<h2 data-id="heading-36">12. æ··åˆå¼€å‘ä¸å¹³å°äº¤äº’</h2>
<h3 data-id="heading-37">é—®é¢˜è¡¨ç°</h3>
<ul>
<li>å¹³å°é€šé“è°ƒç”¨å¤±è´¥</li>
<li>åŸç”Ÿä¸ Flutter é€šä¿¡å»¶è¿Ÿ</li>
<li>æ’ä»¶å…¼å®¹æ€§é—®é¢˜</li>
<li>äºŒè¿›åˆ¶å¤§å°å¢åŠ </li>
</ul>
<h3 data-id="heading-38">è§£å†³æ–¹æ³•</h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 1. æ–¹æ³•é€šé“å°è£…</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NativeBridge</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> platform = MethodChannel(<span class="hljs-string">'com.example/native'</span>);
  
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-built_in">String?</span>&gt; callNativeMethod(<span class="hljs-built_in">String</span> method, [<span class="hljs-built_in">dynamic</span> args]) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">final</span> result = <span class="hljs-keyword">await</span> platform.invokeMethod(method, args);
      <span class="hljs-keyword">return</span> result.toString();
    } <span class="hljs-keyword">on</span> PlatformException <span class="hljs-keyword">catch</span> (e) {
      debugPrint(<span class="hljs-string">'Native call failed: <span class="hljs-subst">${e.message}</span>'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }
  }
  
  <span class="hljs-comment">// 2. åŒå‘é€šä¿¡</span>
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> setupEventChannel() {
    <span class="hljs-keyword">const</span> eventChannel = EventChannel(<span class="hljs-string">'com.example/events'</span>);
    
    eventChannel.receiveBroadcastStream().listen(
      (event) {
        <span class="hljs-comment">// å¤„ç†æ¥è‡ªåŸç”Ÿçš„äº‹ä»¶</span>
        _handleNativeEvent(event);
      },
      onError: (error) {
        debugPrint(<span class="hljs-string">'Event channel error: <span class="hljs-subst">$error</span>'</span>);
      },
    );
  }
}

<span class="hljs-comment">// 3. ä½¿ç”¨ Pigeon ç”Ÿæˆç±»å‹å®‰å…¨çš„ä»£ç </span>
<span class="hljs-comment">// schema.dart</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:pigeon/pigeon.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchRequest</span> </span>{
  <span class="hljs-built_in">String?</span> query;
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchReply</span> </span>{
  <span class="hljs-built_in">String?</span> result;
}

<span class="hljs-meta">@HostApi</span>()
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SearchApi</span> </span>{
  SearchReply search(SearchRequest request);
}

<span class="hljs-comment">// 4. å¹³å°ç‰¹å®šä»£ç æŠ½è±¡</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PlatformSpecificFeature</span> </span>{
  Future&lt;<span class="hljs-keyword">void</span>&gt; doSomething();
  
  <span class="hljs-keyword">factory</span> PlatformSpecificFeature() {
    <span class="hljs-keyword">if</span> (Platform.isAndroid) {
      <span class="hljs-keyword">return</span> AndroidImplementation();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Platform.isIOS) {
      <span class="hljs-keyword">return</span> IOSImplementation();
    }
    <span class="hljs-keyword">throw</span> UnsupportedError(<span class="hljs-string">'Platform not supported'</span>);
  }
}

<span class="hljs-comment">// 5. æ’ä»¶å¼€å‘æ³¨æ„äº‹é¡¹</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyPlugin</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> registerWith(Registrar registrar) {
    <span class="hljs-keyword">final</span> channel = MethodChannel(
      <span class="hljs-string">'my_plugin'</span>,
      StandardMethodCodec(),
      registrar.messenger(),
    );
    
    <span class="hljs-keyword">final</span> instance = MyPlugin();
    channel.setMethodCallHandler(instance.handleMethodCall);
  }
  
  Future&lt;<span class="hljs-built_in">dynamic</span>&gt; handleMethodCall(MethodCall call) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">switch</span> (call.method) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'getPlatformVersion'</span>:
        <span class="hljs-keyword">return</span> Platform.version;
      <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">throw</span> PlatformException(
          code: <span class="hljs-string">'Unimplemented'</span>,
          message: <span class="hljs-string">'Method not implemented'</span>,
        );
    }
  }
}
</code></pre>
<h2 data-id="heading-39">13. è°ƒè¯•å’Œæ—¥å¿—ç³»ç»Ÿ</h2>
<h3 data-id="heading-40">é—®é¢˜è¡¨ç°</h3>
<ul>
<li>ç”Ÿäº§ç¯å¢ƒæ—¥å¿—æ³„éœ²</li>
<li>è°ƒè¯•ä¿¡æ¯ä¸è¶³</li>
<li>æ€§èƒ½ç›‘æ§ç¼ºå¤±</li>
<li>é”™è¯¯è¿½è¸ªå›°éš¾</li>
</ul>
<h3 data-id="heading-41">è§£å†³æ–¹æ³•</h3>
<p>dart</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. åˆ†çº§æ—¥å¿—ç³»ç»Ÿ</span>
enum LogLevel { debug, info, warning, error }

class Logger {
  static final Logger _instance = Logger<span class="hljs-selector-class">._internal</span>();
  factory <span class="hljs-built_in">Logger</span>() =&gt; _instance;
  
  Logger<span class="hljs-selector-class">._internal</span>();
  
  void <span class="hljs-built_in">log</span>(LogLevel level, String message, {Object? error, StackTrace? stackTrace}) {
    if (kDebugMode) {
      <span class="hljs-comment">// å¼€å‘ç¯å¢ƒï¼šè¾“å‡ºåˆ°æ§åˆ¶å°</span>
      <span class="hljs-built_in">_printLog</span>(level, message, error, stackTrace);
    }
    
    <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒï¼šå‘é€åˆ°æœåŠ¡å™¨</span>
    if (level.index &gt;= LogLevel.warning.index) {
      <span class="hljs-built_in">_sendToServer</span>(level, message, error, stackTrace);
    }
  }
  
  void <span class="hljs-built_in">_printLog</span>(LogLevel level, String message, Object? error, StackTrace? stackTrace) {
    final prefix = '<span class="hljs-selector-attr">[${level.name.toUpperCase()}]</span>';
    <span class="hljs-built_in">debugPrint</span>('$prefix $message');
    
    if (error != null) {
      <span class="hljs-built_in">debugPrint</span>('Error: $error');
    }
    if (stackTrace != null) {
      <span class="hljs-built_in">debugPrint</span>('Stack: $stackTrace');
    }
  }
}

<span class="hljs-comment">// 2. ä½¿ç”¨ logger åŒ…</span>
dependencies:
  logger: ^<span class="hljs-number">1.1</span>.<span class="hljs-number">0</span>

final logger = <span class="hljs-built_in">Logger</span>(
  printer: <span class="hljs-built_in">PrettyPrinter</span>(
    methodCount: <span class="hljs-number">2</span>,
    errorMethodCount: <span class="hljs-number">8</span>,
    colors: true,
  ),
);

<span class="hljs-comment">// 3. æ€§èƒ½ç›‘æ§</span>
void <span class="hljs-selector-tag">main</span>() {
  <span class="hljs-comment">// è®°å½•å¯åŠ¨æ—¶é—´</span>
  final stopwatch = <span class="hljs-built_in">Stopwatch</span>().<span class="hljs-selector-class">.start</span>();
  
  <span class="hljs-built_in">runApp</span>(MyApp());
  
  WidgetsBinding<span class="hljs-selector-class">.instance</span><span class="hljs-selector-class">.addPostFrameCallback</span>((_) {
    stopwatch<span class="hljs-selector-class">.stop</span>();
    logger<span class="hljs-selector-class">.d</span>('App started in ${stopwatch.elapsedMilliseconds}ms');
  });
}

<span class="hljs-comment">// 4. ç½‘ç»œè¯·æ±‚æ‹¦æˆªæ—¥å¿—</span>
dio<span class="hljs-selector-class">.interceptors</span><span class="hljs-selector-class">.add</span>(LogInterceptor(
  request: true,
  requestHeader: true,
  requestBody: true,
  responseHeader: true,
  responseBody: true,
  logPrint: (object) {
    logger<span class="hljs-selector-class">.d</span>(object);
  },
));

<span class="hljs-comment">// 5. è‡ªå®šä¹‰é”™è¯¯é¡µé¢</span>
class ErrorBoundary extends StatelessWidget {
  final Widget child;
  
  <span class="hljs-keyword">@override</span>
  Widget build(BuildContext context) {
    return ErrorWidget<span class="hljs-selector-class">.builder</span>((FlutterErrorDetails details) {
      <span class="hljs-comment">// è®°å½•é”™è¯¯</span>
      logger<span class="hljs-selector-class">.e</span>(details.exceptionAsString(), 
        error: details.exception,
        stackTrace: details.stack,
      );
      
      <span class="hljs-comment">// æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯é¡µé¢</span>
      return <span class="hljs-built_in">ErrorScreen</span>(
        onRetry: () =&gt; Navigator<span class="hljs-selector-class">.of</span>(context)<span class="hljs-selector-class">.pop</span>(),
      );
    });
  }
}
</code></pre>
<h2 data-id="heading-42">14. æµ‹è¯•ç›¸å…³æŒ‘æˆ˜</h2>
<h3 data-id="heading-43">é—®é¢˜è¡¨ç°</h3>
<ul>
<li>å•å…ƒæµ‹è¯•éš¾ä»¥ç¼–å†™</li>
<li>Widget æµ‹è¯•ç¼“æ…¢</li>
<li>é›†æˆæµ‹è¯•ä¸ç¨³å®š</li>
<li>Mock æ•°æ®å¤æ‚</li>
</ul>
<h3 data-id="heading-44">è§£å†³æ–¹æ³•</h3>
<p>dart</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 1. ä½¿ç”¨ Mockito å’Œ Build Runner</span>
dev_dependencies:
  mockito: ^5.3.0
  build_runner: ^2.3.0

// ç”Ÿæˆ Mock ç±»
@GenerateMocks([HttpClient])
import 'my_test.mocks.dart';

<span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">main</span>() {
  <span class="hljs-selector-tag">late</span> <span class="hljs-selector-tag">MockHttpClient</span> <span class="hljs-selector-tag">mockClient</span>;
  
  <span class="hljs-selector-tag">setUp</span>(() {
    <span class="hljs-selector-tag">mockClient</span> = <span class="hljs-selector-tag">MockHttpClient</span>();
  });
  
  <span class="hljs-selector-tag">test</span>(<span class="hljs-string">'æµ‹è¯•ç½‘ç»œè¯·æ±‚'</span>, () async {
    <span class="hljs-keyword">when</span>(mockClient.<span class="hljs-built_in">get</span>(any)).<span class="hljs-built_in">thenAnswer</span>(
      (_) async =&gt; <span class="hljs-built_in">HttpResponse</span>(<span class="hljs-attribute">data</span>: <span class="hljs-string">'test'</span>, <span class="hljs-attribute">statusCode</span>: <span class="hljs-number">200</span>),
    );
    
    final service = <span class="hljs-built_in">MyService</span>(mockClient);
    final result = await service.<span class="hljs-built_in">fetchData</span>();
    
    <span class="hljs-built_in">expect</span>(result, <span class="hljs-string">'test'</span>);
    <span class="hljs-built_in">verify</span>(mockClient.<span class="hljs-built_in">get</span>(any)).<span class="hljs-built_in">called</span>(<span class="hljs-number">1</span>);
  });
}

<span class="hljs-comment">// 2. Widget æµ‹è¯•ä¼˜åŒ–</span>
<span class="hljs-built_in">testWidgets</span>(<span class="hljs-string">'æµ‹è¯•ç™»å½•é¡µé¢'</span>, (WidgetTester tester) async {
  <span class="hljs-comment">// ä½¿ç”¨ Key æŸ¥æ‰¾ç»„ä»¶</span>
  await tester.<span class="hljs-built_in">pumpWidget</span>(<span class="hljs-built_in">MyApp</span>());
  
  <span class="hljs-comment">// è¾“å…¥æ–‡æœ¬</span>
  await tester.<span class="hljs-built_in">enterText</span>(find.<span class="hljs-built_in">byKey</span>(<span class="hljs-built_in">Key</span>(<span class="hljs-string">'email_field'</span>)), <span class="hljs-string">'test@example.com'</span>);
  await tester.<span class="hljs-built_in">enterText</span>(find.<span class="hljs-built_in">byKey</span>(<span class="hljs-built_in">Key</span>(<span class="hljs-string">'password_field'</span>)), <span class="hljs-string">'password'</span>);
  
  <span class="hljs-comment">// ç‚¹å‡»æŒ‰é’®</span>
  await tester.<span class="hljs-built_in">tap</span>(find.<span class="hljs-built_in">byKey</span>(<span class="hljs-built_in">Key</span>(<span class="hljs-string">'login_button'</span>)));
  
  <span class="hljs-comment">// ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ</span>
  await tester.<span class="hljs-built_in">pumpAndSettle</span>();
  
  <span class="hljs-comment">// éªŒè¯ç»“æœ</span>
  <span class="hljs-built_in">expect</span>(find.<span class="hljs-built_in">text</span>(<span class="hljs-string">'ç™»å½•æˆåŠŸ'</span>), findsOneWidget);
});

<span class="hljs-comment">// 3. é›†æˆæµ‹è¯•æœ€ä½³å®è·µ</span>
import <span class="hljs-string">'package:flutter_test/flutter_test.dart'</span>;
import <span class="hljs-string">'package:integration_test/integration_test.dart'</span>;

void <span class="hljs-built_in">main</span>() {
  <span class="hljs-selector-tag">IntegrationTestWidgetsFlutterBinding</span><span class="hljs-selector-class">.ensureInitialized</span>();
  
  <span class="hljs-selector-tag">testWidgets</span>(<span class="hljs-string">'å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•'</span>, (WidgetTester tester) async {
    <span class="hljs-comment">// å¯åŠ¨åº”ç”¨</span>
    <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">tester</span><span class="hljs-selector-class">.pumpWidget</span>(<span class="hljs-built_in">MyApp</span>());
    
    <span class="hljs-comment">// æ‰§è¡Œç”¨æˆ·æ“ä½œåºåˆ—</span>
    <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">_performLogin</span>(tester);
    <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">_navigateToProfile</span>(tester);
    <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">_updateProfile</span>(tester);
    
    <span class="hljs-comment">// éªŒè¯æœ€ç»ˆçŠ¶æ€</span>
    <span class="hljs-selector-tag">expect</span>(find.<span class="hljs-built_in">text</span>(<span class="hljs-string">'æ›´æ–°æˆåŠŸ'</span>), findsOneWidget);
  });
  
  <span class="hljs-comment">// 4. Golden Testsï¼ˆè§†è§‰å›å½’æµ‹è¯•ï¼‰</span>
  <span class="hljs-selector-tag">testWidgets</span>(<span class="hljs-string">'éªŒè¯UIä¸€è‡´æ€§'</span>, (WidgetTester tester) async {
    <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">tester</span><span class="hljs-selector-class">.pumpWidget</span>(<span class="hljs-built_in">MyWidget</span>());
    
    <span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">expectLater</span>(
      find.<span class="hljs-built_in">byType</span>(MyWidget),
      <span class="hljs-built_in">matchesGoldenFile</span>(<span class="hljs-string">'goldens/my_widget.png'</span>),
    );
  });
}
</code></pre>
<h2 data-id="heading-45">15. æŒç»­é›†æˆ/æŒç»­éƒ¨ç½² (CI/CD)</h2>
<h3 data-id="heading-46">é—®é¢˜è¡¨ç°</h3>
<ul>
<li>æ„å»ºé…ç½®å¤æ‚</li>
<li>å¤šç¯å¢ƒç®¡ç†å›°éš¾</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•é›†æˆ</li>
<li>å‘å¸ƒæµç¨‹ç¹ç</li>
</ul>
<h3 data-id="heading-47">è§£å†³æ–¹æ³•</h3>
<p>yaml</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/flutter.yml</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">Flutter</span> <span class="hljs-string">CI/CD</span>

<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span>, <span class="hljs-string">develop</span> ]
  <span class="hljs-attr">pull_request:</span>
    <span class="hljs-attr">branches:</span> [ <span class="hljs-string">main</span> ]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    
    <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Flutter</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">subosito/flutter-action@v2</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">flutter-version:</span> <span class="hljs-string">'3.0.0'</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">pub</span> <span class="hljs-string">get</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Analyze</span> <span class="hljs-string">code</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">analyze</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">tests</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">flutter</span> <span class="hljs-string">test</span> <span class="hljs-string">--coverage</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">coverage</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">codecov/codecov-action@v2</span>
    
  <span class="hljs-attr">build-android:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">needs:</span> <span class="hljs-string">test</span>
    <span class="hljs-attr">if:</span> <span class="hljs-string">github.ref</span> <span class="hljs-string">==</span> <span class="hljs-string">'refs/heads/main'</span>
    
    <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v2</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Java</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-java@v2</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">distribution:</span> <span class="hljs-string">'temurin'</span>
        <span class="hljs-attr">java-version:</span> <span class="hljs-string">'11'</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Flutter</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">subosito/flutter-action@v2</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">APK</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">|
        flutter build apk --release \
          --dart-define=APP_ENV=production \
          --dart-define=API_URL=https://api.example.com
</span>    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">artifacts</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/upload-artifact@v2</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">name:</span> <span class="hljs-string">app-release</span>
        <span class="hljs-attr">path:</span> <span class="hljs-string">build/app/outputs/flutter-apk/app-release.apk</span>
</code></pre>
<h3 data-id="heading-48">ç¯å¢ƒé…ç½®ç®¡ç†</h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// lib/config/environment.dart</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Environment</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> apiUrl = <span class="hljs-built_in">String</span>.fromEnvironment(<span class="hljs-string">'API_URL'</span>);
  <span class="hljs-keyword">static</span> <span class="hljs-keyword">const</span> <span class="hljs-built_in">String</span> appEnv = <span class="hljs-built_in">String</span>.fromEnvironment(<span class="hljs-string">'APP_ENV'</span>);
  
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isProduction =&gt; appEnv == <span class="hljs-string">'production'</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> isDevelopment =&gt; appEnv == <span class="hljs-string">'development'</span>;
  
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">String</span>&gt; <span class="hljs-keyword">get</span> variables {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-string">'API_URL'</span>: apiUrl,
      <span class="hljs-string">'APP_ENV'</span>: appEnv,
    };
  }
}

<span class="hljs-comment">// æ„å»ºå‘½ä»¤</span>
flutter run --dart-define=APP_ENV=development --dart-define=API_URL=http:<span class="hljs-comment">//localhost:3000</span>

flutter build apk --release --dart-define=APP_ENV=production --dart-define=API_URL=https:<span class="hljs-comment">//api.example.com</span>
</code></pre>
<h2 data-id="heading-49">16. å…¶ä»–å®ç”¨æŠ€å·§</h2>
<h3 data-id="heading-50">è°ƒè¯•æŠ€å·§</h3>
<p>dart</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. è°ƒè¯•Buildæ¬¡æ•°</span>
class BuildCounter extends StatelessWidget {
  <span class="hljs-keyword">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-built_in">debugPrint</span>('BuildCounter rebuilt');
    return <span class="hljs-built_in">Container</span>();
  }
}

<span class="hljs-comment">// 2. ä½¿ç”¨DevTools</span>
<span class="hljs-comment">// è¿è¡Œï¼šflutter pub global run devtools</span>
<span class="hljs-comment">// ç„¶åï¼šflutter run --observatory-port=9200</span>

<span class="hljs-comment">// 3. æ€§èƒ½ç›‘æ§</span>
void <span class="hljs-selector-tag">main</span>() {
  WidgetsFlutterBinding<span class="hljs-selector-class">.ensureInitialized</span>();
  
  <span class="hljs-comment">// æ·»åŠ æ€§èƒ½ç›‘æ§</span>
  FlutterError<span class="hljs-selector-class">.onError</span> = (FlutterErrorDetails details) {
    Zone<span class="hljs-selector-class">.current</span><span class="hljs-selector-class">.handleUncaughtError</span>(details.exception, details.stack!);
  };
  
  <span class="hljs-built_in">runZonedGuarded</span>(() {
    <span class="hljs-built_in">runApp</span>(MyApp());
  }, (error, stackTrace) {
    <span class="hljs-comment">// è®°å½•æœªæ•è·å¼‚å¸¸</span>
    FirebaseCrashlytics<span class="hljs-selector-class">.instance</span><span class="hljs-selector-class">.recordError</span>(error, stackTrace);
  });
}
</code></pre>
<h3 data-id="heading-51">èµ„æºä¼˜åŒ–</h3>
<p>yaml</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># pubspec.yaml</span>
<span class="hljs-attr">flutter:</span>
  <span class="hljs-attr">assets:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">assets/images/</span>
    
  <span class="hljs-comment"># å­—ä½“ä¼˜åŒ–</span>
  <span class="hljs-attr">fonts:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">family:</span> <span class="hljs-string">Roboto</span>
      <span class="hljs-attr">fonts:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">asset:</span> <span class="hljs-string">assets/fonts/Roboto-Regular.ttf</span>
          <span class="hljs-attr">weight:</span> <span class="hljs-number">400</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">asset:</span> <span class="hljs-string">assets/fonts/Roboto-Bold.ttf</span>
          <span class="hljs-attr">weight:</span> <span class="hljs-number">700</span>
  
  <span class="hljs-comment"># Shaderé¢„ç¼–è¯‘ï¼ˆå‡å°‘å¡é¡¿ï¼‰</span>
  <span class="hljs-attr">shaders:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">shaders/myshader.frag</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€æ–‡ç²¾é€š-Mixinç‰¹æ€§]]></title>    <link>https://juejin.cn/post/7585452404113801231</link>    <guid>https://juejin.cn/post/7585452404113801231</guid>    <pubDate>2025-12-20T14:37:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585452404113801231" data-draft-id="7585452404113752079" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€æ–‡ç²¾é€š-Mixinç‰¹æ€§"/> <meta itemprop="keywords" content="Flutter,Dart,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-20T14:37:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ— çŸ¥çš„å‰ç«¯"/> <meta itemprop="url" content="https://juejin.cn/user/2410561882569933"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€æ–‡ç²¾é€š-Mixinç‰¹æ€§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2410561882569933/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ— çŸ¥çš„å‰ç«¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T14:37:25.000Z" title="Sat Dec 20 2025 14:37:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Dart Mixin è¯¦ç»†æŒ‡å—</h2>
<h3 data-id="heading-1">1. åŸºç¡€ Mixin ç”¨æ³•</h3>
<h4 data-id="heading-2">1.1 åŸºæœ¬ Mixin å®šä¹‰å’Œä½¿ç”¨</h4>
<p>dart</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å®šä¹‰ Mixin</span>
mixin <span class="hljs-title class_">LoggerMixin</span> {
  <span class="hljs-title class_">String</span> tag = <span class="hljs-string">'Logger'</span>;
  
  <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> message</span>) {
    <span class="hljs-title function_">print</span>(<span class="hljs-string">'[$tag] $message'</span>);
  }
  
  <span class="hljs-keyword">void</span> <span class="hljs-title function_">debug</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> message</span>) {
    <span class="hljs-title function_">print</span>(<span class="hljs-string">'[$tag] DEBUG: $message'</span>);
  }
}

mixin <span class="hljs-title class_">ValidatorMixin</span> {
  bool <span class="hljs-title function_">validateEmail</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> email</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">RegExp</span>(r<span class="hljs-string">'^[^@]+@[^@]+.[^@]+'</span>).<span class="hljs-title function_">hasMatch</span>(email);
  }
  
  bool <span class="hljs-title function_">validatePhone</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> phone</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">RegExp</span>(r<span class="hljs-string">'^[0-9]{10,11}$'</span>).<span class="hljs-title function_">hasMatch</span>(phone);
  }
}

<span class="hljs-comment">// ä½¿ç”¨ Mixin</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">with</span> <span class="hljs-title class_">LoggerMixin</span>, <span class="hljs-title class_">ValidatorMixin</span> {
  <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerUser</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> email, <span class="hljs-built_in">String</span> phone</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">validateEmail</span>(email) &amp;&amp; <span class="hljs-title function_">validatePhone</span>(phone)) {
      <span class="hljs-title function_">log</span>(<span class="hljs-string">'ç”¨æˆ·æ³¨å†ŒæˆåŠŸ: $email'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">debug</span>(<span class="hljs-string">'æ³¨å†Œä¿¡æ¯éªŒè¯å¤±è´¥'</span>);
    }
  }
}

<span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  final service = <span class="hljs-title class_">UserService</span>();
  service.<span class="hljs-title function_">registerUser</span>(<span class="hljs-string">'test@example.com'</span>, <span class="hljs-string">'13800138000'</span>);
}
</code></pre>
<h3 data-id="heading-3">2. Mixin å®šä¹‰æŠ½è±¡æ–¹æ³•</h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">mixin</span> AuthenticationMixin {
  <span class="hljs-comment">// æŠ½è±¡æ–¹æ³• - å¼ºåˆ¶æ··å…¥ç±»å®ç°</span>
  Future&lt;<span class="hljs-built_in">String</span>&gt; fetchToken();
  
  <span class="hljs-comment">// å…·ä½“æ–¹æ³• - å¯ä»¥ä½¿ç”¨æŠ½è±¡æ–¹æ³•</span>
  Future&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&gt; getProfile() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> token = <span class="hljs-keyword">await</span> fetchToken();
    log(<span class="hljs-string">'ä½¿ç”¨ token: <span class="hljs-subst">$token</span> è·å–ç”¨æˆ·èµ„æ–™'</span>);
    <span class="hljs-keyword">return</span> {<span class="hljs-string">'name'</span>: <span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-string">'token'</span>: token};
  }
  
  <span class="hljs-keyword">void</span> log(<span class="hljs-built_in">String</span> message) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'[Auth] <span class="hljs-subst">$message</span>'</span>);
  }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiService</span> <span class="hljs-title">with</span> <span class="hljs-title">AuthenticationMixin</span> </span>{
  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-built_in">String</span>&gt; fetchToken() <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// å®ç°æŠ½è±¡æ–¹æ³•</span>
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">100</span>));
    <span class="hljs-keyword">return</span> <span class="hljs-string">'jwt_token_123456'</span>;
  }
}

<span class="hljs-keyword">void</span> main() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> api = ApiService();
  <span class="hljs-keyword">final</span> profile = <span class="hljs-keyword">await</span> api.getProfile();
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'ç”¨æˆ·èµ„æ–™: <span class="hljs-subst">$profile</span>'</span>);
}
</code></pre>
<h3 data-id="heading-4">3. ä½¿ç”¨Â <code>on</code>Â å…³é”®å­—é™åˆ¶ Mixin èŒƒå›´</h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// åŸºç±»</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Animal</span> </span>{
  <span class="hljs-built_in">String</span> name;
  Animal(<span class="hljs-keyword">this</span>.name);
  
  <span class="hljs-keyword">void</span> eat() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">$name</span> æ­£åœ¨åƒä¸œè¥¿'</span>);
  }
}

<span class="hljs-comment">// åªèƒ½ç”¨äº Animal åŠå…¶å­ç±»çš„ Mixin</span>
<span class="hljs-keyword">mixin</span> WalkerMixin <span class="hljs-keyword">on</span> Animal {
  <span class="hljs-keyword">void</span> walk() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">$name</span> æ­£åœ¨è¡Œèµ°'</span>);
    eat(); <span class="hljs-comment">// å¯ä»¥è®¿é—®å®¿ä¸»ç±»çš„æ–¹æ³•</span>
  }
}

<span class="hljs-keyword">mixin</span> SwimmerMixin <span class="hljs-keyword">on</span> Animal {
  <span class="hljs-keyword">void</span> swim() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">$name</span> æ­£åœ¨æ¸¸æ³³'</span>);
  }
}

<span class="hljs-comment">// æ­£ç¡®ä½¿ç”¨</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Animal</span> <span class="hljs-title">with</span> <span class="hljs-title">WalkerMixin</span> </span>{
  Dog(<span class="hljs-built_in">String</span> name) : <span class="hljs-keyword">super</span>(name);
  
  <span class="hljs-keyword">void</span> bark() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'<span class="hljs-subst">$name</span>: æ±ªæ±ª!'</span>);
  }
}

<span class="hljs-comment">// é”™è¯¯ä½¿ç”¨ï¼ˆç¼–è¯‘é”™è¯¯ï¼‰ï¼š</span>
<span class="hljs-comment">// class Robot with WalkerMixin {} // é”™è¯¯ï¼šWalkerMixin åªèƒ½ç”¨äº Animal</span>

<span class="hljs-keyword">void</span> main() {
  <span class="hljs-keyword">final</span> dog = Dog(<span class="hljs-string">'å°é»‘'</span>);
  dog.walk();  <span class="hljs-comment">// å°é»‘ æ­£åœ¨è¡Œèµ°</span>
  dog.bark();  <span class="hljs-comment">// å°é»‘: æ±ªæ±ª!</span>
  dog.eat();   <span class="hljs-comment">// å°é»‘ æ­£åœ¨åƒä¸œè¥¿</span>
}
</code></pre>
<h3 data-id="heading-5">4. å¤š Mixin ç»„åˆ</h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// åŠŸèƒ½æ¨¡å—åŒ– Mixin</span>
<span class="hljs-keyword">mixin</span> ApiClientMixin {
  Future&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&gt; <span class="hljs-keyword">get</span>(<span class="hljs-built_in">String</span> url) <span class="hljs-keyword">async</span> {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'GET è¯·æ±‚: <span class="hljs-subst">$url</span>'</span>);
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">100</span>));
    <span class="hljs-keyword">return</span> {<span class="hljs-string">'status'</span>: <span class="hljs-number">200</span>, <span class="hljs-string">'data'</span>: <span class="hljs-string">'å“åº”æ•°æ®'</span>};
  }
}

<span class="hljs-keyword">mixin</span> CacheMixin {
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; _cache = {};
  
  <span class="hljs-keyword">void</span> cacheData(<span class="hljs-built_in">String</span> key, <span class="hljs-built_in">dynamic</span> data) {
    _cache[key] = data;
  }
  
  <span class="hljs-built_in">dynamic</span> getCache(<span class="hljs-built_in">String</span> key) =&gt; _cache[key];
}

<span class="hljs-keyword">mixin</span> LoggingMixin {
  <span class="hljs-keyword">void</span> logRequest(<span class="hljs-built_in">String</span> method, <span class="hljs-built_in">String</span> url) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'[<span class="hljs-subst">${DateTime.now()}</span>] <span class="hljs-subst">$method</span> <span class="hljs-subst">$url</span>'</span>);
  }
}

<span class="hljs-comment">// ç»„åˆå¤šä¸ª Mixin</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NetworkService</span> <span class="hljs-title">with</span> <span class="hljs-title">ApiClientMixin</span>, <span class="hljs-title">CacheMixin</span>, <span class="hljs-title">LoggingMixin</span> </span>{
  Future&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&gt; fetchWithCache(<span class="hljs-built_in">String</span> url) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> cached = getCache(url);
    <span class="hljs-keyword">if</span> (cached != <span class="hljs-keyword">null</span>) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">'ä½¿ç”¨ç¼“å­˜æ•°æ®'</span>);
      <span class="hljs-keyword">return</span> cached;
    }
    
    logRequest(<span class="hljs-string">'GET'</span>, url);
    <span class="hljs-keyword">final</span> response = <span class="hljs-keyword">await</span> <span class="hljs-keyword">get</span>(url);
    cacheData(url, response);
    
    <span class="hljs-keyword">return</span> response;
  }
}

<span class="hljs-keyword">void</span> main() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> service = NetworkService();
  <span class="hljs-keyword">final</span> result1 = <span class="hljs-keyword">await</span> service.fetchWithCache(<span class="hljs-string">'/api/user'</span>);
  <span class="hljs-keyword">final</span> result2 = <span class="hljs-keyword">await</span> service.fetchWithCache(<span class="hljs-string">'/api/user'</span>); <span class="hljs-comment">// ç¬¬äºŒæ¬¡ä½¿ç”¨ç¼“å­˜</span>
}
</code></pre>
<h3 data-id="heading-6">5. åŒåæ–¹æ³•å†²çªä¸çº¿æ€§åŒ–é¡ºåº</h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">mixin</span> A {
  <span class="hljs-built_in">String</span> message = <span class="hljs-string">'æ¥è‡ªA'</span>;
  
  <span class="hljs-keyword">void</span> <span class="hljs-keyword">show</span>() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'A.show(): <span class="hljs-subst">$message</span>'</span>);
  }
  
  <span class="hljs-keyword">void</span> methodA() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'A.methodA()'</span>);
  }
}

<span class="hljs-keyword">mixin</span> B {
  <span class="hljs-built_in">String</span> message = <span class="hljs-string">'æ¥è‡ªB'</span>;
  
  <span class="hljs-keyword">void</span> <span class="hljs-keyword">show</span>() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'B.show(): <span class="hljs-subst">$message</span>'</span>);
  }
  
  <span class="hljs-keyword">void</span> methodB() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'B.methodB()'</span>);
  }
}

<span class="hljs-keyword">mixin</span> C {
  <span class="hljs-built_in">String</span> message = <span class="hljs-string">'æ¥è‡ªC'</span>;
  
  <span class="hljs-keyword">void</span> <span class="hljs-keyword">show</span>() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'C.show(): <span class="hljs-subst">$message</span>'</span>);
  }
}

<span class="hljs-comment">// çˆ¶ç±»</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Base</span> </span>{
  <span class="hljs-built_in">String</span> message = <span class="hljs-string">'æ¥è‡ªBase'</span>;
  
  <span class="hljs-keyword">void</span> <span class="hljs-keyword">show</span>() {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'Base.show(): <span class="hljs-subst">$message</span>'</span>);
  }
}

<span class="hljs-comment">// æ··å…¥é¡ºåºï¼šBase -&gt; A -&gt; B -&gt; Cï¼ˆæœ€åæ··å…¥çš„ä¼˜å…ˆçº§æœ€é«˜ï¼‰</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Base</span> <span class="hljs-title">with</span> <span class="hljs-title">A</span>, <span class="hljs-title">B</span>, <span class="hljs-title">C</span> </span>{
  <span class="hljs-comment">// å¯ä»¥é€šè¿‡superè°ƒç”¨çº¿æ€§åŒ–é“¾ä¸­çš„æ–¹æ³•</span>
  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> <span class="hljs-keyword">show</span>() {
    <span class="hljs-keyword">super</span>.<span class="hljs-keyword">show</span>(); <span class="hljs-comment">// è°ƒç”¨Cçš„showæ–¹æ³•</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'MyClass.show() å®Œæˆ'</span>);
  }
}

<span class="hljs-comment">// çº¿æ€§åŒ–é¡ºåºéªŒè¯</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnotherClass</span> <span class="hljs-title">with</span> <span class="hljs-title">C</span>, <span class="hljs-title">B</span>, <span class="hljs-title">A</span> </span>{
  <span class="hljs-comment">// é¡ºåºï¼šObject -&gt; C -&gt; B -&gt; A</span>
  <span class="hljs-keyword">void</span> test() {
    <span class="hljs-keyword">show</span>(); <span class="hljs-comment">// è°ƒç”¨Açš„showï¼ˆæœ€åæ··å…¥ï¼‰</span>
    <span class="hljs-built_in">print</span>(message); <span class="hljs-comment">// è¾“å‡ºï¼šæ¥è‡ªA</span>
  }
}

<span class="hljs-keyword">void</span> main() {
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'=== MyClass æµ‹è¯• ==='</span>);
  <span class="hljs-keyword">final</span> obj1 = MyClass();
  obj1.<span class="hljs-keyword">show</span>();    <span class="hljs-comment">// è°ƒç”¨C.show()ï¼Œå› ä¸ºCæœ€åæ··å…¥</span>
  <span class="hljs-built_in">print</span>(obj1.message); <span class="hljs-comment">// è¾“å‡ºï¼šæ¥è‡ªC</span>
  
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'\n=== AnotherClass æµ‹è¯• ==='</span>);
  <span class="hljs-keyword">final</span> obj2 = AnotherClass();
  obj2.test();
  
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'\n=== æ–¹æ³•è°ƒç”¨é“¾ ==='</span>);
  obj1.methodA(); <span class="hljs-comment">// å¯ä»¥è°ƒç”¨</span>
  obj1.methodB(); <span class="hljs-comment">// å¯ä»¥è°ƒç”¨</span>
  
  <span class="hljs-comment">// éªŒè¯ç±»å‹</span>
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'\n=== ç±»å‹æ£€æŸ¥ ==='</span>);
  <span class="hljs-built_in">print</span>(obj1 <span class="hljs-keyword">is</span> Base); <span class="hljs-comment">// true</span>
  <span class="hljs-built_in">print</span>(obj1 <span class="hljs-keyword">is</span> A);    <span class="hljs-comment">// true</span>
  <span class="hljs-built_in">print</span>(obj1 <span class="hljs-keyword">is</span> B);    <span class="hljs-comment">// true</span>
  <span class="hljs-built_in">print</span>(obj1 <span class="hljs-keyword">is</span> C);    <span class="hljs-comment">// true</span>
}
</code></pre>
<h3 data-id="heading-7">6. å¤æ‚çš„çº¿æ€§åŒ–é¡ºåºç¤ºä¾‹</h3>
<p>dart</p>
<pre><code class="hljs language-scss" lang="scss">class Base {
  void <span class="hljs-built_in">execute</span>() =&gt; <span class="hljs-built_in">print</span>('Base.execute()');
}

mixin Mixin1 {
  void <span class="hljs-built_in">execute</span>() {
    <span class="hljs-built_in">print</span>('Mixin1.execute() - å¼€å§‹');
    super<span class="hljs-selector-class">.execute</span>();
    <span class="hljs-built_in">print</span>('Mixin1.execute() - ç»“æŸ');
  }
}

mixin Mixin2 {
  void <span class="hljs-built_in">execute</span>() {
    <span class="hljs-built_in">print</span>('Mixin2.execute() - å¼€å§‹');
    super<span class="hljs-selector-class">.execute</span>();
    <span class="hljs-built_in">print</span>('Mixin2.execute() - ç»“æŸ');
  }
}

mixin Mixin3 {
  void <span class="hljs-built_in">execute</span>() {
    <span class="hljs-built_in">print</span>('Mixin3.execute() - å¼€å§‹');
    super<span class="hljs-selector-class">.execute</span>();
    <span class="hljs-built_in">print</span>('Mixin3.execute() - ç»“æŸ');
  }
}

class MyService extends Base with Mixin1, Mixin2, Mixin3 {
  <span class="hljs-keyword">@override</span>
  void execute() {
    <span class="hljs-built_in">print</span>('MyService.execute() - å¼€å§‹');
    super<span class="hljs-selector-class">.execute</span>(); <span class="hljs-comment">// è°ƒç”¨é“¾ï¼šMixin3 -&gt; Mixin2 -&gt; Mixin1 -&gt; Base</span>
    <span class="hljs-built_in">print</span>('MyService.execute() - ç»“æŸ');
  }
}

void <span class="hljs-selector-tag">main</span>() {
  final service = <span class="hljs-built_in">MyService</span>();
  service<span class="hljs-selector-class">.execute</span>();
  
  <span class="hljs-comment">// è¾“å‡ºé¡ºåºï¼š</span>
  <span class="hljs-comment">// MyService.execute() - å¼€å§‹</span>
  <span class="hljs-comment">// Mixin3.execute() - å¼€å§‹</span>
  <span class="hljs-comment">// Mixin2.execute() - å¼€å§‹</span>
  <span class="hljs-comment">// Mixin1.execute() - å¼€å§‹</span>
  <span class="hljs-comment">// Base.execute()</span>
  <span class="hljs-comment">// Mixin1.execute() - ç»“æŸ</span>
  <span class="hljs-comment">// Mixin2.execute() - ç»“æŸ</span>
  <span class="hljs-comment">// Mixin3.execute() - ç»“æŸ</span>
  <span class="hljs-comment">// MyService.execute() - ç»“æŸ</span>
}
</code></pre>
<h3 data-id="heading-8">7. å·¥å‚æ¨¡å¼ä¸ Mixin</h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// å¯åºåˆ—åŒ–æ¥å£</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Serializable</span> </span>{
  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toJson();
}

<span class="hljs-comment">// Mixin æä¾›åºåˆ—åŒ–åŠŸèƒ½</span>
<span class="hljs-keyword">mixin</span> JsonSerializableMixin <span class="hljs-keyword">implements</span> Serializable {
  <span class="hljs-meta">@override</span>
  <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; toJson() {
    <span class="hljs-keyword">final</span> json = &lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;{};
    
    <span class="hljs-comment">// ä½¿ç”¨åå°„è·å–æ‰€æœ‰å­—æ®µï¼ˆå®é™…é¡¹ç›®ä¸­å¯èƒ½éœ€è¦ dart:mirrors æˆ–ä»£ç ç”Ÿæˆï¼‰</span>
    <span class="hljs-comment">// è¿™é‡Œç®€åŒ–å¤„ç†</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> field <span class="hljs-keyword">in</span> _getFields()) {
      json[field] = _getFieldValue(field);
    }
    
    <span class="hljs-keyword">return</span> json;
  }
  
  <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; _getFields() {
    <span class="hljs-comment">// å®é™…å®ç°åº”ä½¿ç”¨åå°„</span>
    <span class="hljs-keyword">return</span> [];
  }
  
  <span class="hljs-built_in">dynamic</span> _getFieldValue(<span class="hljs-built_in">String</span> field) {
    <span class="hljs-comment">// å®é™…å®ç°åº”ä½¿ç”¨åå°„</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
  }
}

<span class="hljs-comment">// ä½¿ç”¨ Mixin å¢å¼ºç±»çš„åŠŸèƒ½</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> <span class="hljs-title">with</span> <span class="hljs-title">JsonSerializableMixin</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> name;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> age;
  
  User(<span class="hljs-keyword">this</span>.name, <span class="hljs-keyword">this</span>.age);
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; _getFields() =&gt; [<span class="hljs-string">'name'</span>, <span class="hljs-string">'age'</span>];
  
  <span class="hljs-meta">@override</span>
  <span class="hljs-built_in">dynamic</span> _getFieldValue(<span class="hljs-built_in">String</span> field) {
    <span class="hljs-keyword">switch</span> (field) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'name'</span>: <span class="hljs-keyword">return</span> name;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'age'</span>: <span class="hljs-keyword">return</span> age;
      <span class="hljs-keyword">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
    }
  }
}

<span class="hljs-keyword">void</span> main() {
  <span class="hljs-keyword">final</span> user = User(<span class="hljs-string">'å¼ ä¸‰'</span>, <span class="hljs-number">25</span>);
  <span class="hljs-built_in">print</span>(user.toJson()); <span class="hljs-comment">// {name: å¼ ä¸‰, age: 25}</span>
}
</code></pre>
<h3 data-id="heading-9">8. ä¾èµ–æ³¨å…¥æ¨¡å¼ä¸­çš„ Mixin</h3>
<p>dart</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// æœåŠ¡å®šä½å™¨ Mixin</span>
<span class="hljs-keyword">mixin</span> ServiceLocatorMixin {
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">Type</span>, <span class="hljs-built_in">Object</span>&gt; _services = {};
  
  <span class="hljs-keyword">void</span> registerService&lt;T&gt;(T service) {
    _services[T] = service;
  }
  
  T getService&lt;T&gt;() {
    <span class="hljs-keyword">final</span> service = _services[T];
    <span class="hljs-keyword">if</span> (service == <span class="hljs-keyword">null</span>) {
      <span class="hljs-keyword">throw</span> StateError(<span class="hljs-string">'æœªæ‰¾åˆ°æœåŠ¡: <span class="hljs-subst">$T</span>'</span>);
    }
    <span class="hljs-keyword">return</span> service <span class="hljs-keyword">as</span> T;
  }
}

<span class="hljs-comment">// ç½‘ç»œæœåŠ¡</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NetworkService</span> </span>{
  Future&lt;<span class="hljs-built_in">String</span>&gt; fetchData() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">100</span>));
    <span class="hljs-keyword">return</span> <span class="hljs-string">'ç½‘ç»œæ•°æ®'</span>;
  }
}

<span class="hljs-comment">// æ•°æ®åº“æœåŠ¡</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DatabaseService</span> </span>{
  Future&lt;<span class="hljs-built_in">String</span>&gt; queryData() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> Future.delayed(<span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">50</span>));
    <span class="hljs-keyword">return</span> <span class="hljs-string">'æ•°æ®åº“æ•°æ®'</span>;
  }
}

<span class="hljs-comment">// ä½¿ç”¨ Mixin çš„åº”ç”¨ç±»</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-title">with</span> <span class="hljs-title">ServiceLocatorMixin</span> </span>{
  MyApp() {
    <span class="hljs-comment">// æ³¨å†ŒæœåŠ¡</span>
    registerService(NetworkService());
    registerService(DatabaseService());
  }
  
  Future&lt;<span class="hljs-keyword">void</span>&gt; run() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> network = getService&lt;NetworkService&gt;();
    <span class="hljs-keyword">final</span> database = getService&lt;DatabaseService&gt;();
    
    <span class="hljs-keyword">final</span> results = <span class="hljs-keyword">await</span> Future.wait([
      network.fetchData(),
      database.queryData(),
    ]);
    
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'ç»“æœ: <span class="hljs-subst">$results</span>'</span>);
  }
}

<span class="hljs-keyword">void</span> main() <span class="hljs-keyword">async</span> {
  <span class="hljs-keyword">final</span> app = MyApp();
  <span class="hljs-keyword">await</span> app.run();
}
</code></pre>
<h3 data-id="heading-10">9. Mixin æœ€ä½³å®è·µç¤ºä¾‹</h3>
<p>dart</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. å•ä¸€èŒè´£çš„ Mixin</span>
mixin EquatableMixin&lt;T&gt; {
  bool <span class="hljs-built_in">equals</span>(T other);
  
  <span class="hljs-keyword">@override</span>
  bool operator ==(Object other) =&gt;
      identical(this, other) ||
      other is T &amp;&amp; equals(other);
      
  <span class="hljs-keyword">@override</span>
  int get hashCode =&gt; toString().hashCode;
}

mixin CloneableMixin&lt;T&gt; {
  T <span class="hljs-built_in">clone</span>();
}

<span class="hljs-comment">// 2. å¸¦ç”Ÿå‘½å‘¨æœŸçš„ Mixin</span>
mixin LifecycleMixin {
  bool _isInitialized = false;
  
  void <span class="hljs-built_in">initialize</span>() {
    if (!_isInitialized) {
      <span class="hljs-built_in">_onInit</span>();
      _isInitialized = true;
    }
  }
  
  void <span class="hljs-built_in">dispose</span>() {
    if (_isInitialized) {
      <span class="hljs-built_in">_onDispose</span>();
      _isInitialized = false;
    }
  }
  
  <span class="hljs-comment">// é’©å­æ–¹æ³•</span>
  void <span class="hljs-built_in">_onInit</span>() {}
  void <span class="hljs-built_in">_onDispose</span>() {}
}

<span class="hljs-comment">// 3. å¯è§‚å¯Ÿçš„ Mixin</span>
mixin ObservableMixin {
  final List&lt;<span class="hljs-built_in">Function</span>()&gt; _listeners = <span class="hljs-selector-attr">[]</span>;
  
  void <span class="hljs-built_in">addListener</span>(Function() listener) {
    _listeners<span class="hljs-selector-class">.add</span>(listener);
  }
  
  void <span class="hljs-built_in">removeListener</span>(Function() listener) {
    _listeners<span class="hljs-selector-class">.remove</span>(listener);
  }
  
  void <span class="hljs-built_in">notifyListeners</span>() {
    for (final listener in _listeners) {
      <span class="hljs-built_in">listener</span>();
    }
  }
}

<span class="hljs-comment">// ä½¿ç”¨å¤šä¸ª Mixin çš„æ¨¡å‹ç±»</span>
class UserModel with EquatableMixin&lt;UserModel&gt;, CloneableMixin&lt;UserModel&gt;, ObservableMixin {
  String name;
  int age;
  
  <span class="hljs-built_in">UserModel</span>(this.name, this.age);
  
  <span class="hljs-keyword">@override</span>
  bool equals(UserModel other) =&gt;
      name == other.name &amp;&amp; age == other.age;
      
  <span class="hljs-keyword">@override</span>
  UserModel clone() =&gt; UserModel(name, age);
  
  void <span class="hljs-built_in">updateName</span>(String newName) {
    name = newName;
    <span class="hljs-built_in">notifyListeners</span>(); <span class="hljs-comment">// é€šçŸ¥è§‚å¯Ÿè€…</span>
  }
  
  <span class="hljs-keyword">@override</span>
  String toString() =&gt; <span class="hljs-string">'User(name: $name, age: $age)'</span>;
}

void <span class="hljs-selector-tag">main</span>() {
  final user1 = <span class="hljs-built_in">UserModel</span>('Alice', <span class="hljs-number">30</span>);
  final user2 = <span class="hljs-built_in">UserModel</span>('Alice', <span class="hljs-number">30</span>);
  final user3 = user1<span class="hljs-selector-class">.clone</span>();
  
  <span class="hljs-built_in">print</span>('user1 == user2: ${user1 == user2}'); <span class="hljs-comment">// true</span>
  <span class="hljs-built_in">print</span>('user1 == user3: ${user1 == user3}'); <span class="hljs-comment">// true</span>
  
  <span class="hljs-comment">// æ·»åŠ ç›‘å¬å™¨</span>
  user1<span class="hljs-selector-class">.addListener</span>(() {
    <span class="hljs-built_in">print</span>('ç”¨æˆ·æ•°æ®å·²æ›´æ–°ï¼');
  });
  
  user1<span class="hljs-selector-class">.updateName</span>('Bob'); <span class="hljs-comment">// è§¦å‘ç›‘å¬å™¨</span>
}
</code></pre>
<h3 data-id="heading-11">Mixin è¯¦ç»†æ€»ç»“</h3>
<h4 data-id="heading-12">ç‰¹æ€§æ€»ç»“</h4>













































<table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>å®šä¹‰æ–¹å¼</strong></td><td>ä½¿ç”¨Â <code>mixin</code>Â å…³é”®å­—å®šä¹‰</td></tr><tr><td><strong>ä½¿ç”¨æ–¹å¼</strong></td><td>ä½¿ç”¨Â <code>with</code>Â å…³é”®å­—æ··å…¥åˆ°ç±»ä¸­</td></tr><tr><td><strong>ç»§æ‰¿é™åˆ¶</strong></td><td>æ¯ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œä½†å¯ä»¥æ··å…¥å¤šä¸ª Mixin</td></tr><tr><td><strong>å®ä¾‹åŒ–</strong></td><td>Mixin ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œåªèƒ½è¢«æ··å…¥</td></tr><tr><td><strong>æ„é€ å‡½æ•°</strong></td><td>Mixin ä¸èƒ½å£°æ˜æ„é€ å‡½æ•°ï¼ˆæ— å‚æ„é€ å‡½æ•°é™¤å¤–ï¼‰</td></tr><tr><td><strong>æŠ½è±¡æ–¹æ³•</strong></td><td>å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ï¼Œå¼ºåˆ¶å®¿ä¸»ç±»å®ç°</td></tr><tr><td><strong>èŒƒå›´é™åˆ¶</strong></td><td>å¯ä»¥ä½¿ç”¨Â <code>on</code>Â å…³é”®å­—é™åˆ¶ Mixin åªèƒ½ç”¨äºç‰¹å®šç±»</td></tr><tr><td><strong>çº¿æ€§åŒ–é¡ºåº</strong></td><td>æ··å…¥é¡ºåºå†³å®šæ–¹æ³•è°ƒç”¨ä¼˜å…ˆçº§ï¼ˆæœ€åæ··å…¥çš„ä¼˜å…ˆçº§æœ€é«˜ï¼‰</td></tr><tr><td><strong>ç±»å‹ç³»ç»Ÿ</strong></td><td>Mixin åœ¨ç±»å‹ç³»ç»Ÿä¸­æ˜¯é€æ˜çš„ï¼Œå®¿ä¸»ç±»æ‹¥æœ‰ Mixin çš„æ‰€æœ‰æ¥å£</td></tr></tbody></table>
<h4 data-id="heading-13">ä½¿ç”¨åœºæ™¯</h4>
<ol>
<li>
<p><strong>æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆCross-cutting Concernsï¼‰</strong></p>
<ul>
<li>æ—¥å¿—è®°å½•ã€æƒé™éªŒè¯ã€æ€§èƒ½ç›‘æ§</li>
<li>æ•°æ®éªŒè¯ã€æ ¼å¼è½¬æ¢</li>
</ul>
</li>
<li>
<p><strong>åŠŸèƒ½ç»„åˆï¼ˆFeature Compositionï¼‰</strong></p>
<ul>
<li>UI ç»„ä»¶çš„åŠŸèƒ½ç»„åˆ</li>
<li>æœåŠ¡ç±»çš„åŠŸèƒ½å¢å¼º</li>
</ul>
</li>
<li>
<p><strong>æ¥å£å¢å¼ºï¼ˆInterface Enhancementï¼‰</strong></p>
<ul>
<li>ä¸ºç°æœ‰ç±»æ·»åŠ é¢å¤–åŠŸèƒ½è€Œä¸ä¿®æ”¹åŸå§‹ç±»</li>
<li>å®ç°è£…é¥°å™¨æ¨¡å¼</li>
</ul>
</li>
<li>
<p><strong>ä»£ç å¤ç”¨ï¼ˆCode Reuseï¼‰</strong></p>
<ul>
<li>å°†é€šç”¨é€»è¾‘æŠ½ç¦»ä¸ºå¯å¤ç”¨æ¨¡å—</li>
<li>é¿å…é‡å¤ä»£ç </li>
</ul>
</li>
</ol>
<h4 data-id="heading-14">ä¼˜ç‚¹</h4>
<ol>
<li><strong>çµæ´»æ€§é«˜</strong>ï¼šå¯ä»¥ç»„åˆå¤šä¸ª Mixinï¼Œå®ç°ç±»ä¼¼å¤šç»§æ‰¿çš„æ•ˆæœ</li>
<li><strong>è§£è€¦æ€§å¼º</strong>ï¼šåŠŸèƒ½æ¨¡å—åŒ–ï¼ŒèŒè´£å•ä¸€</li>
<li><strong>é¿å…é’»çŸ³é—®é¢˜</strong>ï¼šé€šè¿‡çº¿æ€§åŒ–é¡ºåºè§£å†³å¤šç»§æ‰¿ä¸­çš„æ­§ä¹‰é—®é¢˜</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šç¼–è¯‘æ—¶æ£€æŸ¥ï¼Œè¿è¡Œæ—¶æ€§èƒ½å¥½</li>
<li><strong>æ˜“äºæµ‹è¯•</strong>ï¼šå¯ä»¥å•ç‹¬æµ‹è¯• Mixin çš„åŠŸèƒ½</li>
</ol>
<h4 data-id="heading-15">ç¼ºç‚¹</h4>
<ol>
<li><strong>ç†è§£æˆæœ¬</strong>ï¼šçº¿æ€§åŒ–é¡ºåºéœ€è¦ç†è§£</li>
<li><strong>è°ƒè¯•å›°éš¾</strong>ï¼šæ–¹æ³•è°ƒç”¨é“¾å¯èƒ½è¾ƒé•¿</li>
<li><strong>è¿‡åº¦ä½¿ç”¨é£é™©</strong>ï¼šå¯èƒ½å¯¼è‡´ç±»ç»“æ„å¤æ‚</li>
<li><strong>å‘½åå†²çª</strong>ï¼šä¸åŒ Mixin çš„åŒåæ–¹æ³•å¯èƒ½å†²çª</li>
</ol>
<h4 data-id="heading-16">æœ€ä½³å®è·µ</h4>
<ol>
<li><strong>å•ä¸€èŒè´£</strong>ï¼šæ¯ä¸ª Mixin åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„åŠŸèƒ½</li>
<li><strong>å‘½åæ¸…æ™°</strong>ï¼šä½¿ç”¨Â <code>Mixin</code>Â åç¼€ï¼Œå¦‚Â <code>LoggerMixin</code></li>
<li><strong>é€‚åº¦ä½¿ç”¨</strong>ï¼šé¿å…è¿‡åº¦ä½¿ç”¨å¯¼è‡´ä»£ç éš¾ä»¥ç†è§£</li>
<li><strong>æ–‡æ¡£æ³¨é‡Š</strong>ï¼šè¯´æ˜ Mixin çš„ä½œç”¨å’Œä½¿ç”¨æ–¹å¼</li>
<li><strong>è€ƒè™‘æ›¿ä»£æ–¹æ¡ˆ</strong>ï¼šæœ‰æ—¶ç»§æ‰¿æˆ–ç»„åˆå¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©</li>
</ol>
<h4 data-id="heading-17">ä¸ç›¸å…³æ¦‚å¿µçš„å¯¹æ¯”</h4>

























<table><thead><tr><th>æ¦‚å¿µ</th><th>ä¸ Mixin çš„åŒºåˆ«</th></tr></thead><tbody><tr><td><strong>æŠ½è±¡ç±»</strong></td><td>å¯ä»¥æœ‰æ„é€ å‡½æ•°ã€å¯ä»¥æœ‰çŠ¶æ€ï¼›Mixin ä¸èƒ½æœ‰æ„é€ å‡½æ•°</td></tr><tr><td><strong>æ¥å£</strong></td><td>åªå®šä¹‰å¥‘çº¦ï¼Œä¸æä¾›å®ç°ï¼›Mixin å¯ä»¥æä¾›å®ç°</td></tr><tr><td><strong>æ‰©å±•æ–¹æ³•</strong></td><td>åœ¨ç±»å¤–éƒ¨æ·»åŠ æ–¹æ³•ï¼›Mixin åœ¨ç±»å†…éƒ¨æ·»åŠ </td></tr><tr><td><strong>ç»§æ‰¿</strong></td><td>å•ç»§æ‰¿ï¼Œå¼ºè°ƒ "is-a" å…³ç³»ï¼›Mixin å¼ºè°ƒ "has-a" æˆ– "can-do" å…³ç³»</td></tr></tbody></table>
<p>Mixin æ˜¯ Dart è¯­è¨€ä¸­éå¸¸å¼ºå¤§çš„ç‰¹æ€§ï¼Œåˆç†ä½¿ç”¨å¯ä»¥è®©ä»£ç æ›´åŠ æ¨¡å—åŒ–ã€å¯å¤ç”¨å’Œå¯ç»´æŠ¤ã€‚</p>
<h3 data-id="heading-18"><strong>1. ä»€ä¹ˆæ˜¯ Mixinï¼Ÿå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h3>
<p><strong>ç²¾å‡†å›ç­”ï¼š</strong><br/>
"Mixin æ˜¯ Dart ä¸­ä¸€ç§ä»£ç å¤ç”¨æœºåˆ¶ï¼Œå®ƒå…è®¸ä¸€ä¸ªç±»é€šè¿‡Â <code>with</code>Â å…³é”®å­—æ··å…¥ä¸€ä¸ªæˆ–å¤šä¸ªç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—ã€‚Mixin çš„ä¸»è¦ä½œç”¨æ˜¯è§£å†³ Dart å•ç»§æ‰¿çš„é™åˆ¶ï¼Œå®ç°ç±»ä¼¼å¤šç»§æ‰¿çš„æ•ˆæœï¼Œè®©ä»£ç æ›´åŠ æ¨¡å—åŒ–å’Œå¯å¤ç”¨ã€‚"</p>
<p><strong>åŠ åˆ†ç‚¹ï¼š</strong></p>
<ul>
<li>å¼ºè°ƒ "ä»£ç å¤ç”¨æœºåˆ¶" è€Œé "ç»§æ‰¿æœºåˆ¶"</li>
<li>æåˆ° "å•ç»§æ‰¿é™åˆ¶" å’Œ "ç±»ä¼¼å¤šç»§æ‰¿"</li>
<li>è¯´æ˜ä¸»è¦ä½¿ç”¨åœºæ™¯ï¼šæ¨ªå‘åŠŸèƒ½æ‰©å±•</li>
</ul>
<h3 data-id="heading-19"><strong>2. Mixin å’Œç»§æ‰¿ã€æ¥å£æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h3>
<p><strong>ç²¾å‡†å›ç­”ï¼ˆè¡¨æ ¼å¯¹æ¯”ï¼‰ï¼š</strong></p>









































<table><thead><tr><th>ç‰¹æ€§</th><th>Mixin</th><th>ç»§æ‰¿</th><th>æ¥å£</th></tr></thead><tbody><tr><td>å…³ç³»</td><td>"å…·æœ‰" åŠŸèƒ½ (has-a)</td><td>"æ˜¯ä¸€ä¸ª" (is-a)</td><td>"èƒ½åšä»€ä¹ˆ" (can-do)</td></tr><tr><td>æ•°é‡</td><td>å¯å¤šä¸ª</td><td>å•ç»§æ‰¿</td><td>å¯å®ç°å¤šä¸ª</td></tr><tr><td>å®ç°</td><td>å¯åŒ…å«å…·ä½“å®ç°</td><td>å¯åŒ…å«å…·ä½“å®ç°</td><td>åªå®šä¹‰å¥‘çº¦</td></tr><tr><td>æ„é€ å‡½æ•°</td><td>ä¸èƒ½æœ‰ï¼ˆé™¤æ— å‚ï¼‰</td><td>å¯ä»¥æœ‰</td><td>ä¸èƒ½æœ‰</td></tr><tr><td>å…³é”®å­—</td><td><code>with</code></td><td><code>extends</code></td><td><code>implements</code></td></tr></tbody></table>
<p><strong>è¯¦ç»†è¡¥å……ï¼š</strong><br/>
"Mixin å¼ºè°ƒçš„æ˜¯åŠŸèƒ½ç»„åˆï¼Œè®©ç±»è·å¾—æŸäº›èƒ½åŠ›ï¼›ç»§æ‰¿å¼ºè°ƒçš„æ˜¯çˆ¶å­å…³ç³»ï¼›æ¥å£å¼ºè°ƒçš„æ˜¯å¥‘çº¦å®ç°ã€‚Mixin æä¾›äº†æ¯”æ¥å£æ›´çµæ´»çš„å®ç°å¤ç”¨ï¼Œåˆé¿å…äº†ä¼ ç»Ÿå¤šç»§æ‰¿çš„å¤æ‚æ€§ã€‚"</p>
<h3 data-id="heading-20"><strong>3. Mixin çš„çº¿æ€§åŒ–é¡ºåºæ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ç¡®å®šï¼Ÿ</strong></h3>
<p><strong>ç²¾å‡†å›ç­”ï¼š</strong><br/>
"Mixin çš„çº¿æ€§åŒ–é¡ºåºéµå¾ªä»¥ä¸‹è§„åˆ™ï¼š</p>
<ol>
<li>ä»ç»§æ‰¿é“¾çš„æœ€é¡¶ç«¯å¼€å§‹</li>
<li>æŒ‰ç…§Â <code>with</code>Â å…³é”®å­—å Mixin çš„å£°æ˜é¡ºåºï¼Œä»å·¦åˆ°å³å¤„ç†</li>
<li>æœ€åæ··å…¥çš„ Mixin ä¼˜å…ˆçº§æœ€é«˜</li>
</ol>
<p><strong>çº¿æ€§åŒ–ç®—æ³•ï¼š</strong> Â æ·±åº¦ä¼˜å…ˆï¼Œä»å·¦åˆ°å³ï¼Œä¸é‡å¤ã€‚"</p>
<p><strong>ç¤ºä¾‹è¯´æ˜ï¼š</strong></p>
<p>dart</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">A</span> </span>{}
mixin <span class="hljs-type">B</span> {}
mixin <span class="hljs-type">C</span> {}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">D</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">A</span> <span class="hljs-keyword">with</span> <span class="hljs-title">B</span>, <span class="hljs-title">C</span> </span>{}
<span class="hljs-comment">// çº¿æ€§åŒ–é¡ºåºï¼šA â†’ B â†’ C â†’ D</span>
<span class="hljs-comment">// æ–¹æ³•æŸ¥æ‰¾é¡ºåºï¼šD â†’ C â†’ B â†’ A â†’ Object</span>
</code></pre>
<h3 data-id="heading-21"><strong>4. Mixin å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•å—ï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></h3>
<p><strong>ç²¾å‡†å›ç­”ï¼š</strong><br/>
"å¯ä»¥ã€‚Mixin ä¸­åŒ…å«æŠ½è±¡æ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯ï¼š</p>
<ol>
<li><strong>å¼ºåˆ¶çº¦æŸ</strong>ï¼šå¼ºåˆ¶æ··å…¥ç±»å¿…é¡»å®ç°æŸäº›æ–¹æ³•</li>
<li><strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong>ï¼šåœ¨ Mixin ä¸­å®šä¹‰ç®—æ³•éª¨æ¶ï¼ŒæŠ½è±¡æ–¹æ³•ç”±æ··å…¥ç±»å…·ä½“å®ç°</li>
<li><strong>ä¾èµ–æ³¨å…¥</strong>ï¼šè¦æ±‚å®¿ä¸»ç±»æä¾›å¿…è¦çš„ä¾èµ–æˆ–å®ç°"</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<p>dart</p>
<pre><code class="hljs language-arduino" lang="arduino">mixin ValidatorMixin {
  <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">validate</span><span class="hljs-params">(<span class="hljs-type">String</span> input)</span></span>; <span class="hljs-comment">// æŠ½è±¡æ–¹æ³•</span>
  <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">validateAndProcess</span><span class="hljs-params">(<span class="hljs-type">String</span> input)</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">validate</span>(input)) {
      <span class="hljs-comment">// å¤„ç†é€»è¾‘</span>
    }
  }
}
</code></pre>
<h3 data-id="heading-22"><strong>5.Â <code>on</code>Â å…³é”®å­—åœ¨ Mixin ä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</strong></h3>
<p><strong>ç²¾å‡†å›ç­”ï¼š</strong><br/>
"<code>on</code>Â å…³é”®å­—ç”¨äºé™åˆ¶ Mixin çš„ä½¿ç”¨èŒƒå›´ï¼Œç¡®ä¿ Mixin åªèƒ½ç”¨äºç‰¹å®šç±»å‹æˆ–å…¶å­ç±»ã€‚ä¸»è¦æœ‰ä¸¤ä¸ªä½œç”¨ï¼š</p>
<ol>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šé˜²æ­¢è¯¯ç”¨ï¼Œç¡®ä¿ Mixin åªåœ¨åˆé€‚çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨</li>
<li><strong>è®¿é—®å®¿ä¸»ç±»æˆå‘˜</strong>ï¼šå¯ä»¥å®‰å…¨åœ°è®¿é—®å®¿ä¸»ç±»çš„æ–¹æ³•å’Œå±æ€§"</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<p>dart</p>
<pre><code class="hljs language-csharp" lang="csharp">mixin Walker <span class="hljs-keyword">on</span> Animal {
  <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">walk</span>()</span> {
    move(); <span class="hljs-comment">// å¯ä»¥å®‰å…¨è°ƒç”¨ Animal çš„æ–¹æ³•</span>
  }
}
<span class="hljs-comment">// åªèƒ½ç”¨äº Animal åŠå…¶å­ç±»</span>
</code></pre>
<h3 data-id="heading-23"><strong>6. å¤šä¸ª Mixin æœ‰åŒåæ–¹æ³•æ—¶å¦‚ä½•è§£å†³å†²çªï¼Ÿ</strong></h3>
<p><strong>ç²¾å‡†å›ç­”ï¼š</strong><br/>
"Dart é€šè¿‡çº¿æ€§åŒ–é¡ºåºè§£å†³åŒåæ–¹æ³•å†²çªï¼š</p>
<ol>
<li><strong>æœ€åæ··å…¥çš„ä¼˜å…ˆçº§æœ€é«˜</strong>ï¼šçº¿æ€§åŒ–é“¾ä¸­é åçš„è¦†ç›–å‰é¢çš„</li>
<li><strong>å¯ä»¥ä½¿ç”¨Â <code>super</code></strong>ï¼šè°ƒç”¨çº¿æ€§åŒ–é“¾ä¸­ä¸‹ä¸€ä¸ªå®ç°</li>
<li><strong>å¯ä»¥é‡å†™è¦†ç›–</strong>ï¼šåœ¨å®¿ä¸»ç±»ä¸­é‡å†™æ–¹æ³•è¿›è¡Œç»Ÿä¸€å¤„ç†</li>
</ol>
<p>è¿™æ˜¯ç¼–è¯‘æ—¶ç¡®å®šçš„ï¼Œä¸ä¼šäº§ç”Ÿè¿è¡Œæ—¶æ­§ä¹‰ã€‚"</p>
<p><strong>å†²çªè§£å†³ç¤ºä¾‹ï¼š</strong></p>
<p>dart</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> <span class="hljs-keyword">with</span> <span class="hljs-title">A</span>, <span class="hljs-title">B</span> </span>{
  <span class="hljs-meta">@override</span>
  void conflictMethod() {
    <span class="hljs-comment">// è°ƒç”¨ç‰¹å®š Mixin çš„æ–¹æ³•</span>
    <span class="hljs-keyword">super</span>.conflictMethod(); <span class="hljs-comment">// è°ƒç”¨ B çš„å®ç°</span>
  }
}
</code></pre>
<h3 data-id="heading-24"><strong>7. Mixin å¯ä»¥æœ‰æ„é€ å‡½æ•°å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></h3>
<p><strong>ç²¾å‡†å›ç­”ï¼š</strong><br/>
"MixinÂ <strong>ä¸èƒ½å£°æ˜æœ‰å‚æ•°çš„æ„é€ å‡½æ•°</strong>ï¼Œåªèƒ½æœ‰é»˜è®¤çš„æ— å‚æ„é€ å‡½æ•°ã€‚è¿™æ˜¯å› ä¸ºï¼š</p>
<ol>
<li><strong>åˆå§‹åŒ–é¡ºåºé—®é¢˜</strong>ï¼šå¤šä¸ª Mixin çš„æ„é€ å‡½æ•°è°ƒç”¨é¡ºåºéš¾ä»¥ç¡®å®š</li>
<li><strong>ç®€åŒ–è®¾è®¡</strong>ï¼šé¿å…å¤æ‚çš„åˆå§‹åŒ–é€»è¾‘å†²çª</li>
<li><strong>èŒè´£åˆ†ç¦»</strong>ï¼šMixin åº”è¯¥ä¸“æ³¨äºåŠŸèƒ½å®ç°ï¼Œè€Œä¸æ˜¯å¯¹è±¡æ„å»º</li>
</ol>
<p>å¦‚æœéœ€è¦åˆå§‹åŒ–é€»è¾‘ï¼Œå¯ä»¥ä½¿ç”¨åˆå§‹åŒ–æ–¹æ³•é…åˆè°ƒç”¨ã€‚"</p>
<h3 data-id="heading-25"><strong>8. Mixin åœ¨å®é™…é¡¹ç›®ä¸­æœ‰å“ªäº›å…¸å‹åº”ç”¨åœºæ™¯ï¼Ÿ</strong></h3>
<p><strong>ç²¾å‡†å›ç­”ï¼ˆç»“åˆå®é™…ç»éªŒï¼‰ï¼š</strong><br/>
"åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä¸»è¦å°† Mixin ç”¨äºï¼š</p>
<ol>
<li>
<p><strong>æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆCross-cutting Concernsï¼‰</strong></p>
<ul>
<li>æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ã€å¼‚å¸¸å¤„ç†</li>
<li>æƒé™éªŒè¯ã€æ•°æ®æ ¡éªŒ</li>
</ul>
</li>
<li>
<p><strong>UI ç»„ä»¶åŠŸèƒ½ç»„åˆ</strong></p>
<p>dart</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Button</span> <span class="hljs-keyword">with</span> <span class="hljs-title">HoverEffect</span>, <span class="hljs-title">RippleEffect</span>, <span class="hljs-title">TooltipMixin</span> </span>{}
</code></pre>
</li>
<li>
<p><strong>æœåŠ¡å±‚åŠŸèƒ½å¢å¼º</strong></p>
<p>dart</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ApiService</span> <span class="hljs-keyword">with</span> <span class="hljs-title">CacheMixin</span>, <span class="hljs-title">RetryMixin</span>, <span class="hljs-title">LoggingMixin</span> </span>{}
</code></pre>
</li>
<li>
<p><strong>è®¾è®¡æ¨¡å¼å®ç°</strong></p>
<ul>
<li>è£…é¥°å™¨æ¨¡å¼ï¼šåŠ¨æ€æ·»åŠ åŠŸèƒ½</li>
<li>ç­–ç•¥æ¨¡å¼ï¼šç®—æ³•åˆ‡æ¢"</li>
</ul>
</li>
</ol>
<h3 data-id="heading-26"><strong>9. Mixin çš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</strong></h3>
<p><strong>ç²¾å‡†å›ç­”ï¼š</strong><br/>
<strong>ä¼˜ç‚¹ï¼š</strong></p>
<ol>
<li><strong>çµæ´»å¤ç”¨</strong>ï¼šçªç ´å•ç»§æ‰¿é™åˆ¶</li>
<li><strong>æ¨¡å—åŒ–</strong>ï¼šåŠŸèƒ½åˆ†ç¦»ï¼ŒèŒè´£å•ä¸€</li>
<li><strong>é¿å…é‡å¤</strong>ï¼šDRY åŸåˆ™</li>
<li><strong>ç»„åˆä¼˜äºç»§æ‰¿</strong>ï¼šæ›´çµæ´»çš„è®¾è®¡</li>
</ol>
<p><strong>ç¼ºç‚¹ï¼š</strong></p>
<ol>
<li><strong>ç†è§£æˆæœ¬</strong>ï¼šçº¿æ€§åŒ–é¡ºåºéœ€è¦ç†è§£</li>
<li><strong>è°ƒè¯•å›°éš¾</strong>ï¼šè°ƒç”¨é“¾å¯èƒ½å¾ˆæ·±</li>
<li><strong>å‘½åå†²çª</strong>ï¼šéœ€è¦åˆç†è®¾è®¡</li>
<li><strong>è¿‡åº¦ä½¿ç”¨é£é™©</strong>ï¼šå¯èƒ½å¯¼è‡´ "ç‘å£«å†›åˆ€" ç±»</li>
</ol>
<h3 data-id="heading-27"><strong>10. ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ Mixinï¼Ÿä»€ä¹ˆæ—¶å€™ä¸åº”è¯¥ä½¿ç”¨ï¼Ÿ</strong></h3>
<p><strong>ç²¾å‡†å›ç­”ï¼š</strong><br/>
"<strong>åº”è¯¥ä½¿ç”¨ Mixin çš„æƒ…å†µï¼š</strong></p>
<ol>
<li>éœ€è¦æ¨ªå‘å¤ç”¨åŠŸèƒ½æ—¶</li>
<li>åŠŸèƒ½ç›¸å¯¹ç‹¬ç«‹ï¼Œä¸ä¾èµ–è¿‡å¤šä¸Šä¸‹æ–‡</li>
<li>å¤šä¸ªç±»éœ€è¦ç›¸åŒåŠŸèƒ½ä½†ç±»å‹å±‚æ¬¡ä¸åŒæ—¶</li>
<li>éœ€è¦åŠ¨æ€ç»„åˆåŠŸèƒ½æ—¶</li>
</ol>
<p><strong>ä¸åº”è¯¥ä½¿ç”¨ Mixin çš„æƒ…å†µï¼š</strong></p>
<ol>
<li>åŠŸèƒ½ä¹‹é—´æœ‰å¼ºè€¦åˆæ—¶</li>
<li>éœ€è¦åˆå§‹åŒ–å¤æ‚çŠ¶æ€æ—¶</li>
<li>åŠŸèƒ½æ˜¯ç±»çš„æ ¸å¿ƒèŒè´£æ—¶ï¼ˆåº”è¯¥ç”¨ç»§æ‰¿ï¼‰</li>
<li>ç®€å•çš„å·¥å…·æ–¹æ³•ï¼ˆè€ƒè™‘ç”¨æ‰©å±•æ–¹æ³•ï¼‰"</li>
</ol>
<h3 data-id="heading-28"><strong>11. Mixin å’Œæ‰©å±•æ–¹æ³•ï¼ˆExtension Methodsï¼‰æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</strong></h3>
<p><strong>ç²¾å‡†å›ç­”ï¼š</strong><br/>
"ä¸¤è€…éƒ½ç”¨äºæ‰©å±•ç±»å‹åŠŸèƒ½ï¼Œä½†é€‚ç”¨åœºæ™¯ä¸åŒï¼š</p>






























<table><thead><tr><th>æ–¹é¢</th><th>Mixin</th><th>æ‰©å±•æ–¹æ³•</th></tr></thead><tbody><tr><td>ä½œç”¨åŸŸ</td><td>ç±»å†…éƒ¨</td><td>ç±»å¤–éƒ¨</td></tr><tr><td>è®¿é—®æƒé™</td><td>å¯è®¿é—®ç§æœ‰æˆå‘˜</td><td>åªèƒ½è®¿é—®å…¬å¼€æˆå‘˜</td></tr><tr><td>é€‚ç”¨æ€§</td><td>éœ€è¦çŠ¶æ€æ—¶</td><td>çº¯å‡½æ•°æ“ä½œæ—¶</td></tr><tr><td>ä½¿ç”¨æ–¹å¼</td><td><code>with</code>Â å…³é”®å­—</td><td><code>extension</code>Â å…³é”®å­—</td></tr></tbody></table>
<p>æ‰©å±•æ–¹æ³•é€‚åˆä¸ºç°æœ‰ç±»æ·»åŠ é™æ€å·¥å…·æ–¹æ³•ï¼ŒMixin é€‚åˆä¸ºç±»æ·»åŠ æœ‰çŠ¶æ€çš„å¤æ‚åŠŸèƒ½ã€‚"</p>
<h3 data-id="heading-29"><strong>12. å¦‚ä½•å¤„ç† Mixin ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Ÿ</strong></h3>
<p><strong>ç²¾å‡†å›ç­”ï¼š</strong><br/>
"å¤„ç† Mixin ä¾èµ–å…³ç³»çš„å‡ ç§ç­–ç•¥ï¼š</p>
<ol>
<li><strong>ä½¿ç”¨Â <code>on</code>Â é™åˆ¶</strong>ï¼šç¡®ä¿ Mixin åªåœ¨åˆé€‚çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨</li>
<li><strong>æ¥å£æŠ½è±¡</strong>ï¼šé€šè¿‡æŠ½è±¡æ–¹æ³•å®šä¹‰ä¾èµ–å¥‘çº¦</li>
<li><strong>ç»„åˆæ¨¡å¼</strong>ï¼šè®©ä¸€ä¸ª Mixin ä¾èµ–å¦ä¸€ä¸ª Mixin</li>
<li><strong>ä¾èµ–æŸ¥æ‰¾</strong>ï¼šé€šè¿‡æœåŠ¡å®šä½å™¨è·å–ä¾èµ–</li>
</ol>
<p><strong>æœ€ä½³å®è·µï¼š</strong> Â ä¿æŒ Mixin å°½å¯èƒ½ç‹¬ç«‹ï¼Œä¾èµ–é€šè¿‡æŠ½è±¡å®šä¹‰ã€‚"</p>
<h3 data-id="heading-30"><strong>é«˜çº§é¢è¯•é—®é¢˜å›ç­”æŠ€å·§</strong></h3>
<h4 data-id="heading-31"><strong>æŠ€æœ¯æ·±åº¦å±•ç¤ºï¼š</strong></h4>
<p>å½“è¢«é—®åˆ°å¤æ‚é—®é¢˜æ—¶ï¼Œå±•ç¤ºå¯¹åº•å±‚æœºåˆ¶çš„ç†è§£ï¼š</p>
<p><strong>ç¤ºä¾‹å›ç­”ï¼š</strong><br/>
"Mixin çš„çº¿æ€§åŒ–æœºåˆ¶å®é™…ä¸Šæ˜¯ç¼–è¯‘æ—¶è¿›è¡Œçš„ï¼ŒDart ç¼–è¯‘å™¨ä¼šç”Ÿæˆä¸€ä¸ªçº¿æ€§çš„ç±»å±‚æ¬¡ç»“æ„ã€‚ä»å®ç°è§’åº¦çœ‹ï¼ŒMixin ä¼šè¢«ç¼–è¯‘ä¸ºæ™®é€šçš„ç±»ï¼Œç„¶åé€šè¿‡ä»£ç†æ¨¡å¼å°†æ–¹æ³•è°ƒç”¨è½¬å‘åˆ°æ­£ç¡®çš„å®ç°ã€‚"</p>
<h4 data-id="heading-32"><strong>ç»“åˆå®é™…é¡¹ç›®ï¼š</strong></h4>
<p>"åœ¨æˆ‘ä¹‹å‰çš„ç”µå•†é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Mixin å®ç°äº†è´­ç‰©è½¦çš„å„ç§è¡Œä¸ºï¼š</p>
<ul>
<li><code>WithCacheMixin</code>ï¼šç¼“å­˜å•†å“ä¿¡æ¯</li>
<li><code>WithValidationMixin</code>ï¼šéªŒè¯åº“å­˜å’Œä»·æ ¼</li>
<li><code>WithAnalyticsMixin</code>ï¼šè®°å½•ç”¨æˆ·è¡Œä¸º<br/>
è¿™æ ·æ¯ä¸ªä¸šåŠ¡æ¨¡å—éƒ½å¯ä»¥æŒ‰éœ€ç»„åˆåŠŸèƒ½ã€‚"</li>
</ul>
<h4 data-id="heading-33"><strong>å±•ç¤ºè®¾è®¡æ€è€ƒï¼š</strong></h4>
<p>"åœ¨è®¾è®¡ Mixin æ—¶ï¼Œæˆ‘éµå¾ª SOLID åŸåˆ™ï¼š</p>
<ul>
<li><strong>å•ä¸€èŒè´£</strong>ï¼šæ¯ä¸ª Mixin åªåšä¸€ä»¶äº‹</li>
<li><strong>å¼€é—­åŸåˆ™</strong>ï¼šé€šè¿‡ Mixin æ‰©å±•è€Œéä¿®æ”¹</li>
<li><strong>æ¥å£éš”ç¦»</strong>ï¼šå®šä¹‰æ¸…æ™°çš„æŠ½è±¡æ–¹æ³•</li>
<li><strong>ä¾èµ–å€’ç½®</strong>ï¼šä¾èµ–æŠ½è±¡è€Œéå…·ä½“å®ç°"</li>
</ul>
<h3 data-id="heading-34"><strong>å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ</strong></h3>
<h4 data-id="heading-35"><strong>é™·é˜± 1ï¼šçŠ¶æ€å…±äº«é—®é¢˜</strong></h4>
<p><strong>é—®é¢˜ï¼š</strong> Â "å¤šä¸ªç±»æ··å…¥åŒä¸€ä¸ª Mixin ä¼šå…±äº«çŠ¶æ€å—ï¼Ÿ"</p>
<p><strong>å›ç­”ï¼š</strong> Â "ä¸ä¼šã€‚æ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„ Mixin çŠ¶æ€å‰¯æœ¬ã€‚Mixin ä¸­çš„å­—æ®µåœ¨ç¼–è¯‘æ—¶ä¼šå¤åˆ¶åˆ°å®¿ä¸»ç±»ä¸­ï¼Œæ¯ä¸ªå®ä¾‹ç‹¬ç«‹ã€‚"</p>
<h4 data-id="heading-36"><strong>é™·é˜± 2ï¼šåˆå§‹åŒ–é¡ºåº</strong></h4>
<p><strong>é—®é¢˜ï¼š</strong> Â "å¦‚æœå¤šä¸ª Mixin éƒ½éœ€è¦åˆå§‹åŒ–æ€ä¹ˆåŠï¼Ÿ"</p>
<p><strong>å›ç­”ï¼š</strong> Â "ä½¿ç”¨åˆå§‹åŒ–æ–¹æ³•æ¨¡å¼ï¼š</p>
<p>dart</p>
<pre><code class="hljs language-scala" lang="scala">mixin <span class="hljs-type">Initializable</span> {
  void initialize() {
    <span class="hljs-comment">// åˆå§‹åŒ–é€»è¾‘</span>
  }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyClass</span> <span class="hljs-keyword">with</span> <span class="hljs-title">A</span>, <span class="hljs-title">B</span> </span>{
  void init() {
    <span class="hljs-comment">// æŒ‰éœ€è°ƒç”¨åˆå§‹åŒ–</span>
    (<span class="hljs-keyword">this</span> as <span class="hljs-type">A</span>).initialize();
    (<span class="hljs-keyword">this</span> as <span class="hljs-type">B</span>).initialize();
  }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é˜¿é‡ŒZ-Imageå›¾åƒç”Ÿæˆæ¨¡å‹å®¹å™¨éƒ¨ç½²]]></title>    <link>https://juejin.cn/post/7585412203979161643</link>    <guid>https://juejin.cn/post/7585412203979161643</guid>    <pubDate>2025-12-20T10:32:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585412203979161643" data-draft-id="7585490245006147590" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é˜¿é‡ŒZ-Imageå›¾åƒç”Ÿæˆæ¨¡å‹å®¹å™¨éƒ¨ç½²"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-20T10:32:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PetterHillWater"/> <meta itemprop="url" content="https://juejin.cn/user/4088451358280841"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é˜¿é‡ŒZ-Imageå›¾åƒç”Ÿæˆæ¨¡å‹å®¹å™¨éƒ¨ç½²
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4088451358280841/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PetterHillWater
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T10:32:05.000Z" title="Sat Dec 20 2025 10:32:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fwintersun%2Fp%2F19376166" target="_blank" title="https://www.cnblogs.com/wintersun/p/19376166" ref="nofollow noopener noreferrer">é˜¿é‡ŒZ-Imageå›¾åƒç”Ÿæˆæ¨¡å‹å®¹å™¨éƒ¨ç½²</a></strong></p>
<h2 data-id="heading-0">èƒŒæ™¯</h2>
<p>Â Â Â Â Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTongyi-MAI%2FZ-Image" target="_blank" title="https://github.com/Tongyi-MAI/Z-Image" ref="nofollow noopener noreferrer">Z-Image</a>æ˜¯é˜¿é‡Œå·´å·´é€šä¹‰å®éªŒå®¤å¼€å‘çš„ä¸€æ¬¾<strong>å¼€æºå›¾åƒç”Ÿæˆæ¨¡å‹ï¼Œ</strong>Â è¯¦ç»†ä»‹ç»“å¯ä»¥çœ‹è¿™å„¿ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fwintersun%2Fp%2F19290582" target="_blank" title="https://www.cnblogs.com/wintersun/p/19290582" ref="nofollow noopener noreferrer">Z-Imageå›¾åƒç”Ÿæˆæ¨¡å‹å‘å¸ƒä¸ç«å“</a>ã€‹ã€‚Z-Imageç³»åˆ—é«˜æ€§èƒ½ç”Ÿæˆæ¨¡å‹ï¼Œå…¶ä¸­åŒ…æ‹¬ç”¨äºå¿«é€Ÿæ¨ç†çš„Z-Image-Turboå’Œä¸“ä¸šçš„å›¾åƒç¼–è¾‘æ¨¡å‹Z-Image-Editã€‚è¿™äº›æ¨¡å‹åŸºäºå¯æ‰©å±•å•æµæ‰©æ•£è½¬æ¢å™¨ (S3-DiT) æ¶æ„æ„å»ºï¼Œå¼ºè°ƒé€šè¿‡ä¼˜åŒ–è®¾è®¡å®ç°æé«˜çš„è®­ç»ƒæ•ˆç‡å’Œä½è®¡ç®—æˆæœ¬ã€‚å…¶æ ¸å¿ƒæ–¹æ³•è®ºä¾èµ–äºå…ˆè¿›çš„æ•°æ®åŸºç¡€è®¾æ–½ï¼ŒåŒ…æ‹¬ä½¿ç”¨ä¸»åŠ¨ç­–å±•å¼•æ“ (Active Curation Engine) æ¥ç¡®ä¿æ•°æ®è´¨é‡å¹¶è§£å†³é•¿å°¾æ¦‚å¿µé—®é¢˜ã€‚è®­ç»ƒæµç¨‹ç»“åˆäº†é«˜æ•ˆçš„å‡ æ­¥è’¸é¦æŠ€æœ¯å’Œå¤šé˜¶æ®µçš„äººç±»åé¦ˆå¼ºåŒ–å­¦ä¹  (RLHF) æ¡†æ¶ï¼Œä»¥æ›´å¥½åœ°ç¬¦åˆäººç±»åå¥½å’ŒæŒ‡ä»¤ã€‚æ­¤å¤–ï¼ŒæŠ¥å‘Šé‡ç‚¹å±•ç¤ºäº†æ¨¡å‹åˆ©ç”¨æç¤ºå¢å¼ºå™¨ (PE) æ¨¡å—æ³¨å…¥ä¸–ç•ŒçŸ¥è¯†å’Œé€»è¾‘æ¨ç†èƒ½åŠ›çš„åŠŸèƒ½ï¼Œä»è€Œæå‡äº†å¯¹å¤æ‚ç”¨æˆ·æç¤ºçš„ç†è§£ã€‚å®šé‡å’Œå®šæ€§è¯„ä¼°ç»“æœè¡¨æ˜ï¼Œè¯¥æ¨¡å‹åœ¨ç…§ç‰‡çº§çœŸå®æ„Ÿç”Ÿæˆå’Œå‡†ç¡®çš„ä¸­è‹±åŒè¯­æ–‡æœ¬æ¸²æŸ“æ–¹é¢å‡å–å¾—äº†è¡Œä¸šé¢†å…ˆçš„æ€§èƒ½ã€‚</p>
<p><strong>å·²æ„å»ºå¥½çš„docker image</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/993530fe560b43ccaf1fb5fee83a7351~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGV0dGVySGlsbFdhdGVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831524&amp;x-signature=8ul5qQmcEmztCoYiZs%2BRHQR7zA4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">åç«¯é•œåƒ</h2>
<p><code>docker pull registry.cn-hangzhou.aliyuncs.com/megadotnet/z-image-turbo-backend:v0</code></p>
<p>14.3GB</p>
<p><strong>å‰ç«¯é•œåƒ</strong></p>
<p><code>registry.cn-hangzhou.aliyuncs.com/megadotnet/z-image-turbo-frontend:v1</code></p>
<p><strong>æ„å»ºè¿‡ç¨‹</strong></p>
<p><strong>åŸºç¡€é•œåƒå‡†å¤‡</strong></p>
<pre><code class="hljs language-js" lang="js">docker pull registry.<span class="hljs-property">cn</span>-hangzhou.<span class="hljs-property">aliyuncs</span>.<span class="hljs-property">com</span>/megadotnet/nvidia.<span class="hljs-property">cuda</span>:<span class="hljs-number">12.4</span><span class="hljs-number">.1</span>-devel-ubuntu22<span class="hljs-number">.04</span> &amp;&amp; docker tag registry.<span class="hljs-property">cn</span>-hangzhou.<span class="hljs-property">aliyuncs</span>.<span class="hljs-property">com</span>/megadotnet/nvidia.<span class="hljs-property">cuda</span>:<span class="hljs-number">12.4</span><span class="hljs-number">.1</span>-devel-ubuntu22<span class="hljs-number">.04</span> nvidia/<span class="hljs-attr">cuda</span>:<span class="hljs-number">12.4</span><span class="hljs-number">.1</span>-devel-ubuntu22<span class="hljs-number">.04</span>


docker pull registry.<span class="hljs-property">cn</span>-hangzhou.<span class="hljs-property">aliyuncs</span>.<span class="hljs-property">com</span>/megadotnet/<span class="hljs-attr">node</span>:<span class="hljs-number">18</span>-alpine &amp;&amp; docker tag registry.<span class="hljs-property">cn</span>-hangzhou.<span class="hljs-property">aliyuncs</span>.<span class="hljs-property">com</span>/megadotnet/<span class="hljs-attr">node</span>:<span class="hljs-number">18</span>-alpine <span class="hljs-attr">node</span>:<span class="hljs-number">18</span>-alpine

docker pull registry.<span class="hljs-property">cn</span>-hangzhou.<span class="hljs-property">aliyuncs</span>.<span class="hljs-property">com</span>/megadotnet/<span class="hljs-attr">nginx</span>:alpine &amp;&amp; docker tag registry.<span class="hljs-property">cn</span>-hangzhou.<span class="hljs-property">aliyuncs</span>.<span class="hljs-property">com</span>/megadotnet/<span class="hljs-attr">nginx</span>:alpine <span class="hljs-attr">nginx</span>:alpine
</code></pre>
<h2 data-id="heading-2">åç«¯æ„å»º</h2>
<pre><code class="hljs language-js" lang="js">cd backend

docker build -t z-image-turbo-backend .
</code></pre>
<p>æ‰“tag</p>
<pre><code class="hljs language-js" lang="js">docker tag z-image-turbo-backend registry.<span class="hljs-property">cn</span>-hangzhou.<span class="hljs-property">aliyuncs</span>.<span class="hljs-property">com</span>/megadotnet/z-image-turbo-<span class="hljs-attr">backend</span>:v0

docker push registry.<span class="hljs-property">cn</span>-hangzhou.<span class="hljs-property">aliyuncs</span>.<span class="hljs-property">com</span>/megadotnet/z-image-turbo-<span class="hljs-attr">backend</span>:v0

</code></pre>
<h2 data-id="heading-3">æ³¨æ„äº‹é¡¹</h2>
<p>1. ç¬”è€…åœ¨æ²¡æœ‰RTX 3060æ˜¾å¡çš„æœåŠ¡å™¨ä¸Šæ„å»ºæ—¶ï¼Œé»˜è®¤ç‰ˆæœ¬torch==2.7.1æ˜¯å¤±è´¥çš„ã€‚æ„å»ºæ²¡æœ‰æŠ¥é”™é€€å‡ºï¼ˆè¯´æ˜ 21GB å†…å­˜æš‚æ—¶é¡¶ä½äº† OOM å´©æºƒï¼‰ï¼Œä½†æ˜¯å¡åœ¨ Building wheel for flash-attn è¿™ä¸€æ­¥å·²ç»æ¥è¿‘ 90 åˆ†é’Ÿã€‚ä½¿ç”¨äº†Â MAX_JOBS=4ã€‚ç¼–è¯‘ Flash Attention æ—¶ï¼Œæ¯ä¸ª C++ ç¼–è¯‘è¿›ç¨‹åœ¨å³°å€¼æ—¶å¯èƒ½æ¶ˆè€— 5GB-6GB å†…å­˜ã€‚4 ä¸ªè¿›ç¨‹å¹¶å‘å¯èƒ½éœ€è¦ 20GB-24GB çš„ç¬æ—¶å†…å­˜ã€‚åä¿®æ”¹Dockerfileé™ä½ç‰ˆæœ¬</p>
<pre><code class="hljs language-js" lang="js">
\# -----------------------------------------------------------------------------

\# \[ä¿®å¤æ­¥éª¤\] åˆ†æ­¥å®‰è£…ä»¥è§£å†³æºæ‰¾ä¸åˆ°çš„é—®é¢˜

\# -----------------------------------------------------------------------------

\# ç¬¬ä¸€æ­¥ï¼šä½¿ç”¨é˜¿é‡Œäº‘é•œåƒå®‰è£…é€šç”¨ä¾èµ– (ninja, packaging)

<span class="hljs-variable constant_">RUN</span> pip install --no-cache-dir packaging ninja

\# ç¬¬äºŒæ­¥ï¼šä½¿ç”¨ <span class="hljs-title class_">PyTorch</span> å®˜æ–¹æºå®‰è£… <span class="hljs-title class_">Torch</span> å…¨å®¶æ¡¶ (æŒ‡å®š --index-url)

<span class="hljs-variable constant_">RUN</span> pip install --no-cache-dir <span class="hljs-string">"torch==2.5.1"</span> <span class="hljs-string">"torchvision==0.20.1"</span> <span class="hljs-string">"torchaudio==2.5.1"</span> --index-urlÂ <span class="hljs-attr">https</span>:<span class="hljs-comment">//download.pytorch.org/whl/cu124</span>
</code></pre>
<p>2.å¯¹äº PyTorch è¿™ç§åŠ¨è¾„ 2GB+ çš„åº“ï¼Œå¿…é¡»åŠ  --no-cache-dir</p>
<p>3. MAX_JOBS=1 å¯ä»¥æ ¹æ®å½“å‰æœåŠ¡å™¨ç¡¬ä»¶é…ç½®è°ƒæ•´</p>
<p>4.å¦‚æœä¸€ä¸ªå‘½ä»¤æ—¢éœ€è¦å®˜æ–¹æºçš„åŒ…ï¼ˆTorchï¼‰ï¼Œåˆéœ€è¦é€šç”¨åŒ…ï¼ˆNinjaï¼‰ï¼Œè¯·æ‹†åˆ†æˆä¸¤æ¡ RUN æŒ‡ä»¤ã€‚</p>
<p>5.æœå¿…é¡»ç¼–è¯‘ï¼Œå…ˆå°†å¹¶å‘é™ä¸º 1ã€‚å¦‚æœä¾ç„¶ OOMï¼Œè¯´æ˜éœ€è¦å¢åŠ ç‰©ç†å†…å­˜æˆ– Swapï¼Œæˆ–è€…å¯»æ‰¾é¢„ç¼–è¯‘åŒ…ï¼ˆæœ€ä½³æ–¹æ¡ˆï¼‰ã€‚</p>















































<table><thead><tr><th/><th/><th/><th/></tr></thead><tbody><tr><td><strong>åºå·</strong></td><td><strong>éšœç¢ç°è±¡</strong></td><td><strong>æ ¹æœ¬åŸå› </strong></td><td><strong>æœ€ç»ˆè§£å†³æ–¹æ¡ˆ</strong></td></tr><tr><td><strong>1</strong></td><td><strong>æ„å»ºæ— é™ç­‰å¾…</strong></td><td><strong>ç½‘ç»œå¢™</strong>ï¼šå›½å†…ç›´è¿ Ubuntu/PyPI å®˜æ–¹æºææ…¢ã€‚</td><td><strong>æ¢æº</strong>ï¼šæ›¿æ¢ Apt å’Œ Pip ä¸ºé˜¿é‡Œäº‘é•œåƒã€‚</td></tr><tr><td><strong>2</strong></td><td><strong>No space left</strong></td><td><strong>ç£ç›˜è€—å°½</strong>ï¼šPyTorch åŒ…å·¨å¤§ï¼Œpip ç¼“å­˜+è§£å‹å æ»¡æ ¹åˆ†åŒºã€‚</td><td><strong>ç˜¦èº«</strong>ï¼šå¢åŠ  --no-cache-dir ç¦ç”¨ç¼“å­˜ã€‚</td></tr><tr><td><strong>3</strong></td><td><strong>AttributeError</strong></td><td><strong>ç¯å¢ƒå…¼å®¹</strong>ï¼šUbuntu ç³»ç»Ÿè‡ªå¸¦æ—§ç‰ˆ setuptools ä¸æ”¯æŒæ–° PEP æ ‡å‡†ã€‚</td><td><strong>å‡çº§</strong>ï¼šå¼ºåˆ¶å‡çº§ pip setuptools wheelã€‚</td></tr><tr><td><strong>4</strong></td><td><strong>Killed (OOM)</strong></td><td><strong>å†…å­˜æº¢å‡º</strong>ï¼štorch 2.7.1 (é¢„è§ˆç‰ˆ) æ— é¢„ç¼–è¯‘åŒ…ï¼Œè§¦å‘æºç ç¼–è¯‘ï¼Œè€—å°½å†…å­˜ã€‚</td><td><strong>é™çº§</strong>ï¼š<strong>å›é€€åˆ° torch 2.5.1 (ç¨³å®šç‰ˆ)</strong>ï¼Œç›´æ¥ä½¿ç”¨å®˜æ–¹ .whl åŒ…ã€‚</td></tr><tr><td><strong>5</strong></td><td><strong>Ninja not found</strong></td><td><strong>æºå†²çª</strong>ï¼šæŒ‡å®š --index-url ä¸º PyTorch åï¼Œpip æ‰¾ä¸åˆ°é€šç”¨åº“ã€‚</td><td><strong>åˆ†æ­¥</strong>ï¼šå…ˆç”¨é˜¿é‡Œæºè£…å·¥å…·ï¼Œå†ç”¨å®˜æ–¹æºè£… Torchã€‚</td></tr></tbody></table>
<h2 data-id="heading-4">å‰ç«¯æ„å»º</h2>
<pre><code class="hljs language-js" lang="js">cd frontend

docker build -t z-image-turbo-frontend .

docker tag z-image-turbo-frontend registry.<span class="hljs-property">cn</span>-hangzhou.<span class="hljs-property">aliyuncs</span>.<span class="hljs-property">com</span>/megadotnet/z-image-turbo-<span class="hljs-attr">frontend</span>:v1

docker push registry.<span class="hljs-property">cn</span>-hangzhou.<span class="hljs-property">aliyuncs</span>.<span class="hljs-property">com</span>/megadotnet/z-image-turbo-<span class="hljs-attr">frontend</span>:v1
</code></pre>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-js" lang="js">
docker run --gpus all -p <span class="hljs-number">8000</span>:<span class="hljs-number">8000</span> z-image-turbo-backend

docker run -p <span class="hljs-number">3000</span>:<span class="hljs-number">3000</span> -d z-image-turbo-frontend
</code></pre>
<p>å‰ç«¯æ•ˆæœ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89eb5c3c267c4fec967a73a8cf27034d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGV0dGVySGlsbFdhdGVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831524&amp;x-signature=wDARPxopMkrynKYEqae8uMA5HqE%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eda147b3061843e4bcfcd4eb942fd540~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGV0dGVySGlsbFdhdGVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831524&amp;x-signature=3lxNAxZgDKhC%2F1Yk6ueRZ3b46Lc%3D" alt="image.png" loading="lazy"/></p>
<p><strong>æœ€åé•œåƒåˆ—è¡¨</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80384308901b464aabe198813eb29acf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGV0dGVySGlsbFdhdGVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831524&amp;x-signature=om9VeXuzhnQmMXAkWmJFPuI6I38%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">DeepWikiä¼˜åŒ–åç«¯Dockerfileç‰ˆæœ¬##</h2>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-variable constant_">FROM</span> nvidia/<span class="hljs-attr">cuda</span>:<span class="hljs-number">12.4</span><span class="hljs-number">.1</span>-cudnn-devel-ubuntu22<span class="hljs-number">.04</span>

<span class="hljs-variable constant_">ENV</span> <span class="hljs-variable constant_">DEBIAN_FRONTEND</span>=noninteractive

<span class="hljs-variable constant_">ENV</span> <span class="hljs-variable constant_">PYTHONUNBUFFERED</span>=<span class="hljs-number">1</span>

<span class="hljs-variable constant_">ENV</span> <span class="hljs-variable constant_">FLASH_ATTENTION_FORCE_COMPILE</span>=<span class="hljs-literal">true</span>

\# æ›¿æ¢<span class="hljs-title class_">Apt</span>æºå¹¶å®‰è£…ç³»ç»Ÿä¾èµ–

<span class="hljs-variable constant_">RUN</span> sed -i <span class="hljs-string">'s/archive.ubuntu.com/mirrors.aliyun.com/g'</span> /etc/apt/sources.<span class="hljs-property">list</span> &amp;&amp; \\

sed -i <span class="hljs-string">'s/security.ubuntu.com/mirrors.aliyun.com/g'</span> /etc/apt/sources.<span class="hljs-property">list</span> &amp;&amp; \\

apt-get update &amp;&amp; apt-get install -y \\

software-properties-common \\

git \\

ninja-build \\

curl \\

ca-certificates \\

python3<span class="hljs-number">.11</span> \\

python3<span class="hljs-number">.11</span>-dev \\

python3<span class="hljs-number">.11</span>-distutils \\

python3-pip \\

&amp;&amp; rm -rf /<span class="hljs-keyword">var</span>/lib/apt/lists/\* \\

&amp;&amp; ln -sf /usr/bin/python3<span class="hljs-number">.11</span> /usr/bin/python \\

&amp;&amp; ln -sf /usr/bin/python3<span class="hljs-number">.11</span> /usr/bin/python3

<span class="hljs-variable constant_">WORKDIR</span> /app

\# é…ç½®<span class="hljs-title class_">Pip</span>é•œåƒæº

<span class="hljs-variable constant_">RUN</span> pip config set <span class="hljs-variable language_">global</span>.<span class="hljs-property">index</span>-url <span class="hljs-attr">https</span>:<span class="hljs-comment">//mirrors.aliyun.com/pypi/simple/ &amp;&amp; \\</span>

pip config set <span class="hljs-variable language_">global</span>.<span class="hljs-property">trusted</span>-host mirrors.<span class="hljs-property">aliyun</span>.<span class="hljs-property">com</span>

\# å‡çº§pipå·¥å…·

<span class="hljs-variable constant_">RUN</span> pip install --no-cache-dir --upgrade pip setuptools wheel

\# å®‰è£…æ ¸å¿ƒä¾èµ–

<span class="hljs-variable constant_">RUN</span> pip install --no-cache-dir packaging ninja &amp;&amp; \\

pip install --no-cache-dir <span class="hljs-string">"torch==2.5.1"</span> <span class="hljs-string">"torchvision==0.20.1"</span> <span class="hljs-string">"torchaudio==2.5.1"</span> --index-url <span class="hljs-attr">https</span>:<span class="hljs-comment">//download.pytorch.org/whl/cu124 &amp;&amp; \\</span>

pip install --no-cache-dir <span class="hljs-string">"flash-attn&gt;=2.6.3"</span> --no-build-isolation

\# å®‰è£…diffuserså’Œé¡¹ç›®ä¾èµ–

<span class="hljs-variable constant_">RUN</span> pip install --no-cache-dir git+<span class="hljs-attr">https</span>:<span class="hljs-comment">//github.com/huggingface/diffusers.git</span>

<span class="hljs-variable constant_">COPY</span> requirements.<span class="hljs-property">txt</span> .

<span class="hljs-variable constant_">RUN</span> pip install --no-cache-dir -r requirements.<span class="hljs-property">txt</span>

\# å¤åˆ¶åº”ç”¨ä»£ç 

<span class="hljs-variable constant_">COPY</span> . .

<span class="hljs-variable constant_">EXPOSE</span> <span class="hljs-number">8000</span>

<span class="hljs-variable constant_">CMD</span> \[<span class="hljs-string">"uvicorn"</span>, <span class="hljs-string">"main:app"</span>, <span class="hljs-string">"--host"</span>, <span class="hljs-string">"0.0.0.0"</span>, <span class="hljs-string">"--port"</span>, <span class="hljs-string">"8000"</span>\]
</code></pre>
<ol>
<li>é•œåƒæºä¼˜åŒ–ï¼šæ‚¨ä½¿ç”¨çš„é˜¿é‡Œäº‘é•œåƒæºåœ¨ä¸­å›½å¤§é™†åœ°åŒºç¡®å®èƒ½æ˜¾è‘—æå‡ä¸‹è½½é€Ÿåº¦</li>
<li>Flash Attentionï¼šç¡®ä¿GPUå…¼å®¹æ€§ï¼Œä¸å…¼å®¹çš„GPUå¯èƒ½å¯¼è‡´å®‰è£…å¤±è´¥ README.md</li>
<li>æ„å»ºç¼“å­˜ï¼š--no-cache-diré€‰é¡¹èƒ½å‡å°‘é•œåƒå¤§å°ï¼Œä½†ä¼šå¤±å»pipç¼“å­˜ä¼˜åŠ¿</li>
<li>requirements.txtï¼šä»£ç åº“ä¸­æœªæä¾›æ­¤æ–‡ä»¶ï¼Œè¯·ç¡®ä¿åŒ…å«Z-Imageæ‰€éœ€çš„æ‰€æœ‰ä¾èµ–ã€‚</li>
</ol>
<h2 data-id="heading-6">æ€»ç»“</h2>
<p>Â Â Â Â  Z-Imageæ˜¯é˜¿é‡Œå·´å·´é€šä¹‰å®éªŒå®¤å¼€å‘çš„å¼€æºå›¾åƒç”Ÿæˆæ¨¡å‹ï¼Œæœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†å…¶Dockeré•œåƒçš„æ„å»ºè¿‡ç¨‹ã€æ³¨æ„äº‹é¡¹åŠè§£å†³æ–¹æ¡ˆã€‚å¦‚æœä¸æƒ³æœ¬åœ°éƒ¨ç½²ï¼Œåœ¨çº¿æµ‹è¯•å¯ä»¥ç”¨è¿™å„¿ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhuggingface.co%2Fspaces%2FTongyi-MAI%2FZ-Image-Turbo" target="_blank" title="https://huggingface.co/spaces/Tongyi-MAI/Z-Image-Turbo" ref="nofollow noopener noreferrer">huggingface.co/spaces/Tongâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenTortoiseï¼šå¼€ç®±å³ç”¨çš„Javaè°ƒç”¨LLMä¸­é—´ä»¶ï¼Œä¸€ç«™å¼è§£å†³é…ç½®ã€è°ƒç”¨ã€æˆæœ¬ç›‘æ§å’Œæ™ºèƒ½è®°å¿†]]></title>    <link>https://juejin.cn/post/7585485074037915654</link>    <guid>https://juejin.cn/post/7585485074037915654</guid>    <pubDate>2025-12-20T11:35:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485074037915654" data-draft-id="7585485074037882886" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenTortoiseï¼šå¼€ç®±å³ç”¨çš„Javaè°ƒç”¨LLMä¸­é—´ä»¶ï¼Œä¸€ç«™å¼è§£å†³é…ç½®ã€è°ƒç”¨ã€æˆæœ¬ç›‘æ§å’Œæ™ºèƒ½è®°å¿†"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T11:35:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Tortoise"/> <meta itemprop="url" content="https://juejin.cn/user/2596378198417179"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenTortoiseï¼šå¼€ç®±å³ç”¨çš„Javaè°ƒç”¨LLMä¸­é—´ä»¶ï¼Œä¸€ç«™å¼è§£å†³é…ç½®ã€è°ƒç”¨ã€æˆæœ¬ç›‘æ§å’Œæ™ºèƒ½è®°å¿†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2596378198417179/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Tortoise
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T11:35:33.000Z" title="Sat Dec 20 2025 11:35:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»24åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise" ref="nofollow noopener noreferrer">github.com/JohnTortoisâ€¦</a></p>
<hr/>
<h2 data-id="heading-0">âœ¨ æ ¸å¿ƒç‰¹æ€§</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E6%25A0%25B8%25E5%25BF%2583%25E7%2589%25B9%25E6%2580%25A7" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7" ref="nofollow noopener noreferrer"/></p>
<ul>
<li>ğŸš€Â <strong>å¼€ç®±å³ç”¨</strong>Â - ç®€å•é…ç½®å³å¯å¼€å§‹ä½¿ç”¨ï¼Œæ— éœ€å¤æ‚è®¾ç½®</li>
<li>ğŸ’°Â <strong>æˆæœ¬ç›‘æ§</strong>Â - å®æ—¶è·Ÿè¸ªTokenæ¶ˆè€—å’Œè´¹ç”¨ï¼Œæ”¯æŒå¤šæ¨¡å‹æˆæœ¬ç®¡ç†</li>
<li>ğŸ§ Â <strong>æ™ºèƒ½è®°å¿†</strong>Â - æ”¯æŒå¤šç§è®°å¿†ç­–ç•¥ï¼ˆæˆªæ–­ã€æ‘˜è¦ã€å›¾è°±ï¼‰ï¼Œä¿æŒå¯¹è¯è¿è´¯æ€§</li>
<li>ğŸ”„Â <strong>æµå¼è°ƒç”¨</strong>Â - æ”¯æŒæµå¼å“åº”ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li>
<li>ğŸ› ï¸Â <strong>ç®¡ç†åå°</strong>Â - æä¾›å®Œæ•´çš„Webç®¡ç†ç•Œé¢ï¼Œæ”¯æŒé…ç½®ç®¡ç†ã€æ•°æ®å¯¼å…¥ç­‰</li>
<li>ğŸ“ŠÂ <strong>å¯è§†åŒ–ç›‘æ§</strong>Â - å¯¹è¯å†å²ã€æˆæœ¬ç»Ÿè®¡ã€è®°å¿†ç®¡ç†ä¸€ç›®äº†ç„¶</li>
</ul>
<h2 data-id="heading-1">ğŸ“‹ æ–‡æ¡£å¯¼èˆª</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E6%2596%2587%25E6%25A1%25A3%25E5%25AF%25BC%25E8%2588%25AA" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E6%96%87%E6%A1%A3%E5%AF%BC%E8%88%AA" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E5%25BF%25AB%25E9%2580%259F%25E5%25BC%2580%25E5%25A7%258B" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B" ref="nofollow noopener noreferrer">ğŸš€ å¿«é€Ÿå¼€å§‹</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E6%25A0%25B8%25E5%25BF%2583%25E7%25BB%2584%25E4%25BB%25B6" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6" ref="nofollow noopener noreferrer">ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E7%25AE%25A1%25E7%2590%2586%25E5%2590%258E%25E5%258F%25B0" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0" ref="nofollow noopener noreferrer">ğŸ–¥ï¸ ç®¡ç†åå°</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E8%25AE%25B0%25E5%25BF%2586%25E7%25AD%2596%25E7%2595%25A5%25E8%25AF%25A6%25E8%25A7%25A3" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E8%AE%B0%E5%BF%86%E7%AD%96%E7%95%A5%E8%AF%A6%E8%A7%A3" ref="nofollow noopener noreferrer">ğŸ§  è®°å¿†ç­–ç•¥è¯¦è§£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E5%25BC%2580%25E5%258F%2591%25E7%25A4%25BA%25E4%25BE%258B" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E5%BC%80%E5%8F%91%E7%A4%BA%E4%BE%8B" ref="nofollow noopener noreferrer">ğŸ’» å¼€å‘ç¤ºä¾‹</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23api%25E6%2596%2587%25E6%25A1%25A3" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#api%E6%96%87%E6%A1%A3" ref="nofollow noopener noreferrer">ğŸ“š APIæ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E8%25B4%25A1%25E7%258C%25AE%25E6%258C%2587%25E5%258D%2597" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E8%B4%A1%E7%8C%AE%E6%8C%87%E5%8D%97" ref="nofollow noopener noreferrer">ğŸ¤ è´¡çŒ®æŒ‡å—</a></li>
</ul>
<hr/>
<h2 data-id="heading-2">ğŸš€ å¿«é€Ÿå¼€å§‹</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E5%25BF%25AB%25E9%2580%259F%25E5%25BC%2580%25E5%25A7%258B" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-3">ğŸ“¦ å®‰è£…ä¾èµ–</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E5%25AE%2589%25E8%25A3%2585%25E4%25BE%259D%25E8%25B5%2596" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96" ref="nofollow noopener noreferrer"/></p>
<p>åœ¨é¡¹ç›®çš„Â <code>pom.xml</code>Â ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.github.johntortoise<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>tortoise-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">ğŸ’» åŸºç¡€ä½¿ç”¨</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E5%259F%25BA%25E7%25A1%2580%25E4%25BD%25BF%25E7%2594%25A8" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8" ref="nofollow noopener noreferrer"/></p>
<p>åˆ›å»ºÂ <code>TortoiseClient</code>Â å¹¶å¼€å§‹å¯¹è¯ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> io.github.johntortoise.demo;

<span class="hljs-keyword">import</span> io.github.johntortoise.core.client.TortoiseClient;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.model.ChatCompletionResponse;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.model.Model;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.sys.TortoiseMessage;
<span class="hljs-keyword">import</span> java.math.BigDecimal;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuickStartDemo</span> {

    <span class="hljs-comment">// åˆ›å»ºTortoiseå®¢æˆ·ç«¯</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> TortoiseClient&lt;ChatCompletionResponse&gt; tortoiseClient =
        TortoiseClient.create(ChatCompletionResponse.class);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. é…ç½®æ¨¡å‹ä¿¡æ¯</span>
        <span class="hljs-type">Model</span> <span class="hljs-variable">model</span> <span class="hljs-operator">=</span> Model.builder()
                .modelName(<span class="hljs-string">"doubao-seed-1-6-lite-251015"</span>)  <span class="hljs-comment">// æ¨¡å‹åç§°</span>
                .apiKey(<span class="hljs-string">"your-api-key-here"</span>)              <span class="hljs-comment">// APIå¯†é’¥</span>
                .completeUrl(<span class="hljs-string">"https://ark.cn-beijing.volces.com/api/v3/chat/completions"</span>)  <span class="hljs-comment">// APIåœ°å€</span>
                .temperature(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.7"</span>))       <span class="hljs-comment">// æ¸©åº¦å‚æ•°</span>
                .build();

        <span class="hljs-comment">// 2. å®šä¹‰ä¼šè¯IDï¼ˆæ¯ä¸ªèŠå¤©çª—å£å¯¹åº”å”¯ä¸€IDï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">conversationId</span> <span class="hljs-operator">=</span> <span class="hljs-string">"conversation_001"</span>;

        <span class="hljs-comment">// 3. å‘é€ç¬¬ä¸€æ¡æ¶ˆæ¯</span>
        <span class="hljs-type">TortoiseMessage</span> <span class="hljs-variable">firstMessage</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TortoiseMessage</span>(<span class="hljs-string">"ä½ å¥½ï¼Œæˆ‘å«ç‹å¤§åŠ›"</span>);
        firstMessage.setConversationId(conversationId);

        <span class="hljs-type">ChatCompletionResponse</span> <span class="hljs-variable">firstResponse</span> <span class="hljs-operator">=</span> tortoiseClient.chat(firstMessage, model);
        System.out.println(<span class="hljs-string">"ç¬¬ä¸€æ¬¡å›å¤ï¼š"</span> + firstResponse.getChoices().get(<span class="hljs-number">0</span>).getMessage().getContent());

        <span class="hljs-comment">// 4. å‘é€ç¬¬äºŒæ¡æ¶ˆæ¯ï¼ˆç³»ç»Ÿä¼šè‡ªåŠ¨ç»´æŠ¤å¯¹è¯å†å²ï¼‰</span>
        <span class="hljs-type">TortoiseMessage</span> <span class="hljs-variable">secondMessage</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TortoiseMessage</span>(<span class="hljs-string">"æˆ‘å«ä»€ä¹ˆåå­—ï¼Œç›´æ¥å‘Šè¯‰æˆ‘"</span>);
        secondMessage.setConversationId(conversationId);

        <span class="hljs-type">ChatCompletionResponse</span> <span class="hljs-variable">secondResponse</span> <span class="hljs-operator">=</span> tortoiseClient.chat(secondMessage, model);
        System.out.println(<span class="hljs-string">"ç¬¬äºŒæ¬¡å›å¤ï¼š"</span> + secondResponse.getChoices().get(<span class="hljs-number">0</span>).getMessage().getContent());
    }
}
</code></pre>
<h3 data-id="heading-5">ğŸ“‹ è¿è¡Œç»“æœ</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E8%25BF%2590%25E8%25A1%258C%25E7%25BB%2593%25E6%259E%259C" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C" ref="nofollow noopener noreferrer"/></p>
<p>è¿è¡Œä¸Šè¿°ä»£ç ï¼Œä½ å°†åœ¨æ§åˆ¶å°çœ‹åˆ°è¯¦ç»†çš„è¯·æ±‚å’Œå“åº”æ—¥å¿—ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[tortoise-llmReq]</span> <span class="hljs-attr">conversationId</span>=conversation_001 | æ­£åœ¨è°ƒç”¨LLM...
<span class="hljs-section">[tortoise-llmResp]</span> <span class="hljs-attr">conversationId</span>=conversation_001 | æ”¶åˆ°LLMå“åº”ï¼ŒTokenæ¶ˆè€—: <span class="hljs-number">130</span>
ç¬¬äºŒæ¬¡å›å¤ï¼šä½ å«ç‹å¤§åŠ›ã€‚
</code></pre>
<blockquote>
<p>ğŸ’¡Â <strong>æ³¨æ„</strong>ï¼šç¬¬äºŒæ¬¡è°ƒç”¨æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨åŒ…å«äº†å¯¹è¯å†å²ï¼Œç¡®ä¿AIèƒ½è®°ä½ç”¨æˆ·åå­—ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-6">ğŸ—ï¸ æ ¸å¿ƒç»„ä»¶</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25EF%25B8%258F-%25E6%25A0%25B8%25E5%25BF%2583%25E7%25BB%2584%25E4%25BB%25B6" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%EF%B8%8F-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-7">ğŸ”§ å®¢æˆ·ç«¯åˆå§‹åŒ–</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF%25E5%2588%259D%25E5%25A7%258B%25E5%258C%2596" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%88%9D%E5%A7%8B%E5%8C%96" ref="nofollow noopener noreferrer"/></p>
<h4 data-id="heading-8">æ–¹å¼ä¸€ï¼šç›´æ¥åˆ›å»ºï¼ˆåŸºç¡€æ¨¡å¼ï¼‰</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E6%2596%25B9%25E5%25BC%258F%25E4%25B8%2580%25E7%259B%25B4%25E6%258E%25A5%25E5%2588%259B%25E5%25BB%25BA%25E5%259F%25BA%25E7%25A1%2580%25E6%25A8%25A1%25E5%25BC%258F" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E6%96%B9%E5%BC%8F%E4%B8%80%E7%9B%B4%E6%8E%A5%E5%88%9B%E5%BB%BA%E5%9F%BA%E7%A1%80%E6%A8%A1%E5%BC%8F" ref="nofollow noopener noreferrer"/></p>
<pre><code class="hljs language-ini" lang="ini">// ç›´æ¥åˆ›å»ºå®¢æˆ·ç«¯ï¼Œé€‚ç”¨äºç®€å•åœºæ™¯
TortoiseClient&lt;ChatCompletionResponse&gt; <span class="hljs-attr">client</span> = TortoiseClient.create(ChatCompletionResponse.class)<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-9">æ–¹å¼äºŒï¼šæ¥å…¥ç®¡ç†åå°ï¼ˆé«˜çº§æ¨¡å¼ï¼‰</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E6%2596%25B9%25E5%25BC%258F%25E4%25BA%258C%25E6%258E%25A5%25E5%2585%25A5%25E7%25AE%25A1%25E7%2590%2586%25E5%2590%258E%25E5%258F%25B0%25E9%25AB%2598%25E7%25BA%25A7%25E6%25A8%25A1%25E5%25BC%258F" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E6%96%B9%E5%BC%8F%E4%BA%8C%E6%8E%A5%E5%85%A5%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0%E9%AB%98%E7%BA%A7%E6%A8%A1%E5%BC%8F" ref="nofollow noopener noreferrer"/></p>
<pre><code class="hljs language-ini" lang="ini">// æ¥å…¥tortoise-adminåå°ï¼Œè·å¾—å®Œæ•´åŠŸèƒ½æ”¯æŒ
String <span class="hljs-attr">adminHost</span> = <span class="hljs-string">"http://localhost:8080"</span><span class="hljs-comment">;</span>
String <span class="hljs-attr">accessKey</span> = <span class="hljs-string">"sk-xxxxxxxxxxxxxxxxx"</span><span class="hljs-comment">; // ä»ç®¡ç†åå°è·å–</span>

TortoiseClient&lt;ChatCompletionResponse&gt; <span class="hljs-attr">client</span> =
    TortoiseClient.createForAdmin(ChatCompletionResponse.class, adminHost, accessKey)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-10">ğŸ“‹ æ ¸å¿ƒæ¥å£è¯¦è§£</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E6%25A0%25B8%25E5%25BF%2583%25E6%258E%25A5%25E5%258F%25A3%25E8%25AF%25A6%25E8%25A7%25A3" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3%E8%AF%A6%E8%A7%A3" ref="nofollow noopener noreferrer"/></p>
<h4 data-id="heading-11">ğŸ—‚ï¸ TortoiseChatManger - èŠå¤©ç®¡ç†å™¨</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25EF%25B8%258F-tortoisechatmanger---%25E8%2581%258A%25E5%25A4%25A9%25E7%25AE%25A1%25E7%2590%2586%25E5%2599%25A8" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%EF%B8%8F-tortoisechatmanger---%E8%81%8A%E5%A4%A9%E7%AE%A1%E7%90%86%E5%99%A8" ref="nofollow noopener noreferrer"/></p>
<p><code>TortoiseChatManger</code>Â æ˜¯èŠå¤©ç®¡ç†æ¥å£ï¼Œè´Ÿè´£ç®¡ç†å¯¹è¯æµç¨‹ï¼š</p>
<ul>
<li><strong>DefaultTortoiseChatManger</strong>: é»˜è®¤å®ç°ï¼Œé€‚ç”¨äºåŸºç¡€åœºæ™¯</li>
<li><strong>AdminTortoiseChatManger</strong>: ç®¡ç†åå°å®ç°ï¼Œæä¾›é«˜çº§åŠŸèƒ½</li>
</ul>
<p>æ ¸å¿ƒæ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TortoiseChatManger</span> {

    <span class="hljs-comment">/**
     * æ ¡éªŒæ˜¯å¦è¶…è¿‡é™åˆ¶
     * <span class="hljs-doctag">@param</span> conversationId ä¼šè¯ID
     * <span class="hljs-doctag">@return</span> trueè¡¨ç¤ºè¶…è¿‡é™åˆ¶ï¼Œæ­¤æ¬¡è°ƒç”¨å°†è¢«æ‹¦æˆª
     */</span>
    Boolean <span class="hljs-title function_">checkLimit</span><span class="hljs-params">(String conversationId)</span>;

    <span class="hljs-comment">/**
     * è·å–å†å²æ¶ˆæ¯
     * <span class="hljs-doctag">@param</span> conversationId ä¼šè¯ID
     * <span class="hljs-doctag">@return</span> å†å²æ¶ˆæ¯åˆ—è¡¨
     */</span>
    List&lt;Message&gt; <span class="hljs-title function_">findHistoryChat</span><span class="hljs-params">(String conversationId)</span>;

    <span class="hljs-comment">/**
     * èŠå¤©åå¤„ç†æ–¹æ³•
     * <span class="hljs-doctag">@param</span> afterChatDTO åŒ…å«æœ¬æ¬¡ä¼šè¯çš„æ‰€æœ‰è¾“å…¥è¾“å‡ºæ•°æ®
     */</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterChat</span><span class="hljs-params">(AfterChatDTO afterChatDTO)</span>;
}
</code></pre>
<h5 data-id="heading-12">ğŸ” checkLimit - é™åˆ¶æ ¡éªŒ</h5>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-checklimit---%25E9%2599%2590%25E5%2588%25B6%25E6%25A0%25A1%25E9%25AA%258C" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-checklimit---%E9%99%90%E5%88%B6%E6%A0%A1%E9%AA%8C" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>è§¦å‘æ—¶æœº</strong>: æ¯æ¬¡è°ƒç”¨Â <code>chat</code>Â æ–¹æ³•å‰é¦–å…ˆæ‰§è¡Œ</li>
<li><strong>DefaultTortoiseChatManger</strong>: è¿”å›Â <code>false</code>ï¼Œä¸è¿›è¡Œä»»ä½•é™åˆ¶</li>
<li><strong>AdminTortoiseChatManger</strong>: æ£€æŸ¥ä¼šè¯æ˜¯å¦è¶…è¿‡Tokenä½¿ç”¨ä¸Šé™</li>
<li><strong>è‡ªå®šä¹‰æ‰©å±•</strong>: å¼€å‘è€…å¯å®ç°è°ƒç”¨æ¬¡æ•°ã€é¢‘ç‡ç­‰é™åˆ¶é€»è¾‘</li>
</ul>
<h5 data-id="heading-13">ğŸ“š findHistoryChat - å†å²æ¶ˆæ¯è·å–</h5>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-findhistorychat---%25E5%258E%2586%25E5%258F%25B2%25E6%25B6%2588%25E6%2581%25AF%25E8%258E%25B7%25E5%258F%2596" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-findhistorychat---%E5%8E%86%E5%8F%B2%E6%B6%88%E6%81%AF%E8%8E%B7%E5%8F%96" ref="nofollow noopener noreferrer"/></p>
<p>è¯¥æ–¹æ³•è´Ÿè´£ä¸ºæ¯æ¬¡å¯¹è¯æä¾›å¿…è¦çš„ä¸Šä¸‹æ–‡å†å²ï¼š</p>
<p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">// ä½ åªéœ€è¦ä¼ å…¥æ–°æ¶ˆæ¯å’Œä¼šè¯ID
TortoiseMessage <span class="hljs-attr">message</span> = new TortoiseMessage(<span class="hljs-string">"æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ"</span>)<span class="hljs-comment">;</span>
message.setConversationId(conversationId)<span class="hljs-comment">;</span>
tortoiseClient.chat(message, model)<span class="hljs-comment">;</span>
</code></pre>
<p><strong>å®é™…å‘é€ç»™å¤§æ¨¡å‹çš„å®Œæ•´æ¶ˆæ¯ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">{
  "messages": [
    {"<span class="hljs-attribute">content</span>": <span class="hljs-string">"ä½ å¥½ï¼Œæˆ‘å«ç‹å¤§åŠ›"</span>, <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>},
    {"<span class="hljs-attribute">content</span>": <span class="hljs-string">"ä½ å¥½å‘€ç‹å¤§åŠ›ï¼"</span>, <span class="hljs-string">"role"</span>: <span class="hljs-string">"assistant"</span>},
    {"<span class="hljs-attribute">content</span>": <span class="hljs-string">"æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ"</span>, <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>}
  ]
}
</code></pre>
<p><strong>ä¸åŒå®ç°çš„å·®å¼‚ï¼š</strong></p>
<ul>
<li><strong>DefaultTortoiseChatManger</strong>: å†…å­˜å­˜å‚¨ï¼Œç®€å•é«˜æ•ˆ</li>
<li><strong>AdminTortoiseChatManger</strong>: æ•°æ®åº“å­˜å‚¨ï¼Œæ”¯æŒå¤æ‚è®°å¿†ç­–ç•¥</li>
</ul>
<h5 data-id="heading-14">ğŸ“ afterChat - å¯¹è¯åå¤„ç†</h5>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-afterchat---%25E5%25AF%25B9%25E8%25AF%259D%25E5%2590%258E%25E5%25A4%2584%25E7%2590%2586" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-afterchat---%E5%AF%B9%E8%AF%9D%E5%90%8E%E5%A4%84%E7%90%86" ref="nofollow noopener noreferrer"/></p>
<p>å¯¹è¯å®Œæˆåå¯¹æ•°æ®è¿›è¡Œæ•´åˆå’Œå­˜å‚¨ï¼š</p>
<p><strong>AfterChatDTO</strong>Â ä¸»è¦åŒ…å«ï¼š</p>
<ul>
<li><code>conversationId</code>: ä¼šè¯æ ‡è¯†</li>
<li><code>MainInfo</code>: å®Œæ•´çš„å¯¹è¯æ•°æ®</li>
</ul>
<p><strong>MainInfo æ•°æ®ç»“æ„ï¼š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> io.github.johntortoise.core.dto.model;

<span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Builder;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainInfo</span> {

    <span class="hljs-keyword">private</span> List&lt;Message&gt; history;    <span class="hljs-comment">// å†å²æ¶ˆæ¯</span>

    <span class="hljs-keyword">private</span> Message input;           <span class="hljs-comment">// ç”¨æˆ·è¾“å…¥</span>

    <span class="hljs-keyword">private</span> Message outPut;          <span class="hljs-comment">// AIè¾“å‡º</span>

    <span class="hljs-keyword">private</span> Tokens tokens;           <span class="hljs-comment">// Tokenæ¶ˆè€—ç»Ÿè®¡</span>


    <span class="hljs-meta">@Data</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Tokens</span>{
        <span class="hljs-keyword">private</span> Integer completionTokens;  <span class="hljs-comment">// è¾“å‡ºToken</span>

        <span class="hljs-keyword">private</span> Integer promptTokens;      <span class="hljs-comment">// è¾“å…¥Token</span>

        <span class="hljs-keyword">private</span> Integer totalTokens;       <span class="hljs-comment">// æ€»Token</span>

        <span class="hljs-keyword">private</span> Integer cachedTokens;      <span class="hljs-comment">// ç¼“å­˜Token</span>

    }
}
</code></pre>
<p><strong>ä¸åŒå®ç°çš„å¤„ç†é€»è¾‘ï¼š</strong></p>
<ul>
<li><strong>DefaultTortoiseChatManger</strong>: ç›´æ¥å­˜å‚¨åˆ°å†…å­˜Mapä¸­</li>
<li><strong>AdminTortoiseChatManger</strong>: è§¦å‘æ¶ˆæ¯å­˜å‚¨ã€æˆæœ¬è®¡ç®—ã€è®°å¿†ç”Ÿæˆä¸‰å¤§æµç¨‹</li>
</ul>
<h4 data-id="heading-15">ğŸ”„ TortoiseMessageHandler - æ¶ˆæ¯å¤„ç†æ‹¦æˆªå™¨</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-tortoisemessagehandler---%25E6%25B6%2588%25E6%2581%25AF%25E5%25A4%2584%25E7%2590%2586%25E6%258B%25A6%25E6%2588%25AA%25E5%2599%25A8" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-tortoisemessagehandler---%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E6%8B%A6%E6%88%AA%E5%99%A8" ref="nofollow noopener noreferrer"/></p>
<p>å¤„ç†ä¸åŒå¤§æ¨¡å‹çš„è¾“å‡ºæ ¼å¼å·®å¼‚ï¼š</p>
<ul>
<li><strong>é€‚ç”¨åœºæ™¯</strong>: ä¸åŒLLMæœåŠ¡çš„å“åº”æ ¼å¼ä¸ç»Ÿä¸€æ—¶ä½¿ç”¨</li>
<li><strong>æ‰©å±•æ€§</strong>: æ”¯æŒè‡ªå®šä¹‰æ¶ˆæ¯è§£æé€»è¾‘</li>
<li><strong>é»˜è®¤å®ç°</strong>:Â <code>DefaultTortoiseMessageHandler</code>Â æä¾›åŸºç¡€åŠŸèƒ½</li>
</ul>

<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TortoiseMessageHandler</span>&lt;T&gt; {
    <span class="hljs-comment">/**
     * è§£æå¤§æ¨¡å‹å“åº”ä¸ºJavaå¯¹è±¡
     * <span class="hljs-doctag">@param</span> resp LLMçš„å®Œæ•´å“åº”å­—ç¬¦ä¸²
     * <span class="hljs-doctag">@return</span> è½¬æ¢åçš„Javaå¯¹è±¡
     */</span>
    T <span class="hljs-title function_">convertForResult</span><span class="hljs-params">(String resp)</span>;

    <span class="hljs-comment">/**
     * æ•´åˆå¯¹è¯æ•°æ®ç”¨äºåç»­å¤„ç†
     * <span class="hljs-doctag">@param</span> history å†å²æ¶ˆæ¯åˆ—è¡¨
     * <span class="hljs-doctag">@param</span> input ç”¨æˆ·è¾“å…¥æ¶ˆæ¯
     * <span class="hljs-doctag">@param</span> resp å¤§æ¨¡å‹åŸå§‹å“åº”
     * <span class="hljs-doctag">@param</span> streamCallBack æµå¼å›è°ƒï¼ˆå¯é€‰ï¼‰
     * <span class="hljs-doctag">@return</span> MainInfoå¯¹è±¡ï¼Œä¼ é€’ç»™TortoiseChatManger.afterChat()
     */</span>
    MainInfo <span class="hljs-title function_">convertForMainInfo</span><span class="hljs-params">(List&lt;Message&gt; history, Message input,
                                String resp, StreamCallBack streamCallBack)</span>;
}
</code></pre>
<p>æˆ‘ä»¬åªä¸ºTortoiseMessageHandleræä¾›ç»™äº†ä¸€ä¸ªåŸºç¡€çš„å®ç°ç±»DefaultTortoiseMessageHandlerï¼Œè¿™éƒ¨åˆ†æ›´å¤šæ˜¯åœ¨å¯¹è¾“å‡ºåšæ ¼å¼åŒ–ï¼Œä¸å†ç»†è®²</p>
<h2 data-id="heading-16">ğŸ–¥ï¸ TortoiseClient - æ ¸å¿ƒå®¢æˆ·ç«¯</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25EF%25B8%258F-tortoiseclient---%25E6%25A0%25B8%25E5%25BF%2583%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%EF%B8%8F-tortoiseclient---%E6%A0%B8%E5%BF%83%E5%AE%A2%E6%88%B7%E7%AB%AF" ref="nofollow noopener noreferrer"/></p>
<p><code>TortoiseClient</code>Â æ˜¯æ¡†æ¶çš„æ ¸å¿ƒï¼Œå°è£…äº†æ‰€æœ‰å¤æ‚çš„è°ƒç”¨é€»è¾‘ï¼š</p>
<p><strong>æ ¸å¿ƒç»„ä»¶ï¼š</strong></p>
<ul>
<li><strong>TortoiseChatManger</strong>: èŠå¤©ç®¡ç†å™¨</li>
<li><strong>TortoiseMessageHandler</strong>: æ¶ˆæ¯å¤„ç†æ‹¦æˆªå™¨</li>
<li><strong>Model</strong>: æ¨¡å‹é…ç½®ä¿¡æ¯</li>
<li><strong>TortoiseAdminClient</strong>: ç®¡ç†åå°å®¢æˆ·ç«¯</li>
</ul>
<p><strong>æ”¯æŒçš„è°ƒç”¨æ–¹å¼ï¼š</strong></p>
<h4 data-id="heading-17">ğŸ“ åŸºç¡€è°ƒç”¨æ¨¡å¼ (ä½¿ç”¨Â <code>TortoiseClient.create</code>)</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E5%259F%25BA%25E7%25A1%2580%25E8%25B0%2583%25E7%2594%25A8%25E6%25A8%25A1%25E5%25BC%258F-%25E4%25BD%25BF%25E7%2594%25A8-tortoiseclientcreate" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E5%9F%BA%E7%A1%80%E8%B0%83%E7%94%A8%E6%A8%A1%E5%BC%8F-%E4%BD%BF%E7%94%A8-tortoiseclientcreate" ref="nofollow noopener noreferrer"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.github.johntortoise.core.callback.StreamCallBack;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.client.TortoiseClient;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.model.ChatCompletionResponse;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.model.Model;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.sys.TortoiseMessage;
<span class="hljs-keyword">import</span> java.math.BigDecimal;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicUsageDemo</span> {

    <span class="hljs-comment">// åˆ›å»ºåŸºç¡€å®¢æˆ·ç«¯</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> TortoiseClient&lt;ChatCompletionResponse&gt; client =
        TortoiseClient.create(ChatCompletionResponse.class);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. é…ç½®æ¨¡å‹</span>
        <span class="hljs-type">Model</span> <span class="hljs-variable">model</span> <span class="hljs-operator">=</span> Model.builder()
                .modelName(<span class="hljs-string">"doubao-seed-1-6-lite-251015"</span>)
                .apiKey(<span class="hljs-string">"your-api-key"</span>)
                .completeUrl(<span class="hljs-string">"https://ark.cn-beijing.volces.com/api/v3/chat/completions"</span>)
                .temperature(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.7"</span>))
                .build();

        <span class="hljs-type">String</span> <span class="hljs-variable">conversationId</span> <span class="hljs-operator">=</span> <span class="hljs-string">"conv_001"</span>;

        <span class="hljs-comment">// 2. éæµå¼è°ƒç”¨ - ä¸€æ¬¡æ€§è¿”å›å®Œæ•´ç»“æœ</span>
        <span class="hljs-type">TortoiseMessage</span> <span class="hljs-variable">message1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TortoiseMessage</span>(<span class="hljs-string">"ä½ å¥½ï¼Œæˆ‘å«ç‹å¤§åŠ›"</span>);
        message1.setConversationId(conversationId);
        <span class="hljs-type">ChatCompletionResponse</span> <span class="hljs-variable">response1</span> <span class="hljs-operator">=</span> client.chat(message1, model);

        <span class="hljs-comment">// 3. æµå¼è°ƒç”¨ - å®æ—¶è¾“å‡ºç»“æœ</span>
        <span class="hljs-type">TortoiseMessage</span> <span class="hljs-variable">message2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TortoiseMessage</span>(<span class="hljs-string">"æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ"</span>);
        message2.setConversationId(conversationId);

        client.chatStream(message2, model, <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamCallBack</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">send</span><span class="hljs-params">(String content)</span> {
                System.out.print(content); <span class="hljs-comment">// å®æ—¶è¾“å‡º</span>
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finish</span><span class="hljs-params">()</span> {
                System.out.println(<span class="hljs-string">"\n[æµå¼è¾“å‡ºå®Œæˆ]"</span>);
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">()</span> {
                System.err.println(<span class="hljs-string">"è°ƒç”¨å¤±è´¥"</span>);
            }
        });
    }
}
</code></pre>
<h4 data-id="heading-18">ğŸ”§ ç®¡ç†åå°è°ƒç”¨æ¨¡å¼ (ä½¿ç”¨Â <code>TortoiseClient.createForAdmin</code>)</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E7%25AE%25A1%25E7%2590%2586%25E5%2590%258E%25E5%258F%25B0%25E8%25B0%2583%25E7%2594%25A8%25E6%25A8%25A1%25E5%25BC%258F-%25E4%25BD%25BF%25E7%2594%25A8-tortoiseclientcreateforadmin" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0%E8%B0%83%E7%94%A8%E6%A8%A1%E5%BC%8F-%E4%BD%BF%E7%94%A8-tortoiseclientcreateforadmin" ref="nofollow noopener noreferrer"/></p>
<blockquote>
<p>ğŸ’¡Â <strong>æ³¨æ„</strong>: æ­¤æ¨¡å¼éœ€è¦å…ˆéƒ¨ç½² tortoise-admin ç®¡ç†åå°ï¼Œä¼šè¯IDé€šè¿‡Â <code>createConversation()</code>Â åˆ›å»º</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> io.github.johntortoise.core.callback.StreamCallBack;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.client.TortoiseClient;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.model.ChatCompletionResponse;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.sys.TortoiseMessage;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdminUsageDemo</span> {

    <span class="hljs-comment">// ç®¡ç†åå°åœ°å€å’Œè®¿é—®å¯†é’¥</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ADMIN_HOST</span> <span class="hljs-operator">=</span> <span class="hljs-string">"http://localhost:8080"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ACCESS_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"sk-xxxxxxxxxxxxxxxxx"</span>;

    <span class="hljs-comment">// åˆ›å»ºæ¥å…¥ç®¡ç†åå°çš„å®¢æˆ·ç«¯</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">static</span> TortoiseClient&lt;ChatCompletionResponse&gt; client =
        TortoiseClient.createForAdmin(ChatCompletionResponse.class, ADMIN_HOST, ACCESS_KEY);

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 1. é€šè¿‡ç®¡ç†åå°åˆ›å»ºä¼šè¯</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">conversationId</span> <span class="hljs-operator">=</span> client.createConversation(<span class="hljs-string">"è‡ªå®šä¹‰ä¼šè¯æ ‡è¯†"</span>);

        <span class="hljs-comment">// 2. éæµå¼è°ƒç”¨ - æ— éœ€æ‰‹åŠ¨ä¼ å…¥æ¨¡å‹é…ç½®</span>
        <span class="hljs-type">TortoiseMessage</span> <span class="hljs-variable">message1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TortoiseMessage</span>(<span class="hljs-string">"ä½ å¥½ï¼Œæˆ‘å«ç‹å¤§åŠ›"</span>);
        message1.setConversationId(conversationId);
        <span class="hljs-type">ChatCompletionResponse</span> <span class="hljs-variable">response1</span> <span class="hljs-operator">=</span> client.chatForAdmin(message1);

        <span class="hljs-comment">// 3. æµå¼è°ƒç”¨</span>
        <span class="hljs-type">TortoiseMessage</span> <span class="hljs-variable">message2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TortoiseMessage</span>(<span class="hljs-string">"æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ"</span>);
        message2.setConversationId(conversationId);

        client.chatStreamForAdmin(message2, <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamCallBack</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">send</span><span class="hljs-params">(String content)</span> {
                System.out.print(content);
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finish</span><span class="hljs-params">()</span> {
                System.out.println(<span class="hljs-string">"\n[ç®¡ç†åå°æµå¼è¾“å‡ºå®Œæˆ]"</span>);
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">()</span> {
                System.err.println(<span class="hljs-string">"ç®¡ç†åå°è°ƒç”¨å¤±è´¥"</span>);
            }
        });
    }
}
</code></pre>
<h3 data-id="heading-19">3.2 LLMApiClient</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2332-llmapiclient" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#32-llmapiclient" ref="nofollow noopener noreferrer"/></p>
<p>è€ƒè™‘åˆ°æœ‰äº›å¼€å‘è€…å¯èƒ½ä¸æƒ³ä½¿ç”¨æˆ‘ä»¬çš„TortoiseClientï¼Œè€Œæƒ³å®Œå…¨è‡ªå·±ä¸å¤§æ¨¡å‹äº¤äº’ å› æ­¤CompleteLLMApiClientå’ŒStreamLLMApiClientæ˜¯å…è®¸ç›´æ¥ä½¿ç”¨çš„</p>
<h4 data-id="heading-20">3.2.1 CompleteLLMApiClient</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23321-completellmapiclient" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#321-completellmapiclient" ref="nofollow noopener noreferrer"/></p>
<p>ä½¿ç”¨ç¤ºä¾‹</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> io.github.johntortoise.demo.controller;

<span class="hljs-keyword">import</span> io.github.johntortoise.core.client.llm.CompleteLLMApiClient;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.model.Message;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.model.Model;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.enums.RoleEnum;

<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//å®šä¹‰æ¨¡å‹ä¿¡æ¯</span>
            <span class="hljs-type">Model</span> <span class="hljs-variable">model</span> <span class="hljs-operator">=</span> Model.builder().modelName(<span class="hljs-string">"doubao-seed-1-6-lite-251015"</span>)
                    .apiKey(<span class="hljs-string">"857299ff-3489-435a-8d1b-9aaad1c89d9b"</span>)
                    .completeUrl(<span class="hljs-string">"https://ark.cn-beijing.volces.com/api/v3/chat/completions"</span>)
                    .temperature(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.7"</span>))
                    .build();

            <span class="hljs-type">CompleteLLMApiClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> CompleteLLMApiClient.createClient(model);

            <span class="hljs-type">String</span> <span class="hljs-variable">conversationId</span> <span class="hljs-operator">=</span> <span class="hljs-string">"1"</span>;

            List&lt;Message&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">"ä½ å¥½ï¼Œæˆ‘å«ç‹å¤§åŠ›"</span>,RoleEnum.USER.getCode()));
            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">"ä½ å¥½å‘€ç‹å¤§åŠ›ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï½æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åˆ°ä½ çš„å—ï¼Ÿ"</span>,RoleEnum.SYSTEM.getCode()));
            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">"æˆ‘å«ä»€ä¹ˆåå­—ï¼Œç›´æ¥å‘Šè¯‰æˆ‘"</span>,RoleEnum.USER.getCode()));

            client.chatCompletion(list,conversationId);
        }<span class="hljs-keyword">catch</span> (Exception e){
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
        }
    }
}
</code></pre>
<h4 data-id="heading-21">3.2.1 StreamLLMApiClient</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23321-streamllmapiclient" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#321-streamllmapiclient" ref="nofollow noopener noreferrer"/></p>
<p>StreamLLMApiClient ä½¿ç”¨ç¤ºä¾‹</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> io.github.johntortoise.demo.controller;

<span class="hljs-keyword">import</span> io.github.johntortoise.core.callback.StreamCallBack;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.client.llm.StreamLLMApiClient;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.model.Message;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.model.Model;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.enums.RoleEnum;

<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">//å®šä¹‰æ¨¡å‹ä¿¡æ¯</span>
            <span class="hljs-type">Model</span> <span class="hljs-variable">model</span> <span class="hljs-operator">=</span> Model.builder().modelName(<span class="hljs-string">"doubao-seed-1-6-lite-251015"</span>)
                    .apiKey(<span class="hljs-string">"857299ff-3489-435a-8d1b-9aaad1c89d9b"</span>)
                    .completeUrl(<span class="hljs-string">"https://ark.cn-beijing.volces.com/api/v3/chat/completions"</span>)
                    .temperature(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.7"</span>))
                    .build();

            <span class="hljs-type">StreamLLMApiClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> StreamLLMApiClient.createClient(model);

            <span class="hljs-type">String</span> <span class="hljs-variable">conversationId</span> <span class="hljs-operator">=</span> <span class="hljs-string">"1"</span>;

            List&lt;Message&gt; list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">"ä½ å¥½ï¼Œæˆ‘å«ç‹å¤§åŠ›"</span>,RoleEnum.USER.getCode()));
            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">"ä½ å¥½å‘€ç‹å¤§åŠ›ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï½æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åˆ°ä½ çš„å—ï¼Ÿ"</span>,RoleEnum.SYSTEM.getCode()));
            list.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-string">"æˆ‘å«ä»€ä¹ˆåå­—ï¼Œç›´æ¥å‘Šè¯‰æˆ‘"</span>,RoleEnum.USER.getCode()));

            client.chatCompletion(list, conversationId,  <span class="hljs-keyword">new</span> <span class="hljs-title class_">StreamCallBack</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">send</span><span class="hljs-params">(String content)</span> {
                    System.out.println(content);
                }

                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finish</span><span class="hljs-params">()</span> {

                }

                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onFailure</span><span class="hljs-params">()</span> {

                }
            },<span class="hljs-literal">null</span>);
        }<span class="hljs-keyword">catch</span> (Exception e){
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);
        }
    }
}
</code></pre>
<h3 data-id="heading-22">ğŸ”— TortoiseAdminClient - ç®¡ç†åå°å®¢æˆ·ç«¯</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-tortoiseadminclient---%25E7%25AE%25A1%25E7%2590%2586%25E5%2590%258E%25E5%258F%25B0%25E5%25AE%25A2%25E6%2588%25B7%25E7%25AB%25AF" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-tortoiseadminclient---%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0%E5%AE%A2%E6%88%B7%E7%AB%AF" ref="nofollow noopener noreferrer"/></p>
<p><code>TortoiseAdminClient</code>Â å°è£…äº†æ‰€æœ‰ä¸ç®¡ç†åå°çš„äº¤äº’é€»è¾‘ã€‚å¦‚æœä¸ä½¿ç”¨ç®¡ç†åå°åŠŸèƒ½ï¼Œå¯ä»¥è·³è¿‡æ­¤éƒ¨åˆ†ã€‚</p>
<h4 data-id="heading-23">ğŸ“¡ æ ¸å¿ƒAPIæ–¹æ³•</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E6%25A0%25B8%25E5%25BF%2583api%25E6%2596%25B9%25E6%25B3%2595" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E6%A0%B8%E5%BF%83api%E6%96%B9%E6%B3%95" ref="nofollow noopener noreferrer"/></p>
<p><strong>TortoiseClient å†…éƒ¨è°ƒç”¨ï¼š</strong></p>








































<table><thead><tr><th>æ–¹æ³•</th><th>è§¦å‘æ—¶æœº</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>connect</code></td><td><code>tortoiseClient.checkConnection()</code></td><td>è¿æ¥æµ‹è¯•</td></tr><tr><td><code>createConversation</code></td><td><code>tortoiseClient.createConversation()</code></td><td>åˆ›å»ºä¼šè¯</td></tr><tr><td><code>findModel</code></td><td><code>chatForAdmin()</code>Â /Â <code>chatStreamForAdmin()</code></td><td>è·å–SKç»‘å®šçš„æ¨¡å‹é…ç½®</td></tr><tr><td><code>afterChat</code></td><td><code>TortoiseChatManger.afterChat()</code></td><td>å¯¹è¯åå¤„ç†ï¼ˆå­˜å‚¨æˆæœ¬ã€ç”Ÿæˆè®°å¿†ï¼‰</td></tr><tr><td><code>getMemoriesByConversationId</code></td><td><code>TortoiseChatManger.findHistoryChat()</code></td><td>è·å–ä¼šè¯è®°å¿†</td></tr><tr><td><code>checkLimit</code></td><td><code>TortoiseChatManger.checkLimit()</code></td><td>æ£€æŸ¥Tokenä½¿ç”¨é™åˆ¶</td></tr></tbody></table>
<p><strong>ç‹¬ç«‹ä½¿ç”¨æ–¹æ³•ï¼š</strong></p>















<table><thead><tr><th>æ–¹æ³•</th><th>é€‚ç”¨åœºæ™¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>receiveMessage</code></td><td>ä»…éœ€è¦è®°å¿†åŠŸèƒ½</td><td>æ¨é€æ¶ˆæ¯å¹¶è§¦å‘è®°å¿†ç”Ÿæˆ</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡Â <strong>æç¤º</strong>:Â <code>receiveMessage</code>Â æ–¹æ³•è¯¦è§Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2362-%25E8%25A7%25A6%25E5%258F%2591%25E8%25AE%25B0%25E5%25BF%2586%25E7%2594%259F%25E6%2588%2590" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#62-%E8%A7%A6%E5%8F%91%E8%AE%B0%E5%BF%86%E7%94%9F%E6%88%90" ref="nofollow noopener noreferrer">6.2 è§¦å‘è®°å¿†ç”Ÿæˆ</a></p>
</blockquote>
<h2 data-id="heading-24">ğŸ–¥ï¸ ç®¡ç†åå° (Tortoise Admin)</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25EF%25B8%258F-%25E7%25AE%25A1%25E7%2590%2586%25E5%2590%258E%25E5%258F%25B0-tortoise-admin" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%EF%B8%8F-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0-tortoise-admin" ref="nofollow noopener noreferrer"/></p>
<p>å®Œæ•´çš„Webç®¡ç†ç•Œé¢ï¼Œæä¾›å¯è§†åŒ–çš„é…ç½®ç®¡ç†ã€ç›‘æ§å’Œè¿ç»´åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-25">ğŸ—„ï¸ æ•°æ®åº“åˆå§‹åŒ–</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25EF%25B8%258F-%25E6%2595%25B0%25E6%258D%25AE%25E5%25BA%2593%25E5%2588%259D%25E5%25A7%258B%25E5%258C%2596" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%EF%B8%8F-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%88%9D%E5%A7%8B%E5%8C%96" ref="nofollow noopener noreferrer"/></p>
<ol>
<li>
<p><strong>æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬</strong></p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># æ‰§è¡Œæ•°æ®åº“è¡¨ç»“æ„åˆ›å»ºè„šæœ¬</span>
mysql -u root -p &lt; tortoise-admin/<span class="hljs-keyword">init</span>/<span class="hljs-keyword">init</span>-ddl.sql

<span class="hljs-meta"># æ‰§è¡Œæ•°æ®åˆå§‹åŒ–è„šæœ¬</span>
mysql -u root -p &lt; tortoise-admin/<span class="hljs-keyword">init</span>/<span class="hljs-keyword">init</span>-dml.sql
</code></pre>
</li>
<li>
<p><strong>é…ç½®æ•°æ®åº“è¿æ¥</strong>Â ç¼–è¾‘Â <code>tortoise-admin/.env</code>:</p>
<pre><code class="hljs language-ini" lang="ini"> <span class="hljs-attr">SPRING_DATASOURCE_HOST</span>=<span class="hljs-number">192.168</span>.<span class="hljs-number">3.11</span>
 <span class="hljs-attr">SPRING_DATASOURCE_PORT</span>=<span class="hljs-number">3306</span>
 <span class="hljs-attr">SPRING_DATASOURCE_DATABASE</span>=db_tortoise
 <span class="hljs-attr">SPRING_DATASOURCE_USERNAME</span>=root
 <span class="hljs-attr">SPRING_DATASOURCE_PASSWORD</span>=usiytvsiid5843
</code></pre>
</li>
</ol>
<h3 data-id="heading-26">ğŸš€ å¯åŠ¨æœåŠ¡</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E5%2590%25AF%25E5%258A%25A8%25E6%259C%258D%25E5%258A%25A1" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1" ref="nofollow noopener noreferrer"/></p>
<h4 data-id="heading-27">æœ¬åœ°å¯åŠ¨</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E6%259C%25AC%25E5%259C%25B0%25E5%2590%25AF%25E5%258A%25A8" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E6%9C%AC%E5%9C%B0%E5%90%AF%E5%8A%A8" ref="nofollow noopener noreferrer"/></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> tortoise-admin
./start-app  <span class="hljs-comment"># Windowsä½¿ç”¨ start-app.bat</span>

<span class="hljs-comment"># è®¿é—®ç®¡ç†åå°</span>
open http://localhost:8080/login
</code></pre>
<h4 data-id="heading-28">Dockerå¯åŠ¨</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23docker%25E5%2590%25AF%25E5%258A%25A8" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#docker%E5%90%AF%E5%8A%A8" ref="nofollow noopener noreferrer"/></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> tortoise-admin
docker-compose up -d

<span class="hljs-comment"># è®¿é—®ç®¡ç†åå°</span>
open http://your-ip:8080/login
</code></pre>
<p><strong>é»˜è®¤è´¦å·</strong>:Â <code>admin@gmail.com</code>Â /Â <code>123456</code></p>
<h3 data-id="heading-29">4.1 å¤§æ¨¡å‹é…ç½®é¡µé¢</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2341-%25E5%25A4%25A7%25E6%25A8%25A1%25E5%259E%258B%25E9%2585%258D%25E7%25BD%25AE%25E9%25A1%25B5%25E9%259D%25A2" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#41-%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%85%8D%E7%BD%AE%E9%A1%B5%E9%9D%A2" ref="nofollow noopener noreferrer"/></p>
<h4 data-id="heading-30">ç•Œé¢æ¦‚è§ˆ</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0641c867def344f095cae6232476bec6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=%2FEh4rZ6Y0wMOtfGcSogAUqKaacI%3D" alt="llmConfig.png" loading="lazy"/></p>
<h4 data-id="heading-31">åˆå§‹åŒ–é…ç½®</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E5%2588%259D%25E5%25A7%258B%25E5%258C%2596%25E9%2585%258D%25E7%25BD%25AE" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE" ref="nofollow noopener noreferrer"/></p>
<p>åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶ï¼Œ<code>init-dml.sql</code>Â æ–‡ä»¶ä¼šé¢„ç½®ç¤ºä¾‹æ¨¡å‹é…ç½®ã€‚æ‚¨éœ€è¦å°†å…¶ä¿®æ”¹ä¸ºå®é™…çš„æ¨¡å‹é…ç½®ã€‚</p>
<p><strong>æ“ä½œæ–¹å¼ï¼š</strong></p>
<ul>
<li>ç‚¹å‡»"ç¼–è¾‘"æŒ‰é’®ä¿®æ”¹ç°æœ‰é…ç½®</li>
<li>ç‚¹å‡»"æ–°å¢"æŒ‰é’®åˆ›å»ºæ–°é…ç½®</li>
</ul>
<h4 data-id="heading-32">æ–°å¢/ç¼–è¾‘é…ç½®ç•Œé¢</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fe2f894d4604c8fad8974f1c937870e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=iQ8qhcZFPVThmE2MWkY7EKZcV0U%3D" alt="llmConfigAddOrUpdate.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e754df39ee78400baa9761edf4809836~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=Iqq2V%2Fg70SahyOCyODc1jbz7Iyo%3D" alt="llmConfigAddOrUpdate-1.png" loading="lazy"/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E6%2596%25B0%25E5%25A2%259E%25E7%25BC%2596%25E8%25BE%2591%25E9%2585%258D%25E7%25BD%25AE%25E7%2595%258C%25E9%259D%25A2" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E6%96%B0%E5%A2%9E%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E7%95%8C%E9%9D%A2" ref="nofollow noopener noreferrer"/></p>
<h4 data-id="heading-33">é…ç½®å‚æ•°è¯¦è§£</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E9%2585%258D%25E7%25BD%25AE%25E5%258F%2582%25E6%2595%25B0%25E8%25AF%25A6%25E8%25A7%25A3" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3" ref="nofollow noopener noreferrer"/></p>
<h4 data-id="heading-34">åŸºæœ¬ä¿¡æ¯</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E5%259F%25BA%25E6%259C%25AC%25E4%25BF%25A1%25E6%2581%25AF" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>æ¨¡å‹åç§°</strong><br/>
è°ƒç”¨ç¬¬ä¸‰æ–¹APIæ—¶ä¼ å…¥çš„Â <code>model</code>Â å‚æ•°ï¼ˆä¾‹å¦‚ï¼š<code>qwen-flash</code>ï¼‰</li>
<li><strong>é…ç½®åç§°</strong><br/>
è‡ªå®šä¹‰æ ‡è¯†åç§°ï¼Œå»ºè®®ä¸æ¨¡å‹åç§°åŒºåˆ†ï¼Œé¿å…æ··æ·†</li>
</ul>
<h4 data-id="heading-35">API è¿æ¥é…ç½®</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23api-%25E8%25BF%259E%25E6%258E%25A5%25E9%2585%258D%25E7%25BD%25AE" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#api-%E8%BF%9E%E6%8E%A5%E9%85%8D%E7%BD%AE" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>API å¯†é’¥</strong><br/>
ç¬¬ä¸‰æ–¹LLMæœåŠ¡å•†æä¾›çš„å¯†é’¥ï¼ˆä»…éœ€å¡«å…¥"Bearer "åé¢çš„éƒ¨åˆ†ï¼‰</li>
<li><strong>API URL</strong><br/>
âš ï¸Â <strong>è¯·å¡«å…¥å®Œæ•´çš„APIç«¯ç‚¹è·¯å¾„</strong><br/>
<strong>è¯´æ˜</strong>ï¼šç”±äºOpenAI SDKè®¾è®¡äº†Â <code>baseUrl + /v1/chat/completions</code>Â çš„æ‹¼æ¥æ–¹å¼ï¼Œè€Œéƒ¨åˆ†å‚å•†çš„APIä¸æ”¯æŒæ­¤æ¨¡å¼ã€‚ä¸ºç¡®ä¿å…¼å®¹æ€§ï¼Œæ­¤å¤„éœ€å¡«å†™å®Œæ•´çš„è¯·æ±‚åœ°å€ã€‚</li>
</ul>
<h4 data-id="heading-36">æ¨¡å‹å‚æ•°</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E6%25A8%25A1%25E5%259E%258B%25E5%258F%2582%25E6%2595%25B0" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>çŠ¶æ€</strong><br/>
<code>å¯ç”¨</code>Â /Â <code>ç¦ç”¨</code>Â - ä»…å¯ç”¨çš„æ¨¡å‹å¯åœ¨å…¶ä»–åŠŸèƒ½é¡µé¢ä¸­è¢«æœç´¢å’Œä½¿ç”¨</li>
<li><strong>æ¸©åº¦å€¼</strong><br/>
å¯¹åº”å¤§æ¨¡å‹APIçš„Â <code>temperature</code>Â å‚æ•°ï¼Œæ§åˆ¶ç”Ÿæˆæ–‡æœ¬çš„éšæœºæ€§</li>
</ul>
<h4 data-id="heading-37">æˆæœ¬ç®¡ç†</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E6%2588%2590%25E6%259C%25AC%25E7%25AE%25A1%25E7%2590%2586" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E6%88%90%E6%9C%AC%E7%AE%A1%E7%90%86" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>è¾“å…¥ä»·æ ¼</strong><br/>
æ¯ token çš„æˆæœ¬å•ä»·ï¼ˆæ”¯æŒæœ€å¤š6ä½å°æ•°ï¼‰</li>
<li><strong>è¾“å‡ºä»·æ ¼</strong><br/>
æ¯ token çš„æˆæœ¬å•ä»·ï¼ˆæ”¯æŒæœ€å¤š6ä½å°æ•°ï¼‰</li>
<li><strong>ç¼“å­˜ä»·æ ¼</strong><br/>
éƒ¨åˆ†æ¨¡å‹åœ¨è°ƒç”¨æ—¶å¯èƒ½å‘½ä¸­ç¼“å­˜ï¼Œè‹¥å‚å•†æœªæä¾›æ­¤ä¿¡æ¯ï¼Œè¯·è®¾ç½®ä¸ºÂ <code>0</code></li>
</ul>
<p><strong>ä»·æ ¼å•ä½è¯´æ˜</strong>ï¼š<br/>
ä¸åŒå‚å•†å¯èƒ½æä¾›"æ¯ç™¾ä¸‡token"æˆ–"æ¯åƒtoken"çš„è®¡ä»·æ–¹å¼ï¼Œæ­¤å¤„å·²ç»Ÿä¸€ä¸º"æ¯token"è®¡ç®—ã€‚å¦‚éœ€è°ƒæ•´ç²¾åº¦ï¼Œè¯·ä¿®æ”¹Â <code>tortoise_llm_config</code>Â è¡¨ä¸­çš„å­—æ®µç±»å‹ã€‚</p>
<h4 data-id="heading-38">å…¶ä»–ä¿¡æ¯</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E5%2585%25B6%25E4%25BB%2596%25E4%25BF%25A1%25E6%2581%25AF" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E5%85%B6%E4%BB%96%E4%BF%A1%E6%81%AF" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>é…ç½®æè¿°</strong><br/>
è‡ªå®šä¹‰è¯´æ˜ä¿¡æ¯ï¼Œå¯ç”¨äºè®°å½•é…ç½®çš„ç”¨é€”ï¼ˆä¾‹å¦‚ï¼š"Aç»„ - XXé¡¹ç›®ä¸“ç”¨é…ç½®"ï¼‰</li>
</ul>
<h3 data-id="heading-39">4.2 è®°å¿†ç­–ç•¥</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2342-%25E8%25AE%25B0%25E5%25BF%2586%25E7%25AD%2596%25E7%2595%25A5" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#42-%E8%AE%B0%E5%BF%86%E7%AD%96%E7%95%A5" ref="nofollow noopener noreferrer"/></p>
<p>åœ¨è®²è§£å…·ä½“é…ç½®å‰ï¼Œéœ€è¦æ˜ç¡®ä¸€ä¸ªæ ¸å¿ƒçš„é€šè¯†æ€§é—®é¢˜ï¼š</p>
<h4 data-id="heading-40">è®°å¿†çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E8%25AE%25B0%25E5%25BF%2586%25E7%259A%2584%25E6%259C%25AC%25E8%25B4%25A8%25E6%2598%25AF%25E4%25BB%2580%25E4%25B9%2588" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E8%AE%B0%E5%BF%86%E7%9A%84%E6%9C%AC%E8%B4%A8%E6%98%AF%E4%BB%80%E4%B9%88" ref="nofollow noopener noreferrer"/></p>
<p>é€šå¸¸ï¼Œæˆ‘ä»¬é€šè¿‡ API ä¸å¤§æ¨¡å‹å¯¹è¯æ—¶ï¼ŒæœåŠ¡æä¾›æ–¹æœ¬èº«<strong>ä¸æä¾›</strong>è®°å¿†åŠŸèƒ½ã€‚æ‰€è°“çš„â€œè®°å¿†â€ï¼Œå®Œå…¨ç”±è°ƒç”¨æ–¹åœ¨æ¯æ¬¡è¯·æ±‚æ—¶æä¾›çš„Â <code>messages</code>Â ä¸Šä¸‹æ–‡æ•°ç»„å†³å®šã€‚</p>
<p><strong>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥ç†è§£è¿™ä¸ªæµç¨‹ï¼š</strong></p>
<ol>
<li>
<p><strong>ç¬¬ä¸€æ¬¡å‘èµ·å¯¹è¯</strong></p>
<pre><code class="hljs language-css" lang="css">{
  "messages": [
    {
      "<span class="hljs-attribute">content</span>": â€œä½ å¥½ï¼Œæˆ‘å«ç‹å¤§åŠ›â€œ,
      â€œroleâ€œ: â€œuserâ€œ
    }
  ]
}
</code></pre>
</li>
<li>
<p><strong>å¤§æ¨¡å‹å›å¤</strong></p>
<pre><code class="hljs language-css" lang="css">{
  â€œ<span class="hljs-attribute">content</span>â€œ: â€œä½ å¥½å‘€ç‹å¤§åŠ›ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï½æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åˆ°ä½ çš„å—ï¼Ÿâ€œ,
  â€œroleâ€œ: â€œassistantâ€œ
}
</code></pre>
</li>
<li>
<p><strong>ç¬¬äºŒæ¬¡å‘èµ·å¯¹è¯ï¼ˆå¸¸è§é”™è¯¯æ–¹å¼ï¼‰</strong> Â å¦‚æœä»…å‘é€æ–°é—®é¢˜ï¼Œæ¨¡å‹å°†å¤±å»ä¹‹å‰çš„ä¸Šä¸‹æ–‡ã€‚</p>
<pre><code class="hljs language-css" lang="css">{
  â€œmessagesâ€œ: [
    {
      â€œ<span class="hljs-attribute">content</span>â€œ: â€œæˆ‘å«ä»€ä¹ˆåå­—ï¼Œç›´æ¥å‘Šè¯‰æˆ‘â€œ,
      â€œroleâ€œ: â€œuserâ€œ
    }
  ]
}
</code></pre>
<p><strong>æ­¤æ—¶ï¼Œå¤§æ¨¡å‹å¹¶ä¸çŸ¥é“ä½ çš„åå­—ã€‚</strong></p>
</li>
<li>
<p><strong>æ­£ç¡®çš„è®°å¿†æ–¹å¼</strong>Â å¿…é¡»å°†å®Œæ•´çš„å†å²å¯¹è¯åŒ…å«åœ¨Â <code>messages</code>Â ä¸­ã€‚</p>
<pre><code class="hljs language-css" lang="css">{
  â€œmessagesâ€œ: [
    {
      â€œ<span class="hljs-attribute">content</span>â€œ: â€œä½ å¥½ï¼Œæˆ‘å«ç‹å¤§åŠ›â€œ,
      â€œroleâ€œ: â€œuserâ€œ
    },
    {
      â€œ<span class="hljs-attribute">content</span>â€œ: â€œä½ å¥½å‘€ç‹å¤§åŠ›ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï½æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åˆ°ä½ çš„å—ï¼Ÿâ€œ,
      â€œroleâ€œ: â€œassistantâ€œ
    },
    {
      â€œ<span class="hljs-attribute">content</span>â€œ: â€œæˆ‘å«ä»€ä¹ˆåå­—ï¼Œç›´æ¥å‘Šè¯‰æˆ‘â€œ,
      â€œroleâ€œ: â€œuserâ€œ
    }
  ]
}
</code></pre>
<p>è¿™å°±æ˜¯<strong>è®°å¿†çš„æœ¬è´¨</strong>ï¼šç”±è°ƒç”¨æ–¹ç»´æŠ¤å¹¶æä¾›çš„å¯¹è¯ä¸Šä¸‹æ–‡ã€‚</p>
</li>
</ol>
<h4 data-id="heading-41">ä¸ºä»€ä¹ˆéœ€è¦è®°å¿†ç­–ç•¥ï¼Ÿ</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E4%25B8%25BA%25E4%25BB%2580%25E4%25B9%2588%25E9%259C%2580%25E8%25A6%2581%25E8%25AE%25B0%25E5%25BF%2586%25E7%25AD%2596%25E7%2595%25A5" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E8%AE%B0%E5%BF%86%E7%AD%96%E7%95%A5" ref="nofollow noopener noreferrer"/></p>
<p>éšç€å¯¹è¯è½®æ•°å¢åŠ ï¼Œ<code>messages</code>Â ä¼šä¸æ–­å¢é•¿ï¼Œå¯¼è‡´æ¶ˆè€—çš„ Token æ•°é‡æ¿€å¢ï¼Œäº§ç”Ÿé«˜æ˜‚è´¹ç”¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸Šä¸‹æ–‡è¿›è¡Œä¼˜åŒ–å’Œç¼©çŸ­ã€‚</p>
<h4 data-id="heading-42">ä¸šå†…é€šç”¨çš„è®°å¿†ä¼˜åŒ–ç­–ç•¥</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E4%25B8%259A%25E5%2586%2585%25E9%2580%259A%25E7%2594%25A8%25E7%259A%2584%25E8%25AE%25B0%25E5%25BF%2586%25E4%25BC%2598%25E5%258C%2596%25E7%25AD%2596%25E7%2595%25A5" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E4%B8%9A%E5%86%85%E9%80%9A%E7%94%A8%E7%9A%84%E8%AE%B0%E5%BF%86%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5" ref="nofollow noopener noreferrer"/></p>
<p>å½“å‰ä¸»æµçš„è§£å†³æ–¹æ¡ˆæœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>








































<table><thead><tr><th align="left">ç­–ç•¥</th><th align="left">æ ¸å¿ƒæ€æƒ³</th><th align="left">ç‰¹ç‚¹</th></tr></thead><tbody><tr><td align="left"><strong>æˆªæ–­</strong></td><td align="left">ä»…ä¿ç•™æœ€è¿‘ N è½®å¯¹è¯ã€‚</td><td align="left">ç®€å•ç›´æ¥ï¼Œä½†å¯èƒ½ä¸¢å¤±é‡è¦æ—©æœŸä¿¡æ¯ã€‚</td></tr><tr><td align="left"><strong>æ‘˜è¦</strong></td><td align="left">å¯¹è¯åï¼Œç”¨å¤§æ¨¡å‹å°†å†å²æ€»ç»“æˆä¸€æ®µæ–‡å­—ï¼Œä¸‹æ¬¡å¯¹è¯æ—¶ä¼ å…¥æ‘˜è¦å’Œæ–°é—®é¢˜ã€‚</td><td align="left">å¹³è¡¡æˆæœ¬ä¸ä¿¡æ¯ä¿ç•™ï¼Œéœ€è¦é¢å¤–æ¨¡å‹è°ƒç”¨ã€‚</td></tr><tr><td align="left"><strong>ç›¸å…³æ€§è¿‡æ»¤</strong></td><td align="left">ç»´æŠ¤ä¸€ä¸ªâ€œå¯¹è¯æ± â€ï¼Œæ ¹æ®ç›¸å…³æ€§è¯„åˆ†åŠ¨æ€æ›¿æ¢æ± ä¸­æœ€ä¸ç›¸å…³çš„å¯¹è¯ã€‚</td><td align="left">æ™ºèƒ½åŒ–ä¿ç•™ï¼Œå®ç°ç›¸å¯¹å¤æ‚ã€‚</td></tr><tr><td align="left"><strong>åˆ†æœŸè®°å¿†</strong></td><td align="left">å°†è®°å¿†åˆ†å±‚å¤„ç†ï¼šä¹…è¿œè®°å¿†â†’å…³é”®è¯ï¼Œä¸­æœŸè®°å¿†â†’æ‘˜è¦ï¼Œè¿‘æœŸè®°å¿†â†’å®Œæ•´ä¸Šä¸‹æ–‡ã€‚</td><td align="left">ç»“æ„ç²¾ç»†ï¼Œèƒ½è¾ƒå¥½å…¼é¡¾è¿œè¿‘ä¿¡æ¯ã€‚</td></tr><tr><td align="left"><strong>æ£€ç´¢</strong></td><td align="left">æ ¹æ®å½“å‰è¾“å…¥ï¼Œä»æ‰€æœ‰å†å²å¯¹è¯ä¸­æ£€ç´¢å‡ºç›¸å…³çš„ç‰‡æ®µä¼ å…¥ä¸Šä¸‹æ–‡ã€‚</td><td align="left">ç±»ä¼¼â€œè”ç½‘æœç´¢â€ï¼Œç²¾å‡†ä½†ä¾èµ–æ£€ç´¢è´¨é‡ã€‚</td></tr><tr><td align="left"><strong>å›¾è°±</strong></td><td align="left">å°†å¯¹è¯å†…å®¹æç‚¼æˆâ€œå®ä½“-å…³ç³»â€å›¾è°±ï¼ˆå¦‚ï¼š<code>[æˆ‘] -[æ˜¯]-&gt; [ç¨‹åºå‘˜]</code>ï¼‰ï¼ŒåŠ¨æ€æ›´æ–°å›¾è°±ä½œä¸ºè®°å¿†ã€‚</td><td align="left">ç»“æ„åŒ–ç¨‹åº¦é«˜ï¼Œèƒ½ç†è§£å¤æ‚å…³ç³»ã€‚</td></tr></tbody></table>
<h4 data-id="heading-43">æœ¬ç³»ç»Ÿæä¾›çš„è®°å¿†ç­–ç•¥</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E6%259C%25AC%25E7%25B3%25BB%25E7%25BB%259F%25E6%258F%2590%25E4%25BE%259B%25E7%259A%2584%25E8%25AE%25B0%25E5%25BF%2586%25E7%25AD%2596%25E7%2595%25A5" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E6%9C%AC%E7%B3%BB%E7%BB%9F%E6%8F%90%E4%BE%9B%E7%9A%84%E8%AE%B0%E5%BF%86%E7%AD%96%E7%95%A5" ref="nofollow noopener noreferrer"/></p>
<p>è€ƒè™‘åˆ°æ˜“ç”¨æ€§å’Œé€šç”¨æ€§ï¼Œæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹ä¸‰ç§ç­–ç•¥ï¼Œåˆ†ä¸ºä¸¤å¤§ç±»å‹ï¼š</p>
<ul>
<li><strong>æ— éœ€å¤§æ¨¡å‹ååŠ©</strong>Â <strong>æˆªæ–­</strong>ï¼šé…ç½®ç®€å•ï¼Œèµ„æºæ¶ˆè€—ä½ã€‚</li>
<li><strong>éœ€è¦å¤§æ¨¡å‹ååŠ©</strong>ï¼ˆéœ€ç¡®ä¿å¯¹åº”æ¨¡å‹å¯ç”¨ï¼‰Â <strong>1.æ‘˜è¦</strong>ï¼šåœ¨å¯¹è¯åè‡ªåŠ¨ç”Ÿæˆå†å²æ‘˜è¦ã€‚Â <strong>2.å›¾è°±</strong>ï¼šæ„å»ºå¹¶ç»´æŠ¤çŸ¥è¯†å›¾è°±ä½œä¸ºè®°å¿†ã€‚</li>
</ul>
<h4 data-id="heading-44">é…ç½®æ“ä½œæŒ‡å¼•</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E9%2585%258D%25E7%25BD%25AE%25E6%2593%258D%25E4%25BD%259C%25E6%258C%2587%25E5%25BC%2595" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E9%85%8D%E7%BD%AE%E6%93%8D%E4%BD%9C%E6%8C%87%E5%BC%95" ref="nofollow noopener noreferrer"/></p>
<p>ç°åœ¨å›åˆ°é…ç½®é¡µé¢ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71ded811d6e74d7ea72366806cef34c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=y1bMV0Tz4bOypSjnsBHeGxPkmfo%3D" alt="memory-policy.png" loading="lazy"/></p>
<p><strong>é‡è¦æç¤º</strong>ï¼š åœ¨Â <code>init-dml.sql</code>Â è„šæœ¬ä¸­ï¼Œç³»ç»Ÿä¼šåˆå§‹åŒ–è®°å¿†é…ç½®ã€‚å¦‚æœæ‚¨é€‰æ‹©çš„ç­–ç•¥ç±»å‹æ˜¯<strong>æ‘˜è¦</strong>æˆ–<strong>å›¾è°±</strong>ï¼Œè¯·åŠ¡å¿…åœ¨é…ç½®é¡µé¢ä¸Šå°†å…¶å…³è”çš„æ¨¡å‹ä¿®æ”¹ä¸ºÂ <strong>4.1 ç« èŠ‚ä¸­å·²é…ç½®å¹¶å¯ç”¨çš„æ¨¡å‹</strong>ã€‚</p>
<h4 data-id="heading-45">4.2.1 æˆªæ–­</h4>
<p>è€ƒè™‘åˆ°å¯¹è¯çš„å®Œæ•´æ€§ä¸ºä¸€é—®ä¸€ç­”ï¼Œå› æ­¤æˆ‘ä»¬åœ¨å®ç°æˆªæ–­æ—¶ï¼ŒåŸºæœ¬ç»´åº¦å°±æ˜¯ä¸€é—®ä¸€ç­”ï¼ŒåŒ…æ‹¬æˆ‘ä»¬çš„è¡¨è®¾è®¡tortoise_message,å…¶ä¹ŸåŒ…å«äº†inputå’Œoutputå­—æ®µ æˆªæ–­ç±»å‹çš„é…ç½®éå¸¸ç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºÂ </p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7607ca65174d4c8a904f8edd29c1fc1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=0GDSnzNPUH7No6i1L%2F2IgFgyvD0%3D" alt="memory-policy-1.png" loading="lazy"/></p>
<h3 data-id="heading-46">4.2.2 æ‘˜è¦ä¸å›¾è°±è®°å¿†ç­–ç•¥</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7ee7f422aea4516aa75171e43fb2ba2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=WRV2mThw%2F%2Bu10B6E6a9fuI2TnIQ%3D" alt="memory-policy-2.png" loading="lazy"/></p>
<blockquote>
<p>ä»¥ä¸Šä¸¤ç§è®°å¿†ç­–ç•¥çš„å®ç°é€»è¾‘è¾ƒä¸ºç›¸ä¼¼ï¼Œå› æ­¤åˆå¹¶è¯´æ˜ã€‚</p>
</blockquote>
<h4 data-id="heading-47">ğŸ“Œ è®°å¿†é˜ˆå€¼</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E8%25AE%25B0%25E5%25BF%2586%25E9%2598%2588%25E5%2580%25BC" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E8%AE%B0%E5%BF%86%E9%98%88%E5%80%BC" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>æ˜¯ä»€ä¹ˆ</strong>ï¼šè§¦å‘è‡ªåŠ¨è®°å¿†æ€»ç»“çš„å¯¹è¯è½®æ•°å¼€å…³ã€‚ä¾‹å¦‚è®¾ç½®ä¸º<code>20</code>ï¼Œåˆ™æ¯ç´¯è®¡å®Œæˆ<strong>20è½®å¯¹è¯</strong>ï¼Œç³»ç»Ÿä¾¿ä¼šè‡ªåŠ¨å¯¹è¿™20è½®å†…å®¹è¿›è¡Œä¸€æ¬¡è®°å¿†æç‚¼ã€‚</li>
<li><strong>ä¸ºä»€ä¹ˆ</strong>ï¼šæ§åˆ¶è®°å¿†ç”Ÿæˆçš„<strong>èŠ‚å¥ä¸é¢—ç²’åº¦</strong>ã€‚é˜ˆå€¼è¶Šå°ï¼Œè®°å¿†è¶Šé¢‘ç¹ï¼ˆæˆæœ¬è¶Šé«˜ï¼‰ï¼›é˜ˆå€¼è¶Šå¤§ï¼Œè®°å¿†è¶Šç¨€ç–ï¼ˆå¯èƒ½é—æ¼ç»†èŠ‚ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-48">ğŸ”¢ å•æ¬¡åˆ†ææ¶ˆæ¯æ•°é‡</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E5%258D%2595%25E6%25AC%25A1%25E5%2588%2586%25E6%259E%2590%25E6%25B6%2588%25E6%2581%25AF%25E6%2595%25B0%25E9%2587%258F" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E5%8D%95%E6%AC%A1%E5%88%86%E6%9E%90%E6%B6%88%E6%81%AF%E6%95%B0%E9%87%8F" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>æ˜¯ä»€ä¹ˆ</strong>ï¼šæ¯æ¬¡è°ƒç”¨æ¨¡å‹è¿›è¡Œåˆ†ææ—¶ï¼Œè¾“å…¥ç»™æ¨¡å‹çš„<strong>æ•°æ®å—å¤§å°</strong>ï¼Œä¸»è¦å—æ¨¡å‹ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶ã€‚</li>
<li><strong>ç¤ºä¾‹</strong>ï¼šè®°å¿†é˜ˆå€¼=<code>100</code>ï¼Œå•æ¬¡åˆ†æé‡=<code>20</code>Â â†’ ç³»ç»Ÿä¼šå°†100è½®å¯¹è¯åˆ‡åˆ†ä¸º5ä¸ª20è½®çš„å—ï¼Œåˆ†æ‰¹åˆ†æåæ±‡æ€»ç»“æœã€‚</li>
<li><strong>ä¸ºä»€ä¹ˆ</strong>ï¼šè§£å†³<strong>é•¿ä¸Šä¸‹æ–‡æ— æ³•ä¸€æ¬¡æ€§å¤„ç†</strong>çš„é—®é¢˜ï¼Œå®ç°å¤§å¯¹è¯é‡çš„åˆ†å—åˆ†æã€‚</li>
</ul>
<h4 data-id="heading-49">ğŸ“ è®°å¿†æœ€å¤§é•¿åº¦</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E8%25AE%25B0%25E5%25BF%2586%25E6%259C%2580%25E5%25A4%25A7%25E9%2595%25BF%25E5%25BA%25A6" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E8%AE%B0%E5%BF%86%E6%9C%80%E5%A4%A7%E9%95%BF%E5%BA%A6" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>æ˜¯ä»€ä¹ˆ</strong>ï¼šå¯¹ç”Ÿæˆçš„è®°å¿†å†…å®¹ï¼ˆæ‘˜è¦/å›¾è°±ï¼‰è®¾å®šçš„<strong>é•¿åº¦é™åˆ¶å™¨</strong>ã€‚å½“è®°å¿†å†…å®¹è¶…è¿‡è¯¥å­—æ•°é™åˆ¶æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è§¦å‘å‹ç¼©ï¼Œä¿ç•™æ ¸å¿ƒã€èˆå¼ƒæ¬¡è¦ä¿¡æ¯ã€‚</li>
<li><strong>ä¸ºä»€ä¹ˆ</strong>ï¼šé˜²æ­¢è®°å¿†<strong>æ— é™è†¨èƒ€</strong>ï¼Œå½±å“åç»­ä½¿ç”¨çš„æ£€ç´¢æ•ˆç‡ã€å‡†ç¡®æ€§å’Œæˆæœ¬ã€‚</li>
</ul>
<h4 data-id="heading-50">ğŸ”„ â€œæ˜¯å¦åˆ©ç”¨å†å²è®°å¿†â€ çš„é€»è¾‘å·®å¼‚</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E6%2598%25AF%25E5%2590%25A6%25E5%2588%25A9%25E7%2594%25A8%25E5%258E%2586%25E5%258F%25B2%25E8%25AE%25B0%25E5%25BF%2586-%25E7%259A%2584%25E9%2580%25BB%25E8%25BE%2591%25E5%25B7%25AE%25E5%25BC%2582" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E6%98%AF%E5%90%A6%E5%88%A9%E7%94%A8%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BF%86-%E7%9A%84%E9%80%BB%E8%BE%91%E5%B7%AE%E5%BC%82" ref="nofollow noopener noreferrer"/></p>
<p>å‡è®¾Â <strong>è®°å¿†é˜ˆå€¼ = 20</strong>ï¼Œå½“å‰å·²å¯¹è¯Â <strong>39 è½®</strong>ï¼Œä¸”ç¬¬1-20è½®çš„å¯¹è¯å·²ç”Ÿæˆ<strong>å†å²è®°å¿†A</strong>ã€‚ å½“<strong>ç¬¬40è½®å¯¹è¯å®Œæˆ</strong>æ—¶ï¼ˆ<code>40 % 20 = 0</code>ï¼‰ï¼Œä¼šè§¦å‘æ–°ä¸€è½®è®°å¿†ç”Ÿæˆã€‚</p>























<table><thead><tr><th align="left">é€‰é¡¹</th><th align="left">å·¥ä½œæ¨¡å¼</th><th align="left">æ ¸å¿ƒæµç¨‹</th><th align="left">ä¼˜ç‚¹ä¸åœºæ™¯</th></tr></thead><tbody><tr><td align="left"><strong>å¯ç”¨ï¼ˆæ˜¯ï¼‰</strong> <em><strong>å¢é‡æ›´æ–°</strong></em></td><td align="left">åœ¨å·²æœ‰è®°å¿†åŸºç¡€ä¸Šæ›´æ–°ã€‚</td><td align="left">1. ç”¨<strong>åŸºç¡€æç¤ºè¯</strong>åˆ†æç¬¬21-40è½®ï¼Œç”Ÿæˆ<strong>æ–°è®°å¿†B</strong>ã€‚ 2. ç”¨<strong>æ›´æ–°æç¤ºè¯</strong>ï¼Œå°†<strong>å†å²è®°å¿†A</strong>ä¸<strong>æ–°è®°å¿†B</strong>åˆå¹¶ï¼Œç”Ÿæˆ<strong>æœ€ç»ˆè®°å¿†C</strong>ã€‚ 3. å­˜å…¥<strong>è®°å¿†C</strong>ã€‚</td><td align="left"><strong>ä¼˜ç‚¹</strong>ï¼šæ•ˆç‡é«˜ã€æˆæœ¬ä½ï¼ˆä»…åˆ†ææ–°å¢å¯¹è¯ï¼‰ã€‚ <strong>åœºæ™¯</strong>ï¼šå¸¸è§„ç”Ÿäº§ç¯å¢ƒã€‚æç¤ºè¯ç¨³å®šï¼Œéœ€æŒç»­ç´¯ç§¯è®°å¿†ã€‚</td></tr><tr><td align="left"><strong>ä¸å¯ç”¨ï¼ˆå¦ï¼‰</strong> <em><strong>å…¨é‡é‡ç®—</strong></em></td><td align="left">å¿½ç•¥å·²æœ‰è®°å¿†ï¼Œé‡æ–°è®¡ç®—å…¨éƒ¨ã€‚</td><td align="left">1. ç”¨<strong>åŸºç¡€æç¤ºè¯****é‡æ–°åˆ†æ</strong>ç¬¬1-20è½®ï¼Œç”Ÿæˆ<strong>æ–°è®°å¿†Bâ€˜</strong> ï¼ˆé‡æ–°è®¡ç®—ï¼‰ã€‚ 2. ç”¨<strong>åŸºç¡€æç¤ºè¯</strong>åˆ†æç¬¬21-40è½®ï¼Œç”Ÿæˆ<strong>æ–°è®°å¿†Câ€˜</strong> ã€‚ 3. ç”¨<strong>æ›´æ–°æç¤ºè¯</strong>ï¼Œå°†<strong>Bâ€˜</strong> Â å’ŒÂ <strong>Câ€˜</strong> Â åˆå¹¶ï¼Œç”Ÿæˆ<strong>æœ€ç»ˆè®°å¿†D</strong>ã€‚ 4. å­˜å…¥<strong>è®°å¿†D</strong>ã€‚</td><td align="left"><strong>ç¼ºç‚¹</strong>ï¼šæˆæœ¬é«˜ï¼ˆé‡å¤åˆ†ææ—§æ•°æ®ï¼‰ã€æ•ˆç‡ä½ã€‚ <strong>åœºæ™¯</strong>ï¼š<strong>æç¤ºè¯è¿­ä»£è°ƒè¯•æœŸ</strong>ã€‚ä¿®æ”¹æç¤ºè¯åï¼Œéœ€è¦æ‰€æœ‰å†å²æ•°æ®æŒ‰æ–°è§„åˆ™é‡æ–°ç”Ÿæˆï¼Œä¿è¯å…¨å±€ä¸€è‡´æ€§ã€‚</td></tr></tbody></table>
<h4 data-id="heading-51">âœï¸ è‡ªå®šä¹‰æç¤ºè¯</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25EF%25B8%258F-%25E8%2587%25AA%25E5%25AE%259A%25E4%25B9%2589%25E6%258F%2590%25E7%25A4%25BA%25E8%25AF%258D" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%EF%B8%8F-%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8F%90%E7%A4%BA%E8%AF%8D" ref="nofollow noopener noreferrer"/></p>
<p>å‰è¿°è®°å¿†åŠŸèƒ½æ¶‰åŠå¤šä¸ªéœ€è¦æç¤ºè¯çš„ç¯èŠ‚ï¼Œå› æ­¤ç³»ç»Ÿæ”¯æŒ<strong>è‡ªå®šä¹‰æç¤ºè¯</strong>ã€‚å¦‚ä¸å¡«å†™ï¼Œåˆ™é»˜è®¤é‡‡ç”¨ç³»ç»Ÿé¢„ç½®é…ç½®ã€‚</p>
<p>æˆ‘ä»¬å°†æç¤ºè¯åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ol>
<li><strong>åŸºç¡€æç¤ºè¯</strong>ï¼šç”¨äºä»åŸå§‹å¯¹è¯å—ä¸­é¦–æ¬¡æå–è®°å¿†ã€‚</li>
<li><strong>æ›´æ–°æç¤ºè¯</strong>ï¼šç”¨äºå°†æ–°æ—§ä¸¤ä»½è®°å¿†åˆå¹¶æˆä¸€ä»½æ›´æ–°çš„è®°å¿†ã€‚</li>
<li><strong>è¶…é•¿æç¤ºè¯</strong>ï¼šç”¨äºå½“è®°å¿†å†…å®¹è¶…è¿‡â€œè®°å¿†æœ€å¤§é•¿åº¦â€æ—¶ï¼Œå¯¹å…¶è¿›è¡Œå‹ç¼©å’Œç²¾ç®€ã€‚</li>
</ol>
<p><strong>ğŸ¯ ç»¼åˆç¤ºä¾‹</strong></p>
<ul>
<li><strong>é™åˆ¶æ¡ä»¶</strong>ï¼šè®°å¿†é˜ˆå€¼=<code>20</code>ï¼Œå•æ¬¡åˆ†æé‡=<code>20</code>ï¼Œå¯ç”¨å†å²è®°å¿†ï¼Œæœ€å¤§é•¿åº¦=<code>500</code></li>
<li><strong>å½“å‰çŠ¶æ€</strong>ï¼šåˆšå®Œæˆç¬¬100æ¬¡å¯¹è¯ï¼Œå·²æœ‰<strong>è®°å¿†A (1-80)</strong></li>
<li><strong>æ‰§è¡Œæµç¨‹</strong>ï¼š</li>
</ul>
<ol>
<li>ä½¿ç”¨<strong>åŸºç¡€æç¤ºè¯</strong>ï¼Œåˆ†æç¬¬81-100è½®å¯¹è¯ï¼Œæå–å¾—åˆ°<strong>è®°å¿†B (81-100)</strong> ã€‚</li>
<li>ä½¿ç”¨<strong>æ›´æ–°æç¤ºè¯</strong>ï¼Œå°†<strong>è®°å¿†A (1-80)</strong> Â å’ŒÂ <strong>è®°å¿†B (81-100)</strong> Â åˆå¹¶ï¼Œå¾—åˆ°<strong>è®°å¿†C (1-100)</strong> ã€‚</li>
<li>æ£€æŸ¥å‘ç°<strong>è®°å¿†C</strong>é•¿åº¦è¶…è¿‡500å­—ï¼Œè§¦å‘å‹ç¼©ã€‚</li>
<li>ä½¿ç”¨<strong>è¶…é•¿æç¤ºè¯</strong>ï¼Œå¯¹<strong>è®°å¿†C</strong>è¿›è¡Œç²¾ç®€ï¼Œå¾—åˆ°<strong>è®°å¿†D (1-100)</strong> ã€‚</li>
<li>æœ€ç»ˆï¼Œå°†<strong>è®°å¿†D</strong>å­˜å…¥æ•°æ®åº“ã€‚</li>
</ol>
<blockquote>
<p><strong>æç¤º</strong>ï¼šå„é¡¹å‚æ•°ï¼ˆé˜ˆå€¼ã€åˆ†æé‡ã€é•¿åº¦ç­‰ï¼‰çš„æœ€ä½³é…ç½®å€¼ï¼Œéœ€æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯ã€æˆæœ¬é¢„ç®—å’Œå¯¹è®°å¿†ç²¾ç»†åº¦çš„è¦æ±‚æ¥å†³å®šã€‚</p>
</blockquote>
<h2 data-id="heading-52">4.3 èŠå¤©é…ç½®</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40976930fbd7451fb90d687531739b26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=UjI%2FKt8yqwIYaG5Vbt%2BpULhAxIY%3D" alt="chat-profile.png" loading="lazy"/></p>
<p>èŠå¤©é…ç½®é¡µé¢çš„æ ¸å¿ƒåŠŸèƒ½æ˜¯<strong>ç”Ÿæˆå’Œç®¡ç†è®¿é—®å¯†é’¥ï¼ˆSKï¼‰</strong> ã€‚å…¶æ ¸å¿ƒæ“ä½œåœ¨åˆ›å»ºé…ç½®çš„å¼¹çª—ä¸­å®Œæˆã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09cd4fda97854ea2b4af1aa67f19b0a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=9mWyPn9495U7KiYA03ao0h47ORU%3D" alt="chat-profile-1.png" loading="lazy"/></p>
<h3 data-id="heading-53">ğŸ”§ åˆ›å»ºèŠå¤©é…ç½®</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E5%2588%259B%25E5%25BB%25BA%25E8%2581%258A%25E5%25A4%25A9%25E9%2585%258D%25E7%25BD%25AE" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E5%88%9B%E5%BB%BA%E8%81%8A%E5%A4%A9%E9%85%8D%E7%BD%AE" ref="nofollow noopener noreferrer"/></p>
<p>åˆ›å»ºæ–°çš„èŠå¤©é…ç½®ï¼ˆå³ç”Ÿæˆä¸€ä¸ªSKï¼‰ï¼Œéœ€å¡«å†™ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š</p>
<ol>
<li><strong>é€‰æ‹©æ¨¡å‹</strong>ï¼šä»å·²é…ç½®çš„æ¨¡å‹ï¼ˆå‚è§Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2341-%25E6%25A8%25A1%25E5%259E%258B%25E9%2585%258D%25E7%25BD%25AE" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#41-%E6%A8%A1%E5%9E%8B%E9%85%8D%E7%BD%AE" ref="nofollow noopener noreferrer">4.1 æ¨¡å‹é…ç½®</a>ï¼‰ä¸­é€‰æ‹©ä¸€ä¸ªã€‚</li>
<li><strong>é€‰æ‹©è®°å¿†ç­–ç•¥</strong>ï¼šä»å·²é…ç½®çš„è®°å¿†ç­–ç•¥ï¼ˆå‚è§Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2342-%25E8%25AE%25B0%25E5%25BF%2586%25E7%25AD%2596%25E7%2595%25A5" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#42-%E8%AE%B0%E5%BF%86%E7%AD%96%E7%95%A5" ref="nofollow noopener noreferrer">4.2 è®°å¿†ç­–ç•¥</a>ï¼‰ä¸­é€‰æ‹©ä¸€ç§ã€‚</li>
<li><strong>è¾“å…¥Tokenä¸Šé™</strong>ï¼šè®¾ç½®<strong>æ­¤SKä¸‹æ‰€æœ‰ä¼šè¯åˆè®¡</strong>å…è®¸çš„<strong>å•æ—¥Tokenæ¶ˆè€—ä¸Šé™</strong>ã€‚</li>
<li><strong>ç‚¹å‡»ä¿å­˜</strong>ï¼šå®Œæˆåˆ›å»ºã€‚</li>
</ol>
<h3 data-id="heading-54">ğŸ”‘ è·å–ä¸ä½¿ç”¨SK</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E8%258E%25B7%25E5%258F%2596%25E4%25B8%258E%25E4%25BD%25BF%25E7%2594%25A8sk" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E8%8E%B7%E5%8F%96%E4%B8%8E%E4%BD%BF%E7%94%A8sk" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>è·å–SK</strong>ï¼šé…ç½®åˆ›å»ºæˆåŠŸåï¼Œé¡µé¢å°†<strong>å±•ç¤ºç”Ÿæˆçš„SKå€¼</strong>ã€‚</li>
<li><strong>ä½¿ç”¨SK</strong>ï¼šå¦‚åœ¨Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2312-%25E9%2580%259A%25E8%25BF%2587%25E7%25AE%25A1%25E7%2590%2586%25E5%258F%25B0%25E5%2588%259B%25E5%25BB%25BA%25E4%25BC%259A%25E8%25AF%259D" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#12-%E9%80%9A%E8%BF%87%E7%AE%A1%E7%90%86%E5%8F%B0%E5%88%9B%E5%BB%BA%E4%BC%9A%E8%AF%9D" ref="nofollow noopener noreferrer">1.2 é€šè¿‡ç®¡ç†å°åˆ›å»ºä¼šè¯</a>Â ä¸­æ‰€è¿°ï¼Œåœ¨ç®¡ç†å°åˆ›å»ºæ–°ä¼šè¯æ—¶ï¼Œéœ€è¦ä¼ å…¥çš„æ­£æ˜¯æ­¤SKå€¼ã€‚</li>
</ul>
<h3 data-id="heading-55">ğŸ’¡ é…ç½®å…³ç³»è¯´æ˜</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E9%2585%258D%25E7%25BD%25AE%25E5%2585%25B3%25E7%25B3%25BB%25E8%25AF%25B4%25E6%2598%258E" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E9%85%8D%E7%BD%AE%E5%85%B3%E7%B3%BB%E8%AF%B4%E6%98%8E" ref="nofollow noopener noreferrer"/></p>
<ul>
<li><strong>ä¸€ä¸ªSKå¯¹åº”å¤šä¸ªä¼šè¯</strong>ï¼šæ¯ä¸ªèŠå¤©é…ç½®ï¼ˆSKï¼‰ä¸‹å¯ä»¥åˆ›å»ºå’Œç®¡ç†å¤šä¸ªç‹¬ç«‹çš„èŠå¤©ä¼šè¯ã€‚</li>
<li><strong>Tokené™é¢è®¾è®¡</strong>ï¼š</li>
<li><strong>èŠå¤©é…ç½®çš„Tokenä¸Šé™</strong>ï¼šæŒ‡è¯¥SKä¸‹<strong>æ‰€æœ‰ä¼šè¯ç´¯è®¡</strong>çš„æ¯æ—¥æ¶ˆè€—é™é¢ã€‚</li>
<li><strong>ä¼šè¯çš„Tokenä¸Šé™</strong>ï¼šæŒ‡<strong>å•ä¸ªä¼šè¯</strong>çš„æ¯æ—¥æ¶ˆè€—é™é¢ï¼ˆåœ¨è®°å¿†ç­–ç•¥ä¸­é…ç½®ï¼‰ã€‚</li>
<li><strong>å…³ç³»å»ºè®®</strong>ï¼šä¸ºç¡®ä¿ä¸šåŠ¡æ­£å¸¸è¿è¡Œï¼Œ<code>èŠå¤©é…ç½®çš„Tokenä¸Šé™</code>Â åº”Â <strong>å¤§äº</strong>Â <code>ä¼šè¯Tokenä¸Šé™ Ã— é¢„ä¼°çš„å¹³å‡ä¼šè¯æ•°</code>ã€‚å…·ä½“æ•°å€¼éœ€æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯å’Œå¹¶å‘é‡è¿›è¡Œè§„åˆ’ã€‚</li>
</ul>
<h2 data-id="heading-56">4.4 å†å²ä¼šè¯ç®¡ç†</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc243dbc5fb948f29b72215f8ef51305~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=nKwlXbupMGdWvOgr3tw1lbipog8%3D" alt="conversation.png" loading="lazy"/></p>
<p>å½“é€šè¿‡å®¢æˆ·ç«¯è°ƒç”¨<code>chat</code>æ¥å£åï¼Œç³»ç»Ÿä¼šè§¦å‘<code>afterChat</code>æ–¹æ³•ã€‚æ­¤æ–¹æ³•å°†ç»“åˆÂ <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2341-%25E6%25A8%25A1%25E5%259E%258B%25E9%2585%258D%25E7%25BD%25AE" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#41-%E6%A8%A1%E5%9E%8B%E9%85%8D%E7%BD%AE" ref="nofollow noopener noreferrer">4.1 æ¨¡å‹é…ç½®</a></strong>Â å’ŒÂ <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2342-%25E8%25AE%25B0%25E5%25BF%2586%25E7%25AD%2596%25E7%2595%25A5" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#42-%E8%AE%B0%E5%BF%86%E7%AD%96%E7%95%A5" ref="nofollow noopener noreferrer">4.2 è®°å¿†ç­–ç•¥</a></strong>Â ä¸­çš„è®¾å®šï¼Œè‡ªåŠ¨è®°å½•æœ¬æ¬¡ä¼šè¯çš„<strong>æ¶ˆæ¯å†…å®¹</strong>ã€<strong>æˆæœ¬æ¶ˆè€—</strong>ä¸<strong>è®°å¿†æ‘˜è¦</strong>ã€‚</p>
<h3 data-id="heading-57">ğŸ“œ æ¶ˆæ¯å†…å®¹é¡µé¢</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E6%25B6%2588%25E6%2581%25AF%25E5%2586%2585%25E5%25AE%25B9%25E9%25A1%25B5%25E9%259D%25A2" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E6%B6%88%E6%81%AF%E5%86%85%E5%AE%B9%E9%A1%B5%E9%9D%A2" ref="nofollow noopener noreferrer"/></p>
<p>æ­¤é¡µé¢æŒ‰æ—¶é—´é¡ºåºå®Œæ•´å±•ç¤ºä¼šè¯ä¸­çš„æ‰€æœ‰å¯¹è¯è®°å½•ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d399e93bb404863b41b8f2886683ffb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=dSCTm7tqxm0jX4yi2esvHfh9kaA%3D" alt="conversation-1.png" loading="lazy"/></p>
<h3 data-id="heading-58">ğŸ§  è®°å¿†é¡µé¢</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E8%25AE%25B0%25E5%25BF%2586%25E9%25A1%25B5%25E9%259D%25A2" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E8%AE%B0%E5%BF%86%E9%A1%B5%E9%9D%A2" ref="nofollow noopener noreferrer"/></p>
<blockquote>
<p>æ­¤é¡µé¢å±•ç¤ºçš„æ¶ˆæ¯å†…å®¹ï¼Œå–å†³äºå…·ä½“çš„è®°å¿†ç­–ç•¥ï¼Œå’Œè®°å¿†è¿›åº¦ï¼Œæ¯”å¦‚ï¼Œå¦‚ä¸‹ä¸ºæˆªæ–­ç±»å‹çš„è®°å¿†</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c33f1ff928534f0dae1ee58de000b9f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=FHvHBlx%2FqR4xhWVbbzpak%2FEw%2F78%3D" alt="conversation-11.png" loading="lazy"/></p>
<h3 data-id="heading-59">ğŸ’° æˆæœ¬é¡µé¢</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23-%25E6%2588%2590%25E6%259C%25AC%25E9%25A1%25B5%25E9%259D%25A2" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#-%E6%88%90%E6%9C%AC%E9%A1%B5%E9%9D%A2" ref="nofollow noopener noreferrer"/></p>
<p>æ­¤é¡µé¢è¯¦ç»†åˆ—å‡ºè¯¥ä¼šè¯äº§ç”Ÿçš„æ‰€æœ‰Tokenæ¶ˆè€—åŠå¯¹åº”çš„æˆæœ¬è®¡ç®—ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15d12369c0124a91819fd2439af10c4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=10EidLS3d1fJBaz1sLiS6DcNUws%3D" alt="conversation-2.png" loading="lazy"/></p>
<ul>
<li><strong>æŸ¥çœ‹æ˜ç»†</strong>ï¼šç‚¹å‡»Â <strong><code>è¯¦æƒ…</code></strong>Â æŒ‰é’®ï¼ŒæŸ¥çœ‹æŸæ¬¡å…·ä½“è°ƒç”¨æ—¶çš„è¾“å…¥(Input)ä¸è¾“å‡º(Output)è¯¦æƒ…</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/686f3c2296c44f8fadaac678a99c7c8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=7D%2Bjp4dKClrv03DDLJeO44mITlA%3D" alt="conversation-3.png" loading="lazy"/></p>
<h2 data-id="heading-60">5è®°å¿†ç­–ç•¥Demo</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%235%25E8%25AE%25B0%25E5%25BF%2586%25E7%25AD%2596%25E7%2595%25A5demo" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#5%E8%AE%B0%E5%BF%86%E7%AD%96%E7%95%A5demo" ref="nofollow noopener noreferrer"/></p>
<h3 data-id="heading-61">5.1æˆªæ–­Demo</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2351%25E6%2588%25AA%25E6%2596%25ADdemo" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#51%E6%88%AA%E6%96%ADdemo" ref="nofollow noopener noreferrer"/></p>
<pre><code class="hljs language-ini" lang="ini">package io.github.johntortoise.demo.controller<span class="hljs-comment">;</span>

import io.github.johntortoise.core.client.TortoiseClient<span class="hljs-comment">;</span>
import io.github.johntortoise.core.dto.model.ChatCompletionResponse<span class="hljs-comment">;</span>
import io.github.johntortoise.core.dto.sys.TortoiseMessage<span class="hljs-comment">;</span>

public class Test {

    public static String <span class="hljs-attr">host</span> = <span class="hljs-string">"http://localhost:8080"</span><span class="hljs-comment">;</span>

    /**
     *  æ­¤skï¼Œè¯·é…ç½®è®°å¿†ç­–ç•¥ä¸ºæˆªæ–­ç­–ç•¥ï¼Œæœ€æ–°æ¶ˆæ¯æ•°ä¸º2
     */
    public static String <span class="hljs-attr">sk</span> = <span class="hljs-string">"sk-428acddd-6ced-4e33-a9cb-ec96c980cf02"</span><span class="hljs-comment">;</span>

    private final static TortoiseClient&lt;ChatCompletionResponse&gt; <span class="hljs-attr">tortoiseClient</span> = TortoiseClient.createForAdmin(ChatCompletionResponse.class,host,sk)<span class="hljs-comment">;</span>

    public static void main(String<span class="hljs-section">[]</span> args) throws InterruptedException {
        String <span class="hljs-attr">conversationId</span> = tortoiseClient.createConversation(<span class="hljs-string">"zgsssjznbdgj"</span>)<span class="hljs-comment">;</span>

        //ç¬¬ä¸€æ¡
        TortoiseMessage <span class="hljs-attr">firstMessage</span> = new TortoiseMessage(<span class="hljs-string">"ä½ å¥½,æˆ‘å«ç‹å¤§åŠ›"</span>)<span class="hljs-comment">;</span>
        firstMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
        tortoiseClient.chatForAdmin(firstMessage)<span class="hljs-comment">;</span>

        Thread.sleep(2000L)<span class="hljs-comment">;</span>

        //ç¬¬äºŒæ¡
        TortoiseMessage <span class="hljs-attr">secondMessage</span> = new TortoiseMessage(<span class="hljs-string">"æˆ‘å«ä»€ä¹ˆåå­—ï¼Œç›´æ¥å‘Šè¯‰æˆ‘"</span>)<span class="hljs-comment">;</span>
        secondMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
        tortoiseClient.chatForAdmin(secondMessage)<span class="hljs-comment">;</span>

        Thread.sleep(2000L)<span class="hljs-comment">;</span>

        //ç¬¬ä¸‰æ¡(ä¸Šä¸‹æ–‡æ˜¯1-2)
        TortoiseMessage <span class="hljs-attr">thirdMessage</span> = new TortoiseMessage(<span class="hljs-string">"ä»Šå¤©åŒ—äº¬çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"</span>)<span class="hljs-comment">;</span>
        thirdMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
        tortoiseClient.chatForAdmin(thirdMessage)<span class="hljs-comment">;</span>

        Thread.sleep(2000L)<span class="hljs-comment">;</span>

        //ç¬¬å››æ¡(ä¸Šä¸‹æ–‡æ˜¯2-3)
        TortoiseMessage <span class="hljs-attr">fourthMessage</span> = new TortoiseMessage(<span class="hljs-string">"æˆ‘éœ€è¦ç©¿ä»€ä¹ˆè¡£æœï¼Ÿ"</span>)<span class="hljs-comment">;</span>
        fourthMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
        tortoiseClient.chatForAdmin(fourthMessage)<span class="hljs-comment">;</span>

        Thread.sleep(2000L)<span class="hljs-comment">;</span>

        //ç¬¬äº”æ¡(ä¸Šä¸‹æ–‡æ˜¯3-4ï¼Œè¿™é‡Œåº”è¯¥å›ç­”ä¸å‡ºæ¥äº†)
        TortoiseMessage <span class="hljs-attr">fifthMessage</span> = new TortoiseMessage(<span class="hljs-string">"æˆ‘å«ä»€ä¹ˆåå­—ï¼Œç›´æ¥å‘Šè¯‰æˆ‘"</span>)<span class="hljs-comment">;</span>
        fifthMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
        tortoiseClient.chatForAdmin(fifthMessage)<span class="hljs-comment">;</span>

    }
}
</code></pre>
<p>çœ‹ä¸€ä¸‹demoè¿è¡Œåçš„å¯¹è¯å†…å®¹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4008aef31e9b498d8be34fb7b1a3608c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=1bdKo9SRBJGo9yEvnd9FhqpC2xg%3D" alt="conversation-4.png" loading="lazy"/></p>
<p>ç”±äºé…ç½®çš„æœ€è¿‘æ¶ˆæ¯æ•°æ˜¯ä¸¤è½®ï¼Œæ‰€ä»¥å½“ç¬¬äº”æ¬¡è¯¢é—®å¤§æ¨¡å‹æ—¶ï¼Œå…¶å·²ç»ä¸¢å¤±äº†åå­—ä¿¡æ¯</p>
<h3 data-id="heading-62">5.2æ‘˜è¦Demo</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2352%25E6%2591%2598%25E8%25A6%2581demo" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#52%E6%91%98%E8%A6%81demo" ref="nofollow noopener noreferrer"/></p>
<pre><code class="hljs language-ini" lang="ini">package io.github.johntortoise.demo.controller<span class="hljs-comment">;</span>

import io.github.johntortoise.core.client.TortoiseClient<span class="hljs-comment">;</span>
import io.github.johntortoise.core.dto.model.ChatCompletionResponse<span class="hljs-comment">;</span>
import io.github.johntortoise.core.dto.sys.TortoiseMessage<span class="hljs-comment">;</span>

public class Test {

 public static String <span class="hljs-attr">host</span> = <span class="hljs-string">"http://localhost:8080"</span><span class="hljs-comment">;</span>

 /**
  *  æ­¤skï¼Œè¯·é…ç½®è®°å¿†ç­–ç•¥ä¸ºæ‘˜è¦ç­–ç•¥ï¼Œé˜ˆå€¼ä¸º2ï¼Œå•æ¬¡åˆ†æ2ï¼Œå¯ç”¨å†å²è®°å¿†ï¼Œæœ€å¤§è®°å¿†é•¿åº¦ä¸º100
  */
 public static String <span class="hljs-attr">sk</span> = <span class="hljs-string">"sk-c09eefbb-4172-4724-8af1-e14eb86d8a40"</span><span class="hljs-comment">;</span>

 private final static TortoiseClient&lt;ChatCompletionResponse&gt; <span class="hljs-attr">tortoiseClient</span> = TortoiseClient.createForAdmin(ChatCompletionResponse.class,host,sk)<span class="hljs-comment">;</span>

 public static void main(String<span class="hljs-section">[]</span> args) throws InterruptedException {
  String <span class="hljs-attr">conversationId</span> = tortoiseClient.createConversation(<span class="hljs-string">"zgsssjznbdgj"</span>)<span class="hljs-comment">;</span>

  //ç¬¬ä¸€æ¡
  TortoiseMessage <span class="hljs-attr">firstMessage</span> = new TortoiseMessage(<span class="hljs-string">"ä½ å¥½,æˆ‘å«ç‹å¤§åŠ›"</span>)<span class="hljs-comment">;</span>
  firstMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
  tortoiseClient.chatForAdmin(firstMessage)<span class="hljs-comment">;</span>

  Thread.sleep(2000L)<span class="hljs-comment">;</span>

  //ç¬¬äºŒæ¡
  TortoiseMessage <span class="hljs-attr">secondMessage</span> = new TortoiseMessage(<span class="hljs-string">"æˆ‘å«ä»€ä¹ˆåå­—ï¼Œç›´æ¥å‘Šè¯‰æˆ‘"</span>)<span class="hljs-comment">;</span>
  secondMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
  tortoiseClient.chatForAdmin(secondMessage)<span class="hljs-comment">;</span>

  //è¿™é‡Œç¡çœ 10ç§’ç­‰ä¸€ä¸‹è®°å¿†
  Thread.sleep(10000L)<span class="hljs-comment">;</span>

  //ç¬¬ä¸‰æ¡(ä¸Šä¸‹æ–‡ï¼šè®°å¿†A(1-2))
  TortoiseMessage <span class="hljs-attr">thirdMessage</span> = new TortoiseMessage(<span class="hljs-string">"ä»Šå¤©åŒ—äº¬çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"</span>)<span class="hljs-comment">;</span>
  thirdMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
  tortoiseClient.chatForAdmin(thirdMessage)<span class="hljs-comment">;</span>

  Thread.sleep(2000L)<span class="hljs-comment">;</span>

  //ç¬¬å››æ¡(ä¸Šä¸‹æ–‡ï¼šè®°å¿†A(1-2) å’Œ3çš„è¾“å…¥è¾“å‡º)
  TortoiseMessage <span class="hljs-attr">fourthMessage</span> = new TortoiseMessage(<span class="hljs-string">"æˆ‘éœ€è¦ç©¿ä»€ä¹ˆè¡£æœï¼Ÿ"</span>)<span class="hljs-comment">;</span>
  fourthMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
  tortoiseClient.chatForAdmin(fourthMessage)<span class="hljs-comment">;</span>

  //è¿™é‡Œç¡çœ 10ç§’ç­‰ä¸€ä¸‹è®°å¿†
  Thread.sleep(10000L)<span class="hljs-comment">;</span>

  //ç¬¬äº”æ¡(ä¸Šä¸‹æ–‡ ï¼šè®°å¿†B(1-4) æˆ– ä¸Šä¸‹æ–‡å‘¢è®°å¿†A(1-2)å’Œ3ï¼Œ4çš„è¾“å…¥è¾“å‡º å–å†³äºè®°å¿†æœ‰æ²¡æœ‰ç”Ÿæˆï¼Œå¦‚æœæ²¡ç”Ÿæˆï¼Œæ‹¿çš„æ˜¯è®°å¿†å’Œè®°å¿†ä¹‹å¤–çš„æ‰€æœ‰æ¶ˆæ¯))
  TortoiseMessage <span class="hljs-attr">fifthMessage</span> = new TortoiseMessage(<span class="hljs-string">"æˆ‘å«ä»€ä¹ˆåå­—ï¼Œç›´æ¥å‘Šè¯‰æˆ‘"</span>)<span class="hljs-comment">;</span>
  fifthMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
  tortoiseClient.chatForAdmin(fifthMessage)<span class="hljs-comment">;</span>

 }
}
</code></pre>
<p>çœ‹ä¸€ä¸‹å¯¹è¯è¿‡ç¨‹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb799502cd8d45898ec226b92892bef7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=cgomwqavh54NdBos1Gs2gQ3bO1I%3D" alt="conversation-5.png" loading="lazy"/></p>
<p>ä»å¯¹è¯å¯ä»¥çœ‹åˆ°ï¼Œæœ€åä¸€é—®çš„æ—¶å€™å›ç­”å‡ºäº†æˆ‘ä»¬çš„åå­—ï¼Œä¸æˆªæ–­ä¸åŒ å†çœ‹å½“å‰çš„è®°å¿†</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/968de97cb5854845bebe62c94b7d3a3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=cznic49ZfqtJ9sPIiRddzVYtcvA%3D" alt="conversation-6.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°ä¸€æ®µæ€»ç»“ï¼Œè¿˜æœ‰ç¬¬äº”è½®å¯¹è¯ï¼Œå› ä¸ºç¬¬äº”è½®å¯¹è¯è¿˜æœªç”Ÿæˆè®°å¿†</p>
<p>ä½¿ç”¨æˆæœ¬</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf3a36ef7c6f459e9f68897a65db45f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=Ki7dIN6utEGMqtYkbzunvpJPUNU%3D" alt="conversation-7.png" loading="lazy"/></p>
<p>å¯ä»¥çœ‹åˆ°æ˜¯ ä¼šè¯â†’ä¼šè¯â†’è®°å¿†ç”Ÿæˆ(è¾¾åˆ°é˜ˆå€¼è§¦å‘)â†’ä¼šè¯â†’ä¼šè¯â†’è®°å¿†ç”Ÿæˆ(è¾¾åˆ°é˜ˆå€¼è§¦å‘)â†’è®°å¿†æ›´æ–°(è¿™é‡Œæ˜¯å°†1-2çš„è®°å¿†å’Œ3-4çš„è®°å¿†æ›´æ–°)â†’è®°å¿†ç²¾ç®€(ç”±äºæœ€ç»ˆæ›´æ–°çš„è®°å¿†è¿˜æ˜¯è¶…è¿‡äº†é•¿åº¦ï¼Œæ‰€ä»¥è§¦å‘äº†ç²¾ç®€)â†’ä¼šè¯</p>
<h3 data-id="heading-63">5.3å›¾è°±Demo</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2353%25E5%259B%25BE%25E8%25B0%25B1demo" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#53%E5%9B%BE%E8%B0%B1demo" ref="nofollow noopener noreferrer"/></p>
<pre><code class="hljs language-ini" lang="ini">package io.github.johntortoise.demo.controller<span class="hljs-comment">;</span>

import io.github.johntortoise.core.client.TortoiseClient<span class="hljs-comment">;</span>
import io.github.johntortoise.core.dto.model.ChatCompletionResponse<span class="hljs-comment">;</span>
import io.github.johntortoise.core.dto.sys.TortoiseMessage<span class="hljs-comment">;</span>

public class Test {

    public static String <span class="hljs-attr">host</span> = <span class="hljs-string">"http://localhost:8080"</span><span class="hljs-comment">;</span>

    /**
     *  æ­¤skï¼Œè¯·é…ç½®è®°å¿†ç­–ç•¥ä¸ºæ‘˜è¦ç­–ç•¥ï¼Œé˜ˆå€¼ä¸º2ï¼Œå•æ¬¡åˆ†æ2ï¼Œå¯ç”¨å†å²è®°å¿†
     */
    public static String <span class="hljs-attr">sk</span> = <span class="hljs-string">"sk-b2254cc0-f3fa-4bd3-926b-ddc48fd2ac0e"</span><span class="hljs-comment">;</span>

    private final static TortoiseClient&lt;ChatCompletionResponse&gt; <span class="hljs-attr">tortoiseClient</span> = TortoiseClient.createForAdmin(ChatCompletionResponse.class,host,sk)<span class="hljs-comment">;</span>

    public static void main(String<span class="hljs-section">[]</span> args) throws InterruptedException {
        String <span class="hljs-attr">conversationId</span> = tortoiseClient.createConversation(<span class="hljs-string">"zgsssjznbdgj"</span>)<span class="hljs-comment">;</span>

        //ç¬¬ä¸€æ¡
        TortoiseMessage <span class="hljs-attr">firstMessage</span> = new TortoiseMessage(<span class="hljs-string">"ä½ å¥½,æˆ‘å«ç‹å¤§åŠ›"</span>)<span class="hljs-comment">;</span>
        firstMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
        tortoiseClient.chatForAdmin(firstMessage)<span class="hljs-comment">;</span>

        Thread.sleep(2000L)<span class="hljs-comment">;</span>

        //ç¬¬äºŒæ¡
        TortoiseMessage <span class="hljs-attr">secondMessage</span> = new TortoiseMessage(<span class="hljs-string">"æˆ‘å«ä»€ä¹ˆåå­—ï¼Œç›´æ¥å‘Šè¯‰æˆ‘"</span>)<span class="hljs-comment">;</span>
        secondMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
        tortoiseClient.chatForAdmin(secondMessage)<span class="hljs-comment">;</span>

        //è¿™é‡Œç¡çœ 10ç§’ç­‰ä¸€ä¸‹è®°å¿†
        Thread.sleep(10000L)<span class="hljs-comment">;</span>

        //ç¬¬ä¸‰æ¡(ä¸Šä¸‹æ–‡ï¼šè®°å¿†A(1-2))
        TortoiseMessage <span class="hljs-attr">thirdMessage</span> = new TortoiseMessage(<span class="hljs-string">"ä»Šå¤©åŒ—äº¬çš„å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"</span>)<span class="hljs-comment">;</span>
        thirdMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
        tortoiseClient.chatForAdmin(thirdMessage)<span class="hljs-comment">;</span>

        Thread.sleep(2000L)<span class="hljs-comment">;</span>

        //ç¬¬å››æ¡(ä¸Šä¸‹æ–‡ï¼šè®°å¿†A(1-2) å’Œ3çš„è¾“å…¥è¾“å‡º)
        TortoiseMessage <span class="hljs-attr">fourthMessage</span> = new TortoiseMessage(<span class="hljs-string">"æˆ‘éœ€è¦ç©¿ä»€ä¹ˆè¡£æœï¼Ÿ"</span>)<span class="hljs-comment">;</span>
        fourthMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
        tortoiseClient.chatForAdmin(fourthMessage)<span class="hljs-comment">;</span>

        //è¿™é‡Œç¡çœ 30ç§’ç­‰ä¸€ä¸‹è®°å¿†
        Thread.sleep(30000L)<span class="hljs-comment">;</span>

        //ç¬¬äº”æ¡(ä¸Šä¸‹æ–‡ ï¼šè®°å¿†B(1-4) æˆ– ä¸Šä¸‹æ–‡å‘¢è®°å¿†A(1-2)å’Œ3ï¼Œ4çš„è¾“å…¥è¾“å‡º å–å†³äºè®°å¿†æœ‰æ²¡æœ‰ç”Ÿæˆï¼Œå¦‚æœæ²¡ç”Ÿæˆï¼Œæ‹¿çš„æ˜¯è®°å¿†å’Œè®°å¿†ä¹‹å¤–çš„æ‰€æœ‰æ¶ˆæ¯))
        TortoiseMessage <span class="hljs-attr">fifthMessage</span> = new TortoiseMessage(<span class="hljs-string">"æˆ‘å«ä»€ä¹ˆåå­—ï¼Œç›´æ¥å‘Šè¯‰æˆ‘"</span>)<span class="hljs-comment">;</span>
        fifthMessage.setConversationId(conversationId)<span class="hljs-comment">;</span>
        tortoiseClient.chatForAdmin(fifthMessage)<span class="hljs-comment">;</span>

    }
}
</code></pre>
<p>çœ‹ä¸€ä¸‹è®°å¿†</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce879b0c062449c2a1d6a3023c1f858b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=CT52weeKYKNj8pUOE7TZU%2FF4MM8%3D" alt="conversation-8.png" loading="lazy"/></p>
<h2 data-id="heading-64">6. ä»…æ¥å…¥è®°å¿†åŠŸèƒ½</h2>
<blockquote>
<p><strong>å‰ç½®è¦æ±‚</strong>ï¼šè¯·å…ˆæŒ‰ç…§Â <strong>4.3 ç« èŠ‚</strong>Â å®Œæˆç›¸å…³é…ç½®ã€‚</p>
</blockquote>
<h3 data-id="heading-65">6.1 å¯¼å…¥å†å²æ•°æ®</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2361-%25E5%25AF%25BC%25E5%2585%25A5%25E5%258E%2586%25E5%258F%25B2%25E6%2595%25B0%25E6%258D%25AE" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#61-%E5%AF%BC%E5%85%A5%E5%8E%86%E5%8F%B2%E6%95%B0%E6%8D%AE" ref="nofollow noopener noreferrer"/></p>
<p>æˆ‘ä»¬æä¾›äº†æ•°æ®å¯¼å…¥æ¥å£ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤å¯¼å…¥å†å²å¯¹è¯æ•°æ®ã€‚</p>
<h4 data-id="heading-66">æ“ä½œæ­¥éª¤</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E6%2593%258D%25E4%25BD%259C%25E6%25AD%25A5%25E9%25AA%25A4" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4" ref="nofollow noopener noreferrer"/></p>
<ol>
<li><strong>ç‚¹å‡»å¯¼å…¥æŒ‰é’®</strong>Â <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c19bb857069943848ac788ce8617b749~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=ReUHq5mrHQ3Bm3jTTPG86TnFKGA%3D" alt="import.png" loading="lazy"/></li>
<li><strong>è¿›å…¥å¯¼å…¥é¡µé¢</strong>Â 
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55a8fe2a001e489dacef8c1e8edd08d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=iCKNwOnbRkk8BXSURog5i0PF7pM%3D" alt="import-1.png" loading="lazy"/></li>
<li><strong>ä¸‹è½½å¹¶å¡«å†™æ¨¡æ¿</strong> -   ç‚¹å‡»Â  <strong>â€œä¸‹è½½æ¨¡æ¿â€</strong> Â è·å–æ ‡å‡†æ ¼å¼æ–‡ä»¶ã€‚</li>
</ol>
<h4 data-id="heading-67">æ¨¡æ¿å­—æ®µè¯´æ˜</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E6%25A8%25A1%25E6%259D%25BF%25E5%25AD%2597%25E6%25AE%25B5%25E8%25AF%25B4%25E6%2598%258E" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E6%A8%A1%E6%9D%BF%E5%AD%97%E6%AE%B5%E8%AF%B4%E6%98%8E" ref="nofollow noopener noreferrer"/></p>





















<table><thead><tr><th align="left">å­—æ®µå</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><code>conversation_id</code></td><td align="left">ä¼šè¯æ ‡è¯†ã€‚ä¸€ä¸ªä¼šè¯ï¼ˆConversationï¼‰å¯åŒ…å«å¤šæ¡å¯¹è¯è®°å½•ã€‚</td></tr><tr><td align="left"><code>chat_profile_id</code></td><td align="left">æ ¹æ® 4.3 é…ç½®åç”Ÿæˆçš„é…ç½®IDã€‚<strong>æ³¨æ„ï¼šè¿™ä¸æ˜¯SK</strong>ã€‚</td></tr><tr><td align="left"><code>unique_id</code></td><td align="left">ä»£è¡¨ä¸€æ¬¡â€œä¸€é—®ä¸€ç­”â€çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚</td></tr></tbody></table>
<h4 data-id="heading-68">æ•°æ®å¡«å†™ç¤ºä¾‹</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E6%2595%25B0%25E6%258D%25AE%25E5%25A1%25AB%25E5%2586%2599%25E7%25A4%25BA%25E4%25BE%258B" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E6%95%B0%E6%8D%AE%E5%A1%AB%E5%86%99%E7%A4%BA%E4%BE%8B" ref="nofollow noopener noreferrer"/></p>
<p>å¡«å†™åçš„æ¨¡æ¿æ–‡ä»¶ç¤ºä¾‹å¦‚ä¸‹ï¼šÂ </p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93442def3c7042748e6daddd491d50e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=9MUff6mrDB4JvIsdyMpEwaZQ%2Flw%3D" alt="import-3.png" loading="lazy"/></p>
<h4 data-id="heading-69">æ‰§è¡Œå¯¼å…¥</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E6%2589%25A7%25E8%25A1%258C%25E5%25AF%25BC%25E5%2585%25A5" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E6%89%A7%E8%A1%8C%E5%AF%BC%E5%85%A5" ref="nofollow noopener noreferrer"/></p>
<ol>
<li>ç‚¹å‡»Â  <strong>â€œé€‰æ‹©æ–‡ä»¶â€</strong> ï¼Œä¸Šä¼ å¡«å†™å¥½çš„æ•°æ®æ–‡ä»¶ã€‚</li>
<li>æˆ‘ä»¬ä»¥Â <strong>50ä¸‡è¡Œ</strong>Â çš„æ•°æ®æ–‡ä»¶ä¸ºä¾‹ï¼ˆè·¯å¾„ï¼š<code>docs/img/file/conversation_import_data_500k.xlsx</code>ï¼‰ã€‚</li>
</ol>
<h4 data-id="heading-70">å¯¼å…¥çŠ¶æ€</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E5%25AF%25BC%25E5%2585%25A5%25E7%258A%25B6%25E6%2580%2581" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E5%AF%BC%E5%85%A5%E7%8A%B6%E6%80%81" ref="nofollow noopener noreferrer"/></p>
<ul>
<li>
<p><strong>å¤„ç†ä¸­çŠ¶æ€</strong>Â </p>
<blockquote>
<p>æœ¬æ¬¡ç¤ºä¾‹å¯¼å…¥50ä¸‡è¡Œæ•°æ®ï¼Œè€—æ—¶çº¦Â <strong>87ç§’</strong>ã€‚</p>
</blockquote>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f523f9be4d684e2f9452e081256fdc6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=OM6BrQZVNAjb%2FE7PaxR1nWHUd04%3D" alt="import-deal.png" loading="lazy"/></p>
<ul>
<li><strong>å¤„ç†å®ŒæˆçŠ¶æ€</strong>Â </li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf6220839eab4753a55100c90e7f69e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=HxWTsdTBTBYVIHkQuKqgZ%2F%2FRZuY%3D" alt="import-finish.png" loading="lazy"/></p>
<h3 data-id="heading-71">6.2 è§¦å‘è®°å¿†ç”Ÿæˆ</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2362-%25E8%25A7%25A6%25E5%258F%2591%25E8%25AE%25B0%25E5%25BF%2586%25E7%2594%259F%25E6%2588%2590" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#62-%E8%A7%A6%E5%8F%91%E8%AE%B0%E5%BF%86%E7%94%9F%E6%88%90" ref="nofollow noopener noreferrer"/></p>
<p>å½“æ¨é€æ¶ˆæ¯æ—¶ï¼Œå¦‚æœÂ <strong>æœªç”Ÿæˆè®°å¿†çš„æ¶ˆæ¯æ•°é‡è¾¾åˆ°æˆ–è¶…è¿‡æ‚¨è®¾å®šçš„é˜ˆå€¼</strong>ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨è§¦å‘è®°å¿†ç”Ÿæˆã€‚</p>
<h4 data-id="heading-72">è°ƒç”¨ç¤ºä¾‹ä»£ç </h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E8%25B0%2583%25E7%2594%25A8%25E7%25A4%25BA%25E4%25BE%258B%25E4%25BB%25A3%25E7%25A0%2581" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81" ref="nofollow noopener noreferrer"/></p>
<pre><code class="hljs language-arduino" lang="arduino">package io.github.johntortoise.demo.controller;

<span class="hljs-keyword">import</span> io.github.johntortoise.core.client.TortoiseClient;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.model.ChatCompletionResponse;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.model.Message;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.sys.ReceiveMessageReq;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.enums.RoleEnum;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">String</span> host = <span class="hljs-string">"http://localhost:8080"</span>;

    <span class="hljs-comment">/**
     * æ­¤ SKï¼Œè¯·å¡«å†™å¯¹åº” chat_profile_id æ‰€é…ç½®çš„ SK
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">String</span> sk = <span class="hljs-string">"sk-428acddd-6ced-4e33-a9cb-ec96c980cf02"</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">static</span> TortoiseClient&lt;ChatCompletionResponse&gt; tortoiseClient = TortoiseClient.<span class="hljs-built_in">createForAdmin</span>(ChatCompletionResponse.<span class="hljs-keyword">class</span>, host, sk);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>{
        ReceiveMessageReq build = ReceiveMessageReq.<span class="hljs-built_in">builder</span>().<span class="hljs-built_in">conversationId</span>(<span class="hljs-string">"257386521051582337"</span>).<span class="hljs-built_in">build</span>();
        build.<span class="hljs-built_in">setInput</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Message</span>(<span class="hljs-string">"ä½ å¥½ï¼Œæˆ‘å«ç‹å¤§åŠ›"</span>, RoleEnum.SYSTEM.<span class="hljs-built_in">getCode</span>()));
        build.<span class="hljs-built_in">setOutPut</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Message</span>(<span class="hljs-string">"ç‹å¤§åŠ›ä½ å¥½"</span>, RoleEnum.SYSTEM.<span class="hljs-built_in">getCode</span>()));
        tortoiseClient.<span class="hljs-built_in">sendMessage</span>(build);
    }
}
</code></pre>
<h4 data-id="heading-73">âš ï¸Â é‡è¦æç¤º</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25EF%25B8%258F-%25E9%2587%258D%25E8%25A6%2581%25E6%258F%2590%25E7%25A4%25BA" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%EF%B8%8F-%E9%87%8D%E8%A6%81%E6%8F%90%E7%A4%BA" ref="nofollow noopener noreferrer"/></p>
<p>å¦‚æœæ‚¨çš„å†å²è®°å¿†æ•°æ®é‡å¾ˆå¤§ï¼Œè¯·åŠ¡å¿…<strong>åœ¨å¯¼å…¥å‰è°ƒæ•´Â <code>chat_profile_id</code>Â å¯¹åº”çš„è®°å¿†ä¸Šé™é…ç½®</strong>ï¼Œå¦åˆ™å¯èƒ½ä¼šè§¦å‘ç³»ç»ŸæŠ¥é”™ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e90e1f37e80f4ea89318ceb770d2e399~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVG9ydG9pc2U=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835369&amp;x-signature=p9lucSK24Q4bw3nIEqzyIZc31tg%3D" alt="error.png" loading="lazy"/></p>
<h3 data-id="heading-74">6.3 è·å–è®°å¿†å†…å®¹</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%2363-%25E8%258E%25B7%25E5%258F%2596%25E8%25AE%25B0%25E5%25BF%2586%25E5%2586%2585%25E5%25AE%25B9" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#63-%E8%8E%B7%E5%8F%96%E8%AE%B0%E5%BF%86%E5%86%85%E5%AE%B9" ref="nofollow noopener noreferrer"/></p>
<p>æ‚¨å¯èƒ½ä¼šæ‹…å¿ƒä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>ä¸€æ¬¡æ€§å¯¼å…¥äº†å¤§æ‰¹é‡çš„å†å²å¯¹è¯</li>
<li>å¯¼å…¥æ—¶è®°å¿†å°šæœªå®Œæˆç”Ÿæˆ</li>
</ul>
<p>é’ˆå¯¹ä¸Šè¿°æƒ…å†µï¼Œæˆ‘ä»¬è®¾è®¡äº†<strong>å…œåº•ç­–ç•¥</strong>ï¼š å¦‚æœè®°å¿†å°šæœªç”Ÿæˆï¼Œç³»ç»Ÿå°†è¿”å›æ‚¨æ‰€é…ç½®çš„<strong>æœ€è¿‘ X è½®å¯¹è¯</strong>ä½œä¸ºè®°å¿†å†…å®¹ï¼Œå…¶ä¸­Â <strong>X å³ä¸ºæ‚¨é…ç½®çš„è®°å¿†é˜ˆå€¼</strong>ã€‚</p>
<h4 data-id="heading-75">è°ƒç”¨ç¤ºä¾‹</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%23%25E8%25B0%2583%25E7%2594%25A8%25E7%25A4%25BA%25E4%25BE%258B" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#%E8%B0%83%E7%94%A8%E7%A4%BA%E4%BE%8B" ref="nofollow noopener noreferrer"/></p>
<pre><code class="hljs language-arduino" lang="arduino">package io.github.johntortoise.demo.controller;

<span class="hljs-keyword">import</span> io.github.johntortoise.core.client.TortoiseClient;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.model.ChatCompletionResponse;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.model.Message;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.sys.ReceiveMessageReq;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.dto.sys.TortoiseMessage;
<span class="hljs-keyword">import</span> io.github.johntortoise.core.enums.RoleEnum;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">String</span> host = <span class="hljs-string">"http://localhost:8080"</span>;

    <span class="hljs-comment">/**
     * æ­¤ SK è¯·å¡«å†™å¯¹åº” chat_profile_id æ‰€é…ç½®çš„ SK
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">String</span> sk = <span class="hljs-string">"sk-428acddd-6ced-4e33-a9cb-ec96c980cf02"</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">static</span> TortoiseClient&lt;ChatCompletionResponse&gt; tortoiseClient = TortoiseClient.<span class="hljs-built_in">createForAdmin</span>(ChatCompletionResponse.<span class="hljs-keyword">class</span>, host, sk);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">String</span>[] args)</span> </span>{
        List&lt;Message&gt; memory = tortoiseClient.<span class="hljs-built_in">getMemory</span>(<span class="hljs-string">"257386521051582337"</span>);
        System.out.<span class="hljs-built_in">println</span>(memory);
    }
}
</code></pre>
<h2 data-id="heading-76">7 æœªæ¥</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJohnTortoise%2FOpenTortoise%237-%25E6%259C%25AA%25E6%259D%25A5" target="_blank" title="https://github.com/JohnTortoise/OpenTortoise#7-%E6%9C%AA%E6%9D%A5" ref="nofollow noopener noreferrer"/></p>
<p>æˆ‘ä»¬å°†ä¸æ–­ä¼˜åŒ–æˆ‘ä»¬çš„ç³»ç»Ÿï¼Œä¸ºå¼€æºè´¡çŒ®è‡ªå·±çš„åŠ›é‡</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯AIå¼€å‘ï¼šä¸ºä»€ä¹ˆé€‰æ‹©SSEï¼Œå®ƒä¸åˆ†å—ä¼ è¾“ç¼–ç æœ‰ä½•ä¸åŒï¼Ÿaxiosèƒ½å¤„ç†SSEå—ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7585484081435967539</link>    <guid>https://juejin.cn/post/7585484081435967539</guid>    <pubDate>2025-12-20T13:00:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585484081435967539" data-draft-id="7585463195201896498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯AIå¼€å‘ï¼šä¸ºä»€ä¹ˆé€‰æ‹©SSEï¼Œå®ƒä¸åˆ†å—ä¼ è¾“ç¼–ç æœ‰ä½•ä¸åŒï¼Ÿaxiosèƒ½å¤„ç†SSEå—ï¼Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-20T13:00:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="donecoding"/> <meta itemprop="url" content="https://juejin.cn/user/3192637500430093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯AIå¼€å‘ï¼šä¸ºä»€ä¹ˆé€‰æ‹©SSEï¼Œå®ƒä¸åˆ†å—ä¼ è¾“ç¼–ç æœ‰ä½•ä¸åŒï¼Ÿaxiosèƒ½å¤„ç†SSEå—ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3192637500430093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    donecoding
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:00:43.000Z" title="Sat Dec 20 2025 13:00:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨AIå¤§æ½®å¸­å·å‰ç«¯çš„ä»Šå¤©ï¼Œå¦‚ä½•ä¼˜é›…åœ°å®ç°"æ‰“å­—æœº"æ•ˆæœçš„æµå¼å“åº”ï¼Ÿaxiosçš„onDownloadProgressèƒ½å¸®æˆ‘ä»¬å—ï¼Ÿæœ¬æ–‡å°†ä¸ºä½ æ­å¼€è¿·é›¾ã€‚</p>
</blockquote>
<h2 data-id="heading-0">å¼•è¨€ï¼šAIæ—¶ä»£çš„å®æ—¶æ•°æ®æµæŒ‘æˆ˜</h2>
<p>æœ€è¿‘åœ¨å¼€å‘ä¸€ä¸ªAIåŠ©æ‰‹åŠŸèƒ½æ—¶ï¼Œæˆ‘é‡åˆ°äº†è¿™æ ·çš„éœ€æ±‚ï¼šç”¨æˆ·è¾“å…¥é—®é¢˜åï¼Œéœ€è¦å®æ—¶æ¥æ”¶AIçš„æµå¼å“åº”ï¼Œå®ç°é€å­—æ‰“å°æ•ˆæœã€‚æœ€åˆæˆ‘å°è¯•ä½¿ç”¨axiosé…åˆonDownloadProgresså›è°ƒï¼Œå´å‘ç°æ— æ³•è¾¾åˆ°é¢„æœŸæ•ˆæœã€‚ç»è¿‡ä¸€ç•ªæ¢ç´¢ï¼Œæˆ‘å‘ç°è¿™èƒŒåæ¶‰åŠSSEï¼ˆServer-Sent Eventsï¼‰ã€åˆ†å—ä¼ è¾“ç¼–ç ç­‰æ ¸å¿ƒæ¦‚å¿µã€‚ä»Šå¤©ï¼Œå°±å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹æˆ‘çš„å­¦ä¹ å¿ƒå¾—ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆå‰ç«¯AIå¼€å‘åçˆ±SSEï¼Ÿ</h2>
<h3 data-id="heading-2">1.1 AIåœºæ™¯çš„ç‹¬ç‰¹éœ€æ±‚</h3>
<p>åœ¨AIåº”ç”¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å¤„ç†ä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li>ChatGPTå¼çš„å¯¹è¯å“åº”ï¼ˆé€å­—è¾“å‡ºï¼‰</li>
<li>ä»£ç ç”Ÿæˆçš„å®æ—¶å±•ç¤º</li>
<li>AIç»˜ç”»çš„è¿‡ç¨‹æ›´æ–°</li>
<li>è¯­éŸ³è¯†åˆ«çš„å®æ—¶è½¬å†™</li>
</ul>
<p>è¿™äº›åœºæ™¯éƒ½æœ‰ä¸€ä¸ªå…±åŒç‰¹ç‚¹ï¼š<strong>æ•°æ®æ˜¯è¿ç»­äº§ç”Ÿçš„ï¼Œéœ€è¦å®æ—¶å±•ç¤ºç»™ç”¨æˆ·</strong>ã€‚</p>
<h3 data-id="heading-3">1.2 SSEçš„å¤©ç„¶ä¼˜åŠ¿</h3>
<p>SSEæ­£æ˜¯ä¸ºè¿™ç±»åœºæ™¯é‡èº«å®šåˆ¶çš„ï¼š</p>
<p>javascript</p>
<pre><code class="hljs language-ini" lang="ini">// ä½¿ç”¨EventSourceçš„ç®€å•ç¤ºä¾‹
const <span class="hljs-attr">eventSource</span> = new EventSource(<span class="hljs-string">'/api/ai/chat'</span>)<span class="hljs-comment">;</span>

<span class="hljs-attr">eventSource.onmessage</span> = (event) =&gt; {
  const <span class="hljs-attr">data</span> = JSON.parse(event.data)<span class="hljs-comment">;</span>
  // å®æ—¶æ›´æ–°UIï¼Œå®ç°é€å­—è¾“å‡ºæ•ˆæœ
  updateChatUI(data.text)<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p><strong>SSEçš„æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p>






























<table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th><th>AIåœºæ™¯ä»·å€¼</th></tr></thead><tbody><tr><td><strong>å®æ—¶æ€§</strong></td><td>æœåŠ¡å™¨å¯ä»¥éšæ—¶æ¨é€æ•°æ®</td><td>AIå“åº”ç«‹å³æ˜¾ç¤ºï¼Œæ— éœ€ç­‰å¾…å®Œæ•´ç”Ÿæˆ</td></tr><tr><td><strong>è‡ªåŠ¨é‡è¿</strong></td><td>å†…ç½®æ–­çº¿é‡è¿æœºåˆ¶</td><td>ç½‘ç»œä¸ç¨³å®šæ—¶è‡ªåŠ¨æ¢å¤ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</td></tr><tr><td><strong>è½»é‡çº§</strong></td><td>åŸºäºHTTPï¼Œæ— éœ€é¢å¤–åè®®</td><td>éƒ¨ç½²ç®€å•ï¼Œå…¼å®¹æ€§å¥½</td></tr><tr><td><strong>æ–‡æœ¬å‹å¥½</strong></td><td>åŸç”Ÿæ”¯æŒæ–‡æœ¬æ•°æ®æ ¼å¼</td><td>AIç”Ÿæˆçš„æ–‡æœ¬ã€JSONæ•°æ®ç›´æ¥ä¼ è¾“</td></tr></tbody></table>
<h3 data-id="heading-4">1.3 å¯¹æ¯”å…¶ä»–æ–¹æ¡ˆçš„ä¸è¶³</h3>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¼ ç»Ÿè½®è¯¢æ–¹å¼ - ä¸é€‚ç”¨äºAIæµå¼å“åº”</span>
<span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/ai/status'</span>);
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">json</span>();
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">hasUpdate</span>) {
    <span class="hljs-comment">// é—®é¢˜ï¼šå»¶è¿Ÿé«˜ï¼Œèµ„æºæµªè´¹</span>
  }
}, <span class="hljs-number">1000</span>);

<span class="hljs-comment">// WebSocket - åŠŸèƒ½è¿‡è½½ï¼Œå®ç°å¤æ‚</span>
<span class="hljs-keyword">const</span> ws = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">'wss://api.example.com'</span>);
ws.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-comment">// è™½ç„¶å¯ä»¥å®æ—¶é€šä¿¡ï¼Œä½†å¯¹äºå•å‘AIå“åº”è¿‡äºé‡é‡çº§</span>
};
</code></pre>
<h2 data-id="heading-5">äºŒã€æ ¸å¿ƒæ¦‚å¿µï¼šSSE vs åˆ†å—ä¼ è¾“ç¼–ç </h2>
<p>è¿™æ˜¯æœ€å®¹æ˜“æ··æ·†çš„ä¸€å¯¹æ¦‚å¿µï¼Œè®©æˆ‘ä»¬å½»åº•ææ‡‚å®ƒä»¬ã€‚</p>
<h3 data-id="heading-6">2.1 åˆ†å—ä¼ è¾“ç¼–ç ï¼ˆChunked Transfer Encodingï¼‰</h3>
<p><strong>å®šä¹‰</strong>ï¼šHTTPåè®®å±‚é¢çš„ä¸€ç§æ•°æ®ä¼ è¾“æœºåˆ¶ï¼Œå…è®¸æœåŠ¡å™¨åœ¨ä¸çŸ¥é“å†…å®¹æ€»é•¿åº¦çš„æƒ…å†µä¸‹åˆ†å—å‘é€æ•°æ®ã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<p>text</p>
<pre><code class="hljs language-makefile" lang="makefile">HTTP/1.1 200 OK
<span class="hljs-section">Content-Type: text/plain</span>
<span class="hljs-section">Transfer-Encoding: chunked</span>

5\r\n
Hello\r\n
6\r\n
World!\r\n
0\r\n
\r\n
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>åè®®å±‚é¢çš„æœºåˆ¶</li>
<li>åªæ˜¯<strong>å¦‚ä½•ä¼ è¾“</strong>æ•°æ®ï¼Œä¸å…³å¿ƒ<strong>æ•°æ®æ˜¯ä»€ä¹ˆ</strong></li>
<li>æ¯ä¸ªå—åŒ…å«å¤§å°å’Œæ•°æ®ä¸¤éƒ¨åˆ†</li>
</ul>
<h3 data-id="heading-7">2.2 SSEï¼ˆServer-Sent Eventsï¼‰</h3>
<p><strong>å®šä¹‰</strong>ï¼šåŸºäºHTTPçš„åº”ç”¨å±‚åè®®ï¼Œä¸“é—¨ç”¨äºæœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€äº‹ä»¶ã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<p>text</p>
<pre><code class="hljs language-vbnet" lang="vbnet">HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK
Content-Type: <span class="hljs-keyword">text</span>/<span class="hljs-keyword">event</span>-stream
Cache-Control: no-cache
<span class="hljs-symbol">Connection:</span> keep-alive

<span class="hljs-symbol">event:</span> message
<span class="hljs-symbol">data:</span> {<span class="hljs-string">"chunk"</span>: <span class="hljs-string">"Hello"</span>, <span class="hljs-string">"index"</span>: <span class="hljs-number">1</span>}

<span class="hljs-symbol">data:</span> This <span class="hljs-built_in">is</span> a 
<span class="hljs-symbol">data:</span> multi-line message

<span class="hljs-symbol">event:</span> complete
<span class="hljs-symbol">data:</span> {<span class="hljs-string">"status"</span>: <span class="hljs-string">"done"</span>}
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>åº”ç”¨å±‚åè®®</li>
<li>æœ‰æ˜ç¡®çš„æ•°æ®æ ¼å¼è§„èŒƒ</li>
<li>æ”¯æŒäº‹ä»¶ç±»å‹ã€é‡è¿æ—¶é—´ã€æ¶ˆæ¯IDç­‰å…ƒæ•°æ®</li>
</ul>
<h3 data-id="heading-8">2.3 å…³é”®åŒºåˆ«å¯¹æ¯”è¡¨</h3>








































<table><thead><tr><th>ç»´åº¦</th><th>åˆ†å—ä¼ è¾“ç¼–ç </th><th>SSE</th></tr></thead><tbody><tr><td><strong>åè®®å±‚çº§</strong></td><td>HTTPä¼ è¾“å±‚æœºåˆ¶</td><td>åº”ç”¨å±‚åè®®</td></tr><tr><td><strong>æ•°æ®æ ¼å¼</strong></td><td>æ— ç‰¹å®šæ ¼å¼</td><td>å›ºå®šæ ¼å¼ï¼ˆdata:, event:, id:, retry:ï¼‰</td></tr><tr><td><strong>å†…å®¹ç±»å‹</strong></td><td>ä»»ä½•Content-Type</td><td>å¿…é¡»æ˜¯text/event-stream</td></tr><tr><td><strong>æµè§ˆå™¨æ”¯æŒ</strong></td><td>è‡ªåŠ¨å¤„ç†ï¼Œæ— ä¸“é—¨API</td><td>é€šè¿‡EventSource API</td></tr><tr><td><strong>æ¶ˆæ¯è¾¹ç•Œ</strong></td><td>æŒ‰å—å¤§å°åˆ†å‰²</td><td>æŒ‰åŒæ¢è¡Œç¬¦(\n\n)åˆ†å‰²</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>ä»»ä½•éœ€è¦æµå¼ä¼ è¾“çš„åœºæ™¯</td><td>æœåŠ¡å™¨å‘å®¢æˆ·ç«¯æ¨é€äº‹ä»¶</td></tr></tbody></table>
<h3 data-id="heading-9">2.4 å®é™…å…³ç³»</h3>
<p><strong>é‡è¦æ´å¯Ÿ</strong>ï¼šSSEé€šå¸¸ä½¿ç”¨åˆ†å—ä¼ è¾“ç¼–ç ä½œä¸ºå…¶åº•å±‚ä¼ è¾“æœºåˆ¶ï¼Œä½†å®ƒä»¬è§£å†³çš„é—®é¢˜ä¸åŒï¼š</p>
<ul>
<li>åˆ†å—ä¼ è¾“ç¼–ç è§£å†³"å¦‚ä½•æµå¼ä¼ è¾“"</li>
<li>SSEè§£å†³"å¦‚ä½•è§£ææµå¼ä¼ è¾“çš„äº‹ä»¶æ•°æ®"</li>
</ul>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¨¡æ‹ŸSSEåº•å±‚ä½¿ç”¨åˆ†å—ä¼ è¾“ç¼–ç </span>
<span class="hljs-comment">// æœåŠ¡å™¨ç«¯é€»è¾‘</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/stream'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">writeHead</span>(<span class="hljs-number">200</span>, {
    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/event-stream'</span>,
    <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'no-cache'</span>,
    <span class="hljs-string">'Connection'</span>: <span class="hljs-string">'keep-alive'</span>,
    <span class="hljs-string">'Transfer-Encoding'</span>: <span class="hljs-string">'chunked'</span>  <span class="hljs-comment">// ä½¿ç”¨åˆ†å—ä¼ è¾“ç¼–ç </span>
  });
  
  <span class="hljs-comment">// å‘é€SSEæ ¼å¼çš„æ•°æ®å—</span>
  res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'data: First chunk\n\n'</span>);
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    res.<span class="hljs-title function_">write</span>(<span class="hljs-string">'data: Second chunk\n\n'</span>);
  }, <span class="hljs-number">1000</span>);
});
</code></pre>
<h2 data-id="heading-10">ä¸‰ã€axiosèƒ½ç”¨æ¥è¯·æ±‚SSEå—ï¼Ÿ</h2>
<p><strong>ç›´æ¥ç­”æ¡ˆ</strong>ï¼šä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œaxiosä¸æ˜¯ä¸ºSSEè®¾è®¡çš„ã€‚</p>
<h3 data-id="heading-11">3.1 ä¸ºä»€ä¹ˆaxiosä¸æ”¯æŒSSEï¼Ÿ</h3>
<p>axiosçš„æ ¸å¿ƒé™åˆ¶ï¼š</p>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å°è¯•ç”¨axioså¤„ç†SSE - è¿™æ˜¯é”™è¯¯çš„ï¼</span>
axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/ai/stream'</span>, {
  <span class="hljs-attr">responseType</span>: <span class="hljs-string">'stream'</span> <span class="hljs-comment">// Node.jsç¯å¢ƒå¯èƒ½æœ‰ï¼Œæµè§ˆå™¨ç¯å¢ƒä¸æ”¯æŒ</span>
})
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
  <span class="hljs-comment">// é—®é¢˜1ï¼šaxiosä¼šç­‰å¾…å®Œæ•´å“åº”</span>
  <span class="hljs-comment">// é—®é¢˜2ï¼šæ²¡æœ‰åŸç”Ÿçš„SSEè§£æèƒ½åŠ›</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(response.<span class="hljs-property">data</span>); <span class="hljs-comment">// ä¸€æ¬¡æ€§æ‹¿åˆ°æ‰€æœ‰æ•°æ®</span>
});
</code></pre>
<p><strong>æ ¹æœ¬åŸå› åˆ†æ</strong>ï¼š</p>
<ol>
<li>
<p><strong>è®¾è®¡ç›®æ ‡ä¸åŒ</strong></p>
<ul>
<li>axiosï¼šè®¾è®¡ç”¨äºå®Œæ•´çš„è¯·æ±‚-å“åº”å‘¨æœŸ</li>
<li>SSEï¼šè®¾è®¡ç”¨äºæŒä¹…çš„å•å‘æ•°æ®æµ</li>
</ul>
</li>
<li>
<p><strong>åº•å±‚æŠ€æœ¯é™åˆ¶</strong></p>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// axiosåœ¨æµè§ˆå™¨ç«¯çš„åº•å±‚å®ç°</span>
<span class="hljs-comment">// åŸºäºXMLHttpRequestæˆ–Fetch API</span>
<span class="hljs-comment">// ä½†axioså°è£…å±‚æ²¡æœ‰æš´éœ²æµå¼è®¿é—®æ¥å£</span>

<span class="hljs-comment">// XMLHttpRequestçš„å±€é™æ€§</span>
<span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();
xhr.<span class="hljs-property">onprogress</span> = <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
  <span class="hljs-comment">// åªèƒ½åœ¨readyState=3æ—¶è·å–éƒ¨åˆ†æ•°æ®</span>
  <span class="hljs-comment">// ä½†æ— æ³•å®æ—¶å¤„ç†ï¼Œä¸”éœ€è¦æ‰‹åŠ¨è§£æ</span>
};
</code></pre>
</li>
<li>
<p><strong>APIä¸åŒ¹é…</strong></p>
<ul>
<li>axiosçš„Promiseæ¨¡å‹å‡è®¾è¯·æ±‚ä¼š"å®Œæˆ"</li>
<li>SSEè¿æ¥ç†è®ºä¸Šå¯ä»¥æ°¸è¿œä¸å…³é—­</li>
</ul>
</li>
</ol>
<h3 data-id="heading-12">3.2 onDownloadProgressèƒ½æ¥æ”¶chunkå—ï¼Ÿ</h3>
<p><strong>éƒ¨åˆ†å¯ä»¥ï¼Œä½†ä¸é€‚åˆSSEåœºæ™¯</strong>ã€‚</p>
<p>è®©æˆ‘ä»¬æ·±å…¥åˆ†æonDownloadProgressçš„å·¥ä½œåŸç†ï¼š</p>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript">axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/data'</span>, {
  <span class="hljs-attr">onDownloadProgress</span>: <span class="hljs-function">(<span class="hljs-params">progressEvent</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Loaded:'</span>, progressEvent.<span class="hljs-property">loaded</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Total:'</span>, progressEvent.<span class="hljs-property">total</span>);
    
    <span class="hljs-comment">// å…³é”®é—®é¢˜ï¼šæˆ‘ä»¬èƒ½æ‹¿åˆ°åŸå§‹æ•°æ®å—ï¼Ÿ</span>
    <span class="hljs-comment">// ç­”æ¡ˆï¼šä¸èƒ½ç›´æ¥é€šè¿‡è¿™ä¸ªå›è°ƒè·å–</span>
  }
});
</code></pre>
<p><strong>onDownloadProgressçš„å±€é™æ€§</strong>ï¼š</p>
<ol>
<li>
<p><strong>åªæœ‰è¿›åº¦ä¿¡æ¯ï¼Œæ²¡æœ‰æ•°æ®å†…å®¹</strong></p>
<p>javascript</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// onDownloadProgressäº‹ä»¶å¯¹è±¡ç»“æ„</span>
{
  lengthComputable: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// æ€»å¤§å°æ˜¯å¦å¯çŸ¥</span>
  loaded: <span class="hljs-number">1024</span>,           <span class="hljs-comment">// å·²åŠ è½½å­—èŠ‚æ•°</span>
  total: <span class="hljs-number">2048</span>             <span class="hljs-comment">// æ€»å­—èŠ‚æ•°ï¼ˆå¦‚æœå·²çŸ¥ï¼‰</span>
  <span class="hljs-comment">// æ³¨æ„ï¼šæ²¡æœ‰åŒ…å«å®é™…æ•°æ®çš„å­—æ®µï¼</span>
}
</code></pre>
</li>
<li>
<p><strong>æ•°æ®å·²ç”±axioså†…éƒ¨å¤„ç†</strong></p>
<p>javascript</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// axioså†…éƒ¨å¤„ç†æµç¨‹</span>
<span class="hljs-comment">// 1. æ¥æ”¶ç½‘ç»œæ•°æ® â†’ 2. è§¦å‘onDownloadProgress â†’ 3. ç¼“å†²æ•°æ® â†’ 4. å®Œæˆè¯·æ±‚ â†’ 5. è¿”å›å®Œæ•´æ•°æ®</span>

<span class="hljs-comment">// è¿™æ„å‘³ç€ï¼šåœ¨onDownloadProgressè§¦å‘æ—¶ï¼Œæ•°æ®å·²ç»è¢«axiosæ¥ç®¡</span>
<span class="hljs-comment">// æˆ‘ä»¬æ— æ³•åœ¨è¿‡ç¨‹ä¸­è®¿é—®æ•°æ®å—</span>
</code></pre>
</li>
<li>
<p><strong>æ— æ³•å®æ—¶å¤„ç†åˆ†å—æ•°æ®</strong></p>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‡è®¾æˆ‘ä»¬æƒ³å®æ—¶æ˜¾ç¤ºAIå“åº”</span>
<span class="hljs-comment">// é”™è¯¯çš„æ–¹å¼ï¼š</span>
axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/api/ai/stream'</span>, {
  <span class="hljs-attr">onDownloadProgress</span>: <span class="hljs-function">(<span class="hljs-params">progress</span>) =&gt;</span> {
    <span class="hljs-comment">// è¿™é‡Œæ— æ³•è·å–åˆ°æ–‡æœ¬å†…å®¹</span>
    <span class="hljs-comment">// æ— æ³•å®ç°é€å­—æ˜¾ç¤ºæ•ˆæœ</span>
  }
});
</code></pre>
</li>
</ol>
<h3 data-id="heading-13">3.3 éªŒè¯å®éªŒï¼šonDownloadProgressçš„çœŸå®èƒ½åŠ›</h3>
<p>æˆ‘åˆ›å»ºäº†ä¸€ä¸ªæµ‹è¯•æ¥éªŒè¯onDownloadProgressçš„å®é™…è¡Œä¸ºï¼š</p>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æµ‹è¯•æœåŠ¡å™¨ï¼šå‘é€æ…¢é€Ÿæ•°æ®æµ</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/test-stream'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  res.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/plain'</span>);
  
  <span class="hljs-keyword">const</span> sentences = [
    <span class="hljs-string">"Hello, "</span>,
    <span class="hljs-string">"this is "</span>,
    <span class="hljs-string">"a chunked "</span>,
    <span class="hljs-string">"response."</span>,
    <span class="hljs-string">" And it's "</span>,
    <span class="hljs-string">"coming in "</span>,
    <span class="hljs-string">"multiple parts."</span>
  ];
  
  <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">const</span> interval = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (index &lt; sentences.<span class="hljs-property">length</span>) {
      res.<span class="hljs-title function_">write</span>(sentences[index]);
      index++;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">clearInterval</span>(interval);
      res.<span class="hljs-title function_">end</span>();
    }
  }, <span class="hljs-number">500</span>);
});

<span class="hljs-comment">// å®¢æˆ·ç«¯æµ‹è¯•</span>
axios.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/test-stream'</span>, {
  <span class="hljs-attr">onDownloadProgress</span>: <span class="hljs-function">(<span class="hljs-params">progressEvent</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Progress:'</span>, progressEvent.<span class="hljs-property">loaded</span>);
    <span class="hljs-comment">// å…³é”®å‘ç°ï¼šprogressEventä¸åŒ…å«æ¥æ”¶åˆ°çš„æ–‡æœ¬</span>
    <span class="hljs-comment">// æˆ‘ä»¬æ— æ³•åœ¨è¿™é‡Œå®æ—¶æ˜¾ç¤ºæ•°æ®</span>
  }
}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å®Œæ•´å“åº”:'</span>, response.<span class="hljs-property">data</span>);
  <span class="hljs-comment">// åªèƒ½åœ¨è¿™é‡Œä¸€æ¬¡æ€§è·å–æ‰€æœ‰æ•°æ®</span>
});
</code></pre>
<p><strong>æµ‹è¯•ç»“è®º</strong>ï¼šonDownloadProgressåªé€‚åˆæ˜¾ç¤ºä¸‹è½½è¿›åº¦æ¡ï¼Œä¸é€‚åˆå¤„ç†æµå¼æ•°æ®å†…å®¹ã€‚</p>
<h2 data-id="heading-14">å››ã€å¦‚ä½•æ­£ç¡®å®ç°å‰ç«¯AIçš„SSEè¯·æ±‚ï¼Ÿ</h2>
<p>æ—¢ç„¶axiosä¸è¡Œï¼Œæˆ‘ä»¬åº”è¯¥ç”¨ä»€ä¹ˆï¼Ÿä»¥ä¸‹æ˜¯å‡ ç§æ¨èæ–¹æ¡ˆï¼š</p>
<h3 data-id="heading-15">4.1 æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨åŸç”ŸEventSourceï¼ˆæœ€ç®€å•ï¼‰</h3>
<p>javascript</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AISSEConnection</span> {
  <span class="hljs-keyword">constructor</span>(url, options = {}) {
    <span class="hljs-keyword">this</span>.url = url;
    <span class="hljs-keyword">this</span>.eventSource = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.messageBuffer = <span class="hljs-string">''</span>;
    
    <span class="hljs-keyword">this</span>.onMessage = options.onMessage || (() =&gt; {});
    <span class="hljs-keyword">this</span>.onError = options.onError || (() =&gt; {});
    <span class="hljs-keyword">this</span>.onComplete = options.onComplete || (() =&gt; {});
  }
  
  connect() {
    <span class="hljs-keyword">this</span>.eventSource = new EventSource(<span class="hljs-keyword">this</span>.url);
    
    <span class="hljs-keyword">this</span>.eventSource.onmessage = (event) =&gt; {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">data</span> = JSON.parse(event.<span class="hljs-keyword">data</span>);
        <span class="hljs-keyword">this</span>.onMessage(<span class="hljs-keyword">data</span>);
      } <span class="hljs-keyword">catch</span> (e) {
        console.error(<span class="hljs-string">'è§£æSSEæ•°æ®å¤±è´¥:'</span>, e);
      }
    };
    
    <span class="hljs-keyword">this</span>.eventSource.addEventListener(<span class="hljs-string">'error'</span>, (event) =&gt; {
      console.error(<span class="hljs-string">'SSEè¿æ¥é”™è¯¯:'</span>, event);
      <span class="hljs-keyword">this</span>.onError(event);
    });
    
    <span class="hljs-comment">// è‡ªå®šä¹‰äº‹ä»¶</span>
    <span class="hljs-keyword">this</span>.eventSource.addEventListener(<span class="hljs-string">'complete'</span>, (event) =&gt; {
      <span class="hljs-keyword">this</span>.onComplete(JSON.parse(event.<span class="hljs-keyword">data</span>));
      <span class="hljs-keyword">this</span>.close();
    });
  }
  
  close() {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.eventSource) {
      <span class="hljs-keyword">this</span>.eventSource.close();
    }
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> aiConnection = new AISSEConnection(<span class="hljs-string">'/api/ai/chat'</span>, {
  onMessage: (<span class="hljs-keyword">data</span>) =&gt; {
    document.getElementById(<span class="hljs-string">'response'</span>).textContent += <span class="hljs-keyword">data</span>.chunk;
  }
});
</code></pre>
<p><strong>å±€é™æ€§</strong>ï¼šEventSourceä¸æ”¯æŒè‡ªå®šä¹‰è¯·æ±‚å¤´ï¼Œè¿™åœ¨éœ€è¦è®¤è¯çš„APIä¸­æ˜¯ä¸ªé—®é¢˜ã€‚</p>
<h3 data-id="heading-16">4.2 æ–¹æ¡ˆäºŒï¼šä½¿ç”¨Fetch APIï¼ˆæœ€çµæ´»ï¼‰</h3>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>* <span class="hljs-title function_">createSSEStream</span>(<span class="hljs-params">url, options = {}</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, {
    <span class="hljs-attr">method</span>: options.<span class="hljs-property">method</span> || <span class="hljs-string">'GET'</span>,
    <span class="hljs-attr">headers</span>: {
      <span class="hljs-string">'Accept'</span>: <span class="hljs-string">'text/event-stream'</span>,
      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span>,
      ...options.<span class="hljs-property">headers</span>,
    },
    <span class="hljs-attr">body</span>: options.<span class="hljs-property">body</span> ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(options.<span class="hljs-property">body</span>) : <span class="hljs-literal">undefined</span>,
  });
  
  <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span> || !response.<span class="hljs-property">body</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`SSEè¯·æ±‚å¤±è´¥: <span class="hljs-subst">${response.status}</span>`</span>);
  }
  
  <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>
    .<span class="hljs-title function_">pipeThrough</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoderStream</span>())
    .<span class="hljs-title function_">getReader</span>();
  
  <span class="hljs-keyword">let</span> buffer = <span class="hljs-string">''</span>;
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
      <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
      
      <span class="hljs-keyword">if</span> (done) {
        <span class="hljs-comment">// å¤„ç†ç¼“å†²åŒºå‰©ä½™æ•°æ®</span>
        <span class="hljs-keyword">if</span> (buffer.<span class="hljs-title function_">trim</span>()) {
          <span class="hljs-keyword">yield</span>* <span class="hljs-title function_">parseSSEChunks</span>(buffer);
        }
        <span class="hljs-keyword">break</span>;
      }
      
      buffer += value;
      <span class="hljs-keyword">const</span> chunks = buffer.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n\n'</span>);
      buffer = chunks.<span class="hljs-title function_">pop</span>() || <span class="hljs-string">''</span>; <span class="hljs-comment">// æœ€åä¸€ä¸ªå¯èƒ½æ˜¯ä¸å®Œæ•´çš„å—</span>
      
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> chunks) {
        <span class="hljs-keyword">if</span> (chunk.<span class="hljs-title function_">trim</span>()) {
          <span class="hljs-keyword">yield</span>* <span class="hljs-title function_">parseSSEChunks</span>(chunk);
        }
      }
    }
  } <span class="hljs-keyword">finally</span> {
    reader.<span class="hljs-title function_">releaseLock</span>();
  }
}

<span class="hljs-keyword">function</span>* <span class="hljs-title function_">parseSSEChunks</span>(<span class="hljs-params">rawChunk</span>) {
  <span class="hljs-keyword">const</span> lines = rawChunk.<span class="hljs-title function_">split</span>(<span class="hljs-string">'\n'</span>);
  <span class="hljs-keyword">let</span> event = { <span class="hljs-attr">type</span>: <span class="hljs-string">'message'</span>, <span class="hljs-attr">data</span>: <span class="hljs-string">''</span> };
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> lines) {
    <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'event:'</span>)) {
      event.<span class="hljs-property">type</span> = line.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'event:'</span>, <span class="hljs-string">''</span>).<span class="hljs-title function_">trim</span>();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'data:'</span>)) {
      event.<span class="hljs-property">data</span> += line.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'data:'</span>, <span class="hljs-string">''</span>).<span class="hljs-title function_">trim</span>() + <span class="hljs-string">'\n'</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'id:'</span>)) {
      event.<span class="hljs-property">id</span> = line.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'id:'</span>, <span class="hljs-string">''</span>).<span class="hljs-title function_">trim</span>();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'retry:'</span>)) {
      event.<span class="hljs-property">retry</span> = <span class="hljs-built_in">parseInt</span>(line.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'retry:'</span>, <span class="hljs-string">''</span>).<span class="hljs-title function_">trim</span>(), <span class="hljs-number">10</span>);
    }
  }
  
  event.<span class="hljs-property">data</span> = event.<span class="hljs-property">data</span>.<span class="hljs-title function_">trim</span>();
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span>) {
    <span class="hljs-comment">// å¤„ç†ç‰¹æ®Šç»“æŸæ ‡è®°</span>
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span> === <span class="hljs-string">'[DONE]'</span>) {
      <span class="hljs-keyword">yield</span> { <span class="hljs-attr">type</span>: <span class="hljs-string">'done'</span> };
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">yield</span> { ...event, <span class="hljs-attr">data</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>) };
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">yield</span> { ...event }; <span class="hljs-comment">// è¿”å›åŸå§‹æ•°æ®</span>
      }
    }
  }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAIStream</span>(<span class="hljs-params">prompt</span>) {
  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> event <span class="hljs-keyword">of</span> <span class="hljs-title function_">createSSEStream</span>(<span class="hljs-string">'/api/ai/chat'</span>, {
    <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
    <span class="hljs-attr">body</span>: { prompt }
  })) {
    <span class="hljs-keyword">switch</span> (event.<span class="hljs-property">type</span>) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'message'</span>:
        <span class="hljs-title function_">updateChatUI</span>(event.<span class="hljs-property">data</span>.<span class="hljs-property">chunk</span>);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'complete'</span>:
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'AIå“åº”å®Œæˆ:'</span>, event.<span class="hljs-property">data</span>);
        <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'done'</span>:
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æµç»“æŸ'</span>);
        <span class="hljs-keyword">break</span>;
    }
  }
}
</code></pre>
<h3 data-id="heading-17">4.3 æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨ä¸“é—¨çš„äº‹ä»¶æµåº“ï¼ˆæœ€çœå¿ƒï¼‰</h3>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨eventsource-parseråº“</span>
<span class="hljs-keyword">import</span> { createParser } <span class="hljs-keyword">from</span> <span class="hljs-string">'eventsource-parser'</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">streamAIResponse</span>(<span class="hljs-params">url, options</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, options);
  <span class="hljs-keyword">const</span> parser = <span class="hljs-title function_">createParser</span>({
    <span class="hljs-attr">onEvent</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span> === <span class="hljs-string">'[DONE]'</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Stream completed'</span>);
        <span class="hljs-keyword">return</span>;
      }
      
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(event.<span class="hljs-property">data</span>);
        <span class="hljs-comment">// å¤„ç†AIå“åº”æ•°æ®</span>
        <span class="hljs-title function_">onDataReceived</span>(data);
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to parse SSE data:'</span>, e);
      }
    },
    <span class="hljs-attr">onError</span>: <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'SSE parser error:'</span>, error);
    }
  });
  
  <span class="hljs-keyword">const</span> reader = response.<span class="hljs-property">body</span>.<span class="hljs-title function_">getReader</span>();
  <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextDecoder</span>();
  
  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">const</span> { done, value } = <span class="hljs-keyword">await</span> reader.<span class="hljs-title function_">read</span>();
    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">break</span>;
    
    <span class="hljs-keyword">const</span> chunk = decoder.<span class="hljs-title function_">decode</span>(value);
    parser.<span class="hljs-title function_">feed</span>(chunk);
  }
}
</code></pre>
<h2 data-id="heading-18">äº”ã€å®æˆ˜ï¼šåœ¨Reactä¸­å®ç°AIèŠå¤©ç»„ä»¶</h2>
<p>è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªå®Œæ•´çš„Reactç»„ä»¶æ¥æ¼”ç¤ºæœ€ä½³å®è·µï¼š</p>
<p>jsx</p>
<pre><code class="hljs language-ini" lang="ini">import { useState, useRef, useEffect } from 'react'<span class="hljs-comment">;</span>

function AIChatComponent() {
  const <span class="hljs-section">[messages, setMessages]</span> = useState(<span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>
  const <span class="hljs-section">[input, setInput]</span> = useState('')<span class="hljs-comment">;</span>
  const <span class="hljs-section">[isLoading, setIsLoading]</span> = useState(false)<span class="hljs-comment">;</span>
  const <span class="hljs-attr">abortControllerRef</span> = useRef(null)<span class="hljs-comment">;</span>
  
  const <span class="hljs-attr">handleSubmit</span> = async (e) =&gt; {
    e.preventDefault()<span class="hljs-comment">;</span>
    if (!input.trim() || isLoading) return<span class="hljs-comment">;</span>
    
    const <span class="hljs-attr">userMessage</span> = { role: <span class="hljs-string">'user'</span>, content: input }<span class="hljs-comment">;</span>
    setMessages(<span class="hljs-attr">prev</span> =&gt; [...prev, userMessage])<span class="hljs-comment">;</span>
    setInput('')<span class="hljs-comment">;</span>
    setIsLoading(true)<span class="hljs-comment">;</span>
    
    // æ·»åŠ åˆå§‹AIæ¶ˆæ¯ï¼ˆç©ºå†…å®¹ï¼‰
    const <span class="hljs-attr">aiMessageId</span> = Date.now()<span class="hljs-comment">;</span>
    setMessages(<span class="hljs-attr">prev</span> =&gt; [...prev, { 
      id: aiMessageId, 
      role: <span class="hljs-string">'assistant'</span>, 
      content: <span class="hljs-string">''</span> 
    }])<span class="hljs-comment">;</span>
    
    // åˆ›å»ºå¯ä¸­æ­¢çš„è¯·æ±‚
    <span class="hljs-attr">abortControllerRef.current</span> = new AbortController()<span class="hljs-comment">;</span>
    
    try {
      const <span class="hljs-attr">response</span> = await fetch(<span class="hljs-string">'/api/ai/chat'</span>, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'text/event-stream',
        },
        body: JSON.stringify({ message: input }),
        signal: abortControllerRef.current.signal,
      })<span class="hljs-comment">;</span>
      
      const <span class="hljs-attr">reader</span> = response.body.getReader()<span class="hljs-comment">;</span>
      const <span class="hljs-attr">decoder</span> = new TextDecoder()<span class="hljs-comment">;</span>
      let <span class="hljs-attr">buffer</span> = <span class="hljs-string">''</span><span class="hljs-comment">;</span>
      
      while (true) {
        const { done, value } = await reader.read()<span class="hljs-comment">;</span>
        if (done) break<span class="hljs-comment">;</span>
        
        buffer += decoder.decode(value, { stream: true })<span class="hljs-comment">;</span>
        const <span class="hljs-attr">lines</span> = buffer.split(<span class="hljs-string">'\n\n'</span>)<span class="hljs-comment">;</span>
        <span class="hljs-attr">buffer</span> = lines.pop() || <span class="hljs-string">''</span><span class="hljs-comment">;</span>
        
        for (const line of lines) {
          if (line.startsWith('data: ')) {
            const <span class="hljs-attr">data</span> = line.replace(<span class="hljs-string">'data: '</span>, <span class="hljs-string">''</span>)<span class="hljs-comment">;</span>
            if (<span class="hljs-attr">data</span> === <span class="hljs-string">'[DONE]'</span>) break<span class="hljs-comment">;</span>
            
            try {
              const <span class="hljs-attr">parsed</span> = JSON.parse(data)<span class="hljs-comment">;</span>
              // æ›´æ–°AIæ¶ˆæ¯å†…å®¹
              setMessages(<span class="hljs-attr">prev</span> =&gt; prev.map(msg =&gt; 
                <span class="hljs-attr">msg.id</span> === aiMessageId 
                  ? { ...msg, content: msg.content + parsed.chunk }
                  : msg
              ))<span class="hljs-comment">;</span>
            } catch (e) {
              console.warn('Failed to parse chunk:', e)<span class="hljs-comment">;</span>
            }
          }
        }
      }
    } catch (error) {
      if (error.name !== 'AbortError') {
        console.error('Stream error:', error)<span class="hljs-comment">;</span>
      }
    } finally {
      setIsLoading(false)<span class="hljs-comment">;</span>
      <span class="hljs-attr">abortControllerRef.current</span> = null<span class="hljs-comment">;</span>
    }
  }<span class="hljs-comment">;</span>
  
  const <span class="hljs-attr">stopGeneration</span> = () =&gt; {
    if (abortControllerRef.current) {
      abortControllerRef.current.abort()<span class="hljs-comment">;</span>
      setIsLoading(false)<span class="hljs-comment">;</span>
    }
  }<span class="hljs-comment">;</span>
  
  // æ¸…ç†å‡½æ•°
  useEffect(() =&gt; {
    return () =&gt; {
      if (abortControllerRef.current) {
        abortControllerRef.current.abort()<span class="hljs-comment">;</span>
      }
    }<span class="hljs-comment">;</span>
  }, <span class="hljs-section">[]</span>)<span class="hljs-comment">;</span>
  
  return (
    &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"ai-chat"</span>&gt;
      &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"messages"</span>&gt;
        {messages.map((msg, index) =&gt; (
          &lt;div <span class="hljs-attr">key</span>={index} className={`message <span class="hljs-variable">${msg.role}</span>`}&gt;
            {msg.content}
          &lt;/div&gt;
        ))}
      &lt;/div&gt;
      
      &lt;form <span class="hljs-attr">onSubmit</span>={handleSubmit}&gt;
        &lt;input
          <span class="hljs-attr">value</span>={input}
          <span class="hljs-attr">onChange</span>={(e) =&gt; setInput(e.target.value)}
          <span class="hljs-attr">disabled</span>={isLoading}
          <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¾“å…¥æ‚¨çš„é—®é¢˜..."</span>
        /&gt;
        &lt;button <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span> disabled={isLoading}&gt;
          {isLoading ? 'ç”Ÿæˆä¸­...' : 'å‘é€'}
        &lt;/button&gt;
        {isLoading &amp;&amp; (
          &lt;button <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-literal">on</span>Click={stopGeneration}&gt;
            åœæ­¢ç”Ÿæˆ
          &lt;/button&gt;
        )}
      &lt;/form&gt;
    &lt;/div&gt;
  )<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-19">å…­ã€æ€»ç»“ä¸æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-20">6.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾</h3>
<ol>
<li><strong>SSEæ˜¯AIå‰ç«¯å¼€å‘çš„ç†æƒ³é€‰æ‹©</strong>ï¼šä¸“é—¨ä¸ºæœåŠ¡å™¨æ¨é€è®¾è®¡ï¼Œè½»é‡ä¸”å®æ—¶</li>
<li><strong>SSE â‰  åˆ†å—ä¼ è¾“ç¼–ç </strong>ï¼šSSEæ˜¯åº”ç”¨å±‚åè®®ï¼Œåˆ†å—ä¼ è¾“æ˜¯ä¼ è¾“æœºåˆ¶</li>
<li><strong>axiosä¸é€‚åˆSSEåœºæ™¯</strong>ï¼šè®¾è®¡ç›®æ ‡ä¸åŒï¼Œæ— æ³•å®æ—¶å¤„ç†æµå¼æ•°æ®</li>
<li><strong>onDownloadProgressä¸èƒ½æ¥æ”¶æ•°æ®å†…å®¹</strong>ï¼šåªæä¾›è¿›åº¦ä¿¡æ¯ï¼Œä¸åŒ…å«å®é™…æ•°æ®</li>
</ol>
<h3 data-id="heading-21">6.2 æŠ€æœ¯é€‰å‹å»ºè®®</h3>






























<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>ç†ç”±</th></tr></thead><tbody><tr><td>ç®€å•AIå¯¹è¯</td><td>EventSource</td><td>åŸç”Ÿæ”¯æŒï¼Œå®ç°ç®€å•</td></tr><tr><td>éœ€è¦è®¤è¯çš„AIæœåŠ¡</td><td>Fetch API + æ‰‹åŠ¨è§£æ</td><td>æ”¯æŒè‡ªå®šä¹‰è¯·æ±‚å¤´</td></tr><tr><td>å¤æ‚ä¼ä¸šåº”ç”¨</td><td>ä¸“é—¨çš„äº‹ä»¶æµåº“</td><td>å¥å£®æ€§å¥½ï¼ŒåŠŸèƒ½å®Œæ•´</td></tr><tr><td>éœ€è¦ä¸­æ­¢è¯·æ±‚</td><td>Fetch API + AbortController</td><td>æ”¯æŒç”¨æˆ·ä¸­æ–­ç”Ÿæˆ</td></tr></tbody></table>
<h3 data-id="heading-22">6.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. æ·»åŠ è¿æ¥çŠ¶æ€ç®¡ç†</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionManager</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">connections</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reconnectAttempts</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
  }
  
  <span class="hljs-title function_">getConnection</span>(<span class="hljs-params">url</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">connections</span>.<span class="hljs-title function_">has</span>(url)) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createConnection</span>(url);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">connections</span>.<span class="hljs-title function_">get</span>(url);
  }
  
  <span class="hljs-title function_">createConnection</span>(<span class="hljs-params">url</span>) {
    <span class="hljs-keyword">const</span> connection = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventSource</span>(url);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupReconnectionLogic</span>(url, connection);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">connections</span>.<span class="hljs-title function_">set</span>(url, connection);
  }
}

<span class="hljs-comment">// 2. æ·»åŠ æ•°æ®ç¼“å†²å’Œé˜²æŠ–</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createDebouncedStreamHandler</span>(<span class="hljs-params">delay = <span class="hljs-number">50</span></span>) {
  <span class="hljs-keyword">let</span> buffer = [];
  <span class="hljs-keyword">let</span> timeout = <span class="hljs-literal">null</span>;
  
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">chunk, callback</span>) =&gt;</span> {
    buffer.<span class="hljs-title function_">push</span>(chunk);
    
    <span class="hljs-keyword">if</span> (timeout) <span class="hljs-built_in">clearTimeout</span>(timeout);
    
    timeout = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">callback</span>(buffer.<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>));
      buffer = [];
    }, delay);
  };
}
</code></pre>
<h3 data-id="heading-23">6.4 æœªæ¥å±•æœ›</h3>
<p>éšç€WebæŠ€æœ¯çš„å‘å±•ï¼Œæˆ‘ä»¬å¯èƒ½æœ‰æ›´å¤šé€‰æ‹©ï¼š</p>
<ul>
<li><strong>WebTransport</strong>ï¼šæ­£åœ¨å‘å±•çš„æ–°åè®®ï¼Œæ”¯æŒå¯é å’Œä¸å¯é çš„æ•°æ®ä¼ è¾“</li>
<li><strong>WebSocket with Streams API</strong>ï¼šç»“åˆæµå¼APIçš„WebSocketä½¿ç”¨</li>
<li><strong>QUIC/HTTP3</strong>ï¼šä¸‹ä¸€ä»£HTTPåè®®ï¼ŒåŸç”Ÿæ”¯æŒå¤šè·¯å¤ç”¨</li>
</ul>
<p>ä½†åœ¨å½“å‰é˜¶æ®µï¼ŒSSEä»ç„¶æ˜¯å‰ç«¯AIå¼€å‘ä¸­æœ€å®ç”¨ã€æœ€æˆç†Ÿçš„å®æ—¶æ•°æ®æµæ–¹æ¡ˆã€‚</p>
<hr/>
<p><strong>æœ€åæ€è€ƒ</strong>ï¼šæŠ€æœ¯é€‰å‹æ²¡æœ‰ç»å¯¹çš„å¯¹é”™ï¼Œåªæœ‰é€‚åˆä¸ä¸é€‚åˆã€‚ç†è§£æ¯ç§æŠ€æœ¯çš„è®¾è®¡åˆè¡·å’Œé€‚ç”¨åœºæ™¯ï¼Œæ‰èƒ½åšå‡ºæœ€ä½³é€‰æ‹©ã€‚åœ¨AIå‰ç«¯å¼€å‘çš„é“è·¯ä¸Šï¼ŒSSEåªæ˜¯èµ·ç‚¹ï¼Œæœªæ¥è¿˜æœ‰æ›´å¤šå¯èƒ½æ€§ç­‰å¾…æˆ‘ä»¬æ¢ç´¢ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Œ LLMå®æˆ˜ - ä¼ä¸š ã€åŸºäº markdown-it AST çš„ Markdown æ–‡çŒ®ç¿»è¯‘å®ç°è¯¦è§£]]></title>    <link>https://juejin.cn/post/7585452404113539087</link>    <guid>https://juejin.cn/post/7585452404113539087</guid>    <pubDate>2025-12-20T13:36:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585452404113539087" data-draft-id="7585476892976283682" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Œ LLMå®æˆ˜ - ä¼ä¸š ã€åŸºäº markdown-it AST çš„ Markdown æ–‡çŒ®ç¿»è¯‘å®ç°è¯¦è§£"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-20T13:36:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Codelinghu"/> <meta itemprop="url" content="https://juejin.cn/user/3597257777351341"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Œ LLMå®æˆ˜ - ä¼ä¸š ã€åŸºäº markdown-it AST çš„ Markdown æ–‡çŒ®ç¿»è¯‘å®ç°è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3597257777351341/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Codelinghu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:36:06.000Z" title="Sat Dec 20 2025 13:36:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>å†™åœ¨å‰é¢</strong></p>
<blockquote>
<p>â€œæˆ‘ä¸€å¼€å§‹åªæ˜¯æƒ³ç¿»è¯‘ Markdownï¼Œ  ä½†åœ¨å¤„ç†ç§‘ç ”æ–‡çŒ®æ—¶ï¼Œæˆ‘å‘ç°â€˜æ–‡æœ¬ç¿»è¯‘â€™æœ¬èº«ä¸æ˜¯éš¾ç‚¹ï¼Œ  çœŸæ­£çš„éš¾ç‚¹æ˜¯â€˜å¦‚ä½•åœ¨ä¸ç ´åæ–‡æ¡£ç»“æ„çš„å‰æä¸‹å¤„ç†æ–‡æœ¬â€™ï¼Œ  äºæ˜¯æˆ‘å¼•å…¥äº† AST çš„æ¦‚å¿µï¼Œå¹¶åŸºäº markdown-it å®ç°äº†ä¸€å¥—ç»“æ„ä¿æŒçš„ç¿»è¯‘æµæ°´çº¿ã€‚â€</p>
</blockquote>
<p>[TOC]</p>
<blockquote>
<p>æˆ‘ä¹‹å‰ä¸€ç›´åœ¨åšä¸€ä¸ªå·¥ä¸šçº§å¤§æ¨¡å‹æ–‡æ¡£å¤„ç†æµæ°´çº¿çš„æ´»å„¿ã€‚</p>
</blockquote>
<p>é¡¾åæ€ä¹‰å°±æ˜¯ç”¨LLMå»ç¿»è¯‘ä¸€äº›å¤–æ–‡çš„ç§‘ç ”æ–‡çŒ®ï¼Œå¹¶åšæ™ºèƒ½æ€»ç»“ã€æ‘˜è¦ç­‰å·¥ä½œã€‚</p>
<p>å¤§å®¶å¯ä»¥ç§»æ­¥çœ‹æ–‡ç« ï¼š</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fweixin_43891901%2Farticle%2Fdetails%2F155676043%3Fspm%3D1001.2014.3001.5501" target="_blank" title="https://blog.csdn.net/weixin_43891901/article/details/155676043?spm=1001.2014.3001.5501" ref="nofollow noopener noreferrer">ã€Œ LLMå®æˆ˜ - ä¼ä¸š ã€æ„å»ºå·¥ä¸šçº§å¤§æ¨¡å‹æ–‡æ¡£å¤„ç†æµæ°´çº¿ï¼šè§£å†³æˆªæ–­ã€å¹»è§‰ä¸å»¶è¿Ÿä¸ç¡®å®šæ€§çš„ç«¯åˆ°ç«¯å®è·µè§£å†³æ–¹æ¡ˆ-CSDNåšå®¢</a></p>
<p>æˆ‘åœ¨è¿™ç¯‡æ–‡ç« é‡Œè¯´çš„ï¼Œæ„å»ºè¿™ä¸ªæµæ°´çº¿çš„ä¸€ä¸ªåŸºæœ¬æµç¨‹å°±æ˜¯ï¼š</p>
<blockquote>
<p>PDF---&gt;MinerU---&gt;Mdæ–‡æ¡£ï¼ˆè‹±æ–‡ï¼‰---&gt;AIå¤§æ¨¡å‹---&gt;æ‘˜è¦ã€ç¿»è¯‘å…¨æ–‡ã€ç®€ä»‹ç­‰</p>
</blockquote>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æŠŠmarkdwonçš„è‹±æ–‡æ–‡æ¡£åšå…¨æ–‡ç¿»è¯‘ï¼Œå¦‚æœç›´æ¥è®©LLMå»åšå…¨æ–‡ç¿»è¯‘ï¼Œä¼šå‡ºç°ç¿»è¯‘è¢«æˆªæ–­ã€ç¿»è¯‘å†…å®¹èƒ¡ç¼–ä¹±é€ ã€ä¸ç¿»è¯‘çš„å¹»è§‰ç­‰é—®é¢˜æ‘å’‹ã€‚äºæ˜¯æˆ‘åœ¨ä¸Šä¸€ä¸ªæ–‡ç« é‡Œæäº†ä¸€ä¸ªæ–°çš„æ€è·¯ï¼Œé‚£å°±æ˜¯æŒ‰â€œè¡Œå—â€ç¿»è¯‘ã€‚æŠŠè‹±æ–‡çš„mdæ–‡æ¡£çš„æ¯ä¸€è¡Œæ‹¿å‡ºæ¥ç¿»è¯‘ï¼Œç¿»è¯‘å®Œå†æ‹¼æ¥å›å»ã€‚</p>
<h2 data-id="heading-0">å±€é™æ€§</h2>
<p>å…¶å®ä½ ä¼šå‘ç°ï¼Œå¦‚æœæŒ‰ç…§æˆ‘ä¹‹å‰çš„ç¿»è¯‘markdwonæ–‡æ¡£çš„æ¯ä¸€è¡Œï¼Œé‚£è¿™æ ·åšç¿»è¯‘å‡ºæ¥çš„è´¨é‡å¹¶ä¸é«˜ã€‚æˆ‘ä»¬ä¸æ˜¯æŒ‰ç…§è¯­ä¹‰å»ç¿»è¯‘çš„ï¼Œè€Œæ˜¯æ´»ç”Ÿç”Ÿçš„åˆ‡å‰²äº†å…¨æ–‡çš„æ¯ä¸€è¡Œï¼Œæœºæ¢°çš„ç¿»è¯‘çš„ï¼Œè¿™æ ·åšå¹¶ä¸å¥½ã€‚</p>
<p><strong>æœ¬æ–‡å°†æä¾›ä¸€ç§æ–°çš„æ€è·¯å»åšç¿»è¯‘ã€‚æœ¬æ–‡å°†å‘Šè¯‰å¤§å®¶æˆ‘æ˜¯æ€ä¹ˆæŒ‰ç…§markdwonåŸæ–‡çš„è¯­ä¹‰å»åšæ‹†åˆ†çš„ï¼Œä»è€Œè®©å¤§æ¨¡å‹ç¿»è¯‘çš„æ•ˆæœæ›´å®Œç¾ï¼Œæ•ˆæœæ›´ä½³ï¼</strong></p>
<h2 data-id="heading-1">ASTæŠ½è±¡è¯­æ³•æ ‘</h2>
<p>è¯´å®è¯ï¼Œä¸å»ºè®®å¤§å®¶ç›´æ¥å»æ·±ç©¶ASTè¿™ä¸ªä¸œè¥¿ï¼Œä½ åªè¦ç†è§£ï¼Œè¿™ä¸ªASTå¯ä»¥å¸®ä½ æŠŠmarkdwonæ–‡æ¡£é‡Œçš„è¡Œå•Šã€æ–‡æœ¬å•Šã€è¡¨æ ¼å•Šã€æ ‡é¢˜å•Šè¿™äº›ä¸œè¥¿æ ‡è®°å‡ºæ¥ï¼Œå†ä¸ç ´åè¿™äº›ç»“æ„çš„æƒ…å†µä¸‹ï¼Œå¸®ä½ ç›´æ¥å»æ ‡è®°å‡ºæ¥å®ƒä»¬ï¼Œä½ åœ¨åšç¿»è¯‘çš„æ—¶å€™ï¼Œç›´æ¥æŠŠè¿™éƒ¨åˆ†æ ‡è®°çš„å†…å®¹æå‡ºæ¥ç¿»è¯‘å³å¯ã€‚è¿™æ ·å°±ä¸ä¼šç ´ååŸæœ¬çš„markdwonæ–‡æœ¬ç»“æ„äº†ã€‚</p>
<p>å¦‚æœä¸ç”¨ASTæŠ½è±¡è¯­æ³•æ ‘ï¼Œé‚£ä½ å¯¹markdwonçš„ç¿»è¯‘å·¥ä½œå¾ˆå¯èƒ½æ˜¯ç ´åäº†åŸæœ¬çš„æ–‡æœ¬ç»“æ„çš„ï¼Œæ¯”å¦‚è¡¨æ ¼å•Šã€å¼•ç”¨å•Šï¼Œæ®µè½å•Šï¼Œç»“æ„è¢«ä½ ç ´åäº†ï¼Œæ‹¿ç€ç ´åçš„ç»“æ„å»ç¿»è¯‘ï¼Œè´¨é‡å°±ä¸ä¼šé«˜ã€‚</p>
<h3 data-id="heading-2">Markdown-it</h3>
<p>æœ‰ä¸€ä¸ªå·¥ä¸šçº§çš„å¼€æºé¡¹ç›®ï¼šMarkdown-itã€‚</p>
<p>é¡¹ç›®åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmarkdown-it%2Fmarkdown-it.git" target="_blank" title="https://github.com/markdown-it/markdown-it.git" ref="nofollow noopener noreferrer">github.com/markdown-itâ€¦</a></p>
<p>å®ƒå°±æ˜¯åˆ©ç”¨ASTçš„åŸç†å¸®åŠ©ä½ æå–markdwonæ–‡æœ¬é‡Œçš„å„ä¸ªç»“æ„ï¼Œè¿›è¡Œæå–æ¸²æŸ“æˆhtmlæ ¼å¼ã€‚æ¸²æŸ“å‡ºæ¥çš„htmlè¿˜èƒ½ä¿è¯markdwonåŸæ–‡çš„ç»“æ„ä¸è¢«ç ´åã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘ä¸ä¼šå»è¿›è¡Œhtmlçš„è½¬æ¢ï¼Œæˆ‘åªæ˜¯æ‹¿ä»–åšASTçš„è§£æå™¨ã€‚</p>
<pre><code class="hljs language-tex" lang="tex">Markdown æ–‡æœ¬
   â†“
markdown-it.parse()
   â†“
Token æµï¼ˆASTï¼‰

</code></pre>
<p>æˆ‘çš„ç›®çš„æ˜¯æŠŠæˆ‘çš„markdwonæ–‡æœ¬ä¸¢ç»™markdwon-itè¿›è¡ŒASTçš„è§£æï¼Œè§£ææˆä¸ºTokenæµã€‚</p>
<p>è¢«è§£æå‡ºæ¥çš„Tokenåˆ—è¡¨å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-tex" lang="tex">heading_open
inline("Experiment Results")
heading_close
paragraph_open
inline("The sensor shows high sensitivity.")
paragraph_close

</code></pre>
<p>åœ¨æ‹¿åˆ°ASTç»“æ„ä»¥åï¼Œæˆ‘ä»¬å†è¿›è¡Œç»“æ„å’Œå†…å®¹çš„æ‹†åˆ†ï¼š</p>
<pre><code class="hljs language-tex" lang="tex">Markdown ç»“æ„ï¼ˆASTï¼‰
        +
å¯ç¿»è¯‘æ–‡æœ¬å•å…ƒï¼ˆunitsï¼‰

</code></pre>
<p>æˆ‘ä»¬æŠŠå¯ç¿»è¯‘çš„æ–‡æœ¬å•å…ƒå†æ¬¡æ‹†åˆ†æˆæœ€å°è¯­ä¹‰å•å…ƒï¼š</p>
<pre><code class="hljs language-python" lang="python">units = [
  {<span class="hljs-built_in">id</span>: <span class="hljs-number">0</span>, text: <span class="hljs-string">"..."</span>},
  {<span class="hljs-built_in">id</span>: <span class="hljs-number">1</span>, text: <span class="hljs-string">"..."</span>}
]

</code></pre>
<p>è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>æ¯ä¸€æ®µéƒ½æœ‰æ˜ç¡®è¾¹ç•Œ</li>
<li>æ¯ä¸€æ®µéƒ½å¯è¿½è¸ª</li>
<li>ç¿»è¯‘å¤±è´¥ä¸ä¼šæ±¡æŸ“å…¨å±€</li>
</ul>
<blockquote>
<p>åœ¨å®Œæˆæœ€å°è¯­ä¹‰çº§åˆ«çš„ç¿»è¯‘ä¹‹åï¼Œ
Markdown æ–‡æ¡£å·²ç»è¢«æ‹†è§£ä¸ºä¸€ç»„ AST Tokensã€‚
æ¯ä¸ª Token æè¿°çš„ä¸æ˜¯æ–‡æœ¬ï¼Œè€Œæ˜¯â€œç»“æ„è¯­ä¹‰â€ã€‚</p>
</blockquote>
<blockquote>
<p>æœ¬é˜¶æ®µçš„ä»»åŠ¡ï¼Œæ˜¯æ ¹æ® Token çš„ç±»å‹ï¼Œ
å°†è¿™äº›ç»“æ„è¯­ä¹‰é‡æ–°æ˜ å°„ä¸º Markdown è¯­æ³•ï¼Œ
å¹¶å°†å·²ç»ç¿»è¯‘å®Œæˆçš„ inline å†…å®¹æŒ‰é¡ºåºå›å†™ï¼Œ
æœ€ç»ˆé‡å»ºå‡ºä¸€ç¯‡å®Œæ•´ã€ç»“æ„ä¸å˜ã€å†…å®¹å·²ç¿»è¯‘çš„ Markdown æ–‡æ¡£ã€‚</p>
</blockquote>
<h2 data-id="heading-3">å®é™…è¿ç”¨</h2>
<p>æ¥ä¸‹æ¥æˆ‘è¯´ä¸€ä¸‹ï¼Œæˆ‘çš„æºä»£ç ï¼Œæˆ‘æ˜¯æ€ä¹ˆå®é™…æŠŠmarkdwonæ–‡æœ¬è¿›è¡ŒASTè½¬æ¢ï¼Œåœ¨ä»ASTç»“æ„ä¸­æå–å‡ºæœ€å°å¯ç¿»è¯‘å•å…ƒè¿›è¡Œç¿»è¯‘ï¼Œæœ€ååœ¨è¿›è¡Œå›å†™çš„ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python</span>
<span class="hljs-comment"># -*- coding: utf-8 -*-</span>
<span class="hljs-comment"># @Time    : 2025/12/17 15:14</span>
<span class="hljs-comment"># @Author  : linghu</span>
<span class="hljs-comment"># @File    : md_ast_translator.py</span>
<span class="hljs-comment"># @Software: PyCharm</span>
<span class="hljs-comment">##AST ç¿»è¯‘å™¨</span>
<span class="hljs-keyword">from</span> markdown_it <span class="hljs-keyword">import</span> MarkdownIt
<span class="hljs-keyword">import</span> re

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MarkdownASTTranslator</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.md = MarkdownIt()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_units</span>(<span class="hljs-params">self, md_text: <span class="hljs-built_in">str</span></span>):
        <span class="hljs-string">"""
        Markdown â†’ å¯ç¿»è¯‘è¯­ä¹‰å•å…ƒ
        å°†Markdownæ–‡æœ¬è§£æä¸ºASTï¼Œå¹¶æå–å¯ç¿»è¯‘çš„æ–‡æœ¬å•å…ƒ
        è¿”å›å€¼æ ¼å¼ä¸Translatorç±»çš„translate_blocksæ–¹æ³•å…¼å®¹
        """</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[DEBUG] ASTè§£æå¼€å§‹ï¼Œæ–‡æœ¬é•¿åº¦: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(md_text)}</span>"</span>)
        tokens = self.md.parse(md_text)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[DEBUG] ASTè§£æå®Œæˆï¼Œå…±<span class="hljs-subst">{<span class="hljs-built_in">len</span>(tokens)}</span>ä¸ªtoken"</span>)

        units = []
        uid = <span class="hljs-number">0</span>
        last_open = <span class="hljs-literal">None</span>

        <span class="hljs-keyword">for</span> i, token <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(tokens):
            <span class="hljs-keyword">if</span> token.<span class="hljs-built_in">type</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">"heading_open"</span>, <span class="hljs-string">"paragraph_open"</span>, <span class="hljs-string">"blockquote_open"</span>, <span class="hljs-string">"list_item_open"</span>):
                <span class="hljs-comment"># æ”¯æŒæ›´å¤šç±»å‹çš„å—çº§å…ƒç´ </span>
                last_open = token.<span class="hljs-built_in">type</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[DEBUG] Token <span class="hljs-subst">{i}</span>: æ‰“å¼€å—çº§å…ƒç´  <span class="hljs-subst">{token.<span class="hljs-built_in">type</span>}</span>"</span>)

            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"inline"</span> <span class="hljs-keyword">and</span> last_open <span class="hljs-keyword">and</span> token.content.strip():
                <span class="hljs-comment"># åªæå–éç©ºçš„å†…è”æ–‡æœ¬å†…å®¹</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[DEBUG] Token <span class="hljs-subst">{i}</span>: æ‰¾åˆ°å¯ç¿»è¯‘æ–‡æœ¬ '<span class="hljs-subst">{token.content[:<span class="hljs-number">50</span>]}</span>...' (ç±»å‹: <span class="hljs-subst">{last_open}</span>)"</span>)
                units.append({
                    <span class="hljs-string">"id"</span>: uid,
                    <span class="hljs-string">"text"</span>: token.content,  <span class="hljs-comment"># ç¡®ä¿æ ¼å¼ä¸Translatorç±»æœŸæœ›çš„ä¸€è‡´</span>
                    <span class="hljs-string">"type"</span>: last_open.replace(<span class="hljs-string">"_open"</span>, <span class="hljs-string">""</span>)  <span class="hljs-comment"># ä¿ç•™ç±»å‹ä¿¡æ¯ç”¨äºè°ƒè¯•</span>
                })
                uid += <span class="hljs-number">1</span>
            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> != <span class="hljs-string">"inline"</span> <span class="hljs-keyword">and</span> token.content:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[DEBUG] Token <span class="hljs-subst">{i}</span>: <span class="hljs-subst">{token.<span class="hljs-built_in">type</span>}</span>, å†…å®¹: '<span class="hljs-subst">{token.content[:<span class="hljs-number">20</span>]}</span>...'"</span>)

        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[DEBUG] æå–å®Œæˆï¼Œå…±<span class="hljs-subst">{<span class="hljs-built_in">len</span>(units)}</span>ä¸ªå¯ç¿»è¯‘å•å…ƒ"</span>)
        <span class="hljs-keyword">return</span> tokens, units

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">apply_translation</span>(<span class="hljs-params">self, tokens, translated_units</span>):
        <span class="hljs-string">"""
        ç¿»è¯‘ç»“æœ â†’ AST å›å†™
        å°†ç¿»è¯‘åçš„æ–‡æœ¬å•å…ƒåº”ç”¨å›ASTï¼Œå¹¶ç”Ÿæˆæœ€ç»ˆçš„Markdownæ–‡æœ¬
        """</span>
        <span class="hljs-comment"># åˆ›å»ºç¿»è¯‘æ˜ å°„ï¼Œä½¿ç”¨idä½œä¸ºé”®</span>
        translated_map = {
            item[<span class="hljs-string">"id"</span>]: item[<span class="hljs-string">"text"</span>]  <span class="hljs-comment"># æ³¨æ„ï¼šTranslatorè¿”å›çš„å­—æ®µæ˜¯"text"è€Œä¸æ˜¯"translated"</span>
            <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> translated_units
        }

        uid = <span class="hljs-number">0</span>
        last_open = <span class="hljs-literal">None</span>

        <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> tokens:
            <span class="hljs-keyword">if</span> token.<span class="hljs-built_in">type</span> <span class="hljs-keyword">in</span> (<span class="hljs-string">"heading_open"</span>, <span class="hljs-string">"paragraph_open"</span>, <span class="hljs-string">"blockquote_open"</span>, <span class="hljs-string">"list_item_open"</span>):
                last_open = token.<span class="hljs-built_in">type</span>

            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"inline"</span> <span class="hljs-keyword">and</span> last_open:
                <span class="hljs-comment"># åªå¤„ç†éç©ºçš„å†…è”æ–‡æœ¬å†…å®¹ï¼Œä¸extract_unitsä¿æŒä¸€è‡´</span>
                <span class="hljs-keyword">if</span> token.content.strip():
                    <span class="hljs-keyword">if</span> uid <span class="hljs-keyword">in</span> translated_map:
                        token.content = translated_map[uid]
                    uid += <span class="hljs-number">1</span>

        <span class="hljs-comment"># æ¸²æŸ“æœ€ç»ˆçš„Markdownæ–‡æœ¬</span>
        <span class="hljs-comment"># æ³¨æ„ï¼šä½¿ç”¨markdown-itçš„renderæ–¹æ³•å°†ASTè½¬æ¢ä¸ºHTMLï¼Œç„¶åè½¬æ¢å›Markdown</span>
        <span class="hljs-comment"># æˆ–è€…ä½¿ç”¨ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•ï¼Œç›´æ¥ä»tokensé‡å»ºMarkdown</span>
        md_text = <span class="hljs-string">""</span>
        current_level = <span class="hljs-number">0</span>
        list_stack = []
        
        <span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> tokens:
            <span class="hljs-keyword">if</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"heading_open"</span>:
                level = <span class="hljs-built_in">int</span>(token.tag[<span class="hljs-number">1</span>])
                current_level = level
                md_text += <span class="hljs-string">"#"</span> * level + <span class="hljs-string">" "</span>
            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"heading_close"</span>:
                md_text += <span class="hljs-string">"\n\n"</span>
                current_level = <span class="hljs-number">0</span>
            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"paragraph_open"</span>:
                md_text += <span class="hljs-string">""</span>
            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"paragraph_close"</span>:
                md_text += <span class="hljs-string">"\n\n"</span>
            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"blockquote_open"</span>:
                md_text += <span class="hljs-string">"&gt; "</span>
            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"blockquote_close"</span>:
                md_text += <span class="hljs-string">"\n\n"</span>
            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"list_item_open"</span>:
                <span class="hljs-keyword">if</span> token.level <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> list_stack:
                    list_stack.append(token.level)
                md_text += <span class="hljs-string">"- "</span>
            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"list_item_close"</span>:
                md_text += <span class="hljs-string">"\n"</span>
                <span class="hljs-keyword">if</span> token.level <span class="hljs-keyword">in</span> list_stack:
                    list_stack.remove(token.level)
            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"inline"</span>:
                <span class="hljs-comment"># å¤„ç†å†…è”å†…å®¹ï¼ˆåŒ…å«ç¿»è¯‘åçš„æ–‡æœ¬ï¼‰</span>
                md_text += token.content
            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"hr"</span>:
                md_text += <span class="hljs-string">"---\n\n"</span>
            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"code_block"</span>:
                md_text += <span class="hljs-string">"```\n"</span> + token.content + <span class="hljs-string">"\n```\n\n"</span>
            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"fence"</span>:
                md_text += <span class="hljs-string">"```"</span> + token.info + <span class="hljs-string">"\n"</span> + token.content + <span class="hljs-string">"\n```\n\n"</span>
            <span class="hljs-keyword">elif</span> token.<span class="hljs-built_in">type</span> == <span class="hljs-string">"text"</span> <span class="hljs-keyword">and</span> token.content.strip():
                md_text += token.content
        
        <span class="hljs-comment"># ç§»é™¤å¤šä½™çš„ç©ºè¡Œ</span>
        md_text = re.sub(<span class="hljs-string">r'\n\s*\n'</span>, <span class="hljs-string">'\n\n'</span>, md_text)
        <span class="hljs-keyword">return</span> md_text.strip()

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">translate_markdown</span>(<span class="hljs-params">self, md_text, translator</span>):
        <span class="hljs-string">"""
        å®Œæ•´çš„Markdownç¿»è¯‘æµç¨‹
        1. æå–å¯ç¿»è¯‘å•å…ƒ
        2. ä½¿ç”¨æä¾›çš„translatorè¿›è¡Œç¿»è¯‘
        3. å°†ç¿»è¯‘ç»“æœåº”ç”¨å›AST
        4. è¿”å›ç¿»è¯‘åçš„Markdown
        """</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[ASTç¿»è¯‘å™¨] å¼€å§‹ç¿»è¯‘Markdownæ–‡æœ¬"</span>)
        
        <span class="hljs-comment"># 1. è§£æASTå¹¶æå–å¯ç¿»è¯‘å•å…ƒ</span>
        tokens, units = self.extract_units(md_text)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[ASTç¿»è¯‘å™¨] æå–åˆ° <span class="hljs-subst">{<span class="hljs-built_in">len</span>(units)}</span> ä¸ªå¯ç¿»è¯‘å•å…ƒ"</span>)
        
        <span class="hljs-comment"># 2. ä½¿ç”¨æä¾›çš„translatorè¿›è¡Œç¿»è¯‘ï¼ˆæ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼‰</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[ASTç¿»è¯‘å™¨] å¼€å§‹è°ƒç”¨ç¿»è¯‘æœåŠ¡"</span>)
        translated_units = <span class="hljs-keyword">await</span> translator.translate_blocks(units)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[ASTç¿»è¯‘å™¨] ç¿»è¯‘å®Œæˆï¼Œå…±å¾—åˆ° <span class="hljs-subst">{<span class="hljs-built_in">len</span>(translated_units)}</span> ä¸ªç¿»è¯‘ç»“æœ"</span>)
        
        <span class="hljs-comment"># æ‰“å°ä¸€äº›ç¿»è¯‘ç»“æœç¤ºä¾‹</span>
        <span class="hljs-keyword">if</span> translated_units:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[DEBUG] ç¿»è¯‘ç»“æœç¤ºä¾‹ (id=<span class="hljs-subst">{translated_units[<span class="hljs-number">0</span>][<span class="hljs-string">'id'</span>]}</span>): '<span class="hljs-subst">{translated_units[<span class="hljs-number">0</span>][<span class="hljs-string">'text'</span>][:<span class="hljs-number">50</span>]}</span>...'"</span>)
        
        <span class="hljs-comment"># 3. å°†ç¿»è¯‘ç»“æœåº”ç”¨å›AST</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[ASTç¿»è¯‘å™¨] å¼€å§‹åº”ç”¨ç¿»è¯‘ç»“æœåˆ°AST"</span>)
        translated_md = self.apply_translation(tokens, translated_units)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[ASTç¿»è¯‘å™¨] ç¿»è¯‘å®Œæˆï¼Œæœ€ç»ˆMarkdowné•¿åº¦: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(translated_md)}</span>"</span>)
        
        <span class="hljs-comment"># æ‰“å°ç¿»è¯‘åçš„Markdownå‰100ä¸ªå­—ç¬¦</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[DEBUG] ç¿»è¯‘åçš„Markdownå‰100ä¸ªå­—ç¬¦: '<span class="hljs-subst">{translated_md[:<span class="hljs-number">100</span>]}</span>...'"</span>)
        
        <span class="hljs-keyword">return</span> translated_md

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æç¤ºè¯é“¾æ¨¡å¼ï¼šä¸€ç§åˆ©ç”¨LLMå¤§è¯­è¨€æ¨¡å‹å¤„ç†å¤æ‚ä»»åŠ¡çš„å¼ºå¤§èŒƒå¼]]></title>    <link>https://juejin.cn/post/7585463258691403785</link>    <guid>https://juejin.cn/post/7585463258691403785</guid>    <pubDate>2025-12-20T14:09:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585463258691403785" data-draft-id="7585686247285227571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æç¤ºè¯é“¾æ¨¡å¼ï¼šä¸€ç§åˆ©ç”¨LLMå¤§è¯­è¨€æ¨¡å‹å¤„ç†å¤æ‚ä»»åŠ¡çš„å¼ºå¤§èŒƒå¼"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-20T14:09:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Codelinghu"/> <meta itemprop="url" content="https://juejin.cn/user/3597257777351341"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æç¤ºè¯é“¾æ¨¡å¼ï¼šä¸€ç§åˆ©ç”¨LLMå¤§è¯­è¨€æ¨¡å‹å¤„ç†å¤æ‚ä»»åŠ¡çš„å¼ºå¤§èŒƒå¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3597257777351341/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Codelinghu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T14:09:17.000Z" title="Sat Dec 20 2025 14:09:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æç¤ºè¯é“¾æ¨¡å¼ï¼šPrompt Chaining</p>
<p>ä¹Ÿè¢«å«åšç®¡é“æ¨¡å¼ã€‚</p>
<blockquote>
<p>å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå°†åŸå§‹çš„å¤æ‚é—®é¢˜åˆ†è§£ä¸ºä¸€ç³»åˆ—æ›´å°ã€æ›´æ˜“ç®¡ç†çš„å­é—®é¢˜ã€‚æ¯ä¸ªå­é—®é¢˜é€šè¿‡ä¸“é—¨è®¾è®¡çš„æç¤ºè¯å•ç‹¬å¤„ç†ï¼Œå¹¶ä¸”ä¸€ä¸ªæç¤ºè¯çš„è¾“å‡ºä¼šä½œä¸ºè¾“å…¥ä¼ é€’ç»™é“¾ä¸­çš„ä¸‹ä¸€ä¸ªæç¤ºè¯ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬åœ¨æ„å»ºå¤æ‚AI Agentçš„æ—¶å€™æœ€å¥½ä¸è¦é‡‡ç”¨å•ä¸€æç¤ºè¯ï¼Œå•ä¸€æç¤ºè¯çš„å±€é™æ€§å¾ˆå¤§ï¼Œå¯èƒ½ä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>æŒ‡ä»¤å¿½ç•¥ï¼ˆæç¤ºè¯çš„æŸäº›éƒ¨åˆ†è¢«å¿½è§†ï¼‰</li>
<li>ä¸Šä¸‹æ–‡æ¼‚ç§»ï¼ˆæ¨¡å‹å¤±å»å¯¹ä¸Šä¸‹æ–‡çš„è·Ÿè¸ªï¼‰</li>
<li>é”™è¯¯ä¼ æ’­ï¼ˆæ—©èµ·é”™è¯¯è¢«æ”¾å¤§ï¼‰</li>
<li>éœ€è¦æ›´é•¿ä¸Šä¸‹æ–‡çª—å£ï¼ˆæ¨¡å‹è·å¾—çš„ä¿¡æ¯ä¸è¶³æ— æ³•å“åº”ï¼‰ä»¥åŠå¹»è§‰ï¼ˆè®¤çŸ¥è´Ÿè·å¢åŠ å¯¼è‡´é”™è¯¯ä¿¡æ¯çš„å¯èƒ½æ€§ï¼‰</li>
</ul>
<h3 data-id="heading-0">é¡ºåºåˆ†è§£å¢å¼º</h3>
<p>å…ˆè¯´ä¸€ä¸ªä¾‹å­ï¼š</p>
<p><strong>ä¸€ä¸ªè¦æ±‚åˆ†æå¸‚åœºåˆ†æç ”ç©¶æŠ¥å‘Šã€æ€»ç»“ã€å‘ç°ã€è¯†åˆ«å¸¦æ•°æ®ç‚¹çš„è¶‹åŠ¿å¹¶èµ·è‰ç”µå­é‚®ä»¶çš„æŸ¥è¯¢ã€‚</strong></p>
<p>å¯¹äºä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œæç¤ºè¯é“¾é€šè¿‡å°†è¿™ä¸ªå¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºèšç„¦çš„é¡ºåºå·¥ä½œæµæ¥è§£å†³å®ƒã€‚ç”¨é“¾å¼æ–¹æ³•å¯ä»¥è¿™æ ·æè¿°ï¼š</p>
<ul>
<li>åˆå§‹åŒ–æç¤ºè¯(æ€»ç»“)ï¼šâ€œæ€»ç»“ä»¥ä¸‹å¸‚åœºåˆ†æç ”ç©¶æŠ¥å‘Šçš„ä¸»è¦å‘ç°ï¼š[æ–‡æœ¬]ã€‚â€ æ¨¡å‹çš„å”¯ä¸€ç„¦ç‚¹æ˜¯æ€»ç»“ï¼Œæé«˜äº†è¿™ä¸€åˆå§‹åŒ–æ­¥éª¤çš„å‡†ç¡®æ€§ã€‚</li>
<li>ç¬¬äºŒä¸ªæç¤ºè¯ï¼ˆè¶‹åŠ¿è¯†åˆ«ï¼‰ï¼šâ€œä½¿ç”¨æ‘˜è¦ï¼Œè¯†åˆ«å‰ä¸‰ä¸ªæ–°å…´è¶‹åŠ¿å¹¶æå–æ”¯æŒæ¯ä¸ªè¶‹åŠ¿çš„å…·ä½“æ•°æ®ç‚¹ï¼š[æ­¥éª¤1çš„è¾“å‡º]ã€‚â€æ­¤æç¤ºè¯ç°åœ¨æ›´å—çº¦æŸï¼Œå¹¶ç›´æ¥å»ºç«‹åœ¨ç»éªŒéªŒè¯çš„è¾“å‡ºä¹‹ä¸Šã€‚</li>
<li>ç¬¬ä¸‰ä¸ªæç¤ºè¯ï¼ˆç”µå­é‚®ä»¶æ’°å†™ï¼‰ï¼šâ€œå‘è¥é”€å›¢é˜Ÿèµ·è‰ä¸€å°ç®€æ˜çš„ç”µå­é‚®ä»¶ï¼Œæ¦‚è¿°ä»¥ä¸‹è¶‹åŠ¿åŠå…¶æ”¯æŒæ•°æ®ï¼š[æ­¥éª¤2çš„è¾“å‡º]ã€‚â€</li>
</ul>
<p>è¿™ç§å¯¹ä»»åŠ¡çš„åˆ†è§£å…è®¸å¯¹æµç¨‹è¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶ã€‚æ¯ä¸€æ­¥éƒ½ç®€å•æ˜äº†æ¸…æ™°ï¼Œè¿™æ ·å‡å°‘äº†æ¨¡å‹çš„è®¤çŸ¥è´Ÿè·ï¼Œå¯ä»¥è®©è¾“å‡ºçš„ç»“æœæ›´å‡†ç¡®ã€‚</p>
<p>è¿™ç§æ¨¡å—åŒ–ç±»ä¼¼è®¡ç®—ç®¡é“ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå‡½æ•°åœ¨æ‰§è¡Œç‰¹å®šæ“ä½œåå°†ç»“æœä¼ é€’ç»™ä¸‹ä¸€ä¸ªã€‚</p>
<p>ä¸ºäº†ç¡®ä¿æ¯ä¸ªç‰¹å®šä»»åŠ¡çš„å‡†ç¡®æ€§ï¼Œå¯ä»¥åœ¨æ¯ä¸ªé˜¶æ®µä¸ºæ¨¡å‹åˆ†é…ä¸åŒçš„è§’è‰²ã€‚ä¾‹å¦‚åœ¨ç»™å®šçš„åœºæ™¯ä¸­ï¼Œåˆå§‹åŒ–æç¤ºè¯çš„æ—¶å€™å¯ä»¥æŒ‡å®šï¼šå¸‚åœºåˆ†æå®¤ï¼›åç»­æç¤ºè¯ä¸ºâ€œè´¸æ˜“åˆ†æå¸ˆâ€ï¼›ç¬¬ä¸‰ä¸ªæç¤ºè¯ä¸ºâ€œä¸“å®¶æ–‡æ¡£æ’°å†™è€…â€ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<h3 data-id="heading-1">ç»“æ„åŒ–è¾“å‡º</h3>
<p>æˆ‘ä»¬ä¸Šé¢è¯´åˆ°ï¼Œæç¤ºè¯è¦åœ¨æ¯ä¸ªç¯èŠ‚ä¹‹å‰ä¼ é€’ï¼Œè¿™ä¸ªä¼ é€’å¾—é è°±æ‰è¡Œã€‚æˆ‘ä»¬è¦è®©ä»–é è°±ï¼Œæœ€å¥½åº”ç”¨jsonæ ¼å¼å»ä¼ é€’è¿™ä¸ªæ•°æ®ï¼š</p>
<h2 data-id="heading-2">è¿ç”¨é¢†åŸŸ</h2>
<p>æç¤ºè¯é“¾æ˜¯ä¸€ç§å¤šç”¨é€”æ¨¡å¼ï¼Œåœ¨æ„å»ºAgentå¯¹è¯ç³»ç»Ÿçš„æ—¶å€™è¿ç”¨çš„åœºæ™¯ç‰¹åˆ«å¤šï¼š</p>
<ul>
<li>ä¿¡æ¯å¤„ç†å·¥ä½œæµï¼ˆæ€»ç»“æ–‡æ¡£ã€æå–å…³é”®å®ä½“ã€ç„¶åä½¿ç”¨è¿™äº›å®ä½“æŸ¥è¯¢æ•°æ®åº“ç”ŸæˆæŠ¥å‘Šï¼‰
<ul>
<li>è‡ªåŠ¨åŒ–å†…å®¹åˆ†æ</li>
<li>AIé©±åŠ¨çš„ç ”ç©¶åŠ©æ‰‹</li>
<li>å¤æ‚æŠ¥å‘Šç”Ÿæˆ</li>
</ul>
</li>
<li>å¤æ‚æŸ¥è¯¢å›ç­”</li>
<li>æ•°æ®æå–å’Œè½¬æ¢
<ul>
<li>ä»è¡¨å•ã€å‘ç¥¨ã€ç”µå­é‚®ä»¶éç»“æ„åŒ–æ¥æºè¿›è¡Œæ•°æ®æå–å’Œåˆ†æ</li>
<li>OCRè¯†åˆ«ã€PDFè¡¨å•</li>
</ul>
</li>
<li>åˆ›æ„å™äº‹ã€æŠ€æœ¯æ–‡æ¡£ã€å…¶ä»–å½¢å¼ç»“æ„åŒ–æ–‡æ¡£å†…å®¹è‡ªåŠ¨åˆ›ä½œ</li>
<li>ä»£ç ç”Ÿæˆå’Œå®Œå–„å·¥å…·</li>
<li>å¤šæ¨¡æ€æ¨ç†
<ul>
<li>è§£é‡ŠåŒ…å«åµŒå…¥æ–‡æœ¬çš„å›¾ç‰‡ã€çªå‡ºæ˜¾ç¤ºæ–‡æœ¬çš„çš„æ ‡ç­¾ã€è§£é‡Šæ¯ä¸ªæ ‡ç­¾çš„è¡¨æ ¼æ•°æ®çš„å›¾åƒã€‚</li>
</ul>
</li>
</ul>
<h2 data-id="heading-3">å®é™…ä»£ç </h2>
<p>å¦‚ä½•ä½¿ç”¨Langchainåº“å¤„ç†æ–‡æœ¬ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥é€‰æ‹©ç”¨ä¸¤ä¸ªç‹¬ç«‹çš„æç¤ºè¯æ¥å®ç°ï¼š</p>
<ul>
<li>æç¤ºè¯1ï¼šä¸€ä¸ªä»è¾“å…¥å­—ç¬¦ä¸²ä¸­æå–æŠ€æœ¯è§„æ ¼</li>
<li>æç¤ºè¯2ï¼šä»è¿™äº›æŠ€æœ¯è§„æ ¼ä¸­è½¬æ¢ä¸ºjsonå¯¹è±¡</li>
</ul>
<p>æˆ‘ä»¬ä½¿ç”¨å¤§è¯­è¨€æ¨¡å‹äº¤äº’ï¼Œé…åˆStrOutputParserç¡®ä¿è¾“å‡ºä¸ºå¯ç”¨çš„å­—ç¬¦ä¸²æ ¼å¼ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> final

<span class="hljs-keyword">from</span> langchain_community.chat_models <span class="hljs-keyword">import</span> ChatTongyi
<span class="hljs-keyword">from</span> langchain_core.output_parsers <span class="hljs-keyword">import</span> StrOutputParser
<span class="hljs-keyword">from</span> langchain_core.prompts <span class="hljs-keyword">import</span> ChatPromptTemplate



os.environ[<span class="hljs-string">"DASHSCOPE_API_KEY"</span>] = <span class="hljs-string">"sk-xxx"</span><span class="hljs-comment">#æ¢æˆä½ è‡ªå·±çš„</span>
<span class="hljs-comment">##åˆå§‹åŒ–è¯­è¨€æ¨¡å‹</span>
llm = ChatTongyi(model=<span class="hljs-string">"qwen-turbo-2025-04-28"</span>)
<span class="hljs-comment">## æç¤ºè¯1ï¼šæå–ä¿¡æ¯</span>
prompt_extract = ChatPromptTemplate.from_template(
    <span class="hljs-string">"ä»ä»¥ä¸‹æ–‡æœ¬ä¸­æå–æŠ€æœ¯è§„æ ¼:\n\n{text_input}"</span>
)

<span class="hljs-comment">## æç¤ºè¯2ï¼šè½¬æ¢ä¸ºjson</span>
prompt_transform = ChatPromptTemplate.from_template(
    <span class="hljs-string">"å°†ä»¥ä¸‹è§„æ ¼è½¬æ¢ä¸ºjsonå¯¹è±¡ï¼Œä½¿ç”¨CPUã€memoryå’Œstorageä½œä¸ºé”®ï¼š\n\n{specifications}"</span>
)
<span class="hljs-comment">##ä½¿ç”¨LCELæ„å»ºé“¾</span>
extraction_chain = prompt_extract | llm | StrOutputParser()
<span class="hljs-comment">##å®Œæ•´çš„é“¾å°†æå–é“¾çš„è¾“å‡ºä¼ é€’åˆ°è½¬æ¢æç¤ºè¯çš„â€œspecificationsâ€å˜é‡ä¸­</span>
full_chain=(
    {<span class="hljs-string">"specifications"</span>:extraction_chain}
    | prompt_transform
    | llm
    | StrOutputParser()
)
<span class="hljs-comment">##è¿è¡Œé“¾</span>
input_text=<span class="hljs-string">"æ–°æ¬¾ç¬”è®°æœ¬ç”µè„‘å‹å·é…å¤‡3.5GHZï¼Œå…«æ ¸å¤„ç†å™¨ã€16GBå†…å­˜å’Œ1TBå›ºæ€ç¡¬ç›˜ã€‚"</span>
<span class="hljs-comment">##ä½¿ç”¨è¾“å…¥æ–‡æœ¬å­—å…¸æ‰§è¡Œé“¾</span>
final_result = full_chain.invoke({<span class="hljs-string">"text_input"</span>:input_text})

<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n---æœ€ç»ˆjsonè¾“å‡º---"</span>)
<span class="hljs-built_in">print</span>(final_result)
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a585f8b065f7496eb5aac6db325c2dba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29kZWxpbmdodQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766844557&amp;x-signature=2MU4zBcYK2OYrnruQ5H31LmrKSs%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Windowsç³»ç»Ÿæ— æ³•ç›´æ¥ç”¨uvå®‰è£…pyqt5ï¼Œä½†å¯ä»¥ç”¨uv pipå®‰è£…]]></title>    <link>https://juejin.cn/post/7585485284152557603</link>    <guid>https://juejin.cn/post/7585485284152557603</guid>    <pubDate>2025-12-20T13:10:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485284152557603" data-draft-id="7585476892976152610" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Windowsç³»ç»Ÿæ— æ³•ç›´æ¥ç”¨uvå®‰è£…pyqt5ï¼Œä½†å¯ä»¥ç”¨uv pipå®‰è£…"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-20T13:10:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¯¸ç¥ç¼„é»˜ä¸è¯­"/> <meta itemprop="url" content="https://juejin.cn/user/2036746568087502"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Windowsç³»ç»Ÿæ— æ³•ç›´æ¥ç”¨uvå®‰è£…pyqt5ï¼Œä½†å¯ä»¥ç”¨uv pipå®‰è£…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2036746568087502/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¯¸ç¥ç¼„é»˜ä¸è¯­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:10:06.000Z" title="Sat Dec 20 2025 13:10:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2FPolarisRisingWar%2Farticle%2Fdetails%2F116396744" target="_blank" title="https://blog.csdn.net/PolarisRisingWar/article/details/116396744" ref="nofollow noopener noreferrer">è¯¸ç¥ç¼„é»˜ä¸è¯­-ä¸ªäººæŠ€æœ¯åšæ–‡ä¸è§†é¢‘ç›®å½•</a></p>
<h2 data-id="heading-0">1. é—®é¢˜</h2>
<p>é—®é¢˜ï¼š
æ‰§è¡Œ<code>uv add pyqt5</code>æ—¶å®‰è£…å¤±è´¥ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">Resolved <span class="hljs-number">144</span> packages <span class="hljs-keyword">in</span> <span class="hljs-number">6.34</span>s
<span class="hljs-symbol">error:</span> Distribution `pyqt5-qt5==<span class="hljs-number">5.15</span>.<span class="hljs-number">18</span> @ registry+https://pypi.org/simple` can<span class="hljs-comment">'t be installed because it doesn't have a source distribution or wheel for the current platform</span>

<span class="hljs-symbol">hint:</span> You<span class="hljs-comment">'re on Windows (`win_amd64`), but `pyqt5-qt5` (v5.15.18) only has wheels for the following platforms: `manylinux2014_x86_64`, `macosx_10_13_x86_64`, `macosx_11_0_arm64`; consider adding your platform to `tool.uv.required-environments` to ensure uv resolves to a version with compatible wheels</span>
</code></pre>
<p>å¦‚æœåœ¨pyproject.tomlä¸­ç›´æ¥å†™å…¥pyqt5çš„è¯ï¼Œæ‰§è¡Œ<code>uv sync</code>æ—¶ä¼šè¿™ä¹ˆæŠ¥é”™ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">Resolved <span class="hljs-number">145</span> packages in <span class="hljs-number">1.78</span>s
  Ã— Failed to build `pyqt5==<span class="hljs-number">5.15</span><span class="hljs-number">.2</span>`
  â”œâ”€â–¶ The build backend returned an error                                           
  â•°â”€â–¶ Call to `sipbuild.api.build_wheel` <span class="hljs-built_in">failed</span> (exit code: <span class="hljs-number">1</span>)

      [stderr]
      pyproject.toml: line <span class="hljs-number">7</span>: <span class="hljs-keyword">using</span> <span class="hljs-string">'[tool.sip.metadata]'</span> to specify the project    
      metadata is deprecated <span class="hljs-keyword">and</span> will be removed in SIP v7<span class="hljs-number">.0</span><span class="hljs-number">.0</span>, use <span class="hljs-string">'[project]'</span>     
      instead
      <span class="hljs-built_in">Traceback</span> (most recent call last):
        <span class="hljs-built_in">File</span> <span class="hljs-string">"&lt;string&gt;"</span>, line <span class="hljs-number">11</span>, in &lt;<span class="hljs-keyword">module</span>&gt;
          wheel_filename =
      backend.<span class="hljs-built_in">build_wheel</span>(<span class="hljs-string">"D:\\all_applications\\foruv\\foruvcache\\builds-v0\\.tmpdm8CqW"</span>,
      {}, None)
        <span class="hljs-built_in">File</span>
      <span class="hljs-string">"D:\all_applications\foruv\foruvcache\builds-v0\.tmpywcL19\Lib\site-packages\sipbuild\api.py"</span>,
      line <span class="hljs-number">28</span>, in build_wheel
          project = AbstractProject.<span class="hljs-built_in">bootstrap</span>(<span class="hljs-string">'wheel'</span>,
                  arguments=_convert_config_settings(config_settings))
        <span class="hljs-built_in">File</span>
      <span class="hljs-string">"D:\all_applications\foruv\foruvcache\builds-v0\.tmpywcL19\Lib\site-packages\sipbuild\abstract_project.py"</span>,
      line <span class="hljs-number">74</span>, in bootstrap
          project.<span class="hljs-built_in">setup</span>(pyproject, tool, tool_description)
          ~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        <span class="hljs-built_in">File</span>
      <span class="hljs-string">"D:\all_applications\foruv\foruvcache\builds-v0\.tmpywcL19\Lib\site-packages\sipbuild\project.py"</span>,
      line <span class="hljs-number">661</span>, in setup
          self.<span class="hljs-built_in">apply_user_defaults</span>(tool)
          ~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
        <span class="hljs-built_in">File</span>
      <span class="hljs-string">"D:\all_applications\foruv\foruvcache\sdists-v9\pypi\pyqt5\5.15.2\DCnXDNUwgyaPDx3Z6cidl\src\project.py"</span>,
      line <span class="hljs-number">63</span>, in apply_user_defaults
          <span class="hljs-built_in">super</span>().<span class="hljs-built_in">apply_user_defaults</span>(tool)
          ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
        <span class="hljs-built_in">File</span>
      <span class="hljs-string">"D:\all_applications\foruv\foruvcache\builds-v0\.tmpywcL19\Lib\site-packages\pyqtbuild\project.py"</span>,
      line <span class="hljs-number">51</span>, in apply_user_defaults
          <span class="hljs-built_in">super</span>().<span class="hljs-built_in">apply_user_defaults</span>(tool)
          ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
        <span class="hljs-built_in">File</span>
      <span class="hljs-string">"D:\all_applications\foruv\foruvcache\builds-v0\.tmpywcL19\Lib\site-packages\sipbuild\project.py"</span>,
      line <span class="hljs-number">248</span>, in apply_user_defaults
          self.builder.<span class="hljs-built_in">apply_user_defaults</span>(tool)
          ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
        <span class="hljs-built_in">File</span>
      <span class="hljs-string">"D:\all_applications\foruv\foruvcache\builds-v0\.tmpywcL19\Lib\site-packages\pyqtbuild\builder.py"</span>,
      line <span class="hljs-number">49</span>, in apply_user_defaults
          raise <span class="hljs-built_in">PyProjectOptionException</span>(<span class="hljs-string">'qmake'</span>,
                  <span class="hljs-string">"specify a working qmake or add it to PATH"</span>)
      sipbuild.pyproject.PyProjectOptionException

      hint: This usually indicates a problem with the package <span class="hljs-keyword">or</span> the build
      environment.
  help: `pyqt5` (v5<span class="hljs-number">.15</span><span class="hljs-number">.2</span>) was included because `paid-column1` (v0<span class="hljs-number">.1</span><span class="hljs-number">.0</span>) depends      
        on `pyqt5`
</code></pre>
<h2 data-id="heading-1">2. åŸå› </h2>
<p>åŸå› å‡ºåœ¨pyqt5å®˜æ–¹ï¼Œä»–å®¶å°±é™åˆ¶äº†æœ€æ–°ç‰ˆpyqt5ä¾èµ–çš„pyqt5-qt5åŒ…ä¸èƒ½åœ¨Windowså¹³å°ä¸Šè£…ã€‚</p>
<h2 data-id="heading-2">3. è§£å†³æ–¹æ¡ˆ</h2>
<p>æˆ‘æœ€ç»ˆæˆåŠŸçš„è§£å†³æ–¹æ¡ˆæ˜¯å…ˆ<code>uv sync</code>å†<code>uv pip install pyqt5</code>ã€‚æ³¨æ„å¦‚æœåè¿‡æ¥ä¼šæŠŠç¯å¢ƒæ”¹å›pyproject.tomlçš„ç¯å¢ƒï¼Œä½†æˆ‘è§‰å¾—uvé€Ÿåº¦è¿™ä¹ˆå¿«ä½ æ¯æ¬¡éƒ½æ¥ä¸€éä¹Ÿæ²¡æœ‰å…³ç³»ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Using Python 3.13.7 environment at: D:\Codes\uv_environment\example\.venv
Resolved 3 packages in 12.74s
Prepared 2 packages in 49.63s
Installed 3 packages in 296ms
 + <span class="hljs-attr">pyqt5</span>==<span class="hljs-number">5.15</span>.<span class="hljs-number">11</span>                                                                   
 + <span class="hljs-attr">pyqt5-qt5</span>==<span class="hljs-number">5.15</span>.<span class="hljs-number">2</span>
 + <span class="hljs-attr">pyqt5-sip</span>==<span class="hljs-number">12.17</span>.<span class="hljs-number">2</span>
</code></pre>
<p>å…¶ä»–æåˆ°çš„å¯èƒ½æœ‰ç”¨çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li><code>uv add pyqt5==5.15.11 pyqt5-qt5==5.15.2</code><sup><a href="#user-content-fn-1" id="user-content-user-content-fnref-1" data-footnote-ref="" aria-describedby="footnote-label" title="#user-content-fn-1">1</a></sup></li>
<li>åœ¨pyproject.tomlä¸­å¢åŠ ï¼ˆè·Ÿä¸Šé¢ä¸€æ¡å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å†™æ³•ä¸åŒï¼‰<sup><a href="#user-content-fn-2" id="user-content-user-content-fnref-2" data-footnote-ref="" aria-describedby="footnote-label" title="#user-content-fn-2">2</a></sup>ï¼š
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[dependency-groups]</span>
<span class="hljs-attr">dev</span> = [
    <span class="hljs-string">"pyqt5==5.15.11"</span>,
    <span class="hljs-string">"pyqt5-qt5==5.15.2"</span>,
]
</code></pre>
æˆ–<sup><a href="#user-content-fn-4" id="user-content-user-content-fnref-4" data-footnote-ref="" aria-describedby="footnote-label" title="#user-content-fn-4">3</a></sup>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">deps</span> = [
    <span class="hljs-string">"pyqt5&gt;=5.15.11; sys_platform != 'win32'"</span>,
    <span class="hljs-string">"pyqt5&lt;=5.15.2; sys_platform == 'win32'"</span>
]
</code></pre>
</li>
<li>åœ¨pyproject.tomlä¸­å¢åŠ <sup><a href="#user-content-fn-4" id="user-content-user-content-fnref-4-2" data-footnote-ref="" aria-describedby="footnote-label" title="#user-content-fn-4">3</a></sup>ï¼š
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[tool.uv]</span>
<span class="hljs-attr">constraint-dependencies</span> = [<span class="hljs-string">"pyqt5-qt5 &lt;=5.15.2"</span>]
</code></pre>
</li>
<li>ç”¨PyQt6ï¼ˆè‰ï¼‰<sup><a href="#user-content-fn-3" id="user-content-user-content-fnref-3" data-footnote-ref="" aria-describedby="footnote-label" title="#user-content-fn-3">4</a></sup></li>
</ol>
<h3 class="sr-only" id="user-content-footnote-label" data-id="heading-3">Footnotes</h3>
<ol>
<li id="user-content-user-content-fn-1">
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fuv%2Fissues%2F11865" target="_blank" title="https://github.com/astral-sh/uv/issues/11865" ref="nofollow noopener noreferrer">Bug Report: uv sync Fails to Install PyQt5 on Windows Â· Issue #11865 Â· astral-sh/uv</a> <a href="#user-content-fnref-1" data-footnote-backref="" class="data-footnote-backref" aria-label="Back to content" title="#user-content-fnref-1">â†©</a></p>
</li>
<li id="user-content-user-content-fn-2">
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fuv%2Fissues%2F15421" target="_blank" title="https://github.com/astral-sh/uv/issues/15421" ref="nofollow noopener noreferrer"><code>uv sync</code> fails on <code>PyQt5</code> but pip install is OK Â· Issue #15421 Â· astral-sh/uv</a> <a href="#user-content-fnref-2" data-footnote-backref="" class="data-footnote-backref" aria-label="Back to content" title="#user-content-fnref-2">â†©</a></p>
</li>
<li id="user-content-user-content-fn-4">
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fastral-sh%2Fuv%2Fissues%2F7005" target="_blank" title="https://github.com/astral-sh/uv/issues/7005" ref="nofollow noopener noreferrer"><code>uv add pyqt5</code> error Â· Issue #7005 Â· astral-sh/uv</a> <a href="#user-content-fnref-4" data-footnote-backref="" class="data-footnote-backref" aria-label="Back to content" title="#user-content-fnref-4">â†©</a> <a href="#user-content-fnref-4-2" data-footnote-backref="" class="data-footnote-backref" aria-label="Back to content" title="#user-content-fnref-4-2">â†©<sup>2</sup></a></p>
</li>
<li id="user-content-user-content-fn-3">
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnapari%2Fnapari%2Fpull%2F7744" target="_blank" title="https://github.com/napari/napari/pull/7744" ref="nofollow noopener noreferrer">Add pyqt5-qt5 pin for <code>uv add</code> compatibility on Windows by TimMonko Â· Pull Request #7744 Â· napari/napari</a> <a href="#user-content-fnref-3" data-footnote-backref="" class="data-footnote-backref" aria-label="Back to content" title="#user-content-fnref-3">â†©</a></p>
</li>
</ol>
</div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Code å‘½ä»¤å®Œæ•´æ–‡æ¡£]]></title>    <link>https://juejin.cn/post/7585463258691256329</link>    <guid>https://juejin.cn/post/7585463258691256329</guid>    <pubDate>2025-12-20T11:47:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585463258691256329" data-draft-id="7585484081435754547" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Code å‘½ä»¤å®Œæ•´æ–‡æ¡£"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T11:47:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å§ç„¶_9527"/> <meta itemprop="url" content="https://juejin.cn/user/1025189696514199"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Code å‘½ä»¤å®Œæ•´æ–‡æ¡£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1025189696514199/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å§ç„¶_9527
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T11:47:49.000Z" title="Sat Dec 20 2025 11:47:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Claude Code å‘½ä»¤å®Œæ•´æ–‡æ¡£</h2>
<h3 data-id="heading-1">ğŸ“š ç›®å½•</h3>
<ul>
<li><a href="#%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4" title="#%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4">åŸºç¡€å‘½ä»¤</a></li>
<li><a href="#%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86" title="#%E4%BC%9A%E8%AF%9D%E7%AE%A1%E7%90%86">ä¼šè¯ç®¡ç†</a></li>
<li><a href="#%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86" title="#%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86">é…ç½®ç®¡ç†</a></li>
<li><a href="#%E6%96%9C%E6%9D%A0%E5%91%BD%E4%BB%A4%E4%BA%A4%E4%BA%92%E5%BC%8F%E5%91%BD%E4%BB%A4" title="#%E6%96%9C%E6%9D%A0%E5%91%BD%E4%BB%A4%E4%BA%A4%E4%BA%92%E5%BC%8F%E5%91%BD%E4%BB%A4">æ–œæ å‘½ä»¤ï¼ˆäº¤äº’å¼å‘½ä»¤ï¼‰</a></li>
<li><a href="#%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD" title="#%E9%AB%98%E7%BA%A7%E5%8A%9F%E8%83%BD">é«˜çº§åŠŸèƒ½</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B" title="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">ä½¿ç”¨ç¤ºä¾‹</a></li>
<li><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" title="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">å¸¸è§é—®é¢˜</a></li>
</ul>
<hr/>
<h3 data-id="heading-2">åŸºç¡€å‘½ä»¤</h3>
<h4 data-id="heading-3">1. <code>claude</code></h4>
<p>å¯åŠ¨ Claude Code çš„äº¤äº’å¼ REPLï¼ˆRead-Eval-Print Loopï¼‰ç¯å¢ƒï¼Œè¿›å…¥å¯¹è¯æ¨¡å¼ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">claude
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>å¯åŠ¨åä¼šè¿›å…¥äº¤äº’å¼å‘½ä»¤è¡Œç•Œé¢</li>
<li>å¯ä»¥æŒç»­ä¸ Claude Code å¯¹è¯</li>
<li>æ”¯æŒå¤šè½®å¯¹è¯ï¼Œä¿ç•™ä¸Šä¸‹æ–‡ä¿¡æ¯</li>
<li>è¾“å…¥ <code>exit</code> æˆ– <code>quit</code> é€€å‡º</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ claude
&gt; ä½ å¥½ï¼Œæˆ‘æƒ³äº†è§£ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®çš„ç»“æ„
[Claude Code ä¼šåˆ†æé¡¹ç›®å¹¶ç»™å‡ºå›ç­”]
&gt; å¸®æˆ‘ä¼˜åŒ–è¿™ä¸ªå‡½æ•°çš„æ€§èƒ½
[Claude Code æä¾›ä¼˜åŒ–å»ºè®®]
&gt; <span class="hljs-built_in">exit</span>
</code></pre>
<hr/>
<h4 data-id="heading-4">2. <code>claude "æŸ¥è¯¢å†…å®¹"</code></h4>
<p>ä½¿ç”¨åˆå§‹æç¤ºå¯åŠ¨ REPLï¼ŒClaude Code ä¼šæ ¹æ®æä¾›çš„æç¤ºå¼€å§‹ä¼šè¯ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">claude <span class="hljs-string">"æŸ¥è¯¢å†…å®¹"</span>
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>å¯ä»¥ç«‹å³å¼€å§‹å¯¹è¯ï¼Œæ— éœ€ç­‰å¾…è¿›å…¥äº¤äº’æ¨¡å¼</li>
<li>é€‚åˆå¿«é€ŸæŸ¥è¯¢åœºæ™¯</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¯¢é—®é¡¹ç›®ç»“æ„</span>
claude <span class="hljs-string">"è§£é‡Šè¿™ä¸ªSpring Booté¡¹ç›®çš„æ¶æ„"</span>

<span class="hljs-comment"># åˆ†æä»£ç </span>
claude <span class="hljs-string">"åˆ†æ UserController ç±»çš„åŠŸèƒ½"</span>

<span class="hljs-comment"># ç”Ÿæˆä»£ç </span>
claude <span class="hljs-string">"å¸®æˆ‘åˆ›å»ºä¸€ä¸ª RESTful API æ§åˆ¶å™¨"</span>
</code></pre>
<hr/>
<h4 data-id="heading-5">3. <code>claude -p "æŸ¥è¯¢å†…å®¹"</code> / <code>claude --prompt "æŸ¥è¯¢å†…å®¹"</code></h4>
<p>è¿è¡Œä¸€æ¬¡æ€§æŸ¥è¯¢ï¼Œå¤„ç†å®Œæˆåç›´æ¥é€€å‡ºï¼Œä¸è¿›å…¥äº¤äº’æ¨¡å¼ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">claude -p <span class="hljs-string">"æŸ¥è¯¢å†…å®¹"</span>
claude --prompt <span class="hljs-string">"æŸ¥è¯¢å†…å®¹"</span>
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>-p</code> å’Œ <code>--prompt</code> åŠŸèƒ½ç›¸åŒï¼Œå¯ä»¥äº’æ¢ä½¿ç”¨</li>
<li>é€‚åˆè„šæœ¬è°ƒç”¨æˆ–è‡ªåŠ¨åŒ–åœºæ™¯</li>
<li>å¤„ç†å®ŒæŸ¥è¯¢åç«‹å³é€€å‡ºï¼Œä¸ä¿ç•™ä¼šè¯</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸€æ¬¡æ€§æŸ¥è¯¢</span>
claude -p <span class="hljs-string">"æ£€æŸ¥ä»£ç ä¸­çš„è¯­æ³•é”™è¯¯"</span>

<span class="hljs-comment"># åœ¨è„šæœ¬ä¸­ä½¿ç”¨</span>
claude -p <span class="hljs-string">"ç”Ÿæˆå•å…ƒæµ‹è¯•"</span> &gt; test_output.txt
</code></pre>
<hr/>
<h4 data-id="heading-6">4. <code>cat æ–‡ä»¶ | claude -p "æŸ¥è¯¢å†…å®¹"</code></h4>
<p>é€šè¿‡ç®¡é“ï¼ˆpipeï¼‰å°†æ–‡ä»¶å†…å®¹ä¼ é€’ç»™ Claude Code å¤„ç†ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> &lt;æ–‡ä»¶è·¯å¾„&gt; | claude -p <span class="hljs-string">"æŸ¥è¯¢å†…å®¹"</span>
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>åˆ©ç”¨ Unix/Linux çš„ç®¡é“æœºåˆ¶ä¼ é€’æ•°æ®</li>
<li>é€‚åˆå¤„ç†å¤§æ–‡ä»¶æˆ–æ—¥å¿—æ–‡ä»¶</li>
<li>Claude Code ä¼šåŸºäºä¼ å…¥çš„å†…å®¹è¿›è¡Œåˆ†æ</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ†ææ—¥å¿—æ–‡ä»¶</span>
<span class="hljs-built_in">cat</span> app.log | claude -p <span class="hljs-string">"æ‰¾å‡ºé”™è¯¯ä¿¡æ¯å¹¶æ€»ç»“"</span>

<span class="hljs-comment"># åˆ†æä»£ç æ–‡ä»¶</span>
<span class="hljs-built_in">cat</span> UserService.java | claude -p <span class="hljs-string">"è§£é‡Šè¿™ä¸ªç±»çš„åŠŸèƒ½"</span>

<span class="hljs-comment"># åˆ†æå¤šä¸ªæ–‡ä»¶</span>
<span class="hljs-built_in">cat</span> *.java | claude -p <span class="hljs-string">"æ£€æŸ¥ä»£ç é£æ ¼ä¸€è‡´æ€§"</span>
</code></pre>
<p><strong>Windows ç­‰æ•ˆå‘½ä»¤</strong>ï¼š</p>
<pre><code class="hljs language-cmd" lang="cmd">type app.log | claude -p "åˆ†æé”™è¯¯"
</code></pre>
<hr/>
<h3 data-id="heading-7">ä¼šè¯ç®¡ç†</h3>
<h4 data-id="heading-8">5. <code>claude -c</code> / <code>claude --continue</code></h4>
<p>ç»§ç»­æœ€è¿‘çš„å¯¹è¯ï¼Œä¼šè¯ä¸Šä¸‹æ–‡å¾—ä»¥ä¿ç•™ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">claude -c
claude --<span class="hljs-built_in">continue</span>
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>æ¢å¤æœ€è¿‘ä¸€æ¬¡å¯¹è¯çš„ä¸Šä¸‹æ–‡</li>
<li>é€‚åˆåœ¨ä¸­æ–­åç»§ç»­ä¹‹å‰çš„å¯¹è¯</li>
<li>ä¿ç•™ä¹‹å‰çš„å¯¹è¯å†å²</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¹‹å‰çš„å¯¹è¯</span>
$ claude
&gt; å¸®æˆ‘é‡æ„ UserService ç±»
[Claude Code æä¾›é‡æ„æ–¹æ¡ˆ]
&gt; <span class="hljs-built_in">exit</span>

<span class="hljs-comment"># ç»§ç»­å¯¹è¯</span>
$ claude -c
&gt; æŒ‰ç…§ä½ çš„å»ºè®®ï¼Œæˆ‘å·²ç»ä¿®æ”¹äº†ä»£ç ï¼Œè¯·æ£€æŸ¥ä¸€ä¸‹
[Claude Code ä¼šåŸºäºä¹‹å‰çš„ä¸Šä¸‹æ–‡è¿›è¡Œæ£€æŸ¥]
</code></pre>
<hr/>
<h4 data-id="heading-9">6. <code>claude -c -p "æŸ¥è¯¢å†…å®¹"</code></h4>
<p>åœ¨ç»§ç»­æœ€è¿‘å¯¹è¯çš„åŸºç¡€ä¸Šï¼Œè¿è¡Œæ–°çš„æŸ¥è¯¢ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">claude -c -p <span class="hljs-string">"æŸ¥è¯¢å†…å®¹"</span>
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>ç»“åˆäº† <code>-c</code> å’Œ <code>-p</code> çš„åŠŸèƒ½</li>
<li>æ¢å¤ä¸Šä¸‹æ–‡ä½†ä¸è¿›å…¥äº¤äº’æ¨¡å¼</li>
<li>é€‚åˆåœ¨è„šæœ¬ä¸­ç»§ç»­ä¹‹å‰çš„å¯¹è¯</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸€æ¬¡æ€§ç»§ç»­å¯¹è¯å¹¶æŸ¥è¯¢</span>
claude -c -p <span class="hljs-string">"åˆšæ‰çš„é‡æ„æ˜¯å¦å®Œæ•´ï¼Ÿ"</span>
</code></pre>
<hr/>
<h4 data-id="heading-10">7. <code>claude -r "&lt;ä¼šè¯ID&gt;" "æŸ¥è¯¢å†…å®¹"</code> / <code>claude --resume "&lt;ä¼šè¯ID&gt;" "æŸ¥è¯¢å†…å®¹"</code></h4>
<p>é€šè¿‡æŒ‡å®šä¼šè¯ ID æ¢å¤ä¹‹å‰çš„ä¼šè¯ï¼Œå¹¶è¿è¡Œæ–°çš„æŸ¥è¯¢ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">claude -r <span class="hljs-string">"&lt;ä¼šè¯ID&gt;"</span> <span class="hljs-string">"æŸ¥è¯¢å†…å®¹"</span>
claude --resume <span class="hljs-string">"&lt;ä¼šè¯ID&gt;"</span> <span class="hljs-string">"æŸ¥è¯¢å†…å®¹"</span>
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>-r</code> å’Œ <code>--resume</code> åŠŸèƒ½ç›¸åŒ</li>
<li>éœ€è¦æä¾›ä¼šè¯ IDï¼ˆé€šå¸¸åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºï¼‰</li>
<li>å¯ä»¥æ¢å¤ä»»æ„å†å²ä¼šè¯</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ¢å¤æŒ‡å®šä¼šè¯</span>
claude -r <span class="hljs-string">"abc123def456"</span> <span class="hljs-string">"ç»§ç»­å®Œæˆä¹‹å‰çš„ä»»åŠ¡"</span>

<span class="hljs-comment"># åœ¨è„šæœ¬ä¸­ä½¿ç”¨</span>
claude -r <span class="hljs-string">"<span class="hljs-variable">$SESSION_ID</span>"</span> <span class="hljs-string">"æ£€æŸ¥ä»£ç è´¨é‡"</span>
</code></pre>
<p><strong>å¦‚ä½•è·å–ä¼šè¯ ID</strong>ï¼š</p>
<ul>
<li>åœ¨äº¤äº’å¼ä¼šè¯ä¸­ï¼Œä¼šè¯ ID é€šå¸¸ä¼šæ˜¾ç¤ºåœ¨æç¤ºç¬¦ä¸­</li>
<li>æŸ¥çœ‹å†å²ä¼šè¯åˆ—è¡¨ï¼ˆå¦‚æœæ”¯æŒï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-11">é…ç½®ç®¡ç†</h3>
<h4 data-id="heading-12">8. <code>claude config</code></h4>
<p>æŸ¥çœ‹æˆ–ä¿®æ”¹ Claude Code çš„é…ç½®è®¾ç½®ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹æ‰€æœ‰é…ç½®</span>
claude config

<span class="hljs-comment"># æŸ¥çœ‹ç‰¹å®šé…ç½®é¡¹</span>
claude config get &lt;é…ç½®é¡¹&gt;

<span class="hljs-comment"># è®¾ç½®é…ç½®é¡¹ï¼ˆå½“å‰ä¼šè¯ï¼‰</span>
claude config <span class="hljs-built_in">set</span> &lt;é…ç½®é¡¹&gt; &lt;å€¼&gt;

<span class="hljs-comment"># è®¾ç½®å…¨å±€é…ç½®é¡¹</span>
claude config <span class="hljs-built_in">set</span> --global &lt;é…ç½®é¡¹&gt; &lt;å€¼&gt;

<span class="hljs-comment"># åˆ é™¤é…ç½®é¡¹</span>
claude config <span class="hljs-built_in">unset</span> &lt;é…ç½®é¡¹&gt;
</code></pre>
<p><strong>å¸¸ç”¨é…ç½®é¡¹</strong>ï¼š</p>









































<table><thead><tr><th>é…ç½®é¡¹</th><th>è¯´æ˜</th><th>å¯é€‰å€¼</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>theme</code></td><td>ç•Œé¢ä¸»é¢˜</td><td><code>dark</code>, <code>light</code>, <code>auto</code></td><td><code>claude config set theme dark</code></td></tr><tr><td><code>model</code></td><td>ä½¿ç”¨çš„æ¨¡å‹</td><td><code>claude-3-5-sonnet</code>, <code>claude-3-opus</code> ç­‰</td><td><code>claude config set model claude-3-5-sonnet</code></td></tr><tr><td><code>max-tokens</code></td><td>æœ€å¤§ä»¤ç‰Œæ•°</td><td>æ•°å­—</td><td><code>claude config set max-tokens 4096</code></td></tr><tr><td><code>temperature</code></td><td>æ¸©åº¦å‚æ•°</td><td>0.0-1.0</td><td><code>claude config set temperature 0.7</code></td></tr><tr><td><code>locale</code></td><td>è¯­è¨€è®¾ç½®</td><td><code>zh-CN</code>, <code>en-US</code> ç­‰</td><td><code>claude config set locale zh-CN</code></td></tr></tbody></table>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰æ‰€æœ‰é…ç½®</span>
claude config

<span class="hljs-comment"># æŸ¥çœ‹ä¸»é¢˜è®¾ç½®</span>
claude config get theme

<span class="hljs-comment"># è®¾ç½®æš—è‰²ä¸»é¢˜ï¼ˆä»…å½“å‰ä¼šè¯ï¼‰</span>
claude config <span class="hljs-built_in">set</span> theme dark

<span class="hljs-comment"># å…¨å±€è®¾ç½®æš—è‰²ä¸»é¢˜</span>
claude config <span class="hljs-built_in">set</span> --global theme dark

<span class="hljs-comment"># è®¾ç½®ä½¿ç”¨ä¸­æ–‡</span>
claude config <span class="hljs-built_in">set</span> locale zh-CN

<span class="hljs-comment"># åˆ é™¤æŸä¸ªé…ç½®é¡¹</span>
claude config <span class="hljs-built_in">unset</span> theme
</code></pre>
<p><strong>é…ç½®æ–‡ä»¶ä½ç½®</strong>ï¼š</p>
<ul>
<li>å…¨å±€é…ç½®ï¼š<code>~/.claude/config.json</code> æˆ– <code>%USERPROFILE%\.claude\config.json</code>ï¼ˆWindowsï¼‰</li>
<li>é¡¹ç›®é…ç½®ï¼š<code>.claude/config.json</code>ï¼ˆé¡¹ç›®æ ¹ç›®å½•ï¼‰</li>
</ul>
<hr/>
<h4 data-id="heading-13">9. <code>claude update</code></h4>
<p>æ›´æ–° Claude Code åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">claude update
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>æ£€æŸ¥å¹¶ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</li>
<li>å¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™</li>
<li>æ›´æ–°åå»ºè®®é‡å¯ç»ˆç«¯</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬</span>
claude update

<span class="hljs-comment"># å¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™ï¼ˆmacOS/Linuxï¼‰</span>
sudo claude update
</code></pre>
<hr/>
<h3 data-id="heading-14">æ–œæ å‘½ä»¤ï¼ˆäº¤äº’å¼å‘½ä»¤ï¼‰</h3>
<p>ä»¥ä¸‹å‘½ä»¤éœ€è¦åœ¨äº¤äº’å¼ä¼šè¯ä¸­ä½¿ç”¨ï¼ˆå³å…ˆæ‰§è¡Œ <code>claude</code> è¿›å…¥äº¤äº’æ¨¡å¼ï¼‰ã€‚</p>
<h4 data-id="heading-15">10. <code>/add-dir &lt;ç›®å½•è·¯å¾„&gt;</code></h4>
<p>å°†æŒ‡å®šç›®å½•æ·»åŠ åˆ° Claude Code çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œæ–¹ä¾¿å…¶è®¿é—®å’Œç†è§£è¯¥ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/add-dir &lt;ç›®å½•è·¯å¾„&gt;
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>å¿…é¡»åœ¨äº¤äº’å¼ä¼šè¯ä¸­ä½¿ç”¨</li>
<li>æ·»åŠ åï¼ŒClaude Code å¯ä»¥æ›´å¥½åœ°ç†è§£è¯¥ç›®å½•ä¸‹çš„ä»£ç </li>
<li>æ”¯æŒç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„</li>
<li>å¯ä»¥å¤šæ¬¡ä½¿ç”¨æ·»åŠ å¤šä¸ªç›®å½•</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">/add-dir src/main/java</span>
å·²æ·»åŠ ç›®å½•: src/main/java
<span class="hljs-meta prompt_">
&gt; </span><span class="bash">/add-dir ./common-starter</span>
å·²æ·»åŠ ç›®å½•: ./common-starter
<span class="hljs-meta prompt_">
&gt; </span><span class="bash">/add-dir C:\Users\dale\Desktop\é¡¹ç›®\src</span>
å·²æ·»åŠ ç›®å½•: C:\Users\dale\Desktop\é¡¹ç›®\src
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>è®© Claude Code äº†è§£é¡¹ç›®ç»“æ„</li>
<li>æ·»åŠ ç‰¹å®šæ¨¡å—è¿›è¡Œåˆ†æ</li>
<li>é™åˆ¶ Claude Code çš„å…³æ³¨èŒƒå›´</li>
</ul>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<ul>
<li>æ·»åŠ å¤§ç›®å½•å¯èƒ½ä¼šæ¶ˆè€—æ›´å¤šä»¤ç‰Œ</li>
<li>å»ºè®®åªæ·»åŠ ç›¸å…³çš„æºä»£ç ç›®å½•ï¼Œé¿å…æ·»åŠ  <code>node_modules</code>ã€<code>target</code> ç­‰ç¼–è¯‘äº§ç‰©ç›®å½•</li>
</ul>
<hr/>
<h4 data-id="heading-16">11. <code>/cost</code></h4>
<p>æ˜¾ç¤ºå½“å‰ä¼šè¯çš„ä»¤ç‰Œä½¿ç”¨ç»Ÿè®¡ï¼Œå¸®åŠ©æ‚¨äº†è§£èµ„æºæ¶ˆè€—æƒ…å†µã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/cost
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>æ˜¾ç¤ºå·²ä½¿ç”¨çš„è¾“å…¥ä»¤ç‰Œæ•°</li>
<li>æ˜¾ç¤ºå·²ä½¿ç”¨çš„è¾“å‡ºä»¤ç‰Œæ•°</li>
<li>æ˜¾ç¤ºæ€»ä»¤ç‰Œæ•°</li>
<li>å¯èƒ½æ˜¾ç¤ºé¢„ä¼°è´¹ç”¨ï¼ˆå¦‚æœæœ‰ï¼‰</li>
</ul>
<p><strong>ç¤ºä¾‹è¾“å‡º</strong>ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile">&gt; /cost
å½“å‰ä¼šè¯ä»¤ç‰Œä½¿ç”¨ç»Ÿè®¡ï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
<span class="hljs-section">è¾“å…¥ä»¤ç‰Œ: 2,345</span>
<span class="hljs-section">è¾“å‡ºä»¤ç‰Œ: 1,567</span>
<span class="hljs-section">æ€»ä»¤ç‰Œæ•°: 3,912</span>
<span class="hljs-section">é¢„ä¼°è´¹ç”¨: $0.012</span>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ç›‘æ§ API ä½¿ç”¨é‡</li>
<li>ä¼˜åŒ–æç¤ºè¯ä»¥å‡å°‘ä»¤ç‰Œæ¶ˆè€—</li>
<li>æ§åˆ¶ä½¿ç”¨æˆæœ¬</li>
</ul>
<hr/>
<h4 data-id="heading-17">12. <code>/config</code></h4>
<p>åœ¨äº¤äº’å¼ä¼šè¯ä¸­æŸ¥çœ‹æˆ–ä¿®æ”¹å½“å‰ä¼šè¯çš„é…ç½®è®¾ç½®ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹é…ç½®</span>
/config

<span class="hljs-comment"># è®¾ç½®é…ç½®ï¼ˆåœ¨äº¤äº’æ¨¡å¼ä¸­ç›´æ¥è¾“å…¥ï¼‰</span>
/config theme dark
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>åœ¨äº¤äº’å¼ä¼šè¯ä¸­å¿«é€Ÿä¿®æ”¹é…ç½®</li>
<li>é…ç½®ä»…å¯¹å½“å‰ä¼šè¯æœ‰æ•ˆ</li>
<li>ç­‰åŒäº <code>claude config</code> çš„äº¤äº’å¼ç‰ˆæœ¬</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-quote">&gt; /config</span>
å½“å‰é…ç½®ï¼š
<span class="hljs-bullet">-</span> theme: light
<span class="hljs-bullet">-</span> model: claude-3-5-sonnet
<span class="hljs-bullet">-</span> locale: zh-CN

<span class="hljs-quote">&gt; /config theme dark</span>
å·²è®¾ç½®ä¸»é¢˜ä¸º: dark
</code></pre>
<hr/>
<h4 data-id="heading-18">13. <code>/clear</code></h4>
<p>æ¸…é™¤å½“å‰å¯¹è¯å†å²ï¼Œå¼€å§‹æ–°çš„ä¼šè¯ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">/clear
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>æ¸…é™¤å½“å‰ä¼šè¯çš„æ‰€æœ‰å†å²è®°å½•</li>
<li>é‡ç½®ä¸Šä¸‹æ–‡</li>
<li>ä¸é€€å‡ºäº¤äº’æ¨¡å¼ï¼Œç»§ç»­å¯¹è¯</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">å¸®æˆ‘åˆ†æ UserService ç±»</span>
[Claude Code åˆ†æ...]
<span class="hljs-meta prompt_">
&gt; </span><span class="bash">/clear</span>
å¯¹è¯å†å²å·²æ¸…é™¤
<span class="hljs-meta prompt_">
&gt; </span><span class="bash">ç°åœ¨å¸®æˆ‘åˆ†æ OrderService ç±»</span>
[Claude Code å¼€å§‹æ–°çš„åˆ†æï¼Œä¸å—ä¹‹å‰å½±å“]
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>åˆ‡æ¢ä¸åŒçš„ä»»åŠ¡ä¸»é¢˜</li>
<li>é¿å…ä¸Šä¸‹æ–‡æ··æ·†</li>
<li>é‡æ–°å¼€å§‹å¯¹è¯</li>
</ul>
<hr/>
<h4 data-id="heading-19">14. <code>/help</code></h4>
<p>è·å–å¯ç”¨å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/help
/help &lt;å‘½ä»¤å&gt;
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤åˆ—è¡¨</li>
<li>å¯ä»¥æŸ¥çœ‹ç‰¹å®šå‘½ä»¤çš„è¯¦ç»†è¯´æ˜</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">&gt; /help
å¯ç”¨å‘½ä»¤ï¼š
  /add-dir    æ·»åŠ ç›®å½•åˆ°ä¸Šä¸‹æ–‡
  /cost       æ˜¾ç¤ºä»¤ç‰Œä½¿ç”¨ç»Ÿè®¡
  /config     æŸ¥çœ‹/ä¿®æ”¹é…ç½®
  /clear      æ¸…é™¤å¯¹è¯å†å²
  /help       æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
  ...

&gt; /help add-dir
/add-dir &lt;ç›®å½•è·¯å¾„&gt;
å°†æŒ‡å®šç›®å½•æ·»åŠ åˆ°ä¸Šä¸‹æ–‡ä¸­
</code></pre>
<hr/>
<h4 data-id="heading-20">15. <code>/init</code></h4>
<p>ä½¿ç”¨ <code>CLAUDE.md</code> æŒ‡å—åˆå§‹åŒ–é¡¹ç›®ï¼Œç”Ÿæˆé¡¹ç›®è¯´æ˜æ–‡ä»¶ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/init
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>åœ¨é¡¹ç›®æ ¹ç›®å½•ç”Ÿæˆæˆ–æ›´æ–° <code>CLAUDE.md</code> æ–‡ä»¶</li>
<li>åŸºäºå½“å‰é¡¹ç›®ç»“æ„ç”Ÿæˆé¡¹ç›®è¯´æ˜</li>
<li>å¸®åŠ© Claude Code æ›´å¥½åœ°ç†è§£é¡¹ç›®</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">/init</span>
æ­£åœ¨åˆ†æé¡¹ç›®ç»“æ„...
å·²ç”Ÿæˆ CLAUDE.md æ–‡ä»¶
<span class="hljs-meta prompt_">
&gt; </span><span class="bash">/init</span>
CLAUDE.md å·²å­˜åœ¨ï¼Œæ˜¯å¦æ›´æ–°ï¼Ÿ(y/n)
</code></pre>
<p><strong>ç”Ÿæˆçš„ <code>CLAUDE.md</code> é€šå¸¸åŒ…å«</strong>ï¼š</p>
<ul>
<li>é¡¹ç›®æ¦‚è¿°</li>
<li>æŠ€æœ¯æ ˆ</li>
<li>é¡¹ç›®ç»“æ„</li>
<li>å¼€å‘è§„èŒƒ</li>
<li>å¸¸ç”¨å‘½ä»¤</li>
</ul>
<hr/>
<h4 data-id="heading-21">16. <code>/login</code></h4>
<p>ç™»å½•æ‚¨çš„ Anthropic è´¦æˆ·ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/login
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>æç¤ºè¾“å…¥ API Key æˆ–é€šè¿‡æµè§ˆå™¨ç™»å½•</li>
<li>ä¿å­˜è®¤è¯ä¿¡æ¯ä»¥ä¾¿åç»­ä½¿ç”¨</li>
<li>å¿…éœ€æ­¥éª¤æ‰èƒ½ä½¿ç”¨ Claude Code</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">/login</span>
è¯·è¾“å…¥æ‚¨çš„ API Key: sk-ant-...
ç™»å½•æˆåŠŸï¼

æˆ–
<span class="hljs-meta prompt_">
&gt; </span><span class="bash">/login</span>
æ­£åœ¨æ‰“å¼€æµè§ˆå™¨è¿›è¡Œç™»å½•...
è¯·åœ¨æµè§ˆå™¨ä¸­å®Œæˆç™»å½•
ç™»å½•æˆåŠŸï¼
</code></pre>
<hr/>
<h4 data-id="heading-22">17. <code>/logout</code></h4>
<p>ç™»å‡ºå½“å‰ Anthropic è´¦æˆ·ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/logout
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>æ¸…é™¤æœ¬åœ°ä¿å­˜çš„è®¤è¯ä¿¡æ¯</li>
<li>ä¸‹æ¬¡ä½¿ç”¨æ—¶éœ€è¦é‡æ–°ç™»å½•</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">/logout</span>
å·²ç™»å‡º
</code></pre>
<hr/>
<h4 data-id="heading-23">18. <code>/memory</code></h4>
<p>ç¼–è¾‘ <code>CLAUDE.md</code> è®°å¿†æ–‡ä»¶ï¼Œç®¡ç† Claude Code çš„è®°å¿†å†…å®¹ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/memory
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>æ‰“å¼€ <code>CLAUDE.md</code> æ–‡ä»¶è¿›è¡Œç¼–è¾‘</li>
<li>å¯ä»¥æ·»åŠ é¡¹ç›®ç‰¹å®šçš„çŸ¥è¯†</li>
<li>Claude Code ä¼šåœ¨åç»­å¯¹è¯ä¸­å‚è€ƒè¿™äº›è®°å¿†</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">/memory</span>
æ­£åœ¨æ‰“å¼€ç¼–è¾‘å™¨...
[ç¼–è¾‘ CLAUDE.md æ–‡ä»¶]
ä¿å­˜åï¼Œè®°å¿†å·²æ›´æ–°
</code></pre>
<hr/>
<h4 data-id="heading-24">19. <code>/review</code></h4>
<p>è¯·æ±‚ä»£ç å®¡æŸ¥ï¼ŒClaude Code ä¼šå¯¹å½“å‰ä»£ç è¿›è¡Œè¯„å®¡å¹¶æä¾›åé¦ˆã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/review
/review &lt;æ–‡ä»¶è·¯å¾„&gt;
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>åˆ†æä»£ç è´¨é‡ã€å®‰å…¨æ€§ã€æ€§èƒ½ç­‰</li>
<li>æä¾›æ”¹è¿›å»ºè®®</li>
<li>å¯ä»¥æŒ‡å®šç‰¹å®šæ–‡ä»¶æˆ–ç›®å½•</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">/review</span>
æ­£åœ¨å®¡æŸ¥å½“å‰ä»£ç ...
[Claude Code æä¾›å®¡æŸ¥æ„è§]
<span class="hljs-meta prompt_">
&gt; </span><span class="bash">/review UserService.java</span>
æ­£åœ¨å®¡æŸ¥ UserService.java...
[é’ˆå¯¹è¯¥æ–‡ä»¶çš„å®¡æŸ¥æ„è§]
</code></pre>
<p><strong>å®¡æŸ¥å†…å®¹é€šå¸¸åŒ…æ‹¬</strong>ï¼š</p>
<ul>
<li>ä»£ç é£æ ¼</li>
<li>æ½œåœ¨ bug</li>
<li>æ€§èƒ½ä¼˜åŒ–å»ºè®®</li>
<li>å®‰å…¨æ¼æ´</li>
<li>æœ€ä½³å®è·µå»ºè®®</li>
</ul>
<hr/>
<h4 data-id="heading-25">20. <code>/terminal-setup</code></h4>
<p>å®‰è£… Shift+Enter é”®ç»‘å®šï¼Œç”¨äºåœ¨ç»ˆç«¯ä¸­æ¢è¡Œï¼ˆä»…é™ iTerm2 å’Œ VSCodeï¼‰ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">/terminal-setup
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>é…ç½®ç»ˆç«¯å¿«æ·é”®</li>
<li>æ”¯æŒ iTerm2ï¼ˆmacOSï¼‰å’Œ VSCode é›†æˆç»ˆç«¯</li>
<li>æ–¹ä¾¿è¾“å…¥å¤šè¡Œæ–‡æœ¬</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">/terminal-setup</span>
æ­£åœ¨é…ç½®ç»ˆç«¯...
âœ“ Shift+Enter é”®ç»‘å®šå·²å®‰è£…
ç°åœ¨å¯ä»¥ä½¿ç”¨ Shift+Enter è¿›è¡Œæ¢è¡Œ
</code></pre>
<hr/>
<h4 data-id="heading-26">21. <code>/vim</code></h4>
<p>è¿›å…¥ Vim æ¨¡å¼ï¼Œå…è®¸åœ¨æ’å…¥å’Œå‘½ä»¤æ¨¡å¼ä¹‹é—´åˆ‡æ¢ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/vim
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>å¯ç”¨ Vim é”®ç»‘å®š</li>
<li>é€‚åˆç†Ÿæ‚‰ Vim çš„ç”¨æˆ·</li>
<li>æä¾›æ›´å¥½çš„æ–‡æœ¬ç¼–è¾‘ä½“éªŒ</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">/vim</span>
å·²å¯ç”¨ Vim æ¨¡å¼
æŒ‰ ESC è¿›å…¥å‘½ä»¤æ¨¡å¼ï¼ŒæŒ‰ i è¿›å…¥æ’å…¥æ¨¡å¼
</code></pre>
<p><strong>å¸¸ç”¨ Vim å‘½ä»¤</strong>ï¼š</p>
<ul>
<li><code>i</code>: è¿›å…¥æ’å…¥æ¨¡å¼</li>
<li><code>ESC</code>: é€€å‡ºæ’å…¥æ¨¡å¼</li>
<li><code>:w</code>: ä¿å­˜ï¼ˆå¦‚æœé€‚ç”¨ï¼‰</li>
<li><code>:q</code>: é€€å‡ºï¼ˆå¦‚æœé€‚ç”¨ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-27">é«˜çº§åŠŸèƒ½</h3>
<h4 data-id="heading-28">22. <code>claude mcp</code></h4>
<p>é…ç½®æ¨¡å‹ä¸Šä¸‹æ–‡åè®®ï¼ˆModel Context Protocolï¼‰æœåŠ¡å™¨ï¼Œå…è®¸ Claude Code è¿æ¥å¤–éƒ¨æ•°æ®æºæˆ–å·¥å…·ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ MCP é…ç½®</span>
claude mcp

<span class="hljs-comment"># æ·»åŠ  MCP æœåŠ¡å™¨</span>
claude mcp add &lt;æœåŠ¡å™¨åç§°&gt; &lt;é…ç½®&gt;

<span class="hljs-comment"># ç§»é™¤ MCP æœåŠ¡å™¨</span>
claude mcp remove &lt;æœåŠ¡å™¨åç§°&gt;

<span class="hljs-comment"># åˆ—å‡ºæ‰€æœ‰ MCP æœåŠ¡å™¨</span>
claude mcp list
</code></pre>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<ul>
<li>MCP å…è®¸ Claude Code è¿æ¥æ•°æ®åº“ã€APIã€æ–‡ä»¶ç³»ç»Ÿç­‰</li>
<li>æ‰©å±• Claude Code çš„èƒ½åŠ›</li>
<li>é€‚åˆä¼ä¸šçº§é›†æˆåœºæ™¯</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰ MCP é…ç½®</span>
claude mcp

<span class="hljs-comment"># æ·»åŠ æ•°æ®åº“è¿æ¥</span>
claude mcp add database <span class="hljs-string">"postgresql://localhost:5432/mydb"</span>

<span class="hljs-comment"># åˆ—å‡ºæ‰€æœ‰æœåŠ¡å™¨</span>
claude mcp list
</code></pre>
<hr/>
<h3 data-id="heading-29">ä½¿ç”¨ç¤ºä¾‹</h3>
<h4 data-id="heading-30">ç¤ºä¾‹ 1: å¿«é€Ÿä»£ç å®¡æŸ¥</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸€æ¬¡æ€§å®¡æŸ¥ä»£ç </span>
claude -p <span class="hljs-string">"å®¡æŸ¥ UserService.java çš„ä»£ç è´¨é‡"</span> &lt; UserService.java
</code></pre>
<h4 data-id="heading-31">ç¤ºä¾‹ 2: æŒç»­å¼€å‘ä¼šè¯</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¼€å§‹ä¼šè¯</span>
claude
&gt; /add-dir src/main/java
&gt; å¸®æˆ‘é‡æ„ UserController ç±»

<span class="hljs-comment"># ä¸­æ–­åç»§ç»­</span>
claude -c
&gt; æŒ‰ç…§ä½ çš„å»ºè®®ä¿®æ”¹åï¼Œè¯·æ£€æŸ¥ä¸€ä¸‹
</code></pre>
<h4 data-id="heading-32">ç¤ºä¾‹ 3: æ‰¹é‡æ–‡ä»¶å¤„ç†</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ†æå¤šä¸ªæ–‡ä»¶</span>
<span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> *.java; <span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"=== <span class="hljs-variable">$file</span> ==="</span> &gt;&gt; analysis.txt
  <span class="hljs-built_in">cat</span> <span class="hljs-string">"<span class="hljs-variable">$file</span>"</span> | claude -p <span class="hljs-string">"åˆ†æè¿™ä¸ªæ–‡ä»¶"</span> &gt;&gt; analysis.txt
<span class="hljs-keyword">done</span>
</code></pre>
<h4 data-id="heading-33">ç¤ºä¾‹ 4: é…ç½®å’Œä½¿ç”¨</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é…ç½®</span>
claude config <span class="hljs-built_in">set</span> --global theme dark
claude config <span class="hljs-built_in">set</span> locale zh-CN

<span class="hljs-comment"># ä½¿ç”¨</span>
claude
&gt; /config
&gt; ç”¨ä¸­æ–‡è§£é‡Šè¿™ä¸ªé¡¹ç›®çš„æ¶æ„
</code></pre>
<hr/>
<h3 data-id="heading-34">å¸¸è§é—®é¢˜</h3>
<h4 data-id="heading-35">Q1: å¦‚ä½•æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤ï¼Ÿ</h4>
<pre><code class="hljs language-bash" lang="bash">claude --<span class="hljs-built_in">help</span>
<span class="hljs-comment"># æˆ–</span>
claude -h
</code></pre>
<p>åœ¨äº¤äº’æ¨¡å¼ä¸­ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/help
</code></pre>
<h4 data-id="heading-36">Q2: å¦‚ä½•é‡ç½®é…ç½®ï¼Ÿ</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ é™¤é…ç½®æ–‡ä»¶</span>
<span class="hljs-built_in">rm</span> ~/.claude/config.json  <span class="hljs-comment"># macOS/Linux</span>
del %USERPROFILE%\.claude\config.json  <span class="hljs-comment"># Windows</span>

<span class="hljs-comment"># é‡æ–°é…ç½®</span>
claude config <span class="hljs-built_in">set</span> theme auto
</code></pre>
<h4 data-id="heading-37">Q3: ä»¤ç‰Œä½¿ç”¨è¿‡å¤šæ€ä¹ˆåŠï¼Ÿ</h4>
<ul>
<li>ä½¿ç”¨ <code>/cost</code> ç›‘æ§ä½¿ç”¨æƒ…å†µ</li>
<li>ä¼˜åŒ–æç¤ºè¯ï¼Œé¿å…å†—ä½™å†…å®¹</li>
<li>ä½¿ç”¨ <code>/clear</code> æ¸…é™¤ä¸å¿…è¦çš„å†å²</li>
<li>é™åˆ¶ <code>/add-dir</code> æ·»åŠ çš„ç›®å½•å¤§å°</li>
</ul>
<h4 data-id="heading-38">Q4: å¦‚ä½•åœ¨è„šæœ¬ä¸­ä½¿ç”¨ï¼Ÿ</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>
RESULT=$(claude -p <span class="hljs-string">"åˆ†æä»£ç è´¨é‡"</span> &lt; code.java)
<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$RESULT</span>"</span> &gt; result.txt
</code></pre>
<h4 data-id="heading-39">Q5: æ”¯æŒå“ªäº›æ“ä½œç³»ç»Ÿï¼Ÿ</h4>
<ul>
<li>macOS</li>
<li>Linux</li>
<li>Windows (é€šè¿‡ WSL æˆ–åŸç”Ÿæ”¯æŒ)</li>
</ul>
<h4 data-id="heading-40">Q6: å¦‚ä½•æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Ÿ</h4>
<pre><code class="hljs language-bash" lang="bash">claude update
</code></pre>
<p>å¦‚æœå¤±è´¥ï¼Œå¯èƒ½éœ€è¦ï¼š</p>
<ul>
<li>æ£€æŸ¥ç½‘ç»œè¿æ¥</li>
<li>ä½¿ç”¨ç®¡ç†å‘˜æƒé™</li>
<li>æ‰‹åŠ¨ä¸‹è½½æœ€æ–°ç‰ˆæœ¬</li>
</ul>
<hr/>
<h3 data-id="heading-41">å‘½ä»¤é€ŸæŸ¥è¡¨</h3>































































































<table><thead><tr><th>å‘½ä»¤</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>claude</code></td><td>åŸºç¡€</td><td>å¯åŠ¨äº¤äº’å¼ä¼šè¯</td></tr><tr><td><code>claude -p "æŸ¥è¯¢"</code></td><td>åŸºç¡€</td><td>ä¸€æ¬¡æ€§æŸ¥è¯¢</td></tr><tr><td><code>claude -c</code></td><td>ä¼šè¯</td><td>ç»§ç»­æœ€è¿‘å¯¹è¯</td></tr><tr><td><code>claude -r "ID" "æŸ¥è¯¢"</code></td><td>ä¼šè¯</td><td>æ¢å¤æŒ‡å®šä¼šè¯</td></tr><tr><td><code>claude config</code></td><td>é…ç½®</td><td>é…ç½®ç®¡ç†</td></tr><tr><td><code>claude update</code></td><td>é…ç½®</td><td>æ›´æ–°è½¯ä»¶</td></tr><tr><td><code>/add-dir</code></td><td>äº¤äº’</td><td>æ·»åŠ ç›®å½•</td></tr><tr><td><code>/cost</code></td><td>äº¤äº’</td><td>æŸ¥çœ‹ä»¤ç‰Œç»Ÿè®¡</td></tr><tr><td><code>/config</code></td><td>äº¤äº’</td><td>æŸ¥çœ‹/ä¿®æ”¹é…ç½®</td></tr><tr><td><code>/clear</code></td><td>äº¤äº’</td><td>æ¸…é™¤å†å²</td></tr><tr><td><code>/help</code></td><td>äº¤äº’</td><td>æ˜¾ç¤ºå¸®åŠ©</td></tr><tr><td><code>/init</code></td><td>äº¤äº’</td><td>åˆå§‹åŒ–é¡¹ç›®</td></tr><tr><td><code>/login</code></td><td>äº¤äº’</td><td>ç™»å½•è´¦æˆ·</td></tr><tr><td><code>/logout</code></td><td>äº¤äº’</td><td>ç™»å‡ºè´¦æˆ·</td></tr><tr><td><code>/memory</code></td><td>äº¤äº’</td><td>ç¼–è¾‘è®°å¿†æ–‡ä»¶</td></tr><tr><td><code>/review</code></td><td>äº¤äº’</td><td>ä»£ç å®¡æŸ¥</td></tr><tr><td><code>/vim</code></td><td>äº¤äº’</td><td>å¯ç”¨ Vim æ¨¡å¼</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ˜Ÿå“¥å¸¦ä½ ç©é£ç‰›NAS-13ï¼šè‡ªåŠ¨è¿½ç•ªã€è®¢é˜…ä¸‹è½½ + åˆ®å‰Šï¼ŒåŠ¨æ¼«å…šå½»åº•è§£æ”¾åŒæ‰‹ï¼]]></title>    <link>https://juejin.cn/post/7585452404113932303</link>    <guid>https://juejin.cn/post/7585452404113932303</guid>    <pubDate>2025-12-20T15:41:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585452404113932303" data-draft-id="7585485284152901667" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ˜Ÿå“¥å¸¦ä½ ç©é£ç‰›NAS-13ï¼šè‡ªåŠ¨è¿½ç•ªã€è®¢é˜…ä¸‹è½½ + åˆ®å‰Šï¼ŒåŠ¨æ¼«å…šå½»åº•è§£æ”¾åŒæ‰‹ï¼"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-20T15:41:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜Ÿå“¥ç©äº‘"/> <meta itemprop="url" content="https://juejin.cn/user/2937506526137149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ˜Ÿå“¥å¸¦ä½ ç©é£ç‰›NAS-13ï¼šè‡ªåŠ¨è¿½ç•ªã€è®¢é˜…ä¸‹è½½ + åˆ®å‰Šï¼ŒåŠ¨æ¼«å…šå½»åº•è§£æ”¾åŒæ‰‹ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2937506526137149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜Ÿå“¥ç©äº‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T15:41:34.000Z" title="Sat Dec 20 2025 15:41:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ˜Ÿå“¥å¸¦ä½ ç©é£ç‰›NAS-13ï¼šè‡ªåŠ¨è¿½ç•ªã€è®¢é˜…ä¸‹è½½ + åˆ®å‰Šï¼ŒåŠ¨æ¼«å…šå½»åº•è§£æ”¾åŒæ‰‹ï¼</h2>
<p>ä½œä¸ºåŠ¨æ¼«çˆ±å¥½è€…ï¼Œä½ æ˜¯å¦è¿˜åœ¨ä¸º â€œè¿½ç•ªåˆ†æ•£åœ¨å¤šä¸ªå¹³å°â€â€œæ–°ç•ªæ›´æ–°å¿˜æ‰“å¡â€â€œæ‰‹åŠ¨æ‰¾èµ„æºã€ä¸‹å­—å¹•ã€æ•´ç†æ–‡ä»¶â€ è€Œçƒ¦æ¼ï¼Ÿåˆ«æ€¥ï¼Œä»Šå¤©ç»™å¤§å®¶å¸¦æ¥ä¸€å¥— â€œä¸€åŠ³æ°¸é€¸â€ çš„è§£å†³æ–¹æ¡ˆ â€”â€” åœ¨é£ç‰› Nas ä¸Šéƒ¨ç½² ani-rss å·¥å…·ï¼Œå®ç°ä»è®¢é˜…ã€è‡ªåŠ¨ä¸‹è½½åˆ°ä¿¡æ¯åˆ®å‰Šçš„å…¨æµç¨‹è‡ªåŠ¨åŒ–ï¼Œè®©ä½ ä¸“æ³¨äº«å—åŠ¨æ¼«æœ¬èº«ï¼Œå½»åº•å‘Šåˆ«ç¹çæ“ä½œï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/737f1a28bdf1456b8b597b30e5c7b945~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5ZOl546p5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766850093&amp;x-signature=PJ8UwdCcHNC9fca2EclNxwVhppk%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-1">Ani-rssçš„ä¼˜ç‚¹</h3>
<p>åœ¨ä¼—å¤šè¿½ç•ªå·¥å…·ä¸­ï¼Œani-rss å‡­å€Ÿ â€œè½»é‡ã€é«˜æ•ˆã€å…¼å®¹æ€§å¼ºâ€ è„±é¢–è€Œå‡ºï¼Œæ­é…é£ç‰› Nas çš„æœ¬åœ°å­˜å‚¨ä¼˜åŠ¿ï¼Œå ªç§°åŠ¨æ¼«å…šçš„ â€œé»„é‡‘ç»„åˆâ€ï¼š</p>
<ul>
<li><strong>å…¨æµç¨‹è‡ªåŠ¨åŒ–</strong>ï¼šè®¢é˜…åŠ¨æ¼«åè‡ªåŠ¨ç›‘æµ‹æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨è§¦å‘ä¸‹è½½ï¼Œæ–°ç•ªæ›´æ–°ç§’çº§å“åº”ï¼›</li>
<li><strong>å¤šæºé€‚é… + é«˜å…¼å®¹æ€§</strong>ï¼šæ”¯æŒèœœæŸ‘ RSS ç­‰ä¸»æµåŠ¨æ¼«æºï¼Œå…¼å®¹ Transmissionã€qBittorrentã€Aria2 ç­‰å¤šæ¬¾ä¸‹è½½å·¥å…·ï¼Œè¿˜èƒ½å¯¹æ¥ Alist å®ç°æ–‡ä»¶ç®¡ç†ï¼›</li>
<li><strong>å­—å¹•ç»„å…¨è¦†ç›–</strong>ï¼šæ•´åˆé›ªé£˜å·¥ä½œå®¤ã€LoliHouseã€å–µèŒå¥¶èŒ¶å±‹ã€æ¡œéƒ½å­—å¹•ç»„ç­‰ä¸»æµæ±‰åŒ–ç»„èµ„æºï¼Œé«˜æ¸…ç‰‡æº + ç²¾å‡†å­—å¹•ä¸€æ­¥åˆ°ä½ï¼›</li>
<li><strong>Nas éƒ¨ç½²æ›´çœå¿ƒ</strong>ï¼šå ç”¨èµ„æºä½ï¼Œåå°æŒç»­è¿è¡Œä¸æ‰“æ‰°ï¼Œæœ¬åœ°å­˜å‚¨é¿å…äº‘ç›˜é™é€Ÿï¼Œè¿˜èƒ½é€šè¿‡åˆ®å‰ŠåŠŸèƒ½è‡ªåŠ¨æ•´ç†åŠ¨æ¼«ä¿¡æ¯ï¼ˆç‰‡åã€è¯„åˆ†ã€é›†æ•°ç­‰ï¼‰ï¼Œæ–‡ä»¶åˆ†ç±»è§„æ•´æ˜“æŸ¥æ‰¾ã€‚</li>
</ul>
<p>åœ¨é£ç‰›nasä¸­éƒ¨ç½²ani-rssæ˜¯ç›¸å½“ç®€å•ï¼Œåªéœ€è¦ç‚¹å‡»å®‰è£…å³å¯ï¼</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00f772b9a1e84561aa75c146296f0c5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5ZOl546p5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766850093&amp;x-signature=ATM9iTPQ7M5VrxiVIZXtgQIaY58%3D" alt="img" loading="lazy"/></p>
<h3 data-id="heading-2">åœ¨éé£ç‰›NASä¸­éƒ¨ç½²ani-rss</h3>
<p>åœ¨é£ç‰›nasä¸­éƒ¨ç½²ani-rssæ˜¯ç›¸å½“ç®€å•ï¼Œåªéœ€è¦ç‚¹å‡»å®‰è£…å³å¯ã€‚å¦‚æœæ˜¯åœ¨éé£ç‰›NASä¸­ï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²çš„</p>
<ol start="0">
<li><strong>ç¡¬ä»¶è¦æ±‚</strong>ï¼šé£ç‰› Nas éœ€æ”¯æŒ Dockerï¼ˆå¤§éƒ¨åˆ†æ–°æ¬¾é£ç‰› Nas å‡å·²é¢„è£…ï¼Œæ—§æ¬¾å¯é€šè¿‡å®˜æ–¹å›ºä»¶å‡çº§å¼€å¯ï¼‰ï¼›</li>
<li><strong>ç½‘ç»œç¯å¢ƒ</strong>ï¼šç¡®ä¿ Nas å¤„äºå¯è®¿é—®äº’è”ç½‘çš„ç¯å¢ƒï¼Œè‹¥éœ€ä¸‹è½½æµ·å¤–ç‰‡æºï¼Œå»ºè®®é…ç½®åˆè§„ç½‘ç»œï¼ˆéµå®ˆæ‰€åœ¨åœ°åŒºç½‘ç»œæ³•è§„ï¼‰ï¼›</li>
<li><strong>å·¥å…·å‡†å¤‡</strong>ï¼šç”µè„‘ç«¯å®‰è£… SSH å·¥å…·ï¼ˆå¦‚ Xshellã€FinalShellï¼‰ï¼ˆç”¨äºè¿æ¥ Nasï¼‰ã€Docker Composeï¼ˆå¯é€‰ï¼Œç®€åŒ–éƒ¨ç½²å‘½ä»¤ï¼‰ï¼›</li>
<li><strong>ä¾èµ–æ”¯æŒ</strong>ï¼šæå‰åœ¨ Nas ä¸­å®‰è£…ç›®æ ‡ä¸‹è½½å·¥å…·ï¼ˆå¦‚ qBittorrentï¼‰ï¼Œå¹¶è®°å½•å…¶è®¿é—®åœ°å€ã€ç«¯å£åŠè´¦å·å¯†ç ã€‚</li>
</ol>
<h3 data-id="heading-3">Dockerå®‰è£… ani-rss ï¼ˆé£ç‰›NASå¯è·³è¿‡ï¼‰</h3>
<h4 data-id="heading-4">ç¬¬ä¸€æ­¥ï¼šè¿æ¥LinuxæœåŠ¡å™¨å¹¶åˆ›å»ºéƒ¨ç½²ç›®å½•</h4>
<ol start="0">
<li>æ‰“å¼€ SSH å·¥å…·ï¼Œè¾“å…¥LinuxæœåŠ¡å™¨ çš„ IP åœ°å€ï¼ˆå¦‚ 192.168.5.4ï¼Œå¯åœ¨è·¯ç”±å™¨ç®¡ç†é¡µæŸ¥è¯¢ï¼‰ã€ç”¨æˆ·ååŠå¯†ç ï¼ŒæˆåŠŸè¿æ¥ Nas ç»ˆç«¯ï¼›</li>
<li>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»º ani-rss ä¸“å±ç›®å½•ï¼ˆç”¨äºå­˜å‚¨é…ç½®æ–‡ä»¶ã€æ—¥å¿—ç­‰ï¼‰ï¼Œé¿å…æ–‡ä»¶æ··ä¹±ï¼š</li>
</ol>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> -p /data/docker/ani-rss/config Â <span class="hljs-comment"># é…ç½®æ–‡ä»¶ç›®å½•</span>
<span class="hljs-built_in">mkdir</span> -p /data/docker/ani-rss/logs Â  <span class="hljs-comment"># æ—¥å¿—ç›®å½•</span>
</code></pre>
<p>ï¼ˆæ³¨ï¼š/data ä¸ºLinuxæœåŠ¡å™¨ é»˜è®¤å­˜å‚¨åˆ†åŒºï¼Œè‹¥ä½ çš„å­˜å‚¨åˆ†åŒºå‘½åä¸åŒï¼Œéœ€å¯¹åº”ä¿®æ”¹è·¯å¾„ï¼‰</p>
<h4 data-id="heading-5">ç¬¬äºŒæ­¥ï¼šé€šè¿‡ Docker éƒ¨ç½² ani-rssï¼ˆæ¨èæ–¹æ¡ˆï¼Œç®€å•é«˜æ•ˆï¼‰</h4>
<p>ani-rss å®˜æ–¹æä¾›äº† Docker é•œåƒï¼Œéƒ¨ç½²æ­¥éª¤ç®€åŒ–åˆ° â€œå¤åˆ¶ç²˜è´´å‘½ä»¤â€ï¼š</p>
<ol start="0">
<li>æ‰§è¡Œ Docker æ‹‰å–å‘½ä»¤ï¼Œè·å–æœ€æ–°ç‰ˆ ani-rss é•œåƒï¼š</li>
</ol>

<pre><code class="hljs language-bash" lang="bash">docker pull wushuo894/ani-rss:latest
</code></pre>
<p>0.  ç¼–å†™ Docker Compose é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰ï¼Œåˆ›å»º<code>docker-compose.yml</code>æ–‡ä»¶ï¼š</p>

<pre><code class="hljs language-bash" lang="bash">vim /data/docker/ani-rss/docker-compose.yml
</code></pre>
<p>0.  ç²˜è´´ä»¥ä¸‹é…ç½®å†…å®¹ï¼ˆæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹å‚æ•°ï¼‰ï¼š</p>

<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">version:</span> <span class="hljs-string">'3'</span>
<span class="hljs-symbol">services:</span>
  ani-<span class="hljs-symbol">rss:</span>
 Â   <span class="hljs-symbol">image:</span> wushuo894/ani-<span class="hljs-symbol">rss:</span>latest
 Â   <span class="hljs-symbol">container_name:</span> ani-rss
 Â   <span class="hljs-symbol">restart:</span> always Â <span class="hljs-comment"># å¼€æœºè‡ªå¯</span>
 Â   <span class="hljs-symbol">ports:</span>
 Â  Â   - <span class="hljs-string">"8080:8080"</span> Â <span class="hljs-comment"># ç«¯å£æ˜ å°„ï¼Œå·¦ä¾§ä¸ºNasæœ¬åœ°ç«¯å£ï¼Œå¯è‡ªå®šä¹‰</span>
 Â   <span class="hljs-symbol">volumes:</span>
 Â  Â   - <span class="hljs-regexp">/data/docker</span><span class="hljs-regexp">/ani-rss/config</span><span class="hljs-symbol">:/app/config</span> Â <span class="hljs-comment"># é…ç½®æ–‡ä»¶æ˜ å°„</span>
 Â  Â   - <span class="hljs-regexp">/data/docker</span><span class="hljs-regexp">/ani-rss/logs</span><span class="hljs-symbol">:/app/logs</span> Â  Â  <span class="hljs-comment"># æ—¥å¿—æ˜ å°„</span>
 Â  Â   - <span class="hljs-regexp">/data/</span><span class="hljs-title class_">Media</span>/<span class="hljs-title class_">Anime</span><span class="hljs-symbol">:/app/downloads</span> Â  Â  Â  Â  <span class="hljs-comment"># åŠ¨æ¼«å­˜å‚¨ç›®å½•ï¼Œéœ€æå‰åˆ›å»º</span>
 Â   <span class="hljs-symbol">environment:</span>
 Â  Â   - <span class="hljs-variable constant_">TZ</span>=<span class="hljs-title class_">Asia</span>/<span class="hljs-title class_">Shanghai</span> Â <span class="hljs-comment"># æ—¶åŒºè®¾ç½®ï¼Œé¿å…æ—¶é—´é”™ä¹±</span>
 Â  Â   - <span class="hljs-variable constant_">LANG</span>=zh_CN.<span class="hljs-variable constant_">UTF</span>-<span class="hljs-number">8</span> Â <span class="hljs-comment"># ä¸­æ–‡ç¼–ç </span>
</code></pre>
<p>0.  å¯åŠ¨å®¹å™¨ï¼šåœ¨<code>docker-compose.yml</code>æ‰€åœ¨ç›®å½•æ‰§è¡Œå‘½ä»¤ï¼š</p>

<pre><code class="hljs">docker-compose up -d
</code></pre>
<p>0.  éªŒè¯éƒ¨ç½²ï¼šåœ¨æµè§ˆå™¨è¾“å…¥<code>http://NasIP:8080</code>ï¼ˆå¦‚<a href="https://link.juejin.cn?target=http%3A%2F%2F192.168.5.4%3A8080%2F" target="_blank" title="http://192.168.5.4:8080/" ref="nofollow noopener noreferrer">http://192.168.5.4:8080</a>ï¼‰ï¼Œè‹¥èƒ½çœ‹åˆ° ani-rss ç™»å½•ç•Œé¢ï¼Œè¯´æ˜éƒ¨ç½²æˆåŠŸï¼</p>
<p>é»˜è®¤ç”¨æˆ·åå’Œå¯†ç æ˜¯adminå’Œadminã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bef3174558044b45922962238164fbf5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5ZOl546p5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766850093&amp;x-signature=eRL%2FeTk9bbtcPvTGDomY1mB463E%3D" alt="img" loading="lazy"/></p>
<h4 data-id="heading-6">ç¬¬ä¸‰æ­¥ï¼šåŸºç¡€é…ç½®ï¼šè®¢é˜…åŠ¨æ¼« + å…³è”ä¸‹è½½å·¥å…·</h4>
<ol start="0">
<li>é¦–æ¬¡ç™»å½• ani-rssï¼ˆé»˜è®¤è´¦å·å¯†ç å¯åœ¨å®˜æ–¹æ–‡æ¡£æŸ¥è¯¢ï¼Œå»ºè®®ç™»å½•åç«‹å³ä¿®æ”¹ï¼‰ï¼›</li>
<li>é…ç½®ä¸‹è½½å·¥å…·ï¼šè¿›å…¥ â€œè®¾ç½®â€â†’â€œä¸‹è½½å™¨â€ï¼Œé€‰æ‹©ä½ å·²å®‰è£…çš„å·¥å…·ï¼ˆå¦‚ qBittorrentï¼‰ï¼Œè¾“å…¥å·¥å…·çš„ IPã€ç«¯å£ã€è´¦å·å¯†ç ï¼Œç‚¹å‡» â€œæµ‹è¯•è¿æ¥â€ï¼Œæ˜¾ç¤º â€œè¿æ¥æˆåŠŸâ€ å³å¯ï¼›</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49048084c3534b88899244f3ea9896d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5ZOl546p5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766850093&amp;x-signature=jSfh6WG9LQKpjvV7ciNFxkejZzU%3D" alt="img" loading="lazy"/></p>
<p>è®¢é˜…åŠ¨æ¼«ï¼šç‚¹å‡» â€œ+ æ·»åŠ â€ï¼Œè¾“å…¥åŠ¨æ¼«åç§°æˆ–ç›´æ¥ç²˜è´´èœœæŸ‘ RSS é“¾æ¥ï¼Œé€‰æ‹©å­—å¹•ç»„ï¼ˆå¦‚ LoliHouseã€é›ªé£˜å·¥ä½œå®¤ï¼‰ï¼Œè®¾ç½®ä¸‹è½½ä¼˜å…ˆçº§ï¼Œå‹¾é€‰ â€œè‡ªåŠ¨ä¸‹è½½æ–°é›†â€ï¼Œå®Œæˆè®¢é˜…ï¼›</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78f63797ba11497d9b15f74b0f1fec80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pif5ZOl546p5LqR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766850093&amp;x-signature=QoxQNAXS8nXXVwa64E84DKVUAHE%3D" alt="img" loading="lazy"/></p>
<p>å¼€å¯è‡ªåŠ¨åˆ·æ–°ï¼šåœ¨é¦–é¡µç‚¹å‡» â€œåˆ·æ–°â€ æŒ‰é’®ï¼Œæˆ–åœ¨è®¾ç½®ä¸­è®¾ç½® â€œè‡ªåŠ¨åˆ·æ–°é—´éš”â€ï¼ˆå»ºè®® 10-30 åˆ†é’Ÿï¼‰ï¼Œç¡®ä¿åŠæ—¶ç›‘æµ‹æ–°ç•ªæ›´æ–°ã€‚</p>
<h3 data-id="heading-7">è¿›é˜¶æ“ä½œï¼šåˆ®å‰ŠåŠŸèƒ½è®©åŠ¨æ¼«ç®¡ç†æ›´è§„æ•´</h3>
<p>ani-rss æœ¬èº«æ”¯æŒåŸºç¡€çš„æ–‡ä»¶å‘½åæ•´ç†ï¼Œè‹¥éœ€æ›´è¯¦ç»†çš„åŠ¨æ¼«ä¿¡æ¯ï¼ˆå¦‚æµ·æŠ¥ã€å‰§æƒ…ç®€ä»‹ã€è¯„åˆ†ã€é›†æ•°æ’åºï¼‰ï¼Œå¯æ­é…åˆ®å‰Šå·¥å…·å®ç°ï¼š</p>
<ol start="0">
<li>æå‰åœ¨é£ç‰› Nas éƒ¨ç½²åˆ®å‰Šå·¥å…·ï¼ˆå¦‚ TMMã€Emby Serverï¼‰ï¼›</li>
<li>åœ¨ ani-rss ä¸­è®¾ç½® â€œä¸‹è½½åæ–‡ä»¶å‘½åè§„åˆ™â€ï¼Œå»ºè®®é‡‡ç”¨ â€œåŠ¨æ¼«åç§° - å­£æ•° - é›†æ•° - å­—å¹•ç»„â€ æ ¼å¼ï¼ˆå¦‚ã€Šæˆ‘ç‹¬è‡ªå‡çº§ - ç¬¬ 2 å­£ - 07-LoliHouseã€‹ï¼‰ï¼Œä¾¿äºåˆ®å‰Šå·¥å…·è¯†åˆ«ï¼›</li>
<li>åœ¨åˆ®å‰Šå·¥å…·ä¸­æ·»åŠ  ani-rss çš„åŠ¨æ¼«å­˜å‚¨ç›®å½•ï¼Œé€‰æ‹©åˆ®å‰Šæºï¼ˆå¦‚ TheTVDBã€TMDBï¼‰ï¼Œæ‰§è¡Œæ‰¹é‡åˆ®å‰Šï¼Œå³å¯è‡ªåŠ¨ç”Ÿæˆè§„æ•´çš„åŠ¨æ¼«èµ„æ–™åº“ï¼Œæ”¯æŒæŒ‰è¯„åˆ†ã€ç±»å‹ã€æ›´æ–°æ—¶é—´ç­›é€‰ã€‚</li>
</ol>
<h3 data-id="heading-8">æ€»ç»“</h3>
<p>å¦‚æœä½ åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯å‚è€ƒ GitHub ä»“åº“<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fwushuo894%2Fani-rss" target="_blank" title="https://github.com/wushuo894/ani-rss" ref="nofollow noopener noreferrer">github.com/wushuo894/aâ€¦</a></p>
<p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ å·²ç»åœ¨é£ç‰› Nas ä¸ŠæˆåŠŸéƒ¨ç½²äº† ani-rssï¼Œå®ç°äº† â€œè®¢é˜…â†’è‡ªåŠ¨ä¸‹è½½â†’åˆ®å‰Šæ•´ç†â€ çš„å…¨æµç¨‹è‡ªåŠ¨åŒ–ã€‚ä»æ­¤ä¸ç”¨å†è¹²ç‚¹ç­‰æ›´æ–°ã€ä¸ç”¨æ‰‹åŠ¨æ‰¾èµ„æºã€ä¸ç”¨è´¹å¿ƒæ•´ç†æ–‡ä»¶ï¼Œæ‰“å¼€ Nas æˆ–å…³è”çš„æ’­æ”¾å™¨ï¼Œå°±èƒ½ç›´æ¥è§‚çœ‹æœ€æ–°ç•ªå‰§ï¼ŒçœŸæ­£åšåˆ° â€œè¿½ç•ªè‡ªç”±â€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æˆ‘è¾…å¯¼400+å­¦å‘˜æ‹¿Go Offeråå‘ç°ï¼šçªç ´å¹´è–ª50Wï¼Œå¸¸ç¦»ä¸å¼€è¿™10ä¸ªå®æˆ˜æŠ€å·§]]></title>    <link>https://juejin.cn/post/7585485074038276102</link>    <guid>https://juejin.cn/post/7585485074038276102</guid>    <pubDate>2025-12-20T16:05:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485074038276102" data-draft-id="7585502118459736083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æˆ‘è¾…å¯¼400+å­¦å‘˜æ‹¿Go Offeråå‘ç°ï¼šçªç ´å¹´è–ª50Wï¼Œå¸¸ç¦»ä¸å¼€è¿™10ä¸ªå®æˆ˜æŠ€å·§"/> <meta itemprop="keywords" content="åç«¯,Go,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-20T16:05:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç‹ä¸­é˜³è®²AIç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2189882892232029"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æˆ‘è¾…å¯¼400+å­¦å‘˜æ‹¿Go Offeråå‘ç°ï¼šçªç ´å¹´è–ª50Wï¼Œå¸¸ç¦»ä¸å¼€è¿™10ä¸ªå®æˆ˜æŠ€å·§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2189882892232029/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç‹ä¸­é˜³è®²AIç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T16:05:52.000Z" title="Sat Dec 20 2025 16:05:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;font-weight:400;line-height:2;font-size:17px;overflow-x:hidden;color:#000}.markdown-body strong{padding:1px;color:#ee3f4d}.markdown-body em{padding:0 2px;color:#f33b1f}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{position:relative;margin-top:30px;margin-bottom:20px;line-height:1.5;font-weight:700}.markdown-body h1{text-align:center;padding-bottom:5px;font-size:32px;color:#ac1f18}.markdown-body h1:after{content:"";display:block;margin:4px auto 0;width:100px;height:2px;border-bottom:2px solid #f33b1f}.markdown-body h2{font-size:28px;border-bottom:1px solid #f33b1f}.markdown-body h2:before{content:"# "!important;color:#f33b1f}.markdown-body h3{font-size:24px;padding-left:9px;border-left:6px solid #f33b1f}.markdown-body h4{font-size:20px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #bbb;margin:16px 0}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f9f1db;color:#ee2746;border-radius:2px;font-size:16px;padding:1px 2px}.markdown-body code,.markdown-body pre{font-family:-apple-system,-apple-system-body,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,PingFang SC,æ€æºé»‘ä½“ CN,æ€æºé»‘ä½“,JetBrains Mono,Fira Code,Menlo,Ubuntu Mono,Consolas,sans-serif}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{margin:12px 0!important;border-radius:3px;font-size:15px;padding:16px 12px;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f7f7f7}.markdown-body a{text-decoration:none;color:#1781b5;padding:0 2px;border-bottom:1px solid #1781b5}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #f33b1f;color:#ac1f18}.markdown-body blockquote{color:#3d3d3d;background-color:#fff9f9;padding:6px 16px;margin:16px 0;border-left:3px solid #f07c82}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:6px 0}.markdown-body ol,.markdown-body ul{padding-left:30px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:6px}.markdown-body ol li{padding-left:6px}.markdown-body ::marker{color:#f33b1f}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body .task-list-item input[type=checkbox]{position:relative}.markdown-body .task-list-item input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;background:#fff;border:1px solid #f07c82;border-radius:3px;box-sizing:border-box;z-index:1}.markdown-body .task-list-item input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-5px;left:0;right:0;bottom:0;width:0;height:0;color:#f33b1f;font-size:16px;font-weight:700;z-index:2}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border-spacing:0;border-collapse:collapse}.markdown-body table thead{background:#fff9f9;color:#000;text-align:left;font-size:15px}.markdown-body table tr:nth-child(2n){background-color:#fcfcfc}.markdown-body table tr:hover{background-color:#fff9f9}.markdown-body table td,.markdown-body table th{padding:12px 7px;line-height:24px;border:1px solid #f9f1db}.markdown-body table td{min-width:120px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><blockquote>
<p>æœ€è¿‘åˆæœ‰ä¸å°‘åŒå­¦ç§ä¿¡æˆ‘ï¼šâ€œä¸­é˜³è€å¸ˆï¼ŒåŒæ ·æ˜¯å†™Goï¼Œä¸ºä»€ä¹ˆæœ‰äººèƒ½æ‹¿50Wå¹´è–ªï¼Œæˆ‘åšäº†3å¹´è¿˜æ˜¯å¡åœ¨25Wï¼Ÿâ€</p>
</blockquote>
<p>è¿™ä¸¤å¹´æˆ‘å¸®400+å­¦å‘˜åšGoæ–¹å‘çš„å°±ä¸šè¾…å¯¼ï¼Œä»ç®€å†ä¼˜åŒ–åˆ°æŠ€æœ¯é¢å†²åˆºï¼Œè§è¿‡å¤ªå¤šç±»ä¼¼çš„å›°æƒ‘ã€‚å…¶å®åœ¨æˆ‘çœ‹æ¥ï¼Œæœˆè–ª15Kå’Œ30Kçš„Goå¼€å‘è€…ï¼Œå·®è·ä»æ¥ä¸åœ¨è¯­æ³•ç†Ÿç»ƒåº¦â€”â€”æ¯•ç«Ÿforå¾ªç¯ã€ifåˆ¤æ–­è°éƒ½ä¼šå†™ï¼ŒçœŸæ­£çš„åˆ†æ°´å²­ï¼Œæ˜¯â€œå·¥ç¨‹åŒ–æ€ç»´+è½åœ°çº§å®æˆ˜æŠ€å·§â€ã€‚</p>
<p>ä»Šå¤©å°±æŠŠæˆ‘ä»10å¹´å¤§å‚ç ”å‘+åˆ›ä¸šç»å†ä¸­æç‚¼çš„10ä¸ªæ ¸å¿ƒæŠ€å·§åˆ†äº«å‡ºæ¥ï¼Œè¿™äº›ä¹Ÿæ˜¯æˆ‘è¾…å¯¼å­¦å‘˜å†²å‡»é«˜è–ªOfferæ—¶å¿…è®²çš„é‡ç‚¹ï¼Œä¸ç®¡ä½ æ˜¯åˆšè½¬Goçš„æ–°æ‰‹ï¼Œè¿˜æ˜¯æƒ³çªç ´ç“¶é¢ˆçš„èµ„æ·±å¼€å‘è€…ï¼Œè®¤çœŸçœ‹å®Œéƒ½èƒ½å°‘èµ°1-2å¹´å¼¯è·¯ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€å¹¶å‘ç¼–ç¨‹ï¼šé¿å…goroutineæ»¥ç”¨ï¼ŒæŒæ¡å·¥ç¨‹çº§å®è·µ</h2>
<p>Goçš„å¹¶å‘æ˜¯å…¶æ ¸å¿ƒä¼˜åŠ¿ï¼Œä½†ä¹Ÿææ˜“æˆä¸ºç”Ÿäº§ç¯å¢ƒçš„â€œæš—ç¤â€ã€‚å¸¸è§é—®é¢˜å¦‚æ— èŠ‚åˆ¶åœ°åˆ›å»ºgoroutineå¯¼è‡´æ³„æ¼ï¼Œæˆ–ç¼ºä¹åè°ƒå¼•å‘æ­»é”ã€‚</p>
<p>ç‰¢è®°ä¸‰ä¸ªæ ¸å¿ƒæ¨¡å¼ï¼šä½¿ç”¨ <code>sync.WaitGroup</code> ç®¡ç†ç”Ÿå‘½å‘¨æœŸï¼Œä½¿ç”¨ <code>context</code> å®ç°å–æ¶ˆä¸è¶…æ—¶æ§åˆ¶ï¼Œä½¿ç”¨ <code>channel</code> è¿›è¡Œé€šä¿¡ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç”Ÿäº§å¯ç”¨çš„ä»»åŠ¡æ‰¹é‡å¤„ç†æ¨¡æ¿ï¼š</p>
<pre><code class="hljs language-go" lang="go">ctx, cancel := context.WithTimeout(context.Background(), <span class="hljs-number">3</span>*time.Second)
<span class="hljs-keyword">defer</span> cancel() <span class="hljs-comment">// ç¡®ä¿èµ„æºæœ€ç»ˆé‡Šæ”¾</span>
wg := sync.WaitGroup{}

<span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ {
    wg.Add(<span class="hljs-number">1</span>)
    <span class="hljs-comment">// åŠ¡å¿…å°†å¾ªç¯å˜é‡ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œé¿å…é—­åŒ…æ•è·åŒä¸€å˜é‡</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(taskID <span class="hljs-type">int</span>)</span></span> {
        <span class="hljs-keyword">defer</span> wg.Done()
        <span class="hljs-comment">// å…³é”®ï¼šdoTaskéœ€è¦èƒ½å“åº”ctxçš„å–æ¶ˆã€‚ä¾‹å¦‚ï¼Œå®ƒåº”æ¥æ”¶ctxå‚æ•°ï¼Œ</span>
        <span class="hljs-comment">// å¹¶åœ¨å†…éƒ¨è°ƒç”¨æ”¯æŒcontextçš„æ–¹æ³•ï¼ˆå¦‚httpè¯·æ±‚ã€channelæ“ä½œç­‰ï¼‰ã€‚</span>
        <span class="hljs-keyword">if</span> err := doTask(ctx, taskID); err != <span class="hljs-literal">nil</span> {
            <span class="hljs-comment">// å¤„ç†ä»»åŠ¡é”™è¯¯ï¼Œå¯è®°å½•æ—¥å¿—</span>
            zap.L().Warn(<span class="hljs-string">"task failed"</span>, zap.Int(<span class="hljs-string">"taskID"</span>, taskID), zap.Error(err))
        }
    }(i)
}
wg.Wait() <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰ä»»åŠ¡ç»“æŸ</span>
</code></pre>
<p><strong>é‡è¦æç¤º</strong>ï¼šé¿å…åœ¨å¾ªç¯ä¸­æ— é™åˆ¶å¯åŠ¨goroutineã€‚é¢å¯¹é«˜å¹¶å‘åœºæ™¯ï¼Œåº”è€ƒè™‘ä½¿ç”¨ <strong>Worker Poolï¼ˆåç¨‹æ± ï¼‰</strong> æ¥æ§åˆ¶å¹¶å‘åº¦ï¼Œè¿™æ—¢æ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ï¼Œä¹Ÿæ˜¯åŒºåˆ†å¼€å‘ç»éªŒæ·±æµ…çš„å¸¸è§é¢è¯•é¢˜ã€‚</p>
<h2 data-id="heading-1">äºŒã€é”™è¯¯å¤„ç†ï¼šè¶…è¶Šfmt.Printlnï¼Œæ„å»ºå¯è¿½æº¯çš„é”™è¯¯å¤„ç†ä½“ç³»</h2>
<p>ä½æ•ˆçš„é”™è¯¯å¤„ç†ä¼šè®©çº¿ä¸Šæ’æŸ¥å¦‚åŒå¤§æµ·æé’ˆã€‚ä»…ä»…æ‰“å°é”™è¯¯ä¿¡æ¯ï¼Œç¼ºå¤±äº†å…³é”®çš„ä¸Šä¸‹æ–‡å’Œç»“æ„ã€‚</p>
<p>é«˜æ ‡å‡†çš„å®è·µåœ¨äº <strong>åˆ†å±‚åŒ…è£…</strong> ä¸ <strong>ç²¾å‡†æº¯æº</strong>ã€‚åˆ©ç”¨ <code>fmt.Errorf</code> å’Œ <code>%w</code> åŠ¨è¯åŒ…è£…é”™è¯¯é“¾ï¼Œå®šä¹‰æ¸…æ™°çš„ä¸šåŠ¡é”™è¯¯ç±»å‹ï¼Œå¹¶é…åˆç»“æ„åŒ–æ—¥å¿—ï¼ˆå¦‚Zapï¼‰è®°å½•å †æ ˆã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// æŒ‰ä¸šåŠ¡åŸŸå®šä¹‰é”™è¯¯ç ï¼Œä¿æŒæ¸…æ™°</span>
<span class="hljs-keyword">const</span> (
    <span class="hljs-comment">// è®¤è¯ç›¸å…³é”™è¯¯ 10xx</span>
    ErrLoginFailed = <span class="hljs-number">1001</span>
    <span class="hljs-comment">// ç”¨æˆ·ç›¸å…³é”™è¯¯ 11xx</span>
    ErrUserNotFound = <span class="hljs-number">1101</span>
)

<span class="hljs-comment">// è‡ªå®šä¹‰ä¸šåŠ¡é”™è¯¯ç±»å‹ï¼Œä¾¿äºè°ƒç”¨æ–¹è¯†åˆ«</span>
<span class="hljs-keyword">type</span> BusinessError <span class="hljs-keyword">struct</span> {
    Code <span class="hljs-type">int</span>
    Msg  <span class="hljs-type">string</span>
}
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(e *BusinessError)</span></span> Error() <span class="hljs-type">string</span> { <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"[%d]%s"</span>, e.Code, e.Msg) }

<span class="hljs-comment">// åœ¨ä¸šåŠ¡å±‚ä¸­ï¼Œå¯¹åº•å±‚é”™è¯¯è¿›è¡ŒåŒ…è£…ï¼Œæ·»åŠ ä¸Šä¸‹æ–‡</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Login</span><span class="hljs-params">(username, password <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> {
    user, err := getUserByUsername(username)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-comment">// ä½¿ç”¨ %w åŒ…è£…ï¼Œå½¢æˆé”™è¯¯é“¾ï¼Œerrors.Is/As å¯è¿½æº¯</span>
        <span class="hljs-keyword">return</span> fmt.Errorf(<span class="hljs-string">"Login: failed to get user '%s': %w"</span>, username, err)
    }
    <span class="hljs-keyword">if</span> user.Password != hash(password) {
        <span class="hljs-keyword">return</span> &amp;BusinessError{Code: ErrLoginFailed, Msg: <span class="hljs-string">"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"</span>}
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// åœ¨Handlerå±‚ï¼ŒåŒºåˆ†å¤„ç†ç³»ç»Ÿé”™è¯¯ä¸ä¸šåŠ¡é”™è¯¯</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">LoginHandler</span><span class="hljs-params">(c *gin.Context)</span></span> {
    <span class="hljs-keyword">var</span> req LoginReq
    <span class="hljs-keyword">if</span> err := c.ShouldBindJSON(&amp;req); err != <span class="hljs-literal">nil</span> {
        zap.L().Warn(<span class="hljs-string">"è¯·æ±‚å‚æ•°ç»‘å®šå¤±è´¥"</span>, zap.Error(err))
        c.JSON(<span class="hljs-number">400</span>, gin.H{<span class="hljs-string">"code"</span>: <span class="hljs-number">-1</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"è¯·æ±‚å‚æ•°æ— æ•ˆ"</span>})
        <span class="hljs-keyword">return</span>
    }
    
    err := Login(req.Username, req.Password)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">var</span> bizErr *BusinessError
        <span class="hljs-keyword">if</span> errors.As(err, &amp;bizErr) {
            <span class="hljs-comment">// å·²çŸ¥ä¸šåŠ¡é”™è¯¯ï¼Œè¿”å›æ˜ç¡®æç¤º</span>
            c.JSON(<span class="hljs-number">400</span>, gin.H{<span class="hljs-string">"code"</span>: bizErr.Code, <span class="hljs-string">"msg"</span>: bizErr.Msg})
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// æœªçŸ¥ç³»ç»Ÿé”™è¯¯ï¼Œè®°å½•è¯¦ç»†æ—¥å¿—ï¼Œè¿”å›é€šç”¨ä¿¡æ¯</span>
            zap.L().Error(<span class="hljs-string">"ç™»å½•è¿‡ç¨‹å‘ç”Ÿç³»ç»Ÿé”™è¯¯"</span>, zap.Error(err), zap.String(<span class="hljs-string">"username"</span>, req.Username))
            c.JSON(<span class="hljs-number">500</span>, gin.H{<span class="hljs-string">"code"</span>: <span class="hljs-number">-1</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"ç³»ç»Ÿå†…éƒ¨é”™è¯¯"</span>})
        }
        <span class="hljs-keyword">return</span>
    }
    c.JSON(<span class="hljs-number">200</span>, gin.H{<span class="hljs-string">"code"</span>: <span class="hljs-number">0</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"ç™»å½•æˆåŠŸ"</span>})
}
</code></pre>
<p><strong>è¿™æ ·åšçš„å¥½å¤„</strong>ï¼šæ—¥å¿—ç³»ç»Ÿèƒ½å®Œæ•´è®°å½•é”™è¯¯é“¾æ¡ï¼Œä¾¿äºä½¿ç”¨ <code>errors.Is/As</code> è¿›è¡Œç²¾å‡†åˆ¤æ–­å’Œå®šä½ï¼›å‰ç«¯ä¹Ÿèƒ½æ ¹æ®ä¸åŒçš„é”™è¯¯ç è¿›è¡Œå·®å¼‚åŒ–äº¤äº’æç¤ºã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€é¡¹ç›®ç»“æ„ï¼šå·¥ç¨‹åŒ–çš„ç¬¬ä¸€æ­¥ï¼Œæ˜¯â€œåˆ†å±‚æ¸…æ™°â€</h2>
<p>å¾ˆå¤šåŒå­¦å†™é¡¹ç›®ï¼Œæ–‡ä»¶éšæ„å †æ”¾ï¼Œcontrollerã€serviceã€modelæ··æ‚åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œï¼Œä¸ä»…ä»–äººæ¥æ‰‹å›°éš¾ï¼Œè‡ªå·±ä¸€æ®µæ—¶é—´åä¹Ÿéš¾ä»¥å¿«é€Ÿç†è§£ã€‚</p>
<p>æˆ‘åœ¨è¾…å¯¼å­¦å‘˜æ—¶ï¼Œéƒ½è¦æ±‚é‡‡ç”¨è¿™å¥—æ ‡å‡†åŒ–ç»“æ„ï¼Œå¹¶ç»“åˆwireè¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œæ— è®ºæ˜¯ä¸ªäººå¼€å‘è¿˜æ˜¯å›¢é˜Ÿåä½œéƒ½èƒ½å¤§å¹…æå‡æ•ˆç‡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/project-name
â”œâ”€â”€ cmd/            <span class="hljs-comment"># ä¸»ç¨‹åºå…¥å£ï¼ˆæ¯ä¸ªæœåŠ¡ä¸€ä¸ªå­ç›®å½•ï¼‰</span>
â”‚   â””â”€â”€ api/        <span class="hljs-comment"># APIæœåŠ¡å…¥å£</span>
â”œâ”€â”€ internal/       <span class="hljs-comment"># æ ¸å¿ƒä¸šåŠ¡å®ç°</span>
â”‚   â”œâ”€â”€ api/        <span class="hljs-comment"># è¯·æ±‚å“åº”ç»“æ„ä½“</span>
â”‚   â”œâ”€â”€ model/      <span class="hljs-comment"># æ•°æ®æ¨¡å‹ï¼ˆæ•°æ®åº“ã€ç¼“å­˜ç­‰ï¼‰</span>
â”‚   â”œâ”€â”€ repository/ <span class="hljs-comment"># æ•°æ®è®¿é—®å±‚ï¼ˆæ“ä½œæ•°æ®åº“ã€ç¼“å­˜ï¼‰</span>
â”‚   â”œâ”€â”€ service/    <span class="hljs-comment"># ä¸šåŠ¡é€»è¾‘å±‚</span>
â”‚   â””â”€â”€ handler/    <span class="hljs-comment"># æ¥å£å¤„ç†å±‚ï¼ˆå¯¹æ¥ginç­‰æ¡†æ¶ï¼‰</span>
â”œâ”€â”€ pkg/            <span class="hljs-comment"># å¯å¤ç”¨ç»„ä»¶ï¼ˆå¯¹å¤–å¯å…±äº«ï¼‰</span>
â”‚   â”œâ”€â”€ logger/     <span class="hljs-comment"># æ—¥å¿—ç»„ä»¶</span>
â”‚   â”œâ”€â”€ config/     <span class="hljs-comment"># é…ç½®ç»„ä»¶</span>
â”‚   â””â”€â”€ utils/      <span class="hljs-comment"># å·¥å…·å‡½æ•°</span>
â”œâ”€â”€ configs/        <span class="hljs-comment"># é…ç½®æ–‡ä»¶</span>
â”œâ”€â”€ migrations/     <span class="hljs-comment"># æ•°æ®åº“è¿ç§»è„šæœ¬</span>
â””â”€â”€ go.mod          <span class="hljs-comment"># ä¾èµ–ç®¡ç†</span>
</code></pre>
<p><strong>å…³é”®ç‚¹è¯´æ˜</strong>ï¼š<code>internal</code> ç›®å½•åˆ©ç”¨äº†Goçš„internalåŒ…æœºåˆ¶ï¼Œå…¶ä¸‹çš„ä»£ç ä»…èƒ½è¢«ä½äºç›¸åŒæ¨¡å—ï¼ˆmoduleï¼‰æ ¹ç›®å½•æˆ–å…¶çˆ¶ç›®å½•ä¸‹çš„ä»£ç å¯¼å…¥ï¼Œæœ‰æ•ˆé˜²æ­¢äº†å¤–éƒ¨ä¾èµ–çš„æ»¥ç”¨ã€‚<code>pkg</code> ç›®å½•ç”¨äºå­˜æ”¾é€šç”¨ç»„ä»¶ï¼Œå¦‚æ—¥å¿—ã€é…ç½®ç­‰ï¼Œä¾¿äºå¤šä¸ªæœåŠ¡å¤ç”¨ã€‚</p>
<h2 data-id="heading-3">å››ã€æ¥å£æŠ½è±¡ï¼šå†™å¥½æµ‹è¯•çš„å‰æï¼Œæ˜¯â€œä¾èµ–å€’ç½®â€</h2>
<p>â€œä¸ä¼šå†™æµ‹è¯•çš„Goå¼€å‘è€…ï¼Œå¾ˆéš¾æ‹¿åˆ°é«˜è–ªâ€ã€‚è€Œå†™å¥½æµ‹è¯•çš„å…³é”®ï¼Œåœ¨äºåšå¥½æ¥å£æŠ½è±¡â€”â€”é«˜å±‚æ¨¡å—ä¾èµ–æ¥å£ï¼Œè€Œéå…·ä½“å®ç°ï¼Œä»è€Œèƒ½å¤Ÿæ–¹ä¾¿åœ°ä½¿ç”¨mockå·¥å…·ç”Ÿæˆæµ‹è¯•æ¡©ã€‚</p>
<p>ä»¥ç”¨æˆ·æœåŠ¡ä¸ºä¾‹ï¼Œå…ˆå®šä¹‰æ¥å£ï¼Œå†ç¼–å†™å®ç°ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// å®šä¹‰æ¥å£</span>
<span class="hljs-keyword">type</span> UserRepository <span class="hljs-keyword">interface</span> {
    FindByID(id <span class="hljs-type">int64</span>) (*User, <span class="hljs-type">error</span>)
    Create(user *User) <span class="hljs-type">error</span>
}

<span class="hljs-comment">// å®ç°æ¥å£ï¼ˆæ•°æ®åº“ç‰ˆæœ¬ï¼‰</span>
<span class="hljs-keyword">type</span> UserRepositoryMysql <span class="hljs-keyword">struct</span> {
    db *gorm.DB
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepositoryMysql)</span></span> FindByID(id <span class="hljs-type">int64</span>) (*User, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">var</span> user User
    <span class="hljs-comment">// ä¸»é”®æŸ¥è¯¢æ¨èä½¿ç”¨ db.First(&amp;user, id)</span>
    err := r.db.Where(<span class="hljs-string">"id = ?"</span>, id).First(&amp;user).Error
    <span class="hljs-keyword">if</span> errors.Is(err, gorm.ErrRecordNotFound) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, fmt.Errorf(<span class="hljs-string">"user not found: %w"</span>, err)
    }
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-keyword">return</span> &amp;user, <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *UserRepositoryMysql)</span></span> Create(user *User) <span class="hljs-type">error</span> {
    <span class="hljs-keyword">return</span> r.db.Create(user).Error
}

<span class="hljs-comment">// ä¸šåŠ¡æœåŠ¡ä¾èµ–æ¥å£</span>
<span class="hljs-keyword">type</span> UserService <span class="hljs-keyword">struct</span> {
    repo UserRepository <span class="hljs-comment">// ä¾èµ–æ¥å£ï¼Œä¸æ˜¯å…·ä½“å®ç°</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUserService</span><span class="hljs-params">(repo UserRepository)</span></span> *UserService {
    <span class="hljs-keyword">return</span> &amp;UserService{repo: repo}
}

<span class="hljs-comment">// ä¸šåŠ¡æ–¹æ³•</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *UserService)</span></span> GetUserInfo(id <span class="hljs-type">int64</span>) (*User, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">return</span> s.repo.FindByID(id)
}
</code></pre>
<p>ç¼–å†™æµ‹è¯•æ—¶ï¼Œä½¿ç”¨mockgenç”Ÿæˆ<code>UserRepository</code>çš„mockå®ç°ï¼Œæ— éœ€ä¾èµ–çœŸå®æ•°æ®åº“å³å¯å®Œæˆå•å…ƒæµ‹è¯•ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// ç”Ÿæˆçš„mockä»£ç ï¼ˆç®€åŒ–ï¼‰</span>
<span class="hljs-keyword">type</span> MockUserRepository <span class="hljs-keyword">struct</span> {
    mock.Mock
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(m *MockUserRepository)</span></span> FindByID(id <span class="hljs-type">int64</span>) (*User, <span class="hljs-type">error</span>) {
    args := m.Called(id)
    <span class="hljs-comment">// æ³¨æ„ï¼šéœ€è¦å¤„ç†args.Get(0)ä¸ºnilçš„æƒ…å†µ</span>
    <span class="hljs-keyword">if</span> args.Get(<span class="hljs-number">0</span>) == <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, args.Error(<span class="hljs-number">1</span>)
    }
    <span class="hljs-keyword">return</span> args.Get(<span class="hljs-number">0</span>).(*User), args.Error(<span class="hljs-number">1</span>)
}

<span class="hljs-comment">// æµ‹è¯•ç”¨ä¾‹</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestUserService_GetUserInfo</span><span class="hljs-params">(t *testing.T)</span></span> {
    <span class="hljs-comment">// åˆå§‹åŒ–mock</span>
    mockRepo := <span class="hljs-built_in">new</span>(MockUserRepository)
    user := &amp;User{ID: <span class="hljs-number">1</span>, Name: <span class="hljs-string">"test"</span>}
    mockRepo.On(<span class="hljs-string">"FindByID"</span>, <span class="hljs-type">int64</span>(<span class="hljs-number">1</span>)).Return(user, <span class="hljs-literal">nil</span>)
    
    <span class="hljs-comment">// åˆå§‹åŒ–æœåŠ¡</span>
    service := NewUserService(mockRepo)
    
    <span class="hljs-comment">// æ‰§è¡Œæµ‹è¯•</span>
    result, err := service.GetUserInfo(<span class="hljs-number">1</span>)
    assert.NoError(t, err)
    assert.Equal(t, user.Name, result.Name)
    
    <span class="hljs-comment">// éªŒè¯è°ƒç”¨</span>
    mockRepo.AssertExpectations(t)
}

<span class="hljs-comment">// è¡¨æ ¼é©±åŠ¨æµ‹è¯•ç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestUserService_GetUserInfo_Table</span><span class="hljs-params">(t *testing.T)</span></span> {
    tests := []<span class="hljs-keyword">struct</span> {
        name      <span class="hljs-type">string</span>
        userID    <span class="hljs-type">int64</span>
        mockUser  *User
        mockErr   <span class="hljs-type">error</span>
        wantErr   <span class="hljs-type">bool</span>
    }{
        {<span class="hljs-string">"ç”¨æˆ·å­˜åœ¨"</span>, <span class="hljs-number">1</span>, &amp;User{ID: <span class="hljs-number">1</span>, Name: <span class="hljs-string">"Alice"</span>}, <span class="hljs-literal">nil</span>, <span class="hljs-literal">false</span>},
        {<span class="hljs-string">"ç”¨æˆ·ä¸å­˜åœ¨"</span>, <span class="hljs-number">2</span>, <span class="hljs-literal">nil</span>, gorm.ErrRecordNotFound, <span class="hljs-literal">true</span>},
    }
    <span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests {
        t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> {
            mockRepo := <span class="hljs-built_in">new</span>(MockUserRepository)
            mockRepo.On(<span class="hljs-string">"FindByID"</span>, tt.userID).Return(tt.mockUser, tt.mockErr)
            
            service := NewUserService(mockRepo)
            _, err := service.GetUserInfo(tt.userID)
            
            <span class="hljs-keyword">if</span> tt.wantErr {
                assert.Error(t, err)
            } <span class="hljs-keyword">else</span> {
                assert.NoError(t, err)
            }
            mockRepo.AssertExpectations(t)
        })
    }
}
</code></pre>
<p>è¿™æ ·ç¼–å†™çš„ä»£ç ï¼Œä¸ä»…å¯æµ‹è¯•æ€§å¼ºï¼Œå½“éœ€è¦æ›´æ¢æ•°æ®æºï¼ˆå¦‚ä»MySQLæ¢æˆRedisç¼“å­˜ï¼‰æ—¶ï¼Œåªéœ€æ–°å¢ä¸€ä¸ªæ¥å£å®ç°ï¼Œä¸šåŠ¡é€»è¾‘ä»£ç æ— éœ€ä¿®æ”¹â€”â€”è¿™æ­£æ˜¯â€œä¾èµ–å€’ç½®â€åŸåˆ™çš„é­…åŠ›æ‰€åœ¨ã€‚</p>
<h2 data-id="heading-4">äº”ã€æ ‡å‡†åº“ï¼šæ·±å…¥ç†è§£æ ‡å‡†åº“ï¼Œé¿å…é‡å¤é€ è½®å­</h2>
<p>å¾ˆå¤šåŒå­¦åœ¨å­¦ä¹ GoåŸºç¡€åï¼Œæ€¥äºå¼•å…¥å„ç§ç¬¬ä¸‰æ–¹åº“ï¼Œå´å¿½ç•¥äº†æ ‡å‡†åº“æœ¬èº«å·²è¶³å¤Ÿå¼ºå¤§ã€‚æˆ‘è§è¿‡æœ‰äººæ‰‹å†™å­—ç¬¦ä¸²æ›¿æ¢å‡½æ•°ï¼Œå´ä¸çŸ¥<code>strings.ReplaceAll</code>ï¼›è‡ªå·±å®ç°æ—¶é—´è§£æé€»è¾‘ï¼Œå´å› æ ¼å¼é—®é¢˜è¸©å‘ã€‚</p>
<p>é«˜æ°´å¹³çš„å¼€å‘è€…ï¼Œé€šå¸¸æ˜¯â€œæ ‡å‡†åº“ä¸“å®¶â€ã€‚ä»¥ä¸‹åˆ†äº«å‡ ä¸ªé«˜é¢‘ä¸”æ˜“é”™çš„æ ‡å‡†åº“ç”¨æ³•ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 1. å­—ç¬¦ä¸²å¤„ç†</span>
s := <span class="hljs-string">"go go go"</span>
<span class="hljs-comment">// strings.ReplaceAll ä¸æ—§ç‰ˆ strings.Replace(s, "go", "run", -1) æ•ˆæœç›¸åŒ</span>
newS := strings.ReplaceAll(s, <span class="hljs-string">"go"</span>, <span class="hljs-string">"run"</span>) <span class="hljs-comment">// ç»“æœï¼šrun run run</span>

<span class="hljs-comment">// 2. æ—¶é—´å¤„ç†ï¼ˆå¿…é¡»ä½¿ç”¨Goçš„å‚è€ƒæ—¶é—´ï¼š2006-01-02 15:04:05ï¼‰</span>
t, err := time.Parse(<span class="hljs-string">"2006-01-02 15:04:05"</span>, <span class="hljs-string">"2025-01-01 12:00:00"</span>)
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    log.Fatal(err)
}
<span class="hljs-comment">// æ ¼å¼åŒ–è¾“å‡º</span>
fmt.Println(t.Format(<span class="hljs-string">"2006/01/02"</span>)) <span class="hljs-comment">// è¾“å‡ºï¼š2025/01/01</span>

<span class="hljs-comment">// 3. JSONå¤„ç†</span>
<span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> {
    Name <span class="hljs-type">string</span> <span class="hljs-string">`json:"name"`</span>
    Age  <span class="hljs-type">int</span>    <span class="hljs-string">`json:"age,omitempty"`</span> <span class="hljs-comment">// omitemptyï¼šé›¶å€¼æ—¶ä¸åºåˆ—åŒ–ï¼Œæ³¨æ„inté›¶å€¼ä¸º0</span>
    <span class="hljs-comment">// å¦‚éœ€åŒºåˆ†"å­—æ®µä¸å­˜åœ¨"å’Œ"å€¼ä¸º0"ï¼Œå¯ä½¿ç”¨æŒ‡é’ˆ</span>
    Height *<span class="hljs-type">int</span>  <span class="hljs-string">`json:"height,omitempty"`</span>
}
user := User{Name: <span class="hljs-string">"å¼ ä¸‰"</span>}
data, err := json.Marshal(user) <span class="hljs-comment">// ç»“æœï¼š{"name":"å¼ ä¸‰"}</span>

<span class="hljs-comment">// 4. HTTPå®¢æˆ·ç«¯ï¼ˆåŠ¡å¿…è®¾ç½®è¶…æ—¶ï¼‰</span>
client := &amp;http.Client{
    Timeout: <span class="hljs-number">5</span> * time.Second, <span class="hljs-comment">// é˜²æ­¢è¯·æ±‚é•¿æ—¶é—´é˜»å¡</span>
    Transport: &amp;http.Transport{
        MaxIdleConns:        <span class="hljs-number">100</span>,
        IdleConnTimeout:     <span class="hljs-number">90</span> * time.Second,
        TLSHandshakeTimeout: <span class="hljs-number">10</span> * time.Second,
    },
}
resp, err := client.Get(<span class="hljs-string">"https://api.example.com"</span>)
</code></pre>
<p><strong>æ ¸å¿ƒåŸåˆ™</strong>ï¼šä¼˜å…ˆä½¿ç”¨æ ‡å‡†åº“ï¼Œä»…åœ¨æ ‡å‡†åº“æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶å†å¼•å…¥ç¬¬ä¸‰æ–¹åº“ã€‚ä¾‹å¦‚ï¼ŒJSONå¤„ç†åœ¨å¤šæ•°åœºæ™¯ä¸‹æ ‡å‡†åº“å·²è¶³å¤Ÿï¼›HTTPæœåŠ¡æ–¹é¢ï¼Œç®€å•APIå¯ç”¨æ ‡å‡†åº“<code>net/http</code>ï¼Œå¤æ‚è·¯ç”±åœºæ™¯å†è€ƒè™‘Ginã€Echoç­‰æ¡†æ¶ã€‚</p>
<h2 data-id="heading-5">å…­ã€æ•°æ®åº“ï¼šORMä¸SQLä¼˜åŒ–åŒç®¡é½ä¸‹</h2>
<p>æœåŠ¡ç«¯å¼€å‘ç»•ä¸å¼€æ•°æ®åº“ï¼Œè€Œè®¸å¤šç³»ç»Ÿçš„æ€§èƒ½ç“¶é¢ˆæ°æ°å‡ºç°åœ¨æ•°æ®åº“å±‚é¢ã€‚å¸¸è§é—®é¢˜åŒ…æ‹¬ï¼šä½¿ç”¨GORMæ—¶æ— æ„è¯†å…¨è¡¨æ‰«æã€å¿½è§†é¢„åŠ è½½ï¼ˆPreloadï¼‰å¯¼è‡´N+1æŸ¥è¯¢ç­‰ã€‚</p>
<p>åˆ†äº«å‡ ä¸ªå®æˆ˜ä¼˜åŒ–æŠ€å·§ï¼š</p>
<ol>
<li><strong>ä½¿ç”¨SelectæŒ‡å®šå­—æ®µ</strong>ï¼šé¿å…<code>SELECT *</code>ï¼Œå‡å°‘æ•°æ®ä¼ è¾“</li>
<li><strong>å…³è”æŸ¥è¯¢ç”¨Preload</strong>ï¼šä¸€æ¬¡æ€§åŠ è½½å…³è”æ•°æ®ï¼Œè§£å†³N+1é—®é¢˜</li>
<li><strong>æ‰¹é‡æ“ä½œæ›¿ä»£å•æ¡æ“ä½œ</strong>ï¼šå¤§å¹…æå‡æ’å…¥ã€æ›´æ–°æ•ˆç‡</li>
<li><strong>åˆç†æ·»åŠ ç´¢å¼•</strong>ï¼šåŸºäºæŸ¥è¯¢æ¡ä»¶å»ºç«‹ç´¢å¼•ï¼Œé¿å…å…¨è¡¨æ‰«æ</li>
</ol>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 1. æŒ‡å®šå­—æ®µæŸ¥è¯¢</span>
<span class="hljs-keyword">var</span> user User
db.Select(<span class="hljs-string">"id"</span>, <span class="hljs-string">"name"</span>, <span class="hljs-string">"age"</span>).Where(<span class="hljs-string">"id = ?"</span>, <span class="hljs-number">1</span>).First(&amp;user)

<span class="hljs-comment">// 2. å…³è”æŸ¥è¯¢ï¼ˆPreloadè§£å†³N+1é—®é¢˜ï¼‰</span>
<span class="hljs-keyword">var</span> users []User
<span class="hljs-comment">// ä¸€æ¬¡æ€§åŠ è½½ç”¨æˆ·åŠå…¶è®¢å•ï¼Œè€Œéå¾ªç¯æŸ¥è¯¢</span>
db.Preload(<span class="hljs-string">"Orders"</span>, <span class="hljs-string">"status = ?"</span>, <span class="hljs-string">"paid"</span>).Where(<span class="hljs-string">"status = ?"</span>, <span class="hljs-number">1</span>).Find(&amp;users)

<span class="hljs-comment">// 3. æ‰¹é‡æ’å…¥</span>
users := []User{
    {Name: <span class="hljs-string">"å¼ ä¸‰"</span>, Age: <span class="hljs-number">20</span>},
    {Name: <span class="hljs-string">"æå››"</span>, Age: <span class="hljs-number">22</span>},
}
<span class="hljs-comment">// æ¯100æ¡è®°å½•åˆ†æ‰¹æ’å…¥</span>
db.CreateInBatches(users, <span class="hljs-number">100</span>)

<span class="hljs-comment">// 4. æ‰¹é‡æ›´æ–°</span>
db.Model(&amp;User{}).Where(<span class="hljs-string">"age &lt; ?"</span>, <span class="hljs-number">18</span>).Update(<span class="hljs-string">"status"</span>, <span class="hljs-number">0</span>)

<span class="hljs-comment">// 5. å¤æ‚æŸ¥è¯¢ä½¿ç”¨åŸç”ŸSQL</span>
<span class="hljs-keyword">type</span> UserReport <span class="hljs-keyword">struct</span> {
    Name  <span class="hljs-type">string</span>
    Total <span class="hljs-type">int</span>
}
<span class="hljs-keyword">var</span> reports []UserReport
db.Raw(<span class="hljs-string">`
    SELECT u.name, COUNT(o.id) as total 
    FROM users u 
    LEFT JOIN orders o ON u.id = o.user_id 
    WHERE u.created_at &gt; ? 
    GROUP BY u.id 
    HAVING total &gt; ?
    ORDER BY total DESC
`</span>, <span class="hljs-string">"2024-01-01"</span>, <span class="hljs-number">10</span>).Scan(&amp;reports)
</code></pre>
<p><strong>é‡è¦æé†’</strong>ï¼šå¯¹äºå¤æ‚æŸ¥è¯¢ï¼ˆå¦‚å¤šè¡¨å…³è”ã€çª—å£å‡½æ•°ã€å¤æ‚èšåˆï¼‰ï¼Œä¸å¿…å‹‰å¼ºä½¿ç”¨ORMï¼Œç›´æ¥ç¼–å†™åŸç”ŸSQLå¾€å¾€æ›´ç›´è§‚ã€æ›´é«˜æ•ˆã€‚ORMé€‚åˆå¸¸è§„CRUDæ“ä½œï¼Œè€Œå¤æ‚æŠ¥è¡¨ç±»æŸ¥è¯¢æ›´é€‚åˆåŸç”ŸSQLã€‚</p>
<h2 data-id="heading-6">ä¸ƒã€æ—¥å¿—ä¸é…ç½®ï¼šè§„èŒƒæ˜¯çº¿ä¸Šæ’æŸ¥çš„â€œç”Ÿå‘½çº¿â€</h2>
<p>â€œæ—¥å¿—æ··ä¹±å¦‚éº»ï¼Œæ’æŸ¥æ³ªæµä¸¤è¡Œâ€ã€‚è®¸å¤šé¡¹ç›®æ—¥å¿—ä½¿ç”¨fmtæ‰“å°ï¼Œé…ç½®ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼Œçº¿ä¸Šé—®é¢˜å‘ç”Ÿæ—¶ï¼Œè¦ä¹ˆæ‰¾ä¸åˆ°å…³é”®æ—¥å¿—ï¼Œè¦ä¹ˆä¿®æ”¹é…ç½®éœ€è¦é‡æ–°éƒ¨ç½²ã€‚</p>
<p>é«˜æ ‡å‡†å®è·µæ˜¯ï¼šä½¿ç”¨<strong>Zap</strong>è¿›è¡Œç»“æ„åŒ–æ—¥å¿—è®°å½•ï¼ˆé«˜æ€§èƒ½ã€æ”¯æŒè°ƒç”¨æ ˆï¼‰ï¼Œä½¿ç”¨<strong>Viper</strong>ç®¡ç†é…ç½®ï¼ˆæ”¯æŒå¤šç¯å¢ƒã€çƒ­æ›´æ–°ï¼‰ã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 1. Zapæ—¥å¿—åˆå§‹åŒ–ï¼ˆç”Ÿäº§ç¯å¢ƒé…ç½®ï¼‰</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitLogger</span><span class="hljs-params">()</span></span> {
    config := zap.NewProductionConfig()
    config.OutputPaths = []<span class="hljs-type">string</span>{<span class="hljs-string">"stdout"</span>, <span class="hljs-string">"/var/log/myapp/app.log"</span>}
    config.ErrorOutputPaths = []<span class="hljs-type">string</span>{<span class="hljs-string">"stderr"</span>, <span class="hljs-string">"/var/log/myapp/error.log"</span>}
    config.EncoderConfig.TimeKey = <span class="hljs-string">"timestamp"</span>
    config.EncoderConfig.EncodeTime = zapcore.ISO8601TimeEncoder
    
    logger, err := config.Build(zap.AddCaller(), zap.AddStacktrace(zap.ErrorLevel))
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-built_in">panic</span>(fmt.Sprintf(<span class="hljs-string">"failed to initialize logger: %v"</span>, err))
    }
    zap.ReplaceGlobals(logger)
    
    <span class="hljs-comment">// ç¨‹åºé€€å‡ºå‰åˆ·æ–°ç¼“å†²</span>
    <span class="hljs-keyword">defer</span> logger.Sync()
}

<span class="hljs-comment">// ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—</span>
zap.L().Info(<span class="hljs-string">"ç”¨æˆ·ç™»å½•æˆåŠŸ"</span>, 
    zap.String(<span class="hljs-string">"username"</span>, <span class="hljs-string">"å¼ ä¸‰"</span>), 
    zap.Int64(<span class="hljs-string">"user_id"</span>, <span class="hljs-number">1</span>),
    zap.String(<span class="hljs-string">"ip"</span>, <span class="hljs-string">"192.168.1.1"</span>))
zap.L().Error(<span class="hljs-string">"æ•°æ®åº“æŸ¥è¯¢å¤±è´¥"</span>, 
    zap.Error(err), 
    zap.String(<span class="hljs-string">"sql"</span>, sqlStr),
    zap.String(<span class="hljs-string">"operation"</span>, <span class="hljs-string">"user_login"</span>))

<span class="hljs-comment">// 2. Viperé…ç½®åˆå§‹åŒ–</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">InitConfig</span><span class="hljs-params">()</span></span> {
    viper.SetConfigName(<span class="hljs-string">"config"</span>) <span class="hljs-comment">// é…ç½®æ–‡ä»¶åä¸º config.yaml</span>
    viper.SetConfigType(<span class="hljs-string">"yaml"</span>)   <span class="hljs-comment">// é…ç½®æ–‡ä»¶ç±»å‹</span>
    viper.AddConfigPath(<span class="hljs-string">"."</span>)      <span class="hljs-comment">// å½“å‰ç›®å½•</span>
    viper.AddConfigPath(<span class="hljs-string">"./configs/"</span>) <span class="hljs-comment">// configsç›®å½•</span>
    viper.AddConfigPath(<span class="hljs-string">"/etc/myapp/"</span>) <span class="hljs-comment">// ç³»ç»Ÿé…ç½®ç›®å½•</span>
    
    <span class="hljs-comment">// è®¾ç½®ç¯å¢ƒå˜é‡å‰ç¼€ï¼Œè‡ªåŠ¨å°† MYAPP_ å¼€å¤´çš„ç¯å¢ƒå˜é‡æ˜ å°„åˆ°é…ç½®</span>
    viper.SetEnvPrefix(<span class="hljs-string">"MYAPP"</span>)
    viper.AutomaticEnv()
    
    <span class="hljs-comment">// è®¾ç½®é…ç½®é»˜è®¤å€¼</span>
    viper.SetDefault(<span class="hljs-string">"server.port"</span>, <span class="hljs-number">8080</span>)
    viper.SetDefault(<span class="hljs-string">"database.max_connections"</span>, <span class="hljs-number">100</span>)
    
    <span class="hljs-comment">// è¯»å–é…ç½®</span>
    <span class="hljs-keyword">if</span> err := viper.ReadInConfig(); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">if</span> _, ok := err.(viper.ConfigFileNotFoundError); ok {
            zap.L().Warn(<span class="hljs-string">"config file not found, using defaults and environment variables"</span>)
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">panic</span>(fmt.Errorf(<span class="hljs-string">"read config failed: %w"</span>, err))
        }
    }
    
    <span class="hljs-comment">// æ”¯æŒçƒ­æ›´æ–°</span>
    viper.WatchConfig()
    viper.OnConfigChange(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(e fsnotify.Event)</span></span> {
        zap.L().Info(<span class="hljs-string">"config file changed"</span>, zap.String(<span class="hljs-string">"file"</span>, e.Name))
        <span class="hljs-comment">// é‡æ–°åŠ è½½ç›¸å…³é…ç½®</span>
        reloadConfig()
    })
}

<span class="hljs-comment">// ä½¿ç”¨é…ç½®</span>
port := viper.GetInt(<span class="hljs-string">"server.port"</span>)
dbDsn := viper.GetString(<span class="hljs-string">"database.dsn"</span>)
</code></pre>
<p><strong>å®æ–½æ•ˆæœ</strong>ï¼šé€šè¿‡ç»“æ„åŒ–æ—¥å¿—ï¼Œå¯ä»¥å¿«é€Ÿç­›é€‰ã€èšåˆå…³é”®ä¿¡æ¯ï¼›é…ç½®çƒ­æ›´æ–°ä½¿å¾—è°ƒæ•´å‚æ•°æ— éœ€é‡å¯æœåŠ¡ï¼Œå¤§å¤§æå‡äº†è¿ç»´æ•ˆç‡ã€‚</p>
<h2 data-id="heading-7">å…«ã€ä¸­é—´ä»¶ï¼šæ¨¡å—åŒ–å¤„ç†é‰´æƒã€é™æµç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹</h2>
<p>ä¸­é—´ä»¶æ˜¯Go Webå¼€å‘çš„æ ¸å¿ƒæ‰©å±•æœºåˆ¶ã€‚è¯¸å¦‚é‰´æƒã€æ—¥å¿—è®°å½•ã€é™æµã€é“¾è·¯è¿½è¸ªç­‰é€šç”¨åŠŸèƒ½ï¼Œåº”é€šè¿‡ä¸­é—´ä»¶å®ç°ï¼Œè€Œéæ··å…¥ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>ä»¥Ginæ¡†æ¶ä¸ºä¾‹ï¼Œå®ç°ä¸€ä¸ªé€šç”¨çš„é‰´æƒä¸­é—´ä»¶ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// AuthMiddleware é‰´æƒä¸­é—´ä»¶</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">AuthMiddleware</span><span class="hljs-params">()</span></span> gin.HandlerFunc {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> {
        <span class="hljs-comment">// ä»Headerè·å–Token</span>
        token := c.GetHeader(<span class="hljs-string">"Authorization"</span>)
        <span class="hljs-keyword">if</span> token == <span class="hljs-string">""</span> {
            c.JSON(<span class="hljs-number">401</span>, gin.H{<span class="hljs-string">"code"</span>: <span class="hljs-number">401</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"æœªæˆæƒè®¿é—®"</span>})
            c.Abort() <span class="hljs-comment">// ç»ˆæ­¢è¯·æ±‚é“¾</span>
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-comment">// éªŒè¯Tokenï¼ˆå®é™…åœºæ™¯ä½¿ç”¨JWTç­‰æ–¹æ¡ˆï¼‰</span>
        claims, err := ParseJWTToken(token)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            c.JSON(<span class="hljs-number">401</span>, gin.H{<span class="hljs-string">"code"</span>: <span class="hljs-number">401</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"ä»¤ç‰Œæ— æ•ˆæˆ–å·²è¿‡æœŸ"</span>})
            c.Abort()
            <span class="hljs-keyword">return</span>
        }
        
        <span class="hljs-comment">// å°†ç”¨æˆ·ä¿¡æ¯å­˜å…¥ä¸Šä¸‹æ–‡ï¼Œä¾›åç»­å¤„ç†ä½¿ç”¨</span>
        c.Set(<span class="hljs-string">"user_id"</span>, claims.UserID)
        c.Set(<span class="hljs-string">"user_role"</span>, claims.Role)
        
        <span class="hljs-comment">// è®°å½•å®¡è®¡æ—¥å¿—</span>
        zap.L().Debug(<span class="hljs-string">"ç”¨æˆ·è¯·æ±‚é‰´æƒé€šè¿‡"</span>,
            zap.Int64(<span class="hljs-string">"user_id"</span>, claims.UserID),
            zap.String(<span class="hljs-string">"path"</span>, c.Request.URL.Path),
            zap.String(<span class="hljs-string">"method"</span>, c.Request.Method))
        
        c.Next() <span class="hljs-comment">// ç»§ç»­æ‰§è¡Œåç»­ä¸­é—´ä»¶å’Œä¸šåŠ¡é€»è¾‘</span>
        
        <span class="hljs-comment">// è¯·æ±‚åå¤„ç†ï¼ˆå¦‚è®°å½•æœ€ç»ˆçŠ¶æ€ï¼‰</span>
        <span class="hljs-keyword">if</span> c.Writer.Status() &gt;= <span class="hljs-number">400</span> {
            zap.L().Warn(<span class="hljs-string">"è¯·æ±‚å¤„ç†å¼‚å¸¸"</span>,
                zap.Int(<span class="hljs-string">"status"</span>, c.Writer.Status()),
                zap.String(<span class="hljs-string">"path"</span>, c.Request.URL.Path))
        }
    }
}

<span class="hljs-comment">// é™æµä¸­é—´ä»¶ç¤ºä¾‹ï¼ˆä»¤ç‰Œæ¡¶ç®—æ³•ï¼‰</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">RateLimitMiddleware</span><span class="hljs-params">(bucket *ratelimit.Bucket)</span></span> gin.HandlerFunc {
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> {
        <span class="hljs-keyword">if</span> bucket.TakeAvailable(<span class="hljs-number">1</span>) == <span class="hljs-number">0</span> {
            zap.L().Warn(<span class="hljs-string">"è¯·æ±‚é¢‘ç‡è¶…é™"</span>,
                zap.String(<span class="hljs-string">"ip"</span>, c.ClientIP()),
                zap.String(<span class="hljs-string">"path"</span>, c.Request.URL.Path))
            c.JSON(<span class="hljs-number">429</span>, gin.H{<span class="hljs-string">"code"</span>: <span class="hljs-number">429</span>, <span class="hljs-string">"msg"</span>: <span class="hljs-string">"è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åé‡è¯•"</span>})
            c.Abort()
            <span class="hljs-keyword">return</span>
        }
        c.Next()
    }
}

<span class="hljs-comment">// æ³¨å†Œä¸­é—´ä»¶</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    r := gin.Default()
    
    <span class="hljs-comment">// å…¨å±€ä¸­é—´ä»¶</span>
    r.Use(LoggerMiddleware())      <span class="hljs-comment">// æ—¥å¿—è®°å½•</span>
    r.Use(RecoveryMiddleware())    <span class="hljs-comment">// å¼‚å¸¸æ¢å¤</span>
    r.Use(CorsMiddleware())        <span class="hljs-comment">// è·¨åŸŸå¤„ç†</span>
    
    <span class="hljs-comment">// å…¬å…±è·¯ç”±ï¼ˆæ— éœ€é‰´æƒï¼‰</span>
    r.POST(<span class="hljs-string">"/api/v1/login"</span>, LoginHandler)
    r.GET(<span class="hljs-string">"/api/v1/public"</span>, PublicHandler)
    
    <span class="hljs-comment">// éœ€è¦é‰´æƒçš„è·¯ç”±ç»„</span>
    authGroup := r.Group(<span class="hljs-string">"/api/v1"</span>)
    authGroup.Use(AuthMiddleware())
    {
        authGroup.GET(<span class="hljs-string">"/user/info"</span>, UserInfoHandler)
        authGroup.POST(<span class="hljs-string">"/order/create"</span>, CreateOrderHandler)
    }
    
    <span class="hljs-comment">// éœ€è¦é™æµçš„æ•æ„Ÿæ¥å£</span>
    sensitiveGroup := r.Group(<span class="hljs-string">"/api/v1/sensitive"</span>)
    sensitiveGroup.Use(AuthMiddleware())
    sensitiveGroup.Use(RateLimitMiddleware(ratelimit.NewBucket(<span class="hljs-number">10</span>, <span class="hljs-number">5</span>))) <span class="hljs-comment">// 10ä¸ªå®¹é‡ï¼Œæ¯ç§’5ä¸ªä»¤ç‰Œ</span>
    {
        sensitiveGroup.GET(<span class="hljs-string">"/report"</span>, ReportHandler)
        sensitiveGroup.POST(<span class="hljs-string">"/batch"</span>, BatchOperationHandler)
    }
    
    r.Run(fmt.Sprintf(<span class="hljs-string">":%d"</span>, viper.GetInt(<span class="hljs-string">"server.port"</span>)))
}
</code></pre>
<p>é™¤äº†é‰´æƒå’Œé™æµï¼Œä¸­é—´ä»¶è¿˜å¯ç”¨äºå®ç°è¯·æ±‚è€—æ—¶ç»Ÿè®¡ã€æ•°æ®æ ¡éªŒã€ç¼“å­˜æ§åˆ¶ç­‰åŠŸèƒ½ã€‚è‰¯å¥½çš„ä¸­é—´ä»¶è®¾è®¡èƒ½ä½¿ä¸šåŠ¡ä»£ç æ›´åŠ ç®€æ´ï¼Œä¸“æ³¨äºæ ¸å¿ƒé€»è¾‘ã€‚</p>
<h2 data-id="heading-8">ä¹ã€å¹¶å‘å®‰å…¨ä¸æ€§èƒ½åˆ†æï¼šè§£å†³çº¿ä¸Šé—®é¢˜çš„æ ¸å¿ƒèƒ½åŠ›</h2>
<p>åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå¹¶å‘å®‰å…¨æ˜¯å¿…é¡»é¢å¯¹çš„é—®é¢˜ï¼›è€Œæ€§èƒ½åˆ†æåˆ™æ˜¯å®šä½çº¿ä¸Šç“¶é¢ˆçš„å…³é”®æŠ€èƒ½ã€‚è¿™ä¸¤ç‚¹ä¹Ÿæ˜¯é«˜è–ªå²—ä½é¢è¯•çš„å¸¸è§è€ƒç‚¹ã€‚</p>
<p><strong>å¹¶å‘å®‰å…¨åœºæ™¯ä¸æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 1. è¯»å¤šå†™å°‘åœºæ™¯ï¼šsync.RWMutex</span>
<span class="hljs-keyword">type</span> ConfigCache <span class="hljs-keyword">struct</span> {
    mu    sync.RWMutex
    data  <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">string</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *ConfigCache)</span></span> Get(key <span class="hljs-type">string</span>) <span class="hljs-type">string</span> {
    c.mu.RLock()         <span class="hljs-comment">// è¯»é”ï¼Œå…è®¸å¤šä¸ªgoroutineåŒæ—¶è¯»å–</span>
    <span class="hljs-keyword">defer</span> c.mu.RUnlock()
    <span class="hljs-keyword">return</span> c.data[key]
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c *ConfigCache)</span></span> Set(key, value <span class="hljs-type">string</span>) {
    c.mu.Lock()          <span class="hljs-comment">// å†™é”ï¼Œäº’æ–¥è®¿é—®</span>
    <span class="hljs-keyword">defer</span> c.mu.Unlock()
    c.data[key] = value
}

<span class="hljs-comment">// 2. é«˜é¢‘è¯»å†™çš„å¹¶å‘å®‰å…¨Mapï¼šsync.Mapï¼ˆé€‚ç”¨äºç‰¹å®šåœºæ™¯ï¼‰</span>
<span class="hljs-keyword">var</span> userSession sync.Map

<span class="hljs-comment">// å­˜å‚¨</span>
userSession.Store(<span class="hljs-string">"user123"</span>, &amp;Session{UserID: <span class="hljs-number">123</span>})
<span class="hljs-comment">// åŠ è½½</span>
<span class="hljs-keyword">if</span> sess, ok := userSession.Load(<span class="hljs-string">"user123"</span>); ok {
    <span class="hljs-comment">// ä½¿ç”¨session</span>
}
<span class="hljs-comment">// éå†</span>
userSession.Range(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(key, value <span class="hljs-keyword">interface</span>{})</span></span> <span class="hljs-type">bool</span> {
    <span class="hljs-comment">// å¤„ç†æ¯ä¸ªé”®å€¼å¯¹</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span> <span class="hljs-comment">// è¿”å›trueç»§ç»­éå†</span>
})

<span class="hljs-comment">// 3. å¯¹è±¡å¤ç”¨åœºæ™¯ï¼šsync.Poolï¼ˆå‡å°‘GCå‹åŠ›ï¼‰</span>
<span class="hljs-keyword">var</span> bufferPool = sync.Pool{
    New: <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> <span class="hljs-keyword">interface</span>{} {
        <span class="hljs-keyword">return</span> bytes.NewBuffer(<span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1024</span>))
    },
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetBuffer</span><span class="hljs-params">()</span></span> *bytes.Buffer {
    <span class="hljs-keyword">return</span> bufferPool.Get().(*bytes.Buffer)
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PutBuffer</span><span class="hljs-params">(buf *bytes.Buffer)</span></span> {
    buf.Reset()
    bufferPool.Put(buf)
}
</code></pre>
<p><strong>æ€§èƒ½åˆ†æå®æˆ˜ï¼š</strong></p>
<p>Goå†…ç½®çš„pprofå·¥å…·æ˜¯æ€§èƒ½åˆ†æçš„åˆ©å™¨ï¼Œèƒ½å¤Ÿå¿«é€Ÿå®šä½CPUã€å†…å­˜ã€goroutineç­‰ç“¶é¢ˆã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// å¯¼å…¥pprofï¼ˆç”Ÿäº§ç¯å¢ƒéœ€æ³¨æ„è®¿é—®æ§åˆ¶ï¼‰</span>
<span class="hljs-keyword">import</span> _ <span class="hljs-string">"net/http/pprof"</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// å¯åŠ¨pprofæœåŠ¡ï¼ˆç»‘å®šåˆ°æœ¬åœ°å›ç¯ï¼Œé¿å…å¤–éƒ¨è®¿é—®ï¼‰</span>
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        addr := <span class="hljs-string">"127.0.0.1:6060"</span>
        log.Println(<span class="hljs-string">"Pprof server listening on"</span>, addr)
        <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒå»ºè®®æ·»åŠ åŸºç¡€è®¤è¯æˆ–IPç™½åå•</span>
        log.Println(http.ListenAndServe(addr, <span class="hljs-literal">nil</span>))
    }()
    
    <span class="hljs-comment">// ä¸šåŠ¡ä»£ç ...</span>
    startServer()
}

<span class="hljs-comment">// åœ¨ä»£ç ä¸­æ·»åŠ è‡ªå®šä¹‰æ€§èƒ½åˆ†æç‚¹</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">processBatch</span><span class="hljs-params">(data []<span class="hljs-type">string</span>)</span></span> {
    <span class="hljs-comment">// è®°å½•å‡½æ•°è€—æ—¶</span>
    <span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(start time.Time)</span></span> {
        elapsed := time.Since(start)
        <span class="hljs-keyword">if</span> elapsed &gt; <span class="hljs-number">100</span>*time.Millisecond {
            zap.L().Warn(<span class="hljs-string">"processBatch took too long"</span>, 
                zap.Duration(<span class="hljs-string">"elapsed"</span>, elapsed),
                zap.Int(<span class="hljs-string">"data_size"</span>, <span class="hljs-built_in">len</span>(data)))
        }
    }(time.Now())
    
    <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘...</span>
}
</code></pre>
<p>æ€§èƒ½åˆ†æå‘½ä»¤ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹CPUä½¿ç”¨æƒ…å†µï¼ˆé‡‡æ ·30ç§’ï¼‰</span>
go tool pprof http://127.0.0.1:6060/debug/pprof/profile?seconds=30

<span class="hljs-comment"># æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ</span>
go tool pprof http://127.0.0.1:6060/debug/pprof/heap

<span class="hljs-comment"># æŸ¥çœ‹goroutineæ•°é‡åŠå †æ ˆ</span>
go tool pprof http://127.0.0.1:6060/debug/pprof/goroutine

<span class="hljs-comment"># ç”Ÿæˆç«ç„°å›¾ï¼ˆéœ€è¦å®‰è£…graphvizï¼‰</span>
go tool pprof -http=:8080 http://127.0.0.1:6060/debug/pprof/profile

<span class="hljs-comment"># æŸ¥çœ‹å†…å­˜åˆ†é…æƒ…å†µ</span>
go tool pprof http://127.0.0.1:6060/debug/pprof/allocs
</code></pre>
<p>æˆ‘æ›¾è¾…å¯¼ä¸€ä½å­¦å‘˜ï¼Œå…¶çº¿ä¸ŠæœåŠ¡CPUä½¿ç”¨ç‡æŒç»­é«˜ä½ï¼Œé€šè¿‡pprofåˆ†æå‘ç°ï¼Œé—®é¢˜å‡ºåœ¨ä¸€ä¸ªå¾ªç¯å†…çš„å­—ç¬¦ä¸²æ‹¼æ¥æœªä½¿ç”¨<code>strings.Builder</code>ï¼Œå¯¼è‡´å¤§é‡å†…å­˜åˆ†é…å’ŒGCå‹åŠ›ã€‚ä¼˜åŒ–åï¼ŒCPUä½¿ç”¨ç‡ä»80%é™è‡³15%ã€‚</p>
<h2 data-id="heading-9">åã€æµ‹è¯•ä¸CI/CDï¼šé«˜è´¨é‡ä»£ç çš„ä¿éšœä½“ç³»</h2>
<p>â€œæœªç»å……åˆ†æµ‹è¯•çš„ä»£ç ï¼Œå…¶å¯é æ€§æ˜¯æœªçŸ¥çš„â€ã€‚é«˜æ°´å¹³çš„å¼€å‘è€…ä¸ä»…è¦ç¼–å†™ä¸šåŠ¡ä»£ç ï¼Œè¿˜è¦ç¼–å†™æµ‹è¯•ä»£ç ï¼Œå¹¶æ­å»ºCI/CDæµæ°´çº¿å®ç°è‡ªåŠ¨åŒ–æµ‹è¯•ä¸éƒ¨ç½²ã€‚</p>
<p><strong>å®Œæ•´çš„æµ‹è¯•ç­–ç•¥ï¼š</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 1. å•å…ƒæµ‹è¯•ï¼ˆtable-driven testsæ˜¯Goç¤¾åŒºæ¨èé£æ ¼ï¼‰</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Add</span><span class="hljs-params">(a, b <span class="hljs-type">int</span>)</span></span> <span class="hljs-type">int</span> {
    <span class="hljs-keyword">return</span> a + b
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestAdd</span><span class="hljs-params">(t *testing.T)</span></span> {
    tests := []<span class="hljs-keyword">struct</span> {
        name     <span class="hljs-type">string</span>
        a, b     <span class="hljs-type">int</span>
        expected <span class="hljs-type">int</span>
    }{
        {<span class="hljs-string">"æ­£æ•°ç›¸åŠ "</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>},
        {<span class="hljs-string">"è´Ÿæ•°ä¸æ­£æ•°"</span>, <span class="hljs-number">-1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>},
        {<span class="hljs-string">"é›¶å€¼"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>},
        {<span class="hljs-string">"å¤§æ•°"</span>, <span class="hljs-number">1000000</span>, <span class="hljs-number">2000000</span>, <span class="hljs-number">3000000</span>},
    }
    
    <span class="hljs-keyword">for</span> _, tt := <span class="hljs-keyword">range</span> tests {
        t.Run(tt.name, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(t *testing.T)</span></span> {
            result := Add(tt.a, tt.b)
            assert.Equal(t, tt.expected, result, 
                fmt.Sprintf(<span class="hljs-string">"Add(%d, %d) = %d, expected %d"</span>, 
                    tt.a, tt.b, result, tt.expected))
        })
    }
}

<span class="hljs-comment">// 2. é›†æˆæµ‹è¯•ï¼ˆéªŒè¯æ¨¡å—é—´åä½œï¼‰</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestUserLoginIntegration</span><span class="hljs-params">(t *testing.T)</span></span> {
    <span class="hljs-comment">// ä½¿ç”¨æµ‹è¯•æ•°æ®åº“</span>
    testDB := setupTestDB(t)
    <span class="hljs-keyword">defer</span> teardownTestDB(t, testDB)
    
    <span class="hljs-comment">// åˆå§‹åŒ–ä»“åº“å’ŒæœåŠ¡</span>
    repo := NewUserRepository(testDB)
    service := NewUserService(repo)
    
    <span class="hljs-comment">// åˆ›å»ºæµ‹è¯•ç”¨æˆ·</span>
    testUser := &amp;User{Username: <span class="hljs-string">"testuser"</span>, Password: hashPassword(<span class="hljs-string">"testpass"</span>)}
    err := repo.Create(testUser)
    require.NoError(t, err)
    
    <span class="hljs-comment">// æµ‹è¯•ç™»å½•</span>
    user, err := service.Login(<span class="hljs-string">"testuser"</span>, <span class="hljs-string">"testpass"</span>)
    assert.NoError(t, err)
    assert.Equal(t, <span class="hljs-string">"testuser"</span>, user.Username)
}

<span class="hljs-comment">// 3. APIæ¥å£æµ‹è¯•</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestUserInfoAPI</span><span class="hljs-params">(t *testing.T)</span></span> {
    <span class="hljs-comment">// åˆå§‹åŒ–è·¯ç”±</span>
    router := setupRouter()
    
    <span class="hljs-comment">// åˆ›å»ºæµ‹è¯•è¯·æ±‚ï¼ˆå¸¦æœ‰æ•ˆtokenï¼‰</span>
    req := httptest.NewRequest(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"/api/v1/user/info"</span>, <span class="hljs-literal">nil</span>)
    req.Header.Set(<span class="hljs-string">"Authorization"</span>, <span class="hljs-string">"Bearer test-token-123"</span>)
    req.Header.Set(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>)
    
    <span class="hljs-comment">// è®°å½•å“åº”</span>
    w := httptest.NewRecorder()
    router.ServeHTTP(w, req)
    
    <span class="hljs-comment">// éªŒè¯å“åº”</span>
    assert.Equal(t, http.StatusOK, w.Code)
    
    <span class="hljs-keyword">var</span> resp Response
    err := json.Unmarshal(w.Body.Bytes(), &amp;resp)
    assert.NoError(t, err)
    assert.Equal(t, <span class="hljs-number">0</span>, resp.Code)
    assert.NotEmpty(t, resp.Data)
}
</code></pre>
<p><strong>GitHub Actions CIæµæ°´çº¿é…ç½®ï¼š</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">CI</span> <span class="hljs-string">Pipeline</span>
<span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>, <span class="hljs-string">pull_request</span>]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">test:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">services:</span>
      <span class="hljs-attr">mysql:</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">root</span>
          <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">testdb</span>
        <span class="hljs-attr">ports:</span>
          <span class="hljs-bullet">-</span> <span class="hljs-number">3306</span><span class="hljs-string">:3306</span>
        <span class="hljs-attr">options:</span> <span class="hljs-string">&gt;-
          --health-cmd="mysqladmin ping"
          --health-interval=10s
          --health-timeout=5s
          --health-retries=3
</span>    
    <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">Go</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-go@v5</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">go-version:</span> <span class="hljs-string">'1.25'</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">go</span> <span class="hljs-string">mod</span> <span class="hljs-string">download</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">linter</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">|
        go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
        golangci-lint run --timeout=5m ./...
</span>    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">unit</span> <span class="hljs-string">tests</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">go</span> <span class="hljs-string">test</span> <span class="hljs-string">./...</span> <span class="hljs-string">-v</span> <span class="hljs-string">-short</span> <span class="hljs-string">-race</span> <span class="hljs-string">-coverprofile=coverage.out</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Run</span> <span class="hljs-string">integration</span> <span class="hljs-string">tests</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">|
        go test ./internal/repository -v -tags=integration -race
        go test ./internal/service -v -tags=integration -race
</span>      <span class="hljs-attr">env:</span>
        <span class="hljs-attr">DB_DSN:</span> <span class="hljs-string">"root:root@tcp(localhost:3306)/testdb?charset=utf8mb4&amp;parseTime=True&amp;loc=Local"</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">coverage</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">codecov/codecov-action@v4</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">file:</span> <span class="hljs-string">./coverage.out</span>
    
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">needs:</span> <span class="hljs-string">test</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">if:</span> <span class="hljs-string">github.event_name</span> <span class="hljs-string">==</span> <span class="hljs-string">'push'</span> <span class="hljs-string">&amp;&amp;</span> <span class="hljs-string">github.ref</span> <span class="hljs-string">==</span> <span class="hljs-string">'refs/heads/main'</span>
    
    <span class="hljs-attr">steps:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Set</span> <span class="hljs-string">up</span> <span class="hljs-string">Go</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-go@v5</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">go-version:</span> <span class="hljs-string">'1.25'</span>
    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">binary</span>
      <span class="hljs-attr">run:</span> <span class="hljs-string">|
        go build -ldflags="-s -w" -o myapp ./cmd/api
</span>    
    <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Docker</span> <span class="hljs-string">build</span> <span class="hljs-string">and</span> <span class="hljs-string">push</span>
      <span class="hljs-attr">uses:</span> <span class="hljs-string">docker/build-push-action@v5</span>
      <span class="hljs-attr">with:</span>
        <span class="hljs-attr">context:</span> <span class="hljs-string">.</span>
        <span class="hljs-attr">push:</span> <span class="hljs-literal">true</span>
        <span class="hljs-attr">tags:</span> <span class="hljs-string">|
          ${{ secrets.DOCKER_USERNAME }}/myapp:latest
          ${{ secrets.DOCKER_USERNAME }}/myapp:${{ github.sha }}
</span></code></pre>
<p>è¿™æ ·çš„CI/CDé…ç½®ç¡®ä¿äº†æ¯æ¬¡ä»£ç æäº¤éƒ½ç»è¿‡è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæµ‹è¯•å¤±è´¥ä¼šç«‹å³é€šçŸ¥ï¼Œæœ‰æ•ˆé˜²æ­¢bugè¿›å…¥ä¸»åˆ†æ”¯ã€‚ç»“åˆè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œå¯ä»¥å®ç°ä»å¼€å‘åˆ°ä¸Šçº¿çš„å…¨æµç¨‹è´¨é‡ä¿éšœã€‚</p>
<h2 data-id="heading-10">æ€»ç»“ï¼šå¹´è–ª50Wçš„Goå¼€å‘è€…ï¼Œæ ¸å¿ƒèƒ½åŠ›æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>å›é¡¾æˆ‘è¾…å¯¼400+å­¦å‘˜è·å–Offerçš„ç»éªŒï¼Œå¹´è–ª50Wçš„Goå¼€å‘è€…ï¼Œå…¶ä¼˜åŠ¿ä»æ¥ä¸æ­¢äº"ä¼šå†™è¯­æ³•"ï¼Œè€Œæ˜¯å…·å¤‡ä»¥ä¸‹å››å¤§æ ¸å¿ƒèƒ½åŠ›ï¼š</p>
<ol>
<li><strong>å·¥ç¨‹åŒ–æ€ç»´</strong>ï¼šèƒ½å¤Ÿè®¾è®¡å¹¶å®ç°ç»“æ„æ¸…æ™°ã€å¯ç»´æŠ¤ã€å¯æ‰©å±•çš„ä»£ç æ¶æ„</li>
<li><strong>é—®é¢˜è§£å†³èƒ½åŠ›</strong>ï¼šèƒ½å¤Ÿå¿«é€Ÿå®šä½å¹¶è§£å†³çº¿ä¸Šå¤æ‚é—®é¢˜ï¼ˆå¹¶å‘ã€æ€§èƒ½ã€æ•°æ®åº“ä¼˜åŒ–ç­‰ï¼‰</li>
<li><strong>è´¨é‡ä¿éšœæ„è¯†</strong>ï¼šç†Ÿç»ƒæŒæ¡æµ‹è¯•ç¼–å†™ï¼Œèƒ½å¤Ÿé€šè¿‡CI/CDæµç¨‹ç¡®ä¿ä»£ç è´¨é‡</li>
<li><strong>å·¥å…·é“¾ç†Ÿç»ƒåº¦</strong>ï¼šé«˜æ•ˆä½¿ç”¨å„ç§å¼€å‘ã€è°ƒè¯•ã€è¿ç»´å·¥å…·ï¼ˆpprofã€Zapã€Viperã€Dockerç­‰ï¼‰æå‡å·¥ä½œæ•ˆç‡</li>
</ol>
<p>è¿™10ä¸ªå®æˆ˜æŠ€å·§ï¼Œå‡æºäºçœŸå®é¡¹ç›®ç»éªŒå’Œå­¦å‘˜è¾…å¯¼å®è·µã€‚å°†å®ƒä»¬ç³»ç»Ÿæ€§åœ°åº”ç”¨åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œä½ çš„ä»£ç è´¨é‡å’ŒæŠ€æœ¯èƒ½åŠ›å¿…å°†å®ç°è´¨çš„é£è·ƒã€‚</p>
<p>å¦‚æœä½ çš„Goå­¦ä¹ æ­£å¤„äºç“¶é¢ˆæœŸï¼Œæˆ–è®¡åˆ’å†²å‡»é«˜è–ªOfferï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„å…¬ä¼—å·ï¼šç‹ä¸­é˜³ï¼Œç§ä¿¡"Goè¿›é˜¶"ï¼Œæˆ‘ä¼šå°†æ•´ç†çš„ã€ŠGoé¢è¯•é«˜é¢‘è€ƒç‚¹è§£æã€‹ä¸ã€Šä¼ä¸šçº§é¡¹ç›®å®æˆ˜æ¨¡æ¿ã€‹åˆ†äº«ç»™ä½ ã€‚</p>
<p>å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„æ˜é‡‘è´¦å·ï¼Œå¹¶åˆ†äº«ç»™æ›´å¤šæ­£åœ¨å­¦ä¹ Goçš„æœ‹å‹â€”â€”ä½ çš„åˆ†äº«ï¼Œæˆ–è®¸èƒ½ä¸ºä»–ä»¬ç…§äº®å‰è¡Œçš„é“è·¯ã€‚</p>
<blockquote>
<p>æˆ‘æ˜¯ç‹ä¸­é˜³ï¼Œä¸“æ³¨äºGoåç«¯æŠ€æœ¯æå‡ä¸èŒä¸šå‘å±•è¾…å¯¼ï¼Œå…³æ³¨æˆ‘ï¼Œç”¨æŠ€æœ¯å®ç°èŒä¸šçªç ´ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CAS ä¸€ç¯‡è®²æ¸…ï¼šåŸç†ã€Java ç”¨æ³•ï¼Œä»¥åŠçº¿ä¸Šå¯ç”¨çš„è®¢å•çŠ¶æ€æœºå¹‚ç­‰æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7585458459166736418</link>    <guid>https://juejin.cn/post/7585458459166736418</guid>    <pubDate>2025-12-20T16:25:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585458459166736418" data-draft-id="7585458459166720034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" CAS ä¸€ç¯‡è®²æ¸…ï¼šåŸç†ã€Java ç”¨æ³•ï¼Œä»¥åŠçº¿ä¸Šå¯ç”¨çš„è®¢å•çŠ¶æ€æœºå¹‚ç­‰æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T16:25:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ¨æœ¨ä¸€ç›´åœ¨å“­æ³£"/> <meta itemprop="url" content="https://juejin.cn/user/3896324937225085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             CAS ä¸€ç¯‡è®²æ¸…ï¼šåŸç†ã€Java ç”¨æ³•ï¼Œä»¥åŠçº¿ä¸Šå¯ç”¨çš„è®¢å•çŠ¶æ€æœºå¹‚ç­‰æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3896324937225085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ¨æœ¨ä¸€ç›´åœ¨å“­æ³£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T16:25:48.000Z" title="Sat Dec 20 2025 16:25:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<p>å¹¶å‘åœºæ™¯é‡Œæœ€å¸¸è§çš„ä¸€ç±»é—®é¢˜æ˜¯ï¼š<strong>å¤šä¸ªçº¿ç¨‹/å¤šæ¬¡å›è°ƒåŒæ—¶æ›´æ–°åŒä¸€ä»½æ•°æ®</strong>ã€‚ä½ æ—¢ä¸æƒ³ä¸Šå¤§é”æŠŠååæ‰“å´©ï¼Œåˆå¿…é¡»ä¿è¯æ­£ç¡®æ€§ï¼ˆå°¤å…¶æ˜¯â€œåªå¤„ç†ä¸€æ¬¡â€çš„å¹‚ç­‰é€»è¾‘ï¼‰ã€‚CASï¼ˆCompare-And-Swap / Compare-And-Setï¼‰å°±æ˜¯ä¸ºæ­¤å‡†å¤‡çš„åº•å±‚èƒ½åŠ›ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« è®²ä¸‰ä»¶äº‹ï¼š</p>
<ol>
<li>CAS æ˜¯ä»€ä¹ˆã€åŸç†æ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆèƒ½æ— é”æ›´æ–°</li>
<li>Java é‡Œ CAS æ€ä¹ˆç”¨ï¼ˆAtomic ç³»åˆ—ï¼‰ä»¥åŠä½•æ—¶éœ€è¦è‡ªæ—‹</li>
<li>ä¸€ä¸ªèƒ½ç›´æ¥çº¿ä¸Šç”¨çš„ä¾‹å­ï¼š<strong>è®¢å•æ”¯ä»˜å›è°ƒå¹‚ç­‰ + çŠ¶æ€æœºï¼ˆNEWâ†’PAYINGâ†’PAIDï¼‰</strong> ï¼Œé¿å…é‡å¤æ‰§è¡Œå‰¯ä½œç”¨ä¸”é˜²æ­¢â€œåŠæˆåŠŸâ€</li>
</ol>
<hr/>
<h3 data-id="heading-0">1ï¼‰CAS æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>CAS æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œè¯­ä¹‰æ˜¯ï¼š</p>
<blockquote>
<p><strong>å¦‚æœå†…å­˜ä¸­çš„å€¼ == æœŸæœ›å€¼ expectedï¼Œå°±æ›´æ–°ä¸ºæ–°å€¼ newï¼›å¦åˆ™å¤±è´¥ã€‚</strong></p>
</blockquote>
<p>ä¼ªä»£ç ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-built_in">boolean</span> <span class="hljs-title function_">CAS</span>(<span class="hljs-params">addr, expected, newValue</span>) {
  <span class="hljs-keyword">if</span> (*addr == expected) {
    *addr = newValue
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}
</code></pre>
<p>CAS çš„åŸå­æ€§æ¥è‡ª CPU æŒ‡ä»¤ï¼ˆä¾‹å¦‚ x86 çš„ <code>cmpxchg</code>ï¼‰ï¼ŒJVM æŠŠå®ƒå°è£…æˆ Java API ç»™æˆ‘ä»¬ç”¨ã€‚</p>
<hr/>
<h3 data-id="heading-1">2ï¼‰CAS çš„å…¸å‹å†™æ³•ï¼šè‡ªæ—‹é‡è¯•ï¼ˆä»€ä¹ˆæ—¶å€™éœ€è¦ï¼‰</h3>
<p>CAS åªè¿”å›æˆåŠŸ/å¤±è´¥ï¼Œä¸ä¼šåƒé”é‚£æ ·é˜»å¡ç­‰å¾…ã€‚æ‰€ä»¥ä½ ä¼šçœ‹åˆ°ä¸¤ç±»ç”¨æ³•ï¼š</p>
<h4 data-id="heading-2">2.1 å¿…é¡»æœ€ç»ˆæˆåŠŸï¼šéœ€è¦è‡ªæ—‹ï¼ˆæ¯”å¦‚è®¡æ•°å™¨ +1ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">while (true) {
    int <span class="hljs-attr">old</span> = count.get()<span class="hljs-comment">;</span>
    int <span class="hljs-attr">next</span> = old + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
    if (count.compareAndSet(old, next)) break<span class="hljs-comment">;</span>
}
</code></pre>
<p>è¿™æ®µå¾ªç¯çš„æ„æ€æ˜¯ï¼š<br/>
<strong>å¦‚æœæˆ‘æ›´æ–°å¤±è´¥ï¼Œè¯´æ˜è¢«åˆ«äººæŠ¢å…ˆæ”¹äº†ï¼Œé‚£æˆ‘é‡æ–°è¯»æœ€æ–°å€¼å†ç®—å†è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢</strong>ã€‚<br/>
è¿™ç§åœºæ™¯ä¸è‡ªæ—‹å°±ä¼šâ€œä¸¢æ›´æ–°â€ã€‚</p>
<h4 data-id="heading-3">2.2 åªå…è®¸æ‰§è¡Œä¸€æ¬¡ï¼šä¸éœ€è¦è‡ªæ—‹ï¼ˆå¹‚ç­‰æŠ¢å æ‰§è¡Œæƒï¼‰</h4>
<p>æ¯”å¦‚æ”¯ä»˜å›è°ƒã€å‘åˆ¸ã€å‘è´§è¿™ç§å‰¯ä½œç”¨é€»è¾‘ï¼Œè¯­ä¹‰æ˜¯ï¼š</p>
<blockquote>
<p><strong>åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œä¸€æ¬¡ï¼›å…¶ä»–çº¿ç¨‹å‘ç°å·²ç»å¤„ç†è¿‡å°±ç›´æ¥è¿”å›ã€‚</strong></p>
</blockquote>
<p>è¿™ç§åœºæ™¯å°±åº”è¯¥â€œä¸€æªâ€CASï¼š</p>
<pre><code class="hljs language-scss" lang="scss">if (!cas(NEW, PAYING)) return; <span class="hljs-comment">// æŠ¢ä¸åˆ°å°±ç›´æ¥èµ°å¹‚ç­‰</span>
<span class="hljs-built_in">doSideEffectsOnce</span>();
</code></pre>
<p>å¤±è´¥äº†ä¸è¦è‡ªæ—‹ï¼Œå› ä¸ºå¤±è´¥æ„å‘³ç€â€œåˆ«äººå·²ç»åœ¨å¤„ç†/å¤„ç†è¿‡â€ï¼Œä½ ä¸åº”è¯¥å†æŠ¢ã€‚</p>
<hr/>
<h3 data-id="heading-4">3ï¼‰CAS ä¸ºä»€ä¹ˆå¿«ï¼Ÿæœ‰ä»€ä¹ˆå‘ï¼Ÿ</h3>
<h4 data-id="heading-5">ä¼˜ç‚¹</h4>
<ul>
<li><strong>æ— é˜»å¡</strong>ï¼šå¤±è´¥ä¸æŒ‚çº¿ç¨‹ï¼Œä¸è¿›å…¥ OS é”</li>
<li>å†²çªä½æ—¶ååé«˜ã€å»¶è¿Ÿä½</li>
</ul>
<h4 data-id="heading-6">ç¼ºç‚¹</h4>
<ul>
<li>å†²çªé«˜ä¼šå¯¼è‡´è‡ªæ—‹å¤šï¼ŒCPU é£™å‡ï¼ˆè®¡æ•°çƒ­ç‚¹å°¤å…¶æ˜æ˜¾ï¼‰</li>
<li>ç»å…¸é—®é¢˜ï¼šABAï¼ˆAâ†’Bâ†’Aï¼‰ï¼Œæ— é”æ•°æ®ç»“æ„é‡Œè¦ç”¨ç‰ˆæœ¬å·è§£å†³ï¼ˆAtomicStampedReferenceï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-7">4ï¼‰Java é‡Œ CAS ç”¨åœ¨å“ªï¼Ÿ</h3>
<p>ä½ æ—¥å¸¸å…¶å®ä¸€ç›´åœ¨ç”¨ï¼š</p>
<ul>
<li><code>AtomicInteger/AtomicLong/AtomicReference</code>ï¼šæ ¸å¿ƒå°±æ˜¯ <code>compareAndSet</code></li>
<li><code>LongAdder</code>ï¼šé«˜å¹¶å‘è®¡æ•°å™¨ï¼Œå‡å°‘çƒ­ç‚¹ CAS å†²çª</li>
<li><code>ConcurrentHashMap</code>ã€AQS/ReentrantLockï¼šå…³é”®è·¯å¾„éƒ½ç”¨ CAS</li>
</ul>
<p>ç»“è®ºï¼š<strong>CAS æ˜¯å¾ˆå¤šå¹¶å‘å·¥å…·çš„åœ°åŸº</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-8">5ï¼‰çº¿ä¸Šå¯ç”¨ä¾‹å­ï¼šè®¢å•æ”¯ä»˜å›è°ƒå¹‚ç­‰ï¼ˆNEWâ†’PAYINGâ†’PAIDï¼‰</h2>
<p>å¾ˆå¤šäººç”¨ CAS å†™å¹‚ç­‰ï¼Œä¼šç›´æ¥ <code>NEW â†’ PAID</code>ï¼Œè¿™åœ¨â€œçº¯çŠ¶æ€â€ä¸Šæ²¡é—®é¢˜ï¼Œä½†çº¿ä¸Šå¸¸è§å‘æ˜¯ï¼š</p>
<ul>
<li>ä½ æŠŠçŠ¶æ€æ”¹æˆ PAID äº†</li>
<li>ä½†â€œå‘åˆ¸/è®°è´¦/å‘MQâ€ç­‰å‰¯ä½œç”¨æ‰§è¡Œåˆ°ä¸€åŠå¼‚å¸¸</li>
<li>ç»“æœå˜æˆï¼š<strong>çŠ¶æ€å·²ç»ˆæ€ï¼Œä½†å‰¯ä½œç”¨ä¸å®Œæ•´</strong>ï¼ˆæœ€éš¾æ’æŸ¥ï¼‰</li>
</ul>
<p>æ›´ç¨³çš„å·¥ç¨‹å†™æ³•æ˜¯åŠ ä¸€ä¸ªä¸­é—´æ€ï¼š<code>PAYING</code>ï¼ˆå¤„ç†ä¸­/æŠ¢å æ€ï¼‰ï¼š</p>
<ol>
<li><code>NEW â†’ PAYING</code>ï¼šCAS æŠ¢å æ‰§è¡Œæƒï¼ˆåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æˆåŠŸï¼‰</li>
<li>åšå‰¯ä½œç”¨ï¼ˆç¡®ä¿åªæ‰§è¡Œä¸€æ¬¡ï¼‰</li>
<li>æˆåŠŸå <code>PAYING â†’ PAID</code></li>
<li>å¤±è´¥åˆ™å›æ»šä¸º <code>NEW</code> æˆ–æ ‡è®° <code>PAY_FAILED</code>ï¼ˆçœ‹ä¸šåŠ¡ï¼‰</li>
</ol>
<p>è¿™æ ·èƒ½æŠŠâ€œæ‰§è¡ŒæƒæŠ¢å â€å’Œâ€œå‰¯ä½œç”¨å®Œæˆâ€è§£è€¦ï¼Œçº¿ä¸Šæ›´ç¨³ã€‚</p>
<hr/>
<h3 data-id="heading-9">5.1 çŠ¶æ€å®šä¹‰</h3>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">OrderStatus</span> {
    <span class="hljs-type">NEW</span>,        <span class="hljs-comment">// æœªæ”¯ä»˜</span>
    <span class="hljs-type">PAYING</span>,     <span class="hljs-comment">// æ”¯ä»˜å¤„ç†ä¸­ï¼ˆæŠ¢å æ‰§è¡Œæƒï¼‰</span>
    <span class="hljs-type">PAID</span>,       <span class="hljs-comment">// å·²æ”¯ä»˜</span>
    <span class="hljs-type">PAY_FAILED</span>, <span class="hljs-comment">// æ”¯ä»˜å¤„ç†å¤±è´¥ï¼ˆå¯é€‰ï¼‰</span>
    <span class="hljs-type">CANCELED</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-10">5.2 è®¢å•å¯¹è±¡ï¼šAtomicReference ä¿å­˜çŠ¶æ€</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> java.util.concurrent.atomic.AtomicReference;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> orderId;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> AtomicReference&lt;OrderStatus&gt; status = <span class="hljs-keyword">new</span> AtomicReference&lt;&gt;(OrderStatus.NEW);

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Order</span><span class="hljs-params">(<span class="hljs-type">String</span> orderId)</span> </span>{
        <span class="hljs-keyword">this</span>.orderId = orderId;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">getOrderId</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> orderId;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> OrderStatus <span class="hljs-title">getStatus</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> status.<span class="hljs-built_in">get</span>();
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title">casStatus</span><span class="hljs-params">(OrderStatus expected, OrderStatus update)</span> </span>{
        <span class="hljs-keyword">return</span> status.<span class="hljs-built_in">compareAndSet</span>(expected, update);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-11">5.3 æ”¯ä»˜å›è°ƒå¤„ç†å™¨ï¼šæŠ¢å æ‰§è¡Œæƒ + å¹‚ç­‰ + é˜²åŠæˆåŠŸ</h3>
<pre><code class="hljs language-scss" lang="scss">import org<span class="hljs-selector-class">.slf4j</span><span class="hljs-selector-class">.Logger</span>;
import org<span class="hljs-selector-class">.slf4j</span><span class="hljs-selector-class">.LoggerFactory</span>;

public class PaymentCallbackHandler {
    private static final Logger log = LoggerFactory<span class="hljs-selector-class">.getLogger</span>(PaymentCallbackHandler.class);

    public void <span class="hljs-built_in">onPaid</span>(Order order, String paymentNo) {
        <span class="hljs-comment">// 1) CAS æŠ¢å æ‰§è¡Œæƒï¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŠŠ NEW æ”¹æˆ PAYING</span>
        boolean won = <span class="hljs-attribute">order</span><span class="hljs-selector-class">.casStatus</span>(OrderStatus.NEW, OrderStatus.PAYING);
        if (!won) {
            <span class="hljs-comment">// å¹‚ç­‰ç‚¹ï¼šé‡å¤å›è°ƒ/å¹¶å‘å¤„ç†éƒ½ç›´æ¥è¿”å›</span>
            log<span class="hljs-selector-class">.info</span>("ignore duplicate/parallel callback. orderId={}, status={}, paymentNo={}",
                    order.getOrderId(), <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getStatus</span>(), paymentNo);
            return;
        }

        <span class="hljs-comment">// 2) åªæœ‰æŠ¢åˆ°æ‰§è¡Œæƒçš„çº¿ç¨‹èƒ½æ‰§è¡Œå‰¯ä½œç”¨</span>
        try {
            log<span class="hljs-selector-class">.info</span>("won execution. start side effects. orderId={}, paymentNo={}",
                    order.getOrderId(), paymentNo);

            <span class="hljs-built_in">doSideEffectsOnce</span>(order, paymentNo);

            <span class="hljs-comment">// 3) å‰¯ä½œç”¨å®Œæˆåå†æ¨è¿›ç»ˆæ€</span>
            <span class="hljs-attribute">order</span><span class="hljs-selector-class">.casStatus</span>(OrderStatus.PAYING, OrderStatus.PAID);
            log<span class="hljs-selector-class">.info</span>("paid success. orderId={}, finalStatus={}", order.getOrderId(), <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getStatus</span>());

        } catch (Exception e) {
            <span class="hljs-comment">// 4) å¤±è´¥å¤„ç†ï¼šå¯ä»¥å›æ»šä¸º NEW è®©åç»­é‡è¯•ï¼Œæˆ–æ ‡è®°å¤±è´¥æ€</span>
            <span class="hljs-attribute">order</span><span class="hljs-selector-class">.casStatus</span>(OrderStatus.PAYING, OrderStatus.PAY_FAILED);
            log<span class="hljs-selector-class">.warn</span>("paid handling failed. orderId={}, finalStatus={}, err={}",
                    order.getOrderId(), <span class="hljs-attribute">order</span><span class="hljs-selector-class">.getStatus</span>(), e<span class="hljs-selector-class">.toString</span>());

            <span class="hljs-comment">// çº¿ä¸Šé€šå¸¸è¿˜ä¼šï¼šè®°å½•å¤±è´¥åŸå› ã€æŠ¥è­¦ã€äººå·¥è¡¥å¿/é‡è¯•</span>
        }
    }

    private void <span class="hljs-built_in">doSideEffectsOnce</span>(Order order, String paymentNo) {
        <span class="hljs-comment">// ç¤ºä¾‹ï¼šè®°è´¦ã€å‘åˆ¸ã€å‘æ¶ˆæ¯ã€å†™æµæ°´â€¦â€¦</span>
        <span class="hljs-comment">// è¿™é‡Œè¦ç¡®ä¿è¿™äº›åŠ¨ä½œè¦ä¹ˆå¯å¹‚ç­‰ï¼Œè¦ä¹ˆä¿è¯åªåœ¨â€œwonâ€çš„çº¿ç¨‹æ‰§è¡Œ</span>
        <span class="hljs-comment">// ä¾‹å¦‚ï¼šå†™ä¸€æ¡æ”¯ä»˜æµæ°´ï¼ˆå”¯ä¸€é”® orderIdï¼‰ï¼Œé‡å¤å†™ä¼šå¤±è´¥ -&gt; å¹‚ç­‰</span>
        <span class="hljs-comment">// æˆ–è€…è°ƒç”¨ä¸‹æ¸¸æ—¶å¸¦å¹‚ç­‰å· paymentNo / requestId</span>

        <span class="hljs-comment">// æ¨¡æ‹Ÿä¸šåŠ¡</span>
        if (paymentNo.endsWith("<span class="hljs-number">7</span>")) {
            <span class="hljs-comment">// æ¨¡æ‹Ÿå¶å‘å¼‚å¸¸ï¼ŒéªŒè¯â€œPAYING -&gt; PAY_FAILEDâ€ä¸ä¼šå‡ºç° PAID åŠæˆåŠŸ</span>
            throw new <span class="hljs-built_in">RuntimeException</span>("simulate downstream failure");
        }
    }
}
</code></pre>
<h4 data-id="heading-12">è¿™ä¸ªæ–¹æ¡ˆè§£å†³äº†ä»€ä¹ˆï¼Ÿ</h4>
<ul>
<li><strong>åªæ‰§è¡Œä¸€æ¬¡</strong>ï¼šNEWâ†’PAYING çš„ CAS åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æˆåŠŸï¼Œå…¶å®ƒçº¿ç¨‹ç›´æ¥è¿”å›</li>
<li><strong>ä¸è‡ªæ—‹</strong>ï¼šæŠ¢ä¸åˆ°å°±æ˜¯å¹‚ç­‰è¿”å›ï¼Œä¸ä¼šçƒ§ CPU</li>
<li><strong>é˜²åŠæˆåŠŸ</strong>ï¼šçŠ¶æ€åªæœ‰åœ¨å‰¯ä½œç”¨å®Œæˆåæ‰æ¨è¿›åˆ° PAID</li>
<li><strong>å¤±è´¥å¯è§‚æµ‹</strong>ï¼šPAY_FAILED å¯ä»¥ç”¨äºæŠ¥è­¦ã€è¡¥å¿ã€é‡è¯•ç­–ç•¥</li>
</ul>
<hr/>
<h3 data-id="heading-13">5.4 å¹¶å‘æµ‹è¯•ï¼šè¯æ˜åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½â€œæŠ¢åˆ°æ‰§è¡Œæƒâ€</h3>
<pre><code class="hljs language-ini" lang="ini">import java.util.concurrent.CountDownLatch<span class="hljs-comment">;</span>
import java.util.concurrent.ExecutorService<span class="hljs-comment">;</span>
import java.util.concurrent.Executors<span class="hljs-comment">;</span>

public class CasOrderDemo {
    public static void main(String<span class="hljs-section">[]</span> args) throws Exception {
        Order <span class="hljs-attr">order</span> = new Order(<span class="hljs-string">"O20251221"</span>)<span class="hljs-comment">;</span>
        PaymentCallbackHandler <span class="hljs-attr">handler</span> = new PaymentCallbackHandler()<span class="hljs-comment">;</span>

        int <span class="hljs-attr">n</span> = <span class="hljs-number">20</span><span class="hljs-comment">;</span>
        ExecutorService <span class="hljs-attr">pool</span> = Executors.newFixedThreadPool(<span class="hljs-number">8</span>)<span class="hljs-comment">;</span>
        CountDownLatch <span class="hljs-attr">latch</span> = new CountDownLatch(n)<span class="hljs-comment">;</span>

        for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; n; i++) {</span>
            String <span class="hljs-attr">paymentNo</span> = <span class="hljs-string">"P"</span> + i<span class="hljs-comment">;</span>
            pool.submit(() -&gt; {
                try {
                    handler.onPaid(order, paymentNo)<span class="hljs-comment">;</span>
                } finally {
                    latch.countDown()<span class="hljs-comment">;</span>
                }
            })<span class="hljs-comment">;</span>
        }

        latch.await()<span class="hljs-comment">;</span>
        pool.shutdown()<span class="hljs-comment">;</span>

        System.out.println("final status: " + order.getStatus())<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>ä½ ä¼šè§‚å¯Ÿåˆ°ï¼š</p>
<ul>
<li>åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰“å° â€œwon executionâ€</li>
<li>å…¶å®ƒéƒ½æ˜¯ â€œignore duplicate/parallel callbackâ€</li>
<li>å¦‚æœä½ æ•…æ„è®© â€œå‰¯ä½œç”¨â€ æŠ›å¼‚å¸¸ï¼Œæœ€ç»ˆçŠ¶æ€ä¼šè½åœ¨ <code>PAY_FAILED</code> è€Œä¸æ˜¯ <code>PAID</code></li>
</ul>
<hr/>
<h3 data-id="heading-14">6ï¼‰è¡¥ä¸€å¥çœŸå®çº¿ä¸Šï¼šè·¨å®ä¾‹ä¸€è‡´æ€ä¹ˆåŠï¼Ÿ</h3>
<p>ä¸Šé¢ä¾‹å­æ˜¯ JVM å†…å­˜æ€ï¼Œé€‚åˆå•å®ä¾‹å†…æ§åˆ¶æˆ–ä¸­é—´æ€æ§åˆ¶ã€‚<strong>çœŸæ­£è®¢å•æœ€ç»ˆè¦è½åº“</strong>ï¼Œè·¨å®ä¾‹ä¸€è‡´å¸¸ç”¨æ•°æ®åº“ä¹è§‚é”ï¼ˆç‰ˆæœ¬å·ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">UPDATE orders
SET <span class="hljs-attr">status</span>=<span class="hljs-string">'PAYING'</span>, version=version+<span class="hljs-number">1</span>
WHERE <span class="hljs-attr">order_id</span>=? AND status=<span class="hljs-string">'NEW'</span> AND version=?<span class="hljs-comment">;</span>
</code></pre>
<p>å½±å“è¡Œæ•°=1 æ‰ç®—æŠ¢åˆ°æ‰§è¡Œæƒï¼Œ0 è¡¨ç¤ºè¢«åˆ«äººæŠ¢å…ˆå¤„ç†/çŠ¶æ€å·²å˜ï¼Œç›´æ¥å¹‚ç­‰è¿”å›ã€‚<br/>
æœ¬è´¨ä¸Šè¿™å°±æ˜¯å­˜å‚¨å±‚çš„ CASã€‚</p>
<hr/>
<h3 data-id="heading-15">7ï¼‰æ€»ç»“</h3>
<ul>
<li>CAS æ˜¯â€œæ¯”è¾ƒå¹¶äº¤æ¢â€çš„åŸå­æ“ä½œï¼Œæ˜¯æ— é”å¹¶å‘çš„åŸºç¡€</li>
<li>è‡ªæ—‹ CAS é€‚ç”¨äºâ€œå¿…é¡»æœ€ç»ˆæˆåŠŸâ€çš„åœºæ™¯ï¼ˆè®¡æ•°å™¨ã€ç´¯åŠ ï¼‰</li>
<li>å¹‚ç­‰æŠ¢å æ‰§è¡Œæƒé€‚ç”¨äºâ€œåªå…è®¸æ‰§è¡Œä¸€æ¬¡â€çš„å‰¯ä½œç”¨åœºæ™¯ï¼ˆæ”¯ä»˜å›è°ƒã€å‘åˆ¸ã€å‘è´§ï¼‰â€”â€”<strong>ä¸éœ€è¦è‡ªæ—‹</strong></li>
<li>å·¥ç¨‹ä¸Šæ›´ç¨³çš„åšæ³•æ˜¯å¼•å…¥ä¸­é—´æ€ï¼š<code>NEW â†’ PAYING â†’ PAID</code>ï¼Œé¿å…â€œçŠ¶æ€ç»ˆæ€ä½†å‰¯ä½œç”¨åŠæˆåŠŸâ€</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQLç´¢å¼•è®¾è®¡ä¸ä¼˜åŒ–å®æˆ˜]]></title>    <link>https://juejin.cn/post/7585468725333033014</link>    <guid>https://juejin.cn/post/7585468725333033014</guid>    <pubDate>2025-12-21T00:32:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585468725333033014" data-draft-id="7585485074038390790" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQLç´¢å¼•è®¾è®¡ä¸ä¼˜åŒ–å®æˆ˜"/> <meta itemprop="keywords" content="åç«¯,MySQL"/> <meta itemprop="datePublished" content="2025-12-21T00:32:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç„¡é‡"/> <meta itemprop="url" content="https://juejin.cn/user/1116759546145086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQLç´¢å¼•è®¾è®¡ä¸ä¼˜åŒ–å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759546145086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç„¡é‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T00:32:18.000Z" title="Sun Dec 21 2025 00:32:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»38åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>ç´¢å¼•æ˜¯MySQLæ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæ‰‹æ®µï¼Œåˆç†çš„ç´¢å¼•è®¾è®¡èƒ½è®©æŸ¥è¯¢é€Ÿåº¦æå‡æ•°ç™¾å€ï¼Œè€Œé”™è¯¯çš„ç´¢å¼•è®¾è®¡åˆ™ä¼šå¯¼è‡´æ€§èƒ½ç¾éš¾ã€‚æœ¬æ–‡ä»ç´¢å¼•ç±»å‹ã€èšç°‡ç´¢å¼•ä¸éèšç°‡ç´¢å¼•ã€è”åˆç´¢å¼•ä¸æœ€å·¦å‰ç¼€åŸåˆ™ã€è¦†ç›–ç´¢å¼•ä¸ç´¢å¼•ä¸‹æ¨ã€ç´¢å¼•å¤±æ•ˆçš„12ç§åœºæ™¯ã€ç´¢å¼•é€‰æ‹©æ€§è®¡ç®—ç­‰æ ¸å¿ƒçŸ¥è¯†ç‚¹å‡ºå‘ï¼Œæ·±å…¥å‰–æä¸ºä»€ä¹ˆä½åŒºåˆ†åº¦å­—æ®µï¼ˆå¦‚genderã€statusï¼‰ä¸èƒ½å•ç‹¬å»ºç´¢å¼•ï¼Œç»“åˆç”µå•†è®¢å•ç³»ç»Ÿç­‰å®æˆ˜æ¡ˆä¾‹ï¼Œè®²è§£ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µä¸æ…¢æŸ¥è¯¢ä¼˜åŒ–æŠ€å·§ï¼Œå¸®åŠ©è¯»è€…æ„å»ºå®Œæ•´çš„ç´¢å¼•ä¼˜åŒ–çŸ¥è¯†ä½“ç³»ï¼Œåœ¨é¢è¯•å’Œå®é™…å·¥ä½œä¸­æ¸¸åˆƒæœ‰ä½™ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€ç†è®ºçŸ¥è¯†ä¸æ ¸å¿ƒæ¦‚å¿µ</h2>
<h3 data-id="heading-2">1.1 ä»€ä¹ˆæ˜¯ç´¢å¼•?ä¸ºä»€ä¹ˆéœ€è¦ç´¢å¼•?</h3>
<p><strong>ç´¢å¼•(Index)<strong>æ˜¯æ•°æ®åº“è¡¨ä¸­ä¸€åˆ—æˆ–å¤šåˆ—å€¼çš„æ’åºæ•°æ®ç»“æ„,æœ¬è´¨æ˜¯</strong>æ’åº+æŸ¥æ‰¾</strong>ã€‚ç´¢å¼•çš„ä½œç”¨ç±»ä¼¼äºä¹¦ç±çš„ç›®å½•,é€šè¿‡ç›®å½•å¯ä»¥å¿«é€Ÿå®šä½åˆ°å…·ä½“å†…å®¹,æ— éœ€ä»å¤´åˆ°å°¾ç¿»é˜…æ•´æœ¬ä¹¦ã€‚</p>
<p><strong>æ²¡æœ‰ç´¢å¼•çš„æŸ¥è¯¢</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>;
</code></pre>
<p>MySQLéœ€è¦<strong>å…¨è¡¨æ‰«æ</strong>(Full Table Scan),é€è¡Œæ£€æŸ¥nameå­—æ®µæ˜¯å¦ç­‰äº'Alice',å¤æ‚åº¦O(n)ã€‚100ä¸‡è¡Œæ•°æ®,æ‰«æ100ä¸‡æ¬¡ã€‚</p>
<p><strong>æœ‰ç´¢å¼•çš„æŸ¥è¯¢</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- nameå­—æ®µå»ºç«‹B+æ ‘ç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_name (name);

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>;
</code></pre>
<p>MySQLé€šè¿‡<strong>B+æ ‘ç´¢å¼•</strong>å¿«é€Ÿå®šä½,å¤æ‚åº¦O(log n)ã€‚100ä¸‡è¡Œæ•°æ®,3å±‚B+æ ‘,ä»…éœ€<strong>3æ¬¡I/O</strong>å³å¯å®šä½ã€‚</p>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong>:</p>





























<table><thead><tr><th>æ•°æ®é‡</th><th>æ— ç´¢å¼•æ‰«ææ¬¡æ•°</th><th>B+æ ‘ç´¢å¼•I/Oæ¬¡æ•°</th><th>æ€§èƒ½æå‡</th></tr></thead><tbody><tr><td>1ä¸‡è¡Œ</td><td>10,000</td><td>3æ¬¡</td><td>3333å€</td></tr><tr><td>100ä¸‡è¡Œ</td><td>1,000,000</td><td>3æ¬¡</td><td>333,333å€</td></tr><tr><td>1äº¿è¡Œ</td><td>100,000,000</td><td>4æ¬¡</td><td>25,000,000å€</td></tr></tbody></table>
<h3 data-id="heading-3">1.2 ç´¢å¼•çš„ä¼˜ç¼ºç‚¹</h3>
<p><strong>ä¼˜ç‚¹</strong>:</p>
<ul>
<li>âœ… <strong>åŠ å¿«æŸ¥è¯¢é€Ÿåº¦</strong>: WHEREæ¡ä»¶æŸ¥è¯¢ã€JOINè¡¨è¿æ¥ã€ORDER BYæ’åºã€GROUP BYåˆ†ç»„éƒ½èƒ½åˆ©ç”¨ç´¢å¼•</li>
<li>âœ… <strong>å‡å°‘I/Oæ¬¡æ•°</strong>: ç´¢å¼•æŒ‰é¡ºåºå­˜å‚¨,èŒƒå›´æŸ¥è¯¢(å¦‚<code>age &gt; 25</code>)åªéœ€æ‰«æéƒ¨åˆ†ç´¢å¼•</li>
<li>âœ… <strong>é¿å…æ’åº</strong>: ORDER BYç´¢å¼•åˆ—,MySQLç›´æ¥æŒ‰ç´¢å¼•é¡ºåºè¿”å›,æ— éœ€é¢å¤–æ’åº</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>:</p>
<ul>
<li>âŒ <strong>å ç”¨å­˜å‚¨ç©ºé—´</strong>: ç´¢å¼•æœ¬èº«å ç”¨ç£ç›˜ç©ºé—´,å•è¡¨ç´¢å¼•è¿‡å¤š(&gt;5ä¸ª)æµªè´¹ç©ºé—´</li>
<li>âŒ <strong>é™ä½å†™å…¥æ€§èƒ½</strong>: INSERT/UPDATE/DELETEéœ€è¦ç»´æŠ¤ç´¢å¼•,ç´¢å¼•è¶Šå¤š,å†™å…¥è¶Šæ…¢
<ul>
<li>INSERT: éœ€è¦åœ¨ç´¢å¼•B+æ ‘ä¸­æ’å…¥æ–°èŠ‚ç‚¹</li>
<li>UPDATE: è‹¥æ›´æ–°ç´¢å¼•åˆ—,éœ€è¦åˆ é™¤æ—§ç´¢å¼•èŠ‚ç‚¹,æ’å…¥æ–°èŠ‚ç‚¹</li>
<li>DELETE: éœ€è¦åˆ é™¤ç´¢å¼•èŠ‚ç‚¹(å®é™…æ˜¯æ ‡è®°åˆ é™¤)</li>
</ul>
</li>
<li>âŒ <strong>ç»´æŠ¤æˆæœ¬</strong>: ç´¢å¼•ç¢ç‰‡ã€ç´¢å¼•å¤±æ•ˆéœ€è¦å®šæœŸåˆ†æå’Œä¼˜åŒ–</li>
</ul>
<p><strong>æƒè¡¡</strong>: è¯»å¤šå†™å°‘çš„åœºæ™¯(å¦‚è®¢å•æŸ¥è¯¢ã€å•†å“æœç´¢)é€‚åˆå»ºç´¢å¼•;å†™å¤šè¯»å°‘çš„åœºæ™¯(å¦‚æ—¥å¿—å†™å…¥)è°¨æ…å»ºç´¢å¼•ã€‚</p>
<h3 data-id="heading-4">1.3 ä»€ä¹ˆæ—¶å€™å»ºç´¢å¼•?ä»€ä¹ˆæ—¶å€™ä¸å»º?</h3>
<p><strong>âœ… åº”è¯¥å»ºç´¢å¼•çš„å­—æ®µ</strong>:</p>
<ol>
<li><strong>WHEREæ¡ä»¶å­—æ®µ</strong>: <code>WHERE user_id = 100</code>, <code>WHERE status = 1</code></li>
<li><strong>JOINè¿æ¥å­—æ®µ</strong>: <code>JOIN orders ON users.id = orders.user_id</code></li>
<li><strong>ORDER BYæ’åºå­—æ®µ</strong>: <code>ORDER BY create_time DESC</code></li>
<li><strong>GROUP BYåˆ†ç»„å­—æ®µ</strong>: <code>GROUP BY category_id</code></li>
<li><strong>é«˜é€‰æ‹©æ€§å­—æ®µ</strong> (Cardinality / Total Rows &gt; 0.1): ä¸»é”®ã€å”¯ä¸€é”®ã€æ‰‹æœºå·ã€é‚®ç®±</li>
</ol>
<p><strong>âŒ ä¸åº”è¯¥å»ºç´¢å¼•çš„å­—æ®µ</strong>:</p>
<ol>
<li><strong>ä½é€‰æ‹©æ€§å­—æ®µ</strong> (&lt; 5%): genderã€statusã€typeç­‰æšä¸¾å­—æ®µ</li>
<li><strong>é¢‘ç¹æ›´æ–°çš„å­—æ®µ</strong>: æ›´æ–°é¢‘ç¹ä¼šå¯¼è‡´ç´¢å¼•é¢‘ç¹é‡å»º</li>
<li><strong>å¾ˆå°‘ä½¿ç”¨çš„æŸ¥è¯¢å­—æ®µ</strong>: ç´¢å¼•ç»´æŠ¤æˆæœ¬é«˜,æ”¶ç›Šä½</li>
<li><strong>æ•°æ®é‡å°çš„è¡¨</strong> (&lt; 1000è¡Œ): å…¨è¡¨æ‰«ææ›´å¿«</li>
<li><strong>TEXT/BLOBå¤§å­—æ®µ</strong>: ç´¢å¼•å ç”¨ç©ºé—´å¤§,ä¸æ¨è(å¯ä½¿ç”¨å‰ç¼€ç´¢å¼•)</li>
</ol>
<p><strong>æ ¸å¿ƒåŸåˆ™</strong>: <strong>ç´¢å¼•ä¸æ˜¯è¶Šå¤šè¶Šå¥½,è€Œæ˜¯æ°åˆ°å¥½å¤„</strong>ã€‚å•è¡¨ç´¢å¼•å»ºè®®â‰¤5ä¸ª,è”åˆç´¢å¼•å­—æ®µæ•°â‰¤5ä¸ªã€‚</p>
<hr/>
<h2 data-id="heading-5">äºŒã€ç´¢å¼•ç±»å‹è¯¦è§£</h2>
<h3 data-id="heading-6">2.1 æŒ‰æ•°æ®ç»“æ„åˆ†ç±»</h3>
<h4 data-id="heading-7">2.1.1 B+æ ‘ç´¢å¼•(é»˜è®¤)</h4>
<p><strong>InnoDBå’ŒMyISAMé»˜è®¤ä½¿ç”¨B+æ ‘ç´¢å¼•</strong>,ç‰¹ç‚¹:</p>
<ul>
<li>âœ… <strong>æœ‰åºå­˜å‚¨</strong>: æ•°æ®æŒ‰ç´¢å¼•åˆ—é¡ºåºå­˜å‚¨,æ”¯æŒèŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€BETWEEN)</li>
<li>âœ… <strong>èŒƒå›´æŸ¥è¯¢é«˜æ•ˆ</strong>: å¶å­èŠ‚ç‚¹é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥,èŒƒå›´æ‰«æåªéœ€é¡ºåºéå†</li>
<li>âœ… <strong>æ”¯æŒæ’åº</strong>: ORDER BYç´¢å¼•åˆ—æ— éœ€é¢å¤–æ’åº</li>
<li>âœ… <strong>æ ‘é«˜ä½</strong>: 3å±‚B+æ ‘èƒ½å­˜å‚¨çº¦2000ä¸‡è¡Œæ•°æ®,æŸ¥è¯¢åªéœ€3æ¬¡I/O</li>
</ul>
<p>è¯¦è§ä¸Šä¸€ç¯‡ã€ŠMySQLæ¶æ„åŸç†ä¸æ‰§è¡Œæµç¨‹ã€‹ç¬¬3.4èŠ‚B+æ ‘ç´¢å¼•åŸç†ã€‚</p>
<h4 data-id="heading-8">2.1.2 å“ˆå¸Œç´¢å¼•</h4>
<p><strong>Memoryå¼•æ“ä½¿ç”¨å“ˆå¸Œç´¢å¼•</strong>,InnoDBæœ‰è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•(Adaptive Hash Index)ã€‚</p>
<p><strong>ç‰¹ç‚¹</strong>:</p>
<ul>
<li>âœ… <strong>ç­‰å€¼æŸ¥è¯¢æå¿«</strong>: O(1)æ—¶é—´å¤æ‚åº¦,<code>WHERE id = 100</code></li>
<li>âŒ <strong>ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢</strong>: <code>WHERE age &gt; 25</code>æ— æ³•ä½¿ç”¨å“ˆå¸Œç´¢å¼•</li>
<li>âŒ <strong>ä¸æ”¯æŒæ’åº</strong>: <code>ORDER BY age</code>æ— æ³•ä½¿ç”¨å“ˆå¸Œç´¢å¼•</li>
<li>âŒ <strong>ä¸æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢</strong>: <code>WHERE name LIKE 'abc%'</code>æ— æ³•ä½¿ç”¨</li>
</ul>
<p><strong>InnoDBè‡ªé€‚åº”å“ˆå¸Œç´¢å¼•</strong>:</p>
<ul>
<li>InnoDBè‡ªåŠ¨ç›‘æ§B+æ ‘ç´¢å¼•çš„è®¿é—®æ¨¡å¼</li>
<li>å¯¹äºé¢‘ç¹è®¿é—®çš„ç´¢å¼•é¡µ,è‡ªåŠ¨åˆ›å»ºå“ˆå¸Œç´¢å¼•</li>
<li>åŠ é€Ÿç­‰å€¼æŸ¥è¯¢,æ— æ³•æ‰‹åŠ¨é…ç½®</li>
</ul>
<h4 data-id="heading-9">2.1.3 å…¨æ–‡ç´¢å¼•(Full-Text Index)</h4>
<p><strong>ç”¨äºæ–‡æœ¬æœç´¢</strong>,MySQL 5.6+æ”¯æŒInnoDBå…¨æ–‡ç´¢å¼•ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ›å»ºå…¨æ–‡ç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> articles <span class="hljs-keyword">ADD</span> FULLTEXT INDEX ft_content (title, content);

<span class="hljs-comment">-- å…¨æ–‡æœç´¢</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> articles <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span>(title, content) AGAINST(<span class="hljs-string">'MySQL ç´¢å¼•'</span>);
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>:</p>
<ul>
<li>âœ… æ”¯æŒè‡ªç„¶è¯­è¨€æœç´¢ã€å¸ƒå°”æ¨¡å¼æœç´¢</li>
<li>âŒ ä¸­æ–‡åˆ†è¯æ”¯æŒå·®,é€šå¸¸ä½¿ç”¨Elasticsearchæ›¿ä»£</li>
</ul>
<p><strong>ç”Ÿäº§å»ºè®®</strong>: æ–‡æœ¬æœç´¢ä¼˜å…ˆä½¿ç”¨Elasticsearch,æ€§èƒ½å’ŒåŠŸèƒ½è¿œè¶…MySQLå…¨æ–‡ç´¢å¼•ã€‚</p>
<h3 data-id="heading-10">2.2 æŒ‰ç‰©ç†å­˜å‚¨åˆ†ç±»</h3>
<h4 data-id="heading-11">2.2.1 èšç°‡ç´¢å¼•(Clustered Index)</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3505b7f6226841e38fcf31a1ea9096d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766881937&amp;x-signature=5zcXD2uysAMf9i00PEXP76bR3Xs%3D" alt="clustered-vs-secondary-index.svg" loading="lazy"/></p>
<p><strong>èšç°‡ç´¢å¼•å®šä¹‰</strong>: æ•°æ®æŒ‰ä¸»é”®é¡ºåºç‰©ç†å­˜å‚¨,å¶å­èŠ‚ç‚¹åŒ…å«å®Œæ•´æ•°æ®è¡Œã€‚</p>
<p><strong>InnoDBèšç°‡ç´¢å¼•ç‰¹ç‚¹</strong>:</p>
<ul>
<li>âœ… <strong>æ¯ä¸ªè¡¨å¿…æœ‰ä¸€ä¸ªèšç°‡ç´¢å¼•</strong> (ä¸»é”®ç´¢å¼•)</li>
<li>âœ… <strong>å¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´æ•°æ®è¡Œ</strong>: æ— éœ€å›è¡¨,ä¸€æ¬¡æŸ¥è¯¢å³å¯è·å–æ‰€æœ‰æ•°æ®</li>
<li>âœ… <strong>æ•°æ®æŒ‰ä¸»é”®é¡ºåºå­˜å‚¨</strong>: èŒƒå›´æŸ¥è¯¢(å¦‚<code>WHERE id &gt; 100</code>)é«˜æ•ˆ</li>
<li>âŒ <strong>ä¸»é”®ä¸å®œè¿‡å¤§</strong>: æ‰€æœ‰äºŒçº§ç´¢å¼•éƒ½åŒ…å«ä¸»é”®,ä¸»é”®è¿‡å¤§æµªè´¹ç©ºé—´</li>
</ul>
<p><strong>èšç°‡ç´¢å¼•é€‰æ‹©è§„åˆ™</strong>:</p>
<ol>
<li>è‹¥å®šä¹‰äº†ä¸»é”®,ä½¿ç”¨ä¸»é”®ä½œä¸ºèšç°‡ç´¢å¼•</li>
<li>è‹¥æ²¡æœ‰ä¸»é”®,é€‰æ‹©ç¬¬ä¸€ä¸ªéNULLå”¯ä¸€ç´¢å¼•</li>
<li>è‹¥æ²¡æœ‰å”¯ä¸€ç´¢å¼•,InnoDBè‡ªåŠ¨ç”Ÿæˆéšè—çš„row_id(6å­—èŠ‚)ä½œä¸ºèšç°‡ç´¢å¼•</li>
</ol>
<p><strong>ä¸ºä»€ä¹ˆInnoDBä¸»é”®æ¨èè‡ªå¢ID?</strong></p>
<ul>
<li>âœ… <strong>é¡ºåºæ’å…¥</strong>: è‡ªå¢IDæŒ‰é¡ºåºæ’å…¥,B+æ ‘å¶å­èŠ‚ç‚¹é¡ºåºå†™å…¥,æ— éœ€é¡µåˆ†è£‚</li>
<li>âŒ <strong>UUIDéšæœºæ’å…¥</strong>: UUIDæ˜¯éšæœºå€¼,æ’å…¥æ—¶å¯èƒ½å¯¼è‡´é¡µåˆ†è£‚ã€æ•°æ®ç§»åŠ¨,æ€§èƒ½å·®</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âœ… æ¨è: è‡ªå¢ä¸»é”®</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
  id <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
  <span class="hljs-keyword">PRIMARY</span> KEY (id)
);

<span class="hljs-comment">-- âŒ ä¸æ¨è: UUIDä¸»é”®(36å­—èŠ‚,éšæœºæ’å…¥)</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
  id <span class="hljs-type">CHAR</span>(<span class="hljs-number">36</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),
  <span class="hljs-keyword">PRIMARY</span> KEY (id)
);
</code></pre>
<h4 data-id="heading-12">2.2.2 éèšç°‡ç´¢å¼•(Secondary Index / äºŒçº§ç´¢å¼•)</h4>
<p><strong>éèšç°‡ç´¢å¼•å®šä¹‰</strong>: å¶å­èŠ‚ç‚¹ä¸å­˜å‚¨å®Œæ•´æ•°æ®,åªå­˜å‚¨ç´¢å¼•åˆ—å€¼+ä¸»é”®å€¼ã€‚</p>
<p><strong>InnoDBäºŒçº§ç´¢å¼•ç‰¹ç‚¹</strong>:</p>
<ul>
<li>âœ… <strong>å¯ä»¥æœ‰å¤šä¸ªäºŒçº§ç´¢å¼•</strong></li>
<li>âŒ <strong>éœ€è¦å›è¡¨</strong>: å…ˆæŸ¥äºŒçº§ç´¢å¼•è·å–ä¸»é”®,å†æŸ¥ä¸»é”®ç´¢å¼•è·å–å®Œæ•´æ•°æ®</li>
<li>âŒ <strong>å›è¡¨ä»£ä»·é«˜</strong>: è¿”å›å¤§é‡æ•°æ®æ—¶,å›è¡¨æ¬¡æ•°å¤š,æ€§èƒ½å·®</li>
</ul>
<p><strong>å›è¡¨æŸ¥è¯¢ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ageå­—æ®µå»ºç«‹äºŒçº§ç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_age (age);

<span class="hljs-comment">-- æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;
</code></pre>
<p><strong>æ‰§è¡Œæµç¨‹</strong>:</p>
<ol>
<li><strong>æ­¥éª¤1</strong>: åœ¨ageç´¢å¼•(äºŒçº§ç´¢å¼•)ä¸­æŸ¥æ‰¾age=25,æ‰¾åˆ°ä¸»é”®pk=1, pk=5, pk=8 (å‡è®¾3æ¡è®°å½•)</li>
<li><strong>æ­¥éª¤2</strong>: åœ¨ä¸»é”®ç´¢å¼•(èšç°‡ç´¢å¼•)ä¸­åˆ†åˆ«æŸ¥æ‰¾pk=1ã€pk=5ã€pk=8,è·å–å®Œæ•´æ•°æ®</li>
<li><strong>æ€»è®¡</strong>: 4æ¬¡B+æ ‘æŸ¥è¯¢(1æ¬¡äºŒçº§ç´¢å¼• + 3æ¬¡ä¸»é”®ç´¢å¼•å›è¡¨)</li>
</ol>
<p><strong>æ€§èƒ½é—®é¢˜</strong>: è‹¥age=25æœ‰10ä¸‡æ¡è®°å½•,éœ€è¦å›è¡¨10ä¸‡æ¬¡,æ€§èƒ½æå·®!</p>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>: ä½¿ç”¨<strong>è¦†ç›–ç´¢å¼•</strong>,é¿å…å›è¡¨ã€‚</p>
<h4 data-id="heading-13">2.2.3 MyISAMçš„ç´¢å¼•ç»“æ„</h4>
<p><strong>MyISAMæ‰€æœ‰ç´¢å¼•éƒ½æ˜¯éèšç°‡ç´¢å¼•</strong>(åŒ…æ‹¬ä¸»é”®ç´¢å¼•)ã€‚</p>
<p><strong>MyISAM vs InnoDBç´¢å¼•å¯¹æ¯”</strong>:</p>






























<table><thead><tr><th>ç»´åº¦</th><th>InnoDB</th><th>MyISAM</th></tr></thead><tbody><tr><td><strong>ä¸»é”®ç´¢å¼•</strong></td><td>èšç°‡ç´¢å¼•,å¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´æ•°æ®</td><td>éèšç°‡ç´¢å¼•,å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®æ–‡ä»¶æŒ‡é’ˆ</td></tr><tr><td><strong>äºŒçº§ç´¢å¼•</strong></td><td>å¶å­èŠ‚ç‚¹å­˜å‚¨ä¸»é”®å€¼</td><td>å¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®æ–‡ä»¶æŒ‡é’ˆ</td></tr><tr><td><strong>æ•°æ®æ–‡ä»¶</strong></td><td>æ•°æ®å’Œç´¢å¼•åœ¨åŒä¸€ä¸ª.ibdæ–‡ä»¶</td><td>æ•°æ®(.MYD)å’Œç´¢å¼•(.MYI)åˆ†ç¦»</td></tr><tr><td><strong>å›è¡¨æ€§èƒ½</strong></td><td>äºŒçº§ç´¢å¼•å›è¡¨æŸ¥ä¸»é”®ç´¢å¼•</td><td>æ‰€æœ‰ç´¢å¼•ç›´æ¥é€šè¿‡æŒ‡é’ˆè®¿é—®æ•°æ®</td></tr></tbody></table>
<h3 data-id="heading-14">2.3 æŒ‰å­—æ®µæ•°é‡åˆ†ç±»</h3>
<h4 data-id="heading-15">2.3.1 å•åˆ—ç´¢å¼•</h4>
<p><strong>å®šä¹‰</strong>: ä¸€ä¸ªå­—æ®µå»ºç«‹çš„ç´¢å¼•ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_name (name);
</code></pre>
<h4 data-id="heading-16">2.3.2 è”åˆç´¢å¼•(å¤åˆç´¢å¼•)</h4>
<p><strong>å®šä¹‰</strong>: å¤šä¸ªå­—æ®µç»„åˆå»ºç«‹çš„ç´¢å¼•,<strong>éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™</strong>ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_status_time (user_id, status, create_time);
</code></pre>
<p>è¯¦è§ç¬¬ä¸‰ç« ã€Šè”åˆç´¢å¼•ä¸æœ€å·¦å‰ç¼€åŸåˆ™ã€‹ã€‚</p>
<h3 data-id="heading-17">2.4 æŒ‰åŠŸèƒ½åˆ†ç±»</h3>
<h4 data-id="heading-18">2.4.1 ä¸»é”®ç´¢å¼•(Primary Key)</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users (
  id <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  <span class="hljs-keyword">PRIMARY</span> KEY (id)
);
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>:</p>
<ul>
<li>âœ… å”¯ä¸€ä¸”ä¸ä¸ºNULL</li>
<li>âœ… è‡ªåŠ¨åˆ›å»ºèšç°‡ç´¢å¼•(InnoDB)</li>
<li>âœ… æ¯ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®</li>
</ul>
<h4 data-id="heading-19">2.4.2 å”¯ä¸€ç´¢å¼•(Unique Index)</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span> INDEX uk_mobile (mobile);
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>:</p>
<ul>
<li>âœ… å€¼å”¯ä¸€,ä½†å¯ä»¥ä¸ºNULL (å…è®¸å¤šä¸ªNULL)</li>
<li>âœ… å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€ç´¢å¼•</li>
</ul>
<p><strong>âš ï¸ è½¯åˆ é™¤åœºæ™¯é—®é¢˜</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯: è½¯åˆ é™¤åæ— æ³•å†æ’å…¥ç›¸åŒmobile</span>
<span class="hljs-keyword">UNIQUE</span> KEY uk_mobile (mobile)

<span class="hljs-comment">-- ç”¨æˆ·A mobile=13800138000 åˆ é™¤å(is_deleted=1)</span>
<span class="hljs-comment">-- ç”¨æˆ·B æ— æ³•æ³¨å†Œ mobile=13800138000 (å”¯ä¸€ç´¢å¼•å†²çª)</span>

<span class="hljs-comment">-- âœ… æ­£ç¡®: å”¯ä¸€ç´¢å¼•åŒ…å«is_deletedå­—æ®µ</span>
<span class="hljs-keyword">UNIQUE</span> KEY uk_mobile_deleted (mobile, is_deleted)

<span class="hljs-comment">-- å…è®¸å¤šä¸ªç”¨æˆ·ä½¿ç”¨ç›¸åŒmobile (is_deletedä¸åŒ)</span>
</code></pre>
<h4 data-id="heading-20">2.4.3 æ™®é€šç´¢å¼•(Normal Index)</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_age (age);
</code></pre>
<p><strong>ç‰¹ç‚¹</strong>: æ— çº¦æŸ,æœ€å¸¸ç”¨çš„ç´¢å¼•ç±»å‹ã€‚</p>
<h4 data-id="heading-21">2.4.4 å‰ç¼€ç´¢å¼•(Prefix Index)</h4>
<p><strong>ç”¨äºé•¿å­—ç¬¦ä¸²å­—æ®µ</strong>,åªç´¢å¼•å‰Nä¸ªå­—ç¬¦,å‡å°‘ç´¢å¼•å¤§å°ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åªç´¢å¼•emailå‰10ä¸ªå­—ç¬¦</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_email (email(<span class="hljs-number">10</span>));
</code></pre>
<p><strong>å¦‚ä½•é€‰æ‹©å‰ç¼€é•¿åº¦?</strong></p>
<p>è®¡ç®—ä¸åŒå‰ç¼€é•¿åº¦çš„é€‰æ‹©æ€§:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å®Œæ•´å­—æ®µé€‰æ‹©æ€§</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> email) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> users;
<span class="hljs-comment">-- ç»“æœ: 0.95</span>

<span class="hljs-comment">-- å‰ç¼€é•¿åº¦5</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> <span class="hljs-keyword">LEFT</span>(email, <span class="hljs-number">5</span>)) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> users;
<span class="hljs-comment">-- ç»“æœ: 0.75</span>

<span class="hljs-comment">-- å‰ç¼€é•¿åº¦10</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> <span class="hljs-keyword">LEFT</span>(email, <span class="hljs-number">10</span>)) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> users;
<span class="hljs-comment">-- ç»“æœ: 0.92 (æ¥è¿‘å®Œæ•´å­—æ®µé€‰æ‹©æ€§)</span>

<span class="hljs-comment">-- é€‰æ‹©å‰ç¼€é•¿åº¦10</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_email (email(<span class="hljs-number">10</span>));
</code></pre>
<p><strong>âš ï¸ å‰ç¼€ç´¢å¼•çš„é™åˆ¶</strong>:</p>
<ul>
<li>âŒ æ— æ³•ä½¿ç”¨è¦†ç›–ç´¢å¼•</li>
<li>âŒ æ— æ³•ç”¨äºORDER BYã€GROUP BY</li>
</ul>
<hr/>
<h2 data-id="heading-22">ä¸‰ã€è”åˆç´¢å¼•ä¸æœ€å·¦å‰ç¼€åŸåˆ™</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a0d27a2c67f4d38aab83b971aea9374~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766881937&amp;x-signature=Sa8lJjEZc5SU4F840s0SLoGt6gU%3D" alt="composite-index-structure.svg" loading="lazy"/></p>
<h3 data-id="heading-23">3.1 è”åˆç´¢å¼•åŸç†</h3>
<p><strong>è”åˆç´¢å¼•å®šä¹‰</strong>: å¤šä¸ªå­—æ®µç»„åˆå»ºç«‹çš„ç´¢å¼•,MySQLå†…éƒ¨æŒ‰å­—æ®µé¡ºåºæ’åºã€‚</p>
<p><strong>åˆ›å»ºè”åˆç´¢å¼•</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_status_time (user_id, status, create_time);
</code></pre>
<p><strong>ç´¢å¼•å­˜å‚¨ç»“æ„</strong>:</p>
<ul>
<li><strong>å…ˆæŒ‰user_idæ’åº</strong></li>
<li><strong>user_idç›¸åŒ,å†æŒ‰statusæ’åº</strong></li>
<li><strong>statusç›¸åŒ,å†æŒ‰create_timeæ’åº</strong></li>
</ul>
<p>è”åˆç´¢å¼•åœ¨B+æ ‘ä¸­çš„å­˜å‚¨å¦‚å›¾æ‰€ç¤º,æ¯ä¸ªå¶å­èŠ‚ç‚¹å­˜å‚¨(user_id, status, create_time, pk)ã€‚</p>
<h3 data-id="heading-24">3.2 æœ€å·¦å‰ç¼€åŸåˆ™(Left-most Prefix Principle)</h3>
<p><strong>æœ€å·¦å‰ç¼€åŸåˆ™å®šä¹‰</strong>: æŸ¥è¯¢æ¡ä»¶å¿…é¡»<strong>ä»æœ€å·¦è¾¹ç¬¬ä¸€ä¸ªå­—æ®µå¼€å§‹è¿ç»­åŒ¹é…</strong>,é‡åˆ°èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€BETWEENã€LIKE)åœæ­¢åŒ¹é…ã€‚</p>
<p><strong>è§„åˆ™è¯¦è§£</strong>:</p>
<p><strong>è§„åˆ™1</strong>: å¿…é¡»ä»æœ€å·¦è¾¹ç¬¬ä¸€ä¸ªå­—æ®µå¼€å§‹</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç´¢å¼•: idx(a, b, c)</span>

<span class="hljs-comment">-- âœ… ä½¿ç”¨a</span>
<span class="hljs-keyword">WHERE</span> a <span class="hljs-operator">=</span> <span class="hljs-number">1</span>

<span class="hljs-comment">-- âœ… ä½¿ç”¨a, b</span>
<span class="hljs-keyword">WHERE</span> a <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> b <span class="hljs-operator">=</span> <span class="hljs-number">2</span>

<span class="hljs-comment">-- âœ… ä½¿ç”¨a, b, c (å®Œæ•´ç´¢å¼•)</span>
<span class="hljs-keyword">WHERE</span> a <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> b <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">AND</span> c <span class="hljs-operator">=</span> <span class="hljs-number">3</span>

<span class="hljs-comment">-- âŒ è·³è¿‡a,ç´¢å¼•å®Œå…¨å¤±æ•ˆ</span>
<span class="hljs-keyword">WHERE</span> b <span class="hljs-operator">=</span> <span class="hljs-number">2</span>

<span class="hljs-comment">-- âŒ è·³è¿‡b,åªä½¿ç”¨a</span>
<span class="hljs-keyword">WHERE</span> a <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> c <span class="hljs-operator">=</span> <span class="hljs-number">3</span>
</code></pre>
<p><strong>è§„åˆ™2</strong>: é‡åˆ°èŒƒå›´æŸ¥è¯¢åœæ­¢åŒ¹é…</p>
<p><strong>èŒƒå›´æŸ¥è¯¢</strong>: &gt;ã€&lt;ã€&gt;=ã€&lt;=ã€BETWEENã€!=ã€NOT INã€LIKE '%xxx'</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç´¢å¼•: idx(a, b, c)</span>

<span class="hljs-comment">-- âš ï¸ åªä½¿ç”¨a,bã€cç´¢å¼•å¤±æ•ˆ</span>
<span class="hljs-keyword">WHERE</span> a <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> <span class="hljs-keyword">AND</span> b <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">AND</span> c <span class="hljs-operator">=</span> <span class="hljs-number">3</span>

<span class="hljs-comment">-- âš ï¸ ä½¿ç”¨aã€b,cç´¢å¼•å¤±æ•ˆ</span>
<span class="hljs-keyword">WHERE</span> a <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> b <span class="hljs-operator">&gt;</span> <span class="hljs-number">5</span> <span class="hljs-keyword">AND</span> c <span class="hljs-operator">=</span> <span class="hljs-number">3</span>

<span class="hljs-comment">-- âš ï¸ åªä½¿ç”¨a,bã€cç´¢å¼•å¤±æ•ˆ (BETWEENä¹Ÿæ˜¯èŒƒå›´æŸ¥è¯¢)</span>
<span class="hljs-keyword">WHERE</span> a <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">10</span> <span class="hljs-keyword">AND</span> b <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">AND</span> c <span class="hljs-operator">=</span> <span class="hljs-number">3</span>
</code></pre>
<p><strong>è§„åˆ™3</strong>: é¡ºåºæ— å…³,ä¼˜åŒ–å™¨ä¼šè°ƒæ•´</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç´¢å¼•: idx(a, b, c)</span>

<span class="hljs-comment">-- âœ… ä¼˜åŒ–å™¨è°ƒæ•´ä¸º a=1 AND b=2,ä½¿ç”¨aã€b</span>
<span class="hljs-keyword">WHERE</span> b <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">AND</span> a <span class="hljs-operator">=</span> <span class="hljs-number">1</span>

<span class="hljs-comment">-- âœ… ä¼˜åŒ–å™¨è°ƒæ•´,ä½¿ç”¨aã€bã€c</span>
<span class="hljs-keyword">WHERE</span> c <span class="hljs-operator">=</span> <span class="hljs-number">3</span> <span class="hljs-keyword">AND</span> a <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> b <span class="hljs-operator">=</span> <span class="hljs-number">2</span>
</code></pre>
<h3 data-id="heading-25">3.3 èƒ½ç”¨åˆ°ç´¢å¼•çš„SQLç¤ºä¾‹</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç´¢å¼•: idx_user_status_time (user_id, status, create_time)</span>

<span class="hljs-comment">-- âœ… ä½¿ç”¨user_id</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;

<span class="hljs-comment">-- âœ… ä½¿ç”¨user_id, status</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- âœ… ä½¿ç”¨user_id, status, create_time (å®Œæ•´ç´¢å¼•)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>;

<span class="hljs-comment">-- âœ… ä¼˜åŒ–å™¨è°ƒæ•´é¡ºåº,ä½¿ç”¨user_id, status</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;

<span class="hljs-comment">-- âœ… ä½¿ç”¨user_id (èŒƒå›´æŸ¥è¯¢)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">&gt;</span> <span class="hljs-number">100</span>;
</code></pre>
<h3 data-id="heading-26">3.4 ä¸èƒ½ç”¨åˆ°ç´¢å¼•çš„SQLç¤ºä¾‹</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç´¢å¼•: idx_user_status_time (user_id, status, create_time)</span>

<span class="hljs-comment">-- âŒ è·³è¿‡user_id,ç´¢å¼•å®Œå…¨å¤±æ•ˆ,å…¨è¡¨æ‰«æ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- âŒ è·³è¿‡user_idå’Œstatus,ç´¢å¼•å®Œå…¨å¤±æ•ˆ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>;

<span class="hljs-comment">-- âŒ è·³è¿‡user_id,ç´¢å¼•å®Œå…¨å¤±æ•ˆ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>;
</code></pre>
<h3 data-id="heading-27">3.5 éƒ¨åˆ†ä½¿ç”¨ç´¢å¼•çš„SQLç¤ºä¾‹</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç´¢å¼•: idx_user_status_time (user_id, status, create_time)</span>

<span class="hljs-comment">-- âš ï¸ åªä½¿ç”¨user_id,statusç´¢å¼•å¤±æ•ˆ (èŒƒå›´æŸ¥è¯¢æˆªæ–­)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">&gt;</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- âš ï¸ ä½¿ç”¨user_idã€status,create_timeç´¢å¼•å¤±æ•ˆ (èŒƒå›´æŸ¥è¯¢æˆªæ–­)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">=</span> <span class="hljs-string">'2024-01-01'</span>;

<span class="hljs-comment">-- âš ï¸ åªä½¿ç”¨user_id,create_timeç´¢å¼•å¤±æ•ˆ (è·³è¿‡status)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>;
</code></pre>
<h3 data-id="heading-28">3.6 è”åˆç´¢å¼•è®¾è®¡åŸåˆ™</h3>
<p><strong>åŸåˆ™1: åŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾å‰é¢</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- user_idåŒºåˆ†åº¦é«˜(å‡è®¾100ä¸‡ç”¨æˆ·)</span>
<span class="hljs-comment">-- statusåŒºåˆ†åº¦ä½(åªæœ‰5ä¸ªå€¼)</span>

<span class="hljs-comment">-- âœ… æ¨è</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_status (user_id, status);

<span class="hljs-comment">-- âŒ ä¸æ¨è</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_status_user (status, user_id);
</code></pre>
<p><strong>åŸå› </strong>: user_idå…ˆè¿‡æ»¤,å¤§å¹…å‡å°‘æ‰«æè¡Œæ•°;statuså…ˆè¿‡æ»¤,æ‰«æè¡Œæ•°å¤šã€‚</p>
<p><strong>åŸåˆ™2: ç­‰å€¼æŸ¥è¯¢å­—æ®µæ”¾å‰é¢,èŒƒå›´æŸ¥è¯¢å­—æ®µæ”¾åé¢</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- user_idç­‰å€¼æŸ¥è¯¢</span>
<span class="hljs-comment">-- create_timeèŒƒå›´æŸ¥è¯¢</span>

<span class="hljs-comment">-- âœ… æ¨è</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_time (user_id, create_time);

<span class="hljs-comment">-- âŒ ä¸æ¨è</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_time_user (create_time, user_id);
</code></pre>
<p><strong>åŸåˆ™3: ç»å¸¸ä¸€èµ·æŸ¥è¯¢çš„å­—æ®µç»„åˆæˆè”åˆç´¢å¼•</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç»å¸¸æŸ¥è¯¢: WHERE user_id = 100 AND status = 1</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_status (user_id, status);
</code></pre>
<p><strong>åŸåˆ™4: è€ƒè™‘è¦†ç›–ç´¢å¼•,å‡å°‘å›è¡¨</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥è¯¢: SELECT order_no, user_id, status FROM orders WHERE user_id = 100</span>

<span class="hljs-comment">-- âœ… è¦†ç›–ç´¢å¼•,åŒ…å«order_noã€user_idã€statusã€id(ä¸»é”®)</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_status_orderno (user_id, status, order_no);

<span class="hljs-comment">-- EXPLAINæ˜¾ç¤º: Using index (æ— éœ€å›è¡¨)</span>
</code></pre>
<hr/>
<h2 data-id="heading-29">å››ã€è¦†ç›–ç´¢å¼•ä¸ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–</h2>
<h3 data-id="heading-30">4.1 è¦†ç›–ç´¢å¼•(Covering Index)</h3>
<p><strong>è¦†ç›–ç´¢å¼•å®šä¹‰</strong>: æŸ¥è¯¢çš„æ‰€æœ‰å­—æ®µéƒ½åœ¨ç´¢å¼•ä¸­,æ— éœ€å›è¡¨æŸ¥è¯¢ä¸»é”®ç´¢å¼•ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7915bea4ddcb4b118482089c32b7a34d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766881937&amp;x-signature=OpE1uvuO%2F2xyD6Yd0NPoD3doYoQ%3D" alt="covering-index-vs-table-lookup.svg" loading="lazy"/></p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è”åˆç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_name_age (name, age);

<span class="hljs-comment">-- âœ… è¦†ç›–ç´¢å¼•,EXPLAINæ˜¾ç¤ºUsing index</span>
<span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>;

<span class="hljs-comment">-- ç´¢å¼•åŒ…å«: name, age, id(ä¸»é”®è‡ªåŠ¨åŒ…å«åœ¨äºŒçº§ç´¢å¼•ä¸­)</span>
<span class="hljs-comment">-- æŸ¥è¯¢å­—æ®µ: id, name, age</span>
<span class="hljs-comment">-- å®Œå…¨åŒ¹é…,æ— éœ€å›è¡¨</span>
</code></pre>
<p><strong>EXPLAINåˆ†æ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>\G

<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>
           id: <span class="hljs-number">1</span>
  select_type: SIMPLE
        <span class="hljs-keyword">table</span>: users
         type: <span class="hljs-keyword">ref</span>
possible_keys: idx_name_age
          key: idx_name_age
      key_len: <span class="hljs-number">202</span>
          <span class="hljs-keyword">ref</span>: const
         <span class="hljs-keyword">rows</span>: <span class="hljs-number">100</span>
        Extra: <span class="hljs-keyword">Using</span> index   <span class="hljs-operator">&lt;</span><span class="hljs-comment">--- è¦†ç›–ç´¢å¼•æ ‡è¯†</span>
</code></pre>
<p><strong>âŒ éè¦†ç›–ç´¢å¼•,éœ€è¦å›è¡¨</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- addresså­—æ®µä¸åœ¨ç´¢å¼•ä¸­,éœ€è¦å›è¡¨</span>
<span class="hljs-keyword">SELECT</span> id, name, age, address <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>;

<span class="hljs-comment">-- EXPLAINæ˜¾ç¤º: NULL (æ— Using index)</span>
</code></pre>
<p><strong>è¦†ç›–ç´¢å¼•çš„ä¼˜åŠ¿</strong>:</p>
<ul>
<li>âœ… <strong>å‡å°‘å›è¡¨</strong>: åªæŸ¥è¯¢ä¸€æ¬¡äºŒçº§ç´¢å¼•,æ— éœ€æŸ¥è¯¢ä¸»é”®ç´¢å¼•</li>
<li>âœ… <strong>å‡å°‘I/O</strong>: å›è¡¨éœ€è¦éšæœºI/O,è¦†ç›–ç´¢å¼•åªéœ€é¡ºåºI/O</li>
<li>âœ… <strong>æ€§èƒ½æå‡</strong>: å›è¡¨10ä¸‡æ¬¡ vs è¦†ç›–ç´¢å¼•0æ¬¡å›è¡¨,æ€§èƒ½æå‡æ•°åå€</li>
</ul>
<p><strong>è¦†ç›–ç´¢å¼•è®¾è®¡å»ºè®®</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å¸¸è§æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> order_no, user_id, status, total_amount
<span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- âœ… è¦†ç›–ç´¢å¼•è®¾è®¡</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_status_orderno_amount
  (user_id, status, order_no, total_amount);

<span class="hljs-comment">-- ç´¢å¼•åŒ…å«æ‰€æœ‰æŸ¥è¯¢å­—æ®µ,æ— éœ€å›è¡¨</span>
</code></pre>
<h3 data-id="heading-31">4.2 ç´¢å¼•ä¸‹æ¨ä¼˜åŒ–(Index Condition Pushdown, ICP)</h3>
<p><strong>ç´¢å¼•ä¸‹æ¨å®šä¹‰</strong>: MySQL 5.6+ç‰¹æ€§,å°†WHEREæ¡ä»¶ä¸‹æ¨åˆ°å­˜å‚¨å¼•æ“å±‚,å‡å°‘å›è¡¨æ¬¡æ•°ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/911ea935657d479692eca35745485038~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766881937&amp;x-signature=fHkRnTuq7PJfOzli%2Bx53v5Z0hiM%3D" alt="index-condition-pushdown.svg" loading="lazy"/></p>
<p><strong>ç¤ºä¾‹SQL</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è”åˆç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_name_age (name, age);

<span class="hljs-comment">-- æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'Ali%'</span> <span class="hljs-keyword">AND</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;
</code></pre>
<p><strong>æœªå¼€å¯ICPçš„æ‰§è¡Œæµç¨‹</strong>:</p>
<ol>
<li>åœ¨idx_name_ageç´¢å¼•ä¸­æŸ¥æ‰¾name LIKE 'Ali%'çš„æ‰€æœ‰è®°å½•,è·å–ä¸»é”®åˆ—è¡¨(å‡è®¾100æ¡)</li>
<li><strong>å›è¡¨100æ¬¡</strong>,æŸ¥è¯¢ä¸»é”®ç´¢å¼•,è·å–å®Œæ•´æ•°æ®</li>
<li><strong>Serverå±‚</strong>è¿‡æ»¤age = 25,è¿”å›æœ€ç»ˆç»“æœ(å‡è®¾10æ¡)</li>
</ol>
<p><strong>é—®é¢˜</strong>: å›è¡¨100æ¬¡,ä½†åªæœ‰10æ¡ç¬¦åˆæ¡ä»¶,æµªè´¹90æ¬¡å›è¡¨I/Oã€‚</p>
<p><strong>å¼€å¯ICPçš„æ‰§è¡Œæµç¨‹</strong>:</p>
<ol>
<li>åœ¨idx_name_ageç´¢å¼•ä¸­æŸ¥æ‰¾name LIKE 'Ali%'</li>
<li><strong>å­˜å‚¨å¼•æ“å±‚</strong>ç›´æ¥è¿‡æ»¤age = 25,ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„è®°å½•(10æ¡)</li>
<li><strong>åªå›è¡¨10æ¬¡</strong>,æŸ¥è¯¢ä¸»é”®ç´¢å¼•,è·å–å®Œæ•´æ•°æ®</li>
</ol>
<p><strong>æ€§èƒ½æå‡</strong>: å›è¡¨æ¬¡æ•°ä»100æ¬¡é™åˆ°10æ¬¡,å‡å°‘90%çš„éšæœºI/Oã€‚</p>
<p><strong>EXPLAINåˆ†æ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'Ali%'</span> <span class="hljs-keyword">AND</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span>\G

<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>
           id: <span class="hljs-number">1</span>
  select_type: SIMPLE
        <span class="hljs-keyword">table</span>: users
         type: <span class="hljs-keyword">range</span>
possible_keys: idx_name_age
          key: idx_name_age
      key_len: <span class="hljs-number">206</span>
          <span class="hljs-keyword">ref</span>: <span class="hljs-keyword">NULL</span>
         <span class="hljs-keyword">rows</span>: <span class="hljs-number">100</span>
        Extra: <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span>   <span class="hljs-operator">&lt;</span><span class="hljs-comment">--- ç´¢å¼•ä¸‹æ¨æ ‡è¯†</span>
</code></pre>
<p><strong>ç´¢å¼•ä¸‹æ¨é€‚ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>âœ… è”åˆç´¢å¼•</li>
<li>âœ… WHEREæ¡ä»¶ä¸­ç´¢å¼•åˆ—çš„åç»­åˆ—å‚ä¸è¿‡æ»¤</li>
<li>âœ… MySQL 5.6+é»˜è®¤å¼€å¯: <code>optimizer_switch='index_condition_pushdown=on'</code></li>
</ul>
<p><strong>ç´¢å¼•ä¸‹æ¨ vs è¦†ç›–ç´¢å¼•å¯¹æ¯”</strong>:</p>






























<table><thead><tr><th>ç»´åº¦</th><th>è¦†ç›–ç´¢å¼•</th><th>ç´¢å¼•ä¸‹æ¨</th></tr></thead><tbody><tr><td><strong>å›è¡¨æ¬¡æ•°</strong></td><td>0æ¬¡(æ— éœ€å›è¡¨)</td><td>å‡å°‘å›è¡¨æ¬¡æ•°</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>æŸ¥è¯¢å­—æ®µéƒ½åœ¨ç´¢å¼•ä¸­</td><td>æŸ¥è¯¢å­—æ®µä¸å…¨åœ¨ç´¢å¼•ä¸­</td></tr><tr><td><strong>EXPLAINæ ‡è¯†</strong></td><td>Using index</td><td>Using index condition</td></tr><tr><td><strong>æ€§èƒ½æå‡</strong></td><td>æœ€ä¼˜(æ— å›è¡¨)</td><td>æ¬¡ä¼˜(å‡å°‘å›è¡¨)</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-32">äº”ã€ç´¢å¼•å¤±æ•ˆçš„12ç§åœºæ™¯åˆ†æ</h2>
<p>ç´¢å¼•å¤±æ•ˆæ˜¯æ…¢æŸ¥è¯¢çš„ä¸»è¦åŸå› ,ä»¥ä¸‹12ç§åœºæ™¯ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆ,æ¯ä¸ªåœºæ™¯éƒ½é…EXPLAINåˆ†æã€‚</p>
<h3 data-id="heading-33">5.1 åœºæ™¯1: è¿åæœ€å·¦å‰ç¼€åŸåˆ™</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç´¢å¼•: idx_user_status_time (user_id, status, create_time)</span>

<span class="hljs-comment">-- âŒ è·³è¿‡user_id,ç´¢å¼•å¤±æ•ˆ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>EXPLAINåˆ†æ</strong>:</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">type:</span> ALL   (å…¨è¡¨æ‰«æ)
<span class="hljs-symbol">key:</span> NULL   (æœªä½¿ç”¨ç´¢å¼•)
<span class="hljs-symbol">rows:</span> <span class="hljs-number">1000000</span>
<span class="hljs-symbol">Extra:</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span>
</code></pre>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>: ä½¿ç”¨å®Œæ•´ç´¢å¼•æˆ–è°ƒæ•´ç´¢å¼•é¡ºåºã€‚</p>
<h3 data-id="heading-34">5.2 åœºæ™¯2: åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ ç´¢å¼•å¤±æ•ˆ: YEAR()å‡½æ•°</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(create_time) <span class="hljs-operator">=</span> <span class="hljs-number">2024</span>;
</code></pre>
<p><strong>åŸå› </strong>: ç´¢å¼•å­˜å‚¨çš„æ˜¯create_timeåŸå§‹å€¼,ç»è¿‡YEAR()å‡½æ•°è½¬æ¢å,æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚</p>
<p><strong>EXPLAINåˆ†æ</strong>:</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">type:</span> ALL
<span class="hljs-symbol">key:</span> NULL
<span class="hljs-symbol">rows:</span> <span class="hljs-number">1000000</span>
<span class="hljs-symbol">Extra:</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span>
</code></pre>
<p><strong>âœ… ä¼˜åŒ–æ–¹æ¡ˆ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ”¹ä¸ºèŒƒå›´æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2024-01-01'</span>
  <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2025-01-01'</span>;
</code></pre>
<p><strong>å…¶ä»–å¸¸è§å‡½æ•°å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ DATE_FORMAT</span>
<span class="hljs-keyword">WHERE</span> DATE_FORMAT(create_time, <span class="hljs-string">'%Y-%m'</span>) <span class="hljs-operator">=</span> <span class="hljs-string">'2024-01'</span>

<span class="hljs-comment">-- âœ… æ”¹ä¸ºèŒƒå›´æŸ¥è¯¢</span>
<span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2024-01-01'</span> <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&lt;</span> <span class="hljs-string">'2024-02-01'</span>

<span class="hljs-comment">-- âŒ SUBSTRING</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">SUBSTRING</span>(mobile, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>) <span class="hljs-operator">=</span> <span class="hljs-string">'138'</span>

<span class="hljs-comment">-- âœ… æ”¹ä¸ºLIKE</span>
<span class="hljs-keyword">WHERE</span> mobile <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'138%'</span>
</code></pre>
<h3 data-id="heading-35">5.3 åœºæ™¯3: éšå¼ç±»å‹è½¬æ¢</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- mobileæ˜¯VARCHARç±»å‹</span>
<span class="hljs-comment">-- âŒ éšå¼ç±»å‹è½¬æ¢,ç´¢å¼•å¤±æ•ˆ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> mobile <span class="hljs-operator">=</span> <span class="hljs-number">13800138000</span>;
</code></pre>
<p><strong>åŸå› </strong>: MySQLä¼šå°†mobileå­—æ®µè½¬æ¢ä¸ºæ•°å­—ç±»å‹,ç›¸å½“äº<code>CAST(mobile AS UNSIGNED) = 13800138000</code>,å‡½æ•°å¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</p>
<p><strong>EXPLAINåˆ†æ</strong>:</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">type:</span> ALL
<span class="hljs-symbol">key:</span> NULL
<span class="hljs-symbol">rows:</span> <span class="hljs-number">1000000</span>
<span class="hljs-symbol">Extra:</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span>
</code></pre>
<p><strong>âœ… ä¼˜åŒ–æ–¹æ¡ˆ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä½¿ç”¨æ­£ç¡®çš„ç±»å‹</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> mobile <span class="hljs-operator">=</span> <span class="hljs-string">'13800138000'</span>;
</code></pre>
<p><strong>å…¶ä»–éšå¼è½¬æ¢åœºæ™¯</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ å­—ç¬¦ä¸²ä¸æ•°å­—æ¯”è¾ƒ</span>
<span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-number">123</span>   (nameæ˜¯<span class="hljs-type">VARCHAR</span>)

<span class="hljs-comment">-- âŒ æ•´æ•°ä¸å­—ç¬¦ä¸²æ¯”è¾ƒ</span>
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-string">'100'</span>   (idæ˜¯<span class="hljs-type">BIGINT</span>,ä¸å½±å“,MySQLä¼šè½¬æ¢å­—ç¬¦ä¸²)

<span class="hljs-comment">-- âœ… è§„åˆ™: å­—æ®µç±»å‹ä¸æŸ¥è¯¢å€¼ç±»å‹ä¿æŒä¸€è‡´</span>
</code></pre>
<h3 data-id="heading-36">5.4 åœºæ™¯4: ä½¿ç”¨!=ã€&lt;&gt;</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ ç´¢å¼•å¤±æ•ˆ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">!=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- âŒ ç´¢å¼•å¤±æ•ˆ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>åŸå› </strong>: !=ã€&lt;&gt;éœ€è¦æ‰«æå¤§é‡æ•°æ®,ä¼˜åŒ–å™¨è®¤ä¸ºå…¨è¡¨æ‰«ææ›´å¿«ã€‚</p>
<p><strong>EXPLAINåˆ†æ</strong>:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">type:</span> <span class="hljs-string">ALL</span>
<span class="hljs-attr">key:</span> <span class="hljs-literal">NULL</span>
<span class="hljs-attr">rows:</span> <span class="hljs-number">1000000</span>
</code></pre>
<p><strong>âœ… ä¼˜åŒ–æ–¹æ¡ˆ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æ”¹ä¸ºINæˆ–UNION</span>
<span class="hljs-comment">-- å‡è®¾statusåªæœ‰0,1,2ä¸‰ä¸ªå€¼</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> status <span class="hljs-keyword">IN</span> (<span class="hljs-number">0</span>, <span class="hljs-number">2</span>);
</code></pre>
<h3 data-id="heading-37">5.5 åœºæ™¯5: IS NULLã€IS NOT NULL</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âš ï¸ å¯èƒ½å¤±æ•ˆ(å–å†³äºNULLæ¯”ä¾‹)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> email <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;

<span class="hljs-comment">-- âš ï¸ å¯èƒ½å¤±æ•ˆ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> email <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>;
</code></pre>
<p><strong>åŸå› </strong>:</p>
<ul>
<li>è‹¥NULLå€¼æ¯”ä¾‹ &gt; 30%,<code>IS NOT NULL</code>å¯èƒ½èµ°ç´¢å¼•</li>
<li>è‹¥NULLå€¼æ¯”ä¾‹ &lt; 30%,<code>IS NULL</code>å¯èƒ½èµ°ç´¢å¼•</li>
<li>å–å†³äºä¼˜åŒ–å™¨çš„æˆæœ¬ä¼°ç®—</li>
</ul>
<p><strong>å»ºè®®</strong>:</p>
<ul>
<li>âœ… å­—æ®µè®¾è®¡æ—¶å°½é‡NOT NULL,ç»™é»˜è®¤å€¼</li>
<li>âœ… é¿å…ä½¿ç”¨NULLåˆ¤æ–­ä½œä¸ºæŸ¥è¯¢æ¡ä»¶</li>
</ul>
<h3 data-id="heading-38">5.6 åœºæ™¯6: LIKEä»¥%å¼€å¤´</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ ç´¢å¼•å¤±æ•ˆ: %åœ¨å‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%Alice'</span>;

<span class="hljs-comment">-- âŒ ç´¢å¼•å¤±æ•ˆ: %åœ¨ä¸¤è¾¹</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%Alice%'</span>;

<span class="hljs-comment">-- âœ… ç´¢å¼•ç”Ÿæ•ˆ: %åœ¨å</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'Alice%'</span>;
</code></pre>
<p><strong>åŸå› </strong>: B+æ ‘ç´¢å¼•æŒ‰å­—æ®µä»å·¦åˆ°å³æ’åº,%åœ¨å‰æ— æ³•åˆ©ç”¨ç´¢å¼•çš„æœ‰åºæ€§ã€‚</p>
<p><strong>âœ… ä¼˜åŒ–æ–¹æ¡ˆ</strong>:</p>
<ul>
<li>ä¸šåŠ¡å…è®¸,ä½¿ç”¨<code>LIKE 'xxx%'</code></li>
<li>å…¨æ–‡æœç´¢ä½¿ç”¨Elasticsearch</li>
</ul>
<h3 data-id="heading-39">5.7 åœºæ™¯7: ORè¿æ¥,ORä¸¤è¾¹å­—æ®µæ²¡æœ‰éƒ½å»ºç´¢å¼•</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç´¢å¼•: idx_name</span>

<span class="hljs-comment">-- âŒ ç´¢å¼•å¤±æ•ˆ (ageæ— ç´¢å¼•)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span> <span class="hljs-keyword">OR</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;
</code></pre>
<p><strong>åŸå› </strong>: nameæœ‰ç´¢å¼•,ä½†ageæ— ç´¢å¼•,MySQLæ— æ³•åŒæ—¶ä½¿ç”¨ä¸¤ä¸ªç´¢å¼•,é€‰æ‹©å…¨è¡¨æ‰«æã€‚</p>
<p><strong>âœ… ä¼˜åŒ–æ–¹æ¡ˆ1</strong>: ORä¸¤è¾¹å­—æ®µéƒ½å»ºç´¢å¼•</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_name (name);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_age (age);

<span class="hljs-comment">-- ä¼˜åŒ–å™¨å¯èƒ½ä½¿ç”¨index_merge</span>
</code></pre>
<p><strong>âœ… ä¼˜åŒ–æ–¹æ¡ˆ2</strong>: æ”¹ä¸ºUNION</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;
</code></pre>
<h3 data-id="heading-40">5.8 åœºæ™¯8: INèŒƒå›´è¿‡å¤§</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âš ï¸ INå€¼å¤ªå¤š,ä¼˜åŒ–å™¨å¯èƒ½é€‰æ‹©å…¨è¡¨æ‰«æ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,...,<span class="hljs-number">10000</span>);
</code></pre>
<p><strong>åŸå› </strong>: INå€¼è¿‡å¤š(&gt;1000),ä¼˜åŒ–å™¨è®¤ä¸ºå…¨è¡¨æ‰«ææ›´å¿«ã€‚</p>
<p><strong>å»ºè®®</strong>: INåˆ—è¡¨æ§åˆ¶åœ¨500ä»¥å†…ã€‚</p>
<h3 data-id="heading-41">5.9 åœºæ™¯9: è”åˆç´¢å¼•èŒƒå›´æŸ¥è¯¢åçš„å­—æ®µ</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç´¢å¼•: idx(a, b, c)</span>

<span class="hljs-comment">-- âš ï¸ bã€cç´¢å¼•å¤±æ•ˆ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t <span class="hljs-keyword">WHERE</span> a <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> <span class="hljs-keyword">AND</span> b <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> c <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
</code></pre>
<p>è¯¦è§ç¬¬ä¸‰ç« æœ€å·¦å‰ç¼€åŸåˆ™ã€‚</p>
<h3 data-id="heading-42">5.10 åœºæ™¯10: å­—ç¬¦é›†ä¸ä¸€è‡´</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- t1.name: utf8mb4</span>
<span class="hljs-comment">-- t2.name: utf8</span>

<span class="hljs-comment">-- âŒ JOINæ—¶ç´¢å¼•å¯èƒ½å¤±æ•ˆ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t1 <span class="hljs-keyword">JOIN</span> t2 <span class="hljs-keyword">ON</span> t1.name <span class="hljs-operator">=</span> t2.name;
</code></pre>
<p><strong>åŸå› </strong>: å­—ç¬¦é›†ä¸ä¸€è‡´,MySQLéœ€è¦è½¬æ¢å­—ç¬¦é›†,ç›¸å½“äºå‡½æ•°æ“ä½œã€‚</p>
<p><strong>âœ… ä¼˜åŒ–æ–¹æ¡ˆ</strong>: ç»Ÿä¸€å­—ç¬¦é›†ä¸ºutf8mb4ã€‚</p>
<h3 data-id="heading-43">5.11 åœºæ™¯11: MySQLä¼˜åŒ–å™¨è®¤ä¸ºå…¨è¡¨æ‰«ææ›´å¿«</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è¡¨åªæœ‰100è¡Œæ•°æ®</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> small_table <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>åŸå› </strong>: æ•°æ®é‡å¤ªå°,å…¨è¡¨æ‰«ææ¯”ç´¢å¼•æŸ¥è¯¢æ›´å¿«(ç´¢å¼•æŸ¥è¯¢éœ€è¦é¢å¤–çš„ç´¢å¼•æ‰«æå¼€é”€)ã€‚</p>
<p><strong>å»ºè®®</strong>: å°è¡¨(&lt;1000è¡Œ)æ— éœ€å»ºç´¢å¼•ã€‚</p>
<h3 data-id="heading-44">5.12 åœºæ™¯12: SELECT * å¯¼è‡´æ— æ³•ä½¿ç”¨è¦†ç›–ç´¢å¼•</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç´¢å¼•: idx_name_age (name, age)</span>

<span class="hljs-comment">-- âŒ éœ€è¦å›è¡¨ (addressä¸åœ¨ç´¢å¼•ä¸­)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>;

<span class="hljs-comment">-- âœ… è¦†ç›–ç´¢å¼•,æ— éœ€å›è¡¨</span>
<span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>;
</code></pre>
<p><strong>å»ºè®®</strong>: é¿å…SELECT *,åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µã€‚</p>
<hr/>
<h2 data-id="heading-45">å…­ã€ç´¢å¼•åŒºåˆ†åº¦ä¸é€‰æ‹©æ€§è®¡ç®—(é‡è¦!)</h2>
<h3 data-id="heading-46">6.1 ä»€ä¹ˆæ˜¯ç´¢å¼•é€‰æ‹©æ€§?</h3>
<p><strong>ç´¢å¼•é€‰æ‹©æ€§(Selectivity)å®šä¹‰</strong>: ç´¢å¼•åˆ—ä¸é‡å¤å€¼çš„æ•°é‡(åŸºæ•°Cardinality)ä¸è¡¨æ€»è¡Œæ•°çš„æ¯”å€¼ã€‚</p>
<p><strong>å…¬å¼</strong>:</p>
<pre><code class="hljs language-scss" lang="scss">é€‰æ‹©æ€§ = åŸºæ•°(Cardinality) / æ€»è¡Œæ•°(Total Rows)
</code></pre>
<p><strong>è®¡ç®—æ–¹æ³•</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è®¡ç®—å­—æ®µçš„é€‰æ‹©æ€§</span>
<span class="hljs-keyword">SELECT</span>
  <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> column_name) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> selectivity
<span class="hljs-keyword">FROM</span> table_name;
</code></pre>
<h3 data-id="heading-47">6.2 é€‰æ‹©æ€§é˜ˆå€¼ä¸å»ºè®®</h3>
<p><strong>ç»éªŒé˜ˆå€¼</strong>:</p>
<ul>
<li><strong>é€‰æ‹©æ€§ &gt; 0.9</strong> (90%): âœ… å¼ºçƒˆæ¨èå»ºç´¢å¼• (å¦‚ä¸»é”®ã€å”¯ä¸€é”®ã€æ‰‹æœºå·ã€é‚®ç®±)</li>
<li><strong>é€‰æ‹©æ€§ 0.5 - 0.9</strong> (50-90%): âœ… æ¨èå»ºç´¢å¼• (å¦‚ç”¨æˆ·åã€è®¢å•å·)</li>
<li><strong>é€‰æ‹©æ€§ 0.1 - 0.5</strong> (10-50%): âš ï¸ è°¨æ…è€ƒè™‘,ç»“åˆæ•°æ®é‡å’ŒæŸ¥è¯¢é¢‘ç‡</li>
<li><strong>é€‰æ‹©æ€§ &lt; 0.1</strong> (10%): âŒ ä¸æ¨èå»ºç´¢å¼•</li>
<li><strong>é€‰æ‹©æ€§ &lt; 0.05</strong> (5%): âŒ ç¦æ­¢å•ç‹¬å»ºç´¢å¼•</li>
</ul>
<h3 data-id="heading-48">6.3 æ¡ˆä¾‹åˆ†æ: è®¢å•è¡¨å­—æ®µé€‰æ‹©æ€§è®¡ç®—</h3>
<p><strong>è®¢å•è¡¨orders</strong>, 100ä¸‡æ¡æ•°æ®:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- user_idé€‰æ‹©æ€§ (å‡è®¾10ä¸‡ç”¨æˆ·)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> orders;
<span class="hljs-comment">-- ç»“æœ: 100000 / 1000000 = 0.1 (10%)</span>
<span class="hljs-comment">-- ç»“è®º: âœ… å¯ä»¥å»ºç´¢å¼•</span>

<span class="hljs-comment">-- order_noé€‰æ‹©æ€§ (è®¢å•å·å”¯ä¸€)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> order_no) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> orders;
<span class="hljs-comment">-- ç»“æœ: 1000000 / 1000000 = 1.0 (100%)</span>
<span class="hljs-comment">-- ç»“è®º: âœ… å¼ºçƒˆæ¨èå»ºç´¢å¼• (å®é™…é€šå¸¸å»ºå”¯ä¸€ç´¢å¼•)</span>

<span class="hljs-comment">-- statusé€‰æ‹©æ€§ (åªæœ‰5ä¸ªçŠ¶æ€: 0å¾…æ”¯ä»˜ã€1å·²æ”¯ä»˜ã€2å·²å‘è´§ã€3å·²å®Œæˆã€4å·²å–æ¶ˆ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> status) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> orders;
<span class="hljs-comment">-- ç»“æœ: 5 / 1000000 = 0.000005 (0.0005%)</span>
<span class="hljs-comment">-- ç»“è®º: âŒ ç¦æ­¢å•ç‹¬å»ºç´¢å¼•</span>

<span class="hljs-comment">-- create_timeé€‰æ‹©æ€§ (æ—¶é—´ç²¾ç¡®åˆ°ç§’,é‡å¤ç‡ä½)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> create_time) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> orders;
<span class="hljs-comment">-- ç»“æœ: å‡è®¾ 800000 / 1000000 = 0.8 (80%)</span>
<span class="hljs-comment">-- ç»“è®º: âœ… å¯ä»¥å»ºç´¢å¼•</span>
</code></pre>
<h3 data-id="heading-49">6.4 ä¸ºä»€ä¹ˆä½åŒºåˆ†åº¦å­—æ®µä¸èƒ½å•ç‹¬å»ºç´¢å¼•?</h3>
<p><strong>æ ¸å¿ƒåŸå› åˆ†æ</strong>:</p>
<h4 data-id="heading-50">åŸå› 1: æ‰«æè¡Œæ•°å¤š,ä¼˜åŒ–å™¨é€‰æ‹©å…¨è¡¨æ‰«æ</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- statusåªæœ‰5ä¸ªå€¼,100ä¸‡æ•°æ®</span>
<span class="hljs-comment">-- æ¯ä¸ªstatuså¯¹åº”çº¦20ä¸‡è¡Œ</span>

<span class="hljs-comment">-- æŸ¥è¯¢status=1çš„è®¢å•</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>æˆæœ¬åˆ†æ</strong>:</p>
<ul>
<li><strong>ç´¢å¼•æ‰«æ</strong>: æ‰«æidx_statusç´¢å¼•,æ‰¾åˆ°20ä¸‡ä¸ªä¸»é”®,å›è¡¨20ä¸‡æ¬¡</li>
<li><strong>å…¨è¡¨æ‰«æ</strong>: é¡ºåºæ‰«æ100ä¸‡è¡Œ,è¿‡æ»¤å‡º20ä¸‡è¡Œ</li>
</ul>
<p><strong>ä¼˜åŒ–å™¨é€‰æ‹©</strong>: <strong>å…¨è¡¨æ‰«ææ›´å¿«</strong> (é¡ºåºI/O &gt; éšæœºI/O)</p>
<h4 data-id="heading-51">åŸå› 2: å›è¡¨ä»£ä»·é«˜</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- status=1è¿”å›20ä¸‡è¡Œæ•°æ®</span>
<span class="hljs-comment">-- äºŒçº§ç´¢å¼•å›è¡¨éœ€è¦20ä¸‡æ¬¡éšæœºI/O</span>
<span class="hljs-comment">-- å…¨è¡¨æ‰«æåªéœ€é¡ºåºI/O</span>

<span class="hljs-comment">-- ä¼˜åŒ–å™¨æˆæœ¬ä¼°ç®—:</span>
<span class="hljs-comment">-- ç´¢å¼•æ‰«ææˆæœ¬ = 20ä¸‡æ¬¡éšæœºI/O</span>
<span class="hljs-comment">-- å…¨è¡¨æ‰«ææˆæœ¬ = é¡ºåºæ‰«æ100ä¸‡è¡Œ</span>

<span class="hljs-comment">-- éšæœºI/Oæˆæœ¬ &gt;&gt; é¡ºåºI/Oæˆæœ¬</span>
<span class="hljs-comment">-- ä¼˜åŒ–å™¨é€‰æ‹©å…¨è¡¨æ‰«æ</span>
</code></pre>
<h4 data-id="heading-52">åŸå› 3: ç´¢å¼•ç»´æŠ¤æˆæœ¬é«˜,æ”¶ç›Šä½</h4>
<ul>
<li>æ¯æ¬¡INSERT/UPDATE/DELETEéƒ½è¦ç»´æŠ¤ç´¢å¼•</li>
<li>statusç´¢å¼•åŒºåˆ†åº¦ä½,æŸ¥è¯¢ä¼˜åŒ–æ•ˆæœå·®</li>
<li><strong>é«˜ç»´æŠ¤æˆæœ¬ + ä½æŸ¥è¯¢æ”¶ç›Š = ä¸å€¼å¾—å»ºç´¢å¼•</strong></li>
</ul>
<h3 data-id="heading-53">6.5 ä¸ºä»€ä¹ˆstatus/gender/typeç­‰æšä¸¾å­—æ®µä¸èƒ½å•ç‹¬å»ºç´¢å¼•?</h3>
<p><strong>å…¸å‹ä½åŒºåˆ†åº¦å­—æ®µ</strong>:</p>









































<table><thead><tr><th>å­—æ®µ</th><th>å€¼çš„æ•°é‡</th><th>é€‰æ‹©æ€§</th><th>æ˜¯å¦å»ºç´¢å¼•</th></tr></thead><tbody><tr><td>gender</td><td>3ä¸ª (male/female/other)</td><td>0.3%</td><td>âŒ ç¦æ­¢</td></tr><tr><td>status</td><td>5-7ä¸ª</td><td>0.05-0.07%</td><td>âŒ ç¦æ­¢</td></tr><tr><td>user_type</td><td>3-5ä¸ª (normal/vip/svip)</td><td>0.03-0.05%</td><td>âŒ ç¦æ­¢</td></tr><tr><td>member_level</td><td>5ä¸ª (L1-L5)</td><td>0.05%</td><td>âŒ ç¦æ­¢</td></tr><tr><td>audit_status</td><td>3ä¸ª (pending/pass/reject)</td><td>0.03%</td><td>âŒ ç¦æ­¢</td></tr></tbody></table>
<p><strong>é—®é¢˜åˆ†æ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å‡è®¾usersè¡¨100ä¸‡ç”¨æˆ·</span>
<span class="hljs-comment">-- gender: male(50ä¸‡), female(49ä¸‡), other(1ä¸‡)</span>

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> gender <span class="hljs-operator">=</span> <span class="hljs-string">'male'</span>;
</code></pre>
<p><strong>æ‰§è¡Œè®¡åˆ’</strong>:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">type:</span> <span class="hljs-string">ALL</span>   <span class="hljs-string">(å…¨è¡¨æ‰«æ)</span>
<span class="hljs-attr">key:</span> <span class="hljs-literal">NULL</span>   <span class="hljs-string">(æœªä½¿ç”¨idx_genderç´¢å¼•)</span>
<span class="hljs-attr">rows:</span> <span class="hljs-number">1000000</span>
</code></pre>
<p><strong>åŸå› </strong>: æ‰«æ50ä¸‡è¡Œ,ä¼˜åŒ–å™¨è®¤ä¸ºå…¨è¡¨æ‰«ææ›´å¿«,ç´¢å¼•å¤±æ•ˆã€‚</p>
<h3 data-id="heading-54">6.6 å¤åˆç´¢å¼•ç­–ç•¥: é«˜åŒºåˆ†åº¦ + ä½åŒºåˆ†åº¦</h3>
<p><strong>âœ… æ­£ç¡®åšæ³•</strong>: å°†ä½åŒºåˆ†åº¦å­—æ®µæ”¾åœ¨è”åˆç´¢å¼•çš„åé¢,é«˜åŒºåˆ†åº¦å­—æ®µåœ¨å‰ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯: å•ç‹¬å»ºstatusç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_status (status);

<span class="hljs-comment">-- âœ… æ­£ç¡®: è”åˆç´¢å¼•,user_idé«˜åŒºåˆ†åº¦åœ¨å‰,statusä½åŒºåˆ†åº¦åœ¨å</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_status (user_id, status);
</code></pre>
<p><strong>æŸ¥è¯¢ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- æ‰§è¡Œè®¡åˆ’:</span>
<span class="hljs-comment">-- type: ref (ä½¿ç”¨ç´¢å¼•)</span>
<span class="hljs-comment">-- key: idx_user_status</span>
<span class="hljs-comment">-- rows: 10 (user_id=100çš„è®¢å•çº¦100æ¡,status=1è¿‡æ»¤åçº¦10æ¡)</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·æœ‰æ•ˆ?</strong></p>
<ol>
<li><strong>user_idå…ˆè¿‡æ»¤</strong>: 100ä¸‡è®¢å• â†’ 100æ¡ (ç”¨æˆ·100çš„è®¢å•)</li>
<li><strong>statuså†è¿‡æ»¤</strong>: 100æ¡ â†’ 10æ¡ (status=1)</li>
<li><strong>æ‰«æè¡Œæ•°å°‘</strong>: åªæ‰«æ100æ¡,è€Œä¸æ˜¯20ä¸‡æ¡</li>
</ol>
<h3 data-id="heading-55">6.7 å®Œæ•´æ¡ˆä¾‹: ä½åŒºåˆ†åº¦å­—æ®µç´¢å¼•è®¾è®¡</h3>
<p><strong>åœºæ™¯</strong>: è®¢å•è¡¨,æŸ¥è¯¢æŸç”¨æˆ·çš„æŸçŠ¶æ€è®¢å•ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ–¹æ¡ˆ1: å•ç‹¬å»ºstatusç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_status (status);

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- é—®é¢˜:</span>
<span class="hljs-comment">-- 1. idx_statusç´¢å¼•å¤±æ•ˆ(WHEREæ¡ä»¶æ²¡æœ‰statuså•ç‹¬æŸ¥è¯¢)</span>
<span class="hljs-comment">-- 2. å…¨è¡¨æ‰«æ,æ€§èƒ½å·®</span>

<span class="hljs-comment">-- âœ… æ–¹æ¡ˆ2: è”åˆç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_status (user_id, status);

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- æ‰§è¡Œè®¡åˆ’:</span>
<span class="hljs-comment">-- type: ref</span>
<span class="hljs-comment">-- key: idx_user_status</span>
<span class="hljs-comment">-- rows: 10</span>
<span class="hljs-comment">-- æ€§èƒ½ä¼˜å¼‚</span>
</code></pre>
<p><strong>EXPLAINå¯¹æ¯”</strong>:</p>

































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>type</th><th>key</th><th>rows</th><th>æ€§èƒ½</th></tr></thead><tbody><tr><td>æ— ç´¢å¼•</td><td>ALL</td><td>NULL</td><td>1000000</td><td>æå·®</td></tr><tr><td>idx_statuså•ç‹¬ç´¢å¼•</td><td>ALL</td><td>NULL</td><td>1000000</td><td>æå·®(ç´¢å¼•å¤±æ•ˆ)</td></tr><tr><td>idx_user_statusè”åˆç´¢å¼•</td><td>ref</td><td>idx_user_status</td><td>10</td><td>ä¼˜ç§€</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-56">ä¸ƒã€ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ</h2>
<h3 data-id="heading-57">7.1 é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œç´¢å¼•è§„èŒƒ</h3>
<p><strong>ã€å¼ºåˆ¶ã€‘ä¸è¦åœ¨ä½é€‰æ‹©æ€§å­—æ®µå•ç‹¬å»ºç´¢å¼•</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ ç¦æ­¢</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_gender (gender);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_status (status);

<span class="hljs-comment">-- âœ… æ­£ç¡®: è”åˆç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_status (user_id, status);
</code></pre>
<p><strong>ã€å¼ºåˆ¶ã€‘å”¯ä¸€ç´¢å¼•å¿…é¡»åŒ…å«is_deletedå­—æ®µ</strong> (è½¯åˆ é™¤):</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯</span>
<span class="hljs-keyword">UNIQUE</span> KEY uk_mobile (mobile)

<span class="hljs-comment">-- âœ… æ­£ç¡®</span>
<span class="hljs-keyword">UNIQUE</span> KEY uk_mobile_deleted (mobile, is_deleted)
</code></pre>
<p><strong>ã€å¼ºåˆ¶ã€‘ç¦æ­¢ä½¿ç”¨å¤–é”®</strong>:</p>
<ul>
<li>å¤–é”®å½±å“INSERT/UPDATE/DELETEæ€§èƒ½</li>
<li>åˆ†å¸ƒå¼åœºæ™¯ä¸‹æ— æ³•ä½¿ç”¨å¤–é”®</li>
<li>æ•°æ®ä¸€è‡´æ€§åœ¨åº”ç”¨å±‚ä¿è¯</li>
</ul>
<p><strong>ã€æ¨èã€‘å•è¡¨ç´¢å¼•æ•°é‡ä¸è¶…è¿‡5ä¸ª</strong>:</p>
<ul>
<li>ç´¢å¼•è¿‡å¤šå½±å“å†™å…¥æ€§èƒ½</li>
<li>ç´¢å¼•ç»´æŠ¤æˆæœ¬é«˜</li>
</ul>
<p><strong>ã€æ¨èã€‘è”åˆç´¢å¼•å­—æ®µæ•°ä¸è¶…è¿‡5ä¸ª</strong>:</p>
<ul>
<li>å­—æ®µè¿‡å¤š,ç´¢å¼•ä½“ç§¯å¤§</li>
<li>æœ€å·¦å‰ç¼€åŸåˆ™å¤æ‚,éš¾ä»¥ä¼˜åŒ–</li>
</ul>
<p><strong>ã€æ¨èã€‘VARCHARå­—æ®µä½¿ç”¨å‰ç¼€ç´¢å¼•</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- emailå¹³å‡é•¿åº¦30å­—èŠ‚</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_email (email(<span class="hljs-number">10</span>));
</code></pre>
<h3 data-id="heading-58">7.2 ç´¢å¼•è®¾è®¡å†³ç­–æ ‘</h3>
<pre><code class="hljs language-sql" lang="sql">æ˜¯å¦éœ€è¦å»ºç´¢å¼•?
â”œâ”€ å­—æ®µæ˜¯<span class="hljs-keyword">WHERE</span>ã€<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span>ã€<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>ã€<span class="hljs-keyword">JOIN</span>æ¡ä»¶?
â”‚  â””â”€ å¦ â†’ âŒ ä¸å»ºç´¢å¼•
â”‚
â”œâ”€ å­—æ®µé€‰æ‹©æ€§ <span class="hljs-operator">&gt;</span> <span class="hljs-number">0.1</span>?
â”‚  â””â”€ å¦ â†’ âŒ ä¸å»ºç´¢å¼•
â”‚
â”œâ”€ è¡¨æ•°æ®é‡ <span class="hljs-operator">&gt;</span> <span class="hljs-number">1000</span>?
â”‚  â””â”€ å¦ â†’ âŒ ä¸å»ºç´¢å¼• (å°è¡¨å…¨è¡¨æ‰«ææ›´å¿«)
â”‚
â”œâ”€ å­—æ®µæ˜¯å¦é¢‘ç¹æ›´æ–°?
â”‚  â””â”€ æ˜¯ â†’ âš ï¸ è°¨æ…è€ƒè™‘ (ç»´æŠ¤æˆæœ¬é«˜)
â”‚
â””â”€ æ˜¯ â†’ âœ… å»ºç´¢å¼•
   â”œâ”€ å•åˆ—ç´¢å¼• <span class="hljs-keyword">or</span> è”åˆç´¢å¼•?
   â”‚  â””â”€ ç»å¸¸ä¸€èµ·æŸ¥è¯¢ â†’ è”åˆç´¢å¼•
   â”‚  â””â”€ å•ç‹¬æŸ¥è¯¢ â†’ å•åˆ—ç´¢å¼•
   â”‚
   â””â”€ ä¸»é”®ç´¢å¼• <span class="hljs-keyword">or</span> å”¯ä¸€ç´¢å¼• <span class="hljs-keyword">or</span> æ™®é€šç´¢å¼•?
      â””â”€ å€¼å”¯ä¸€ä¸”ä¸ä¸º<span class="hljs-keyword">NULL</span> â†’ ä¸»é”®ç´¢å¼•
      â””â”€ å€¼å”¯ä¸€å¯ä¸º<span class="hljs-keyword">NULL</span> â†’ å”¯ä¸€ç´¢å¼•
      â””â”€ å…¶ä»– â†’ æ™®é€šç´¢å¼•
</code></pre>
<h3 data-id="heading-59">7.3 è”åˆç´¢å¼•è®¾è®¡æ­¥éª¤</h3>
<p><strong>æ­¥éª¤1</strong>: åˆ—å‡ºæŸ¥è¯¢æ¡ä»¶ä¸­çš„å­—æ®µ</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥è¯¢1</span>
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>

<span class="hljs-comment">-- æŸ¥è¯¢2</span>
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>
</code></pre>
<p>å­—æ®µåˆ—è¡¨: user_id, status, create_time</p>
<p><strong>æ­¥éª¤2</strong>: è®¡ç®—æ¯ä¸ªå­—æ®µçš„é€‰æ‹©æ€§</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> user_id) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> orders;    <span class="hljs-comment">-- 0.1</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> status) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> orders;     <span class="hljs-comment">-- 0.000005</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> create_time) <span class="hljs-operator">/</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> orders; <span class="hljs-comment">-- 0.8</span>
</code></pre>
<p><strong>æ­¥éª¤3</strong>: é€‰æ‹©æ€§é«˜çš„å­—æ®µæ”¾å‰é¢</p>
<p>æ’åº: user_id (0.1) &gt; create_time (0.8) &gt; status (0.000005)</p>
<p>ç­‰ç­‰,create_timeæ˜¯èŒƒå›´æŸ¥è¯¢,åº”è¯¥æ”¾æœ€å!</p>
<p><strong>æ­¥éª¤4</strong>: è€ƒè™‘æœ€å·¦å‰ç¼€åŸåˆ™</p>
<ul>
<li>ç­‰å€¼æŸ¥è¯¢å­—æ®µ: user_id, status</li>
<li>èŒƒå›´æŸ¥è¯¢å­—æ®µ: create_time</li>
</ul>
<p>æ’åº: user_id (ç­‰å€¼,é«˜åŒºåˆ†åº¦) &gt; status (ç­‰å€¼,ä½åŒºåˆ†åº¦) &gt; create_time (èŒƒå›´æŸ¥è¯¢)</p>
<p><strong>æ­¥éª¤5</strong>: è€ƒè™‘è¦†ç›–ç´¢å¼•</p>
<p>å¸¸æŸ¥è¯¢å­—æ®µ: order_no, user_id, status, total_amount</p>
<p>è”åˆç´¢å¼•: idx_user_status_orderno_amount (user_id, status, order_no, total_amount)</p>
<p><strong>æ­¥éª¤6</strong>: éªŒè¯EXPLAIN</p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> order_no, user_id, status, total_amount
<span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- æœŸæœ›ç»“æœ:</span>
<span class="hljs-comment">-- type: ref</span>
<span class="hljs-comment">-- key: idx_user_status_orderno_amount</span>
<span class="hljs-comment">-- Extra: Using index (è¦†ç›–ç´¢å¼•)</span>
</code></pre>
<hr/>
<h2 data-id="heading-60">å…«ã€å®æˆ˜åœºæ™¯åº”ç”¨</h2>
<h3 data-id="heading-61">8.1 åœºæ™¯1: åƒä¸‡çº§è®¢å•è¡¨ç´¢å¼•è®¾è®¡</h3>
<p><strong>ä¸šåŠ¡èƒŒæ™¯</strong>:</p>
<ul>
<li>è®¢å•è¡¨orders, 1000ä¸‡æ•°æ®</li>
<li>ä¸»è¦æŸ¥è¯¢åœºæ™¯:
<ol>
<li>ç”¨æˆ·æŸ¥è¯¢è‡ªå·±çš„è®¢å•: <code>WHERE user_id = ?</code></li>
<li>ç”¨æˆ·æŸ¥è¯¢ç‰¹å®šçŠ¶æ€è®¢å•: <code>WHERE user_id = ? AND status = ?</code></li>
<li>æŒ‰æ—¶é—´æ’åº: <code>ORDER BY create_time DESC</code></li>
<li>å–å®¶æŸ¥è¯¢è®¢å•: <code>WHERE seller_id = ? AND status = ?</code></li>
</ol>
</li>
</ul>
<p><strong>è¡¨ç»“æ„</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> orders (
  id <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
  order_no <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  user_id <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  seller_id <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  status TINYINT UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  total_amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  create_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  is_deleted TINYINT UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (id)
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4;
</code></pre>
<p><strong>ç´¢å¼•è®¾è®¡</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. ä¸»é”®ç´¢å¼• (è‡ªåŠ¨åˆ›å»º)</span>
<span class="hljs-keyword">PRIMARY</span> KEY (id)

<span class="hljs-comment">-- 2. è®¢å•å·å”¯ä¸€ç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span> INDEX uk_order_no (order_no);

<span class="hljs-comment">-- 3. ç”¨æˆ·è®¢å•æŸ¥è¯¢ (æœ€å¸¸ç”¨)</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_status_time (user_id, status, create_time);

<span class="hljs-comment">-- 4. å–å®¶è®¢å•æŸ¥è¯¢</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_seller_status_time (seller_id, status, create_time);
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡?</strong></p>
<p><strong>ç´¢å¼•1: uk_order_no</strong></p>
<ul>
<li>order_noå”¯ä¸€,å»ºå”¯ä¸€ç´¢å¼•</li>
<li>æŸ¥è¯¢: <code>WHERE order_no = 'xxx'</code> (ç”¨æˆ·æŸ¥è®¢å•è¯¦æƒ…)</li>
</ul>
<p><strong>ç´¢å¼•2: idx_user_status_time</strong></p>
<ul>
<li><strong>user_idåŒºåˆ†åº¦é«˜</strong> (å‡è®¾100ä¸‡ç”¨æˆ·, é€‰æ‹©æ€§0.1)</li>
<li><strong>statusåŒºåˆ†åº¦ä½</strong> (5ä¸ªå€¼, é€‰æ‹©æ€§0.000005)</li>
<li><strong>create_timeç”¨äºæ’åº</strong></li>
</ul>
<p>æŸ¥è¯¢åœºæ™¯:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥è¯¢1: âœ… ä½¿ç”¨user_id</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;

<span class="hljs-comment">-- æŸ¥è¯¢2: âœ… ä½¿ç”¨user_id + status</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- æŸ¥è¯¢3: âœ… ä½¿ç”¨user_id + status + create_time</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>;

<span class="hljs-comment">-- EXPLAIN:</span>
<span class="hljs-comment">-- type: ref</span>
<span class="hljs-comment">-- key: idx_user_status_time</span>
<span class="hljs-comment">-- rows: 10-100</span>
<span class="hljs-comment">-- Extra: Backward index scan (å€’åºæ‰«æç´¢å¼•,æ— éœ€æ’åº)</span>
</code></pre>
<p><strong>ç´¢å¼•3: idx_seller_status_time</strong></p>
<ul>
<li>å–å®¶æŸ¥è¯¢è®¢å•,ä¸ç”¨æˆ·æŸ¥è¯¢ç±»ä¼¼</li>
</ul>
<p><strong>æ€§èƒ½æµ‹è¯•å¯¹æ¯”</strong>:</p>





























<table><thead><tr><th>åœºæ™¯</th><th>æ— ç´¢å¼•</th><th>æœ‰ç´¢å¼•</th><th>æ€§èƒ½æå‡</th></tr></thead><tbody><tr><td>user_idæŸ¥è¯¢</td><td>3000ms (å…¨è¡¨æ‰«æ1000ä¸‡è¡Œ)</td><td>10ms (ç´¢å¼•æ‰«æ100è¡Œ)</td><td>300å€</td></tr><tr><td>user_id+statusæŸ¥è¯¢</td><td>3000ms</td><td>5ms (ç´¢å¼•æ‰«æ10è¡Œ)</td><td>600å€</td></tr><tr><td>user_id+status+æ’åº</td><td>5000ms (å…¨è¡¨æ‰«æ+filesort)</td><td>8ms (ç´¢å¼•æ‰«æ+ç´¢å¼•æ’åº)</td><td>625å€</td></tr></tbody></table>
<h3 data-id="heading-62">8.2 åœºæ™¯2: æ…¢æŸ¥è¯¢å®šä½ä¸ä¼˜åŒ–</h3>
<p><strong>æ…¢æŸ¥è¯¢æ—¥å¿—å‘ç°</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"># <span class="hljs-type">Time</span>: <span class="hljs-number">2024</span><span class="hljs-number">-10</span><span class="hljs-number">-21</span>T10:<span class="hljs-number">30</span>:<span class="hljs-number">15.123456</span>Z
# <span class="hljs-keyword">User</span><span class="hljs-variable">@Host</span>: app_user[app_user] @ localhost []
# Query_time: <span class="hljs-number">3.521234</span>  Lock_time: <span class="hljs-number">0.000123</span>  Rows_sent: <span class="hljs-number">20</span>  Rows_examined: <span class="hljs-number">1000000</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>;
</code></pre>
<p><strong>é—®é¢˜åˆ†æ</strong>:</p>
<ul>
<li>Query_time: 3.5ç§’ (è¶…è¿‡æ…¢æŸ¥è¯¢é˜ˆå€¼1ç§’)</li>
<li>Rows_examined: 100ä¸‡è¡Œ (å…¨è¡¨æ‰«æ)</li>
</ul>
<p><strong>EXPLAINåˆ†æ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>\G

<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>
           id: <span class="hljs-number">1</span>
  select_type: SIMPLE
        <span class="hljs-keyword">table</span>: orders
         type: <span class="hljs-keyword">ALL</span>        <span class="hljs-operator">&lt;</span><span class="hljs-comment">--- å…¨è¡¨æ‰«æ</span>
possible_keys: <span class="hljs-keyword">NULL</span>
          key: <span class="hljs-keyword">NULL</span>       <span class="hljs-operator">&lt;</span><span class="hljs-comment">--- æœªä½¿ç”¨ç´¢å¼•</span>
      key_len: <span class="hljs-keyword">NULL</span>
          <span class="hljs-keyword">ref</span>: <span class="hljs-keyword">NULL</span>
         <span class="hljs-keyword">rows</span>: <span class="hljs-number">1000000</span>    <span class="hljs-operator">&lt;</span><span class="hljs-comment">--- æ‰«æ100ä¸‡è¡Œ</span>
        Extra: <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span>; <span class="hljs-keyword">Using</span> filesort  <span class="hljs-operator">&lt;</span><span class="hljs-comment">--- æ–‡ä»¶æ’åº</span>
</code></pre>
<p><strong>é—®é¢˜æ ¹å› </strong>:</p>
<ol>
<li><strong>statusåŒºåˆ†åº¦ä½</strong>(5ä¸ªå€¼, 20ä¸‡è¡Œ),å•ç‹¬ç´¢å¼•æ— æ•ˆ</li>
<li><strong>create_timeèŒƒå›´æŸ¥è¯¢</strong></li>
<li><strong>ORDER BY create_timeéœ€è¦æ’åº</strong>,æ— ç´¢å¼•æ”¯æŒ,Using filesort</li>
</ol>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ1: æ·»åŠ è”åˆç´¢å¼•</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_status_time (status, create_time);
</code></pre>
<p><strong>ä¼˜åŒ–åEXPLAIN</strong>:</p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>\G

type: <span class="hljs-keyword">range</span>       <span class="hljs-operator">&lt;</span><span class="hljs-comment">--- èŒƒå›´æŸ¥è¯¢</span>
key: idx_status_time
<span class="hljs-keyword">rows</span>: <span class="hljs-number">200000</span>      <span class="hljs-operator">&lt;</span><span class="hljs-comment">--- æ‰«æ20ä¸‡è¡Œ (status=1çš„æ•°æ®)</span>
Extra: Backward index scan  <span class="hljs-operator">&lt;</span><span class="hljs-comment">--- å€’åºæ‰«æç´¢å¼•,æ— filesort</span>
</code></pre>
<p><strong>æ€§èƒ½æå‡</strong>: 3000ms â†’ 800ms (æå‡3.75å€)</p>
<p><strong>é—®é¢˜</strong>: ä»ç„¶æ‰«æ20ä¸‡è¡Œ,èƒ½å¦ç»§ç»­ä¼˜åŒ–?</p>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ2: ä¸šåŠ¡ä¼˜åŒ– + ç´¢å¼•è°ƒæ•´</strong></p>
<p><strong>ä¸šåŠ¡è°ƒæ•´</strong>: åªæŸ¥è¯¢è¿‘30å¤©æ•°æ®</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;</span> DATE_SUB(NOW(), <span class="hljs-type">INTERVAL</span> <span class="hljs-number">30</span> <span class="hljs-keyword">DAY</span>)
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>;
</code></pre>
<p><strong>ç´¢å¼•è°ƒæ•´</strong>: create_timeåœ¨å‰,statusåœ¨å (æ—¶é—´èŒƒå›´å°,å…ˆè¿‡æ»¤)</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_time_status (create_time, status);
</code></pre>
<p><strong>ä¼˜åŒ–åEXPLAIN</strong>:</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">type:</span> range
<span class="hljs-symbol">key:</span> idx_time_status
<span class="hljs-symbol">rows:</span> <span class="hljs-number">5000</span>   &lt;--- åªæ‰«æè¿‘<span class="hljs-number">30</span>å¤©æ•°æ®(çº¦<span class="hljs-number">5000</span>è¡Œ)
<span class="hljs-symbol">Extra:</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span>; Backward index scan
</code></pre>
<p><strong>æ€§èƒ½æå‡</strong>: 3000ms â†’ 50ms (æå‡60å€!)</p>
<h3 data-id="heading-63">8.3 åœºæ™¯3: è¦†ç›–ç´¢å¼•ä¼˜åŒ–å›è¡¨æŸ¥è¯¢</h3>
<p><strong>åŸå§‹æŸ¥è¯¢</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> order_no, user_id, status, total_amount
<span class="hljs-keyword">FROM</span> orders
<span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>;
</code></pre>
<p><strong>ç´¢å¼•</strong>: idx_user_status_time (user_id, status, create_time)</p>
<p><strong>EXPLAINåˆ†æ</strong>:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">type:</span> <span class="hljs-string">ref</span>
<span class="hljs-attr">key:</span> <span class="hljs-string">idx_user_status_time</span>
<span class="hljs-attr">rows:</span> <span class="hljs-number">100</span>
<span class="hljs-attr">Extra:</span> <span class="hljs-literal">NULL</span>   <span class="hljs-string">&lt;---</span> <span class="hljs-string">éœ€è¦å›è¡¨</span>
</code></pre>
<p><strong>é—®é¢˜</strong>: æŸ¥è¯¢å­—æ®µ(order_no, total_amount)ä¸åœ¨ç´¢å¼•ä¸­,éœ€è¦å›è¡¨100æ¬¡ã€‚</p>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>: åˆ›å»ºè¦†ç›–ç´¢å¼•</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_status_time_orderno_amount
  (user_id, status, create_time, order_no, total_amount);
</code></pre>
<p><strong>ä¼˜åŒ–åEXPLAIN</strong>:</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">type:</span> ref
<span class="hljs-symbol">key:</span> idx_user_status_time_orderno_amount
<span class="hljs-symbol">rows:</span> <span class="hljs-number">100</span>
<span class="hljs-symbol">Extra:</span> <span class="hljs-keyword">Using</span> index  &lt;--- è¦†ç›–ç´¢å¼•,æ— éœ€å›è¡¨
</code></pre>
<p><strong>æ€§èƒ½æå‡</strong>:</p>
<ul>
<li>å›è¡¨100æ¬¡ (100æ¬¡éšæœºI/O) â†’ 0æ¬¡å›è¡¨</li>
<li>æŸ¥è¯¢æ—¶é—´: 50ms â†’ 10ms (æå‡5å€)</li>
</ul>
<hr/>
<h2 data-id="heading-64">ä¹ã€ç”Ÿäº§æ¡ˆä¾‹ä¸æ•…éšœæ’æŸ¥</h2>
<h3 data-id="heading-65">9.1 æ¡ˆä¾‹1: ç´¢å¼•ä¼˜åŒ–è®©æŸ¥è¯¢ä»3sé™åˆ°50ms</h3>
<p><strong>é—®é¢˜èƒŒæ™¯</strong>:</p>
<ul>
<li>è®¢å•è¡¨1000ä¸‡æ•°æ®</li>
<li>æŸ¥è¯¢: <code>SELECT * FROM orders WHERE user_id = 100 AND status IN (1, 2, 3)</code></li>
<li>å“åº”æ—¶é—´: 3000ms</li>
<li>ç”¨æˆ·æŠ•è¯‰: è®¢å•åˆ—è¡¨åŠ è½½æ…¢</li>
</ul>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>:</p>
<p><strong>æ­¥éª¤1: æ…¢æŸ¥è¯¢æ—¥å¿—åˆ†æ</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Query_time: 3.123</span>
<span class="hljs-section">Rows_examined: 300000</span>
</code></pre>
<p><strong>æ­¥éª¤2: EXPLAINåˆ†æ</strong></p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">100</span> <span class="hljs-keyword">AND</span> status <span class="hljs-keyword">IN</span> (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)\G

type: <span class="hljs-keyword">ref</span>
key: idx_user_id
<span class="hljs-keyword">rows</span>: <span class="hljs-number">300000</span>
Extra: <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span>
</code></pre>
<p><strong>é—®é¢˜å‘ç°</strong>:</p>
<ul>
<li>ä½¿ç”¨idx_user_idç´¢å¼•</li>
<li>ä½†æ‰«æ30ä¸‡è¡Œ (user_id=100çš„æ‰€æœ‰è®¢å•)</li>
<li>statusè¿‡æ»¤åœ¨Serverå±‚,æ•ˆç‡ä½</li>
</ul>
<p><strong>æ­¥éª¤3: ç´¢å¼•ä¼˜åŒ–</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åŸç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_id (user_id);

<span class="hljs-comment">-- ä¼˜åŒ–: æ·»åŠ è”åˆç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_status (user_id, status);
</code></pre>
<p><strong>ä¼˜åŒ–åEXPLAIN</strong>:</p>
<pre><code class="hljs language-sql" lang="sql">type: <span class="hljs-keyword">range</span> (<span class="hljs-keyword">IN</span>æ˜¯èŒƒå›´æŸ¥è¯¢)
key: idx_user_status
<span class="hljs-keyword">rows</span>: <span class="hljs-number">15000</span>   <span class="hljs-operator">&lt;</span><span class="hljs-comment">--- æ‰«æè¡Œæ•°å¤§å¹…å‡å°‘</span>
Extra: <span class="hljs-keyword">Using</span> index <span class="hljs-keyword">condition</span>
</code></pre>
<p><strong>æ•ˆæœ</strong>:</p>
<ul>
<li>æŸ¥è¯¢æ—¶é—´: 3000ms â†’ 50ms (æå‡60å€)</li>
<li>æ‰«æè¡Œæ•°: 30ä¸‡è¡Œ â†’ 1.5ä¸‡è¡Œ (å‡å°‘95%)</li>
</ul>
<h3 data-id="heading-66">9.2 æ¡ˆä¾‹2: éšå¼ç±»å‹è½¬æ¢å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</h3>
<p><strong>é—®é¢˜èƒŒæ™¯</strong>:</p>
<ul>
<li>ç”¨æˆ·è¡¨1000ä¸‡æ•°æ®</li>
<li>æŸ¥è¯¢: <code>SELECT * FROM users WHERE mobile = 13800138000</code></li>
<li>å“åº”æ—¶é—´: 5000ms (å…¨è¡¨æ‰«æ)</li>
<li>mobileå­—æ®µç±»å‹: VARCHAR(11), æœ‰ç´¢å¼•idx_mobile</li>
</ul>
<p><strong>EXPLAINåˆ†æ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> mobile <span class="hljs-operator">=</span> <span class="hljs-number">13800138000</span>\G

type: <span class="hljs-keyword">ALL</span>    <span class="hljs-operator">&lt;</span><span class="hljs-comment">--- å…¨è¡¨æ‰«æ</span>
key: <span class="hljs-keyword">NULL</span>    <span class="hljs-operator">&lt;</span><span class="hljs-comment">--- ç´¢å¼•å¤±æ•ˆ</span>
<span class="hljs-keyword">rows</span>: <span class="hljs-number">10000000</span>
</code></pre>
<p><strong>é—®é¢˜æ ¹å› </strong>:</p>
<ul>
<li>mobileæ˜¯VARCHARç±»å‹</li>
<li>æŸ¥è¯¢å€¼13800138000æ˜¯æ•°å­—</li>
<li>MySQLå°†mobileè½¬æ¢ä¸ºæ•°å­—: <code>CAST(mobile AS UNSIGNED) = 13800138000</code></li>
<li>å‡½æ•°å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</li>
</ul>
<p><strong>ä¿®å¤æ–¹æ¡ˆ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âœ… æ­£ç¡®: ä½¿ç”¨å­—ç¬¦ä¸²</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> mobile <span class="hljs-operator">=</span> <span class="hljs-string">'13800138000'</span>;
</code></pre>
<p><strong>ä¼˜åŒ–åEXPLAIN</strong>:</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">type: ref</span>
<span class="hljs-section">key: idx_mobile</span>
<span class="hljs-section">rows: 1</span>
</code></pre>
<p><strong>æ•ˆæœ</strong>: 5000ms â†’ 5ms (æå‡1000å€)</p>
<p><strong>æ•™è®­</strong>:</p>
<ul>
<li>âœ… å­—æ®µç±»å‹ä¸æŸ¥è¯¢å€¼ç±»å‹ä¿æŒä¸€è‡´</li>
<li>âœ… VARCHARå­—æ®µä½¿ç”¨å­—ç¬¦ä¸²æŸ¥è¯¢</li>
<li>âœ… INTå­—æ®µä½¿ç”¨æ•°å­—æŸ¥è¯¢</li>
</ul>
<h3 data-id="heading-67">9.3 æ¡ˆä¾‹3: ORDER BYå¯¼è‡´Using filesortæ€§èƒ½å·®</h3>
<p><strong>é—®é¢˜èƒŒæ™¯</strong>:</p>
<ul>
<li>å•†å“è¡¨500ä¸‡æ•°æ®</li>
<li>æŸ¥è¯¢: <code>SELECT * FROM products WHERE category_id = 10 ORDER BY sales DESC LIMIT 20</code></li>
<li>å“åº”æ—¶é—´: 2000ms</li>
</ul>
<p><strong>EXPLAINåˆ†æ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> products <span class="hljs-keyword">WHERE</span> category_id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sales <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">20</span>\G

type: <span class="hljs-keyword">ref</span>
key: idx_category_id
<span class="hljs-keyword">rows</span>: <span class="hljs-number">50000</span>
Extra: <span class="hljs-keyword">Using</span> filesort   <span class="hljs-operator">&lt;</span><span class="hljs-comment">--- æ–‡ä»¶æ’åº</span>
</code></pre>
<p><strong>é—®é¢˜</strong>: ORDER BY salesæ— ç´¢å¼•æ”¯æŒ,éœ€è¦å¯¹5ä¸‡è¡Œæ•°æ®è¿›è¡Œfilesortã€‚</p>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>: åˆ›å»ºè”åˆç´¢å¼•</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> products <span class="hljs-keyword">ADD</span> INDEX idx_category_sales (category_id, sales);
</code></pre>
<p><strong>ä¼˜åŒ–åEXPLAIN</strong>:</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">type: ref</span>
<span class="hljs-section">key: idx_category_sales</span>
<span class="hljs-section">rows: 50000</span>
<span class="hljs-section">Extra: Backward index scan  &lt;--- ç´¢å¼•å€’åºæ‰«æ,æ— filesort</span>
</code></pre>
<p><strong>æ•ˆæœ</strong>: 2000ms â†’ 100ms (æå‡20å€)</p>
<hr/>
<h2 data-id="heading-68">åã€å¸¸è§é—®é¢˜ä¸é¿å‘æŒ‡å—</h2>
<h3 data-id="heading-69">10.1 ä¸ºä»€ä¹ˆä¸æ¨èä½¿ç”¨å¤–é”®?</h3>
<p><strong>å¤–é”®çš„é—®é¢˜</strong>:</p>
<ol>
<li><strong>æ€§èƒ½é—®é¢˜</strong>: INSERT/UPDATE/DELETEéœ€è¦æ£€æŸ¥å¤–é”®çº¦æŸ,æ€§èƒ½å·®</li>
<li><strong>åˆ†å¸ƒå¼é—®é¢˜</strong>: åˆ†åº“åˆ†è¡¨å,å¤–é”®æ— æ³•è·¨åº“ä½¿ç”¨</li>
<li><strong>æ­»é”é£é™©</strong>: å¤–é”®é”å¯èƒ½å¯¼è‡´æ­»é”</li>
<li><strong>çµæ´»æ€§å·®</strong>: è¡¨ç»“æ„å˜æ›´å›°éš¾</li>
</ol>
<p><strong>âœ… æ¨èåšæ³•</strong>:</p>
<ul>
<li>æ•°æ®ä¸€è‡´æ€§åœ¨åº”ç”¨å±‚ä¿è¯</li>
<li>ä½¿ç”¨äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§</li>
</ul>
<h3 data-id="heading-70">10.2 ä¸ºä»€ä¹ˆè¦é¿å…SELECT *?</h3>
<p><strong>åŸå› </strong>:</p>
<ol>
<li><strong>æ— æ³•ä½¿ç”¨è¦†ç›–ç´¢å¼•</strong>: æŸ¥è¯¢æ‰€æœ‰å­—æ®µ,å¿…ç„¶æœ‰å­—æ®µä¸åœ¨ç´¢å¼•ä¸­,éœ€è¦å›è¡¨</li>
<li><strong>ç½‘ç»œä¼ è¾“å¼€é”€å¤§</strong>: ä¼ è¾“ä¸éœ€è¦çš„å­—æ®µ,æµªè´¹å¸¦å®½</li>
<li><strong>Buffer Poolå ç”¨å¤š</strong>: ç¼“å­˜å¤§é‡æ— ç”¨æ•°æ®</li>
<li><strong>å¯è¯»æ€§å·®</strong>: ä¸çŸ¥é“æŸ¥è¯¢äº†å“ªäº›å­—æ®µ</li>
</ol>
<p><strong>âœ… æ¨è</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ</span>
<span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<h3 data-id="heading-71">10.3 å¦‚ä½•é€‰æ‹©è”åˆç´¢å¼•è¿˜æ˜¯å¤šä¸ªå•åˆ—ç´¢å¼•?</h3>
<p><strong>åŸåˆ™</strong>: <strong>ä¼˜å…ˆé€‰æ‹©è”åˆç´¢å¼•</strong>ã€‚</p>
<p><strong>åŸå› </strong>:</p>
<ul>
<li>âœ… è”åˆç´¢å¼•æ”¯æŒæœ€å·¦å‰ç¼€,ä¸€ä¸ªç´¢å¼•æŠµå¤šä¸ªå•åˆ—ç´¢å¼•</li>
<li>âœ… è”åˆç´¢å¼•å¯ä»¥è¦†ç›–ç´¢å¼•,å‡å°‘å›è¡¨</li>
<li>âŒ å¤šä¸ªå•åˆ—ç´¢å¼•,MySQLåªèƒ½é€‰æ‹©ä¸€ä¸ªç´¢å¼•,å…¶ä»–ç´¢å¼•æµªè´¹</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯: å¤šä¸ªå•åˆ—ç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user (user_id);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_status (status);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_time (create_time);

<span class="hljs-comment">-- æŸ¥è¯¢: WHERE user_id = 100 AND status = 1</span>
<span class="hljs-comment">-- MySQLåªèƒ½é€‰æ‹©ä¸€ä¸ªç´¢å¼•(idx_useræˆ–idx_status),å¦ä¸€ä¸ªæµªè´¹</span>

<span class="hljs-comment">-- âœ… æ­£ç¡®: è”åˆç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_status_time (user_id, status, create_time);

<span class="hljs-comment">-- æ”¯æŒå¤šç§æŸ¥è¯¢ç»„åˆ</span>
</code></pre>
<h3 data-id="heading-72">10.4 å‰ç¼€ç´¢å¼•å¦‚ä½•é€‰æ‹©é•¿åº¦?</h3>
<p>è§ç¬¬äºŒç« 2.4.4èŠ‚ã€‚</p>
<h3 data-id="heading-73">10.5 ç´¢å¼•è¶Šå¤šè¶Šå¥½å—?</h3>
<p><strong>âŒ ä¸æ˜¯!</strong></p>
<p><strong>åŸå› </strong>:</p>
<ol>
<li><strong>å†™å…¥æ€§èƒ½ä¸‹é™</strong>: æ¯ä¸ªç´¢å¼•éƒ½è¦ç»´æŠ¤,ç´¢å¼•è¶Šå¤š,INSERT/UPDATE/DELETEè¶Šæ…¢</li>
<li><strong>å ç”¨ç©ºé—´</strong>: ç´¢å¼•å ç”¨ç£ç›˜ç©ºé—´</li>
<li><strong>ä¼˜åŒ–å™¨é€‰æ‹©å›°éš¾</strong>: ç´¢å¼•è¿‡å¤š,ä¼˜åŒ–å™¨å¯èƒ½é€‰é”™ç´¢å¼•</li>
</ol>
<p><strong>å»ºè®®</strong>:</p>
<ul>
<li>å•è¡¨ç´¢å¼•æ•°é‡ â‰¤ 5ä¸ª</li>
<li>è”åˆç´¢å¼•å­—æ®µæ•° â‰¤ 5ä¸ª</li>
<li>å®šæœŸæ¸…ç†æ— ç”¨ç´¢å¼•</li>
</ul>
<h3 data-id="heading-74">10.6 ä¸ºä»€ä¹ˆä¸å»ºè®®åœ¨is_deletedå­—æ®µå•ç‹¬å»ºç´¢å¼•?</h3>
<p><strong>åŸå› </strong>:</p>
<ul>
<li>is_deletedåªæœ‰2ä¸ªå€¼(0æœªåˆ é™¤, 1å·²åˆ é™¤)</li>
<li>é€‰æ‹©æ€§æä½(0.00005%)</li>
<li>é€šå¸¸æŸ¥è¯¢<code>WHERE is_deleted = 0</code>è¿”å›99.9%çš„æ•°æ®,å…¨è¡¨æ‰«ææ›´å¿«</li>
</ul>
<p><strong>âœ… æ­£ç¡®åšæ³•</strong>: æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_user_id_deleted (user_id, is_deleted);
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">UNIQUE</span> INDEX uk_mobile_deleted (mobile, is_deleted);
</code></pre>
<h3 data-id="heading-75">10.7 COUNT(*)ã€COUNT(1)ã€COUNT(column)çš„åŒºåˆ«?</h3>





























<table><thead><tr><th>å‡½æ•°</th><th>å«ä¹‰</th><th>æ˜¯å¦ç»Ÿè®¡NULL</th><th>æ€§èƒ½</th></tr></thead><tbody><tr><td>COUNT(*)</td><td>ç»Ÿè®¡è¡Œæ•°</td><td>æ˜¯</td><td>æœ€å¿« (InnoDBä¼˜åŒ–)</td></tr><tr><td>COUNT(1)</td><td>ç»Ÿè®¡è¡Œæ•°</td><td>æ˜¯</td><td>ç­‰åŒCOUNT(*)</td></tr><tr><td>COUNT(column)</td><td>ç»Ÿè®¡éNULLè¡Œæ•°</td><td>å¦</td><td>æ…¢ (éœ€è¦è¯»å–columnå€¼)</td></tr></tbody></table>
<p><strong>æ¨è</strong>: ä½¿ç”¨COUNT(*)ã€‚</p>
<hr/>
<h2 data-id="heading-76">åä¸€ã€æœ€ä½³å®è·µä¸æ€»ç»“</h2>
<h3 data-id="heading-77">11.1 ç´¢å¼•è®¾è®¡Checklist</h3>
<p><strong>è®¾è®¡é˜¶æ®µ</strong>:</p>
<ul>
<li>âœ… é«˜é¢‘WHEREæ¡ä»¶å­—æ®µå»ºç´¢å¼•</li>
<li>âœ… é«˜é¢‘JOINè¿æ¥å­—æ®µå»ºç´¢å¼•</li>
<li>âœ… é«˜é¢‘ORDER BYã€GROUP BYå­—æ®µå»ºç´¢å¼•</li>
<li>âœ… å­—æ®µé€‰æ‹©æ€§ &gt; 0.1æ‰å»ºç´¢å¼•</li>
<li>âŒ ä½é€‰æ‹©æ€§å­—æ®µ(&lt;5%)ä¸å•ç‹¬å»ºç´¢å¼•</li>
<li>âŒ é¢‘ç¹æ›´æ–°çš„å­—æ®µè°¨æ…å»ºç´¢å¼•</li>
<li>âŒ TEXT/BLOBå¤§å­—æ®µä¸å»ºç´¢å¼•</li>
</ul>
<p><strong>å®æ–½é˜¶æ®µ</strong>:</p>
<ul>
<li>âœ… è”åˆç´¢å¼•éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™</li>
<li>âœ… åŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾å‰é¢</li>
<li>âœ… ç­‰å€¼æŸ¥è¯¢å­—æ®µæ”¾å‰é¢,èŒƒå›´æŸ¥è¯¢å­—æ®µæ”¾åé¢</li>
<li>âœ… è€ƒè™‘è¦†ç›–ç´¢å¼•,å‡å°‘å›è¡¨</li>
<li>âœ… å”¯ä¸€ç´¢å¼•åŒ…å«is_deletedå­—æ®µ</li>
</ul>
<p><strong>éªŒè¯é˜¶æ®µ</strong>:</p>
<ul>
<li>âœ… EXPLAINåˆ†ææ‰§è¡Œè®¡åˆ’</li>
<li>âœ… typeè¾¾åˆ°refä»¥ä¸Š</li>
<li>âœ… keyæ˜¾ç¤ºä½¿ç”¨äº†ç´¢å¼•</li>
<li>âœ… rowsæ‰«æè¡Œæ•°åˆç†</li>
<li>âœ… Extraæ— Using filesortã€Using temporary</li>
</ul>
<h3 data-id="heading-78">11.2 æ…¢æŸ¥è¯¢ä¼˜åŒ–æµç¨‹</h3>
<p><strong>æ­¥éª¤1</strong>: å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</p>
<pre><code class="hljs language-bash" lang="bash">slow_query_log=ON
long_query_time=1
slow_query_log_file=/var/log/mysql-slow.log
log_queries_not_using_indexes=ON
</code></pre>
<p><strong>æ­¥éª¤2</strong>: åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># mysqldumpslow</span>
mysqldumpslow -s t -t 10 /var/log/mysql-slow.log

<span class="hljs-comment"># pt-query-digest (æ¨è)</span>
pt-query-digest /var/log/mysql-slow.log
</code></pre>
<p><strong>æ­¥éª¤3</strong>: EXPLAINåˆ†æ</p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> ...\G
</code></pre>
<p>é‡ç‚¹å…³æ³¨: typeã€keyã€rowsã€Extra</p>
<p><strong>æ­¥éª¤4</strong>: ä¼˜åŒ–ç´¢å¼•</p>
<ul>
<li>æ·»åŠ ç¼ºå¤±çš„ç´¢å¼•</li>
<li>è°ƒæ•´è”åˆç´¢å¼•é¡ºåº</li>
<li>ä½¿ç”¨è¦†ç›–ç´¢å¼•å‡å°‘å›è¡¨</li>
</ul>
<p><strong>æ­¥éª¤5</strong>: éªŒè¯æ•ˆæœ</p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> ...\G  <span class="hljs-comment">-- éªŒè¯æ‰§è¡Œè®¡åˆ’æ”¹å–„</span>
</code></pre>
<p>å¯¹æ¯”ä¼˜åŒ–å‰åçš„Query_timeå’ŒRows_examinedã€‚</p>
<h3 data-id="heading-79">11.3 EXPLAINåˆ†æè¦ç‚¹</h3>
<p><strong>å…³é”®å­—æ®µ</strong>:</p>



































<table><thead><tr><th>å­—æ®µ</th><th>å«ä¹‰</th><th>ä¼˜ç§€å€¼</th><th>å·®å€¼</th></tr></thead><tbody><tr><td><strong>type</strong></td><td>è®¿é—®ç±»å‹</td><td>constã€eq_refã€ref</td><td>ALLã€index</td></tr><tr><td><strong>key</strong></td><td>ä½¿ç”¨çš„ç´¢å¼•</td><td>ç´¢å¼•å</td><td>NULL</td></tr><tr><td><strong>rows</strong></td><td>æ‰«æè¡Œæ•°</td><td>è¶Šå°‘è¶Šå¥½</td><td>&gt;10ä¸‡</td></tr><tr><td><strong>Extra</strong></td><td>é¢å¤–ä¿¡æ¯</td><td>Using index</td><td>Using filesortã€Using temporary</td></tr></tbody></table>
<p><strong>ä¼˜åŒ–ç›®æ ‡</strong>:</p>
<ul>
<li>âœ… typeè¾¾åˆ°refä»¥ä¸Š</li>
<li>âœ… keyä¸ä¸ºNULL</li>
<li>âœ… rows &lt; 1000 (å–å†³äºä¸šåŠ¡)</li>
<li>âœ… Extraæ˜¾ç¤ºUsing index (è¦†ç›–ç´¢å¼•)</li>
</ul>
<h3 data-id="heading-80">11.4 ç›‘æ§æŒ‡æ ‡å»ºè®®</h3>
<p><strong>ç´¢å¼•ç›¸å…³ç›‘æ§</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ç´¢å¼•ä½¿ç”¨æƒ…å†µ</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sys.schema_unused_indexes;

<span class="hljs-comment">-- Buffer Poolå‘½ä¸­ç‡</span>
<span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'Innodb_buffer_pool%'</span>;

<span class="hljs-comment">-- æ…¢æŸ¥è¯¢æ•°é‡</span>
<span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'Slow_queries'</span>;
</code></pre>
<p><strong>å‘Šè­¦é˜ˆå€¼</strong>:</p>
<ul>
<li>Buffer Poolå‘½ä¸­ç‡ &lt; 99%</li>
<li>æ…¢æŸ¥è¯¢æ•°é‡ &gt; 100/åˆ†é’Ÿ</li>
<li>ç´¢å¼•æœªä½¿ç”¨ &gt; 3ä¸ªæœˆ</li>
</ul>
<h3 data-id="heading-81">11.5 æ ¸å¿ƒè¦ç‚¹æ€»ç»“</h3>
<p><strong>ç´¢å¼•åŸç†</strong>:</p>
<ul>
<li>ç´¢å¼•æœ¬è´¨æ˜¯æ’åº+æŸ¥æ‰¾,B+æ ‘ç´¢å¼•é»˜è®¤</li>
<li>èšç°‡ç´¢å¼•(ä¸»é”®)å¶å­èŠ‚ç‚¹å­˜å‚¨å®Œæ•´æ•°æ®,éèšç°‡ç´¢å¼•(äºŒçº§ç´¢å¼•)éœ€è¦å›è¡¨</li>
<li>3å±‚B+æ ‘èƒ½å­˜2000ä¸‡è¡Œæ•°æ®,æŸ¥è¯¢åªéœ€3æ¬¡I/O</li>
</ul>
<p><strong>è”åˆç´¢å¼•</strong>:</p>
<ul>
<li>éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™,ä»æœ€å·¦å­—æ®µå¼€å§‹è¿ç»­åŒ¹é…</li>
<li>é‡åˆ°èŒƒå›´æŸ¥è¯¢åœæ­¢åŒ¹é…</li>
<li>åŒºåˆ†åº¦é«˜çš„å­—æ®µæ”¾å‰é¢,ç­‰å€¼æŸ¥è¯¢å­—æ®µæ”¾å‰é¢</li>
</ul>
<p><strong>ç´¢å¼•é€‰æ‹©æ€§</strong>:</p>
<ul>
<li>é€‰æ‹©æ€§ = åŸºæ•° / æ€»è¡Œæ•°</li>
<li>é€‰æ‹©æ€§ &gt; 0.1æ‰å»ºç´¢å¼•,&lt; 0.05ç¦æ­¢å•ç‹¬å»ºç´¢å¼•</li>
<li>ä½åŒºåˆ†åº¦å­—æ®µ(genderã€status)ä¸å•ç‹¬å»ºç´¢å¼•,æ”¾åœ¨è”åˆç´¢å¼•åé¢</li>
</ul>
<p><strong>ç´¢å¼•å¤±æ•ˆ</strong>:</p>
<ul>
<li>å‡½æ•°ã€éšå¼ç±»å‹è½¬æ¢ã€!=ã€LIKE '%xxx'ã€è¿åæœ€å·¦å‰ç¼€</li>
<li>ä¼˜åŒ–å™¨è®¤ä¸ºå…¨è¡¨æ‰«ææ›´å¿«æ—¶,ç´¢å¼•å¤±æ•ˆ</li>
</ul>
<p><strong>è¦†ç›–ç´¢å¼•</strong>:</p>
<ul>
<li>æŸ¥è¯¢å­—æ®µéƒ½åœ¨ç´¢å¼•ä¸­,æ— éœ€å›è¡¨,EXPLAINæ˜¾ç¤ºUsing index</li>
<li>æ€§èƒ½æœ€ä¼˜,å›è¡¨0æ¬¡</li>
</ul>
<p><strong>ç´¢å¼•è®¾è®¡åŸåˆ™</strong>:</p>
<ul>
<li>å•è¡¨ç´¢å¼•â‰¤5ä¸ª,è”åˆç´¢å¼•å­—æ®µâ‰¤5ä¸ª</li>
<li>ä¼˜å…ˆè”åˆç´¢å¼•,ä¸å»ºå¤šä¸ªå•åˆ—ç´¢å¼•</li>
<li>å”¯ä¸€ç´¢å¼•åŒ…å«is_deletedå­—æ®µ(è½¯åˆ é™¤)</li>
<li>EXPLAINåˆ†ææ¯æ¡SQL,ä¸Šçº¿å‰å¿…é¡»éªŒè¯</li>
</ul>
<p>æŒæ¡ç´¢å¼•è®¾è®¡ä¸ä¼˜åŒ–,æ˜¯MySQLæ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæŠ€èƒ½ã€‚é€šè¿‡æ·±å…¥ç†è§£ç´¢å¼•åŸç†ã€æœ€å·¦å‰ç¼€åŸåˆ™ã€ç´¢å¼•é€‰æ‹©æ€§è®¡ç®—ã€ç´¢å¼•å¤±æ•ˆåœºæ™¯,ç»“åˆEXPLAINæ‰§è¡Œè®¡åˆ’åˆ†æå’Œç”Ÿäº§å®æˆ˜æ¡ˆä¾‹,èƒ½å¤Ÿåœ¨é¢è¯•å’Œå®é™…å·¥ä½œä¸­æ¸¸åˆƒæœ‰ä½™,æ„å»ºé«˜æ€§èƒ½çš„æ•°æ®åº“ç³»ç»Ÿã€‚</p>
<hr/>
<p><strong>å‚è€ƒèµ„æ–™</strong>:</p>
<ul>
<li>ã€Šé«˜æ€§èƒ½MySQLã€‹(ç¬¬4ç‰ˆ) - Baron Schwartzç­‰</li>
<li>ã€ŠMySQLæŠ€æœ¯å†…å¹•: InnoDBå­˜å‚¨å¼•æ“ã€‹(ç¬¬2ç‰ˆ) - å§œæ‰¿å°§</li>
<li>é˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œ (åµ©å±±ç‰ˆ)</li>
<li>MySQLå®˜æ–¹æ–‡æ¡£: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F8.0%2Fen%2Foptimization-indexes.html" target="_blank" title="https://dev.mysql.com/doc/refman/8.0/en/optimization-indexes.html" ref="nofollow noopener noreferrer">dev.mysql.com/doc/refman/â€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQLäº‹åŠ¡ä¸é”æœºåˆ¶æ·±åº¦å‰–æ]]></title>    <link>https://juejin.cn/post/7585474459777269796</link>    <guid>https://juejin.cn/post/7585474459777269796</guid>    <pubDate>2025-12-21T01:34:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459777269796" data-draft-id="7585485074038423558" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQLäº‹åŠ¡ä¸é”æœºåˆ¶æ·±åº¦å‰–æ"/> <meta itemprop="keywords" content="åç«¯,MySQL"/> <meta itemprop="datePublished" content="2025-12-21T01:34:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç„¡é‡"/> <meta itemprop="url" content="https://juejin.cn/user/1116759546145086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQLäº‹åŠ¡ä¸é”æœºåˆ¶æ·±åº¦å‰–æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759546145086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç„¡é‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T01:34:29.000Z" title="Sun Dec 21 2025 01:34:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»31åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>äº‹åŠ¡å’Œé”æ˜¯MySQLå¹¶å‘æ§åˆ¶çš„æ ¸å¿ƒæœºåˆ¶ã€‚æœ¬æ–‡ä»ACIDç‰¹æ€§å‡ºå‘,æ·±å…¥å‰–æå››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸å¹¶å‘é—®é¢˜,è¯¦è§£MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶çš„å®ç°åŸç†(éšè—åˆ—ã€ç‰ˆæœ¬é“¾ã€Read Viewå¯è§æ€§åˆ¤æ–­),å…¨é¢è®²è§£InnoDBé”æœºåˆ¶(è®°å½•é”ã€é—´éš™é”ã€Next-Key Lock),ç»“åˆç”µå•†åº“å­˜æ‰£å‡ã€æ­»é”æ’æŸ¥ç­‰å®æˆ˜æ¡ˆä¾‹,å¸®åŠ©è¯»è€…å½»åº•ç†è§£MySQLäº‹åŠ¡ä¸é”çš„åº•å±‚åŸç†,åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ¸¸åˆƒæœ‰ä½™ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€ç†è®ºçŸ¥è¯†ä¸æ ¸å¿ƒæ¦‚å¿µ</h2>
<h3 data-id="heading-2">1.1 ä»€ä¹ˆæ˜¯äº‹åŠ¡?ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡?</h3>
<p>**äº‹åŠ¡(Transaction)**æ˜¯æ•°æ®åº“æ“ä½œçš„æœ€å°å·¥ä½œå•å…ƒ,ç”±ä¸€ç»„SQLè¯­å¥ç»„æˆçš„é€»è¾‘å¤„ç†å•å…ƒã€‚äº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œ,è¦ä¹ˆå…¨éƒ¨æˆåŠŸæäº¤(COMMIT),è¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»š(ROLLBACK),ä¸å­˜åœ¨ä¸­é—´çŠ¶æ€ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦äº‹åŠ¡?</strong></p>
<p>è€ƒè™‘ä¸€ä¸ªç»å…¸çš„è½¬è´¦åœºæ™¯:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è´¦æˆ·Aæ‰£æ¬¾100å…ƒ</span>
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span>;

<span class="hljs-comment">-- è´¦æˆ·BåŠ æ¬¾100å…ƒ</span>
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">+</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">'B'</span>;
</code></pre>
<p>å¦‚æœç¬¬ä¸€æ¡SQLæ‰§è¡ŒæˆåŠŸ,ç¬¬äºŒæ¡SQLå› ä¸ºç³»ç»Ÿå´©æºƒæ‰§è¡Œå¤±è´¥,ä¼šå¯¼è‡´:</p>
<ul>
<li>è´¦æˆ·Aæ‰£æ¬¾æˆåŠŸ,ä½™é¢å‡å°‘100å…ƒ</li>
<li>è´¦æˆ·BåŠ æ¬¾å¤±è´¥,ä½™é¢æœªå¢åŠ </li>
<li><strong>ç»“æœ</strong>: ç³»ç»Ÿå‡­ç©ºå°‘äº†100å…ƒ,æ•°æ®ä¸ä¸€è‡´!</li>
</ul>
<p><strong>ä½¿ç”¨äº‹åŠ¡ä¿è¯åŸå­æ€§:</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">BEGIN</span>; <span class="hljs-comment">-- å¼€å¯äº‹åŠ¡</span>
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">'A'</span>;
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">+</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">'B'</span>;
<span class="hljs-keyword">COMMIT</span>; <span class="hljs-comment">-- æäº¤äº‹åŠ¡</span>
</code></pre>
<p>äº‹åŠ¡ä¿è¯ä¸¤æ¡UPDATEè¦ä¹ˆå…¨éƒ¨æˆåŠŸ,è¦ä¹ˆå…¨éƒ¨å›æ»š,æ•°æ®ä¸€è‡´æ€§å¾—åˆ°ä¿è¯ã€‚</p>
<h3 data-id="heading-3">1.2 ACIDå››å¤§ç‰¹æ€§è¯¦è§£</h3>
<p>äº‹åŠ¡å…·æœ‰å››ä¸ªæ ¸å¿ƒç‰¹æ€§,é€šå¸¸ç®€ç§°ä¸ºACID:</p>
<p><strong>1. åŸå­æ€§(Atomicity)</strong></p>
<ul>
<li><strong>å®šä¹‰</strong>: äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å·¥ä½œå•å…ƒ,è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œ,è¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ</li>
<li><strong>å®ç°æœºåˆ¶</strong>: Undo Log(å›æ»šæ—¥å¿—)
<ul>
<li>æ¯ä¸ªäº‹åŠ¡æ‰§è¡Œå‰,InnoDBä¼šåœ¨Undo Logä¸­è®°å½•ä¿®æ”¹å‰çš„æ—§å€¼</li>
<li>äº‹åŠ¡å›æ»šæ—¶,é€šè¿‡Undo Logæ¢å¤åˆ°ä¿®æ”¹å‰çš„çŠ¶æ€</li>
</ul>
</li>
<li><strong>ç¤ºä¾‹</strong>: è½¬è´¦åœºæ™¯,Aæ‰£æ¬¾å’ŒBåŠ æ¬¾å¿…é¡»åŒæ—¶æˆåŠŸæˆ–åŒæ—¶å¤±è´¥</li>
</ul>
<p><strong>2. ä¸€è‡´æ€§(Consistency)</strong></p>
<ul>
<li><strong>å®šä¹‰</strong>: äº‹åŠ¡æ‰§è¡Œå‰å,æ•°æ®åº“å¿…é¡»ä»ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€</li>
<li><strong>çº¦æŸä¿è¯</strong>:
<ul>
<li>æ•°æ®å®Œæ•´æ€§çº¦æŸ(ä¸»é”®ã€å¤–é”®ã€å”¯ä¸€çº¦æŸã€éç©ºçº¦æŸ)</li>
<li>ä¸šåŠ¡è§„åˆ™çº¦æŸ(å¦‚ä½™é¢ä¸èƒ½ä¸ºè´Ÿæ•°)</li>
</ul>
</li>
<li><strong>ç¤ºä¾‹</strong>: è½¬è´¦å‰å,Aå’ŒBè´¦æˆ·ä½™é¢ä¹‹å’Œä¿æŒä¸å˜</li>
</ul>
<p><strong>3. éš”ç¦»æ€§(Isolation)</strong></p>
<ul>
<li><strong>å®šä¹‰</strong>: å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶,ä¸€ä¸ªäº‹åŠ¡çš„æ‰§è¡Œä¸åº”è¢«å…¶ä»–äº‹åŠ¡å¹²æ‰°</li>
<li><strong>å®ç°æœºåˆ¶</strong>: MVCC + é”æœºåˆ¶</li>
<li><strong>éš”ç¦»çº§åˆ«</strong>: è¯»æœªæäº¤ã€è¯»å·²æäº¤ã€å¯é‡å¤è¯»ã€ä¸²è¡ŒåŒ–(è¯¦è§ç¬¬äºŒç« )</li>
<li><strong>ç¤ºä¾‹</strong>: äº‹åŠ¡Aåœ¨æŸ¥è¯¢è´¦æˆ·ä½™é¢æ—¶,ä¸åº”çœ‹åˆ°äº‹åŠ¡Bæœªæäº¤çš„ä¿®æ”¹</li>
</ul>
<p><strong>4. æŒä¹…æ€§(Durability)</strong></p>
<ul>
<li><strong>å®šä¹‰</strong>: äº‹åŠ¡ä¸€æ—¦æäº¤,å¯¹æ•°æ®çš„ä¿®æ”¹æ˜¯æ°¸ä¹…æ€§çš„,å³ä½¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±</li>
<li><strong>å®ç°æœºåˆ¶</strong>: Redo Log(é‡åšæ—¥å¿—) + åŒå†™ç¼“å†²(Doublewrite Buffer)
<ul>
<li>äº‹åŠ¡æäº¤å‰,å…ˆå°†ä¿®æ”¹å†™å…¥Redo Logå¹¶åˆ·ç›˜(WALæœºåˆ¶)</li>
<li>ç³»ç»Ÿå´©æºƒæ¢å¤æ—¶,é€šè¿‡Redo Logé‡åšå·²æäº¤çš„äº‹åŠ¡</li>
</ul>
</li>
<li><strong>ç¤ºä¾‹</strong>: äº‹åŠ¡æäº¤å,å³ä½¿æ•°æ®åº“æœåŠ¡å™¨æ–­ç”µ,æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±</li>
</ul>
<h3 data-id="heading-4">1.3 å¹¶å‘äº‹åŠ¡å¸¦æ¥çš„é—®é¢˜</h3>
<p>å¤šä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œæ—¶,å¦‚æœæ²¡æœ‰é€‚å½“çš„éš”ç¦»æœºåˆ¶,ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜:</p>
<p><strong>1. è„å†™(Dirty Write / Lost Update)</strong></p>
<ul>
<li><strong>å®šä¹‰</strong>: ä¸¤ä¸ªäº‹åŠ¡åŒæ—¶ä¿®æ”¹åŒä¸€è¡Œæ•°æ®,åæäº¤çš„äº‹åŠ¡è¦†ç›–äº†å‰é¢äº‹åŠ¡çš„ä¿®æ”¹</li>
<li><strong>ç¤ºä¾‹</strong>:
<ul>
<li>äº‹åŠ¡A: UPDATE account SET balance = 900 WHERE id = 1; (æœªæäº¤)</li>
<li>äº‹åŠ¡B: UPDATE account SET balance = 800 WHERE id = 1; (æœªæäº¤)</li>
<li>äº‹åŠ¡Aå›æ»š,balanceæ¢å¤åˆ°1000</li>
<li><strong>é—®é¢˜</strong>: äº‹åŠ¡Bçš„ä¿®æ”¹ä¸¢å¤±äº†!</li>
</ul>
</li>
<li><strong>è§£å†³</strong>: æ‰€æœ‰éš”ç¦»çº§åˆ«éƒ½èƒ½é˜²æ­¢è„å†™(InnoDBé€šè¿‡è¡Œé”å®ç°)</li>
</ul>
<p><strong>2. è„è¯»(Dirty Read)</strong></p>
<ul>
<li><strong>å®šä¹‰</strong>: äº‹åŠ¡Aè¯»å–åˆ°äº†äº‹åŠ¡Bå·²ä¿®æ”¹ä½†æœªæäº¤çš„æ•°æ®</li>
<li><strong>ç¤ºä¾‹</strong>:
<ul>
<li>äº‹åŠ¡B: UPDATE account SET balance = 500 WHERE id = 1; (æœªæäº¤)</li>
<li>äº‹åŠ¡A: SELECT balance FROM account WHERE id = 1; -- è¯»åˆ°500</li>
<li>äº‹åŠ¡Bå›æ»š,balanceæ¢å¤åˆ°1000</li>
<li><strong>é—®é¢˜</strong>: äº‹åŠ¡Aè¯»åˆ°çš„500æ˜¯"è„æ•°æ®"</li>
</ul>
</li>
<li><strong>å±å®³</strong>: åŸºäºè„æ•°æ®åšå†³ç­–,å¯èƒ½å¯¼è‡´ä¸¥é‡çš„ä¸šåŠ¡é”™è¯¯</li>
<li><strong>è§£å†³</strong>: READ COMMITTEDåŠä»¥ä¸Šéš”ç¦»çº§åˆ«å¯é˜²æ­¢è„è¯»</li>
</ul>
<p><strong>3. ä¸å¯é‡å¤è¯»(Non-Repeatable Read)</strong></p>
<ul>
<li><strong>å®šä¹‰</strong>: äº‹åŠ¡Aå†…å¤šæ¬¡è¯»å–åŒä¸€è¡Œæ•°æ®,ç»“æœä¸ä¸€è‡´(å…¶ä»–äº‹åŠ¡UPDATEå¹¶æäº¤)</li>
<li><strong>ç¤ºä¾‹</strong>:
<ul>
<li>äº‹åŠ¡A: SELECT balance FROM account WHERE id = 1; -- è¯»åˆ°1000</li>
<li>äº‹åŠ¡B: UPDATE account SET balance = 500 WHERE id = 1; COMMIT;</li>
<li>äº‹åŠ¡A: SELECT balance FROM account WHERE id = 1; -- è¯»åˆ°500</li>
<li><strong>é—®é¢˜</strong>: åŒä¸€äº‹åŠ¡å†…ä¸¤æ¬¡æŸ¥è¯¢ç»“æœä¸åŒ</li>
</ul>
</li>
<li><strong>åœºæ™¯</strong>: ç»Ÿè®¡æŠ¥è¡¨,æŸ¥è¯¢ä¸¤æ¬¡é‡‘é¢ä¸åŒ,æ•°æ®ä¸ä¸€è‡´</li>
<li><strong>è§£å†³</strong>: REPEATABLE READåŠä»¥ä¸Šéš”ç¦»çº§åˆ«å¯é˜²æ­¢ä¸å¯é‡å¤è¯»</li>
</ul>
<p><strong>4. å¹»è¯»(Phantom Read)</strong></p>
<ul>
<li><strong>å®šä¹‰</strong>: äº‹åŠ¡Aå†…å¤šæ¬¡æŸ¥è¯¢,ç»“æœé›†çš„è¡Œæ•°ä¸ä¸€è‡´(å…¶ä»–äº‹åŠ¡INSERT/DELETEå¹¶æäº¤)</li>
<li><strong>ç¤ºä¾‹</strong>:
<ul>
<li>äº‹åŠ¡A: SELECT COUNT(*) FROM orders WHERE status = 1; -- ç»“æœ100æ¡</li>
<li>äº‹åŠ¡B: INSERT INTO orders VALUES (101, 1, ...); COMMIT;</li>
<li>äº‹åŠ¡A: SELECT COUNT(*) FROM orders WHERE status = 1; -- ç»“æœ101æ¡</li>
<li><strong>é—®é¢˜</strong>: åŒä¸€äº‹åŠ¡å†…ä¸¤æ¬¡æŸ¥è¯¢ç»“æœé›†ä¸åŒ,å‡ºç°"å¹»å½±"æ•°æ®</li>
</ul>
</li>
<li><strong>ä¸ä¸å¯é‡å¤è¯»åŒºåˆ«</strong>:
<ul>
<li>ä¸å¯é‡å¤è¯»: é’ˆå¯¹UPDATEæ“ä½œ,æ•°æ®å†…å®¹å˜åŒ–</li>
<li>å¹»è¯»: é’ˆå¯¹INSERT/DELETEæ“ä½œ,æ•°æ®è¡Œæ•°å˜åŒ–</li>
</ul>
</li>
<li><strong>è§£å†³</strong>: SERIALIZABLEéš”ç¦»çº§åˆ«æˆ–REPEATABLE READ + Next-Key Lock</li>
</ul>
<hr/>
<h2 data-id="heading-5">äºŒã€äº‹åŠ¡éš”ç¦»çº§åˆ«è¯¦è§£</h2>
<h3 data-id="heading-6">2.1 å››ç§éš”ç¦»çº§åˆ«</h3>
<p>SQLæ ‡å‡†å®šä¹‰äº†å››ç§äº‹åŠ¡éš”ç¦»çº§åˆ«,ä»ä½åˆ°é«˜åˆ†åˆ«æ˜¯:</p>













































<table><thead><tr><th>éš”ç¦»çº§åˆ«</th><th>è„è¯»</th><th>ä¸å¯é‡å¤è¯»</th><th>å¹»è¯»</th><th>å®ç°æ–¹å¼</th><th>å¹¶å‘æ€§èƒ½</th></tr></thead><tbody><tr><td><strong>è¯»æœªæäº¤ (Read Uncommitted)</strong></td><td>âœ… å¯èƒ½</td><td>âœ… å¯èƒ½</td><td>âœ… å¯èƒ½</td><td>æ— é”</td><td>æœ€é«˜</td></tr><tr><td><strong>è¯»å·²æäº¤ (Read Committed)</strong></td><td>âŒ ä¸å¯èƒ½</td><td>âœ… å¯èƒ½</td><td>âœ… å¯èƒ½</td><td>MVCC(æ¯æ¬¡SELECTç”Ÿæˆæ–°Read View)</td><td>é«˜</td></tr><tr><td><strong>å¯é‡å¤è¯» (Repeatable Read)</strong></td><td>âŒ ä¸å¯èƒ½</td><td>âŒ ä¸å¯èƒ½</td><td>âš ï¸ éƒ¨åˆ†è§£å†³</td><td>MVCC + Next-Key Lock</td><td>ä¸­</td></tr><tr><td><strong>ä¸²è¡ŒåŒ– (Serializable)</strong></td><td>âŒ ä¸å¯èƒ½</td><td>âŒ ä¸å¯èƒ½</td><td>âŒ ä¸å¯èƒ½</td><td>è¡¨é”/è¡Œé” + é—´éš™é”</td><td>æœ€ä½</td></tr></tbody></table>
<p><strong>MySQL InnoDBé»˜è®¤éš”ç¦»çº§åˆ«</strong>: REPEATABLE READ</p>
<h3 data-id="heading-7">2.2 éš”ç¦»çº§åˆ«è¯¦è§£ä¸ç¤ºä¾‹</h3>
<h4 data-id="heading-8">2.2.1 è¯»æœªæäº¤ (Read Uncommitted)</h4>
<p><strong>ç‰¹ç‚¹</strong>: äº‹åŠ¡å¯ä»¥è¯»å–å…¶ä»–äº‹åŠ¡æœªæäº¤çš„æ•°æ®(è„è¯»)</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¼šè¯A: è®¾ç½®éš”ç¦»çº§åˆ«ä¸ºè¯»æœªæäº¤</span>
<span class="hljs-keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ UNCOMMITTED;
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- balance = 1000</span>

<span class="hljs-comment">-- ä¼šè¯B: ä¿®æ”¹æ•°æ®ä½†ä¸æäº¤</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> <span class="hljs-number">500</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- ä¼šè¯A: å†æ¬¡æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- balance = 500 (è„è¯»!)</span>

<span class="hljs-comment">-- ä¼šè¯B: å›æ»š</span>
<span class="hljs-keyword">ROLLBACK</span>;

<span class="hljs-comment">-- ä¼šè¯A: å†æ¬¡æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- balance = 1000 (æ•°æ®ä¸ä¸€è‡´!)</span>
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: å‡ ä¹ä¸ä½¿ç”¨,æ•°æ®ä¸€è‡´æ€§æ— æ³•ä¿è¯</p>
<h4 data-id="heading-9">2.2.2 è¯»å·²æäº¤ (Read Committed)</h4>
<p><strong>ç‰¹ç‚¹</strong>: åªèƒ½è¯»å–å·²æäº¤çš„æ•°æ®,è§£å†³è„è¯»,ä½†å­˜åœ¨ä¸å¯é‡å¤è¯»</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¼šè¯A</span>
<span class="hljs-keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> balance <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- 1000</span>

<span class="hljs-comment">-- ä¼šè¯B</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> <span class="hljs-number">500</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- ä¼šè¯A: å†æ¬¡æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> balance <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- 500 (ä¸å¯é‡å¤è¯»!)</span>
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: Oracleã€PostgreSQLé»˜è®¤éš”ç¦»çº§åˆ«,é€‚åˆå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜ä½†æ€§èƒ½è¦æ±‚é«˜çš„åœºæ™¯</p>
<h4 data-id="heading-10">2.2.3 å¯é‡å¤è¯» (Repeatable Read)</h4>
<p><strong>ç‰¹ç‚¹</strong>: åŒä¸€äº‹åŠ¡å†…å¤šæ¬¡è¯»å–ç»“æœä¸€è‡´,è§£å†³è„è¯»å’Œä¸å¯é‡å¤è¯»</p>
<p><strong>å®ç°æœºåˆ¶</strong>: MVCC(å¿«ç…§è¯») + Next-Key Lock(å½“å‰è¯»)</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¼šè¯A</span>
<span class="hljs-keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> balance <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- 1000</span>

<span class="hljs-comment">-- ä¼šè¯B</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> <span class="hljs-number">500</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- ä¼šè¯A: å†æ¬¡æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> balance <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- ä»ç„¶æ˜¯1000 (å¯é‡å¤è¯»!)</span>

<span class="hljs-comment">-- ä¼šè¯A: UPDATEä¼šä½¿ç”¨å½“å‰å€¼</span>
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">-</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">SELECT</span> balance <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- 400 (500 - 100,ä½¿ç”¨å½“å‰è¯»)</span>
</code></pre>
<p><strong>å¹»è¯»é—®é¢˜</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¼šè¯A</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>; <span class="hljs-comment">-- å‡è®¾0æ¡</span>

<span class="hljs-comment">-- ä¼šè¯B</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> account <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">15</span>, <span class="hljs-string">'test'</span>, <span class="hljs-number">100</span>);
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- ä¼šè¯A: å¿«ç…§è¯»</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>; <span class="hljs-comment">-- ä»ç„¶0æ¡ (MVCC,çœ‹ä¸åˆ°æ–°æ’å…¥çš„è¡Œ)</span>

<span class="hljs-comment">-- ä¼šè¯A: å½“å‰è¯»</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>; <span class="hljs-comment">-- 1æ¡ (Next-Key Lock,èƒ½çœ‹åˆ°)</span>

<span class="hljs-comment">-- ä¼šè¯A: UPDATEè§¦å‘å½“å‰è¯»</span>
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> balance <span class="hljs-operator">+</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>; <span class="hljs-comment">-- å½±å“1è¡Œ (å¹»è¯»!)</span>
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: MySQL InnoDBé»˜è®¤çº§åˆ«,é€‚åˆå¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯</p>
<h4 data-id="heading-11">2.2.4 ä¸²è¡ŒåŒ– (Serializable)</h4>
<p><strong>ç‰¹ç‚¹</strong>: äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œ,å®Œå…¨é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»,ä½†å¹¶å‘æ€§èƒ½æœ€å·®</p>
<p><strong>å®ç°</strong>: æ‰€æœ‰SELECTè‡ªåŠ¨åŠ å…±äº«é”(LOCK IN SHARE MODE)</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¼šè¯A</span>
<span class="hljs-keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- è‡ªåŠ¨åŠ Sé”</span>

<span class="hljs-comment">-- ä¼šè¯B</span>
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> <span class="hljs-number">500</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- é˜»å¡ç­‰å¾…,ç›´åˆ°ä¼šè¯Aæäº¤</span>
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>: æå°‘ä½¿ç”¨,é€šå¸¸ç”¨äºé‡‘èç­‰å¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜çš„åœºæ™¯</p>
<h3 data-id="heading-12">2.3 éš”ç¦»çº§åˆ«è®¾ç½®</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥çœ‹å½“å‰éš”ç¦»çº§åˆ« (MySQL 5.7+)</span>
<span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@transaction</span>_isolation;

<span class="hljs-comment">-- æŸ¥çœ‹å½“å‰éš”ç¦»çº§åˆ« (MySQL 5.7ä»¥å‰)</span>
<span class="hljs-keyword">SELECT</span> @<span class="hljs-variable">@tx</span>_isolation;

<span class="hljs-comment">-- è®¾ç½®ä¼šè¯çº§åˆ«éš”ç¦»çº§åˆ«</span>
<span class="hljs-keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;

<span class="hljs-comment">-- è®¾ç½®å…¨å±€éš”ç¦»çº§åˆ« (é‡å¯åå¤±æ•ˆ)</span>
<span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> TRANSACTION ISOLATION LEVEL READ COMMITTED;

<span class="hljs-comment">-- æ°¸ä¹…è®¾ç½® (ä¿®æ”¹my.cnf)</span>
[mysqld]
transaction<span class="hljs-operator">-</span>isolation <span class="hljs-operator">=</span> READ<span class="hljs-operator">-</span>COMMITTED
</code></pre>
<hr/>
<h2 data-id="heading-13">ä¸‰ã€MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/293912b22f0d42c8af3e83f001f552ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885669&amp;x-signature=xT0uMlfRRFTZkSH0JX0R9Br98Dk%3D" alt="mvcc-principle.svg" loading="lazy"/></p>
<h3 data-id="heading-14">3.1 MVCCæ ¸å¿ƒåŸç†</h3>
<p>**MVCC(Multi-Version Concurrency Control)**æ˜¯InnoDBå®ç°é«˜å¹¶å‘è¯»å†™çš„æ ¸å¿ƒæœºåˆ¶:</p>
<ul>
<li><strong>æ ¸å¿ƒæ€æƒ³</strong>: ä¸ºæ¯è¡Œæ•°æ®ä¿å­˜å¤šä¸ªç‰ˆæœ¬,è¯»å–æ•°æ®æ—¶æ ¹æ®äº‹åŠ¡éš”ç¦»çº§åˆ«è¿”å›åˆé€‚çš„ç‰ˆæœ¬</li>
<li><strong>ä¼˜åŠ¿</strong>: è¯»å†™ä¸é˜»å¡,è¯»ä¸åŠ é”,å¤§å¹…æå‡å¹¶å‘æ€§èƒ½</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>: åªåœ¨READ COMMITTEDå’ŒREPEATABLE READéš”ç¦»çº§åˆ«ä¸‹ç”Ÿæ•ˆ</li>
</ul>
<p><strong>ä¼ ç»Ÿé”æœºåˆ¶ vs MVCC:</strong></p>






























<table><thead><tr><th>ç»´åº¦</th><th>ä¼ ç»Ÿé”æœºåˆ¶</th><th>MVCCæœºåˆ¶</th></tr></thead><tbody><tr><td>è¯»å†™å¹¶å‘</td><td>è¯»å†™äº’æ–¥(è¯»åŠ Sé”,å†™åŠ Xé”)</td><td>è¯»å†™ä¸äº’æ–¥(å¿«ç…§è¯»)</td></tr><tr><td>æ€§èƒ½</td><td>è¯»å†™é˜»å¡,å¹¶å‘æ€§èƒ½å·®</td><td>è¯»å†™å¹¶å‘,æ€§èƒ½é«˜</td></tr><tr><td>å®ç°å¤æ‚åº¦</td><td>ç®€å•(åŠ é”å³å¯)</td><td>å¤æ‚(ç‰ˆæœ¬é“¾ã€Read View)</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>SERIALIZABLEéš”ç¦»çº§åˆ«</td><td>RCã€RRéš”ç¦»çº§åˆ«</td></tr></tbody></table>
<h3 data-id="heading-15">3.2 MVCCå®ç°æœºåˆ¶</h3>
<h4 data-id="heading-16">3.2.1 éšè—åˆ—</h4>
<p>InnoDBä¸ºæ¯è¡Œæ•°æ®è‡ªåŠ¨æ·»åŠ ä¸‰ä¸ªéšè—åˆ—(è¯¦è§ä¸Šå›¾):</p>

























<table><thead><tr><th>éšè—åˆ—</th><th>å¤§å°</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><strong>DB_TRX_ID</strong></td><td>6å­—èŠ‚</td><td>æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è¡Œçš„äº‹åŠ¡ID</td></tr><tr><td><strong>DB_ROLL_PTR</strong></td><td>7å­—èŠ‚</td><td>å›æ»šæŒ‡é’ˆ,æŒ‡å‘Undo Logä¸­çš„æ—§ç‰ˆæœ¬</td></tr><tr><td><strong>DB_ROW_ID</strong></td><td>6å­—èŠ‚</td><td>éšè—ä¸»é”®(è¡¨æ²¡æœ‰ä¸»é”®æ—¶è‡ªåŠ¨ç”Ÿæˆ)</td></tr></tbody></table>
<p><strong>ç¤ºä¾‹æ•°æ®è¡Œç»“æ„</strong>:</p>
<pre><code class="hljs language-ini" lang="ini">| <span class="hljs-attr">id</span>=<span class="hljs-number">1</span> | name=<span class="hljs-string">'Alice'</span> | age=<span class="hljs-number">25</span> | DB_TRX_ID=<span class="hljs-number">100</span> | DB_ROLL_PTR=<span class="hljs-number">0</span>x... | DB_ROW_ID=... |
</code></pre>
<h4 data-id="heading-17">3.2.2 Undo Logç‰ˆæœ¬é“¾</h4>
<p><strong>Undo Logä½œç”¨</strong>:</p>
<ol>
<li>äº‹åŠ¡å›æ»šæ—¶æ¢å¤æ•°æ®</li>
<li>MVCCè¯»å–å†å²ç‰ˆæœ¬æ•°æ®</li>
</ol>
<p><strong>ç‰ˆæœ¬é“¾å½¢æˆè¿‡ç¨‹</strong>:</p>
<p>å‡è®¾id=1è¿™è¡Œæ•°æ®ç»å†äº†ä¸‰æ¬¡ä¿®æ”¹:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">1. trx_id</span>=<span class="hljs-number">100</span>: INSERT (age=<span class="hljs-number">25</span>)
<span class="hljs-attr">2. trx_id</span>=<span class="hljs-number">200</span>: UPDATE age=<span class="hljs-number">30</span>
<span class="hljs-attr">3. trx_id</span>=<span class="hljs-number">300</span>: UPDATE age=<span class="hljs-number">35</span>
</code></pre>
<p><strong>ç‰ˆæœ¬é“¾ç»“æ„</strong> (è¯¦è§ä¸Šå›¾):</p>
<pre><code class="hljs language-ini" lang="ini">å½“å‰ç‰ˆæœ¬: (<span class="hljs-attr">age</span>=<span class="hljs-number">35</span>, DB_TRX_ID=<span class="hljs-number">300</span>, DB_ROLL_PTRâ†’ç‰ˆæœ¬<span class="hljs-number">2</span>)
    â†“
ç‰ˆæœ¬2 (Undo Log): (<span class="hljs-attr">age</span>=<span class="hljs-number">30</span>, DB_TRX_ID=<span class="hljs-number">200</span>, DB_ROLL_PTRâ†’ç‰ˆæœ¬<span class="hljs-number">1</span>)
    â†“
ç‰ˆæœ¬1 (Undo Log): (<span class="hljs-attr">age</span>=<span class="hljs-number">25</span>, DB_TRX_ID=<span class="hljs-number">100</span>, DB_ROLL_PTR=NULL)
</code></pre>
<p>é€šè¿‡ç‰ˆæœ¬é“¾,MVCCå¯ä»¥è¯»å–åˆ°æ•°æ®çš„ä»»æ„å†å²ç‰ˆæœ¬ã€‚</p>
<h4 data-id="heading-18">3.2.3 Read View(è¯»è§†å›¾)</h4>
<p><strong>Read Viewå®šä¹‰</strong>: äº‹åŠ¡å¼€å§‹æ—¶(æˆ–æ¯æ¬¡SELECTæ—¶)åˆ›å»ºçš„ä¸€è‡´æ€§è§†å›¾,ç”¨äºåˆ¤æ–­å“ªäº›ç‰ˆæœ¬å¯¹å½“å‰äº‹åŠ¡å¯è§ã€‚</p>
<p><strong>Read Viewå››ä¸ªæ ¸å¿ƒå±æ€§</strong>:</p>

























<table><thead><tr><th>å±æ€§</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><strong>m_ids</strong></td><td>åˆ›å»ºRead Viewæ—¶æ‰€æœ‰æ´»è·ƒ(æœªæäº¤)çš„äº‹åŠ¡IDåˆ—è¡¨</td></tr><tr><td><strong>min_trx_id</strong></td><td>m_idsä¸­æœ€å°çš„äº‹åŠ¡ID</td></tr><tr><td><strong>max_trx_id</strong></td><td>ä¸‹ä¸€ä¸ªå°†è¦åˆ†é…çš„äº‹åŠ¡ID (æœ€å¤§å€¼+1)</td></tr><tr><td><strong>creator_trx_id</strong></td><td>åˆ›å»ºè¯¥Read Viewçš„äº‹åŠ¡ID (å½“å‰äº‹åŠ¡)</td></tr></tbody></table>
<p><strong>ç¤ºä¾‹</strong>:</p>
<p>å‡è®¾å½“å‰æœ‰5ä¸ªäº‹åŠ¡:</p>
<pre><code class="hljs language-ini" lang="ini">å·²æäº¤äº‹åŠ¡: <span class="hljs-attr">trx_id</span> = <span class="hljs-number">95</span>, <span class="hljs-number">98</span>
æ´»è·ƒäº‹åŠ¡: <span class="hljs-attr">trx_id</span> = <span class="hljs-number">101</span>, <span class="hljs-number">105</span>, <span class="hljs-number">108</span> (æœªæäº¤)
å½“å‰äº‹åŠ¡: <span class="hljs-attr">trx_id</span> = <span class="hljs-number">106</span>
</code></pre>
<p>åˆ™Read Viewä¸º:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">m_ids</span> = [<span class="hljs-number">101</span>, <span class="hljs-number">105</span>, <span class="hljs-number">108</span>]
<span class="hljs-attr">min_trx_id</span> = <span class="hljs-number">101</span>
<span class="hljs-attr">max_trx_id</span> = <span class="hljs-number">110</span> (ä¸‹ä¸€ä¸ªåˆ†é…çš„ID)
<span class="hljs-attr">creator_trx_id</span> = <span class="hljs-number">106</span>
</code></pre>
<h3 data-id="heading-19">3.3 å¯è§æ€§åˆ¤æ–­è§„åˆ™</h3>
<p><strong>æ ¸å¿ƒé—®é¢˜</strong>: æ•°æ®è¡Œçš„DB_TRX_IDæ˜¯å¦å¯¹å½“å‰äº‹åŠ¡å¯è§?</p>
<p><strong>åˆ¤æ–­æµç¨‹</strong> (è¯¦è§ä¸Šå›¾):</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> trx<span class="hljs-emphasis">_id == creator_</span>trx<span class="hljs-emphasis">_id?
   â†’ æ˜¯: å¯è§ (å½“å‰äº‹åŠ¡è‡ªå·±ä¿®æ”¹çš„æ•°æ®)

2. trx_</span>id &lt; min<span class="hljs-emphasis">_trx_</span>id?
   â†’ æ˜¯: å¯è§ (åœ¨Read Viewåˆ›å»ºå‰å°±å·²æäº¤)

<span class="hljs-bullet">3.</span> trx<span class="hljs-emphasis">_id &gt;= max_</span>trx<span class="hljs-emphasis">_id?
   â†’ æ˜¯: ä¸å¯è§ (åœ¨Read Viewåˆ›å»ºåæ‰å¼€å§‹çš„äº‹åŠ¡)

4. min_</span>trx<span class="hljs-emphasis">_id &lt;= trx_</span>id &lt; max<span class="hljs-emphasis">_trx_</span>id?
   â†’ trx<span class="hljs-emphasis">_id in m_</span>ids?
<span class="hljs-bullet">      -</span> åœ¨: ä¸å¯è§ (æ´»è·ƒäº‹åŠ¡,æœªæäº¤)
<span class="hljs-bullet">      -</span> ä¸åœ¨: å¯è§ (å·²æäº¤)
</code></pre>
<p><strong>ç¤ºä¾‹</strong>:</p>
<p>å‡è®¾å½“å‰Read View:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">m_ids</span> = [<span class="hljs-number">101</span>, <span class="hljs-number">105</span>, <span class="hljs-number">108</span>]
<span class="hljs-attr">min_trx_id</span> = <span class="hljs-number">101</span>
<span class="hljs-attr">max_trx_id</span> = <span class="hljs-number">110</span>
<span class="hljs-attr">creator_trx_id</span> = <span class="hljs-number">106</span>
</code></pre>
<p>åˆ¤æ–­ä»¥ä¸‹æ•°æ®è¡Œæ˜¯å¦å¯è§:</p>



































<table><thead><tr><th>DB_TRX_ID</th><th>åˆ¤æ–­</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>106</td><td>== creator_trx_id</td><td>âœ… å¯è§ (è‡ªå·±çš„ä¿®æ”¹)</td></tr><tr><td>98</td><td>&lt; min_trx_id</td><td>âœ… å¯è§ (å·²æäº¤)</td></tr><tr><td>112</td><td>&gt;= max_trx_id</td><td>âŒ ä¸å¯è§ (æœªæ¥äº‹åŠ¡)</td></tr><tr><td>101</td><td>in m_ids</td><td>âŒ ä¸å¯è§ (æœªæäº¤)</td></tr><tr><td>103</td><td>not in m_ids &amp;&amp; &lt; max_trx_id</td><td>âœ… å¯è§ (å·²æäº¤)</td></tr></tbody></table>
<p><strong>å¦‚æœå½“å‰ç‰ˆæœ¬ä¸å¯è§æ€ä¹ˆåŠ?</strong></p>
<p>é€šè¿‡DB_ROLL_PTRæ²¿ç€ç‰ˆæœ¬é“¾å‘å‰æŸ¥æ‰¾,ç›´åˆ°æ‰¾åˆ°å¯è§çš„ç‰ˆæœ¬ã€‚</p>
<h3 data-id="heading-20">3.4 ä¸åŒéš”ç¦»çº§åˆ«çš„Read Viewç”Ÿæˆæ—¶æœº</h3>
<p><strong>READ COMMITTED</strong>:</p>
<ul>
<li><strong>ç”Ÿæˆæ—¶æœº</strong>: æ¯æ¬¡SELECTéƒ½ç”Ÿæˆæ–°çš„Read View</li>
<li><strong>ç»“æœ</strong>: æ¯æ¬¡SELECTéƒ½èƒ½è¯»åˆ°æœ€æ–°å·²æäº¤çš„æ•°æ®</li>
<li><strong>é—®é¢˜</strong>: å¯¼è‡´ä¸å¯é‡å¤è¯»</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- äº‹åŠ¡A (RCéš”ç¦»çº§åˆ«)</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- Read View 1: balance=1000</span>

<span class="hljs-comment">-- äº‹åŠ¡B</span>
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> <span class="hljs-number">500</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- äº‹åŠ¡A</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- Read View 2: balance=500 (ä¸å¯é‡å¤è¯»!)</span>
</code></pre>
<p><strong>REPEATABLE READ</strong>:</p>
<ul>
<li><strong>ç”Ÿæˆæ—¶æœº</strong>: äº‹åŠ¡ç¬¬ä¸€æ¬¡SELECTæ—¶ç”ŸæˆRead View,åç»­SELECTå¤ç”¨åŒä¸€ä¸ª</li>
<li><strong>ç»“æœ</strong>: åŒä¸€äº‹åŠ¡å†…å¤šæ¬¡SELECTç»“æœä¸€è‡´</li>
<li><strong>ä¼˜åŠ¿</strong>: ä¿è¯å¯é‡å¤è¯»</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- äº‹åŠ¡A (RRéš”ç¦»çº§åˆ«)</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- Read View 1: balance=1000</span>

<span class="hljs-comment">-- äº‹åŠ¡B</span>
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> <span class="hljs-number">500</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- äº‹åŠ¡A</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- å¤ç”¨Read View 1: balance=1000 (å¯é‡å¤è¯»!)</span>
</code></pre>
<h3 data-id="heading-21">3.5 MVCC + é”è§£å†³å¹»è¯»</h3>
<p><strong>MVCCåªèƒ½è§£å†³å¿«ç…§è¯»çš„å¹»è¯»,ä¸èƒ½è§£å†³å½“å‰è¯»çš„å¹»è¯»</strong></p>
<ul>
<li><strong>å¿«ç…§è¯»(Snapshot Read)</strong>: æ™®é€šSELECT,ä½¿ç”¨MVCC,è¯»å–å†å²ç‰ˆæœ¬</li>
<li><strong>å½“å‰è¯»(Current Read)</strong>: SELECT ... FOR UPDATEã€UPDATEã€DELETE,åŠ é”,è¯»å–æœ€æ–°ç‰ˆæœ¬</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- äº‹åŠ¡A (RRéš”ç¦»çº§åˆ«)</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-comment">-- å¿«ç…§è¯»: MVCC,è¯»å–å†å²ç‰ˆæœ¬</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- å‡è®¾100æ¡</span>

<span class="hljs-comment">-- äº‹åŠ¡B</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> orders <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">101</span>, <span class="hljs-number">1</span>, ...); <span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- äº‹åŠ¡A: å¿«ç…§è¯»</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- ä»ç„¶100æ¡ (MVCC,çœ‹ä¸åˆ°æ–°æ’å…¥çš„è¡Œ)</span>

<span class="hljs-comment">-- äº‹åŠ¡A: å½“å‰è¯»</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>; <span class="hljs-comment">-- 101æ¡ (Next-Key Lock,èƒ½çœ‹åˆ°,å¹»è¯»!)</span>

<span class="hljs-comment">-- äº‹åŠ¡A: UPDATEè§¦å‘å½“å‰è¯»</span>
<span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> amount <span class="hljs-operator">=</span> amount <span class="hljs-operator">+</span> <span class="hljs-number">100</span> <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">-- å½±å“101è¡Œ (å¹»è¯»!)</span>
</code></pre>
<p><strong>Next-Key Lockè§£å†³å½“å‰è¯»çš„å¹»è¯»</strong> (è¯¦è§ç¬¬å››ç« )</p>
<hr/>
<h2 data-id="heading-22">å››ã€InnoDBé”æœºåˆ¶è¯¦è§£</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/028d9f1618f2453ab789dfa5d0ff4116~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885669&amp;x-signature=%2FNpUfXcZ0bGw1jm33wcSNoHfjtg%3D" alt="innodb-lock-types.svg" loading="lazy"/></p>
<h3 data-id="heading-23">4.1 é”çš„åˆ†ç±»</h3>
<h4 data-id="heading-24">4.1.1 æŒ‰ç²’åº¦åˆ†ç±»</h4>
<p><strong>è¡¨é” (Table Lock)</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>: é”å®šæ•´å¼ è¡¨,å¼€é”€å°,åŠ é”å¿«,ä¸ä¼šå‡ºç°æ­»é”</li>
<li><strong>ç¼ºç‚¹</strong>: é”ç²’åº¦å¤§,å¹¶å‘åº¦ä½</li>
<li><strong>ä½¿ç”¨åœºæ™¯</strong>: MyISAMå¼•æ“,æ•´è¡¨æ•°æ®è¿ç§»</li>
<li><strong>ç¤ºä¾‹</strong>:
<pre><code class="hljs language-sql" lang="sql">LOCK <span class="hljs-keyword">TABLE</span> orders READ;   <span class="hljs-comment">-- è¯»é”</span>
LOCK <span class="hljs-keyword">TABLE</span> orders WRITE;  <span class="hljs-comment">-- å†™é”</span>
UNLOCK TABLES;            <span class="hljs-comment">-- é‡Šæ”¾é”</span>
</code></pre>
</li>
</ul>
<p><strong>è¡Œé” (Row Lock)</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>: é”å®šå•è¡Œæˆ–å¤šè¡Œ,å¼€é”€å¤§,åŠ é”æ…¢,å¯èƒ½å‡ºç°æ­»é”</li>
<li><strong>ä¼˜ç‚¹</strong>: é”ç²’åº¦å°,å¹¶å‘åº¦é«˜</li>
<li><strong>ä½¿ç”¨åœºæ™¯</strong>: InnoDBå¼•æ“é»˜è®¤</li>
<li><strong>ç¤ºä¾‹</strong>:
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>; <span class="hljs-comment">-- é”å®šid=10è¿™ä¸€è¡Œ</span>
</code></pre>
</li>
</ul>
<h4 data-id="heading-25">4.1.2 æŒ‰æ¨¡å¼åˆ†ç±»</h4>
<p><strong>å…±äº«é” (Shared Lock, Sé”)</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>: è¯»é”,å¤šä¸ªäº‹åŠ¡å¯åŒæ—¶æŒæœ‰åŒä¸€è¡Œçš„Sé”</li>
<li><strong>å…¼å®¹æ€§</strong>: Sé”ä¸Sé”å…¼å®¹,Sé”ä¸Xé”äº’æ–¥</li>
<li><strong>åŠ é”æ–¹å¼</strong>:
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> LOCK <span class="hljs-keyword">IN</span> SHARE MODE;
</code></pre>
</li>
</ul>
<p><strong>æ’ä»–é” (Exclusive Lock, Xé”)</strong></p>
<ul>
<li><strong>ç‰¹ç‚¹</strong>: å†™é”,åªæœ‰ä¸€ä¸ªäº‹åŠ¡å¯æŒæœ‰Xé”</li>
<li><strong>å…¼å®¹æ€§</strong>: Xé”ä¸æ‰€æœ‰é”äº’æ–¥</li>
<li><strong>åŠ é”æ–¹å¼</strong>:
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span>; <span class="hljs-comment">-- è‡ªåŠ¨åŠ Xé”</span>
<span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;           <span class="hljs-comment">-- è‡ªåŠ¨åŠ Xé”</span>
</code></pre>
</li>
</ul>
<p><strong>é”å…¼å®¹æ€§çŸ©é˜µ</strong>:</p>




















<table><thead><tr><th/><th>Sé”</th><th>Xé”</th></tr></thead><tbody><tr><td><strong>Sé”</strong></td><td>âœ… å…¼å®¹</td><td>âŒ äº’æ–¥</td></tr><tr><td><strong>Xé”</strong></td><td>âŒ äº’æ–¥</td><td>âŒ äº’æ–¥</td></tr></tbody></table>
<h3 data-id="heading-26">4.2 InnoDBè¡Œé”ç±»å‹</h3>
<h4 data-id="heading-27">4.2.1 è®°å½•é” (Record Lock)</h4>
<p><strong>å®šä¹‰</strong>: é”å®šå•ä¸ªç´¢å¼•è®°å½•,ä¸é”å®šè®°å½•ä¹‹é—´çš„é—´éš™</p>
<p><strong>ç¤ºä¾‹</strong> (è¯¦è§ä¸Šå›¾):</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å‡è®¾accountè¡¨æœ‰ä¸»é”®ç´¢å¼• id = [3, 10, 20, 30]</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
</code></pre>
<p><strong>é”å®šèŒƒå›´</strong>: åªé”å®šid=10è¿™ä¸€æ¡è®°å½•</p>
<p><strong>ç‰¹ç‚¹</strong>:</p>
<ul>
<li>âœ… å…¶ä»–äº‹åŠ¡å¯ä»¥åœ¨é—´éš™(3, 10)ã€(10, 20)ä¸­æ’å…¥æ–°è®°å½•</li>
<li>âŒ å…¶ä»–äº‹åŠ¡æ— æ³•UPDATE/DELETE id=10çš„è®°å½•</li>
</ul>
<h4 data-id="heading-28">4.2.2 é—´éš™é” (Gap Lock)</h4>
<p><strong>å®šä¹‰</strong>: é”å®šç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™,ä¸é”å®šè®°å½•æœ¬èº«,é˜²æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥æ•°æ®(é˜²æ­¢å¹»è¯»)</p>
<p><strong>ç¤ºä¾‹</strong> (è¯¦è§ä¸Šå›¾):</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- REPEATABLE READéš”ç¦»çº§åˆ«</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> <span class="hljs-keyword">AND</span> id <span class="hljs-operator">&lt;</span> <span class="hljs-number">20</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
</code></pre>
<p><strong>é”å®šèŒƒå›´</strong>: é”å®šé—´éš™(10, 20),ä¸åŒ…æ‹¬id=10å’Œid=20</p>
<p><strong>ç‰¹ç‚¹</strong>:</p>
<ul>
<li>âœ… é˜²æ­¢åœ¨(10, 20)èŒƒå›´å†…æ’å…¥æ–°è®°å½•</li>
<li>âŒ å…¶ä»–äº‹åŠ¡æ— æ³•æ‰§è¡Œ<code>INSERT INTO account VALUES(15, ...)</code></li>
<li>âœ… å…¶ä»–äº‹åŠ¡å¯ä»¥UPDATE/DELETE id=10æˆ–id=20çš„è®°å½•</li>
</ul>
<p><strong>âš ï¸ é‡è¦</strong>: é—´éš™é”åªåœ¨REPEATABLE READéš”ç¦»çº§åˆ«ä¸‹ç”Ÿæ•ˆ</p>
<h4 data-id="heading-29">4.2.3 Next-Key Lock(ä¸´é”®é”)</h4>
<p><strong>å®šä¹‰</strong>: è®°å½•é” + é—´éš™é”çš„ç»„åˆ,é”å®šä¸€ä¸ªèŒƒå›´å¹¶é”å®šè®°å½•æœ¬èº«</p>
<p><strong>InnoDBé»˜è®¤è¡Œé”ç±»å‹</strong>: Next-Key Lock</p>
<p><strong>ç¤ºä¾‹</strong> (è¯¦è§ä¸Šå›¾):</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- REPEATABLE READéš”ç¦»çº§åˆ«</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">AND</span> id <span class="hljs-operator">&lt;</span> <span class="hljs-number">20</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
</code></pre>
<p><strong>é”å®šèŒƒå›´</strong>: [10, 20),åŒ…æ‹¬id=10(è®°å½•é”) + é—´éš™(10, 20)(é—´éš™é”)</p>
<p><strong>ç‰¹ç‚¹</strong>:</p>
<ul>
<li>âŒ å…¶ä»–äº‹åŠ¡æ— æ³•UPDATE/DELETE id=10çš„è®°å½•</li>
<li>âŒ å…¶ä»–äº‹åŠ¡æ— æ³•åœ¨(10, 20)èŒƒå›´å†…æ’å…¥æ–°è®°å½•</li>
</ul>
<p><strong>Next-Key LockèŒƒå›´è®¡ç®—è§„åˆ™</strong>:</p>
<p>å‡è®¾ç´¢å¼•å€¼ä¸º [3, 10, 20, 30],æŸ¥è¯¢æ¡ä»¶ <code>id &gt;= 10 AND id &lt; 20</code>:</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">Next</span>-<span class="hljs-keyword">Key</span> LockèŒƒå›´: (<span class="hljs-number">3</span>, <span class="hljs-number">10</span>] + (<span class="hljs-number">10</span>, <span class="hljs-number">20</span>) = (<span class="hljs-number">3</span>, <span class="hljs-number">20</span>)
</code></pre>
<h4 data-id="heading-30">4.2.4 æ’å…¥æ„å‘é” (Insert Intention Lock)</h4>
<p><strong>å®šä¹‰</strong>: ç‰¹æ®Šçš„é—´éš™é”,å¤šä¸ªäº‹åŠ¡å¯åœ¨åŒä¸€é—´éš™å¹¶å‘æ’å…¥(ä¸åŒä½ç½®)</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- äº‹åŠ¡A</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> account <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">15</span>, ...); <span class="hljs-comment">-- åœ¨é—´éš™(10, 20)ä¸­æ’å…¥</span>

<span class="hljs-comment">-- äº‹åŠ¡B</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> account <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">18</span>, ...); <span class="hljs-comment">-- åœ¨åŒä¸€é—´éš™(10, 20)ä¸­æ’å…¥,ä¸é˜»å¡</span>
</code></pre>
<h3 data-id="heading-31">4.3 æ„å‘é” (Intention Lock)</h3>
<p><strong>å®šä¹‰</strong>: è¡¨çº§é”,ç”±InnoDBè‡ªåŠ¨æ·»åŠ ,ç”¨äºå¿«é€Ÿåˆ¤æ–­è¡¨æ˜¯å¦è¢«é”å®š</p>
<p><strong>ä¸¤ç§æ„å‘é”</strong>:</p>
<ul>
<li><strong>ISé”(Intention Shared Lock)</strong>: äº‹åŠ¡æƒ³è¦è·å–è¡¨ä¸­æŸäº›è¡Œçš„Sé”</li>
<li><strong>IXé”(Intention Exclusive Lock)</strong>: äº‹åŠ¡æƒ³è¦è·å–è¡¨ä¸­æŸäº›è¡Œçš„Xé”</li>
</ul>
<p><strong>ä½œç”¨</strong>: é¿å…åœ¨åŠ è¡¨é”æ—¶é€è¡Œæ£€æŸ¥æ˜¯å¦æœ‰è¡Œé”</p>
<p><strong>é”å…¼å®¹æ€§çŸ©é˜µ</strong>:</p>








































<table><thead><tr><th/><th>IS</th><th>IX</th><th>S</th><th>X</th></tr></thead><tbody><tr><td><strong>IS</strong></td><td>âœ…</td><td>âœ…</td><td>âœ…</td><td>âŒ</td></tr><tr><td><strong>IX</strong></td><td>âœ…</td><td>âœ…</td><td>âŒ</td><td>âŒ</td></tr><tr><td><strong>S</strong></td><td>âœ…</td><td>âŒ</td><td>âœ…</td><td>âŒ</td></tr><tr><td><strong>X</strong></td><td>âŒ</td><td>âŒ</td><td>âŒ</td><td>âŒ</td></tr></tbody></table>
<h3 data-id="heading-32">4.4 é”çš„åŠ é”è§„åˆ™</h3>
<p><strong>1. å”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è®°å½•å­˜åœ¨</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-comment">-- åŠ é”: è®°å½•é” (åªé”id=10)</span>

<span class="hljs-comment">-- è®°å½•ä¸å­˜åœ¨</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">15</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-comment">-- åŠ é”: é—´éš™é” (10, 20)</span>
</code></pre>
<p><strong>2. å”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> <span class="hljs-keyword">AND</span> id <span class="hljs-operator">&lt;</span> <span class="hljs-number">20</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-comment">-- åŠ é”: Next-Key Lock (10, 20]</span>
</code></pre>
<p><strong>3. éå”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å‡è®¾nameå­—æ®µæœ‰éå”¯ä¸€ç´¢å¼•</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-comment">-- åŠ é”: Next-Key Lock + é—´éš™é”</span>
</code></pre>
<p><strong>4. éå”¯ä¸€ç´¢å¼•èŒƒå›´æŸ¥è¯¢</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'Alice'</span> <span class="hljs-keyword">AND</span> name <span class="hljs-operator">&lt;</span> <span class="hljs-string">'Bob'</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-comment">-- åŠ é”: Next-Key Lock</span>
</code></pre>
<p><strong>5. æ— ç´¢å¼•æŸ¥è¯¢</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- balanceå­—æ®µæ— ç´¢å¼•</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> balance <span class="hljs-operator">&gt;</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-comment">-- åŠ é”: å…¨è¡¨æ‰«æ,é”å®šæ‰€æœ‰è®°å½• (ç›¸å½“äºè¡¨é”)</span>
</code></pre>
<p><strong>âš ï¸ é‡è¦</strong>: æ— ç´¢å¼•è¡Œé”ä¼šå‡çº§ä¸ºè¡¨é”,ä¸¥é‡å½±å“å¹¶å‘æ€§èƒ½!</p>
<h3 data-id="heading-33">4.5 æ­»é”é—®é¢˜</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/983e758638ce4b43a922b42b9a6874ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885669&amp;x-signature=XDJTHssbWCowrXqQ3aA0gi3IezI%3D" alt="deadlock-scenario.svg" loading="lazy"/></p>
<h4 data-id="heading-34">4.5.1 æ­»é”äº§ç”Ÿçš„å››ä¸ªå¿…è¦æ¡ä»¶</h4>
<ol>
<li><strong>äº’æ–¥æ¡ä»¶</strong>: èµ„æºä¸èƒ½è¢«å¤šä¸ªäº‹åŠ¡åŒæ—¶ä½¿ç”¨</li>
<li><strong>è¯·æ±‚ä¸ä¿æŒæ¡ä»¶</strong>: äº‹åŠ¡æŒæœ‰éƒ¨åˆ†èµ„æº,åŒæ—¶è¯·æ±‚æ–°èµ„æº</li>
<li><strong>ä¸å‰¥å¤ºæ¡ä»¶</strong>: å·²è·å¾—çš„èµ„æºåœ¨æœªä½¿ç”¨å®Œå‰ä¸èƒ½è¢«å¼ºè¡Œå‰¥å¤º</li>
<li><strong>å¾ªç¯ç­‰å¾…æ¡ä»¶</strong>: äº‹åŠ¡å½¢æˆç¯è·¯,æ¯ä¸ªäº‹åŠ¡éƒ½åœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªäº‹åŠ¡é‡Šæ”¾èµ„æº</li>
</ol>
<h4 data-id="heading-35">4.5.2 æ­»é”ç¤ºä¾‹</h4>
<p><strong>åœºæ™¯</strong>: ä¸¤ä¸ªäº‹åŠ¡ä»¥ä¸åŒé¡ºåºé”å®šèµ„æº(è¯¦è§ä¸Šå›¾)</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- äº‹åŠ¡1</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span>; <span class="hljs-comment">-- æŒæœ‰id=10çš„é”</span>
<span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">20</span>; <span class="hljs-comment">-- ç­‰å¾…id=20çš„é” (é˜»å¡)</span>
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- äº‹åŠ¡2</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">20</span>; <span class="hljs-comment">-- æŒæœ‰id=20çš„é”</span>
<span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span>; <span class="hljs-comment">-- ç­‰å¾…id=10çš„é” (é˜»å¡) â†’ æ­»é”!</span>
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<p><strong>æ­»é”æ£€æµ‹</strong>: InnoDBè‡ªåŠ¨æ£€æµ‹åˆ°å¾ªç¯ç­‰å¾…,é€‰æ‹©å›æ»šä»£ä»·å°çš„äº‹åŠ¡(äº‹åŠ¡2)</p>
<h4 data-id="heading-36">4.5.3 å¦‚ä½•é¿å…æ­»é”</h4>
<p><strong>1. ç»Ÿä¸€é”å®šé¡ºåº</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯: ä¸åŒé¡ºåºé”å®š</span>
<span class="hljs-comment">// çº¿ç¨‹A</span>
updateOrder(<span class="hljs-number">10</span>);
updateOrder(<span class="hljs-number">20</span>);

<span class="hljs-comment">// çº¿ç¨‹B</span>
updateOrder(<span class="hljs-number">20</span>);
updateOrder(<span class="hljs-number">10</span>);

<span class="hljs-comment">// âœ… æ­£ç¡®: ç»Ÿä¸€é¡ºåºé”å®š</span>
List&lt;Long&gt; orderIds = Arrays.asList(<span class="hljs-number">10L</span>, <span class="hljs-number">20L</span>);
Collections.sort(orderIds); <span class="hljs-comment">// æ’åº,ä¿è¯é¡ºåºä¸€è‡´</span>
<span class="hljs-keyword">for</span> (Long id : orderIds) {
    updateOrder(id);
}
</code></pre>
<p><strong>2. å°½é‡ä½¿ç”¨ç´¢å¼•è®¿é—®æ•°æ®</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ— ç´¢å¼•,é”å…¨è¡¨</span>
<span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> user_name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>;

<span class="hljs-comment">-- âœ… æœ‰ç´¢å¼•,åªé”éƒ¨åˆ†è¡Œ</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_name (user_name);
<span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> user_name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>;
</code></pre>
<p><strong>3. ç¼©çŸ­äº‹åŠ¡æŒç»­æ—¶é—´</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯: äº‹åŠ¡ä¸­åŒ…å«RPCè°ƒç”¨</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(Long orderId)</span> {
    orderMapper.updateStatus(orderId, OrderStatus.PAID);

    <span class="hljs-comment">// RPCè°ƒç”¨,è€—æ—¶é•¿,é•¿æ—¶é—´æŒæœ‰é”!</span>
    inventoryService.deduct(orderId);

    pointsMapper.add(orderId);
}

<span class="hljs-comment">// âœ… æ­£ç¡®: RPCè°ƒç”¨ç§»åˆ°äº‹åŠ¡å¤–</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">(Long orderId)</span> {
    <span class="hljs-comment">// äº‹åŠ¡å¤–è°ƒç”¨RPC</span>
    <span class="hljs-type">InventoryResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> inventoryService.deduct(orderId);

    <span class="hljs-comment">// äº‹åŠ¡å†…å¿«é€Ÿæäº¤</span>
    updateOrderInTransaction(orderId, result);
}

<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateOrderInTransaction</span><span class="hljs-params">(Long orderId, InventoryResult result)</span> {
    orderMapper.updateStatus(orderId, OrderStatus.PAID);
    pointsMapper.add(orderId);
}
</code></pre>
<p><strong>4. è®¾ç½®é”ç­‰å¾…è¶…æ—¶æ—¶é—´</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥çœ‹é”ç­‰å¾…è¶…æ—¶æ—¶é—´ (é»˜è®¤50ç§’)</span>
<span class="hljs-keyword">SHOW</span> VARIABLES <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'innodb_lock_wait_timeout'</span>;

<span class="hljs-comment">-- è®¾ç½®é”ç­‰å¾…è¶…æ—¶æ—¶é—´</span>
<span class="hljs-keyword">SET</span> innodb_lock_wait_timeout <span class="hljs-operator">=</span> <span class="hljs-number">10</span>; <span class="hljs-comment">-- 10ç§’</span>
</code></pre>
<h4 data-id="heading-37">4.5.4 æŸ¥çœ‹æ­»é”æ—¥å¿—</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥çœ‹æœ€è¿‘ä¸€æ¬¡æ­»é”ä¿¡æ¯</span>
<span class="hljs-keyword">SHOW</span> ENGINE INNODB STATUS\G;

<span class="hljs-comment">-- è¾“å‡ºç¤ºä¾‹</span>
<span class="hljs-comment">------------------------</span>
LATEST DETECTED DEADLOCK
<span class="hljs-comment">------------------------</span>
<span class="hljs-number">2024</span><span class="hljs-number">-10</span><span class="hljs-number">-21</span> <span class="hljs-number">10</span>:<span class="hljs-number">30</span>:<span class="hljs-number">15</span> <span class="hljs-number">0x7f8b8c0c9700</span>
<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> (<span class="hljs-number">1</span>) TRANSACTION:
TRANSACTION <span class="hljs-number">12345</span>, ACTIVE <span class="hljs-number">5</span> sec starting index read
mysql tables <span class="hljs-keyword">in</span> use <span class="hljs-number">1</span>, locked <span class="hljs-number">1</span>
LOCK WAIT <span class="hljs-number">2</span> lock struct(s), heap size <span class="hljs-number">1136</span>, <span class="hljs-number">1</span> <span class="hljs-type">row</span> lock(s)
MySQL thread id <span class="hljs-number">10</span>, OS thread handle <span class="hljs-number">140237</span>, query id <span class="hljs-number">1000</span> localhost root updating
<span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">20</span>
<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> (<span class="hljs-number">1</span>) WAITING <span class="hljs-keyword">FOR</span> THIS LOCK <span class="hljs-keyword">TO</span> BE GRANTED:
RECORD LOCKS space id <span class="hljs-number">100</span> page <span class="hljs-keyword">no</span> <span class="hljs-number">3</span> n bits <span class="hljs-number">72</span> index <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">table</span> `test`.`orders` trx id <span class="hljs-number">12345</span> lock_mode X locks rec but <span class="hljs-keyword">not</span> gap waiting
Record lock, heap <span class="hljs-keyword">no</span> <span class="hljs-number">5</span> PHYSICAL RECORD: n_fields <span class="hljs-number">5</span>; compact format; info bits <span class="hljs-number">0</span>

<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> (<span class="hljs-number">2</span>) TRANSACTION:
TRANSACTION <span class="hljs-number">12346</span>, ACTIVE <span class="hljs-number">3</span> sec starting index read
mysql tables <span class="hljs-keyword">in</span> use <span class="hljs-number">1</span>, locked <span class="hljs-number">1</span>
<span class="hljs-number">2</span> lock struct(s), heap size <span class="hljs-number">1136</span>, <span class="hljs-number">1</span> <span class="hljs-type">row</span> lock(s)
MySQL thread id <span class="hljs-number">11</span>, OS thread handle <span class="hljs-number">140238</span>, query id <span class="hljs-number">1001</span> localhost root updating
<span class="hljs-keyword">UPDATE</span> orders <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-number">2</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span>
<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> (<span class="hljs-number">2</span>) HOLDS THE LOCK(S):
RECORD LOCKS space id <span class="hljs-number">100</span> page <span class="hljs-keyword">no</span> <span class="hljs-number">3</span> n bits <span class="hljs-number">72</span> index <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">table</span> `test`.`orders` trx id <span class="hljs-number">12346</span> lock_mode X locks rec but <span class="hljs-keyword">not</span> gap
Record lock, heap <span class="hljs-keyword">no</span> <span class="hljs-number">5</span> PHYSICAL RECORD: n_fields <span class="hljs-number">5</span>; compact format; info bits <span class="hljs-number">0</span>

<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> (<span class="hljs-number">2</span>) WAITING <span class="hljs-keyword">FOR</span> THIS LOCK <span class="hljs-keyword">TO</span> BE GRANTED:
RECORD LOCKS space id <span class="hljs-number">100</span> page <span class="hljs-keyword">no</span> <span class="hljs-number">3</span> n bits <span class="hljs-number">72</span> index <span class="hljs-keyword">PRIMARY</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">table</span> `test`.`orders` trx id <span class="hljs-number">12346</span> lock_mode X locks rec but <span class="hljs-keyword">not</span> gap waiting
Record lock, heap <span class="hljs-keyword">no</span> <span class="hljs-number">4</span> PHYSICAL RECORD: n_fields <span class="hljs-number">5</span>; compact format; info bits <span class="hljs-number">0</span>

<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> WE ROLL BACK TRANSACTION (<span class="hljs-number">2</span>)
</code></pre>
<hr/>
<h2 data-id="heading-38">äº”ã€å®æˆ˜åœºæ™¯åº”ç”¨</h2>
<h3 data-id="heading-39">5.1 åœºæ™¯1: ç”µå•†åº“å­˜æ‰£å‡å¹¶å‘é—®é¢˜</h3>
<p><strong>ä¸šåŠ¡èƒŒæ™¯</strong>: è®¢å•ä¸‹å•æ—¶æ‰£å‡åº“å­˜,é«˜å¹¶å‘ä¸‹å¯èƒ½è¶…å–</p>
<p><strong>æ–¹æ¡ˆå¯¹æ¯”</strong>:</p>
<h4 data-id="heading-40">æ–¹æ¡ˆA: æ‚²è§‚é” (SELECT ... FOR UPDATE)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long skuId, Integer quantity)</span> {
    <span class="hljs-comment">// 1. æ‚²è§‚é”æŸ¥è¯¢åº“å­˜</span>
    <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productMapper.selectForUpdate(skuId);

    <span class="hljs-comment">// 2. æ£€æŸ¥åº“å­˜</span>
    <span class="hljs-keyword">if</span> (product.getStock() &lt; quantity) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"åº“å­˜ä¸è¶³"</span>);
    }

    <span class="hljs-comment">// 3. æ‰£å‡åº“å­˜</span>
    productMapper.deductStock(skuId, quantity);

    <span class="hljs-comment">// 4. åˆ›å»ºè®¢å•</span>
    orderMapper.insert(order);
}
</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- productMapper.selectForUpdate</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> product <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> #{skuId} <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;

<span class="hljs-comment">-- productMapper.deductStock</span>
<span class="hljs-keyword">UPDATE</span> product <span class="hljs-keyword">SET</span> stock <span class="hljs-operator">=</span> stock <span class="hljs-operator">-</span> #{quantity} <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> #{skuId};
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>:</p>
<ul>
<li>âœ… å¼ºä¸€è‡´æ€§,ç»å¯¹ä¸ä¼šè¶…å–</li>
<li>âœ… å®ç°ç®€å•,é€»è¾‘æ¸…æ™°</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>:</p>
<ul>
<li>âŒ å¹¶å‘æ€§èƒ½å·®,æ‰€æœ‰è¯·æ±‚ä¸²è¡Œæ‰§è¡Œ</li>
<li>âŒ é«˜å¹¶å‘ä¸‹å¤§é‡è¯·æ±‚é˜»å¡</li>
</ul>
<h4 data-id="heading-41">æ–¹æ¡ˆB: ä¹è§‚é” (versionå­—æ®µ)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long skuId, Integer quantity)</span> {
    <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (retryCount &lt; <span class="hljs-number">3</span>) {
        <span class="hljs-comment">// 1. æŸ¥è¯¢åº“å­˜å’Œç‰ˆæœ¬å·</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productMapper.selectById(skuId);

        <span class="hljs-comment">// 2. æ£€æŸ¥åº“å­˜</span>
        <span class="hljs-keyword">if</span> (product.getStock() &lt; quantity) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"åº“å­˜ä¸è¶³"</span>);
        }

        <span class="hljs-comment">// 3. ä¹è§‚é”æ‰£å‡åº“å­˜</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> productMapper.deductStockWithVersion(
            skuId, quantity, product.getVersion()
        );

        <span class="hljs-keyword">if</span> (rows &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// 4. åˆ›å»ºè®¢å•</span>
            orderMapper.insert(order);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// ç‰ˆæœ¬å·ä¸åŒ¹é…,é‡è¯•</span>
        retryCount++;
        Thread.sleep(<span class="hljs-number">10</span>);
    }

    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"åº“å­˜æ‰£å‡å¤±è´¥,è¯·é‡è¯•"</span>);
}
</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- productMapper.deductStockWithVersion</span>
<span class="hljs-keyword">UPDATE</span> product
<span class="hljs-keyword">SET</span> stock <span class="hljs-operator">=</span> stock <span class="hljs-operator">-</span> #{quantity}, version <span class="hljs-operator">=</span> version <span class="hljs-operator">+</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> #{skuId} <span class="hljs-keyword">AND</span> version <span class="hljs-operator">=</span> #{version} <span class="hljs-keyword">AND</span> stock <span class="hljs-operator">&gt;=</span> #{quantity};
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>:</p>
<ul>
<li>âœ… å¹¶å‘æ€§èƒ½å¥½,æ— é˜»å¡</li>
<li>âœ… é€‚åˆå†²çªä¸é¢‘ç¹çš„åœºæ™¯</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>:</p>
<ul>
<li>âŒ éœ€è¦é‡è¯•æœºåˆ¶,å®ç°å¤æ‚</li>
<li>âŒ é«˜å¹¶å‘ä¸‹é‡è¯•æ¬¡æ•°å¤š,æ€§èƒ½ä¸‹é™</li>
</ul>
<h4 data-id="heading-42">æ–¹æ¡ˆC: æ•°æ®åº“çº¦æŸ (stock &gt;= 0)</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long skuId, Integer quantity)</span> {
    <span class="hljs-comment">// 1. ç›´æ¥æ‰£å‡åº“å­˜</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> productMapper.deductStock(skuId, quantity);

    <span class="hljs-comment">// 2. æ£€æŸ¥æ›´æ–°è¡Œæ•°</span>
    <span class="hljs-keyword">if</span> (rows == <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"åº“å­˜ä¸è¶³"</span>);
    }

    <span class="hljs-comment">// 3. åˆ›å»ºè®¢å•</span>
    orderMapper.insert(order);
}
</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- productMapper.deductStock</span>
<span class="hljs-keyword">UPDATE</span> product
<span class="hljs-keyword">SET</span> stock <span class="hljs-operator">=</span> stock <span class="hljs-operator">-</span> #{quantity}
<span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> #{skuId} <span class="hljs-keyword">AND</span> stock <span class="hljs-operator">&gt;=</span> #{quantity};
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>:</p>
<ul>
<li>âœ… å®ç°ç®€å•,æ€§èƒ½å¥½</li>
<li>âœ… æ— éœ€SELECT,å‡å°‘ä¸€æ¬¡æŸ¥è¯¢</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>:</p>
<ul>
<li>âŒ éœ€è¦æ£€æŸ¥æ›´æ–°å½±å“è¡Œæ•°</li>
<li>âŒ æ— æ³•æå‰åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</li>
</ul>
<p><strong>ä¸‰ç§æ–¹æ¡ˆæ€§èƒ½å¯¹æ¯”</strong>:</p>

































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>TPS (1000å¹¶å‘)</th><th>è¶…å–é£é™©</th><th>å®ç°å¤æ‚åº¦</th><th>æ¨èåº¦</th></tr></thead><tbody><tr><td>æ‚²è§‚é”</td><td>500 TPS</td><td>âŒ æ— </td><td>ç®€å•</td><td>â­â­â­</td></tr><tr><td>ä¹è§‚é”</td><td>3000 TPS</td><td>âŒ æ— </td><td>å¤æ‚</td><td>â­â­â­â­</td></tr><tr><td>æ•°æ®åº“çº¦æŸ</td><td>5000 TPS</td><td>âŒ æ— </td><td>ç®€å•</td><td>â­â­â­â­â­</td></tr></tbody></table>
<p><strong>æ¨è</strong>: ä¼˜å…ˆä½¿ç”¨æ–¹æ¡ˆC(æ•°æ®åº“çº¦æŸ),å®ç°ç®€å•,æ€§èƒ½æœ€ä¼˜</p>
<h3 data-id="heading-43">5.2 åœºæ™¯2: è®¢å•çŠ¶æ€æ›´æ–°çš„äº‹åŠ¡æ§åˆ¶</h3>
<p><strong>ä¸šåŠ¡èƒŒæ™¯</strong>: è®¢å•æ”¯ä»˜æˆåŠŸ,éœ€è¦æ›´æ–°è®¢å•çŠ¶æ€ã€æ‰£å‡åº“å­˜ã€å¢åŠ ç§¯åˆ†</p>
<p><strong>å®Œæ•´ä»£ç ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderItemMapper orderItemMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> InventoryMapper inventoryMapper;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> PointsMapper pointsMapper;

    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class, isolation = Isolation.REPEATABLE_READ)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateOrderAfterPay</span><span class="hljs-params">(Long orderId, PayDTO payDTO)</span> {
        <span class="hljs-comment">// 1. æŸ¥è¯¢è®¢å•</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> orderMapper.selectById(orderId);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"è®¢å•ä¸å­˜åœ¨"</span>);
        }

        <span class="hljs-comment">// 2. æ£€æŸ¥è®¢å•çŠ¶æ€</span>
        <span class="hljs-keyword">if</span> (order.getStatus() != OrderStatus.UNPAID) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"è®¢å•çŠ¶æ€å¼‚å¸¸"</span>);
        }

        <span class="hljs-comment">// 3. æ›´æ–°è®¢å•çŠ¶æ€</span>
        orderMapper.updateStatus(orderId, OrderStatus.PAID, payDTO.getPayTime());

        <span class="hljs-comment">// 4. æ‰£å‡åº“å­˜</span>
        List&lt;OrderItem&gt; items = orderItemMapper.selectByOrderId(orderId);
        <span class="hljs-keyword">for</span> (OrderItem item : items) {
            <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> inventoryMapper.deduct(item.getSkuId(), item.getQuantity());
            <span class="hljs-keyword">if</span> (rows == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"åº“å­˜ä¸è¶³: SKU="</span> + item.getSkuId());
            }
        }

        <span class="hljs-comment">// 5. å¢åŠ ç§¯åˆ†</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">points</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (payDTO.getAmount() / <span class="hljs-number">10</span>); <span class="hljs-comment">// æ¯æ¶ˆè´¹10å…ƒå¢åŠ 1ç§¯åˆ†</span>
        pointsMapper.add(payDTO.getUserId(), points);

        log.info(<span class="hljs-string">"è®¢å•æ”¯ä»˜æˆåŠŸå¤„ç†å®Œæˆ, orderId={}, userId={}, amount={}, points={}"</span>,
            orderId, payDTO.getUserId(), payDTO.getAmount(), points);
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>:</p>
<ol>
<li>
<p><strong>@Transactionalé…ç½®</strong>:</p>
<ul>
<li><code>rollbackFor = Exception.class</code>: æ‰€æœ‰å¼‚å¸¸éƒ½å›æ»š(åŒ…æ‹¬éRuntimeException)</li>
<li><code>isolation = Isolation.REPEATABLE_READ</code>: ä½¿ç”¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«</li>
</ul>
</li>
<li>
<p><strong>äº‹åŠ¡è¾¹ç•Œæ§åˆ¶</strong>:</p>
<ul>
<li>äº‹åŠ¡å†…åªåŒ…å«æ•°æ®åº“æ“ä½œ</li>
<li>RPCè°ƒç”¨ã€æ–‡ä»¶æ“ä½œç§»åˆ°äº‹åŠ¡å¤–</li>
</ul>
</li>
<li>
<p><strong>å¼‚å¸¸å¤„ç†</strong>:</p>
<ul>
<li>åº“å­˜ä¸è¶³æŠ›å‡ºå¼‚å¸¸,è§¦å‘äº‹åŠ¡å›æ»š</li>
<li>æ‰€æœ‰æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸ,è¦ä¹ˆå…¨éƒ¨å›æ»š</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-44">å…­ã€ç”Ÿäº§æ¡ˆä¾‹ä¸æ•…éšœæ’æŸ¥</h2>
<h3 data-id="heading-45">6.1 æ¡ˆä¾‹1: æ­»é”å¯¼è‡´çš„è®¢å•å¤„ç†å¤±è´¥</h3>
<p><strong>æ•…éšœç°è±¡</strong>:</p>
<ul>
<li>è®¢å•æ”¯ä»˜å,çŠ¶æ€æœªæ›´æ–°</li>
<li>åº”ç”¨æ—¥å¿—å‡ºç°å¤§é‡DeadlockLoserDataAccessException</li>
<li>ç”¨æˆ·æŠ•è¯‰è®¢å•æ”¯ä»˜æˆåŠŸä½†æ˜¾ç¤ºæœªæ”¯ä»˜</li>
</ul>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>:</p>
<p><strong>æ­¥éª¤1</strong>: æŸ¥çœ‹åº”ç”¨æ—¥å¿—</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-number">2024</span>-<span class="hljs-number">10</span>-<span class="hljs-number">21</span> <span class="hljs-number">10</span>:<span class="hljs-number">30</span>:<span class="hljs-number">15</span> <span class="hljs-keyword">ERROR</span> OrderService - è®¢å•æ›´æ–°å¤±è´¥, orderId=<span class="hljs-number">12345</span>
org.springframework.dao.DeadlockLoserDataAccessException:
PreparedStatementCallback; SQL [UPDATE orders <span class="hljs-keyword">SET</span> status=? <span class="hljs-keyword">WHERE</span> id=?];
Deadlock found <span class="hljs-keyword">when</span> trying <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> lock; <span class="hljs-keyword">try</span> restarting transaction
</code></pre>
<p><strong>æ­¥éª¤2</strong>: æŸ¥çœ‹MySQLæ­»é”æ—¥å¿—</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SHOW</span> ENGINE INNODB STATUS\G;
</code></pre>
<p>åˆ†ææ­»é”æ—¥å¿—,å®šä½åˆ°ä¸¤æ¡SQL:</p>
<pre><code class="hljs language-ini" lang="ini">äº‹åŠ¡1: UPDATE orders SET <span class="hljs-attr">status</span>=<span class="hljs-number">1</span> WHERE id=<span class="hljs-number">100</span><span class="hljs-comment">;</span>
        UPDATE order_items SET <span class="hljs-attr">status</span>=<span class="hljs-number">1</span> WHERE order_id=<span class="hljs-number">100</span><span class="hljs-comment">;</span>

äº‹åŠ¡2: UPDATE order_items SET <span class="hljs-attr">status</span>=<span class="hljs-number">1</span> WHERE order_id=<span class="hljs-number">100</span><span class="hljs-comment">;</span>
        UPDATE orders SET <span class="hljs-attr">status</span>=<span class="hljs-number">1</span> WHERE id=<span class="hljs-number">100</span><span class="hljs-comment">;</span>
</code></pre>
<p><strong>é—®é¢˜åˆ†æ</strong>:</p>
<ul>
<li>ä¸¤ä¸ªäº‹åŠ¡ä»¥ä¸åŒé¡ºåºé”å®šresources</li>
<li>äº‹åŠ¡1å…ˆé”orders,å†é”order_items</li>
<li>äº‹åŠ¡2å…ˆé”order_items,å†é”orders</li>
<li>å½¢æˆå¾ªç¯ç­‰å¾…,äº§ç”Ÿæ­»é”</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<p>ç»Ÿä¸€é”å®šé¡ºåº,å…ˆé”orders,å†é”order_items:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âœ… æ­£ç¡®: ç»Ÿä¸€é”å®šé¡ºåº</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateOrderStatus</span><span class="hljs-params">(Long orderId, Integer status)</span> {
    <span class="hljs-comment">// 1. å…ˆé”orders</span>
    orderMapper.updateStatus(orderId, status);

    <span class="hljs-comment">// 2. å†é”order_items</span>
    orderItemMapper.updateStatusByOrderId(orderId, status);
}
</code></pre>
<p><strong>æ•ˆæœ</strong>: æ­»é”é¢‘ç‡ä»æ¯å°æ—¶100æ¬¡é™åˆ°0</p>
<h3 data-id="heading-46">6.2 æ¡ˆä¾‹2: é•¿äº‹åŠ¡å¯¼è‡´çš„é”ç­‰å¾…</h3>
<p><strong>æ•…éšœç°è±¡</strong>:</p>
<ul>
<li>è®¢å•åˆ—è¡¨æŸ¥è¯¢å˜æ…¢,å¤§é‡è¶…æ—¶</li>
<li>åº”ç”¨CPUå’Œå†…å­˜æ­£å¸¸,ä½†å“åº”æ…¢</li>
<li>æ•°æ®åº“è¿æ¥æ± è€—å°½</li>
</ul>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>:</p>
<p><strong>æ­¥éª¤1</strong>: æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># Time: 2024-10-21T10:30:15.123456Z</span>
<span class="hljs-comment"># Query_time: 30.521234  Lock_time: 30.000123</span>
SELECT * FROM orders WHERE <span class="hljs-attr">user_id</span> = <span class="hljs-number">100</span><span class="hljs-comment">;</span>
</code></pre>
<p>Lock_time=30ç§’,è¯´æ˜åœ¨ç­‰å¾…é”!</p>
<p><strong>æ­¥éª¤2</strong>: æŸ¥çœ‹å½“å‰äº‹åŠ¡å’Œé”</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥çœ‹å½“å‰æ´»è·ƒäº‹åŠ¡</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.innodb_trx\G;

<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>
                    trx_id: <span class="hljs-number">12345</span>
                 trx_state: <span class="hljs-keyword">RUNNING</span>
               trx_started: <span class="hljs-number">2024</span><span class="hljs-number">-10</span><span class="hljs-number">-21</span> <span class="hljs-number">10</span>:<span class="hljs-number">25</span>:<span class="hljs-number">00</span>
     trx_requested_lock_id: <span class="hljs-keyword">NULL</span>
          trx_wait_started: <span class="hljs-keyword">NULL</span>
                trx_weight: <span class="hljs-number">0</span>
       trx_mysql_thread_id: <span class="hljs-number">100</span>
                 trx_query: <span class="hljs-keyword">NULL</span>
       trx_operation_state: <span class="hljs-keyword">NULL</span>
         trx_tables_in_use: <span class="hljs-number">0</span>
         trx_tables_locked: <span class="hljs-number">1</span>
          trx_lock_structs: <span class="hljs-number">1</span>
     trx_lock_memory_bytes: <span class="hljs-number">1136</span>
           trx_rows_locked: <span class="hljs-number">100</span>
         trx_rows_modified: <span class="hljs-number">0</span>
   trx_concurrency_tickets: <span class="hljs-number">0</span>
       trx_isolation_level: REPEATABLE READ
         trx_unique_checks: <span class="hljs-number">1</span>
    trx_foreign_key_checks: <span class="hljs-number">1</span>
trx_last_foreign_key_error: <span class="hljs-keyword">NULL</span>
 trx_adaptive_hash_latched: <span class="hljs-number">0</span>
 trx_adaptive_hash_timeout: <span class="hljs-number">0</span>
          trx_is_read_only: <span class="hljs-number">0</span>
trx_autocommit_non_locking: <span class="hljs-number">0</span>
       trx_schedule_weight: <span class="hljs-keyword">NULL</span>
</code></pre>
<p>å‘ç°ä¸€ä¸ªäº‹åŠ¡å·²è¿è¡Œ5åˆ†é’Ÿ(10:25:00 - 10:30:00),æœªæäº¤!</p>
<p><strong>æ­¥éª¤3</strong>: æŸ¥çœ‹é”ç­‰å¾…</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.innodb_lock_waits\G;

<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span> <span class="hljs-number">1.</span> <span class="hljs-type">row</span> <span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>
requesting_trx_id: <span class="hljs-number">12346</span>
requested_lock_id: <span class="hljs-number">12346</span>:<span class="hljs-number">100</span>:<span class="hljs-number">3</span>:<span class="hljs-number">5</span>
  blocking_trx_id: <span class="hljs-number">12345</span>
 blocking_lock_id: <span class="hljs-number">12345</span>:<span class="hljs-number">100</span>:<span class="hljs-number">3</span>:<span class="hljs-number">5</span>
</code></pre>
<p>äº‹åŠ¡12346è¢«äº‹åŠ¡12345é˜»å¡ã€‚</p>
<p><strong>æ­¥éª¤4</strong>: æŸ¥çœ‹é˜»å¡çº¿ç¨‹çš„SQL</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">FULL</span> PROCESSLIST;

<span class="hljs-operator">+</span><span class="hljs-comment">-----+------+-----------+------+---------+------+-------+------------------+</span>
<span class="hljs-operator">|</span> Id  <span class="hljs-operator">|</span> <span class="hljs-keyword">User</span> <span class="hljs-operator">|</span> Host      <span class="hljs-operator">|</span> db   <span class="hljs-operator">|</span> Command <span class="hljs-operator">|</span> <span class="hljs-type">Time</span> <span class="hljs-operator">|</span> State <span class="hljs-operator">|</span> Info             <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-----+------+-----------+------+---------+------+-------+------------------+</span>
<span class="hljs-operator">|</span> <span class="hljs-number">100</span> <span class="hljs-operator">|</span> root <span class="hljs-operator">|</span> localhost <span class="hljs-operator">|</span> test <span class="hljs-operator">|</span> Sleep   <span class="hljs-operator">|</span> <span class="hljs-number">300</span>  <span class="hljs-operator">|</span>       <span class="hljs-operator">|</span> <span class="hljs-keyword">NULL</span>             <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">-----+------+-----------+------+---------+------+-------+------------------+</span>
</code></pre>
<p>çº¿ç¨‹100å¤„äºSleepçŠ¶æ€,å·²è¿è¡Œ300ç§’!</p>
<p><strong>é—®é¢˜åˆ†æ</strong>:</p>
<ul>
<li>å¼€å‘äººå‘˜åœ¨æµ‹è¯•ç¯å¢ƒæ‰‹åŠ¨BEGIN,æ‰§è¡ŒUPDATEåæœªCOMMIT</li>
<li>é•¿æ—¶é—´æŒæœ‰é”,é˜»å¡å…¶ä»–æŸ¥è¯¢</li>
<li>è¿æ¥æ± è¢«è€—å°½,æ–°è¯·æ±‚æ— æ³•è·å–è¿æ¥</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<p><strong>ä¸´æ—¶æ–¹æ¡ˆ</strong>: KILLæ‰é•¿äº‹åŠ¡</p>
<pre><code class="hljs language-sql" lang="sql">KILL <span class="hljs-number">100</span>;
</code></pre>
<p><strong>æ°¸ä¹…æ–¹æ¡ˆ</strong>:</p>
<ol>
<li>è®¾ç½®é”ç­‰å¾…è¶…æ—¶æ—¶é—´:</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SET</span> <span class="hljs-keyword">GLOBAL</span> innodb_lock_wait_timeout <span class="hljs-operator">=</span> <span class="hljs-number">10</span>; <span class="hljs-comment">-- 10ç§’</span>
</code></pre>
<ol start="2">
<li>ç›‘æ§é•¿äº‹åŠ¡,è‡ªåŠ¨å‘Šè­¦:</li>
</ol>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥è¯¢è¿è¡Œè¶…è¿‡10ç§’çš„äº‹åŠ¡</span>
<span class="hljs-keyword">SELECT</span>
    trx_id,
    trx_state,
    trx_started,
    TIMESTAMPDIFF(<span class="hljs-keyword">SECOND</span>, trx_started, NOW()) <span class="hljs-keyword">AS</span> running_seconds,
    trx_mysql_thread_id,
    trx_query
<span class="hljs-keyword">FROM</span> information_schema.innodb_trx
<span class="hljs-keyword">WHERE</span> TIMESTAMPDIFF(<span class="hljs-keyword">SECOND</span>, trx_started, NOW()) <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>;
</code></pre>
<ol start="3">
<li>ä»£ç Review,ç¡®ä¿äº‹åŠ¡åŠæ—¶æäº¤:</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯: æ‰‹åŠ¨BEGINæœªCOMMIT</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">badExample</span><span class="hljs-params">()</span> {
    jdbcTemplate.execute(<span class="hljs-string">"BEGIN"</span>);
    jdbcTemplate.update(<span class="hljs-string">"UPDATE ..."</span>);
    <span class="hljs-comment">// å¿˜è®°COMMIT!</span>
}

<span class="hljs-comment">// âœ… æ­£ç¡®: ä½¿ç”¨@Transactional</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">goodExample</span><span class="hljs-params">()</span> {
    jdbcTemplate.update(<span class="hljs-string">"UPDATE ..."</span>);
    <span class="hljs-comment">// è‡ªåŠ¨COMMITæˆ–ROLLBACK</span>
}
</code></pre>
<p><strong>æ•ˆæœ</strong>: é”ç­‰å¾…æ—¶é—´ä»30ç§’é™åˆ°0,æŸ¥è¯¢å“åº”æ—¶é—´ä»30ç§’é™åˆ°50ms</p>
<hr/>
<h2 data-id="heading-47">ä¸ƒã€å¸¸è§é—®é¢˜ä¸é¿å‘æŒ‡å—</h2>
<h3 data-id="heading-48">7.1 ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‘ç”Ÿå¹»è¯»?InnoDBå¦‚ä½•è§£å†³?</h3>
<p><strong>å¹»è¯»å‘ç”Ÿæ¡ä»¶</strong>:</p>
<ol>
<li>éš”ç¦»çº§åˆ«ä¸ºREPEATABLE READ</li>
<li>ä½¿ç”¨å½“å‰è¯»(SELECT ... FOR UPDATEã€UPDATEã€DELETE)</li>
<li>å…¶ä»–äº‹åŠ¡INSERTæ–°æ•°æ®å¹¶æäº¤</li>
</ol>
<p><strong>InnoDBè§£å†³æ–¹æ¡ˆ</strong>: Next-Key Lock</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- äº‹åŠ¡A</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>; <span class="hljs-comment">-- åŠ Next-Key Lock</span>

<span class="hljs-comment">-- äº‹åŠ¡B</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> orders <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">101</span>, <span class="hljs-number">1</span>, ...); <span class="hljs-comment">-- é˜»å¡,æ— æ³•æ’å…¥</span>

<span class="hljs-comment">-- äº‹åŠ¡A</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>; <span class="hljs-comment">-- ç»“æœä¸€è‡´,æ— å¹»è¯»</span>
</code></pre>
<h3 data-id="heading-49">7.2 ä¸ºä»€ä¹ˆREPEATABLE READæ˜¯MySQLé»˜è®¤éš”ç¦»çº§åˆ«?</h3>
<p><strong>åŸå› </strong>:</p>
<ol>
<li><strong>æ€§èƒ½å¹³è¡¡</strong>: RCçº§åˆ«æ€§èƒ½é«˜ä½†æœ‰ä¸å¯é‡å¤è¯»,SERIALIZABLEçº§åˆ«æ— å¹¶å‘,RRçº§åˆ«æŠ˜ä¸­</li>
<li><strong>ä¸»ä»å¤åˆ¶</strong>: MySQL binlogé»˜è®¤ä½¿ç”¨STATEMENTæ ¼å¼,RCçº§åˆ«ä¸‹å¯èƒ½å¯¼è‡´ä¸»ä»ä¸ä¸€è‡´</li>
<li><strong>å…¼å®¹æ€§</strong>: MySQLå†å²åŸå› ,ä¿æŒå‘åå…¼å®¹</li>
</ol>
<p><strong>Oracleä¸ºä»€ä¹ˆç”¨READ COMMITTED?</strong></p>
<ul>
<li>Oracleä½¿ç”¨Redo Logå®ç°ä¸»ä»å¤åˆ¶,ä¸ä¾èµ–binlog</li>
<li>Oracle MVCCå®ç°æ›´å®Œå–„,RCçº§åˆ«ä¸‹ä¹Ÿèƒ½ä¿è¯ä¸€è‡´æ€§</li>
</ul>
<h3 data-id="heading-50">7.3 MVCCåœ¨ä»€ä¹ˆéš”ç¦»çº§åˆ«ä¸‹ç”Ÿæ•ˆ?</h3>
<p><strong>ç”Ÿæ•ˆçº§åˆ«</strong>: READ COMMITTEDã€REPEATABLE READ</p>
<p><strong>ä¸ç”Ÿæ•ˆçº§åˆ«</strong>:</p>
<ul>
<li>READ UNCOMMITTED: æ— éš”ç¦»,ç›´æ¥è¯»æœ€æ–°æ•°æ®</li>
<li>SERIALIZABLE: æ‰€æœ‰SELECTè‡ªåŠ¨åŠ Sé”,æ— éœ€MVCC</li>
</ul>
<h3 data-id="heading-51">7.4 ä»€ä¹ˆæ˜¯å¿«ç…§è¯»å’Œå½“å‰è¯»?åŒºåˆ«æ˜¯ä»€ä¹ˆ?</h3>








































<table><thead><tr><th>ç»´åº¦</th><th>å¿«ç…§è¯» (Snapshot Read)</th><th>å½“å‰è¯» (Current Read)</th></tr></thead><tbody><tr><td><strong>å®šä¹‰</strong></td><td>è¯»å–å†å²ç‰ˆæœ¬æ•°æ®</td><td>è¯»å–æœ€æ–°ç‰ˆæœ¬æ•°æ®</td></tr><tr><td><strong>SQL</strong></td><td>SELECT (æ™®é€š)</td><td>SELECT ... FOR UPDATE<br/>UPDATE<br/>DELETE</td></tr><tr><td><strong>å®ç°</strong></td><td>MVCC(Read View + ç‰ˆæœ¬é“¾)</td><td>åŠ é”(Sé”æˆ–Xé”)</td></tr><tr><td><strong>æ˜¯å¦åŠ é”</strong></td><td>âŒ ä¸åŠ é”</td><td>âœ… åŠ é”</td></tr><tr><td><strong>è¯»å†™é˜»å¡</strong></td><td>è¯»å†™ä¸é˜»å¡</td><td>è¯»å†™äº’æ–¥</td></tr><tr><td><strong>å¹»è¯»</strong></td><td>MVCCè§£å†³å¿«ç…§è¯»çš„å¹»è¯»</td><td>Next-Key Lockè§£å†³å½“å‰è¯»çš„å¹»è¯»</td></tr></tbody></table>
<h3 data-id="heading-52">7.5 ä¸ºä»€ä¹ˆæ— ç´¢å¼•æŸ¥è¯¢ä¼šé”å…¨è¡¨?</h3>
<p><strong>åŸå› </strong>: InnoDBè¡Œé”æ˜¯åŠ åœ¨ç´¢å¼•ä¸Šçš„,æ— ç´¢å¼•åˆ™å…¨è¡¨æ‰«æ,é”å®šæ‰€æœ‰è®°å½•</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- balanceå­—æ®µæ— ç´¢å¼•</span>
<span class="hljs-keyword">UPDATE</span> account <span class="hljs-keyword">SET</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> balance <span class="hljs-operator">&gt;</span> <span class="hljs-number">1000</span>;
</code></pre>
<p><strong>æ‰§è¡Œè®¡åˆ’</strong>:</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">type:</span> ALL (å…¨è¡¨æ‰«æ)
<span class="hljs-symbol">rows:</span> <span class="hljs-number">1000000</span>
<span class="hljs-symbol">Extra:</span> <span class="hljs-keyword">Using</span> <span class="hljs-keyword">where</span>
</code></pre>
<p><strong>åŠ é”</strong>: é”å®šæ‰€æœ‰100ä¸‡è¡Œè®°å½•(ç›¸å½“äºè¡¨é”)</p>
<p><strong>ä¼˜åŒ–</strong>: æ·»åŠ ç´¢å¼•</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> account <span class="hljs-keyword">ADD</span> INDEX idx_balance (balance);
</code></pre>
<h3 data-id="heading-53">7.6 é—´éš™é”åœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šåŠ ?</h3>
<p><strong>åŠ é”æ¡ä»¶</strong>:</p>
<ol>
<li>éš”ç¦»çº§åˆ«ä¸ºREPEATABLE READ</li>
<li>èŒƒå›´æŸ¥è¯¢(&gt;ã€&lt;ã€BETWEEN)æˆ–ç­‰å€¼æŸ¥è¯¢ä½†è®°å½•ä¸å­˜åœ¨</li>
</ol>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- RRéš”ç¦»çº§åˆ«,ç´¢å¼•å€¼ [3, 10, 20, 30]</span>

<span class="hljs-comment">-- 1. èŒƒå›´æŸ¥è¯¢ â†’ åŠ é—´éš™é”</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span> <span class="hljs-keyword">AND</span> id <span class="hljs-operator">&lt;</span> <span class="hljs-number">20</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-comment">-- é”å®š: (10, 20)</span>

<span class="hljs-comment">-- 2. ç­‰å€¼æŸ¥è¯¢ä½†è®°å½•ä¸å­˜åœ¨ â†’ åŠ é—´éš™é”</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">15</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-comment">-- é”å®š: (10, 20)</span>

<span class="hljs-comment">-- 3. ç­‰å€¼æŸ¥è¯¢ä¸”è®°å½•å­˜åœ¨ â†’ åŠ è®°å½•é”</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">10</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
<span class="hljs-comment">-- é”å®š: id=10 (è®°å½•é”)</span>
</code></pre>
<h3 data-id="heading-54">7.7 å¦‚ä½•æŸ¥çœ‹å½“å‰äº‹åŠ¡å’Œé”ä¿¡æ¯?</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥çœ‹å½“å‰æ´»è·ƒäº‹åŠ¡</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.innodb_trx;

<span class="hljs-comment">-- æŸ¥çœ‹å½“å‰é”</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.innodb_locks;

<span class="hljs-comment">-- æŸ¥çœ‹é”ç­‰å¾…</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.innodb_lock_waits;

<span class="hljs-comment">-- æŸ¥çœ‹InnoDBçŠ¶æ€ (åŒ…å«æ­»é”æ—¥å¿—)</span>
<span class="hljs-keyword">SHOW</span> ENGINE INNODB STATUS\G;

<span class="hljs-comment">-- æŸ¥çœ‹è¿›ç¨‹åˆ—è¡¨</span>
<span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">FULL</span> PROCESSLIST;

<span class="hljs-comment">-- KILLæ‰é˜»å¡çš„äº‹åŠ¡</span>
KILL <span class="hljs-operator">&lt;</span>thread_id<span class="hljs-operator">&gt;</span>;
</code></pre>
<h3 data-id="heading-55">7.8 @Transactionalæ³¨è§£çš„rollbackForä¸ºä»€ä¹ˆè¦è®¾ç½®?</h3>
<p><strong>åŸå› </strong>: Springé»˜è®¤åªå›æ»šRuntimeExceptionå’ŒError,ä¸å›æ»šå—æ£€å¼‚å¸¸(Exception)</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯: å—æ£€å¼‚å¸¸ä¸å›æ»š</span>
<span class="hljs-meta">@Transactional</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">badExample</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
    orderMapper.insert(order);
    <span class="hljs-keyword">if</span> (someCondition) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">"ä¸šåŠ¡å¼‚å¸¸"</span>); <span class="hljs-comment">// ä¸ä¼šå›æ»š!</span>
    }
}

<span class="hljs-comment">// âœ… æ­£ç¡®: æ‰€æœ‰å¼‚å¸¸éƒ½å›æ»š</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">goodExample</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
    orderMapper.insert(order);
    <span class="hljs-keyword">if</span> (someCondition) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Exception</span>(<span class="hljs-string">"ä¸šåŠ¡å¼‚å¸¸"</span>); <span class="hljs-comment">// ä¼šå›æ»š</span>
    }
}
</code></pre>
<h3 data-id="heading-56">7.9 äº‹åŠ¡å¤±æ•ˆçš„Nç§åœºæ™¯</h3>
<p><strong>1. åŒç±»è°ƒç”¨</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯: åŒç±»è°ƒç”¨,@Transactionalå¤±æ•ˆ</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.insertOrder(); <span class="hljs-comment">// åŒç±»è°ƒç”¨,äº‹åŠ¡å¤±æ•ˆ!</span>
    }

    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertOrder</span><span class="hljs-params">()</span> {
        orderMapper.insert(order);
    }
}

<span class="hljs-comment">// âœ… æ­£ç¡®: æ³¨å…¥è‡ªå·±,é€šè¿‡ä»£ç†è°ƒç”¨</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderService self;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">()</span> {
        self.insertOrder(); <span class="hljs-comment">// é€šè¿‡ä»£ç†è°ƒç”¨,äº‹åŠ¡ç”Ÿæ•ˆ</span>
    }

    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertOrder</span><span class="hljs-params">()</span> {
        orderMapper.insert(order);
    }
}
</code></pre>
<p><strong>2. æ–¹æ³•épublic</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯: privateæ–¹æ³•,äº‹åŠ¡å¤±æ•ˆ</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertOrder</span><span class="hljs-params">()</span> {
    orderMapper.insert(order);
}

<span class="hljs-comment">// âœ… æ­£ç¡®: publicæ–¹æ³•</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertOrder</span><span class="hljs-params">()</span> {
    orderMapper.insert(order);
}
</code></pre>
<p><strong>3. å¼‚å¸¸è¢«catch</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯: å¼‚å¸¸è¢«catch,äº‹åŠ¡ä¸å›æ»š</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertOrder</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> {
        orderMapper.insert(order);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"æ’å…¥å¤±è´¥"</span>, e);
        <span class="hljs-comment">// å¼‚å¸¸è¢«åäº†,äº‹åŠ¡ä¸å›æ»š!</span>
    }
}

<span class="hljs-comment">// âœ… æ­£ç¡®: é‡æ–°æŠ›å‡ºå¼‚å¸¸</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertOrder</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">try</span> {
        orderMapper.insert(order);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"æ’å…¥å¤±è´¥"</span>, e);
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"è®¢å•åˆ›å»ºå¤±è´¥"</span>, e);
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-57">å…«ã€æœ€ä½³å®è·µä¸æ€»ç»“</h2>
<h3 data-id="heading-58">8.1 äº‹åŠ¡ä½¿ç”¨åŸåˆ™</h3>
<ol>
<li>
<p><strong>äº‹åŠ¡åº”å°½å¯èƒ½çŸ­</strong></p>
<ul>
<li>âœ… äº‹åŠ¡å†…åªåŒ…å«æ•°æ®åº“æ“ä½œ</li>
<li>âŒ äº‹åŠ¡å†…ä¸è¦åŒ…å«RPCè°ƒç”¨ã€æ–‡ä»¶æ“ä½œã€HTTPè¯·æ±‚</li>
</ul>
</li>
<li>
<p><strong>åˆç†è®¾ç½®éš”ç¦»çº§åˆ«</strong></p>
<ul>
<li>å¤§å¤šæ•°åœºæ™¯: REPEATABLE READ (MySQLé»˜è®¤)</li>
<li>å¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜: READ COMMITTED (æ€§èƒ½æ›´å¥½)</li>
<li>é‡‘èç­‰å¼ºä¸€è‡´æ€§åœºæ™¯: SERIALIZABLE</li>
</ul>
</li>
<li>
<p><strong>æ­£ç¡®ä½¿ç”¨@Transactionalæ³¨è§£</strong></p>
<ul>
<li>å¿…é¡»è®¾ç½®<code>rollbackFor = Exception.class</code></li>
<li>æ–¹æ³•å¿…é¡»æ˜¯public</li>
<li>é¿å…åŒç±»è°ƒç”¨</li>
<li>å¼‚å¸¸ä¸è¦è¢«catch</li>
</ul>
</li>
</ol>
<h3 data-id="heading-59">8.2 é”ä½¿ç”¨åŸåˆ™</h3>
<ol>
<li>
<p><strong>ä¼˜å…ˆä½¿ç”¨ä¹è§‚é”</strong></p>
<ul>
<li>å†²çªä¸é¢‘ç¹çš„åœºæ™¯: ä¹è§‚é”(versionå­—æ®µ)</li>
<li>å†²çªé¢‘ç¹çš„åœºæ™¯: æ‚²è§‚é”(SELECT ... FOR UPDATE)</li>
</ul>
</li>
<li>
<p><strong>é¿å…é•¿æ—¶é—´æŒæœ‰é”</strong></p>
<ul>
<li>ç¼©çŸ­äº‹åŠ¡æŒç»­æ—¶é—´</li>
<li>RPCè°ƒç”¨ç§»åˆ°äº‹åŠ¡å¤–</li>
</ul>
</li>
<li>
<p><strong>ç»Ÿä¸€é”å®šé¡ºåº,é¿å…æ­»é”</strong></p>
<ul>
<li>æŒ‰ä¸»é”®é¡ºåºé”å®š</li>
<li>å…ˆé”çˆ¶è¡¨,å†é”å­è¡¨</li>
</ul>
</li>
<li>
<p><strong>å°½é‡ä½¿ç”¨ç´¢å¼•,é¿å…é”å…¨è¡¨</strong></p>
<ul>
<li>WHEREæ¡ä»¶å¿…é¡»ä½¿ç”¨ç´¢å¼•</li>
<li>é¿å…åœ¨éç´¢å¼•å­—æ®µä¸ŠUPDATE</li>
</ul>
</li>
</ol>
<h3 data-id="heading-60">8.3 æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<ol>
<li><strong>å°½é‡ä½¿ç”¨ç´¢å¼•,é¿å…å…¨è¡¨æ‰«æ</strong></li>
<li><strong>æ‰¹é‡æ“ä½œæ‹†åˆ†ä¸ºå°äº‹åŠ¡</strong></li>
<li><strong>è¯»å¤šå†™å°‘åœºæ™¯ä½¿ç”¨MVCC(å¿«ç…§è¯»)</strong></li>
<li><strong>å®šæœŸåˆ†ææ­»é”æ—¥å¿—,ä¼˜åŒ–SQL</strong></li>
</ol>
<h3 data-id="heading-61">8.4 ç›‘æ§æŒ‡æ ‡</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. æ­»é”é¢‘ç‡</span>
<span class="hljs-keyword">SHOW</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'Innodb_deadlocks'</span>;

<span class="hljs-comment">-- 2. é”ç­‰å¾…ç»Ÿè®¡</span>
<span class="hljs-keyword">SHOW</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'Innodb_row_lock%'</span>;

<span class="hljs-comment">-- 3. é•¿äº‹åŠ¡ç›‘æ§</span>
<span class="hljs-keyword">SELECT</span>
    trx_id,
    trx_state,
    trx_started,
    TIMESTAMPDIFF(<span class="hljs-keyword">SECOND</span>, trx_started, NOW()) <span class="hljs-keyword">AS</span> running_seconds
<span class="hljs-keyword">FROM</span> information_schema.innodb_trx
<span class="hljs-keyword">WHERE</span> TIMESTAMPDIFF(<span class="hljs-keyword">SECOND</span>, trx_started, NOW()) <span class="hljs-operator">&gt;</span> <span class="hljs-number">10</span>;
</code></pre>
<p><strong>å‘Šè­¦é˜ˆå€¼</strong>:</p>
<ul>
<li>æ­»é”é¢‘ç‡ &gt; 10æ¬¡/å°æ—¶</li>
<li>å¹³å‡é”ç­‰å¾…æ—¶é—´ &gt; 1ç§’</li>
<li>é•¿äº‹åŠ¡(&gt;10ç§’) &gt; 5ä¸ª</li>
</ul>
<h3 data-id="heading-62">8.5 äº‹åŠ¡è®¾è®¡Checklist</h3>
<ul>
<li>âœ… äº‹åŠ¡å†…åªåŒ…å«æ•°æ®åº“æ“ä½œ</li>
<li>âœ… è®¾ç½®<code>rollbackFor = Exception.class</code></li>
<li>âœ… æ–¹æ³•æ˜¯public</li>
<li>âœ… å¼‚å¸¸ä¸è¢«catchæˆ–é‡æ–°æŠ›å‡º</li>
<li>âœ… WHEREæ¡ä»¶ä½¿ç”¨ç´¢å¼•</li>
<li>âœ… ç»Ÿä¸€é”å®šé¡ºåº</li>
<li>âœ… äº‹åŠ¡æŒç»­æ—¶é—´ &lt; 1ç§’</li>
<li>âœ… æ‰¹é‡æ“ä½œæ‹†åˆ†ä¸ºå°äº‹åŠ¡</li>
</ul>
<h3 data-id="heading-63">8.6 æ ¸å¿ƒè¦ç‚¹æ€»ç»“</h3>
<p><strong>äº‹åŠ¡ACIDç‰¹æ€§</strong>:</p>
<ul>
<li>åŸå­æ€§(Undo Log)ã€ä¸€è‡´æ€§(çº¦æŸ)ã€éš”ç¦»æ€§(MVCC+é”)ã€æŒä¹…æ€§(Redo Log)</li>
</ul>
<p><strong>å››ç§éš”ç¦»çº§åˆ«</strong>:</p>
<ul>
<li>RU(æ€§èƒ½æœ€é«˜,æ— éš”ç¦») &lt; RC(é˜²è„è¯») &lt; RR(é˜²ä¸å¯é‡å¤è¯»,MySQLé»˜è®¤) &lt; SERIALIZABLE(å®Œå…¨éš”ç¦»)</li>
</ul>
<p><strong>MVCCåŸç†</strong>:</p>
<ul>
<li>éšè—åˆ—(DB_TRX_IDã€DB_ROLL_PTR) + Undo Logç‰ˆæœ¬é“¾ + Read Viewå¯è§æ€§åˆ¤æ–­</li>
<li>RCçº§åˆ«æ¯æ¬¡SELECTç”Ÿæˆæ–°Read View,RRçº§åˆ«å¤ç”¨åŒä¸€ä¸ª</li>
</ul>
<p><strong>InnoDBé”ç±»å‹</strong>:</p>
<ul>
<li>è®°å½•é”(é”å•è¡Œ)ã€é—´éš™é”(é”é—´éš™)ã€Next-Key Lock(é”è¡Œ+é—´éš™,é˜²å¹»è¯»)</li>
<li>é—´éš™é”åªåœ¨RRçº§åˆ«å­˜åœ¨</li>
</ul>
<p><strong>æ­»é”é¿å…</strong>:</p>
<ul>
<li>ç»Ÿä¸€é”å®šé¡ºåºã€ä½¿ç”¨ç´¢å¼•ã€ç¼©çŸ­äº‹åŠ¡ã€è®¾ç½®è¶…æ—¶æ—¶é—´</li>
</ul>
<p><strong>å¿«ç…§è¯»vså½“å‰è¯»</strong>:</p>
<ul>
<li>å¿«ç…§è¯»(æ™®é€šSELECT,MVCC,ä¸åŠ é”) vs å½“å‰è¯»(FOR UPDATE,åŠ é”,è¯»æœ€æ–°ç‰ˆæœ¬)</li>
</ul>
<p>æŒæ¡MySQLäº‹åŠ¡ä¸é”æœºåˆ¶,æ˜¯é«˜å¹¶å‘ç³»ç»Ÿå¼€å‘çš„æ ¸å¿ƒèƒ½åŠ›ã€‚é€šè¿‡æ·±å…¥ç†è§£MVCCåŸç†ã€é”çš„ç±»å‹ä¸åŠ é”è§„åˆ™,ç»“åˆç”µå•†åº“å­˜æ‰£å‡ã€æ­»é”æ’æŸ¥ç­‰å®æˆ˜æ¡ˆä¾‹,èƒ½å¤Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ¸¸åˆƒæœ‰ä½™åœ°å¤„ç†å¹¶å‘é—®é¢˜,æ„å»ºé«˜æ€§èƒ½ã€é«˜å¯é çš„æ•°æ®åº“ç³»ç»Ÿã€‚</p>
<hr/>
<p><strong>å‚è€ƒèµ„æ–™</strong>:</p>
<ul>
<li>ã€Šé«˜æ€§èƒ½MySQLã€‹(ç¬¬4ç‰ˆ) - Baron Schwartzç­‰</li>
<li>ã€ŠMySQLæŠ€æœ¯å†…å¹•: InnoDBå­˜å‚¨å¼•æ“ã€‹(ç¬¬2ç‰ˆ) - å§œæ‰¿å°§</li>
<li>MySQLå®˜æ–¹æ–‡æ¡£: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F8.0%2Fen%2Finnodb-locking.html" target="_blank" title="https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html" ref="nofollow noopener noreferrer">dev.mysql.com/doc/refman/â€¦</a></li>
<li>ã€Šæ·±å…¥ç†è§£MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸é”æœºåˆ¶ã€‹- é˜¿é‡Œäº‘æ•°æ®åº“å›¢é˜Ÿ</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring é‡Œçš„è¿‡æ»¤å™¨ï¼ˆFilterï¼‰å’Œæ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰åˆ°åº•å•¥åŒºåˆ«ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7585485284153671715</link>    <guid>https://juejin.cn/post/7585485284153671715</guid>    <pubDate>2025-12-21T02:30:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485284153671715" data-draft-id="7585600621521354792" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Spring é‡Œçš„è¿‡æ»¤å™¨ï¼ˆFilterï¼‰å’Œæ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰åˆ°åº•å•¥åŒºåˆ«ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-21T02:30:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ¨æœ¨ä¸€ç›´åœ¨å“­æ³£"/> <meta itemprop="url" content="https://juejin.cn/user/3896324937225085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Spring é‡Œçš„è¿‡æ»¤å™¨ï¼ˆFilterï¼‰å’Œæ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰åˆ°åº•å•¥åŒºåˆ«ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3896324937225085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ¨æœ¨ä¸€ç›´åœ¨å“­æ³£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T02:30:46.000Z" title="Sun Dec 21 2025 02:30:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨åš Spring Boot å¼€å‘æ—¶ï¼Œç»å¸¸ä¼šå¬åˆ°ä¸¤å¥è¯ï¼šâ€œç”¨ Filter åšç»Ÿä¸€å¤„ç†â€ã€â€œç”¨ Interceptor æ‹¦æˆªè¯·æ±‚â€ã€‚å¾ˆå¤šåŒå­¦ä¼šæ··æ·†ï¼šå®ƒä»¬æ˜¯ä¸æ˜¯éƒ½æ˜¯ Spring çš„ï¼Ÿå®ƒä»¬åœ¨è¯·æ±‚é“¾è·¯çš„å“ªä¸ªä½ç½®ï¼Ÿé€‚åˆå¹²å˜›ï¼ŸSpring Boot é‡Œæ€ä¹ˆå†™ï¼Ÿ</p>
<p>è¿™ç¯‡æ–‡ç« ç”¨ç®€å•çš„æ–¹å¼è®²æ¸…æ¥š Filter å’Œ Interceptor çš„å®šä½ï¼Œå¹¶ç»™å‡ºä¸¤ä¸ªèƒ½ç›´æ¥å¤åˆ¶è¿è¡Œçš„ä¾‹å­ï¼Œæœ€åç”¨ä¸€ä¸ªæ€»ç»“æŠŠé€‰æ‹©å»ºè®®è¯´é€ã€‚</p>
<h2 data-id="heading-0">1. å…ˆä¸‹ç»“è®ºï¼šå®ƒä»¬å½’å±ä¸åŒ</h2>
<p>Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ä¸æ˜¯ Spring å‘æ˜çš„ï¼Œå®ƒå±äº Servlet è§„èŒƒï¼Œç”± Tomcat/Jetty ç­‰å®¹å™¨è´Ÿè´£è°ƒç”¨ã€‚å®ƒçš„ä½ç½®æ›´é å¤–ï¼Œåœ¨è¯·æ±‚è¿›å…¥ Spring MVC ä¹‹å‰å°±ä¼šæ‰§è¡Œã€‚</p>
<p>Interceptorï¼ˆæ‹¦æˆªå™¨ï¼‰é€šå¸¸æŒ‡ Spring MVC çš„ HandlerInterceptorï¼Œæ˜¯ Spring MVC çš„èƒ½åŠ›ã€‚å®ƒçš„ä½ç½®æ›´é å†…ï¼Œè¯·æ±‚è¿›å…¥ DispatcherServlet ä¹‹åã€Controller æ–¹æ³•æ‰§è¡Œå‰åæ‰ä¼šè§¦å‘ã€‚</p>
<h2 data-id="heading-1">2. ç”¨â€œæ´‹è‘±æ¨¡å‹â€ç†è§£ä½ç½®å…³ç³»</h2>
<p>è¯·æ±‚ä»å¤–å¾€å†…èµ°ï¼š</p>
<p>Tomcat â†’ Filterï¼ˆServlet è§„èŒƒï¼‰â†’ DispatcherServletï¼ˆSpring MVC å…¥å£ï¼‰â†’ Interceptorï¼ˆSpring MVCï¼‰â†’ Controller</p>
<p>å“åº”è¿”å›æ—¶ï¼Œå†æŒ‰ç›¸åæ–¹å‘å›å»ã€‚</p>
<h2 data-id="heading-2">3. ä»€ä¹ˆæ—¶å€™ç”¨ Filterï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨ Interceptorï¼Ÿ</h2>
<p>Filter æ›´é€‚åˆåšâ€œå…¨ç«™é€šç”¨ã€è·Ÿä¸šåŠ¡æ— å…³â€çš„äº‹æƒ…ï¼Œä¾‹å¦‚ç¼–ç å¤„ç†ã€å…¨å±€ CORSã€XSS è¿‡æ»¤ã€RequestWrapperï¼ˆè¯» body/æ”¹ headerï¼‰ã€ç»Ÿä¸€è®¿é—®æ—¥å¿—ã€é™æµã€ä»¥åŠå®‰å…¨é“¾è·¯ç›¸å…³å¤„ç†ã€‚å¾ˆå¤šäººä¸çŸ¥é“çš„æ˜¯ï¼ŒSpring Security æœ¬è´¨ä¸Šå°±æ˜¯ä¸€æ¡å¾ˆé•¿çš„ FilterChainã€‚</p>
<p>Interceptor æ›´é€‚åˆåšâ€œè·Ÿ Controller/ä¸šåŠ¡å¼ºç›¸å…³â€çš„äº‹æƒ…ï¼Œä¾‹å¦‚ç™»å½•æ€/æƒé™æ ¡éªŒï¼ˆå°¤å…¶éœ€è¦æ‹¿åˆ° Controller æ–¹æ³•æˆ–æ³¨è§£æ—¶ï¼‰ã€æ¥å£åŸ‹ç‚¹ç»Ÿè®¡æ¯ä¸ª Controller çš„è€—æ—¶ã€ç»Ÿä¸€æ³¨å…¥ä¸Šä¸‹æ–‡ï¼ˆuserIdã€traceIdï¼‰å¹¶åœ¨ afterCompletion æ¸…ç† ThreadLocal/MDCã€å¤šç§Ÿæˆ· tenant ä¸Šä¸‹æ–‡ç­‰ã€‚</p>
<h2 data-id="heading-3">4. æœ€å…³é”®åŒºåˆ«ï¼šè§¦å‘æ—¶æœº &amp; èƒ½æ‹¿åˆ°çš„ä¿¡æ¯</h2>






























<table><thead><tr><th>ç»´åº¦</th><th>Filter</th><th>Interceptor</th></tr></thead><tbody><tr><td>å½’å±</td><td>Servlet è§„èŒƒï¼ˆå®¹å™¨è°ƒç”¨ï¼‰</td><td>Spring MVCï¼ˆDispatcherServlet è°ƒç”¨ï¼‰</td></tr><tr><td>æ‰§è¡Œæ—¶æœº</td><td>æ›´æ—©ï¼ˆè¿›å…¥ Spring MVC ä¹‹å‰ï¼‰</td><td>æ›´æ™šï¼ˆè¿›å…¥ Spring MVC ä¹‹åï¼ŒController å‰åï¼‰</td></tr><tr><td>æ˜¯å¦èƒ½æ‹¿åˆ° Controller æ–¹æ³•</td><td>ä¸çŸ¥é“å…·ä½“ handler</td><td>èƒ½æ‹¿åˆ° handlerï¼ˆæ–¹æ³•/æ³¨è§£ï¼‰</td></tr><tr><td>å…¸å‹ç”¨é€”</td><td>å…¨å±€é€šç”¨å¤„ç†ã€å®‰å…¨è¿‡æ»¤ã€åŒ…è£… request</td><td>ä¸šåŠ¡æ ¡éªŒã€åŸ‹ç‚¹ã€ä¸Šä¸‹æ–‡ç®¡ç†ã€æƒé™</td></tr></tbody></table>
<h2 data-id="heading-4">5. ä¾‹å­ 1ï¼šFilter è®°å½•å…¨ç«™è€—æ—¶ï¼ˆå®Œæ•´å¯ç”¨ï¼‰</h2>
<p>ç›®æ ‡æ˜¯æ‰“å°æ¯ä¸ªè¯·æ±‚çš„ URIã€çº¿ç¨‹åã€è€—æ—¶ï¼Œå¹¶ä¸”èƒ½ç›´è§‚çœ‹åˆ°å®ƒåœ¨ Controller å‰åæ‰§è¡Œã€‚æ¨èç»§æ‰¿ OncePerRequestFilterï¼Œé¿å…ä¸€æ¬¡è¯·æ±‚å¤šæ¬¡æ‰§è¡Œçš„é—®é¢˜ã€‚</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">import</span> jakarta.servlet.<span class="hljs-type">FilterChain</span>;
<span class="hljs-keyword">import</span> jakarta.servlet.<span class="hljs-type">ServletException</span>;
<span class="hljs-keyword">import</span> jakarta.servlet.http.<span class="hljs-type">HttpServletRequest</span>;
<span class="hljs-keyword">import</span> jakarta.servlet.http.<span class="hljs-type">HttpServletResponse</span>;
<span class="hljs-keyword">import</span> org.springframework.stereotype.<span class="hljs-type">Component</span>;
<span class="hljs-keyword">import</span> org.springframework.web.filter.<span class="hljs-type">OncePerRequestFilter</span>;

<span class="hljs-keyword">import</span> java.io.<span class="hljs-type">IOException</span>;

<span class="hljs-meta">@Component</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AccessLogFilter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OncePerRequestFilter</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> void doFilterInternal(
            <span class="hljs-type">HttpServletRequest</span> request,
            <span class="hljs-type">HttpServletResponse</span> response,
            <span class="hljs-type">FilterChain</span> filterChain
    ) <span class="hljs-keyword">throws</span> <span class="hljs-type">ServletException</span>, <span class="hljs-type">IOException</span> {

        long start = <span class="hljs-type">System</span>.currentTimeMillis();
        <span class="hljs-type">String</span> uri = request.getRequestURI();
        <span class="hljs-type">String</span> thread = <span class="hljs-type">Thread</span>.currentThread().getName();

        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"[Filter] before chain, uri="</span> + uri + <span class="hljs-string">", thread="</span> + thread);
            filterChain.doFilter(request, response); <span class="hljs-comment">// æ”¾è¡Œï¼Œè¿›å…¥ DispatcherServlet / Controller</span>
        } <span class="hljs-keyword">finally</span> {
            long cost = <span class="hljs-type">System</span>.currentTimeMillis() - start;
            <span class="hljs-type">System</span>.out.println(<span class="hljs-string">"[Filter] after chain , uri="</span> + uri + <span class="hljs-string">", cost="</span> + cost + <span class="hljs-string">"ms"</span>);
        }
    }
}
</code></pre>
<p>ç†è§£è¦ç‚¹æ˜¯ï¼šfilterChain.doFilter å‰æ˜¯â€œè¿› Spring MVC ä¹‹å‰â€ï¼ŒdoFilter åæ˜¯â€œController å’Œåç»­å¤„ç†éƒ½ç»“æŸåâ€ã€‚</p>
<h2 data-id="heading-5">6. ä¾‹å­ 2ï¼šInterceptor ç»Ÿä¸€æ³¨å…¥ userId + traceIdï¼Œå¹¶æ­£ç¡®æ¸…ç†ï¼ˆå®Œæ•´å¯ç”¨ï¼‰</h2>
<p>è¿™ä¸ªä¾‹å­æ›´è´´è¿‘çœŸå®çº¿ä¸Šï¼šä»è¯·æ±‚å¤´/å‚æ•°æ‹¿ userIdï¼Œç”Ÿæˆ traceIdï¼Œæ”¾åˆ° ThreadLocalï¼ŒController é‡Œéšæ—¶èƒ½å–ï¼ŒåŒæ—¶åœ¨ afterCompletion æ¸…ç†ï¼Œé¿å…çº¿ç¨‹æ± å¤ç”¨å¯¼è‡´ä¸²å·å’Œâ€œçº¿ç¨‹çº§å¸¸é©»â€ã€‚</p>
<p>å…ˆå®šä¹‰ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡å’Œ ThreadLocal å®¹å™¨ã€‚</p>
<p>RequestContext.javaï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestContext</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> userId;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> traceId;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">RequestContext</span><span class="hljs-params">(<span class="hljs-type">String</span> userId, <span class="hljs-type">String</span> traceId)</span> </span>{
        <span class="hljs-keyword">this</span>.userId = userId;
        <span class="hljs-keyword">this</span>.traceId = traceId;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">getUserId</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> userId; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">getTraceId</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> traceId; }
}
</code></pre>
<p>RequestContextHolder.javaï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">RequestContextHolder</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final ThreadLocal&lt;RequestContext&gt; CTX = <span class="hljs-keyword">new</span> ThreadLocal&lt;&gt;();

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span>(<span class="hljs-params">RequestContext ctx</span>)</span> { CTX.<span class="hljs-keyword">set</span>(ctx); }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> RequestContext <span class="hljs-title">get</span>()</span> { <span class="hljs-keyword">return</span> CTX.<span class="hljs-keyword">get</span>(); }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">remove</span>()</span> { CTX.<span class="hljs-keyword">remove</span>(); }
}
</code></pre>
<p>ç„¶åå®ç° Interceptorã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> jakarta.<span class="hljs-property">servlet</span>.<span class="hljs-property">http</span>.<span class="hljs-property">HttpServletRequest</span>;
<span class="hljs-keyword">import</span> jakarta.<span class="hljs-property">servlet</span>.<span class="hljs-property">http</span>.<span class="hljs-property">HttpServletResponse</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">servlet</span>.<span class="hljs-property">HandlerInterceptor</span>;

<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">UUID</span>;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ContextInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">preHandle</span>(<span class="hljs-params">HttpServletRequest request, HttpServletResponse response, <span class="hljs-built_in">Object</span> handler</span>) {
        <span class="hljs-title class_">String</span> userId = request.<span class="hljs-title function_">getHeader</span>(<span class="hljs-string">"X-UserId"</span>);
        <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span> || userId.<span class="hljs-title function_">isBlank</span>()) {
            userId = request.<span class="hljs-title function_">getParameter</span>(<span class="hljs-string">"userId"</span>);
        }
        <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span> || userId.<span class="hljs-title function_">isBlank</span>()) {
            userId = <span class="hljs-string">"anonymous"</span>;
        }

        <span class="hljs-title class_">String</span> traceId = <span class="hljs-variable constant_">UUID</span>.<span class="hljs-title function_">randomUUID</span>().<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">replace</span>(<span class="hljs-string">"-"</span>, <span class="hljs-string">""</span>);
        <span class="hljs-title class_">RequestContextHolder</span>.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestContext</span>(userId, traceId));

        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"[Interceptor] preHandle, userId="</span> + userId + <span class="hljs-string">", traceId="</span> + traceId);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">afterCompletion</span>(<span class="hljs-params">HttpServletRequest request, HttpServletResponse response, <span class="hljs-built_in">Object</span> handler, Exception ex</span>) {
        <span class="hljs-title class_">RequestContextHolder</span>.<span class="hljs-title function_">remove</span>();
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"[Interceptor] afterCompletion, cleaned"</span>);
    }
}
</code></pre>
<p>æ¥ç€åœ¨ Spring Boot ä¸­æ³¨å†Œ Interceptorã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">context</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Configuration</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">servlet</span>.<span class="hljs-property">config</span>.<span class="hljs-property">annotation</span>.*;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">addInterceptors</span>(<span class="hljs-params">InterceptorRegistry registry</span>) {
        registry.<span class="hljs-title function_">addInterceptor</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ContextInterceptor</span>())
                .<span class="hljs-title function_">addPathPatterns</span>(<span class="hljs-string">"/**"</span>)
                .<span class="hljs-title function_">excludePathPatterns</span>(<span class="hljs-string">"/health"</span>);
    }
}
</code></pre>
<p>æœ€åå†™ä¸€ä¸ª Controller éªŒè¯ä¸Šä¸‹æ–‡æ˜¯å¦èƒ½æ‹¿åˆ°ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoController</span> {

    <span class="hljs-meta">@GetMapping(<span class="hljs-string">"/demo"</span>)</span>
    <span class="hljs-keyword">public</span> String demo() {
        RequestContext ctx = RequestContextHolder.<span class="hljs-keyword">get</span>();
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ok, userId="</span> + ctx.getUserId() + <span class="hljs-string">", traceId="</span> + ctx.getTraceId();
    }
}
</code></pre>
<p>è®¿é—® <code>/demo?userId=mm</code>ï¼Œä½ ä¼šçœ‹åˆ°è¾“å‡ºé¡ºåºå¤§è‡´æ˜¯ï¼š</p>
<p>[Filter] before chain<br/>
[Interceptor] preHandle<br/>
Controller æ‰§è¡Œ<br/>
[Interceptor] afterCompletion<br/>
[Filter] after chain</p>
<p>è¿™ä¹Ÿèƒ½ç›´è§‚çœ‹åˆ° Filter åœ¨å¤–å±‚åŒ…ç€æ•´ä¸ª Spring MVCï¼Œè€Œ Interceptor åœ¨ Spring MVC å†…éƒ¨å›´ç»• Controllerã€‚</p>
<h3 data-id="heading-6">æ€»ç»“</h3>
<p>Filter å±äº Servlet è§„èŒƒï¼Œä½ç½®æ›´é å¤–ï¼Œæ›´é€‚åˆåšå…¨ç«™é€šç”¨å¤„ç†ï¼ˆæ—¥å¿—ã€ç¼–ç ã€CORSã€å®‰å…¨è¿‡æ»¤ã€è¯·æ±‚åŒ…è£…ç­‰ï¼‰ï¼Œå®ƒåªå…³å¿ƒ request/responseï¼Œä¸çŸ¥é“å…·ä½“ä¼šèµ°å“ªä¸ª Controllerã€‚</p>
<p>Interceptor å±äº Spring MVCï¼Œä½ç½®æ›´é å†…ï¼Œæ›´é€‚åˆåšä¸ Controller/ä¸šåŠ¡ç›¸å…³çš„æ‹¦æˆªï¼ˆæƒé™ã€åŸ‹ç‚¹ã€ä¸Šä¸‹æ–‡æ³¨å…¥ä¸æ¸…ç†ã€å¤šç§Ÿæˆ·ç­‰ï¼‰ï¼Œå®ƒèƒ½æ‹¿åˆ° handlerï¼ˆæ–¹æ³•/æ³¨è§£ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ afterCompletion åšç»Ÿä¸€æ¸…ç†ã€‚</p>
<p>å†™ Filter è®°ä½å›´ç»• chain.doFilter åŒ…ä¸€å±‚ï¼›å†™ Interceptor è®°ä½ preHandle åšæ‹¦æˆªã€afterCompletion åšæ¸…ç†ï¼ˆå°¤å…¶ ThreadLocal/MDCï¼‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç°ä»£ JavaScript ç‰¹æ€§ï¼šES6+ æ–°ç‰¹æ€§æ·±åº¦è§£æä¸å®è·µ]]></title>    <link>https://juejin.cn/post/7585474459777630244</link>    <guid>https://juejin.cn/post/7585474459777630244</guid>    <pubDate>2025-12-21T05:22:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459777630244" data-draft-id="7585485074038816774" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç°ä»£ JavaScript ç‰¹æ€§ï¼šES6+ æ–°ç‰¹æ€§æ·±åº¦è§£æä¸å®è·µ"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-21T05:22:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="1024è‚¥å®…"/> <meta itemprop="url" content="https://juejin.cn/user/588993964030574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç°ä»£ JavaScript ç‰¹æ€§ï¼šES6+ æ–°ç‰¹æ€§æ·±åº¦è§£æä¸å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993964030574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    1024è‚¥å®…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T05:22:39.000Z" title="Sun Dec 21 2025 05:22:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">å¼•è¨€</h4>
<p>è‡ª2015å¹´ES6ï¼ˆECMAScript 2015ï¼‰å‘å¸ƒä»¥æ¥ï¼ŒJavaScriptè¯­è¨€ç»å†äº†é©å‘½æ€§çš„æ¼”è¿›ã€‚è¿™äº›æ–°ç‰¹æ€§ä¸ä»…æå‡äº†å¼€å‘æ•ˆç‡ï¼Œè¿˜ä½¿JavaScriptä»ä¸€é—¨"ç©å…·è¯­è¨€"æˆé•¿ä¸ºèƒ½å¤Ÿæ„å»ºå¤æ‚åº”ç”¨çš„å¼ºå¤§å·¥å…·ã€‚æœ¬æ–‡å°†æ·±å…¥è§£æES6+çš„æ ¸å¿ƒç‰¹æ€§ï¼Œé‡ç‚¹æ¢è®¨Proxyã€Generatorã€Symbolã€WeakMapç­‰é«˜çº§åŠŸèƒ½ï¼Œå¹¶è¡¥å……ç®­å¤´å‡½æ•°ã€Promiseã€async/awaitç­‰å®ç”¨ç‰¹æ€§ï¼Œé€šè¿‡å®é™…ä»£ç ç¤ºä¾‹å±•ç¤ºå…¶å®ç°åŸç†å’Œåº”ç”¨åœºæ™¯ã€‚</p>
<h4 data-id="heading-1">ä¸€ã€Proxy å’Œ Reflect çš„åº”ç”¨</h4>
<h5 data-id="heading-2">Proxyï¼šå…ƒç¼–ç¨‹çš„åˆ©å™¨</h5>
<p>Proxyæ˜¯ES6å¼•å…¥çš„å…ƒç¼–ç¨‹èƒ½åŠ›ï¼Œå…è®¸æˆ‘ä»¬æ‹¦æˆªå¹¶è‡ªå®šä¹‰å¯¹è±¡çš„åº•å±‚æ“ä½œã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1.1 åŸºæœ¬Proxyç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> target = { <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> };

<span class="hljs-keyword">const</span> handler = {
  <span class="hljs-title function_">get</span>(<span class="hljs-params">target, property</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è·å–å±æ€§: <span class="hljs-subst">${property}</span>`</span>);
    <span class="hljs-keyword">return</span> target[property] || <span class="hljs-string">'å±æ€§ä¸å­˜åœ¨'</span>;
  },
  <span class="hljs-title function_">set</span>(<span class="hljs-params">target, property, value</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è®¾ç½®å±æ€§: <span class="hljs-subst">${property}</span> = <span class="hljs-subst">${value}</span>`</span>);
    <span class="hljs-keyword">if</span> (property === <span class="hljs-string">'age'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> value !== <span class="hljs-string">'number'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'å¹´é¾„å¿…é¡»æ˜¯æ•°å­—'</span>);
    }
    target[property] = value;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// è¡¨ç¤ºè®¾ç½®æˆåŠŸ</span>
  },
  <span class="hljs-title function_">deleteProperty</span>(<span class="hljs-params">target, property</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`åˆ é™¤å±æ€§: <span class="hljs-subst">${property}</span>`</span>);
    <span class="hljs-keyword">if</span> (property === <span class="hljs-string">'name'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'ä¸èƒ½åˆ é™¤nameå±æ€§'</span>);
    }
    <span class="hljs-keyword">delete</span> target[property];
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
};

<span class="hljs-keyword">const</span> proxy = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, handler);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy.<span class="hljs-property">name</span>); <span class="hljs-comment">// "è·å–å±æ€§: name" -&gt; "John"</span>
proxy.<span class="hljs-property">age</span> = <span class="hljs-number">31</span>; <span class="hljs-comment">// "è®¾ç½®å±æ€§: age = 31"</span>
<span class="hljs-comment">// proxy.age = '31' // æŠ›å‡ºé”™è¯¯ï¼šå¹´é¾„å¿…é¡»æ˜¯æ•°å­—</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(proxy.<span class="hljs-property">nonexistent</span>); <span class="hljs-comment">// "è·å–å±æ€§: nonexistent" -&gt; "å±æ€§ä¸å­˜åœ¨"</span>
</code></pre>
<h5 data-id="heading-3">Reflectï¼šå¯¹è±¡æ“ä½œçš„æ ‡å‡†åŒ–</h5>
<p>Reflectæä¾›äº†ä¸€å¥—æ“ä½œå¯¹è±¡çš„æ ‡å‡†æ–¹æ³•ï¼Œä¸Proxy handleræ–¹æ³•ä¸€ä¸€å¯¹åº”ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1.2 ReflectåŸºç¡€ç”¨æ³•</span>
<span class="hljs-keyword">const</span> user = {
  <span class="hljs-attr">_id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span>,
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">id</span>() {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_id</span>;
  },
  <span class="hljs-keyword">set</span> <span class="hljs-title function_">id</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_id</span> = value;
  }
};

<span class="hljs-comment">// å¯¹æ¯”ä¼ ç»Ÿæ–¹æ³•ä¸Reflect</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'name'</span> <span class="hljs-keyword">in</span> user); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">has</span>(user, <span class="hljs-string">'name'</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(user, <span class="hljs-string">'name'</span>));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getOwnPropertyDescriptor</span>(user, <span class="hljs-string">'name'</span>));

<span class="hljs-comment">// Reflectè°ƒç”¨æ–¹æ³•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(user, <span class="hljs-string">'name'</span>)); <span class="hljs-comment">// "Alice"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(user, <span class="hljs-string">'name'</span>, <span class="hljs-string">'Bob'</span>)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// éªŒè¯å¯¹è±¡æ˜¯å¦å¯æ‰©å±•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">isExtensible</span>(user)); <span class="hljs-comment">// true</span>
<span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">preventExtensions</span>(user);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">isExtensible</span>(user)); <span class="hljs-comment">// false</span>
</code></pre>
<h5 data-id="heading-4">é«˜çº§Proxyåº”ç”¨</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1.3 å®ç°æ•°æ®éªŒè¯Proxy</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createValidator</span>(<span class="hljs-params">target, validations</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {
    <span class="hljs-title function_">set</span>(<span class="hljs-params">obj, prop, value</span>) {
      <span class="hljs-keyword">if</span> (validations[prop]) {
        <span class="hljs-keyword">const</span> isValid = validations[prop](value);
        <span class="hljs-keyword">if</span> (!isValid) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`éªŒè¯å¤±è´¥: <span class="hljs-subst">${prop}</span> = <span class="hljs-subst">${value}</span>`</span>);
        }
      }
      <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(obj, prop, value);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
  });
}

<span class="hljs-keyword">const</span> validations = {
  <span class="hljs-attr">email</span>: <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> <span class="hljs-regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>.<span class="hljs-title function_">test</span>(val),
  <span class="hljs-attr">age</span>: <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> <span class="hljs-title class_">Number</span>.<span class="hljs-title function_">isInteger</span>(val) &amp;&amp; val &gt;= <span class="hljs-number">0</span> &amp;&amp; val &lt;= <span class="hljs-number">150</span>,
  <span class="hljs-attr">password</span>: <span class="hljs-function">(<span class="hljs-params">val</span>) =&gt;</span> val &amp;&amp; val.<span class="hljs-property">length</span> &gt;= <span class="hljs-number">8</span>
};

<span class="hljs-keyword">const</span> userData = <span class="hljs-title function_">createValidator</span>({}, validations);

<span class="hljs-keyword">try</span> {
  userData.<span class="hljs-property">email</span> = <span class="hljs-string">'test@example.com'</span>; <span class="hljs-comment">// æˆåŠŸ</span>
  userData.<span class="hljs-property">age</span> = <span class="hljs-number">25</span>; <span class="hljs-comment">// æˆåŠŸ</span>
  userData.<span class="hljs-property">password</span> = <span class="hljs-string">'short'</span>; <span class="hljs-comment">// æŠ›å‡ºé”™è¯¯</span>
} <span class="hljs-keyword">catch</span> (error) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error.<span class="hljs-property">message</span>); <span class="hljs-comment">// "éªŒè¯å¤±è´¥: password = short"</span>
}

<span class="hljs-comment">// 1.4 å®ç°è‡ªåŠ¨è§‚å¯Ÿè€…æ¨¡å¼</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createObservable</span>(<span class="hljs-params">target, callback</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(target, {
    <span class="hljs-title function_">set</span>(<span class="hljs-params">obj, prop, value</span>) {
      <span class="hljs-keyword">const</span> oldValue = obj[prop];
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(obj, prop, value);
      
      <span class="hljs-keyword">if</span> (oldValue !== value) {
        <span class="hljs-title function_">callback</span>(prop, oldValue, value);
      }
      
      <span class="hljs-keyword">return</span> result;
    }
  });
}

<span class="hljs-keyword">const</span> data = <span class="hljs-title function_">createObservable</span>({ <span class="hljs-attr">count</span>: <span class="hljs-number">0</span> }, <span class="hljs-function">(<span class="hljs-params">prop, oldVal, newVal</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ•°æ®å˜åŒ–: <span class="hljs-subst">${prop}</span> ä» <span class="hljs-subst">${oldVal}</span> å˜ä¸º <span class="hljs-subst">${newVal}</span>`</span>);
});

data.<span class="hljs-property">count</span> = <span class="hljs-number">1</span>; <span class="hljs-comment">// "æ•°æ®å˜åŒ–: count ä» 0 å˜ä¸º 1"</span>
data.<span class="hljs-property">count</span> = <span class="hljs-number">2</span>; <span class="hljs-comment">// "æ•°æ®å˜åŒ–: count ä» 1 å˜ä¸º 2"</span>

<span class="hljs-comment">// 1.5 å®ç°è´Ÿç´¢å¼•æ•°ç»„</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createNegativeArray</span>(<span class="hljs-params">arr</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(arr, {
    <span class="hljs-title function_">get</span>(<span class="hljs-params">target, prop</span>) {
      <span class="hljs-keyword">let</span> index = <span class="hljs-title class_">Number</span>(prop);
      
      <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span>) {
        index = target.<span class="hljs-property">length</span> + index;
      }
      
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, index);
    },
    <span class="hljs-title function_">set</span>(<span class="hljs-params">target, prop, value</span>) {
      <span class="hljs-keyword">let</span> index = <span class="hljs-title class_">Number</span>(prop);
      
      <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-number">0</span>) {
        index = target.<span class="hljs-property">length</span> + index;
      }
      
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">set</span>(target, index, value);
    }
  });
}

<span class="hljs-keyword">const</span> arr = <span class="hljs-title function_">createNegativeArray</span>([<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>]);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr[-<span class="hljs-number">1</span>]); <span class="hljs-comment">// "d"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr[-<span class="hljs-number">2</span>]); <span class="hljs-comment">// "c"</span>
arr[-<span class="hljs-number">1</span>] = <span class="hljs-string">'z'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr); <span class="hljs-comment">// ['a', 'b', 'c', 'z']</span>
</code></pre>
<h4 data-id="heading-5">äºŒã€Generator å’Œ Iterator</h4>
<h5 data-id="heading-6">Iteratorï¼šéå†åè®®çš„åŸºç¡€</h5>
<p>Iteratorä¸ºå„ç§æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„éå†æ¥å£ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 2.1 è‡ªå®šä¹‰è¿­ä»£å™¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Range</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">start, end, step = <span class="hljs-number">1</span></span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">start</span> = start;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">end</span> = end;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">step</span> = step;
  }
  
  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]() {
    <span class="hljs-keyword">let</span> current = <span class="hljs-variable language_">this</span>.<span class="hljs-property">start</span>;
    <span class="hljs-keyword">const</span> end = <span class="hljs-variable language_">this</span>.<span class="hljs-property">end</span>;
    <span class="hljs-keyword">const</span> step = <span class="hljs-variable language_">this</span>.<span class="hljs-property">step</span>;
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-title function_">next</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">if</span> (current &lt;= end) {
          <span class="hljs-keyword">const</span> value = current;
          current += step;
          <span class="hljs-keyword">return</span> { value, <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> };
        }
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">value</span>: <span class="hljs-literal">undefined</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span> };
      }
    };
  }
}

<span class="hljs-keyword">const</span> range = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> num <span class="hljs-keyword">of</span> range) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num); <span class="hljs-comment">// 1, 2, 3, 4, 5</span>
}

<span class="hljs-comment">// 2.2 æ— é™åºåˆ—è¿­ä»£å™¨</span>
<span class="hljs-keyword">function</span>* <span class="hljs-title function_">fibonacci</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">let</span> [prev, curr] = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>];
  
  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">yield</span> curr;
    [prev, curr] = [curr, prev + curr];
  }
}

<span class="hljs-keyword">const</span> fib = <span class="hljs-title function_">fibonacci</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fib.<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>); <span class="hljs-comment">// 1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fib.<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>); <span class="hljs-comment">// 1</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fib.<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>); <span class="hljs-comment">// 2</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fib.<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>); <span class="hljs-comment">// 3</span>
</code></pre>
<h5 data-id="heading-7">Generatorï¼šæ›´ä¼˜é›…çš„è¿­ä»£å™¨</h5>
<p>Generatorå‡½æ•°æä¾›äº†ä¸€ç§æ›´ç®€æ´çš„å®ç°è¿­ä»£å™¨çš„æ–¹å¼ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 2.3 åŸºç¡€Generator</span>
<span class="hljs-keyword">function</span>* <span class="hljs-title function_">numberGenerator</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">yield</span> <span class="hljs-number">1</span>;
  <span class="hljs-keyword">yield</span> <span class="hljs-number">2</span>;
  <span class="hljs-keyword">yield</span> <span class="hljs-number">3</span>;
}

<span class="hljs-keyword">const</span> gen = <span class="hljs-title function_">numberGenerator</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gen.<span class="hljs-title function_">next</span>()); <span class="hljs-comment">// { value: 1, done: false }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gen.<span class="hljs-title function_">next</span>()); <span class="hljs-comment">// { value: 2, done: false }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gen.<span class="hljs-title function_">next</span>()); <span class="hljs-comment">// { value: 3, done: false }</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gen.<span class="hljs-title function_">next</span>()); <span class="hljs-comment">// { value: undefined, done: true }</span>

<span class="hljs-comment">// 2.4 åŒå‘é€šä¿¡</span>
<span class="hljs-keyword">function</span>* <span class="hljs-title function_">twoWayCommunication</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> name = <span class="hljs-keyword">yield</span> <span class="hljs-string">'è¯·è¾“å…¥ä½ çš„åå­—:'</span>;
  <span class="hljs-keyword">const</span> age = <span class="hljs-keyword">yield</span> <span class="hljs-string">`ä½ å¥½ <span class="hljs-subst">${name}</span>, è¯·è¾“å…¥ä½ çš„å¹´é¾„:`</span>;
  <span class="hljs-keyword">yield</span> <span class="hljs-string">`ä¿¡æ¯æ±‡æ€»: åå­—-<span class="hljs-subst">${name}</span>, å¹´é¾„-<span class="hljs-subst">${age}</span>`</span>;
}

<span class="hljs-keyword">const</span> communicator = <span class="hljs-title function_">twoWayCommunication</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(communicator.<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>); <span class="hljs-comment">// "è¯·è¾“å…¥ä½ çš„åå­—:"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(communicator.<span class="hljs-title function_">next</span>(<span class="hljs-string">'å¼ ä¸‰'</span>).<span class="hljs-property">value</span>); <span class="hljs-comment">// "ä½ å¥½ å¼ ä¸‰, è¯·è¾“å…¥ä½ çš„å¹´é¾„:"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(communicator.<span class="hljs-title function_">next</span>(<span class="hljs-number">25</span>).<span class="hljs-property">value</span>); <span class="hljs-comment">// "ä¿¡æ¯æ±‡æ€»: åå­—-å¼ ä¸‰, å¹´é¾„-25"</span>

<span class="hljs-comment">// 2.5 å¼‚æ­¥æ“ä½œè°ƒåº¦</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncTask</span>(<span class="hljs-params">value, delay</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å®Œæˆ: <span class="hljs-subst">${value}</span>`</span>);
      <span class="hljs-title function_">resolve</span>(value);
    }, delay);
  });
}

<span class="hljs-keyword">function</span>* <span class="hljs-title function_">asyncGenerator</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> result1 = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">asyncTask</span>(<span class="hljs-string">'ä»»åŠ¡1'</span>, <span class="hljs-number">1000</span>);
  <span class="hljs-keyword">const</span> result2 = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">asyncTask</span>(<span class="hljs-string">'ä»»åŠ¡2'</span>, <span class="hljs-number">500</span>);
  <span class="hljs-keyword">const</span> result3 = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">asyncTask</span>(<span class="hljs-string">'ä»»åŠ¡3'</span>, <span class="hljs-number">800</span>);
  <span class="hljs-keyword">return</span> [result1, result2, result3];
}

<span class="hljs-comment">// Generatoræ‰§è¡Œå™¨</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">runGenerator</span>(<span class="hljs-params">genFunc</span>) {
  <span class="hljs-keyword">const</span> gen = <span class="hljs-title function_">genFunc</span>();
  <span class="hljs-keyword">let</span> result;
  
  <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">const</span> { value, done } = gen.<span class="hljs-title function_">next</span>(result);
    
    <span class="hljs-keyword">if</span> (done) {
      <span class="hljs-keyword">return</span> value;
    }
    
    <span class="hljs-keyword">if</span> (value &amp;&amp; <span class="hljs-keyword">typeof</span> value.<span class="hljs-property">then</span> === <span class="hljs-string">'function'</span>) {
      result = <span class="hljs-keyword">await</span> value;
    } <span class="hljs-keyword">else</span> {
      result = value;
    }
  }
}

<span class="hljs-title function_">runGenerator</span>(asyncGenerator).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ‰€æœ‰ä»»åŠ¡å®Œæˆ:'</span>, results);
});
</code></pre>
<h4 data-id="heading-8">ä¸‰ã€ES Symbol çš„åº”ç”¨åœºæ™¯</h4>
<h5 data-id="heading-9">Symbolï¼šåˆ›å»ºå”¯ä¸€æ ‡è¯†ç¬¦</h5>
<p>Symbolæ˜¯ES6å¼•å…¥çš„æ–°çš„åŸå§‹æ•°æ®ç±»å‹ï¼Œè¡¨ç¤ºå”¯ä¸€çš„å€¼ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 3.1 åŸºæœ¬Symbolä½¿ç”¨</span>
<span class="hljs-keyword">const</span> sym1 = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'description'</span>);
<span class="hljs-keyword">const</span> sym2 = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'description'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sym1 === sym2); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> sym1); <span class="hljs-comment">// "symbol"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(sym1.<span class="hljs-title function_">toString</span>()); <span class="hljs-comment">// "Symbol(description)"</span>

<span class="hljs-comment">// 3.2 å…¨å±€Symbolæ³¨å†Œè¡¨</span>
<span class="hljs-keyword">const</span> globalSym1 = <span class="hljs-title class_">Symbol</span>.<span class="hljs-title function_">for</span>(<span class="hljs-string">'global.key'</span>);
<span class="hljs-keyword">const</span> globalSym2 = <span class="hljs-title class_">Symbol</span>.<span class="hljs-title function_">for</span>(<span class="hljs-string">'global.key'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(globalSym1 === globalSym2); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Symbol</span>.<span class="hljs-title function_">keyFor</span>(globalSym1)); <span class="hljs-comment">// "global.key"</span>

<span class="hljs-comment">// 3.3 å¯¹è±¡å±æ€§çš„å”¯ä¸€é”®</span>
<span class="hljs-keyword">const</span> user = {
  [<span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'id'</span>)]: <span class="hljs-number">12345</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(user)); <span class="hljs-comment">// ["name"]</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getOwnPropertySymbols</span>(user)); <span class="hljs-comment">// [Symbol(id)]</span>

<span class="hljs-comment">// é˜²æ­¢å±æ€§åå†²çª</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PRIVATE_ID</span> = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'id'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PRIVATE_METHOD</span> = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">'privateMethod'</span>);

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SecureClass</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id</span>) {
    <span class="hljs-variable language_">this</span>[<span class="hljs-variable constant_">PRIVATE_ID</span>] = id;
  }
  
  [<span class="hljs-variable constant_">PRIVATE_METHOD</span>]() {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç§æœ‰æ–¹æ³•è¢«è°ƒç”¨'</span>);
  }
  
  <span class="hljs-title function_">getPublicId</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>[<span class="hljs-variable constant_">PRIVATE_ID</span>];
  }
  
  <span class="hljs-title function_">callPrivateMethod</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>[<span class="hljs-variable constant_">PRIVATE_METHOD</span>]();
  }
}

<span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecureClass</span>(<span class="hljs-number">100</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(instance.<span class="hljs-title function_">getPublicId</span>()); <span class="hljs-comment">// 100</span>
instance.<span class="hljs-title function_">callPrivateMethod</span>(); <span class="hljs-comment">// "ç§æœ‰æ–¹æ³•è¢«è°ƒç”¨"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(instance[<span class="hljs-variable constant_">PRIVATE_ID</span>]); <span class="hljs-comment">// undefined (å¤–éƒ¨æ— æ³•è®¿é—®)</span>
</code></pre>
<h5 data-id="heading-10">å†…ç½®Symbolï¼šæ”¹å˜è¯­è¨€è¡Œä¸º</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 3.4 Symbol.iterator - å®šä¹‰å¯¹è±¡çš„é»˜è®¤è¿­ä»£å™¨</span>
<span class="hljs-keyword">const</span> customIterable = {
  <span class="hljs-attr">data</span>: [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>],
  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]() {
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">next</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">length</span>) {
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>[index++], <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> };
        }
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">value</span>: <span class="hljs-literal">undefined</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span> };
      }
    };
  }
};

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> customIterable) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item); <span class="hljs-comment">// "a", "b", "c"</span>
}

<span class="hljs-comment">// 3.5 Symbol.toPrimitive - è‡ªå®šä¹‰ç±»å‹è½¬æ¢</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Temperature</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">celsius</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">celsius</span> = celsius;
  }
  
  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">toPrimitive</span>](hint) {
    <span class="hljs-keyword">if</span> (hint === <span class="hljs-string">'string'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.celsius}</span>Â°C`</span>;
    }
    <span class="hljs-keyword">if</span> (hint === <span class="hljs-string">'number'</span> || hint === <span class="hljs-string">'default'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">celsius</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
}

<span class="hljs-keyword">const</span> temp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Temperature</span>(<span class="hljs-number">25</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">String</span>(temp)); <span class="hljs-comment">// "25Â°C"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Number</span>(temp) + <span class="hljs-number">10</span>); <span class="hljs-comment">// 35</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(temp + <span class="hljs-number">5</span>); <span class="hljs-comment">// 30</span>

<span class="hljs-comment">// 3.6 Symbol.hasInstance - è‡ªå®šä¹‰instanceofè¡Œä¸º</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyArray</span> {
  <span class="hljs-keyword">static</span> [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">hasInstance</span>](instance) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(instance);
  }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyArray</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>({} <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyArray</span>); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 3.7 Symbol.species - æ§åˆ¶è¡ç”Ÿå¯¹è±¡çš„æ„é€ å‡½æ•°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomArray</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Array</span> {
  <span class="hljs-keyword">static</span> get [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">species</span>]() {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>; <span class="hljs-comment">// è¡ç”Ÿå¯¹è±¡ä½¿ç”¨Arrayè€Œä¸æ˜¯CustomArray</span>
  }
}

<span class="hljs-keyword">const</span> custom = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomArray</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
<span class="hljs-keyword">const</span> mapped = custom.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x * <span class="hljs-number">2</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(custom <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">CustomArray</span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mapped <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">CustomArray</span>); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mapped <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 3.8 Symbol.match - è‡ªå®šä¹‰å­—ç¬¦ä¸²åŒ¹é…</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CaseInsensitiveMatcher</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value.<span class="hljs-title function_">toLowerCase</span>();
  }
  
  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">match</span>](string) {
    <span class="hljs-keyword">return</span> string.<span class="hljs-title function_">toLowerCase</span>().<span class="hljs-title function_">indexOf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);
  }
}

<span class="hljs-keyword">const</span> str = <span class="hljs-string">'Hello World'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'world'</span>.<span class="hljs-title function_">match</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CaseInsensitiveMatcher</span>(<span class="hljs-string">'WORLD'</span>))); <span class="hljs-comment">// 6</span>
</code></pre>
<h4 data-id="heading-11">å››ã€WeakMap å’Œ WeakSet</h4>
<h5 data-id="heading-12">WeakMapï¼šå¼±å¼•ç”¨æ˜ å°„</h5>
<p>WeakMapçš„é”®å¿…é¡»æ˜¯å¯¹è±¡ï¼Œä¸”é”®æ˜¯å¼±å¼•ç”¨ï¼Œä¸ä¼šé˜»æ­¢åƒåœ¾å›æ”¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 4.1 WeakMapåŸºæœ¬ç”¨æ³•</span>
<span class="hljs-keyword">const</span> wm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();

<span class="hljs-keyword">let</span> obj1 = { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> };
<span class="hljs-keyword">let</span> obj2 = { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span> };

wm.<span class="hljs-title function_">set</span>(obj1, <span class="hljs-string">'value1'</span>);
wm.<span class="hljs-title function_">set</span>(obj2, <span class="hljs-string">'value2'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(wm.<span class="hljs-title function_">get</span>(obj1)); <span class="hljs-comment">// "value1"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(wm.<span class="hljs-title function_">has</span>(obj1)); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// å½“å¯¹è±¡è¢«åƒåœ¾å›æ”¶åï¼ŒWeakMapä¸­çš„æ¡ç›®è‡ªåŠ¨ç§»é™¤</span>
obj1 = <span class="hljs-literal">null</span>;

<span class="hljs-comment">// ç­‰å¾…åƒåœ¾å›æ”¶</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(wm.<span class="hljs-title function_">get</span>(obj1)); <span class="hljs-comment">// undefined</span>
}, <span class="hljs-number">1000</span>);

<span class="hljs-comment">// 4.2 ç§æœ‰æˆå‘˜å®ç°</span>
<span class="hljs-keyword">const</span> privateData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();

<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age</span>) {
    privateData.<span class="hljs-title function_">set</span>(<span class="hljs-variable language_">this</span>, { name, age });
  }
  
  <span class="hljs-title function_">getName</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> privateData.<span class="hljs-title function_">get</span>(<span class="hljs-variable language_">this</span>).<span class="hljs-property">name</span>;
  }
  
  <span class="hljs-title function_">getAge</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> privateData.<span class="hljs-title function_">get</span>(<span class="hljs-variable language_">this</span>).<span class="hljs-property">age</span>;
  }
  
  <span class="hljs-title function_">setAge</span>(<span class="hljs-params">age</span>) {
    <span class="hljs-keyword">const</span> data = privateData.<span class="hljs-title function_">get</span>(<span class="hljs-variable language_">this</span>);
    data.<span class="hljs-property">age</span> = age;
  }
}

<span class="hljs-keyword">const</span> user1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">'Alice'</span>, <span class="hljs-number">25</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user1.<span class="hljs-title function_">getName</span>()); <span class="hljs-comment">// "Alice"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user1.<span class="hljs-property">age</span>); <span class="hljs-comment">// undefined (æ— æ³•ç›´æ¥è®¿é—®)</span>

<span class="hljs-comment">// 4.3 DOMå…ƒç´ å…³è”æ•°æ®</span>
<span class="hljs-keyword">const</span> domData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">attachData</span>(<span class="hljs-params">element, data</span>) {
  domData.<span class="hljs-title function_">set</span>(element, data);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getData</span>(<span class="hljs-params">element</span>) {
  <span class="hljs-keyword">return</span> domData.<span class="hljs-title function_">get</span>(element);
}

<span class="hljs-keyword">const</span> button = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'button'</span>);
<span class="hljs-title function_">attachData</span>(button, { <span class="hljs-attr">clicks</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">lastClick</span>: <span class="hljs-literal">null</span> });

button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">getData</span>(button);
  data.<span class="hljs-property">clicks</span>++;
  data.<span class="hljs-property">lastClick</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ç‚¹å‡»æ¬¡æ•°: <span class="hljs-subst">${data.clicks}</span>`</span>);
});

<span class="hljs-comment">// å½“buttonå…ƒç´ ä»DOMç§»é™¤å¹¶è¢«åƒåœ¾å›æ”¶åï¼Œå…³è”æ•°æ®è‡ªåŠ¨æ¸…é™¤</span>
</code></pre>
<h5 data-id="heading-13">WeakSetï¼šå¼±å¼•ç”¨é›†åˆ</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 4.4 WeakSetåŸºæœ¬ç”¨æ³•</span>
<span class="hljs-keyword">const</span> ws = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakSet</span>();

<span class="hljs-keyword">let</span> obj1 = {};
<span class="hljs-keyword">let</span> obj2 = {};

ws.<span class="hljs-title function_">add</span>(obj1);
ws.<span class="hljs-title function_">add</span>(obj2);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ws.<span class="hljs-title function_">has</span>(obj1)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ws.<span class="hljs-title function_">has</span>(obj2)); <span class="hljs-comment">// true</span>

ws.<span class="hljs-title function_">delete</span>(obj1);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(ws.<span class="hljs-title function_">has</span>(obj1)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 4.5 é˜²æ­¢é‡å¤æ³¨å†Œäº‹ä»¶</span>
<span class="hljs-keyword">const</span> registeredListeners = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakSet</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">addSafeEventListener</span>(<span class="hljs-params">element, event, handler</span>) {
  <span class="hljs-keyword">if</span> (registeredListeners.<span class="hljs-title function_">has</span>(handler)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'è¯¥ç›‘å¬å™¨å·²æ³¨å†Œ'</span>);
    <span class="hljs-keyword">return</span>;
  }
  
  element.<span class="hljs-title function_">addEventListener</span>(event, handler);
  registeredListeners.<span class="hljs-title function_">add</span>(handler);
}

<span class="hljs-keyword">const</span> button = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'button'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handler</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'clicked'</span>);

<span class="hljs-title function_">addSafeEventListener</span>(button, <span class="hljs-string">'click'</span>, handler); <span class="hljs-comment">// æˆåŠŸæ³¨å†Œ</span>
<span class="hljs-title function_">addSafeEventListener</span>(button, <span class="hljs-string">'click'</span>, handler); <span class="hljs-comment">// è­¦å‘Š: è¯¥ç›‘å¬å™¨å·²æ³¨å†Œ</span>

<span class="hljs-comment">// 4.6 å¯¹è±¡æ ‡è®°</span>
<span class="hljs-keyword">const</span> processedObjects = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakSet</span>();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">processObject</span>(<span class="hljs-params">obj</span>) {
  <span class="hljs-keyword">if</span> (processedObjects.<span class="hljs-title function_">has</span>(obj)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¯¹è±¡å·²å¤„ç†è¿‡'</span>);
    <span class="hljs-keyword">return</span>;
  }
  
  <span class="hljs-comment">// å¤„ç†å¯¹è±¡...</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¤„ç†å¯¹è±¡:'</span>, obj);
  processedObjects.<span class="hljs-title function_">add</span>(obj);
}

<span class="hljs-keyword">const</span> data = { <span class="hljs-attr">value</span>: <span class="hljs-number">42</span> };
<span class="hljs-title function_">processObject</span>(data); <span class="hljs-comment">// "å¤„ç†å¯¹è±¡: {value: 42}"</span>
<span class="hljs-title function_">processObject</span>(data); <span class="hljs-comment">// "å¯¹è±¡å·²å¤„ç†è¿‡"</span>
</code></pre>
<h4 data-id="heading-14">äº”ã€ç®­å¤´å‡½æ•°å’Œthisç»‘å®š</h4>
<p>ç®­å¤´å‡½æ•°ä¸ä»…è¯­æ³•ç®€æ´ï¼Œæ›´é‡è¦çš„æ˜¯å®ƒä¸ç»‘å®šè‡ªå·±çš„thisã€argumentsã€superæˆ–new.targetã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 5.1 ç®­å¤´å‡½æ•°ä¸æ™®é€šå‡½æ•°å¯¹æ¯”</span>
<span class="hljs-keyword">const</span> obj = {
  <span class="hljs-attr">value</span>: <span class="hljs-number">42</span>,
  
  <span class="hljs-comment">// æ™®é€šå‡½æ•° - thiså–å†³äºè°ƒç”¨æ–¹å¼</span>
  <span class="hljs-attr">normalFunc</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>);
  },
  
  <span class="hljs-comment">// ç®­å¤´å‡½æ•° - thisç»§æ‰¿è‡ªå¤–å±‚ä½œç”¨åŸŸ</span>
  <span class="hljs-attr">arrowFunc</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>); <span class="hljs-comment">// æŒ‡å‘å…¨å±€this</span>
  },
  
  <span class="hljs-comment">// åµŒå¥—å‡½æ•°ä¸­çš„thisé—®é¢˜</span>
  <span class="hljs-attr">nestedFunction</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> innerFunc = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>); <span class="hljs-comment">// undefined</span>
    };
    <span class="hljs-title function_">innerFunc</span>();
  },
  
  <span class="hljs-comment">// ä½¿ç”¨ç®­å¤´å‡½æ•°è§£å†³åµŒå¥—thisé—®é¢˜</span>
  <span class="hljs-attr">nestedArrow</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">innerFunc</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>); <span class="hljs-comment">// 42</span>
    };
    <span class="hljs-title function_">innerFunc</span>();
  }
};

obj.<span class="hljs-title function_">normalFunc</span>(); <span class="hljs-comment">// 42</span>
obj.<span class="hljs-title function_">arrowFunc</span>(); <span class="hljs-comment">// undefined</span>
obj.<span class="hljs-title function_">nestedFunction</span>(); <span class="hljs-comment">// undefined</span>
obj.<span class="hljs-title function_">nestedArrow</span>(); <span class="hljs-comment">// 42</span>

<span class="hljs-comment">// 5.2 å›è°ƒå‡½æ•°ä¸­çš„this</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Button</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = <span class="hljs-string">'Click me'</span>;
    
    <span class="hljs-comment">// é”™è¯¯ç¤ºä¾‹</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>); <span class="hljs-comment">// undefined</span>
    });
    
    <span class="hljs-comment">// æ­£ç¡®ç¤ºä¾‹ - ä½¿ç”¨ç®­å¤´å‡½æ•°</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>); <span class="hljs-comment">// "Click me"</span>
    });
    
    <span class="hljs-comment">// æˆ–è€…ä½¿ç”¨bind</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleClick</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
  }
  
  <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>);
  }
}

<span class="hljs-comment">// 5.3 ç®­å¤´å‡½æ•°ä½œä¸ºæ–¹æ³•çš„é—®é¢˜</span>
<span class="hljs-keyword">const</span> calculator = {
  <span class="hljs-attr">values</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>],
  
  <span class="hljs-comment">// ç®­å¤´å‡½æ•°ä½œä¸ºæ–¹æ³• - æ— æ³•è®¿é—®å®ä¾‹å±æ€§</span>
  <span class="hljs-attr">sumArrow</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">values</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">values</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>) : <span class="hljs-number">0</span>;
  },
  
  <span class="hljs-comment">// æ™®é€šå‡½æ•°ä½œä¸ºæ–¹æ³•</span>
  <span class="hljs-attr">sumNormal</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">values</span>.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b, <span class="hljs-number">0</span>);
  }
};

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(calculator.<span class="hljs-title function_">sumArrow</span>()); <span class="hljs-comment">// 0 (thisæŒ‡å‘å…¨å±€)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(calculator.<span class="hljs-title function_">sumNormal</span>()); <span class="hljs-comment">// 15</span>

<span class="hljs-comment">// 5.4 ç®­å¤´å‡½æ•°ä¸æ„é€ å‡½æ•°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Person</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
};

<span class="hljs-comment">// ç®­å¤´å‡½æ•°ä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ArrowPerson</span> = (<span class="hljs-params">name</span>) =&gt; {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; <span class="hljs-comment">// é”™è¯¯</span>
};

<span class="hljs-comment">// new Person('John'); // æ­£å¸¸</span>
<span class="hljs-comment">// new ArrowPerson('John'); // æŠ›å‡ºé”™è¯¯: ArrowPerson is not a constructor</span>
</code></pre>
<h5 data-id="heading-15">å…­ã€Promiseã€async/await å’Œå¼‚æ­¥ç¼–ç¨‹</h5>
<h5 data-id="heading-16">Promiseï¼šå¼‚æ­¥ç¼–ç¨‹çš„åŸºç¡€</h5>
<p>å…³äºPromiseå¯ä»¥é˜…è¯» <a href="https://juejin.cn/post/7580208715275976746" target="_blank" title="https://juejin.cn/post/7580208715275976746">æ‰‹å†™ Promiseï¼šæ·±å…¥ç†è§£ JavaScript å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒ</a></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 6.1 PromiseåŸºç¡€</span>
<span class="hljs-keyword">const</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> random = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>();
    <span class="hljs-keyword">if</span> (random &gt; <span class="hljs-number">0.5</span>) {
      <span class="hljs-title function_">resolve</span>(<span class="hljs-string">`æˆåŠŸ: <span class="hljs-subst">${random}</span>`</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">reject</span>(<span class="hljs-string">`å¤±è´¥: <span class="hljs-subst">${random}</span>`</span>);
    }
  }, <span class="hljs-number">1000</span>);
});

promise
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result))
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error))
  .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å®Œæˆ'</span>));

<span class="hljs-comment">// 6.2 Promiseé™æ€æ–¹æ³•</span>
<span class="hljs-comment">// Promise.all - æ‰€æœ‰æˆåŠŸæˆ–ä¸€ä¸ªå¤±è´¥</span>
<span class="hljs-keyword">const</span> promises = [
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">1</span>),
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">2</span>),
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-number">3</span>)
];

<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(promises)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(results)) <span class="hljs-comment">// [1, 2, 3]</span>
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error));

<span class="hljs-comment">// Promise.allSettled - ç­‰å¾…æ‰€æœ‰å®Œæˆ</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">allSettled</span>([
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'æˆåŠŸ1'</span>),
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">'å¤±è´¥1'</span>),
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'æˆåŠŸ2'</span>)
])
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {
  results.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">result, index</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">status</span> === <span class="hljs-string">'fulfilled'</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Promise <span class="hljs-subst">${index}</span>: <span class="hljs-subst">${result.value}</span>`</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Promise <span class="hljs-subst">${index}</span>: <span class="hljs-subst">${result.reason}</span>`</span>);
    }
  });
});

<span class="hljs-comment">// Promise.race - ç¬¬ä¸€ä¸ªå®Œæˆï¼ˆæ— è®ºæˆåŠŸå¤±è´¥ï¼‰</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'å¿«é€Ÿ'</span>), <span class="hljs-number">100</span>)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-string">'æ…¢é€Ÿ'</span>), <span class="hljs-number">500</span>))
])
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result)); <span class="hljs-comment">// "å¿«é€Ÿ"</span>

<span class="hljs-comment">// Promise.any - ç¬¬ä¸€ä¸ªæˆåŠŸ</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">any</span>([
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">'é”™è¯¯1'</span>),
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">'é”™è¯¯2'</span>),
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'æˆåŠŸ'</span>)
])
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">result</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result)) <span class="hljs-comment">// "æˆåŠŸ"</span>
.<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error));

<span class="hljs-comment">// 6.3 å®ç°Promise</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPromise</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">executor</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = <span class="hljs-string">'pending'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-literal">undefined</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = <span class="hljs-literal">undefined</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onFulfilledCallbacks</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span> = [];
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">resolve</span> = (<span class="hljs-params">value</span>) =&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-string">'pending'</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = <span class="hljs-string">'fulfilled'</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onFulfilledCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> <span class="hljs-title function_">callback</span>(value));
      }
    };
    
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">reject</span> = (<span class="hljs-params">reason</span>) =&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-string">'pending'</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> = <span class="hljs-string">'rejected'</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = reason;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">callback</span> =&gt;</span> <span class="hljs-title function_">callback</span>(reason));
      }
    };
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-title function_">executor</span>(resolve, reject);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-title function_">reject</span>(error);
    }
  }
  
  <span class="hljs-title function_">then</span>(<span class="hljs-params">onFulfilled, onRejected</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyPromise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleFulfilled</span> = (<span class="hljs-params">value</span>) =&gt; {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> result = onFulfilled ? <span class="hljs-title function_">onFulfilled</span>(value) : value;
          <span class="hljs-title function_">resolve</span>(result);
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-title function_">reject</span>(error);
        }
      };
      
      <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleRejected</span> = (<span class="hljs-params">reason</span>) =&gt; {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-keyword">const</span> result = onRejected ? <span class="hljs-title function_">onRejected</span>(reason) : reason;
          <span class="hljs-title function_">resolve</span>(result);
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-title function_">reject</span>(error);
        }
      };
      
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-string">'fulfilled'</span>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">handleFulfilled</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>), <span class="hljs-number">0</span>);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span> === <span class="hljs-string">'rejected'</span>) {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">handleRejected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span>), <span class="hljs-number">0</span>);
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onFulfilledCallbacks</span>.<span class="hljs-title function_">push</span>(handleFulfilled);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">onRejectedCallbacks</span>.<span class="hljs-title function_">push</span>(handleRejected);
      }
    });
  }
  
  <span class="hljs-keyword">catch</span>(onRejected) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">then</span>(<span class="hljs-literal">null</span>, onRejected);
  }
  
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">resolve</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyPromise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-title function_">resolve</span>(value));
  }
  
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">reject</span>(<span class="hljs-params">reason</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyPromise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span> <span class="hljs-title function_">reject</span>(reason));
  }
}
</code></pre>
<h5 data-id="heading-17">async/awaitï¼šæ›´ä¼˜é›…çš„å¼‚æ­¥</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 6.4 async/awaitåŸºç¡€</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUser</span>(<span class="hljs-params">userId</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// æ¨¡æ‹ŸAPIè¯·æ±‚</span>
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">id</span>: userId, <span class="hljs-attr">name</span>: <span class="hljs-string">'John Doe'</span> });
      }, <span class="hljs-number">1000</span>);
    });
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç”¨æˆ·æ•°æ®:'</span>, response);
    <span class="hljs-keyword">return</span> response;
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'è·å–ç”¨æˆ·å¤±è´¥:'</span>, error);
    <span class="hljs-keyword">throw</span> error;
  }
}

<span class="hljs-comment">// ä½¿ç”¨asyncå‡½æ•°</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">processUser</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>(<span class="hljs-number">1</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å¤„ç†ç”¨æˆ·: <span class="hljs-subst">${user.name}</span>`</span>);
  <span class="hljs-keyword">return</span> user;
}

<span class="hljs-title function_">processUser</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">user</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å¤„ç†å®Œæˆ:'</span>, user));

<span class="hljs-comment">// 6.5 å¹¶å‘æ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œ</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchMultipleUsers</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [user1, user2, user3] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([
    <span class="hljs-title function_">fetchUser</span>(<span class="hljs-number">1</span>),
    <span class="hljs-title function_">fetchUser</span>(<span class="hljs-number">2</span>),
    <span class="hljs-title function_">fetchUser</span>(<span class="hljs-number">3</span>)
  ]);
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ‰€æœ‰ç”¨æˆ·:'</span>, [user1, user2, user3]);
  <span class="hljs-keyword">return</span> [user1, user2, user3];
}

<span class="hljs-comment">// 6.6 å¼‚æ­¥è¿­ä»£</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>* <span class="hljs-title function_">asyncGenerator</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">100</span>));
    <span class="hljs-keyword">yield</span> i;
  }
}

(<span class="hljs-keyword">async</span> () =&gt; {
  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> value <span class="hljs-keyword">of</span> <span class="hljs-title function_">asyncGenerator</span>()) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value); <span class="hljs-comment">// 0, 1, 2</span>
  }
})();

<span class="hljs-comment">// 6.7 å®ç°async/awaitçš„polyfill</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">asyncToGenerator</span>(<span class="hljs-params">generatorFunc</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">const</span> gen = generatorFunc.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
    
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
      <span class="hljs-keyword">function</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">key, arg</span>) {
        <span class="hljs-keyword">let</span> result;
        
        <span class="hljs-keyword">try</span> {
          result = gen[key](arg);
        } <span class="hljs-keyword">catch</span> (error) {
          <span class="hljs-title function_">reject</span>(error);
          <span class="hljs-keyword">return</span>;
        }
        
        <span class="hljs-keyword">const</span> { value, done } = result;
        
        <span class="hljs-keyword">if</span> (done) {
          <span class="hljs-title function_">resolve</span>(value);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(value).<span class="hljs-title function_">then</span>(
            <span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> <span class="hljs-title function_">step</span>(<span class="hljs-string">'next'</span>, val),
            <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-title function_">step</span>(<span class="hljs-string">'throw'</span>, err)
          );
        }
      }
      
      <span class="hljs-title function_">step</span>(<span class="hljs-string">'next'</span>);
    });
  };
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> originalAsync = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">x</span>) {
  <span class="hljs-keyword">const</span> a = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(x);
  <span class="hljs-keyword">const</span> b = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(a + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">return</span> b;
};

<span class="hljs-keyword">const</span> polyfilledAsync = <span class="hljs-title function_">asyncToGenerator</span>(<span class="hljs-keyword">function</span>*(x) {
  <span class="hljs-keyword">const</span> a = <span class="hljs-keyword">yield</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(x);
  <span class="hljs-keyword">const</span> b = <span class="hljs-keyword">yield</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(a + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">return</span> b;
});

<span class="hljs-title function_">originalAsync</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">then</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>); <span class="hljs-comment">// 6</span>
<span class="hljs-title function_">polyfilledAsync</span>(<span class="hljs-number">5</span>).<span class="hljs-title function_">then</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>); <span class="hljs-comment">// 6</span>
</code></pre>
<h4 data-id="heading-18">ä¸ƒã€ç±»ä¸é¢å‘å¯¹è±¡ç¼–ç¨‹</h4>
<p>ES6å¼•å…¥äº†åŸºäºç±»çš„é¢å‘å¯¹è±¡ç¼–ç¨‹è¯­æ³•ï¼Œæ›´æ¥è¿‘ä¼ ç»Ÿé¢å‘å¯¹è±¡è¯­è¨€ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 7.1 ç±»çš„åŸºæœ¬è¯­æ³•</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_id</span> = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  }
  
  <span class="hljs-comment">// å®ä¾‹æ–¹æ³•</span>
  <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> å‘å‡ºå£°éŸ³`</span>);
  }
  
  <span class="hljs-comment">// é™æ€æ–¹æ³•</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">isAnimal</span>(<span class="hljs-params">obj</span>) {
    <span class="hljs-keyword">return</span> obj <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Animal</span>;
  }
  
  <span class="hljs-comment">// Getter/Setter</span>
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">id</span>() {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_id</span>;
  }
  
  <span class="hljs-keyword">set</span> <span class="hljs-title function_">id</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'idæ˜¯åªè¯»å±æ€§'</span>);
  }
  
  <span class="hljs-comment">// ç§æœ‰å­—æ®µï¼ˆES2022ï¼‰</span>
  #secret = <span class="hljs-string">'è¿™æ˜¯ç§æœ‰å­—æ®µ'</span>;
  
  <span class="hljs-title function_">revealSecret</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#secret;
  }
}

<span class="hljs-comment">// 7.2 ç»§æ‰¿</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age, breed</span>) {
    <span class="hljs-variable language_">super</span>(name, age); <span class="hljs-comment">// è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">breed</span> = breed;
  }
  
  <span class="hljs-comment">// æ–¹æ³•é‡å†™</span>
  <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> æ±ªæ±ªå«`</span>);
  }
  
  <span class="hljs-comment">// æ–°æ–¹æ³•</span>
  <span class="hljs-title function_">fetch</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> å»æ¡çƒ`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">'çƒ'</span>;
  }
  
  <span class="hljs-comment">// é™æ€æ–¹æ³•ç»§æ‰¿</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">createPuppy</span>(<span class="hljs-params">name, breed</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(name, <span class="hljs-number">0</span>, breed);
  }
}

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">'Buddy'</span>, <span class="hljs-number">3</span>, <span class="hljs-string">'Golden Retriever'</span>);
dog.<span class="hljs-title function_">speak</span>(); <span class="hljs-comment">// "Buddy æ±ªæ±ªå«"</span>
dog.<span class="hljs-title function_">fetch</span>(); <span class="hljs-comment">// "Buddy å»æ¡çƒ"</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Dog</span>.<span class="hljs-title function_">isAnimal</span>(dog)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog.<span class="hljs-title function_">revealSecret</span>()); <span class="hljs-comment">// "è¿™æ˜¯ç§æœ‰å­—æ®µ"</span>

<span class="hljs-comment">// 7.3 Mixinæ¨¡å¼</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">CanSwim</span> = <span class="hljs-title class_">Base</span> =&gt; <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">Base</span> {
  <span class="hljs-title function_">swim</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> åœ¨æ¸¸æ³³`</span>);
  }
};

<span class="hljs-keyword">const</span> <span class="hljs-title function_">CanFly</span> = <span class="hljs-title class_">Base</span> =&gt; <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">Base</span> {
  <span class="hljs-title function_">fly</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> åœ¨é£ç¿”`</span>);
  }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">CanFly</span>(<span class="hljs-title class_">Animal</span>) {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-variable language_">super</span>(name, age);
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Duck</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">CanSwim</span>(<span class="hljs-title class_">CanFly</span>(<span class="hljs-title class_">Animal</span>)) {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, age</span>) {
    <span class="hljs-variable language_">super</span>(name, age);
  }
}

<span class="hljs-keyword">const</span> duck = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Duck</span>(<span class="hljs-string">'Donald'</span>, <span class="hljs-number">2</span>);
duck.<span class="hljs-title function_">swim</span>(); <span class="hljs-comment">// "Donald åœ¨æ¸¸æ³³"</span>
duck.<span class="hljs-title function_">fly</span>(); <span class="hljs-comment">// "Donald åœ¨é£ç¿”"</span>

<span class="hljs-comment">// 7.4 ç±»çš„è£…é¥°å™¨</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">logMethod</span>(<span class="hljs-params">target, name, descriptor</span>) {
  <span class="hljs-keyword">const</span> original = descriptor.<span class="hljs-property">value</span>;
  
  descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`è°ƒç”¨ <span class="hljs-subst">${name}</span> æ–¹æ³•ï¼Œå‚æ•°:`</span>, args);
    <span class="hljs-keyword">const</span> result = original.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ–¹æ³• <span class="hljs-subst">${name}</span> è¿”å›:`</span>, result);
    <span class="hljs-keyword">return</span> result;
  };
  
  <span class="hljs-keyword">return</span> descriptor;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">sealClass</span>(<span class="hljs-params">constructor</span>) {
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">seal</span>(constructor);
  <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">seal</span>(constructor.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
}

@sealClass
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> {
  @logMethod
  <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>) {
    <span class="hljs-keyword">return</span> a + b;
  }
  
  @logMethod
  <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a, b</span>) {
    <span class="hljs-keyword">return</span> a * b;
  }
}

<span class="hljs-keyword">const</span> calc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Calculator</span>();
calc.<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// æ§åˆ¶å°æ˜¾ç¤ºæ—¥å¿—</span>
</code></pre>
<h4 data-id="heading-19">å…«ã€æ¨¡å—åŒ–ä¸æ¨¡å—ç³»ç»Ÿ</h4>
<p>ES6å¼•å…¥äº†å®˜æ–¹çš„æ¨¡å—ç³»ç»Ÿï¼Œä½¿JavaScriptçš„æ¨¡å—åŒ–æ›´åŠ æ ‡å‡†åŒ–ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 8.1 åŸºæœ¬å¯¼å‡ºå¯¼å…¥</span>
<span class="hljs-comment">// math.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PI</span> = <span class="hljs-number">3.14159</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">return</span> a + b;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">return</span> a * b;
}

<span class="hljs-comment">// é»˜è®¤å¯¼å‡º</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">calculator</span>(<span class="hljs-params">operation, ...args</span>) {
  <span class="hljs-keyword">switch</span> (operation) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'add'</span>: <span class="hljs-keyword">return</span> args.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">sum, num</span>) =&gt;</span> sum + num, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">case</span> <span class="hljs-string">'multiply'</span>: <span class="hljs-keyword">return</span> args.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">product, num</span>) =&gt;</span> product * num, <span class="hljs-number">1</span>);
    <span class="hljs-attr">default</span>: <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
}

<span class="hljs-comment">// app.js</span>
<span class="hljs-keyword">import</span> calc, { <span class="hljs-variable constant_">PI</span>, add, multiply } <span class="hljs-keyword">from</span> <span class="hljs-string">'./math.js'</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable constant_">PI</span>); <span class="hljs-comment">// 3.14159</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)); <span class="hljs-comment">// 5</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">calc</span>(<span class="hljs-string">'add'</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)); <span class="hljs-comment">// 6</span>

<span class="hljs-comment">// 8.2 å‘½åç©ºé—´å¯¼å…¥</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">MathUtils</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./math.js'</span>;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MathUtils</span>.<span class="hljs-property">PI</span>); <span class="hljs-comment">// 3.14159</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">MathUtils</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>)); <span class="hljs-comment">// 15</span>

<span class="hljs-comment">// 8.3 åŠ¨æ€å¯¼å…¥</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadModule</span>(<span class="hljs-params">moduleName</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">`./modules/<span class="hljs-subst">${moduleName}</span>.js`</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">module</span>;
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`åŠ è½½æ¨¡å— <span class="hljs-subst">${moduleName}</span> å¤±è´¥:`</span>, error);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }
}

<span class="hljs-comment">// æ ¹æ®æ¡ä»¶åŠ¨æ€åŠ è½½</span>
<span class="hljs-keyword">if</span> (userNeedsChart) {
  <span class="hljs-keyword">const</span> chartModule = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loadModule</span>(<span class="hljs-string">'chart'</span>);
  chartModule.<span class="hljs-title function_">renderChart</span>(data);
}

<span class="hljs-comment">// 8.4 æ¨¡å—å…ƒæ•°æ®</span>
<span class="hljs-comment">// module-info.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> metadata = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'ç”¨æˆ·ç®¡ç†æ¨¡å—'</span>,
  <span class="hljs-attr">version</span>: <span class="hljs-string">'1.0.0'</span>,
  <span class="hljs-attr">author</span>: <span class="hljs-string">'John Doe'</span>
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getUser</span>(<span class="hljs-params">id</span>) {
  <span class="hljs-keyword">return</span> { id, <span class="hljs-attr">name</span>: <span class="hljs-string">'User'</span> + id };
}

<span class="hljs-comment">// è·å–å½“å‰æ¨¡å—ä¿¡æ¯</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>); <span class="hljs-comment">// å½“å‰æ¨¡å—çš„URL</span>

<span class="hljs-comment">// 8.5 å¾ªç¯ä¾èµ–å¤„ç†</span>
<span class="hljs-comment">// a.js</span>
<span class="hljs-keyword">import</span> { b } <span class="hljs-keyword">from</span> <span class="hljs-string">'./b.js'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> a = <span class="hljs-string">'æ¨¡å—A'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getB</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> b;
}

<span class="hljs-comment">// b.js</span>
<span class="hljs-keyword">import</span> { a } <span class="hljs-keyword">from</span> <span class="hljs-string">'./a.js'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> b = <span class="hljs-string">'æ¨¡å—B'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getA</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> a;
}

<span class="hljs-comment">// 8.6 Workeræ¨¡å—</span>
<span class="hljs-comment">// worker.js</span>
self.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> result = event.<span class="hljs-property">data</span> * <span class="hljs-number">2</span>;
  self.<span class="hljs-title function_">postMessage</span>(result);
};

<span class="hljs-comment">// ä¸»çº¿ç¨‹</span>
<span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">'./worker.js'</span>, { <span class="hljs-attr">type</span>: <span class="hljs-string">'module'</span> });
worker.<span class="hljs-title function_">postMessage</span>(<span class="hljs-number">5</span>);
worker.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Workerè¿”å›:'</span>, event.<span class="hljs-property">data</span>); <span class="hljs-comment">// 10</span>
};
</code></pre>
<h4 data-id="heading-20">ä¹ã€å…¶ä»–é‡è¦ES6+ç‰¹æ€§</h4>
<h5 data-id="heading-21">è§£æ„èµ‹å€¼</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 9.1 å¯¹è±¡è§£æ„</span>
<span class="hljs-keyword">const</span> user = {
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,
  <span class="hljs-attr">address</span>: {
    <span class="hljs-attr">city</span>: <span class="hljs-string">'New York'</span>,
    <span class="hljs-attr">country</span>: <span class="hljs-string">'USA'</span>
  }
};

<span class="hljs-keyword">const</span> { name, age, <span class="hljs-attr">address</span>: { city } } = user;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name, age, city); <span class="hljs-comment">// "John" 30 "New York"</span>

<span class="hljs-comment">// é‡å‘½åå’Œè§£æ„é»˜è®¤å€¼</span>
<span class="hljs-keyword">const</span> { <span class="hljs-attr">name</span>: userName, role = <span class="hljs-string">'user'</span> } = user;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(userName, role); <span class="hljs-comment">// "John" "user"</span>

<span class="hljs-comment">// å‡½æ•°å‚æ•°è§£æ„</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">printUser</span>(<span class="hljs-params">{ name, age }</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${name}</span> is <span class="hljs-subst">${age}</span> years old`</span>);
}

<span class="hljs-comment">// 9.2 æ•°ç»„è§£æ„</span>
<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];
<span class="hljs-keyword">const</span> [first, second, ...rest] = numbers;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(first, second, rest); <span class="hljs-comment">// 1 2 [3, 4, 5]</span>

<span class="hljs-comment">// äº¤æ¢å˜é‡</span>
<span class="hljs-keyword">let</span> a = <span class="hljs-number">1</span>, b = <span class="hljs-number">2</span>;
[a, b] = [b, a];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b); <span class="hljs-comment">// 2 1</span>

<span class="hljs-comment">// 9.3 åµŒå¥—è§£æ„</span>
<span class="hljs-keyword">const</span> data = {
  <span class="hljs-attr">users</span>: [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'Bob'</span> }
  ],
  <span class="hljs-attr">meta</span>: {
    <span class="hljs-attr">page</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">total</span>: <span class="hljs-number">2</span>
  }
};

<span class="hljs-keyword">const</span> {
  <span class="hljs-attr">users</span>: [{ <span class="hljs-attr">name</span>: firstUserName }, secondUser],
  <span class="hljs-attr">meta</span>: { page }
} = data;

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(firstUserName, secondUser.<span class="hljs-property">name</span>, page); <span class="hljs-comment">// "Alice" "Bob" 1</span>
</code></pre>
<h5 data-id="heading-22">æ¨¡æ¿å­—ç¬¦ä¸²å’Œæ ‡ç­¾æ¨¡æ¿</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 9.4 æ¨¡æ¿å­—ç¬¦ä¸²</span>
<span class="hljs-keyword">const</span> name = <span class="hljs-string">'John'</span>;
<span class="hljs-keyword">const</span> age = <span class="hljs-number">30</span>;

<span class="hljs-keyword">const</span> message = <span class="hljs-string">`å§“å: <span class="hljs-subst">${name}</span>, å¹´é¾„: <span class="hljs-subst">${age}</span>`</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(message); <span class="hljs-comment">// "å§“å: John, å¹´é¾„: 30"</span>

<span class="hljs-comment">// å¤šè¡Œå­—ç¬¦ä¸²</span>
<span class="hljs-keyword">const</span> multiLine = <span class="hljs-string">`
  ç¬¬ä¸€è¡Œ
  ç¬¬äºŒè¡Œ
  ç¬¬ä¸‰è¡Œ
`</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(multiLine);

<span class="hljs-comment">// 9.5 æ ‡ç­¾æ¨¡æ¿</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">highlight</span>(<span class="hljs-params">strings, ...values</span>) {
  <span class="hljs-keyword">let</span> result = <span class="hljs-string">''</span>;
  strings.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">str, i</span>) =&gt;</span> {
    result += str;
    <span class="hljs-keyword">if</span> (values[i]) {
      result += <span class="hljs-string">`&lt;strong&gt;<span class="hljs-subst">${values[i]}</span>&lt;/strong&gt;`</span>;
    }
  });
  <span class="hljs-keyword">return</span> result;
}

<span class="hljs-keyword">const</span> user = <span class="hljs-string">'Alice'</span>;
<span class="hljs-keyword">const</span> score = <span class="hljs-number">95</span>;
<span class="hljs-keyword">const</span> html = highlight<span class="hljs-string">`ç”¨æˆ· <span class="hljs-subst">${user}</span> çš„åˆ†æ•°æ˜¯ <span class="hljs-subst">${score}</span>`</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(html); <span class="hljs-comment">// "ç”¨æˆ· &lt;strong&gt;Alice&lt;/strong&gt; çš„åˆ†æ•°æ˜¯ &lt;strong&gt;95&lt;/strong&gt;"</span>

<span class="hljs-comment">// 9.6 SQLå®‰å…¨æŸ¥è¯¢</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sql</span>(<span class="hljs-params">strings, ...values</span>) {
  <span class="hljs-keyword">let</span> query = <span class="hljs-string">''</span>;
  strings.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">str, i</span>) =&gt;</span> {
    query += str;
    <span class="hljs-keyword">if</span> (values[i]) {
      <span class="hljs-comment">// é˜²æ­¢SQLæ³¨å…¥</span>
      query += <span class="hljs-string">`'<span class="hljs-subst">${values[i].toString().replace(/<span class="hljs-string">'/g, "'</span><span class="hljs-string">'")}'</span><span class="hljs-string">`;
    }
  });
  return query;
}

const userId = 1;
const userName = "O'Connor";
const query = sql`</span>SELECT * FROM users WHERE id = ${userId} AND name = ${userName}<span class="hljs-string">`;
console.log(query); // "SELECT * FROM users WHERE id = '1' AND name = 'O''Connor'"
</span></span></span></code></pre>
<h5 data-id="heading-23">å¯é€‰é“¾æ“ä½œç¬¦å’Œç©ºå€¼åˆå¹¶æ“ä½œç¬¦</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 9.7 å¯é€‰é“¾æ“ä½œç¬¦</span>
<span class="hljs-keyword">const</span> user = {
  <span class="hljs-attr">profile</span>: {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>,
    <span class="hljs-attr">address</span>: {
      <span class="hljs-attr">city</span>: <span class="hljs-string">'New York'</span>
    }
  }
};

<span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼</span>
<span class="hljs-keyword">const</span> city = user &amp;&amp; user.<span class="hljs-property">profile</span> &amp;&amp; user.<span class="hljs-property">profile</span>.<span class="hljs-property">address</span> &amp;&amp; user.<span class="hljs-property">profile</span>.<span class="hljs-property">address</span>.<span class="hljs-property">city</span>;

<span class="hljs-comment">// å¯é€‰é“¾</span>
<span class="hljs-keyword">const</span> city2 = user?.<span class="hljs-property">profile</span>?.<span class="hljs-property">address</span>?.<span class="hljs-property">city</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(city2); <span class="hljs-comment">// "New York"</span>

<span class="hljs-comment">// ä¸å­˜åœ¨çš„å±æ€§</span>
<span class="hljs-keyword">const</span> zipCode = user?.<span class="hljs-property">profile</span>?.<span class="hljs-property">address</span>?.<span class="hljs-property">zipCode</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(zipCode); <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">// æ–¹æ³•è°ƒç”¨</span>
<span class="hljs-keyword">const</span> result = user?.<span class="hljs-property">profile</span>?.<span class="hljs-property">getFullName</span>?.();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result); <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">// æ•°ç»„è®¿é—®</span>
<span class="hljs-keyword">const</span> firstItem = user?.<span class="hljs-property">orders</span>?.[<span class="hljs-number">0</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(firstItem); <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">// 9.8 ç©ºå€¼åˆå¹¶æ“ä½œç¬¦</span>
<span class="hljs-keyword">const</span> settings = {
  <span class="hljs-attr">theme</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">fontSize</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">notifications</span>: <span class="hljs-literal">false</span>
};

<span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼</span>
<span class="hljs-keyword">const</span> theme = settings.<span class="hljs-property">theme</span> !== <span class="hljs-literal">null</span> &amp;&amp; settings.<span class="hljs-property">theme</span> !== <span class="hljs-literal">undefined</span> ? 
  settings.<span class="hljs-property">theme</span> : <span class="hljs-string">'default'</span>;

<span class="hljs-comment">// ç©ºå€¼åˆå¹¶</span>
<span class="hljs-keyword">const</span> theme2 = settings.<span class="hljs-property">theme</span> ?? <span class="hljs-string">'default'</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(theme2); <span class="hljs-comment">// "default"</span>

<span class="hljs-comment">// ä¸é€»è¾‘æˆ–çš„åŒºåˆ«</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(settings.<span class="hljs-property">fontSize</span> || <span class="hljs-number">16</span>); <span class="hljs-comment">// 16 (0è¢«è§†ä¸ºå‡å€¼)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(settings.<span class="hljs-property">fontSize</span> ?? <span class="hljs-number">16</span>); <span class="hljs-comment">// 0 (åªæœ‰null/undefinedæ‰ç”¨é»˜è®¤å€¼)</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(settings.<span class="hljs-property">notifications</span> || <span class="hljs-literal">true</span>); <span class="hljs-comment">// true (falseè¢«è§†ä¸ºå‡å€¼)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(settings.<span class="hljs-property">notifications</span> ?? <span class="hljs-literal">true</span>); <span class="hljs-comment">// false</span>
</code></pre>
<h5 data-id="heading-24">å±•å¼€è¿ç®—ç¬¦å’Œå‰©ä½™å‚æ•°</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 9.9 å±•å¼€è¿ç®—ç¬¦</span>
<span class="hljs-comment">// æ•°ç»„å±•å¼€</span>
<span class="hljs-keyword">const</span> arr1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> arr2 = [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];
<span class="hljs-keyword">const</span> combined = [...arr1, ...arr2];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(combined); <span class="hljs-comment">// [1, 2, 3, 4, 5, 6]</span>

<span class="hljs-comment">// å¯¹è±¡å±•å¼€</span>
<span class="hljs-keyword">const</span> obj1 = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">2</span> };
<span class="hljs-keyword">const</span> obj2 = { <span class="hljs-attr">b</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">c</span>: <span class="hljs-number">4</span> };
<span class="hljs-keyword">const</span> merged = { ...obj1, ...obj2 };
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(merged); <span class="hljs-comment">// { a: 1, b: 3, c: 4 }</span>

<span class="hljs-comment">// å‡½æ•°è°ƒç”¨å±•å¼€</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">a, b, c</span>) {
  <span class="hljs-keyword">return</span> a + b + c;
}
<span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">sum</span>(...numbers)); <span class="hljs-comment">// 6</span>

<span class="hljs-comment">// 9.10 å‰©ä½™å‚æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processUser</span>(<span class="hljs-params">firstUser, secondUser, ...otherUsers</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å‰ä¸¤ä¸ªç”¨æˆ·:'</span>, firstUser, secondUser);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'å…¶ä»–ç”¨æˆ·:'</span>, otherUsers);
}

<span class="hljs-title function_">processUser</span>(<span class="hljs-string">'Alice'</span>, <span class="hljs-string">'Bob'</span>, <span class="hljs-string">'Charlie'</span>, <span class="hljs-string">'David'</span>, <span class="hljs-string">'Eve'</span>);

<span class="hljs-comment">// è§£æ„ä¸­çš„å‰©ä½™å‚æ•°</span>
<span class="hljs-keyword">const</span> [first, second, ...rest] = [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>, <span class="hljs-string">'e'</span>];
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(first, second, rest); <span class="hljs-comment">// "a" "b" ["c", "d", "e"]</span>

<span class="hljs-keyword">const</span> { id, name, ...details } = {
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'John'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>,
  <span class="hljs-attr">city</span>: <span class="hljs-string">'NYC'</span>
};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(id, name, details); <span class="hljs-comment">// 1 "John" { age: 30, city: 'NYC' }</span>
</code></pre>
<h5 data-id="heading-25">æ–°çš„æ•°æ®ç»“æ„ï¼šMap å’Œ Set</h5>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 9.11 Map</span>
<span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();

<span class="hljs-comment">// è®¾ç½®é”®å€¼å¯¹ï¼ˆé”®å¯ä»¥æ˜¯ä»»æ„ç±»å‹ï¼‰</span>
map.<span class="hljs-title function_">set</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'John'</span>);
map.<span class="hljs-title function_">set</span>(<span class="hljs-number">42</span>, <span class="hljs-string">'The Answer'</span>);
map.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">id</span>: <span class="hljs-number">1</span> }, <span class="hljs-string">'Object as key'</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(map.<span class="hljs-title function_">get</span>(<span class="hljs-string">'name'</span>)); <span class="hljs-comment">// "John"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(map.<span class="hljs-title function_">has</span>(<span class="hljs-number">42</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(map.<span class="hljs-property">size</span>); <span class="hljs-comment">// 3</span>

<span class="hljs-comment">// éå†Map</span>
map.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">value, key</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key, value);
});

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, value] <span class="hljs-keyword">of</span> map) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(key, value);
}

<span class="hljs-comment">// 9.12 Set</span>
<span class="hljs-keyword">const</span> set = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(set.<span class="hljs-property">size</span>); <span class="hljs-comment">// 5 (è‡ªåŠ¨å»é‡)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(set.<span class="hljs-title function_">has</span>(<span class="hljs-number">3</span>)); <span class="hljs-comment">// true</span>

set.<span class="hljs-title function_">add</span>(<span class="hljs-number">6</span>);
set.<span class="hljs-title function_">delete</span>(<span class="hljs-number">2</span>);

<span class="hljs-comment">// éå†Set</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> value <span class="hljs-keyword">of</span> set) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value);
}

<span class="hljs-comment">// Setæ“ä½œ</span>
<span class="hljs-keyword">const</span> setA = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
<span class="hljs-keyword">const</span> setB = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]);

<span class="hljs-comment">// å¹¶é›†</span>
<span class="hljs-keyword">const</span> union = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([...setA, ...setB]);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([...union]); <span class="hljs-comment">// [1, 2, 3, 4, 5]</span>

<span class="hljs-comment">// äº¤é›†</span>
<span class="hljs-keyword">const</span> intersection = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([...setA].<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> setB.<span class="hljs-title function_">has</span>(x)));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([...intersection]); <span class="hljs-comment">// [3]</span>

<span class="hljs-comment">// å·®é›†</span>
<span class="hljs-keyword">const</span> difference = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([...setA].<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> !setB.<span class="hljs-title function_">has</span>(x)));
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([...difference]); <span class="hljs-comment">// [1, 2]</span>
</code></pre>
<h4 data-id="heading-26">æ€»ç»“</h4>
<p>ES6+çš„æ–°ç‰¹æ€§æå¤§åœ°ä¸°å¯Œäº†JavaScriptçš„åŠŸèƒ½ï¼Œä½¿å¼€å‘æ›´åŠ é«˜æ•ˆå’Œä¼˜é›…ã€‚ä»Proxyçš„å…ƒç¼–ç¨‹èƒ½åŠ›åˆ°async/awaitçš„å¼‚æ­¥å¤„ç†ï¼Œä»ç±»çš„é¢å‘å¯¹è±¡ç¼–ç¨‹åˆ°æ¨¡å—åŒ–çš„æ ‡å‡†æ”¯æŒï¼Œè¿™äº›ç‰¹æ€§å…±åŒæ„å»ºäº†ç°ä»£JavaScriptçš„å¼€å‘åŸºç¡€ã€‚</p>
<p><strong>å…³é”®ç‰¹æ€§æ€»ç»“:</strong></p>
<ol>
<li><strong>Proxy/Reflect:</strong> æä¾›å¼ºå¤§çš„å…ƒç¼–ç¨‹èƒ½åŠ›ï¼Œå®ç°æ•°æ®ç»‘å®šã€éªŒè¯ç­‰é«˜çº§åŠŸèƒ½</li>
<li><strong>Generator/Iterator:</strong> ç®€åŒ–è¿­ä»£å™¨åˆ›å»ºï¼Œæ”¯æŒæƒ°æ€§æ±‚å€¼å’Œå¼‚æ­¥æ“ä½œ</li>
<li><strong>Symbol:</strong> åˆ›å»ºå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå®ç°ç§æœ‰å±æ€§å’Œæ”¹å˜å†…ç½®è¡Œä¸º</li>
<li><strong>WeakMap/WeakSet:</strong> å¼±å¼•ç”¨æ•°æ®ç»“æ„ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</li>
<li><strong>ç®­å¤´å‡½æ•°:</strong> ç®€æ´è¯­æ³•å’Œè¯æ³•thisç»‘å®š</li>
<li><strong>Promise/async/await:</strong> é©å‘½æ€§çš„å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ</li>
<li><strong>ç±»ä¸æ¨¡å—:</strong> æ ‡å‡†åŒ–çš„é¢å‘å¯¹è±¡å’Œæ¨¡å—åŒ–æ”¯æŒ</li>
<li><strong>è§£æ„ã€æ¨¡æ¿å­—ç¬¦ä¸²ã€å¯é€‰é“¾ç­‰:</strong> æå‡ä»£ç ç®€æ´æ€§å’Œå¯è¯»æ€§</li>
</ol>
<p>æŒæ¡è¿™äº›ç‰¹æ€§ä¸ä»…èƒ½è®©ä»£ç æ›´åŠ ç®€æ´ä¼˜é›…ï¼Œè¿˜èƒ½æ·±å…¥ç†è§£JavaScriptçš„è®¾è®¡å“²å­¦å’Œæœ€ä½³å®è·µã€‚éšç€ECMAScriptæ ‡å‡†çš„æŒç»­æ¼”è¿›ï¼ŒJavaScriptå°†ç»§ç»­æˆä¸ºæœ€çµæ´»ã€æœ€å¼ºå¤§çš„ç¼–ç¨‹è¯­è¨€ä¹‹ä¸€ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œåº”æ ¹æ®é¡¹ç›®éœ€æ±‚å’ŒæŠ€æœ¯æ ˆé€‰æ‹©åˆé€‚çš„æ–°ç‰¹æ€§ï¼Œå¹³è¡¡åŠŸèƒ½æ€§å’Œæµè§ˆå™¨å…¼å®¹æ€§ï¼Œæ„å»ºé«˜è´¨é‡çš„å‰ç«¯åº”ç”¨ã€‚</p>
<p>ES6+çš„é©æ–°åªæ˜¯å¼€å§‹ï¼Œæœªæ¥JavaScriptå°†ç»§ç»­å¼•å…¥æ›´å¤šå¼ºå¤§çš„ç‰¹æ€§ï¼ˆå¦‚è£…é¥°å™¨ã€ç®¡é“æ“ä½œç¬¦ç­‰ï¼‰ï¼Œä¿æŒè¯­è¨€çš„ç”Ÿå‘½åŠ›å’Œç«äº‰åŠ›ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter å‹‡é—¯2Dåƒç´ æ¸¸æˆä¹‹è·¯ï¼ˆå››ï¼‰ï¼šä¸å“¥å¸ƒæ—æˆ˜æ–—çš„æ»‘æ­¥é­”æ³•å¸ˆ]]></title>    <link>https://juejin.cn/post/7585463258691125257</link>    <guid>https://juejin.cn/post/7585463258691125257</guid>    <pubDate>2025-12-20T10:53:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585463258691125257" data-draft-id="7584787119274688539" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter å‹‡é—¯2Dåƒç´ æ¸¸æˆä¹‹è·¯ï¼ˆå››ï¼‰ï¼šä¸å“¥å¸ƒæ—æˆ˜æ–—çš„æ»‘æ­¥é­”æ³•å¸ˆ"/> <meta itemprop="keywords" content="Flutter,æ¸¸æˆ,æ¸¸æˆå¼€å‘"/> <meta itemprop="datePublished" content="2025-12-20T10:53:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_å¤§å­¦ç‰²"/> <meta itemprop="url" content="https://juejin.cn/user/3125273628517148"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter å‹‡é—¯2Dåƒç´ æ¸¸æˆä¹‹è·¯ï¼ˆå››ï¼‰ï¼šä¸å“¥å¸ƒæ—æˆ˜æ–—çš„æ»‘æ­¥é­”æ³•å¸ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3125273628517148/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _å¤§å­¦ç‰²
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T10:53:17.000Z" title="Sat Dec 20 2025 10:53:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»22åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff353f3f0cda44ecaf4bcb207fe029b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=6HsscFCyLCTQ7OrIFSz7uDFF%2FDI%3D" width="100%" loading="lazy"/></p><p/>
<p><a href="https://juejin.cn/post/7579264485259411471" target="_blank" title="https://juejin.cn/post/7579264485259411471">Flutter å‹‡é—¯2Dåƒç´ æ¸¸æˆä¹‹è·¯ï¼ˆä¸€ï¼‰ï¼šä¸€ä¸ª Hero çš„è¯ç”Ÿ</a><br/>
<a href="https://juejin.cn/post/7581025279646892070" target="_blank" title="https://juejin.cn/post/7581025279646892070">Flutter å‹‡é—¯2Dåƒç´ æ¸¸æˆä¹‹è·¯ï¼ˆäºŒï¼‰ï¼šç»˜åˆ¶åŠ è½½æ¸¸æˆåœ°å›¾</a><br/>
<a href="https://juejin.cn/post/7584014975242911754" target="_blank" title="https://juejin.cn/post/7584014975242911754">Flutter å‹‡é—¯2Dåƒç´ æ¸¸æˆä¹‹è·¯ï¼ˆä¸‰ï¼‰ï¼šäººç‰©ä¸åœ°å›¾å…ƒç´ çš„äº¤äº’</a><br/>
<a href="https://juejin.cn/post/7585463258691125257" target="_blank" title="https://juejin.cn/post/7585463258691125257">Flutter å‹‡é—¯2Dåƒç´ æ¸¸æˆä¹‹è·¯ï¼ˆå››ï¼‰ï¼šä¸å“¥å¸ƒæ—æˆ˜æ–—çš„æ»‘æ­¥é­”æ³•å¸ˆ</a></p>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨ä¸Šç¯‡æ–‡ç« ä¸­,æˆ‘ä»¬å®Œæˆäº†å’Œ <strong>åœ°å›¾å…ƒç´ </strong> çš„äº¤äº’ï¼Œ<code>å¼€ç®±ã€å¼€é—¨ã€è¢«åˆºæ‰</code> æ— æ‰€ä¸ç²¾ã€‚<br/>
é‚£ä¹ˆæœ¬ç« ç»™å¤§å®¶ä»‹ç»,ä¸€æ¬¾æ¸¸æˆçš„ç²¾é«“ <strong>å¯¹æˆ˜</strong> ç›¸å…³å…ƒç´ çš„å®ç°ã€‚<br/>
è¿™ä¸€å…ƒç´ ç±»æ¯” <strong>è°ˆæ‹çˆ±</strong>ï¼Œå¯ä»¥è¯´æ˜¯ï¼Œç»™å¤§å¤šæ•°ç©å®¶çš„<code>ç¬¬ä¸€å°è±¡</code> äº†ã€‚</p>
<h3 data-id="heading-1">å¯¹æˆ˜å…ƒç´ çš„é‡è¦æ€§</h3>



































<table><thead><tr><th>ç»´åº¦</th><th>å¯¹æˆ˜å…ƒç´ çš„ä½œç”¨</th><th>å¯¹æ¸¸æˆçš„å½±å“</th></tr></thead><tbody><tr><td>ç©å®¶å­˜åœ¨æ„Ÿ</td><td>æ“ä½œèƒ½ç«‹åˆ»äº§ç”Ÿå‘½ä¸­ã€å—ä¼¤ã€å‡»æ€å¾—åˆ°æ­£åé¦ˆ</td><td>å¼ºåŒ–<code>æ¸¸æˆä¸–ç•Œ</code> çš„çœŸå®æ„Ÿ</td></tr><tr><td>æ¸¸æˆèŠ‚å¥</td><td>å½¢æˆç´§å¼ ï¼ˆæˆ˜æ–—ï¼‰ä¸æ”¾æ¾ï¼ˆæ¢ç´¢/å™äº‹ï¼‰çš„ç»“åˆ</td><td>é¿å…èŠ‚å¥å•ä¸€ï¼Œé™ä½ç–²åŠ³æ„Ÿ</td></tr><tr><td>å†³ç­–å†³æ–­</td><td>å¼•å…¥é£é™©ä¸å›æŠ¥ï¼ˆæ‰“/ç»•ã€è¿›/é€€ã€ç”¨/ç•™ï¼‰</td><td>ä»æ‰§è¡Œæ“ä½œå‡çº§ä¸ºç­–ç•¥é€‰æ‹©</td></tr><tr><td>é‡å¤å¯ç©æ€§</td><td>æ•Œäººç»„åˆã€èµ°ä½ã€æˆ˜å†µå…·æœ‰ä¸ç¡®å®šæ€§</td><td>æé«˜é‡ç©ä»·å€¼ï¼Œå»¶é•¿æ¸¸æˆå¯¿å‘½</td></tr><tr><td>æƒ…ç»ªé©±åŠ¨</td><td>èƒœåˆ©ã€å¤±è´¥ã€é€†è½¬å¸¦æ¥æƒ…ç»ªæ³¢åŠ¨</td><td>å¢å¼ºæˆå°±æ„Ÿä¸æ²‰æµ¸æ„Ÿ</td></tr></tbody></table>
<blockquote>
<p><strong>æ€»ç»“</strong>ï¼š<br/>
å¯¹æˆ˜å…ƒç´ å¹¶ä¸åªæ˜¯ <code>æˆ˜æ–—æœºåˆ¶</code>ï¼Œè€Œæ˜¯è¿æ¥ç©å®¶è¡Œä¸ºã€ç³»ç»Ÿè®¾è®¡ä¸æƒ…ç»ªä½“éªŒçš„ <strong>æ ¸å¿ƒæ¢çº½</strong>ï¼Œå†³å®šäº†ä¸€æ¬¾æ¸¸æˆæ˜¯å¦çœŸæ­£å…·å¤‡æŒç»­å¸å¼•åŠ›ã€‚</p>
</blockquote>
<blockquote>
<p><strong>githubæºç </strong> å’Œ <strong>æ¸¸æˆåœ¨çº¿ä½“éªŒåœ°å€</strong>ï¼ˆä½“éªŒç‰ˆä¸ºç½‘é¡µï¼Œå¯èƒ½æ‰‹æ„Ÿè¾ƒå·®ï¼Œæ¨èæºç å®‰è£…è‡³æ‰‹æœºä½“éªŒï¼‰ çš†åœ¨æ–‡ç« æœ€åã€‚</p>
</blockquote>
<h2 data-id="heading-2">Myhero</h2>
<h3 data-id="heading-3">ä¸€. æœ¬ç« ç›®æ ‡</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c88f6f2e60594c008552bf6ba6d28e2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=PViAje2D1bnE9vzAze9zLjeqU5s%3D" width="100%" loading="lazy"/></p><p/>
<h3 data-id="heading-4">äºŒ. å®ç° <code>HUD</code> é¢æ¿</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4923ce697d174603830da2aa850cd097~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=d6Vjob2lXkbWuK0PkOEvpXdWW6c%3D" width="100%" loading="lazy"/></p><p/>
<p><strong>HUD</strong>ï¼ˆHeads-Up Displayï¼ŒæŠ¬å¤´æ˜¾ç¤ºï¼‰æ˜¯å§‹ç»ˆ <strong>å›ºå®šåœ¨å±å¹•ä¸Š</strong> çš„æ¸¸æˆç•Œé¢å±‚ï¼Œç”¨äºå‘ç©å®¶å±•ç¤ºä¿¡æ¯å¹¶æ¥æ”¶æ“ä½œã€‚<br/>
ä¾‹å¦‚ <strong>è¡€æ¡ã€æŠ€èƒ½æŒ‰é’®ã€æ‘‡æ†å’Œæš‚åœæŒ‰é’®</strong>ï¼Œå®ƒ<strong>ä¸å‚ä¸ä¸–ç•Œç¢°æ’ã€ä¸éšåœ°å›¾æˆ–ç›¸æœºç§»åŠ¨</strong>ï¼Œåªè´Ÿè´£ <code>æ˜¾ç¤ºä¸è¾“å…¥</code>ã€‚</p>
<h4 data-id="heading-5">1. ç´ æ</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da5b23874e8646b99a8619226da2ea6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=o1%2FJq7Ruzrn8cUDkD3A75Jf5Y60%3D" width="50%" loading="lazy"/></p><p/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73058f2feaa84f32bea0458f39fd6239~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=Uy4djmFiJWXdCYuq3faPtSfjbd0%3D" width="100%" loading="lazy"/></p><p/>
<p>å¤§å®¶å¯ä»¥å»ä¸‹é¢ <strong>ä¸¤ä¸ªç½‘ç«™</strong> ä¸­ï¼Œæ‰¾æ‰¾è‡ªå·±å¿ƒä»ªçš„ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨æˆ‘ä¸Šé¢çš„å›¾ç‰‡ï¼ˆåœ¨ <strong>ä»“åº“</strong> ä¸­ï¼‰ã€‚</p>
<blockquote>
<p><strong>çˆ±ç»™ç½‘</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aigei.com%2F" target="_blank" title="https://www.aigei.com/" ref="nofollow noopener noreferrer">www.aigei.com/</a><br/>
<strong>itch</strong> : <a href="https://link.juejin.cn?target=https%3A%2F%2Fitch.io%2F" target="_blank" title="https://itch.io/" ref="nofollow noopener noreferrer">itch.io/</a></p>
</blockquote>
<h4 data-id="heading-6">2. äººç‰©è¡€æ¡</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da5b23874e8646b99a8619226da2ea6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=o1%2FJq7Ruzrn8cUDkD3A75Jf5Y60%3D" width="50%" loading="lazy"/></p><p/>
<p>è§‚å¯Ÿä¸Šè¿° <strong>å¿ƒå‹è¡€æ¡</strong> çš„ç²¾çµå›¾ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ€è·¯ï¼š</p>
<ul>
<li>
<p>ä»æ»¡è¡€åˆ°ç©ºè¡€ï¼Œä¸€å…±æ˜¯å››ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬å°±å§‘ä¸”è®© <strong>æ¯é¢— â¤ï¸ æ‰¿è½½ 4ç‚¹è¡€</strong>ã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// æ¯ä¸ªå¿ƒè·³ç»„ä»¶åŒ…å«çš„ç”Ÿå‘½å€¼</span>
<span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> hpPerHeart = <span class="hljs-number">4</span>;
</code></pre>
</li>
<li>
<p>å› æ­¤ï¼Œå°†æ¯é¢— â¤ï¸ï¼Œå•ç‹¬ä½œä¸ºä¸€ä¸ª <code>HeartComponent</code>,åªè´Ÿè´£å•é¢— â¤ï¸ <strong>æ‰£è¡€æˆ–åŠ è¡€çš„å›¾ç‰‡å˜åŒ–</strong>ã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeartComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpriteComponent</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Sprite&gt; sprites;

  HeartComponent(<span class="hljs-keyword">this</span>.sprites) {
    sprite = sprites.last; <span class="hljs-comment">// é»˜è®¤æ»¡è¡€</span>
  }

  <span class="hljs-keyword">void</span> setHpStage(<span class="hljs-built_in">int</span> stage) {
    sprite = sprites[stage.clamp(<span class="hljs-number">0</span>, sprites.length - <span class="hljs-number">1</span>)];
  }
}
</code></pre>
</li>
<li>
<p>æœ€åé€šè¿‡ <code>HeroHpHud</code> ç»Ÿä¸€ç®¡ç†ï¼š</p>
<ul>
<li><strong>æ·»åŠ ç®¡ç† <code>HeartComponent</code></strong>ï¼š è®¡ç®—äººç‰©æ€»å¿ƒæ•° ï¼ˆ<code>â¤ï¸æ€»é¢—æ•° = æ€»è¡€é‡ / æ¯é¢— â¤ï¸è¡€é‡</code>ï¼‰ï¼ŒåŠ¨æ€ç”Ÿæˆ componentã€‚
<pre><code class="hljs language-dart" lang="dart"> <span class="hljs-comment">// å¿ƒè·³ç»„ä»¶</span>
 <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;HeartComponent&gt; hearts = [];

 <span class="hljs-comment">// æ¯ä¸ªå¿ƒè·³ç»„ä»¶çš„ç²¾çµå›¾</span>
 <span class="hljs-keyword">late</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;Sprite&gt; heartSprites;

...

<span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; hero.maxHp ~/ hpPerHeart; i++) {
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> heartSize = <span class="hljs-number">24</span>;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> heartSpacing = heartSize + <span class="hljs-number">1</span>;
  <span class="hljs-keyword">final</span> heart = HeartComponent(heartSprites)
    ..size = Vector2(heartSize, heartSize)
    ..position = Vector2(i * heartSpacing, <span class="hljs-number">0</span>);
  hearts.add(heart);
  add(heart);
}
</code></pre>
</li>
<li><strong>åŠ¨æ€æ›´æ–°è¡€æ¡</strong>ï¼šæ¯å¸§æ›´æ–°æ—¶ï¼Œè·å–äººç‰©è¡€é‡ï¼Œè®¡ç®—å¾—å‡ºæ¯é¢— â¤ï¸è¯¥å±•ç¤ºçš„é˜¶æ®µã€‚
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">void</span> update(<span class="hljs-built_in">double</span> dt) {
    <span class="hljs-keyword">super</span>.update(dt);
    <span class="hljs-keyword">final</span> totalHearts = hearts.length;
    <span class="hljs-keyword">final</span> clampedHp = hero.hp.clamp(<span class="hljs-number">0</span>, hero.maxHp);
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; totalHearts; i++) {
      <span class="hljs-keyword">final</span> start = i * hpPerHeart;
      <span class="hljs-keyword">final</span> filled = (clampedHp - start).clamp(<span class="hljs-number">0</span>, hpPerHeart);
      hearts[i].setHpStage(filled);
    }
  }
</code></pre>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-7">3. æ€ªç‰©è¡€æ¡</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ab4dbc17e484b93aea5f6719e981f79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=nICbXU%2Bb6xawKmOLmDPH5nAX9UQ%3D" width="80%" loading="lazy"/></p><p/>
<p>ç›¸å¯¹äº <strong>äººç‰©è¡€æ¡</strong> çš„ç²¾å¿ƒå±•ç¤ºï¼Œ<strong>æ€ªç‰©è¡€æ¡</strong> å¯å°±å¤ªç®€å•äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ç®€å•é˜è¿°ä¸€ä¸‹æ­¥éª¤ï¼š</p>
<ul>
<li><strong>ç»˜åˆ¶è¡€æ¡èƒŒæ™¯</strong>ï¼šç»˜åˆ¶ä¸€ä¸ª <strong>åŠé€æ˜é»‘è‰²çš„canvas</strong> ï¼Œå¸®åŠ©ç”¨æˆ·ç›´è§‚çš„æ„Ÿå—æ€ªç‰©è¡€é‡çš„å‡å°‘ã€‚
<pre><code class="hljs language-dart" lang="dart"> <span class="hljs-comment">// èƒŒæ™¯è‰²</span>
 <span class="hljs-keyword">final</span> bgPaint = Paint()
    ..color = Colors.black.withOpacity(<span class="hljs-number">0.6</span>);

  <span class="hljs-comment">// èƒŒæ™¯</span>
  canvas.drawRect(
    Rect.fromLTWH(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, size.x, size.y),
    bgPaint,
  );
</code></pre>
</li>
<li><strong>ç»˜åˆ¶çœŸå®è¡€é‡æ¡</strong>ï¼šåœ¨é»‘è‰²èƒŒæ™¯ç›¸åŒä½ç½®,ç»˜åˆ¶ä¸€ä¸ªçœŸå®è¡€é‡æ¡ï¼Œä¸”åœ¨ä¸åŒ <strong>è¡€é‡æ¯”ä¾‹</strong> åŠ¨æ€å˜åŒ–é¢œè‰²ã€‚
<pre><code class="hljs language-dart" lang="dart">    <span class="hljs-comment">// è¡€æ¡è‰²</span>
    <span class="hljs-keyword">final</span> hpPaint = Paint()
      ..color = _hpColor();

    <span class="hljs-comment">// å½“å‰è¡€é‡</span>
    <span class="hljs-keyword">final</span> ratio = currentHp / maxHp;
    canvas.drawRect(
      Rect.fromLTWH(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, size.x * ratio, size.y),
      hpPaint,
    );

    ...

  <span class="hljs-comment">// ä¸åŒè¡€é‡æ¯”ä¾‹åŠ¨æ€å˜åŒ–é¢œè‰²</span>
  Color _hpColor() {
    <span class="hljs-keyword">final</span> ratio = currentHp / maxHp;
    <span class="hljs-keyword">if</span> (ratio &gt; <span class="hljs-number">0.6</span>) <span class="hljs-keyword">return</span> Colors.green;
    <span class="hljs-keyword">if</span> (ratio &gt; <span class="hljs-number">0.3</span>) <span class="hljs-keyword">return</span> Colors.orange;
    <span class="hljs-keyword">return</span> Colors.red;
  }
</code></pre>
</li>
<li><strong>æ¯å¸§æ›´æ–°è¡€é‡å˜åŒ–</strong>
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-keyword">void</span> updateHp(<span class="hljs-built_in">int</span> hp) {
    currentHp = hp.clamp(<span class="hljs-number">0</span>, maxHp);
  }
</code></pre>
</li>
</ul>
<h4 data-id="heading-8">4. æ”»å‡»æŠ€èƒ½æŒ‰é’®</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d8f03287b8640ce92a035192bd7ae9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=W%2FRTzmEuhwHSorekR4fPfvlm%2BsQ%3D" width="80%" loading="lazy"/></p><p/>
<p>åƒæ‰‹æœºæ¸¸æˆä¸­ <strong>æ”»å‡»æŒ‰é’®çš„å¸ƒå±€</strong>ï¼Œå¤§å¤šæ•°éƒ½æ˜¯å’Œ <code>ç‹è€…è£è€€</code> å¤§å·®ä¸å·®çš„ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿæ¥å®ç°ä¸€ä¸‹ï¼š</p>
<h5 data-id="heading-9">ï¼ˆ1ï¼‰å®ç°å•ä¸ªæŠ€èƒ½æŒ‰é’® <code>AttackButton</code></h5>
<ul>
<li><code>æ„é€ å‚æ•°</code>ï¼š
<ul>
<li><strong>HeroComponent hero</strong>ï¼šä¼ å…¥æŒ‰é’®çš„ä½¿ç”¨è€…</li>
<li><strong>String icon</strong>ï¼šä¼ å…¥æŒ‰é’®çš„å›¾æ ‡</li>
<li><strong>VoidCallback onPressed</strong>ï¼šä¼ å…¥æŒ‰é’®çš„æ‰§è¡Œå‡½æ•°</li>
</ul>
<pre><code class="hljs language-dart" lang="dart">  AttackButton({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.hero,
    <span class="hljs-keyword">required</span> <span class="hljs-built_in">String</span> icon,
    <span class="hljs-keyword">required</span> VoidCallback onPressed,
  }) : iconName = icon,
       <span class="hljs-keyword">super</span>(
         onPressed: onPressed,
         size: Vector2.all(<span class="hljs-number">72</span>),
         anchor: Anchor.center,
       );
</code></pre>
</li>
<li><code>åŠ è½½icon ï¼Œç»˜åˆ¶å¤–è¾¹æ¡†</code>:
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-keyword">void</span>&gt; onLoad() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">super</span>.onLoad();
    button = <span class="hljs-keyword">await</span> Sprite.load(iconName);

    <span class="hljs-comment">// æ·»åŠ å¤–éƒ¨åœ†åœˆ</span>
    add(
      CircleComponent(
        radius: <span class="hljs-number">36</span>,
        position: size / <span class="hljs-number">2</span>,
        anchor: Anchor.center,
        paint: Paint()
          ..color = Colors.white38
          ..style = PaintingStyle.stroke
          ..strokeWidth = <span class="hljs-number">4</span>,
      ),
    );
  }
</code></pre>
</li>
<li><code>é‡å†™ render , è£å‰ª â­•ï¸ å¤šä½™éƒ¨åˆ†</code>:
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-meta">@override</span>
<span class="hljs-keyword">void</span> render(Canvas canvas) {
  canvas.save();
  <span class="hljs-keyword">final</span> path = Path()..addOval(size.toRect());
  canvas.clipPath(path);
  <span class="hljs-keyword">super</span>.render(canvas);
  canvas.restore();
}
</code></pre>
</li>
</ul>
<h5 data-id="heading-10">ï¼ˆ2ï¼‰åˆ›å»ºæŒ‰é’®ç»„ <code>AttackHud</code></h5>
<ul>
<li><strong>åˆ›å»ºä¸€ä¸ª <code>buttonGroup</code> å®¹å™¨</strong>
<pre><code class="hljs language-dart" lang="dart">    buttonGroup = PositionComponent()
      ..anchor = Anchor.center
      ..position = Vector2.zero();
</code></pre>
</li>
<li><strong>è·å–æŠ€èƒ½æ•°é‡</strong>
<pre><code class="hljs language-dart" lang="dart">    <span class="hljs-keyword">final</span> attacks = hero.cfg.attack;
    <span class="hljs-keyword">final</span> count = attacks.length;
</code></pre>
</li>
<li><strong>å®šä¹‰äº†ä¸€ä¸ª <code>å·¦ä¸‹ â†’ æ­£å·¦</code> çš„æ‰‡å½¢</strong>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> radius = buttonSize + <span class="hljs-number">32.0</span>;
<span class="hljs-keyword">final</span> startDeg = <span class="hljs-number">270.0</span>;
<span class="hljs-keyword">final</span> endDeg = <span class="hljs-number">180.0</span>;
</code></pre>
</li>
<li><strong>åŠ¨æ€åˆ›å»ºæŒ‰é’®</strong>:
<ul>
<li>ç¬¬ä¸€ä¸ªæ™®é€šæ”»å‡»æ”¾ä¸­é—´</li>
<li>å…¶ä»–æŒ‰é’®é æ‰‡å½¢å‡åŒ€åˆ†å¸ƒ</li>
<li>åˆ›å»º <code>AttackButton</code> å¹¶æŒ‚è½½</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {
        Vector2 position;

        <span class="hljs-comment">// æ™®é€šæ”»å‡»æ”¾ä¸­é—´</span>
        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) {
          position = Vector2.zero();
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">final</span> skillIndex = i - <span class="hljs-number">1</span>;
          <span class="hljs-keyword">final</span> skillCount = count - <span class="hljs-number">1</span>;
          
          <span class="hljs-comment">// å‡åŒ€åˆ†å¸ƒ</span>
          <span class="hljs-keyword">final</span> t = skillCount &lt;= <span class="hljs-number">1</span> ? <span class="hljs-number">0.5</span> : skillIndex / (skillCount - <span class="hljs-number">1</span>);
          <span class="hljs-keyword">final</span> deg = startDeg + (endDeg - startDeg) * t;
          
          <span class="hljs-comment">// æåæ ‡ â†’ å±å¹•åæ ‡</span>
          <span class="hljs-keyword">final</span> rad = deg * math.pi / <span class="hljs-number">180.0</span>;
          position = Vector2(math.cos(rad), math.sin(rad)) * radius;
        }

        buttonGroup.add(
          AttackButton(
            hero: hero,
            icon: attacks[i].icon!,
            onPressed: () =&gt; _attack(i),
          )..position = position,
        );
      }
</code></pre>
</li>
<li><strong>è°ƒç”¨äººç‰©æ”»å‡»</strong>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">void</span> _attack(<span class="hljs-built_in">int</span> index) {
    hero.attack(index, MonsterComponent);
  }
</code></pre>
</li>
</ul>
<h3 data-id="heading-11">ä¸‰. äººç‰©ç»„ä»¶çš„æŠ½è±¡ç»§æ‰¿</h3>
<h4 data-id="heading-12">1. åˆ›å»ºè§’è‰²é…ç½®æ–‡ä»¶</h4>
<p>å°†è§’è‰²å‚æ•°<strong>ç¡¬ç¼–ç </strong> åœ¨ç»„ä»¶ä¸­ï¼Œä¼šå¯¼è‡´ç»„ä»¶ä¸å…·ä½“è§’è‰² <strong>å¼ºè€¦åˆ</strong>ï¼Œä¸€æ—¦æ¶‰åŠå¤šè§’è‰²ä½“ç³»æˆ–æ€ªç‰©è§„æ¨¡åŒ–ç”Ÿæˆï¼Œä»£ç å°†è¿…é€ŸğŸ’¥ğŸ¥šã€‚<br/>
å› æ­¤æˆ‘ä»¬å¼•å…¥<strong>è§’è‰²é…ç½®å±‚</strong>ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶æè¿°è§’è‰²çš„ <strong>åŠ¨ç”»ã€å±æ€§ä¸ç¢°æ’ä¿¡æ¯</strong>ï¼Œç”± <code>è§’è‰²åŸºç±»</code> åœ¨è¿è¡Œæ—¶ç»Ÿä¸€åŠ è½½ã€‚<br/>
è¿™æ ·å°±ä½¿è§’è‰²ç³»ç»Ÿä» <code>ä»£ç é©±åŠ¨ â¡ æ•°æ®é©±åŠ¨</code>ï¼Œæå‡äº†æ‰©å±•æ€§ä¸ç»´æŠ¤æ€§ã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">è§’è‰²é…ç½®</span></span>
<span class="hljs-comment">/// <span class="markdown">id è§’è‰²id</span></span>
<span class="hljs-comment">/// <span class="markdown">spritePath è§’è‰²spriteè·¯å¾„</span></span>
<span class="hljs-comment">/// <span class="markdown">cellSize è§’è‰²spriteå•å…ƒæ ¼å¤§å°</span></span>
<span class="hljs-comment">/// <span class="markdown">componentSize è§’è‰²ç»„ä»¶å¤§å°</span></span>
<span class="hljs-comment">/// <span class="markdown">maxHp æœ€å¤§ç”Ÿå‘½å€¼</span></span>
<span class="hljs-comment">/// <span class="markdown">attackValue æ”»å‡»å€¼</span></span>
<span class="hljs-comment">/// <span class="markdown">speed ç§»åŠ¨é€Ÿåº¦</span></span>
<span class="hljs-comment">/// <span class="markdown">detectRadius æ£€æµ‹åŠå¾„</span></span>
<span class="hljs-comment">/// <span class="markdown">attackRange æ”»å‡»èŒƒå›´</span></span>
<span class="hljs-comment">/// <span class="markdown">hitbox äººç‰©ä½“å‹ç¢°æ’æ¡†</span></span>
<span class="hljs-comment">/// <span class="markdown">animations åŠ¨ç”»</span></span>
<span class="hljs-comment">/// <span class="markdown">attack æ”»å‡»åˆ—è¡¨</span></span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CharacterConfig</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> spritePath;
  <span class="hljs-keyword">final</span> Vector2 cellSize;
  <span class="hljs-keyword">final</span> Vector2 componentSize;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> maxHp;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> attackValue;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> speed;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> detectRadius;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> attackRange;
  <span class="hljs-keyword">final</span> HitboxSpec hitbox;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">Object</span>, AnimationSpec&gt; animations;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;AttackSpec&gt; attack;

  <span class="hljs-keyword">const</span> CharacterConfig({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.spritePath,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.cellSize,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.componentSize,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.maxHp,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.attackValue,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.speed,
    <span class="hljs-keyword">this</span>.detectRadius = <span class="hljs-number">500</span>,
    <span class="hljs-keyword">this</span>.attackRange = <span class="hljs-number">60</span>,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.hitbox,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.animations,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.attack,
  });

  <span class="hljs-keyword">static</span> CharacterConfig? byId(<span class="hljs-built_in">String</span> id) =&gt; _characterConfigs[id];
}
</code></pre>
<blockquote>
<p>æœ‰äº†è¿™ä»½é©±åŠ¨æ•°æ®åï¼Œ<strong>å¯¹é©´ç”»é©¬</strong> å°†åŸæ¥çš„ <code>HeroComponent</code> ä¸­çš„è§’è‰²é€šç”¨æ•°æ®å’Œæ–¹æ³•ï¼Œé›†ä¸­åˆ° <code>CharacterComponent</code>,åœ¨å•ç‹¬ç»§æ‰¿å®ç°<code>HeroComponent</code> å’Œå…¶ä»–æ‰©å±•ç±»ï¼Œä¹Ÿæ˜¯ç®€ç®€å•å•ã€‚</p>
<p>å› æ­¤ï¼Œäººç‰©æ‹†åˆ†å†…å®¹å°±ä¸å¤šèµ˜è¿°ï¼Œä»…ä½œä»‹ç»ï¼Œå…·ä½“å®ç°æŸ¥çœ‹ <strong>ä»“åº“æºç </strong>ã€‚</p>
</blockquote>
<h4 data-id="heading-13">2. æŠ½è±¡è§’è‰²ç»„ä»¶ <code>CharacterComponent</code></h4>



















































































































































































<table><thead><tr><th>æ¨¡å—åˆ†ç±»</th><th>åŠŸèƒ½ç‚¹</th><th>å·²å®ç°å†…å®¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>åŸºç¡€å®šä¹‰</strong></td><td>è§’è‰²åŸºç¡€ç»„ä»¶</td><td>ç»§æ‰¿ <code>SpriteAnimationComponent</code></td><td>å…·å¤‡ç²¾çµåŠ¨ç”»ã€ä½ç½®ã€å°ºå¯¸ã€æœå‘èƒ½åŠ›</td></tr><tr><td/><td>æ¸¸æˆå¼•ç”¨</td><td><code>HasGameReference&lt;MyGame&gt;</code></td><td>å¯è®¿é—® worldã€blockersã€camera ç­‰</td></tr><tr><td><strong>é…ç½®ç³»ç»Ÿ</strong></td><td>è§’è‰²é…ç½®åŠ è½½</td><td><code>CharacterConfig.byId(characterId)</code></td><td>è§’è‰²å±æ€§ã€æ”»å‡»é…ç½®æ•°æ®é©±åŠ¨</td></tr><tr><td/><td>è´´å›¾èµ„æº</td><td><code>spritePath / cellSize</code></td><td>ç»Ÿä¸€ä»é…ç½®åŠ è½½åŠ¨ç”»èµ„æº</td></tr><tr><td><strong>åŸºç¡€å±æ€§</strong></td><td>ç”Ÿå‘½å€¼ç³»ç»Ÿ</td><td><code>maxHp / hp / loseHp()</code></td><td>æä¾›å®Œæ•´ç”Ÿå‘½ç®¡ç†ä¸æ­»äº¡åˆ¤å®š</td></tr><tr><td/><td>æ”»å‡»æ•°å€¼</td><td><code>attackValue</code></td><td>åŸºç¡€æ”»å‡»åŠ›å­—æ®µ</td></tr><tr><td/><td>ç§»åŠ¨é€Ÿåº¦</td><td><code>speed</code></td><td>ç”¨äºä½ç§» / å†²åˆº</td></tr><tr><td><strong>çŠ¶æ€ç³»ç»Ÿ</strong></td><td>çŠ¶æ€æšä¸¾</td><td><code>CharacterState</code></td><td>idle / run / attack / hurt / dead</td></tr><tr><td/><td>çŠ¶æ€é”</td><td><code>isActionLocked</code></td><td>æ”»å‡» / å—ä¼¤ / æ­»äº¡æœŸé—´ç¦æ­¢æ“ä½œ</td></tr><tr><td/><td>çŠ¶æ€åˆ‡æ¢</td><td><code>setState()</code></td><td>åŒæ­¥åŠ¨ç”»ä¸çŠ¶æ€</td></tr><tr><td><strong>åŠ¨ç”»ç³»ç»Ÿ</strong></td><td>åŠ¨ç”»åŠ è½½</td><td><code>loadAnimations()</code></td><td>ä» SpriteSheet æ„å»ºçŠ¶æ€åŠ¨ç”»</td></tr><tr><td/><td>æ”»å‡»åŠ¨ç”»</td><td><code>playAttackAnimation()</code></td><td>æ’­æ”¾æ”»å‡»åŠ¨ç”»å¹¶è‡ªåŠ¨å› idle</td></tr><tr><td><strong>æœå‘æ§åˆ¶</strong></td><td>æ°´å¹³æœå‘</td><td><code>facingRight</code></td><td>ç»Ÿä¸€æ”»å‡» / ç§»åŠ¨æ–¹å‘</td></tr><tr><td/><td>ç¿»è½¬é€»è¾‘</td><td><code>faceLeft / faceRight()</code></td><td>ç²¾çµæ°´å¹³ç¿»è½¬</td></tr><tr><td><strong>æ”»å‡»ç³»ç»Ÿ</strong></td><td>æ”»å‡»å…¥å£</td><td><code>attack(index, targetType)</code></td><td>è§’è‰²ç»Ÿä¸€æ”»å‡»æ¥å£</td></tr><tr><td/><td>Hitbox è§£è€¦</td><td><code>AttackHitboxFactory.create()</code></td><td>æ”»å‡»åˆ¤å®šå®Œå…¨å·¥å‚åŒ–</td></tr><tr><td/><td>æ”»å‡»åŠ¨ç”»é©±åŠ¨</td><td>æ”»å‡»å‰æ’­æ”¾åŠ¨ç”»</td><td>åŠ¨ç”»ä¸åˆ¤å®šåˆ†ç¦»</td></tr><tr><td><strong>ç¢°æ’ä½“ç³»</strong></td><td>ä¸»ä½“ç¢°æ’ä½“</td><td><code>RectangleHitbox hitbox</code></td><td>ç”¨äºä¸–ç•Œå®ä½“ç¢°æ’</td></tr><tr><td/><td>çŸ©å½¢ç¢°æ’æ£€æµ‹</td><td><code>collidesWith(Rect)</code></td><td>æä¾›çŸ©å½¢çº§ç¢°æ’åˆ¤æ–­</td></tr><tr><td/><td>ç¢°æ’çº æ­£</td><td><code>resolveOverlaps(dt)</code></td><td>è§£å†³äººç‰©å¡æ­»</td></tr><tr><td><strong>ç§»åŠ¨ç³»ç»Ÿ</strong></td><td>ç¢°æ’ç§»åŠ¨</td><td><code>moveWithCollision()</code></td><td>æ”¯æŒæ»‘åŠ¨çš„é˜»æŒ¡ç¢°æ’ç§»åŠ¨</td></tr><tr><td/><td>å›é€€æœºåˆ¶</td><td>X/Y åˆ†è½´å¤„ç†</td><td>é˜²æ­¢è§’è‰²å¡æ­»</td></tr><tr><td><strong>ç¯å¢ƒäº¤äº’</strong></td><td>åœ°å½¢é˜»æŒ¡</td><td><code>game.blockers</code></td><td>å¢™ä½“ / éšœç¢ç‰©é˜»æŒ¡</td></tr><tr><td/><td>é—¨äº¤äº’</td><td><code>DoorComponent.attemptOpen()</code></td><td>å¸¦æ¡ä»¶çš„äº¤äº’ç¢°æ’</td></tr><tr><td><strong>è§’è‰²äº¤äº’</strong></td><td>è§’è‰²é—´é˜»æŒ¡</td><td>ä¸å…¶ä»– <code>CharacterComponent</code> ç¢°æ’</td><td>é˜²æ­¢è§’è‰²é‡å </td></tr><tr><td><strong>å¬å”¤ç‰©AIé€»è¾‘</strong></td><td>æ­»äº¡å¤„ç†</td><td><code>updateSummonAI(dt)</code></td><td>å¯»æ‰¾æ•Œäººã€æ”»å‡»ã€è·Ÿéšä¸»äººã€å¾…æœº</td></tr><tr><td><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td>æ­»äº¡å¤„ç†</td><td><code>onDead()</code>ï¼ˆæŠ½è±¡ï¼‰</td><td>å­ç±»å®ç°å…·ä½“æ­»äº¡è¡Œä¸º</td></tr><tr><td><strong>æ‰©å±•èƒ½åŠ›</strong></td><td>æŠ½è±¡åŸºç±»</td><td><code>abstract class</code></td><td>Hero / Monster / NPC ç»Ÿä¸€çˆ¶ç±»</td></tr></tbody></table>
<h4 data-id="heading-14">3. å®ç° <code>HeroComponent</code></h4>





















































































<table><thead><tr><th>åŠŸèƒ½æ¨¡å—</th><th>å·²å®ç°ä½œç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>è§’è‰²èº«ä»½</strong></td><td>æ˜ç¡®ä¸º<code>ç©å®¶è§’è‰²</code></td><td>Hero æ˜¯å¯è¾“å…¥æ§åˆ¶çš„ Character</td></tr><tr><td><strong>é’¥åŒ™ç³»ç»Ÿ</strong></td><td>ç®¡ç†ç©å®¶æŒæœ‰çš„é’¥åŒ™é›†åˆ</td><td><code>keys</code> ç”¨äºé—¨ã€æœºå…³ç­‰æ¡ä»¶äº¤äº’</td></tr><tr><td><strong>é“å…·åé¦ˆ</strong></td><td>è·å–é’¥åŒ™æ—¶ UI æç¤º</td><td><code>UiNotify.showToast</code> å±äºç©å®¶åé¦ˆ</td></tr><tr><td><strong>åŠ¨ç”»åˆå§‹åŒ–</strong></td><td>åŠ è½½å¹¶ç»‘å®šè§’è‰²åŠ¨ç”»</td><td>ä½¿ç”¨é…ç½®è¡¨ä¸­çš„ animations</td></tr><tr><td><strong>åˆå§‹çŠ¶æ€è®¾ç½®</strong></td><td>åˆå§‹ä¸º <code>idle</code> çŠ¶æ€</td><td>Hero å‡ºç”Ÿå³å¾…æœº</td></tr><tr><td><strong>å‡ºç”Ÿä½ç½®è®¾ç½®</strong></td><td>è®¾ç½®åˆå§‹åæ ‡</td><td>é€šå¸¸åªç”± Hero å†³å®š</td></tr><tr><td><strong>ç¢°æ’ä½“åˆ›å»º</strong></td><td>åˆ›å»ºå¹¶æŒ‚è½½è§’è‰² Hitbox</td><td>Hero çš„ç‰©ç†å½¢æ€</td></tr><tr><td><strong>ç›¸æœºç»‘å®š</strong></td><td>ç›¸æœºè·Ÿéšç©å®¶</td><td><code>game.camera.follow(this)</code></td></tr><tr><td><strong>è¾“å…¥å¤„ç†</strong></td><td>è¯»å–æ‘‡æ†è¾“å…¥</td><td>Hero ç‹¬æœ‰ï¼Œæ€ªç‰©ä¸ä¼šæœ‰</td></tr><tr><td><strong>çŠ¶æ€åˆ‡æ¢</strong></td><td>idle / run çŠ¶æ€ç®¡ç†</td><td>åŸºäºç©å®¶è¾“å…¥</td></tr><tr><td><strong>å—å‡»åé¦ˆ</strong></td><td>æ’­æ”¾å—å‡»éŸ³æ•ˆä¸åŠ¨ç”»</td><td>ç©å®¶ä¸“å±ä½“éªŒåé¦ˆ</td></tr><tr><td><strong>å—å‡»çŠ¶æ€æ¢å¤</strong></td><td>å—å‡»åå›åˆ° idle</td><td>ä¿è¯æ“ä½œè¿è´¯æ€§</td></tr><tr><td><strong>æ­»äº¡è¡¨ç°</strong></td><td>æ’­æ”¾æ­»äº¡åŠ¨ç”»</td><td>ä¸æ€ªç‰©æ­»äº¡é€»è¾‘ä¸åŒ</td></tr><tr><td><strong>é‡å¼€æµç¨‹</strong></td><td>æ˜¾ç¤º Restart UI</td><td>åªå±äºç©å®¶æ­»äº¡é€»è¾‘</td></tr><tr><td><strong>UI äº¤äº’</strong></td><td>ä¸ HUD / Overlay è”åŠ¨</td><td>Hero æ˜¯ UI çš„æ ¸å¿ƒæ•°æ®æº</td></tr></tbody></table>
<h4 data-id="heading-15">4. å®ç° <code>MonsterComponent</code></h4>
















































































<table><thead><tr><th>åŠŸèƒ½æ¨¡å—</th><th>å·²å®ç°ä½œç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>è§’è‰²èº«ä»½</strong></td><td>æ˜ç¡®ä¸º<code>æ€ªç‰©è§’è‰²</code></td><td>ç”± AI æ§åˆ¶çš„ Character</td></tr><tr><td><strong>å‡ºç”Ÿç‚¹ç®¡ç†</strong></td><td>å›ºå®šå‡ºç”Ÿåæ ‡</td><td><code>birthPosition</code> å†³å®šæ€ªç‰©åˆå§‹ä½ç½®</td></tr><tr><td><strong>æ€ªç‰©ç±»å‹æ ‡è¯†</strong></td><td>monsterId</td><td>ç”¨äºè¯»å–é…ç½®ã€åŒºåˆ†æ€ªç‰©</td></tr><tr><td><strong>åŠ¨ç”»åˆå§‹åŒ–</strong></td><td>åŠ è½½å¹¶ç»‘å®šæ€ªç‰©åŠ¨ç”»</td><td>æ¥è‡ª cfg.animations</td></tr><tr><td><strong>åˆå§‹çŠ¶æ€è®¾ç½®</strong></td><td>åˆå§‹ä¸º <code>idle</code></td><td>å‡ºç”Ÿå³å¾…æœº</td></tr><tr><td><strong>ç¢°æ’ä½“åˆ›å»º</strong></td><td>åˆ›å»ºå¹¶æŒ‚è½½ Hitbox</td><td>æ€ªç‰©ç‰©ç†è¾¹ç•Œ</td></tr><tr><td><strong>è¡€æ¡ç»„ä»¶</strong></td><td>å¤´é¡¶è¡€æ¡æ˜¾ç¤º</td><td><code>MonsterHpBarComponent</code></td></tr><tr><td><strong>è¡€é‡åŒæ­¥</strong></td><td>å®æ—¶æ›´æ–°è¡€æ¡</td><td>æ¯å¸§ <code>hpBar.updateHp</code></td></tr><tr><td><strong>ç®€å•AI</strong></td><td>æ¢æµ‹è·ç¦»ã€è¿½é€ã€æ”»å‡»ç©å®¶å’Œè‡ªä¸»æ¸¸è¡</td><td><code>detectRadiusã€attackRange</code></td></tr><tr><td><strong>çŠ¶æ€åˆ‡æ¢</strong></td><td>idle / run / hurt</td><td>ç”± AI å†³å®š</td></tr><tr><td><strong>å—å‡»åé¦ˆ</strong></td><td>æ’­æ”¾å—å‡»åŠ¨ç”»</td><td>æ—  UI æç¤º</td></tr><tr><td><strong>å—å‡»æ¢å¤</strong></td><td>å—å‡»åå›åˆ° idle</td><td>ä¿è¯ AI è¿è´¯</td></tr><tr><td><strong>æ­»äº¡è¡¨ç°</strong></td><td>æ’­æ”¾æ­»äº¡åŠ¨ç”»</td><td>ä¸æ˜¾ç¤º UI</td></tr><tr><td><strong>é”€æ¯é€»è¾‘</strong></td><td>æ­»äº¡åç§»é™¤å®ä½“</td><td><code>removeFromParent()</code></td></tr></tbody></table>
<h3 data-id="heading-16">å››. ç¢°æ’ç±»æ”»å‡»çš„å®ç°</h3>
<p>å®Œæˆäº† <strong>äººç‰©</strong> é‚£ä¸ªåŸºç¡€è¦ç‚¹ï¼Œæ¥ä¸‹æ¥å…ä¸äº†çš„å°±æ˜¯ <strong>æ”»å‡»é€»è¾‘</strong> äº†ï¼Œè¿™æ˜¯å¤§å¤šæ•°æ¸¸æˆçš„æ ¸å¿ƒã€‚<br/>
è€Œæ¸¸æˆçš„ <code>äººç‰©</code> å’Œ <code>æ”»å‡»</code>  ä¸€æ ·éƒ½ç¦»ä¸å¼€ <strong>ç¢°æ’</strong>ï¼Œç”šè‡³åè€…æ›´ç”šä¹‹ã€‚</p>
<h4 data-id="heading-17">1.æ€è·¯</h4>
<p>æ— è®ºæ˜¯ <strong>è¿‘æˆ˜ã€è¿œç¨‹ å’Œ å†²åˆº</strong>ï¼Œé€ æˆ <strong>ä¼¤å®³</strong> çš„<code> ç¬¬ä¸€è¦ç‚¹</code>ï¼Œå°±æ˜¯æ”»å‡»äº§ç”Ÿçš„ <code>çŸ©å½¢</code> ç¢°æ’åˆ°ç›®æ ‡æ•Œäººäº†ã€‚<br/>
å…¶æ¬¡ï¼Œåœ¨æ‰‹æœºè‚‰é¸½æ¸¸æˆä¸­ï¼Œ<strong>è¿‘æˆ˜å’Œè¿œç¨‹</strong> çš„æ”»å‡»æ€»ä¼šè‡ªåŠ¨ç´¢æ•Œï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ª <code>é€šç”¨ç‚¹</code>ã€‚<br/>
å› æ­¤ï¼Œå¾—å‡ºä¸Šè¿°é€»è¾‘ä¹‹åï¼Œæˆ‘ä»¬å¿…ç„¶å°†å…±æ€§ç‚¹æŠ½è±¡ä¸º <code>åŸºç±»</code>ï¼Œå…¶ä»–ä»»æ„ <strong>ç¢°æ’äº§ç”Ÿä¼¤å®³çš„æ”»å‡»</strong> <code>ç»§æ‰¿å®ç°</code> å³å¯ã€‚</p>
<h4 data-id="heading-18">2. æ”»å‡»åˆ¤å®šåŸºç±» <code>AbstractAttackRect</code></h4>
<h5 data-id="heading-19">ï¼ˆ1ï¼‰ <strong>åŸºç¡€å±æ€§ç®¡ç†</strong></h5>
<ul>
<li><strong>damage</strong>ï¼šä¼¤å®³</li>
<li><strong>owner</strong>ï¼šå½’å±è€…</li>
<li><strong>targetType</strong>ï¼šç›®æ ‡ç±»å‹</li>
<li><strong>duration</strong>ï¼šæŒç»­æ—¶é•¿</li>
<li><strong>removeOnHit</strong>ï¼šæ˜¯å¦ç©¿é€</li>
<li><strong>maxLockDistance</strong>ï¼šæœ€å¤§è·ç¦»</li>
</ul>
<h5 data-id="heading-20">ï¼ˆ2ï¼‰ <strong>å‘½ä¸­æ£€æµ‹æœºåˆ¶</strong></h5>
<ul>
<li>
<p>æä¾› <code>getAttackRect</code> æ¥å£æ”¯æŒè‡ªå®šä¹‰å‡ ä½•åŒºåŸŸåˆ¤å®šï¼ˆå¦‚æ‰‡å½¢ã€å¤šè¾¹å½¢ï¼‰ã€‚</p>
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-comment">/// <span class="markdown">è¿”å›è¯¥ç»„ä»¶ç”¨äºåˆ¤å®šçš„å‡ ä½•åŒºåŸŸ</span></span>
  ui.Rect getAttackRect();
</code></pre>
</li>
<li>
<p>å†…ç½®ç›®æ ‡å»é‡æœºåˆ¶ <code>_hitTargets</code>ï¼Œé˜²æ­¢å•æ¬¡æ”»å‡»å¤šæ®µä¼¤å®³å¼‚å¸¸ã€‚</p>
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Set</span>&lt;PositionComponent&gt; _hitTargets = {};
</code></pre>
</li>
<li>
<p>é›†æˆ <code>CollisionCallbacks</code> æ”¯æŒç‰©ç†å¼•æ“ç¢°æ’ã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> onCollisionStart(
    <span class="hljs-built_in">Set</span>&lt;Vector2&gt; intersectionPoints,
    PositionComponent other,
  ) {
    <span class="hljs-keyword">super</span>.onCollisionStart(intersectionPoints, other);
    _applyHit(other);
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> onCollision(<span class="hljs-built_in">Set</span>&lt;Vector2&gt; intersectionPoints, PositionComponent other) {
    <span class="hljs-keyword">super</span>.onCollision(intersectionPoints, other);
    _applyHit(other);
  }
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/085297c428774e8e885a29975dbb5e3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=ED8LJVq%2Fj98ULoYSTLYahjs%2FqzQ%3D" width="100%" loading="lazy"/></p><p/>
<blockquote>
<p>âš ï¸ <strong>æ³¨æ„</strong></p>
<p>å¦‚æœè¿™é‡Œåªä¾é  <strong>Flame</strong> çš„ <code>CollisionCallbacks</code> åˆ¤æ–­å‘½ä¸­ï¼Œæ˜¯æœ‰é—®é¢˜çš„ï¼š</p>
<ul>
<li>å·²ç»ç«™åœ¨æ”»å‡»çŸ©å½¢é‡Œçš„æ•Œäºº âŒ ä¸ä¼šè§¦å‘</li>
<li>æ”»å‡»ç”Ÿæˆç¬é—´å°±é‡å  âŒ ä¸ä¸€å®šè§¦å‘</li>
</ul>
<p>è¿™å°±æ˜¯ <strong>ç åˆ€è´´è„¸ = æ²¡ä¼¤å®³</strong> çš„ç»å…¸ bug æ¥æº</p>
<p>ç©¶å…¶åŸå› ï¼ŒFlame çš„ç¢°æ’æ¨¡å‹æ ¸å¿ƒæ˜¯ <code>å‘ç”Ÿç¢°æ’ â†’ è§¦å‘å›è°ƒ</code>,åªèƒ½å‘Šè¯‰ä½  <strong>ä¸¤ä¸ªç¢°æ’ä½“æ˜¯å¦æ¥è§¦</strong><br/>
ä½†å®ƒä¸èƒ½å¯é åœ°å›ç­”: <strong>å½“å‰æ”»å‡»åŒºåŸŸå†… <em>æœ‰å“ªäº›</em> ç›®æ ‡</strong></p>
<p>å› æ­¤,æˆ‘ä»¬éœ€è¦åœ¨ <code>update</code> ä¸­æ‰‹åŠ¨åˆ¤æ–­ï¼Œ<code>CollisionCallbacks</code>åªèƒ½ä½œä¸ºè¾…åŠ©åˆ¤æ–­ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5980ee4ebe924ec7a569b58963bf71ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=d2V0QUKeV%2F%2F%2BMD2o5GPE2RIOvaI%3D" width="100%" loading="lazy"/></p><p/>
<pre><code class="hljs language-dart" lang="dart">      <span class="hljs-meta">@override</span>
      <span class="hljs-keyword">void</span> update(<span class="hljs-built_in">double</span> dt) {
        <span class="hljs-keyword">super</span>.update(dt);
        <span class="hljs-keyword">final</span> ui.Rect attackRect = getAttackRect();
         <span class="hljs-keyword">if</span> (targetType == HeroComponent) {
           <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> h <span class="hljs-keyword">in</span> game.world.children.query&lt;HeroComponent&gt;()) {
             <span class="hljs-keyword">if</span> (h == owner) <span class="hljs-keyword">continue</span>;
             <span class="hljs-keyword">final</span> ui.Rect targetRect = h.hitbox.toAbsoluteRect();
             <span class="hljs-keyword">if</span> (_shouldDamage(attackRect, targetRect)) {               _applyHit(h);
           }
         }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (targetType == MonsterComponent) {
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> m <span class="hljs-keyword">in</span> game.world.children.query&lt;MonsterComponent&gt;()) {
            <span class="hljs-keyword">if</span> (m == owner) <span class="hljs-keyword">continue</span>;
            <span class="hljs-keyword">final</span> ui.Rect targetRect = m.hitbox.toAbsoluteRect();
            <span class="hljs-keyword">if</span> (_shouldDamage(attackRect, targetRect)) {               _applyHit(m);
            }
          }
        }
      }
</code></pre>
</li>
</ul>
<h5 data-id="heading-21">ï¼ˆ3ï¼‰ <strong>æ™ºèƒ½ç´¢æ•Œç³»ç»Ÿ</strong></h5>
<ul>
<li><code>autoLockNearestTarget</code>ï¼šè‡ªåŠ¨ç­›é€‰æœ€è¿‘çš„æœ‰æ•ˆç›®æ ‡ï¼ˆæ’é™¤è‡ªèº«ã€è¿‡æ»¤è·ç¦»ï¼‰ã€‚
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-comment">/// <span class="markdown">å­ç±»å®ç°ï¼šå½“æ‰¾åˆ°æœ€è¿‘ç›®æ ‡æ—¶çš„å¤„ç†</span></span>
  <span class="hljs-keyword">void</span> onLockTargetFound(PositionComponent target);

  <span class="hljs-comment">/// <span class="markdown">å­ç±»å®ç°ï¼šå½“æœªæ‰¾åˆ°ç›®æ ‡æ—¶çš„å¤„ç†ï¼ˆå¦‚è·Ÿéšæ‘‡æ†æ–¹å‘ï¼‰</span></span>
  <span class="hljs-keyword">void</span> onNoTargetFound();

  <span class="hljs-comment">/// <span class="markdown">è‡ªåŠ¨é”å®šæœ€è¿‘ç›®æ ‡</span></span>
  <span class="hljs-keyword">void</span> autoLockNearestTarget() {
    <span class="hljs-keyword">final</span> PositionComponent? target = _findNearestTarget();
    <span class="hljs-keyword">if</span> (target != <span class="hljs-keyword">null</span>) {
      onLockTargetFound(target);
    } <span class="hljs-keyword">else</span> {
      onNoTargetFound();
    }
  }
</code></pre>
</li>
<li><code>angleToTarget</code>ï¼šè®¡ç®—ç²¾å‡†çš„æ”»å‡»æœå‘ã€‚
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-comment">/// <span class="markdown">è®¡ç®—åˆ°ç›®æ ‡çš„æœå‘è§’åº¦ï¼ˆå¼§åº¦ï¼‰</span></span>
  <span class="hljs-built_in">double</span> angleToTarget(PositionComponent target, Vector2 from) {
    <span class="hljs-keyword">final</span> Vector2 origin = from;
    <span class="hljs-keyword">final</span> Vector2 targetPos = target.position.clone();
    <span class="hljs-keyword">return</span> math.atan2(targetPos.y - origin.y, targetPos.x - origin.x);
  }
</code></pre>
</li>
</ul>
<h5 data-id="heading-22">ï¼ˆ4ï¼‰ <strong>ç”Ÿå‘½å‘¨æœŸæ§åˆ¶</strong></h5>
<ul>
<li>æ”¯æŒå‘½ä¸­å³é”€æ¯ (<code>removeOnHit</code>) æˆ–ç©¿é€æ¨¡å¼ã€‚(å­ç±»é€šè¿‡ä¼ é€’å‚æ•°æ§åˆ¶)
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-keyword">if</span> (removeOnHit) {
    removeFromParent();
  }
</code></pre>
</li>
<li>åŸºäºæ—¶é—´çš„è‡ªåŠ¨é”€æ¯æœºåˆ¶ã€‚</li>
</ul>
<h5 data-id="heading-23">ï¼ˆ5ï¼‰ æ‰©å±•è¯´æ˜</h5>
<ul>
<li>æ‰€æœ‰æ”»å‡»åˆ¤å®šä½“ï¼ˆ<strong>è¿‘æˆ˜ã€å­å¼¹ã€AOEç­‰</strong>ï¼‰å‡åº”ç»§æ‰¿æ­¤ç±»ã€‚</li>
<li>å­ç±»éœ€å®ç° <code>getAttackRect</code> ä»¥å®šä¹‰å…·ä½“çš„æ”»å‡»åŒºåŸŸå½¢çŠ¶ã€‚</li>
</ul>
<h4 data-id="heading-24">3. æ™®é€šè¿‘æˆ˜æ”»å‡»ç»„ä»¶ <code>MeleeHitbox</code></h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc61a2c8caa748b7adc97e1d1d437e80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=7ZaoHrHa9Fv9QQEu0jl%2FAUKEgUI%3D" width="100%" loading="lazy"/></p><p/>
<h5 data-id="heading-25">ï¼ˆ1ï¼‰ çŸ©å½¢åˆ¤å®šåŒºåŸŸ</h5>
<ul>
<li>ä½¿ç”¨ <code>RectangleHitbox</code> ä½œä¸ºç‰©ç†ç¢°æ’æ£€æµ‹åŒºåŸŸã€‚
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-meta">@override</span>
  ui.Rect getAttackRect() =&gt; hitbox.toAbsoluteRect();
</code></pre>
</li>
<li>é»˜è®¤é…ç½®ä¸ºè¢«åŠ¨ç¢°æ’ç±»å‹ (<code>CollisionType.passive</code>)ã€‚
<pre><code class="hljs language-dart" lang="dart">   hitbox = RectangleHitbox()..collisionType = CollisionType.passive;
</code></pre>
<blockquote>
<p>ğŸ‘‰ <strong>è¡¨ç¤ºï¼šè¿™ä¸ªç¢°æ’ä½“åªæ¥æ”¶ç¢°æ’ï¼Œä¸ä¸»åŠ¨æ¨åŠ¨æˆ–é˜»æŒ¡åˆ«äºº</strong></p>
</blockquote>
</li>
</ul>
<h5 data-id="heading-26">ï¼ˆ2ï¼‰ è‡ªåŠ¨ç´¢æ•Œè½¬å‘</h5>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> onLockTargetFound(PositionComponent target) {
    <span class="hljs-keyword">final</span> ui.Rect rect = getAttackRect();
    <span class="hljs-keyword">final</span> Vector2 center = Vector2(
      rect.left + rect.width / <span class="hljs-number">2</span>,
      rect.top + rect.height / <span class="hljs-number">2</span>,
    );
    angle = angleToTarget(target, center);
  }
</code></pre>
<ul>
<li>é‡å†™ <code>onLockTargetFound</code> å®ç°æ”»å‡»æ–¹å‘è‡ªåŠ¨å¯¹å‡†æœ€è¿‘ç›®æ ‡ã€‚</li>
<li>é€šè¿‡è°ƒæ•´ç»„ä»¶æ—‹è½¬è§’åº¦ (<code>angle</code>) æ¥æŒ‡å‘ç›®æ ‡ä¸­å¿ƒã€‚</li>
</ul>
<h5 data-id="heading-27">ï¼ˆ3ï¼‰ ç”Ÿå‘½å‘¨æœŸç®¡ç†</h5>
<pre><code class="hljs language-dart" lang="dart"> <span class="hljs-built_in">double</span> _timer = <span class="hljs-number">0</span>;

 <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> update(<span class="hljs-built_in">double</span> dt) {
    ...

    _timer += dt;
    <span class="hljs-keyword">if</span> (_timer &gt;= duration) {
      removeFromParent();
    }
  }
</code></pre>
<ul>
<li>ä½¿ç”¨å†…éƒ¨è®¡æ—¶å™¨ <code>_timer</code> ç²¾ç¡®æ§åˆ¶æ”»å‡»æŒç»­æ—¶é—´ã€‚</li>
<li>è¶…æ—¶è‡ªåŠ¨é”€æ¯ï¼Œæ¨¡æ‹Ÿç¬é—´æŒ¥ç æ•ˆæœã€‚</li>
</ul>
<h5 data-id="heading-28">ï¼ˆ4ï¼‰ ä½ç½®ä¿®æ­£</h5>
<pre><code class="hljs language-dart" lang="dart"> <span class="hljs-comment">// å°†ä¼ å…¥çš„å·¦ä¸Šè§’åæ ‡è½¬æ¢ä¸ºä¸­å¿ƒåæ ‡ä»¥ä¾¿æ—‹è½¬</span>
 position: position + size / <span class="hljs-number">2</span>,
</code></pre>
<ul>
<li>æ„é€ æ—¶è‡ªåŠ¨å°†å·¦ä¸Šè§’åæ ‡è½¬æ¢ä¸ºä¸­å¿ƒåæ ‡ï¼Œç¡®ä¿æ—‹è½¬å›´ç»•ä¸­å¿ƒç‚¹è¿›è¡Œã€‚</li>
</ul>
<h5 data-id="heading-29">ï¼ˆ5ï¼‰ é€‚ç”¨åœºæ™¯</h5>
<ul>
<li>åˆ€å‰‘æŒ¥ç ã€æ‹³å‡»ç­‰ <strong>çŸ­è·ç¦»ç¬é—´æ”»å‡»</strong>ã€‚</li>
<li>éœ€è¦è‡ªåŠ¨å¸é™„æˆ–è½¬å‘ç›®æ ‡çš„è¿‘èº«æ”»å‡»ã€‚</li>
</ul>
<h4 data-id="heading-30">4. è¿œç¨‹æŠ•å°„ç‰©æ”»å‡»ç»„ä»¶ <code>BulletHitbox</code></h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af91b418428d4c2ca83ad84f7cf204cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=imPgYA7YXHSxhnuNRQLIqRYNdCs%3D" width="100%" loading="lazy"/></p><p/>
<h5 data-id="heading-31">ï¼ˆ1ï¼‰ ç›´çº¿å¼¹é“è¿åŠ¨</h5>
<ul>
<li>åŸºäº <code>direction</code> å’Œ <code>config.speed</code> è¿›è¡Œæ¯å¸§ä½ç§»ã€‚</li>
<li>è®°å½•é£è¡Œè·ç¦» <code>_distanceTraveled</code>ï¼Œè¶…è¿‡å°„ç¨‹ <code>config.maxRange</code> è‡ªåŠ¨é”€æ¯ã€‚
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> update(<span class="hljs-built_in">double</span> dt) {
    <span class="hljs-keyword">super</span>.update(dt);

    ...

    <span class="hljs-keyword">final</span> moveStep = direction * config.speed * dt;
    position += moveStep;
    _distanceTraveled += moveStep.length;

    <span class="hljs-keyword">if</span> (_distanceTraveled &gt;= config.maxRange) {
      removeFromParent();
    }
  }
</code></pre>
</li>
</ul>
<h5 data-id="heading-32">ï¼ˆ2ï¼‰ æ™ºèƒ½ç´¢æ•Œä¸æ–¹å‘é”å®š</h5>
<ul>
<li>
<p><code>onLockTargetFound</code>ï¼šå‘å°„æ—¶è‹¥æ£€æµ‹åˆ°æ•Œäººï¼Œè‡ªåŠ¨é”å®šæ–¹å‘æœå‘æ•Œäººã€‚</p>
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> onLockTargetFound(PositionComponent target) {
    <span class="hljs-comment">// è®¾ç½®ä»äººç‰©åˆ°æœ€è¿‘æ•Œäººçš„ç›´çº¿æ–¹å‘</span>
    <span class="hljs-keyword">final</span> Vector2 origin = position.clone();
    <span class="hljs-keyword">final</span> Vector2 targetPos = target.position.clone();
    direction = (targetPos - origin).normalized();
    _locked = <span class="hljs-keyword">true</span>;
  }
</code></pre>
</li>
<li>
<p><code>onNoTargetFound</code>ï¼šè‹¥æ— æ•Œäººï¼Œä¼˜å…ˆä½¿ç”¨æ‘‡æ†æ–¹å‘ï¼Œå¦åˆ™ä¿æŒåˆå§‹æ–¹å‘ã€‚</p>
</li>
<li>
<p><code>_locked</code> æœºåˆ¶ï¼šç¡®ä¿å­å¼¹ä¸€æ—¦å‘å°„ï¼Œæ–¹å‘å³è¢«é”å®šï¼Œä¸ä¼šéšç©å®¶åç»­æ“ä½œæ”¹å˜è½¨è¿¹ã€‚</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-built_in">bool</span> _locked = <span class="hljs-keyword">false</span>;

<span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> onNoTargetFound() {
    <span class="hljs-comment">// å­å¼¹æ”»å‡»ï¼šè‹¥æ— ç›®æ ‡ï¼Œä¸”å°šæœªé”å®šæ–¹å‘ï¼Œåˆ™å°è¯•ä½¿ç”¨æ‘‡æ†æ–¹å‘</span>
    <span class="hljs-comment">// å¦‚æœæ‘‡æ†ä¹Ÿæ— è¾“å…¥ï¼Œä¿æŒåˆå§‹ direction</span>
    <span class="hljs-keyword">if</span> (!_locked &amp;&amp; !game.joystick.delta.isZero()) {
      direction = game.joystick.delta.normalized();
    }
    <span class="hljs-comment">// æ— è®ºæ˜¯å¦ä½¿ç”¨äº†æ‘‡æ†æ–¹å‘ï¼Œåªè¦è¿›å…¥è¿™é‡Œï¼ˆè¯´æ˜æ²¡æ‰¾åˆ°æ•Œäººï¼‰ï¼Œå°±é”å®šæ–¹å‘ã€‚</span>
    <span class="hljs-comment">// é˜²æ­¢åç»­é£è¡Œä¸­å› ä¸ºæ‘‡æ†å˜åŠ¨è€Œæ”¹å˜æ–¹å‘ã€‚</span>
    _locked = <span class="hljs-keyword">true</span>;
  }
</code></pre>
</li>
</ul>
<h5 data-id="heading-33">ï¼ˆ3ï¼‰ è§†è§‰è¡¨ç°</h5>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8074cd3c15740319af4f120dd9e04a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=vy2zau3FtksuGEcKpfTyDra7eyo%3D" width="100%" loading="lazy"/></p><p/>
<ul>
<li>
<p>æ”¯æŒé™æ€è´´å›¾æˆ–å¸§åŠ¨ç”» (<code>SpriteAnimationComponent</code>)ã€‚</p>
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; onLoad() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">super</span>.onLoad();
    <span class="hljs-keyword">if</span> (config.spritePath != <span class="hljs-keyword">null</span>) {
      <span class="hljs-keyword">final</span> image = <span class="hljs-keyword">await</span> game.images.load(config.spritePath!);

      <span class="hljs-keyword">if</span> (config.animation != <span class="hljs-keyword">null</span>) {
        <span class="hljs-keyword">final</span> sheet = SpriteSheet(
          image: image,
          srcSize: config.textureSize ?? config.size,
        );
        <span class="hljs-keyword">final</span> anim = sheet.createAnimation(
          row: config.animation!.row,
          stepTime: config.animation!.stepTime,
          from: config.animation!.from,
          to: config.animation!.to,
          loop: config.animation!.loop,
        );
        add(SpriteAnimationComponent(animation: anim, size: size));
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">final</span> sprite = Sprite(image);
        add(SpriteComponent(sprite: sprite, size: size));
      }
    }
  }
</code></pre>
</li>
</ul>
<h5 data-id="heading-34">ï¼ˆ4ï¼‰ ç¢°æ’ç‰¹æ€§</h5>
<ul>
<li>ä½¿ç”¨ <code>RectangleHitbox</code> å¹¶è®¾ä¸º <code>CollisionType.active</code> ä¸»åŠ¨æ£€æµ‹ç¢°æ’ã€‚
<pre><code class="hljs language-dart" lang="dart">RectangleHitbox()..collisionType = CollisionType.active;
</code></pre>
</li>
<li>æ”¯æŒç©¿é€å±æ€§ (<code>config.penetrate</code>)ï¼Œå†³å®šå‘½ä¸­åæ˜¯å¦ç«‹å³é”€æ¯ã€‚
<pre><code class="hljs language-dart" lang="dart">removeOnHit: !config.penetrate,
</code></pre>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a9a078f8ab740d7b0db0547b8a475e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=aNviq3tYklc0qeEBQH1VfJWo6WA%3D" width="100%" loading="lazy"/><p/></li>
</ul>
<h5 data-id="heading-35">ï¼ˆ5ï¼‰ é€‚ç”¨åœºæ™¯</h5>
<ul>
<li>å¼“ç®­ã€é­”æ³•çƒã€æªæ¢°å­å¼¹ç­‰è¿œç¨‹æ”»å‡»ã€‚</li>
<li>éœ€è¦ç›´çº¿é£è¡Œä¸”å°„ç¨‹å—é™çš„æŠ•å°„ç‰©ã€‚</li>
</ul>
<h4 data-id="heading-36">5. å†²åˆºæ”»å‡»ç»„ä»¶ <code>DashHitbox</code></h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63158ff4efc24c5e9e6b2afb1dd9dc14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=IyzK3szWIsXc8kzftFqnrbS62mw%3D" width="100%" loading="lazy"/></p><p/>
<p><strong>æ»‘æ­¥</strong> å…¶å®å°±æ˜¯æ¸¸æˆä¸­å¸¸è§çš„ <strong>å†²æ’æŠ€èƒ½</strong>ã€‚ <br/>
å› æ­¤ï¼Œæˆ‘ä»¬ä¾æ—§ç»§æ‰¿æˆ‘ä»¬çš„æ”»å‡»åˆ¤å®šåŸºç±» <code>AbstractAttackRect</code>ï¼Œå¹¶åœ¨æ­¤åŸºç¡€ä¸Šå®ç°ä½ç§»å°±è¡Œäº†ã€‚</p>
<h5 data-id="heading-37">ï¼ˆ1ï¼‰ ä½ç§»ä¸ç‰©ç†è¿åŠ¨</h5>
<ul>
<li>ç›´æ¥é©±åŠ¨å½’å±è€… <code>owner</code> è¿›è¡Œé«˜é€Ÿä½ç§»ã€‚</li>
<li>é›†æˆç‰©ç†ç¢°æ’æ£€æµ‹ <code>moveWithCollision</code>ï¼Œé˜²æ­¢ç©¿å¢™ã€‚</li>
<li>æŒç»­åŒæ­¥ä½ç½® <code>position.setFrom(owner.position)</code>ï¼Œç¡®ä¿æ”»å‡»åˆ¤å®šè·Ÿéšè§’è‰²ã€‚</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">if</span> (_locked &amp;&amp; !direction.isZero()) {
      <span class="hljs-keyword">final</span> delta = direction * speed * dt;
      <span class="hljs-keyword">if</span> (owner <span class="hljs-keyword">is</span> CharacterComponent) {
         <span class="hljs-keyword">final</span> char = owner <span class="hljs-keyword">as</span> CharacterComponent;
         char.moveWithCollision(delta);

         <span class="hljs-keyword">if</span> (delta.x &gt; <span class="hljs-number">0</span>) char.faceRight();
         <span class="hljs-keyword">if</span> (delta.x &lt; <span class="hljs-number">0</span>) char.faceLeft();
      } <span class="hljs-keyword">else</span> {
         owner.position += delta;
      }
    }

position.setFrom(owner.position);
</code></pre>
<h5 data-id="heading-38">ï¼ˆ2ï¼‰ æ‘‡æ†æ“ä½œä¸æ–¹å‘é”å®š</h5>
<ul>
<li><code>onNoTargetFound</code>ï¼šä¼˜å…ˆä½¿ç”¨æ‘‡æ†æ–¹å‘ï¼Œå¦åˆ™æ²¿å½“å‰æœå‘å†²åˆºã€‚</li>
<li><code>_locked</code> æœºåˆ¶ï¼šç¡®ä¿å†²åˆºè¿‡ç¨‹ä¸­æ–¹å‘æ’å®šï¼Œä¸å—ä¸­é€”æ“ä½œå½±å“ã€‚</li>
</ul>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> onNoTargetFound() {
    <span class="hljs-keyword">if</span> (_locked) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-keyword">if</span> (!game.joystick.delta.isZero()) {
      direction = game.joystick.delta.normalized();
    } <span class="hljs-keyword">else</span> {
       <span class="hljs-keyword">if</span> (owner <span class="hljs-keyword">is</span> CharacterComponent) {
         direction = Vector2((owner <span class="hljs-keyword">as</span> CharacterComponent).facingRight ? <span class="hljs-number">1</span> : <span class="hljs-number">-1</span>, <span class="hljs-number">0</span>);
       } <span class="hljs-keyword">else</span> {
         direction = Vector2(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>); 
       }
    }
    _locked = <span class="hljs-keyword">true</span>;
  }
</code></pre>
<h5 data-id="heading-39">ï¼ˆ3ï¼‰ æŒç»­ä¼¤å®³åˆ¤å®š</h5>
<ul>
<li><code>removeOnHit: false</code>ï¼šå†²åˆºä¸ä¼šå› å‘½ä¸­æ•Œäººè€Œåœæ­¢ (ç©¿é€æ•ˆæœ)ã€‚</li>
<li>åœ¨æŒç»­æ—¶é—´ <code>duration</code> å†…ï¼Œå¯¹è·¯å¾„ä¸Šæ¥è§¦çš„æ‰€æœ‰æœ‰æ•ˆç›®æ ‡é€ æˆä¼¤å®³ã€‚</li>
</ul>
<pre><code class="hljs language-dart" lang="dart">_elapsedTime += dt;
<span class="hljs-keyword">if</span> (_elapsedTime &gt;= duration) {
  removeFromParent();
  <span class="hljs-keyword">return</span>;
}
</code></pre>
<h5 data-id="heading-40">ï¼ˆ4ï¼‰ ç”Ÿå‘½å‘¨æœŸç®¡ç†</h5>
<ul>
<li>åŸºäºæ—¶é—´ <code>_elapsedTime</code> æ§åˆ¶å†²åˆºæ—¶é•¿ï¼Œç»“æŸåè‡ªåŠ¨é”€æ¯ç»„ä»¶ã€‚</li>
</ul>
<h5 data-id="heading-41">ï¼ˆ5ï¼‰ é€‚ç”¨åœºæ™¯</h5>
<ul>
<li>æˆ˜å£«å†²é”‹ã€åˆºå®¢çªè¿›ç­‰ä½ç§»æŠ€èƒ½ã€‚</li>
<li>éœ€è¦åŒæ—¶å…¼é¡¾ä½ç§»å’Œä¼¤å®³çš„æŠ€èƒ½æœºåˆ¶ã€‚</li>
</ul>
<h3 data-id="heading-42">äº”. æ¸¸æˆéŸ³æ•ˆ</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1074d4e175184db58a39e0df5147401b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=2Aocr%2FujRzLp0I2SOdlnqMI3uxM%3D" alt="æˆªå±2025-12-20 16.58.12.png" loading="lazy"/></p>
<p>åœ¨æ¸¸æˆä½“éªŒä¸­ï¼Œ<strong>éŸ³æ•ˆå¹¶ä¸æ˜¯è£…é¥°å“ï¼Œè€Œæ˜¯åé¦ˆç³»ç»Ÿçš„ä¸€éƒ¨åˆ†</strong>ã€‚<br/>
æ— è®ºæ˜¯æ”»å‡»å‘½ä¸­ã€è§’è‰²å—ä¼¤ï¼Œè¿˜æ˜¯åœºæ™¯äº¤äº’ï¼Œå¦‚æœéŸ³æ•ˆåˆ†æ•£å†™åœ¨å„ä¸ªç»„ä»¶ä¸­ï¼Œå¾€å¾€ä¼šé€ æˆ<strong>èµ„æºé‡å¤åŠ è½½ã€é€»è¾‘æ··ä¹±ã€éš¾ä»¥ç»Ÿä¸€ç®¡ç†éŸ³é‡ä¸çŠ¶æ€</strong>çš„é—®é¢˜ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¯¹æ¸¸æˆéŸ³é¢‘è¿›è¡Œç»Ÿä¸€å°è£…ï¼Œå¼•å…¥ä¸€ä¸ª <strong><code>AudioManager</code></strong>ï¼Œé›†ä¸­è´Ÿè´£ <strong>BGM ä¸éŸ³æ•ˆï¼ˆSFXï¼‰çš„åŠ è½½ã€æ’­æ”¾ã€æš‚åœä¸è¯­ä¹‰åŒ–è°ƒç”¨</strong>ï¼Œè®©æ¸¸æˆé€»è¾‘åªå…³å¿ƒ <code>å‘ç”Ÿäº†ä»€ä¹ˆï¼Œè€Œä¸å…³å¿ƒéŸ³æ•ˆæ€ä¹ˆæ”¾</code>ã€‚</p>
<h4 data-id="heading-43">1. å°è£… <code>AudioManager</code></h4>
<pre><code class="hljs language-dart" lang="dart">
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AudioManager</span> </span>{
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">bool</span> _inited = <span class="hljs-keyword">false</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">String?</span> _currentBgm;

  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> bgmVolume = <span class="hljs-number">0.8</span>;
  <span class="hljs-keyword">static</span> <span class="hljs-built_in">double</span> sfxVolume = <span class="hljs-number">1.0</span>;

  <span class="hljs-comment">/// <span class="markdown">å¿…é¡»åœ¨æ¸¸æˆå¯åŠ¨æ—¶è°ƒç”¨</span></span>
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; init() <span class="hljs-keyword">async</span> {
    ...
  }

  <span class="hljs-comment">// ================== SFX ==================</span>

  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; playSfx(<span class="hljs-built_in">String</span> file, {<span class="hljs-built_in">double?</span> volume}) <span class="hljs-keyword">async</span> {
    ...
  }

  <span class="hljs-comment">// ================== BGM ==================</span>

  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; playBgm(<span class="hljs-built_in">String</span> file, {<span class="hljs-built_in">double?</span> volume}) <span class="hljs-keyword">async</span> {
    ...
  }

  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; stopBgm() <span class="hljs-keyword">async</span> {
    ...
  }

  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; pauseBgm() <span class="hljs-keyword">async</span> {
    ...
  }

  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; resumeBgm() <span class="hljs-keyword">async</span> {
    ...
  }

  <span class="hljs-comment">// ================== è¯­ä¹‰åŒ–å°è£… ==================</span>

  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; playDoorOpen() =&gt; playSfx(<span class="hljs-string">'door_open.wav'</span>);
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; playSwordClash() =&gt; playSfx(<span class="hljs-string">'sword_clash_2.wav'</span>);
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; playFireLighting() =&gt; playSfx(<span class="hljs-string">'fire_lighting.wav'</span>);
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; startBattleBgm() =&gt; playBgm(<span class="hljs-string">'Goblins_Dance_(Battle).wav'</span>);
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; startRegularBgm() =&gt; playBgm(<span class="hljs-string">'Goblins_Den_(Regular).wav'</span>);
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; playDoorKnock() =&gt; playSfx(<span class="hljs-string">'door_knock.wav'</span>);
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; playWhistle() =&gt; playSfx(<span class="hljs-string">'whistle.wav'</span>);
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; playHurt() =&gt; playSfx(<span class="hljs-string">'Hurt.wav'</span>);
  <span class="hljs-keyword">static</span> Future&lt;<span class="hljs-keyword">void</span>&gt; playLaserGun() =&gt; playSfx(<span class="hljs-string">'Laser_Gun.wav'</span>);
}

</code></pre>
<h4 data-id="heading-44">2. éŸ³æ•ˆä½¿ç”¨</h4>
<ul>
<li><code>mygame</code> ä¸­åˆå§‹åŒ–ï¼Œå¹¶å¼€å§‹æ’­æ”¾ <code>bgm</code>
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; onLoad() <span class="hljs-keyword">async</span> {
    <span class="hljs-comment">// åŠ è½½æ¸¸æˆèµ„æº</span>
    <span class="hljs-keyword">super</span>.onLoad();
    <span class="hljs-comment">// åˆå§‹åŒ–éŸ³é¢‘ç®¡ç†å™¨</span>
    <span class="hljs-keyword">await</span> AudioManager.init();
    <span class="hljs-comment">// æ’­æ”¾BGM</span>
    AudioManager.startRegularBgm();
    <span class="hljs-comment">// åŠ è½½åœ°å›¾</span>
    <span class="hljs-keyword">await</span> _loadLevel();
  }
</code></pre>
</li>
<li><code>BulletHitbox</code>ï¼š<strong>å­å¼¹éŸ³æ•ˆ</strong></li>
<li><code>DoorComponent</code>: <strong>æ•²é—¨ä¸å…³é—¨éŸ³æ•ˆ</strong></li>
<li><code>HeroComponent</code>: <strong>å—å‡»éŸ³æ•ˆ</strong></li>
<li>...</li>
</ul>
<blockquote>
<p>å¤§å®¶å»ç½‘ä¸Šæ‰¾ <strong>éŸ³é¢‘</strong> åï¼Œä¿å­˜åœ¨ <code>assets/aduio/</code> ä¸‹ï¼Œåœ¨ <code>AudioManager</code> ä¸­åŠ è½½ä½¿ç”¨ï¼Œ å°±å¯ä»¥åœ¨ä½ æƒ³è¦çš„åœ°æ–¹æ·»åŠ äº†ã€‚</p>
</blockquote>
<h3 data-id="heading-45">å…­. å¬å”¤æœ¯</h3>
<p>åœ¨ä¸Šè¿°ï¼Œæœ‰äº† <strong>è¿‘æˆ˜ã€è¿œç¨‹å’Œå†²åˆº</strong> çš„çŸ©å½¢åˆ¤æ–­ä¹‹åï¼Œæˆ‘ä»¬çš„å°äººå°±æŒæ¡äº† <code>æ™®æ”»</code> ã€ <code>ç«çƒæ³•æœ¯</code> å’Œ <code>æ»‘æ­¥</code>ã€‚<br/>
ä½†æ˜¯ï¼Œæˆ‘è§‰å¾—é‚£äº›è¿˜ä¸å¤Ÿæœ‰æ„æ€ï¼Œå› ä¸ºä»–æ˜¯ <strong>é­”æ³•å¸ˆ</strong>ã€‚<br/>
äºæ˜¯ä¹ï¼Œä¼š <code>å¬å”¤</code> å°å¼Ÿçš„æ»‘æ­¥é­”æ³•å¸ˆï¼Œä»–æ¥äº†ã€‚</p>
<h4 data-id="heading-46">1. æ„æ€</h4>
<p>ä¸€å¼€å§‹,æˆ‘æ‰“ç®—æ–°å»ºä¸€ä¸ª <code>GenerateComponent</code> ç»§æ‰¿ <code>CharacterComponent</code>ã€‚<br/>
è¿™å¾ˆç®€å•ï¼Œ<strong>ä¾è‘«èŠ¦ç”»ç“¢</strong> å¾ˆå¿«ä¹Ÿå°±å®ç°äº†ï¼Œä½†æ˜¯åˆ°äº†å¬å”¤ç‰©æ”»å‡»é€»è¾‘æ—¶ï¼Œå°±å¤´ç–¼äº†ã€‚<br/>
å› ä¸ºï¼Œæˆ‘ä»¬ä¹‹å‰æ‰€æœ‰é€»è¾‘éƒ½æ˜¯å›´ç»•ä¸¤ä¸ªé˜µè¥çš„ <code>hero</code> ğŸ†š <code>monster</code>ï¼Œæ–°å¢ç¬¬ä¸‰æ–¹ï¼Œå°±è¦é‡æ„äº†ã€‚<br/>
ä½†æ˜¯è½¬å¿µä¸€æƒ³ï¼Œå…¶å®è¿™ä¸ªå¬å”¤ç‰©å’Œå…¶ä»–ä¸¤ä¸ªç±»æ²¡ä»€ä¹ˆä¸åŒï¼Œç´¢æ€§å“ªä¸ªäººç‰©å¬å”¤çš„ï¼Œå¬å”¤ç‰©å°±ç”¨å“ªä¸ªäººç‰©çš„ç±»åˆ›å»ºå°±è¡Œäº†ã€‚<br/>
æ‰€æœ‰é€»è¾‘éƒ½ä¸éœ€è¦æ”¹å˜äº†ï¼Œå¯¹æˆ˜é€»è¾‘å®Œå…¨ç¬¦åˆï¼Œä»…ä»…éœ€è¦æ–°å¢ä¸€æ®µ <strong>å¬å”¤ç‰©AIé€»è¾‘</strong> å°±å¯ä»¥äº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d973b7941c04811ac0c704c34af1389~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=El9kqY%2BJHOT4nLAvi3LOPxaNYd4%3D" width="100%" loading="lazy"/></p><p/>
<h4 data-id="heading-47">2. å®ç°</h4>
<ul>
<li>æ–°å»ºå¬å”¤ç‰©ç”Ÿæˆå·¥å‚ç±» <code>GenerateFactory</code></li>
<li><code>æ‰€éœ€å±æ€§</code>
<ul>
<li><strong>game</strong>ï¼šæ¸¸æˆå®¹å™¨ï¼Œç”¨äºæ·»åŠ å¬å”¤ç‰©</li>
<li><strong>center</strong>: äººç‰©ä¸­å¿ƒç‚¹</li>
<li><strong>generateId</strong>: å¬å”¤ç‰©idï¼Œç”¨äºå®šä½é…ç½®èµ„æº</li>
<li><strong>owner</strong>: å¬å”¤è€…</li>
<li><strong>enemyType</strong>: æ•Œå¯¹ç±»å‹</li>
<li><strong>count</strong>: å¬å”¤ç‰©æ•°é‡</li>
<li><strong>radius</strong>: è§’åº¦</li>
<li><strong>followDistance</strong>: è·Ÿéšè·ç¦»</li>
</ul>
</li>
<li><code>ç¡®å®šç”Ÿæˆç‰©ç›¸å¯¹äºäººç‰©çš„ä½ç½®</code>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> step = <span class="hljs-number">2</span> * math.pi / count;
<span class="hljs-keyword">final</span> start = -math.pi / <span class="hljs-number">2</span>;
<span class="hljs-keyword">final</span> list = &lt;CharacterComponent&gt;[];
<span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {
  <span class="hljs-keyword">final</span> angle = start + i * step;
  <span class="hljs-keyword">final</span> pos = Vector2(
    center.x + radius * math.cos(angle),
    center.y + radius * math.sin(angle),
  );     
</code></pre>
</li>
<li><code>ç”Ÿæˆæ‰€æœ‰å¬å”¤ç‰©</code>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// æ ¹æ®æ‹¥æœ‰è€…ç±»å‹å†³å®šç”Ÿæˆç‰©ç±»å‹</span>
<span class="hljs-comment">// Heroç”ŸæˆHeroComponentä½œä¸ºéšä»</span>
<span class="hljs-comment">// Monsterç”ŸæˆMonsterComponentä½œä¸ºéšä»</span>
<span class="hljs-keyword">if</span> (owner <span class="hljs-keyword">is</span> HeroComponent) {
 comp = HeroComponent(
   heroId: generateId, 
   birthPosition: position,
 );
} <span class="hljs-keyword">else</span> {
 comp = MonsterComponent(position, generateId);
}

<span class="hljs-comment">// è®¾ç½®å¬å”¤ç‰©é€šç”¨å±æ€§</span>
comp.position = position;
comp.isGenerate = <span class="hljs-keyword">true</span>;
comp.summonOwner = owner;
comp.followDistance = followDistance;


...

list.add(
   create(
     position: pos,
     generateId: generateId,
     owner: owner,
     enemyType: enemyType,
     followDistance: followDistance,
   ),
 );
</code></pre>
</li>
</ul>
<h3 data-id="heading-48">ä¸ƒ. äººæœºé€»è¾‘</h3>
<p>åœ¨æ¸¸æˆä¸­ï¼Œ<strong>æ•Œäººæ˜¯å¦ <code>åƒä¸ªäºº</code></strong> ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºäººæœºé€»è¾‘ï¼ˆAIï¼‰ã€‚<br/>
å’±ä»¬çš„ AI å¹¶ä¸è¿½æ±‚å¤æ‚ï¼Œè€Œæ˜¯è¦åšåˆ° <strong>æ„ŸçŸ¥ã€åˆ¤æ–­å’Œåé¦ˆ</strong> ï¼š<br/>
èƒ½å‘ç°æ•Œäººã€èƒ½å†³å®šè¡ŒåŠ¨ã€ä¹Ÿèƒ½åœ¨ä¸åŒçŠ¶æ€ä¹‹é—´è‡ªç„¶åˆ‡æ¢ã€‚</p>
<h4 data-id="heading-49">1. æ€ªç‰©ç´¢æ•Œé€»è¾‘</h4>
<ul>
<li>é¦–å…ˆï¼Œå¯»æ‰¾æœ€è¿‘çš„ <code>HeroComponent</code> ä½œä¸ºç›®æ ‡
<pre><code class="hljs language-dart" lang="dart">    PositionComponent? target;
    <span class="hljs-built_in">double</span> distance = <span class="hljs-built_in">double</span>.infinity;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> h <span class="hljs-keyword">in</span> monster.game.world.children.query&lt;HeroComponent&gt;()) {
      <span class="hljs-keyword">final</span> d = (h.position - monster.position).length;
      <span class="hljs-keyword">if</span> (d &lt; distance) {
        distance = d;
        target = h;
      }
    }
</code></pre>
</li>
<li>ç„¶åï¼Œå¦‚æœè¶…å‡º <strong>æ„ŸçŸ¥èŒƒå›´</strong> æˆ–æœªæ‰¾åˆ° <strong>ç›®æ ‡</strong>ï¼Œåˆ™ <strong>æ¸¸è¡</strong>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">if</span> (target == <span class="hljs-keyword">null</span> || distance &gt; monster.detectRadius) {
     <span class="hljs-keyword">if</span> (monster.wanderDuration &gt; <span class="hljs-number">0</span>) {
       monster.setState(CharacterState.run);
       <span class="hljs-keyword">final</span> delta = monster.wanderDir * monster.speed * dt;
       monster.moveWithCollision(delta);
       monster.wanderDuration -= dt;
       monster.wanderDir.x &gt;= <span class="hljs-number">0</span> ? monster.faceRight() : monster.faceLeft();
     } <span class="hljs-keyword">else</span> {
       monster.wanderCooldown -= dt;
       <span class="hljs-keyword">if</span> (monster.wanderCooldown &lt;= <span class="hljs-number">0</span>) {
         <span class="hljs-keyword">final</span> angle = monster.rng.nextDouble() * <span class="hljs-number">2</span> * math.pi;
         monster.wanderDir = Vector2(math.cos(angle), math.sin(angle));
         monster.wanderDuration = <span class="hljs-number">0.6</span> + monster.rng.nextDouble() * <span class="hljs-number">1.2</span>;
         monster.wanderCooldown = <span class="hljs-number">1.0</span> + monster.rng.nextDouble() * <span class="hljs-number">2.0</span>;
       } <span class="hljs-keyword">else</span> {
         monster.setState(CharacterState.idle);
       }
     }
     <span class="hljs-keyword">return</span>;
   }
</code></pre>
</li>
<li>å…¶æ¬¡ï¼Œå¦‚æœåœ¨ <strong>æ„ŸçŸ¥èŒƒå›´å†…</strong>ï¼Œå°±åˆ¤æ–­æ˜¯å¦åœ¨å¯ä»¥å‘èµ· <strong>æ”»å‡»</strong> çš„ <strong>æ”»å‡»èŒƒå›´å†…</strong>
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-comment">// è¿›å…¥æ”»å‡»èŒƒå›´</span>
  <span class="hljs-keyword">if</span> (distance &lt;= monster.attackRange) {
    monster.attack(<span class="hljs-number">0</span>, HeroComponent);
    <span class="hljs-keyword">return</span>;
  }
</code></pre>
</li>
<li>æœ€åï¼Œå¦‚æœä¸åœ¨ <strong>æ”»å‡»èŒƒå›´å†…</strong>ï¼Œåˆ™ <strong>è¿½é€</strong>
<pre><code class="hljs language-dart" lang="dart"> <span class="hljs-comment">// è¿½é€</span>
 monster.setState(CharacterState.run);

 <span class="hljs-keyword">final</span> toTarget = target!.position - monster.position;
 <span class="hljs-keyword">final</span> direction = toTarget.normalized();
 <span class="hljs-keyword">final</span> delta = direction * monster.speed * dt;

 monster.moveWithCollision(delta);

 direction.x &gt;= <span class="hljs-number">0</span> ? monster.faceRight() : monster.faceLeft();
</code></pre>
</li>
</ul>
<h4 data-id="heading-50">2. å¬å”¤ç‰©è¿è¡Œé€»è¾‘</h4>
<ul>
<li><strong>ç¡®å®šæ•Œå¯¹ç±»å‹</strong>ï¼šå¦‚æœè‡ªå·±æ˜¯ <code>HeroComponent</code>ï¼Œåˆ™æ•Œäººæ˜¯ <code>MonsterComponent</code>ï¼Œåä¹‹äº¦ç„¶
<pre><code class="hljs language-dart" lang="dart">  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> isHero = component <span class="hljs-keyword">is</span> HeroComponent;
</code></pre>
</li>
<li><strong>å¯»æ‰¾æœ€è¿‘çš„æ•Œäºº</strong>
<pre><code class="hljs language-dart" lang="dart">  PositionComponent? target;
  <span class="hljs-keyword">if</span> (isHero) {
    <span class="hljs-comment">// å¯»æ‰¾æœ€è¿‘çš„Monster</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> m <span class="hljs-keyword">in</span> component.game.world.children.query&lt;MonsterComponent&gt;()) {
      <span class="hljs-keyword">if</span> (m == component.summonOwner) <span class="hljs-keyword">continue</span>; <span class="hljs-comment">// æ’é™¤ä¸»äººï¼ˆå¦‚æœæ˜¯ï¼‰</span>
      <span class="hljs-keyword">if</span> (target == <span class="hljs-keyword">null</span> ||
          (m.position - component.position).length &lt;
              (target!.position - component.position).length) {
        target = m;
      }
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// å¯»æ‰¾æœ€è¿‘çš„Hero</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">final</span> h <span class="hljs-keyword">in</span> component.game.world.children.query&lt;HeroComponent&gt;()) {
      <span class="hljs-keyword">if</span> (h == component.summonOwner) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">if</span> (target == <span class="hljs-keyword">null</span> ||
          (h.position - component.position).length &lt;
              (target!.position - component.position).length) {
        target = h;
      }
    }
  }
</code></pre>
</li>
<li>å¦‚æœåœ¨ <strong>æ”»å‡»èŒƒå›´å†…</strong>ï¼Œåˆ™å‘èµ· <strong>æ”»å‡»è¿½é€</strong>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> toEnemy = target.position - component.position;
<span class="hljs-keyword">final</span> enemyDistance = toEnemy.length;
<span class="hljs-keyword">if</span> (enemyDistance &lt;= detectRadius) {
  <span class="hljs-comment">// è¿›å…¥æ”»å‡»èŒƒå›´</span>
  <span class="hljs-keyword">if</span> (enemyDistance &lt;= attackRange) {
    component.attack(<span class="hljs-number">0</span>, isHero ? MonsterComponent : HeroComponent);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-comment">// è¿½å‡»æ•Œäºº</span>
  component.setState(CharacterState.run);
  <span class="hljs-keyword">final</span> direction = toEnemy.normalized();
  <span class="hljs-keyword">final</span> delta = direction * component.speed * dt;
  component.moveWithCollision(delta);
  direction.x &gt;= <span class="hljs-number">0</span> ? component.faceRight() : component.faceLeft();
  <span class="hljs-keyword">return</span>;
}
</code></pre>
</li>
<li>å¦‚æœé™„è¿‘æ²¡æ•Œäººï¼Œå°±è·Ÿéš <strong>å¬å”¤è€…</strong>
<pre><code class="hljs language-dart" lang="dart"> <span class="hljs-keyword">if</span> (component.summonOwner != <span class="hljs-keyword">null</span> &amp;&amp; component.summonOwner!.parent != <span class="hljs-keyword">null</span>) {
   <span class="hljs-keyword">final</span> toOwner = component.summonOwner!.position - component.position;
   <span class="hljs-keyword">final</span> ownerDistance = toOwner.length;
   <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> deadZone = <span class="hljs-number">8.0</span>;

   <span class="hljs-keyword">if</span> (ownerDistance &gt; component.followDistance + deadZone) {
     component.setState(CharacterState.run);
     <span class="hljs-keyword">final</span> direction = toOwner.normalized();
     <span class="hljs-keyword">final</span> delta = direction * component.speed * dt;
     component.moveWithCollision(delta);
     direction.x &gt;= <span class="hljs-number">0</span> ? component.faceRight() : component.faceLeft();
     <span class="hljs-keyword">return</span>;
   }
 }
</code></pre>
</li>
</ul>
<h3 data-id="heading-51">å…«. æ¸¸æˆé€»è¾‘</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff3b25c4b9f149f69591a5375b54e429~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=zYgSc3RYQ47QIroHOL6sHV9ag%2Fw%3D" alt="196b61c4c7e648abaab520444fdd2f55.gif" loading="lazy"/></p>
<blockquote>
<p>ç»ˆäºç»ˆäºï¼Œå°†æœ¬æœŸå†…å®¹ä»‹ç»çš„å·®ä¸å¤šäº†ï¼Œé‚£ä¹ˆç®€å•è®¾è®¡ä¸€ä¸‹ <strong>ä½“éªŒç‰ˆdemo</strong> çš„é€»è¾‘ï¼Œå®Œç»“åŸºç¡€ç¯‡å§ã€‚</p>
</blockquote>
<h4 data-id="heading-52">1. ç»˜å›¾</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/941ce464f3aa4328958914c46c16d4cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=cEqdiYR60X9%2FA7FhaXssxY2xldU%3D" width="100%" loading="lazy"/></p><p/>
<p>åœ¨å›¾ä¸­ï¼Œæ–°å¢ åä¸º <strong>spawn_points</strong> çš„ <code>object layer</code>å›¾å±‚ï¼Œè®¾ç½®å››ä¸ª <strong>æ€ªç‰©å‡ºç”Ÿç‚¹</strong> å’Œ <strong>ä¸€ä¸ªèƒœåˆ©çš„ç»ˆç‚¹</strong>ï¼š</p>
<ul>
<li><code>èƒœåˆ©ç‚¹å±æ€§</code>ï¼š
<ul>
<li><strong>type</strong>ï¼šç±»å‹ goal</li>
</ul>
</li>
<li><code>æ€ªç‰©å‡ºç”Ÿç‚¹å±æ€§</code>ï¼š
<ul>
<li>
<p><strong>type</strong> ï¼šç±»å‹ monster_spawn</p>
</li>
<li>
<p><strong>monsterId</strong>ï¼šæ€ªç‰©ç±»å‹id</p>
</li>
<li>
<p><strong>maxCount</strong>ï¼šè¯¥æ€ªç‰©ç‚¹ï¼Œæœ€å¤§æ€ªç‰©å­˜æ´»æ•°é‡</p>
</li>
<li>
<p><strong>perCount</strong>ï¼šè¯¥æ€ªç‰©ç‚¹ï¼Œæ¯æ¬¡ç”Ÿæˆæ€ªç‰©æ•°é‡</p>
</li>
<li>
<p><strong>productSpeed</strong>ï¼šè¯¥æ€ªç‰©ç‚¹ï¼Œç”Ÿæˆæ€ªç‰©é€Ÿåº¦</p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-53">2. æ–°å¢æ€ªç‰©å‡ºç”Ÿç‚¹</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">/// <span class="markdown">æ€ªç‰©ç”Ÿæˆç‚¹ç»„ä»¶</span></span>
<span class="hljs-comment">///</span>
<span class="hljs-comment">/// <span class="markdown"><span class="hljs-bullet">-</span> æ”¯æŒå®šæ—¶æŒ‰æ‰¹æ¬¡ç”Ÿæˆæ€ªç‰©</span></span>
<span class="hljs-comment">/// <span class="markdown"><span class="hljs-bullet">-</span> æ”¯æŒæœ€å¤§æ•°é‡é™åˆ¶ä¸å¼€å§‹/åœæ­¢æ§åˆ¶</span></span>
<span class="hljs-comment">/// <span class="markdown"><span class="hljs-bullet">-</span> ä½ç½®ä¸å¤§å°ç”±å…³å¡é…ç½®å†³å®šï¼ˆç”¨äºè°ƒè¯•æ˜¾ç¤ºï¼‰</span></span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpawnPointComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">PositionComponent</span>
    <span class="hljs-title">with</span> <span class="hljs-title">HasGameReference</span>&lt;<span class="hljs-title">MyGame</span>&gt; </span>{
  <span class="hljs-comment">/// <span class="markdown">åœºæ™¯å…è®¸å­˜åœ¨çš„æœ€å¤§æ€ªç‰©æ€»æ•°</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> maxCount;

  <span class="hljs-comment">/// <span class="markdown">è¦ç”Ÿæˆçš„æ€ªç‰©ç±»å‹ IDï¼ˆä¸ç°æœ‰ä»£ç ä¸€è‡´ï¼Œä½¿ç”¨å­—ç¬¦ä¸²ï¼‰</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> monsterId;

  <span class="hljs-comment">/// <span class="markdown">æ¯æ¬¡ç”Ÿæˆçš„æ€ªç‰©æ•°é‡</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">int</span> perCount;

  <span class="hljs-comment">/// <span class="markdown">æ¯æ¬¡ç”Ÿæˆçš„æ—¶é—´é—´éš”</span></span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Duration</span> productSpeed;

  <span class="hljs-built_in">bool</span> _running = <span class="hljs-keyword">false</span>;
  <span class="hljs-built_in">double</span> _timeSinceLastSpawn = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Set</span>&lt;MonsterComponent&gt; _spawned = {};

  SpawnPointComponent({
    <span class="hljs-keyword">required</span> Vector2 position,
    <span class="hljs-keyword">required</span> Vector2 size,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.maxCount,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.monsterId,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.perCount,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.productSpeed,
    Anchor anchor = Anchor.center,
    <span class="hljs-built_in">int</span> priority = <span class="hljs-number">0</span>,
  }) : <span class="hljs-keyword">super</span>(
          position: position,
          size: size,
          anchor: anchor,
          priority: priority,
        );

  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; onLoad() <span class="hljs-keyword">async</span> {
    debugMode = <span class="hljs-keyword">true</span>;
  }

  <span class="hljs-comment">/// <span class="markdown">å¼€å§‹ç”Ÿæˆ</span></span>
  <span class="hljs-keyword">void</span> start() {
    _running = <span class="hljs-keyword">true</span>;
  }

  <span class="hljs-comment">/// <span class="markdown">åœæ­¢ç”Ÿæˆå¹¶é‡ç½®è®¡æ—¶</span></span>
  <span class="hljs-keyword">void</span> stop() {
    _running = <span class="hljs-keyword">false</span>;
    _timeSinceLastSpawn = <span class="hljs-number">0</span>;
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> update(<span class="hljs-built_in">double</span> dt) {
    <span class="hljs-keyword">super</span>.update(dt);
    <span class="hljs-keyword">if</span> (!_running) <span class="hljs-keyword">return</span>;

    _timeSinceLastSpawn += dt;
    <span class="hljs-keyword">final</span> intervalSeconds = productSpeed.inMicroseconds / <span class="hljs-number">1e6</span>;

    <span class="hljs-comment">// æŒ‰é—´éš”ç”Ÿæˆï¼Œé¿å…é•¿å¸§é—æ¼</span>
    <span class="hljs-keyword">while</span> (_timeSinceLastSpawn &gt;= intervalSeconds) {
      _timeSinceLastSpawn -= intervalSeconds;
      _spawnBatch();
    }
  }

  <span class="hljs-keyword">void</span> _spawnBatch() {
    <span class="hljs-comment">// ä»…ç»Ÿè®¡ç”±è¯¥ç”Ÿæˆç‚¹äº§ç”Ÿã€ä¸”ä»å­˜åœ¨äºåœºæ™¯ä¸­çš„æ€ªç‰©æ•°é‡</span>
    _spawned.removeWhere((m) =&gt; m.parent == <span class="hljs-keyword">null</span>);
    <span class="hljs-keyword">final</span> currentCount = _spawned.length;
    <span class="hljs-keyword">final</span> allowance = maxCount - currentCount;
    <span class="hljs-keyword">if</span> (allowance &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">final</span> batch = math.min(perCount, allowance);
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; batch; i++) {
      <span class="hljs-keyword">final</span> monster = MonsterComponent(position.clone(), monsterId);
      monster.debugMode = <span class="hljs-keyword">true</span>;
      game.world.add(monster);
      _spawned.add(monster);
    }
  }
}
</code></pre>
<h4 data-id="heading-54">3. æ–°å¢é€šå…³ç‚¹</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GoalComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SpriteAnimationComponent</span>
    <span class="hljs-title">with</span> <span class="hljs-title">HasGameReference</span>&lt;<span class="hljs-title">MyGame</span>&gt;, <span class="hljs-title">CollisionCallbacks</span> </span>{
  GoalComponent({<span class="hljs-keyword">required</span> Vector2 position, <span class="hljs-keyword">required</span> Vector2 size})
    : <span class="hljs-keyword">super</span>(position: position, size: size);

  <span class="hljs-meta">@override</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; onLoad() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">await</span> <span class="hljs-keyword">super</span>.onLoad();
    <span class="hljs-keyword">final</span> image = <span class="hljs-keyword">await</span> game.images.load(<span class="hljs-string">'flag.png'</span>);
    <span class="hljs-keyword">final</span> sheet = SpriteSheet(image: image, srcSize: Vector2(<span class="hljs-number">60</span>, <span class="hljs-number">60</span>));
    animation = sheet.createAnimation(
      row: <span class="hljs-number">0</span>,
      stepTime: <span class="hljs-number">0.12</span>,
      from: <span class="hljs-number">0</span>,
      to: <span class="hljs-number">4</span>,
      loop: <span class="hljs-keyword">true</span>,
    );
    add(RectangleHitbox());
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> onCollisionStart(
    <span class="hljs-built_in">Set</span>&lt;Vector2&gt; intersectionPoints,
    PositionComponent other,
  ) {
    <span class="hljs-keyword">super</span>.onCollisionStart(intersectionPoints, other);
    <span class="hljs-keyword">if</span> (other <span class="hljs-keyword">is</span> HeroComponent) {
      AudioManager.playWhistle();
      UiNotify.showToast(game, <span class="hljs-string">'æ­å–œä½ å®Œæˆäº†æ¸¸æˆï¼'</span>);
      other.onDead();
    }
  }
}

</code></pre>
<h4 data-id="heading-55">4. demoæµç¨‹</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    Start[å¯åŠ¨æ¸¸æˆ] --&gt; Init[åˆå§‹åŒ–: åŠ è½½èµ„æº/éŸ³ä¹/åœ°å›¾]
    Init --&gt; Spawn[ç”Ÿæˆ: è‹±é›„, æ€ªç‰©, é“å…·]
    Spawn --&gt; Loop{æ¸¸æˆå¾ªç¯}
    
    Loop --&gt; Input[ç©å®¶è¾“å…¥: æ‘‡æ†/æ”»å‡»]
    Input --&gt; Update[çŠ¶æ€æ›´æ–°: ç§»åŠ¨/æˆ˜æ–—/ç‰©ç†]
    Update --&gt; Check{æ£€æµ‹çŠ¶æ€}
    
    Check -- &amp;#34;HP &lt;= 0&amp;#34; --&gt; Dead[æ­»äº¡: æ¸¸æˆç»“æŸ]
    Check -- &amp;#34;è·å¾—é’¥åŒ™&amp;#34; --&gt; OpenDoor[äº¤äº’: å¼€å¯é—¨/å®ç®±]
    Check -- &amp;#34;åˆ°è¾¾ç»ˆç‚¹&amp;#34; --&gt; Win[èƒœåˆ©: é€šå…³]
    Check -- &amp;#34;ç»§ç»­&amp;#34; --&gt; Loop
    
    OpenDoor --&gt; Loop
    
    Dead --&gt; Restart[æ˜¾ç¤ºé‡å¼€æŒ‰é’®]
    Win --&gt; Restart
    Restart --&gt; Init
</code></pre>
<h3 data-id="heading-56">ä¹. æ€»ç»“ä¸å±•æœ›</h3>
<h4 data-id="heading-57">æ€»ç»“</h4>
<p>æœ¬ç« ä¸»è¦ä»‹ç»äº† <strong>Flutter&amp;Flame</strong> å¼€å‘ <strong>2Dåƒç´ æ¸¸æˆ</strong> å…³äº <code>æ”»å‡»é€»è¾‘</code> çš„åŸºç¡€å®è·µã€‚<br/>
é€šè¿‡ä¸Šè¿°æ­¥éª¤ï¼Œæˆ‘ä»¬å®Œæˆäº†<code>äººç‰©hudç•Œé¢ã€è¿‘æˆ˜ã€è¿œç¨‹ã€å†²åˆºå’Œå¬å”¤</code> è¿™å‡ ç±»å¸¸è§æ”»å‡»å…ƒç´ çš„å®ç°ã€‚</p>
<p>æˆªè‡³ç›®å‰ä¸ºæ­¢ï¼Œæ¸¸æˆä¸»è¦åŒ…æ‹¬äº†ä»¥ä¸‹å†…å®¹ï¼š</p>
<ul>
<li><strong>è§’è‰²ä¸åŠ¨ç”»</strong>ï¼šä½¿ç”¨ç²¾çµå›¾ (<code>SpriteSheet</code>) åˆ›å»ºè§’è‰²ï¼Œæ”¯æŒ idle/run ç­‰åŠ¨ç”»çŠ¶æ€åˆ‡æ¢ã€‚</li>
<li><strong>ç©å®¶äº¤äº’</strong>ï¼šé€šè¿‡æ‘‡æ†æ§åˆ¶è§’è‰²ç§»åŠ¨ï¼Œå¹¶æ ¹æ®æ–¹å‘ç¿»è½¬åŠ¨ç”»ã€‚</li>
<li><strong>åœ°å›¾åŠ è½½</strong>ï¼šé€šè¿‡ <code>Tiled</code> ç»˜åˆ¶å¹¶åœ¨ <strong>Flame</strong> ä¸­åŠ è½½çš„ <strong>2dåƒç´ åœ°å›¾</strong>ã€‚</li>
<li><strong>åœ°å›¾äº¤äº’</strong>ï¼šé€šè¿‡ç»„ä»¶åŒ–æ¨¡å¼ï¼Œæ–°å»ºäº†å¤šä¸ªå¯ä¾›äº¤äº’çš„ç»„ä»¶å¦‚ï¼ˆ<strong>é—¨ã€é’¥åŒ™ã€å®ç®±ã€åœ°åˆº</strong>ï¼‰ï¼Œä¸ºæ¸¸æˆå¢åŠ äº†äº’åŠ¨æ€§ã€‚</li>
<li><strong>ç»Ÿä¸€ç¢°æ’åŒºæ£€æµ‹</strong>ï¼šå°†è§’è‰²ä¸ <strong>éœ€è¦äº§ç”Ÿç¢°æ’</strong> çš„ç‰©ä½“ç»Ÿä¸€ç®¡ç†ï¼Œå¹¶å®ç°ç¢°æ’æ—¶çš„ <strong>å¹³æ»‘ä¾§ç§»</strong>ã€‚</li>
<li><strong>ç»Ÿä¸€äººç‰©é…ç½®åˆ›å»º</strong>ï¼š é€šè¿‡å°†è§’è‰²æ•°æ®é…ç½®ä¸ºæ–‡ä»¶ï¼Œè¾¾åˆ°ä»¥åŠ¨æ€æ•°æ®é©±åŠ¨æ¨¡å‹çš„ç›®çš„ã€‚</li>
<li><strong>HUDç•Œé¢</strong>ï¼š åŒ…æ‹¬ <code>äººç‰©è¡€é‡æ¡</code> å’Œ <code>æŠ€èƒ½æŒ‰é’®</code>ã€‚</li>
<li><strong>å®Œå–„çš„æ”»å‡»é€»è¾‘</strong>ï¼šé€šè¿‡ç»Ÿä¸€åŸºç±»å®ç°<code>è¿‘æˆ˜ã€è¿œç¨‹ã€å†²åˆº</code> çš„æ”»å‡»æ–¹å¼ å’Œ ç‹¬ç‰¹ <code>å¬å”¤</code> æŠ€èƒ½ã€‚</li>
</ul>
<h4 data-id="heading-58">å±•æœ›</h4>
<ul>
<li>
<p>æ€è€ƒ ğŸ¤” ä¸€ä¸ªæœ‰è¶£çš„æ¸¸æˆæœºåˆ¶ing ...</p>
</li>
<li>
<p>è¿›é˜¶è¿™ä¸ªdemoç‰ˆ</p>
</li>
<li>
<p>æ”¯æŒå±€åŸŸç½‘å¤šç©å®¶è”æœºåŠŸèƒ½ã€‚</p>
</li>
</ul>
<blockquote>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Fmyhero.shanchen.space" target="_blank" title="http://myhero.shanchen.space" ref="nofollow noopener noreferrer">ğŸ® MyHero åœ¨çº¿ä½“éªŒ</a><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTheSyart%2Fmyhero" target="_blank" title="https://github.com/TheSyart/myhero" ref="nofollow noopener noreferrer">ğŸšª github æºç </a><br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.shanchen.space" target="_blank" title="https://www.shanchen.space" ref="nofollow noopener noreferrer">ğŸ’» ä¸ªäººé—¨æˆ·ç½‘ç«™</a></p>
</blockquote>
<hr/>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48d840c0943b48dc974afc9d4952fefd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgX-Wkp-WtpueJsg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766833156&amp;x-signature=wA9rhxuqYdB5qFgAt38MxlrqmRY%3D" width="100%" loading="lazy"/></p><p/>
<p align="center"><i>ä¹‹å‰å°è¯•çš„Demoé¢„è§ˆ</i></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è§£æ„ JavaScript è¿­ä»£å™¨ï¼šä¸€è¡Œä»£ç å¼•å‘çš„æ€§èƒ½æ€è€ƒ]]></title>    <link>https://juejin.cn/post/7585468725332623414</link>    <guid>https://juejin.cn/post/7585468725332623414</guid>    <pubDate>2025-12-20T11:40:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585468725332623414" data-draft-id="7585400495684321322" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è§£æ„ JavaScript è¿­ä»£å™¨ï¼šä¸€è¡Œä»£ç å¼•å‘çš„æ€§èƒ½æ€è€ƒ"/> <meta itemprop="keywords" content="JavaScript,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2025-12-20T11:40:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SakuraOnTheWay"/> <meta itemprop="url" content="https://juejin.cn/user/3035112839343709"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è§£æ„ JavaScript è¿­ä»£å™¨ï¼šä¸€è¡Œä»£ç å¼•å‘çš„æ€§èƒ½æ€è€ƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3035112839343709/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SakuraOnTheWay
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T11:40:34.000Z" title="Sat Dec 20 2025 11:40:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€ï¼šä¸€è¡Œä»£ç å¼•å‘çš„æ€è€ƒ</h2>
<p>ä»Šå¤©åœ¨åˆ· LeetCode <a href="https://link.juejin.cn?target=https%3A%2F%2Fleetcode.cn%2Fproblems%2Flru-cache%2Fdescription%2F%3FenvType%3Dstudy-plan-v2%26envId%3Dtop-100-liked" target="_blank" title="https://leetcode.cn/problems/lru-cache/description/?envType=study-plan-v2&amp;envId=top-100-liked" ref="nofollow noopener noreferrer"><strong>146. LRU ç¼“å­˜æœºåˆ¶</strong></a> æ—¶ï¼Œæˆ‘é‡åˆ°äº†ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„éœ€æ±‚ï¼š<strong>åœ¨ JavaScript çš„ Map ä¸­ï¼Œå¦‚ä½•ä»¥ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span> çš„æ—¶é—´å¤æ‚åº¦æ‹¿åˆ°æœ€æ—©æ’å…¥çš„é‚£ä¸ª Keyï¼Ÿ</strong></p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒES6 çš„ <code>Map</code> æ˜¯æœ‰åºçš„ï¼ˆæŒ‰æ’å…¥é¡ºåºï¼‰ã€‚æˆ‘çš„ç¬¬ä¸€ååº”æ˜¯è¿™æ ·å†™ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// âŒ å¸¸è§å†™æ³• </span>
<span class="hljs-comment">// ä¸ºäº†æ‹¿ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ŒæŠŠæ•´ä¸ª Map éå†ä¸€éè½¬æˆæ•°ç»„ </span>
<span class="hljs-keyword">const</span> keys = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(map.<span class="hljs-title function_">keys</span>()); 
<span class="hljs-keyword">const</span> firstKey = keys[<span class="hljs-number">0</span>];
</code></pre>
<p>å¦‚æœ Map é‡Œå­˜äº† 100 ä¸‡æ¡æ•°æ®ï¼Œè¿™è¡Œä»£ç æ„å‘³ç€è¦å¼€è¾Ÿä¸€ä¸ªå­˜ 100 ä¸‡å…ƒç´ çš„æ•°ç»„ï¼Œä¸ä»…å†…å­˜é£™å‡ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿå˜æˆäº† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></span>ã€‚è¿™åœ¨é«˜æ€§èƒ½è¦æ±‚çš„ LRU ç®—æ³•é‡Œæ˜¯ä¸å¯æ¥å—çš„ã€‚</p>
<p>åæ¥æˆ‘çœ‹åˆ°äº†ä¸€ç§â€œæå®¢â€å†™æ³•ï¼Œç›´æ¥æŠŠå¤æ‚åº¦é™åˆ°äº† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// âœ… é«˜æ‰‹å†™æ³• </span>
<span class="hljs-keyword">const</span> firstKey = map.<span class="hljs-title function_">keys</span>().<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>;
</code></pre>
<p>è¿™è¡Œä»£ç é‡Œçš„ <code>.next()</code> åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆå®ƒèƒ½ç²¾å‡†åœ°â€œåªå–ä¸€ä¸ªâ€ï¼Ÿ</p>
<p>è¿™å°±è§¦åŠåˆ°äº† JavaScript ä¸­ä¸€ä¸ªå¹³æ—¶å®¹æ˜“è¢«å¿½ç•¥ï¼Œä½†æå…¶å¼ºå¤§çš„æ¦‚å¿µâ€”â€”<strong>è¿­ä»£å™¨åè®® (Iterator Protocol)</strong> ã€‚</p>
<h2 data-id="heading-1">ä»€ä¹ˆæ˜¯è¿­ä»£å™¨ï¼Ÿ</h2>
<p>åœ¨ã€ŠJavaScript é«˜çº§ç¨‹åºè®¾è®¡ã€‹ä¸­ï¼Œå¯¹è¿­ä»£å™¨çš„å®šä¹‰æ¯”è¾ƒæ™¦æ¶©ã€‚å…¶å®åœ¨å·¥ç¨‹å®è·µä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦ç†è§£ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š <strong>â€œå·¥å‚â€</strong> å’Œ <strong>â€œå·¥äººâ€</strong> ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad18ea1448364c25a06728f5fe735601~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2FrdXJhT25UaGVXYXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835634&amp;x-signature=CDvqFwWvQf7VJ%2BjJqmGIZnJrtv0%3D" alt="æˆªå±2025-12-20 19.00.43.png" loading="lazy"/></p>
<h3 data-id="heading-2">å¯è¿­ä»£å¯¹è±¡ (Iterable) â€”â€” â€œå·¥å‚â€</h3>
<p>åªè¦ä¸€ä¸ªå¯¹è±¡å®ç°äº† <code>[Symbol.iterator]</code> æ¥å£ï¼Œå®ƒå°±æ˜¯â€œå¯è¿­ä»£çš„â€ã€‚ è¿™æ„å‘³ç€ï¼Œé™¤äº†æœ¬èº«çš„å­˜å‚¨åŠŸèƒ½å¤–ï¼Œ<strong>å®ƒè¿˜é¢å¤–æ‰¿æ‹…äº†ä¸€é¡¹èŒè´£ï¼šå®šä¹‰å¦‚ä½•ç”Ÿäº§ä¸€ä¸ªè¿­ä»£å™¨ã€‚</strong> å½“æˆ‘ä»¬éœ€è¦éå†å®ƒæ—¶ï¼Œå°±æ˜¯è°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œæ´¾å‡ºä¸€ä¸ªâ€œå·¥äººâ€æ¥ã€‚</p>
<ul>
<li><strong>è°æ˜¯å·¥å‚ï¼Ÿ</strong> <code>Array</code>, <code>Map</code>, <code>Set</code>, <code>String</code>, <code>NodeList</code> ç­‰ã€‚</li>
<li><strong>æ€ä¹ˆç”Ÿäº§ï¼Ÿ</strong> <code>const iterator = map.keys()</code> (è¿™é‡Œ <code>keys()</code> æ–¹æ³•åº•å±‚å°±è°ƒç”¨äº†å·¥å‚æ–¹æ³•)ã€‚</li>
</ul>
<h3 data-id="heading-3">è¿­ä»£å™¨ (Iterator) â€”â€” â€œå·¥äººâ€</h3>
<p>è¿™å°±æ˜¯ä¸Šé¢ç”Ÿæˆçš„é‚£ä¸ªå¯¹è±¡ã€‚å®ƒåƒä¸€ä¸ª<strong>æ¸¸æ ‡ (Cursor)</strong> ï¼Œç”¨æ¥éå†æ•°æ®ã€‚å®ƒå¿…é¡»æœ‰ä¸€ä¸ª <code>next()</code> æ–¹æ³•ã€‚</p>
<ul>
<li>
<p><strong>æ€ä¹ˆå·¥ä½œï¼Ÿ</strong> æ¯æ¬¡è°ƒç”¨ <code>.next()</code>ï¼Œå·¥äººå°±ä¼šå¾€åèµ°ä¸€æ­¥ï¼Œå¹¶æ±‡æŠ¥å½“å‰çš„æƒ…å†µã€‚</p>
</li>
<li>
<p><strong>æ±‡æŠ¥æ ¼å¼</strong>ï¼š<code>{ value: å½“å‰å€¼, done: æ˜¯å¦ç»“æŸ }</code>ã€‚</p>
</li>
</ul>
<h3 data-id="heading-4">å›åˆ°å¼€å¤´çš„ä»£ç </h3>
<ul>
<li><code>map.keys()</code>å·²ç»æŒ‡æ´¾äº†ä¸€åå·¥äººç«™åœ¨ä¼ åŠ¨å¸¦çš„èµ·å§‹ä½ç½®ï¼Œè¿™æ˜¯<strong>ç¬é—´å®Œæˆ (<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>)</strong> çš„ï¼Œå› ä¸ºä¸ç®¡ä»“åº“é‡Œæœ‰ 10 ä¸ªè´§è¿˜æ˜¯ 100 ä¸‡ä¸ªè´§ï¼Œ<strong>æ´¾ä¸€ä¸ªäººè¿‡å»</strong>è¿™ä¸ªåŠ¨ä½œçš„æ—¶é—´æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚æ­¤æ—¶ï¼Œå·¥äººæ‰‹é‡Œæ˜¯ç©ºçš„ï¼Œè´§ç‰©ä¹Ÿè¿˜åœ¨ä¼ é€å¸¦ä¸Šï¼Œä»€ä¹ˆèµ„æºéƒ½æ²¡æµªè´¹ã€‚</li>
<li><code>Array.from(map.keys())</code>åƒæ˜¯æš´åŠ›æ¬ä»“ï¼Œâ€œå…ˆæŠŠä¼ é€å¸¦ä¸Šè¿™ 100 ä¸‡ä¸ªè´§ç‰©ï¼Œå…¨éƒ¨æ¬ä¸‹æ¥ï¼ŒæŒ‰é¡ºåºè£…åˆ°è¾†æ–°å¡è½¦ï¼ˆArrayï¼‰ä¸Šå»ï¼â€è¿™éœ€è¦åŠ¨ç”¨å¤§é‡äººåŠ›ï¼ˆCPU ç®—åŠ›ï¼‰ï¼Œéœ€è¦ä¸€è¾†å·¨å¤§çš„å¡è½¦æ¥è£…è´§ï¼ˆå†…å­˜æš´æ¶¨ï¼‰ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œ<strong>åœ¨æ¬å®Œæœ€åä¸€ä¸ªè´§ç‰©ä¹‹å‰ï¼Œä½ è¿ç¬¬ä¸€ä¸ªè´§ç‰©éƒ½æ‹¿ä¸åˆ°</strong>ï¼Œè¿™å°±å«é˜»å¡ã€‚<strong>æ—¶é—´å¤æ‚åº¦</strong>ï¼š<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></span>ï¼Œè´§ç‰©è¶Šå¤šï¼Œæ¬çš„æ—¶é—´è¶Šé•¿ã€‚</li>
<li><code>.next()</code>å°±åƒæ˜¯ç»™å·¥äººä¸‹è¾¾äº†ä¸€ä¸ªå‘½ä»¤ï¼šâ€œæŠŠä½ çœ¼å‰çš„è´§ç‰©æ‹¿ç»™æˆ‘â€ï¼Œå·¥äººæŠŠå½“å‰çš„valueç»™ä½ ï¼Œç„¶åå‘åèµ°äº†ä¸€æ­¥ã€‚å¦‚æœä¸ç»§ç»­æ‰§è¡Œ<code>.next()</code>ï¼Œé‚£å·¥äººå°±ä¸ä¼šç»§ç»­æ‰§è¡Œï¼Œä¸æµªè´¹èµ„æºã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4039a47a0c244a8b98e458bc5f8b0bcf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2FrdXJhT25UaGVXYXk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835634&amp;x-signature=af62ufiNBhb2%2B63hY%2BdtTmkgOFg%3D" alt="æˆªå±2025-12-20 19.02.37.png" loading="lazy"/></p>
<p>è¿™å°±æ˜¯<strong>æƒ°æ€§æ±‚å€¼ (Lazy Evaluation)</strong> çš„é­…åŠ›ï¼š<strong>æˆ‘ä¸éœ€è¦çŸ¥é“åé¢è¿˜æœ‰å¤šå°‘æ•°æ®ï¼Œæˆ‘åªéœ€è¦è¿ˆå‡ºç¬¬ä¸€æ­¥ã€‚</strong></p>
<h2 data-id="heading-5">å®æˆ˜ï¼šè®©è‡ªå®šä¹‰å¯¹è±¡æ”¯æŒ <code>for...of</code></h2>
<p>ç†è§£äº†åŸç†ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ€ä¹ˆç”¨ã€‚</p>
<p>å¹³æ—¶æˆ‘ä»¬èƒ½ç”¨ <code>for...of</code> éå†æ•°ç»„ï¼Œæ˜¯å› ä¸ºæ•°ç»„å†…ç½®äº†è¿­ä»£å™¨ã€‚å¦‚æœæˆ‘ä»¬è‡ªå·±å†™ä¸€ä¸ª <code>Class</code>ï¼Œæ€ä¹ˆè®©å®ƒä¹Ÿèƒ½è¢«éå†å‘¢ï¼Ÿ</p>
<p>å‡è®¾æˆ‘ä»¬è¦ç®¡ç†ä¸€ä¸ªâ€œå¼€å‘å°ç»„â€ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Team</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">members</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">members</span> = members;
  }

  <span class="hljs-comment">// 1. éƒ¨ç½² [Symbol.iterator] æ¥å£</span>
  [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]() {
    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// 2. è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼ˆå¿…é¡»æœ‰ next æ–¹æ³•ï¼‰</span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-comment">// ä½¿ç”¨ç®­å¤´å‡½æ•°é”å®š this</span>
      <span class="hljs-attr">next</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (index &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">members</span>.<span class="hljs-property">length</span>) {
          <span class="hljs-comment">// 3. è¿˜æœ‰æ•°æ®ï¼Œè¿”å› value å’Œ done: false</span>
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">members</span>[index++], <span class="hljs-attr">done</span>: <span class="hljs-literal">false</span> };
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// 4. æ²¡æ•°æ®äº†ï¼Œè¿”å› done: true</span>
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">value</span>: <span class="hljs-literal">undefined</span>, <span class="hljs-attr">done</span>: <span class="hljs-literal">true</span> };
        }
      }
    };
  }
}

<span class="hljs-comment">// æµ‹è¯•ä¸€ä¸‹</span>
<span class="hljs-keyword">const</span> myTeam = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Team</span>([<span class="hljs-string">'Alice'</span>, <span class="hljs-string">'Bob'</span>, <span class="hljs-string">'Charlie'</span>]);

<span class="hljs-comment">// æˆåŠŸï¼è‡ªå®šä¹‰å¯¹è±¡æ”¯æŒ for...of äº†</span>
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> member <span class="hljs-keyword">of</span> myTeam) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(member); 
}
<span class="hljs-comment">// è¾“å‡º: Alice, Bob, Charlie</span>
</code></pre>
<h2 data-id="heading-6">è¿›é˜¶ï¼šç”Ÿæˆå™¨ (Generator)</h2>
<p>æ‰‹åŠ¨å†™ <code>next()</code> å’Œç»´æŠ¤ <code>index</code> çŠ¶æ€å¤ªéº»çƒ¦äº†ï¼ŸES6 æä¾›äº†ä¸€ä¸ªç‹ç‚¸è¯­æ³•ï¼š<strong>ç”Ÿæˆå™¨å‡½æ•° (<code>function*</code>)</strong> ã€‚</p>
<p>å®ƒè®©å‡½æ•°å˜æˆäº†â€œå¯ä»¥æš‚åœâ€çš„è¿­ä»£å™¨ã€‚ç”¨ <code>yield</code> å…³é”®å­—ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ä»£ç ç®€åŒ–æˆè¿™æ ·ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Team</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">members</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">members</span> = members;
  }

  <span class="hljs-comment">// * è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å·¥å‚</span>
  *[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]() {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> member <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">members</span>) {
      <span class="hljs-comment">// yield ä¼šæš‚åœå‡½æ•°æ‰§è¡Œï¼ŒæŠŠå€¼â€œåâ€ç»™å¤–éƒ¨</span>
      <span class="hljs-comment">// ä¸‹æ¬¡å†è°ƒ next() æ—¶ï¼Œä»è¿™é‡Œç»§ç»­</span>
      <span class="hljs-keyword">yield</span> member; 
    }
  }
}
</code></pre>
<p>ä»£ç é‡å‡å°‘äº†ä¸€åŠï¼Œé€»è¾‘å´æ›´åŠ æ¸…æ™°ã€‚</p>
<h2 data-id="heading-7">ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å…³æ³¨è¿­ä»£å™¨ï¼Ÿ</h2>
<p>é™¤äº†åœ¨ LRU ç®—æ³•ä¸­åšæ€§èƒ½ä¼˜åŒ–ï¼Œè¿­ä»£å™¨è¿˜æœ‰å¾ˆå¤šåº”ç”¨åœºæ™¯ï¼š</p>
<h3 data-id="heading-8">A. å¤„ç†æ— é™åºåˆ—</h3>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦ä¸€ä¸ªæ— é™è‡ªå¢çš„ ID ç”Ÿæˆå™¨ï¼Œç”¨æ•°ç»„å­˜æ˜¾ç„¶ä¼šå†…å­˜æº¢å‡ºã€‚ä½†ç”¨è¿­ä»£å™¨ï¼Œ<strong>ç”¨ä¸€ä¸ªç”Ÿæˆä¸€ä¸ª</strong>ï¼Œå†…å­˜å ç”¨æ°¸è¿œæ˜¯ <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span>* <span class="hljs-title function_">generateId</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> id = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">yield</span> id++ <span class="hljs-comment">// å…ˆåå€¼ï¼Œå†åŠ 1</span>
    }
}

<span class="hljs-keyword">const</span> gen = <span class="hljs-title function_">generateId</span>()
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gen.<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>) <span class="hljs-comment">// 0</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(gen.<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>) <span class="hljs-comment">// 1</span>
</code></pre>
<h3 data-id="heading-9">B. æŒæ§æµ·é‡æ•°æ®ï¼šNode.js æµä¸å¼‚æ­¥è¿­ä»£</h3>
<p>åœ¨å¤„ç†è¶…å¤§æ–‡ä»¶ï¼ˆGB çº§åˆ«ï¼‰æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸€æ¬¡æ€§ readFile åˆ°å†…å­˜ã€‚Node.js çš„ Stream (æµ) æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ç§å¼‚æ­¥è¿­ä»£å™¨ï¼Œè¯»ä¸€è¡Œï¼Œå¤„ç†ä¸€è¡Œï¼Œæ‰”æ‰ä¸€è¡Œ ã€‚ä¸ºäº†è®²æ¸…æ¥šï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼š<strong>å¼‚æ­¥è¿­ä»£å™¨ (Async Iterator)</strong></p>
<p>æƒ³è±¡ä½ æœ‰ä¸€å°åªæœ‰ <strong>8GB å†…å­˜</strong>çš„æœåŠ¡å™¨ã€‚ ç°åœ¨ä½ è¦å¤„ç†ä¸€ä¸ª <strong>20GB çš„æ—¥å¿—æ–‡ä»¶</strong>ï¼ˆæ¯”å¦‚åˆ†æè®¿é—®é‡ï¼‰ã€‚</p>
<h4 data-id="heading-10">âŒ ä¼ ç»Ÿåšæ³•ï¼š<code>fs.readFile</code> (åŠæ—©æ±‚å€¼)</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// è¯•å›¾æŠŠ 20GB çš„æ–‡ä»¶ä¸€æ¬¡æ€§è¯»å…¥ 8GB çš„å†…å­˜</span>
<span class="hljs-comment">// ç»“æœï¼šError: heap out of memory (ç¨‹åºå´©æºƒ)</span>
<span class="hljs-keyword">const</span> data = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'./big.log'</span>); 

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-title function_">toString</span>());
</code></pre>
<h4 data-id="heading-11">âœ…æµå¼åšæ³•ï¼šStream (æƒ°æ€§æ±‚å€¼)</h4>
<p>Node.js çš„ Stream æ¨¡å—ï¼Œåˆ©ç”¨äº†è¿­ä»£å™¨çš„æ€æƒ³ï¼š <strong>æˆ‘ä¸å…³å¿ƒæ–‡ä»¶æœ‰å¤šå¤§ï¼Œæˆ‘åªå…³å¿ƒè¿™ä¸€å£ï¼ˆChunkï¼‰ã€‚</strong></p>
<h4 data-id="heading-12">æŠ€æœ¯åŸç†ï¼šä» Iterator åˆ° Async Iterator</h4>
<p>æˆ‘ä»¬åœ¨å‰å‡ èŠ‚è®²çš„è¿­ä»£å™¨æ˜¯<strong>åŒæ­¥</strong>çš„ï¼š</p>
<ul>
<li><code>iterator.next()</code> -&gt; ç«‹é©¬è¿”å› <code>{ value, done }</code>ã€‚</li>
</ul>
<p>ä½†åœ¨æ–‡ä»¶è¯»å–ä¸­ï¼Œç¡¬ç›˜è¯»å–é€Ÿåº¦æ…¢ï¼Œæ•°æ®ä¸æ˜¯ç«‹é©¬å°±æœ‰çš„ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦<strong>å¼‚æ­¥è¿­ä»£å™¨</strong>ï¼š</p>
<ul>
<li><strong>Symbol</strong>: <code>[Symbol.asyncIterator]</code></li>
<li><strong>åŠ¨ä½œ</strong>: <code>iterator.next()</code> -&gt; è¿”å›ä¸€ä¸ª <strong>Promise</strong>ï¼Œè§£æåæ‰æ˜¯ <code>{ value, done }</code>ã€‚</li>
<li><strong>è¯­æ³•</strong>: <code>for await (const chunk of stream)</code></li>
</ul>
<h4 data-id="heading-13">å¤„ç† 20GB æ–‡ä»¶åªéœ€ 64KB å†…å­˜</h4>
<p>æˆ‘ä»¬éœ€è¦ç”¨åˆ° Node.js çš„ <code>readline</code> æ¨¡å—ï¼Œå®ƒå°è£…äº† Streamï¼Œè®©æˆ‘ä»¬å¯ä»¥<strong>æŒ‰è¡Œ</strong>è¿­ä»£ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> readline = <span class="hljs-built_in">require</span>(<span class="hljs-string">'readline'</span>);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">processBigFile</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 1. åˆ›å»ºä¸€ä¸ªæµï¼Œæ¥åœ¨æ–‡ä»¶ä¸Š</span>
  <span class="hljs-keyword">const</span> fileStream = fs.<span class="hljs-title function_">createReadStream</span>(<span class="hljs-string">'./20gb_server.log'</span>);

  <span class="hljs-comment">// 2. åˆ›å»ºä¸€ä¸ªé€è¡Œè¯»å–æ¥å£ï¼ˆè¿™æ˜¯ä¸ªå¼‚æ­¥å¯è¿­ä»£å¯¹è±¡ï¼‰</span>
  <span class="hljs-keyword">const</span> rl = readline.<span class="hljs-title function_">createInterface</span>({
    <span class="hljs-attr">input</span>: fileStream,
    <span class="hljs-attr">crlfDelay</span>: <span class="hljs-title class_">Infinity</span>
  });

  <span class="hljs-comment">// 3. å¼€å§‹æ‰§è¡Œ</span>
  <span class="hljs-comment">// è¿™é‡Œçš„ for await...of å°±æ˜¯å¼‚æ­¥è¿­ä»£å™¨çš„è¯­æ³•ç³–</span>
  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> line <span class="hljs-keyword">of</span> rl) {
    <span class="hljs-comment">// åœ¨è¿™ä¸€åˆ»ï¼Œå†…å­˜é‡Œåªæœ‰è¿™ä¸€è¡Œå­—ç¬¦ä¸²ï¼</span>
    <span class="hljs-comment">// ä¸Šä¸€è¡Œå·²ç»è¢«åƒåœ¾å›æ”¶(GC)äº†ï¼Œä¸‹ä¸€è¡Œè¿˜åœ¨ç¡¬ç›˜é‡Œã€‚</span>
    
    <span class="hljs-keyword">if</span> (line.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'ERROR'</span>)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ‰¾åˆ°é”™è¯¯:'</span>, line);
    }
    
    <span class="hljs-comment">// è¿™ä¸€è¡Œå¤„ç†å®Œï¼Œç«‹é©¬æ‰”æ‰ï¼Œé‡Šæ”¾å†…å­˜</span>
  }
}

<span class="hljs-title function_">processBigFile</span>();
</code></pre>
<h2 data-id="heading-14">æ€»ç»“ï¼šåœ¨çµæ´»æ€§ä¸æ€§èƒ½ä¹‹é—´å¯»æ‰¾å¹³è¡¡</h2>
<p>å›åˆ°æ–‡ç« å¼€å¤´çš„é‚£ä¸ª LRU ç®—æ³•é¢˜ï¼Œä¸€è¡Œç®€å•çš„ <code>.next().value</code> èƒŒåï¼Œå…¶å®è—ç€ JavaScript è¯­è¨€è®¾è®¡çš„å“²å­¦ã€‚</p>
<p>é€šè¿‡è¿™æ¬¡å¯¹è¿­ä»£å™¨åè®®çš„æ·±æŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸¤ä¸ªçœ‹ä¼¼çŸ›ç›¾ã€å®åˆ™ç»Ÿä¸€çš„ç»“è®ºï¼š</p>
<h3 data-id="heading-15">JavaScript çš„ä¸Šé™æé«˜</h3>
<p>å¾ˆå¤šå¼€å‘è€…è®¤ä¸º JS åªæ˜¯è„šæœ¬è¯­è¨€ï¼Œç¼ºä¹åº•å±‚æ§åˆ¶åŠ›ã€‚ä½†è¿­ä»£å™¨åè®®å‘æˆ‘ä»¬å±•ç¤ºäº† JS <strong>ç¡¬æ ¸</strong>çš„ä¸€é¢ï¼š</p>
<ul>
<li>å®ƒèµ‹äºˆäº†æˆ‘ä»¬<strong>æ‰‹åŠ¨æ§åˆ¶å†…å­˜å’Œ CPU</strong> çš„èƒ½åŠ›ï¼ˆæƒ°æ€§æ±‚å€¼ï¼‰ã€‚</li>
<li>å®ƒè®©æˆ‘ä»¬å¯ä»¥åƒ C++ æŒ‡é’ˆä¸€æ ·ç²¾å‡†æ“ä½œæ•°æ®ï¼Œä¹Ÿå¯ä»¥åƒ Haskell ä¸€æ ·å¤„ç†æ— é™åºåˆ—ã€‚</li>
<li>ä»ç®€å•çš„æ•°ç»„éå†ï¼Œåˆ° Node.js å¤„ç† TB çº§æ–‡ä»¶çš„ Streamï¼Œè¿­ä»£å™¨è´¯ç©¿å§‹ç»ˆï¼Œæ”¯æ’‘èµ·äº† JS å¤„ç†å¤æ‚å·¥ç¨‹é—®é¢˜çš„éª¨æ¶ã€‚</li>
</ul>
<h3 data-id="heading-16">çµæ´»æ€§çš„ä»£ä»·</h3>
<h4 data-id="heading-17">1. éšå½¢æ€æ‰‹ï¼šè¯­æ³•ç³–èƒŒåçš„å¼€é”€</h4>
<p><code>Array.from(map.keys()</code>æˆ–è€…<code>[...map.keys]</code> å†™èµ·æ¥æ¯” <code>map.keys().next()</code> ä¼˜é›…å¾—å¤šï¼Œä½†å®ƒæ‚„æ— å£°æ¯åœ°å¼•å…¥äº† <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>O</mi><mo stretchy="false">(</mo><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">O(N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></span> çš„æ—¶ç©ºå¤æ‚åº¦ã€‚JS å¼•æ“å¤ªèªæ˜äº†ï¼Œå¸®æˆ‘ä»¬å¤„ç†äº†å¤ªå¤šäº‹æƒ…ï¼Œä»¥è‡³äºæˆ‘ä»¬å®¹æ˜“å¿˜è®°ï¼š<strong>æ¯ä¸€è¡Œä¼˜é›…çš„ä»£ç èƒŒåï¼Œéƒ½æœ‰ CPU åœ¨è´Ÿé‡å‰è¡Œã€‚</strong></p>
<h4 data-id="heading-18">2. ç¦åŒºï¼šä¸è¦è§¦ç¢°åŸå‹é“¾</h4>
<p>å­¦ä¼šäº† <code>Symbol.iterator</code> åï¼Œå¾ˆå¤šäººä¼šäº§ç”Ÿä¸€ç§å±é™©çš„å†²åŠ¨ï¼š</p>
<p>â€œæ—¢ç„¶ Object ä¸èƒ½éå†ï¼Œé‚£æˆ‘ç›´æ¥ç»™ <code>Object.prototype</code> åŠ ä¸Šä¸€ä¸ªè¿­ä»£å™¨æ¥å£ä¸å°±è¡Œäº†ï¼Ÿâ€</p>
<p><strong>åƒä¸‡ä¸è¦è¿™æ ·åšï¼</strong></p>
<p><strong>JavaScript ç»™äº†ä½ ä¿®æ”¹ä¸–ç•Œçš„èƒ½åŠ›ï¼Œä½†ä¼˜ç§€çš„å·¥ç¨‹å¸ˆæ‡‚å¾—å…‹åˆ¶ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VUEåå°ç®¡ç†ç³»ç»Ÿï¼šé¡¹ç›®æ¶æ„ä¹‹æ­å»ºLayoutæ¶æ„è§£å†³æ–¹æ¡ˆä¸å®ç°]]></title>    <link>https://juejin.cn/post/7585476892976037922</link>    <guid>https://juejin.cn/post/7585476892976037922</guid>    <pubDate>2025-12-20T11:54:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585476892976037922" data-draft-id="7575162322240847872" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VUEåå°ç®¡ç†ç³»ç»Ÿï¼šé¡¹ç›®æ¶æ„ä¹‹æ­å»ºLayoutæ¶æ„è§£å†³æ–¹æ¡ˆä¸å®ç°"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-20T11:54:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é»˜æµ·ç¬‘"/> <meta itemprop="url" content="https://juejin.cn/user/3246223221632151"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VUEåå°ç®¡ç†ç³»ç»Ÿï¼šé¡¹ç›®æ¶æ„ä¹‹æ­å»ºLayoutæ¶æ„è§£å†³æ–¹æ¡ˆä¸å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3246223221632151/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é»˜æµ·ç¬‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T11:54:49.000Z" title="Sat Dec 20 2025 11:54:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ•ˆæœå®ç°å›¾</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e55ec96fd1e14b9da6f5a5e7b8815350~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buY5rW356yR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766836489&amp;x-signature=HSOhJYsnqUbX1oVaUnggOCO%2B2jc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">æ–‡ä»¶ç»“æ„å¸ƒå±€</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d98d4584592442559f887840d717350f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buY5rW356yR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766836489&amp;x-signature=TFrwiTkMhnKypBVdLiO9iXYtOS0%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ff57bdc9f5343278f594c24cc74e3a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6buY5rW356yR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766836489&amp;x-signature=krsn%2BhOv5IDJ2nBHo19zoE6748A%3D" alt="image.png" loading="lazy"/>
åœ¨è¿™å¼ å›¾ä¸­ï¼Œæˆ‘ä»¬æŠŠé¡µé¢åˆ†ä¸ºäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ol>
<li>å·¦ä¾§çš„ <code>Menu</code> èœå•</li>
<li>é¡¶éƒ¨çš„ <code>NavBar</code></li>
<li>ä¸­é—´çš„å†…å®¹åŒº <code>Main</code></li>
</ol>
<p>æœ¬ç« ä¸­æˆ‘ä»¬å°†ä¼šå®ç°ä»¥ä¸‹çš„æ ¸å¿ƒè§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>ç”¨æˆ·é€€å‡ºæ–¹æ¡ˆ</li>
<li>åŠ¨æ€ä¾§è¾¹æ æ–¹æ¡ˆ</li>
<li>åŠ¨æ€é¢åŒ…å±‘æ–¹æ¡ˆ</li>
</ol>
<p>é™¤äº†è¿™äº›æ ¸å¿ƒå†…å®¹ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„å°åŠŸèƒ½ï¼Œæ¯”å¦‚ï¼š</p>
<ol>
<li>é€€å‡ºçš„é€šç”¨é€»è¾‘å°è£…</li>
<li>ä¼¸ç¼©ä¾§è¾¹æ åŠ¨ç”»</li>
<li><code>vue3</code> åŠ¨ç”»</li>
<li>ç»„ä»¶çŠ¶æ€é©±åŠ¨çš„åŠ¨æ€ <code>CSS</code> å€¼ç­‰ç­‰</li>
</ol>
<p>æ¢å¥è¯è€Œè¨€ï¼ŒæŒæ¡äº†æœ¬ç« ä¸­çš„å†…å®¹ä¹‹åï¼Œåå°é¡¹ç›®çš„é€šç”¨ <code>Layout</code> å¤„ç†ï¼Œå¯¹äºæ¥è¯´å°†å˜å¾—å°èœä¸€ç¢Ÿï¼</p>
<h5 data-id="heading-2">1. æ•´ä¸ªé¡µé¢åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå»åˆ›å»ºå¯¹åº”çš„ä¸‰ä¸ªç»„ä»¶ï¼š</h5>
<ol>
<li><code>layout/components/Sidebar/index.vue</code></li>
<li><code>layout/components/Navbar.vue</code></li>
<li><code>layout/components/AppMain.vue</code></li>
</ol>
<h5 data-id="heading-3">2. ç„¶ååœ¨ <code>layout/index.vue</code> ä¸­å¼•å…¥è¿™ä¸‰ä¸ªç»„ä»¶</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup&gt;
    import Navbar from './components/Navbar'
    import Sidebar from './components/Sidebar'
    import AppMain from './components/AppMain'
&lt;/script&gt;
</code></pre>
<h5 data-id="heading-4">3. å®Œæˆå¯¹åº”çš„å¸ƒå±€ç»“æ„</h5>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="app-wrapper"&gt;
    &lt;!-- å·¦ä¾§ menu --&gt;
    &lt;sidebar
      id="guide-sidebar"
      class="sidebar-container"
    /&gt;
    &lt;div class="main-container"&gt;
      &lt;div class="fixed-header"&gt;
        &lt;!-- é¡¶éƒ¨çš„ navbar --&gt;
        &lt;navbar /&gt;
      &lt;/div&gt;
      &lt;!-- å†…å®¹åŒº --&gt;
      &lt;app-main /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
</code></pre>
<h5 data-id="heading-5">4. åœ¨ <code>styles</code> ä¸­åˆ›å»ºå¦‚ä¸‹ <code>css</code> æ–‡ä»¶ï¼š</h5>
<ol>
<li><code>variables.scss</code> ï¼š å®šä¹‰å¸¸é‡</li>
<li><code>mixin.scss</code> ï¼šå®šä¹‰é€šç”¨çš„ <code>css</code></li>
<li><code>sidebar.scss</code>ï¼šå¤„ç† <code>menu</code> èœå•çš„æ ·å¼</li>
</ol>
<h5 data-id="heading-6">5. ä¸º <code>variables.scss</code> ï¼Œå®šä¹‰å¦‚ä¸‹å¸¸é‡å¹¶è¿›è¡Œå¯¼å‡ºï¼ˆ <code>:export</code> å¯è§ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bluematador.com%2Fblog%2Fhow-to-share-variables-between-js-and-sass" target="_blank" title="https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass" ref="nofollow noopener noreferrer">scss ä¸ js å…±äº«å˜é‡</a>ï¼‰ï¼š</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// sidebar</span>
<span class="hljs-variable">$menuText</span>: <span class="hljs-number">#bfcbd9</span>;
<span class="hljs-variable">$menuActiveText</span>: <span class="hljs-number">#ffffff</span>;
<span class="hljs-variable">$subMenuActiveText</span>: <span class="hljs-number">#f4f4f5</span>;

<span class="hljs-variable">$menuBg</span>: <span class="hljs-number">#304156</span>;
<span class="hljs-variable">$menuHover</span>: <span class="hljs-number">#263445</span>;

<span class="hljs-variable">$subMenuBg</span>: <span class="hljs-number">#1f2d3d</span>;
<span class="hljs-variable">$subMenuHover</span>: <span class="hljs-number">#001528</span>;

<span class="hljs-variable">$sideBarWidth</span>: <span class="hljs-number">210px</span>;

<span class="hljs-comment">// https://www.bluematador.com/blog/how-to-share-variables-between-js-and-sass</span>
<span class="hljs-comment">// JS ä¸ scss å…±äº«å˜é‡ï¼Œåœ¨ scss ä¸­é€šè¿‡ :export è¿›è¡Œå¯¼å‡ºï¼Œåœ¨ js ä¸­å¯é€šè¿‡ ESM è¿›è¡Œå¯¼å…¥</span>
:export {
  menuText: <span class="hljs-variable">$menuText</span>;
  menuActiveText: <span class="hljs-variable">$menuActiveText</span>;
  subMenuActiveText: <span class="hljs-variable">$subMenuActiveText</span>;
  menuBg: <span class="hljs-variable">$menuBg</span>;
  menuHover: <span class="hljs-variable">$menuHover</span>;
  subMenuBg: <span class="hljs-variable">$subMenuBg</span>;
  subMenuHover: <span class="hljs-variable">$subMenuHover</span>;
  sideBarWidth: <span class="hljs-variable">$sideBarWidth</span>;
}

</code></pre>
<h5 data-id="heading-7">6. ä¸º <code>mixin.scss</code> å®šä¹‰å¦‚ä¸‹æ ·å¼ï¼š</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@mixin</span> clearfix {
  &amp;<span class="hljs-selector-pseudo">:after</span> {
    <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
    <span class="hljs-attribute">display</span>: table;
    <span class="hljs-attribute">clear</span>: both;
  }
}

<span class="hljs-keyword">@mixin</span> scrollBar {
  &amp;::-webkit-scrollbar-track-piece {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#d3dce6</span>;
  }

  &amp;::-webkit-scrollbar {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">6px</span>;
  }

  &amp;::-webkit-scrollbar-thumb {
    <span class="hljs-attribute">background</span>: <span class="hljs-number">#99a9bf</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
  }
}

<span class="hljs-keyword">@mixin</span> relative {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
}

</code></pre>
<h5 data-id="heading-8">7. ä¸º <code>sidebar.scss</code> å®šä¹‰å¦‚ä¸‹æ ·å¼ï¼š</h5>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-id">#app</span> {
  <span class="hljs-selector-class">.main-container</span> {
    <span class="hljs-attribute">min-height</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">transition</span>: margin-left <span class="hljs-number">0.28s</span>;
    <span class="hljs-attribute">margin-left</span>: <span class="hljs-variable">$sideBarWidth</span>;
    <span class="hljs-attribute">position</span>: relative;
  }

  <span class="hljs-selector-class">.sidebar-container</span> {
    <span class="hljs-attribute">transition</span>: width <span class="hljs-number">0.28s</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-variable">$sideBarWidth</span> <span class="hljs-meta">!important</span>;
    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
    <span class="hljs-attribute">position</span>: fixed;
    <span class="hljs-attribute">top</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1001</span>;
    <span class="hljs-attribute">overflow</span>: hidden;

    <span class="hljs-comment">// é‡ç½® element-plus çš„css</span>
    <span class="hljs-selector-class">.horizontal-collapse-transition</span> {
      <span class="hljs-attribute">transition</span>: <span class="hljs-number">0s</span> width ease-in-out, <span class="hljs-number">0s</span> padding-left ease-in-out,
        <span class="hljs-number">0s</span> padding-right ease-in-out;
    }

    <span class="hljs-selector-class">.scrollbar-wrapper</span> {
      <span class="hljs-attribute">overflow-x</span>: hidden <span class="hljs-meta">!important</span>;
    }

    <span class="hljs-selector-class">.el-scrollbar__bar</span><span class="hljs-selector-class">.is-vertical</span> {
      <span class="hljs-attribute">right</span>: <span class="hljs-number">0px</span>;
    }

    <span class="hljs-selector-class">.el-scrollbar</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
    }

    &amp;<span class="hljs-selector-class">.has-logo</span> {
      <span class="hljs-selector-class">.el-scrollbar</span> {
        <span class="hljs-attribute">height</span>: <span class="hljs-built_in">calc</span>(<span class="hljs-number">100%</span> - <span class="hljs-number">50px</span>);
      }
    }

    <span class="hljs-selector-class">.is-horizontal</span> {
      <span class="hljs-attribute">display</span>: none;
    }

    <span class="hljs-selector-tag">a</span> {
      <span class="hljs-attribute">display</span>: inline-block;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">overflow</span>: hidden;
    }

    <span class="hljs-selector-class">.svg-icon</span> {
      <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">16px</span>;
    }

    <span class="hljs-selector-class">.sub-el-icon</span> {
      <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">12px</span>;
      <span class="hljs-attribute">margin-left</span>: -<span class="hljs-number">2px</span>;
    }

    <span class="hljs-selector-class">.el-menu</span> {
      <span class="hljs-attribute">border</span>: none;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span> <span class="hljs-meta">!important</span>;
    }

    <span class="hljs-selector-class">.is-active</span> &gt; <span class="hljs-selector-class">.el-submenu__title</span> {
      <span class="hljs-attribute">color</span>: <span class="hljs-variable">$subMenuActiveText</span> <span class="hljs-meta">!important</span>;
    }

    &amp; <span class="hljs-selector-class">.nest-menu</span> <span class="hljs-selector-class">.el-submenu</span> &gt; <span class="hljs-selector-class">.el-submenu__title</span>,
    &amp; <span class="hljs-selector-class">.el-submenu</span> <span class="hljs-selector-class">.el-menu-item</span> {
      <span class="hljs-attribute">min-width</span>: <span class="hljs-variable">$sideBarWidth</span> <span class="hljs-meta">!important</span>;
    }
  }

  <span class="hljs-selector-class">.hideSidebar</span> {
    <span class="hljs-selector-class">.sidebar-container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">54px</span> <span class="hljs-meta">!important</span>;
    }

    <span class="hljs-selector-class">.main-container</span> {
      <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">54px</span>;
    }

    <span class="hljs-selector-class">.submenu-title-noDropdown</span> {
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-meta">!important</span>;
      <span class="hljs-attribute">position</span>: relative;

      <span class="hljs-selector-class">.el-tooltip</span> {
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-meta">!important</span>;

        <span class="hljs-selector-class">.svg-icon</span> {
          <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">20px</span>;
        }

        <span class="hljs-selector-class">.sub-el-icon</span> {
          <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">19px</span>;
        }
      }
    }

    <span class="hljs-selector-class">.el-submenu</span> {
      <span class="hljs-attribute">overflow</span>: hidden;

      &amp; &gt; <span class="hljs-selector-class">.el-submenu__title</span> {
        <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-meta">!important</span>;

        <span class="hljs-selector-class">.svg-icon</span> {
          <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">20px</span>;
        }

        <span class="hljs-selector-class">.sub-el-icon</span> {
          <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">19px</span>;
        }

        <span class="hljs-selector-class">.el-submenu__icon-arrow</span> {
          <span class="hljs-attribute">display</span>: none;
        }
      }
    }

    <span class="hljs-selector-class">.el-menu--collapse</span> {
      <span class="hljs-selector-class">.el-submenu</span> {
        &amp; &gt; <span class="hljs-selector-class">.el-submenu__title</span> {
          &amp; &gt; <span class="hljs-selector-tag">span</span> {
            <span class="hljs-attribute">height</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">width</span>: <span class="hljs-number">0</span>;
            <span class="hljs-attribute">overflow</span>: hidden;
            <span class="hljs-attribute">visibility</span>: hidden;
            <span class="hljs-attribute">display</span>: inline-block;
          }
        }
      }
    }
  }

  <span class="hljs-selector-class">.el-menu--collapse</span> <span class="hljs-selector-class">.el-menu</span> <span class="hljs-selector-class">.el-submenu</span> {
    <span class="hljs-attribute">min-width</span>: <span class="hljs-variable">$sideBarWidth</span> <span class="hljs-meta">!important</span>;
  }

  <span class="hljs-selector-class">.withoutAnimation</span> {
    <span class="hljs-selector-class">.main-container</span>,
    <span class="hljs-selector-class">.sidebar-container</span> {
      <span class="hljs-attribute">transition</span>: none;
    }
  }
}

<span class="hljs-selector-class">.el-menu--vertical</span> {
  &amp; &gt; <span class="hljs-selector-class">.el-menu</span> {
    <span class="hljs-selector-class">.svg-icon</span> {
      <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">16px</span>;
    }
    <span class="hljs-selector-class">.sub-el-icon</span> {
      <span class="hljs-attribute">margin-right</span>: <span class="hljs-number">12px</span>;
      <span class="hljs-attribute">margin-left</span>: -<span class="hljs-number">2px</span>;
    }
  }

  <span class="hljs-comment">// èœå•é¡¹è¿‡é•¿æ—¶</span>
  &gt; <span class="hljs-selector-class">.el-menu--popup</span> {
    <span class="hljs-attribute">max-height</span>: <span class="hljs-number">100vh</span>;
    <span class="hljs-attribute">overflow-y</span>: auto;

    &amp;::-webkit-scrollbar-track-piece {
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#d3dce6</span>;
    }

    &amp;::-webkit-scrollbar {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">6px</span>;
    }

    &amp;::-webkit-scrollbar-thumb {
      <span class="hljs-attribute">background</span>: <span class="hljs-number">#99a9bf</span>;
      <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
    }
  }
}

</code></pre>
<h5 data-id="heading-9">10. å› ä¸ºå°†æ¥è¦å®ç° <strong>ä¸»é¢˜æ›´æ¢</strong>ï¼Œæ‰€ä»¥ä¸º <code>sidebar</code> èµ‹å€¼åŠ¨æ€çš„èƒŒæ™¯é¢œè‰²</h5>
<pre><code class="hljs language-xml" lang="xml">```vue
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
...
    <span class="hljs-comment">&lt;!-- å·¦ä¾§ menu --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">sidebar</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"sidebar-container"</span>
      <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ backgroundColor: variables.menuBg }"</span>
    /&gt;</span>
...
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> variables <span class="hljs-keyword">from</span> <span class="hljs-string">'@/styles/variables.scss'</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
```
</code></pre>
<h5 data-id="heading-10">11. ä¸º <code>Navbar</code>ã€<code>Sidebar</code>ã€<code>AppMain</code> ç»„ä»¶è¿›è¡Œåˆå§‹åŒ–ä»£ç </h5>
<pre><code class="hljs language-xml" lang="xml">```vue
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">""</span>&gt;</span>{ç»„ä»¶å}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> {} <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

```
</code></pre>
<p>ä»£ç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmohaixiao%2Fvue-admin%2Fcommit%2Fe174f35315147a78cc132d61459bca0025e90a24" target="_blank" title="https://github.com/mohaixiao/vue-admin/commit/e174f35315147a78cc132d61459bca0025e90a24" ref="nofollow noopener noreferrer">github.com/mohaixiao/vâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[WebGL çš„æ¸²æŸ“ç®¡é“å’Œç¼–ç¨‹æ¥å£]]></title>    <link>https://juejin.cn/post/7585686247269875721</link>    <guid>https://juejin.cn/post/7585686247269875721</guid>    <pubDate>2025-12-20T12:47:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585686247269875721" data-draft-id="7585484081435885619" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="WebGL çš„æ¸²æŸ“ç®¡é“å’Œç¼–ç¨‹æ¥å£"/> <meta itemprop="keywords" content="å‰ç«¯,WebGL"/> <meta itemprop="datePublished" content="2025-12-20T12:47:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¸©å®‡é£"/> <meta itemprop="url" content="https://juejin.cn/user/4300945219403368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            WebGL çš„æ¸²æŸ“ç®¡é“å’Œç¼–ç¨‹æ¥å£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4300945219403368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¸©å®‡é£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T12:47:15.000Z" title="Sat Dec 20 2025 12:47:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»46åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>WebGL (Web Graphics Library) æ˜¯ä¸€ä¸ªåŸºäº OpenGL ES çš„ Web æ ‡å‡†ï¼Œå®ƒå…è®¸åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œç¡¬ä»¶åŠ é€Ÿçš„å›¾å½¢æ¸²æŸ“ï¼Œå¹¿æ³›åº”ç”¨äºæ¸¸æˆã€æ•°æ®å¯è§†åŒ–ã€CAD ç­‰åœºæ™¯ã€‚æœ¬æ–‡å°†ä»‹ç» WebGL çš„æ¸²æŸ“ç®¡é“å·¥ä½œæµç¨‹ï¼Œä»¥åŠå…¶æä¾›çš„æ ¸å¿ƒç¼–ç¨‹æ¥å£å’Œèƒ½åŠ›ã€‚</p>
<h2 data-id="heading-0">ä» OpenGL åˆ° WebGL</h2>
<p>WebGL æ˜¯ OpenGL ES åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­çš„ JavaScript ç»‘å®šï¼Œä½¿å¾— Web åº”ç”¨èƒ½å¤Ÿé€šè¿‡æ ‡å‡† API è®¿é—® GPU è¿›è¡Œç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“ã€‚</p>
<h3 data-id="heading-1">å¦‚ä½•å°† OpenGL ç¼–è¯‘æˆ WebGL</h3>
<p>Emscripten å¯ä»¥å°† C/C++ çš„ OpenGL ä»£ç ç¼–è¯‘ä¸º WebAssembly + WebGLï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¼–è¯‘ OpenGL C++ ä»£ç ä¸º WebAssembly</span>
emcc main.cpp -o output.html -s USE_WEBGL2=1 -s FULL_ES3=1
</code></pre>
<p>Emscripten çš„å·¥ä½œåŸç†ï¼š</p>
<ul>
<li>å°† C++ ä»£ç ç¼–è¯‘ä¸º WebAssembly (wasm)</li>
<li>è‡ªåŠ¨ç”Ÿæˆ JavaScript èƒ¶æ°´ä»£ç  (glue code)</li>
<li>å°† OpenGL ES è°ƒç”¨è½¬æ¢ä¸º WebGL è°ƒç”¨</li>
<li>å¤„ç†å†…å­˜ç®¡ç†å’ŒæŒ‡é’ˆæ˜ å°„</li>
</ul>
<p>è¿™ç§æ–¹å¼é€‚åˆå°†ç°æœ‰çš„ OpenGL åº”ç”¨å¿«é€Ÿç§»æ¤åˆ° Webã€‚æ›´å¤šç¼–è¯‘é€‰é¡¹å’Œé…ç½®ç»†èŠ‚è¯·å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Femscripten.org%2Fdocs%2Fporting%2Fmultimedia_and_graphics%2FOpenGL-support.html" target="_blank" title="https://emscripten.org/docs/porting/multimedia_and_graphics/OpenGL-support.html" ref="nofollow noopener noreferrer">Emscripten OpenGL æ”¯æŒæ–‡æ¡£</a>ã€‚</p>
<h3 data-id="heading-2">WebGL1 ä¸ WebGL2 çš„åŒºåˆ«</h3>
<p>WebGL1 åŸºäº OpenGL ES 2.0ï¼ŒWebGL2 åŸºäº OpenGL ES 3.0ã€‚ä¸¤è€…çš„æ¸²æŸ“ç®¡é“ç»“æ„ç›¸åŒï¼Œä½† WebGL2 å¢å¼ºäº†ç®¡é“å„é˜¶æ®µçš„èƒ½åŠ›ã€‚ä¸‹è¡¨åˆ—å‡ºäº†ä¸»è¦å·®å¼‚ï¼Œå®Œæ•´çš„åŠŸèƒ½å¯¹æ¯”å’ŒæŠ€æœ¯ç»†èŠ‚è¯·å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.khronos.org%2Fregistry%2Fwebgl%2Fspecs%2Flatest%2F2.0%2F" target="_blank" title="https://www.khronos.org/registry/webgl/specs/latest/2.0/" ref="nofollow noopener noreferrer">WebGL2 è§„èŒƒ</a>ã€‚</p>
<p><strong>æ¸²æŸ“ç®¡é“å¢å¼º</strong></p>






























<table><thead><tr><th>ç®¡é“é˜¶æ®µ</th><th>WebGL1</th><th>WebGL2 æ–°å¢</th></tr></thead><tbody><tr><td>é¡¶ç‚¹å¤„ç†</td><td>é¡¶ç‚¹ç€è‰²å™¨</td><td>Transform Feedbackï¼ˆå¯æ•è·é¡¶ç‚¹æ•°æ®å›ä¼ åˆ°ç¼“å†²åŒºï¼‰</td></tr><tr><td>ç‰‡æ®µå¤„ç†</td><td>å•ä¸€æ¸²æŸ“ç›®æ ‡</td><td>å¤šæ¸²æŸ“ç›®æ ‡ MRTï¼ˆåŒæ—¶è¾“å‡ºåˆ°å¤šä¸ªé¢œè‰²é™„ä»¶ï¼‰</td></tr><tr><td>çº¹ç†é‡‡æ ·</td><td>2D çº¹ç†ã€ç«‹æ–¹ä½“è´´å›¾</td><td>3D çº¹ç†ã€2D çº¹ç†æ•°ç»„ã€é‡‡æ ·å™¨å¯¹è±¡</td></tr><tr><td>ç€è‰²å™¨è¯­è¨€</td><td>GLSL ES 1.00</td><td>GLSL ES 3.00ï¼ˆæ”¯æŒæ•´æ•°è¿ç®—ã€ä½è¿ç®—ã€æ›´å¤šå†…ç½®å‡½æ•°ï¼‰</td></tr></tbody></table>
<p><strong>æ ¸å¿ƒåŠŸèƒ½å¯¹æ¯”</strong></p>













































<table><thead><tr><th>åŠŸèƒ½</th><th>WebGL1</th><th>WebGL2</th></tr></thead><tbody><tr><td>é¡¶ç‚¹æ•°ç»„å¯¹è±¡ (VAO)</td><td>éœ€è¦æ‰©å±• <code>OES_vertex_array_object</code></td><td>åŸç”Ÿæ”¯æŒ</td></tr><tr><td>å®ä¾‹åŒ–æ¸²æŸ“</td><td>éœ€è¦æ‰©å±• <code>ANGLE_instanced_arrays</code></td><td>åŸç”Ÿæ”¯æŒ <code>drawArraysInstanced</code></td></tr><tr><td>å¤šé‡é‡‡æ ·</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ MSAA æŠ—é”¯é½¿</td></tr><tr><td>Uniform ç¼“å†²å¯¹è±¡</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ UBOï¼Œå‡å°‘ Uniform ä¸Šä¼ å¼€é”€</td></tr><tr><td>æ•´æ•°çº¹ç†</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ <code>INT</code>ã€<code>UNSIGNED_INT</code> çº¹ç†æ ¼å¼</td></tr><tr><td>æ·±åº¦çº¹ç†</td><td>éœ€è¦æ‰©å±• <code>WEBGL_depth_texture</code></td><td>åŸç”Ÿæ”¯æŒ</td></tr><tr><td>é 2 æ¬¡å¹‚çº¹ç†</td><td>é™åˆ¶ä¸¥æ ¼ï¼ˆä¸èƒ½ Mipmapã€å¿…é¡» CLAMP_TO_EDGEï¼‰</td><td>å®Œå…¨æ”¯æŒ</td></tr></tbody></table>
<p><strong>æµè§ˆå™¨æ”¯æŒ</strong></p>
<p>WebGL1 åœ¨æ‰€æœ‰ç°ä»£æµè§ˆå™¨ä¸­å‡å¾—åˆ°æ”¯æŒï¼ŒWebGL2 åœ¨å¤§éƒ¨åˆ†ç°ä»£æµè§ˆå™¨ä¸­æ”¯æŒï¼ˆChrome 56+, Firefox 51+, Safari 15+, Edge 79+ï¼‰ï¼ŒiOS Safari åœ¨ 15 ä¹‹å‰ä¸æ”¯æŒã€‚æœ€æ–°çš„æµè§ˆå™¨å…¼å®¹æ€§æ•°æ®è¯·å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcaniuse.com%2Fwebgl" target="_blank" title="https://caniuse.com/webgl" ref="nofollow noopener noreferrer">Can I use WebGL</a> å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcaniuse.com%2Fwebgl2" target="_blank" title="https://caniuse.com/webgl2" ref="nofollow noopener noreferrer">Can I use WebGL2</a>ã€‚</p>
<h3 data-id="heading-3">WebGL ä¸Šä¸‹æ–‡åˆ›å»ºå’Œé…ç½®</h3>
<p>åˆ›å»º WebGL ä¸Šä¸‹æ–‡æ—¶å¯ä»¥é€šè¿‡ <code>WebGLContextAttributes</code> é…ç½®é»˜è®¤å¸§ç¼“å†²ï¼ˆDefault Framebufferï¼‰çš„ç¼“å†²åŒºã€æ€§èƒ½åå¥½ã€æŠ—é”¯é½¿ç­‰é€‰é¡¹ã€‚è¿™äº›é…ç½®åœ¨ä¸Šä¸‹æ–‡åˆ›å»ºåæ— æ³•ä¿®æ”¹ï¼Œå½±å“æ¸²æŸ“ç®¡é“çš„è¡Œä¸ºå’Œæ€§èƒ½ã€‚</p>
<p><strong>æ³¨æ„</strong>ï¼šè¿™äº›é…ç½®åªå½±å“<strong>é»˜è®¤å¸§ç¼“å†²</strong>ï¼ˆç›´æ¥æ¸²æŸ“åˆ° Canvas çš„å¸§ç¼“å†²ï¼‰ï¼Œä¸å½±å“è‡ªå®šä¹‰çš„ FBOï¼ˆé€šè¿‡ <code>createFramebuffer</code> åˆ›å»ºçš„å¸§ç¼“å†²å¯¹è±¡ï¼‰ã€‚è‡ªå®šä¹‰ FBO çš„æ·±åº¦ã€æ¨¡æ¿ã€æŠ—é”¯é½¿ç­‰éœ€è¦å•ç‹¬é…ç½®é™„ä»¶ã€‚</p>
<p><strong>åˆ›å»º WebGL ä¸Šä¸‹æ–‡</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"canvas"</span>);

<span class="hljs-comment">// åˆ›å»º WebGL2 ä¸Šä¸‹æ–‡ï¼Œé…ç½®æ·±åº¦ç¼“å†²å’ŒæŠ—é”¯é½¿</span>
<span class="hljs-keyword">const</span> gl = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"webgl2"</span>, {
  ...<span class="hljs-title class_">WebGLContextAttributes</span>,
});

<span class="hljs-keyword">if</span> (!gl) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"WebGL2 not supported, fallback to WebGL1"</span>);
  gl = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"webgl"</span>, {
    <span class="hljs-comment">/* ... */</span>
  });
}

<span class="hljs-comment">// è·å–å®é™…ä½¿ç”¨çš„ä¸Šä¸‹æ–‡å±æ€§</span>
<span class="hljs-keyword">const</span> attrs = gl.<span class="hljs-title function_">getContextAttributes</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Context attributes:"</span>, attrs);
</code></pre>
<p><strong>WebGLContextAttributes å±æ€§è¯´æ˜</strong>ï¼š</p>













































<table><thead><tr><th>å±æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>alpha</code></td><td>é»˜è®¤å¸§ç¼“å†²æ˜¯å¦åŒ…å« alpha é€šé“ï¼ˆé»˜è®¤ <code>true</code>ï¼‰ã€‚<code>false</code> æ—¶é»˜è®¤å¸§ç¼“å†²èƒŒæ™¯ä¸é€æ˜ï¼Œæ— æ³•ä¸ HTML å…ƒç´ æ··åˆ</td></tr><tr><td><code>depth</code></td><td>é»˜è®¤å¸§ç¼“å†²æ˜¯å¦åˆ›å»ºæ·±åº¦ç¼“å†²åŒºï¼ˆé»˜è®¤ <code>true</code>ï¼‰ã€‚<code>false</code> æ—¶æ— æ³•å¯¹é»˜è®¤å¸§ç¼“å†²æ‰§è¡Œæ·±åº¦æµ‹è¯•ï¼ˆ<code>gl.DEPTH_TEST</code> æ— æ•ˆï¼‰</td></tr><tr><td><code>stencil</code></td><td>é»˜è®¤å¸§ç¼“å†²æ˜¯å¦åˆ›å»ºæ¨¡æ¿ç¼“å†²åŒºï¼ˆé»˜è®¤ <code>false</code>ï¼‰ã€‚<code>false</code> æ—¶æ— æ³•å¯¹é»˜è®¤å¸§ç¼“å†²æ‰§è¡Œæ¨¡æ¿æµ‹è¯•ï¼ˆ<code>gl.STENCIL_TEST</code> æ— æ•ˆï¼‰</td></tr><tr><td><code>antialias</code></td><td>é»˜è®¤å¸§ç¼“å†²æ˜¯å¦å¯ç”¨ MSAA æŠ—é”¯é½¿ï¼ˆé»˜è®¤ <code>true</code>ï¼‰ã€‚å®é™…æŠ—é”¯é½¿æ•ˆæœç”±æµè§ˆå™¨å’Œç¡¬ä»¶å†³å®šï¼Œå¯èƒ½è¢«å¿½ç•¥</td></tr><tr><td><code>premultipliedAlpha</code></td><td>é»˜è®¤å¸§ç¼“å†²çš„ alpha é€šé“æ˜¯å¦é¢„ä¹˜ï¼ˆé»˜è®¤ <code>true</code>ï¼‰ã€‚<code>true</code> æ—¶ç‰‡æ®µç€è‰²å™¨è¾“å‡º <code>(r*a, g*a, b*a, a)</code>ï¼Œ<code>false</code> æ—¶è¾“å‡º <code>(r, g, b, a)</code></td></tr><tr><td><code>preserveDrawingBuffer</code></td><td>é»˜è®¤å¸§ç¼“å†²æ˜¯å¦åœ¨æ¸²æŸ“åä¿ç•™å†…å®¹ï¼ˆé»˜è®¤ <code>false</code>ï¼‰ã€‚<code>false</code> æ—¶æ¯å¸§æ¸²æŸ“åå†…å®¹æœªå®šä¹‰ï¼ˆå¯èƒ½è¢«æ¸…ç©ºï¼‰ï¼Œ<code>true</code> æ—¶å†…å®¹ä¿ç•™åˆ°ä¸‹ä¸€å¸§</td></tr><tr><td><code>powerPreference</code></td><td>GPU é€‰æ‹©åå¥½ï¼ˆé»˜è®¤ <code>default</code>ï¼‰ã€‚å¯é€‰<code>high-performance</code> <code> low-power</code> <code>default </code></td></tr><tr><td><code>failIfMajorPerformanceCaveat</code></td><td>å¦‚æœç³»ç»Ÿæ€§èƒ½è¾ƒå·®ï¼ˆå¦‚ä½¿ç”¨è½¯ä»¶æ¸²æŸ“ï¼‰æ˜¯å¦åˆ›å»ºå¤±è´¥ï¼ˆé»˜è®¤ <code>false</code>ï¼‰ã€‚<code>true</code> æ—¶åœ¨æ£€æµ‹åˆ°æ€§èƒ½é—®é¢˜æ—¶ <code>getContext()</code> è¿”å› <code>null</code></td></tr><tr><td><code>desynchronized</code></td><td>æ˜¯å¦ç¦ç”¨å‚ç›´åŒæ­¥ï¼ˆVSyncï¼‰ï¼ˆé»˜è®¤ <code>false</code>ï¼‰ã€‚<code>true</code> æ—¶æ¸²æŸ“ä¸ç­‰å¾…æ˜¾ç¤ºå™¨åˆ·æ–°ï¼Œå¯é™ä½è¾“å…¥å»¶è¿Ÿä½†å¯èƒ½å¯¼è‡´ç”»é¢æ’•è£‚</td></tr></tbody></table>
<p><strong>å‚è€ƒæ–‡æ¡£</strong>ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FHTMLCanvasElement%2FgetContext" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/getContext" ref="nofollow noopener noreferrer">MDN - HTMLCanvasElement.getContext()</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Femscripten.org%2Fdocs%2Fapi_reference%2Fhtml5.h.html%23c.EmscriptenWebGLContextAttributes" target="_blank" title="https://emscripten.org/docs/api_reference/html5.h.html#c.EmscriptenWebGLContextAttributes" ref="nofollow noopener noreferrer">Emscripten - EmscriptenWebGLContextAttributes</a></li>
</ul>
<h2 data-id="heading-4">æ¸²æŸ“ç®¡é“</h2>
<p>æ¸²æŸ“ç®¡é“ (Rendering Pipeline) æ˜¯ GPU å°†é¡¶ç‚¹æ•°æ®è½¬æ¢ä¸ºå±å¹•åƒç´ çš„å¤„ç†æµç¨‹ã€‚æœ¬ç« åŸºäº Khronos OpenGL å®˜æ–¹æ–‡æ¡£ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwikis.khronos.org%2Fopengl%2FRendering_Pipeline_Overview" target="_blank" title="https://wikis.khronos.org/opengl/Rendering_Pipeline_Overview" ref="nofollow noopener noreferrer">Rendering Pipeline Overview</a> ä»‹ç» WebGL çš„æ¸²æŸ“ç®¡é“ã€‚</p>
<p>æ ¹æ® Khronos å®˜æ–¹å®šä¹‰ï¼ŒOpenGL/WebGL æ¸²æŸ“ç®¡é“åŒ…å«ä»¥ä¸‹é˜¶æ®µï¼š</p>
<ol>
<li>Vertex Specification(é¡¶ç‚¹è§„èŒƒ)</li>
<li>Vertex Processing(é¡¶ç‚¹å¤„ç†)</li>
<li>Vertex Post-Processing(é¡¶ç‚¹åå¤„ç†)</li>
<li>Rasterization(å…‰æ …åŒ–)</li>
<li>Fragment Processing(ç‰‡æ®µå¤„ç†)</li>
<li>Per-Sample Operations(é€æ ·æœ¬æ“ä½œ)</li>
<li>Framebuffer(å¸§ç¼“å†²)</li>
</ol>
<h3 data-id="heading-5">Vertex Specificationï¼ˆé¡¶ç‚¹è§„èŒƒï¼‰</h3>
<p>å®šä¹‰é¡¶ç‚¹æ•°æ®çš„æ ¼å¼å’Œæ¥æºï¼Œé€šè¿‡ä»¥ä¸‹ API é…ç½®ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºå¹¶ç»‘å®šç¼“å†²åŒº</span>
<span class="hljs-keyword">const</span> buffer = gl.<span class="hljs-title function_">createBuffer</span>();
gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, buffer);
gl.<span class="hljs-title function_">bufferData</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([...]), gl.<span class="hljs-property">STATIC_DRAW</span>);

<span class="hljs-comment">// æŒ‡å®šé¡¶ç‚¹å±æ€§æ ¼å¼</span>
<span class="hljs-keyword">const</span> positionLoc = gl.<span class="hljs-title function_">getAttribLocation</span>(program, <span class="hljs-string">'aPosition'</span>);
gl.<span class="hljs-title function_">vertexAttribPointer</span>(positionLoc, <span class="hljs-number">3</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
gl.<span class="hljs-title function_">enableVertexAttribArray</span>(positionLoc);
</code></pre>
<p>æ­¤é˜¶æ®µä¸å¤„ç†æ•°æ®ï¼Œä»…æè¿°æ•°æ®ç»“æ„ã€‚</p>
<h3 data-id="heading-6">Vertex Processingï¼ˆé¡¶ç‚¹å¤„ç†ï¼‰</h3>
<p><strong>å¯ç¼–ç¨‹é˜¶æ®µ</strong>ï¼Œé€šè¿‡ Vertex Shader å¤„ç†æ¯ä¸ªé¡¶ç‚¹ã€‚</p>
<p><strong>è¾“å…¥</strong>ï¼šAttribute å˜é‡ï¼ˆé¡¶ç‚¹ä½ç½®ã€æ³•çº¿ã€UV ç­‰ï¼‰ã€Uniform å˜é‡ï¼ˆå˜æ¢çŸ©é˜µç­‰ï¼‰
<strong>è¾“å‡º</strong>ï¼š<code>gl_Position</code>ï¼ˆè£å‰ªç©ºé—´åæ ‡ï¼Œå¿…éœ€ï¼‰ã€Varying å˜é‡ï¼ˆä¼ é€’ç»™ Fragment Shaderï¼‰</p>
<pre><code class="hljs language-glsl" lang="glsl">// Vertex Shader ç¤ºä¾‹ï¼ˆGLSL ES 1.00ï¼‰
attribute vec3 aPosition;
attribute vec2 aTexCoord;
uniform mat4 uMVPMatrix;
varying vec2 vTexCoord;

void main() {
  gl_Position = uMVPMatrix * vec4(aPosition, 1.0);  // è¾“å‡ºè£å‰ªç©ºé—´åæ ‡
  vTexCoord = aTexCoord;
}
</code></pre>
<h3 data-id="heading-7">Vertex Post-Processingï¼ˆé¡¶ç‚¹åå¤„ç†ï¼‰</h3>
<p>å›ºå®šåŠŸèƒ½é˜¶æ®µï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ol>
<li><strong>Transform Feedback</strong>ï¼ˆWebGL2 æ”¯æŒï¼‰ï¼šæ•è·é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºçš„æ•°æ®å›ä¼ åˆ°ç¼“å†²åŒºï¼Œç”¨äº GPU ç²’å­ç³»ç»Ÿç­‰åœºæ™¯</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// WebGL2 ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> transformFeedback = gl.<span class="hljs-title function_">createTransformFeedback</span>();
gl.<span class="hljs-title function_">bindTransformFeedback</span>(gl.<span class="hljs-property">TRANSFORM_FEEDBACK</span>, transformFeedback);
gl.<span class="hljs-title function_">transformFeedbackVaryings</span>(program, [<span class="hljs-string">"vPosition"</span>], gl.<span class="hljs-property">SEPARATE_ATTRIBS</span>);
</code></pre>
<ol start="2">
<li><strong>Primitive Assembly</strong>ï¼ˆå›¾å…ƒè£…é…ï¼‰ï¼šå°†é¡¶ç‚¹åºåˆ—ç»„è£…æˆå›¾å…ƒï¼ˆä¸‰è§’å½¢ã€çº¿æ®µæˆ–ç‚¹ï¼‰ï¼Œç±»å‹ç”± <code>gl.drawArrays(mode, ...)</code> çš„ <code>mode</code> å‚æ•°å†³å®š</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>); <span class="hljs-comment">// ä¸‰è§’å½¢ï¼ˆæ¯ 3 ä¸ªé¡¶ç‚¹ï¼‰</span>
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">LINES</span>, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>); <span class="hljs-comment">// çº¿æ®µï¼ˆæ¯ 2 ä¸ªé¡¶ç‚¹ï¼‰</span>
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">POINTS</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>); <span class="hljs-comment">// ç‚¹</span>
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">TRIANGLE_STRIP</span>, <span class="hljs-number">0</span>, <span class="hljs-number">8</span>); <span class="hljs-comment">// ä¸‰è§’å½¢å¸¦</span>
</code></pre>
<ol start="3">
<li>
<p><strong>Clipping</strong>ï¼ˆè£å‰ªï¼‰ï¼šè£å‰ªè¶…å‡ºè§†é”¥ä½“çš„å›¾å…ƒï¼Œä¸¢å¼ƒå®Œå…¨åœ¨è§†é”¥ä½“å¤–çš„å›¾å…ƒï¼Œå¯¹éƒ¨åˆ†åœ¨è§†é”¥ä½“å†…çš„å›¾å…ƒè¿›è¡Œè£å‰ª</p>
</li>
<li>
<p><strong>Perspective Divide</strong>ï¼ˆé€è§†é™¤æ³•ï¼‰ï¼šå°†è£å‰ªç©ºé—´åæ ‡ <code>(x, y, z, w)</code> è½¬æ¢ä¸º NDC åæ ‡ <code>(x/w, y/w, z/w)</code>ï¼ŒNDC åæ ‡èŒƒå›´ä¸º <code>[-1, 1]</code></p>
</li>
<li>
<p><strong>Viewport Transform</strong>ï¼ˆè§†å£å˜æ¢ï¼‰ï¼šå°† NDC åæ ‡ <code>[-1, 1]</code> æ˜ å°„åˆ°å±å¹•åƒç´ åæ ‡ã€‚é€šè¿‡ <code>gl.viewport()</code> è®¾ç½®æ˜ å°„åˆ°çš„å±å¹•åƒç´ èŒƒå›´</p>
</li>
<li>
<p><strong>Face Culling</strong>ï¼ˆé¢å‰”é™¤ï¼‰ï¼šæ ¹æ®ä¸‰è§’å½¢çš„æ­£åé¢å‰”é™¤èƒŒé¢ä¸‰è§’å½¢ï¼ˆéœ€é€šè¿‡ <code>gl.enable(gl.CULL_FACE)</code> å¯ç”¨ï¼‰</p>
</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">CULL_FACE</span>);
gl.<span class="hljs-title function_">cullFace</span>(gl.<span class="hljs-property">BACK</span>); <span class="hljs-comment">// å‰”é™¤èƒŒé¢ï¼ˆé»˜è®¤ï¼‰</span>
gl.<span class="hljs-title function_">frontFace</span>(gl.<span class="hljs-property">CCW</span>); <span class="hljs-comment">// é€†æ—¶é’ˆä¸ºæ­£é¢ï¼ˆé»˜è®¤ï¼‰</span>
</code></pre>
<h3 data-id="heading-8">Rasterizationï¼ˆå…‰æ …åŒ–ï¼‰</h3>
<p>å°†å›¾å…ƒè½¬æ¢ä¸ºç‰‡æ®µ (Fragment)ï¼Œç¡®å®šå›¾å…ƒè¦†ç›–å“ªäº›åƒç´ ã€‚</p>
<ol>
<li><strong>Scan Conversion</strong>ï¼ˆæ‰«æè½¬æ¢ï¼‰ï¼šç¡®å®šå›¾å…ƒè¦†ç›–çš„åƒç´ ä½ç½®</li>
<li><strong>Interpolation</strong>ï¼ˆæ’å€¼ï¼‰ï¼šå¯¹ Varying å˜é‡è¿›è¡Œæ’å€¼ï¼Œä¸ºæ¯ä¸ªç‰‡æ®µç”Ÿæˆæ’å€¼åçš„æ•°æ®
<ul>
<li>ä¾‹å¦‚ï¼šä¸‰è§’å½¢ä¸‰ä¸ªé¡¶ç‚¹é¢œè‰²ä¸º (1,0,0)ã€(0,1,0)ã€(0,0,1)ï¼Œå†…éƒ¨ç‰‡æ®µé¢œè‰²ä¸ºæ’å€¼ç»“æœ</li>
</ul>
</li>
</ol>
<h3 data-id="heading-9">Fragment Processingï¼ˆç‰‡æ®µå¤„ç†ï¼‰</h3>
<p><strong>å¯ç¼–ç¨‹é˜¶æ®µ</strong>ï¼Œé€šè¿‡ Fragment Shader å¤„ç†æ¯ä¸ªç‰‡æ®µï¼Œæ‰§è¡Œç€è‰²è®¡ç®—å’Œé€»è¾‘åˆ¤æ–­ã€‚</p>
<p><strong>è¾“å…¥</strong>ï¼šVarying å˜é‡ï¼ˆæ’å€¼åçš„æ•°æ®ï¼‰ã€Uniform å˜é‡ï¼ˆçº¹ç†ã€å…‰ç…§å‚æ•°ç­‰ï¼‰</p>
<p><strong>è¾“å‡º</strong>ï¼š</p>
<ul>
<li>ç‰‡æ®µæ•°æ®ï¼š
<ul>
<li>webgl1: é€šè¿‡å†…ç½®å˜é‡ <code>gl_FragColor</code> è¾“å‡ºé¢œè‰²</li>
<li>webgl2: é€šè¿‡è‡ªå®šä¹‰ <code>out</code> å˜é‡è¾“å‡ºï¼ˆå•ä¸ªé¢œè‰²é™„ä»¶æˆ–å¤šæ¸²æŸ“ç›®æ ‡ MRTï¼‰</li>
</ul>
</li>
<li>å¯é€‰ï¼šé€šè¿‡ <code>discard</code> ä¸¢å¼ƒç‰‡æ®µ</li>
</ul>
<pre><code class="hljs language-glsl" lang="glsl">// Fragment Shader ç¤ºä¾‹ï¼ˆGLSL ES 1.00ï¼‰
precision mediump float;
varying vec2 vTexCoord;
uniform sampler2D uTexture;

void main() {
  gl_FragColor = texture2D(uTexture, vTexCoord);  // çº¹ç†é‡‡æ ·
}
</code></pre>
<h3 data-id="heading-10">Per-Sample Operationsï¼ˆé€æ ·æœ¬æ“ä½œï¼‰</h3>
<p>å›ºå®šåŠŸèƒ½é˜¶æ®µï¼Œæ‰§è¡Œä¸€ç³»åˆ—æµ‹è¯•å†³å®šç‰‡æ®µæ˜¯å¦å†™å…¥å¸§ç¼“å†²ã€‚</p>
<p><strong>æ‰§è¡Œé¡ºåº</strong>ï¼ˆæŒ‰ç…§ OpenGL è§„èŒƒï¼‰ï¼š</p>
<ol>
<li><strong>Scissor Test</strong>ï¼ˆè£å‰ªæµ‹è¯•ï¼‰</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">SCISSOR_TEST</span>);
gl.<span class="hljs-title function_">scissor</span>(x, y, width, height); <span class="hljs-comment">// åªæ¸²æŸ“çŸ©å½¢åŒºåŸŸ</span>
</code></pre>
<ol start="2">
<li><strong>Stencil Test</strong>ï¼ˆæ¨¡æ¿æµ‹è¯•ï¼‰</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">STENCIL_TEST</span>);
gl.<span class="hljs-title function_">stencilFunc</span>(gl.<span class="hljs-property">EQUAL</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0xff</span>); <span class="hljs-comment">// æ¯”è¾ƒå‡½æ•°</span>
gl.<span class="hljs-title function_">stencilOp</span>(gl.<span class="hljs-property">KEEP</span>, gl.<span class="hljs-property">KEEP</span>, gl.<span class="hljs-property">REPLACE</span>); <span class="hljs-comment">// æ“ä½œ</span>
</code></pre>
<ol start="3">
<li><strong>Depth Test</strong>ï¼ˆæ·±åº¦æµ‹è¯•ï¼‰</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">DEPTH_TEST</span>);
gl.<span class="hljs-title function_">depthFunc</span>(gl.<span class="hljs-property">LESS</span>); <span class="hljs-comment">// æ·±åº¦å€¼æ›´å°æ—¶é€šè¿‡</span>
</code></pre>
<ol start="4">
<li><strong>Blending</strong>ï¼ˆé¢œè‰²æ··åˆï¼‰</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">BLEND</span>);
gl.<span class="hljs-title function_">blendFunc</span>(gl.<span class="hljs-property">SRC_ALPHA</span>, gl.<span class="hljs-property">ONE_MINUS_SRC_ALPHA</span>); <span class="hljs-comment">// Alpha æ··åˆ</span>
gl.<span class="hljs-title function_">blendEquation</span>(gl.<span class="hljs-property">FUNC_ADD</span>); <span class="hljs-comment">// æ··åˆæ–¹ç¨‹</span>
</code></pre>
<ol start="5">
<li><strong>Masking</strong>ï¼ˆå†™å…¥é®ç½©ï¼‰ï¼šæ§åˆ¶å“ªäº›æ•°æ®å¯ä»¥å†™å…¥å¸§ç¼“å†²ã€‚å¯ä»¥ç‹¬ç«‹æ§åˆ¶é¢œè‰²ã€æ·±åº¦ã€æ¨¡æ¿çš„å†™å…¥ï¼Œç”šè‡³å¯ä»¥å•ç‹¬å±è”½é¢œè‰²çš„å„ä¸ªé€šé“</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é¢œè‰²é®ç½©ï¼šæ§åˆ¶ RGBA å„é€šé“æ˜¯å¦å¯å†™</span>
gl.<span class="hljs-title function_">colorMask</span>(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// ç¦æ­¢å†™å…¥ Alpha é€šé“</span>

<span class="hljs-comment">// æ·±åº¦é®ç½©ï¼šæ§åˆ¶æ·±åº¦ç¼“å†²åŒºæ˜¯å¦å¯å†™</span>
gl.<span class="hljs-title function_">depthMask</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// ç¦æ­¢å†™å…¥æ·±åº¦å€¼</span>

<span class="hljs-comment">// æ¨¡æ¿é®ç½©ï¼šæ§åˆ¶æ¨¡æ¿ç¼“å†²åŒºå“ªäº›ä½å¯å†™</span>
gl.<span class="hljs-title function_">stencilMask</span>(<span class="hljs-number">0xff</span>); <span class="hljs-comment">// å…è®¸å†™å…¥æ‰€æœ‰ä½</span>
</code></pre>
<p>é€šè¿‡æ‰€æœ‰æµ‹è¯•çš„ç‰‡æ®µï¼Œæ ¹æ®é®ç½©è®¾ç½®å†™å…¥å¸§ç¼“å†²å¯¹åº”çš„é™„ä»¶ã€‚</p>
<h3 data-id="heading-11">Framebufferï¼ˆå¸§ç¼“å†²ï¼‰</h3>
<p>å­˜å‚¨æœ€ç»ˆæ¸²æŸ“ç»“æœã€‚WebGL æ”¯æŒä¸¤ç§å¸§ç¼“å†²ï¼š</p>
<ul>
<li><strong>é»˜è®¤å¸§ç¼“å†²</strong>ï¼šç›´æ¥æ¸²æŸ“åˆ° Canvas</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript">gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, <span class="hljs-literal">null</span>);
</code></pre>
<ul>
<li><strong>è‡ªå®šä¹‰å¸§ç¼“å†² (FBO)</strong>ï¼šç¦»å±æ¸²æŸ“ï¼ˆç”¨äºåå¤„ç†ã€é˜´å½±è´´å›¾ç­‰ï¼‰</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fbo = gl.<span class="hljs-title function_">createFramebuffer</span>();
gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, fbo);
gl.<span class="hljs-title function_">framebufferTexture2D</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, gl.<span class="hljs-property">COLOR_ATTACHMENT0</span>, gl.<span class="hljs-property">TEXTURE_2D</span>, texture, <span class="hljs-number">0</span>);
</code></pre>
<p>å¸§ç¼“å†²åŒ…å«å¤šä¸ªé™„ä»¶ (Attachment)ï¼š</p>
<ul>
<li>é¢œè‰²é™„ä»¶ (Color Attachment)ï¼šå­˜å‚¨é¢œè‰²å€¼</li>
<li>æ·±åº¦é™„ä»¶ (Depth Attachment)ï¼šå­˜å‚¨æ·±åº¦å€¼</li>
<li>æ¨¡æ¿é™„ä»¶ (Stencil Attachment)ï¼šå­˜å‚¨æ¨¡æ¿å€¼</li>
</ul>
<h2 data-id="heading-12">é¡¶ç‚¹æ•°æ®å‡†å¤‡</h2>
<p>æ•°æ®å‡†å¤‡æ¥å£ç”¨äºå°†é¡¶ç‚¹æ•°æ®ä» CPU ä¼ è¾“åˆ° GPUï¼Œå¹¶æŒ‡å®šæ•°æ®çš„æ ¼å¼å’Œå¸ƒå±€ï¼Œä¸ºæ¸²æŸ“ç®¡é“çš„ Vertex Specification é˜¶æ®µæä¾›è¾“å…¥ã€‚</p>
<h3 data-id="heading-13">Buffer å¯¹è±¡çš„åˆ›å»º</h3>
<p>Buffer å¯¹è±¡æ˜¯ GPU å†…å­˜ä¸­çš„ä¸€å—å­˜å‚¨ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é¡¶ç‚¹æ•°æ®ï¼ˆä½ç½®ã€é¢œè‰²ã€æ³•çº¿ã€UV ç­‰ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºç¼“å†²åŒºå¯¹è±¡</span>
<span class="hljs-keyword">const</span> buffer = gl.<span class="hljs-title function_">createBuffer</span>();
</code></pre>
<ul>
<li><code>createBuffer()</code> åœ¨ GPU ä¸­åˆ†é…ä¸€å—å†…å­˜ç©ºé—´ï¼Œè¿”å›ä¸€ä¸ª Buffer å¯¹è±¡çš„å¼•ç”¨</li>
<li>æ­¤æ—¶åªæ˜¯åˆ›å»ºäº†å¼•ç”¨ï¼Œå°šæœªåˆ†é…å®é™…çš„å­˜å‚¨ç©ºé—´</li>
</ul>
<h3 data-id="heading-14">ä¸Šä¼ æ•°æ®åˆ° Buffer</h3>
<p>å°† JavaScript çš„ç±»å‹åŒ–æ•°ç»„æ•°æ®å¤åˆ¶åˆ° GPU å†…å­˜ï¼Œåˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<p><strong>æ­¥éª¤ 1ï¼šç»‘å®š Buffer</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å°† Buffer ç»‘å®šåˆ° ARRAY_BUFFER ç»‘å®šç‚¹</span>
gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, buffer);
</code></pre>
<p><strong>æ­¥éª¤ 2ï¼šä¸Šä¼ æ•°æ®</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‡†å¤‡é¡¶ç‚¹æ•°æ®</span>
<span class="hljs-keyword">const</span> vertices = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([
  -<span class="hljs-number">0.5</span>,
  -<span class="hljs-number">0.5</span>,
  <span class="hljs-number">0.0</span>, <span class="hljs-comment">// é¡¶ç‚¹ 1</span>
  <span class="hljs-number">0.5</span>,
  -<span class="hljs-number">0.5</span>,
  <span class="hljs-number">0.0</span>, <span class="hljs-comment">// é¡¶ç‚¹ 2</span>
  <span class="hljs-number">0.0</span>,
  <span class="hljs-number">0.5</span>,
  <span class="hljs-number">0.0</span>, <span class="hljs-comment">// é¡¶ç‚¹ 3</span>
]);

<span class="hljs-comment">// ä¸Šä¼ å®Œæ•´æ•°æ®åˆ°å½“å‰ç»‘å®šçš„ Buffer</span>
gl.<span class="hljs-title function_">bufferData</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, vertices, gl.<span class="hljs-property">STATIC_DRAW</span>);

<span class="hljs-comment">// æˆ–è€…åªæ›´æ–°ä¸€éƒ¨åˆ†æ•°æ®</span>
<span class="hljs-keyword">const</span> offset = <span class="hljs-number">12</span>; <span class="hljs-comment">// å­—èŠ‚åç§»é‡</span>
<span class="hljs-keyword">const</span> newData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([<span class="hljs-number">1.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>]);
gl.<span class="hljs-title function_">bufferSubData</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, offset, newData);
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>ç»‘å®šåªæ˜¯é…ç½®æ—¶çš„ä¸­ä»‹</strong>ï¼š<code>bindBuffer</code> çš„ä½œç”¨æ˜¯å‘Šè¯‰ WebGL "æ¥ä¸‹æ¥çš„é…ç½®æ“ä½œä½œç”¨äºå“ªä¸ª Buffer"</li>
<li><strong>åç»­æ¸²æŸ“ä¸å½“å‰ç»‘å®šæ— å…³</strong>ï¼šç»˜åˆ¶æ—¶ä½¿ç”¨çš„æ˜¯ <code>vertexAttribPointer</code> é…ç½®æ—¶è®°å½•çš„ Buffer å¼•ç”¨ï¼Œä¸æ˜¯å½“å‰ç»‘å®šåˆ° <code>ARRAY_BUFFER</code> çš„ Buffer</li>
</ul>
<p><strong>ä½¿ç”¨æç¤ºï¼ˆUsage Hintï¼‰</strong>ï¼š</p>
<p><code>bufferData</code> çš„ç¬¬ä¸‰ä¸ªå‚æ•°å‘Šè¯‰ GPU æ•°æ®çš„ä½¿ç”¨æ¨¡å¼ï¼ŒGPU é©±åŠ¨å¯ä»¥æ®æ­¤ä¼˜åŒ–å†…å­˜åˆ†é…ã€‚</p>





























<table><thead><tr><th>å¸¸é‡</th><th>è¯´æ˜</th><th>é€‚ç”¨åœºæ™¯</th><th>GPU ä¼˜åŒ–ç­–ç•¥</th></tr></thead><tbody><tr><td><code>gl.STATIC_DRAW</code></td><td>æ•°æ®ä¸€æ¬¡ä¸Šä¼ ï¼Œå¤šæ¬¡ç»˜åˆ¶</td><td>é™æ€æ¨¡å‹</td><td>å­˜å‚¨åœ¨ GPU æ˜¾å­˜ä¸­ï¼Œæé«˜è¯»å–é€Ÿåº¦</td></tr><tr><td><code>gl.DYNAMIC_DRAW</code></td><td>æ•°æ®å¤šæ¬¡ä¿®æ”¹ï¼Œå¤šæ¬¡ç»˜åˆ¶</td><td>åŠ¨ç”»æ¨¡å‹</td><td>å­˜å‚¨åœ¨å¯å¿«é€Ÿæ›´æ–°çš„å†…å­˜åŒºåŸŸ</td></tr><tr><td><code>gl.STREAM_DRAW</code></td><td>æ•°æ®ä¸€æ¬¡ä¸Šä¼ ï¼Œå°‘é‡ç»˜åˆ¶</td><td>ä¸´æ—¶æ•°æ®</td><td>å­˜å‚¨åœ¨å†™å…¥å¿«ä½†è¯»å–æ…¢çš„ç¼“å†²åŒº</td></tr></tbody></table>
<h3 data-id="heading-15">é…ç½®é¡¶ç‚¹å±æ€§è¯»å–æ–¹å¼</h3>
<p>å‘Šè¯‰ GPU å¦‚ä½•ä»é‚£ä¸ª Buffer ä¸­è§£ææ•°æ®ï¼Œå¦‚ä½•å°† Buffer æ˜ å°„åˆ°é¡¶ç‚¹ç€è‰²å™¨çš„ Attribute å˜é‡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç»‘å®šåŒ…å«é¡¶ç‚¹æ•°æ®çš„ Buffer</span>
gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, buffer);

<span class="hljs-comment">// é…ç½®ä½ç½®å±æ€§ï¼ˆåç§» 0ï¼‰</span>
<span class="hljs-keyword">const</span> positionLoc = gl.<span class="hljs-title function_">getAttribLocation</span>(program, <span class="hljs-string">"aPosition"</span>);
gl.<span class="hljs-title function_">vertexAttribPointer</span>(positionLoc, <span class="hljs-number">3</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, stride, <span class="hljs-number">0</span>);

<span class="hljs-comment">// é…ç½®é¢œè‰²å±æ€§ï¼ˆåç§» 3 ä¸ª floatï¼‰</span>
<span class="hljs-keyword">const</span> colorLoc = gl.<span class="hljs-title function_">getAttribLocation</span>(program, <span class="hljs-string">"aColor"</span>);
gl.<span class="hljs-title function_">vertexAttribPointer</span>(colorLoc, <span class="hljs-number">3</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, stride, <span class="hljs-number">3</span> * <span class="hljs-number">4</span>);
</code></pre>
<p><strong>æ³¨</strong>ï¼šè°ƒç”¨ <code>vertexAttribPointer</code> å‰å¿…é¡»å…ˆ <code>bindBuffer</code>ï¼Œå¦åˆ™æ— æ³•çŸ¥é“ä»å“ªä¸ª Buffer è¯»å–æ•°æ®</p>
<h3 data-id="heading-16">å¯ç”¨é¡¶ç‚¹å±æ€§æ•°ç»„</h3>
<p>ä»å¸¸é‡æ¨¡å¼åˆ‡æ¢åˆ°æ•°ç»„æ¨¡å¼ï¼Œè®©é¡¶ç‚¹ç€è‰²å™¨ä» Buffer ä¸­è¯»å–æ•°æ®ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é…ç½®å®Œ vertexAttribPointer åï¼Œå¯ç”¨æ•°ç»„æ¨¡å¼</span>
gl.<span class="hljs-title function_">enableVertexAttribArray</span>(positionLoc);
gl.<span class="hljs-title function_">enableVertexAttribArray</span>(colorLoc);
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦å¯ç”¨ï¼Ÿ</strong></p>
<ul>
<li><code>vertexAttribPointer</code> åªæ˜¯é…ç½®äº†è¯»å–è§„åˆ™ï¼Œä½†ä¸ä¼šè‡ªåŠ¨å¯ç”¨ã€‚é»˜è®¤å¤„äº<strong>å¸¸é‡æ¨¡å¼</strong>ã€‚ä½¿ç”¨å›ºå®šå€¼ <code>(0, 0, 0, 1)</code></li>
<li>å¿…é¡»è°ƒç”¨ <code>enableVertexAttribArray</code> æ‰èƒ½åˆ‡æ¢åˆ°<strong>æ•°ç»„æ¨¡å¼</strong>ï¼Œä» Buffer è¯»å–æ•°æ®</li>
</ul>
<h3 data-id="heading-17">ç´¢å¼•ç¼“å†²åŒºï¼šå‡å°‘é¡¶ç‚¹æ•°æ®å†—ä½™</h3>
<p>é€šè¿‡ç´¢å¼•å¤ç”¨é¡¶ç‚¹ï¼Œé¿å…é‡å¤å­˜å‚¨ï¼Œå‡å°‘å†…å­˜å ç”¨ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼šç»˜åˆ¶çŸ©å½¢</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// é¡¶ç‚¹æ•°æ®ï¼ˆ4 ä¸ªé¡¶ç‚¹ï¼‰</span>
<span class="hljs-keyword">const</span> vertices = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([
  -<span class="hljs-number">0.5</span>,
  -<span class="hljs-number">0.5</span>,
  <span class="hljs-number">0.0</span>, <span class="hljs-comment">// 0: å·¦ä¸‹</span>
  <span class="hljs-number">0.5</span>,
  -<span class="hljs-number">0.5</span>,
  <span class="hljs-number">0.0</span>, <span class="hljs-comment">// 1: å³ä¸‹</span>
  <span class="hljs-number">0.5</span>,
  <span class="hljs-number">0.5</span>,
  <span class="hljs-number">0.0</span>, <span class="hljs-comment">// 2: å³ä¸Š</span>
  -<span class="hljs-number">0.5</span>,
  <span class="hljs-number">0.5</span>,
  <span class="hljs-number">0.0</span>, <span class="hljs-comment">// 3: å·¦ä¸Š</span>
]);

<span class="hljs-comment">// ç´¢å¼•æ•°æ®ï¼ˆ2 ä¸ªä¸‰è§’å½¢å¤ç”¨é¡¶ç‚¹ï¼‰</span>
<span class="hljs-keyword">const</span> indices = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint16Array</span>([
  <span class="hljs-number">0</span>,
  <span class="hljs-number">1</span>,
  <span class="hljs-number">2</span>, <span class="hljs-comment">// ç¬¬ä¸€ä¸ªä¸‰è§’å½¢</span>
  <span class="hljs-number">0</span>,
  <span class="hljs-number">2</span>,
  <span class="hljs-number">3</span>, <span class="hljs-comment">// ç¬¬äºŒä¸ªä¸‰è§’å½¢</span>
]);

<span class="hljs-comment">// ä¸Šä¼ é¡¶ç‚¹æ•°æ®ã€‚æ­¤å¤„çœç•¥ã€‚</span>
<span class="hljs-comment">// ä¸Šä¼ ç´¢å¼•æ•°æ®</span>
<span class="hljs-keyword">const</span> indexBuffer = gl.<span class="hljs-title function_">createBuffer</span>();
gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ELEMENT_ARRAY_BUFFER</span>, indexBuffer);
gl.<span class="hljs-title function_">bufferData</span>(gl.<span class="hljs-property">ELEMENT_ARRAY_BUFFER</span>, indices, gl.<span class="hljs-property">STATIC_DRAW</span>);

<span class="hljs-comment">// ä½¿ç”¨ç´¢å¼•ç»˜åˆ¶</span>
gl.<span class="hljs-title function_">drawElements</span>(gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-number">6</span>, gl.<span class="hljs-property">UNSIGNED_SHORT</span>, <span class="hljs-number">0</span>);
</code></pre>
<p><strong>æ•°æ®å¯¹æ¯”</strong>ï¼š</p>


























<table><thead><tr><th>æ–¹å¼</th><th>é¡¶ç‚¹æ•°æ®</th><th>ç´¢å¼•æ•°æ®</th><th>æ€»è®¡</th><th>èŠ‚çœ</th></tr></thead><tbody><tr><td><code>drawArrays</code></td><td>72 å­—èŠ‚ï¼ˆ6 é¡¶ç‚¹ï¼‰</td><td>æ— </td><td>72 å­—èŠ‚</td><td>-</td></tr><tr><td><code>drawElements</code></td><td>48 å­—èŠ‚ï¼ˆ4 é¡¶ç‚¹ï¼‰</td><td>12 å­—èŠ‚ï¼ˆ6 ç´¢å¼•ï¼‰</td><td>60 å­—èŠ‚</td><td>16.7%</td></tr></tbody></table>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// drawArraysï¼šæŒ‰é¡ºåºè¯»å–é¡¶ç‚¹</span>
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6</span>);

<span class="hljs-comment">// drawElementsï¼šæŒ‰ç´¢å¼•è¯»å–é¡¶ç‚¹</span>
gl.<span class="hljs-title function_">drawElements</span>(gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-number">6</span>, gl.<span class="hljs-property">UNSIGNED_SHORT</span>, <span class="hljs-number">0</span>);
</code></pre>
<h3 data-id="heading-18">é¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼šå¿«é€Ÿåˆ‡æ¢é…ç½®</h3>
<p>VAO (Vertex Array Object) ä¿å­˜æ‰€æœ‰é¡¶ç‚¹é…ç½®çŠ¶æ€ï¼Œä¸€æ¬¡ç»‘å®šæ¢å¤æ‰€æœ‰çŠ¶æ€ï¼Œç”¨äºå¤šæ¨¡å‹æ¸²æŸ“çš„å¿«é€Ÿåˆ‡æ¢ã€‚WebGL2 åŸç”Ÿæ”¯æŒï¼ŒWebGL1 éœ€è¦æ‰©å±• <code>OES_vertex_array_object</code>ï¼š</p>
<p><strong>VAO ä¿å­˜çš„çŠ¶æ€</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰ Attribute çš„ <code>vertexAttribPointer</code> é…ç½®ï¼ˆBuffer å¼•ç”¨ã€sizeã€typeã€strideã€offsetï¼‰</li>
<li>æ‰€æœ‰ Attribute çš„å¯ç”¨çŠ¶æ€ï¼ˆ<code>enableVertexAttribArray</code> / <code>disableVertexAttribArray</code>ï¼‰</li>
<li>å½“å‰ç»‘å®šåˆ° <code>ELEMENT_ARRAY_BUFFER</code> çš„ç´¢å¼•ç¼“å†²åŒº</li>
</ul>
<p><strong>ä½¿ç”¨ VAO</strong>ï¼š</p>
<ol>
<li>åˆ›å»º VAO</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> vao = gl.<span class="hljs-title function_">createVertexArray</span>();
</code></pre>
<ol start="2">
<li>é…ç½® VAO</li>
</ol>
<pre><code class="hljs language-js" lang="js">gl.<span class="hljs-title function_">bindVertexArray</span>(vao);

<span class="hljs-comment">// é…ç½®é¡¶ç‚¹å±æ€§ï¼ˆé…ç½®ä¼šè¢« VAO è®°å½•ï¼‰</span>
gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, buffer);
gl.<span class="hljs-title function_">vertexAttribPointer</span>(positionLoc, <span class="hljs-number">3</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
gl.<span class="hljs-title function_">enableVertexAttribArray</span>(positionLoc);

<span class="hljs-comment">// ç»‘å®šç´¢å¼•ç¼“å†²åŒºï¼ˆä¹Ÿä¼šè¢« VAO è®°å½•ï¼‰</span>
gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ELEMENT_ARRAY_BUFFER</span>, indexBuffer);

<span class="hljs-comment">// è§£ç»‘ VAO</span>
gl.<span class="hljs-title function_">bindVertexArray</span>(<span class="hljs-literal">null</span>);
</code></pre>
<ol start="3">
<li>ç»˜åˆ¶æ—¶åªéœ€ç»‘å®š VAOï¼Œè‡ªåŠ¨æ¢å¤æ‰€æœ‰é…ç½®</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">gl.<span class="hljs-title function_">bindVertexArray</span>(vao);
gl.<span class="hljs-title function_">drawElements</span>(gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-number">6</span>, gl.<span class="hljs-property">UNSIGNED_SHORT</span>, <span class="hljs-number">0</span>);
</code></pre>
<h2 data-id="heading-19">çº¹ç†æ•°æ®å‡†å¤‡</h2>
<p>çº¹ç†æ¥å£ç”¨äºå°†å›¾åƒæ•°æ®ä¸Šä¼ åˆ° GPUï¼Œå¹¶é…ç½®çº¹ç†çš„é‡‡æ ·æ–¹å¼ï¼Œä¸ºç‰‡æ®µç€è‰²å™¨æä¾›çº¹ç†é‡‡æ ·åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-20">çº¹ç†å¯¹è±¡çš„åˆ›å»º</h3>
<p>Texture å¯¹è±¡æ˜¯ GPU å†…å­˜ä¸­çš„ä¸€å—å­˜å‚¨ç©ºé—´ï¼Œç”¨äºå­˜å‚¨å›¾åƒæ•°æ®ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºçº¹ç†å¯¹è±¡</span>
<span class="hljs-keyword">const</span> texture = gl.<span class="hljs-title function_">createTexture</span>();
</code></pre>
<ul>
<li><code>createTexture()</code> åœ¨ GPU ä¸­åˆ†é…ä¸€å—å†…å­˜ç©ºé—´ï¼Œè¿”å›ä¸€ä¸ª Texture å¯¹è±¡çš„å¼•ç”¨</li>
<li>æ­¤æ—¶åªæ˜¯åˆ›å»ºäº†å¼•ç”¨ï¼Œå°šæœªåˆ†é…å®é™…çš„å­˜å‚¨ç©ºé—´</li>
</ul>
<h3 data-id="heading-21">ä¸Šä¼ æ•°æ®åˆ° Texture</h3>
<p>å°†å›¾åƒæ•°æ®å¤åˆ¶åˆ° GPU å†…å­˜ä¸­ï¼Œåˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p>
<p><strong>æ­¥éª¤ 1ï¼šç»‘å®š Texture</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å°† Texture ç»‘å®šåˆ° TEXTURE_2D ç»‘å®šç‚¹</span>
gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture);
</code></pre>
<p><strong>å¸¸ç”¨ç»‘å®šç‚¹</strong>ï¼š</p>
<ul>
<li><code>gl.TEXTURE_2D</code>ï¼š2D çº¹ç†</li>
<li><code>gl.TEXTURE_CUBE_MAP</code>ï¼šç«‹æ–¹ä½“è´´å›¾</li>
</ul>
<p><strong>æ­¥éª¤ 2ï¼šä¸Šä¼ æ•°æ®</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä» Image å¯¹è±¡ä¸Šä¼ çº¹ç†</span>
<span class="hljs-keyword">const</span> image = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>();
image.<span class="hljs-property">onload</span> = <span class="hljs-function">() =&gt;</span> {
  gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture);
  gl.<span class="hljs-title function_">texImage2D</span>(
    gl.<span class="hljs-property">TEXTURE_2D</span>, <span class="hljs-comment">// ç›®æ ‡</span>
    <span class="hljs-number">0</span>, <span class="hljs-comment">// Mipmap çº§åˆ«ï¼ˆ0 ä¸ºåŸºç¡€çº§åˆ«ï¼‰</span>
    gl.<span class="hljs-property">RGBA</span>, <span class="hljs-comment">// å†…éƒ¨æ ¼å¼</span>
    gl.<span class="hljs-property">RGBA</span>, <span class="hljs-comment">// æºæ•°æ®æ ¼å¼</span>
    gl.<span class="hljs-property">UNSIGNED_BYTE</span>, <span class="hljs-comment">// æºæ•°æ®ç±»å‹</span>
    image <span class="hljs-comment">// æ•°æ®æº</span>
  );
};
image.<span class="hljs-property">src</span> = <span class="hljs-string">"texture.png"</span>;

<span class="hljs-comment">// æˆ–ä» TypedArray ä¸Šä¼ çº¹ç†</span>
<span class="hljs-keyword">const</span> pixels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([
  <span class="hljs-number">255</span>,
  <span class="hljs-number">0</span>,
  <span class="hljs-number">0</span>,
  <span class="hljs-number">255</span>, <span class="hljs-comment">// çº¢è‰²åƒç´ </span>
  <span class="hljs-number">0</span>,
  <span class="hljs-number">255</span>,
  <span class="hljs-number">0</span>,
  <span class="hljs-number">255</span>, <span class="hljs-comment">// ç»¿è‰²åƒç´ </span>
]);
gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture);
gl.<span class="hljs-title function_">texImage2D</span>(
  gl.<span class="hljs-property">TEXTURE_2D</span>,
  <span class="hljs-number">0</span>,
  gl.<span class="hljs-property">RGBA</span>,
  <span class="hljs-number">2</span>,
  <span class="hljs-number">1</span>, <span class="hljs-comment">// å®½åº¦ã€é«˜åº¦</span>
  <span class="hljs-number">0</span>, <span class="hljs-comment">// è¾¹ç•Œï¼ˆå¿…é¡»ä¸º 0ï¼‰</span>
  gl.<span class="hljs-property">RGBA</span>,
  gl.<span class="hljs-property">UNSIGNED_BYTE</span>,
  pixels
);

<span class="hljs-comment">// æˆ–éƒ¨åˆ†æ›´æ–°çº¹ç†æ•°æ®</span>
gl.<span class="hljs-title function_">texSubImage2D</span>(
  gl.<span class="hljs-property">TEXTURE_2D</span>,
  <span class="hljs-number">0</span>, <span class="hljs-comment">// Mipmap çº§åˆ«</span>
  <span class="hljs-number">10</span>,
  <span class="hljs-number">10</span>, <span class="hljs-comment">// xã€y åç§»</span>
  <span class="hljs-number">64</span>,
  <span class="hljs-number">64</span>, <span class="hljs-comment">// å®½åº¦ã€é«˜åº¦</span>
  gl.<span class="hljs-property">RGBA</span>,
  gl.<span class="hljs-property">UNSIGNED_BYTE</span>,
  partialImage
);
</code></pre>
<p><strong>é‡è¦è¯´æ˜</strong>ï¼š</p>
<ul>
<li><strong>ç»‘å®šåªæ˜¯é…ç½®æ—¶çš„ä¸­ä»‹</strong>ï¼š<code>bindTexture</code> çš„ä½œç”¨æ˜¯å‘Šè¯‰ WebGL "æ¥ä¸‹æ¥çš„é…ç½®æ“ä½œä½œç”¨äºå“ªä¸ª Texture"</li>
<li><strong>åç»­æ¸²æŸ“ä¸å½“å‰ç»‘å®šæ— å…³</strong>ï¼šç»˜åˆ¶æ—¶ä½¿ç”¨çš„æ˜¯ <code>uniform1i</code> è®¾ç½®æ—¶æŒ‡å®šçš„çº¹ç†å•å…ƒç»‘å®šçš„ Textureï¼Œä¸æ˜¯å½“å‰ç»‘å®šåˆ° <code>TEXTURE_2D</code> çš„ Texture</li>
</ul>
<h3 data-id="heading-22">é…ç½®çº¹ç†é‡‡æ ·å‚æ•°</h3>
<p>å‘Šè¯‰ GPU å¦‚ä½•ä» Texture ä¸­é‡‡æ ·æ•°æ®ï¼ˆè¿‡æ»¤æ¨¡å¼å’Œç¯ç»•æ¨¡å¼ï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç»‘å®šéœ€è¦é…ç½®çš„ Texture</span>
gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture);

<span class="hljs-comment">// é…ç½®è¿‡æ»¤æ¨¡å¼</span>
gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_MAG_FILTER</span>, gl.<span class="hljs-property">LINEAR</span>); <span class="hljs-comment">// æ”¾å¤§è¿‡æ»¤</span>
gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_MIN_FILTER</span>, gl.<span class="hljs-property">LINEAR</span>); <span class="hljs-comment">// ç¼©å°è¿‡æ»¤</span>

<span class="hljs-comment">// é…ç½®ç¯ç»•æ¨¡å¼</span>
gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_WRAP_S</span>, gl.<span class="hljs-property">REPEAT</span>); <span class="hljs-comment">// S æ–¹å‘ï¼ˆæ¨ªå‘ï¼‰</span>
gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_WRAP_T</span>, gl.<span class="hljs-property">CLAMP_TO_EDGE</span>); <span class="hljs-comment">// T æ–¹å‘ï¼ˆçºµå‘ï¼‰</span>
</code></pre>
<p><strong>æ³¨</strong>ï¼šè°ƒç”¨ <code>texParameteri</code> å‰å¿…é¡»å…ˆ <code>bindTexture</code>ï¼Œå¦åˆ™æ— æ³•çŸ¥é“é…ç½®å“ªä¸ª Texture</p>
<p><strong>è¿‡æ»¤æ¨¡å¼</strong>ï¼š</p>

































<table><thead><tr><th>å¸¸é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>gl.NEAREST</code></td><td>æœ€è¿‘é‚»ï¼Œæ—  Mipmap</td></tr><tr><td><code>gl.LINEAR</code></td><td>çº¿æ€§æ’å€¼ï¼Œæ—  Mipmap</td></tr><tr><td><code>gl.NEAREST_MIPMAP_NEAREST</code></td><td>æœ€è¿‘é‚» Mipmapï¼Œæœ€è¿‘é‚»æ’å€¼</td></tr><tr><td><code>gl.LINEAR_MIPMAP_NEAREST</code></td><td>æœ€è¿‘é‚» Mipmapï¼Œçº¿æ€§æ’å€¼</td></tr><tr><td><code>gl.NEAREST_MIPMAP_LINEAR</code></td><td>çº¿æ€§ Mipmapï¼Œæœ€è¿‘é‚»æ’å€¼</td></tr><tr><td><code>gl.LINEAR_MIPMAP_LINEAR</code></td><td>çº¿æ€§ Mipmapï¼Œçº¿æ€§æ’å€¼ï¼ˆä¸‰çº¿æ€§è¿‡æ»¤ï¼‰</td></tr></tbody></table>
<p><strong>ç¯ç»•æ¨¡å¼</strong>ï¼š</p>





















<table><thead><tr><th>å¸¸é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>gl.REPEAT</code></td><td>é‡å¤çº¹ç†</td></tr><tr><td><code>gl.CLAMP_TO_EDGE</code></td><td>è¾¹ç¼˜æ‹‰ä¼¸</td></tr><tr><td><code>gl.MIRRORED_REPEAT</code></td><td>é•œåƒé‡å¤ï¼ˆWebGL1 éœ€è¦æ‰©å±•ï¼ŒWebGL2 åŸç”Ÿæ”¯æŒï¼‰</td></tr></tbody></table>
<p><strong>é 2 æ¬¡å¹‚çº¹ç†é™åˆ¶</strong>ï¼š</p>
<p>WebGL1 å¯¹é 2 æ¬¡å¹‚ (NPOT) çº¹ç†æœ‰é™åˆ¶ï¼šä¸èƒ½ç”Ÿæˆ Mipmapã€ç¯ç»•æ¨¡å¼å¿…é¡»ä¸º <code>CLAMP_TO_EDGE</code>ã€‚
WebGL2 å®Œå…¨æ”¯æŒ NPOT çº¹ç†ã€‚</p>
<p><strong>åƒç´ å­˜å‚¨å‚æ•°ï¼ˆpixelStoreiï¼‰</strong>ï¼š</p>
<p><code>pixelStorei</code> ç”¨äºé…ç½®çº¹ç†æ•°æ®çš„è§£åŒ…ï¼ˆä¸Šä¼ åˆ° GPU æ—¶ï¼‰å’Œæ‰“åŒ…ï¼ˆä» GPU è¯»å–æ—¶ï¼‰æ–¹å¼ï¼Œå½±å“ <code>texImage2D</code>ã€<code>texSubImage2D</code> å’Œ <code>readPixels</code> çš„è¡Œä¸ºã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è®¾ç½®è§£åŒ…å¯¹é½æ–¹å¼ï¼ˆé»˜è®¤ 4 å­—èŠ‚å¯¹é½ï¼‰</span>
gl.<span class="hljs-title function_">pixelStorei</span>(gl.<span class="hljs-property">UNPACK_ALIGNMENT</span>, <span class="hljs-number">1</span>); <span class="hljs-comment">// 1 å­—èŠ‚å¯¹é½ï¼Œé€‚ç”¨äº RGB ç­‰é 4 å­—èŠ‚å¯¹é½çš„æ ¼å¼</span>

<span class="hljs-comment">// è®¾ç½® Y è½´ç¿»è½¬ï¼ˆé»˜è®¤ falseï¼‰</span>
gl.<span class="hljs-title function_">pixelStorei</span>(gl.<span class="hljs-property">UNPACK_FLIP_Y_WEBGL</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// åŠ è½½å›¾åƒæ—¶å‚ç›´ç¿»è½¬</span>

<span class="hljs-comment">// è®¾ç½®é¢„ä¹˜ Alphaï¼ˆé»˜è®¤ falseï¼‰</span>
gl.<span class="hljs-title function_">pixelStorei</span>(gl.<span class="hljs-property">UNPACK_PREMULTIPLY_ALPHA_WEBGL</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// é¢„ä¹˜ Alpha é€šé“</span>

<span class="hljs-comment">// è®¾ç½®è‰²å½©ç©ºé—´è½¬æ¢ï¼ˆé»˜è®¤ BROWSER_DEFAULT_WEBGLï¼‰</span>
gl.<span class="hljs-title function_">pixelStorei</span>(gl.<span class="hljs-property">UNPACK_COLORSPACE_CONVERSION_WEBGL</span>, gl.<span class="hljs-property">NONE</span>); <span class="hljs-comment">// ç¦ç”¨è‰²å½©ç©ºé—´è½¬æ¢</span>
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼š<code>pixelStorei</code> æ˜¯å…¨å±€çŠ¶æ€ï¼Œä¼šå½±å“åç»­æ‰€æœ‰çº¹ç†ä¸Šä¼ æ“ä½œï¼Œä½¿ç”¨åè®°å¾—æ¢å¤é»˜è®¤å€¼ã€‚</p>
<h3 data-id="heading-23">Mipmap ç”Ÿæˆ</h3>
<p>Mipmap æ˜¯çº¹ç†çš„å¤šçº§åˆ†è¾¨ç‡ç‰ˆæœ¬ï¼Œç”¨äºæé«˜æ¸²æŸ“è´¨é‡å’Œæ€§èƒ½ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸Šä¼ åŸºç¡€çº§åˆ«çº¹ç†åç”Ÿæˆ Mipmap</span>
gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture);
gl.<span class="hljs-title function_">generateMipmap</span>(gl.<span class="hljs-property">TEXTURE_2D</span>);
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li>WebGL1 åªå¯¹ 2 æ¬¡å¹‚çº¹ç† æœ‰æ•ˆï¼›WebGL2 æ²¡æœ‰æ­¤é™åˆ¶</li>
<li>Mipmap ä¼šå¢åŠ çº¦ 33% çš„å†…å­˜å ç”¨</li>
<li>è¿œè·ç¦»æ¸²æŸ“æ—¶ Mipmap å¯ä»¥å‡å°‘é”¯é½¿å’Œé—ªçƒ</li>
</ul>
<h3 data-id="heading-24">åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­ä½¿ç”¨çº¹ç†</h3>
<p>çº¹ç†é€šè¿‡çº¹ç†å•å…ƒä¼ é€’ç»™ç€è‰²å™¨ï¼Œæ¶‰åŠä¸‰ä¸ªæ­¥éª¤ã€‚</p>
<p><strong>æ­¥éª¤ 1ï¼šå°† Texture åˆ†é…ç»™çº¹ç†å•å…ƒ</strong></p>
<p>WebGL æä¾›å¤šä¸ªçº¹ç†å•å…ƒï¼ˆTexture Unitï¼‰ï¼Œæ¯ä¸ªå•å…ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„"æ’æ§½"ï¼Œå¯ä»¥ç»‘å®šä¸€ä¸ªçº¹ç†ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¿€æ´»çº¹ç†å•å…ƒ 0</span>
gl.<span class="hljs-title function_">activeTexture</span>(gl.<span class="hljs-property">TEXTURE0</span>);
<span class="hljs-comment">// å°† texture1 ç»‘å®šåˆ°çº¹ç†å•å…ƒ 0</span>
gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture1);

<span class="hljs-comment">// æ¿€æ´»çº¹ç†å•å…ƒ 1</span>
gl.<span class="hljs-title function_">activeTexture</span>(gl.<span class="hljs-property">TEXTURE1</span>);
<span class="hljs-comment">// å°† texture2 ç»‘å®šåˆ°çº¹ç†å•å…ƒ 1ã€‚æ­¤æ—¶ä¸¤ä¸ªçº¹ç†å•å…ƒæœ‰å„è‡ªçš„ç»‘å®š</span>
gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture2);
</code></pre>
<p><strong><code>activeTexture</code> åšäº†ä»€ä¹ˆ</strong>ï¼šåˆ‡æ¢å½“å‰æ´»åŠ¨çš„çº¹ç†å•å…ƒï¼Œåç»­çš„ <code>bindTexture</code> æ“ä½œå°†çº¹ç†ç»‘å®šåˆ°è¯¥å•å…ƒ</p>
<p><strong>æ­¥éª¤ 2ï¼šè®¾ç½® Uniform ä½¿ç”¨å“ªä¸ªçº¹ç†å•å…ƒ</strong></p>
<p>é€šè¿‡ <code>uniform1i</code> å‘Šè¯‰ç€è‰²å™¨çš„ <code>sampler2D</code> å˜é‡ä½¿ç”¨å“ªä¸ªçº¹ç†å•å…ƒã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‘Šè¯‰ uDiffuse ä½¿ç”¨çº¹ç†å•å…ƒ 0</span>
<span class="hljs-keyword">const</span> diffuseLoc = gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">"uDiffuse"</span>);
gl.<span class="hljs-title function_">uniform1i</span>(diffuseLoc, <span class="hljs-number">0</span>); <span class="hljs-comment">// 0 è¡¨ç¤º gl.TEXTURE0</span>

<span class="hljs-comment">// å‘Šè¯‰ uNormal ä½¿ç”¨çº¹ç†å•å…ƒ 1</span>
<span class="hljs-keyword">const</span> normalLoc = gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">"uNormal"</span>);
gl.<span class="hljs-title function_">uniform1i</span>(normalLoc, <span class="hljs-number">1</span>); <span class="hljs-comment">// 1 è¡¨ç¤º gl.TEXTURE1</span>
</code></pre>
<p><strong>æ­¥éª¤ 3ï¼šé¡¶ç‚¹ç€è‰²å™¨ä¼ é€’çº¹ç†åæ ‡</strong>ï¼šé€šè¿‡ Attribute æ¥æ”¶çº¹ç†åæ ‡ï¼ˆUVï¼‰ï¼Œé€šè¿‡ Varying ä¼ é€’ç»™ç‰‡æ®µç€è‰²å™¨</p>
<pre><code class="hljs language-glsl" lang="glsl">// é¡¶ç‚¹ç€è‰²å™¨: ä¼ é€’çº¹ç†åæ ‡
attribute vec3 aPosition;
attribute vec2 aTexCoord;
varying vec2 vTexCoord;

void main() {
  gl_Position = vec4(aPosition, 1.0);
  vTexCoord = aTexCoord;
}
</code></pre>
<p><strong>æ­¥éª¤ 4:ç‰‡æ®µç€è‰²å™¨é‡‡æ ·çº¹ç†</strong>ï¼šé€šè¿‡ <code>sampler2D</code> ç±»å‹çš„ Uniform æ¥æ”¶çº¹ç†ï¼Œä½¿ç”¨ <code>texture2D</code> å‡½æ•°é‡‡æ ·</p>
<pre><code class="hljs language-glsl" lang="glsl">// ç‰‡æ®µç€è‰²å™¨: é‡‡æ ·å¤šä¸ªçº¹ç†
precision mediump float;

uniform sampler2D uDiffuse;  // æ¼«åå°„çº¹ç†
uniform sampler2D uNormal;   // æ³•çº¿çº¹ç†
varying vec2 vTexCoord;

void main() {
  vec4 diffuse = texture2D(uDiffuse, vTexCoord);
  vec4 normal = texture2D(uNormal, vTexCoord);

  // æ··åˆçº¹ç†
  gl_FragColor = diffuse * 0.8 + normal * 0.2;
}
</code></pre>
<h3 data-id="heading-25">WebGL2 é€šè¿‡é‡‡æ ·å™¨å¯¹è±¡é…ç½®çº¹ç†é‡‡æ ·å‚æ•°</h3>
<p>WebGL2 æ”¯æŒå°†çº¹ç†æ•°æ®å’Œé‡‡æ ·å‚æ•°åˆ†ç¦»ç®¡ç†ã€‚åœ¨ WebGL1 ä¸­ï¼Œé‡‡æ ·å‚æ•°ï¼ˆè¿‡æ»¤æ¨¡å¼ã€ç¯ç»•æ¨¡å¼ï¼‰æ˜¯çº¹ç†å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œé€šè¿‡ <code>texParameteri</code> è®¾ç½®ï¼›WebGL2 å¼•å…¥é‡‡æ ·å™¨å¯¹è±¡ï¼Œå¯ä»¥ç‹¬ç«‹ç®¡ç†é‡‡æ ·å‚æ•°ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºé‡‡æ ·å™¨å¯¹è±¡</span>
<span class="hljs-keyword">const</span> sampler = gl.<span class="hljs-title function_">createSampler</span>();
gl.<span class="hljs-title function_">samplerParameteri</span>(sampler, gl.<span class="hljs-property">TEXTURE_MIN_FILTER</span>, gl.<span class="hljs-property">LINEAR</span>);
gl.<span class="hljs-title function_">samplerParameteri</span>(sampler, gl.<span class="hljs-property">TEXTURE_MAG_FILTER</span>, gl.<span class="hljs-property">LINEAR</span>);
gl.<span class="hljs-title function_">samplerParameteri</span>(sampler, gl.<span class="hljs-property">TEXTURE_WRAP_S</span>, gl.<span class="hljs-property">REPEAT</span>);
gl.<span class="hljs-title function_">samplerParameteri</span>(sampler, gl.<span class="hljs-property">TEXTURE_WRAP_T</span>, gl.<span class="hljs-property">REPEAT</span>);

gl.<span class="hljs-title function_">bindSampler</span>(<span class="hljs-number">0</span>, sampler); <span class="hljs-comment">// gl.TEXTURE0 ä½¿ç”¨æ­¤é‡‡æ ·å™¨</span>
gl.<span class="hljs-title function_">bindSampler</span>(<span class="hljs-number">1</span>, sampler); <span class="hljs-comment">// gl.TEXTURE1 ä½¿ç”¨æ­¤é‡‡æ ·å™¨</span>

<span class="hljs-comment">// é‡‡æ ·å™¨å‚æ•°ä¼šè¦†ç›–çº¹ç†å¯¹è±¡çš„å‚æ•°</span>
</code></pre>
<p><strong>é‡‡æ ·å™¨å¯¹è±¡çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>åŒä¸€çº¹ç†å¯ä»¥ä½¿ç”¨ä¸åŒçš„é‡‡æ ·å‚æ•°ï¼ˆä¾‹å¦‚ï¼šåŒä¸€çº¹ç†åœ¨ä¸åŒä½ç½®ä½¿ç”¨ä¸åŒçš„è¿‡æ»¤æ¨¡å¼ï¼‰</li>
<li>å‡å°‘çº¹ç†å¯¹è±¡çš„çŠ¶æ€åˆ‡æ¢å¼€é”€</li>
<li>æ›´çµæ´»çš„çº¹ç†é‡‡æ ·é…ç½®</li>
</ul>
<h2 data-id="heading-26">ç€è‰²å™¨æ¥å£</h2>
<p>ç€è‰²å™¨æ¥å£ç”¨äºç¼–è¯‘ GLSL ç€è‰²å™¨ä»£ç å¹¶é“¾æ¥æˆå¯æ‰§è¡Œçš„ç€è‰²å™¨ç¨‹åº (Program)ï¼Œä»¥åŠç®¡ç†ç€è‰²å™¨ä¸­çš„å˜é‡ï¼ˆAttributeã€Uniformï¼‰ã€‚</p>
<h3 data-id="heading-27">ç€è‰²å™¨åˆ›å»ºå’Œç¼–è¯‘</h3>
<p>ç€è‰²å™¨ (Shader) ä½¿ç”¨ GLSL è¯­è¨€ç¼–å†™ï¼Œéœ€è¦ç»è¿‡åˆ›å»ºã€ä¸Šä¼ æºç ã€ç¼–è¯‘ä¸‰ä¸ªæ­¥éª¤ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºç€è‰²å™¨å¯¹è±¡</span>
<span class="hljs-keyword">const</span> vertexShader = gl.<span class="hljs-title function_">createShader</span>(gl.<span class="hljs-property">VERTEX_SHADER</span>);
<span class="hljs-keyword">const</span> fragmentShader = gl.<span class="hljs-title function_">createShader</span>(gl.<span class="hljs-property">FRAGMENT_SHADER</span>);

<span class="hljs-comment">// ä¸Šä¼ ç€è‰²å™¨æºç </span>
<span class="hljs-keyword">const</span> vertexSource = <span class="hljs-string">`
  attribute vec3 aPosition;
  uniform mat4 uMVPMatrix;
  void main() {
    gl_Position = uMVPMatrix * vec4(aPosition, 1.0);
  }
`</span>;
gl.<span class="hljs-title function_">shaderSource</span>(vertexShader, vertexSource);

<span class="hljs-comment">// ç¼–è¯‘ç€è‰²å™¨</span>
gl.<span class="hljs-title function_">compileShader</span>(vertexShader);
</code></pre>
<p>ç€è‰²å™¨ç¼–è¯‘é”™è¯¯å¤„ç†ï¼šç¼–è¯‘ç€è‰²å™¨åï¼Œå¯ä»¥è·å–é”™è¯¯ä¿¡æ¯ç”¨äºè°ƒè¯•ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">compileShader</span>(<span class="hljs-params">gl, type, source</span>) {
  <span class="hljs-keyword">const</span> shader = gl.<span class="hljs-title function_">createShader</span>(type);
  gl.<span class="hljs-title function_">shaderSource</span>(shader, source);
  gl.<span class="hljs-title function_">compileShader</span>(shader);

  <span class="hljs-comment">// æ£€æŸ¥ç¼–è¯‘çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> success = gl.<span class="hljs-title function_">getShaderParameter</span>(shader, gl.<span class="hljs-property">COMPILE_STATUS</span>);
  <span class="hljs-keyword">if</span> (!success) {
    <span class="hljs-comment">// è·å–ç¼–è¯‘é”™è¯¯æ—¥å¿—</span>
    <span class="hljs-keyword">const</span> log = gl.<span class="hljs-title function_">getShaderInfoLog</span>(shader);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Shader compilation failed: <span class="hljs-subst">${log}</span>`</span>);
    gl.<span class="hljs-title function_">deleteShader</span>(shader);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">return</span> shader;
}
</code></pre>
<p>å¸¸è§ç¼–è¯‘é”™è¯¯ï¼š</p>
<ul>
<li>è¯­æ³•é”™è¯¯ï¼šæ‹¼å†™é”™è¯¯ã€ç¼ºå°‘åˆ†å·ç­‰</li>
<li>ç±»å‹ä¸åŒ¹é…ï¼š<code>vec3</code> èµ‹å€¼ç»™ <code>vec4</code></li>
<li>æœªå£°æ˜å˜é‡ï¼šä½¿ç”¨äº†æœªå®šä¹‰çš„ Uniform æˆ– Attribute</li>
<li>GLSL ç‰ˆæœ¬ä¸å…¼å®¹ï¼šWebGL1 åªæ”¯æŒ GLSL ES 1.00</li>
</ul>
<h3 data-id="heading-28">ç¨‹åºåˆ›å»ºå’Œé“¾æ¥</h3>
<p>å°†é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨é“¾æ¥æˆä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºç¨‹åºå¯¹è±¡</span>
<span class="hljs-keyword">const</span> program = gl.<span class="hljs-title function_">createProgram</span>();

<span class="hljs-comment">// é™„åŠ ç€è‰²å™¨</span>
gl.<span class="hljs-title function_">attachShader</span>(program, vertexShader);
gl.<span class="hljs-title function_">attachShader</span>(program, fragmentShader);

<span class="hljs-comment">// é“¾æ¥ç¨‹åº</span>
gl.<span class="hljs-title function_">linkProgram</span>(program);

<span class="hljs-comment">// ä½¿ç”¨ç¨‹åº</span>
gl.<span class="hljs-title function_">useProgram</span>(program);
</code></pre>
<p>ç¨‹åºé“¾æ¥é”™è¯¯å¤„ç†ï¼šé“¾æ¥ç¨‹åºåï¼Œå¯ä»¥æ£€æŸ¥é“¾æ¥çŠ¶æ€ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createProgram</span>(<span class="hljs-params">gl, vertexShader, fragmentShader</span>) {
  <span class="hljs-keyword">const</span> program = gl.<span class="hljs-title function_">createProgram</span>();
  gl.<span class="hljs-title function_">attachShader</span>(program, vertexShader);
  gl.<span class="hljs-title function_">attachShader</span>(program, fragmentShader);
  gl.<span class="hljs-title function_">linkProgram</span>(program);

  <span class="hljs-comment">// æ£€æŸ¥é“¾æ¥çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> success = gl.<span class="hljs-title function_">getProgramParameter</span>(program, gl.<span class="hljs-property">LINK_STATUS</span>);
  <span class="hljs-keyword">if</span> (!success) {
    <span class="hljs-comment">// è·å–é“¾æ¥é”™è¯¯æ—¥å¿—</span>
    <span class="hljs-keyword">const</span> log = gl.<span class="hljs-title function_">getProgramInfoLog</span>(program);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Program linking failed: <span class="hljs-subst">${log}</span>`</span>);
    gl.<span class="hljs-title function_">deleteProgram</span>(program);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">return</span> program;
}
</code></pre>
<p>å¸¸è§é“¾æ¥é”™è¯¯ï¼š</p>
<ul>
<li>Varying å˜é‡ä¸åŒ¹é…ï¼šé¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºçš„ Varying ä¸ç‰‡æ®µç€è‰²å™¨è¾“å…¥çš„ä¸ä¸€è‡´</li>
<li>ç¼ºå°‘å¿…éœ€è¾“å‡ºï¼šé¡¶ç‚¹ç€è‰²å™¨æœªå†™å…¥ <code>gl_Position</code>ï¼Œæˆ–ç‰‡æ®µç€è‰²å™¨æœªå†™å…¥ <code>gl_FragColor</code>ï¼ˆWebGL1ï¼‰</li>
<li>Attribute æ•°é‡è¶…é™ï¼šè¶…è¿‡ GPU æ”¯æŒçš„æœ€å¤§ Attribute æ•°é‡ï¼ˆé€šè¿‡ <code>gl.getParameter(gl.MAX_VERTEX_ATTRIBS)</code> æŸ¥è¯¢ï¼‰</li>
</ul>
<h3 data-id="heading-29">Attribute å˜é‡ç®¡ç†</h3>
<p>Attribute å˜é‡ç”¨äºæ¥æ”¶é¡¶ç‚¹æ•°æ®ï¼Œåªèƒ½åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ä½¿ç”¨ã€‚</p>
<p><strong>è·å– Attribute ä½ç½®</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è·å– Attribute å˜é‡çš„ä½ç½®</span>
<span class="hljs-keyword">const</span> positionLoc = gl.<span class="hljs-title function_">getAttribLocation</span>(program, <span class="hljs-string">"aPosition"</span>);

<span class="hljs-comment">// è¿”å›å€¼ï¼š</span>
<span class="hljs-comment">// - éè´Ÿæ•´æ•°ï¼šå˜é‡å­˜åœ¨ä¸”æ´»è·ƒï¼ˆè¢«ç€è‰²å™¨å®é™…ä½¿ç”¨ï¼‰</span>
<span class="hljs-comment">// - -1ï¼šå˜é‡ä¸å­˜åœ¨ï¼Œæˆ–æœªè¢«ä½¿ç”¨ï¼ˆè¢«ç¼–è¯‘å™¨ä¼˜åŒ–æ‰ï¼‰</span>

<span class="hljs-keyword">if</span> (positionLoc === -<span class="hljs-number">1</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Attribute "aPosition" not found or not used'</span>);
}
</code></pre>
<p><strong>ä½¿ç”¨ Attribute å˜é‡</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// GLSL é¡¶ç‚¹ç€è‰²å™¨</span>
<span class="hljs-keyword">const</span> vertexSource = <span class="hljs-string">`
  attribute vec3 aPosition;  // ä½ç½®
  attribute vec3 aColor;     // é¢œè‰²
  varying vec3 vColor;

  void main() {
    gl_Position = vec4(aPosition, 1.0);
    vColor = aColor;
  }
`</span>;

<span class="hljs-comment">// JavaScript</span>
<span class="hljs-keyword">const</span> positionLoc = gl.<span class="hljs-title function_">getAttribLocation</span>(program, <span class="hljs-string">"aPosition"</span>);
<span class="hljs-keyword">const</span> colorLoc = gl.<span class="hljs-title function_">getAttribLocation</span>(program, <span class="hljs-string">"aColor"</span>);

<span class="hljs-comment">// ç»‘å®šä½ç½®æ•°æ®</span>
gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, positionBuffer);
gl.<span class="hljs-title function_">vertexAttribPointer</span>(positionLoc, <span class="hljs-number">3</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
gl.<span class="hljs-title function_">enableVertexAttribArray</span>(positionLoc); <span class="hljs-comment">// å¯ç”¨ Attribute</span>

<span class="hljs-comment">// ç»‘å®šé¢œè‰²æ•°æ®</span>
gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, colorBuffer);
gl.<span class="hljs-title function_">vertexAttribPointer</span>(colorLoc, <span class="hljs-number">3</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
gl.<span class="hljs-title function_">enableVertexAttribArray</span>(colorLoc); <span class="hljs-comment">// å¯ç”¨ Attribute</span>
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li>åªæœ‰è¢«ç€è‰²å™¨å®é™…ä½¿ç”¨çš„ Attribute æ‰ä¼šè¢«ä¿ç•™ï¼Œæœªä½¿ç”¨çš„ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–æ‰</li>
<li>WebGL1 æœ€å¤šæ”¯æŒ 8-16 ä¸ª Attributeï¼ˆè®¾å¤‡ç›¸å…³ï¼Œé€šè¿‡ <code>gl.getParameter(gl.MAX_VERTEX_ATTRIBS)</code> æŸ¥è¯¢ï¼‰</li>
</ul>
<h3 data-id="heading-30">WebGL2 çš„ Attribute ä¼˜åŒ–</h3>
<p>WebGL2 æ”¯æŒåœ¨ GLSL ä¸­ä½¿ç”¨ <code>layout(location = N)</code> æ˜¾å¼æŒ‡å®š Attribute ä½ç½®ï¼Œæ— éœ€è°ƒç”¨ <code>getAttribLocation</code>ï¼Œå¯ä»¥æé«˜æ€§èƒ½å¹¶ç®€åŒ–ä»£ç ã€‚</p>
<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-glsl" lang="glsl">// WebGL2 GLSL ES 3.00 é¡¶ç‚¹ç€è‰²å™¨
#version 300 es
layout(location = 0) in vec3 aPosition;  // æ˜¾å¼æŒ‡å®šä½ç½®ä¸º 0
layout(location = 1) in vec3 aColor;     // æ˜¾å¼æŒ‡å®šä½ç½®ä¸º 1

out vec3 vColor;

void main() {
  gl_Position = vec4(aPosition, 1.0);
  vColor = aColor;
}
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JavaScript ä¸­ç›´æ¥ä½¿ç”¨æŒ‡å®šçš„ä½ç½®ï¼Œæ— éœ€ getAttribLocation</span>
gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, positionBuffer);
gl.<span class="hljs-title function_">vertexAttribPointer</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// ä½ç½® 0</span>
gl.<span class="hljs-title function_">enableVertexAttribArray</span>(<span class="hljs-number">0</span>);

gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ARRAY_BUFFER</span>, colorBuffer);
gl.<span class="hljs-title function_">vertexAttribPointer</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-literal">false</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// ä½ç½® 1</span>
gl.<span class="hljs-title function_">enableVertexAttribArray</span>(<span class="hljs-number">1</span>);
</code></pre>
<p><strong>WebGL1 ä¸ WebGL2 å¯¹æ¯”</strong>ï¼š</p>

























<table><thead><tr><th>ç‰¹æ€§</th><th>WebGL1</th><th>WebGL2</th></tr></thead><tbody><tr><td>Attribute å£°æ˜</td><td><code>attribute vec3 aPosition;</code></td><td><code>in vec3 aPosition;</code> æˆ– <code>layout(location = 0) in vec3 aPosition;</code></td></tr><tr><td>è·å–ä½ç½®</td><td>å¿…é¡»ä½¿ç”¨ <code>getAttribLocation</code></td><td>å¯ä»¥ä½¿ç”¨ <code>layout(location)</code> æ˜¾å¼æŒ‡å®šï¼Œæˆ–ä½¿ç”¨ <code>getAttribLocation</code></td></tr><tr><td>æœ€å¤§æ•°é‡</td><td>8-16 ä¸ªï¼ˆè®¾å¤‡ç›¸å…³ï¼‰</td><td>è‡³å°‘ 16 ä¸ª</td></tr></tbody></table>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>é¿å…è¿è¡Œæ—¶æŸ¥è¯¢ä½ç½®çš„å¼€é”€</li>
<li>ä»£ç æ›´æ¸…æ™°ï¼ŒAttribute ä½ç½®åœ¨ç€è‰²å™¨ä¸­æ˜ç¡®å®šä¹‰</li>
<li>ä¾¿äºå¤šä¸ªç€è‰²å™¨ç¨‹åºå…±äº«ç›¸åŒçš„ Attribute å¸ƒå±€</li>
</ul>
<h3 data-id="heading-31">Uniform å˜é‡ç®¡ç†</h3>
<p>Uniform å˜é‡ç”¨äºä¼ é€’å¸¸é‡æ•°æ®ï¼ˆå¦‚å˜æ¢çŸ©é˜µã€å…‰ç…§å‚æ•°ï¼‰ï¼Œå¯åœ¨é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨ä¸­ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è·å– Uniform å˜é‡çš„ä½ç½®</span>
<span class="hljs-keyword">const</span> mvpMatrixLoc = gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">"uMVPMatrix"</span>);
<span class="hljs-keyword">const</span> colorLoc = gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">"uColor"</span>);

<span class="hljs-comment">// è¿”å›å€¼ï¼š</span>
<span class="hljs-comment">// - WebGLUniformLocation å¯¹è±¡ï¼šå˜é‡å­˜åœ¨ä¸”æ´»è·ƒ</span>
<span class="hljs-comment">// - nullï¼šå˜é‡ä¸å­˜åœ¨ï¼Œæˆ–æœªè¢«ä½¿ç”¨</span>

<span class="hljs-keyword">if</span> (!mvpMatrixLoc) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'Uniform "uMVPMatrix" not found or not used'</span>);
}
</code></pre>
<p><strong>ä¸Šä¼  Uniform æ•°æ®</strong>ï¼š</p>
<p>æ ¹æ® Uniform ç±»å‹ä½¿ç”¨ä¸åŒçš„ <code>uniform</code> å‡½æ•°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ ‡é‡ï¼ˆScalarï¼‰</span>
gl.<span class="hljs-title function_">uniform1f</span>(colorLoc, <span class="hljs-number">1.0</span>); <span class="hljs-comment">// float</span>
gl.<span class="hljs-title function_">uniform1i</span>(textureLoc, <span class="hljs-number">0</span>); <span class="hljs-comment">// int / sampler2D</span>

<span class="hljs-comment">// å‘é‡ï¼ˆVectorï¼‰</span>
gl.<span class="hljs-title function_">uniform2f</span>(resolutionLoc, <span class="hljs-number">800</span>, <span class="hljs-number">600</span>); <span class="hljs-comment">// vec2</span>
gl.<span class="hljs-title function_">uniform3f</span>(colorLoc, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>); <span class="hljs-comment">// vec3</span>
gl.<span class="hljs-title function_">uniform4f</span>(colorLoc, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>); <span class="hljs-comment">// vec4</span>

<span class="hljs-comment">// ä½¿ç”¨æ•°ç»„</span>
gl.<span class="hljs-title function_">uniform3fv</span>(colorLoc, [<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>]); <span class="hljs-comment">// vec3</span>

<span class="hljs-comment">// çŸ©é˜µï¼ˆMatrixï¼‰</span>
<span class="hljs-keyword">const</span> matrix = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]);
gl.<span class="hljs-title function_">uniformMatrix4fv</span>(
  mvpMatrixLoc,
  <span class="hljs-literal">false</span>, <span class="hljs-comment">// transposeï¼ˆWebGL å¿…é¡»ä¸º falseï¼‰</span>
  matrix
);
</code></pre>
<p><strong>Uniform ç±»å‹å¯¹ç…§è¡¨</strong>ï¼š</p>























































<table><thead><tr><th>GLSL ç±»å‹</th><th>JavaScript å‡½æ•°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>float</code></td><td><code>uniform1f(loc, v)</code></td><td><code>gl.uniform1f(loc, 1.0)</code></td></tr><tr><td><code>vec2</code></td><td><code>uniform2f(loc, x, y)</code> æˆ– <code>uniform2fv(loc, [x, y])</code></td><td><code>gl.uniform2f(loc, 1.0, 2.0)</code></td></tr><tr><td><code>vec3</code></td><td><code>uniform3f(loc, x, y, z)</code> æˆ– <code>uniform3fv(loc, [x, y, z])</code></td><td><code>gl.uniform3fv(loc, [1, 0, 0])</code></td></tr><tr><td><code>vec4</code></td><td><code>uniform4f(loc, x, y, z, w)</code> æˆ– <code>uniform4fv(loc, [x, y, z, w])</code></td><td><code>gl.uniform4fv(loc, [1, 0, 0, 1])</code></td></tr><tr><td><code>int</code> / <code>bool</code></td><td><code>uniform1i(loc, v)</code></td><td><code>gl.uniform1i(loc, 1)</code></td></tr><tr><td><code>sampler2D</code></td><td><code>uniform1i(loc, unit)</code></td><td><code>gl.uniform1i(loc, 0)</code></td></tr><tr><td><code>mat2</code></td><td><code>uniformMatrix2fv(loc, false, data)</code></td><td><code>gl.uniformMatrix2fv(loc, false, mat2)</code></td></tr><tr><td><code>mat3</code></td><td><code>uniformMatrix3fv(loc, false, data)</code></td><td><code>gl.uniformMatrix3fv(loc, false, mat3)</code></td></tr><tr><td><code>mat4</code></td><td><code>uniformMatrix4fv(loc, false, data)</code></td><td><code>gl.uniformMatrix4fv(loc, false, mat4)</code></td></tr></tbody></table>
<p><strong>Uniform æ•°ç»„</strong>ï¼š</p>
<pre><code class="hljs language-glsl" lang="glsl">// GLSL ä¸­å®šä¹‰ Uniform æ•°ç»„
uniform vec3 uLightPositions[4];
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JavaScript ä¸­ä¸Šä¼ æ•°ç»„</span>
<span class="hljs-keyword">const</span> positions = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([
  <span class="hljs-number">1</span>,
  <span class="hljs-number">2</span>,
  <span class="hljs-number">3</span>, <span class="hljs-comment">// å…‰æº 0</span>
  <span class="hljs-number">4</span>,
  <span class="hljs-number">5</span>,
  <span class="hljs-number">6</span>, <span class="hljs-comment">// å…‰æº 1</span>
  <span class="hljs-number">7</span>,
  <span class="hljs-number">8</span>,
  <span class="hljs-number">9</span>, <span class="hljs-comment">// å…‰æº 2</span>
  <span class="hljs-number">10</span>,
  <span class="hljs-number">11</span>,
  <span class="hljs-number">12</span>, <span class="hljs-comment">// å…‰æº 3</span>
]);
<span class="hljs-keyword">const</span> loc = gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">"uLightPositions"</span>);
gl.<span class="hljs-title function_">uniform3fv</span>(loc, positions);

<span class="hljs-comment">// æˆ–è€…å•ç‹¬è®¾ç½®æ¯ä¸ªå…ƒç´ </span>
<span class="hljs-keyword">const</span> loc0 = gl.<span class="hljs-title function_">getUniformLocation</span>(program, <span class="hljs-string">"uLightPositions[0]"</span>);
gl.<span class="hljs-title function_">uniform3f</span>(loc0, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
</code></pre>
<p><strong>æ€§èƒ½å»ºè®®</strong>ï¼š</p>
<ul>
<li>Uniform ä¸Šä¼ æœ‰æ€§èƒ½å¼€é”€ï¼Œé¿å…æ¯å¸§ä¸Šä¼ æœªå˜åŒ–çš„ Uniform</li>
<li>å°†å¤šä¸ªæ ‡é‡ Uniform åˆå¹¶ä¸ºå‘é‡ Uniform å¯ä»¥å‡å°‘è°ƒç”¨æ¬¡æ•°</li>
</ul>
<h3 data-id="heading-32">WebGL2 çš„ Uniform Buffer Objects (UBO)</h3>
<p>WebGL2 æ”¯æŒ Uniform Buffer Objectsï¼Œå¯ä»¥å°†å¤šä¸ª Uniform æ‰“åŒ…åˆ°ç¼“å†²åŒºä¸­æ‰¹é‡ä¸Šä¼ ï¼Œç›¸æ¯”é€ä¸ªè°ƒç”¨ <code>uniform*</code> å‡½æ•°æ€§èƒ½æ›´å¥½ã€‚</p>
<p><strong>UBO çš„ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>æ‰¹é‡ä¸Šä¼ å¤šä¸ª Uniformï¼Œå‡å°‘ API è°ƒç”¨æ¬¡æ•°</li>
<li>å¯ä»¥åœ¨å¤šä¸ªç€è‰²å™¨ç¨‹åºä¹‹é—´å…±äº« Uniform æ•°æ®ï¼ˆå¦‚ç›¸æœºçŸ©é˜µã€å…‰ç…§å‚æ•°ï¼‰</li>
<li>æ›´æ–°éƒ¨åˆ† Uniform æ—¶ä½¿ç”¨ <code>bufferSubData</code>ï¼Œæ¯”é€ä¸ªè°ƒç”¨ <code>uniform*</code> æ›´é«˜æ•ˆ</li>
</ul>
<p><strong>ä½¿ç”¨ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-glsl" lang="glsl">// WebGL2 GLSL ES 3.00 é¡¶ç‚¹ç€è‰²å™¨
#version 300 es

// å®šä¹‰ Uniform Block
uniform Matrices {
  mat4 uModelMatrix;
  mat4 uViewMatrix;
  mat4 uProjectionMatrix;
};

in vec3 aPosition;

void main() {
  gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aPosition, 1.0);
}
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// JavaScript åˆ›å»ºå’Œä½¿ç”¨ UBO</span>
<span class="hljs-keyword">const</span> program = <span class="hljs-comment">/* ç¼–è¯‘é“¾æ¥çš„ç€è‰²å™¨ç¨‹åº */</span>;

<span class="hljs-comment">// è·å– Uniform Block çš„ç´¢å¼•</span>
<span class="hljs-keyword">const</span> blockIndex = gl.<span class="hljs-title function_">getUniformBlockIndex</span>(program, <span class="hljs-string">'Matrices'</span>);

<span class="hljs-comment">// å°† Uniform Block ç»‘å®šåˆ°ç»‘å®šç‚¹ 0</span>
gl.<span class="hljs-title function_">uniformBlockBinding</span>(program, blockIndex, <span class="hljs-number">0</span>);

<span class="hljs-comment">// æŸ¥è¯¢ Uniform Block çš„å¤§å°</span>
<span class="hljs-keyword">const</span> blockSize = gl.<span class="hljs-title function_">getActiveUniformBlockParameter</span>(
  program,
  blockIndex,
  gl.<span class="hljs-property">UNIFORM_BLOCK_DATA_SIZE</span>
);

<span class="hljs-comment">// åˆ›å»º UBO</span>
<span class="hljs-keyword">const</span> ubo = gl.<span class="hljs-title function_">createBuffer</span>();
gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">UNIFORM_BUFFER</span>, ubo);
gl.<span class="hljs-title function_">bufferData</span>(gl.<span class="hljs-property">UNIFORM_BUFFER</span>, blockSize, gl.<span class="hljs-property">DYNAMIC_DRAW</span>);

<span class="hljs-comment">// å‡†å¤‡çŸ©é˜µæ•°æ®ï¼ˆ3 ä¸ª mat4 = 3 * 16 * 4 = 192 å­—èŠ‚ï¼‰</span>
<span class="hljs-keyword">const</span> matrices = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-number">48</span>); <span class="hljs-comment">// 3 ä¸ª mat4</span>
matrices.<span class="hljs-title function_">set</span>(modelMatrix, <span class="hljs-number">0</span>);   <span class="hljs-comment">// 0-15</span>
matrices.<span class="hljs-title function_">set</span>(viewMatrix, <span class="hljs-number">16</span>);   <span class="hljs-comment">// 16-31</span>
matrices.<span class="hljs-title function_">set</span>(projMatrix, <span class="hljs-number">32</span>);   <span class="hljs-comment">// 32-47</span>

<span class="hljs-comment">// ä¸Šä¼ æ•°æ®åˆ° UBO</span>
gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">UNIFORM_BUFFER</span>, ubo);
gl.<span class="hljs-title function_">bufferSubData</span>(gl.<span class="hljs-property">UNIFORM_BUFFER</span>, <span class="hljs-number">0</span>, matrices);

<span class="hljs-comment">// å°† UBO ç»‘å®šåˆ°ç»‘å®šç‚¹ 0</span>
gl.<span class="hljs-title function_">bindBufferBase</span>(gl.<span class="hljs-property">UNIFORM_BUFFER</span>, <span class="hljs-number">0</span>, ubo);

<span class="hljs-comment">// ç»˜åˆ¶æ—¶ï¼Œæ‰€æœ‰ä½¿ç”¨è¿™ä¸ª Uniform Block çš„ç€è‰²å™¨ç¨‹åºéƒ½èƒ½è®¿é—®æ•°æ®</span>
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<ul>
<li>Uniform Block çš„å†…å­˜å¸ƒå±€éœ€è¦éµå¾ª <code>std140</code> è§„èŒƒï¼ˆå¯¹é½è§„åˆ™å¤æ‚ï¼‰</li>
<li>å¯ä»¥é€šè¿‡ <code>getActiveUniforms</code> æŸ¥è¯¢æ¯ä¸ª Uniform åœ¨å—ä¸­çš„åç§»é‡</li>
<li>WebGL1 ä¸æ”¯æŒ UBOï¼Œæ²¡æœ‰ç›¸å…³æ‰©å±•</li>
</ul>
<h2 data-id="heading-33">æ¸²æŸ“æ§åˆ¶æ¥å£</h2>
<p>æ¸²æŸ“æ§åˆ¶æ¥å£ç”¨äºé…ç½®æ¸²æŸ“ç®¡é“çš„å›ºå®šåŠŸèƒ½é˜¶æ®µï¼ˆè§†å£ã€æµ‹è¯•ã€æ··åˆç­‰ï¼‰å’Œæ‰§è¡Œç»˜åˆ¶å‘½ä»¤ï¼Œæ§åˆ¶å¦‚ä½•å°†å‡ ä½•æ•°æ®æ¸²æŸ“åˆ°å¸§ç¼“å†²ã€‚</p>
<h3 data-id="heading-34">è§†å£è®¾ç½®</h3>
<p>è§†å£ (Viewport) å®šä¹‰ NDC åæ ‡åˆ°å±å¹•åƒç´ åæ ‡çš„æ˜ å°„åŒºåŸŸã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è®¾ç½®è§†å£ï¼ˆé€šå¸¸ä¸ canvas å°ºå¯¸ä¸€è‡´ï¼‰</span>
gl.<span class="hljs-title function_">viewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.<span class="hljs-property">width</span>, canvas.<span class="hljs-property">height</span>);
<span class="hljs-comment">// å‚æ•°ï¼šx, y, width, heightï¼ˆåƒç´ å•ä½ï¼‰</span>

<span class="hljs-comment">// ç¤ºä¾‹ï¼šæ¸²æŸ“åˆ°å·¦åŠå±</span>
gl.<span class="hljs-title function_">viewport</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, canvas.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>, canvas.<span class="hljs-property">height</span>);

<span class="hljs-comment">// æŸ¥è¯¢å½“å‰è§†å£</span>
<span class="hljs-keyword">const</span> viewport = gl.<span class="hljs-title function_">getParameter</span>(gl.<span class="hljs-property">VIEWPORT</span>); <span class="hljs-comment">// [x, y, width, height]</span>
</code></pre>
<p>è§†å£å˜æ¢å°† NDC èŒƒå›´ <code>[-1, 1]</code> æ˜ å°„åˆ°å±å¹•åƒç´ åæ ‡ï¼š</p>
<ul>
<li>NDC <code>(-1, -1)</code> â†’ å±å¹• <code>(x, y)</code></li>
<li>NDC <code>(1, 1)</code> â†’ å±å¹• <code>(x + width, y + height)</code></li>
</ul>
<h3 data-id="heading-35">è£å‰ªæµ‹è¯• (Scissor Test)</h3>
<p>è£å‰ªæµ‹è¯•é™åˆ¶æ¸²æŸ“åˆ°ä¸€ä¸ªçŸ©å½¢åŒºåŸŸï¼ŒåŒºåŸŸå¤–çš„åƒç´ è¢«ä¸¢å¼ƒã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯ç”¨è£å‰ªæµ‹è¯•</span>
gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">SCISSOR_TEST</span>);

<span class="hljs-comment">// è®¾ç½®è£å‰ªçŸ©å½¢</span>
gl.<span class="hljs-title function_">scissor</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">200</span>); <span class="hljs-comment">// x, y, width, height</span>

<span class="hljs-comment">// ç¦ç”¨è£å‰ªæµ‹è¯•</span>
gl.<span class="hljs-title function_">disable</span>(gl.<span class="hljs-property">SCISSOR_TEST</span>);
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>åˆ†å±æ¸²æŸ“ï¼ˆå¤šè§†å£ï¼‰</li>
<li>UI è£å‰ªï¼ˆé™åˆ¶ç»˜åˆ¶åŒºåŸŸï¼‰</li>
<li>ä¼˜åŒ–æ€§èƒ½ï¼ˆåªæ¸²æŸ“å¯è§åŒºåŸŸï¼‰</li>
</ul>
<h3 data-id="heading-36">æ·±åº¦æµ‹è¯• (Depth Test)</h3>
<p>æ·±åº¦æµ‹è¯•æ ¹æ®æ·±åº¦å€¼å†³å®šç‰‡æ®µæ˜¯å¦å¯è§ï¼Œå®ç° 3D ç‰©ä½“çš„é®æŒ¡å…³ç³»ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯ç”¨æ·±åº¦æµ‹è¯•</span>
gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">DEPTH_TEST</span>);

<span class="hljs-comment">// è®¾ç½®æ·±åº¦æ¯”è¾ƒå‡½æ•°</span>
gl.<span class="hljs-title function_">depthFunc</span>(gl.<span class="hljs-property">LESS</span>); <span class="hljs-comment">// æ·±åº¦å€¼æ›´å°ï¼ˆæ›´è¿‘ï¼‰æ—¶é€šè¿‡</span>

<span class="hljs-comment">// æ§åˆ¶æ·±åº¦ç¼“å†²åŒºæ˜¯å¦å¯å†™</span>
gl.<span class="hljs-title function_">depthMask</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// å…è®¸å†™å…¥æ·±åº¦å€¼</span>

<span class="hljs-comment">// ç¦ç”¨æ·±åº¦æµ‹è¯•</span>
gl.<span class="hljs-title function_">disable</span>(gl.<span class="hljs-property">DEPTH_TEST</span>);
</code></pre>
<p><strong>æ·±åº¦æ¯”è¾ƒå‡½æ•°</strong>ï¼š</p>









































<table><thead><tr><th>å¸¸é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>gl.NEVER</code></td><td>æ°¸ä¸é€šè¿‡</td></tr><tr><td><code>gl.ALWAYS</code></td><td>æ€»æ˜¯é€šè¿‡</td></tr><tr><td><code>gl.LESS</code></td><td>æ·±åº¦å€¼ &lt; å½“å‰å€¼æ—¶é€šè¿‡ï¼ˆé»˜è®¤ï¼Œç”¨äºæ­£å¸¸ 3D æ¸²æŸ“ï¼‰</td></tr><tr><td><code>gl.LEQUAL</code></td><td>æ·±åº¦å€¼ â‰¤ å½“å‰å€¼æ—¶é€šè¿‡</td></tr><tr><td><code>gl.EQUAL</code></td><td>æ·±åº¦å€¼ = å½“å‰å€¼æ—¶é€šè¿‡</td></tr><tr><td><code>gl.GEQUAL</code></td><td>æ·±åº¦å€¼ â‰¥ å½“å‰å€¼æ—¶é€šè¿‡</td></tr><tr><td><code>gl.GREATER</code></td><td>æ·±åº¦å€¼ &gt; å½“å‰å€¼æ—¶é€šè¿‡</td></tr><tr><td><code>gl.NOTEQUAL</code></td><td>æ·±åº¦å€¼ â‰  å½“å‰å€¼æ—¶é€šè¿‡</td></tr></tbody></table>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li>éœ€è¦åœ¨åˆ›å»º WebGL ä¸Šä¸‹æ–‡æ—¶è¯·æ±‚æ·±åº¦ç¼“å†²åŒºï¼š<code>gl = canvas.getContext('webgl', { depth: true })</code>ï¼ˆé»˜è®¤ä¸º trueï¼‰</li>
<li>æ·±åº¦å€¼èŒƒå›´ä¸º <code>[0, 1]</code>ï¼Œ0 è¡¨ç¤ºè¿‘å¹³é¢ï¼Œ1 è¡¨ç¤ºè¿œå¹³é¢</li>
</ul>
<h3 data-id="heading-37">æ¨¡æ¿æµ‹è¯• (Stencil Test)</h3>
<p>æ¨¡æ¿æµ‹è¯•ä½¿ç”¨æ¨¡æ¿ç¼“å†²åŒºè¿›è¡Œåƒç´ çº§çš„é®ç½©æ§åˆ¶ï¼Œå®ç°å¤æ‚çš„æ¸²æŸ“æ•ˆæœã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯ç”¨æ¨¡æ¿æµ‹è¯•</span>
gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">STENCIL_TEST</span>);

<span class="hljs-comment">// è®¾ç½®æ¨¡æ¿æ¯”è¾ƒå‡½æ•°</span>
gl.<span class="hljs-title function_">stencilFunc</span>(
  gl.<span class="hljs-property">EQUAL</span>, <span class="hljs-comment">// æ¯”è¾ƒå‡½æ•°</span>
  <span class="hljs-number">1</span>, <span class="hljs-comment">// å‚è€ƒå€¼</span>
  <span class="hljs-number">0xff</span> <span class="hljs-comment">// æ©ç </span>
);

<span class="hljs-comment">// è®¾ç½®æ¨¡æ¿æ“ä½œï¼ˆæµ‹è¯•å¤±è´¥ã€æ·±åº¦æµ‹è¯•å¤±è´¥ã€ä¸¤è€…éƒ½é€šè¿‡æ—¶çš„æ“ä½œï¼‰</span>
gl.<span class="hljs-title function_">stencilOp</span>(
  gl.<span class="hljs-property">KEEP</span>, <span class="hljs-comment">// æ¨¡æ¿æµ‹è¯•å¤±è´¥æ—¶ï¼šä¿æŒ</span>
  gl.<span class="hljs-property">KEEP</span>, <span class="hljs-comment">// æ·±åº¦æµ‹è¯•å¤±è´¥æ—¶ï¼šä¿æŒ</span>
  gl.<span class="hljs-property">REPLACE</span> <span class="hljs-comment">// ä¸¤è€…éƒ½é€šè¿‡æ—¶ï¼šæ›¿æ¢ä¸ºå‚è€ƒå€¼</span>
);

<span class="hljs-comment">// æ§åˆ¶æ¨¡æ¿ç¼“å†²åŒºçš„å†™å…¥æ©ç </span>
gl.<span class="hljs-title function_">stencilMask</span>(<span class="hljs-number">0xff</span>); <span class="hljs-comment">// å…è®¸å†™å…¥æ‰€æœ‰ä½</span>

<span class="hljs-comment">// ç¦ç”¨æ¨¡æ¿æµ‹è¯•</span>
gl.<span class="hljs-title function_">disable</span>(gl.<span class="hljs-property">STENCIL_TEST</span>);
</code></pre>
<p><strong>æ¨¡æ¿æ“ä½œå¸¸é‡</strong>ï¼š</p>









































<table><thead><tr><th>å¸¸é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>gl.KEEP</code></td><td>ä¿æŒå½“å‰å€¼</td></tr><tr><td><code>gl.ZERO</code></td><td>è®¾ç½®ä¸º 0</td></tr><tr><td><code>gl.REPLACE</code></td><td>æ›¿æ¢ä¸ºå‚è€ƒå€¼</td></tr><tr><td><code>gl.INCR</code></td><td>é€’å¢ï¼ˆä¸æº¢å‡ºï¼‰</td></tr><tr><td><code>gl.INCR_WRAP</code></td><td>é€’å¢ï¼ˆæº¢å‡ºæ—¶å›ç»•ï¼‰</td></tr><tr><td><code>gl.DECR</code></td><td>é€’å‡ï¼ˆä¸æº¢å‡ºï¼‰</td></tr><tr><td><code>gl.DECR_WRAP</code></td><td>é€’å‡ï¼ˆæº¢å‡ºæ—¶å›ç»•ï¼‰</td></tr><tr><td><code>gl.INVERT</code></td><td>æŒ‰ä½å–å</td></tr></tbody></table>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>é•œé¢åå°„ï¼ˆåªåœ¨é•œé¢åŒºåŸŸæ¸²æŸ“åå°„ï¼‰</li>
<li>é˜´å½±ä½“ (Shadow Volume)</li>
<li>è½®å»“æ¸²æŸ“</li>
<li>é®ç½©æ•ˆæœ</li>
</ul>
<h3 data-id="heading-38">é¢œè‰²æ··åˆ (Blending)</h3>
<p>é¢œè‰²æ··åˆç”¨äºå®ç°åŠé€æ˜æ•ˆæœï¼Œå°†ç‰‡æ®µé¢œè‰²ä¸å¸§ç¼“å†²åŒºé¢œè‰²æ··åˆã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯ç”¨æ··åˆ</span>
gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">BLEND</span>);

<span class="hljs-comment">// è®¾ç½®æ··åˆå‡½æ•°ï¼ˆæºå› å­ã€ç›®æ ‡å› å­ï¼‰</span>
gl.<span class="hljs-title function_">blendFunc</span>(gl.<span class="hljs-property">SRC_ALPHA</span>, gl.<span class="hljs-property">ONE_MINUS_SRC_ALPHA</span>); <span class="hljs-comment">// æ ‡å‡† Alpha æ··åˆ</span>

<span class="hljs-comment">// è®¾ç½®æ··åˆæ–¹ç¨‹</span>
gl.<span class="hljs-title function_">blendEquation</span>(gl.<span class="hljs-property">FUNC_ADD</span>); <span class="hljs-comment">// åŠ æ³•æ··åˆï¼ˆé»˜è®¤ï¼‰</span>

<span class="hljs-comment">// åˆ†åˆ«è®¾ç½® RGB å’Œ Alpha çš„æ··åˆå‡½æ•°</span>
gl.<span class="hljs-title function_">blendFuncSeparate</span>(
  gl.<span class="hljs-property">SRC_ALPHA</span>,
  gl.<span class="hljs-property">ONE_MINUS_SRC_ALPHA</span>, <span class="hljs-comment">// RGB æ··åˆå› å­</span>
  gl.<span class="hljs-property">ONE</span>,
  gl.<span class="hljs-property">ZERO</span> <span class="hljs-comment">// Alpha æ··åˆå› å­</span>
);

<span class="hljs-comment">// ç¦ç”¨æ··åˆ</span>
gl.<span class="hljs-title function_">disable</span>(gl.<span class="hljs-property">BLEND</span>);
</code></pre>
<p><strong>æ··åˆæ–¹ç¨‹</strong>ï¼š</p>
<pre><code class="hljs">æœ€ç»ˆé¢œè‰² = æºé¢œè‰² Ã— æºå› å­ âŠ• ç›®æ ‡é¢œè‰² Ã— ç›®æ ‡å› å­
</code></pre>
<p>å…¶ä¸­ <code>âŠ•</code> ç”± <code>blendEquation</code> æŒ‡å®šã€‚</p>
<p><strong>å¸¸ç”¨æ··åˆå› å­</strong>ï¼š</p>

















































<table><thead><tr><th>å¸¸é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>gl.ZERO</code></td><td>0</td></tr><tr><td><code>gl.ONE</code></td><td>1</td></tr><tr><td><code>gl.SRC_COLOR</code></td><td>æºé¢œè‰²</td></tr><tr><td><code>gl.ONE_MINUS_SRC_COLOR</code></td><td>1 - æºé¢œè‰²</td></tr><tr><td><code>gl.SRC_ALPHA</code></td><td>æº Alpha</td></tr><tr><td><code>gl.ONE_MINUS_SRC_ALPHA</code></td><td>1 - æº Alpha</td></tr><tr><td><code>gl.DST_COLOR</code></td><td>ç›®æ ‡é¢œè‰²</td></tr><tr><td><code>gl.ONE_MINUS_DST_COLOR</code></td><td>1 - ç›®æ ‡é¢œè‰²</td></tr><tr><td><code>gl.DST_ALPHA</code></td><td>ç›®æ ‡ Alpha</td></tr><tr><td><code>gl.ONE_MINUS_DST_ALPHA</code></td><td>1 - ç›®æ ‡ Alpha</td></tr></tbody></table>
<p><strong>å¸¸ç”¨æ··åˆæ–¹ç¨‹</strong>ï¼š</p>





























<table><thead><tr><th>å¸¸é‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>gl.FUNC_ADD</code></td><td>åŠ æ³•ï¼šæº + ç›®æ ‡</td></tr><tr><td><code>gl.FUNC_SUBTRACT</code></td><td>å‡æ³•ï¼šæº - ç›®æ ‡</td></tr><tr><td><code>gl.FUNC_REVERSE_SUBTRACT</code></td><td>åå‘å‡æ³•ï¼šç›®æ ‡ - æº</td></tr><tr><td><code>gl.MIN</code></td><td>æœ€å°å€¼ï¼ˆWebGL2ï¼‰</td></tr><tr><td><code>gl.MAX</code></td><td>æœ€å¤§å€¼ï¼ˆWebGL2ï¼‰</td></tr></tbody></table>
<p><strong>æ ‡å‡† Alpha æ··åˆç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¸²æŸ“åŠé€æ˜ç‰©ä½“</span>
gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">BLEND</span>);
gl.<span class="hljs-title function_">blendFunc</span>(gl.<span class="hljs-property">SRC_ALPHA</span>, gl.<span class="hljs-property">ONE_MINUS_SRC_ALPHA</span>);

<span class="hljs-comment">// ç‰‡æ®µç€è‰²å™¨è¾“å‡ºåŠé€æ˜é¢œè‰²</span>
<span class="hljs-comment">// gl_FragColor = vec4(1.0, 0.0, 0.0, 0.5);  // åŠé€æ˜çº¢è‰²</span>

<span class="hljs-comment">// æ··åˆè®¡ç®—ï¼š</span>
<span class="hljs-comment">// æœ€ç»ˆé¢œè‰² = (1, 0, 0, 0.5) Ã— 0.5 + å¸§ç¼“å†²é¢œè‰² Ã— (1 - 0.5)</span>
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li>åŠé€æ˜æ¸²æŸ“éœ€è¦ä»åå¾€å‰æ’åºï¼ˆè¿œåˆ°è¿‘ï¼‰</li>
<li>æ·±åº¦å†™å…¥é€šå¸¸éœ€è¦ç¦ç”¨ï¼š<code>gl.depthMask(false)</code></li>
</ul>
<h3 data-id="heading-39">é¢å‰”é™¤ (Face Culling)</h3>
<p>é¢å‰”é™¤æ ¹æ®ä¸‰è§’å½¢çš„æ­£åé¢å‰”é™¤ä¸å¯è§çš„é¢ï¼Œæé«˜æ¸²æŸ“æ€§èƒ½ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯ç”¨é¢å‰”é™¤</span>
gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">CULL_FACE</span>);

<span class="hljs-comment">// è®¾ç½®å‰”é™¤çš„é¢</span>
gl.<span class="hljs-title function_">cullFace</span>(gl.<span class="hljs-property">BACK</span>); <span class="hljs-comment">// å‰”é™¤èƒŒé¢ï¼ˆé»˜è®¤ï¼‰</span>
<span class="hljs-comment">// gl.cullFace(gl.FRONT);  // å‰”é™¤æ­£é¢</span>
<span class="hljs-comment">// gl.cullFace(gl.FRONT_AND_BACK);  // å‰”é™¤æ­£åé¢</span>

<span class="hljs-comment">// è®¾ç½®æ­£é¢çš„å®šä¹‰ï¼ˆé¡¶ç‚¹ç¯ç»•é¡ºåºï¼‰</span>
gl.<span class="hljs-title function_">frontFace</span>(gl.<span class="hljs-property">CCW</span>); <span class="hljs-comment">// é€†æ—¶é’ˆä¸ºæ­£é¢ï¼ˆé»˜è®¤ï¼‰</span>
<span class="hljs-comment">// gl.frontFace(gl.CW);    // é¡ºæ—¶é’ˆä¸ºæ­£é¢</span>

<span class="hljs-comment">// ç¦ç”¨é¢å‰”é™¤</span>
gl.<span class="hljs-title function_">disable</span>(gl.<span class="hljs-property">CULL_FACE</span>);
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>å°é—­æ¨¡å‹ï¼ˆå¦‚ç«‹æ–¹ä½“ã€çƒä½“ï¼‰åªéœ€æ¸²æŸ“æ­£é¢</li>
<li>å‡å°‘çº¦ 50% çš„ç‰‡æ®µå¤„ç†é‡</li>
</ul>
<h3 data-id="heading-40">ç»˜åˆ¶å‘½ä»¤</h3>
<p>æ‰§è¡Œå®é™…çš„æ¸²æŸ“æ“ä½œï¼Œå°†é¡¶ç‚¹æ•°æ®é€šè¿‡æ¸²æŸ“ç®¡é“è½¬æ¢ä¸ºå±å¹•åƒç´ ã€‚</p>
<p><strong>ä½¿ç”¨é¡¶ç‚¹æ•°ç»„ç»˜åˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç»˜åˆ¶ä¸‰è§’å½¢</span>
gl.<span class="hljs-title function_">drawArrays</span>(
  gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-comment">// å›¾å…ƒç±»å‹</span>
  <span class="hljs-number">0</span>, <span class="hljs-comment">// èµ·å§‹é¡¶ç‚¹ç´¢å¼•</span>
  <span class="hljs-number">3</span> <span class="hljs-comment">// é¡¶ç‚¹æ•°é‡</span>
);

<span class="hljs-comment">// å…¶ä»–å›¾å…ƒç±»å‹</span>
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">POINTS</span>, <span class="hljs-number">0</span>, count); <span class="hljs-comment">// ç‚¹</span>
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">LINES</span>, <span class="hljs-number">0</span>, count); <span class="hljs-comment">// çº¿æ®µï¼ˆæ¯ 2 ä¸ªé¡¶ç‚¹ï¼‰</span>
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">LINE_STRIP</span>, <span class="hljs-number">0</span>, count); <span class="hljs-comment">// è¿ç»­çº¿æ®µ</span>
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">LINE_LOOP</span>, <span class="hljs-number">0</span>, count); <span class="hljs-comment">// é—­åˆçº¿æ®µ</span>
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">TRIANGLE_STRIP</span>, <span class="hljs-number">0</span>, count); <span class="hljs-comment">// ä¸‰è§’å½¢å¸¦</span>
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">TRIANGLE_FAN</span>, <span class="hljs-number">0</span>, count); <span class="hljs-comment">// ä¸‰è§’å½¢æ‰‡</span>
</code></pre>
<p><strong>ä½¿ç”¨ç´¢å¼•ç¼“å†²åŒºç»˜åˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç»‘å®šç´¢å¼•ç¼“å†²åŒº</span>
gl.<span class="hljs-title function_">bindBuffer</span>(gl.<span class="hljs-property">ELEMENT_ARRAY_BUFFER</span>, indexBuffer);

<span class="hljs-comment">// ç»˜åˆ¶</span>
gl.<span class="hljs-title function_">drawElements</span>(
  gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-comment">// å›¾å…ƒç±»å‹</span>
  <span class="hljs-number">6</span>, <span class="hljs-comment">// ç´¢å¼•æ•°é‡</span>
  gl.<span class="hljs-property">UNSIGNED_SHORT</span>, <span class="hljs-comment">// ç´¢å¼•ç±»å‹</span>
  <span class="hljs-number">0</span> <span class="hljs-comment">// åç§»é‡ï¼ˆå­—èŠ‚ï¼‰</span>
);
</code></pre>
<p><strong>WebGL2 çš„å®ä¾‹åŒ–æ¸²æŸ“</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç»˜åˆ¶å¤šä¸ªå®ä¾‹ï¼ˆç”¨äºæ¸²æŸ“å¤§é‡ç›¸åŒç‰©ä½“ï¼‰</span>
gl.<span class="hljs-title function_">drawArraysInstanced</span>(gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, <span class="hljs-number">100</span>); <span class="hljs-comment">// ç»˜åˆ¶ 100 ä¸ªå®ä¾‹</span>
gl.<span class="hljs-title function_">drawElementsInstanced</span>(gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-number">6</span>, gl.<span class="hljs-property">UNSIGNED_SHORT</span>, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>);
</code></pre>
<h3 data-id="heading-41">å†™å…¥é®ç½© (Write Mask)</h3>
<p>å†™å…¥é®ç½©æ§åˆ¶å“ªäº›ç¼“å†²åŒºæˆ–é¢œè‰²é€šé“å¯ä»¥è¢«å†™å…¥ï¼Œç”¨äºä¿æŠ¤ç‰¹å®šæ•°æ®ä¸è¢«ä¿®æ”¹ã€‚</p>
<p><strong>é¢œè‰²é®ç½©</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ§åˆ¶ RGBA å„é€šé“æ˜¯å¦å¯å†™</span>
gl.<span class="hljs-title function_">colorMask</span>(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// ç¦æ­¢å†™å…¥ Alpha é€šé“</span>

<span class="hljs-comment">// ç¤ºä¾‹ï¼šåªå†™å…¥çº¢è‰²é€šé“</span>
gl.<span class="hljs-title function_">colorMask</span>(<span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);

<span class="hljs-comment">// æ¢å¤å†™å…¥æ‰€æœ‰é€šé“</span>
gl.<span class="hljs-title function_">colorMask</span>(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
</code></pre>
<p><strong>æ·±åº¦é®ç½©</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ§åˆ¶æ·±åº¦ç¼“å†²åŒºæ˜¯å¦å¯å†™</span>
gl.<span class="hljs-title function_">depthMask</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// ç¦æ­¢å†™å…¥æ·±åº¦å€¼ï¼ˆæ·±åº¦æµ‹è¯•ä»ç„¶æ‰§è¡Œï¼‰</span>

<span class="hljs-comment">// æ¢å¤æ·±åº¦å†™å…¥</span>
gl.<span class="hljs-title function_">depthMask</span>(<span class="hljs-literal">true</span>);
</code></pre>
<p><strong>æ¨¡æ¿é®ç½©</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ§åˆ¶æ¨¡æ¿ç¼“å†²åŒºå“ªäº›ä½å¯å†™</span>
gl.<span class="hljs-title function_">stencilMask</span>(<span class="hljs-number">0xff</span>); <span class="hljs-comment">// å…è®¸å†™å…¥æ‰€æœ‰ä½</span>
gl.<span class="hljs-title function_">stencilMask</span>(<span class="hljs-number">0x00</span>); <span class="hljs-comment">// ç¦æ­¢å†™å…¥ä»»ä½•ä½</span>
gl.<span class="hljs-title function_">stencilMask</span>(<span class="hljs-number">0x0f</span>); <span class="hljs-comment">// åªå…è®¸å†™å…¥ä½ 4 ä½</span>

<span class="hljs-comment">// åˆ†åˆ«è®¾ç½®æ­£åé¢çš„æ¨¡æ¿é®ç½©ï¼ˆWebGL2ï¼‰</span>
gl.<span class="hljs-title function_">stencilMaskSeparate</span>(gl.<span class="hljs-property">FRONT</span>, <span class="hljs-number">0xff</span>); <span class="hljs-comment">// æ­£é¢</span>
gl.<span class="hljs-title function_">stencilMaskSeparate</span>(gl.<span class="hljs-property">BACK</span>, <span class="hljs-number">0x00</span>); <span class="hljs-comment">// èƒŒé¢</span>
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>
<p><strong>æ·±åº¦é®ç½©</strong>ï¼šæ¸²æŸ“åŠé€æ˜ç‰©ä½“æ—¶ç¦æ­¢å†™å…¥æ·±åº¦ï¼Œé¿å…é®æŒ¡åç»­ç‰©ä½“</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ¸²æŸ“åŠé€æ˜ç‰©ä½“</span>
gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">BLEND</span>);
gl.<span class="hljs-title function_">blendFunc</span>(gl.<span class="hljs-property">SRC_ALPHA</span>, gl.<span class="hljs-property">ONE_MINUS_SRC_ALPHA</span>);
gl.<span class="hljs-title function_">depthMask</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// ç¦æ­¢å†™å…¥æ·±åº¦</span>
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-number">0</span>, transparentObjectCount);
gl.<span class="hljs-title function_">depthMask</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// æ¢å¤æ·±åº¦å†™å…¥</span>
</code></pre>
</li>
<li>
<p><strong>é¢œè‰²é®ç½©</strong>ï¼šåªæ›´æ–°ç‰¹å®šé¢œè‰²é€šé“</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åªæ›´æ–° Alpha é€šé“</span>
gl.<span class="hljs-title function_">colorMask</span>(<span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-number">0</span>, count);
gl.<span class="hljs-title function_">colorMask</span>(<span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
</code></pre>
</li>
<li>
<p><strong>æ¨¡æ¿é®ç½©</strong>ï¼šä¿æŠ¤æ¨¡æ¿ç¼“å†²åŒºçš„ç‰¹å®šä½</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åªå…è®¸å†™å…¥æ¨¡æ¿å€¼çš„ä½ 4 ä½</span>
gl.<span class="hljs-title function_">stencilMask</span>(<span class="hljs-number">0x0f</span>);
</code></pre>
</li>
</ul>
<h3 data-id="heading-42">æ¸…å±æ“ä½œ</h3>
<p>æ¸…ç©ºå¸§ç¼“å†²åŒºçš„é¢œè‰²ã€æ·±åº¦ã€æ¨¡æ¿ç¼“å†²ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è®¾ç½®æ¸…å±é¢œè‰²</span>
gl.<span class="hljs-title function_">clearColor</span>(<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>); <span class="hljs-comment">// RGBAï¼Œé»‘è‰²ä¸é€æ˜</span>

<span class="hljs-comment">// è®¾ç½®æ¸…å±æ·±åº¦å€¼</span>
gl.<span class="hljs-title function_">clearDepth</span>(<span class="hljs-number">1.0</span>); <span class="hljs-comment">// æ·±åº¦å€¼ 1.0ï¼ˆæœ€è¿œï¼‰</span>

<span class="hljs-comment">// è®¾ç½®æ¸…å±æ¨¡æ¿å€¼</span>
gl.<span class="hljs-title function_">clearStencil</span>(<span class="hljs-number">0</span>); <span class="hljs-comment">// æ¨¡æ¿å€¼ 0</span>

<span class="hljs-comment">// æ¸…ç©ºç¼“å†²åŒº</span>
gl.<span class="hljs-title function_">clear</span>(gl.<span class="hljs-property">COLOR_BUFFER_BIT</span>); <span class="hljs-comment">// æ¸…ç©ºé¢œè‰²ç¼“å†²åŒº</span>
gl.<span class="hljs-title function_">clear</span>(gl.<span class="hljs-property">DEPTH_BUFFER_BIT</span>); <span class="hljs-comment">// æ¸…ç©ºæ·±åº¦ç¼“å†²åŒº</span>
gl.<span class="hljs-title function_">clear</span>(gl.<span class="hljs-property">STENCIL_BUFFER_BIT</span>); <span class="hljs-comment">// æ¸…ç©ºæ¨¡æ¿ç¼“å†²åŒº</span>

<span class="hljs-comment">// åŒæ—¶æ¸…ç©ºå¤šä¸ªç¼“å†²åŒºï¼ˆæ¨èï¼‰</span>
gl.<span class="hljs-title function_">clear</span>(gl.<span class="hljs-property">COLOR_BUFFER_BIT</span> | gl.<span class="hljs-property">DEPTH_BUFFER_BIT</span>);
</code></pre>
<p><strong>å…¸å‹æ¸²æŸ“å¾ªç¯</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// æ¸…ç©ºç¼“å†²åŒº</span>
  gl.<span class="hljs-title function_">clearColor</span>(<span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">1.0</span>);
  gl.<span class="hljs-title function_">clear</span>(gl.<span class="hljs-property">COLOR_BUFFER_BIT</span> | gl.<span class="hljs-property">DEPTH_BUFFER_BIT</span>);

  <span class="hljs-comment">// å¯ç”¨æ·±åº¦æµ‹è¯•</span>
  gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">DEPTH_TEST</span>);

  <span class="hljs-comment">// ä½¿ç”¨ç€è‰²å™¨ç¨‹åº</span>
  gl.<span class="hljs-title function_">useProgram</span>(program);

  <span class="hljs-comment">// ç»‘å®š VAO</span>
  gl.<span class="hljs-title function_">bindVertexArray</span>(vao);

  <span class="hljs-comment">// ä¸Šä¼  Uniform</span>
  gl.<span class="hljs-title function_">uniformMatrix4fv</span>(mvpMatrixLoc, <span class="hljs-literal">false</span>, mvpMatrix);

  <span class="hljs-comment">// ç»˜åˆ¶</span>
  gl.<span class="hljs-title function_">drawArrays</span>(gl.<span class="hljs-property">TRIANGLES</span>, <span class="hljs-number">0</span>, vertexCount);

  <span class="hljs-title function_">requestAnimationFrame</span>(render);
}
<span class="hljs-title function_">render</span>();
</code></pre>
<h2 data-id="heading-43">å¸§ç¼“å†²æ¥å£</h2>
<p>å¸§ç¼“å†²æ¥å£ç”¨äºåˆ›å»ºè‡ªå®šä¹‰å¸§ç¼“å†²å¯¹è±¡ (Framebuffer Object, FBO)ï¼Œå®ç°ç¦»å±æ¸²æŸ“ï¼Œæ”¯æŒé˜´å½±è´´å›¾ã€åå¤„ç†ã€åŠ¨æ€çº¹ç†ç­‰é«˜çº§æ¸²æŸ“æŠ€æœ¯ã€‚</p>
<h3 data-id="heading-44">å¸§ç¼“å†²å¯¹è±¡åˆ›å»º</h3>
<p>å¸§ç¼“å†²å¯¹è±¡æ˜¯æ¸²æŸ“ç›®æ ‡çš„å®¹å™¨ï¼ŒåŒ…å«é¢œè‰²ã€æ·±åº¦ã€æ¨¡æ¿é™„ä»¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºå¸§ç¼“å†²å¯¹è±¡</span>
<span class="hljs-keyword">const</span> fbo = gl.<span class="hljs-title function_">createFramebuffer</span>();

<span class="hljs-comment">// ç»‘å®šå¸§ç¼“å†²</span>
gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, fbo); <span class="hljs-comment">// åç»­æ“ä½œä½œç”¨äºæ­¤ FBO</span>

<span class="hljs-comment">// ç»‘å®šåˆ°é»˜è®¤å¸§ç¼“å†²ï¼ˆæ¸²æŸ“åˆ° Canvasï¼‰</span>
gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, <span class="hljs-literal">null</span>);
</code></pre>
<p>WebGL2 æ”¯æŒåˆ†åˆ«ç»‘å®šè¯»å–å’Œç»˜åˆ¶å¸§ç¼“å†²ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// WebGL2</span>
gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">DRAW_FRAMEBUFFER</span>, fbo); <span class="hljs-comment">// ç»˜åˆ¶ç›®æ ‡</span>
gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">READ_FRAMEBUFFER</span>, fbo); <span class="hljs-comment">// è¯»å–æº</span>
</code></pre>
<h3 data-id="heading-45">æ¸²æŸ“ç¼“å†²å¯¹è±¡</h3>
<p>æ¸²æŸ“ç¼“å†²å¯¹è±¡ (Renderbuffer) ç”¨äºå­˜å‚¨æ¸²æŸ“æ•°æ®ï¼Œé€šå¸¸ç”¨ä½œæ·±åº¦æˆ–æ¨¡æ¿é™„ä»¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºæ¸²æŸ“ç¼“å†²å¯¹è±¡</span>
<span class="hljs-keyword">const</span> renderbuffer = gl.<span class="hljs-title function_">createRenderbuffer</span>();

<span class="hljs-comment">// ç»‘å®šæ¸²æŸ“ç¼“å†²</span>
gl.<span class="hljs-title function_">bindRenderbuffer</span>(gl.<span class="hljs-property">RENDERBUFFER</span>, renderbuffer);

<span class="hljs-comment">// åˆ†é…å­˜å‚¨ç©ºé—´</span>
gl.<span class="hljs-title function_">renderbufferStorage</span>(
  gl.<span class="hljs-property">RENDERBUFFER</span>,
  gl.<span class="hljs-property">DEPTH_COMPONENT16</span>, <span class="hljs-comment">// å†…éƒ¨æ ¼å¼</span>
  <span class="hljs-number">512</span>,
  <span class="hljs-number">512</span> <span class="hljs-comment">// å®½åº¦ã€é«˜åº¦</span>
);
</code></pre>
<p><strong>å¸¸ç”¨å†…éƒ¨æ ¼å¼</strong>ï¼š</p>

































<table><thead><tr><th>æ ¼å¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>gl.RGBA4</code></td><td>4 ä½ RGBA</td></tr><tr><td><code>gl.RGB565</code></td><td>5-6-5 RGB</td></tr><tr><td><code>gl.RGB5_A1</code></td><td>5-5-5-1 RGBA</td></tr><tr><td><code>gl.DEPTH_COMPONENT16</code></td><td>16 ä½æ·±åº¦</td></tr><tr><td><code>gl.STENCIL_INDEX8</code></td><td>8 ä½æ¨¡æ¿</td></tr><tr><td><code>gl.DEPTH_STENCIL</code></td><td>æ·±åº¦ + æ¨¡æ¿ï¼ˆWebGL1 éœ€è¦æ‰©å±•ï¼ŒWebGL2 åŸç”Ÿæ”¯æŒï¼‰</td></tr></tbody></table>
<p><strong>WebGL2 çš„å¤šé‡é‡‡æ ·æ¸²æŸ“ç¼“å†²</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// WebGL2: åˆ›å»º MSAA æ¸²æŸ“ç¼“å†²ï¼ˆæŠ—é”¯é½¿ï¼‰</span>
gl.<span class="hljs-title function_">renderbufferStorageMultisample</span>(
  gl.<span class="hljs-property">RENDERBUFFER</span>,
  <span class="hljs-number">4</span>, <span class="hljs-comment">// é‡‡æ ·æ•°ï¼ˆé€šå¸¸ 4 æˆ– 8ï¼‰</span>
  gl.<span class="hljs-property">RGBA8</span>, <span class="hljs-comment">// å†…éƒ¨æ ¼å¼</span>
  <span class="hljs-number">512</span>,
  <span class="hljs-number">512</span> <span class="hljs-comment">// å®½åº¦ã€é«˜åº¦</span>
);
</code></pre>
<h3 data-id="heading-46">é¢œè‰²é™„ä»¶</h3>
<p>é¢œè‰²é™„ä»¶ç”¨äºå­˜å‚¨æ¸²æŸ“çš„é¢œè‰²æ•°æ®ï¼Œå¯ä»¥æ˜¯çº¹ç†æˆ–æ¸²æŸ“ç¼“å†²å¯¹è±¡ã€‚</p>
<p><strong>ä½¿ç”¨çº¹ç†ä½œä¸ºé¢œè‰²é™„ä»¶</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºçº¹ç†</span>
<span class="hljs-keyword">const</span> texture = gl.<span class="hljs-title function_">createTexture</span>();
gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture);

<span class="hljs-comment">// é™„åŠ åˆ°å¸§ç¼“å†²</span>
gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, fbo);
gl.<span class="hljs-title function_">framebufferTexture2D</span>(
  gl.<span class="hljs-property">FRAMEBUFFER</span>, <span class="hljs-comment">// ç›®æ ‡</span>
  gl.<span class="hljs-property">COLOR_ATTACHMENT0</span>, <span class="hljs-comment">// é™„ä»¶ç‚¹</span>
  gl.<span class="hljs-property">TEXTURE_2D</span>, <span class="hljs-comment">// çº¹ç†ç›®æ ‡</span>
  texture, <span class="hljs-comment">// çº¹ç†å¯¹è±¡</span>
  <span class="hljs-number">0</span> <span class="hljs-comment">// Mipmap çº§åˆ«</span>
);
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šWebGL1 åªæ”¯æŒä¸€ä¸ªé¢œè‰²é™„ä»¶ (<code>COLOR_ATTACHMENT0</code>)ï¼ŒWebGL2 æ”¯æŒå¤šä¸ªé¢œè‰²é™„ä»¶ï¼ˆè¯¦è§ã€å¤šæ¸²æŸ“ç›®æ ‡ã€‘ç« èŠ‚ï¼‰ã€‚</p>
<p><strong>ä½¿ç”¨æ¸²æŸ“ç¼“å†²å¯¹è±¡ä½œä¸ºé¢œè‰²é™„ä»¶</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> colorRB = gl.<span class="hljs-title function_">createRenderbuffer</span>();
gl.<span class="hljs-title function_">bindRenderbuffer</span>(gl.<span class="hljs-property">RENDERBUFFER</span>, colorRB);
gl.<span class="hljs-title function_">renderbufferStorage</span>(gl.<span class="hljs-property">RENDERBUFFER</span>, gl.<span class="hljs-property">RGBA4</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>);

gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, fbo);
gl.<span class="hljs-title function_">framebufferRenderbuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, gl.<span class="hljs-property">COLOR_ATTACHMENT0</span>, gl.<span class="hljs-property">RENDERBUFFER</span>, colorRB);
</code></pre>
<h3 data-id="heading-47">æ·±åº¦å’Œæ¨¡æ¿é™„ä»¶</h3>
<p>æ·±åº¦å’Œæ¨¡æ¿é™„ä»¶ç”¨äºæ·±åº¦æµ‹è¯•å’Œæ¨¡æ¿æµ‹è¯•ã€‚</p>
<p><strong>æ·±åº¦é™„ä»¶</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨æ¸²æŸ“ç¼“å†²å¯¹è±¡</span>
<span class="hljs-keyword">const</span> depthRB = gl.<span class="hljs-title function_">createRenderbuffer</span>();
gl.<span class="hljs-title function_">bindRenderbuffer</span>(gl.<span class="hljs-property">RENDERBUFFER</span>, depthRB);
gl.<span class="hljs-title function_">renderbufferStorage</span>(gl.<span class="hljs-property">RENDERBUFFER</span>, gl.<span class="hljs-property">DEPTH_COMPONENT16</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>);

gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, fbo);
gl.<span class="hljs-title function_">framebufferRenderbuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, gl.<span class="hljs-property">DEPTH_ATTACHMENT</span>, gl.<span class="hljs-property">RENDERBUFFER</span>, depthRB);

<span class="hljs-comment">// æˆ–ä½¿ç”¨æ·±åº¦çº¹ç†ï¼ˆéœ€è¦æ‰©å±• WEBGL_depth_textureï¼ŒWebGL2 åŸç”Ÿæ”¯æŒï¼‰</span>
<span class="hljs-keyword">const</span> depthTexture = gl.<span class="hljs-title function_">createTexture</span>();
gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, depthTexture);
gl.<span class="hljs-title function_">texImage2D</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, <span class="hljs-number">0</span>, gl.<span class="hljs-property">DEPTH_COMPONENT</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>, <span class="hljs-number">0</span>, gl.<span class="hljs-property">DEPTH_COMPONENT</span>, gl.<span class="hljs-property">UNSIGNED_SHORT</span>, <span class="hljs-literal">null</span>);
gl.<span class="hljs-title function_">framebufferTexture2D</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, gl.<span class="hljs-property">DEPTH_ATTACHMENT</span>, gl.<span class="hljs-property">TEXTURE_2D</span>, depthTexture, <span class="hljs-number">0</span>);
</code></pre>
<p><strong>æ·±åº¦ + æ¨¡æ¿é™„ä»¶</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// WebGL1 éœ€è¦æ‰©å±• WEBGL_depth_texture</span>
<span class="hljs-comment">// WebGL2 åŸç”Ÿæ”¯æŒ</span>
<span class="hljs-keyword">const</span> depthStencilRB = gl.<span class="hljs-title function_">createRenderbuffer</span>();
gl.<span class="hljs-title function_">bindRenderbuffer</span>(gl.<span class="hljs-property">RENDERBUFFER</span>, depthStencilRB);
gl.<span class="hljs-title function_">renderbufferStorage</span>(gl.<span class="hljs-property">RENDERBUFFER</span>, gl.<span class="hljs-property">DEPTH_STENCIL</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>);

gl.<span class="hljs-title function_">framebufferRenderbuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, gl.<span class="hljs-property">DEPTH_STENCIL_ATTACHMENT</span>, gl.<span class="hljs-property">RENDERBUFFER</span>, depthStencilRB);
</code></pre>
<h3 data-id="heading-48">å¸§ç¼“å†²å®Œæ•´æ€§æ£€æŸ¥</h3>
<p>å¸§ç¼“å†²é…ç½®å®Œæˆåéœ€è¦æ£€æŸ¥å®Œæ•´æ€§ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, fbo);

<span class="hljs-comment">// æ£€æŸ¥å¸§ç¼“å†²å®Œæ•´æ€§</span>
<span class="hljs-keyword">const</span> status = gl.<span class="hljs-title function_">checkFramebufferStatus</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>);
<span class="hljs-keyword">if</span> (status !== gl.<span class="hljs-property">FRAMEBUFFER_COMPLETE</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Framebuffer is not complete:"</span>, <span class="hljs-title function_">getStatusString</span>(status));
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getStatusString</span>(<span class="hljs-params">status</span>) {
  <span class="hljs-keyword">switch</span> (status) {
    <span class="hljs-keyword">case</span> gl.<span class="hljs-property">FRAMEBUFFER_INCOMPLETE_ATTACHMENT</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">"INCOMPLETE_ATTACHMENT: é™„ä»¶é…ç½®ä¸å®Œæ•´"</span>;
    <span class="hljs-keyword">case</span> gl.<span class="hljs-property">FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">"INCOMPLETE_MISSING_ATTACHMENT: ç¼ºå°‘é™„ä»¶"</span>;
    <span class="hljs-keyword">case</span> gl.<span class="hljs-property">FRAMEBUFFER_INCOMPLETE_DIMENSIONS</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">"INCOMPLETE_DIMENSIONS: é™„ä»¶å°ºå¯¸ä¸ä¸€è‡´"</span>;
    <span class="hljs-keyword">case</span> gl.<span class="hljs-property">FRAMEBUFFER_UNSUPPORTED</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">"UNSUPPORTED: ä¸æ”¯æŒçš„é™„ä»¶ç»„åˆ"</span>;
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-string">"UNKNOWN ERROR"</span>;
  }
}
</code></pre>
<p><strong>å¸¸è§é”™è¯¯</strong>ï¼š</p>
<ul>
<li>æ²¡æœ‰é™„åŠ ä»»ä½•é¢œè‰²é™„ä»¶</li>
<li>é™„ä»¶å°ºå¯¸ä¸ä¸€è‡´</li>
<li>ä½¿ç”¨äº†ä¸æ”¯æŒçš„å†…éƒ¨æ ¼å¼ç»„åˆ</li>
</ul>
<h3 data-id="heading-49">å¤šæ¸²æŸ“ç›®æ ‡ (Multiple Render Targets, MRT)</h3>
<p>WebGL2 æ”¯æŒå¤šæ¸²æŸ“ç›®æ ‡ (MRT)ï¼Œå…è®¸ç‰‡æ®µç€è‰²å™¨åœ¨ä¸€æ¬¡ç»˜åˆ¶è°ƒç”¨ä¸­åŒæ—¶è¾“å‡ºåˆ°å¤šä¸ªé¢œè‰²é™„ä»¶ï¼Œç”¨äºå»¶è¿Ÿæ¸²æŸ“ (Deferred Rendering)ã€G-Buffer ç­‰é«˜çº§æ¸²æŸ“æŠ€æœ¯ã€‚</p>
<p><strong>é…ç½®å¤šä¸ªé¢œè‰²é™„ä»¶</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºå¤šä¸ªçº¹ç†ä½œä¸ºé¢œè‰²é™„ä»¶</span>
<span class="hljs-keyword">const</span> texture0 = gl.<span class="hljs-title function_">createTexture</span>();
gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture0);
gl.<span class="hljs-title function_">texImage2D</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, <span class="hljs-number">0</span>, gl.<span class="hljs-property">RGBA</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>, <span class="hljs-number">0</span>, gl.<span class="hljs-property">RGBA</span>, gl.<span class="hljs-property">UNSIGNED_BYTE</span>, <span class="hljs-literal">null</span>);

<span class="hljs-keyword">const</span> texture1 = gl.<span class="hljs-title function_">createTexture</span>();
gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture1);
gl.<span class="hljs-title function_">texImage2D</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, <span class="hljs-number">0</span>, gl.<span class="hljs-property">RGBA</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>, <span class="hljs-number">0</span>, gl.<span class="hljs-property">RGBA</span>, gl.<span class="hljs-property">UNSIGNED_BYTE</span>, <span class="hljs-literal">null</span>);

<span class="hljs-keyword">const</span> texture2 = gl.<span class="hljs-title function_">createTexture</span>();
gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture2);
gl.<span class="hljs-title function_">texImage2D</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, <span class="hljs-number">0</span>, gl.<span class="hljs-property">RGBA</span>, <span class="hljs-number">512</span>, <span class="hljs-number">512</span>, <span class="hljs-number">0</span>, gl.<span class="hljs-property">RGBA</span>, gl.<span class="hljs-property">UNSIGNED_BYTE</span>, <span class="hljs-literal">null</span>);

<span class="hljs-comment">// é™„åŠ åˆ°å¸§ç¼“å†²çš„ä¸åŒé¢œè‰²é™„ä»¶</span>
gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, fbo);
gl.<span class="hljs-title function_">framebufferTexture2D</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, gl.<span class="hljs-property">COLOR_ATTACHMENT0</span>, gl.<span class="hljs-property">TEXTURE_2D</span>, texture0, <span class="hljs-number">0</span>);
gl.<span class="hljs-title function_">framebufferTexture2D</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, gl.<span class="hljs-property">COLOR_ATTACHMENT1</span>, gl.<span class="hljs-property">TEXTURE_2D</span>, texture1, <span class="hljs-number">0</span>);
gl.<span class="hljs-title function_">framebufferTexture2D</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, gl.<span class="hljs-property">COLOR_ATTACHMENT2</span>, gl.<span class="hljs-property">TEXTURE_2D</span>, texture2, <span class="hljs-number">0</span>);

<span class="hljs-comment">// æŒ‡å®šç»˜åˆ¶åˆ°å“ªäº›é¢œè‰²é™„ä»¶</span>
gl.<span class="hljs-title function_">drawBuffers</span>([gl.<span class="hljs-property">COLOR_ATTACHMENT0</span>, gl.<span class="hljs-property">COLOR_ATTACHMENT1</span>, gl.<span class="hljs-property">COLOR_ATTACHMENT2</span>]);
</code></pre>
<p><strong>ç‰‡æ®µç€è‰²å™¨è¾“å‡ºåˆ°å¤šä¸ªé™„ä»¶</strong>ï¼š</p>
<pre><code class="hljs language-glsl" lang="glsl">// WebGL2 GLSL ES 3.00 ç‰‡æ®µç€è‰²å™¨
#version 300 es
precision mediump float;

in vec3 vPosition;
in vec3 vNormal;
in vec2 vTexCoord;

// å®šä¹‰å¤šä¸ªè¾“å‡ºå˜é‡
layout(location = 0) out vec4 outColor;      // COLOR_ATTACHMENT0
layout(location = 1) out vec4 outNormal;     // COLOR_ATTACHMENT1
layout(location = 2) out vec4 outPosition;   // COLOR_ATTACHMENT2

void main() {
  // è¾“å‡ºåˆ°ä¸åŒçš„é¢œè‰²é™„ä»¶
  outColor = vec4(1.0, 0.5, 0.2, 1.0);       // é¢œè‰²
  outNormal = vec4(normalize(vNormal), 1.0); // æ³•çº¿
  outPosition = vec4(vPosition, 1.0);        // ä½ç½®
}
</code></pre>
<p><strong>é¢œè‰²é™„ä»¶æ•°é‡é™åˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æŸ¥è¯¢æ”¯æŒçš„æœ€å¤§é¢œè‰²é™„ä»¶æ•°é‡</span>
<span class="hljs-keyword">const</span> maxDrawBuffers = gl.<span class="hljs-title function_">getParameter</span>(gl.<span class="hljs-property">MAX_DRAW_BUFFERS</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æœ€å¤§é¢œè‰²é™„ä»¶æ•°é‡:"</span>, maxDrawBuffers); <span class="hljs-comment">// WebGL2 è‡³å°‘æ”¯æŒ 4 ä¸ª</span>
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹</strong>ï¼š</p>
<ul>
<li>WebGL1 ä¸æ”¯æŒ MRTï¼Œåªèƒ½è¾“å‡ºåˆ°ä¸€ä¸ªé¢œè‰²é™„ä»¶</li>
<li>WebGL2 è‡³å°‘æ”¯æŒ 4 ä¸ªé¢œè‰²é™„ä»¶ï¼Œå…·ä½“æ•°é‡ç”±è®¾å¤‡å†³å®š</li>
<li>æ‰€æœ‰é¢œè‰²é™„ä»¶çš„å°ºå¯¸å¿…é¡»ä¸€è‡´</li>
<li>MRT ä¼šå¢åŠ å¸¦å®½å’Œå†…å­˜å ç”¨ï¼Œéœ€è¦æƒè¡¡æ€§èƒ½</li>
</ul>
<h2 data-id="heading-50">WebGL æ‰©å±•</h2>
<p>WebGL é€šè¿‡æ‰©å±•æœºåˆ¶æä¾›é¢å¤–çš„åŠŸèƒ½ï¼Œå…è®¸æµè§ˆå™¨æš´éœ²ç¡¬ä»¶ç‰¹å®šçš„èƒ½åŠ›ã€‚æ‰©å±•éœ€è¦æ˜¾å¼å¯ç”¨æ‰èƒ½ä½¿ç”¨ï¼Œå¼€å‘è€…åº”æ£€æŸ¥æ‰©å±•çš„å¯ç”¨æ€§ä»¥ç¡®ä¿è·¨å¹³å°å…¼å®¹æ€§ã€‚æœ¬ç« ä»‹ç»å¸¸ç”¨æ‰©å±•çš„åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•ï¼Œå®Œæ•´çš„æ‰©å±•åˆ—è¡¨è¯·å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.khronos.org%2Fregistry%2Fwebgl%2Fextensions%2F" target="_blank" title="https://www.khronos.org/registry/webgl/extensions/" ref="nofollow noopener noreferrer">WebGL æ‰©å±•æ³¨å†Œè¡¨</a>ã€‚</p>
<h3 data-id="heading-51">æ‰©å±•çš„æŸ¥è¯¢å’Œå¯ç”¨</h3>
<p><strong>æŸ¥è¯¢æ”¯æŒçš„æ‰©å±•</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è·å–æ‰€æœ‰æ”¯æŒçš„æ‰©å±•åç§°</span>
<span class="hljs-keyword">const</span> extensions = gl.<span class="hljs-title function_">getSupportedExtensions</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Supported extensions:"</span>, extensions);

<span class="hljs-comment">// ç¤ºä¾‹è¾“å‡ºï¼š</span>
<span class="hljs-comment">// ["ANGLE_instanced_arrays", "EXT_blend_minmax", "EXT_color_buffer_half_float", ...]</span>
</code></pre>
<p><strong>å¯ç”¨æ‰©å±•</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯ç”¨æ‰©å±•</span>
<span class="hljs-keyword">const</span> ext = gl.<span class="hljs-title function_">getExtension</span>(<span class="hljs-string">"OES_texture_float"</span>);

<span class="hljs-keyword">if</span> (!ext) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"OES_texture_float not supported"</span>);
} <span class="hljs-keyword">else</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"OES_texture_float enabled"</span>);
  <span class="hljs-comment">// ç°åœ¨å¯ä»¥ä½¿ç”¨æµ®ç‚¹çº¹ç†</span>
}
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li><code>getExtension</code> è¿”å›æ‰©å±•å¯¹è±¡ï¼ˆå¦‚æœæ”¯æŒï¼‰ï¼Œæˆ– <code>null</code>ï¼ˆå¦‚æœä¸æ”¯æŒï¼‰</li>
<li>æ‰©å±•åç§°åŒºåˆ†å¤§å°å†™ï¼Œå¿…é¡»ä½¿ç”¨å®˜æ–¹åç§°</li>
<li>æŸäº›æ‰©å±•åœ¨å¯ç”¨åä¼šæ·»åŠ æ–°çš„å¸¸é‡æˆ–æ–¹æ³•åˆ° <code>gl</code> å¯¹è±¡</li>
</ul>
<h3 data-id="heading-52">WEBGL_debug_renderer_info</h3>
<p>è·å– GPU æ¸²æŸ“å™¨å’Œä¾›åº”å•†ä¿¡æ¯ï¼Œç”¨äºè°ƒè¯•å’Œæ€§èƒ½åˆ†æã€‚</p>
<p><strong>æ‰©å±•æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.khronos.org%2Fregistry%2Fwebgl%2Fextensions%2FWEBGL_debug_renderer_info%2F" target="_blank" title="https://www.khronos.org/registry/webgl/extensions/WEBGL_debug_renderer_info/" ref="nofollow noopener noreferrer">WEBGL_debug_renderer_info</a></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> ext = gl.<span class="hljs-title function_">getExtension</span>(<span class="hljs-string">"WEBGL_debug_renderer_info"</span>);

<span class="hljs-keyword">if</span> (ext) {
  <span class="hljs-keyword">const</span> vendor = gl.<span class="hljs-title function_">getParameter</span>(ext.<span class="hljs-property">UNMASKED_VENDOR_WEBGL</span>);
  <span class="hljs-keyword">const</span> renderer = gl.<span class="hljs-title function_">getParameter</span>(ext.<span class="hljs-property">UNMASKED_RENDERER_WEBGL</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"GPU Vendor:"</span>, vendor); <span class="hljs-comment">// ä¾‹å¦‚: "NVIDIA Corporation"</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"GPU Renderer:"</span>, renderer); <span class="hljs-comment">// ä¾‹å¦‚: "NVIDIA GeForce GTX 1080"</span>
}
</code></pre>
<p><strong>æ³¨æ„</strong>ï¼šå‡ºäºéšç§è€ƒè™‘ï¼ŒæŸäº›æµè§ˆå™¨å¯èƒ½ä¼šé™åˆ¶æ­¤æ‰©å±•çš„å¯ç”¨æ€§ã€‚</p>
<h3 data-id="heading-53">OES_standard_derivatives</h3>
<p>åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­å¯ç”¨å¯¼æ•°å‡½æ•° <code>dFdx</code>ã€<code>dFdy</code>ã€<code>fwidth</code>ï¼Œç”¨äºè®¡ç®—å±å¹•ç©ºé—´æ¢¯åº¦ã€‚</p>
<p><strong>æ‰©å±•æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.khronos.org%2Fregistry%2Fwebgl%2Fextensions%2FOES_standard_derivatives%2F" target="_blank" title="https://www.khronos.org/registry/webgl/extensions/OES_standard_derivatives/" ref="nofollow noopener noreferrer">OES_standard_derivatives</a></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯ç”¨æ‰©å±•</span>
<span class="hljs-keyword">const</span> ext = gl.<span class="hljs-title function_">getExtension</span>(<span class="hljs-string">"OES_standard_derivatives"</span>);

<span class="hljs-keyword">if</span> (ext) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Standard derivatives enabled"</span>);
}
</code></pre>
<p><strong>ç‰‡æ®µç€è‰²å™¨ä½¿ç”¨</strong>ï¼š</p>
<pre><code class="hljs language-glsl" lang="glsl">#extension GL_OES_standard_derivatives : enable

precision mediump float;
varying vec2 vTexCoord;

void main() {
  // è®¡ç®—çº¹ç†åæ ‡çš„å±å¹•ç©ºé—´å¯¼æ•°
  float dx = dFdx(vTexCoord.x);
  float dy = dFdy(vTexCoord.y);

  // fwidth(p) = abs(dFdx(p)) + abs(dFdy(p))
  float gradient = fwidth(vTexCoord.x);

  gl_FragColor = vec4(gradient, gradient, gradient, 1.0);
}
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>ç¨‹åºåŒ–çº¹ç†çš„æŠ—é”¯é½¿</li>
<li>è®¡ç®—æ³•çº¿ï¼ˆé€šè¿‡ä½ç½®æˆ–é«˜åº¦å›¾ï¼‰</li>
<li>å®ç°è‡ªå®šä¹‰ Mipmap çº§åˆ«é€‰æ‹©</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šWebGL2 åŸç”Ÿæ”¯æŒå¯¼æ•°å‡½æ•°ï¼Œæ— éœ€æ‰©å±•ã€‚</p>
<h3 data-id="heading-54">OES_texture_float</h3>
<p>å…è®¸ä½¿ç”¨æµ®ç‚¹çº¹ç†æ ¼å¼ï¼Œå­˜å‚¨é«˜ç²¾åº¦æ•°æ®ã€‚</p>
<p><strong>æ‰©å±•æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.khronos.org%2Fregistry%2Fwebgl%2Fextensions%2FOES_texture_float%2F" target="_blank" title="https://www.khronos.org/registry/webgl/extensions/OES_texture_float/" ref="nofollow noopener noreferrer">OES_texture_float</a></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯ç”¨æ‰©å±•</span>
<span class="hljs-keyword">const</span> ext = gl.<span class="hljs-title function_">getExtension</span>(<span class="hljs-string">"OES_texture_float"</span>);

<span class="hljs-keyword">if</span> (ext) {
  <span class="hljs-comment">// åˆ›å»ºæµ®ç‚¹çº¹ç†</span>
  <span class="hljs-keyword">const</span> texture = gl.<span class="hljs-title function_">createTexture</span>();
  gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, texture);

  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>([
    <span class="hljs-number">1.5</span>,
    <span class="hljs-number">2.7</span>,
    -<span class="hljs-number">3.2</span>,
    <span class="hljs-number">4.8</span>, <span class="hljs-comment">// RGBA å€¼å¯ä»¥è¶…å‡º [0, 1] èŒƒå›´</span>
    <span class="hljs-number">0.1</span>,
    <span class="hljs-number">0.2</span>,
    <span class="hljs-number">0.3</span>,
    <span class="hljs-number">0.4</span>,
  ]);

  gl.<span class="hljs-title function_">texImage2D</span>(
    gl.<span class="hljs-property">TEXTURE_2D</span>,
    <span class="hljs-number">0</span>,
    gl.<span class="hljs-property">RGBA</span>, <span class="hljs-comment">// å†…éƒ¨æ ¼å¼</span>
    <span class="hljs-number">2</span>,
    <span class="hljs-number">1</span>, <span class="hljs-comment">// å®½åº¦ã€é«˜åº¦</span>
    <span class="hljs-number">0</span>,
    gl.<span class="hljs-property">RGBA</span>, <span class="hljs-comment">// æ ¼å¼</span>
    gl.<span class="hljs-property">FLOAT</span>, <span class="hljs-comment">// ç±»å‹ï¼ˆéœ€è¦æ‰©å±•ï¼‰</span>
    data
  );

  <span class="hljs-comment">// è®¾ç½®çº¹ç†å‚æ•°ï¼ˆæµ®ç‚¹çº¹ç†é€šå¸¸ä¸æ”¯æŒçº¿æ€§è¿‡æ»¤ï¼Œéœ€è¦ OES_texture_float_linearï¼‰</span>
  gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_MIN_FILTER</span>, gl.<span class="hljs-property">NEAREST</span>);
  gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_MAG_FILTER</span>, gl.<span class="hljs-property">NEAREST</span>);
  gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_WRAP_S</span>, gl.<span class="hljs-property">CLAMP_TO_EDGE</span>);
  gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_WRAP_T</span>, gl.<span class="hljs-property">CLAMP_TO_EDGE</span>);
}
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>HDR æ¸²æŸ“</li>
<li>ç‰©ç†æ¨¡æ‹Ÿï¼ˆç²’å­ç³»ç»Ÿã€æµä½“æ¨¡æ‹Ÿï¼‰</li>
<li>å»¶è¿Ÿæ¸²æŸ“çš„ G-Buffer</li>
<li>GPGPU è®¡ç®—</li>
</ul>
<p><strong>ç›¸å…³æ‰©å±•</strong>ï¼š</p>
<ul>
<li><code>OES_texture_float_linear</code>ï¼šå¯ç”¨æµ®ç‚¹çº¹ç†çš„çº¿æ€§è¿‡æ»¤</li>
<li><code>WEBGL_color_buffer_float</code>ï¼šå…è®¸æ¸²æŸ“åˆ°æµ®ç‚¹é¢œè‰²ç¼“å†²åŒº</li>
<li><code>EXT_color_buffer_float</code>ï¼ˆWebGL2ï¼‰ï¼šWebGL2 çš„æµ®ç‚¹æ¸²æŸ“ç›®æ ‡æ‰©å±•</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šWebGL2 åŸç”Ÿæ”¯æŒæµ®ç‚¹çº¹ç†ï¼Œä½†æ¸²æŸ“åˆ°æµ®ç‚¹çº¹ç†ä»éœ€æ‰©å±•ã€‚</p>
<h3 data-id="heading-55">WEBGL_depth_texture</h3>
<p>å…è®¸ä½¿ç”¨æ·±åº¦çº¹ç†ï¼Œå°†æ·±åº¦ç¼“å†²åŒºä½œä¸ºçº¹ç†é‡‡æ ·ã€‚</p>
<p><strong>æ‰©å±•æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.khronos.org%2Fregistry%2Fwebgl%2Fextensions%2FWEBGL_depth_texture%2F" target="_blank" title="https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture/" ref="nofollow noopener noreferrer">WEBGL_depth_texture</a></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// WebGL1 éœ€è¦æ‰©å±•</span>
<span class="hljs-keyword">const</span> ext = gl.<span class="hljs-title function_">getExtension</span>(<span class="hljs-string">"WEBGL_depth_texture"</span>);

<span class="hljs-keyword">if</span> (ext) {
  <span class="hljs-comment">// åˆ›å»ºæ·±åº¦çº¹ç†</span>
  <span class="hljs-keyword">const</span> depthTexture = gl.<span class="hljs-title function_">createTexture</span>();
  gl.<span class="hljs-title function_">bindTexture</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, depthTexture);
  gl.<span class="hljs-title function_">texImage2D</span>(
    gl.<span class="hljs-property">TEXTURE_2D</span>,
    <span class="hljs-number">0</span>,
    gl.<span class="hljs-property">DEPTH_COMPONENT</span>, <span class="hljs-comment">// å†…éƒ¨æ ¼å¼</span>
    <span class="hljs-number">512</span>,
    <span class="hljs-number">512</span>,
    <span class="hljs-number">0</span>,
    gl.<span class="hljs-property">DEPTH_COMPONENT</span>, <span class="hljs-comment">// æ ¼å¼</span>
    gl.<span class="hljs-property">UNSIGNED_SHORT</span>, <span class="hljs-comment">// ç±»å‹</span>
    <span class="hljs-literal">null</span>
  );

  <span class="hljs-comment">// è®¾ç½®çº¹ç†å‚æ•°</span>
  gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_MIN_FILTER</span>, gl.<span class="hljs-property">NEAREST</span>);
  gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_MAG_FILTER</span>, gl.<span class="hljs-property">NEAREST</span>);
  gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_WRAP_S</span>, gl.<span class="hljs-property">CLAMP_TO_EDGE</span>);
  gl.<span class="hljs-title function_">texParameteri</span>(gl.<span class="hljs-property">TEXTURE_2D</span>, gl.<span class="hljs-property">TEXTURE_WRAP_T</span>, gl.<span class="hljs-property">CLAMP_TO_EDGE</span>);

  <span class="hljs-comment">// é™„åŠ åˆ°å¸§ç¼“å†²çš„æ·±åº¦é™„ä»¶</span>
  <span class="hljs-keyword">const</span> fbo = gl.<span class="hljs-title function_">createFramebuffer</span>();
  gl.<span class="hljs-title function_">bindFramebuffer</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, fbo);
  gl.<span class="hljs-title function_">framebufferTexture2D</span>(gl.<span class="hljs-property">FRAMEBUFFER</span>, gl.<span class="hljs-property">DEPTH_ATTACHMENT</span>, gl.<span class="hljs-property">TEXTURE_2D</span>, depthTexture, <span class="hljs-number">0</span>);
}
</code></pre>
<p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>é˜´å½±è´´å›¾ (Shadow Mapping)</li>
<li>æ·±åº¦é©±åŠ¨çš„åå¤„ç†æ•ˆæœï¼ˆæ™¯æ·±ã€ä½“ç§¯å…‰ï¼‰</li>
<li>SSAO (Screen Space Ambient Occlusion)</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šWebGL2 åŸç”Ÿæ”¯æŒæ·±åº¦çº¹ç†ã€‚</p>
<h3 data-id="heading-56">WEBGL_blend_func_extended</h3>
<p>å…è®¸åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­è¾“å‡ºåŒæºæ··åˆï¼ˆDual Source Blendingï¼‰æ•°æ®ï¼Œæä¾›æ›´çµæ´»çš„æ··åˆæ§åˆ¶ã€‚</p>
<p><strong>æ‰©å±•æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.khronos.org%2Fregistry%2Fwebgl%2Fextensions%2FWEBGL_blend_func_extended%2F" target="_blank" title="https://www.khronos.org/registry/webgl/extensions/WEBGL_blend_func_extended/" ref="nofollow noopener noreferrer">WEBGL_blend_func_extended</a></p>
<p><strong>æ ¸å¿ƒæ¦‚å¿µ</strong>ï¼š</p>
<p>åŒæºæ··åˆå…è®¸ç‰‡æ®µç€è‰²å™¨è¾“å‡ºä¸¤ä¸ªé¢œè‰²å€¼ï¼ˆ<code>gl_FragColor</code> å’Œ <code>gl_SecondaryFragColorEXT</code>ï¼‰ï¼Œåˆ†åˆ«ä½œä¸ºæ··åˆå…¬å¼ä¸­çš„æºé¢œè‰²ï¼ˆSource0ï¼‰å’Œç¬¬äºŒæºé¢œè‰²ï¼ˆSource1ï¼‰ã€‚</p>
<p><strong>ç‰‡æ®µç€è‰²å™¨ä½¿ç”¨</strong>ï¼š</p>
<pre><code class="hljs language-glsl" lang="glsl">#extension GL_EXT_blend_func_extended : require

precision mediump float;

void main() {
  // è¾“å‡ºæº0é¢œè‰²ï¼ˆæ­£å¸¸çš„ç‰‡æ®µé¢œè‰²ï¼‰
  gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);

  // è¾“å‡ºæº1é¢œè‰²ï¼ˆç”¨äºåŒæºæ··åˆï¼‰
  gl_SecondaryFragColorEXT = vec4(0.5, 0.5, 0.5, 0.5);
}
</code></pre>
<p><strong>è®¾ç½®æ··åˆå‡½æ•°</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> ext = gl.<span class="hljs-title function_">getExtension</span>(<span class="hljs-string">"WEBGL_blend_func_extended"</span>);

<span class="hljs-keyword">if</span> (ext) {
  <span class="hljs-comment">// æ‰©å±•æä¾›çš„æ–°æ··åˆå› å­å¸¸é‡</span>
  <span class="hljs-comment">// ext.SRC1_COLOR_WEBGL          - æº1é¢œè‰²</span>
  <span class="hljs-comment">// ext.SRC1_ALPHA_WEBGL          - æº1 Alpha</span>
  <span class="hljs-comment">// ext.ONE_MINUS_SRC1_COLOR_WEBGL - 1 - æº1é¢œè‰²</span>
  <span class="hljs-comment">// ext.ONE_MINUS_SRC1_ALPHA_WEBGL - 1 - æº1 Alpha</span>

  <span class="hljs-comment">// ä½¿ç”¨åŒæºæ··åˆå› å­</span>
  gl.<span class="hljs-title function_">enable</span>(gl.<span class="hljs-property">BLEND</span>);
  gl.<span class="hljs-title function_">blendFunc</span>(gl.<span class="hljs-property">ONE</span>, ext.<span class="hljs-property">SRC1_COLOR_WEBGL</span>);
  <span class="hljs-comment">// æœ€ç»ˆé¢œè‰² = æº0é¢œè‰² Ã— 1 + ç›®æ ‡é¢œè‰² Ã— æº1é¢œè‰²</span>
}
</code></pre>
<h2 data-id="heading-57">QA</h2>
<h3 data-id="heading-58">WebGL ä¸­çš„åæ ‡ç³»å˜æ¢åœ¨å“ªé‡Œå‘ç”Ÿï¼Ÿ</h3>
<p>WebGL æ¸²æŸ“ç®¡é“ä¸­æ¶‰åŠå¤šä¸ªåæ ‡ç©ºé—´çš„å˜æ¢ï¼Œè¿™äº›å˜æ¢å‘ç”Ÿåœ¨ä¸åŒçš„ç®¡é“é˜¶æ®µï¼š</p>
<ol>
<li>
<p><strong>æ¨¡å‹ç©ºé—´ â†’ ä¸–ç•Œç©ºé—´ â†’ è§†å›¾/ç›¸æœºç©ºé—´ â†’ è£å‰ªç©ºé—´</strong></p>
<ul>
<li>å‘ç”Ÿåœ¨ï¼š<strong>Vertex Shaderï¼ˆé¡¶ç‚¹ç€è‰²å™¨ï¼‰</strong></li>
<li>é€šè¿‡ MVP çŸ©é˜µï¼ˆModel-View-Projectionï¼‰å®Œæˆï¼Œè¾“å‡ºåˆ° <code>gl_Position</code></li>
<li>æŠ•å½±çŸ©é˜µåˆ†ä¸ºé€è§†æŠ•å½±ï¼ˆé”¥å°å½¢ï¼‰å’Œæ­£äº¤æŠ•å½±ï¼ˆé•¿æ–¹ä½“ï¼‰ï¼Œå†³å®šäº†è§†é”¥ä½“çš„å½¢çŠ¶ï¼ˆè¯¦è§ä¸‹æ–‡ï¼‰</li>
<li>è£å‰ªç©ºé—´å‘½ååŸå› ï¼šæ­¤ç©ºé—´åæ ‡ç”¨äºåç»­çš„è£å‰ªæ“ä½œï¼ŒGPU åœ¨æ­¤é˜¶æ®µåˆ¤æ–­é¡¶ç‚¹æ˜¯å¦åœ¨è§†é”¥ä½“å†…ï¼ˆé€šè¿‡æ¯”è¾ƒ <code>x, y, z</code> ä¸ <code>w</code> çš„å…³ç³»ï¼‰</li>
</ul>
</li>
<li>
<p><strong>è£å‰ªç©ºé—´ â†’ NDC ç©ºé—´ï¼ˆæ ‡å‡†åŒ–è®¾å¤‡åæ ‡ï¼‰</strong></p>
<ul>
<li>å‘ç”Ÿåœ¨ï¼š<strong>Vertex Post-Processingï¼ˆé¡¶ç‚¹åå¤„ç†ï¼‰</strong> é˜¶æ®µ</li>
<li>GPU è‡ªåŠ¨æ‰§è¡Œé€è§†é™¤æ³•ï¼š<code>(x/w, y/w, z/w)</code>ï¼Œå°†è£å‰ªç©ºé—´åæ ‡è½¬æ¢ä¸º NDC èŒƒå›´ <code>[-1, 1]</code></li>
</ul>
</li>
<li>
<p><strong>NDC ç©ºé—´ â†’ å±å¹•ç©ºé—´ï¼ˆåƒç´ åæ ‡ï¼‰</strong></p>
<ul>
<li>å‘ç”Ÿåœ¨ï¼š<strong>Vertex Post-Processingï¼ˆé¡¶ç‚¹åå¤„ç†ï¼‰</strong> é˜¶æ®µ</li>
<li>GPU è‡ªåŠ¨æ‰§è¡Œè§†å£å˜æ¢ï¼Œæ ¹æ® <code>gl.viewport()</code> è®¾ç½®å°† <code>[-1, 1]</code> æ˜ å°„åˆ°å±å¹•åƒç´ åæ ‡</li>
</ul>
</li>
</ol>
<p><strong>æ€»ç»“</strong>ï¼šå¼€å‘è€…åªéœ€åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­å®Œæˆå‰ä¸‰ä¸ªç©ºé—´çš„å˜æ¢ï¼Œé€è§†é™¤æ³•å’Œè§†å£å˜æ¢ç”± GPU å›ºå®šåŠŸèƒ½é˜¶æ®µè‡ªåŠ¨å®Œæˆã€‚</p>
<h3 data-id="heading-59">é€è§†æŠ•å½± vs æ­£äº¤æŠ•å½±</h3>
<p>æŠ•å½±çŸ©é˜µå†³å®šäº†ä»è§†å›¾ç©ºé—´åˆ°è£å‰ªç©ºé—´çš„å˜æ¢æ–¹å¼ï¼Œæœ‰ä¸¤ç§ç±»å‹ï¼š</p>
<p><strong>é€è§†æŠ•å½±ï¼ˆPerspective Projectionï¼‰</strong></p>
<p>è§†é”¥ä½“å½¢çŠ¶ä¸º<strong>é”¥å°</strong>ï¼ˆæˆªæ–­çš„é‡‘å­—å¡”ï¼‰ï¼Œæ¨¡æ‹Ÿäººçœ¼é€è§†æ•ˆæœã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript">       far plane (è¿œå¹³é¢)
      +-----------+
     <span class="hljs-regexp">/|          /</span>|
    <span class="hljs-regexp">/ |         /</span> |    â† è§†é”¥ä½“ï¼ˆfrustumï¼‰
   /  |        /  |
  <span class="hljs-regexp">/   +-------/</span>---+ near plane (è¿‘å¹³é¢)
 /   <span class="hljs-regexp">/       /</span>   /
+---+-------+   /
   eye (ç›¸æœº)
  (<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
</code></pre>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>è¿‘å¤§è¿œå°</strong>ï¼šç‰©ä½“å¤§å°éšè·ç¦»å˜åŒ–ï¼Œè¿œå¤„ç‰©ä½“çœ‹èµ·æ¥æ›´å°</li>
<li><strong>æ·±åº¦æ„Ÿå¼º</strong>ï¼šç¬¦åˆçœŸå®ä¸–ç•Œçš„é€è§†è§„å¾‹</li>
<li><strong>åº”ç”¨åœºæ™¯</strong>ï¼š3D æ¸¸æˆã€å»ºç­‘å¯è§†åŒ–ã€çœŸå®æ„Ÿæ¸²æŸ“</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä½¿ç”¨ gl-matrix åº“åˆ›å»ºé€è§†æŠ•å½±çŸ©é˜µ</span>
<span class="hljs-keyword">const</span> projectionMatrix = mat4.<span class="hljs-title function_">create</span>();
mat4.<span class="hljs-title function_">perspective</span>(
  projectionMatrix,
  <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">4</span>, <span class="hljs-comment">// fov: è§†é‡è§’åº¦ï¼ˆField of Viewï¼Œå¼§åº¦ï¼‰</span>
  canvas.<span class="hljs-property">width</span> / canvas.<span class="hljs-property">height</span>, <span class="hljs-comment">// aspect: å®½é«˜æ¯”</span>
  <span class="hljs-number">0.1</span>, <span class="hljs-comment">// near: è¿‘å¹³é¢è·ç¦»</span>
  <span class="hljs-number">100.0</span> <span class="hljs-comment">// far: è¿œå¹³é¢è·ç¦»</span>
);
</code></pre>
<p><strong>æ­£äº¤æŠ•å½±ï¼ˆOrthographic Projectionï¼‰</strong></p>
<p>è§†æ™¯ä½“å½¢çŠ¶ä¸º<strong>é•¿æ–¹ä½“</strong>ï¼Œå¹³è¡ŒæŠ•å½±ï¼Œç‰©ä½“å¤§å°ä¸éšè·ç¦»å˜åŒ–ã€‚</p>
<pre><code class="hljs language-lua" lang="lua">       far plane
      +<span class="hljs-comment">-----------+</span>
      |           |
      |           |    â† è§†æ™¯ä½“ï¼ˆé•¿æ–¹ä½“ï¼‰
      |           |
      +<span class="hljs-comment">-----------+ near plane</span>

  æ‰€æœ‰æŠ•å½±çº¿å¹³è¡Œ
      â†“ â†“ â†“ â†“ â†“
    æŠ•å½±æ–¹å‘
</code></pre>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>å¹³è¡ŒæŠ•å½±</strong>ï¼šè¿œè¿‘ç‰©ä½“å¤§å°ç›¸åŒï¼Œæ— é€è§†å˜å½¢</li>
<li><strong>æ— æ·±åº¦æ„Ÿ</strong>ï¼šé€‚åˆéœ€è¦ç²¾ç¡®æµ‹é‡çš„åœºæ™¯</li>
<li><strong>åº”ç”¨åœºæ™¯</strong>ï¼š2D æ¸¸æˆã€CAD è½¯ä»¶ã€å·¥ç¨‹å›¾çº¸ã€å»ºç­‘å¹³é¢å›¾ã€UI ç•Œé¢</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åˆ›å»ºæ­£äº¤æŠ•å½±çŸ©é˜µ</span>
<span class="hljs-keyword">const</span> projectionMatrix = mat4.<span class="hljs-title function_">create</span>();
mat4.<span class="hljs-title function_">ortho</span>(
  projectionMatrix,
  -<span class="hljs-number">10</span>,
  <span class="hljs-number">10</span>, <span class="hljs-comment">// left, right: å·¦å³è¾¹ç•Œï¼ˆè§†æ™¯ä½“å®½åº¦ï¼‰</span>
  -<span class="hljs-number">10</span>,
  <span class="hljs-number">10</span>, <span class="hljs-comment">// bottom, top: ä¸Šä¸‹è¾¹ç•Œï¼ˆè§†æ™¯ä½“é«˜åº¦ï¼‰</span>
  <span class="hljs-number">0.1</span>,
  <span class="hljs-number">100.0</span> <span class="hljs-comment">// near, far: è¿‘è¿œå¹³é¢è·ç¦»</span>
);
</code></pre>
<h3 data-id="heading-60">ç‰‡æ®µç€è‰²å™¨åœ¨æµ‹è¯•é˜¶æ®µä¹‹å‰æ‰§è¡Œï¼Œä¼šäº§ç”Ÿå¤šä½™è®¡ç®—å—ï¼Ÿ</h3>
<p>ä¸ä¸€å®šï¼Œç°ä»£ GPU æœ‰å¤šç§ç¡¬ä»¶ä¼˜åŒ–æœºåˆ¶é¿å…æµªè´¹è®¡ç®—ã€‚</p>
<p><strong>1. Scissor Test å’Œå…‰æ …åŒ–é˜¶æ®µä¼˜åŒ–</strong></p>
<ul>
<li>Scissor Test åªéœ€å±å¹•åæ ‡ï¼ŒGPU é€šå¸¸åœ¨å…‰æ …åŒ–é˜¶æ®µå°±ä¸¢å¼ƒè£å‰ªåŒºåŸŸå¤–çš„ç‰‡æ®µ</li>
<li>è¿™äº›ç‰‡æ®µä¸ä¼šè¿›å…¥ç‰‡æ®µç€è‰²å™¨ï¼Œä¸äº§ç”Ÿæµªè´¹</li>
</ul>
<p><strong>2. <a href="https://link.juejin.cn?target=https%3A%2F%2Fwikis.khronos.org%2Fopengl%2FEarly_Fragment_Test" target="_blank" title="https://wikis.khronos.org/opengl/Early_Fragment_Test" ref="nofollow noopener noreferrer">Early Fragment Test</a></strong></p>
<p>ç°ä»£ GPU æ”¯æŒåœ¨ç‰‡æ®µç€è‰²å™¨<strong>ä¹‹å‰</strong>æ‰§è¡Œæµ‹è¯•ï¼ˆScissor/Stencil/Depthï¼‰ï¼Œæå‰å‰”é™¤ä¸å¯è§ç‰‡æ®µï¼Œé¿å…æµªè´¹è®¡ç®—ã€‚</p>
<ul>
<li><strong>ç¡¬ä»¶ä¼˜åŒ–</strong>ï¼šEarly Fragment Test æ˜¯ GPU çš„æ€§èƒ½ä¼˜åŒ–ï¼Œé OpenGL/WebGL è§„èŒƒå¼ºåˆ¶è¦æ±‚ï¼Œå…·ä½“è¡Œä¸ºç”±ç¡¬ä»¶å’Œé©±åŠ¨å†³å®š</li>
<li><strong>æ˜¾å¼å£°æ˜</strong>ï¼ˆWebGL2/OpenGL ES 3.1+ï¼‰ï¼š<code>layout(early_fragment_tests) in;</code></li>
</ul>
<p><strong>æœ€ä½³å®è·µ</strong>ï¼šé¿å…åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­ä¿®æ”¹ <code>gl_FragDepth</code> æˆ–ä½¿ç”¨ <code>discard</code>ï¼Œå…ˆæ¸²æŸ“ä¸é€æ˜ç‰©ä½“ï¼ˆä»å‰å¾€åï¼‰ï¼ŒåŠé€æ˜ç‰©ä½“ä»åå¾€å‰æ¸²æŸ“ã€‚</p>
<h3 data-id="heading-61">WebGL ä¸­çš„ Target æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>Targetï¼ˆç›®æ ‡/ç»‘å®šç‚¹ï¼‰æ˜¯ WebGL çŠ¶æ€æœºä¸­çš„å…¨å±€ç»‘å®šç‚¹ï¼Œç”¨äºæŒ‡å®šåç»­æ“ä½œä½œç”¨äºå“ªä¸ªèµ„æºå¯¹è±¡ã€‚è°ƒç”¨ <code>gl.bind*()</code> æ—¶ï¼Œä¼šå°†èµ„æºå¯¹è±¡ç»‘å®šåˆ°æŒ‡å®šçš„ Targetï¼Œä¹‹åå¯¹è¯¥ Target çš„é…ç½®æ“ä½œéƒ½ä¼šä½œç”¨äºè¿™ä¸ªå¯¹è±¡ã€‚</p>
<p><strong>Target çš„ç”¨é€”</strong>ï¼šæŸäº› API æ‰§è¡Œæ—¶ä¼šä» Target è¯»å–å½“å‰ç»‘å®šçš„å¯¹è±¡ï¼Œå¸¸è§çš„æœ‰ï¼š</p>
<ul>
<li><strong>é…ç½®èµ„æºå¯¹è±¡</strong>ï¼š<code>bufferData</code>ã€<code>texImage2D</code>ã€<code>texParameteri</code> ç­‰ä»å¯¹åº” Target è¯»å–è¦é…ç½®çš„å¯¹è±¡</li>
<li><strong>ç»˜åˆ¶æ“ä½œ</strong>ï¼š<code>drawElements</code> ä» <code>ELEMENT_ARRAY_BUFFER</code> è¯»å–ç´¢å¼•æ•°æ®ï¼›<code>drawArrays</code> / <code>drawElements</code> ä» <code>FRAMEBUFFER</code> è¯»å–æ¸²æŸ“ç›®æ ‡</li>
<li><strong>æ•°æ®è¯»å–</strong>ï¼š<code>readPixels</code> ä» <code>READ_FRAMEBUFFER</code>ï¼ˆWebGL2ï¼‰æˆ– <code>FRAMEBUFFER</code>ï¼ˆWebGL1ï¼‰è¯»å–åƒç´ æ•°æ®</li>
<li><strong>æ•°æ®æ‹·è´</strong>ï¼š<code>copyBufferSubData</code> ä» <code>COPY_READ_BUFFER</code> å’Œ <code>COPY_WRITE_BUFFER</code> è¯»å–æºå’Œç›®æ ‡ç¼“å†²åŒº</li>
</ul>
<p><strong>WebGL ä¸­çš„ Target</strong>ï¼š</p>





































































<table><thead><tr><th>Target</th><th>ä½œç”¨è¯´æ˜</th></tr></thead><tbody><tr><td><code>ARRAY_BUFFER</code></td><td>é…ç½®é¡¶ç‚¹å±æ€§æ•°æ®ã€‚</td></tr><tr><td><code>ELEMENT_ARRAY_BUFFER</code></td><td>å­˜å‚¨é¡¶ç‚¹ç´¢å¼•æ•°æ®ã€‚<code>drawElements</code> å®æ—¶è¯»å–ï¼Œç»˜åˆ¶æ—¶å¿…é¡»ä¿æŒç»‘å®š</td></tr><tr><td><code>FRAMEBUFFER</code></td><td>æŒ‡å®šæ¸²æŸ“è¾“å‡ºç›®æ ‡ã€‚ç»˜åˆ¶æ—¶å®æ—¶è¯»å–ï¼Œå†³å®šæ¸²æŸ“åˆ° FBO è¿˜æ˜¯ Canvasï¼Œå¿…é¡»ä¿æŒç»‘å®š</td></tr><tr><td><code>TEXTURE_2D</code></td><td>2D çº¹ç†ã€‚é…ç½®çº¹ç†å‚æ•°æ—¶ä½¿ç”¨ï¼Œç»˜åˆ¶æ—¶ä½¿ç”¨çº¹ç†å•å…ƒç»‘å®šè€Œéæ­¤ Target</td></tr><tr><td><code>TEXTURE_CUBE_MAP</code></td><td>ç«‹æ–¹ä½“è´´å›¾ï¼ˆ6 ä¸ªé¢ï¼‰ã€‚ç”¨äºå¤©ç©ºç›’ã€ç¯å¢ƒåå°„</td></tr><tr><td><code>RENDERBUFFER</code></td><td>ç¦»å±æ¸²æŸ“å­˜å‚¨ã€‚ä½œä¸ºå¸§ç¼“å†²çš„æ·±åº¦/æ¨¡æ¿é™„ä»¶ï¼Œç»˜åˆ¶æ—¶ä¸ç›´æ¥ä½¿ç”¨</td></tr><tr><td><code>COPY_READ_BUFFER</code> (WebGL2)</td><td>ç¼“å†²åŒºæ‹·è´æºã€‚ç”¨äº <code>copyBufferSubData</code></td></tr><tr><td><code>COPY_WRITE_BUFFER</code> (WebGL2)</td><td>ç¼“å†²åŒºæ‹·è´ç›®æ ‡ã€‚ç”¨äº <code>copyBufferSubData</code></td></tr><tr><td><code>UNIFORM_BUFFER</code> (WebGL2)</td><td>Uniform Buffer Objectsã€‚æ‰¹é‡ä¸Šä¼  Uniform æ•°æ®ï¼Œç»˜åˆ¶æ—¶è¯»å–</td></tr><tr><td><code>PIXEL_PACK_BUFFER</code> (WebGL2)</td><td>å¼‚æ­¥è¯»å–åƒç´ æ•°æ®ï¼ˆGPU â†’ CPUï¼‰ã€‚ç”¨äº <code>readPixels</code></td></tr><tr><td><code>PIXEL_UNPACK_BUFFER</code> (WebGL2)</td><td>å¼‚æ­¥ä¸Šä¼ åƒç´ æ•°æ®ï¼ˆCPU â†’ GPUï¼‰ã€‚ç”¨äº <code>texImage2D</code> / <code>texSubImage2D</code></td></tr><tr><td><code>TEXTURE_3D</code> (WebGL2)</td><td>3D çº¹ç†ï¼ˆä½“ç§¯çº¹ç†ï¼‰ã€‚ç”¨äºä½“ç§¯æ¸²æŸ“ã€3D å™ªå£°</td></tr><tr><td><code>TEXTURE_2D_ARRAY</code> (WebGL2)</td><td>2D çº¹ç†æ•°ç»„ã€‚çº¹ç†é›†åˆï¼ˆå¦‚åœ°å½¢åˆ†å±‚çº¹ç†ï¼‰</td></tr><tr><td><code>DRAW_FRAMEBUFFER</code> (WebGL2)</td><td>ç»˜åˆ¶ç›®æ ‡ã€‚å¯ä¸ <code>READ_FRAMEBUFFER</code> åˆ†ç¦»ç»‘å®š</td></tr><tr><td><code>READ_FRAMEBUFFER</code> (WebGL2)</td><td>è¯»å–æºã€‚ç”¨äº <code>readPixels</code>ã€<code>blitFramebuffer</code></td></tr></tbody></table>
<h3 data-id="heading-62">WebGL ä¸­çš„ Attachment æ˜¯ä»€ä¹ˆï¼Ÿ</h3>
<p>Attachmentï¼ˆé™„ä»¶ï¼‰æ˜¯å¸§ç¼“å†²å¯¹è±¡ï¼ˆFramebufferï¼‰çš„å­˜å‚¨æ§½ä½ï¼Œç”¨äºæŒ‡å®šæ¸²æŸ“ç®¡é“è¾“å‡ºæ•°æ®çš„å­˜å‚¨ä½ç½®ã€‚æ¯ä¸ª Attachment å¯ä»¥é™„åŠ ä¸€ä¸ªçº¹ç†ï¼ˆTextureï¼‰æˆ–æ¸²æŸ“ç¼“å†²å¯¹è±¡ï¼ˆRenderbufferï¼‰ï¼Œç”¨äºå­˜å‚¨æ¸²æŸ“ç»“æœçš„ä¸åŒç±»å‹æ•°æ®ã€‚</p>
<p><strong>WebGL ä¸­çš„ Attachment</strong>ï¼š</p>





























<table><thead><tr><th>Attachment</th><th>ä½œç”¨è¯´æ˜</th></tr></thead><tbody><tr><td><code>COLOR_ATTACHMENT0</code></td><td>é¢œè‰²é™„ä»¶ 0ã€‚å­˜å‚¨ç‰‡æ®µç€è‰²å™¨è¾“å‡ºçš„é¢œè‰²æ•°æ®ï¼ˆWebGL1 åªæ”¯æŒä¸€ä¸ªé¢œè‰²é™„ä»¶ï¼‰</td></tr><tr><td><code>COLOR_ATTACHMENT1</code> ~ <code>COLOR_ATTACHMENT15</code></td><td>é¢œè‰²é™„ä»¶ 1-15ã€‚WebGL2 æ”¯æŒå¤šæ¸²æŸ“ç›®æ ‡ï¼ˆMRTï¼‰ï¼Œç‰‡æ®µç€è‰²å™¨å¯åŒæ—¶è¾“å‡ºåˆ°å¤šä¸ªé¢œè‰²é™„ä»¶</td></tr><tr><td><code>DEPTH_ATTACHMENT</code></td><td>æ·±åº¦é™„ä»¶ã€‚å­˜å‚¨æ·±åº¦æµ‹è¯•çš„æ·±åº¦å€¼ï¼ŒèŒƒå›´ [0, 1]</td></tr><tr><td><code>STENCIL_ATTACHMENT</code></td><td>æ¨¡æ¿é™„ä»¶ã€‚å­˜å‚¨æ¨¡æ¿æµ‹è¯•çš„æ¨¡æ¿å€¼ï¼Œ8 ä½æ•´æ•°</td></tr><tr><td><code>DEPTH_STENCIL_ATTACHMENT</code></td><td>æ·±åº¦ + æ¨¡æ¿é™„ä»¶ã€‚åŒæ—¶å­˜å‚¨æ·±åº¦å’Œæ¨¡æ¿æ•°æ®ï¼ˆWebGL1 éœ€è¦æ‰©å±• <code>WEBGL_depth_texture</code>ï¼ŒWebGL2 åŸç”Ÿï¼‰</td></tr></tbody></table>
<h3 data-id="heading-63">ä»€ä¹ˆæ˜¯ RenderBufferï¼Ÿ</h3>
<p>RenderBuffer (æ¸²æŸ“ç¼“å†²å¯¹è±¡) æ˜¯ä¸€ç§ GPU å†…å­˜å¯¹è±¡ï¼Œä¸“é—¨ç”¨ä½œå¸§ç¼“å†²çš„é™„ä»¶ (Attachment)ï¼Œå­˜å‚¨æ¸²æŸ“æ•°æ®ã€‚å®ƒæ˜¯å¸§ç¼“å†²ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ï¼Œé€šå¸¸ç”¨äºæ·±åº¦ç¼“å†²æˆ–æ¨¡æ¿ç¼“å†²ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>ä¸èƒ½åœ¨ç€è‰²å™¨ä¸­é‡‡æ ·</strong>ï¼šRenderBuffer å¯ä»¥ä½œä¸ºæ¸²æŸ“è¾“å‡ºç›®æ ‡ï¼ˆå†™å…¥ï¼‰ï¼ŒGPU å›ºå®šç®¡é“å¯ä»¥è¯»å–å®ƒè¿›è¡Œæµ‹è¯•ï¼ˆå¦‚æ·±åº¦æµ‹è¯•ã€æ¨¡æ¿æµ‹è¯•ï¼‰ï¼Œä½†ä¸èƒ½åœ¨ç€è‰²å™¨ä¸­é€šè¿‡ <code>texture2D()</code> ç­‰å‡½æ•°é‡‡æ ·è¯»å–ï¼ˆä¸çº¹ç†ä¸åŒï¼‰</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šç›¸æ¯”çº¹ç†ï¼ŒRenderBuffer é’ˆå¯¹æ¸²æŸ“è¾“å‡ºä¼˜åŒ–ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ€§èƒ½æ›´å¥½</li>
</ul>
<p><strong>RenderBuffer vs Texture</strong>ï¼š</p>













































<table><thead><tr><th>ç‰¹æ€§</th><th>RenderBuffer</th><th>Texture</th></tr></thead><tbody><tr><td>ç€è‰²å™¨é‡‡æ ·</td><td>ä¸æ”¯æŒï¼ˆä¸èƒ½åœ¨ç€è‰²å™¨ä¸­è¯»å–ï¼‰</td><td>æ”¯æŒï¼ˆå¯ä»¥åœ¨ç€è‰²å™¨ä¸­é‡‡æ ·ï¼‰</td></tr><tr><td>GPU å›ºå®šç®¡é“</td><td>æ”¯æŒï¼ˆæ·±åº¦æµ‹è¯•ã€æ¨¡æ¿æµ‹è¯•è‡ªåŠ¨è¯»å–ï¼‰</td><td>æ”¯æŒï¼ˆæ·±åº¦æµ‹è¯•ã€æ¨¡æ¿æµ‹è¯•è‡ªåŠ¨è¯»å–ï¼‰</td></tr><tr><td>æ€§èƒ½</td><td>æ¸²æŸ“è¾“å‡ºæ€§èƒ½æ›´å¥½ï¼ˆæŸäº›ç¡¬ä»¶ï¼‰</td><td>é‡‡æ ·æ€§èƒ½æ›´å¥½</td></tr><tr><td>Mipmap</td><td>ä¸æ”¯æŒ</td><td>æ”¯æŒ</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>æ·±åº¦/æ¨¡æ¿ç¼“å†²ï¼Œä¸éœ€è¦ç€è‰²å™¨é‡‡æ ·çš„é™„ä»¶</td><td>éœ€è¦åœ¨ç€è‰²å™¨ä¸­é‡‡æ ·çš„é™„ä»¶ï¼ˆé˜´å½±è´´å›¾ç­‰ï¼‰</td></tr><tr><td>å¤šé‡é‡‡æ ·</td><td>WebGL2 æ”¯æŒ MSAA</td><td>éœ€è¦ç‰¹æ®Šå¤„ç†</td></tr><tr><td>çµæ´»æ€§</td><td>ä»…ç”¨äºå¸§ç¼“å†²é™„ä»¶</td><td>å¯ç”¨äºå¸§ç¼“å†²é™„ä»¶ã€ç€è‰²å™¨é‡‡æ ·ã€æ•°æ®ä¼ è¾“</td></tr></tbody></table>
<p><strong>WebGL2 çš„å¤šé‡é‡‡æ ·</strong>ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// WebGL2: åˆ›å»º MSAA RenderBufferï¼ˆæŠ—é”¯é½¿ï¼‰</span>
gl.<span class="hljs-title function_">renderbufferStorageMultisample</span>(
  gl.<span class="hljs-property">RENDERBUFFER</span>,
  <span class="hljs-number">4</span>, <span class="hljs-comment">// é‡‡æ ·æ•°ï¼ˆé€šå¸¸ 4 æˆ– 8ï¼‰</span>
  gl.<span class="hljs-property">RGBA8</span>, <span class="hljs-comment">// å†…éƒ¨æ ¼å¼</span>
  <span class="hljs-number">512</span>,
  <span class="hljs-number">512</span> <span class="hljs-comment">// å®½åº¦ã€é«˜åº¦</span>
);
</code></pre>
<h3 data-id="heading-64">GLSL ä¸­çš„ç²¾åº¦é™åˆ¶ï¼ˆprecisionï¼‰</h3>
<p>GLSL ä¸­çš„ç²¾åº¦é™åˆ¶ï¼ˆprecisionï¼‰ç”¨äºæŒ‡å®šæµ®ç‚¹æ•°å’Œæ•´æ•°å˜é‡çš„ç²¾åº¦ç­‰çº§ï¼Œç›´æ¥å½±å“è®¡ç®—çš„æ•°å€¼èŒƒå›´ã€ç²¾åº¦å’Œæ€§èƒ½ã€‚è¿™æ˜¯ OpenGL ESï¼ˆå› æ­¤ä¹Ÿæ˜¯ WebGLï¼‰ç‰¹æœ‰çš„ç‰¹æ€§ï¼Œæ¡Œé¢ OpenGL ä¸éœ€è¦ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦ç²¾åº¦é™åˆ¶ï¼Ÿ</strong></p>
<ol>
<li>
<p><strong>ç¡¬ä»¶å·®å¼‚</strong>ï¼šç§»åŠ¨ GPU å’Œæ¡Œé¢ GPU çš„æ¶æ„ä¸åŒ</p>
<ul>
<li>ç§»åŠ¨ GPUï¼šåŠŸè€—å’Œé¢ç§¯å—é™ï¼Œæ”¯æŒå¤šç§ç²¾åº¦ï¼ˆ16 ä½ã€24 ä½ã€32 ä½ï¼‰ä»¥å¹³è¡¡æ€§èƒ½å’Œç²¾åº¦</li>
<li>æ¡Œé¢ GPUï¼šé€šå¸¸ç»Ÿä¸€ä½¿ç”¨ 32 ä½æµ®ç‚¹ï¼Œæ€§èƒ½è¶³å¤Ÿå¼º</li>
</ul>
</li>
<li>
<p><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šä½ç²¾åº¦è®¡ç®—æ›´å¿«ã€æ›´çœç”µ</p>
<ul>
<li><code>lowp</code>ï¼ˆä½ç²¾åº¦ï¼‰ï¼šå¯„å­˜å™¨å ç”¨å°‘ã€è®¡ç®—å•å…ƒç®€å•ã€åŠŸè€—ä½</li>
<li><code>highp</code>ï¼ˆé«˜ç²¾åº¦ï¼‰ï¼šå¯„å­˜å™¨å ç”¨å¤šã€è®¡ç®—å¤æ‚ã€åŠŸè€—é«˜</li>
</ul>
</li>
<li>
<p><strong>èµ„æºèŠ‚çº¦</strong>ï¼šç²¾åº¦å½±å“ GPU å¯„å­˜å™¨å’Œå¸¦å®½æ¶ˆè€—</p>
<ul>
<li>ä½ç²¾åº¦å˜é‡å ç”¨æ›´å°‘çš„å¯„å­˜å™¨ç©ºé—´</li>
<li>Varying å˜é‡çš„ç²¾åº¦å½±å“é¡¶ç‚¹ç€è‰²å™¨åˆ°ç‰‡æ®µç€è‰²å™¨çš„æ•°æ®ä¼ è¾“å¸¦å®½</li>
</ul>
</li>
</ol>
<p><strong>ç²¾åº¦çº§åˆ«</strong>ï¼š</p>

































<table><thead><tr><th>ç²¾åº¦</th><th>æµ®ç‚¹æ•°èŒƒå›´ï¼ˆè¿‘ä¼¼ï¼‰</th><th>æµ®ç‚¹æ•°ç²¾åº¦</th><th>æ•´æ•°èŒƒå›´</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><code>lowp</code></td><td>-2 ~ +2</td><td>8-10 ä½ï¼ˆ1/256ï¼‰</td><td>-2^8 ~ 2^8</td><td>é¢œè‰²ã€å½’ä¸€åŒ–æ–¹å‘ã€çº¹ç†åæ ‡</td></tr><tr><td><code>mediump</code></td><td>-2^14 ~ +2^14</td><td>10-16 ä½</td><td>-2^10 ~ 2^10</td><td>çº¹ç†åæ ‡ã€æ³•çº¿ã€ä¸­ç­‰èŒƒå›´çš„è®¡ç®—</td></tr><tr><td><code>highp</code></td><td>-2^62 ~ +2^62</td><td>16-32 ä½</td><td>-2^16 ~ 2^16</td><td>ä½ç½®è®¡ç®—ã€çŸ©é˜µå˜æ¢ã€é«˜ç²¾åº¦éœ€æ±‚</td></tr></tbody></table>
<p><strong>æ³¨æ„</strong>ï¼š</p>
<ul>
<li>è§„èŒƒåªå®šä¹‰äº†æœ€ä½è¦æ±‚ï¼Œå®é™…ç²¾åº¦ç”±ç¡¬ä»¶å†³å®š</li>
<li>æŸäº›ç§»åŠ¨è®¾å¤‡çš„ç‰‡æ®µç€è‰²å™¨ä¸æ”¯æŒ <code>highp</code>ï¼ˆéœ€æ£€æµ‹ï¼‰</li>
</ul>
<h3 data-id="heading-65">ä»€ä¹ˆæ˜¯é½æ¬¡åæ ‡ï¼Ÿ</h3>
<p>é½æ¬¡åæ ‡ï¼ˆHomogeneous Coordinatesï¼‰æ˜¯è®¡ç®—æœºå›¾å½¢å­¦ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œé€šè¿‡åœ¨ N ç»´åæ ‡ä¸­å¢åŠ ä¸€ä¸ªé¢å¤–çš„åˆ†é‡ wï¼Œå°† N ç»´ç©ºé—´åµŒå…¥åˆ° (N+1) ç»´ç©ºé—´ä¸­ã€‚3D å›¾å½¢ä¸­ï¼Œé½æ¬¡åæ ‡å°† 3D ç¬›å¡å°”åæ ‡ <code>(x, y, z)</code> è¡¨ç¤ºä¸º 4D å‘é‡ <code>(x, y, z, w)</code>ã€‚åœ¨ WebGL ä¸­ï¼Œé¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºé½æ¬¡åæ ‡ <code>gl_Position</code>ï¼ŒGPU è‡ªåŠ¨æ‰§è¡Œé€è§†é™¤æ³•å¾—åˆ° ç¬›å¡å°”åæ ‡ï¼ˆNDCï¼‰ã€‚</p>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šé½æ¬¡åæ ‡é€šè¿‡ w åˆ†é‡ç»Ÿä¸€è¡¨ç¤ºç‚¹å’Œå‘é‡ï¼Œå¹¶å°†å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ã€æŠ•å½±ç­‰å˜æ¢ç»Ÿä¸€ä¸ºçŸ©é˜µä¹˜æ³•ã€‚</p>
<p><strong>é½æ¬¡åæ ‡ä¸ç¬›å¡å°”åæ ‡çš„è½¬æ¢</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ç¬›å¡å°”åæ ‡ â†’ é½æ¬¡åæ ‡ï¼š
(x, y, z) â†’ (x, y, z, <span class="hljs-number">1</span>)    <span class="hljs-comment">// ç‚¹ï¼ˆPositionï¼‰</span>
(x, y, z) â†’ (x, y, z, <span class="hljs-number">0</span>)    <span class="hljs-comment">// å‘é‡ï¼ˆDirectionï¼‰</span>

é½æ¬¡åæ ‡ â†’ ç¬›å¡å°”åæ ‡ï¼ˆé€è§†é™¤æ³•ï¼‰ï¼š
(x, y, z, w) â†’ (x/w, y/w, z/w)
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦é½æ¬¡åæ ‡ï¼Ÿ</strong></p>
<ol>
<li><strong>ç»Ÿä¸€å˜æ¢è¡¨ç¤º</strong>ï¼šæ‰€æœ‰ä»¿å°„å˜æ¢ï¼ˆå¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ï¼‰å’ŒæŠ•å½±å˜æ¢éƒ½å¯ä»¥ç”¨ 4Ã—4 çŸ©é˜µè¡¨ç¤º</li>
</ol>
<pre><code class="hljs language-glsl" lang="glsl">// æ²¡æœ‰é½æ¬¡åæ ‡ï¼šå¹³ç§»éœ€è¦ç‰¹æ®Šå¤„ç†
vec3 transformed = rotation * position + translation;  // ä¸æ˜¯çº¯çŸ©é˜µè¿ç®—

// æœ‰é½æ¬¡åæ ‡ï¼šæ‰€æœ‰å˜æ¢ç»Ÿä¸€ä¸ºçŸ©é˜µä¹˜æ³•
vec4 transformed = matrix * vec4(position, 1.0);  // ç»Ÿä¸€çš„çŸ©é˜µè¿ç®—
</code></pre>
<ol start="2">
<li><strong>è¡¨ç¤ºæ— ç©·è¿œç‚¹/å‘é‡</strong>ï¼šw = 0 è¡¨ç¤ºæ–¹å‘å‘é‡ï¼ˆæ²¡æœ‰å¹³ç§»ï¼‰æˆ–æ— ç©·è¿œç‚¹</li>
</ol>
<pre><code class="hljs language-scss" lang="scss">(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment">// X è½´æ–¹å‘çš„æ— ç©·è¿œç‚¹</span>
(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)  <span class="hljs-comment">// Y è½´æ–¹å‘çš„æ— ç©·è¿œç‚¹</span>
</code></pre>
<ol start="3">
<li><strong>å®ç°é€è§†æŠ•å½±</strong>ï¼šé€šè¿‡ä¿®æ”¹ w åˆ†é‡å®ç°é€è§†æ•ˆæœ</li>
</ol>
<pre><code class="hljs language-scss" lang="scss">é€è§†æŠ•å½±åï¼šgl_Position = (x, y, z, z)  <span class="hljs-comment">// w = zï¼ˆæ·±åº¦ï¼‰</span>
é€è§†é™¤æ³•åï¼šå±å¹•åæ ‡ = (x/z, y/z, <span class="hljs-number">1</span>)   <span class="hljs-comment">// è¿‘å¤§è¿œå°</span>
</code></pre>
<h3 data-id="heading-66">WebGL ä¸­æœ‰å“ªäº› Objectï¼Ÿ</h3>
<p>WebGL ä¸­çš„ Object æ˜¯å°è£… GPU èµ„æºçš„å¥æŸ„ï¼Œç”¨äºç®¡ç†æ¸²æŸ“æ‰€éœ€çš„å„ç§æ•°æ®å’ŒçŠ¶æ€ã€‚ä»¥ä¸‹æ˜¯ä¸»è¦çš„ Object ç±»å‹åŠå…¶å¸¸è§ç®€å†™ï¼š</p>
<p><strong>å¸¸è§ Object ç®€å†™</strong>ï¼š</p>


















































<table><thead><tr><th>ç®€å†™</th><th>å…¨ç§°</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>VBO</td><td>Vertex Buffer Object</td><td>é¡¶ç‚¹ç¼“å†²å¯¹è±¡ï¼ˆå­˜å‚¨é¡¶ç‚¹å±æ€§æ•°æ®ï¼‰</td></tr><tr><td>EBO/IBO</td><td>Element/Index Buffer Object</td><td>å…ƒç´ /ç´¢å¼•ç¼“å†²å¯¹è±¡ï¼ˆå­˜å‚¨ç´¢å¼•æ•°æ®ï¼‰</td></tr><tr><td>VAO</td><td>Vertex Array Object</td><td>é¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼ˆä¿å­˜é¡¶ç‚¹å±æ€§é…ç½®çŠ¶æ€ï¼‰</td></tr><tr><td>FBO</td><td>Framebuffer Object</td><td>å¸§ç¼“å†²å¯¹è±¡ï¼ˆç¦»å±æ¸²æŸ“ç›®æ ‡ï¼‰</td></tr><tr><td>UBO</td><td>Uniform Buffer Object</td><td>Uniform ç¼“å†²å¯¹è±¡ï¼ˆæ‰¹é‡ä¸Šä¼  Uniform æ•°æ®ï¼‰</td></tr><tr><td>PBO</td><td>Pixel Buffer Object</td><td>åƒç´ ç¼“å†²å¯¹è±¡ï¼ˆå¼‚æ­¥è¯»å†™åƒç´ æ•°æ®ï¼‰</td></tr><tr><td>TBO</td><td>Texture Buffer Object</td><td>çº¹ç†ç¼“å†²å¯¹è±¡ï¼ˆå°†ç¼“å†²åŒºä½œä¸ºçº¹ç†è®¿é—®ï¼‰</td></tr><tr><td>RBO</td><td>Renderbuffer Object</td><td>æ¸²æŸ“ç¼“å†²å¯¹è±¡ï¼ˆä½œä¸ºå¸§ç¼“å†²é™„ä»¶ï¼‰</td></tr></tbody></table>
<p><strong>æ•°æ®å­˜å‚¨å¯¹è±¡</strong>ï¼š</p>






























<table><thead><tr><th>Object</th><th>ä½œç”¨è¯´æ˜</th><th>åˆ›å»ºæ–¹æ³•</th></tr></thead><tbody><tr><td>Buffer</td><td>å­˜å‚¨é¡¶ç‚¹æ•°æ®ï¼ˆä½ç½®ã€é¢œè‰²ã€æ³•çº¿ã€UV ç­‰ï¼‰æˆ–ç´¢å¼•æ•°æ®ï¼Œæ˜¯ GPU å†…å­˜ä¸­çš„æ•°æ®å—</td><td><code>gl.createBuffer()</code></td></tr><tr><td>Texture</td><td>å­˜å‚¨å›¾åƒæ•°æ®ï¼Œç”¨äºçº¹ç†é‡‡æ ·ï¼ˆ2D çº¹ç†ã€ç«‹æ–¹ä½“è´´å›¾ã€3D çº¹ç†ç­‰ï¼‰</td><td><code>gl.createTexture()</code></td></tr><tr><td>Renderbuffer</td><td>å­˜å‚¨æ¸²æŸ“æ•°æ®ï¼Œä½œä¸ºå¸§ç¼“å†²çš„é™„ä»¶ï¼ˆé€šå¸¸ç”¨äºæ·±åº¦æˆ–æ¨¡æ¿ç¼“å†²åŒºï¼‰ï¼Œä¸å¯ç›´æ¥é‡‡æ ·</td><td><code>gl.createRenderbuffer()</code></td></tr><tr><td>Framebuffer</td><td>æ¸²æŸ“ç›®æ ‡å®¹å™¨ï¼ŒåŒ…å«é¢œè‰²ã€æ·±åº¦ã€æ¨¡æ¿é™„ä»¶ï¼Œç”¨äºç¦»å±æ¸²æŸ“</td><td><code>gl.createFramebuffer()</code></td></tr></tbody></table>
<p><strong>ç€è‰²å™¨ç›¸å…³å¯¹è±¡</strong>ï¼š</p>




















<table><thead><tr><th>Object</th><th>ä½œç”¨è¯´æ˜</th><th>åˆ›å»ºæ–¹æ³•</th></tr></thead><tbody><tr><td>Shader</td><td>ç€è‰²å™¨å¯¹è±¡ï¼ŒåŒ…å« GLSL æºç ï¼ˆé¡¶ç‚¹ç€è‰²å™¨æˆ–ç‰‡æ®µç€è‰²å™¨ï¼‰</td><td><code>gl.createShader()</code></td></tr><tr><td>Program</td><td>ç€è‰²å™¨ç¨‹åºå¯¹è±¡ï¼Œé“¾æ¥é¡¶ç‚¹ç€è‰²å™¨å’Œç‰‡æ®µç€è‰²å™¨ï¼Œæ˜¯å¯åœ¨ GPU ä¸Šæ‰§è¡Œçš„å®Œæ•´ç¨‹åº</td><td><code>gl.createProgram()</code></td></tr></tbody></table>
<p><strong>WebGL2 æ–°å¢å¯¹è±¡</strong>ï¼š</p>



































<table><thead><tr><th>Object</th><th>ä½œç”¨è¯´æ˜</th><th>åˆ›å»ºæ–¹æ³•</th></tr></thead><tbody><tr><td>VertexArray</td><td>ä¿å­˜é¡¶ç‚¹å±æ€§é…ç½®çŠ¶æ€ï¼ˆ<code>vertexAttribPointer</code>ã€<code>enableVertexAttribArray</code>ã€ç´¢å¼•ç¼“å†²åŒºç»‘å®šï¼‰</td><td><code>gl.createVertexArray()</code></td></tr><tr><td>Sampler</td><td>çº¹ç†é‡‡æ ·å‚æ•°å¯¹è±¡ï¼Œå°†çº¹ç†æ•°æ®å’Œé‡‡æ ·å‚æ•°åˆ†ç¦»ç®¡ç†</td><td><code>gl.createSampler()</code></td></tr><tr><td>Query</td><td>æŸ¥è¯¢å¯¹è±¡ï¼Œç”¨äºå¼‚æ­¥æŸ¥è¯¢ GPU çŠ¶æ€ï¼ˆå¦‚é®æŒ¡æŸ¥è¯¢ã€å˜æ¢åé¦ˆæŸ¥è¯¢ï¼‰</td><td><code>gl.createQuery()</code></td></tr><tr><td>TransformFeedback</td><td>å˜æ¢åé¦ˆå¯¹è±¡ï¼Œæ•è·é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºæ•°æ®å›ä¼ åˆ°ç¼“å†²åŒºï¼Œç”¨äº GPU ç²’å­ç³»ç»Ÿç­‰</td><td><code>gl.createTransformFeedback()</code></td></tr><tr><td>Sync</td><td>åŒæ­¥å¯¹è±¡ï¼Œç”¨äº CPU-GPU åŒæ­¥æ§åˆ¶ï¼ˆé€šè¿‡ <code>fenceSync</code> åˆ›å»ºæ …æ ï¼Œ<code>clientWaitSync</code> ç­‰å¾…å®Œæˆï¼‰</td><td><code>gl.fenceSync()</code></td></tr></tbody></table>
<p><strong>å¯¹è±¡çš„é€šç”¨ç‰¹æ€§</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰ Object éƒ½æ˜¯ä¸é€æ˜çš„å¼•ç”¨ï¼ˆWebGLBufferã€WebGLTexture ç­‰ç±»å‹ï¼‰</li>
<li>é€šè¿‡ <code>gl.bind*()</code> æ–¹æ³•ç»‘å®šåˆ° Targetï¼ˆç»‘å®šç‚¹ï¼‰åæ‰èƒ½é…ç½®æˆ–ä½¿ç”¨</li>
<li>é€šè¿‡ <code>gl.delete*()</code> æ–¹æ³•é‡Šæ”¾ GPU èµ„æºï¼ˆå¦‚ <code>gl.deleteBuffer(buffer)</code>ï¼‰</li>
<li>åˆ é™¤åçš„å¯¹è±¡å¼•ç”¨ä¸åº”å†ä½¿ç”¨ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´é”™è¯¯</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ•‘å‘½ï¼Javaè¿™3ä¸ªå°æŠ€å·§ï¼Œå†™èµ·æ¥çˆ½åˆ°é£èµ·âœ¨]]></title>    <link>https://juejin.cn/post/7585686247269941257</link>    <guid>https://juejin.cn/post/7585686247269941257</guid>    <pubDate>2025-12-20T13:05:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585686247269941257" data-draft-id="7585446706328043529" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ•‘å‘½ï¼Javaè¿™3ä¸ªå°æŠ€å·§ï¼Œå†™èµ·æ¥çˆ½åˆ°é£èµ·âœ¨"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2025-12-20T13:05:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AAAç®€å•ç©è½¬ç¨‹åºè®¾è®¡"/> <meta itemprop="url" content="https://juejin.cn/user/4294056357689099"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ•‘å‘½ï¼Javaè¿™3ä¸ªå°æŠ€å·§ï¼Œå†™èµ·æ¥çˆ½åˆ°é£èµ·âœ¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4294056357689099/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AAAç®€å•ç©è½¬ç¨‹åºè®¾è®¡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:05:39.000Z" title="Sat Dec 20 2025 13:05:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å“ˆå–½å„ä½æ˜é‡‘çš„å°ä¼™ä¼´ï½ æ—¥å¸¸å†™Javaæ€»è¢«åŸºç¡€è¯­æ³•å›°ä½ï¼Ÿä»Šå¤©åˆ†äº«3ä¸ªè¿›é˜¶ååŸºç¡€çš„å®ç”¨æŠ€å·§ï¼Œä»£ç çŸ­ã€ä¸Šæ‰‹å¿«ï¼Œå‘Šåˆ«å†—ä½™å†™æ³•ï¼Œæ•ˆç‡ç›´æ¥ç¿»å€ï¼å…¨ç¨‹é™„æç®€ç¤ºä¾‹ï¼Œæ–°æ‰‹ä¹Ÿèƒ½ç§’æ‡‚ğŸ‘‡</p>
<h2 data-id="heading-0">1.  Optionalï¼šå½»åº•å’ŒNullPointerExceptionè¯´æ‹œæ‹œ</h2>
<p>è¿˜åœ¨å†™ä¸€å †Â if(obj != null)Â åˆ¤ç©ºï¼ŸOptionalä¸“æ²»å„ç§ç©ºæŒ‡é’ˆï¼Œä»£ç å¹²å‡€åˆ°ç¦»è°±ï¼Œè¿›é˜¶å¿…å¤‡åŸºç¡€æ“ä½œï¼</p>
<p>æ ¸å¿ƒç”¨æ³•ï¼šé¿å…ç©ºåˆ¤æ–­ï¼Œä¼˜é›…å–å€¼/å…œåº•</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.Optional;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OptionalDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-comment">// è€å†™æ³•ï¼šä¸€å †ifåˆ¤ç©ºï¼Œç¹çæ˜“å‡ºé”™</span>
        <span class="hljs-keyword">if</span> (name != <span class="hljs-literal">null</span>) {
            System.out.println(name.length());
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"é»˜è®¤åç§°"</span>);
        }
        
        <span class="hljs-comment">// æ–°å†™æ³•ï¼šOptionalä¸€è¡Œæå®šï¼Œä¼˜é›…åˆ°å“­</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Optional.ofNullable(name).orElse(<span class="hljs-string">"é»˜è®¤åç§°"</span>);
        System.out.println(result); <span class="hljs-comment">// è¾“å‡ºï¼šé»˜è®¤åç§°</span>
        
        <span class="hljs-comment">// è¿›é˜¶ï¼šæœ‰å€¼æ‰æ‰§è¡Œï¼Œæ— å€¼ä¸æ“ä½œ</span>
        Optional.ofNullable(name).ifPresent(n -&gt; System.out.println(n.length()));
    }
}
Â 
</code></pre>
<h2 data-id="heading-1">2.  Streamæµï¼šé›†åˆæ“ä½œå¤©èŠ±æ¿ï¼Œä¸€è¡Œé¡¶åè¡Œ</h2>
<p>éå†é›†åˆè¿˜åœ¨ç”¨forå¾ªç¯ï¼ŸStreamæµè®©é›†åˆç­›é€‰ã€æ˜ å°„ã€ç»Ÿè®¡å˜ç®€å•ï¼Œä»£ç ç®€æ´åˆä¼˜é›…ï¼Œè¿›é˜¶åŸºç¡€å¿…æŒæ¡ï¼</p>
<p>æ ¸å¿ƒç”¨æ³•ï¼šç®€åŒ–é›†åˆæ“ä½œï¼Œå‘Šåˆ«åµŒå¥—å¾ªç¯</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StreamDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Integer&gt; nums = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        nums.add(<span class="hljs-number">1</span>);nums.add(<span class="hljs-number">2</span>);nums.add(<span class="hljs-number">3</span>);nums.add(<span class="hljs-number">4</span>);nums.add(<span class="hljs-number">5</span>);
        
        <span class="hljs-comment">// è€å†™æ³•ï¼šç­›é€‰å¶æ•°+æ±‚å’Œï¼Œéœ€è¦å¾ªç¯+åˆ¤æ–­</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : nums) {
            <span class="hljs-keyword">if</span> (num % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) {
                sum += num;
            }
        }
        System.out.println(sum); <span class="hljs-comment">// è¾“å‡ºï¼š6</span>
        
        <span class="hljs-comment">// æ–°å†™æ³•ï¼šStreamä¸€è¡Œæå®šï¼Œæ¸…çˆ½ç›´è§‚</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">streamSum</span> <span class="hljs-operator">=</span> nums.stream().filter(num -&gt; num % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>).mapToInt(Integer::intValue).sum();
        System.out.println(streamSum); <span class="hljs-comment">// è¾“å‡ºï¼š6</span>
        
        <span class="hljs-comment">// å†ä¸¾ä¸€ä¾‹ï¼šç­›é€‰å¤§äº2çš„æ•°ï¼Œè½¬æˆå­—ç¬¦ä¸²åˆ—è¡¨</span>
        List&lt;String&gt; strList = nums.stream().filter(num -&gt; num &gt; <span class="hljs-number">2</span>).map(String::valueOf).collect(Collectors.toList());
        System.out.println(strList); <span class="hljs-comment">// è¾“å‡ºï¼š[3, 4, 5]</span>
    }
}
</code></pre>
<p>Â </p>
<h2 data-id="heading-2">3.  é™æ€å¯¼å…¥ï¼šå°‘å†™å†—ä½™å‰ç¼€ï¼Œä»£ç æ›´æ¸…çˆ½</h2>
<p>é¢‘ç¹ç”¨Mathã€Arrayså·¥å…·ç±»ï¼Ÿé™æ€å¯¼å…¥ç›´æ¥çœç•¥ç±»åï¼Œå†™èµ·æ¥æ›´é¡ºæ»‘ï¼Œè¿›é˜¶åŸºç¡€å°ç»†èŠ‚ï¼Œé€¼æ ¼æ‹‰æ»¡ï¼</p>
<p>æ ¸å¿ƒç”¨æ³•ï¼šå¯¼å…¥é™æ€æ–¹æ³•/å¸¸é‡ï¼Œç›´æ¥è°ƒç”¨</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é™æ€å¯¼å…¥ï¼šç›´æ¥å¯¼å…¥éœ€è¦çš„æ–¹æ³•ï¼Œä¸ç”¨å†™ç±»åå‰ç¼€</span>
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> java.lang.Math.sqrt;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">static</span> java.util.Arrays.sort;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticImportDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// è€å†™æ³•ï¼šå¿…é¡»å¸¦Math.å‰ç¼€</span>
        System.out.println(Math.sqrt(<span class="hljs-number">16</span>)); <span class="hljs-comment">// è¾“å‡ºï¼š4.0</span>
        
        <span class="hljs-comment">// æ–°å†™æ³•ï¼šé™æ€å¯¼å…¥åï¼Œç›´æ¥è°ƒç”¨æ–¹æ³•</span>
        System.out.println(sqrt(<span class="hljs-number">16</span>)); <span class="hljs-comment">// è¾“å‡ºï¼š4.0</span>
        
        <span class="hljs-comment">// æ•°ç»„æ’åºåŒç†</span>
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">3</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>};
        sort(arr); <span class="hljs-comment">// ç›´æ¥è°ƒç”¨Arrays.sortï¼Œæ— éœ€å†™Arrays.</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            System.out.print(num + <span class="hljs-string">" "</span>); <span class="hljs-comment">// è¾“å‡ºï¼š1 2 3</span>
        }
    }
}
</code></pre>
<p>Â </p>
<p>æ€»ç»“</p>
<p>3ä¸ªè¿›é˜¶ååŸºç¡€æŠ€å·§ï¼Œéƒ½æ˜¯æ—¥å¸¸å¼€å‘é«˜é¢‘ç”¨åˆ°çš„â€œçœåŠ›ç¥å™¨â€ï¼š</p>
<p>1.Â Optionalï¼šä¼˜é›…åˆ¤ç©ºï¼Œæœç»ç©ºæŒ‡é’ˆ</p>
<p>2.Â Streamæµï¼šç®€åŒ–é›†åˆæ“ä½œï¼Œä¸€è¡Œé¡¶åè¡Œ</p>
<p>3.Â é™æ€å¯¼å…¥ï¼šå°‘å†™å†—ä½™å‰ç¼€ï¼Œä»£ç æ›´æ¸…çˆ½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘å¸ƒè§‚å¯Ÿè€…æ¨¡å¼ä½¿ç”¨åœºæ™¯è®°å½•]]></title>    <link>https://juejin.cn/post/7585490245006360582</link>    <guid>https://juejin.cn/post/7585490245006360582</guid>    <pubDate>2025-12-20T13:20:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585490245006360582" data-draft-id="7585180775704739867" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘å¸ƒè§‚å¯Ÿè€…æ¨¡å¼ä½¿ç”¨åœºæ™¯è®°å½•"/> <meta itemprop="keywords" content="è®¾è®¡æ¨¡å¼"/> <meta itemprop="datePublished" content="2025-12-20T13:20:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çœŸå¤œ"/> <meta itemprop="url" content="https://juejin.cn/user/3892727627132343"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘å¸ƒè§‚å¯Ÿè€…æ¨¡å¼ä½¿ç”¨åœºæ™¯è®°å½•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3892727627132343/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çœŸå¤œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:20:26.000Z" title="Sat Dec 20 2025 13:20:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. å…¨å±€å…±äº«çš„æ•°ç»„è¯·æ±‚</h2>
<h3 data-id="heading-1">é—®é¢˜</h3>
<p>å½“é‡åˆ°å…¨å±€å…±äº«çš„å­—å…¸listæŒ‚è½½åˆ°vuexæˆ–è€…piniaç­‰å…¨å±€çŠ¶æ€ä¸­ä¾›å…¨å±€ç»„ä»¶ä½¿ç”¨ï¼Œä½†å­—å…¸æ¥å£åç«¯è®¾ç½®äº†tokenè¯·æ±‚ï¼Œå¦‚æœæ˜¯åœ¨æ²¡tokenè¿›å…¥æ—¶å€™å°±ä¼šé‡åˆ°è¿™æ ·çš„æƒ…å†µ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/109252bc51d84709b544aa0245168a64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55yf5aSc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766841626&amp;x-signature=t5CyVCIXqpqxBr1fnsJNfhgwiq4%3D" alt="image.png" loading="lazy"/></p>
<p>åœ¨App.vueç»„ä»¶ä¸­</p>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">"App"</span>,
  <span class="hljs-title function_">created</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span>(<span class="hljs-title function_">getToken</span>()){
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">"getXXXList"</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>.<span class="hljs-title function_">dispatch</span>(<span class="hljs-string">"getXXXList"</span>);
    }<span class="hljs-keyword">else</span>{
        observer.<span class="hljs-title function_">add</span>(getXXXList,<span class="hljs-variable language_">this</span>.<span class="hljs-property">$store</span>)
    }
  },
  <span class="hljs-title function_">metaInfo</span>(<span class="hljs-params"/>) {
    
  },
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>

</code></pre>
<p>è¿™æ ·ç»„ä»¶å‡ºæ—¶å€™åŠ è½½å°±ä¼šå‘èµ·ä¸¤ä¸ªè¯·æ±‚ï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰tokenå¼¹å‡ºä»¥ä¸Šæç¤ºã€‚</p>
<h3 data-id="heading-2">è§£å†³æ€è·¯</h3>
<p>å¯ä»¥ä½¿ç”¨å‘å¸ƒè®¢é˜…è€…æ¨¡å¼ï¼Œåˆå§‹åŒ–æ—¶æ”¶é›†è¯¥ç±»å‹çš„è¯·æ±‚ï¼Œç­‰åˆ°æœ‰tokenæ—¶å€™ï¼ˆå¯ä»¥åœ¨ç™»é™†æ—¶å€™è§¦å‘ï¼Œä¹Ÿå¯ä»¥ç›‘å¬æŸä¸ªå‚æ•°è§¦å‘ï¼‰æ‰§è¡Œè¯¥æ”¶é›†çš„åˆ—è¡¨ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨å…¨å±€çŠ¶æ€ç®¡ç†å®ç°ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">//è§‚å¯Ÿå™¨</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Observer</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">store</span> = <span class="hljs-literal">null</span>;
  }

  <span class="hljs-title function_">add</span>(<span class="hljs-params">observer, store</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">push</span>(observer);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">store</span> = store;
  }
  <span class="hljs-title function_">notify</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">store</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Observer: store is not set"</span>);
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">store</span>);

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">store</span>.<span class="hljs-title function_">dispatch</span>(item);
    });
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">observers</span> = [];
  }
}
<span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observer</span>();
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> observer;


</code></pre>
<p>æœ€ååœ¨ç™»é™†æ—¶å€™notifyå°±å¯ä»¥ã€‚è¿™æ˜¯å•ä¸€åœºæ™¯ä¸‹ï¼Œå¦‚æœæ¶‰åŠåˆ°å…¶ä»– çš„ä¸»é¢˜éœ€è¦æ·»åŠ åˆ†ç±»</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LangGraph1.0é€Ÿé€šæŒ‡å—ï¼ˆäºŒï¼‰â€”â€” LangGraph1.0 æ¡ä»¶è¾¹ã€è®°å¿†ã€äººåœ¨å›è·¯]]></title>    <link>https://juejin.cn/post/7585553799298056238</link>    <guid>https://juejin.cn/post/7585553799298056238</guid>    <pubDate>2025-12-21T05:49:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585553799298056238" data-draft-id="7585076863820660787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LangGraph1.0é€Ÿé€šæŒ‡å—ï¼ˆäºŒï¼‰â€”â€” LangGraph1.0 æ¡ä»¶è¾¹ã€è®°å¿†ã€äººåœ¨å›è·¯"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,Agent,LangChain"/> <meta itemprop="datePublished" content="2025-12-21T05:49:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¤§æ¨¡å‹çœŸå¥½ç©"/> <meta itemprop="url" content="https://juejin.cn/user/3140624091453053"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LangGraph1.0é€Ÿé€šæŒ‡å—ï¼ˆäºŒï¼‰â€”â€” LangGraph1.0 æ¡ä»¶è¾¹ã€è®°å¿†ã€äººåœ¨å›è·¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3140624091453053/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¤§æ¨¡å‹çœŸå¥½ç©
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T05:49:52.000Z" title="Sun Dec 21 2025 05:49:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä¸Šç¯‡å†…å®¹ã€Š<a href="https://juejin.cn/post/7584689488770252835" target="_blank" title="https://juejin.cn/post/7584689488770252835">LangGraph1.0é€Ÿé€šæŒ‡å—ï¼ˆä¸€ï¼‰â€”â€” æ ¸å¿ƒæ¦‚å¿µã€ç‚¹ã€è¾¹</a>ã€‹ä¸­ç¬”è€…ä»‹ç»äº†LangGraph çš„åŸºæœ¬æ¦‚å¿µï¼Œä»¥åŠå¦‚ä½•é€šè¿‡å®šä¹‰èŠ‚ç‚¹ä¸è¾¹æ¥æ„å»ºå¤šç§å›¾ç»“æ„ã€‚æœ‰äº†è¿™äº›åŸºç¡€ï¼Œå¤§å®¶å·²ç»èƒ½å¤Ÿæ­å»ºèµ·ä¸€ä¸ªå¯è¿è¡Œçš„æ™ºèƒ½ä½“å·¥ä½œæµã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ç¬”è€…å°†è¿›ä¸€æ­¥å±•å¼€ LangGraph æ›´ä¸ºçµæ´»å’Œå¼ºå¤§çš„èƒ½åŠ›ã€‚ä½ å°†å­¦ä¹ åˆ°ï¼š</p>
<ul>
<li><strong>æ¡ä»¶è¾¹ï¼ˆConditional Edgesï¼‰</strong> ï¼šé™¤æ¡ä»¶å‡½æ•°å¤–ï¼Œå¦‚ä½•è®©å›¾ç»“æ„æ ¹æ®è¿è¡Œæ—¶çš„çŠ¶æ€åŠ¨æ€é€‰æ‹©ä¸‹ä¸€æ­¥è·¯å¾„ï¼Œå®ç°åˆ†æ”¯ä¸å¾ªç¯é€»è¾‘ï¼›</li>
<li><strong>è®°å¿†ï¼ˆMemoryï¼‰</strong> ï¼šå¦‚ä½•è®© LangGraph åœ¨å¤šæ¬¡è°ƒç”¨ä¸­ä¿ç•™å’Œæ›´æ–°çŠ¶æ€ï¼Œæ„å»ºLangGraphæŒç»­è¿è¡Œçš„èƒ½åŠ›</li>
<li><strong>äººåœ¨å›è·¯ï¼ˆHuman-in-the-loopï¼‰</strong> ï¼šå¦‚ä½•åœ¨å…³é”®èŠ‚ç‚¹å¼•å…¥äººå·¥ç¡®è®¤æˆ–å¹²é¢„ï¼Œä½¿LangGraphå›¾æ›´åŠ å¯æ§ã€å¯é ã€‚</li>
</ul>
<p>LangGraph1.0 ä¸å…ˆå‰ç‰ˆæœ¬å˜åŠ¨ä¸å¤§ï¼Œé¢„è®¡èŠ±è´¹ä¸‰èŠ‚å·¦å³çš„æ—¶é—´è®²è§£ï¼ŒåŒæ—¶ä¹Ÿè¦è¯´æ˜ç¬”è€…çš„ä¸“æ <a href="https://juejin.cn/column/7526240014499495972" target="_blank" title="https://juejin.cn/column/7526240014499495972">ã€Šæ·±å…¥æµ…å‡ºLangChain&amp;LangGraph AI Agent æ™ºèƒ½ä½“å¼€å‘ã€‹</a>é€‚åˆæ‰€æœ‰å¯¹ LangChain æ„Ÿå…´è¶£çš„å­¦ä¹ è€…ï¼Œæ— è®ºä¹‹å‰æ˜¯å¦æ¥è§¦è¿‡ LangChainã€‚è¯¥ä¸“æ åŸºäºç¬”è€…åœ¨å®é™…é¡¹ç›®ä¸­çš„æ·±åº¦ä½¿ç”¨ç»éªŒï¼Œç³»ç»Ÿè®²è§£äº†ä½¿ç”¨LangChain/LangGraphå¦‚ä½•å¼€å‘æ™ºèƒ½ä½“ï¼Œç›®å‰å·²æ›´æ–° 32 è®²ï¼Œå¹¶æŒç»­è¡¥å……å®æˆ˜ä¸æ‹“å±•å†…å®¹ã€‚æ¬¢è¿æ„Ÿå…´è¶£çš„åŒå­¦å…³æ³¨ç¬”è€…çš„æ˜é‡‘è´¦å·ä¸ä¸“æ ï¼Œä¹Ÿå¯å…³æ³¨ç¬”è€…çš„åŒåå¾®ä¿¡å…¬ä¼—å·Â <strong>å¤§æ¨¡å‹çœŸå¥½ç©</strong>ï¼Œæ¯æœŸåˆ†äº«æ¶‰åŠçš„ä»£ç å‡å¯åœ¨å…¬ä¼—å·ç§ä¿¡:Â <strong>LangChainæ™ºèƒ½ä½“å¼€å‘</strong>å…è´¹è·å–ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€ä½¿ç”¨Commandå¯¹è±¡ï¼šè¾¹å®šä¹‰çš„ç¬¬äºŒç§æ–¹æ³•</h2>
<p>ä¸Šç¯‡å†…å®¹ã€Š<a href="https://juejin.cn/post/7584689488770252835" target="_blank" title="https://juejin.cn/post/7584689488770252835">LangGraph1.0é€Ÿé€šæŒ‡å—ï¼ˆä¸€ï¼‰â€”â€” æ ¸å¿ƒæ¦‚å¿µã€ç‚¹ã€è¾¹</a>ã€‹ä¸­ç¬”è€…ä»‹ç»äº†é€šè¿‡Â <code>add_conditional_edges</code>Â é…åˆæ¡ä»¶è·¯ç”±å‡½æ•°æ¥å®šä¹‰è¾¹çš„æ–¹æ³•ã€‚è¯¥å‡½æ•°æ ¹æ®å›¾çš„çŠ¶æ€è¿”å›ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„åç§°ï¼Œä»è€Œå®ç°åŠ¨æ€è·¯ç”±ã€‚</p>
<pre><code class="hljs language-python" lang="python">...
<span class="hljs-keyword">def</span> <span class="hljs-title function_">conditional_edge</span>(<span class="hljs-params">state: State</span>) -&gt; <span class="hljs-type">Literal</span>[<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, END]:
    select = state[<span class="hljs-string">"nList"</span>][-<span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> select == <span class="hljs-string">"b"</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'b'</span>
    <span class="hljs-keyword">elif</span> select == <span class="hljs-string">'c'</span>:
        <span class="hljs-keyword">return</span> <span class="hljs-string">'c'</span>
    <span class="hljs-keyword">elif</span> select == <span class="hljs-string">'q'</span>:
        <span class="hljs-keyword">return</span> END
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">return</span> END

...


builder.add_conditional_edges(<span class="hljs-string">"a"</span>, conditional_edge)
</code></pre>
<p>è¿™æ˜¯ä¸€ç§å°†<strong>è·¯ç”±é€»è¾‘</strong>ï¼ˆè¾¹ï¼‰ä¸<strong>èŠ‚ç‚¹æ‰§è¡Œé€»è¾‘</strong>ï¼ˆç‚¹ï¼‰åˆ†ç¦»çš„æ¸…æ™°æ¨¡å¼ã€‚ç„¶è€Œï¼ŒLangGraph æä¾›äº†å¦ä¸€ç§æ›´ä¸ºç›´æ¥çš„æ§åˆ¶æµæ–¹å¼ï¼šå…è®¸èŠ‚ç‚¹å‡½æ•°åœ¨è¿”å›æ—¶ï¼Œä¸ä»…æ›´æ–°çŠ¶æ€ï¼Œè¿˜èƒ½<strong>æ˜¾å¼æŒ‡å®šæ¥ä¸‹æ¥è¦æ‰§è¡Œçš„èŠ‚ç‚¹</strong>ã€‚è¿™æ˜¯é€šè¿‡è¿”å›ä¸€ä¸ªç‰¹æ®Šçš„Â <code>langgraph.types.Command</code>Â å¯¹è±¡æ¥å®ç°çš„ã€‚</p>
<h3 data-id="heading-2">1.1Â <code>Command</code>Â å¯¹è±¡ï¼šå°†è·¯ç”±é€»è¾‘å†…ç½®äºèŠ‚ç‚¹</h3>
<p><code>Command</code>Â å¯¹è±¡ä¸»è¦æœ‰ä¸¤ä¸ªå…³é”®æŒ‡ä»¤ï¼š</p>
<ul>
<li><strong><code>update</code></strong>: ç”¨äºæ›´æ–°å›¾çš„çŠ¶æ€ã€‚</li>
<li><strong><code>goto</code></strong>: ç”¨äºæŒ‡å®šä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„èŠ‚ç‚¹ã€‚</li>
</ul>
<p>è¿™æ„å‘³ç€å¯ä»¥åœ¨èŠ‚ç‚¹çš„å¤„ç†å‡½æ•°å†…éƒ¨ï¼Œç›´æ¥å†³å®šå·¥ä½œæµçš„ä¸‹ä¸€æ­¥èµ°å‘ï¼Œæ— éœ€æå‰åœ¨å›¾ä¸­å®šä¹‰å¥½æ‰€æœ‰æ¡ä»¶è¾¹ã€‚å¯¹äºä¸‹å›¾ä¸­çš„èŠ‚ç‚¹Aï¼Œç¬”è€…å¸Œæœ›åœ¨æ‰§è¡Œå…¶é€»è¾‘åï¼Œæ ¹æ®å½“å‰çŠ¶æ€é€‰æ‹©è·³è½¬èŠ‚ç‚¹Bæˆ–èŠ‚ç‚¹Cï¼š</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3241372ced94feb926336ab2ffb2365~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766900991&amp;x-signature=uUI4mGzZtHpCbTDX03L%2BXbw4nbY%3D" alt="11.png" width="50%" loading="lazy"/></p>
<p>è¿™å°±éœ€è¦é‡å†™<code>node_a</code>å‡½æ•°</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">node_a</span>(<span class="hljs-params">state: State</span>) -&gt; Command[<span class="hljs-type">Literal</span>[<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>, END]]:
    select = state[<span class="hljs-string">'nList'</span>][-<span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> select == <span class="hljs-string">'b'</span>:
        next_node = <span class="hljs-string">'b'</span>
    <span class="hljs-keyword">elif</span> select == <span class="hljs-string">'c'</span>:
        next_node = <span class="hljs-string">'c'</span>
    <span class="hljs-keyword">elif</span> select == <span class="hljs-string">'q'</span>:
        next_node = END
    <span class="hljs-keyword">else</span>:
        next_node = END

    <span class="hljs-keyword">return</span> Command(
        update=State(nList=[select]),
        goto=next_node
    )
</code></pre>
<h3 data-id="heading-3">1.2 å®Œæ•´ç¤ºä¾‹ä¸æ‰§è¡Œè¿‡ç¨‹åˆ†æ</h3>
<ol>
<li>
<p>å°†è¿™ç§æ€è·¯åº”ç”¨åˆ°<a href="https://juejin.cn/post/7584689488770252835" target="_blank" title="https://juejin.cn/post/7584689488770252835">ä¸Šç¯‡æ–‡ç« </a>çš„æ¡ä»¶å›¾ç»“æ„ä¸­ï¼Œå®Œæ•´çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> START, END, StateGraph
<span class="hljs-keyword">import</span> operator
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, <span class="hljs-type">List</span>, Annotated, <span class="hljs-type">Literal</span>

<span class="hljs-keyword">from</span> langgraph.types <span class="hljs-keyword">import</span> Command


<span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    nList: Annotated[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], operator.add]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_a</span>(<span class="hljs-params">state: State</span>) -&gt; Command[<span class="hljs-type">Literal</span>[<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>, END]]:
    select = state[<span class="hljs-string">'nList'</span>][-<span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> select == <span class="hljs-string">'b'</span>:
        next_node = <span class="hljs-string">'b'</span>
    <span class="hljs-keyword">elif</span> select == <span class="hljs-string">'c'</span>:
        next_node = <span class="hljs-string">'c'</span>
    <span class="hljs-keyword">elif</span> select == <span class="hljs-string">'q'</span>:
        next_node = END
    <span class="hljs-keyword">else</span>:
        next_node = END

    <span class="hljs-keyword">return</span> Command(
        update=State(nList=[select]),
        goto=next_node
    )

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_b</span>(<span class="hljs-params">state: State</span>):
    <span class="hljs-keyword">return</span> Command(
        goto=END
    )

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_c</span>(<span class="hljs-params">state: State</span>):
    <span class="hljs-keyword">return</span> Command(
        goto=END
    )



builder = StateGraph(State)
builder.add_node(<span class="hljs-string">"a"</span>, node_a)
builder.add_node(<span class="hljs-string">"b"</span>, node_b)
builder.add_node(<span class="hljs-string">"c"</span>, node_c)

builder.add_edge(START, <span class="hljs-string">"a"</span>)

graph = builder.<span class="hljs-built_in">compile</span>()

user = <span class="hljs-built_in">input</span>(<span class="hljs-string">'b, c or q to quit:'</span>)
input_state = State(
    nList=[user]
)
<span class="hljs-built_in">print</span>(graph.invoke(input_state))
</code></pre>
</li>
<li>
<p>è¿è¡Œæµ‹è¯•ï¼Œåˆ†æè¾“å…¥Â <code>'b'</code>Â æ—¶çš„æ‰§è¡Œè¿‡ç¨‹ï¼š</p>
<ol>
<li>
<p><strong>åˆå§‹çŠ¶æ€</strong>ï¼š<code>State(nList=['b'])</code></p>
</li>
<li>
<p><strong>æ‰§è¡ŒèŠ‚ç‚¹ A</strong>ï¼š</p>
<ul>
<li>è¯»å–çŠ¶æ€Â <code>nList[-1]</code>ï¼Œå¾—åˆ°Â <code>'b'</code>ã€‚</li>
<li>é€»è¾‘åˆ¤æ–­Â <code>next_node = 'b'</code>ã€‚</li>
<li>è¿”å›Â <code>Command(update=State(nList=['b']), goto='b')</code>ã€‚</li>
<li><strong>çŠ¶æ€æ›´æ–°</strong>ï¼š<code>update</code>Â æŒ‡ä»¤å°†Â <code>['b']</code>Â è¿½åŠ åˆ°åŸçŠ¶æ€ã€‚ç”±äºÂ <code>reducer</code>Â æ˜¯Â <code>operator.add</code>ï¼ŒçŠ¶æ€å˜ä¸ºÂ <code>nList=['b', 'b']</code>ã€‚</li>
</ul>
</li>
<li>
<p><strong>è·³è½¬ä¸æ‰§è¡Œ</strong>ï¼šæ ¹æ®Â <code>goto='b'</code>ï¼Œå›¾è·³è½¬åˆ°èŠ‚ç‚¹ Bã€‚</p>
</li>
<li>
<p><strong>æ‰§è¡ŒèŠ‚ç‚¹ B</strong>ï¼šèŠ‚ç‚¹ B è¿”å›Â <code>Command(goto=END)</code>ï¼Œå›¾è¿è¡Œç»“æŸã€‚</p>
</li>
<li>
<p><strong>æœ€ç»ˆè¾“å‡ºçŠ¶æ€</strong>ï¼š<code>{'nList': ['b', 'b']}</code>ã€‚</p>
</li>
<li>
<p>è¾“å…¥Â <code>'c'</code>Â æˆ–å…¶å®ƒå­—ç¬¦ï¼ˆå¦‚Â <code>'q'</code>ï¼‰çš„é€»è¾‘ç±»ä¼¼ï¼Œæœ€ç»ˆçŠ¶æ€ä¼šåˆ†åˆ«ä¸ºÂ <code>['c', 'c']</code>Â æˆ–Â <code>['q']</code>ã€‚</p>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b84048c3efda405a942524107eb77535~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766900991&amp;x-signature=7cbFmvF%2BDAvRLzeUkTHYcWvqCeo%3D" alt="0.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fcd83efd58cd4c2dafc63bc223035b34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766900991&amp;x-signature=xUiiv02Xx5YXJukrOIcRY9xAuBs%3D" alt="1.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dfdd975dd93434782b2b37cbd2de5ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766900991&amp;x-signature=4uuCKOpO1BnjWnZImnxyQ%2BV2azQ%3D" alt="2.png" loading="lazy"/></p>
</li>
</ol>
<h3 data-id="heading-4">1.3 æ–¹æ³•å¯¹æ¯”é€‰å‹</h3>
<p>è™½ç„¶Â <code>Command</code>Â å¯¹è±¡æä¾›äº†å¼ºå¤§çš„ã€ç”±èŠ‚ç‚¹é©±åŠ¨æµç¨‹çš„èƒ½åŠ›ï¼Œä½†åœ¨å¤§å¤šæ•°æ™ºèƒ½ä½“å·¥ä½œæµçš„è®¾è®¡ä¸­ï¼Œ<strong>ç¬”è€…æ›´æ¨èä½¿ç”¨Â <code>add_conditional_edges</code>Â é…åˆæ¡ä»¶è·¯ç”±å‡½æ•°çš„æ–¹å¼æ¥å®šä¹‰è¾¹</strong>ã€‚</p>
<p>ä¸»è¦åŸå› åœ¨äºâ€œ<strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong>â€å’Œâ€œ<strong>å¯ç»´æŠ¤æ€§</strong>â€ã€‚å°†â€œåšä»€ä¹ˆâ€ï¼ˆèŠ‚ç‚¹é€»è¾‘ï¼‰å’Œâ€œæ¥ä¸‹æ¥å»å“ªâ€ï¼ˆè·¯ç”±é€»è¾‘ï¼‰åˆ†å¼€å®šä¹‰ï¼Œä½¿å¾—å›¾çš„ç»“æ„æ›´åŠ æ¸…æ™°ã€æ˜“äºç†è§£å’Œè°ƒè¯•ã€‚å›¾çš„<code>builder</code>æœ¬èº«å°±èƒ½å®Œæ•´åæ˜ ä¸šåŠ¡é€»è¾‘çš„æµè½¬ï¼Œè€Œä¸æ˜¯å°†æ§åˆ¶æµéšè—åœ¨èŠ‚ç‚¹çš„å®ç°ç»†èŠ‚é‡Œã€‚</p>
<p>å› æ­¤ï¼Œ<code>Command</code>Â æ–¹æ¡ˆæ›´é€‚åˆä½œä¸ºä¸€ç§é«˜çº§æˆ–ç‰¹å®šåœºæ™¯ä¸‹çš„è¡¥å……æ‰‹æ®µï¼Œè€Œåœ¨æ„å»ºæ¸…æ™°ã€å¯ç»´æŠ¤çš„ LangGraph åº”ç”¨æ—¶ï¼Œåº”ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨æ¡ä»¶è¾¹å‡½æ•°æ¥å®šä¹‰è·¯ç”±ã€‚</p>
<h2 data-id="heading-5">äºŒã€Memoryï¼šå®ç°æ™ºèƒ½ä½“çš„é•¿æœŸè®°å¿†</h2>
<p>åœ¨ LangGraph çš„å·¥ä½œæµä¸­ï¼ŒèŠ‚ç‚¹æŒ‰é¡ºåºæ‰§è¡Œï¼ŒçŠ¶æ€éšä¹‹æ›´æ–°ã€‚ç„¶è€Œï¼Œè¿™ç§çŠ¶æ€é»˜è®¤åªå­˜åœ¨äºå•æ¬¡è°ƒç”¨ï¼ˆ<code>invoke</code>ï¼‰çš„ç”Ÿå‘½å‘¨æœŸå†…ã€‚ä¸ºäº†è®©æ™ºèƒ½ä½“åƒäººç±»ä¸€æ ·æ‹¥æœ‰â€œè®°å¿†â€ï¼Œèƒ½å¤Ÿåœ¨å¤šæ¬¡äº¤äº’ä¸­è®°ä½ä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚ï¼Œåƒåœ¨ DeepSeek ç½‘é¡µä¸­è¿›è¡Œçš„å¤šè½®å¯¹è¯ï¼‰ï¼ŒLangGraph æä¾›äº†<strong>æ£€æŸ¥ç‚¹ï¼ˆCheckpointï¼‰</strong> æœºåˆ¶ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d46e8df421a74a97b8c4287d672a4904~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766900991&amp;x-signature=bRw%2BY6WYtLiUYA0Out5K1qADqFo%3D" alt="3.png" loading="lazy"/></p>
<h3 data-id="heading-6">2.1 ç†è§£æ£€æŸ¥ç‚¹ï¼šçŠ¶æ€å¿«ç…§ä¸çº¿ç¨‹</h3>
<p><strong>æ£€æŸ¥ç‚¹</strong>æ˜¯ LangGraph å®ç°è®°å¿†åŠŸèƒ½çš„æ ¸å¿ƒã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯åœ¨å›¾è¿è¡Œçš„<strong>å…³é”®æ­¥éª¤ï¼ˆå¦‚æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œåï¼‰</strong> Â å¯¹å½“å‰å®Œæ•´çŠ¶æ€è¿›è¡Œçš„ä¸€æ¬¡å¿«ç…§ï¼ˆSnapshotï¼‰ï¼Œå¹¶å°†å…¶æŒä¹…åŒ–å­˜å‚¨ã€‚è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼äºä¸ºè™šæ‹Ÿæœºä¿å­˜æ¢å¤ç‚¹ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03113417b6ff41aa886a3354eaf40710~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766900991&amp;x-signature=93B11SD2S34w70cjsODo3lWRc6A%3D" alt="4.png" loading="lazy"/></p>
<p>è¿™äº›æŒ‰æ—¶é—´é¡ºåºæ’åˆ—çš„æ£€æŸ¥ç‚¹é›†åˆï¼Œæ„æˆäº†ä¸€ä¸ª<strong>çº¿ç¨‹ï¼ˆThreadï¼‰</strong> ã€‚åœ¨çº¿ç¨‹ä¸­ï¼Œæ¯æ¬¡<code>graph.invoke</code>è°ƒç”¨çš„å†å²è®°å½•éƒ½è¢«å®Œæ•´ä¿å­˜ã€‚è¿™è§£é‡Šäº†ä¸ºä½•åœ¨ DeepSeek ä¸­ï¼Œâ€œæ–°å¯¹è¯â€ä¼šå¼€å¯ä¸€ä¸ªæ²¡æœ‰å†å²çš„çº¯å‡€ä¼šè¯â€”â€”å› ä¸ºå®ƒå¼€å¯äº†ä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚</p>
<p><strong>æ£€æŸ¥ç‚¹çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š</strong></p>
<p>å¼•å…¥æ£€æŸ¥ç‚¹æœºåˆ¶ä¸ºæ™ºèƒ½ä½“å¼€å‘å¸¦æ¥äº†å¦‚ä¸‹å…³é”®èƒ½åŠ›ï¼š</p>
<ol>
<li><strong>çŠ¶æ€æŒä¹…åŒ–</strong>ï¼šå³ä½¿å›¾åœæ­¢è¿è¡Œï¼ŒçŠ¶æ€ä¹Ÿèƒ½è¢«ä¿ç•™ï¼Œä¸‹æ¬¡å¯ä»æ–­ç‚¹æ¢å¤ã€‚</li>
<li><strong>é”™è¯¯æ¢å¤ä¸é‡è¯•</strong>ï¼šå½“æŸä¸ªèŠ‚ç‚¹æ‰§è¡Œå¤±è´¥æ—¶ï¼Œå¯ä»¥ä»ä¸Šä¸€ä¸ªæ£€æŸ¥ç‚¹æ¢å¤çŠ¶æ€å¹¶é‡è¯•ï¼Œé¿å…ä¸¢å¤±å…¨éƒ¨è¿›åº¦ã€‚</li>
<li><strong>æ—¶é—´æ—…è¡Œä¸å›æ»š</strong>ï¼šå¦‚æœå‘ç°æ™ºèƒ½ä½“åœ¨é•¿æœŸè¿è¡Œåâ€œè·‘åâ€ï¼Œå¯ä»¥å›æ»šåˆ°ä»»æ„å†å²æ£€æŸ¥ç‚¹ï¼Œå¹¶ä»è¯¥å¥åº·çŠ¶æ€é‡æ–°å¼€å§‹ã€‚</li>
<li><strong>æš‚åœä¸ç»§ç»­</strong>ï¼šå¯ä»¥æš‚åœä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡ï¼Œå¹¶åœ¨ä¹‹åå‡†ç¡®åœ°ä»ä¸­æ–­å¤„ç»§ç»­æ‰§è¡Œã€‚</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed9c7cc7f3d341549297021aaa8a7f69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766900991&amp;x-signature=KCMKPWXf83qswoFh350OtOFdQ7s%3D" alt="5.png" loading="lazy"/></p>
<h3 data-id="heading-7">2.2 å®æˆ˜ï¼šä½¿ç”¨å†…å­˜æ£€æŸ¥ç‚¹å™¨</h3>
<p>LangGraph æä¾›äº†å¤šç§æ£€æŸ¥ç‚¹å­˜å‚¨åç«¯ï¼ŒåŒ…æ‹¬å†…å­˜ (<code>InMemorySaver</code>)ã€Postgresæ•°æ®åº“ç­‰ã€‚æœ¬ç¯‡åˆ†äº«ç¬”è€…ä»¥æœ€ç®€å•çš„å†…å­˜æ£€æŸ¥ç‚¹å™¨ä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºã€‚å…¶ä»–å­˜å‚¨å™¨çš„ç”¨æ³•ç±»ä¼¼ï¼Œå¤§å®¶å¯ä»¥åœ¨ç¬”è€…çš„æ–‡ç« ã€Š<a href="https://juejin.cn/post/7555795679382831113" target="_blank" title="https://juejin.cn/post/7555795679382831113">æ·±å…¥æµ…å‡ºLangGraph AI Agentæ™ºèƒ½ä½“å¼€å‘æ•™ç¨‹ï¼ˆä¹ï¼‰â€”LangGraphé•¿çŸ­æœŸè®°å¿†ç®¡ç†</a>ã€‹ä¸­æŸ¥çœ‹è¯¦ç»†ç¤ºä¾‹ã€‚</p>
<ol>
<li>
<p><strong>æ„å»ºåŸºç¡€å›¾ï¼š</strong> å¤ç”¨ä¸Šä¸€èŠ‚ä¸­åŸºäºÂ <code>Command</code>Â å¯¹è±¡çš„è·¯ç”±å›¾ç»“æ„ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> START, END, StateGraph
<span class="hljs-keyword">import</span> operator
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, <span class="hljs-type">List</span>, Annotated, <span class="hljs-type">Literal</span>
<span class="hljs-keyword">from</span> langgraph.types <span class="hljs-keyword">import</span> Command


<span class="hljs-keyword">class</span> <span class="hljs-title class_">State</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    nList: Annotated[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], operator.add]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_a</span>(<span class="hljs-params">state: State</span>) -&gt; Command[<span class="hljs-type">Literal</span>[<span class="hljs-string">'b'</span>,<span class="hljs-string">'c'</span>, END]]:
    select = state[<span class="hljs-string">'nList'</span>][-<span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> select == <span class="hljs-string">'b'</span>:
        next_node = <span class="hljs-string">'b'</span>
    <span class="hljs-keyword">elif</span> select == <span class="hljs-string">'c'</span>:
        next_node = <span class="hljs-string">'c'</span>
    <span class="hljs-keyword">elif</span> select == <span class="hljs-string">'q'</span>:
        next_node = END
    <span class="hljs-keyword">else</span>:
        next_node = END

    <span class="hljs-keyword">return</span> Command(
        update=State(nList=[select]),
        goto=next_node
    )

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_b</span>(<span class="hljs-params">state: State</span>):
    <span class="hljs-keyword">return</span> Command(
        goto=END
    )

<span class="hljs-keyword">def</span> <span class="hljs-title function_">node_c</span>(<span class="hljs-params">state: State</span>):
    <span class="hljs-keyword">return</span> Command(
        goto=END
    )



builder = StateGraph(State)
builder.add_node(<span class="hljs-string">"a"</span>, node_a)
builder.add_node(<span class="hljs-string">"b"</span>, node_b)
builder.add_node(<span class="hljs-string">"c"</span>, node_c)

builder.add_edge(START, <span class="hljs-string">"a"</span>)
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b722abc84f14ee58c82d373e2cfbafd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766900991&amp;x-signature=FL1pDzjXcEu%2B%2FoUktJxa%2FvqWD%2F8%3D" alt="11.png" loading="lazy"/></p>
</li>
<li>
<p><strong>å¼•å…¥å†…å­˜æ£€æŸ¥ç‚¹å™¨ï¼š</strong> ä»Â <code>langgraph.checkpoint.memory</code>Â å¯¼å…¥Â <code>InMemorySaver</code>ï¼Œå¹¶å®ä¾‹åŒ–ã€‚<code>config</code>Â ä¸­çš„Â <code>thread_id</code>Â æ˜¯å…³é”®ï¼Œå®ƒæ ‡è¯†äº†ä¼šè¯çº¿ç¨‹ã€‚ç›¸åŒÂ <code>thread_id</code>Â ä¸‹çš„æ‰€æœ‰è°ƒç”¨å°†å…±äº«çŠ¶æ€å†å²ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.checkpoint.memory <span class="hljs-keyword">import</span> InMemorySaver

memory = InMemorySaver()

config = {
    <span class="hljs-string">"configurable"</span>:{
        <span class="hljs-string">"thread_id"</span>, <span class="hljs-string">"1"</span>
    }
}
</code></pre>
</li>
<li>
<p><strong>ç¼–è¯‘æ—¶å¯ç”¨æ£€æŸ¥ç‚¹ï¼š</strong> åœ¨ç¼–è¯‘å›¾æ—¶ï¼Œé€šè¿‡Â <code>checkpointer</code>Â å‚æ•°ä¼ å…¥æ£€æŸ¥ç‚¹å™¨å®ä¾‹ã€‚</p>
<pre><code class="hljs language-python" lang="python">graph = builder.<span class="hljs-built_in">compile</span>(checkpointer=memory)
</code></pre>
</li>
<li>
<p><strong>åœ¨å¾ªç¯è°ƒç”¨ä¸­ä½“éªŒè®°å¿†ï¼š</strong> ç°åœ¨ç¬”è€…é€šè¿‡ä¸€ä¸ªå¾ªç¯æ¥æ¨¡æ‹Ÿå¤šè½®äº¤äº’ã€‚å…³é”®åœ¨äºï¼Œæ¯æ¬¡è°ƒç”¨Â <code>graph.invoke</code>Â æ—¶éƒ½ä¼ å…¥ç›¸åŒçš„Â <code>config</code>ï¼Œè¿™æ · LangGraph å°±ä¼šè‡ªåŠ¨åŠ è½½è¯¥çº¿ç¨‹ (<code>thread_id=â€™1â€™</code>) çš„ä¸Šä¸€æ¬¡çŠ¶æ€ï¼Œå¹¶åœ¨æ‰§è¡Œåä¿å­˜æ–°çŠ¶æ€ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    user = <span class="hljs-built_in">input</span>(<span class="hljs-string">'b, c or q to quit:'</span>)
    input_state = State(
        nList=[user]
    )
    result = graph.invoke(input_state, config)
    <span class="hljs-built_in">print</span>(result)
    <span class="hljs-keyword">if</span> result[<span class="hljs-string">'nList'</span>][-<span class="hljs-number">1</span>] == <span class="hljs-string">'q'</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'quit'</span>)
        <span class="hljs-keyword">break</span>
</code></pre>
</li>
<li>
<p><strong>è¿è¡Œæµ‹è¯•ï¼š</strong> è¾“å…¥åºåˆ—ï¼š<code>bÂ â†’Â cÂ â†’Â bÂ â†’Â q</code>ï¼Œ<strong>æ‰§è¡Œè¿‡ç¨‹è§£æï¼š</strong></p>
<ul>
<li><strong>ç¬¬ä¸€è½® (<code>è¾“å…¥b</code>)</strong> ï¼šåˆå§‹çŠ¶æ€Â <code>[â€˜bâ€™]</code>ã€‚èŠ‚ç‚¹Aæ‰§è¡Œåæ›´æ–°çŠ¶æ€ä¸ºÂ <code>[â€˜bâ€™, â€˜bâ€™]</code>Â å¹¶è·³è½¬åˆ°èŠ‚ç‚¹Bï¼Œæœ€ç»ˆçŠ¶æ€ä¸ºÂ <code>[â€˜bâ€™, â€˜bâ€™]</code>ã€‚</li>
<li><strong>ç¬¬äºŒè½® (<code>è¾“å…¥c</code>)</strong> ï¼šç”±äºæ£€æŸ¥ç‚¹å­˜åœ¨ï¼Œ<strong>åˆå§‹çŠ¶æ€å¹¶éç©ºåˆ—è¡¨ï¼Œè€Œæ˜¯ä¸Šä¸€è½®çš„æœ€ç»ˆçŠ¶æ€Â <code>[â€˜bâ€™, â€˜bâ€™]</code></strong> ã€‚è¾“å…¥<code>c</code>åï¼ŒçŠ¶æ€ä¼šç´¯ç§¯åˆ°<code>['b','b','c','c']</code></li>
<li><strong>ç¬¬ä¸‰è½® (<code>è¾“å…¥b</code>)</strong> ï¼šçŠ¶æ€ç»§ç»­ç´¯ç§¯ã€‚</li>
<li><strong>ç¬¬å››è½® (<code>è¾“å…¥q</code>)</strong> ï¼šè§¦å‘é€€å‡ºã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cf98c7e0fd64db1888d653b7e30a768~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766900991&amp;x-signature=TIJc48xa5OR%2FhzwE%2Fi4DiUq3dU4%3D" alt="6.png" loading="lazy"/></p>
</li>
<li>
<p>é€šè¿‡ç®€å•çš„å‡ æ­¥é…ç½®,LangGraphå›¾å³å¯å…·å¤‡â€œè®°å¿†â€èƒ½åŠ›ã€‚<code>thread_id</code>Â æ˜¯ç®¡ç†ä¸åŒè®°å¿†ä¼šè¯çš„é’¥åŒ™ã€‚åªè¦ä½¿ç”¨ç›¸åŒçš„Â <code>thread_id</code>ï¼Œæ™ºèƒ½ä½“å°±èƒ½åœ¨å¤šæ¬¡è°ƒç”¨é—´ä¿æŒå¹¶ç´¯ç§¯çŠ¶æ€ã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œåªéœ€å°†Â <code>InMemorySaver</code>Â æ›¿æ¢ä¸ºÂ <code>PostgresSaver</code>Â æˆ–è‡ªå®šä¹‰çš„æŒä¹…åŒ–æ£€æŸ¥ç‚¹å™¨ï¼Œå³å¯å®ç°ç¨³å®šå¯é çš„é•¿æœŸè®°å¿†ã€‚æ›´è¯¦ç»†çš„å…³äºLangGraphè®°å¿†çš„å†…å®¹å¤§å®¶å¯å‚è€ƒç¬”è€…çš„æ–‡ç« ï¼š <a href="https://juejin.cn/post/7555795679382831113" target="_blank" title="https://juejin.cn/post/7555795679382831113">æ·±å…¥æµ…å‡ºLangGraph AI Agentæ™ºèƒ½ä½“å¼€å‘æ•™ç¨‹ï¼ˆä¹ï¼‰â€”LangGraphé•¿çŸ­æœŸè®°å¿†ç®¡ç†</a></p>
</li>
</ol>
<h2 data-id="heading-8">ä¸‰ã€ä¸­æ–­ä¸äººåœ¨å›è·¯</h2>
<p>åœ¨è®¸å¤šå®é™…åœºæ™¯ä¸­éœ€è¦åœ¨æ™ºèƒ½ä½“å·¥ä½œæµçš„å…³é”®èŠ‚ç‚¹å¼•å…¥äººå·¥åˆ¤æ–­ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤§æ¨¡å‹è°ƒç”¨å·¥å…·æ‰§è¡Œæ•°æ®åº“å†™æ“ä½œã€å‘é€é‚®ä»¶æˆ–è¿›è¡Œå…¶ä»–é«˜é£é™©åŠ¨ä½œå‰ï¼Œå¿…é¡»ç”±äººå·¥ç¡®è®¤ã€‚LangGraph é€šè¿‡<strong>ä¸­æ–­ï¼ˆInterruptï¼‰</strong> Â æœºåˆ¶ä¼˜é›…åœ°æ”¯æŒäº†è¿™ç§â€œäººåœ¨å›è·¯ï¼ˆHuman-in-the-loopï¼‰â€æ¨¡å¼ã€‚</p>
<p>ä¸­æ–­å…è®¸ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å›¾åœ¨ç‰¹å®šèŠ‚ç‚¹æš‚åœï¼Œå°†æ§åˆ¶æƒäº¤è¿˜ç»™å¤–éƒ¨ç¨‹åºï¼ˆé€šå¸¸æ˜¯ç­‰å¾…ç”¨æˆ·è¾“å…¥ï¼‰ï¼Œç„¶åæ ¹æ®å¤–éƒ¨è¾“å…¥çš„ç»“æœå†³å®šå¦‚ä½•æ¢å¤æ‰§è¡Œã€‚è¿™ä¸ªå¼ºå¤§çš„åŠŸèƒ½åŒæ ·å»ºç«‹åœ¨ä¹‹å‰ä»‹ç»çš„<strong>æ£€æŸ¥ç‚¹ï¼ˆCheckpointï¼‰</strong> Â æœºåˆ¶ä¹‹ä¸Šã€‚</p>
<p align="center"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b722abc84f14ee58c82d373e2cfbafd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766900991&amp;x-signature=FL1pDzjXcEu%2B%2FoUktJxa%2FvqWD%2F8%3D" alt="11.png" width="50%" loading="lazy"/></p>
<h3 data-id="heading-9">3.1 æ ¸å¿ƒæ¦‚å¿µï¼š<code>interrupt</code>Â ä¸Â <code>Command(resume=...)</code></h3>
<p>ç»§ç»­æ”¹é€ ä¹‹å‰ä½¿ç”¨çš„æ¡ä»¶è·¯ç”±å›¾ã€‚æ ¸å¿ƒæ”¹åŠ¨åœ¨äºï¼Œå½“èŠ‚ç‚¹Â <code>A</code>Â é‡åˆ°æ— æ³•å¤„ç†çš„è¾“å…¥æ—¶ï¼Œä¸å†ç›´æ¥ç»“æŸï¼Œè€Œæ˜¯<strong>ä¸»åŠ¨å¼•å‘ä¸€ä¸ªä¸­æ–­</strong>ï¼Œç­‰å¾…å¤–éƒ¨å¹²é¢„ã€‚</p>
<p><strong>å®ç°ä¸­æ–­éœ€è¦ä¸¤ä¸ªå…³é”®æ“ä½œï¼š</strong></p>
<ol>
<li><strong>åœ¨èŠ‚ç‚¹å†…å¼•å‘ä¸­æ–­</strong>ï¼šä½¿ç”¨Â <code>interrupt()</code>Â å‡½æ•°ã€‚è¿™ä¼šæŠ›å‡ºä¸€ä¸ªç‰¹æ®Šä¿¡å·ï¼Œä½¿å›¾ç«‹å³æš‚åœè¿è¡Œï¼Œå¹¶å°†åŒ…å«ä¸­æ–­ä¿¡æ¯çš„å¿«ç…§ä¿å­˜åˆ°æ£€æŸ¥ç‚¹ä¸­ã€‚</li>
<li><strong>ä»å¤–éƒ¨æ¢å¤æ‰§è¡Œ</strong>ï¼šå‘å›¾ä¸­å‘é€ä¸€ä¸ªå¸¦æœ‰Â <code>resume</code>Â æŒ‡ä»¤çš„Â <code>Command</code>Â å¯¹è±¡ã€‚è¿™ä¸ªæŒ‡ä»¤çš„å€¼ä¼šä¼ é€’å›å¼•å‘ä¸­æ–­çš„èŠ‚ç‚¹ï¼Œä½œä¸ºå…¶Â <code>interrupt()</code>Â è°ƒç”¨çš„è¿”å›å€¼ï¼Œä»è€Œä½¿èŠ‚ç‚¹å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚</li>
</ol>
<h3 data-id="heading-10">3.2 ç¤ºä¾‹ï¼šä¸­æ–­ä»£ç å®æˆ˜</h3>
<ol>
<li>
<p>ç¬”è€…å¯¹ä¹‹å‰çš„Â <code>node_a</code>Â è¿›è¡Œä¿®æ”¹ã€‚å½“ç”¨æˆ·è¾“å…¥ä¸æ˜¯é¢„æœŸçš„Â <code>â€˜bâ€™</code>ï¼ŒÂ <code>â€˜câ€™</code>Â æˆ–Â <code>â€˜qâ€™</code>Â æ—¶ï¼Œè§¦å‘ä¸­æ–­ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">node_a</span>(<span class="hljs-params">state: State</span>) -&gt; Command[<span class="hljs-type">Literal</span>[<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, END]]:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'è¿›å…¥ A èŠ‚ç‚¹'</span>)
    select = state[<span class="hljs-string">'nList'</span>][-<span class="hljs-number">1</span>]
    <span class="hljs-keyword">if</span> select == <span class="hljs-string">'b'</span>:
        next_node = <span class="hljs-string">'b'</span>
    <span class="hljs-keyword">elif</span> select == <span class="hljs-string">'c'</span>:
        next_node = <span class="hljs-string">'c'</span>
    <span class="hljs-keyword">elif</span> select == <span class="hljs-string">'q'</span>:
        next_node = END
    <span class="hljs-keyword">else</span>:
        admin = interrupt(<span class="hljs-string">f"æœªæœŸæœ›çš„è¾“å‡º <span class="hljs-subst">{select}</span>"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'ç”¨æˆ·é‡æ–°è¾“å…¥æ˜¯:'</span>,admin)
        <span class="hljs-keyword">if</span> admin == <span class="hljs-string">'continue'</span>:
            next_node = <span class="hljs-string">'b'</span>
            select = <span class="hljs-string">'b'</span>
        <span class="hljs-keyword">else</span>:
            next_node = END
            select = <span class="hljs-string">'q'</span>

    <span class="hljs-keyword">return</span> Command(
        update=State(nList=[select]),
        goto=next_node
    )
</code></pre>
</li>
<li>
<p>æ„å»ºå›¾å¹¶å¯ç”¨æ£€æŸ¥ç‚¹ï¼Œä¸­æ–­ä¾èµ–æ£€æŸ¥ç‚¹æ¥ä¿å­˜å’Œæ¢å¤çŠ¶æ€ï¼Œå› æ­¤å¿…é¡»é…ç½®æ£€æŸ¥ç‚¹å™¨ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> START, END, StateGraph
<span class="hljs-keyword">from</span> langgraph.checkpoint.memory <span class="hljs-keyword">import</span> InMemorySaver

<span class="hljs-comment"># æ„å»ºå›¾</span>
builder = StateGraph(State)
builder.add_node(<span class="hljs-string">"a"</span>, node_a)
builder.add_node(<span class="hljs-string">"b"</span>, node_b)
builder.add_node(<span class="hljs-string">"c"</span>, node_c)
builder.add_edge(START, <span class="hljs-string">"a"</span>)

<span class="hljs-comment"># é…ç½®å†…å­˜æ£€æŸ¥ç‚¹å™¨å’Œçº¿ç¨‹</span>
memory = InMemorySaver()
config = {<span class="hljs-string">"configurable"</span>: {<span class="hljs-string">"thread_id"</span>: <span class="hljs-string">"1"</span>}}

<span class="hljs-comment"># ç¼–è¯‘æ—¶ä¼ å…¥æ£€æŸ¥ç‚¹å™¨</span>
graph = builder.<span class="hljs-built_in">compile</span>(checkpointer=memory)
</code></pre>
</li>
<li>
<p>å®ç°å¤–éƒ¨ä¸­æ–­å¤„ç†å¾ªç¯:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    user = <span class="hljs-built_in">input</span>(<span class="hljs-string">'b, c or q to quit:'</span>)
    input_state = State(
        nList=[user]
    )
    result = graph.invoke(input_state, config)
    <span class="hljs-built_in">print</span>(result)

    <span class="hljs-keyword">if</span> <span class="hljs-string">'__interrupt__'</span> <span class="hljs-keyword">in</span> result:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f'Interrupt:<span class="hljs-subst">{result}</span>'</span>)
        msg = result[<span class="hljs-string">'__interrupt__'</span>][-<span class="hljs-number">1</span>].value
        <span class="hljs-built_in">print</span>(msg)
        human = <span class="hljs-built_in">input</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{msg}</span>, é‡æ–°è¾“å…¥: "</span>)
        human_response = Command(
            resume=human
        )
        result = graph.invoke(human_response, config)

    <span class="hljs-keyword">if</span> result[<span class="hljs-string">'nList'</span>][-<span class="hljs-number">1</span>] == <span class="hljs-string">'q'</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'quit'</span>)
        <span class="hljs-keyword">break</span>
</code></pre>
</li>
<li>
<p>è¿è¡Œç»“æœåˆ†æï¼šå‡è®¾è¾“å…¥Â <code>p</code>ï¼ˆä¸€ä¸ªéæ³•å€¼ï¼‰ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>è§¦å‘ä¸­æ–­</strong>ï¼šèŠ‚ç‚¹Aè¯†åˆ«åˆ°Â <code>p</code>ï¼Œè°ƒç”¨Â <code>interrupt(â€œæœªé¢„æœŸçš„è¾“å…¥...â€</code>ã€‚å›¾åœ¨æ­¤åˆ»<strong>ç«‹å³æš‚åœ</strong>ï¼Œå¹¶å°†å½“å‰çŠ¶æ€ï¼ˆåŒ…æ‹¬ä¸­æ–­ä¿¡æ¯ï¼‰ä¿å­˜ä¸ºæ£€æŸ¥ç‚¹ã€‚<code>graph.invoke</code>Â è¿”å›çš„ç»“æœä¸­ä¼šåŒ…å«ä¸€ä¸ªç‰¹æ®Šçš„Â <code>__interrupt__</code>Â å­—æ®µã€‚</li>
<li><strong>äººå·¥å¹²é¢„</strong>ï¼šå¤–éƒ¨å¾ªç¯æ£€æµ‹åˆ°ä¸­æ–­ï¼Œæ‰“å°ä¿¡æ¯å¹¶ç­‰å¾…ç”¨æˆ·è¾“å…¥ã€‚ç”¨æˆ·è¾“å…¥Â <code>continue</code>ã€‚</li>
<li><strong>æ¢å¤æ‰§è¡Œ</strong>ï¼šå¤–éƒ¨ç¨‹åºæ„å»ºä¸€ä¸ªÂ <code>Command(resume=â€™continueâ€™)</code>Â å¹¶å†æ¬¡è°ƒç”¨Â <code>graph.invoke</code>ã€‚<strong>å…³é”®ç‚¹</strong>ï¼šå› ä¸ºä½¿ç”¨äº†ç›¸åŒçš„Â <code>thread_id</code>ï¼Œå›¾ä¼šä»ä¸Šä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼ˆå³ä¸­æ–­å¤„ï¼‰æ¢å¤ã€‚</li>
<li><strong>èŠ‚ç‚¹ç»§ç»­è¿è¡Œ</strong>ï¼šæ¢å¤åï¼ŒèŠ‚ç‚¹Aä¸­Â <code>interrupt()</code>Â è°ƒç”¨å¤„å°†è¿”å›Â <code>admin_decision = â€˜continueâ€™</code>ã€‚ç¨‹åºæµç¨‹è¿›å…¥Â <code>if admin_decision == 'continue'</code>Â åˆ†æ”¯ï¼Œæœ€ç»ˆå‰å¾€èŠ‚ç‚¹Bå¹¶ç»“æŸã€‚</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6247d250bc814348bbcb6c5c042535b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L55yf5aW9546p:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766900991&amp;x-signature=UFMTe8VI6sQv%2BI6XXSlP3EjhhCA%3D" alt="8.png" loading="lazy"/></p>
<p><strong>é‡è¦è¯´æ˜</strong>ï¼šå½“å›¾ä»ä¸­æ–­ç‚¹æ¢å¤æ—¶ï¼Œæ•´ä¸ªå›¾ä¼šé‡æ–°æ‰§è¡Œã€‚ä½†ç”±äºæ£€æŸ¥ç‚¹ä¿å­˜äº†ä¸­æ–­å‰çš„çŠ¶æ€ï¼ˆåŒ…æ‹¬Â <code>nList</code>ï¼‰ï¼Œå¹¶ä¸”Â <code>interrupt()</code>Â ä¼šè¿”å›æ–°çš„Â <code>resume</code>Â å€¼ï¼Œå› æ­¤èŠ‚ç‚¹èƒ½åŸºäºæ–°ä¿¡æ¯åšå‡ºä¸åŒçš„å†³ç­–ã€‚<code>__interrupt__</code>Â æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå› ä¸ºä¸€ä¸ªå›¾å¯ä»¥åœ¨ä¸åŒèŠ‚ç‚¹è§¦å‘å¤šä¸ªä¸­æ–­ï¼ŒLangGraph ä¼šè·Ÿè¸ªæ‰€æœ‰ä¸­æ–­çš„ä¸Šä¸‹æ–‡ã€‚</p>
</li>
</ol>
<p>ä»¥ä¸Šå®Œæ•´ä»£ç å‡å¯å…³æ³¨ç¬”è€…åŒåå¾®ä¿¡å…¬ä¼—å·ï¼š<strong>å¤§æ¨¡å‹çœŸå¥½ç©</strong>ï¼Œå¹¶ç§ä¿¡ Â <strong>LangChainæ™ºèƒ½ä½“å¼€å‘</strong> è·å¾—</p>
<h2 data-id="heading-11">å››ã€æ€»ç»“</h2>
<p>æœ¬æœŸæ–‡ç« æ·±å…¥è®²è§£äº† LangGraph 1.0 çš„ä¸‰å¤§è¿›é˜¶åŠŸèƒ½ï¼š<strong>æ¡ä»¶è¾¹</strong>ï¼ˆé™¤æ¡ä»¶å‡½æ•°å¤–ï¼Œè¿˜èƒ½é€šè¿‡ Command å¯¹è±¡å®ç°èŠ‚ç‚¹å†…è·¯ç”±ï¼‰ã€<strong>è®°å¿†</strong>ï¼ˆåˆ©ç”¨æ£€æŸ¥ç‚¹æœºåˆ¶å®ç°çŠ¶æ€æŒä¹…åŒ–ä¸å¤šè½®å¯¹è¯èƒ½åŠ›ï¼‰ä»¥åŠ<strong>äººåœ¨å›è·¯</strong>ï¼ˆé€šè¿‡ä¸­æ–­æœºåˆ¶åœ¨å…³é”®èŠ‚ç‚¹å¼•å…¥äººå·¥å¹²é¢„ï¼‰ã€‚ç°åœ¨å¤§å®¶å°±å­¦ä¹ åˆ°äº†LangGraphçš„åŸºæœ¬æŠ€èƒ½ï¼Œä½†ç›®å‰è¿™äº›çŸ¥è¯†ç‚¹è¿˜æ¯”è¾ƒé›¶ç¢ï¼Œä¸‹ç¯‡åˆ†äº«ç¬”è€…å°†ç»“åˆå¤§æ¨¡å‹ä½¿ç”¨LangGraphç¼–å†™ä¸€ä¸ªæ™ºèƒ½ä½“ï¼Œå¸®åŠ©å¤§å®¶å…¨å±€æŒæ¡è¿™äº›çŸ¥è¯†ç‚¹çš„ç”¨æ³•ï¼ŒæŒæ¡LangGraphæ™ºèƒ½ä½“å¼€å‘çš„åŸºæœ¬æŠ€èƒ½ï¼</p>
<p><a href="https://juejin.cn/column/7526240014499495972" title="https://juejin.cn/column/7526240014499495972" target="_blank">ã€Šæ·±å…¥æµ…å‡ºLangChain&amp;LangGraph AI Agent æ™ºèƒ½ä½“å¼€å‘ã€‹</a>ä¸“æ å†…å®¹æºè‡ªç¬”è€…åœ¨å®é™…å­¦ä¹ å’Œå·¥ä½œä¸­å¯¹ LangChain ä¸ LangGraph çš„æ·±åº¦ä½¿ç”¨ç»éªŒï¼Œæ—¨åœ¨å¸®åŠ©å¤§å®¶ç³»ç»Ÿæ€§åœ°ã€é«˜æ•ˆåœ°æŒæ¡ AI Agent çš„å¼€å‘æ–¹æ³•ï¼Œåœ¨å„å¤§æŠ€æœ¯å¹³å°è·å¾—äº†ä¸å°‘å…³æ³¨ä¸æ”¯æŒã€‚ç›®å‰å·²æ›´æ–°32è®²ï¼Œæ­£åœ¨æ›´æ–°LangGraph1.0é€Ÿé€šæŒ‡å—ï¼Œå¹¶éšæ—¶è¡¥å……ç¬”è€…åœ¨å®é™…å·¥ä½œä¸­æ€»ç»“çš„æ‹“å±•çŸ¥è¯†ç‚¹ã€‚å¦‚æœå¤§å®¶æ„Ÿå…´è¶£ï¼Œæ¬¢è¿å…³æ³¨ç¬”è€…çš„æ˜é‡‘è´¦å·ä¸ä¸“æ ï¼Œä¹Ÿå¯å…³æ³¨ç¬”è€…çš„åŒåå¾®ä¿¡å…¬ä¼—å·Â <strong>å¤§æ¨¡å‹çœŸå¥½ç©</strong>ï¼Œæ¯æœŸåˆ†äº«æ¶‰åŠçš„ä»£ç å‡å¯åœ¨å…¬ä¼—å·ç§ä¿¡:Â <strong>LangChainæ™ºèƒ½ä½“å¼€å‘</strong>å…è´¹è·å–ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ThreadLocal è®²æ¸…æ¥šï¼šå®ƒæ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆä¼šâ€œå†…å­˜æ³„æ¼â€ã€çº¿ç¨‹æ± å¤ç”¨ä¸ºä»€ä¹ˆä¼šä¸²å·]]></title>    <link>https://juejin.cn/post/7585458459166670882</link>    <guid>https://juejin.cn/post/7585458459166670882</guid>    <pubDate>2025-12-20T15:42:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585458459166670882" data-draft-id="7585452404113915919" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ThreadLocal è®²æ¸…æ¥šï¼šå®ƒæ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆä¼šâ€œå†…å­˜æ³„æ¼â€ã€çº¿ç¨‹æ± å¤ç”¨ä¸ºä»€ä¹ˆä¼šä¸²å·"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T15:42:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æœ¨æœ¨ä¸€ç›´åœ¨å“­æ³£"/> <meta itemprop="url" content="https://juejin.cn/user/3896324937225085"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ThreadLocal è®²æ¸…æ¥šï¼šå®ƒæ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆä¼šâ€œå†…å­˜æ³„æ¼â€ã€çº¿ç¨‹æ± å¤ç”¨ä¸ºä»€ä¹ˆä¼šä¸²å·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3896324937225085/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æœ¨æœ¨ä¸€ç›´åœ¨å“­æ³£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T15:42:03.000Z" title="Sat Dec 20 2025 15:42:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<p>ThreadLocal æ˜¯ Java åç«¯é‡Œå¾ˆå¸¸è§çš„åŸºç¡€èƒ½åŠ›ï¼štraceIdã€ç”¨æˆ·ä¸Šä¸‹æ–‡ã€äº‹åŠ¡èµ„æºã€MDCâ€¦â€¦å¾ˆå¤šæ¡†æ¶éƒ½åœ¨ç”¨å®ƒã€‚ä½† ThreadLocal ä¹Ÿå¾ˆå®¹æ˜“â€œç¿»è½¦â€ï¼Œæœ€å…¸å‹å°±æ˜¯ä¸¤ç±»é—®é¢˜ï¼š</p>
<ol>
<li><strong>çœ‹èµ·æ¥åƒå†…å­˜æ³„æ¼</strong>ï¼ˆå…¶å®æ˜¯â€œçº¿ç¨‹çº§å¸¸é©»â€ï¼‰</li>
<li><strong>çº¿ç¨‹æ± å¤ç”¨å¯¼è‡´æ•°æ®ä¸²å·</strong></li>
</ol>
<p>è¿™ç¯‡æ–‡ç« ä¸æ•´å¤æ‚å·¥ç¨‹ï¼Œåªç”¨<strong>æœ€å°ç¤ºä¾‹</strong>è®©ä½ çœ‹æ‡‚æœ¬è´¨ã€‚</p>
<hr/>
<h2 data-id="heading-0">1. ThreadLocal æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p>ä¸€å¥è¯ï¼š</p>
<blockquote>
<p><strong>ThreadLocal = æ¯ä¸ªçº¿ç¨‹ä¸€ä»½çš„éšå¼å˜é‡</strong>ã€‚<br/>
åŒä¸€ä¸ªçº¿ç¨‹é‡Œ set çš„å€¼ï¼Œåé¢éšå¤„ getï¼›ä¸åŒçº¿ç¨‹äº’ç›¸éš”ç¦»ã€‚</p>
</blockquote>
<p>å…³é”®ç‚¹ï¼š<strong>æ•°æ®ä¸å­˜åœ¨çº¿ç¨‹å¤–ï¼Œè€Œæ˜¯å­˜åœ¨ Thread è‡ªå·±çš„ä¸€ä¸ª Map é‡Œ</strong>ã€‚</p>
<p>ä½ å¯ä»¥æƒ³è±¡æˆâ€œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸ªå£è¢‹â€ï¼š</p>
<ul>
<li><code>set(x)</code>ï¼šæŠŠ x æ”¾åˆ°å½“å‰çº¿ç¨‹å£è¢‹</li>
<li><code>get()</code>ï¼šä»å½“å‰çº¿ç¨‹å£è¢‹æ‹¿å‡ºæ¥</li>
</ul>
<hr/>
<h2 data-id="heading-1">2. ä¸ºä»€ä¹ˆä¸ç”¨æ™®é€šå˜é‡ï¼Ÿ</h2>
<ul>
<li><strong>å±€éƒ¨å˜é‡ + æ˜¾å¼ä¼ å‚</strong>æœ€å®‰å…¨ï¼ˆæ¨èï¼‰ï¼Œä½†å·¥ç¨‹é‡Œä¸Šä¸‹æ–‡å¸¸å¸¸è·¨å¾ˆå¤šå±‚ï¼ˆæ—¥å¿—ã€å®¡è®¡ã€é‰´æƒã€DAOï¼‰ï¼Œæ–¹æ³•ç­¾åä¼šçˆ†ç‚¸ã€‚</li>
<li><strong>æˆå‘˜å˜é‡ / static å˜é‡</strong>å¹¶å‘ä¸‹ä¼šä¸²å·ï¼ˆå°¤å…¶ Controller é€šå¸¸æ˜¯å•ä¾‹ï¼Œå¤šä¸ªè¯·æ±‚å¹¶å‘è®¿é—®ï¼‰ã€‚</li>
</ul>
<p>ThreadLocal çš„æ„ä¹‰æ˜¯ï¼šåœ¨ä¸æ±¡æŸ“å¤§é‡æ–¹æ³•ç­¾åçš„æƒ…å†µä¸‹ï¼Œæä¾›<strong>çº¿ç¨‹çº§éš”ç¦»çš„ä¸Šä¸‹æ–‡</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-2">3. çº¿ç¨‹æ± å¤ç”¨ä¸ºä»€ä¹ˆä¼šå¯¼è‡´â€œä¸²å·â€ï¼Ÿ</h2>
<p>æ ¸å¿ƒåŸå› åªæœ‰ä¸€ä¸ªï¼š</p>
<blockquote>
<p><strong>çº¿ç¨‹æ± ä¼šå¤ç”¨åŒä¸€ä¸ª Thread æ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚</strong><br/>
å¦‚æœä½  set äº† ThreadLocal å´ä¸ removeï¼Œä¸‹ä¸€ä¸ªä»»åŠ¡å¤ç”¨åŒä¸€çº¿ç¨‹æ—¶å°±å¯èƒ½è¯»åˆ°ä¸Šä¸€æ¬¡æ®‹ç•™å€¼ã€‚</p>
</blockquote>
<p>ä¸‹é¢è¿™ä¸ªçº¯ Java ç¤ºä¾‹ï¼Œèƒ½è®©ä½ è‚‰çœ¼çœ‹åˆ°â€œä¸²å·â€ã€‚</p>
<h3 data-id="heading-3">âœ… æœ€å°å¯è¿è¡Œç¤ºä¾‹ï¼šå¤ç”¨ + ä¸æ¸…ç† = ä¸²å·</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.ExecutorService;
<span class="hljs-keyword">import</span> java.util.concurrent.Executors;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocalBleedDemo</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;String&gt; TL = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// å•çº¿ç¨‹æ± ï¼šä¿è¯æ¯æ¬¡éƒ½å¤ç”¨åŒä¸€ä¸ªçº¿ç¨‹ï¼Œç°è±¡æœ€æ¸…æ™°</span>
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">1</span>);

        pool.submit(() -&gt; doWork(<span class="hljs-string">"Alice"</span>)).get();
        pool.submit(() -&gt; doWork(<span class="hljs-string">"Bob"</span>)).get();
        pool.submit(() -&gt; doWork(<span class="hljs-string">"Cindy"</span>)).get();

        pool.shutdown();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doWork</span><span class="hljs-params">(String user)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">before</span> <span class="hljs-operator">=</span> TL.get();   <span class="hljs-comment">// è¯»åˆ°ä¸Šä¸€æ¬¡æ®‹ç•™ï¼ˆå¦‚æœæ²¡æ¸…ç†ï¼‰</span>
        TL.set(user);
        <span class="hljs-type">String</span> <span class="hljs-variable">after</span> <span class="hljs-operator">=</span> TL.get();

        System.out.printf(<span class="hljs-string">"[%s] before=%s, after=%s%n"</span>,
                Thread.currentThread().getName(), before, after);

        <span class="hljs-comment">// âŒ æ•…æ„ä¸ removeï¼šä¸‹ä¸€æ¬¡ä»»åŠ¡å¤ç”¨åŒä¸€çº¿ç¨‹å°±ä¼šçœ‹åˆ° before=ä¸Šæ¬¡çš„ after</span>
        <span class="hljs-comment">// TL.remove(); // âœ… æ‰“å¼€å®ƒå°±ä¸ä¼šä¸²å·</span>
    }
}
</code></pre>
<p>å…¸å‹è¾“å‡ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[pool-1-thread-1]</span> <span class="hljs-attr">before</span>=null,  after=Alice
<span class="hljs-section">[pool-1-thread-1]</span> <span class="hljs-attr">before</span>=Alice, after=Bob
<span class="hljs-section">[pool-1-thread-1]</span> <span class="hljs-attr">before</span>=Bob,   after=Cindy
</code></pre>
<p>çœ‹åˆ°æ²¡ï¼šè¿™ä¸æ˜¯å¹¶å‘ç«äº‰ï¼Œè€Œæ˜¯<strong>ç”Ÿå‘½å‘¨æœŸç®¡ç†é”™è¯¯</strong>ã€‚</p>
<h3 data-id="heading-4">æ­£ç¡®å§¿åŠ¿ï¼ˆå¿…èƒŒï¼‰</h3>
<blockquote>
<p><strong>set ä¹‹åå¿…é¡» finally remove</strong></p>
</blockquote>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">try</span> {
    TL.<span class="hljs-keyword">set</span>(user);
    <span class="hljs-comment">// do work</span>
} <span class="hljs-keyword">finally</span> {
    TL.<span class="hljs-keyword">remove</span>();
}
</code></pre>
<hr/>
<h2 data-id="heading-5">4. ThreadLocal ä¸ºä»€ä¹ˆä¼šâ€œå†…å­˜æ³„æ¼â€ï¼Ÿï¼ˆæ›´å‡†ç¡®ï¼šçº¿ç¨‹çº§å¸¸é©»ï¼‰</h2>
<p>å…ˆè¯´ç»“è®ºï¼š</p>
<blockquote>
<p>ThreadLocal â€œæ³„æ¼â€çš„ä¸æ˜¯ ThreadLocal æœ¬èº«ï¼Œè€Œæ˜¯<strong>çº¿ç¨‹é•¿æœŸæŒæœ‰çš„ value</strong>é‡Šæ”¾ä¸æ‰ã€‚<br/>
åœ¨çº¿ç¨‹æ± é‡Œï¼Œçº¿ç¨‹æ´»å¾—å¾ˆä¹…ï¼Œæ‰€ä»¥ value ä¼šâ€œå¸¸é©»â€ï¼Œè¡¨ç°å¾—åƒå†…å­˜æ³„æ¼ã€‚</p>
</blockquote>
<h3 data-id="heading-6">4.1 å‘ç”Ÿäº†ä»€ä¹ˆï¼ˆæŠ“ä½å…³é”®ç»“æ„ï¼‰</h3>
<p>åœ¨ JDK é‡Œï¼ŒThreadLocal æ•°æ®çš„ç»“æ„å¤§è‡´æ˜¯ï¼š</p>
<ul>
<li>
<p>æ¯ä¸ª <code>Thread</code> æœ‰ä¸€ä¸ª <code>ThreadLocalMap</code></p>
</li>
<li>
<p>Map çš„ Entry é‡Œï¼š</p>
<ul>
<li><strong>key æ˜¯ ThreadLocal çš„å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</strong></li>
<li><strong>value æ˜¯å¼ºå¼•ç”¨ï¼ˆObject valueï¼‰</strong></li>
</ul>
</li>
</ul>
<p>ä¹Ÿå°±æ˜¯ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Thread
 â””â”€â”€ ThreadLocalMap
      â””â”€â”€ Entry(<span class="hljs-attr">key</span>=ThreadLocalå¼±å¼•ç”¨, value=å¼ºå¼•ç”¨çš„å¤§å¯¹è±¡)
</code></pre>
<h3 data-id="heading-7">4.2 ä¸ºä»€ä¹ˆ key å¼±å¼•ç”¨äº†è¿˜ä¼šâ€œæ³„æ¼â€ï¼Ÿ</h3>
<p>å› ä¸ºæ³„æ¼ç‚¹åœ¨ valueï¼š</p>
<ul>
<li>æŸäº›æƒ…å†µä¸‹ ThreadLocal è¿™ä¸ª key æ²¡äººå¼•ç”¨äº†ï¼Œä¼šè¢« GC æ‰ï¼ˆå¼±å¼•ç”¨å˜ nullï¼‰</li>
<li>ä½† <strong>Entry.value ä»ç„¶è¢« ThreadLocalMap å¼ºå¼•ç”¨ç€</strong></li>
<li>çº¿ç¨‹ï¼ˆå°¤å…¶çº¿ç¨‹æ± çº¿ç¨‹ï¼‰ä¸ç»“æŸ â†’ Map ä¸é‡Šæ”¾ â†’ value ä¹Ÿé‡Šæ”¾ä¸äº†</li>
</ul>
<p><strong>äºæ˜¯ï¼šä½ ä»¥ä¸ºâ€œè¯·æ±‚ç»“æŸå¯¹è±¡å°±è¯¥å›æ”¶â€ï¼Œå®é™…å®ƒæŒ‚åœ¨çº¿ç¨‹ä¸Šä¸€ç›´åœ¨ã€‚</strong></p>
<h3 data-id="heading-8">4.3 ä¸€ä¸ªæ›´ç›´è§‚çš„â€œå¸¸é©»â€ä¾‹å­</h3>
<p>å‡è®¾ä½ æŠŠå¤§å¯¹è±¡å¡è¿› ThreadLocalï¼ˆæ¯”å¦‚ 10MB çš„ byte[] æˆ–å¤§ Mapï¼‰ï¼š</p>
<ul>
<li>çº¿ç¨‹æ± æœ‰ 200 ä¸ªçº¿ç¨‹</li>
<li>æ¯ä¸ªçº¿ç¨‹éƒ½ set è¿‡ä¸€æ¬¡ 10MB</li>
<li>å³ä½¿ä¸šåŠ¡æ—©å°±ç»“æŸï¼Œè¿™äº› value ä»å¯èƒ½é•¿æœŸæŒ‚åœ¨çº¿ç¨‹ä¸Š</li>
</ul>
<p>ç»“æœå°±æ˜¯ï¼š</p>
<ul>
<li>å †å†…å­˜é•¿æœŸåé«˜</li>
<li>GC å‹åŠ›ä¸Šå‡</li>
<li>æç«¯æƒ…å†µä¸‹ OOM</li>
</ul>
<h3 data-id="heading-9">4.4 å¦‚ä½•é¿å…ï¼ˆå·¥ç¨‹é‡Œå°±ä¸‰æ¡ï¼‰</h3>
<ol>
<li><strong>å¿…é¡» finally remove</strong>ï¼ˆæœ€é‡è¦ï¼‰</li>
<li>ThreadLocal å°½é‡ <code>static final</code>ï¼Œä¸è¦åˆ°å¤„ <code>new ThreadLocal()</code></li>
<li>ThreadLocal é‡Œå°½é‡åˆ«æ”¾å¤§å¯¹è±¡/é‡èµ„æºï¼›ç¡®å®è¦æ”¾å°±æ›´è¦ä¸¥æ ¼æ¸…ç†</li>
</ol>
<hr/>
<h2 data-id="heading-10">5. ä¸€å¥è¯æ€»ç»“</h2>
<blockquote>
<p><strong>ThreadLocal çš„é—®é¢˜ä¸æ˜¯å¹¶å‘ï¼Œè€Œæ˜¯ç”Ÿå‘½å‘¨æœŸã€‚</strong><br/>
å®ƒç»‘å®šçš„æ˜¯çº¿ç¨‹ï¼Œä¸æ˜¯è¯·æ±‚ã€‚åœ¨çº¿ç¨‹æ± ç¯å¢ƒé‡Œï¼Œ<strong>set å¿…é¡»é… remove</strong>ï¼Œå¦åˆ™ä¸²å·å’Œâ€œçº¿ç¨‹çº§å¸¸é©»â€åªæ˜¯æ—¶é—´é—®é¢˜ã€‚</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼š5ä¸ªè¢«ä½ä¼°çš„é…ç½®é¡¹è®©æˆ‘èŠ‚çœäº†40%å†…å­˜æˆæœ¬]]></title>    <link>https://juejin.cn/post/7585600621521616936</link>    <guid>https://juejin.cn/post/7585600621521616936</guid>    <pubDate>2025-12-21T04:16:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585600621521616936" data-draft-id="7585600621521600552" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼š5ä¸ªè¢«ä½ä¼°çš„é…ç½®é¡¹è®©æˆ‘èŠ‚çœäº†40%å†…å­˜æˆæœ¬"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-21T04:16:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼š5ä¸ªè¢«ä½ä¼°çš„é…ç½®é¡¹è®©æˆ‘èŠ‚çœäº†40%å†…å­˜æˆæœ¬
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T04:16:47.000Z" title="Sun Dec 21 2025 04:16:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Redis æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼š5ä¸ªè¢«ä½ä¼°çš„é…ç½®é¡¹è®©æˆ‘èŠ‚çœäº†40%å†…å­˜æˆæœ¬</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>Redis ä½œä¸ºé«˜æ€§èƒ½çš„å†…å­˜æ•°æ®åº“ï¼Œåœ¨ç°ä»£åº”ç”¨æ¶æ„ä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚ç„¶è€Œï¼Œéšç€æ•°æ®è§„æ¨¡çš„æ‰©å¤§ï¼Œå†…å­˜æˆæœ¬å¾€å¾€æˆä¸ºä¸å¯å¿½è§†çš„å¼€é”€ã€‚åœ¨ä¸€æ¬¡ç”Ÿäº§ç¯å¢ƒçš„ä¼˜åŒ–å®è·µä¸­ï¼Œæˆ‘é€šè¿‡è°ƒæ•´ 5 ä¸ªå¸¸è¢«ä½ä¼°çš„ Redis é…ç½®é¡¹ï¼ŒæˆåŠŸé™ä½äº† 40% çš„å†…å­˜ä½¿ç”¨é‡ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨è¿™äº›é…ç½®é¡¹çš„åŸç†ã€ä¼˜åŒ–ç­–ç•¥ä»¥åŠå®é™…æ•ˆæœï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç®¡ç† Redis èµ„æºã€‚</p>
<h2 data-id="heading-2">ä¸»ä½“</h2>
<h3 data-id="heading-3">1. <code>hash-max-ziplist-entries</code> å’Œ <code>hash-max-ziplist-value</code>ï¼šä¼˜åŒ–å“ˆå¸Œç»“æ„å­˜å‚¨</h3>
<p>Redis é»˜è®¤ä½¿ç”¨å“ˆå¸Œè¡¨ï¼ˆhashtableï¼‰å­˜å‚¨ Hash ç±»å‹çš„æ•°æ®ï¼Œä½†å¯¹äºå°è§„æ¨¡çš„å“ˆå¸Œç»“æ„ï¼Œè¿™ç§æ–¹å¼çš„å­˜å‚¨æ•ˆç‡å¹¶ä¸é«˜ã€‚Redis æä¾›äº† <code>ziplist</code>ï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ä½œä¸ºæ›¿ä»£æ–¹æ¡ˆï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘å†…å­˜å ç”¨ã€‚</p>
<ul>
<li>
<p><strong>åŸç†</strong>ï¼š<br/>
å½“ Hash ç»“æ„çš„å­—æ®µæ•°é‡å’Œå­—æ®µå€¼å¤§å°æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼ŒRedis ä¼šä½¿ç”¨ <code>ziplist</code>ï¼š</p>
<ul>
<li>å­—æ®µæ•°é‡ â‰¤ <code>hash-max-ziplist-entries</code>ï¼ˆé»˜è®¤å€¼ï¼š512ï¼‰</li>
<li>å­—æ®µå€¼é•¿åº¦ â‰¤ <code>hash-max-ziplist-value</code>ï¼ˆé»˜è®¤å€¼ï¼š64å­—èŠ‚ï¼‰</li>
</ul>
<p>å¦‚æœä¸æ»¡è¶³æ¡ä»¶ï¼ŒRedis ä¼šé€€åŒ–ä¸º hashtableã€‚</p>
</li>
<li>
<p><strong>ä¼˜åŒ–å®è·µ</strong>ï¼š<br/>
é€šè¿‡åˆ†æä¸šåŠ¡æ•°æ®ç‰¹æ€§ï¼Œæˆ‘å‘ç°å¤§éƒ¨åˆ† Hash ç»“æ„çš„å­—æ®µæ•°ä¸è¶…è¿‡ 1000ï¼Œä¸”å­—æ®µå€¼å¤šä¸ºçŸ­å­—ç¬¦ä¸²ï¼ˆå¦‚ç”¨æˆ·å±æ€§ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘å°†é…ç½®è°ƒæ•´ä¸ºï¼š</p>
<pre><code class="hljs language-plaintext" lang="plaintext">hash-max-ziplist-entries 1024
hash-max-ziplist-value 128
</code></pre>
<p>è¿™ä¸€è°ƒæ•´ä½¿å¾—æ›´å¤š Hash ç»“æ„ä»¥ <code>ziplist</code> å½¢å¼å­˜å‚¨ï¼Œå†…å­˜å ç”¨å‡å°‘äº†çº¦ <strong>15%</strong>ã€‚</p>
</li>
</ul>
<h3 data-id="heading-4">2. <code>list-max-ziplist-size</code>ï¼šå‹ç¼©åˆ—è¡¨çš„çµæ´»æ§åˆ¶</h3>
<p>List ç±»å‹åœ¨ Redis ä¸­é»˜è®¤ä¹Ÿä½¿ç”¨ <code>ziplist</code>ï¼ˆå¯¹äºå°åˆ—è¡¨ï¼‰æˆ–åŒå‘é“¾è¡¨ï¼ˆlinkedlistï¼‰ã€‚<code>list-max-ziplist-size</code>Â å‚æ•°å†³å®šäº†ä½•æ—¶åˆ‡æ¢ä¸º linkedlistã€‚</p>
<ul>
<li>
<p><strong>åŸç†</strong>ï¼š<br/>
è¯¥å‚æ•°çš„é»˜è®¤å€¼ä¸º <code>-2</code>ï¼ˆå³æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§å†…å­˜é™åˆ¶ï¼‰ï¼Œä½†å¯ä»¥é€šè¿‡æ­£æ•´æ•°ç›´æ¥é™åˆ¶èŠ‚ç‚¹æ•°é‡ã€‚ä¾‹å¦‚ï¼š<br/>
è®¾ç½®Â <code>list-max-ziplist-sizeÂ 512</code>Â è¡¨ç¤ºå½“åˆ—è¡¨é•¿åº¦è¶…è¿‡512æ—¶è½¬ä¸º linkedlistã€‚</p>
</li>
<li>
<p><strong>ä¼˜åŒ–å®è·µ</strong>ï¼š<br/>
ç”±äºæˆ‘çš„ä¸šåŠ¡åœºæ™¯ä¸­ List ä¸»è¦ç”¨äºçŸ­æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¹³å‡é•¿åº¦ &lt;1000ï¼‰ï¼Œè°ƒæ•´ä¸ºï¼š</p>
<pre><code class="hljs language-plaintext" lang="plaintext">list-max-ziplist-size -1 (ä¸é™åˆ¶èŠ‚ç‚¹æ•°é‡)
 æˆ–
 list-max-ziplist-sizeÂ 1024
</code></pre>
<p>è¿™é¿å…äº†ä¸å¿…è¦çš„ linkedlistè½¬æ¢ï¼Œè¿›ä¸€æ­¥èŠ‚çœäº† <strong>8%</strong>Â çš„å†…å­˜ã€‚</p>
</li>
</ul>
<h3 data-id="heading-5">Â 3.Â <code>set-max-intset-entries</code>:Â æ•´æ•°é›†åˆçš„é­”æ³•</h3>
<p>Setç±»å‹åœ¨å­˜å‚¨çº¯æ•´æ•°æ—¶ä¼šä½¿ç”¨æ›´é«˜æ•ˆçš„ <code>intset</code>Â è€Œéå“ˆå¸Œè¡¨ã€‚ä½†é»˜è®¤çš„è½¬æ¢é˜ˆå€¼è¾ƒä½ï¼ˆ512ï¼‰ã€‚</p>
<pre><code class="hljs language-plaintext" lang="plaintext">set-max-intset-entriesÂ 1024
```Â Â 

å°†é˜ˆå€¼æé«˜åˆ°1024å,Â å¤§é‡å°è§„æ¨¡æ•´æ•°é›†åˆç»§ç»­ä½¿ç”¨ç´§å‡‘å­˜å‚¨,å†é™ **5%**Â å†…å­˜.Â Â 

### Â 4.å¯ç”¨ä¸»åŠ¨ç¢ç‰‡æ•´ç†:activedefragÂ Â 

éšç€é”®çš„é¢‘ç¹ä¿®æ”¹åˆ é™¤,redisä¼šå‡ºç°å†…å­˜ç¢ç‰‡.è™½ç„¶è‡ªåŠ¨æ¸…ç†å­˜åœ¨,ä½†å¯¹é«˜è´Ÿè½½å®ä¾‹ä¸å¤ŸåŠæ—¶:Â Â 

```plaintext
activedefrag yesÂ 
active-defrag-threshold-lower10Â 
active-defrag-cycle-min25Â Â Â Â Â 
active-defrag-cycle-max75Â Â 
```Â Â 

é€šè¿‡ä¸»åŠ¨æ•´ç†(éœ€ç›‘æ§CPU),å¯å‡å°‘ç¢ç‰‡å¯¼è‡´çš„å¤šä½™åˆ†é…,æ•ˆæœçº¦ **7%**.Â Â 

### Â 5.åˆç†é€‰æ‹©æ·˜æ±°ç­–ç•¥ä¸è¿‡æœŸå¤„ç†Â Â Â 

è®¸å¤šå¼€å‘è€…å¿½è§†maxmemory-policyå¯¹å†…å­˜çš„å½±å“.lru/allkeys-lruå¯èƒ½è¯¯ä¼¤çƒ­ç‚¹æ•°æ®;è€Œvolatileç­–ç•¥éœ€ç»“åˆttlç®¡ç†:Â Â 

```plaintextÂ 
maxmemory-policy volatile-lruÂ Â Â 
#åŒæ—¶ç¡®ä¿è®¾ç½®äº†expireÂ 
```Â 

é…åˆå®šæœŸæ‰«æå¹¶åˆ é™¤æ— ttlçš„é”®,æœ€ç»ˆå†çœ **5%**.Â Â Â 

##æ€»ç»“Â Â 

é€šè¿‡å¯¹äº”ä¸ªå…³é”®å‚æ•°çš„è°ƒä¼˜â€”hash/list/setçš„åº•å±‚ç»“æ„è°ƒæ•´ã€ç¢ç‰‡æ•´ç†å’Œæ·˜æ±°ç­–ç•¥â€”æˆ‘åœ¨ä¿è¯æ€§èƒ½çš„å‰æä¸‹å®ç°äº†40%çš„å†…å­˜èŠ‚çº¦.è¿™äº›ä¼˜åŒ–éœ€è¦ç»“åˆå…·ä½“ä¸šåŠ¡æ•°æ®ç‰¹å¾,å»ºè®®å…ˆè¿›è¡Œbenchmarkæµ‹è¯•.redisçœŸæ­£çš„å¨åŠ›ä¸ä»…åœ¨äºå…¶é€Ÿåº¦,æ›´åœ¨äºè¿™ç§ç»†ç²’åº¦å¯æ§æ€§.
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€è™šæ‹Ÿæœºã€‘ä½¿ç”¨OpenWrtä½œä¸ºè™šæ‹Ÿæœºé›†ç¾¤çš„è½¯è·¯ç”±ï¼ˆä¸‹ï¼‰]]></title>    <link>https://juejin.cn/post/7585463195201945650</link>    <guid>https://juejin.cn/post/7585463195201945650</guid>    <pubDate>2025-12-20T13:57:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585463195201945650" data-draft-id="7585446706328141833" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€è™šæ‹Ÿæœºã€‘ä½¿ç”¨OpenWrtä½œä¸ºè™šæ‹Ÿæœºé›†ç¾¤çš„è½¯è·¯ç”±ï¼ˆä¸‹ï¼‰"/> <meta itemprop="keywords" content="Linux,ç½‘ç»œåè®®"/> <meta itemprop="datePublished" content="2025-12-20T13:57:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çŒ›å–å¨å£«å¿Œ"/> <meta itemprop="url" content="https://juejin.cn/user/3837719308930574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€è™šæ‹Ÿæœºã€‘ä½¿ç”¨OpenWrtä½œä¸ºè™šæ‹Ÿæœºé›†ç¾¤çš„è½¯è·¯ç”±ï¼ˆä¸‹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3837719308930574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çŒ›å–å¨å£«å¿Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:57:42.000Z" title="Sat Dec 20 2025 13:57:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Background</h2>
<p>ä¸Šä¸€ç¯‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ceerdecy.com%2Farticle%2Fvm%2Fopenwrt%2Finstall" target="_blank" title="https://www.ceerdecy.com/article/vm/openwrt/install" ref="nofollow noopener noreferrer">ã€è™šæ‹Ÿæœºã€‘ä½¿ç”¨VMwareå®‰è£…Openwrtï¼ˆä¸Šï¼‰</a></p>
<p>ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬å·²ç»å®‰è£…å¥½äº†ä¸€ä¸ªOpenwrtè™šæ‹Ÿæœºï¼Œé‚£ä¹ˆè¿™ç¯‡æˆ‘ä»¬å°†æ•™å¤§å®¶å¦‚ä½•è¿›è¡Œé…æ¥å®ç°æˆ‘ä»¬ä»¥ä¸‹çš„æ¶æ„ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/683b08e719c746228b2c4a04c7de508b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54yb5Zad5aiB5aOr5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843862&amp;x-signature=yuYhm2KDBTbhTQt35z5bFQC6s5M%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">è®¾ç½®ç½‘å¡</h2>
<p>æˆ‘ä»¬å°†ä¸ºOpenwrtçš„è™šæ‹Ÿæœºæ·»åŠ ä¸¤å¼ <code>ç½‘ç»œé€‚é…å™¨</code></p>
<p>ç¬¬ä¸€å¼ ä½¿ç”¨<code>æ¡¥æ¥æ¨¡å¼</code>ä½œä¸ºeth0ç½‘å¡</p>
<p>ç¬¬äºŒå¼ ä½¿ç”¨è‡ªå®šä¹‰çš„è™šæ‹Ÿç½‘ç»œï¼Œé€‰æ‹©<code>ä»…ä¸»æœºæ¨¡å¼</code>çš„</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c68365b35aab40e99c0180a9be69ca77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54yb5Zad5aiB5aOr5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843862&amp;x-signature=Mc35NDRzkkYYr2JmBwmsmhX%2F%2FHE%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">ä¸ºOpenwrté…ç½®ç½‘ç»œ</h2>
<p>æˆ‘ä»¬æ‰“å¼€å®¿ä¸»æœºï¼ˆWindowsï¼‰çš„ç»ˆç«¯ï¼Œä½¿ç”¨<code>ifconfig</code>æŸ¥çœ‹ä¸€ä¸‹ç½‘ç»œé€‚é…å™¨ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬éœ€è¦å…³æ³¨ä¸€ä¸‹å®¿ä¸»æœºåœ¨æˆ‘ä»¬åˆšåˆšæ·»åŠ çš„è™šæ‹Ÿç½‘ç»œä¸­çš„<code>IP</code>å’Œ<code>å­ç½‘æ©ç </code>Â ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9654966551f4938b424413efa6f3db8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54yb5Zad5aiB5aOr5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843862&amp;x-signature=oyNv8E%2Fpz0mQzDzCM4RMjLS80vA%3D" alt="image.png" loading="lazy"/></p>
<p>å›åˆ°Openwrtçš„è™šæ‹Ÿæœºä¸­ï¼Œè¾“å…¥<code>vi /etc/config/network</code>Â ã€‚</p>
<p>è¾“å…¥<code>i</code>é”®è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œé…ç½®æŒ‰ç…§å›¾ä¸Šçš„å†…å®¹è¿›è¡Œä¿®æ”¹ï¼Œéœ€è¦å•ç‹¬ç•™æ„ä¸€ä¸‹çº¢è‰²æ–¹æ¡†ä¸­çš„<code>ipaddr</code>ä»¥åŠ<code>netmask</code></p>
<p>ipaddréœ€è¦è®¾ç½®å¾—ä¸åˆšåˆšæŸ¥è¯¢çš„å®¿ä¸»æœºipä¸ä¸€æ ·ï¼Œæ¯”å¦‚å®¿ä¸»æœºipä¸º<code>192.168.211.1</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬è®¾ç½®ä¸º<code>192.168.211.2</code>Â å³å¯ï¼Œ<code>netmask</code>åˆ™å’Œå®¿ä¸»æœºçš„çš„å­ç½‘æ©ç ä¸€è‡´ã€‚</p>
<p>æŒ‰ä¸‹<code>esc</code>è¾“å…¥<code>:wq</code>ä¿å­˜</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb924b80d1e94d989f1ded5ee8b7ff3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54yb5Zad5aiB5aOr5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843862&amp;x-signature=ruXM9Z%2Fb1JE52G0WKxYJRxWZvzs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7928d140b0a942d38c99942b1248a400~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54yb5Zad5aiB5aOr5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843862&amp;x-signature=rgyUfG92neQNU5xnU%2BE12g6B5Y4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">é…ç½®è½¬å‘è§„åˆ™</h2>
<p>æ‰§è¡Œå‘½ä»¤<code>sysctl -w net.ipv4.ip_forward=1</code>Â ç¡®ä¿å¼€å¯å†…æ ¸è½¬å‘ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b933479e57c4bb5bbcdaab0423a2a02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54yb5Zad5aiB5aOr5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843862&amp;x-signature=PI6z3Cj2OPeC%2ByouwtszhRj8z8w%3D" alt="image.png" loading="lazy"/>
æ‰§è¡Œä»¥ä¸‹å‘½ä»¤,å°†Lanå£æµé‡é€šè¿‡Wanå£è¿›è¡Œè½¬å‘ï¼Œè¿™æ ·æˆ‘ä»¬è¿æ¥Openwrtçš„è™šæ‹Ÿæœºå°±å¯ä»¥è®¿é—®ç½‘ç»œäº†ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">uci <span class="hljs-built_in">set</span> firewall.@zone[1].masq=<span class="hljs-string">'1'</span>
uci add firewall forwarding
uci <span class="hljs-built_in">set</span> firewall.@forwarding[-1].src=<span class="hljs-string">'lan'</span>
uci <span class="hljs-built_in">set</span> firewall.@forwarding[-1].dest=<span class="hljs-string">'wan'</span>
uci commit firewall
/etc/init.d/firewall restart
</code></pre>
<h2 data-id="heading-4">è¿æ¥Openwrt</h2>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥åˆ›å»ºå¦ä¸€ä¸ªLinuxè™šæ‹Ÿæœºæ¥è¿æ¥å®ƒï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Ubuntuçš„é•œåƒã€‚è€ƒè™‘åˆ°éœ€è¦ä½œä¸ºk8sçš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥å°†<code>IPå›ºå®š</code>ä¸‹æ¥ä¼šæ¯”è¾ƒåˆé€‚ï¼Œè€Œéä½¿ç”¨<code>DHCP</code>ã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬åªéœ€è¦æ·»åŠ ä¸€ä¸ªç½‘ç»œé€‚é…å™¨å³å¯ï¼Œå³ä»…ä¸»æœºæ¨¡å¼çš„VMnet1ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8c65258635946ad8fbc3de5d3605f95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54yb5Zad5aiB5aOr5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843862&amp;x-signature=TgXnZ%2FlckVgvGg4t%2Bez78qRJmiw%3D" alt="image.png" loading="lazy"/></p>
<p>è¾“å…¥<code>sudo vi /etc/netplan/50-cloud-init.yaml</code>Â å¯¹ç½‘ç»œè¿›è¡Œè®¾ç½®ï¼š</p>
<p>å…¶ä¸­<code>addresses</code>è®¾ç½®ä¸ºæœ¬æœºæƒ³è¦ç»‘å®šçš„ip</p>
<p><code>192.168.211.1</code>åˆ†é…ç»™äº†å®¿ä¸»æœº</p>
<p><code>192.168.211.2</code>åˆ†é…ç»™äº†Openwrt</p>
<p>å› æ­¤æœ¬æœºçš„å°±ä¸èƒ½æ˜¯è¿™ä¸¤ä¸ªäº†ï¼Œè€Œä¸ºäº†æ›´å¥½åŒºåˆ†ï¼Œæˆ‘ä»¬å¯ä»¥ä»<code>10</code>å¼€å§‹åˆ†é…ï¼Œå¦‚æœæœ‰å¤šä¸ªè™šæ‹Ÿæœºæƒ³è¦é“¾æ¥ï¼Œé‚£ä¹ˆ<code>11</code>ã€<code>12</code>ã€<code>13</code>ä¾æ¬¡ç´¯åŠ å³å¯ã€‚è¿™é‡Œæˆ‘ä»¬å°±åˆ†é…<code>192.168.211.10</code>ç»™å½“å‰æœºå™¨ï¼Œ<code>/24</code>æ˜¯å› ä¸ºå­ç½‘æ©ç ä¸º<code>255.255.255.0</code>ï¼Œå¦‚æœä½ çš„å­ç½‘æ©ç ä¸æˆ‘çš„ä¸åŒï¼Œé‚£è¿™ä¸ªæ•°å€¼ä¹Ÿéœ€è¦ä¿®æ”¹ã€‚</p>
<p><code>gateway4</code>è®¾ç½®çš„æ˜¯ç½‘å…³åœ°å€ï¼Œå³Openwrtçš„åœ°å€</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f5a14df97304f27abfd1278e472cf99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54yb5Zad5aiB5aOr5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843862&amp;x-signature=3Qu47pKbk0Ac71LT4frEc0Pi%2Bqg%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd4ac43f2c3f481cb38e1f3d73af7e2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54yb5Zad5aiB5aOr5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843862&amp;x-signature=r0%2Bi%2FfqgEEE1P9ZJ3MjgjtMxafY%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-yaml" lang="yaml">    <span class="hljs-attr">network:</span>
      <span class="hljs-attr">version:</span> <span class="hljs-number">2</span>
      <span class="hljs-attr">renderer:</span> <span class="hljs-string">networkd</span>
      <span class="hljs-attr">ethernets:</span>
        <span class="hljs-attr">ens33:</span>
          <span class="hljs-attr">dhcp4:</span> <span class="hljs-literal">no</span> <span class="hljs-comment"># å…³é—­DHCP</span>
          <span class="hljs-attr">addresses:</span>
            <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.211</span><span class="hljs-number">.10</span><span class="hljs-string">/24</span>
          <span class="hljs-attr">gateway4:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.211</span><span class="hljs-number">.2</span>
          <span class="hljs-attr">nameservers:</span>
            <span class="hljs-attr">addresses:</span>
              <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.211</span><span class="hljs-number">.2</span>
              <span class="hljs-bullet">-</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span>
              <span class="hljs-bullet">-</span> <span class="hljs-number">114.114</span><span class="hljs-number">.114</span><span class="hljs-number">.114</span>
</code></pre>
<p>è¿˜æœ‰åˆ«å¿˜äº†æ‰§è¡Œè¿™ä¸ªï¼Œåº”ç”¨ä¸€ä¸‹è®¾ç½®ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">sudo netplan apply
</code></pre>
<p>æ¥ç€æˆ‘ä»¬<code>curl</code>ä¸€ä¸‹<code>www.baidu.com</code> ï¼Œå°±èƒ½å‘ç°è¿™å°æœºå™¨å·²ç»å¯ä»¥æ­£å¸¸è®¿é—®ç½‘ç»œäº†ã€‚è¿™æ ·æˆ‘çš„Openwrtçš„é…ç½®å°±ç®—å®Œæˆäº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cda91c47d6ba4d17b25d53d38d4b9f7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54yb5Zad5aiB5aOr5b-M:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843862&amp;x-signature=MkSdqsUpWUIszm6DZ%2BeCMJQNXb8%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>ä¸Šä¸€ç¯‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ceerdecy.com%2Farticle%2Fvm%2Fopenwrt%2Finstall" target="_blank" title="https://www.ceerdecy.com/article/vm/openwrt/install" ref="nofollow noopener noreferrer">ã€è™šæ‹Ÿæœºã€‘ä½¿ç”¨VMwareå®‰è£…Openwrtï¼ˆä¸Šï¼‰</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flinkæºç é˜…è¯»ï¼šå¦‚ä½•ç”ŸæˆExecutionGraph]]></title>    <link>https://juejin.cn/post/7585452404113637391</link>    <guid>https://juejin.cn/post/7585452404113637391</guid>    <pubDate>2025-12-20T13:59:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585452404113637391" data-draft-id="7585452404113621007" data-original-type="2" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flinkæºç é˜…è¯»ï¼šå¦‚ä½•ç”ŸæˆExecutionGraph"/> <meta itemprop="keywords" content="Flink,å¤§æ•°æ®"/> <meta itemprop="datePublished" content="2025-12-20T13:59:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¢å‘Googleç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flinkæºç é˜…è¯»ï¼šå¦‚ä½•ç”ŸæˆExecutionGraph
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¢å‘Googleç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:59:07.000Z" title="Sat Dec 20 2025 13:59:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä»Šå¤©æˆ‘ä»¬ä¸€èµ·æ¥äº†è§£ Flink æœ€åä¸€ç§æ‰§è¡Œå›¾ï¼ŒExecutionGraph çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p>
<h3 data-id="heading-0">åŸºæœ¬æ¦‚å¿µ</h3>
<p>åœ¨é˜…è¯»æºç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ ExecutionGraph ä¸­çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚</p>
<ul>
<li>
<p><strong>ExecutionJobVertex:</strong>  ExecutionJobVertex æ˜¯ ExecutionGraph ä¸­çš„èŠ‚ç‚¹ï¼Œå¯¹åº”çš„æ˜¯ JobGraph ä¸­çš„ JobVertexã€‚</p>
</li>
<li>
<p><strong>ExecutionVertex:</strong> æ¯ä¸ª ExecutionJobVertex éƒ½åŒ…å«äº†ä¸€ç»„ ExecutionVertexï¼ŒExecutionVertex çš„æ•°é‡å°±æ˜¯èŠ‚ç‚¹å¯¹åº”çš„å¹¶è¡Œåº¦ã€‚</p>
</li>
<li>
<p><strong>IntermediateResult:</strong> IntermediateResult è¡¨ç¤ºèŠ‚ç‚¹çš„è¾“å‡ºç»“æœï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯ JobGraph ä¸­çš„ IntermediateDataSetã€‚</p>
</li>
<li>
<p><strong>IntermediateResultPartition:</strong> IntermediateResultPartition æ˜¯æ¯ä¸ª ExecutionVertex çš„è¾“å‡ºã€‚</p>
</li>
<li>
<p><strong>EdgeManager:</strong> EdgeManager ä¸»è¦è´Ÿè´£å­˜å‚¨ ExecutionGraph ä¸­æ‰€æœ‰ä¹‹é—´çš„è¿æ¥ï¼ŒåŒ…æ‹¬å…¶å¹¶è¡Œåº¦ã€‚</p>
</li>
<li>
<p><strong>Execution:</strong> Execution å¯ä»¥è®¤ä¸ºæ˜¯ä¸€æ¬¡å®é™…çš„è¿è¡Œå°è¯•ã€‚æ¯æ¬¡æ‰§è¡Œæ—¶ï¼ŒFlink éƒ½ä¼šå°†ExecutionVertex å°è£…æˆä¸€ä¸ª Executionï¼Œå¹¶é€šè¿‡ä¸€ä¸ª ExecutionAttemptID æ¥åšå”¯ä¸€æ ‡è¯†ã€‚</p>
</li>
</ul>
<h3 data-id="heading-1">ExecutionGraph ç”Ÿæˆè¿‡ç¨‹</h3>
<p>äº†è§£äº†è¿™äº›åŸºæœ¬æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ ExecutionGraph çš„å…·ä½“ç”Ÿæˆè¿‡ç¨‹ã€‚ç”Ÿæˆ ExecutionGraph çš„ä»£ç å…¥å£æ˜¯ DefaultExecutionGraphBuilder.build æ–¹æ³•ã€‚</p>
<p>é¦–å…ˆæ˜¯è·å–ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬ jobInformationã€jobStatusChangedListeners ç­‰ã€‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯åˆ›å»ºä¸€ä¸ª DefaultExecutionGraph å’Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// create a new execution graph, if none exists so far</span>
<span class="hljs-keyword">final</span> <span class="hljs-type">DefaultExecutionGraph</span> <span class="hljs-variable">executionGraph</span> <span class="hljs-operator">=</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultExecutionGraph</span>(
                jobInformation,
                futureExecutor,
                ioExecutor,
                rpcTimeout,
                executionHistorySizeLimit,
                classLoader,
                blobWriter,
                partitionGroupReleaseStrategyFactory,
                shuffleMaster,
                partitionTracker,
                executionDeploymentListener,
                executionStateUpdateListener,
                initializationTimestamp,
                vertexAttemptNumberStore,
                vertexParallelismStore,
                isDynamicGraph,
                executionJobVertexFactory,
                jobGraph.getJobStatusHooks(),
                markPartitionFinishedStrategy,
                taskDeploymentDescriptorFactory,
                jobStatusChangedListeners,
                executionPlanSchedulingContext);


<span class="hljs-keyword">try</span> {
    executionGraph.setPlan(JsonPlanGenerator.generatePlan(jobGraph));
} <span class="hljs-keyword">catch</span> (Throwable t) {
    log.warn(<span class="hljs-string">"Cannot create plan for job"</span>, t);
    <span class="hljs-comment">// give the graph an empty plan</span>
    executionGraph.setPlan(<span class="hljs-keyword">new</span> <span class="hljs-title class_">JobPlanInfo</span>.Plan(<span class="hljs-string">""</span>, <span class="hljs-string">""</span>, <span class="hljs-string">""</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;()));
}
</code></pre>
<p>ä¸‹é¢å°±æ˜¯ä¸¤ä¸ªæ¯”è¾ƒæ ¸å¿ƒçš„æ–¹æ³• getVerticesSortedTopologicallyFromSources å’Œ attachJobGraphã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// topologically sort the job vertices and attach the graph to the existing one</span>
List&lt;JobVertex&gt; sortedTopology = jobGraph.getVerticesSortedTopologicallyFromSources();

executionGraph.attachJobGraph(sortedTopology, jobManagerJobMetricGroup);
</code></pre>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å…ˆå°† JobVertex è¿›è¡Œæ’åºï¼Œç„¶åæ„å»º ExecutionGraph çš„æ‹“æ‰‘å›¾ã€‚</p>
<h4 data-id="heading-2">getVerticesSortedTopologicallyFromSources</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> List&lt;JobVertex&gt; <span class="hljs-title function_">getVerticesSortedTopologicallyFromSources</span><span class="hljs-params">()</span>
        <span class="hljs-keyword">throws</span> InvalidProgramException {
    <span class="hljs-comment">// early out on empty lists</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.taskVertices.isEmpty()) {
        <span class="hljs-keyword">return</span> Collections.emptyList();
    }

    List&lt;JobVertex&gt; sorted = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;JobVertex&gt;(<span class="hljs-built_in">this</span>.taskVertices.size());
    Set&lt;JobVertex&gt; remaining = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashSet</span>&lt;JobVertex&gt;(<span class="hljs-built_in">this</span>.taskVertices.values());

    <span class="hljs-comment">// start by finding the vertices with no input edges</span>
    <span class="hljs-comment">// and the ones with disconnected inputs (that refer to some standalone data set)</span>
    {
        Iterator&lt;JobVertex&gt; iter = remaining.iterator();
        <span class="hljs-keyword">while</span> (iter.hasNext()) {
            <span class="hljs-type">JobVertex</span> <span class="hljs-variable">vertex</span> <span class="hljs-operator">=</span> iter.next();

            <span class="hljs-keyword">if</span> (vertex.isInputVertex()) {
                sorted.add(vertex);
                iter.remove();
            }
        }
    }

    <span class="hljs-type">int</span> <span class="hljs-variable">startNodePos</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-comment">// traverse from the nodes that were added until we found all elements</span>
    <span class="hljs-keyword">while</span> (!remaining.isEmpty()) {

        <span class="hljs-comment">// first check if we have more candidates to start traversing from. if not, then the</span>
        <span class="hljs-comment">// graph is cyclic, which is not permitted</span>
        <span class="hljs-keyword">if</span> (startNodePos &gt;= sorted.size()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidProgramException</span>(<span class="hljs-string">"The job graph is cyclic."</span>);
        }

        <span class="hljs-type">JobVertex</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> sorted.get(startNodePos++);
        addNodesThatHaveNoNewPredecessors(current, sorted, remaining);
    }

    <span class="hljs-keyword">return</span> sorted;
}
</code></pre>
<p>è¿™æ®µä»£ç æ˜¯å°†æ‰€æœ‰çš„èŠ‚ç‚¹è¿›è¡Œæ’åºï¼Œå…ˆå°†æ‰€æœ‰çš„ Source èŠ‚ç‚¹ç­›é€‰å‡ºæ¥ï¼Œç„¶åå†å°†å‰©ä½™èŠ‚ç‚¹å‡å¦‚åˆ—è¡¨ã€‚è¿™æ ·å°±èƒ½æ„å»ºå‡ºæœ€ç»ˆçš„æ‹“æ‰‘å›¾ã€‚</p>
<h4 data-id="heading-3">attachJobGraph</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attachJobGraph</span><span class="hljs-params">(
        List&lt;JobVertex&gt; verticesToAttach, JobManagerJobMetricGroup jobManagerJobMetricGroup)</span>
        <span class="hljs-keyword">throws</span> JobException {

    assertRunningInJobMasterMainThread();

    LOG.debug(
            <span class="hljs-string">"Attaching {} topologically sorted vertices to existing job graph with {} "</span>
                    + <span class="hljs-string">"vertices and {} intermediate results."</span>,
            verticesToAttach.size(),
            tasks.size(),
            intermediateResults.size());

    attachJobVertices(verticesToAttach, jobManagerJobMetricGroup);
    <span class="hljs-keyword">if</span> (!isDynamic) {
        initializeJobVertices(verticesToAttach);
    }

    <span class="hljs-comment">// the topology assigning should happen before notifying new vertices to failoverStrategy</span>
    executionTopology = DefaultExecutionTopology.fromExecutionGraph(<span class="hljs-built_in">this</span>);

    partitionGroupReleaseStrategy =
            partitionGroupReleaseStrategyFactory.createInstance(getSchedulingTopology());
}
</code></pre>
<p>attachJobGraph æ–¹æ³•ä¸»è¦åŒ…å«ä¸¤æ­¥é€»è¾‘ï¼Œç¬¬ä¸€æ­¥æ˜¯è°ƒç”¨ attachJobVertices æ–¹æ³•åˆ›å»º ExecutionJobVertex å®ä¾‹ï¼Œç¬¬äºŒæ­¥æ˜¯è°ƒç”¨ fromExecutionGraph åˆ›å»ºä¸€äº›å…¶ä»–çš„æ ¸å¿ƒå¯¹è±¡ã€‚</p>
<p><strong>attachJobVertices</strong></p>
<p>attachJobVertices æ–¹æ³•ä¸­å°±æ˜¯éå†æ‰€æœ‰çš„ JobVertexï¼Œç„¶ååˆ©ç”¨ JobVertex ç”Ÿæˆ ExecutionJobVertexã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/** Attach job vertices without initializing them. */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">attachJobVertices</span><span class="hljs-params">(
        List&lt;JobVertex&gt; topologicallySorted, JobManagerJobMetricGroup jobManagerJobMetricGroup)</span>
        <span class="hljs-keyword">throws</span> JobException {
    <span class="hljs-keyword">for</span> (JobVertex jobVertex : topologicallySorted) {

        <span class="hljs-keyword">if</span> (jobVertex.isInputVertex() &amp;&amp; !jobVertex.isStoppable()) {
            <span class="hljs-built_in">this</span>.isStoppable = <span class="hljs-literal">false</span>;
        }

        <span class="hljs-type">VertexParallelismInformation</span> <span class="hljs-variable">parallelismInfo</span> <span class="hljs-operator">=</span>
                parallelismStore.getParallelismInfo(jobVertex.getID());

        <span class="hljs-comment">// create the execution job vertex and attach it to the graph</span>
        <span class="hljs-type">ExecutionJobVertex</span> <span class="hljs-variable">ejv</span> <span class="hljs-operator">=</span>
                executionJobVertexFactory.createExecutionJobVertex(
                        <span class="hljs-built_in">this</span>,
                        jobVertex,
                        parallelismInfo,
                        coordinatorStore,
                        jobManagerJobMetricGroup);

        <span class="hljs-type">ExecutionJobVertex</span> <span class="hljs-variable">previousTask</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.tasks.putIfAbsent(jobVertex.getID(), ejv);
        <span class="hljs-keyword">if</span> (previousTask != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JobException</span>(
                    String.format(
                            <span class="hljs-string">"Encountered two job vertices with ID %s : previous=[%s] / new=[%s]"</span>,
                            jobVertex.getID(), ejv, previousTask));
        }

        <span class="hljs-built_in">this</span>.verticesInCreationOrder.add(ejv);
        <span class="hljs-built_in">this</span>.numJobVerticesTotal++;
    }
}
</code></pre>
<p><strong>initializeJobVertices</strong></p>
<p>åœ¨ DefaultExecutionGraph.initializeJobVertices ä¸­æ˜¯éå†äº†åˆšåˆšæ’å¥½åºçš„ JobVertexï¼Œè·å–äº† ExecutionJobVertex ä¹‹åè°ƒç”¨äº† ExecutionGraph.initializeJobVertex æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬ç›´æ¥æ¥çœ‹ ExecutionGraph.initializeJobVertex çš„é€»è¾‘ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">default</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initializeJobVertex</span><span class="hljs-params">(ExecutionJobVertex ejv, <span class="hljs-type">long</span> createTimestamp)</span>
        <span class="hljs-keyword">throws</span> JobException {
    initializeJobVertex(
            ejv,
            createTimestamp,
            VertexInputInfoComputationUtils.computeVertexInputInfos(
                    ejv, getAllIntermediateResults()::get));
}
</code></pre>
<p>è¿™é‡Œå…ˆæ˜¯è°ƒç”¨äº† VertexInputInfoComputationUtils.computeVertexInputInfos æ–¹æ³•ï¼Œç”Ÿæˆäº† Map&lt;IntermediateDataSetID, JobVertexInputInfo&gt; jobVertexInputInfosã€‚å®ƒè¡¨ç¤ºçš„æ˜¯æ¯ä¸ª ExecutionVertex æ¶ˆè´¹ä¸Šæ¸¸ IntermediateResultPartition çš„èŒƒå›´ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸¤ç§æ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ POINTWISE ï¼ˆç‚¹å¯¹ç‚¹ï¼‰å’Œ ALL_TO_ALLï¼ˆå…¨å¯¹å…¨ï¼‰</p>
<p>åœ¨ POINTWISE æ¨¡å¼ä¸­ï¼Œä¼šæŒ‰ç…§å°½é‡å‡åŒ€åˆ†å¸ƒçš„æ–¹å¼å¤„ç†ã€‚</p>
<ul>
<li>
<p>ä¾‹å¦‚ä¸Šæ¸¸å¹¶å‘åº¦æ˜¯4ï¼Œä¸‹æ¸¸å¹¶å‘åº¦æ˜¯2æ—¶ï¼Œé‚£ä¹ˆå‰ä¸¤ä¸ª IntermediateResultPartition å°±ä¼šè¢«ç¬¬ä¸€ä¸ª ExecutionVertex æ¶ˆè´¹ï¼Œåä¸¤ä¸ª IntermediateResultPartition å°±ä¼šè¢«ç¬¬äºŒä¸ª ExecutionVertex æ¶ˆè´¹ã€‚</p>
</li>
<li>
<p>å¦‚æœä¸Šæ¸¸å¹¶å‘åº¦æ˜¯2ï¼Œä¸‹æ¸¸æ˜¯3æ—¶ï¼Œé‚£ä¹ˆä¸‹æ¸¸å‰ä¸¤ä¸ª IntermediateResultPartition ä¼šè¢«ç¬¬ä¸€ä¸ª ExecutionVertex æ¶ˆè´¹ï¼Œç¬¬ä¸‰ä¸ª IntermediateResultPartition åˆ™ä¼šè¢«ç¬¬äºŒä¸ª ExecutionVertex æ¶ˆè´¹ã€‚</p>
</li>
</ul>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> JobVertexInputInfo <span class="hljs-title function_">computeVertexInputInfoForPointwise</span><span class="hljs-params">(
        <span class="hljs-type">int</span> sourceCount,
        <span class="hljs-type">int</span> targetCount,
        Function&lt;Integer, Integer&gt; numOfSubpartitionsRetriever,
        <span class="hljs-type">boolean</span> isDynamicGraph)</span> {

    <span class="hljs-keyword">final</span> List&lt;ExecutionVertexInputInfo&gt; executionVertexInputInfos = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

    <span class="hljs-keyword">if</span> (sourceCount &gt;= targetCount) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; index &lt; targetCount; index++) {

            <span class="hljs-type">int</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> index * sourceCount / targetCount;
            <span class="hljs-type">int</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> (index + <span class="hljs-number">1</span>) * sourceCount / targetCount;

            <span class="hljs-type">IndexRange</span> <span class="hljs-variable">partitionRange</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndexRange</span>(start, end - <span class="hljs-number">1</span>);
            <span class="hljs-type">IndexRange</span> <span class="hljs-variable">subpartitionRange</span> <span class="hljs-operator">=</span>
                    computeConsumedSubpartitionRange(
                            index,
                            <span class="hljs-number">1</span>,
                            () -&gt; numOfSubpartitionsRetriever.apply(start),
                            isDynamicGraph,
                            <span class="hljs-literal">false</span>,
                            <span class="hljs-literal">false</span>);
            executionVertexInputInfos.add(
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionVertexInputInfo</span>(index, partitionRange, subpartitionRange));
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">partitionNum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; partitionNum &lt; sourceCount; partitionNum++) {

            <span class="hljs-type">int</span> <span class="hljs-variable">start</span> <span class="hljs-operator">=</span> (partitionNum * targetCount + sourceCount - <span class="hljs-number">1</span>) / sourceCount;
            <span class="hljs-type">int</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> ((partitionNum + <span class="hljs-number">1</span>) * targetCount + sourceCount - <span class="hljs-number">1</span>) / sourceCount;
            <span class="hljs-type">int</span> <span class="hljs-variable">numConsumers</span> <span class="hljs-operator">=</span> end - start;

            <span class="hljs-type">IndexRange</span> <span class="hljs-variable">partitionRange</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndexRange</span>(partitionNum, partitionNum);
            <span class="hljs-comment">// Variable used in lambda expression should be final or effectively final</span>
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">finalPartitionNum</span> <span class="hljs-operator">=</span> partitionNum;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start; i &lt; end; i++) {
                <span class="hljs-type">IndexRange</span> <span class="hljs-variable">subpartitionRange</span> <span class="hljs-operator">=</span>
                        computeConsumedSubpartitionRange(
                                i,
                                numConsumers,
                                () -&gt; numOfSubpartitionsRetriever.apply(finalPartitionNum),
                                isDynamicGraph,
                                <span class="hljs-literal">false</span>,
                                <span class="hljs-literal">false</span>);
                executionVertexInputInfos.add(
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionVertexInputInfo</span>(i, partitionRange, subpartitionRange));
            }
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JobVertexInputInfo</span>(executionVertexInputInfos);
}
</code></pre>
<p>åœ¨ ALL_TO_ALL æ¨¡å¼ä¸­ï¼Œæ¯ä¸ªä¸‹æ¸¸éƒ½ä¼šæ¶ˆè´¹æ‰€æœ‰ä¸Šæ¸¸çš„æ•°æ®ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> JobVertexInputInfo <span class="hljs-title function_">computeVertexInputInfoForAllToAll</span><span class="hljs-params">(
        <span class="hljs-type">int</span> sourceCount,
        <span class="hljs-type">int</span> targetCount,
        Function&lt;Integer, Integer&gt; numOfSubpartitionsRetriever,
        <span class="hljs-type">boolean</span> isDynamicGraph,
        <span class="hljs-type">boolean</span> isBroadcast,
        <span class="hljs-type">boolean</span> isSingleSubpartitionContainsAllData)</span> {
    <span class="hljs-keyword">final</span> List&lt;ExecutionVertexInputInfo&gt; executionVertexInputInfos = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-type">IndexRange</span> <span class="hljs-variable">partitionRange</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IndexRange</span>(<span class="hljs-number">0</span>, sourceCount - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; targetCount; ++i) {
        <span class="hljs-type">IndexRange</span> <span class="hljs-variable">subpartitionRange</span> <span class="hljs-operator">=</span>
                computeConsumedSubpartitionRange(
                        i,
                        targetCount,
                        () -&gt; numOfSubpartitionsRetriever.apply(<span class="hljs-number">0</span>),
                        isDynamicGraph,
                        isBroadcast,
                        isSingleSubpartitionContainsAllData);
        executionVertexInputInfos.add(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionVertexInputInfo</span>(i, partitionRange, subpartitionRange));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JobVertexInputInfo</span>(executionVertexInputInfos);
}
</code></pre>
<p>ç”Ÿæˆå¥½äº† jobVertexInputInfos ä¹‹åï¼Œæˆ‘ä»¬å†å›åˆ° DefaultExecutionGraph.initializeJobVertex æ–¹æ³•ä¸­ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initializeJobVertex</span><span class="hljs-params">(
        ExecutionJobVertex ejv,
        <span class="hljs-type">long</span> createTimestamp,
        Map&lt;IntermediateDataSetID, JobVertexInputInfo&gt; jobVertexInputInfos)</span>
        <span class="hljs-keyword">throws</span> JobException {

    checkNotNull(ejv);
    checkNotNull(jobVertexInputInfos);

    jobVertexInputInfos.forEach(
            (resultId, info) -&gt;
                    <span class="hljs-built_in">this</span>.vertexInputInfoStore.put(ejv.getJobVertexId(), resultId, info));

    ejv.initialize(
            executionHistorySizeLimit,
            rpcTimeout,
            createTimestamp,
            <span class="hljs-built_in">this</span>.initialAttemptCounts.getAttemptCounts(ejv.getJobVertexId()),
            executionPlanSchedulingContext);

    ejv.connectToPredecessors(<span class="hljs-built_in">this</span>.intermediateResults);

    <span class="hljs-keyword">for</span> (IntermediateResult res : ejv.getProducedDataSets()) {
        <span class="hljs-type">IntermediateResult</span> <span class="hljs-variable">previousDataSet</span> <span class="hljs-operator">=</span>
                <span class="hljs-built_in">this</span>.intermediateResults.putIfAbsent(res.getId(), res);
        <span class="hljs-keyword">if</span> (previousDataSet != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JobException</span>(
                    String.format(
                            <span class="hljs-string">"Encountered two intermediate data set with ID %s : previous=[%s] / new=[%s]"</span>,
                            res.getId(), res, previousDataSet));
        }
    }

    registerExecutionVerticesAndResultPartitionsFor(ejv);

    <span class="hljs-comment">// enrich network memory.</span>
    <span class="hljs-type">SlotSharingGroup</span> <span class="hljs-variable">slotSharingGroup</span> <span class="hljs-operator">=</span> ejv.getSlotSharingGroup();
    <span class="hljs-keyword">if</span> (areJobVerticesAllInitialized(slotSharingGroup)) {
        SsgNetworkMemoryCalculationUtils.enrichNetworkMemory(
                slotSharingGroup, <span class="hljs-built_in">this</span>::getJobVertex, shuffleMaster);
    }
}
</code></pre>
<p>é¦–å…ˆæ¥çœ‹ ExecutionJobVertex.initialize æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•ä¸»è¦æ˜¯ç”Ÿæˆ IntermediateResult å’Œ ExecutionVertexã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initialize</span><span class="hljs-params">(
        <span class="hljs-type">int</span> executionHistorySizeLimit,
        Duration timeout,
        <span class="hljs-type">long</span> createTimestamp,
        SubtaskAttemptNumberStore initialAttemptCounts,
        ExecutionPlanSchedulingContext executionPlanSchedulingContext)</span>
        <span class="hljs-keyword">throws</span> JobException {

    checkState(parallelismInfo.getParallelism() &gt; <span class="hljs-number">0</span>);
    checkState(!isInitialized());

    <span class="hljs-built_in">this</span>.taskVertices = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionVertex</span>[parallelismInfo.getParallelism()];

    <span class="hljs-built_in">this</span>.inputs = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(jobVertex.getInputs().size());

    <span class="hljs-comment">// create the intermediate results</span>
    <span class="hljs-built_in">this</span>.producedDataSets =
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntermediateResult</span>[jobVertex.getNumberOfProducedIntermediateDataSets()];

    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; jobVertex.getProducedDataSets().size(); i++) {
        <span class="hljs-keyword">final</span> <span class="hljs-type">IntermediateDataSet</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jobVertex.getProducedDataSets().get(i);

        <span class="hljs-built_in">this</span>.producedDataSets[i] =
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntermediateResult</span>(
                        result,
                        <span class="hljs-built_in">this</span>,
                        <span class="hljs-built_in">this</span>.parallelismInfo.getParallelism(),
                        result.getResultType(),
                        executionPlanSchedulingContext);
    }

    <span class="hljs-comment">// create all task vertices</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">this</span>.parallelismInfo.getParallelism(); i++) {
        <span class="hljs-type">ExecutionVertex</span> <span class="hljs-variable">vertex</span> <span class="hljs-operator">=</span>
                createExecutionVertex(
                        <span class="hljs-built_in">this</span>,
                        i,
                        producedDataSets,
                        timeout,
                        createTimestamp,
                        executionHistorySizeLimit,
                        initialAttemptCounts.getAttemptCount(i));

        <span class="hljs-built_in">this</span>.taskVertices[i] = vertex;
    }

    <span class="hljs-comment">// sanity check for the double referencing between intermediate result partitions and</span>
    <span class="hljs-comment">// execution vertices</span>
    <span class="hljs-keyword">for</span> (IntermediateResult ir : <span class="hljs-built_in">this</span>.producedDataSets) {
        <span class="hljs-keyword">if</span> (ir.getNumberOfAssignedPartitions() != <span class="hljs-built_in">this</span>.parallelismInfo.getParallelism()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(
                    <span class="hljs-string">"The intermediate result's partitions were not correctly assigned."</span>);
        }
    }

    <span class="hljs-comment">// set up the input splits, if the vertex has any</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
        InputSplitSource&lt;InputSplit&gt; splitSource =
                (InputSplitSource&lt;InputSplit&gt;) jobVertex.getInputSplitSource();

        <span class="hljs-keyword">if</span> (splitSource != <span class="hljs-literal">null</span>) {
            <span class="hljs-type">Thread</span> <span class="hljs-variable">currentThread</span> <span class="hljs-operator">=</span> Thread.currentThread();
            <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">oldContextClassLoader</span> <span class="hljs-operator">=</span> currentThread.getContextClassLoader();
            currentThread.setContextClassLoader(graph.getUserClassLoader());
            <span class="hljs-keyword">try</span> {
                inputSplits =
                        splitSource.createInputSplits(<span class="hljs-built_in">this</span>.parallelismInfo.getParallelism());

                <span class="hljs-keyword">if</span> (inputSplits != <span class="hljs-literal">null</span>) {
                    splitAssigner = splitSource.getInputSplitAssigner(inputSplits);
                }
            } <span class="hljs-keyword">finally</span> {
                currentThread.setContextClassLoader(oldContextClassLoader);
            }
        } <span class="hljs-keyword">else</span> {
            inputSplits = <span class="hljs-literal">null</span>;
        }
    } <span class="hljs-keyword">catch</span> (Throwable t) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JobException</span>(
                <span class="hljs-string">"Creating the input splits caused an error: "</span> + t.getMessage(), t);
    }
}
</code></pre>
<p>åœ¨åˆ›å»º ExecutionVertex æ—¶ï¼Œä¼šåˆ›å»º IntermediateResultPartition å’Œ Executionï¼Œåˆ›å»º Execution æ—¶ï¼Œä¼šè®¾ç½® attemptNumberï¼Œè¿™ä¸ªå€¼é»˜è®¤æ˜¯0ï¼Œå¦‚æœ ExecutionVertex æ˜¯é‡æ–°è°ƒåº¦çš„ï¼Œé‚£ä¹ˆ attemptNumber ä¼šè‡ªå¢åŠ 1ã€‚</p>
<p>ExecutionJobVertex.connectToPredecessors æ–¹æ³•ä¸»è¦æ˜¯ç”Ÿæˆ ExecutionVertex ä¸ IntermediateResultPartition çš„å…³è”å…³ç³»ã€‚è¿™é‡Œè®¾ç½®å…³è”å…³ç³»ä¹Ÿåˆ†æˆäº†ç‚¹å¯¹ç‚¹å’Œå…¨å¯¹å…¨ä¸¤ç§æ¨¡å¼å¤„ç†ï¼Œç‚¹å¯¹ç‚¹æ¨¡å¼éœ€è¦è®¡ç®— ExecutionVertex å¯¹åº”çš„ IntermediateResultPartition index çš„èŒƒå›´ã€‚ä¸¤ç§æ¨¡å¼æœ€ç»ˆéƒ½è°ƒç”¨äº† connectInternal æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/** Connect all execution vertices to all partitions. */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connectInternal</span><span class="hljs-params">(
        List&lt;ExecutionVertex&gt; taskVertices,
        List&lt;IntermediateResultPartition&gt; partitions,
        ResultPartitionType resultPartitionType,
        EdgeManager edgeManager)</span> {
    checkState(!taskVertices.isEmpty());
    checkState(!partitions.isEmpty());

    <span class="hljs-type">ConsumedPartitionGroup</span> <span class="hljs-variable">consumedPartitionGroup</span> <span class="hljs-operator">=</span>
            createAndRegisterConsumedPartitionGroupToEdgeManager(
                    taskVertices.size(), partitions, resultPartitionType, edgeManager);
    <span class="hljs-keyword">for</span> (ExecutionVertex ev : taskVertices) {
        ev.addConsumedPartitionGroup(consumedPartitionGroup);
    }

    List&lt;ExecutionVertexID&gt; consumerVertices =
            taskVertices.stream().map(ExecutionVertex::getID).collect(Collectors.toList());
    <span class="hljs-type">ConsumerVertexGroup</span> <span class="hljs-variable">consumerVertexGroup</span> <span class="hljs-operator">=</span>
            ConsumerVertexGroup.fromMultipleVertices(consumerVertices, resultPartitionType);
    <span class="hljs-keyword">for</span> (IntermediateResultPartition partition : partitions) {
        partition.addConsumers(consumerVertexGroup);
    }

    consumedPartitionGroup.setConsumerVertexGroup(consumerVertexGroup);
    consumerVertexGroup.setConsumedPartitionGroup(consumedPartitionGroup);
}
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•ä¸­ ev.addConsumedPartitionGroup(consumedPartitionGroup); è´Ÿè´£å°† ExecutionVertex åˆ° IntermediateResultPartition çš„å…³è”å…³ç³»ä¿å­˜åœ¨ EdgeManager.vertexConsumedPartitions ä¸­ã€‚</p>
<p>è€Œ partition.addConsumers(consumerVertexGroup); åˆ™è´Ÿè´£å°† IntermediateResultPartition åˆ° ExecutionVertex çš„å…³ç³»ä¿å­˜åœ¨ EdgeManager.partitionConsumers ä¸­ã€‚</p>
<h3 data-id="heading-4">æ€»ç»“</h3>
<p>é€šè¿‡æœ¬æ–‡ï¼Œæˆ‘ä»¬äº†è§£äº† Flink æ˜¯å¦‚ä½•å°† JobGraph è½¬æ¢æˆ ExecutionGraph çš„ã€‚å…¶ä¸­æ¶‰åŠåˆ°çš„ä¸€äº›æ ¸å¿ƒæ¦‚å¿µåç§°æ¯”è¾ƒç±»ä¼¼ï¼Œå»ºè®®è®¤çœŸå­¦ä¹ å’Œç†è§£é€å½»ä¹‹åå†ç ”ç©¶å…¶ç”Ÿæˆæ–¹æ³•å’Œå¯¹åº”å…³ç³»ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©å‰æ–‡ä¸­ ExecutionGraph ç¤ºæ„å›¾è¾…åŠ©å­¦ä¹ ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Antrl4 å…¥é—¨ â€”â€” ä½¿ç”¨Antrl4å®ç°ä¸€ä¸ªè¡¨è¾¾å¼è®¡ç®—å™¨]]></title>    <link>https://juejin.cn/post/7585476892976447522</link>    <guid>https://juejin.cn/post/7585476892976447522</guid>    <pubDate>2025-12-20T14:21:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585476892976447522" data-draft-id="7581210455827857444" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Antrl4 å…¥é—¨ â€”â€” ä½¿ç”¨Antrl4å®ç°ä¸€ä¸ªè¡¨è¾¾å¼è®¡ç®—å™¨"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-20T14:21:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çµé­‚çŒæ‰‹"/> <meta itemprop="url" content="https://juejin.cn/user/2700056289643895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Antrl4 å…¥é—¨ â€”â€” ä½¿ç”¨Antrl4å®ç°ä¸€ä¸ªè¡¨è¾¾å¼è®¡ç®—å™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2700056289643895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çµé­‚çŒæ‰‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T14:21:21.000Z" title="Sat Dec 20 2025 14:21:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»18åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å¼•è¨€</h2>
<p>åœ¨ç¼–è¯‘åŸç†ä¸­ï¼Œâ€œè§£æâ€æ˜¯å°†æ–‡æœ¬è½¬åŒ–ä¸ºè®¡ç®—æœºå¯ç†è§£ç»“æ„çš„æ ¸å¿ƒæ­¥éª¤ï¼Œä¸»è¦åˆ†ä¸ºä¸¤æ­¥ï¼šè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æã€‚æˆ‘ä»¬ç”¨æœ€å¸¸è§çš„å››åˆ™è¿ç®—â€œ(12+3)<em>4-5</em>â€ï¼Œå°±èƒ½ç›´è§‚ç†è§£è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<p><strong>1. è¯æ³•åˆ†æï¼š</strong>
å°±åƒæˆ‘ä»¬è¯»å¥å­å…ˆæ‹†å‡ºè¯è¯­ï¼Œè¯æ³•åˆ†æä¼šæŠŠè¾“å…¥æ–‡æœ¬æ‹†æˆä¸€ä¸ªä¸ªâ€œè¯æ³•å•å…ƒâ€ï¼ˆtokenï¼‰ï¼Œå‰”é™¤ç©ºæ ¼ã€æ¢è¡Œç­‰æ— å…³å†…å®¹ã€‚æˆ‘ä»¬å°†ä¾‹å­æ›¿æ¢ä¸ºæ›´è´´è¿‘å®é™…çš„å¸¦æ‹¬å·è¡¨è¾¾å¼â€œ(12+3)<em>4-5â€ï¼Œæœ€ç»ˆä¼šæ‹†å‡º 9 ä¸ª Tokenï¼š<strong>å·¦æ‹¬å·(</strong> ã€<strong>æ•°å­—1</strong> <strong>2</strong>ã€<strong>åŠ å·+</strong> ã€<strong>æ•°å­—</strong> <strong>3</strong>ã€<strong>å³æ‹¬å·)</strong> ã€<strong>ä¹˜å·</strong></em> ã€<strong>æ•°å­—</strong> <strong>4</strong>ã€<strong>å‡å·-</strong>ã€<strong>æ•°å­—5</strong>ï¼ŒåŒæ—¶æ ‡è®°æ¯ä¸ª Token çš„ç±»å‹ï¼ˆæ‹¬å·/æ•°å­—/è¿ç®—ç¬¦ï¼‰ã€‚</p>
<p><strong>2. è¯­æ³•åˆ†æï¼š</strong>
åŸºäºè¯æ³•åˆ†æå¾—åˆ°çš„ Token åºåˆ—ï¼ŒæŒ‰ç…§è¯­è¨€è§„åˆ™ï¼ˆå››åˆ™è¿ç®—ä¼˜å…ˆçº§ã€æ‹¬å·ä¼˜å…ˆçº§æœ€é«˜ï¼‰æ„å»ºç»“æ„åŒ–çš„â€œæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰â€ã€‚å¯¹â€œ(12+3)*4-5â€ï¼Œè¯­æ³•åˆ†æä¼šå…ˆè¯†åˆ«å‡ºæ‹¬å·å†…çš„â€œ12+3â€æ˜¯ä¸€ä¸ªå­è¡¨è¾¾å¼ï¼Œå†å°†å…¶ç»“æœä¸â€œ4â€è¿›è¡Œä¹˜æ³•è¿ç®—ï¼Œæœ€åå‡å»â€œ5â€ï¼Œæ˜ç¡®è¿ç®—é¡ºåºä¸ºâ€œ((12+3)*4)-5â€ã€‚å¯¹åº”çš„æŠ½è±¡è¯­æ³•æ ‘å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graphÂ TD  
A[å‡å·]Â --&gt;Â B[ä¹˜å·]  
AÂ --&gt;Â C[5]  
BÂ --&gt;Â D[åŠ å·]  
BÂ --&gt;Â E[4]  
DÂ --&gt;Â F[å·¦æ‹¬å·]  
DÂ --&gt;Â G[12]  
DÂ --&gt;Â H[3]  
DÂ --&gt;Â I[å³æ‹¬å·]
</code></pre>
<p>å¦‚æœæˆ‘ä»¬æ‰‹åŠ¨å®ç°è¯æ³•åˆ†æå™¨å’Œè¯­æ³•åˆ†æå™¨ï¼Œç»†èŠ‚è¾ƒå¤šï¼Œå¤æ‚åº¦è¾ƒé«˜ï¼Œè€ŒANTLR4åˆ™å¯ä»¥å¸®æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ â€”â€” å®ƒä¸“é—¨è´Ÿè´£è‡ªåŠ¨å®Œæˆâ€œè¯æ³•åˆ†æâ€å’Œâ€œè¯­æ³•åˆ†æâ€ç¯èŠ‚ã€‚</p>
<p>ç®€å•è¯´ï¼Œä½ åªéœ€ç”¨ANTLR4å®šä¹‰å¥½ç›®æ ‡è¯­è¨€çš„è¯­æ³•è§„åˆ™ï¼ˆæ¯”å¦‚å››åˆ™è¿ç®—çš„æ•°å­—ã€è¿ç®—ç¬¦ã€ä¼˜å…ˆçº§è§„åˆ™ï¼‰ï¼Œå®ƒå°±èƒ½è‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„è¯æ³•åˆ†æå™¨å’Œè¯­æ³•åˆ†æå™¨ï¼Œè¿˜èƒ½ç›´æ¥è¾“å‡ºASTï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™è§£æé€»è¾‘ã€‚å¹¶æä¾›listenerå’Œvistorä¸¤ç§æ¨¡å¼ï¼Œéå†è¯­æ³•æ ‘ï¼Œå¸®åŠ©ä½ å®Œæˆå‰©ä½™æµç¨‹ã€‚å‡­å€Ÿå¼ºå¤§çš„è§£æèƒ½åŠ›ï¼ŒANTLR4 è¢«å¹¿æ³›åº”ç”¨äºå„ç±»å¼€æºæ¡†æ¶ä¸­ï¼Œæ¯”å¦‚ï¼šSpark SQLï¼ˆè§£æ SQL è¯­å¥ï¼‰ã€Hiveï¼ˆå¤„ç† HiveQLï¼‰ï¼Œæ˜¯æ„å»ºè¯­è¨€è§£æç›¸å…³å·¥å…·çš„ä¸»æµé€‰æ‹©ã€‚</p>
<h2 data-id="heading-1">äºŒã€å®šä¹‰è¯æ³•&amp;è¯­æ³•è§„åˆ™è§„åˆ™</h2>
<p>åœ¨ä½¿ç”¨ANTLR4å¸®åŠ©æˆ‘ä»¬è§£æè¡¨è¾¾å¼ï¼Œéœ€è¦å…ˆå‘Šè¯‰ANTLR4è¡¨è¾¾å¼çš„è§„åˆ™ï¼Œè¿™ä¸ªè§„åˆ™å®šä¹‰åœ¨ANTLR4ä¸­æ˜¯ä¸€ä¸ªè¯­æ³•æ–‡ä»¶ï¼Œä»¥.g4ç»“å°¾ã€‚è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸»è¦åŒ…å«è¯æ³•è§„åˆ™å’Œè¯­æ³•è§„åˆ™ï¼Œg4æ–‡ä»¶ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// è¯­æ³•åç§°ï¼ˆéœ€ä¸æ–‡ä»¶åä¸€è‡´ï¼‰
grammar è¯­æ³•åç§°<span class="hljs-comment">;</span>

// 1. è¯æ³•è§„åˆ™ï¼ˆå¤§å†™å­—æ¯å¼€å¤´ï¼‰
è¯æ³•è§„åˆ™1 : åŒ¹é…æ¨¡å¼<span class="hljs-comment">;</span>
è¯æ³•è§„åˆ™2 : åŒ¹é…æ¨¡å¼<span class="hljs-comment">;</span>

// 2. è¯­æ³•è§„åˆ™ï¼ˆå°å†™å­—æ¯å¼€å¤´ï¼‰
è¯­æ³•è§„åˆ™1 : è§„åˆ™ç»„åˆé€»è¾‘<span class="hljs-comment">;</span>
è¯­æ³•è§„åˆ™2 : è§„åˆ™ç»„åˆé€»è¾‘<span class="hljs-comment">;</span>
</code></pre>
<p><strong>æ³¨æ„:</strong> è¯­æ³•åç§°å¿…é¡»ä¸ <code>.g4</code> æ–‡ä»¶åå®Œå…¨ä¸€è‡´ï¼ˆå¦‚è¯­æ³•åä¸º <code>Calc</code>ï¼Œåˆ™æ–‡ä»¶åä¸º <code>Calc.g4</code>ï¼‰ï¼›è¯æ³•è§„åˆ™ä¸è¯­æ³•è§„åˆ™é€šè¿‡é¦–å­—æ¯å¤§å°å†™ä¸¥æ ¼åŒºåˆ†ï¼Œä¸å¯æ··æ·†ã€‚</p>
<p><strong>PS:</strong> ä¹Ÿå¯ä»¥æŠŠè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æçš„æ–‡ä»¶åˆ†å¼€ï¼Œå¦‚æœå®šä¹‰è¾ƒä¸ºå¤æ‚çš„è¡¨è¾¾å¼è§„åˆ™ï¼ˆæ¯”å¦‚SQLè§£æï¼‰ï¼Œå¯ä»¥åˆ†å¼€ç®¡ç†ï¼š</p>
<ol>
<li>è¯æ³•æ–‡ä»¶ï¼šæ–‡ä»¶åæ ¼å¼ä¸º <code>XXXLexer.g4</code>ï¼Œå¼€å¤´éœ€ç”¨ <code>lexer grammar XXXLexer;</code> å£°æ˜ï¼ˆåŒºåˆ«äºç»„åˆè¯­æ³•çš„ <code>grammar XXX;</code>ï¼‰ï¼Œä»…åŒ…å«è¯æ³•è§„åˆ™ï¼ˆå¤§å†™å¼€å¤´ï¼‰ï¼›</li>
<li>è¯­æ³•æ–‡ä»¶ï¼šæ–‡ä»¶åæ ¼å¼ä¸º <code>XXXParser.g4</code>ï¼Œå¼€å¤´éœ€ç”¨ <code>parser grammar XXXParser;</code> å£°æ˜ï¼Œé€šè¿‡ <code>import XXXLexer;</code> å¯¼å…¥å¯¹åº”çš„è¯æ³•æ–‡ä»¶ï¼Œä»…åŒ…å«è¯­æ³•è§„åˆ™ï¼ˆå°å†™å¼€å¤´ï¼‰ï¼›</li>
<li>å‘½åå…³è”ï¼šè¯æ³•æ–‡ä»¶ä¸è¯­æ³•æ–‡ä»¶çš„å‰ç¼€éœ€ä¸€è‡´ï¼ˆå¦‚ <code>CalcLexer.g4</code> å¯¹åº” <code>CalcParser.g4</code>ï¼‰ï¼Œç¡®ä¿å¯¼å…¥æ—¶èƒ½æ­£ç¡®å…³è”ã€‚</li>
</ol>
<p><strong>PS:</strong> ANTLRçš„å…¨ç§°æ˜¯ANother Tool for Language Recognitionï¼ˆå¦ä¸€ç§è¯­è¨€è¯†åˆ«å·¥å…·ï¼‰ã€‚</p>
<h3 data-id="heading-2">2.1 è¯æ³•è§„åˆ™</h3>
<p>è¯æ³•è§„åˆ™çš„æ ¸å¿ƒä½œç”¨æ˜¯å®šä¹‰â€œä»€ä¹ˆæ˜¯åˆæ³•çš„ Tokenâ€ï¼Œå¯¹åº”æˆ‘ä»¬ä¸Šä¸€ç« æåˆ°çš„â€œè¯æ³•åˆ†æâ€ç¯èŠ‚ã€‚å¯¹äºå››åˆ™è¿ç®—ï¼Œéœ€è¦è¯†åˆ«çš„ Token åŒ…æ‹¬ï¼šå·¦æ‹¬å· <code>(</code>ã€å³æ‹¬å· <code>)</code>ã€è¿ç®—ç¬¦ï¼ˆ<code>+</code>ã€<code>-</code>ã€<code>*</code>ã€<code>/</code>ï¼‰ã€æ•°å­—ï¼ˆæ•´æ•°ï¼Œå¦‚ 12ã€3ï¼‰ã€‚å®ƒçš„åŸºæœ¬ç»„æˆä¸ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">è§„åˆ™å : åŒ¹é…æ¨¡å¼ <span class="hljs-section">[-&gt; åŠ¨ä½œ]</span><span class="hljs-comment">; // ä¸­æ‹¬å·è¡¨ç¤ºåŠ¨ä½œå¯é€‰</span>
</code></pre>
<ul>
<li><strong>è§„åˆ™åï¼š</strong> é¦–å­—æ¯å¿…é¡»å¤§å†™ï¼Œæ¨èé‡‡ç”¨â€œå…¨å¤§å†™+ä¸‹åˆ’çº¿åˆ†éš”â€çš„è¯­ä¹‰åŒ–å‘½åï¼Œæ¯”å¦‚<code>INT</code>ï¼Œç¦æ­¢ä½¿ç”¨ ANTLR4 å…³é”®å­—ï¼ˆå¦‚ <code>grammar</code>ã€<code>mode</code>ï¼‰ï¼›</li>
<li><strong>åŒ¹é…æ¨¡å¼:</strong> åŒ¹é…æ¨¡å¼é‡‡ç”¨<strong>æ­£åˆ™è¡¨è¾¾å¼çš„æ ¸å¿ƒå­é›†</strong>è¯­æ³•ï¼ˆå¹¶éå®Œæ•´æ ‡å‡†æ­£åˆ™ï¼‰ï¼Œç”¨äºæè¿° Token çš„æ–‡æœ¬æ ¼å¼ï¼Œè¶³ä»¥è¦†ç›–ç»å¤§å¤šæ•°è¯æ³•åˆ†æåœºæ™¯ï¼Œä½†éœ€æ³¨æ„ï¼šæ ‡å‡†æ­£åˆ™ä¸­çš„éƒ¨åˆ†å¤æ‚ç‰¹æ€§ï¼ˆå¦‚ \dã€\wã€åå‘å¼•ç”¨ã€é›¶å®½æ–­è¨€ç­‰ï¼‰ä¸è¢«æ”¯æŒã€‚</li>
<li><strong>å¯é€‰åŠ¨ä½œé…ç½®:</strong> åŠ¨ä½œé€šè¿‡ <code>-&gt;</code> å¼•å¯¼ï¼Œç”¨äºå¯¹åŒ¹é…åˆ°çš„Tokenæ‰§è¡Œç‰¹å®šæ“ä½œï¼Œå…¥é—¨å¸¸ç”¨çš„åªæœ‰æ˜¯ <code>skip</code>ï¼ˆè·³è¿‡æ— å…³å†…å®¹ï¼‰ã€‚æ¯”å¦‚<code>[ \t\r\n]+ -&gt; skip;</code>ï¼Œå³å¿½ç•¥ç©ºæ ¼ã€æ¢è¡Œã€åˆ¶è¡¨ç¬¦ã€‚å…¶ä»–åœ¨å…¥é—¨ä¸­ä¸åšä»‹ç»ã€‚</li>
<li><strong>ä¼˜å…ˆçº§è§„åˆ™</strong>ï¼šè§„åˆ™å®šä¹‰é¡ºåºå³åŒ¹é…ä¼˜å…ˆçº§â€”â€”å…ˆå®šä¹‰çš„è§„åˆ™ä¼˜å…ˆçº§æ›´é«˜ï¼Œä¼˜å…ˆåŒ¹é…ï¼ˆå¦‚å…³é”®å­—éœ€ä¼˜å…ˆäºæ ‡è¯†ç¬¦å®šä¹‰ï¼Œå¦åˆ™ä¼šè¢«è¯¯è¯†åˆ«ï¼‰ã€‚</li>
</ul>
<p>ä»¥å››åˆ™è¿ç®—+ç®€å•å‡½æ•°ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-antlr4" lang="antlr4">// 1. å‡½æ•°åè§„åˆ™ï¼šå…³é”®å­—ä¼˜å…ˆï¼ŒåŒ¹é…max/minï¼ˆä¸åŒºåˆ†å¤§å°å†™å¯æ”¹ä¸º [Mm][Aa][Xx]ï¼Œæ­¤å¤„ç»Ÿä¸€å¤§å†™ï¼‰
MAX : 'MAX';  // åŒ¹é…MAXå‡½æ•°å
MIN : 'MIN';  // åŒ¹é…MINå‡½æ•°å

// 2. æ‹¬å·ä¸åˆ†éš”ç¬¦è§„åˆ™
LEFT_PAREN  : '(';  // åŒ¹é…å·¦æ‹¬å· (
RIGHT_PAREN : ')';  // åŒ¹é…å³æ‹¬å· )
COMMA       : ',';  // åŒ¹é…å‚æ•°åˆ†éš”ç¬¦ ,

// 3. è¿ç®—ç¬¦è§„åˆ™ï¼šå•ä¸ªå­—ç¬¦ï¼Œç›´æ¥åŒ¹é…
ADD : '+';  // åŠ å·
SUB : '-';  // å‡å·
MUL : '*';  // ä¹˜å·
DIV : '/';  // é™¤å·

// 4. æ•´æ•°è§„åˆ™ï¼šä½¿ç”¨ [0-9]+ åŒ¹é…1ä½åŠä»¥ä¸Šæ•°å­—
INT : [0-9]+;  // å¯åŒ¹é… 1ã€12ã€345 ç­‰æ•´æ•°ï¼Œè´ªå©ªåŒ¹é…ç‰¹æ€§ä¿è¯å®Œæ•´åŒ¹é…

// 5. è·³è¿‡æ— å…³å†…å®¹ï¼šç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ï¼ˆ\tï¼‰ã€å›è½¦ï¼ˆ\rï¼‰ã€æ¢è¡Œï¼ˆ\nï¼‰
WS  : [ \t\r\n]+ -&gt; skip;  // å¤šä¸ªç©ºç™½å­—ç¬¦è¿ç»­å‡ºç°æ—¶ï¼Œä¸€æ¬¡æ€§è·³è¿‡
</code></pre>
<p><strong>PS:</strong> å¦‚æœæ‰€æœ‰è§„åˆ™ï¼Œéƒ½ä¸åŒºåˆ†å¤§å°å†™ï¼Œå¯ä»¥é…ç½®ä¸€ä¸ªå…¨å±€è§„åˆ™</p>
<pre><code class="hljs language-antlr4" lang="antlr4">options {
    caseInsensitive = true;
}
</code></pre>
<h3 data-id="heading-3">2.2 è¯­æ³•è§„åˆ™</h3>
<p>è¯­æ³•è§„åˆ™çš„æ ¸å¿ƒä½œç”¨æ˜¯å®šä¹‰â€œToken å¦‚ä½•ç»„åˆæ‰åˆæ³•â€ï¼Œè¯­æ³•è§„åˆ™åŸºç¡€æ ¼å¼ä¸ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">è§„åˆ™å : è§„åˆ™ä½“åˆ†æ”¯1 | è§„åˆ™ä½“åˆ†æ”¯2 ... <span class="hljs-section">[# å¯é€‰æ ‡ç­¾]</span><span class="hljs-comment">;</span>
</code></pre>
<ul>
<li><strong>è§„åˆ™åï¼š</strong> å°å†™å­—æ¯å¼€å¤´ï¼ˆå¦‚ <code>expr</code>ã€<code>term</code>ï¼‰ï¼Œå»ºè®®ä½¿ç”¨â€œå…¨å°å†™+ä¸‹åˆ’çº¿â€çš„æ–¹å¼å‘½åï¼›</li>
<li><strong>è§„åˆ™ä½“ï¼š</strong> è¯æ³•åå­—ç»„åˆ + æ­£åˆ™çš„åˆ†ç»„ï¼ˆä¹Ÿå°±æ˜¯æ‹¬å·ï¼‰&amp; åŒ¹é…æ¬¡æ•°ï¼ˆå¦‚ <code>*</code>ã€<code>?</code>ï¼‰,å¤šä¸ªåˆ†æ”¯ç”¨ <code>|</code> åˆ†éš”ï¼›</li>
<li><strong>å¯é€‰æ ‡ç­¾ï¼š</strong> ç”¨ <code>#</code> å¼€å¤´ï¼Œç”¨äºåŒºåˆ†åŒä¸€è§„åˆ™çš„ä¸åŒåˆ†æ”¯ï¼ˆä¾¿äºåç»­éå† AST ï¼‰ï¼Œ</li>
<li><strong>è§„åˆ™ä¼˜å…ˆçº§ï¼š</strong> å¯ä»¥æœ‰å¤šä¸ªè§„åˆ™ï¼Œäº’ç›¸å¼•ç”¨ï¼Œè¢«å¼•ç”¨çš„ä¼˜å…ˆçº§æ›´é«˜ã€‚</li>
</ul>
<p>å¥½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å®šä¹‰å››åˆ™è¿ç®—çš„åŠ å‡æ³•ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">expr : <span class="hljs-type">INT</span> (<span class="hljs-keyword">ADD</span> <span class="hljs-operator">|</span> SUB) <span class="hljs-type">INT</span>
</code></pre>
<p>ç­‰ç­‰ï¼Œè¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œè¿™åªèƒ½è¯†åˆ«ä¸¤ä¸ªæ•´æ•°çš„åŠ å‡æ³•ï¼Œé‚£ä¸‰ä¸ªå‘¢ã€å››ä¸ªå‘¢ï¼Ÿï¼å¥½åƒå¯ä»¥è¿™æ ·å®šä¹‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">expr : <span class="hljs-type">INT</span> ((<span class="hljs-keyword">ADD</span> <span class="hljs-operator">|</span> SUB) <span class="hljs-type">INT</span>)<span class="hljs-operator">*</span>
</code></pre>
<p>è¿˜æ˜¯å“ªé‡Œä¸å¯¹ï¼Œå¦‚æœåŠ æ³•å·¦å³ä¸æ­¢æ˜¯æ•´æ•°å‘¢ï¼Œæ¯”å¦‚ <code>MAX(1,2)+3</code>ï¼Œå†æ¯”å¦‚<code>1+2*3</code>ã€‚è¿™é‡Œå¿…é¡»å¼•å…¥é€’å½’ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œéœ€è¦è‡ªå·±å®šä¹‰è‡ªå·±ã€‚</p>
<p>æ¯”å¦‚è¿™æ ·ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">expr</span> : INT
     | <span class="hljs-built_in">expr</span> (ADD | SUB) <span class="hljs-built_in">expr</span>
</code></pre>
<p>é‚£æ€ä¹ˆå®šä¹‰ä¼˜å…ˆçº§å‘¢ï¼Œæ¯”å¦‚æ‹¬å·ä¼˜å…ˆçº§æœ€é«˜æ¯”ä¹˜é™¤æ³•é«˜ï¼Œä¹˜é™¤æ³•æ¯”åŠ å‡æ³•é«˜ â€”â€” åŒä¸€ä¸ªè¯­æ³•è§„åˆ™ä¸‹ï¼Œä¹¦å†™é¡ºåºå°±æ˜¯ä¼˜å…ˆçº§ï¼Œä¹Ÿå°±æ˜¯å‰é¢çš„ä¼˜å…ˆçº§é«˜ã€‚</p>
<p>é‚£ä¹ˆå¸¦æœ‰å‡½æ•°çš„å®Œæ•´çš„è¯­æ³•å®šä¹‰å°±æ˜¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">expr</span> : (MAX | MIN) LEFT_PAREN <span class="hljs-built_in">expr</span> (COMMA <span class="hljs-built_in">expr</span>)* LEFT_PAREN <span class="hljs-comment"># FuncCallExpr</span>
     | INT <span class="hljs-comment"># IntExpr </span>
     | LEFT_PAREN <span class="hljs-built_in">expr</span> RIGHT_PAREN <span class="hljs-comment"># ParenExpr</span>
     | <span class="hljs-built_in">expr</span> (MUL | DIV) <span class="hljs-built_in">expr</span> <span class="hljs-comment"># MulDivExpr</span>
     | <span class="hljs-built_in">expr</span> (ADD | SUB) <span class="hljs-built_in">expr</span> <span class="hljs-comment"># AddSubExpr</span>
     ;
</code></pre>
<h3 data-id="heading-4">2.3 å®Œæ•´é…ç½®æ–‡ä»¶</h3>
<p>æŠŠè¯æ³•å’Œè¯­æ³•æ–‡ä»¶åˆå¹¶åˆ°ä¸€èµ·ï¼Œå°±å¾—åˆ°äº†å®Œæ•´çš„é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-css" lang="css">grammar Calc;

// è¯æ³•è§„åˆ™ï¼ˆæ–°å¢å‡½æ•°åã€é€—å·ï¼‰
MAX         : <span class="hljs-string">'MAX'</span>;  // MAXå‡½æ•°å
MIN         : <span class="hljs-string">'MIN'</span>;  // MINå‡½æ•°å
LEFT_PAREN  : <span class="hljs-string">'('</span>;
RIGHT_PAREN : <span class="hljs-string">')'</span>;
COMMA       : <span class="hljs-string">','</span>;  // å‚æ•°åˆ†éš”ç¬¦
ADD         : <span class="hljs-string">'+'</span>;
SUB         : <span class="hljs-string">'-'</span>;
MUL         : <span class="hljs-string">'*'</span>;
<span class="hljs-selector-tag">DIV</span>         : <span class="hljs-string">'/'</span>;
INT         : [<span class="hljs-number">0</span>-<span class="hljs-number">9</span>]+;
WS          : [ \t\r\n]+ -&gt; skip;

expr : (MAX | MIN) LEFT_PAREN expr (COMMA expr)* RIGHT_PAREN # FuncCallExpr
     | INT # IntExpr 
     | LEFT_PAREN expr RIGHT_PAREN # ParenExpr
     | expr (MUL | DIV) expr # MulDivExpr
     | expr (ADD | SUB) expr # AddSubExpr
     ;
</code></pre>
<h2 data-id="heading-5">ä¸‰ã€æµ‹è¯• &amp; ç”Ÿæˆä»£ç </h2>
<h3 data-id="heading-6">3.1 æµ‹è¯•</h3>
<p>æœ‰äº†é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ideaçš„æ’ä»¶éªŒè¯ã€‚åœ¨ideaçš„æ’ä»¶å¸‚åœºï¼Œæœç´¢antrl4ï¼Œå®‰è£…å³å¯ã€‚å®‰è£…å®Œæˆåï¼Œé€‰ä¸­è¯­æ³•ï¼Œå³é”®Test Ruleã€‚è¾“å…¥è¡¨è¾¾å¼ï¼Œå°±å¯ä»¥çœ‹åˆ°ï¼Œè½¬ä¸ºäº†æŠ½è±¡è¯­æ³•æ ‘ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac4acb926e834b5489c2000306dfd948~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16a2C54yO5omL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766845548&amp;x-signature=hoh75pkz3qIMeNdrZxi7%2FM6VNvQ%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">3.2 ä»£ç ç”Ÿæˆ</h3>
<p>æµ‹è¯•æ²¡æœ‰é—®é¢˜åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”Ÿæˆä»£ç äº†ã€‚</p>
<ol>
<li><strong>é…ç½®ä»£ç ç”Ÿæˆçš„ä½ç½®ï¼š</strong> é€‰æ‹©g4æ–‡ä»¶ï¼Œå³é”®Configuration ANTLRã€‚
<ul>
<li>â€œOutput directory where all output is generatedâ€ --&gt; javaç›®å½•</li>
<li>â€œPackage/namespace for the generated codeâ€ --&gt; åŒ…å</li>
</ul>
</li>
<li><strong>ä»£ç ç”Ÿæˆï¼š</strong> ç‚¹å‡»g4æ–‡ä»¶ï¼Œå³é”®Generate ANTLR Recognitionç”Ÿæˆå³å¯ã€‚</li>
</ol>
<p>è¿™æ ·ä»£ç å°±æ„‰å¿«çš„ç”Ÿæˆäº†ï¼š</p>
<ul>
<li><code>{GrammarName}Lexer.java</code> --&gt; è¯æ³•è§£æå™¨ï¼›</li>
<li><code>{GrammarName}Parser.java</code> --&gt; è¯­æ³•è§£æå™¨ï¼›</li>
<li>ç›‘å¬å™¨ï¼šæä¾›è¢«åŠ¨ç›‘å¬çš„æ–¹å¼éå†è¯­æ³•æ ‘æ–¹æ³•ï¼Œå½“éå†å™¨è¿›å…¥ï¼ˆ<code>enter</code>ï¼‰æˆ–é€€å‡ºï¼ˆ<code>exit</code>ï¼‰æ ‘çš„æŸä¸ªèŠ‚ç‚¹æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨ç›‘å¬å™¨ä¸­å¯¹åº”çš„æ–¹æ³•ï¼ˆå¦‚Â <code>enterIntExpr</code>ã€<code>exitIntExpr</code>ï¼‰ã€‚
<ul>
<li>æ¥å£ï¼š<code>{GrammarName}Listener.java</code></li>
<li>é»˜è®¤å®ç°ï¼š<code>{GrammarName}BaseListener.java</code></li>
</ul>
</li>
<li>è®¿é—®è€…ï¼šæä¾›ä¸»åŠ¨éå†è¯­æ³•æ ‘çš„æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾å¼è°ƒç”¨Â <code>visit(child)</code>Â æ–¹æ³•è®¿é—®å­èŠ‚ç‚¹ï¼Œå¹¶å¯ä»¥è¿”å›ç»“æœã€‚
<ul>
<li>æ¥å£ï¼š<code>{GrammarName}Visitor.java</code></li>
<li>é»˜è®¤å®ç°ï¼š<code>{GrammarName}BaseVisitor.java</code></li>
</ul>
</li>
<li>å…¶ä»–æ–‡ä»¶ï¼šè¿˜æœ‰äº›<code>.tokens</code>Â æ–‡ä»¶ï¼ˆè®°å½•è¯æ±‡ç¬¦å·çš„æ˜ å°„å…³ç³»ï¼‰å’ŒÂ <code>.interp</code>Â æ–‡ä»¶ï¼ˆç”¨äºè°ƒè¯•ï¼‰ï¼Œé€šå¸¸å¯ä»¥å¿½ç•¥ã€‚</li>
</ul>
<h3 data-id="heading-8">3.3 å¦‚ä½•ä½¿ç”¨</h3>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¢³ç†ä¸‹è¿™äº›ç”Ÿæˆçš„ä»£ç è¯¥å¦‚ä½•ä½¿ç”¨ï¼Œè¿™é‡Œæœ‰ä¸ªåŸºæœ¬èŒƒå¼ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ„é€ å­—ç¬¦æµ</span>
<span class="hljs-type">CharStream</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> CharStreams.fromString(<span class="hljs-string">"1+2*3"</span>);
<span class="hljs-comment">// è¯æ³•è§£æ</span>
<span class="hljs-type">CalcLexer</span> <span class="hljs-variable">lexer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CalcLexer</span>(input);
<span class="hljs-type">CommonTokenStream</span> <span class="hljs-variable">tokens</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonTokenStream</span>(lexer);
<span class="hljs-comment">// è¯­æ³•è§£æï¼Œç”Ÿæˆè¯­æ³•æ ‘</span>
<span class="hljs-type">CalcParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CalcParser</span>(tokens);
<span class="hljs-type">ParseTree</span> <span class="hljs-variable">tree</span> <span class="hljs-operator">=</span> parser.expr();

<span class="hljs-comment">// ä½¿ç”¨listenerã€visitoréå†è¯­æ³•æ ‘</span>
<span class="hljs-comment">// todo ...</span>
</code></pre>
<h4 data-id="heading-9">3.3.1 listeneræ¨¡å¼</h4>
<p>å…ˆçœ‹ä¸‹ç”Ÿæˆçš„listenerçš„ç»§æ‰¿å…³ç³»</p>
<ul>
<li><code>ParseTreeListener</code>ï¼šANTLR4 ä¸­ç”¨äºç›‘å¬è¯­æ³•æ ‘éå†äº‹ä»¶çš„æ ¸å¿ƒæ¥å£ï¼Œå®šä¹‰äº†æœ€åŸºç¡€çš„äº‹ä»¶å›è°ƒã€‚æ³¨æ„ï¼Œè¿™ä¸ªä¸æ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ã€‚
<ul>
<li><code>CalcListener</code>ï¼šæ ¹æ®ä½ çš„è¯­æ³•ï¼Œç”Ÿæˆçš„æ¥å£ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆç±»ä¼¼<code>enter/exitInt</code>ã€<code>enter/exitMaxFunc</code>è¿™æ ·çš„æ–¹æ³•ã€‚
<ul>
<li><code>CalcBaseListener</code>ï¼š<code>CalcListener</code>çš„åŸºç¡€å®ç°ç±»ï¼Œå…¸å‹çš„é€‚é…å™¨æ¨¡å¼ï¼Œå®ç°äº†<code>CalcListener</code>æ¥å£æ‰€æœ‰æ–¹æ³•ï¼Œä½†ä»€ä¹ˆéƒ½æ²¡åšã€‚è¿™æ ·ä½ å†™ä¸€ä¸ªç»§æ‰¿<code>CalcBaseListener</code>çš„æ–¹æ³•æ—¶ï¼Œå°±å¯ä»¥æŒ‰éœ€å®ç°ï¼Œè€Œä¸æ˜¯å®ç°æ‰€æœ‰æ¥å£ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code>ParseTreeListener</code>æ¥å£æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ParseTreeListener</span> { 
    <span class="hljs-comment">// è¿›å…¥ä»»æ„è§„åˆ™èŠ‚ç‚¹æ—¶è§¦å‘ </span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">enterEveryRule</span><span class="hljs-params">(ParserRuleContext ctx)</span>; 
    <span class="hljs-comment">// é€€å‡ºä»»æ„è§„åˆ™èŠ‚ç‚¹æ—¶è§¦å‘ </span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitEveryRule</span><span class="hljs-params">(ParserRuleContext ctx)</span>; 
    <span class="hljs-comment">// è®¿é—®ç»ˆç«¯èŠ‚ç‚¹ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰æ—¶è§¦å‘ </span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visitTerminal</span><span class="hljs-params">(TerminalNode node)</span>; 
    <span class="hljs-comment">// è®¿é—®é”™è¯¯èŠ‚ç‚¹ï¼ˆè¯­æ³•é”™è¯¯èŠ‚ç‚¹ï¼‰æ—¶è§¦å‘ </span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">visitErrorNode</span><span class="hljs-params">(ErrorNode node)</span>; 
}
</code></pre>
<p>è€Œ<code>CalcListener</code>æ¥å£åˆ™æ˜¯enter/exitæˆ‘ä»¬è‡ªå®šä¹‰çš„è¯­æ³•è§„åˆ™çš„æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Enter a parse tree produced by the {<span class="hljs-doctag">@code</span> MulDivExpr}
 * labeled alternative in {<span class="hljs-doctag">@link</span> calcParser#expr}.
 * <span class="hljs-doctag">@param</span> ctx the parse tree
 */</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">enterMulDivExpr</span><span class="hljs-params">(calcParser.MulDivExprContext ctx)</span>;
<span class="hljs-comment">/**
 * Exit a parse tree produced by the {<span class="hljs-doctag">@code</span> MulDivExpr}
 * labeled alternative in {<span class="hljs-doctag">@link</span> calcParser#expr}.
 * <span class="hljs-doctag">@param</span> ctx the parse tree
 */</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">exitMulDivExpr</span><span class="hljs-params">(calcParser.MulDivExprContext ctx)</span>;

<span class="hljs-comment">// çœç•¥äº†ä¸€äº›å…¶ä»–æ–¹æ³•ã€‚ã€‚ã€‚</span>
</code></pre>
<p>è¿™é‡Œå’±ä»¬ç®€å•çš„åœ¨Listenerä¸­æ‰“å°ä¸€ä¸‹ï¼Œçœ‹ä¸‹éå†é¡ºåºï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TraversalListener</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">calcBaseListener</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-variable">indent</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// ç”¨äºç¼©è¿›æ˜¾ç¤ºå±‚çº§</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enterEveryRule</span><span class="hljs-params">(ParserRuleContext ctx)</span> {
        printWithIndent(<span class="hljs-string">"è¿›å…¥èŠ‚ç‚¹: "</span> + ctx.getClass().getSimpleName());
        indent++;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitEveryRule</span><span class="hljs-params">(ParserRuleContext ctx)</span> {
        indent--;
        printWithIndent(<span class="hljs-string">"é€€å‡ºèŠ‚ç‚¹: "</span> + ctx.getClass().getSimpleName());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">visitTerminal</span><span class="hljs-params">(TerminalNode node)</span> {
        printWithIndent(<span class="hljs-string">"è®¿é—®å¶å­èŠ‚ç‚¹: "</span> + node.getText());
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printWithIndent</span><span class="hljs-params">(String message)</span> {
        System.out.println(StringUtils.repeat(<span class="hljs-string">"-&gt;"</span>, indent) + message);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">expr</span> <span class="hljs-operator">=</span> <span class="hljs-string">"1+2*3-5"</span>;
        System.out.println(<span class="hljs-string">"è¡¨è¾¾å¼: "</span> + expr + <span class="hljs-string">"\néå†é¡ºåº:"</span>);

        <span class="hljs-comment">// è§£æä¸ºæŠ½è±¡è¯­æ³•æ ‘</span>
        <span class="hljs-type">CharStream</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> CharStreams.fromString(expr);
        <span class="hljs-type">calcLexer</span> <span class="hljs-variable">lexer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">calcLexer</span>(input);
        <span class="hljs-type">CommonTokenStream</span> <span class="hljs-variable">tokens</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonTokenStream</span>(lexer);
        <span class="hljs-type">calcParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">calcParser</span>(tokens);
        <span class="hljs-type">ParseTree</span> <span class="hljs-variable">tree</span> <span class="hljs-operator">=</span> parser.expr();
        <span class="hljs-comment">// éå†ç›‘å¬</span>
        ParseTreeWalker.DEFAULT.walk(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TraversalListener</span>(), tree);
    }
}
</code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre><code class="hljs language-rust" lang="rust">è¿›å…¥èŠ‚ç‚¹: AddSubExprContext
<span class="hljs-punctuation">-&gt;</span>è¿›å…¥èŠ‚ç‚¹: AddSubExprContext
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>è¿›å…¥èŠ‚ç‚¹: IntExprContext
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>è®¿é—®å¶å­èŠ‚ç‚¹: <span class="hljs-number">1</span>
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>é€€å‡ºèŠ‚ç‚¹: IntExprContext
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>è®¿é—®å¶å­èŠ‚ç‚¹: +
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>è¿›å…¥èŠ‚ç‚¹: MulDivExprContext
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>è¿›å…¥èŠ‚ç‚¹: IntExprContext
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>è®¿é—®å¶å­èŠ‚ç‚¹: <span class="hljs-number">2</span>
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>é€€å‡ºèŠ‚ç‚¹: IntExprContext
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>è®¿é—®å¶å­èŠ‚ç‚¹: *
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>è¿›å…¥èŠ‚ç‚¹: IntExprContext
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>è®¿é—®å¶å­èŠ‚ç‚¹: <span class="hljs-number">3</span>
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>é€€å‡ºèŠ‚ç‚¹: IntExprContext
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>é€€å‡ºèŠ‚ç‚¹: MulDivExprContext
<span class="hljs-punctuation">-&gt;</span>é€€å‡ºèŠ‚ç‚¹: AddSubExprContext
<span class="hljs-punctuation">-&gt;</span>è®¿é—®å¶å­èŠ‚ç‚¹: -
<span class="hljs-punctuation">-&gt;</span>è¿›å…¥èŠ‚ç‚¹: IntExprContext
<span class="hljs-punctuation">-&gt;</span><span class="hljs-punctuation">-&gt;</span>è®¿é—®å¶å­èŠ‚ç‚¹: <span class="hljs-number">5</span>
<span class="hljs-punctuation">-&gt;</span>é€€å‡ºèŠ‚ç‚¹: IntExprContext
é€€å‡ºèŠ‚ç‚¹: AddSubExprContext
</code></pre>
<p>å¯¹æ¯”æŠ½è±¡è¯­æ³•æ ‘ï¼Œä¸éš¾çœ‹å‡ºï¼ŒæŒ‰ç…§è¿›å…¥èŠ‚ç‚¹çš„é¡ºåºï¼Œæ˜¯æ ¹-&gt;å·¦-&gt;å³çš„æ–¹å¼ï¼Œæ·±åº¦ä¼˜å…ˆéå†ï¼›æŒ‰ç…§å‡ºèŠ‚ç‚¹çš„é¡ºåºï¼Œåˆ™æ˜¯å·¦-&gt;å³-&gt;æ ¹çš„é¡ºåºã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dfdb56d23d241dcb91672828a4d2388~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16a2C54yO5omL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766845548&amp;x-signature=9u84VGUzaemX82um9wEU1G8Ipw8%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-10">3.3.2 visitoræ¨¡å¼</h4>
<p>å…ˆçœ‹ä¸‹visitoræ¨¡å¼çš„ç»§æ‰¿å…³ç³»ï¼š</p>
<ul>
<li><code>ParseTreeVisitor&lt;T&gt;</code>: åŸºç¡€æ¥å£ï¼Œç±»ä¼¼<code>ParseTreeListener</code>å®šä¹‰äº†æ¯”å¦‚<code>visit</code>ã€<code>visitChildren</code>è¿™ç§åŸºç¡€æ–¹æ³•ã€‚
<ul>
<li><code>CalcVisitor&lt;T&gt;</code>:è‡ªåŠ¨ç”Ÿæˆçš„æ¥å£ï¼ŒåŒ…å«<code>visitXXX</code>è¿™æ ·æˆ‘ä»¬è‡ªå®šä¹‰çš„è¯­æ³•çš„æ¥å£æ–¹æ³•ã€‚</li>
<li><code>AbstractParseTreeVisitor&lt;T&gt;</code>æŠ½è±¡ç±»ï¼Œ<code>ParseTreeVisitor</code>çš„æœ€åŸºæœ¬å®ç°ã€‚
<ul>
<li><code>CalcBaseVisitor&lt;T&gt;</code>: è‡ªåŠ¨ç”Ÿæˆçš„ç»§æ‰¿è‡ª<code>AbstractParseTreeVisitor&lt;T&gt;</code>,å®ç°äº†<code>CalcVisitor&lt;T&gt;</code>çš„æŠ½è±¡ç±»ï¼Œä¹Ÿæ˜¯å…¸å‹çš„é€‚é…å™¨ï¼Œå†…éƒ¨çš„æ‰€æœ‰å®ç°éƒ½æ˜¯<code>return visitChildren(ctx);</code>ã€‚ä¹Ÿå°±æ˜¯ç»§ç»­å‘ä¸‹éå†ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>ä»‹ç»ä¸‹æœ€åŸºç¡€çš„<code>ParseTreeVisitor&lt;T&gt;</code></p>
<ul>
<li>æ³›å‹Tï¼Œæ˜¯æ¯ä¸ªè®¿é—®æ–¹æ³•ï¼Œéœ€è¦è¿”å›çš„ç±»å‹ã€‚</li>
<li><code>visit(ParseTree tree)</code>ï¼šå¯åŠ¨å¯¹æ•´ä¸ªè¯­æ³•æ ‘çš„éå†ï¼›</li>
<li><code>visitChildren(RuleNode node)</code>ï¼šéå†èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å¹¶è¿”å›æ±‡æ€»ç»“æœï¼›</li>
<li><code>visitTerminal(TerminalNode node)</code>ï¼šè®¿é—®ç»ˆç«¯èŠ‚ç‚¹ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰ï¼›</li>
<li><code>visitErrorNode(ErrorNode node)</code>ï¼šè®¿é—®é”™è¯¯èŠ‚ç‚¹ã€‚</li>
</ul>
<p>ä»–çš„åŸºç¡€å®ç°ç±»<code>AbstractParseTreeVisitor&lt;T&gt;</code>ï¼Œå…¸å‹çš„æ¨¡æ¿æ¨¡å¼ï¼Œä¸»è¦å®ç°äº†åŸºç¡€çš„<code>visit</code>å’Œ<code>visitChildren</code>æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">visit</span><span class="hljs-params">(ParseTree tree)</span> {
    <span class="hljs-comment">//å¯åŠ¨éå†</span>
    <span class="hljs-keyword">return</span> tree.accept(<span class="hljs-built_in">this</span>);
}

<span class="hljs-keyword">public</span> T <span class="hljs-title function_">visitChildren</span><span class="hljs-params">(RuleNode node)</span> {
    <span class="hljs-comment">//éå†æ‰€æœ‰çš„å­èŠ‚ç‚¹</span>
    <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.defaultResult();<span class="hljs-comment">//é»˜è®¤è¿”å›nullï¼Œä¾›å­ç±»å¤å†™ã€‚</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> node.getChildCount();

    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n &amp;&amp; <span class="hljs-built_in">this</span>.shouldVisitNextChild(node, result); ++i) {
        <span class="hljs-type">ParseTree</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> node.getChild(i);
        <span class="hljs-type">T</span> <span class="hljs-variable">childResult</span> <span class="hljs-operator">=</span> c.accept(<span class="hljs-built_in">this</span>);
        result = <span class="hljs-built_in">this</span>.aggregateResult(result, childResult);<span class="hljs-comment">//å¦‚ä½•åˆå¹¶ä¸¤ä¸ªå­èŠ‚ç‚¹çš„å€¼ï¼Œé»˜è®¤è¿”å›åé¢çš„</span>
    }

    <span class="hljs-keyword">return</span> result;
}

<span class="hljs-keyword">protected</span> T <span class="hljs-title function_">defaultResult</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}

<span class="hljs-keyword">protected</span> T <span class="hljs-title function_">aggregateResult</span><span class="hljs-params">(T aggregate, T nextResult)</span> {
    <span class="hljs-keyword">return</span> nextResult;
}
</code></pre>
<p>ä¸Šæ–‡ä¹Ÿè¯´è¿‡äº†ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„<code>CalcBaseVisitor&lt;T&gt;</code>å®ç°çš„æ‰€æœ‰æ–¹æ³•ï¼Œå†…éƒ¨çš„æ‰€æœ‰å®ç°éƒ½æ˜¯<code>return visitChildren(ctx);</code>ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢<code>AbstractParseTreeVisitor&lt;T&gt;</code>çš„æ–¹æ³•ã€‚</p>
<p>å’±ä»¬ä¹Ÿç®€å•å®ç°ä¸€ä¸ªvisitorï¼Œå°±è¾“å…¥æ˜¯ä»€ä¹ˆï¼ŒåŸæ ·è¾“å‡ºå‡ºæ¥ï¼š</p>
<pre><code class="hljs language-java" lang="java">
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">visitTerminal</span><span class="hljs-params">(TerminalNode node)</span> {
    <span class="hljs-keyword">return</span> node.getText();
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">protected</span> String <span class="hljs-title function_">aggregateResult</span><span class="hljs-params">(String aggregate, String nextResult)</span> {
    <span class="hljs-keyword">if</span>(aggregate == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> nextResult;
    <span class="hljs-keyword">if</span>(nextResult == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> aggregate;
    <span class="hljs-keyword">return</span> aggregate + nextResult;
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    <span class="hljs-type">CharStream</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> CharStreams.fromString(<span class="hljs-string">"1+2+3+4"</span>);
    <span class="hljs-type">CalcLexer</span> <span class="hljs-variable">lexer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CalcLexer</span>(input);
    <span class="hljs-type">CommonTokenStream</span> <span class="hljs-variable">tokens</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonTokenStream</span>(lexer);
    <span class="hljs-type">CalcParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CalcParser</span>(tokens);
    <span class="hljs-type">String</span> <span class="hljs-variable">visit</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TraversalVisitor</span>().visit(parser.expr());
    System.out.println(visit);
}
</code></pre>
<p>è¿™é‡Œé‡å†™äº†<code>AbstractParseTreeVisitor&lt;T&gt;</code>çš„</p>
<ul>
<li><code>visitTerminal</code>:å¶å­èŠ‚ç‚¹è¿”å›èŠ‚ç‚¹çš„æ–‡æœ¬ã€‚</li>
<li><code>aggregateResult</code>:åˆå¹¶ä¸¤ä¸ªèŠ‚ç‚¹çš„å€¼ï¼ŒæŠŠå­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥ã€‚</li>
</ul>
<p><strong>è¾“å‡º</strong></p>
<pre><code class="hljs">1+2+3+4
</code></pre>
<p>æˆ‘ä»¬ç®€å•çš„å®ç°åŠ æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">visitAddSubExpr</span><span class="hljs-params">(CalcParser.AddSubExprContext ctx)</span> {

    <span class="hljs-keyword">if</span>(ctx.ADD() != <span class="hljs-literal">null</span>){
        <span class="hljs-comment">//é€’å½’è·å–å·¦å³ä¸¤ä¾§çš„å€¼</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> visit(ctx.expr(<span class="hljs-number">0</span>));
        <span class="hljs-type">String</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> visit(ctx.expr(<span class="hljs-number">1</span>));
        <span class="hljs-keyword">if</span>(NumberUtils.isDigits(left) &amp;&amp; NumberUtils.isDigits(right)){
            <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Integer.parseInt(right) + Integer.parseInt(left);
            <span class="hljs-keyword">return</span> Integer.toString(result);
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.visitAddSubExpr(ctx);
}
</code></pre>
<p>é‚£ä¹ˆä¸Šé¢çš„<code>1+2+3+4</code>å°±ä¼šè¾“å‡º10ã€‚å½“ç„¶ï¼Œä¸€æ—¦æœ‰å…¶ä»–è¿ç®—ï¼Œè¿™é‡Œå°±ä¸çµäº†ï¼Œä¸è¿‡èµ·ç æˆ‘ä»¬ç¦»è®¡ç®—å™¨è¿‘äº†ä¸€æ­¥ï¼Œä¸‹ä¸€ç« æˆ‘ä»¬å…·ä½“å®ç°ã€‚</p>
<h2 data-id="heading-11">å››ã€å®æˆ˜</h2>
<h3 data-id="heading-12">4.1 éœ€æ±‚</h3>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å®æˆ˜ï¼Œå°±æä¸€ä¸ªæç®€çš„è¡¨è¾¾å¼è®¡ç®—å™¨å§ï¼Œéœ€è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>æ”¯æŒå˜é‡ï¼Œå˜é‡åï¼šé¦–å­—ç¬¦ä¸ºå­—æ¯æˆ–è€…ä¸‹åˆ’çº¿ï¼Œåç»­å­—ç¬¦å¯ä¸ºå­—æ¯ã€æ•°å­—æˆ–è€…ä¸‹åˆ’çº¿ï¼Œå¤§å°å†™æ•æ„Ÿï¼›</li>
<li>æ”¯æŒæ•´æ•°å’Œå°æ•°ï¼›</li>
<li>æ”¯æŒå››åˆ™è¿ç®—ä»¥åŠæ‹¬å·ï¼›</li>
<li>æ”¯æŒå‡½æ•°ï¼Œæœ¬æ¬¡ä»…å®ç°MAX/MINï¼Œå¤§å°å†™ä¸æ•æ„Ÿã€‚</li>
</ul>
<h3 data-id="heading-13">4.2 è¯­æ³•æ–‡ä»¶</h3>
<pre><code class="hljs language-ini" lang="ini">grammar Calc<span class="hljs-comment">;</span>

// è¯æ³•è§„åˆ™
MAX         : <span class="hljs-section">[Mm]</span><span class="hljs-section">[Aa]</span><span class="hljs-section">[Xx]</span><span class="hljs-comment">;  // MAXå‡½æ•°å</span>
MIN         : <span class="hljs-section">[Mm]</span><span class="hljs-section">[Ii]</span><span class="hljs-section">[Nn]</span><span class="hljs-comment">;  // MINå‡½æ•°å</span>
LEFT_PAREN  : '('<span class="hljs-comment">;</span>
RIGHT_PAREN : ')'<span class="hljs-comment">;</span>
COMMA       : ','<span class="hljs-comment">;</span>
ADD         : '+'<span class="hljs-comment">;</span>
SUB         : '-'<span class="hljs-comment">;</span>
MUL         : '*'<span class="hljs-comment">;</span>
DIV         : '/'<span class="hljs-comment">;</span>
VAR         : <span class="hljs-section">[a-zA-Z_]</span><span class="hljs-section">[a-zA-Z0-9_]</span>*<span class="hljs-comment">;</span>
INT         : <span class="hljs-section">[0-9]</span>+<span class="hljs-comment">;</span>
FLOAT       : <span class="hljs-section">[0-9]</span>+<span class="hljs-comment">; // å¸¦ç¬¦å·å°æ•°</span>
WS          : <span class="hljs-section">[ \t\r\n]</span>+ -&gt; skip<span class="hljs-comment">;</span>
// è¯­æ³•è§„åˆ™
number : INT | FLOAT<span class="hljs-comment">;</span>
function : MAX LEFT_PAREN expr (COMMA expr)* RIGHT_PAREN <span class="hljs-comment"># maxFunc</span>
         | MIN LEFT_PAREN expr (COMMA expr)* RIGHT_PAREN <span class="hljs-comment"># minFunc</span>
         <span class="hljs-comment">;</span>
expr : function <span class="hljs-comment"># FuncCallExpr</span>
     | number <span class="hljs-comment"># numberExpr</span>
     | VAR <span class="hljs-comment"># varExpr</span>
     | LEFT_PAREN expr RIGHT_PAREN <span class="hljs-comment"># ParenExpr</span>
     | expr (MUL | DIV) expr <span class="hljs-comment"># MulDivExpr</span>
     | expr (ADD | SUB) expr <span class="hljs-comment"># AddSubExpr</span>
     | (ADD | SUB) expr <span class="hljs-comment"># UnaryMinusPlus</span>
     <span class="hljs-comment">;</span>
</code></pre>
<p>ä¸ä¹‹å‰çš„è¯­æ³•æ–‡ä»¶åŒºåˆ«ä¸å¤§</p>
<ol>
<li>æ–°å¢äº†å˜é‡è¯æ³•ï¼Œ<code>VAR: [a-zA-Z_][a-zA-Z0-9_]*</code>ï¼Œæ³¨æ„è¦æ”¾åœ¨å‡½æ•°åçš„åé¢ï¼Œå¦åˆ™å‡½æ•°åå­—ä¼šè¢«è§£ææˆå˜é‡åå­—ã€‚</li>
<li>æ–°å¢å°æ•°ï¼Œå¹¶åœ¨åé¢ä¸æ•´æ•°ä¸€èµ·åˆå¹¶ä¸ºnumberã€‚</li>
<li>functionå•æ‹¿å‡ºæ¥ä½œä¸ºä¸€ä¸ªè¯­æ³•ï¼Œè¢«exprå¼•ç”¨ï¼Œè¿™ç§å†™æ³•ä¸ä¹‹å‰åŒºåˆ«ä¸å¤§ï¼Œåªæ˜¯ç”Ÿæˆçš„ä»£ç ä¸­ï¼Œä¼šå¤šä¸€ä¸ª<code>visitFuncCallExpr</code>(visitoræ¨¡å¼)æˆ–è€…<code>enter/exitFuncCallExpr</code>(listeneræ¨¡å¼)çš„æ–¹æ³•ã€‚</li>
<li>å¢åŠ äº†<code> (ADD | SUB) expr</code>è¿™æ ·çš„è¯­æ³•ï¼Œä»¥æ”¯æŒæ­£è´Ÿæ•°è¿™æ ·çš„å†™æ³•ã€‚</li>
</ol>
<p>Q ï¼šä¸ºä»€ä¹ˆä¸å†INT/FLOATä¸Šç›´æ¥æ”¯æŒæ­£è´Ÿå·å‘¢ï¼Ÿ
A : è¿™æ¥å®šä¹‰ä¼šå’ŒåŠ å‡æ³•å†²çªï¼Œç›®å‰æˆ‘æ²¡æƒ³å¥½è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥åœ¨åé¢åŠ äº†ä¸€ä¸ª<code> (ADD | SUB) expr</code>è¡¨è¾¾å¼ã€‚</p>
<h3 data-id="heading-14">4.3 ä½¿ç”¨Visitorå®ç°</h3>
<p>ä¸Šä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬ä½¿ç”¨visitorå®ç°äº†ï¼Œä»…èƒ½æ”¯æŒåŠ æ³•çš„è®¡ç®—å™¨ï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠæ‰€æœ‰çš„è¯­æ³•éƒ½å®ç°ä¸€éï¼Œä¹Ÿå°±å®ç°äº†è®¡ç®—å™¨ï¼Œæ³¨æ„è¿™é‡Œçš„æ³›å‹æ”¹ä¸º<code>Double</code>äº†ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CalcVisitorEvaluator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CalcBaseVisitor</span>&lt;Double&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Double&gt; variables;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CalcVisitorEvaluator</span><span class="hljs-params">(Map&lt;String, Double&gt; variables)</span> {
        <span class="hljs-built_in">this</span>.variables = variables;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">visitNumberExpr</span><span class="hljs-params">(CalcParser.NumberExprContext ctx)</span> {
        <span class="hljs-keyword">return</span> Double.parseDouble(ctx.number().getText());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">visitVarExpr</span><span class="hljs-params">(CalcParser.VarExprContext ctx)</span> {
        <span class="hljs-keyword">return</span> variables.getOrDefault(ctx.VAR().getText(), <span class="hljs-number">0.0</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">visitParenExpr</span><span class="hljs-params">(CalcParser.ParenExprContext ctx)</span> {
        <span class="hljs-keyword">return</span> visit(ctx.expr());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">visitMulDivExpr</span><span class="hljs-params">(CalcParser.MulDivExprContext ctx)</span> {
        <span class="hljs-type">double</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> visit(ctx.expr(<span class="hljs-number">0</span>));
        <span class="hljs-type">double</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> visit(ctx.expr(<span class="hljs-number">1</span>));
        <span class="hljs-keyword">if</span> (ctx.MUL() != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> left * right;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> left / right;
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">visitAddSubExpr</span><span class="hljs-params">(CalcParser.AddSubExprContext ctx)</span> {
        <span class="hljs-type">double</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> visit(ctx.expr(<span class="hljs-number">0</span>));
        <span class="hljs-type">double</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> visit(ctx.expr(<span class="hljs-number">1</span>));
        <span class="hljs-keyword">if</span> (ctx.ADD() != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> left + right;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> left - right;
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">visitUnaryMinusPlus</span><span class="hljs-params">(CalcParser.UnaryMinusPlusContext ctx)</span> {
        <span class="hljs-type">double</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> visit(ctx.expr());
        <span class="hljs-keyword">return</span> ctx.SUB() != <span class="hljs-literal">null</span> ? -value : value;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">visitMaxFunc</span><span class="hljs-params">(CalcParser.MaxFuncContext ctx)</span> {
        <span class="hljs-type">double</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> Double.NEGATIVE_INFINITY;
        <span class="hljs-keyword">for</span> (CalcParser.ExprContext expr : ctx.expr()) {
            max = Math.max(max, visit(expr));
        }
        <span class="hljs-keyword">return</span> max;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">visitMinFunc</span><span class="hljs-params">(CalcParser.MinFuncContext ctx)</span> {
        <span class="hljs-type">double</span> <span class="hljs-variable">min</span> <span class="hljs-operator">=</span> Double.POSITIVE_INFINITY;
        <span class="hljs-keyword">for</span> (CalcParser.ExprContext expr : ctx.expr()) {
            min = Math.min(min, visit(expr));
        }
        <span class="hljs-keyword">return</span> min;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">visitFuncCallExpr</span><span class="hljs-params">(CalcParser.FuncCallExprContext ctx)</span> {
        <span class="hljs-keyword">return</span> visit(ctx.function());
    }
}
</code></pre>
<p>æ˜¯ä¸æ˜¯çœ‹èµ·æ¥å¾ˆç®€å•ï¼Œåªä¸è¿‡æ˜¯æŠŠæ‰€æœ‰çš„ç®€å•çš„è¯­æ³•éƒ½å®ç°äº†ä¸€éï¼Œå¤æ‚çš„è¯æ³•è¯­æ³•åˆ†æï¼Œä»¥åŠè¯­æ³•æ ‘çš„éå†ï¼Œéƒ½ä¸éœ€è¦è‡ªè¡Œå®ç°äº†ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    Map&lt;String, Double&gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    variables.put(<span class="hljs-string">"a"</span>, <span class="hljs-number">10.0</span>);
    variables.put(<span class="hljs-string">"b"</span>, <span class="hljs-number">6.0</span>);
    <span class="hljs-type">String</span> <span class="hljs-variable">expression</span> <span class="hljs-operator">=</span> <span class="hljs-string">"max(a + 5, min(b * 3, 20)) - 3"</span>;

    <span class="hljs-comment">// ä½¿ç”¨Visitoræ¨¡å¼è®¡ç®—</span>
    CalcParser.<span class="hljs-type">ExprContext</span> <span class="hljs-variable">exprContext</span> <span class="hljs-operator">=</span> parseTree(expression);
    <span class="hljs-type">CalcVisitorEvaluator</span> <span class="hljs-variable">visitor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CalcVisitorEvaluator</span>(variables);
    <span class="hljs-type">double</span> <span class="hljs-variable">visitorResult</span> <span class="hljs-operator">=</span> visitor.visit(exprContext);
    System.out.println(<span class="hljs-string">"Visitorç»“æœ: "</span> + visitorResult);
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> CalcParser.ExprContext <span class="hljs-title function_">parseTree</span><span class="hljs-params">(String expression)</span> {
    <span class="hljs-type">CharStream</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> CharStreams.fromString(expression);
    <span class="hljs-type">CalcLexer</span> <span class="hljs-variable">lexer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CalcLexer</span>(input);
    <span class="hljs-type">CommonTokenStream</span> <span class="hljs-variable">tokens</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonTokenStream</span>(lexer);
    <span class="hljs-type">CalcParser</span> <span class="hljs-variable">parser</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CalcParser</span>(tokens);
    <span class="hljs-keyword">return</span> parser.expr();
}
</code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Visitorç»“æœ: 15.0</span>
</code></pre>
<p>æ˜¯ä¸æ˜¯å¾ˆç¥å¥‡ï¼Œæˆ‘ä»¬ç®€å•æ¢³ç†ä¸‹éå†æ“ä½œï¼Œè¯­æ³•æ ‘å¦‚ä¸‹ï¼Œæ ¹èŠ‚ç‚¹æ˜¯è¿™ä¸ªå‡æ³•ã€‚å›å¤´çœ‹ä¸‹ä»£ç ï¼Œå‡æ³•å°±æ˜¯å…ˆéå†è®¡ç®—å·¦å­èŠ‚ç‚¹çš„å€¼ï¼Œå†éå†è®¡ç®—å³å­èŠ‚ç‚¹ï¼ŒæŠŠä»–ä»¬å‡èµ·æ¥å°±å¯ä»¥äº†ã€‚å…¶å®å°±æ˜¯ä¸€ä¸ªå·¦å³æ ¹çš„é€’å½’éå†ï¼Œæ²¿ç€è¿™ä¸ªé¡ºåºï¼Œå°±ä¼šä¸€ç›´é€’å½’åˆ°å·¦ä¸‹çš„åŠ æ³•åˆ†æ”¯ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd43c3d244b340c2bad36923e370e107~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16a2C54yO5omL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766845548&amp;x-signature=WW3RTw9BAV9mRwW3tSuabM4Aueg%3D" alt="image.png" loading="lazy"/></p>
<p>å·¦ä¸‹çš„åŠ æ³•è®¡ç®—å®Œæˆåï¼Œå°±å˜æˆäº†è¿™æ ·ã€‚å†éå†maxçš„å³è¾¹çš„èŠ‚ç‚¹ï¼Œåˆåˆ°äº†ä¸­é—´çš„ä¹˜æ³•ï¼Œå†è¿›è¡Œä¹˜æ³•è®¡ç®—ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/780be613bbcb43cfbd7d3751da94f7a9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16a2C54yO5omL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766845548&amp;x-signature=fy1Z0Nwcs4u8aujWGlAzO9rcau0%3D" alt="image.png" loading="lazy"/></p>
<p>å—¯ï¼Œæˆ‘ç›¸ä¿¡ä½ å·²ç»çœ‹æ‡‚æ˜¯å¦‚ä½•è®¡ç®—çš„äº†ï¼Œæˆ‘å°±ä¸ç»§ç»­æˆªå›¾äº†ã€‚æ€»ä¹‹éšç€è¯­æ³•æ ‘çš„è‡ªåº•å‘ä¸Šéå†ï¼Œä¸æ–­è®¡ç®—ï¼Œæ±‡æ€»åˆ°æ ¹èŠ‚ç‚¹ï¼Œå°±å¾—åˆ°ç»“æœäº†ã€‚</p>
<h3 data-id="heading-15">4.4 ä½¿ç”¨Listenerå®ç°</h3>
<p>åœ¨visitoræ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯¹è¯­æ³•æ ‘ä½¿ç”¨å·¦å³æ ¹çš„æ–¹å¼éå†æ•´æ£µè¯­æ³•æ ‘ï¼Œè‡ªåº•å‘ä¸Šï¼ŒæŠŠç»“æœè®¡ç®—å‡ºæ¥ã€‚åœ¨listeneræ¨¡å¼ï¼Œä¹Ÿç±»ä¼¼ï¼Œä¸è¿‡listeneræ²¡æœ‰è¿”å›å€¼ï¼Œåœ¨è¿›å…¥èŠ‚ç‚¹æ—¶ï¼Œéœ€è¦åˆ©ç”¨æ ˆè¿™ç§æ•°æ®ç»“æ„ï¼ŒæŠŠæ•°æ®å…ˆå­˜å‚¨èµ·æ¥ï¼Œå‡ºæ ˆå†å»è®¡ç®—ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CalcListenerEvaluator</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CalcBaseListener</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, Double&gt; variables;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Deque&lt;Double&gt; stack = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayDeque</span>&lt;&gt;();

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CalcListenerEvaluator</span><span class="hljs-params">(Map&lt;String, Double&gt; variables)</span> {
        <span class="hljs-built_in">this</span>.variables = variables;
    }

    <span class="hljs-keyword">public</span> Double <span class="hljs-title function_">getResult</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> stack.isEmpty() ? <span class="hljs-number">0.0</span> : stack.pop();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitNumberExpr</span><span class="hljs-params">(CalcParser.NumberExprContext ctx)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> ctx.number().getText();
        stack.push(Double.parseDouble(text));
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitVarExpr</span><span class="hljs-params">(CalcParser.VarExprContext ctx)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">varName</span> <span class="hljs-operator">=</span> ctx.VAR().getText();
        <span class="hljs-type">Double</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> variables.getOrDefault(varName, <span class="hljs-number">0.0</span>);
        stack.push(value);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitParenExpr</span><span class="hljs-params">(CalcParser.ParenExprContext ctx)</span> {
        <span class="hljs-comment">// æ‹¬å·è¡¨è¾¾å¼ç»“æœå·²åœ¨å­è¡¨è¾¾å¼å¤„ç†åå…¥æ ˆï¼Œæ— éœ€é¢å¤–æ“ä½œ</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitMulDivExpr</span><span class="hljs-params">(CalcParser.MulDivExprContext ctx)</span> {
        <span class="hljs-type">double</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> stack.pop();
        <span class="hljs-type">double</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> stack.pop();
        <span class="hljs-keyword">if</span> (ctx.MUL() != <span class="hljs-literal">null</span>) {
            stack.push(left * right);
        } <span class="hljs-keyword">else</span> {
            stack.push(left / right);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitAddSubExpr</span><span class="hljs-params">(CalcParser.AddSubExprContext ctx)</span> {
        <span class="hljs-type">double</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> stack.pop();
        <span class="hljs-type">double</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> stack.pop();
        <span class="hljs-keyword">if</span> (ctx.ADD() != <span class="hljs-literal">null</span>) {
            stack.push(left + right);
        } <span class="hljs-keyword">else</span> {
            stack.push(left - right);
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitUnaryMinusPlus</span><span class="hljs-params">(CalcParser.UnaryMinusPlusContext ctx)</span> {
        <span class="hljs-type">double</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> stack.pop();
        <span class="hljs-keyword">if</span> (ctx.SUB() != <span class="hljs-literal">null</span>) {
            stack.push(-value);
        }
        <span class="hljs-comment">// ä¸€å…ƒåŠ å·ä¸æ”¹å˜å€¼</span>
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitMaxFunc</span><span class="hljs-params">(CalcParser.MaxFuncContext ctx)</span> {
        List&lt;CalcParser.ExprContext&gt; exprs = ctx.expr();
        <span class="hljs-type">double</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> stack.pop();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; exprs.size(); i++) {
            max = Math.max(max, stack.pop());
        }
        stack.push(max);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">exitMinFunc</span><span class="hljs-params">(CalcParser.MinFuncContext ctx)</span> {
        List&lt;CalcParser.ExprContext&gt; exprs = ctx.expr();
        <span class="hljs-type">double</span> <span class="hljs-variable">min</span> <span class="hljs-operator">=</span> stack.pop();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; exprs.size(); i++) {
            min = Math.min(min, stack.pop());
        }
        stack.push(min);
    }

}
</code></pre>
<p>ä¸‹é¢æˆ‘ä»¬éªŒè¯ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    Map&lt;String, Double&gt; variables = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    variables.put(<span class="hljs-string">"a"</span>, <span class="hljs-number">10.0</span>);
    variables.put(<span class="hljs-string">"b"</span>, <span class="hljs-number">6.0</span>);
    <span class="hljs-type">String</span> <span class="hljs-variable">expression</span> <span class="hljs-operator">=</span> <span class="hljs-string">"max(a + 5, min(b * 3, 20)) - 3"</span>;

    <span class="hljs-comment">// ä½¿ç”¨Listeneræ¨¡å¼è®¡ç®—</span>
    <span class="hljs-type">CalcListenerEvaluator</span> <span class="hljs-variable">listener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CalcListenerEvaluator</span>(variables);
    ParseTreeWalker.DEFAULT.walk(listener, exprContext);
    System.out.println(<span class="hljs-string">"Listenerç»“æœ: "</span> + listener.getResult());
}
</code></pre>
<p><strong>è¾“å‡º</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Visitorç»“æœ: 15.0</span>
</code></pre>
<p>listeneræ¨¡å¼ï¼Œæˆ‘ä»¬ä¹Ÿç®€å•æ‹ä¸€ä¸‹ã€‚è¿˜æ˜¯è¿™å¼ å›¾ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œä¸€ç›´å‘ä¸‹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd43c3d244b340c2bad36923e370e107~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54G16a2C54yO5omL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766845548&amp;x-signature=WW3RTw9BAV9mRwW3tSuabM4Aueg%3D" alt="image.png" loading="lazy"/></p>
<p>ç›´åˆ°é‡åˆ°å·¦ä¾§åŠ æ³•çš„å˜é‡èŠ‚ç‚¹ï¼Œå…¥æ ˆa,ä¹Ÿå°±æ˜¯10ï¼Œå†éå†åŠ æ³•å³ä¾§çš„æ•°å­—èŠ‚ç‚¹ï¼Œå…¥æ ˆ5ï¼Œè¿™æ—¶æ ˆçš„æ ·å­ä¸ºï¼š</p>
<pre><code class="hljs language-rust" lang="rust">æ ˆåº• <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">10</span> <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">5</span> <span class="hljs-punctuation">-&gt;</span> æ ˆé¡¶
</code></pre>
<p>ç„¶åå›åˆ°AddSubExprèŠ‚ç‚¹ï¼Œæ‰§è¡Œ<code>exitAddSubExpr</code>æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Override</span>
public void exitAddSubExpr(CalcParser.AddSubExprContext ctx) {
    double <span class="hljs-attribute">right</span> = stack<span class="hljs-selector-class">.pop</span>();
    double <span class="hljs-attribute">left</span> = stack<span class="hljs-selector-class">.pop</span>();
    if (ctx.ADD() != null) {
        stack<span class="hljs-selector-class">.push</span>(left + right);
    } else {
        stack<span class="hljs-selector-class">.push</span>(left - right);
    }
}
</code></pre>
<p>è®¡ç®—äº†10+5ï¼Œå¹¶æŠŠç»“æœ15å…¥æ ˆï¼š</p>
<pre><code class="hljs language-rust" lang="rust">æ ˆåº• <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">15</span> <span class="hljs-punctuation">-&gt;</span> æ ˆé¡¶
</code></pre>
<p>ç»§ç»­éå†ï¼Œåˆ°ä¸­é—´çš„ä¹˜æ³•èŠ‚ç‚¹ï¼Œç»§ç»­å…¥æ ˆbå’Œ3ï¼Œé‚£ä¹ˆç°åœ¨æ˜¯ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">æ ˆåº• <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">15</span> <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">6</span><span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">3</span> <span class="hljs-punctuation">-&gt;</span> æ ˆé¡¶
</code></pre>
<p>ä¹˜æ³•ä¹Ÿæ˜¯ä»æ ˆé‡Œå–å‡ºä¸¤ä¸ªæ•°ï¼Œè®¡ç®—å†æ”¾å›å»ï¼Œé‚£ä¹ˆæ ˆç°åœ¨æ˜¯ï¼š</p>
<pre><code class="hljs language-rust" lang="rust">æ ˆåº• <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">15</span> <span class="hljs-punctuation">-&gt;</span> <span class="hljs-number">18</span> <span class="hljs-punctuation">-&gt;</span> æ ˆé¡¶
</code></pre>
<p>æ˜¯ä¸æ˜¯æœ‰ç‚¹æ„Ÿè§‰äº†ï¼Œä¼´éšè¿™æ ·ä¸æ–­å…¥æ ˆå‡ºæ ˆï¼Œæ ˆä¸­æœ€ç»ˆçš„ç»“æœï¼Œå°±æ˜¯å‡ºæ ¹èŠ‚ç‚¹åè®¡ç®—çš„ç»“æœï¼Œä¹Ÿå°±æ˜¯æœ€ç»ˆç»“æœã€‚</p>
<h2 data-id="heading-16">äº”ã€æ€»ç»“</h2>
<p>åªéœ€è¦å®šä¹‰è¯­æ³•è§„åˆ™ï¼ŒANTRL4å¸®æˆ‘ä»¬å®ç°äº†æ¯”è¾ƒå¤æ‚çš„è¯æ³•ã€è¯­æ³•è§£æï¼Œå¹¶æä¾›visitorå’Œlistenerä¸¤ç§æ¨¡å¼ï¼ŒååŠ©éå†æŠ½è±¡è¯­æ³•æ ‘ï¼Œè®©å¤æ‚çš„è¯­æ³•è§£æï¼Œç¬é—´å˜å¾—ç®€å•ã€‚ANTRL4åœ¨å¾ˆå¤šå¼€æºè½¯ä»¶ä¸­ï¼Œéƒ½æœ‰åº”ç”¨ï¼Œæ¯”å¦‚SPARKã€HIVEçš„è¯­æ³•è§£æã€‚</p>
<p><strong>å¦å¤–</strong></p>
<ol>
<li>å’±ä»¬å®ç°çš„è¡¨è¾¾æ˜¯è®¡ç®—ï¼Œä»…ä»…æ˜¯èƒ½ç”¨ï¼Œæ¯æ¬¡è®¡ç®—éƒ½éœ€è¦é‡æ–°è§£æï¼Œæ€§èƒ½è¾ƒå·®ã€‚ä¸€ä¸ªå¯è¡Œçš„æ€è·¯æ˜¯ï¼Œè§£æåç›´æ¥ç”Ÿæˆjavaå­—èŠ‚ç ï¼Œå¹¶ç¼“å­˜ä»¥æå‡æ€§èƒ½ã€‚è¡¨è¾¾å¼å¼•æ“aviatorå°±æ˜¯è¿™ä¹ˆåšçš„ï¼Œä¸è¿‡ï¼Œaviatorå¹¶æ²¡æœ‰ä½¿ç”¨ANTRL4ã€‚å¦‚æœä½ éœ€è¦è¿™æ ·ä¸€ä¸ªè¡¨è¾¾å¼è§£æå™¨ï¼Œæ¨èaviatorï¼Œæ²¡å¿…è¦é‡å¤é€ è½®å­ã€‚</li>
<li>æ–‡ç« é‡Œæ€»å†™æ ¹å·¦å³æˆ–è€…å·¦å³æ ¹è¿™ç§éå†æ–¹å¼ï¼Œå®é™…ä¸Šè¿™æ˜¯äºŒå‰æ ‘çš„æ¦‚å¿µï¼Œåº”ç”¨çš„å¹¶ä¸å‡†ç¡®ã€‚</li>
<li>è¯­æ³•æ–‡ä»¶ç¼–å†™æ˜¯å¾ˆå¤æ‚çš„ï¼Œè¿™é‡Œè®²çš„å¾ˆç®€ç•¥ï¼Œå¯ä»¥åœ¨Bç«™ä¸Šçœ‹ä¸‹è¿™ä¸ª<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV16TNhz2EKG%2F%3Fspm_id_from%3D333.337.search-card.all.click%26vd_source%3D4ea2be483e14a3b23d2c952bd0c34230" target="_blank" title="https://www.bilibili.com/video/BV16TNhz2EKG/?spm_id_from=333.337.search-card.all.click&amp;vd_source=4ea2be483e14a3b23d2c952bd0c34230" ref="nofollow noopener noreferrer"># ã€antlrã€‘Antlr4ä»å…¥é—¨åˆ°ç²¾é€š</a></li>
<li>æºç ä¸Šä¼ äº†Giteeï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fheyhu%2Fantlr4-express" target="_blank" title="https://gitee.com/heyhu/antlr4-express" ref="nofollow noopener noreferrer">å¯ä»¥è‡ªå–</a>ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¼€å‘å¯æŒæ¡çš„çŸ¥è¯†ï¼šæ¨èç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7585645111875289115</link>    <guid>https://juejin.cn/post/7585645111875289115</guid>    <pubDate>2025-12-21T03:43:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585645111875289115" data-draft-id="7585553799297925166" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¼€å‘å¯æŒæ¡çš„çŸ¥è¯†ï¼šæ¨èç³»ç»Ÿ"/> <meta itemprop="keywords" content="åç«¯,Java,ç®—æ³•"/> <meta itemprop="datePublished" content="2025-12-21T03:43:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸‰å¹´ä¹‹çº¦"/> <meta itemprop="url" content="https://juejin.cn/user/3448523142729784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¼€å‘å¯æŒæ¡çš„çŸ¥è¯†ï¼šæ¨èç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3448523142729784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸‰å¹´ä¹‹çº¦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T03:43:39.000Z" title="Sun Dec 21 2025 03:43:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æ¨èç³»ç»Ÿï¼ˆRecommendation Systemï¼‰æ˜¯ä¸€ç§ä¿¡æ¯è¿‡æ»¤ç³»ç»Ÿï¼Œå…¶ç›®æ ‡æ˜¯é¢„æµ‹ç”¨æˆ·å¯¹ç‰©å“ï¼ˆå¦‚å•†å“ã€ç”µå½±ã€æ–‡ç« ç­‰ï¼‰çš„åå¥½æˆ–è¯„åˆ†ï¼Œä»è€Œå‘ç”¨æˆ·æ¨èä»–ä»¬å¯èƒ½æ„Ÿå…´è¶£çš„ç‰©å“ã€‚æ¨èç³»ç»Ÿå¹¿æ³›åº”ç”¨äºç”µå•†ã€è§†é¢‘å¹³å°ã€ç¤¾äº¤åª’ä½“ã€æ–°é—»æ¨é€ç­‰åœºæ™¯ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹æ¨èç³»ç»Ÿç®—æ³•çš„å®Œæ•´æµç¨‹ï¼ŒåŒ…æ‹¬æ ¸å¿ƒæ¨¡å—ã€å¸¸ç”¨ç®—æ³•ä»¥åŠæ•´ä½“å·¥ä½œæµç¨‹ï¼š</p>
<h2 data-id="heading-0">ä¸€ã€æ¨èç³»ç»Ÿæ•´ä½“æµç¨‹</h2>
<p>ä¸€ä¸ªå®Œæ•´çš„æ¨èç³»ç»Ÿä¸»è¦åŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</p>
<pre><code class="hljs language-text" lang="text">1.Â æ•°æ®æ”¶é›†
2.Â æ•°æ®é¢„å¤„ç†
3.Â ç‰¹å¾å·¥ç¨‹
4.Â æ¨¡å‹é€‰æ‹©ä¸è®­ç»ƒ
5.Â æ¨èç”Ÿæˆï¼ˆå¬å›Â +Â æ’åºï¼‰
6.Â ç»“æœè¯„ä¼°ä¸åé¦ˆ
7.Â åœ¨çº¿æœåŠ¡ä¸æ›´æ–°
</code></pre>
<hr/>
<h3 data-id="heading-1">1. æ•°æ®æ”¶é›†ï¼ˆData Collectionï¼‰</h3>
<p>æ”¶é›†ç”¨æˆ·è¡Œä¸ºæ•°æ®å’Œç‰©å“ä¿¡æ¯ï¼Œå¸¸è§æ•°æ®åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>æ˜¾å¼åé¦ˆ</strong>ï¼šç”¨æˆ·è¯„åˆ†ã€ç‚¹èµã€æ”¶è—ç­‰ï¼ˆå¦‚ç”µå½±è¯„åˆ†ï¼‰</li>
<li><strong>éšå¼åé¦ˆ</strong>ï¼šç‚¹å‡»ã€æµè§ˆã€è´­ä¹°ã€åœç•™æ—¶é•¿ç­‰</li>
<li><strong>ä¸Šä¸‹æ–‡ä¿¡æ¯</strong>ï¼šæ—¶é—´ã€åœ°ç‚¹ã€è®¾å¤‡ã€å¤©æ°”ç­‰</li>
<li><strong>ç”¨æˆ·ç”»åƒ</strong>ï¼šå¹´é¾„ã€æ€§åˆ«ã€åœ°åŸŸã€å…´è¶£æ ‡ç­¾ç­‰</li>
<li><strong>ç‰©å“ç‰¹å¾</strong>ï¼šç±»åˆ«ã€æ ‡ç­¾ã€æè¿°ã€ä»·æ ¼ã€ä½œè€…ç­‰</li>
</ul>
<hr/>
<h3 data-id="heading-2">2. æ•°æ®é¢„å¤„ç†ï¼ˆData Preprocessingï¼‰</h3>
<p>å¯¹åŸå§‹æ•°æ®è¿›è¡Œæ¸…æ´—å’Œè½¬æ¢ï¼š</p>
<ul>
<li>å»é™¤å™ªå£°ï¼ˆå¦‚å¼‚å¸¸ç‚¹å‡»ã€çˆ¬è™«æ•°æ®ï¼‰</li>
<li>å¤„ç†ç¼ºå¤±å€¼</li>
<li>æ•°æ®å½’ä¸€åŒ– / æ ‡å‡†åŒ–</li>
<li>æ„å»ºç”¨æˆ·-ç‰©å“äº¤äº’çŸ©é˜µï¼ˆUser-Item Interaction Matrixï¼‰</li>
<li>åˆ’åˆ†è®­ç»ƒé›† / éªŒè¯é›† / æµ‹è¯•é›†</li>
</ul>
<hr/>
<h3 data-id="heading-3">3. ç‰¹å¾å·¥ç¨‹ï¼ˆFeature Engineeringï¼‰</h3>
<p>æå–æœ‰æ•ˆç‰¹å¾ç”¨äºæ¨¡å‹è®­ç»ƒï¼š</p>
<ul>
<li>ç”¨æˆ·ä¾§ç‰¹å¾ï¼šå†å²è¡Œä¸ºç»Ÿè®¡ï¼ˆå¦‚ç‚¹å‡»ç‡ã€è´­ä¹°é¢‘æ¬¡ï¼‰ã€å…´è¶£å‘é‡</li>
<li>ç‰©å“ä¾§ç‰¹å¾ï¼šç±»åˆ«ã€çƒ­åº¦ã€æ–‡æœ¬åµŒå…¥ï¼ˆå¦‚TF-IDFã€BERTï¼‰</li>
<li>äº¤å‰ç‰¹å¾ï¼šç”¨æˆ·-ç‰©å“äº¤äº’ç‰¹å¾ï¼ˆæ˜¯å¦è´­ä¹°è¿‡åŒç±»å•†å“ï¼‰</li>
<li>æ—¶åºç‰¹å¾ï¼šæœ€è¿‘ä¸€æ¬¡äº¤äº’æ—¶é—´ã€è¡Œä¸ºè¡°å‡æƒé‡</li>
</ul>
<hr/>
<h3 data-id="heading-4">4. æ¨¡å‹é€‰æ‹©ä¸è®­ç»ƒï¼ˆModel Selection &amp; Trainingï¼‰</h3>
<p>æ ¹æ®åœºæ™¯é€‰æ‹©åˆé€‚çš„æ¨èç®—æ³•ã€‚å¸¸è§ç®—æ³•åˆ†ç±»å¦‚ä¸‹ï¼š</p>
<h4 data-id="heading-5">ï¼ˆ1ï¼‰åŸºäºå†…å®¹çš„æ¨èï¼ˆContent-Basedï¼‰</h4>
<ul>
<li>åŸç†ï¼šæ ¹æ®ç”¨æˆ·å†å²å–œæ¬¢çš„ç‰©å“å†…å®¹ï¼Œæ¨èç›¸ä¼¼å†…å®¹çš„ç‰©å“ã€‚</li>
<li>ä¼˜ç‚¹ï¼šå¯è§£é‡Šæ€§å¼ºï¼Œæ— å†·å¯åŠ¨é—®é¢˜ï¼ˆå¯¹æ–°ç‰©å“å‹å¥½ï¼‰</li>
<li>ç¼ºç‚¹ï¼šæ¨èå¤šæ ·æ€§å·®ï¼Œéš¾ä»¥å‘ç°ç”¨æˆ·æ–°å…´è¶£</li>
</ul>
<h4 data-id="heading-6">ï¼ˆ2ï¼‰ååŒè¿‡æ»¤ï¼ˆCollaborative Filtering, CFï¼‰</h4>
<ul>
<li><strong>åŸºäºç”¨æˆ·çš„CF</strong>ï¼šæ‰¾ç›¸ä¼¼ç”¨æˆ·ï¼Œæ¨èä»–ä»¬å–œæ¬¢çš„ç‰©å“</li>
<li><strong>åŸºäºç‰©å“çš„CF</strong>ï¼šæ‰¾ç›¸ä¼¼ç‰©å“ï¼Œæ¨èç”¨æˆ·å–œæ¬¢çš„ç›¸ä¼¼ç‰©å“</li>
<li>ä¼˜ç‚¹ï¼šæ— éœ€ç‰©å“å†…å®¹ä¿¡æ¯ï¼Œå‘ç°æ½œåœ¨å…´è¶£</li>
<li>ç¼ºç‚¹ï¼šå†·å¯åŠ¨é—®é¢˜ï¼ˆæ–°ç”¨æˆ·/æ–°ç‰©å“éš¾å¤„ç†ï¼‰ï¼Œæ•°æ®ç¨€ç–æ€§</li>
</ul>
<h4 data-id="heading-7">ï¼ˆ3ï¼‰çŸ©é˜µåˆ†è§£ï¼ˆMatrix Factorization, MFï¼‰</h4>
<ul>
<li>å°†ç”¨æˆ·-ç‰©å“è¯„åˆ†çŸ©é˜µåˆ†è§£ä¸ºä½ç»´éšå‘é‡ï¼ˆUser Embedding + Item Embeddingï¼‰</li>
<li>ç»å…¸ç®—æ³•ï¼šSVDã€SVD++ã€NMF</li>
<li>ä¼˜ç‚¹ï¼šç¼“è§£ç¨€ç–æ€§ï¼Œæ•æ‰éšå¼å…´è¶£</li>
<li>ç¼ºç‚¹ï¼šéš¾ä»¥èå…¥ä¸°å¯Œç‰¹å¾</li>
</ul>
<h4 data-id="heading-8">ï¼ˆ4ï¼‰æ·±åº¦å­¦ä¹ æ¨¡å‹</h4>
<ul>
<li><strong>Wide &amp; Deep</strong>ï¼šç»“åˆè®°å¿†ï¼ˆWideï¼‰ä¸æ³›åŒ–ï¼ˆDeepï¼‰</li>
<li><strong>Neural CFï¼ˆNCFï¼‰</strong> ï¼šç”¨ç¥ç»ç½‘ç»œæ›¿ä»£å†…ç§¯è®¡ç®—ç”¨æˆ·-ç‰©å“åŒ¹é…åº¦</li>
<li><strong>DeepFM / DIN / DIEN</strong>ï¼šèåˆç‰¹å¾äº¤å‰ä¸ç”¨æˆ·è¡Œä¸ºåºåˆ—å»ºæ¨¡</li>
<li><strong>Graph Neural Networksï¼ˆGNNï¼‰</strong> ï¼šå°†ç”¨æˆ·-ç‰©å“äº¤äº’å»ºæ¨¡ä¸ºå›¾ï¼Œå¦‚ PinSage</li>
</ul>
<h4 data-id="heading-9">ï¼ˆ5ï¼‰å¤šä»»åŠ¡å­¦ä¹ ä¸å¼ºåŒ–å­¦ä¹ </h4>
<ul>
<li>å¤šç›®æ ‡ä¼˜åŒ–ï¼ˆå¦‚ç‚¹å‡»ç‡ + è½¬åŒ–ç‡ + æ—¶é•¿ï¼‰</li>
<li>åœ¨çº¿å­¦ä¹  / å¼ºåŒ–å­¦ä¹ ï¼ˆå¦‚ LinUCBã€DQNï¼‰ç”¨äºåŠ¨æ€è°ƒæ•´æ¨èç­–ç•¥</li>
</ul>
<hr/>
<h3 data-id="heading-10">5. æ¨èç”Ÿæˆï¼šå¬å›ï¼ˆRecallï¼‰ + æ’åºï¼ˆRankingï¼‰</h3>
<p>ç”±äºç‰©å“åº“é€šå¸¸å¾ˆå¤§ï¼ˆç™¾ä¸‡çº§ï¼‰ï¼Œéœ€åˆ†ä¸¤é˜¶æ®µï¼š</p>
<h4 data-id="heading-11">ï¼ˆ1ï¼‰å¬å›é˜¶æ®µ</h4>
<ul>
<li>
<p>ä»å…¨é‡ç‰©å“ä¸­å¿«é€Ÿç­›é€‰å‡ºå‡ ç™¾~å‡ åƒä¸ªå€™é€‰ç‰©å“</p>
</li>
<li>
<p>å¸¸ç”¨æ–¹æ³•ï¼š</p>
<ul>
<li>åŸºäºè§„åˆ™ï¼ˆçƒ­é—¨ã€åœ°åŸŸã€æ–°ä¸Šæ¶ï¼‰</li>
<li>ååŒè¿‡æ»¤ï¼ˆItemCFã€UserCFï¼‰</li>
<li>å‘é‡å¬å›ï¼ˆANNï¼Œå¦‚ Faissã€HNSWï¼Œç”¨ Embedding ç›¸ä¼¼åº¦ï¼‰</li>
<li>å¤šè·¯å¬å›ï¼ˆèåˆå¤šç§ç­–ç•¥ï¼‰</li>
</ul>
</li>
</ul>
<h4 data-id="heading-12">ï¼ˆ2ï¼‰æ’åºé˜¶æ®µ</h4>
<ul>
<li>å¯¹å¬å›ç»“æœæ‰“åˆ†æ’åºï¼Œè¾“å‡º Top-K æ¨è</li>
<li>ä½¿ç”¨å¤æ‚æ¨¡å‹ï¼ˆå¦‚ DeepFMã€DINã€Transformerï¼‰</li>
<li>è¾“å…¥ï¼šç”¨æˆ·ç‰¹å¾ + ç‰©å“ç‰¹å¾ + ä¸Šä¸‹æ–‡ + äº¤å‰ç‰¹å¾</li>
<li>è¾“å‡ºï¼šç‚¹å‡»ç‡ï¼ˆCTRï¼‰ã€è½¬åŒ–ç‡ï¼ˆCVRï¼‰ç­‰é¢„æµ‹å€¼</li>
</ul>
<blockquote>
<p>é«˜çº§ç³»ç»Ÿå¯èƒ½è¿˜æœ‰é‡æ’ï¼ˆRe-rankingï¼‰é˜¶æ®µï¼Œè€ƒè™‘å¤šæ ·æ€§ã€å…¬å¹³æ€§ã€ä¸šåŠ¡è§„åˆ™ç­‰ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-13">6. è¯„ä¼°ä¸åé¦ˆï¼ˆEvaluation &amp; Feedbackï¼‰</h3>
<h4 data-id="heading-14">ç¦»çº¿è¯„ä¼°æŒ‡æ ‡ï¼š</h4>
<ul>
<li>å‡†ç¡®ç‡ï¼šRMSEï¼ˆè¯„åˆ†é¢„æµ‹ï¼‰ã€Precision@Kã€Recall@Kã€NDCG@K</li>
<li>è¦†ç›–ç‡ã€å¤šæ ·æ€§ã€æ–°é¢–æ€§</li>
</ul>
<h4 data-id="heading-15">åœ¨çº¿è¯„ä¼°ï¼ˆA/Bæµ‹è¯•ï¼‰ï¼š</h4>
<ul>
<li>CTRï¼ˆç‚¹å‡»ç‡ï¼‰ã€è½¬åŒ–ç‡ã€äººå‡è§‚çœ‹æ—¶é•¿ã€GMV ç­‰ä¸šåŠ¡æŒ‡æ ‡</li>
</ul>
<h4 data-id="heading-16">ç”¨æˆ·åé¦ˆé—­ç¯ï¼š</h4>
<ul>
<li>å®æ—¶æ”¶é›†ç”¨æˆ·å¯¹æ¨èç»“æœçš„è¡Œä¸º</li>
<li>ç”¨äºåœ¨çº¿å­¦ä¹ æˆ–æ¨¡å‹å®šæœŸæ›´æ–°</li>
</ul>
<hr/>
<h3 data-id="heading-17">7. åœ¨çº¿æœåŠ¡ä¸æ¨¡å‹æ›´æ–°</h3>
<ul>
<li><strong>å®æ—¶æ¨è</strong>ï¼šä½¿ç”¨æµå¤„ç†ï¼ˆå¦‚ Flinkï¼‰æ›´æ–°ç”¨æˆ·å…´è¶£</li>
<li><strong>æ¨¡å‹éƒ¨ç½²</strong>ï¼šé€šè¿‡ TF Servingã€TorchServe æä¾›åœ¨çº¿é¢„æµ‹</li>
<li><strong>å¢é‡è®­ç»ƒ</strong>ï¼šæ¯æ—¥/æ¯å°æ—¶æ›´æ–°æ¨¡å‹ï¼ˆå¦‚ä½¿ç”¨åœ¨çº¿å­¦ä¹ ç®—æ³•ï¼‰</li>
</ul>
<h2 data-id="heading-18">äºŒã€è¯¦ç»†æµç¨‹è§£æ</h2>
<h3 data-id="heading-19">1. æ¨èç”Ÿæˆï¼šå¬å›ï¼ˆRecallï¼‰ + æ’åºï¼ˆRankingï¼‰</h3>
<p>è¿™ä¸ªæµç¨‹çš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š<strong>ä»æµ·é‡ç‰©å“åº“ä¸­ï¼Œé«˜æ•ˆã€å‡†ç¡®åœ°ä¸ºç”¨æˆ·ç­›é€‰å‡ºä»–ä»¬æœ€å¯èƒ½æ„Ÿå…´è¶£çš„å°‘é‡ç‰©å“ï¼Œå¹¶æœ€ç»ˆä»¥ä½“éªŒè‰¯å¥½çš„æ–¹å¼å‘ˆç°å‡ºæ¥ã€‚</strong></p>
<hr/>
<h4 data-id="heading-20">1. å¬å›ï¼ˆRecallï¼‰</h4>
<ul>
<li>
<p><strong>ç›®æ ‡</strong>ï¼šè§£å†³ç®—æ³•æ•ˆç‡é—®é¢˜ã€‚ä»æ•°ä»¥ç™¾ä¸‡ç”šè‡³åƒä¸‡è®¡çš„ç‰©å“åº“ä¸­ï¼Œå¿«é€Ÿã€ç²—ç•¥åœ°ç­›é€‰å‡ºå‡ ç™¾åˆ°å‡ åƒçš„å€™é€‰é›†åˆï¼Œä¿è¯å¬å›ç‡ï¼ˆå°½é‡ä¸é—æ¼ç”¨æˆ·å¯èƒ½å–œæ¬¢çš„ç‰©å“ï¼‰ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šâ€œæµ·é€‰â€ã€‚ä¸è®¡è¾ƒå•ä¸ªç‰©å“çš„ç²¾ç¡®å¾—åˆ†ï¼Œè€Œæ˜¯åˆ©ç”¨å¤šç§ç­–ç•¥ä»ä¸åŒè§’åº¦â€œæâ€å›å¯èƒ½ç›¸å…³çš„ç‰©å“ã€‚</p>
</li>
<li>
<p><strong>å¸¸ç”¨ç­–ç•¥</strong>ï¼šå·¥ä¸šé€šå¸¸é‡‡ç”¨<strong>å¤šè·¯å¬å›ï¼ˆMulti-tower Recallï¼‰</strong> ï¼Œèåˆå¤šç§ç­–ç•¥ç»“æœï¼Œå†å»é‡åˆå¹¶</p>
<ul>
<li>
<p><strong>åŸºäºååŒè¿‡æ»¤</strong>ï¼šæ ¹æ®ç”¨æˆ·çš„å†å²è¡Œä¸ºï¼ˆå¦‚ç‚¹å‡»ã€è´­ä¹°ï¼‰æ‰¾ç›¸ä¼¼ã€‚</p>
<ul>
<li><strong>ç‰©å“ååŒè¿‡æ»¤</strong>ï¼šâ€œä¹°äº†æ­¤å•†å“çš„äººï¼Œä¹Ÿä¹°äº†XXXâ€ã€‚æ ¹æ®ç‰©å“çš„å…±ç°å…³ç³»è¿›è¡Œæ¨èã€‚</li>
<li><strong>ç”¨æˆ·ååŒè¿‡æ»¤</strong>ï¼šâ€œå’Œä½ ç›¸ä¼¼çš„äººï¼Œä¹Ÿå–œæ¬¢XXXâ€ã€‚æ‰¾åˆ°ç›¸ä¼¼ç”¨æˆ·ï¼Œæ¨èä»–ä»¬å–œæ¬¢çš„ç‰©å“ã€‚</li>
</ul>
</li>
<li>
<p><strong>åŸºäºå†…å®¹</strong>ï¼šæ ¹æ®ç”¨æˆ·å–œæ¬¢çš„ç‰©å“çš„å†…å®¹ç‰¹å¾ï¼ˆå¦‚å…³é”®è¯ã€æ ‡ç­¾ã€ç±»åˆ«ï¼‰æ¥æ¨èç›¸ä¼¼ç‰¹å¾çš„ç‰©å“ã€‚</p>
</li>
<li>
<p><strong>åŸºäºçƒ­ç‚¹</strong>ï¼šæ¨èå½“å‰æœ€çƒ­é—¨ã€æœ€æµè¡Œçš„ç‰©å“ã€‚</p>
</li>
<li>
<p><strong>åŸºäºæ¨¡å‹</strong>ï¼šä½¿ <strong>ç”¨å‘é‡åŒ–æŠ€æœ¯ï¼ˆå¦‚Embeddingï¼‰</strong> å°†ç”¨æˆ·å’Œç‰©å“è¡¨ç¤ºä¸ºå‘é‡ï¼Œé€šè¿‡å‘é‡ç›¸ä¼¼åº¦ï¼ˆå¦‚ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰è¿›è¡Œå¿«é€Ÿæ£€ç´¢ï¼Œ<strong>è¿™æ˜¯ç›®å‰çš„ä¸»æµæ¨¡å‹æ–¹æ³•</strong>ã€‚</p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-21">2. æ’åºï¼ˆRankingï¼‰</h4>
<p>æ’åºé˜¶æ®µé€šå¸¸åˆ†ä¸ºä¸¤æ­¥ï¼šç²—æ’å’Œç²¾æ’ã€‚</p>
<ul>
<li>
<p><strong>ç²—æ’ï¼ˆPre-rankingï¼‰</strong></p>
<ul>
<li><strong>ç›®æ ‡</strong>ï¼šå¯¹å¬å›é˜¶æ®µè¾“å‡ºçš„å‡ ç™¾ä¸Šåƒä¸ªå€™é€‰ç‰©å“è¿›è¡Œåˆæ­¥ç­›é€‰ï¼Œå°†æ•°é‡ç¼©å‡åˆ°å‡ åæˆ–ä¸€ç™¾å·¦å³ï¼Œä¸ºåç»­çš„ç²¾æ’é˜¶æ®µå‡å‹ã€‚</li>
<li><strong>ç‰¹ç‚¹</strong>ï¼šä½¿ç”¨ç›¸å¯¹ç®€å•çš„æ¨¡å‹ï¼ˆå¦‚é€»è¾‘å›å½’ã€æµ…å±‚ç¥ç»ç½‘ç»œï¼‰å’Œå°‘é‡å…³é”®ç‰¹å¾ï¼Œè¿½æ±‚é€Ÿåº¦ã€‚</li>
</ul>
</li>
<li>
<p><strong>ç²¾æ’ï¼ˆRankingï¼‰</strong></p>
<ul>
<li>
<p><strong>ç›®æ ‡</strong>ï¼šè¿™æ˜¯æ¨èç³»ç»Ÿçš„æ ¸å¿ƒï¼Œè§£å†³ç®—æ³•ç²¾å‡†åº¦é—®é¢˜ã€‚å®ƒå¯¹ç²—æ’åçš„å€™é€‰é›†è¿›è¡Œç²¾å‡†çš„ç‚¹å‡»ç‡ï¼ˆCTRï¼‰ã€è½¬åŒ–ç‡ï¼ˆCVRï¼‰ç­‰ç›®æ ‡é¢„æµ‹ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šâ€œå†³èµ›â€ã€‚ä¸ºæ¯ä¸ªç‰©å“è®¡ç®—ä¸€ä¸ªæœ€ç»ˆçš„å¾—åˆ†ã€‚</p>
</li>
<li>
<p><strong>å¸¸ç”¨æ¨¡å‹</strong>ï¼š</p>
<ul>
<li><strong>ä¼ ç»Ÿæ¨¡å‹</strong>ï¼šé€»è¾‘å›å½’ï¼ˆLRï¼‰ã€æ¢¯åº¦æå‡å†³ç­–æ ‘ï¼ˆGBDTï¼‰ã€‚</li>
<li><strong>æ·±åº¦å­¦ä¹ æ¨¡å‹</strong>ï¼š Wide &amp; Deepï¼ˆå…¼é¡¾è®°å¿†ä¸æ³›åŒ–ï¼‰ã€DeepFMï¼ˆè‡ªåŠ¨å­¦ä¹ ç‰¹å¾äº¤å‰ï¼‰ã€DINï¼ˆé’ˆå¯¹ç”¨æˆ·å…´è¶£å¤šæ ·æ€§ï¼‰ç­‰ã€‚è¿™äº›æ¨¡å‹èƒ½å¤Ÿå¤„ç†æµ·é‡ç‰¹å¾å¹¶è¿›è¡Œå¤æ‚çš„éçº¿æ€§æ‹Ÿåˆã€‚</li>
</ul>
</li>
<li>
<p><strong>å…³é”®ç‰¹å¾</strong>ï¼š</p>
<ul>
<li><strong>ç”¨æˆ·ç‰¹å¾</strong>ï¼šå¹´é¾„ã€æ€§åˆ«ã€å…´è¶£æ ‡ç­¾ã€è´­ä¹°åŠ›ç­‰ã€‚</li>
<li><strong>ç‰©å“ç‰¹å¾</strong>ï¼šç±»åˆ«ã€ä»·æ ¼ã€å“ç‰Œã€æ ‡ç­¾ç­‰ã€‚</li>
<li><strong>ä¸Šä¸‹æ–‡ç‰¹å¾</strong>ï¼šæ—¶é—´ã€åœ°ç‚¹ã€å¤©æ°”ã€å½“å‰é¡µé¢ç­‰ã€‚</li>
<li><strong>äº¤å‰ç‰¹å¾</strong>ï¼šç”¨æˆ·ä¸ç‰©å“ä¹‹é—´çš„äº¤äº’ç‰¹å¾ï¼Œæ˜¯æå‡æ¨¡å‹æ•ˆæœçš„å…³é”®ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-22">3. é‡æ’ï¼ˆRe-rankingï¼‰</h4>
<ul>
<li>
<p><strong>ç›®æ ‡</strong>ï¼šåœ¨ç²¾æ’ç”Ÿæˆçš„å¾—åˆ†åˆ—è¡¨åŸºç¡€ä¸Šï¼Œå¼•å…¥ä¸šåŠ¡è§„åˆ™å’Œå¤šæ ·æ€§ç­–ç•¥ï¼Œè°ƒæ•´æœ€ç»ˆå±•ç¤ºç»™ç”¨æˆ·çš„åˆ—è¡¨é¡ºåºï¼Œæå‡ç”¨æˆ·ä½“éªŒå’Œä¸šåŠ¡æŒ‡æ ‡ã€‚</p>
</li>
<li>
<p><strong>å¸¸ç”¨ç­–ç•¥</strong>ï¼š</p>
<ul>
<li><strong>å»é‡</strong>ï¼šå»é™¤ç”¨æˆ·å·²ç»çœ‹è¿‡ã€ä¹°è¿‡æˆ–æ˜ç¡®ä¸å–œæ¬¢çš„ç‰©å“ã€‚</li>
<li><strong>å¤šæ ·æ€§</strong>ï¼šé¿å…æ¨èåˆ—è¡¨ä¸­å‡ºç°è¿‡å¤šåŒè´¨åŒ–ç‰©å“ï¼ˆä¾‹å¦‚ï¼Œå…¨æ˜¯åŒä¸€å“ç‰Œçš„æ‰‹æœºï¼‰ã€‚</li>
<li><strong>æ–°é¢–æ€§</strong>ï¼šé€‚å½“ç»™æ–°ç‰©å“æˆ–å†·é—¨ç‰©å“ä¸€äº›æ›å…‰æœºä¼šã€‚</li>
<li><strong>ä¸šåŠ¡è§„åˆ™</strong>ï¼šå¦‚ä¿è¯æŸäº›æˆ˜ç•¥å•†å“çš„æ›å…‰ä½ç½®ã€è¿›è¡Œå•†ä¸šå¼•æµç­‰ã€‚</li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯è½®å­ï¼ˆ1ï¼‰--å‰ç«¯éƒ¨ç½²å-åˆ¤æ–­é¡µé¢æ˜¯å¦ä¸ºæœ€æ–°]]></title>    <link>https://juejin.cn/post/7585706951603601434</link>    <guid>https://juejin.cn/post/7585706951603601434</guid>    <pubDate>2025-12-21T02:18:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585706951603601434" data-draft-id="7585463258690502665" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯è½®å­ï¼ˆ1ï¼‰--å‰ç«¯éƒ¨ç½²å-åˆ¤æ–­é¡µé¢æ˜¯å¦ä¸ºæœ€æ–°"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js,Node.js"/> <meta itemprop="datePublished" content="2025-12-21T02:18:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å°æ˜“"/> <meta itemprop="url" content="https://juejin.cn/user/2032344744857127"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯è½®å­ï¼ˆ1ï¼‰--å‰ç«¯éƒ¨ç½²å-åˆ¤æ–­é¡µé¢æ˜¯å¦ä¸ºæœ€æ–°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2032344744857127/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å°æ˜“
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T02:18:14.000Z" title="Sun Dec 21 2025 02:18:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>å‰ç«¯è½®å­ç³»åˆ—ï¼š</p>
<ol>
<li><a href="https://juejin.cn/spost/7585706951603601434" target="_blank" title="https://juejin.cn/spost/7585706951603601434">å‰ç«¯éƒ¨ç½²å-åˆ¤æ–­é¡µé¢æ˜¯å¦ä¸ºæœ€æ–°</a></li>
<li>å¦‚ä½•ä¼˜é›…diyå“åº”æ•°æ®</li>
<li>å¦‚ä½•ä¼˜é›…è¿›è¡Œwebviewè°ƒè¯•</li>
<li>å¦‚ä½•å®ç°æµ‹è¯•ç¯å¢ƒçš„è‡ªåŠ¨ç™»å½•</li>
<li/>
</ol>
</blockquote>
<blockquote>
<p>é¡¹ç›®éƒ¨ç½²åï¼šé€šçŸ¥æ›´æ–°ã€å¼ºåˆ¶åˆ·æ–°ã€è‡ªæµ‹è®¿é—®çš„é¡µé¢ä¸ºæœ€æ–°ä»£ç ï¼ˆæ˜¯å¦å‘ç‰ˆæˆåŠŸï¼‰<br/>
é‡ç‚¹ï¼š<strong>è‡ªæµ‹ã€ææµ‹ã€ä¿®æ”¹bug</strong>åï¼Œç¡®è®¤è®¿é—®çš„ä¸º<strong>æœ€æ–°é¡µé¢</strong></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e5d14d5dcee4533938fe6b167aab982~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5bCP5piT:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766888338&amp;x-signature=CZ5zNZQsNzIVWwr9mEh1fKlvH6M%3D" alt="check-version.gif" loading="lazy"/></p>
<h2 data-id="heading-0">å®ç°æ€è·¯</h2>
<p>ç›®çš„ï¼šç”Ÿæˆæ–°çš„ç‰ˆæœ¬æ ‡è¯†ï¼Œé€šè¿‡å¯¹æ¯”æ ‡è¯† ==&gt; å½“å‰ä¸ºæœ€æ–° è¿˜æ˜¯ æ—§é¡µé¢</p>
<ol>
<li>ç”Ÿæˆç‰ˆæœ¬å·ï¼šå¦‚ï¼š1.1.10 ï¼Œæˆ–è€…æ—¶é—´æˆ³ï¼ˆ202512201416ï¼‰
<ul>
<li>è‡ªåŠ¨åŒ–è„šæœ¬ç”Ÿæˆ</li>
<li>æ‰‹åŠ¨æ§åˆ¶</li>
</ul>
</li>
<li>å¯¹æ¯”ç‰ˆæœ¬å·ï¼šç›¸ç­‰=&gt; å½“å‰ä¸ºæœ€æ–°ï¼›ä¸ç­‰ =&gt; å½“å‰ä¸ºæ—§é¡µé¢</li>
<li>é€šè¿‡å¯¹æ¯”ç»“æœ å¯¹åº”å¤„ç†äº§å“é€»è¾‘ å®Œäº‹å„¿~</li>
</ol>
<h2 data-id="heading-1">å…·ä½“å®ç°</h2>
<h3 data-id="heading-2">æ–¹æ¡ˆä¸€ï¼šç”Ÿæˆæ—¶é—´æˆ³ï¼Œæ³¨å…¥å˜é‡ï¼Œæ§åˆ¶å°æ‰“å°</h3>
<h4 data-id="heading-3">åœ¨vue-clié¡¹ç›®ä¸­</h4>
<p>é€šè¿‡vue.config.js å…¥å˜é‡<br/>
ç„¶ååœ¨main.jsä¸­æ‰“å°å˜é‡</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'__BUILD_TIME__'</span>, __BUILD_TIME__)
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vue.config.js</span>
<span class="hljs-keyword">const</span> _date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BUILD_TIME</span> = _date.<span class="hljs-property">toLocaleString</span> ? _date.<span class="hljs-title function_">toLocaleString</span>() : _date.<span class="hljs-title function_">getTime</span>()

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">configureWebpack</span>: {
    <span class="hljs-attr">plugins</span>: [
      <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">DefinePlugin</span>({
        <span class="hljs-attr">__BUILD_TIME__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable constant_">BUILD_TIME</span>)
      })
    ]
  },
}

</code></pre>
<h4 data-id="heading-4">åœ¨viteé¡¹ç›®ä¸­</h4>
<p>é€šè¿‡vite.config.js æ³¨å…¥ <strong>BUILD_TIME</strong> å˜é‡<br/>
ç„¶ååœ¨main.jsä¸­æ‰“å° <strong>BUILD_TIME</strong> å˜é‡</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'__BUILD_TIME__'</span>, __BUILD_TIME__)
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">const</span> _date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BUILD_TIME</span> = _date.<span class="hljs-property">toLocaleString</span> ? _date.<span class="hljs-title function_">toLocaleString</span>() : _date.<span class="hljs-title function_">getTime</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">define</span>: {
      <span class="hljs-attr">__BUILD_TIME__</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable constant_">BUILD_TIME</span>)
    },
  }
})
</code></pre>
<p>è¿™ç§æ–¹æ¡ˆï¼Œå®ç°äº†åœ¨æ§åˆ¶å°æ‰“å°ã€‚ä½†æ˜¯å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œæ— æ³•åšåˆ°ç‰ˆæœ¬å·çš„å¯¹æ¯”<br/>
ä¸ºå•¥ï¼Ÿ å› ä¸ºä¸Šçº¿ ä¸€èˆ¬ä¼šå»æ‰æ—¥å¿—çš„æ‰“å°ï¼Œ æ‰€ä»¥å’±é€šè¿‡ç‰ˆæœ¬å·æ¥~</p>
<h3 data-id="heading-5">æ–¹æ¡ˆäºŒï¼šè®°å½•ç‰ˆæœ¬å·ï¼Œè½®è¯¢å¯¹æ¯”ç‰ˆæœ¬å·</h3>
<ol>
<li>ç¼–å†™ç”Ÿæˆç‰ˆæœ¬å·çš„è„šæœ¬ï¼Œç”Ÿæˆç‰ˆæœ¬å·æ–‡ä»¶</li>
<li>buildç»“æŸï¼Œè°ƒç”¨è„šæœ¬å»ç”Ÿæˆç‰ˆæœ¬å·æ–‡ä»¶</li>
<li>è½®è¯¢å¯¹æ¯”ç‰ˆæœ¬å·æ–‡ä»¶ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œåšç›¸åº”æ“ä½œ</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// dist/version.json</span>
{
  <span class="hljs-string">"buildTime"</span>: <span class="hljs-string">"2025-12-20 14:16:00"</span>
}
</code></pre>
<p><strong>prebuild</strong>: buildå‰æ‰§è¡Œçš„è„šæœ¬<br/>
<strong>postbuild</strong>ï¼šbuildç»“æŸåæ‰§è¡Œçš„è„šæœ¬ï¼Œç”¨äºç”Ÿæˆç‰ˆæœ¬å·æ–‡ä»¶</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// package.json</span>
{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"postbuild"</span>: <span class="hljs-string">"node scripts/generate-version-dist.mjs"</span>
  }
}
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// scripts/generate-version-dist.mjs</span>
<span class="hljs-keyword">import</span> { writeFile } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:fs/promises'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'node:path'</span>
<span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:url'</span>

<span class="hljs-keyword">const</span> __filename = <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)
<span class="hljs-keyword">const</span> __dirname = path.<span class="hljs-title function_">dirname</span>(__filename)
<span class="hljs-keyword">const</span> root = path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'..'</span>)


<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> _date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BUILD_TIME</span> = _date.<span class="hljs-property">toLocaleString</span> ? _date.<span class="hljs-title function_">toLocaleString</span>() : _date.<span class="hljs-title function_">getTime</span>()

  <span class="hljs-keyword">const</span> outPath = path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'dist'</span>, <span class="hljs-string">'version.json'</span>)
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">writeFile</span>(outPath, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-variable constant_">BUILD_TIME</span> }, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>) + <span class="hljs-string">'\n'</span>, <span class="hljs-string">'utf-8'</span>)

}

<span class="hljs-title function_">main</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'[generate-version] failed'</span>, e)
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>)
})
</code></pre>
<h4 data-id="heading-6">è½®è¯¢å¯¹æ¯”ç‰ˆæœ¬å·</h4>
<ol>
<li>è½®è¯¢å¯¹æ¯”ç‰ˆæœ¬å·æ–‡ä»¶ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œåšç›¸åº”æ“ä½œ</li>
<li>é¡µé¢éšè—ã€åˆ‡åå°æ—¶ï¼Œåœæ­¢è½®è¯¢ï¼Œé¡µé¢å…³é—­æ—¶ï¼Œåœæ­¢è½®è¯¢</li>
<li>é¡µé¢æ˜¾ç¤ºã€åˆ‡å‰å°æ—¶ï¼Œå¼€å§‹è½®è¯¢</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.js</span>
<span class="hljs-keyword">import</span> { createVersionPoller } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils/versionPoller'</span>
<span class="hljs-title function_">createVersionPoller</span>({
  <span class="hljs-attr">versionUrl</span>: <span class="hljs-string">'/version.json'</span>,
  <span class="hljs-attr">storageKey</span>: <span class="hljs-string">'__VERSION_CHECK__CURRENT_BUILD_TIME__'</span>,
  <span class="hljs-attr">intervalMs</span>: <span class="hljs-number">15_000</span>,
  <span class="hljs-attr">maxDelayMs</span>: <span class="hljs-number">60_000</span>,
  <span class="hljs-attr">onResult</span>: <span class="hljs-function">(<span class="hljs-params">{ remoteVersion, remoteBuildTime }</span>) =&gt;</span> {
    <span class="hljs-comment">// è½®è¯¢åˆ°jsonæ–‡ä»¶ æˆåŠŸï¼Œé¢å¤–å¤„ç†é€»è¾‘</span>
  },
  <span class="hljs-attr">onError</span>: <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-comment">// è½®è¯¢å¤±è´¥ï¼Œé¢å¤–å¤„ç†é€»è¾‘</span>
  },
  <span class="hljs-attr">onUpdate</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// ç‰ˆæœ¬å·ä¸ä¸€è‡´ï¼Œéœ€è¦æ›´æ–°ï¼Œé¢å¤–å¤„ç†é€»è¾‘</span>
  }
}).<span class="hljs-title function_">start</span>()


</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * è½®è¯¢ /version.jsonï¼Œå¯¹æ¯” buildTime åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ï¼ˆsetTimeout + é”™è¯¯æŒ‡æ•°é€€è®©ï¼‰
 *
 * è¡Œä¸ºè¯´æ˜ï¼š
 * - start() ä¼šè‡ªåŠ¨æ³¨å†Œç›‘å¬ï¼švisibilitychange / beforeunload / unload
 * - stop() ä¼šæ¸…ç†å®šæ—¶å™¨å¹¶å¸è½½ç›‘å¬
 * - è¯·æ±‚å¤±è´¥ä¼šæŒ‡æ•°é€€è®©ï¼ˆdelay *= 2ï¼Œæœ€å¤§ä¸è¶…è¿‡ maxDelayMsï¼‰ï¼›æˆåŠŸåæ¢å¤ intervalMs
 * - currentBuildTime ä¼šå†™å…¥ localStorageï¼ˆstorageKeyï¼‰
 *
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">options</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [options.versionUrl='/version.json'] ç‰ˆæœ¬æ–‡ä»¶åœ°å€
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} [options.storageKey='__VERSION_CHECK__CURRENT_BUILD_TIME__'] localStorage key
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} [options.intervalMs=15000] æ­£å¸¸è½®è¯¢é—´éš”ï¼ˆæ¯«ç§’ï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} [options.maxDelayMs=60000] é€€è®©æœ€å¤§é—´éš”ï¼ˆæ¯«ç§’ï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">(info:{localBuildTime:string,remoteBuildTime:string,remoteVersion:string,data:any</span>})=&gt;void} [options.onResult] æ¯æ¬¡æˆåŠŸæ‹‰å–åçš„å›è°ƒ
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">(error:any)=&gt;void</span>} [options.onError] æ‹‰å–å¤±è´¥å›è°ƒ
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">(info:{localBuildTime:string,remoteBuildTime:string,remoteVersion:string,data:any</span>})=&gt;void} [options.onUpdate] å‘ç°æ–° buildTime æ—¶å›è°ƒï¼ˆé»˜è®¤ä¼š stopï¼‰
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createVersionPoller</span>(<span class="hljs-params">{
  versionUrl = <span class="hljs-string">'/version.json'</span>,
  storageKey = <span class="hljs-string">'__VERSION_CHECK__CURRENT_BUILD_TIME__'</span>,
  intervalMs = <span class="hljs-number">15000</span>,
  maxDelayMs = <span class="hljs-number">60000</span>,
  onResult,
  onError,
  onUpdate
} = {}</span>) {
  <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">let</span> stopped = <span class="hljs-literal">true</span>
  <span class="hljs-keyword">let</span> delayMs = intervalMs
  <span class="hljs-keyword">let</span> bound = <span class="hljs-literal">false</span>

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">readLocal</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">getItem</span>(storageKey) || <span class="hljs-string">''</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">writeLocal</span> = (<span class="hljs-params">v</span>) =&gt; v &amp;&amp; <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>.<span class="hljs-title function_">setItem</span>(storageKey, <span class="hljs-title class_">String</span>(v))

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">clear</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!timer) <span class="hljs-keyword">return</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">clearTimeout</span>(timer)
    timer = <span class="hljs-literal">null</span>
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">isVisible</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">document</span>.<span class="hljs-property">visibilityState</span> !== <span class="hljs-string">'hidden'</span>
  }

  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchRemote</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> sep = versionUrl.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'?'</span>) ? <span class="hljs-string">'&amp;'</span> : <span class="hljs-string">'?'</span>
    <span class="hljs-keyword">const</span> url = <span class="hljs-string">`<span class="hljs-subst">${versionUrl}</span><span class="hljs-subst">${sep}</span>t=<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>`</span>
    <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url, { <span class="hljs-attr">cache</span>: <span class="hljs-string">'no-store'</span>, <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Cache-Control'</span>: <span class="hljs-string">'no-cache'</span> } })
    <span class="hljs-keyword">if</span> (!res.<span class="hljs-property">ok</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`fetch <span class="hljs-subst">${versionUrl}</span> failed: <span class="hljs-subst">${res.status}</span>`</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>()
  }

  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">tick</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (stopped || !<span class="hljs-title function_">isVisible</span>()) <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">const</span> localBuildTime = <span class="hljs-title function_">readLocal</span>() || <span class="hljs-string">''</span>

    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchRemote</span>()
      <span class="hljs-keyword">const</span> remoteVersion = <span class="hljs-title class_">String</span>(data?.<span class="hljs-property">version</span> || <span class="hljs-string">''</span>)
      <span class="hljs-keyword">const</span> remoteBuildTime = <span class="hljs-title class_">String</span>(data?.<span class="hljs-property">BUILD_TIME</span> || <span class="hljs-string">''</span>)

      delayMs = intervalMs
      onResult?.({ localBuildTime, remoteBuildTime, remoteVersion, data })

      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>( remoteBuildTime , <span class="hljs-string">'=&gt;'</span>, localBuildTime)

      <span class="hljs-keyword">if</span> (remoteBuildTime &amp;&amp; remoteBuildTime !== localBuildTime) {
        <span class="hljs-comment">// è®°å½•æœ€æ–° buildTimeï¼Œé¿å…é‡å¤æç¤ºåŒä¸€ä¸ªæ›´æ–°</span>
        <span class="hljs-title function_">writeLocal</span>(remoteBuildTime)
        onUpdate?.({ localBuildTime, remoteBuildTime, remoteVersion, data })
      }
    } <span class="hljs-keyword">catch</span> (e) {
      delayMs = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(maxDelayMs, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">500</span>, delayMs * <span class="hljs-number">2</span>))
      onError?.(e)
    }

    timer = <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">setTimeout</span>(tick, delayMs)
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">onVisibilityChange</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (stopped) <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isVisible</span>()) <span class="hljs-keyword">return</span> <span class="hljs-title function_">clear</span>()
    <span class="hljs-title function_">clear</span>()
    timer = <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">setTimeout</span>(tick, <span class="hljs-number">0</span>)
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">ensureBound</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (bound) <span class="hljs-keyword">return</span>
    bound = <span class="hljs-literal">true</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'visibilitychange'</span>, onVisibilityChange)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'beforeunload'</span>, stop)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'unload'</span>, stop)
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">ensureUnbound</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!bound) <span class="hljs-keyword">return</span>
    bound = <span class="hljs-literal">false</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'visibilitychange'</span>, onVisibilityChange)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'beforeunload'</span>, stop)
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'unload'</span>, stop)
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!stopped) <span class="hljs-keyword">return</span>
    stopped = <span class="hljs-literal">false</span>
    delayMs = intervalMs
    <span class="hljs-title function_">ensureBound</span>()
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isVisible</span>()) timer = <span class="hljs-variable language_">window</span>.<span class="hljs-built_in">setTimeout</span>(tick, <span class="hljs-number">0</span>)
  }

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"/>) {
    stopped = <span class="hljs-literal">true</span>
    <span class="hljs-title function_">clear</span>()
    <span class="hljs-title function_">ensureUnbound</span>()
  }

  <span class="hljs-keyword">return</span> { start, stop }
}

</code></pre>
<h2 data-id="heading-7">æ³¨æ„ç‚¹</h2>
<ul>
<li>è½®è¯¢ç‰ˆæœ¬æ–‡ä»¶ï¼Œæ‹¼ æ—¶é—´æˆ³ã€è®¾ç½®è¯·æ±‚å¤´ é¿å…å‘½ä¸­ç¼“å­˜</li>
<li>è½®è¯¢ç‰ˆæœ¬æ–‡ä»¶ï¼Œæ—¶é—´é—´éš”ä¸è¦å¤ªçŸ­ï¼Œè€—è´¹ç½‘ç»œï¼Œè™½ç„¶å·²ç»åšäº†è½®è¯¢æŒ‡æ•°é€€è®©</li>
<li>ç”Ÿæˆçš„ç‰ˆæœ¬æ–‡ä»¶ ç”Ÿæˆåˆ°distä¸‹ æ³¨æ„è®¿é—®è·¯å¾„</li>
<li>ç‰ˆæœ¬å·éœ€è¦ä¸Šä¼ åˆ°gitï¼Œéœ€è¦æ‰‹åŠ¨æ‰§è¡Œè„šæœ¬&amp;commit + push</li>
</ul>
<h2 data-id="heading-8">æºç </h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaoyi1255%2Fversion-check" target="_blank" title="https://github.com/xiaoyi1255/version-check" ref="nofollow noopener noreferrer">xiaoyi1255</a></p>
<h2 data-id="heading-9">ç»“è¯­</h2>
<p>å¦‚æœæœ¬æ–‡å¯¹ä½ æœ‰æ”¶è·ï¼Œéº»çƒ¦åŠ¨åŠ¨å‘è´¢çš„å°æ‰‹ï¼Œç‚¹ç‚¹å…³æ³¨ã€ç‚¹ç‚¹èµï¼ï¼ï¼ğŸ‘»ğŸ‘»ğŸ‘»</p>
<p>å› ä¸ºæ”¶è—===ä¼šäº†</p>
<p>å¦‚æœæœ‰ä¸å¯¹ã€æ›´å¥½çš„æ–¹å¼å®ç°ã€å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹æ¬¢è¿åœ¨è¯„è®ºåŒºæŒ‡å‡ºï¼Œè°¢è°¢ğŸ‘¾ğŸ‘¾ğŸ‘¾</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[G1ä¸ZGCåƒåœ¾æ”¶é›†å™¨æ·±åº¦å‰–æ]]></title>    <link>https://juejin.cn/post/7585474459776696356</link>    <guid>https://juejin.cn/post/7585474459776696356</guid>    <pubDate>2025-12-20T10:26:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459776696356" data-draft-id="7585474459776679972" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="G1ä¸ZGCåƒåœ¾æ”¶é›†å™¨æ·±åº¦å‰–æ"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-20T10:26:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç„¡é‡"/> <meta itemprop="url" content="https://juejin.cn/user/1116759546145086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            G1ä¸ZGCåƒåœ¾æ”¶é›†å™¨æ·±åº¦å‰–æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759546145086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç„¡é‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T10:26:21.000Z" title="Sat Dec 20 2025 10:26:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»33åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>G1å’ŒZGCæ˜¯ç°ä»£Javaåº”ç”¨çš„é¦–é€‰åƒåœ¾æ”¶é›†å™¨,ä»£è¡¨äº†GCæŠ€æœ¯çš„æ¼”è¿›æ–¹å‘ã€‚G1é€šè¿‡Regionåˆ†åŒºå’Œå¯é¢„æµ‹åœé¡¿,åœ¨JDK 9åæˆä¸ºé»˜è®¤æ”¶é›†å™¨,é€‚åˆ4GBä»¥ä¸Šå †å†…å­˜ã€è¿½æ±‚å¹³è¡¡æ€§èƒ½çš„åº”ç”¨;ZGCåˆ™é€šè¿‡æŸ“è‰²æŒ‡é’ˆå’Œå¹¶å‘é‡å®šä½æŠ€æœ¯,å®ç°æ¥è¿‘é›¶åœé¡¿(&lt; 10ms),ä¸“ä¸ºè¶…å¤§å †(TBçº§)å’Œæä½å»¶è¿Ÿåœºæ™¯è®¾è®¡ã€‚æœ¬æ–‡ä»ç†è®ºåˆ°å®æˆ˜,æ·±åº¦å‰–æä¸¤è€…çš„æ ¸å¿ƒåŸç†(Regionè®¾è®¡ã€RSetã€SATBã€æŸ“è‰²æŒ‡é’ˆã€å¤šé‡æ˜ å°„)ã€GCæµç¨‹ã€å‚æ•°è°ƒä¼˜,å¹¶é€šè¿‡ç”Ÿäº§æ¡ˆä¾‹å¯¹æ¯”åˆ†æ,å¸®åŠ©è¯»è€…åœ¨å®é™…é¡¹ç›®ä¸­é€‰æ‹©åˆé€‚çš„æ”¶é›†å™¨,æŒæ¡æ€§èƒ½è°ƒä¼˜æŠ€å·§ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€ç†è®ºèƒŒæ™¯ä¸æ¼”è¿›</h2>
<h3 data-id="heading-2">1.1 ä¼ ç»ŸGCçš„ç—›ç‚¹</h3>
<p>åœ¨G1å’ŒZGCå‡ºç°ä¹‹å‰,Javaåº”ç”¨ä¸»è¦ä½¿ç”¨Serialã€Parallelå’ŒCMSæ”¶é›†å™¨ã€‚è¿™äº›ä¼ ç»ŸGCå­˜åœ¨æ˜¾è‘—ç—›ç‚¹:</p>
<p><strong>Serial GC (ä¸²è¡Œæ”¶é›†å™¨)</strong>:</p>
<ul>
<li>å•çº¿ç¨‹æ”¶é›†,Stop-The-Worldæ—¶é—´é•¿</li>
<li>é€‚ç”¨åœºæ™¯: Clientæ¨¡å¼,å•æ ¸CPUç¯å¢ƒ</li>
<li>ç—›ç‚¹: ç”Ÿäº§ç¯å¢ƒä¸å¯æ¥å—,åœé¡¿æ—¶é—´è¾¾ç§’çº§</li>
</ul>
<p><strong>Parallel GC (å¹¶è¡Œæ”¶é›†å™¨)</strong>:</p>
<ul>
<li>å¤šçº¿ç¨‹å¹¶è¡Œ,ååé‡ä¼˜å…ˆ</li>
<li>é€‚ç”¨åœºæ™¯: åå°è®¡ç®—,æ‰¹å¤„ç†ä»»åŠ¡</li>
<li>ç—›ç‚¹: Full GCæ—¶STWæ—¶é—´é•¿,å †è¶Šå¤§åœé¡¿è¶Šä¹…(8GBå †å¯è¾¾2-5ç§’)</li>
</ul>
<p><strong>CMS GC (å¹¶å‘æ ‡è®°æ¸…é™¤)</strong>:</p>
<ul>
<li>ä½å»¶è¿Ÿ,å¤§éƒ¨åˆ†é˜¶æ®µå¹¶å‘æ‰§è¡Œ</li>
<li>é€‚ç”¨åœºæ™¯: äº’è”ç½‘åº”ç”¨,è¦æ±‚ä½åœé¡¿</li>
<li>ç—›ç‚¹:
<ul>
<li><strong>CPUæ•æ„Ÿ</strong>: å¹¶å‘é˜¶æ®µå ç”¨CPU,é™ä½ååé‡</li>
<li><strong>æµ®åŠ¨åƒåœ¾</strong>: å¹¶å‘æ¸…é™¤æ—¶äº§ç”Ÿçš„æ–°åƒåœ¾æ— æ³•å›æ”¶</li>
<li><strong>å†…å­˜ç¢ç‰‡</strong>: æ ‡è®°-æ¸…é™¤ç®—æ³•,ä¸æ•´ç†ç¢ç‰‡,å¯èƒ½æå‰è§¦å‘Full GC</li>
<li><strong>Concurrent Mode Failure</strong>: å¹¶å‘æ ‡è®°æœªå®Œæˆè€å¹´ä»£å·²æ»¡,é€€åŒ–ä¸ºSerial Old,åœé¡¿æ—¶é—´æ›´é•¿</li>
</ul>
</li>
</ul>
<p><strong>æ ¸å¿ƒçŸ›ç›¾</strong>:</p>
<p>ä¼ ç»ŸGCé¢ä¸´"ä¸å¯èƒ½ä¸‰è§’":</p>
<ul>
<li><strong>ååé‡</strong> (Throughput): è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´å æ¯”</li>
<li><strong>å»¶è¿Ÿ</strong> (Latency): GCåœé¡¿æ—¶é—´</li>
<li><strong>å †å¤§å°</strong> (Heap Size): æ”¯æŒçš„æœ€å¤§å †å†…å­˜</li>
</ul>
<p>ä¼ ç»ŸGCåªèƒ½åœ¨ä¸‰è€…ä¸­é€‰æ‹©ä¸¤ä¸ª,æ— æ³•å…¼é¡¾ã€‚ä¾‹å¦‚:</p>
<ul>
<li>Parallel GC: é«˜ååé‡ + æ”¯æŒå¤§å †,ä½†å»¶è¿Ÿé«˜</li>
<li>CMS: ä½å»¶è¿Ÿ + æ”¯æŒä¸­ç­‰å †,ä½†ååé‡ä¸‹é™ä¸”æœ‰ç¢ç‰‡é—®é¢˜</li>
</ul>
<h3 data-id="heading-3">1.2 G1çš„è¯ç”ŸèƒŒæ™¯</h3>
<p><strong>G1 (Garbage-First)</strong> äºJDK 7å¼•å…¥,JDK 9æˆä¸ºé»˜è®¤æ”¶é›†å™¨,ç›®æ ‡æ˜¯æ‰“ç ´ä¼ ç»ŸGCçš„é™åˆ¶:</p>
<p><strong>è®¾è®¡ç›®æ ‡</strong>:</p>
<ol>
<li><strong>å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´</strong>: é€šè¿‡<code>-XX:MaxGCPauseMillis</code>è®¾ç½®åœé¡¿ç›®æ ‡(è½¯ç›®æ ‡)</li>
<li><strong>é€‚åº”å¤§å †</strong>: æ”¯æŒå‡ åGBå †,Full GCæ—¶é—´å¯æ§</li>
<li><strong>å¹³è¡¡ååé‡å’Œå»¶è¿Ÿ</strong>: ä¸ç‰ºç‰²å¤ªå¤šååé‡çš„å‰æä¸‹,é™ä½åœé¡¿æ—¶é—´</li>
</ol>
<p><strong>æ ¸å¿ƒåˆ›æ–°</strong>:</p>
<ul>
<li><strong>Regionåˆ†åŒº</strong>: å°†å †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„Region,ä¸å†å›ºå®šåˆ†ä»£è¾¹ç•Œ</li>
<li><strong>Garbage-Firstç­–ç•¥</strong>: ä¼˜å…ˆå›æ”¶åƒåœ¾æœ€å¤šçš„Region,åœ¨åœé¡¿æ—¶é—´å…è®¸èŒƒå›´å†…æœ€å¤§åŒ–å›æ”¶æ•ˆæœ</li>
<li><strong>å¢é‡å›æ”¶</strong>: æ¯æ¬¡åªå›æ”¶éƒ¨åˆ†Region,é¿å…å…¨å †æ‰«æ</li>
</ul>
<h3 data-id="heading-4">1.3 ZGCçš„è¯ç”ŸèƒŒæ™¯</h3>
<p><strong>ZGC (Z Garbage Collector)</strong> äºJDK 11å¼•å…¥(å®éªŒæ€§),JDK 15è½¬æ­£,ç›®æ ‡æ˜¯å®ç°è¶…ä½å»¶è¿Ÿ:</p>
<p><strong>è®¾è®¡ç›®æ ‡</strong>:</p>
<ol>
<li><strong>æä½åœé¡¿</strong>: åœé¡¿æ—¶é—´ &lt; 10ms,ä¸å †å¤§å°æ— å…³</li>
<li><strong>æ”¯æŒè¶…å¤§å †</strong>: 4TBä»¥ä¸Šå †,åœé¡¿æ—¶é—´ä¾ç„¶åœ¨10msä»¥å†…</li>
<li><strong>é«˜ååé‡</strong>: åœé¡¿æ—¶é—´é™ä½çš„åŒæ—¶,ååé‡æŸå¤±æ§åˆ¶åœ¨15%ä»¥å†…</li>
</ol>
<p><strong>æ ¸å¿ƒåˆ›æ–°</strong>:</p>
<ul>
<li><strong>æŸ“è‰²æŒ‡é’ˆ</strong> (Colored Pointers): å°†GCä¿¡æ¯å­˜å‚¨åœ¨æŒ‡é’ˆä¸­,è€Œä¸æ˜¯å¯¹è±¡å¤´</li>
<li><strong>è¯»å±éšœ</strong> (Load Barrier): å¯¹è±¡è®¿é—®æ—¶é€šè¿‡è¯»å±éšœè‡ªåŠ¨å¤„ç†é‡å®šä½</li>
<li><strong>å¹¶å‘é‡å®šä½</strong>: å¯¹è±¡ç§»åŠ¨ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œ,æ— éœ€STW</li>
<li><strong>å¤šé‡æ˜ å°„</strong>: åŒä¸€ç‰©ç†å†…å­˜æ˜ å°„åˆ°å¤šä¸ªè™šæ‹Ÿåœ°å€,å®ç°å¹¶å‘å®‰å…¨</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯</strong>:</p>
<ul>
<li>ä½å»¶è¿Ÿè¦æ±‚æé«˜çš„åº”ç”¨ (é‡‘èäº¤æ˜“ã€å®æ—¶ç³»ç»Ÿ)</li>
<li>è¶…å¤§å †å†…å­˜åº”ç”¨ (å‡ åGBåˆ°TBçº§)</li>
<li>è¿½æ±‚æè‡´ç”¨æˆ·ä½“éªŒçš„äº’è”ç½‘åº”ç”¨</li>
</ul>
<hr/>
<h2 data-id="heading-5">äºŒã€G1åƒåœ¾æ”¶é›†å™¨åŸç†</h2>
<h3 data-id="heading-6">2.1 G1çš„æ•´ä½“æ¶æ„</h3>
<p>G1çš„æ ¸å¿ƒè®¾è®¡æ€æƒ³æ˜¯"åŒ–æ•´ä¸ºé›¶",å°†å †åˆ’åˆ†ä¸ºå¤šä¸ªRegion,æ‰“ç ´ä¼ ç»Ÿåˆ†ä»£GCçš„å›ºå®šè¾¹ç•Œã€‚</p>
<h4 data-id="heading-7">2.1.1 Regionåˆ†åŒºè®¾è®¡</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1854670ba37c4decbceda4d0454108d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831181&amp;x-signature=lJK%2FJIW3pJkAJ4CHeSg6SoL3dQ4%3D" alt="g1-region-structure.svg" loading="lazy"/></p>
<p><strong>Regionæ˜¯G1çš„åŸºæœ¬å•ä½</strong>:</p>
<ul>
<li>å°†å †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„Region(é»˜è®¤2048ä¸ª)</li>
<li>Regionå¤§å° = å †å¤§å° / 2048 (å‘ä¸Šå–2çš„å¹‚)</li>
<li>èŒƒå›´: 1MB ~ 32MB,å¿…é¡»æ˜¯2çš„å¹‚</li>
</ul>
<p><strong>Regionå¤§å°è®¡ç®—ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-ini" lang="ini">å †8GB:  Regionå¤§å° = 8GB / 2048 â‰ˆ 4MB
å †16GB: Regionå¤§å° = 16GB / <span class="hljs-attr">2048</span> = <span class="hljs-number">8</span>MB
å †32GB: Regionå¤§å° = 32GB / <span class="hljs-attr">2048</span> = <span class="hljs-number">16</span>MB
</code></pre>
<p><strong>æ‰‹åŠ¨è®¾ç½®Regionå¤§å°</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">-XX:G1HeapRegionSize=8m  <span class="hljs-comment"># è®¾ç½®Regionå¤§å°ä¸º8MB</span>
</code></pre>
<p><strong>Regionç±»å‹</strong>:</p>
<p>G1ä¸­çš„Regionå¯ä»¥åŠ¨æ€åˆ†é…ä¸ºä¸åŒç±»å‹:</p>
<ol>
<li>
<p><strong>Eden Region (EdenåŒº)</strong>:</p>
<ul>
<li>æ–°å¯¹è±¡åˆ†é…çš„åŒºåŸŸ</li>
<li>Young GCæ—¶å…¨éƒ¨æ¸…ç©º</li>
</ul>
</li>
<li>
<p><strong>Survivor Region (SurvivoråŒº)</strong>:</p>
<ul>
<li>Young GCåå­˜æ´»å¯¹è±¡çš„åŒºåŸŸ</li>
<li>é‡‡ç”¨å¤åˆ¶ç®—æ³•,From/Toè§’è‰²äº’æ¢</li>
</ul>
</li>
<li>
<p><strong>Old Region (è€å¹´ä»£åŒº)</strong>:</p>
<ul>
<li>å­˜æ”¾æ™‹å‡å¯¹è±¡</li>
<li>Mixed GCæ—¶éƒ¨åˆ†å›æ”¶</li>
</ul>
</li>
<li>
<p><strong>Humongous Region (å¤§å¯¹è±¡åŒº)</strong>:</p>
<ul>
<li>å­˜æ”¾å¤§å¯¹è±¡(â‰¥ Regionå¤§å°çš„50%)</li>
<li>å¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£</li>
<li>å¯èƒ½è·¨è¶Šå¤šä¸ªè¿ç»­Region</li>
</ul>
</li>
<li>
<p><strong>Free Region (ç©ºé—²åŒº)</strong>:</p>
<ul>
<li>æœªåˆ†é…çš„Region</li>
<li>å¯éšæ—¶åˆ†é…ä¸ºä»»ä½•ç±»å‹</li>
</ul>
</li>
</ol>
<p><strong>åŠ¨æ€åˆ†é…çš„ä¼˜åŠ¿</strong>:</p>
<p>ä¼ ç»Ÿåˆ†ä»£GCä¸­,æ–°ç”Ÿä»£å’Œè€å¹´ä»£æœ‰å›ºå®šè¾¹ç•Œ:</p>
<pre><code class="hljs language-ini" lang="ini">ä¼ ç»ŸGC: <span class="hljs-section">[æ–°ç”Ÿä»£ | è€å¹´ä»£]</span>  â† å›ºå®šè¾¹ç•Œ,æ— æ³•åŠ¨æ€è°ƒæ•´
</code></pre>
<p>G1ä¸­,Regionå¯ä»¥åŠ¨æ€åˆ†é…:</p>
<pre><code class="hljs language-ini" lang="ini">G1: <span class="hljs-section">[E]</span><span class="hljs-section">[E]</span><span class="hljs-section">[S]</span><span class="hljs-section">[O]</span><span class="hljs-section">[O]</span><span class="hljs-section">[O]</span><span class="hljs-section">[F]</span><span class="hljs-section">[F]</span>  â† E/S/Oå¯ä»¥åŠ¨æ€è°ƒæ•´
</code></pre>
<ul>
<li>æ ¹æ®<code>MaxGCPauseMillis</code>ç›®æ ‡,G1è‡ªåŠ¨è°ƒæ•´æ–°ç”Ÿä»£å¤§å°</li>
<li>æ–°ç”Ÿä»£Regionæ•°é‡åœ¨5%-60%ä¹‹é—´åŠ¨æ€å˜åŒ–</li>
<li>é¿å…å›ºå®šè¾¹ç•Œå¯¼è‡´çš„ç©ºé—´æµªè´¹</li>
</ul>
<h4 data-id="heading-8">2.1.2 Remembered Set (RSet)</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6b6717abccd47dc8ee071f028144404~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831181&amp;x-signature=n%2FfaoyQqWQsVQJJL5jh%2BHfJGpEM%3D" alt="g1-rset-structure.svg" loading="lazy"/></p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦RSet?</strong></p>
<p>Young GCæ—¶,éœ€è¦çŸ¥é“å“ªäº›è€å¹´ä»£å¯¹è±¡å¼•ç”¨äº†å¹´è½»ä»£å¯¹è±¡ã€‚ä¼ ç»Ÿåšæ³•æ˜¯å…¨å †æ‰«æ,æ•ˆç‡æä½ã€‚G1é€šè¿‡RSetè®°å½•å¤–éƒ¨Regionå¯¹æœ¬Regionçš„å¼•ç”¨ã€‚</p>
<p><strong>RSetç»“æ„</strong>:</p>
<p>æ¯ä¸ªRegionç»´æŠ¤ä¸€ä¸ªRSet,è®°å½•å“ªäº›Regionå¼•ç”¨äº†æœ¬Regionä¸­çš„å¯¹è±¡:</p>
<pre><code class="hljs language-css" lang="css">Region <span class="hljs-selector-tag">A</span>çš„RSet: {Region <span class="hljs-selector-tag">B</span>, Region C}
// è¡¨ç¤ºRegion <span class="hljs-selector-tag">B</span>å’ŒRegion Cä¸­çš„å¯¹è±¡å¼•ç”¨äº†Region <span class="hljs-selector-tag">A</span>ä¸­çš„å¯¹è±¡
</code></pre>
<p><strong>ç¤ºä¾‹</strong>:</p>
<p>å‡è®¾æœ‰3ä¸ªRegion:</p>
<ul>
<li>Region A (Old): åŒ…å«å¯¹è±¡A1ã€A2</li>
<li>Region B (Eden): åŒ…å«å¯¹è±¡B1ã€B2</li>
<li>Region C (Old): åŒ…å«å¯¹è±¡C1ã€C2</li>
</ul>
<p>å¼•ç”¨å…³ç³»:</p>
<ul>
<li>A1 â†’ B1 (è€å¹´ä»£å¼•ç”¨å¹´è½»ä»£)</li>
<li>A2 â†’ B2</li>
</ul>
<p>åˆ™Region Bçš„RSetè®°å½•: <code>{Region A}</code></p>
<p><strong>Young GCæ—¶ä½¿ç”¨RSet</strong>:</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-number">1</span>. è¦å›æ”¶Region <span class="hljs-selector-tag">B</span> (EdenåŒº)
<span class="hljs-number">2</span>. æŸ¥çœ‹Region <span class="hljs-selector-tag">B</span>çš„RSet: {Region <span class="hljs-selector-tag">A</span>}
<span class="hljs-number">3</span>. åªéœ€æ‰«æRegion <span class="hljs-selector-tag">A</span>ä¸­çš„å¯¹è±¡,æ‰¾å‡ºå¯¹Region <span class="hljs-selector-tag">B</span>çš„å¼•ç”¨
<span class="hljs-number">4</span>. æ— éœ€æ‰«ææ•´ä¸ªè€å¹´ä»£,å¤§å¹…æå‡æ•ˆç‡
</code></pre>
<p><strong>å†™å±éšœç»´æŠ¤RSet</strong>:</p>
<p>æ¯æ¬¡å¼•ç”¨æ›´æ–°æ—¶,JVMæ’å…¥å†™å±éšœä»£ç ,ç»´æŠ¤RSet:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¼ªä»£ç : G1çš„å†™å±éšœ</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">oop_field_store</span><span class="hljs-params">(oop* field, oop new_value)</span> {
  <span class="hljs-comment">// 1. å‰ç½®å†™å±éšœ (SATB,è®°å½•æ—§å€¼,ä¸‹æ–‡è¯¦è¿°)</span>
  pre_write_barrier(field);

  <span class="hljs-comment">// 2. å®é™…çš„å¼•ç”¨æ›´æ–°</span>
  *field = new_value;

  <span class="hljs-comment">// 3. åç½®å†™å±éšœ (ç»´æŠ¤RSet)</span>
  <span class="hljs-keyword">if</span> (is_in_young(new_value) &amp;&amp; is_in_old(field)) {
    <span class="hljs-comment">// è€å¹´ä»£å¯¹è±¡å¼•ç”¨å¹´è½»ä»£å¯¹è±¡</span>
    Region* young_region = get_region(new_value);
    Region* old_region = get_region(field);
    <span class="hljs-comment">// å°†old_regionæ·»åŠ åˆ°young_regionçš„RSet</span>
    young_region-&gt;rset-&gt;add(old_region);
  }
}
</code></pre>
<p><strong>å¡è¡¨(Card Table)å®ç°ç»†èŠ‚</strong>:</p>
<p>RSetçš„åº•å±‚å®ç°ä½¿ç”¨å¡è¡¨(Card Table):</p>
<ul>
<li>å°†å †åˆ’åˆ†ä¸ºå¤šä¸ªCard(é»˜è®¤512å­—èŠ‚)</li>
<li>æ¯ä¸ªCardå¯¹åº”ä¸€ä¸ªå­—èŠ‚çš„æ ‡è®°ä½</li>
<li>å¼•ç”¨å˜åŒ–æ—¶,æ ‡è®°å¯¹åº”Cardä¸º"è„"</li>
<li>RSetè®°å½•çš„æ˜¯Cardçš„é›†åˆ,è€Œä¸æ˜¯å…·ä½“å¯¹è±¡</li>
<li>Young GCæ—¶,åªéœ€æ‰«æRSetä¸­æ ‡è®°ä¸º"è„"çš„Card</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-ini" lang="ini">Regionå†…çš„å¡è¡¨: <span class="hljs-section">[0]</span><span class="hljs-section">[1]</span><span class="hljs-section">[0]</span><span class="hljs-section">[1]</span><span class="hljs-section">[0]</span>
                  â†‘  â†‘  â†‘  â†‘  â†‘
               å¹²å‡€ è„ å¹²å‡€ è„ å¹²å‡€
</code></pre>
<p><strong>RSetçš„ä¼˜åŠ¿ä¸ä»£ä»·</strong>:</p>
<p>ä¼˜åŠ¿:</p>
<ul>
<li>Young GCæ— éœ€å…¨å †æ‰«æ,åªæ‰«æRSetè®°å½•çš„Region</li>
<li>å¤§å¹…æå‡Young GCé€Ÿåº¦</li>
<li>æ”¯æŒéƒ¨åˆ†å›æ”¶(åªå›æ”¶éƒ¨åˆ†Region)</li>
</ul>
<p>ä»£ä»·:</p>
<ul>
<li>RSetå ç”¨é¢å¤–å†…å­˜(çº¦å †å¤§å°çš„5-10%)</li>
<li>å†™å±éšœå¸¦æ¥é¢å¤–CPUå¼€é”€</li>
<li>æ¯æ¬¡å¼•ç”¨æ›´æ–°éƒ½éœ€è¦ç»´æŠ¤RSet</li>
</ul>
<h3 data-id="heading-9">2.2 G1çš„åƒåœ¾å›æ”¶æµç¨‹</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c6de1f77fc44246bad6faf842d12947~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831181&amp;x-signature=AX10mOz%2FGYPZEo0S%2BhXLISxSoY4%3D" alt="g1-gc-flow.svg" loading="lazy"/></p>
<p>G1çš„GCæµç¨‹åŒ…æ‹¬ä¸‰ç§ç±»å‹:Young GCã€Mixed GCå’ŒFull GCã€‚</p>
<h4 data-id="heading-10">2.2.1 Young GC (çº¯å¹´è½»ä»£å›æ”¶)</h4>
<p><strong>è§¦å‘æ¡ä»¶</strong>: Eden Regionæ»¡</p>
<p><strong>å›æ”¶è¿‡ç¨‹</strong> (STWåœé¡¿):</p>
<ol>
<li><strong>æš‚åœåº”ç”¨çº¿ç¨‹</strong> (STWå¼€å§‹)</li>
<li><strong>æ‰«æGC Roots</strong>: çº¿ç¨‹æ ˆã€å…¨å±€å˜é‡ã€JNIå¥æŸ„ç­‰</li>
<li><strong>æ‰«æRSet</strong>: æ‰¾å‡ºè€å¹´ä»£Regionå¯¹å¹´è½»ä»£çš„å¼•ç”¨</li>
<li><strong>å¤åˆ¶å­˜æ´»å¯¹è±¡</strong>:
<ul>
<li>Edenå’ŒSurvivorä¸­çš„å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ°æ–°çš„Survivor Region</li>
<li>å¹´é¾„è¾¾åˆ°é˜ˆå€¼(é»˜è®¤15)çš„å¯¹è±¡æ™‹å‡åˆ°Old Region</li>
</ul>
</li>
<li><strong>æ¸…ç©ºEden</strong>: æ‰€æœ‰Eden Regionæ ‡è®°ä¸ºç©ºé—²</li>
<li><strong>æ¢å¤åº”ç”¨çº¿ç¨‹</strong> (STWç»“æŸ)</li>
</ol>
<p><strong>åœé¡¿æ—¶é—´</strong>: 20-100ms (å–å†³äºå †å¤§å°å’Œå­˜æ´»å¯¹è±¡æ•°é‡)</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-ini" lang="ini">GCå‰:
<span class="hljs-section">[E]</span><span class="hljs-section">[E]</span><span class="hljs-section">[E]</span><span class="hljs-section">[E]</span><span class="hljs-section">[S]</span><span class="hljs-section">[S]</span><span class="hljs-section">[O]</span><span class="hljs-section">[O]</span><span class="hljs-section">[F]</span><span class="hljs-section">[F]</span>
 â†‘  â†‘  â†‘  â†‘  â†‘  â†‘
Edenæ»¡,è§¦å‘Young GC

GCå:
<span class="hljs-section">[F]</span><span class="hljs-section">[F]</span><span class="hljs-section">[F]</span><span class="hljs-section">[F]</span><span class="hljs-section">[S]</span><span class="hljs-section">[S]</span><span class="hljs-section">[O]</span><span class="hljs-section">[O]</span><span class="hljs-section">[F]</span><span class="hljs-section">[F]</span>
                â†‘  â†‘  â†‘
          æ–°çš„Survivor, éƒ¨åˆ†æ™‹å‡åˆ°Old
</code></pre>
<h4 data-id="heading-11">2.2.2 Mixed GC (æ··åˆå›æ”¶)</h4>
<p><strong>è§¦å‘æ¡ä»¶</strong>:</p>
<ol>
<li>å¹¶å‘æ ‡è®°å‘¨æœŸå®Œæˆ</li>
<li>è€å¹´ä»£ä½¿ç”¨ç‡ â‰¥ <code>InitiatingHeapOccupancyPercent</code> (é»˜è®¤45%)</li>
</ol>
<p><strong>å›æ”¶èŒƒå›´</strong>:</p>
<ul>
<li>å¹´è½»ä»£(å…¨éƒ¨Eden + Survivor)</li>
<li>éƒ¨åˆ†è€å¹´ä»£Region (åƒåœ¾æœ€å¤šçš„)</li>
</ul>
<p><strong>æ ¸å¿ƒç­–ç•¥: Garbage-First</strong></p>
<p>G1æ ¹æ®<code>MaxGCPauseMillis</code>ç›®æ ‡,é€‰æ‹©åƒåœ¾æœ€å¤šçš„è€å¹´ä»£Regionå›æ”¶:</p>
<pre><code class="hljs language-erlang" lang="erlang">å‡è®¾æœ‰<span class="hljs-number">10</span>ä¸ªOld Region,åƒåœ¾å æ¯”åˆ†åˆ«ä¸º:
Region1: <span class="hljs-number">90</span><span class="hljs-comment">%</span>
Region2: <span class="hljs-number">85</span><span class="hljs-comment">%</span>
Region3: <span class="hljs-number">70</span><span class="hljs-comment">%</span>
Region4: <span class="hljs-number">50</span><span class="hljs-comment">%</span>
...

G1ä¼˜å…ˆé€‰æ‹©Region1ã€Region2ã€Region3å›æ”¶,
åœ¨åœé¡¿æ—¶é—´å…è®¸èŒƒå›´å†…,å°½å¯èƒ½å¤šå›æ”¶Regionã€‚
</code></pre>
<p><strong>åœé¡¿æ§åˆ¶</strong>:</p>
<p>G1é€šè¿‡<code>MaxGCPauseMillis</code>æ§åˆ¶åœé¡¿æ—¶é—´:</p>
<pre><code class="hljs language-bash" lang="bash">-XX:MaxGCPauseMillis=200  <span class="hljs-comment"># æœŸæœ›æœ€å¤§åœé¡¿200ms</span>
</code></pre>
<p>æ³¨æ„: è¿™æ˜¯è½¯ç›®æ ‡,G1ä¼šå°½åŠ›è¾¾æˆä½†ä¸ä¿è¯ã€‚</p>
<p><strong>åœé¡¿æ—¶é—´</strong>: 50-200ms (å¯é€šè¿‡å‚æ•°æ§åˆ¶)</p>
<p><strong>å¤šæ¬¡Mixed GC</strong>:</p>
<p>ä¸€ä¸ªå¹¶å‘æ ‡è®°å‘¨æœŸå,å¯èƒ½è§¦å‘å¤šæ¬¡Mixed GC,é€æ­¥å›æ”¶è€å¹´ä»£åƒåœ¾ã€‚</p>
<h4 data-id="heading-12">2.2.3 å¹¶å‘æ ‡è®°å‘¨æœŸ (Concurrent Marking Cycle)</h4>
<p>å¹¶å‘æ ‡è®°å‘¨æœŸæ˜¯Mixed GCçš„å‰ç½®é˜¶æ®µ,ç”¨äºæ ‡è®°è€å¹´ä»£ä¸­çš„å­˜æ´»å¯¹è±¡,ç¡®å®šå“ªäº›Regionéœ€è¦å›æ”¶ã€‚</p>
<p><strong>é˜¶æ®µ1: åˆå§‹æ ‡è®° (Initial Mark, STW)</strong></p>
<ul>
<li><strong>STWåœé¡¿</strong>: å‡ æ¯«ç§’</li>
<li><strong>å·¥ä½œ</strong>: æ ‡è®°GC Rootsç›´æ¥å¯è¾¾å¯¹è±¡</li>
<li><strong>ä¼˜åŒ–</strong>: å€Ÿç”¨Young GCçš„STW,æ— é¢å¤–åœé¡¿</li>
</ul>
<p><strong>é˜¶æ®µ2: å¹¶å‘æ ‡è®° (Concurrent Mark, å¹¶å‘)</strong></p>
<ul>
<li><strong>å¹¶å‘æ‰§è¡Œ</strong>: åº”ç”¨çº¿ç¨‹ç»§ç»­è¿è¡Œ</li>
<li><strong>å·¥ä½œ</strong>: éå†æ•´ä¸ªå¯¹è±¡å›¾,æ ‡è®°æ‰€æœ‰å­˜æ´»å¯¹è±¡</li>
<li><strong>è€—æ—¶</strong>: å‡ ç™¾æ¯«ç§’åˆ°å‡ ç§’</li>
</ul>
<p><strong>é˜¶æ®µ3: æœ€ç»ˆæ ‡è®° (Final Mark, STW)</strong></p>
<ul>
<li><strong>STWåœé¡¿</strong>: å‡ åæ¯«ç§’</li>
<li><strong>å·¥ä½œ</strong>: å¤„ç†SATBé˜Ÿåˆ—,ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´çš„å¼•ç”¨å˜åŒ–</li>
</ul>
<p><strong>é˜¶æ®µ4: æ¸…ç† (Cleanup, éƒ¨åˆ†STW)</strong></p>
<ul>
<li><strong>STWéƒ¨åˆ†</strong>: ç»Ÿè®¡Regionå­˜æ´»ç‡ (å‡ æ¯«ç§’)</li>
<li><strong>å¹¶å‘éƒ¨åˆ†</strong>: æ¸…ç†å®Œå…¨ç©ºçš„Region (å‡ åæ¯«ç§’)</li>
</ul>
<p><strong>å®Œæ•´æµç¨‹</strong>:</p>
<pre><code class="hljs language-scss" lang="scss">åˆå§‹æ ‡è®° â†’ å¹¶å‘æ ‡è®° â†’ æœ€ç»ˆæ ‡è®° â†’ æ¸…ç† â†’ è§¦å‘Mixed GC
 (STW)     (å¹¶å‘)     (STW)    (éƒ¨åˆ†STW)
</code></pre>
<h3 data-id="heading-13">2.3 SATBç®—æ³•è¯¦è§£</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ebab0f2dd8b4fe9b2c0a9c04a90f1b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831181&amp;x-signature=LLMz6uWL%2FqcDtxNAbuNuX7d9XDI%3D" alt="tricolor-satb.svg" loading="lazy"/></p>
<h4 data-id="heading-14">2.3.1 ä¸‰è‰²æ ‡è®°ç®—æ³•</h4>
<p>G1ä½¿ç”¨ä¸‰è‰²æ ‡è®°ç®—æ³•è¿›è¡Œå¹¶å‘æ ‡è®°:</p>
<ul>
<li><strong>ç™½è‰²å¯¹è±¡</strong>: æœªæ ‡è®°,å¯èƒ½æ˜¯åƒåœ¾</li>
<li><strong>ç°è‰²å¯¹è±¡</strong>: å·²æ ‡è®°,ä½†å­å¯¹è±¡æœªæ‰«æ</li>
<li><strong>é»‘è‰²å¯¹è±¡</strong>: å·²æ ‡è®°,ä¸”å­å¯¹è±¡å·²æ‰«æ</li>
</ul>
<p><strong>æ ‡è®°æµç¨‹</strong>:</p>
<ol>
<li>åˆå§‹: æ‰€æœ‰å¯¹è±¡ä¸ºç™½è‰²</li>
<li>GC Rootsæ ‡è®°ä¸ºç°è‰²</li>
<li>ä»ç°è‰²å¯¹è±¡é˜Ÿåˆ—å–å‡ºå¯¹è±¡,æ‰«æå…¶å¼•ç”¨:
<ul>
<li>å¼•ç”¨å¯¹è±¡æ ‡è®°ä¸ºç°è‰²</li>
<li>å½“å‰å¯¹è±¡æ ‡è®°ä¸ºé»‘è‰²</li>
</ul>
</li>
<li>é‡å¤æ­¥éª¤3,ç›´åˆ°ç°è‰²å¯¹è±¡é˜Ÿåˆ—ä¸ºç©º</li>
<li>å‰©ä½™ç™½è‰²å¯¹è±¡ = åƒåœ¾,å›æ”¶</li>
</ol>
<p><strong>ä¸å˜å¼</strong>: é»‘è‰²å¯¹è±¡ä¸èƒ½ç›´æ¥å¼•ç”¨ç™½è‰²å¯¹è±¡</p>
<p>è‹¥è¿å,å¯èƒ½å¯¼è‡´å¯¹è±¡æ¼æ ‡:</p>
<ul>
<li>é»‘è‰²å¯¹è±¡å·²æ‰«æå®Œæˆ</li>
<li>æ–°å¢ç™½è‰²å¼•ç”¨ä¸ä¼šè¢«å‘ç°</li>
<li>ç™½è‰²å¯¹è±¡è¢«è¯¯è®¤ä¸ºåƒåœ¾</li>
<li><strong>å­˜æ´»å¯¹è±¡è¢«é”™è¯¯å›æ”¶!</strong></li>
</ul>
<h4 data-id="heading-15">2.3.2 å¹¶å‘æ ‡è®°çš„é—®é¢˜</h4>
<p>å¹¶å‘æ ‡è®°æœŸé—´,åº”ç”¨çº¿ç¨‹å¯èƒ½ä¿®æ”¹å¯¹è±¡å¼•ç”¨,å¯¼è‡´å¯¹è±¡æ¼æ ‡ã€‚</p>
<p><strong>å¯¹è±¡æ¼æ ‡çš„ä¸¤ä¸ªå……è¦æ¡ä»¶</strong>:</p>
<ol>
<li>é»‘è‰²å¯¹è±¡æ–°å¢å¯¹ç™½è‰²å¯¹è±¡çš„å¼•ç”¨</li>
<li>ç°è‰²å¯¹è±¡åˆ é™¤å¯¹ç™½è‰²å¯¹è±¡çš„å¼•ç”¨</li>
</ol>
<p><strong>ç¤ºä¾‹</strong>:</p>
<p>åˆå§‹çŠ¶æ€:</p>
<pre><code class="hljs language-scss" lang="scss">GC Root (é»‘) â†’ å¯¹è±¡<span class="hljs-selector-tag">A</span> (ç°) â†’ å¯¹è±¡<span class="hljs-selector-tag">B</span> (ç™½)
</code></pre>
<p>å¹¶å‘æœŸé—´,åº”ç”¨çº¿ç¨‹æ‰§è¡Œ:</p>
<pre><code class="hljs language-java" lang="java">root.fieldB = objectB;  <span class="hljs-comment">// é»‘â†’ç™½å¼•ç”¨</span>
objectA.fieldB = <span class="hljs-literal">null</span>;  <span class="hljs-comment">// åˆ é™¤ç°â†’ç™½å¼•ç”¨</span>
</code></pre>
<p>ç»“æœ:</p>
<pre><code class="hljs language-scss" lang="scss">GC Root (é»‘) â†’ å¯¹è±¡<span class="hljs-selector-tag">B</span> (ç™½)
</code></pre>
<p>é—®é¢˜:</p>
<ul>
<li>GC Root(é»‘)å·²æ‰«æå®Œ,ä¸ä¼šå†æ‰«æ</li>
<li>å¯¹è±¡A(ç°)åˆ é™¤å¼•ç”¨,ä¸ä¼šè®¿é—®B</li>
<li>å¯¹è±¡B(ç™½)æ²¡æœ‰å…¶ä»–å¼•ç”¨è·¯å¾„</li>
<li><strong>å¯¹è±¡Bè¢«è¯¯è®¤ä¸ºåƒåœ¾,é”™è¯¯å›æ”¶!</strong></li>
</ul>
<h4 data-id="heading-16">2.3.3 SATB (Snapshot-At-The-Beginning) è§£å†³æ–¹æ¡ˆ</h4>
<p><strong>æ ¸å¿ƒæ€æƒ³</strong>: æ ‡è®°å¼€å§‹æ—¶çš„å¯¹è±¡å¿«ç…§(é€»è¾‘å¿«ç…§,éç‰©ç†å¿«ç…§)</p>
<p><strong>å†™å±éšœå®ç°</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// G1çš„SATBå†™å±éšœ (å‰ç½®å±éšœ)</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">oop_field_store</span><span class="hljs-params">(oop* field, oop new_value)</span> {
  <span class="hljs-type">oop</span> <span class="hljs-variable">old_value</span> <span class="hljs-operator">=</span> *field;  <span class="hljs-comment">// 1. è¯»å–æ—§å€¼</span>
  <span class="hljs-keyword">if</span> (old_value != <span class="hljs-literal">null</span> &amp;&amp; is_marking_active()) {
    satb_enqueue(old_value);  <span class="hljs-comment">// 2. ä¿å­˜æ—§å€¼åˆ°SATBé˜Ÿåˆ—</span>
  }
  *field = new_value;  <span class="hljs-comment">// 3. æ‰§è¡Œå®é™…çš„å¼•ç”¨æ›´æ–°</span>
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè®°å½•æ—§å€¼è€Œä¸æ˜¯æ–°å€¼?</strong></p>
<ul>
<li>SATBç›®æ ‡: ä¿è¯æ ‡è®°å¼€å§‹æ—¶çš„å¿«ç…§ä¸­çš„æ‰€æœ‰å­˜æ´»å¯¹è±¡éƒ½è¢«æ ‡è®°</li>
<li>æ—§å€¼å¯èƒ½æ˜¯å”¯ä¸€å¼•ç”¨è·¯å¾„,åˆ é™¤åå¯¹è±¡ä¼šå­¤ç«‹</li>
<li>æ–°å€¼ä¼šåœ¨å¹¶å‘æ ‡è®°ä¸­æ­£å¸¸æ‰«æåˆ°</li>
</ul>
<p><strong>SATBé˜Ÿåˆ—å¤„ç†</strong>:</p>
<ul>
<li>æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªæœ¬åœ°SATBé˜Ÿåˆ—</li>
<li>é˜Ÿåˆ—æ»¡æ—¶,è½¬ç§»åˆ°å…¨å±€é˜Ÿåˆ—</li>
<li>æœ€ç»ˆæ ‡è®°é˜¶æ®µ,GCçº¿ç¨‹å¤„ç†æ‰€æœ‰SATBé˜Ÿåˆ—</li>
<li>ä»é˜Ÿåˆ—ä¸­çš„å¯¹è±¡é‡æ–°æ‰«æ,æ ‡è®°ä¸ºç°è‰²</li>
</ul>
<p><strong>SATBçš„ä¿å®ˆæ€§</strong>:</p>
<ul>
<li>å¯èƒ½æ ‡è®°ä¸€äº›å·²ç»æ­»äº¡çš„å¯¹è±¡(æµ®åŠ¨åƒåœ¾)</li>
<li>ç‰ºç‰²éƒ¨åˆ†ç²¾åº¦,æ¢å–ä¸æ¼æ ‡çš„ä¿è¯</li>
<li>æµ®åŠ¨åƒåœ¾åœ¨ä¸‹ä¸€æ¬¡GCä¼šè¢«å›æ”¶</li>
</ul>
<h3 data-id="heading-17">2.4 G1çš„å‚æ•°è°ƒä¼˜</h3>
<h4 data-id="heading-18">2.4.1 æ ¸å¿ƒå‚æ•°</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯ç”¨G1</span>
-XX:+UseG1GC

<span class="hljs-comment"># æœŸæœ›æœ€å¤§åœé¡¿æ—¶é—´ (è½¯ç›®æ ‡)</span>
-XX:MaxGCPauseMillis=200  <span class="hljs-comment"># é»˜è®¤200ms</span>

<span class="hljs-comment"># å †å¤§å° (å»ºè®®Xms = Xmx)</span>
-Xms4g -Xmx4g

<span class="hljs-comment"># Regionå¤§å° (1MB-32MB,å¿…é¡»æ˜¯2çš„å¹‚)</span>
-XX:G1HeapRegionSize=8m

<span class="hljs-comment"># è€å¹´ä»£å ç”¨ç‡è¾¾åˆ°æ­¤é˜ˆå€¼æ—¶è§¦å‘å¹¶å‘æ ‡è®°</span>
-XX:InitiatingHeapOccupancyPercent=45  <span class="hljs-comment"># é»˜è®¤45%</span>

<span class="hljs-comment"># ä¿ç•™ç©ºé—´,é˜²æ­¢æ™‹å‡å¤±è´¥</span>
-XX:G1ReservePercent=10  <span class="hljs-comment"># é»˜è®¤10%</span>

<span class="hljs-comment"># æ–°ç”Ÿä»£å¤§å°èŒƒå›´</span>
-XX:G1NewSizePercent=5       <span class="hljs-comment"># æ–°ç”Ÿä»£æœ€å°å æ¯”5%</span>
-XX:G1MaxNewSizePercent=60   <span class="hljs-comment"># æ–°ç”Ÿä»£æœ€å¤§å æ¯”60%</span>

<span class="hljs-comment"># å¹¶å‘æ ‡è®°çº¿ç¨‹æ•° (é»˜è®¤ParallelGCThreads/4)</span>
-XX:ConcGCThreads=4

<span class="hljs-comment"># å¹¶è¡ŒGCçº¿ç¨‹æ•° (é»˜è®¤ç­‰äºCPUæ ¸å¿ƒæ•°)</span>
-XX:ParallelGCThreads=8
</code></pre>
<h4 data-id="heading-19">2.4.2 å®Œæ•´é…ç½®ç¤ºä¾‹</h4>
<p><strong>Webåº”ç”¨ (4æ ¸8GB,å †4GB)</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms4g -Xmx4g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=200 \
     -XX:G1HeapRegionSize=8m \
     -XX:InitiatingHeapOccupancyPercent=45 \
     -XX:G1ReservePercent=10 \
     -XX:MetaspaceSize=256m \
     -XX:MaxMetaspaceSize=512m \
     -XX:+HeapDumpOnOutOfMemoryError \
     -XX:HeapDumpPath=/var/log/heapdump.hprof \
     -Xloggc:/var/log/gc.log \
     -XX:+PrintGCDetails \
     -XX:+PrintGCDateStamps \
     -jar application.jar
</code></pre>
<p><strong>å¤§å†…å­˜åº”ç”¨ (16æ ¸32GB,å †24GB)</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms24g -Xmx24g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=100 \
     -XX:G1HeapRegionSize=16m \
     -XX:InitiatingHeapOccupancyPercent=40 \
     -XX:G1ReservePercent=15 \
     -XX:ConcGCThreads=4 \
     -XX:ParallelGCThreads=16 \
     -XX:MetaspaceSize=512m \
     -XX:MaxMetaspaceSize=1g \
     -Xloggc:/var/log/gc.log \
     -jar application.jar
</code></pre>
<hr/>
<h2 data-id="heading-20">ä¸‰ã€ZGCåƒåœ¾æ”¶é›†å™¨åŸç†</h2>
<h3 data-id="heading-21">3.1 ZGCçš„æ•´ä½“æ¶æ„</h3>
<p>ZGCæ˜¯JDK 11å¼•å…¥çš„è¶…ä½å»¶è¿Ÿåƒåœ¾æ”¶é›†å™¨,ç›®æ ‡æ˜¯å®ç°åœé¡¿æ—¶é—´ &lt; 10ms,ä¸å †å¤§å°æ— å…³ã€‚</p>
<h4 data-id="heading-22">3.1.1 æ ¸å¿ƒæŠ€æœ¯</h4>
<p>ZGCçš„ä¸‰å¤§æ ¸å¿ƒæŠ€æœ¯:</p>
<ol>
<li><strong>æŸ“è‰²æŒ‡é’ˆ (Colored Pointers)</strong>: å°†GCä¿¡æ¯å­˜å‚¨åœ¨æŒ‡é’ˆä¸­</li>
<li><strong>è¯»å±éšœ (Load Barrier)</strong>: å¯¹è±¡è®¿é—®æ—¶è‡ªåŠ¨å¤„ç†é‡å®šä½</li>
<li><strong>å¹¶å‘é‡å®šä½</strong>: å¯¹è±¡ç§»åŠ¨ä¸åº”ç”¨çº¿ç¨‹å¹¶å‘æ‰§è¡Œ</li>
</ol>
<h3 data-id="heading-23">3.2 æŸ“è‰²æŒ‡é’ˆ (Colored Pointers)</h3>
<p><img src="images/07/zgc-colored-pointers.svg" alt="ZGCæŸ“è‰²æŒ‡é’ˆç»“æ„" loading="lazy"/></p>
<h4 data-id="heading-24">3.2.1 64ä½æŒ‡é’ˆå¸ƒå±€</h4>
<p>ZGCåˆ©ç”¨64ä½æŒ‡é’ˆçš„é«˜ä½å­˜å‚¨GCä¿¡æ¯:</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-number">63</span>              <span class="hljs-number">47</span> <span class="hljs-number">46</span> <span class="hljs-number">45</span> <span class="hljs-number">44</span> <span class="hljs-number">43</span> <span class="hljs-number">42</span>                                        <span class="hljs-number">0</span>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Reserved     â”‚Fiâ”‚Reâ”‚M1â”‚M0â”‚Res â”‚      <span class="hljs-selector-tag">Object</span> <span class="hljs-selector-tag">Address</span> (<span class="hljs-number">42</span>ä½)           â”‚
â”‚   (<span class="hljs-number">16</span>ä½)       â”‚naâ”‚maâ”‚arâ”‚arâ”‚erv â”‚                                      â”‚
â”‚                â”‚<span class="hljs-selector-tag">li</span>â”‚ppâ”‚keâ”‚keâ”‚ed  â”‚                                      â”‚
â”‚                â”‚zaâ”‚edâ”‚d1â”‚d0â”‚(<span class="hljs-number">2</span>) â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å…ƒæ•°æ®ä½ [47:42]</strong>:</p>
<ul>
<li><strong>Marked0 (ä½44)</strong>: å¥‡æ•°è½®å¹¶å‘æ ‡è®°,æ ‡è®°ä¸º1è¡¨ç¤ºå¯¹è±¡å­˜æ´»</li>
<li><strong>Marked1 (ä½45)</strong>: å¶æ•°è½®å¹¶å‘æ ‡è®°,æ ‡è®°ä¸º1è¡¨ç¤ºå¯¹è±¡å­˜æ´»</li>
<li><strong>Remapped (ä½46)</strong>: æ ‡è®°å¯¹è±¡æ˜¯å¦å·²é‡å®šä½,1è¡¨ç¤ºå·²ç§»åŠ¨åˆ°æ–°åœ°å€</li>
<li><strong>Finalizable (ä½47)</strong>: æ ‡è®°å¯¹è±¡æ˜¯å¦å¯ç»ˆç»“,1è¡¨ç¤ºæœ‰finalizeæ–¹æ³•</li>
</ul>
<p><strong>å¯¹è±¡åœ°å€ [41:0]</strong>:</p>
<ul>
<li>42ä½åœ°å€å¯å¯»å€ 4TB (2^42 = 4TB)</li>
<li>Linux x86-64ä»…ä½¿ç”¨ä½48ä½</li>
</ul>
<h4 data-id="heading-25">3.2.2 ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªMarkedä½?</h4>
<p>ZGCæ¯è½®GCäº¤æ›¿ä½¿ç”¨Marked0å’ŒMarked1:</p>
<ul>
<li>ç¬¬1è½®GC: ä½¿ç”¨Marked0 (Marked0=1è¡¨ç¤ºå­˜æ´»)</li>
<li>ç¬¬2è½®GC: ä½¿ç”¨Marked1 (Marked1=1è¡¨ç¤ºå­˜æ´»)</li>
</ul>
<p><strong>å¥½å¤„</strong>: æ— éœ€é‡ç½®æ‰€æœ‰å¯¹è±¡çš„æ ‡è®°ä½,ç›´æ¥åˆ‡æ¢ä½¿ç”¨å“ªä¸ªä½å³å¯ã€‚</p>
<p>ä¾‹å¦‚:</p>
<ul>
<li>ç¬¬1è½®GCå,Marked0=1çš„å¯¹è±¡æ˜¯å­˜æ´»çš„</li>
<li>ç¬¬2è½®GCå¼€å§‹æ—¶,ç›´æ¥ä½¿ç”¨Marked1,æ— éœ€æ¸…é™¤Marked0</li>
</ul>
<h4 data-id="heading-26">3.2.3 æŸ“è‰²æŒ‡é’ˆçš„ä¼˜åŠ¿</h4>
<p><strong>1. ä¸€æ¬¡æ€§æ ‡è®°</strong></p>
<p>æ— éœ€éå†å¯¹è±¡å›¾,ç›´æ¥é€šè¿‡æŒ‡é’ˆé¢œè‰²åˆ¤æ–­å¯¹è±¡çŠ¶æ€:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ£€æŸ¥å¯¹è±¡æ˜¯å¦å·²æ ‡è®°</span>
<span class="hljs-type">boolean</span> <span class="hljs-title function_">is_marked</span><span class="hljs-params">(Object* ptr)</span> {
  <span class="hljs-keyword">return</span> (ptr &amp; MARKED_BIT) != <span class="hljs-number">0</span>;
}
</code></pre>
<p><strong>2. å¹¶å‘é‡å®šä½</strong></p>
<p>å¯¹è±¡ç§»åŠ¨å,æ—§æŒ‡é’ˆé€šè¿‡è¯»å±éšœè‡ªåŠ¨é‡å®šå‘åˆ°æ–°åœ°å€,æ— éœ€STWæ›´æ–°æ‰€æœ‰å¼•ç”¨ã€‚</p>
<p><strong>3. å¤šä»£è§†å›¾</strong></p>
<p>åŒä¸€ç‰©ç†åœ°å€,é€šè¿‡ä¸åŒé¢œè‰²çš„æŒ‡é’ˆ,å¯ä»¥åŒæ—¶è¡¨ç¤ºæ—§å¯¹è±¡å’Œæ–°å¯¹è±¡ã€‚</p>
<p><strong>4. ä½å»¶è¿Ÿ</strong></p>
<p>é…åˆè¯»å±éšœå’Œå¤šé‡æ˜ å°„,å®ç°æ¥è¿‘é›¶åœé¡¿çš„GC (STWé€šå¸¸ &lt; 10ms)ã€‚</p>
<h3 data-id="heading-27">3.3 è¯»å±éšœ (Load Barrier)</h3>
<p>ZGCä½¿ç”¨è¯»å±éšœ(è€Œä¸æ˜¯å†™å±éšœ)æ¥å®ç°å¹¶å‘é‡å®šä½ã€‚</p>
<p><strong>è¯»å±éšœä¼ªä»£ç </strong>:</p>
<pre><code class="hljs language-java" lang="java">Object <span class="hljs-title function_">load</span><span class="hljs-params">(Object* addr)</span> {
  <span class="hljs-type">Object</span> <span class="hljs-variable">ptr</span> <span class="hljs-operator">=</span> *addr;  <span class="hljs-comment">// 1. è¯»å–æŒ‡é’ˆ</span>

  <span class="hljs-comment">// 2. æ£€æŸ¥æŒ‡é’ˆçš„é¢œè‰²ä½</span>
  <span class="hljs-keyword">if</span> (is_good_color(ptr)) {
    <span class="hljs-keyword">return</span> ptr;  <span class="hljs-comment">// é¢œè‰²æ­£ç¡®,ç›´æ¥è¿”å›</span>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> slow_path(ptr);  <span class="hljs-comment">// é¢œè‰²ä¸å¯¹,è¿›å…¥æ…¢é€Ÿè·¯å¾„ (é‡å®šä½/æ ‡è®°)</span>
  }
}
</code></pre>
<p><strong>å¿«é€Ÿè·¯å¾„</strong>: é¢œè‰²æ­£ç¡®,ç›´æ¥è¿”å›æŒ‡é’ˆ (å‡ ä¹æ— å¼€é”€)</p>
<p><strong>æ…¢é€Ÿè·¯å¾„</strong>: é¢œè‰²ä¸å¯¹,è¿›è¡Œé‡å®šä½æˆ–æ ‡è®°,ç„¶åæ›´æ–°æŒ‡é’ˆé¢œè‰²</p>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>å¯¹è±¡ç§»åŠ¨å,æ—§æŒ‡é’ˆé€šè¿‡è¯»å±éšœè‡ªåŠ¨é‡å®šå‘åˆ°æ–°åœ°å€</li>
<li>åº”ç”¨çº¿ç¨‹è®¿é—®æ—¶è‡ªåŠ¨å®Œæˆé‡å®šä½,æ— éœ€STW</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>:</p>
<ul>
<li>è¯»æ“ä½œæœ‰é¢å¤–å¼€é”€ (ä½†ç°ä»£CPUåˆ†æ”¯é¢„æµ‹ä¼˜åŒ–åå½±å“å¾ˆå°)</li>
</ul>
<h3 data-id="heading-28">3.4 ZGCçš„åƒåœ¾å›æ”¶æµç¨‹</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fef8decbcab344748d4128ccfb7a4779~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831181&amp;x-signature=xnCkYJ58A2hitKJ3%2Bqy3XFPwi88%3D" alt="zgc-gc-flow.svg" loading="lazy"/></p>
<p>ZGCçš„GCæµç¨‹åŒ…æ‹¬7ä¸ªé˜¶æ®µ,åªæœ‰3ä¸ªæçŸ­çš„STWé˜¶æ®µã€‚</p>
<h4 data-id="heading-29">3.4.1 é˜¶æ®µ1: Pause Mark Start (åˆå§‹æ ‡è®° - STW)</h4>
<ul>
<li><strong>STWåœé¡¿</strong>: ~1ms</li>
<li><strong>å·¥ä½œ</strong>: æ ‡è®°GC Rootsç›´æ¥å¯è¾¾å¯¹è±¡</li>
<li><strong>é¢œè‰²æŒ‡é’ˆ</strong>: è®¾ç½®å½“å‰ä½¿ç”¨çš„Markedä½ (Marked0æˆ–Marked1)</li>
</ul>
<h4 data-id="heading-30">3.4.2 é˜¶æ®µ2: Concurrent Mark (å¹¶å‘æ ‡è®°)</h4>
<ul>
<li><strong>å¹¶å‘æ‰§è¡Œ</strong>: åº”ç”¨çº¿ç¨‹ç»§ç»­è¿è¡Œ</li>
<li><strong>å·¥ä½œ</strong>: éå†æ•´ä¸ªå¯¹è±¡å›¾,æ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡</li>
<li><strong>é¢œè‰²æŒ‡é’ˆ</strong>:
<ul>
<li>å·²æ ‡è®°å¯¹è±¡: Markedä½ = 1</li>
<li>æœªæ ‡è®°å¯¹è±¡: Markedä½ = 0 (åƒåœ¾å€™é€‰)</li>
</ul>
</li>
</ul>
<h4 data-id="heading-31">3.4.3 é˜¶æ®µ3: Pause Mark End (æœ€ç»ˆæ ‡è®° - STW)</h4>
<ul>
<li><strong>STWåœé¡¿</strong>: ~1ms</li>
<li><strong>å·¥ä½œ</strong>: å¤„ç†å¹¶å‘æ ‡è®°æœŸé—´çš„å¼±å¼•ç”¨ã€è½¯å¼•ç”¨ç­‰</li>
<li><strong>é€‰æ‹©å›æ”¶å¯¹è±¡</strong>: Markedä½ = 0 çš„å¯¹è±¡ä¸ºåƒåœ¾</li>
</ul>
<h4 data-id="heading-32">3.4.4 é˜¶æ®µ4: Concurrent Process Non-Strong References (å¤„ç†å¼±å¼•ç”¨)</h4>
<ul>
<li><strong>å¹¶å‘æ‰§è¡Œ</strong>: å¤„ç†è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ã€Finalizer</li>
<li><strong>å·¥ä½œ</strong>:
<ul>
<li>å¤„ç†è½¯å¼•ç”¨: æ ¹æ®å†…å­˜æƒ…å†µå†³å®šæ˜¯å¦å›æ”¶</li>
<li>å¤„ç†å¼±å¼•ç”¨: æ ‡è®°é˜¶æ®µæœªæ ‡è®°çš„å¯¹è±¡,å¼±å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ä¼šè¢«å›æ”¶</li>
<li>å¤„ç†è™šå¼•ç”¨</li>
<li>å¤„ç†Finalizer: è°ƒç”¨finalize()æ–¹æ³•</li>
</ul>
</li>
</ul>
<h4 data-id="heading-33">3.4.5 é˜¶æ®µ5: Concurrent Reset Relocation Set (é‡ç½®é‡å®šä½é›†)</h4>
<ul>
<li><strong>å¹¶å‘æ‰§è¡Œ</strong>: å‡†å¤‡é‡å®šä½,é‡ç½®ä¸Šä¸€æ¬¡GCçš„é‡å®šä½æ˜ å°„è¡¨</li>
<li><strong>å·¥ä½œ</strong>: æ¸…ç†ä¸Šä¸€æ¬¡GCçš„è½¬å‘è¡¨ (Forwarding Table)</li>
</ul>
<h4 data-id="heading-34">3.4.6 é˜¶æ®µ6: Pause Relocate Start (å¼€å§‹é‡å®šä½ - STW)</h4>
<ul>
<li><strong>STWåœé¡¿</strong>: ~1ms</li>
<li><strong>å·¥ä½œ</strong>: é‡å®šä½GC Rootsç›´æ¥å¼•ç”¨çš„å¯¹è±¡,æ›´æ–°GC Rootsä¸­çš„å¼•ç”¨æŒ‡é’ˆ</li>
<li><strong>é¢œè‰²æŒ‡é’ˆ</strong>:
<ul>
<li>å·²é‡å®šä½å¯¹è±¡: Remappedä½ = 1</li>
<li>æ›´æ–°æŒ‡é’ˆæŒ‡å‘æ–°åœ°å€</li>
</ul>
</li>
</ul>
<h4 data-id="heading-35">3.4.7 é˜¶æ®µ7: Concurrent Relocate (å¹¶å‘é‡å®šä½)</h4>
<ul>
<li><strong>å¹¶å‘æ‰§è¡Œ</strong>: ç§»åŠ¨å¯¹è±¡,æ›´æ–°å¼•ç”¨æŒ‡é’ˆ</li>
<li><strong>å·¥ä½œ</strong>:
<ul>
<li>éå†Relocation Setä¸­çš„Page,å°†å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°æ–°Page</li>
<li>å»ºç«‹è½¬å‘è¡¨ (Forwarding Table): è®°å½•æ—§åœ°å€ â†’ æ–°åœ°å€æ˜ å°„</li>
<li>é€šè¿‡è¯»å±éšœ,åº”ç”¨çº¿ç¨‹è®¿é—®æ—§åœ°å€æ—¶è‡ªåŠ¨è½¬å‘åˆ°æ–°åœ°å€</li>
</ul>
</li>
</ul>
<p><strong>è¯»å±éšœçš„ä½œç”¨</strong>:</p>
<p>å¹¶å‘é‡å®šä½æœŸé—´,åº”ç”¨çº¿ç¨‹å¦‚ä½•è®¿é—®å·²ç§»åŠ¨çš„å¯¹è±¡?</p>
<p>åœºæ™¯: GCçº¿ç¨‹å·²å°†å¯¹è±¡Aä»åœ°å€0x1000ç§»åŠ¨åˆ°0x2000,ä½†åº”ç”¨çº¿ç¨‹æŒæœ‰æ—§æŒ‡é’ˆ0x1000</p>
<ol>
<li>åº”ç”¨çº¿ç¨‹è®¿é—®å¯¹è±¡A: <code>obj = *ptr;</code> (è§¦å‘è¯»å±éšœ)</li>
<li>è¯»å±éšœæ£€æŸ¥é¢œè‰²ä½:
<ul>
<li>Remapped = 0: å¯¹è±¡è¿˜åœ¨æ—§åœ°å€,ç›´æ¥è¿”å›</li>
<li>Remapped = 1: å¯¹è±¡å·²ç§»åŠ¨,æŸ¥è¯¢è½¬å‘è¡¨è·å–æ–°åœ°å€</li>
</ul>
</li>
<li>è½¬å‘åˆ°æ–°åœ°å€:
<ul>
<li>ä»è½¬å‘è¡¨æŸ¥è¯¢: 0x1000 â†’ 0x2000</li>
<li>è¿”å›æ–°åœ°å€çš„å¯¹è±¡</li>
<li>æ›´æ–°æŒ‡é’ˆä¸ºæ–°åœ°å€ (å¯é€‰ä¼˜åŒ–)</li>
</ul>
</li>
</ol>
<h3 data-id="heading-36">3.5 å¤šé‡æ˜ å°„å†…å­˜ç®¡ç†</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da1b1805c4a74a599643973ffa89e987~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766831181&amp;x-signature=pDIQ9cgwlDBtCqg1ejFoiVLfgTg%3D" alt="zgc-multi-mapping.svg" loading="lazy"/></p>
<h4 data-id="heading-37">3.5.1 æ ¸å¿ƒæ€æƒ³</h4>
<p>ZGCå°†åŒä¸€å—ç‰©ç†å†…å­˜æ˜ å°„åˆ°3ä¸ªä¸åŒçš„è™šæ‹Ÿåœ°å€ç©ºé—´:</p>
<ul>
<li><strong>Marked0 View</strong>: Marked0=1 çš„æŒ‡é’ˆè®¿é—®æ­¤è§†å›¾</li>
<li><strong>Marked1 View</strong>: Marked1=1 çš„æŒ‡é’ˆè®¿é—®æ­¤è§†å›¾</li>
<li><strong>Remapped View</strong>: Remapped=1 çš„æŒ‡é’ˆè®¿é—®æ­¤è§†å›¾</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql">è™šæ‹Ÿåœ°å€ç©ºé—´:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Marked0 <span class="hljs-keyword">View</span>    â”‚ <span class="hljs-number">0x0000</span>_0000_0000 <span class="hljs-operator">-</span> <span class="hljs-number">0x0000</span>_03FF_FFFF
â”‚ (è™šæ‹Ÿåœ°å€)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ æ˜ å°„
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰©ç†å†…å­˜        â”‚ <span class="hljs-number">0x1000</span>_0000 <span class="hljs-operator">-</span> <span class="hljs-number">0x13FF</span>_FFFF (<span class="hljs-number">64</span>MB)
â”‚ (å¯¹è±¡A, B, C...)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘ æ˜ å°„
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Remapped <span class="hljs-keyword">View</span>   â”‚ <span class="hljs-number">0x0000</span>_0800_0000 <span class="hljs-operator">-</span> <span class="hljs-number">0x0000</span>_0BFF_FFFF
â”‚ (è™šæ‹Ÿåœ°å€)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-38">3.5.2 å·¥ä½œåŸç†</h4>
<p><strong>åœºæ™¯</strong>: å°†å¯¹è±¡Aä»ç‰©ç†åœ°å€0x1000_1000 é‡å®šä½åˆ° 0x1000_5000</p>
<p><strong>æ­¥éª¤1: å¹¶å‘æ ‡è®°é˜¶æ®µ (ä½¿ç”¨Marked0è§†å›¾)</strong></p>
<ul>
<li>å¯¹è±¡Açš„æŒ‡é’ˆ: 0x0001_0000_1000 (Marked0=1)</li>
<li>é€šè¿‡Marked0è§†å›¾è®¿é—®ç‰©ç†åœ°å€ 0x1000_1000</li>
<li>è™šæ‹Ÿåœ°å€: 0x0000_0000_1000 â†’ ç‰©ç†åœ°å€: 0x1000_1000</li>
</ul>
<p><strong>æ­¥éª¤2: å¹¶å‘é‡å®šä½é˜¶æ®µ (åˆ‡æ¢åˆ°Remappedè§†å›¾)</strong></p>
<ul>
<li>GCçº¿ç¨‹å°†å¯¹è±¡Aå¤åˆ¶åˆ°æ–°ç‰©ç†åœ°å€ 0x1000_5000</li>
<li>åˆ›å»ºè½¬å‘è¡¨: 0x1000_1000 â†’ 0x1000_5000</li>
<li>æ–°æŒ‡é’ˆ: 0x0004_0000_5000 (Remapped=1)</li>
<li>é€šè¿‡Remappedè§†å›¾è®¿é—®æ–°ç‰©ç†åœ°å€ 0x1000_5000</li>
<li>è™šæ‹Ÿåœ°å€: 0x0000_0800_5000 â†’ ç‰©ç†åœ°å€: 0x1000_5000</li>
</ul>
<p><strong>æ­¥éª¤3: è¯»å±éšœå¤„ç†æ—§æŒ‡é’ˆ</strong></p>
<ul>
<li>åº”ç”¨çº¿ç¨‹æŒæœ‰æ—§æŒ‡é’ˆ: 0x0001_0000_1000</li>
<li>è¯»å±éšœæ£€æŸ¥Marked0=1, Remapped=0</li>
<li>æŸ¥è¯¢è½¬å‘è¡¨: 0x1000_1000 â†’ 0x1000_5000</li>
<li>è¿”å›æ–°åœ°å€å¯¹è±¡</li>
<li>å¯é€‰: æ›´æ–°æŒ‡é’ˆä¸º 0x0004_0000_5000</li>
</ul>
<h4 data-id="heading-39">3.5.3 å¤šé‡æ˜ å°„çš„ä¼˜åŠ¿</h4>
<p><strong>âœ… æ— éœ€ç‰©ç†å¤åˆ¶</strong></p>
<ul>
<li>å¯¹è±¡é‡å®šä½åªéœ€åˆ‡æ¢æŒ‡é’ˆé¢œè‰²ä½</li>
<li>æ— éœ€å¤åˆ¶å¯¹è±¡æ•°æ®</li>
<li>æå¤§å‡å°‘GCå¼€é”€</li>
</ul>
<p><strong>âœ… å¹¶å‘å®‰å…¨</strong></p>
<ul>
<li>æ—§è§†å›¾å’Œæ–°è§†å›¾åŒæ—¶æœ‰æ•ˆ</li>
<li>åº”ç”¨çº¿ç¨‹é€šè¿‡è¯»å±éšœè‡ªåŠ¨è½¬å‘</li>
<li>æ— éœ€STWæ›´æ–°æ‰€æœ‰å¼•ç”¨</li>
</ul>
<p><strong>âœ… å¤šä»£åˆ‡æ¢</strong></p>
<ul>
<li>Marked0/Marked1 äº¤æ›¿ä½¿ç”¨</li>
<li>æ— éœ€æ¸…é™¤ä¸Šä¸€è½®æ ‡è®°ä½</li>
<li>èŠ‚çœæ ‡è®°é‡ç½®æ—¶é—´</li>
</ul>
<p><strong>âœ… æ”¯æŒå¤§å †</strong></p>
<ul>
<li>42ä½åœ°å€æ”¯æŒ4TBå †</li>
<li>åœé¡¿æ—¶é—´ä¸å †å¤§å°æ— å…³</li>
</ul>
<p><strong>âŒ ç¼ºç‚¹: è™šæ‹Ÿåœ°å€ç©ºé—´å¼€é”€</strong></p>
<ul>
<li>éœ€è¦3å€è™šæ‹Ÿåœ°å€ç©ºé—´</li>
<li>Linux x86-64: 128TBè™šæ‹Ÿåœ°å€ç©ºé—´,è¶³å¤Ÿä½¿ç”¨</li>
</ul>
<p><strong>âŒ ç¼ºç‚¹: è¯»å±éšœå¼€é”€</strong></p>
<ul>
<li>æ¯æ¬¡è¯»å–å¯¹è±¡å¼•ç”¨éƒ½éœ€è¦æ£€æŸ¥</li>
<li>ç°ä»£CPUåˆ†æ”¯é¢„æµ‹ä¼˜åŒ–åå½±å“è¾ƒå°</li>
</ul>
<h3 data-id="heading-40">3.6 ZGCçš„å‚æ•°è°ƒä¼˜</h3>
<h4 data-id="heading-41">3.6.1 æ ¸å¿ƒå‚æ•°</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯ç”¨ZGC</span>
-XX:+UseZGC

<span class="hljs-comment"># å †å¤§å° (å»ºè®®Xms = Xmx)</span>
-Xms16g -Xmx16g

<span class="hljs-comment"># å¹¶å‘GCçº¿ç¨‹æ•° (é»˜è®¤ParallelGCThreads/4)</span>
-XX:ConcGCThreads=4

<span class="hljs-comment"># å¹¶è¡ŒGCçº¿ç¨‹æ•° (é»˜è®¤ç­‰äºCPUæ ¸å¿ƒæ•°)</span>
-XX:ParallelGCThreads=8

<span class="hljs-comment"># è½¯æœ€å¤§å †å¤§å° (ZGCä¼šå°½åŠ›ä¸è¶…è¿‡æ­¤å€¼)</span>
-XX:SoftMaxHeapSize=14g

<span class="hljs-comment"># å…ƒç©ºé—´</span>
-XX:MetaspaceSize=256m
-XX:MaxMetaspaceSize=512m
</code></pre>
<h4 data-id="heading-42">3.6.2 å®Œæ•´é…ç½®ç¤ºä¾‹</h4>
<p><strong>å¤§å†…å­˜åº”ç”¨ (16æ ¸32GB,å †24GB)</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms24g -Xmx24g \
     -XX:+UseZGC \
     -XX:ConcGCThreads=4 \
     -XX:ParallelGCThreads=16 \
     -XX:SoftMaxHeapSize=20g \
     -XX:MetaspaceSize=512m \
     -XX:MaxMetaspaceSize=1g \
     -XX:+HeapDumpOnOutOfMemoryError \
     -XX:HeapDumpPath=/var/log/heapdump.hprof \
     -Xlog:gc*:file=/var/log/gc.log:time,<span class="hljs-built_in">uptime</span>,level,tags \
     -jar application.jar
</code></pre>
<p><strong>è¶…å¤§å †åº”ç”¨ (32æ ¸128GB,å †96GB)</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms96g -Xmx96g \
     -XX:+UseZGC \
     -XX:ConcGCThreads=8 \
     -XX:ParallelGCThreads=32 \
     -XX:SoftMaxHeapSize=80g \
     -XX:MetaspaceSize=1g \
     -XX:MaxMetaspaceSize=2g \
     -Xlog:gc*:file=/var/log/gc.log:time,<span class="hljs-built_in">uptime</span>,level,tags \
     -jar application.jar
</code></pre>
<hr/>
<h2 data-id="heading-43">å››ã€G1 vs ZGCå¯¹æ¯”åˆ†æ</h2>
<h3 data-id="heading-44">4.1 æ ¸å¿ƒæŠ€æœ¯å¯¹æ¯”</h3>








































<table><thead><tr><th>ç»´åº¦</th><th>G1</th><th>ZGC</th></tr></thead><tbody><tr><td><strong>åˆ†åŒºè®¾è®¡</strong></td><td>Regionåˆ†åŒº (1MB-32MB)</td><td>Pageåˆ†åŒº (2MB, 32KB, 256KBä¸‰ç§)</td></tr><tr><td><strong>æ ‡è®°ç®—æ³•</strong></td><td>ä¸‰è‰²æ ‡è®° + SATB</td><td>ä¸‰è‰²æ ‡è®° + æŸ“è‰²æŒ‡é’ˆ</td></tr><tr><td><strong>å±éšœç±»å‹</strong></td><td>å†™å±éšœ (ç»´æŠ¤RSet) + å‰ç½®å†™å±éšœ (SATB)</td><td>è¯»å±éšœ (Load Barrier)</td></tr><tr><td><strong>é‡å®šä½</strong></td><td>å¤åˆ¶ç®—æ³• (STW)</td><td>å¹¶å‘é‡å®šä½ (è¯»å±éšœ + è½¬å‘è¡¨)</td></tr><tr><td><strong>å†…å­˜ç®¡ç†</strong></td><td>å•ä¸€è§†å›¾</td><td>å¤šé‡æ˜ å°„ (3ä¸ªè§†å›¾)</td></tr><tr><td><strong>GCä¿¡æ¯å­˜å‚¨</strong></td><td>å¯¹è±¡å¤´ (Mark Word)</td><td>æŒ‡é’ˆå…ƒæ•°æ®ä½</td></tr></tbody></table>
<h3 data-id="heading-45">4.2 æ€§èƒ½å¯¹æ¯”</h3>








































<table><thead><tr><th>æŒ‡æ ‡</th><th>G1</th><th>ZGC</th></tr></thead><tbody><tr><td><strong>åœé¡¿æ—¶é—´</strong></td><td>50-200ms</td><td>&lt; 10ms (é€šå¸¸ &lt; 1ms)</td></tr><tr><td><strong>ååé‡</strong></td><td>95-98%</td><td>85-95%</td></tr><tr><td><strong>å †å¤§å°</strong></td><td>4GB - 64GB (æœ€ä½³)</td><td>8GB - 16TB</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>é€šç”¨åœºæ™¯,å¹³è¡¡æ€§èƒ½</td><td>è¶…å¤§å †,æä½å»¶è¿Ÿ</td></tr><tr><td><strong>CPUå¼€é”€</strong></td><td>ä¸­ç­‰</td><td>è¾ƒé«˜ (è¯»å±éšœ)</td></tr><tr><td><strong>å†…å­˜å¼€é”€</strong></td><td>RSetå 5-10%</td><td>è™šæ‹Ÿåœ°å€ç©ºé—´3å€ (ç‰©ç†å†…å­˜ä¸å¢åŠ )</td></tr></tbody></table>
<h3 data-id="heading-46">4.3 GCæµç¨‹å¯¹æ¯”</h3>



































<table><thead><tr><th>GCé˜¶æ®µ</th><th>G1</th><th>ZGC</th></tr></thead><tbody><tr><td><strong>Young GC</strong></td><td>STW,20-100ms</td><td>æ— ç‹¬ç«‹Young GC,ç»Ÿä¸€æµç¨‹</td></tr><tr><td><strong>å¹¶å‘æ ‡è®°</strong></td><td>4é˜¶æ®µ,2ä¸ªSTW (åˆå§‹/æœ€ç»ˆæ ‡è®°)</td><td>7é˜¶æ®µ,3ä¸ªSTW (æ¯ä¸ª &lt; 1ms)</td></tr><tr><td><strong>Mixed GC</strong></td><td>STW,50-200ms,å›æ”¶éƒ¨åˆ†è€å¹´ä»£</td><td>æ— Mixed GCæ¦‚å¿µ</td></tr><tr><td><strong>é‡å®šä½</strong></td><td>STW,å¤åˆ¶å¯¹è±¡</td><td>å¹¶å‘,æ— STW</td></tr><tr><td><strong>Full GC</strong></td><td>å¯èƒ½å‘ç”Ÿ,åœé¡¿å‡ ç§’</td><td>å‡ ä¹ä¸å‘ç”Ÿ</td></tr></tbody></table>
<h3 data-id="heading-47">4.4 å‚æ•°å¤æ‚åº¦å¯¹æ¯”</h3>






























<table><thead><tr><th>ç»´åº¦</th><th>G1</th><th>ZGC</th></tr></thead><tbody><tr><td><strong>æ ¸å¿ƒå‚æ•°</strong></td><td>~10ä¸ª</td><td>~5ä¸ª</td></tr><tr><td><strong>è°ƒä¼˜éš¾åº¦</strong></td><td>ä¸­ç­‰</td><td>ä½</td></tr><tr><td><strong>è‡ªé€‚åº”èƒ½åŠ›</strong></td><td>è¾ƒå¼º</td><td>æå¼º</td></tr><tr><td><strong>é»˜è®¤é…ç½®</strong></td><td>é€‚ç”¨å¤§å¤šæ•°åœºæ™¯</td><td>å¼€ç®±å³ç”¨</td></tr></tbody></table>
<h3 data-id="heading-48">4.5 é€‰æ‹©å»ºè®®</h3>
<p><strong>é€‰æ‹©G1çš„åœºæ™¯</strong>:</p>
<p>âœ… å †å†…å­˜ 4GB - 64GB
âœ… åœé¡¿æ—¶é—´è¦æ±‚ 50-200ms
âœ… è¿½æ±‚ååé‡å’Œå»¶è¿Ÿçš„å¹³è¡¡
âœ… é€šç”¨äº’è”ç½‘åº”ç”¨,ç”µå•†,ç¤¾äº¤,å†…å®¹å¹³å°
âœ… å¾®æœåŠ¡æ¶æ„</p>
<p><strong>é€‰æ‹©ZGCçš„åœºæ™¯</strong>:</p>
<p>âœ… å †å†…å­˜ â‰¥ 16GB,ç”šè‡³TBçº§
âœ… åœé¡¿æ—¶é—´è¦æ±‚ &lt; 10ms
âœ… ä½å»¶è¿Ÿä¼˜å…ˆçº§é«˜äºååé‡
âœ… é‡‘èäº¤æ˜“ç³»ç»Ÿ,å®æ—¶ç«ä»·,æ¸¸æˆæœåŠ¡å™¨
âœ… å¤§æ•°æ®å®æ—¶å¤„ç†,æµè®¡ç®—</p>
<hr/>
<h2 data-id="heading-49">äº”ã€ç”Ÿäº§ç¯å¢ƒåº”ç”¨åœºæ™¯</h2>
<h3 data-id="heading-50">5.1 ç”µå•†ç§’æ€ç³»ç»Ÿ (é€‰æ‹©G1)</h3>
<p><strong>ä¸šåŠ¡ç‰¹ç‚¹</strong>:</p>
<ul>
<li>æµé‡å³°å€¼: ç§’æ€æ´»åŠ¨ç¬æ—¶QPSä»1000é£™å‡è‡³10ä¸‡</li>
<li>å †å†…å­˜: 8GB</li>
<li>å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ: å¤§éƒ¨åˆ†å¯¹è±¡çŸ­ç”Ÿå‘½å‘¨æœŸ(HTTPè¯·æ±‚å¯¹è±¡ã€ç¼“å­˜å¯¹è±¡)</li>
<li>å»¶è¿Ÿè¦æ±‚: TP99 &lt; 200ms</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©G1</strong>:</p>
<ul>
<li>å †å†…å­˜8GB,G1é€‚ç”¨èŒƒå›´</li>
<li>åŠ¨æ€è°ƒæ•´æ–°ç”Ÿä»£å¤§å°,åº”å¯¹æµé‡å³°å€¼</li>
<li>Young GCé¢‘ç¹ä½†åœé¡¿æ—¶é—´çŸ­(50ms)</li>
<li>Mixed GCå¯æ§åˆ¶åœ¨100mså†…</li>
</ul>
<p><strong>G1é…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms8g -Xmx8g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=100 \
     -XX:G1HeapRegionSize=8m \
     -XX:InitiatingHeapOccupancyPercent=40 \
     -XX:G1ReservePercent=15 \
     -XX:MetaspaceSize=256m \
     -XX:MaxMetaspaceSize=512m \
     -Xloggc:/var/log/gc.log \
     -jar seckill-service.jar
</code></pre>
<p><strong>æ•ˆæœ</strong>:</p>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>è°ƒä¼˜å‰ (Parallel GC)</th><th>è°ƒä¼˜å (G1)</th></tr></thead><tbody><tr><td>TP99å»¶è¿Ÿ</td><td>500ms</td><td>150ms</td></tr><tr><td>GCåœé¡¿</td><td>200-500ms</td><td>50-100ms</td></tr><tr><td>ååé‡</td><td>95%</td><td>96%</td></tr><tr><td>Full GCé¢‘ç‡</td><td>æ¯å°æ—¶2æ¬¡</td><td>åŸºæœ¬æ— Full GC</td></tr></tbody></table>
<h3 data-id="heading-51">5.2 é‡‘èæ”¯ä»˜ç³»ç»Ÿ (é€‰æ‹©ZGC)</h3>
<p><strong>ä¸šåŠ¡ç‰¹ç‚¹</strong>:</p>
<ul>
<li>æµé‡: ç¨³å®šQPS 5000,å³°å€¼1ä¸‡</li>
<li>å †å†…å­˜: 32GB</li>
<li>å»¶è¿Ÿè¦æ±‚: <strong>æä½å»¶è¿Ÿ,TP99 &lt; 50ms,ä»»ä½•è¶…è¿‡100msçš„åœé¡¿éƒ½å¯èƒ½å¯¼è‡´äº¤æ˜“å¤±è´¥</strong></li>
<li>ç›‘ç®¡è¦æ±‚: æ”¯ä»˜å“åº”æ—¶é—´ &lt; 100ms</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©ZGC</strong>:</p>
<ul>
<li>å †å†…å­˜32GB,G1çš„Full GCå¯èƒ½è¾¾åˆ°1-2ç§’,ä¸å¯æ¥å—</li>
<li>ZGCåœé¡¿æ—¶é—´ &lt; 10ms,ä¸å †å¤§å°æ— å…³</li>
<li>é‡‘èç³»ç»Ÿå¯¹å»¶è¿Ÿæ•æ„Ÿ,æ„¿æ„ç‰ºç‰²5-10%ååé‡æ¢å–æä½åœé¡¿</li>
</ul>
<p><strong>ZGCé…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms32g -Xmx32g \
     -XX:+UseZGC \
     -XX:ConcGCThreads=8 \
     -XX:ParallelGCThreads=16 \
     -XX:SoftMaxHeapSize=28g \
     -XX:MetaspaceSize=512m \
     -XX:MaxMetaspaceSize=1g \
     -Xlog:gc*:file=/var/log/gc.log:time,<span class="hljs-built_in">uptime</span>,level,tags \
     -jar payment-service.jar
</code></pre>
<p><strong>æ•ˆæœ</strong>:</p>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>è°ƒä¼˜å‰ (G1)</th><th>è°ƒä¼˜å (ZGC)</th></tr></thead><tbody><tr><td>TP99å»¶è¿Ÿ</td><td>120ms</td><td>45ms</td></tr><tr><td>GCåœé¡¿</td><td>50-150ms</td><td>&lt; 5ms</td></tr><tr><td>ååé‡</td><td>97%</td><td>92%</td></tr><tr><td>Full GCåœé¡¿</td><td>å¶å°”1-2ç§’</td><td>æ— Full GC</td></tr></tbody></table>
<h3 data-id="heading-52">5.3 å¤§æ•°æ®å®æ—¶è®¡ç®— (é€‰æ‹©ZGC)</h3>
<p><strong>ä¸šåŠ¡ç‰¹ç‚¹</strong>:</p>
<ul>
<li>å®æ—¶æµå¤„ç†: Flinkä»»åŠ¡,å¤„ç†10äº¿æ¡/å¤©çš„æ—¥å¿—æ•°æ®</li>
<li>å †å†…å­˜: 64GB</li>
<li>å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ: ä¸­é•¿ç”Ÿå‘½å‘¨æœŸ(çŠ¶æ€æ•°æ®ã€çª—å£æ•°æ®)</li>
<li>å»¶è¿Ÿè¦æ±‚: å¤„ç†å»¶è¿Ÿ &lt; 1ç§’,GCåœé¡¿ä¸èƒ½å½±å“å®æ—¶æ€§</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©ZGC</strong>:</p>
<ul>
<li>å †å†…å­˜64GB,G1çš„Mixed GCå¯èƒ½è¾¾åˆ°200-500ms</li>
<li>å®æ—¶è®¡ç®—å¯¹å»¶è¿Ÿæ•æ„Ÿ,é•¿æ—¶é—´GCå¯¼è‡´æ•°æ®ç§¯å‹</li>
<li>ZGCå¹¶å‘é‡å®šä½,å¯¹è®¡ç®—çº¿ç¨‹å½±å“æœ€å°</li>
</ul>
<p><strong>ZGCé…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms64g -Xmx64g \
     -XX:+UseZGC \
     -XX:ConcGCThreads=16 \
     -XX:ParallelGCThreads=32 \
     -XX:SoftMaxHeapSize=56g \
     -XX:MetaspaceSize=1g \
     -XX:MaxMetaspaceSize=2g \
     -Xlog:gc*:file=/var/log/gc.log:time,<span class="hljs-built_in">uptime</span>,level,tags \
     -jar flink-taskmanager.jar
</code></pre>
<p><strong>æ•ˆæœ</strong>:</p>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>è°ƒä¼˜å‰ (G1)</th><th>è°ƒä¼˜å (ZGC)</th></tr></thead><tbody><tr><td>æ•°æ®å¤„ç†å»¶è¿Ÿ</td><td>800ms</td><td>400ms</td></tr><tr><td>GCåœé¡¿</td><td>100-300ms</td><td>&lt; 8ms</td></tr><tr><td>ååé‡</td><td>96%</td><td>90%</td></tr><tr><td>æ•°æ®ç§¯å‹</td><td>å¶å°”å‘ç”Ÿ</td><td>åŸºæœ¬æ— ç§¯å‹</td></tr></tbody></table>
<h3 data-id="heading-53">5.4 å¾®æœåŠ¡ç½‘å…³ (é€‰æ‹©G1)</h3>
<p><strong>ä¸šåŠ¡ç‰¹ç‚¹</strong>:</p>
<ul>
<li>é«˜å¹¶å‘: QPS 2ä¸‡,å³°å€¼5ä¸‡</li>
<li>å †å†…å­˜: 4GB</li>
<li>å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ: æçŸ­(HTTPè¯·æ±‚/å“åº”å¯¹è±¡)</li>
<li>å»¶è¿Ÿè¦æ±‚: TP99 &lt; 100ms</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆé€‰æ‹©G1</strong>:</p>
<ul>
<li>å †å†…å­˜4GB,G1å¤Ÿç”¨</li>
<li>å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæçŸ­,å¤§éƒ¨åˆ†åœ¨EdenåŒºå›æ”¶</li>
<li>Young GCé¢‘ç¹ä½†åœé¡¿æ—¶é—´çŸ­</li>
<li>G1çš„ååé‡ä¼˜äºZGC</li>
</ul>
<p><strong>G1é…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">java -Xms4g -Xmx4g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=50 \
     -XX:G1HeapRegionSize=4m \
     -XX:G1NewSizePercent=40 \
     -XX:G1MaxNewSizePercent=60 \
     -XX:MetaspaceSize=128m \
     -XX:MaxMetaspaceSize=256m \
     -Xloggc:/var/log/gc.log \
     -jar gateway-service.jar
</code></pre>
<p><strong>æ•ˆæœ</strong>:</p>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>è°ƒä¼˜å‰ (CMS)</th><th>è°ƒä¼˜å (G1)</th></tr></thead><tbody><tr><td>TP99å»¶è¿Ÿ</td><td>150ms</td><td>80ms</td></tr><tr><td>GCåœé¡¿</td><td>20-100ms</td><td>20-50ms</td></tr><tr><td>ååé‡</td><td>93%</td><td>97%</td></tr><tr><td>Full GCé¢‘ç‡</td><td>æ¯å¤©2-3æ¬¡</td><td>åŸºæœ¬æ— Full GC</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-54">å…­ã€ç”Ÿäº§æ¡ˆä¾‹ä¸è°ƒä¼˜å®æˆ˜</h2>
<h3 data-id="heading-55">6.1 æ¡ˆä¾‹1: G1é¢‘ç¹Full GC</h3>
<p><strong>æ•…éšœç°è±¡</strong>:</p>
<p>æŸç”µå•†ç³»ç»Ÿ(å †8GB)ä½¿ç”¨G1,ç”Ÿäº§ç¯å¢ƒæ¯å°æ—¶è§¦å‘5-10æ¬¡Full GC,æ¯æ¬¡åœé¡¿2-3ç§’,å¯¼è‡´æ¥å£è¶…æ—¶ã€‚</p>
<p><strong>æ’æŸ¥è¿‡ç¨‹</strong>:</p>
<p><strong>1. æŸ¥çœ‹GCæ—¥å¿—</strong></p>
<pre><code class="hljs language-bash" lang="bash">grep <span class="hljs-string">"Full GC"</span> gc.log | <span class="hljs-built_in">tail</span> -20
</code></pre>
<p>å‘ç°Full GCé¢‘ç¹,å›æ”¶æ•ˆæœå·®(åªå›æ”¶500MB)ã€‚</p>
<p><strong>2. åˆ†æè§¦å‘åŸå› </strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2024-01-15T14:23:45.123</span><span class="hljs-string">+0800:</span> <span class="hljs-attr">7890.456:</span> [<span class="hljs-string">Full</span> <span class="hljs-string">GC</span> <span class="hljs-string">(Allocation</span> <span class="hljs-string">Failure)</span> <span class="hljs-string">7680M-&gt;7280M(8192M)</span>, <span class="hljs-number">2.3456789</span> <span class="hljs-string">secs</span>]
</code></pre>
<p>è§¦å‘åŸå› : <code>Allocation Failure</code> â†’ å¯¹è±¡åˆ†é…å¤±è´¥,æ™‹å‡å¤±è´¥ã€‚</p>
<p><strong>3. æŸ¥çœ‹å †ä½¿ç”¨æƒ…å†µ</strong></p>
<pre><code class="hljs language-bash" lang="bash">jstat -gc &lt;pid&gt; 1000 10
</code></pre>
<p>å‘ç°è€å¹´ä»£ä½¿ç”¨ç‡æŒç»­åœ¨90%ä»¥ä¸Šã€‚</p>
<p><strong>4. dumpå†…å­˜åˆ†æ</strong></p>
<pre><code class="hljs language-bash" lang="bash">jmap -dump:live,format=b,file=heap.hprof &lt;pid&gt;
</code></pre>
<p>ä½¿ç”¨MATåˆ†æ,å‘ç°å¤§é‡<code>byte[]</code>å¯¹è±¡,å ç”¨4GBå†…å­˜,å¼•ç”¨é“¾:</p>
<pre><code class="hljs language-arduino" lang="arduino">CacheManager.<span class="hljs-built_in">imageCache</span> (<span class="hljs-type">static</span>)
  â†“
ConcurrentHashMap
  â†“
SoftReference&lt;<span class="hljs-type">byte</span>[]&gt;  â† ç¼“å­˜çš„å›¾ç‰‡æ•°æ®
</code></pre>
<p><strong>é—®é¢˜å®šä½</strong>:</p>
<p>ä»£ç ä½¿ç”¨<code>SoftReference</code>ç¼“å­˜å›¾ç‰‡,ä½†ç¼“å­˜æ²¡æœ‰ä¸Šé™,å†…å­˜ä¸è¶³æ—¶é›†ä¸­å›æ”¶å¯¼è‡´é¢‘ç¹Full GCã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<p>ä½¿ç”¨Guava Cacheæ›¿ä»£SoftReference:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¿®å¤å‰</span>
Map&lt;String, SoftReference&lt;<span class="hljs-type">byte</span>[]&gt;&gt; imageCache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;();

<span class="hljs-comment">// ä¿®å¤å</span>
Cache&lt;String, <span class="hljs-type">byte</span>[]&gt; imageCache = CacheBuilder.newBuilder()
    .maximumSize(<span class="hljs-number">5000</span>)              <span class="hljs-comment">// é™åˆ¶5000ä¸ª</span>
    .expireAfterWrite(<span class="hljs-number">1</span>, TimeUnit.HOURS)
    .build();
</code></pre>
<p><strong>è°ƒæ•´G1å‚æ•°</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é™ä½å¹¶å‘æ ‡è®°è§¦å‘é˜ˆå€¼,æå‰è§¦å‘Mixed GC</span>
-XX:InitiatingHeapOccupancyPercent=35  <span class="hljs-comment"># ä»45%é™è‡³35%</span>

<span class="hljs-comment"># å¢åŠ ä¿ç•™ç©ºé—´,é˜²æ­¢æ™‹å‡å¤±è´¥</span>
-XX:G1ReservePercent=15  <span class="hljs-comment"># ä»10%å¢è‡³15%</span>
</code></pre>
<p><strong>æ•ˆæœ</strong>:</p>





























<table><thead><tr><th>æŒ‡æ ‡</th><th>ä¼˜åŒ–å‰</th><th>ä¼˜åŒ–å</th><th>æ”¹å–„</th></tr></thead><tbody><tr><td>Full GCé¢‘ç‡</td><td>æ¯å°æ—¶5-10æ¬¡</td><td>åŸºæœ¬æ— </td><td><strong>99%â†“</strong></td></tr><tr><td>å †ä½¿ç”¨ç‡</td><td>90%</td><td>60%</td><td><strong>33%â†“</strong></td></tr><tr><td>TP99å»¶è¿Ÿ</td><td>2500ms</td><td>120ms</td><td><strong>95%â†“</strong></td></tr></tbody></table>
<h3 data-id="heading-56">6.2 æ¡ˆä¾‹2: ZGCå†…å­˜æ³„æ¼</h3>
<p><strong>æ•…éšœç°è±¡</strong>:</p>
<p>æŸæ”¯ä»˜ç³»ç»Ÿ(å †32GB)ä½¿ç”¨ZGC,è¿è¡Œ3å¤©å,å †ä½¿ç”¨ç‡æŒç»­å¢é•¿è‡³95%,è§¦å‘é¢‘ç¹GC,ä½†å›æ”¶æ•ˆæœå·®ã€‚</p>
<p><strong>æ’æŸ¥è¿‡ç¨‹</strong>:</p>
<p><strong>1. æŸ¥çœ‹GCæ—¥å¿—</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">tail</span> -1000 gc.log | grep <span class="hljs-string">"Heap: "</span>
</code></pre>
<p>å‘ç°å †ä½¿ç”¨ç‡ä»60%é€æ­¥å¢é•¿åˆ°95%,GCæ— æ³•æœ‰æ•ˆå›æ”¶ã€‚</p>
<p><strong>2. å¯¹æ¯”ä¸åŒæ—¶é—´ç‚¹çš„heap dump</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¬¬1å¤©</span>
jmap -dump:live,format=b,file=heap_day1.hprof &lt;pid&gt;

<span class="hljs-comment"># ç¬¬3å¤©</span>
jmap -dump:live,format=b,file=heap_day3.hprof &lt;pid&gt;
</code></pre>
<p><strong>3. MATå¯¹æ¯”åˆ†æ</strong></p>
<p>ä½¿ç”¨MATçš„Histogramå¯¹æ¯”åŠŸèƒ½,å‘ç°:</p>
<ul>
<li><code>java.util.concurrent.ConcurrentHashMap$Node</code>å¯¹è±¡æ•°é‡ä»10ä¸‡å¢é•¿åˆ°500ä¸‡</li>
<li>å ç”¨å†…å­˜ä»500MBå¢é•¿åˆ°15GB</li>
</ul>
<p><strong>4. å®šä½æ³„æ¼ä»£ç </strong></p>
<p>é€šè¿‡Dominator Tree,æ‰¾åˆ°å¼•ç”¨é“¾:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">RequestContextHolder</span> (<span class="hljs-keyword">static</span>)
  â†“
<span class="hljs-title class_">ThreadLocal</span>&lt;<span class="hljs-title class_">RequestContext</span>&gt;
  â†“
<span class="hljs-title class_">ConcurrentHashMap</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; (request attributes)
</code></pre>
<p><strong>é—®é¢˜å®šä½</strong>:</p>
<p>ä»£ç åœ¨æ¯ä¸ªè¯·æ±‚ä¸­å°†å¤§é‡æ•°æ®å­˜å…¥<code>ThreadLocal</code>,ä½†è¯·æ±‚ç»“æŸåæœªæ¸…ç†,å¯¼è‡´çº¿ç¨‹æ± åœºæ™¯ä¸‹<code>ThreadLocal</code>æ³„æ¼ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é—®é¢˜ä»£ç </span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;RequestContext&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> {
        context.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestContext</span>(request));
        chain.doFilter(request, response);
        <span class="hljs-comment">// âŒ å¿˜è®°æ¸…ç†!</span>
    }
}

<span class="hljs-comment">// ä¿®å¤å</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ThreadLocal&lt;RequestContext&gt; context = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> {
        <span class="hljs-keyword">try</span> {
            context.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestContext</span>(request));
            chain.doFilter(request, response);
        } <span class="hljs-keyword">finally</span> {
            context.remove();  <span class="hljs-comment">// âœ… æ¸…ç†ThreadLocal</span>
        }
    }
}
</code></pre>
<p><strong>æ•ˆæœ</strong>:</p>





























<table><thead><tr><th>æŒ‡æ ‡</th><th>ä¼˜åŒ–å‰</th><th>ä¼˜åŒ–å</th><th>æ”¹å–„</th></tr></thead><tbody><tr><td>å †ä½¿ç”¨ç‡</td><td>95%</td><td>60%</td><td><strong>37%â†“</strong></td></tr><tr><td>GCé¢‘ç‡</td><td>æ¯åˆ†é’Ÿ10æ¬¡</td><td>æ¯10åˆ†é’Ÿ1æ¬¡</td><td><strong>99%â†“</strong></td></tr><tr><td>å†…å­˜æ³„æ¼</td><td>æ¯å¤©å¢é•¿5GB</td><td>æ— å¢é•¿</td><td><strong>100%ä¿®å¤</strong></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-57">ä¸ƒã€å¸¸è§é—®é¢˜è§£ç­”</h2>
<h3 data-id="heading-58">7.1 G1å’ŒZGCå¦‚ä½•é€‰æ‹©?</h3>
<p><strong>å†³ç­–æ ‘</strong>:</p>
<pre><code class="hljs language-objectivec" lang="objectivec">å †å†…å­˜å¤§å°?
  â”œâ”€â”€ &lt; <span class="hljs-number">4</span>GB  â†’ G1 æˆ– <span class="hljs-built_in">CMS</span>
  â”œâ”€â”€ <span class="hljs-number">4</span><span class="hljs-number">-16</span>GB â†’ G1
  â”œâ”€â”€ <span class="hljs-number">16</span><span class="hljs-number">-64</span>GB â†’ G1 æˆ– ZGC (æ ¹æ®å»¶è¿Ÿè¦æ±‚)
  â””â”€â”€ â‰¥ <span class="hljs-number">64</span>GB  â†’ ZGC

å»¶è¿Ÿè¦æ±‚?
  â”œâ”€â”€ TP99 &lt; <span class="hljs-number">10</span>ms  â†’ ZGC
  â”œâ”€â”€ TP99 &lt; <span class="hljs-number">100</span>ms â†’ G1
  â””â”€â”€ ååé‡ä¼˜å…ˆ â†’ G1

åº”ç”¨ç±»å‹?
  â”œâ”€â”€ é‡‘èäº¤æ˜“ã€å®æ—¶ç³»ç»Ÿ â†’ ZGC
  â”œâ”€â”€ ç”µå•†ã€ç¤¾äº¤ã€å†…å®¹å¹³å° â†’ G1
  â”œâ”€â”€ å¤§æ•°æ®å®æ—¶è®¡ç®— â†’ ZGC
  â””â”€â”€ å¾®æœåŠ¡ã€ç½‘å…³ â†’ G1
</code></pre>
<h3 data-id="heading-59">7.2 G1çš„MaxGCPauseMilliså¦‚ä½•è®¾ç½®?</h3>
<p><strong>åŸåˆ™</strong>:</p>
<ul>
<li>è¿™æ˜¯è½¯ç›®æ ‡,G1ä¼šå°½åŠ›è¾¾æˆä½†ä¸ä¿è¯</li>
<li>è®¾ç½®è¿‡å°(å¦‚10ms),G1æ— æ³•è¾¾æˆ,å¯èƒ½é¢‘ç¹è§¦å‘Full GC</li>
<li>è®¾ç½®è¿‡å¤§(å¦‚500ms),å¤±å»G1çš„ä½å»¶è¿Ÿä¼˜åŠ¿</li>
</ul>
<p><strong>å»ºè®®</strong>:</p>
<ul>
<li>é€šç”¨åº”ç”¨: 100-200ms</li>
<li>ä½å»¶è¿Ÿåº”ç”¨: 50-100ms</li>
<li>ååé‡ä¼˜å…ˆ: 200-500ms</li>
</ul>
<p><strong>éªŒè¯æ–¹æ³•</strong>:</p>
<p>æŸ¥çœ‹GCæ—¥å¿—,ç¡®è®¤å®é™…åœé¡¿æ—¶é—´:</p>
<pre><code class="hljs language-bash" lang="bash">grep <span class="hljs-string">"GC pause"</span> gc.log | awk <span class="hljs-string">'{print $NF}'</span> | <span class="hljs-built_in">sort</span> -n | <span class="hljs-built_in">tail</span> -100
</code></pre>
<p>å¦‚æœå®é™…åœé¡¿æ—¶é—´è¿œè¶…ç›®æ ‡,è€ƒè™‘:</p>
<ul>
<li>å¢å¤§å †å†…å­˜</li>
<li>é™ä½<code>InitiatingHeapOccupancyPercent</code>,æå‰è§¦å‘å¹¶å‘æ ‡è®°</li>
<li>å¢åŠ å¹¶å‘GCçº¿ç¨‹æ•°</li>
</ul>
<h3 data-id="heading-60">7.3 ä¸ºä»€ä¹ˆG1ä»ç„¶ä¼šè§¦å‘Full GC?</h3>
<p><strong>Full GCçš„è§¦å‘åœºæ™¯</strong>:</p>
<ol>
<li>
<p><strong>æ™‹å‡å¤±è´¥ (Promotion Failure)</strong>:</p>
<ul>
<li>Young GCæ—¶,è€å¹´ä»£æ²¡æœ‰è¶³å¤Ÿç©ºé—´å®¹çº³æ™‹å‡å¯¹è±¡</li>
<li>è§£å†³: å¢å¤§å †å†…å­˜,é™ä½<code>InitiatingHeapOccupancyPercent</code></li>
</ul>
</li>
<li>
<p><strong>å·¨å‹å¯¹è±¡åˆ†é…å¤±è´¥ (Humongous Allocation Failure)</strong>:</p>
<ul>
<li>æ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­Regionå­˜å‚¨å¤§å¯¹è±¡</li>
<li>è§£å†³: å¢å¤§<code>G1HeapRegionSize</code>,é¿å…å¤§å¯¹è±¡(ä¼˜åŒ–ä»£ç ,æ‹†åˆ†å¯¹è±¡)</li>
</ul>
</li>
<li>
<p><strong>å¹¶å‘æ¨¡å¼å¤±è´¥ (Concurrent Mode Failure)</strong>:</p>
<ul>
<li>å¹¶å‘æ ‡è®°æœªå®Œæˆ,è€å¹´ä»£å·²æ»¡</li>
<li>è§£å†³: é™ä½<code>InitiatingHeapOccupancyPercent</code>,å¢åŠ <code>ConcGCThreads</code></li>
</ul>
</li>
<li>
<p><strong>å…ƒç©ºé—´ä¸è¶³</strong>:</p>
<ul>
<li>Metaspace OOM</li>
<li>è§£å†³: å¢å¤§<code>MaxMetaspaceSize</code></li>
</ul>
</li>
</ol>
<h3 data-id="heading-61">7.4 ZGCæœ‰å“ªäº›é™åˆ¶?</h3>
<p><strong>ZGCçš„é™åˆ¶</strong>:</p>
<ol>
<li>
<p><strong>JDKç‰ˆæœ¬</strong>:</p>
<ul>
<li>JDK 11: å®éªŒæ€§ç‰¹æ€§ (<code>-XX:+UnlockExperimentalVMOptions -XX:+UseZGC</code>)</li>
<li>JDK 15+: æ­£å¼ç‰¹æ€§ (<code>-XX:+UseZGC</code>)</li>
</ul>
</li>
<li>
<p><strong>æ“ä½œç³»ç»Ÿ</strong>:</p>
<ul>
<li>Linux (x86-64): å®Œå…¨æ”¯æŒ</li>
<li>macOS: JDK 14+æ”¯æŒ</li>
<li>Windows: JDK 14+æ”¯æŒ</li>
</ul>
</li>
<li>
<p><strong>å †å¤§å°</strong>:</p>
<ul>
<li>æœ€å°: 8GB (å»ºè®®)</li>
<li>æœ€å¤§: 16TB (ç†è®ºä¸Š)</li>
<li>å®é™…ç”Ÿäº§: 16GB - 512GB</li>
</ul>
</li>
<li>
<p><strong>CPUå¼€é”€</strong>:</p>
<ul>
<li>è¯»å±éšœå¸¦æ¥é¢å¤–CPUå¼€é”€</li>
<li>å¹¶å‘GCçº¿ç¨‹å ç”¨CPU</li>
<li>ååé‡æŸå¤±5-15%</li>
</ul>
</li>
<li>
<p><strong>ä¸æ”¯æŒå‹ç¼©ç±»æŒ‡é’ˆ</strong>:</p>
<ul>
<li>ZGCä¸æ”¯æŒ<code>-XX:+UseCompressedClassPointers</code></li>
<li>å…ƒç©ºé—´å ç”¨ç•¥é«˜</li>
</ul>
</li>
</ol>
<h3 data-id="heading-62">7.5 å¦‚ä½•ç›‘æ§G1å’ŒZGCçš„æ€§èƒ½?</h3>
<p><strong>GCæ—¥å¿—åˆ†æ</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># JDK 8åŠä¹‹å‰ (G1)</span>
-XX:+PrintGCDetails
-XX:+PrintGCDateStamps
-Xloggc:/var/log/gc.log

<span class="hljs-comment"># JDK 9+ (G1/ZGC)</span>
-Xlog:gc*:file=/var/log/gc.log:time,<span class="hljs-built_in">uptime</span>,level,tags
</code></pre>
<p><strong>åœ¨çº¿åˆ†æå·¥å…·</strong>:</p>
<ul>
<li><strong>GCEasy</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgceasy.io" target="_blank" title="https://gceasy.io" ref="nofollow noopener noreferrer">gceasy.io</a> (å…è´¹,å¯è§†åŒ–GCæ—¥å¿—)</li>
<li><strong>GCViewer</strong>: å¼€æºGCæ—¥å¿—åˆ†æå·¥å…·</li>
</ul>
<p><strong>å…³é”®æŒ‡æ ‡</strong>:</p>



































<table><thead><tr><th>æŒ‡æ ‡</th><th>G1ç›®æ ‡</th><th>ZGCç›®æ ‡</th></tr></thead><tbody><tr><td>ååé‡</td><td>â‰¥ 95%</td><td>â‰¥ 90%</td></tr><tr><td>Young GCåœé¡¿</td><td>&lt; 100ms</td><td>N/A</td></tr><tr><td>Mixed GCåœé¡¿</td><td>&lt; 200ms</td><td>N/A</td></tr><tr><td>ZGCåœé¡¿</td><td>N/A</td><td>&lt; 10ms</td></tr><tr><td>Full GCé¢‘ç‡</td><td>0</td><td>0</td></tr></tbody></table>
<p><strong>APMç³»ç»Ÿé›†æˆ</strong>:</p>
<ul>
<li>Prometheus + Grafana</li>
<li>SkyWalking</li>
<li>Arthas dashboard</li>
</ul>
<hr/>
<h2 data-id="heading-63">å…«ã€æœ€ä½³å®è·µä¸å»ºè®®</h2>
<h3 data-id="heading-64">8.1 G1æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-65">8.1.1 å‚æ•°é…ç½®Checklist</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-Xms</code> = <code>-Xmx</code> (é¿å…åŠ¨æ€æ‰©å®¹)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å †å¤§å° = ç‰©ç†å†…å­˜çš„60-80%</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:MaxGCPauseMillis=100-200</code> (æ ¹æ®ä¸šåŠ¡è°ƒæ•´)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:G1HeapRegionSize</code> æ‰‹åŠ¨è®¾ç½®(å † â‰¥ 16GBæ—¶)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:InitiatingHeapOccupancyPercent=40-45</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:G1ReservePercent=10-15</code></li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å¼€å¯GCæ—¥å¿—,é…ç½®æ—¥å¿—æ»šåŠ¨</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:+HeapDumpOnOutOfMemoryError</code></li>
</ul>
<h4 data-id="heading-66">8.1.2 ä»£ç å±‚é¢ä¼˜åŒ–</h4>
<p><strong>é¿å…å¤§å¯¹è±¡</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯: åˆ›å»ºå¤§æ•°ç»„</span>
<span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">10</span> * <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>];  <span class="hljs-comment">// 10MB,å¯èƒ½æˆä¸ºHumongouså¯¹è±¡</span>

<span class="hljs-comment">// âœ… æ­£ç¡®: ä½¿ç”¨å¯¹è±¡æ± </span>
<span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> bufferPool.acquire();
</code></pre>
<p><strong>åŠæ—¶é‡Šæ”¾èµ„æº</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯: èµ„æºæ³„æ¼</span>
<span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> dataSource.getConnection();
<span class="hljs-comment">// å¿˜è®°close()</span>

<span class="hljs-comment">// âœ… æ­£ç¡®: try-with-resources</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> dataSource.getConnection()) {
    <span class="hljs-comment">// ä½¿ç”¨conn</span>
}  <span class="hljs-comment">// è‡ªåŠ¨close()</span>
</code></pre>
<p><strong>ä½¿ç”¨æœ¬åœ°å˜é‡</strong>:</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// âŒ é”™è¯¯: é™æ€é›†åˆæŒæœ‰å¯¹è±¡</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Cache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, Object&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    <span class="hljs-comment">// æ°¸ä¸æ¸…ç†,æ³„æ¼!</span>
}

<span class="hljs-comment">// âœ… æ­£ç¡®: ä½¿ç”¨Guava Cache</span>
Cache&lt;String, Object&gt; cache = CacheBuilder.newBuilder()
    .maximumSize(<span class="hljs-number">10000</span>)
    .expireAfterWrite(<span class="hljs-number">30</span>, TimeUnit.MINUTES)
    .build();
</code></pre>
<h3 data-id="heading-67">8.2 ZGCæœ€ä½³å®è·µ</h3>
<h4 data-id="heading-68">8.2.1 å‚æ•°é…ç½®Checklist</h4>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-Xms</code> = <code>-Xmx</code> (é¿å…åŠ¨æ€æ‰©å®¹)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å †å¤§å° â‰¥ 16GB</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:SoftMaxHeapSize</code> è®¾ç½®ä¸ºXmxçš„80-90%</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:ConcGCThreads</code> æ ¹æ®CPUæ ¸å¿ƒæ•°è°ƒæ•´</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å…ƒç©ºé—´é…ç½® (ZGCä¸æ”¯æŒå‹ç¼©ç±»æŒ‡é’ˆ)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å¼€å¯GCæ—¥å¿— (ä½¿ç”¨JDK 9+ç»Ÿä¸€æ—¥å¿—æ ¼å¼)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <code>-XX:+HeapDumpOnOutOfMemoryError</code></li>
</ul>
<h4 data-id="heading-69">8.2.2 é€‚ç”¨åœºæ™¯è¯„ä¼°</h4>
<p><strong>ZGCé€‚åˆ</strong>:</p>
<p>âœ… å †å†…å­˜ â‰¥ 16GB
âœ… å»¶è¿Ÿæ•æ„Ÿåº”ç”¨ (TP99 &lt; 10ms)
âœ… æ„¿æ„ç‰ºç‰²5-15%ååé‡æ¢å–ä½å»¶è¿Ÿ
âœ… JDK 15+</p>
<p><strong>ZGCä¸é€‚åˆ</strong>:</p>
<p>âŒ å°å †åº”ç”¨ (&lt; 8GB)
âŒ ååé‡ä¼˜å…ˆåœºæ™¯
âŒ JDK 8/11 (éœ€è¦å‡çº§åˆ°JDK 15+)
âŒ CPUèµ„æºç´§å¼ çš„ç¯å¢ƒ</p>
<h3 data-id="heading-70">8.3 è°ƒä¼˜æµç¨‹</h3>
<h4 data-id="heading-71">8.3.1 æ€§èƒ½åŸºçº¿å»ºç«‹</h4>
<ol>
<li>
<p><strong>æ”¶é›†å½“å‰æ€§èƒ½æ•°æ®</strong> (è‡³å°‘24å°æ—¶):</p>
<ul>
<li>GCæ—¥å¿—</li>
<li>æ¥å£RT/TP99</li>
<li>ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡ (CPU/å†…å­˜/IO)</li>
<li>ä¸šåŠ¡æŒ‡æ ‡ (QPS/TPS/é”™è¯¯ç‡)</li>
</ul>
</li>
<li>
<p><strong>åˆ†æå½“å‰ç“¶é¢ˆ</strong>:</p>
<ul>
<li>GCé¢‘ç‡è¿‡é«˜?</li>
<li>GCåœé¡¿è¿‡é•¿?</li>
<li>å †ä½¿ç”¨ç‡è¿‡é«˜?</li>
<li>Full GCé¢‘ç¹?</li>
</ul>
</li>
</ol>
<h4 data-id="heading-72">8.3.2 è°ƒä¼˜æ­¥éª¤</h4>
<ol>
<li><strong>å°æ­¥å¿«è·‘</strong>: æ¯æ¬¡åªè°ƒæ•´ä¸€ä¸ªå‚æ•°</li>
<li><strong>å‹æµ‹éªŒè¯</strong>: æ¨¡æ‹Ÿç”Ÿäº§æµé‡å‹æµ‹</li>
<li><strong>ç°åº¦å‘å¸ƒ</strong>: 10% â†’ 50% â†’ 100%</li>
<li><strong>æŒç»­ç›‘æ§</strong>: è§‚å¯Ÿ7å¤©,ç¡®ä¿æ— å¼‚å¸¸</li>
</ol>
<h4 data-id="heading-73">8.3.3 ç›‘æ§å‘Šè­¦</h4>
<p>è®¾ç½®å‘Šè­¦é˜ˆå€¼:</p>
<ul>
<li>Full GCé¢‘ç‡ &gt; 1æ¬¡/å°æ—¶</li>
<li>å †ä½¿ç”¨ç‡ &gt; 80%</li>
<li>GCåœé¡¿ &gt; ç›®æ ‡å€¼ (G1: 200ms, ZGC: 10ms)</li>
<li>æ¥å£TP99 &gt; ä¸šåŠ¡ç›®æ ‡</li>
</ul>
<h3 data-id="heading-74">8.4 å¸¸è§é™·é˜±</h3>
<p><strong>é™·é˜±1: ç›²ç›®è¿½æ±‚MaxGCPauseMillis</strong></p>
<p>è®¾ç½®è¿‡å°çš„åœé¡¿ç›®æ ‡(å¦‚10ms),G1æ— æ³•è¾¾æˆ,å¯èƒ½é¢‘ç¹è§¦å‘Full GCã€‚</p>
<p><strong>é™·é˜±2: å¿½ç•¥ååé‡</strong></p>
<p>ZGCä½å»¶è¿Ÿçš„ä»£ä»·æ˜¯ååé‡ä¸‹é™5-15%,éœ€è¦è¯„ä¼°ä¸šåŠ¡æ˜¯å¦å¯æ¥å—ã€‚</p>
<p><strong>é™·é˜±3: ä¸ç›‘æ§GCæ—¥å¿—</strong></p>
<p>GCæ—¥å¿—æ˜¯è°ƒä¼˜çš„åŸºç¡€,å¿…é¡»å¼€å¯å¹¶å®šæœŸåˆ†æã€‚</p>
<p><strong>é™·é˜±4: ä»£ç é—®é¢˜é GCè§£å†³</strong></p>
<p>å†…å­˜æ³„æ¼ã€å¤§å¯¹è±¡é¢‘ç¹åˆ›å»ºç­‰ä»£ç é—®é¢˜,è°ƒæ•´GCå‚æ•°æ— æ³•æ ¹æ²»,å¿…é¡»ä¼˜åŒ–ä»£ç ã€‚</p>
<hr/>
<h2 data-id="heading-75">æ€»ç»“</h2>
<p>G1å’ŒZGCä»£è¡¨äº†Java GCæŠ€æœ¯çš„æ¼”è¿›æ–¹å‘,ä»å¹³è¡¡æ€§èƒ½åˆ°æè‡´ä½å»¶è¿Ÿã€‚<strong>G1é€šè¿‡Regionåˆ†åŒºã€RSetå’ŒSATBç®—æ³•,å®ç°å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´,é€‚ç”¨äº4GB-64GBå †çš„é€šç”¨åœºæ™¯;ZGCé€šè¿‡æŸ“è‰²æŒ‡é’ˆã€è¯»å±éšœå’Œå¹¶å‘é‡å®šä½,å®ç°&lt; 10msçš„è¶…ä½åœé¡¿,ä¸“ä¸ºè¶…å¤§å †å’Œæä½å»¶è¿Ÿåœºæ™¯è®¾è®¡ã€‚</strong></p>
<p><strong>æ ¸å¿ƒè¦ç‚¹</strong>:</p>
<ol>
<li><strong>Regionè®¾è®¡</strong>: G1çš„æ ¸å¿ƒåˆ›æ–°,æ‰“ç ´å›ºå®šåˆ†ä»£è¾¹ç•Œ,æ”¯æŒåŠ¨æ€è°ƒæ•´</li>
<li><strong>RSetæœºåˆ¶</strong>: è®°å½•è·¨Regionå¼•ç”¨,é¿å…å…¨å †æ‰«æ,å¤§å¹…æå‡Young GCæ•ˆç‡</li>
<li><strong>SATBç®—æ³•</strong>: G1çš„å¹¶å‘æ ‡è®°å®ç°,ä¿è¯ä¸æ¼æ ‡å¯¹è±¡,ä»£ä»·æ˜¯æµ®åŠ¨åƒåœ¾</li>
<li><strong>æŸ“è‰²æŒ‡é’ˆ</strong>: ZGCçš„æ ¸å¿ƒåˆ›æ–°,å°†GCä¿¡æ¯å­˜å‚¨åœ¨æŒ‡é’ˆä¸­,å®ç°å¹¶å‘æ ‡è®°å’Œé‡å®šä½</li>
<li><strong>è¯»å±éšœ</strong>: ZGCçš„å…³é”®æŠ€æœ¯,å¯¹è±¡è®¿é—®æ—¶è‡ªåŠ¨å¤„ç†é‡å®šä½,æ— éœ€STW</li>
<li><strong>å¤šé‡æ˜ å°„</strong>: ZGCçš„å†…å­˜ç®¡ç†æŠ€æœ¯,åŒä¸€ç‰©ç†å†…å­˜æ˜ å°„åˆ°å¤šä¸ªè™šæ‹Ÿåœ°å€,å®ç°å¹¶å‘å®‰å…¨</li>
</ol>
<p><strong>é€‰æ‹©å»ºè®®</strong>:</p>
<ul>
<li><strong>å † &lt; 16GB,å»¶è¿Ÿè¦æ±‚ä¸­ç­‰</strong>: é€‰æ‹©G1,å¹³è¡¡æ€§èƒ½,ååé‡é«˜</li>
<li><strong>å † â‰¥ 16GB,å»¶è¿Ÿè¦æ±‚æé«˜</strong>: é€‰æ‹©ZGC,è¶…ä½åœé¡¿,ä»£ä»·æ˜¯ååé‡ä¸‹é™</li>
<li><strong>é€šç”¨äº’è”ç½‘åº”ç”¨</strong>: G1æ˜¯é¦–é€‰,å¼€ç®±å³ç”¨,è°ƒä¼˜ç®€å•</li>
<li><strong>é‡‘èã€å®æ—¶ç³»ç»Ÿ</strong>: ZGCæ˜¯é¦–é€‰,ä½å»¶è¿Ÿä¼˜å…ˆçº§é«˜äºååé‡</li>
</ul>
<p><strong>è°ƒä¼˜åŸåˆ™</strong>:</p>
<ul>
<li>å»ºç«‹æ€§èƒ½åŸºçº¿,å°æ­¥å¿«è·‘,å‹æµ‹éªŒè¯,ç°åº¦å‘å¸ƒ</li>
<li>ä»£ç ä¼˜åŒ–ä¼˜äºå‚æ•°è°ƒä¼˜,é¿å…å†…å­˜æ³„æ¼å’Œå¤§å¯¹è±¡</li>
<li>æŒç»­ç›‘æ§GCæ—¥å¿—,å®šæœŸReviewæ€§èƒ½æ•°æ®</li>
<li>æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„æ”¶é›†å™¨,ä¸è¦ç›²ç›®è¿½æ±‚æ–°æŠ€æœ¯</li>
</ul>
<p>æŒæ¡G1å’ŒZGCçš„åŸç†ä¸è°ƒä¼˜,èƒ½å¤Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­æ¸¸åˆƒæœ‰ä½™åœ°è¿›è¡ŒGCè°ƒä¼˜,æå‡ç³»ç»Ÿæ€§èƒ½,é™ä½æ•…éšœé£é™©ã€‚</p>
<hr/>
<p><strong>å‚è€ƒèµ„æ–™</strong>:</p>
<ul>
<li>ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœº:JVMé«˜çº§ç‰¹æ€§ä¸æœ€ä½³å®è·µ(ç¬¬3ç‰ˆ)ã€‹- å‘¨å¿—æ˜</li>
<li>ã€ŠJavaæ€§èƒ½æƒå¨æŒ‡å—ã€‹- Scott Oaks</li>
<li>Oracleå®˜æ–¹JVMæ–‡æ¡£</li>
<li>OpenJDK ZGCå®˜æ–¹æ–‡æ¡£</li>
<li>GCEasy: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgceasy.io" target="_blank" title="https://gceasy.io" ref="nofollow noopener noreferrer">gceasy.io</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQLæ¶æ„åŸç†ä¸æ‰§è¡Œæµç¨‹]]></title>    <link>https://juejin.cn/post/7585474459776761892</link>    <guid>https://juejin.cn/post/7585474459776761892</guid>    <pubDate>2025-12-20T11:36:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459776761892" data-draft-id="7585468725332574262" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQLæ¶æ„åŸç†ä¸æ‰§è¡Œæµç¨‹"/> <meta itemprop="keywords" content="åç«¯,MySQL"/> <meta itemprop="datePublished" content="2025-12-20T11:36:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç„¡é‡"/> <meta itemprop="url" content="https://juejin.cn/user/1116759546145086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQLæ¶æ„åŸç†ä¸æ‰§è¡Œæµç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759546145086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç„¡é‡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T11:36:42.000Z" title="Sat Dec 20 2025 11:36:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»32åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>MySQLä½œä¸ºæœ€æµè¡Œçš„å¼€æºå…³ç³»å‹æ•°æ®åº“,åœ¨äº’è”ç½‘åº”ç”¨ä¸­æ‰®æ¼”ç€æ ¸å¿ƒè§’è‰²ã€‚ç†è§£MySQLçš„æ¶æ„åŸç†ä¸SQLæ‰§è¡Œæµç¨‹,æ˜¯æ¯ä½åç«¯å·¥ç¨‹å¸ˆçš„å¿…ä¿®è¯¾ã€‚æœ¬æ–‡ä»MySQLé€»è¾‘æ¶æ„ã€InnoDBå­˜å‚¨å¼•æ“ã€Buffer Poolç¼“å†²æ± ã€B+æ ‘ç´¢å¼•åŸç†ã€SQLæ‰§è¡Œæµç¨‹(SELECT/UPDATE)ã€EXPLAINæ‰§è¡Œè®¡åˆ’åˆ†æç­‰å¤šä¸ªç»´åº¦,æ·±å…¥å‰–æMySQLçš„å†…éƒ¨è¿è¡Œæœºåˆ¶,å¹¶ç»“åˆç”Ÿäº§ç¯å¢ƒå®æˆ˜æ¡ˆä¾‹,è®²è§£æ…¢æŸ¥è¯¢ä¼˜åŒ–ã€ç´¢å¼•ä¼˜åŒ–ç­‰æœ€ä½³å®è·µ,å¸®åŠ©è¯»è€…æ„å»ºå®Œæ•´çš„MySQLæ€§èƒ½ä¼˜åŒ–çŸ¥è¯†ä½“ç³»,åœ¨é¢è¯•å’Œå®é™…å·¥ä½œä¸­æ¸¸åˆƒæœ‰ä½™ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€ç†è®ºçŸ¥è¯†ä¸æ ¸å¿ƒæ¦‚å¿µ</h2>
<h3 data-id="heading-2">1.1 MySQLçš„å®šä½ä¸ç‰¹ç‚¹</h3>
<p>MySQLæ˜¯ä¸€æ¬¾å¼€æºçš„å…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ(RDBMS),ç”±ç‘å…¸MySQL ABå…¬å¸å¼€å‘,ç°å±äºOracleæ——ä¸‹äº§å“ã€‚MySQLå‡­å€Ÿå…¶é«˜æ€§èƒ½ã€é«˜å¯é æ€§ã€æ˜“ç”¨æ€§,æˆä¸ºäº’è”ç½‘åº”ç”¨çš„é¦–é€‰æ•°æ®åº“ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:</p>
<ul>
<li><strong>å¼€æºå…è´¹</strong>: ç¤¾åŒºç‰ˆ(GPLè®¸å¯)å…è´¹ä½¿ç”¨,é™ä½ä¼ä¸šæˆæœ¬</li>
<li><strong>è·¨å¹³å°</strong>: æ”¯æŒLinuxã€Windowsã€macOSç­‰å¤šç§æ“ä½œç³»ç»Ÿ</li>
<li><strong>é«˜æ€§èƒ½</strong>: æ”¯æŒåƒä¸‡çº§æ•°æ®è¡¨,QPSå¯è¾¾æ•°ä¸‡ç”šè‡³æ•°åä¸‡</li>
<li><strong>é«˜å¯ç”¨</strong>: æ”¯æŒä¸»ä»å¤åˆ¶ã€MGRé›†ç¾¤ç­‰é«˜å¯ç”¨æ–¹æ¡ˆ</li>
<li><strong>ä¸°å¯Œçš„å­˜å‚¨å¼•æ“</strong>: InnoDBã€MyISAMã€Memoryç­‰,æ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚</li>
<li><strong>ACIDäº‹åŠ¡æ”¯æŒ</strong>: InnoDBå¼•æ“æ”¯æŒå®Œæ•´çš„ACIDäº‹åŠ¡ç‰¹æ€§</li>
<li><strong>å¼ºå¤§çš„ç¤¾åŒºæ”¯æŒ</strong>: åºå¤§çš„å¼€å‘è€…ç¤¾åŒº,ä¸°å¯Œçš„æ–‡æ¡£å’Œå·¥å…·</li>
</ul>
<h3 data-id="heading-3">1.2 InnoDB vs MyISAM</h3>
<p>MySQLæ”¯æŒå¤šç§å­˜å‚¨å¼•æ“,å…¶ä¸­InnoDBå’ŒMyISAMæ˜¯æœ€å¸¸ç”¨çš„ä¸¤ç§:</p>
<p><strong>InnoDB (MySQL 5.5+é»˜è®¤å¼•æ“)</strong>:</p>
<ul>
<li>âœ… <strong>æ”¯æŒäº‹åŠ¡</strong>(ACIDç‰¹æ€§),é€‚åˆé‡‘èã€ç”µå•†ç­‰å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜çš„åœºæ™¯</li>
<li>âœ… <strong>è¡Œçº§é”</strong>,å¹¶å‘æ€§èƒ½å¥½,æ”¯æŒé«˜å¹¶å‘å†™æ“ä½œ</li>
<li>âœ… <strong>æ”¯æŒå¤–é”®çº¦æŸ</strong>,ä¿è¯æ•°æ®å®Œæ•´æ€§</li>
<li>âœ… <strong>å´©æºƒæ¢å¤èƒ½åŠ›å¼º</strong>,é€šè¿‡Redo Logä¿è¯æ•°æ®ä¸ä¸¢å¤±</li>
<li>âœ… <strong>MVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶</strong>,æå‡è¯»å†™å¹¶å‘æ€§èƒ½</li>
<li>âŒ <strong>å ç”¨ç©ºé—´å¤§</strong>,æ¯ä¸ªè¡¨å¯¹åº”.ibdæ–‡ä»¶,åŒ…å«æ•°æ®å’Œç´¢å¼•</li>
</ul>
<p><strong>MyISAM (è€ç‰ˆæœ¬é»˜è®¤å¼•æ“)</strong>:</p>
<ul>
<li>âŒ <strong>ä¸æ”¯æŒäº‹åŠ¡</strong>,æ— æ³•ä¿è¯æ•°æ®ä¸€è‡´æ€§</li>
<li>âŒ <strong>è¡¨çº§é”</strong>,å¹¶å‘å†™æ€§èƒ½å·®</li>
<li>âŒ <strong>ä¸æ”¯æŒå¤–é”®çº¦æŸ</strong></li>
<li>âœ… <strong>æ’å…¥é€Ÿåº¦å¿«</strong>,é€‚åˆæ—¥å¿—ã€å†å²æ•°æ®ç­‰åªè¯»æˆ–å°‘å†™åœºæ™¯</li>
<li>âœ… <strong>å ç”¨ç©ºé—´å°</strong>,æ¯ä¸ªè¡¨å¯¹åº”3ä¸ªæ–‡ä»¶(.frm/.MYD/.MYI)</li>
</ul>
<p><strong>ç»“è®º</strong>: ç”Ÿäº§ç¯å¢ƒå¼ºçƒˆæ¨èä½¿ç”¨InnoDBå¼•æ“,MyISAMå·²é€æ­¥è¢«æ·˜æ±°ã€‚</p>
<h3 data-id="heading-4">1.3 æ ¸å¿ƒæ¦‚å¿µ</h3>
<p><strong>Buffer Pool (ç¼“å†²æ± )</strong>:</p>
<ul>
<li>InnoDBçš„æ ¸å¿ƒå†…å­˜ç»“æ„,ç¼“å­˜æ•°æ®é¡µå’Œç´¢å¼•é¡µ,å‡å°‘ç£ç›˜I/O</li>
<li>é»˜è®¤å¤§å°128MB,ç”Ÿäº§ç¯å¢ƒå»ºè®®è®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„50-80%</li>
<li>é‡‡ç”¨æ”¹è¿›çš„LRUç®—æ³•ç®¡ç†ç¼“å­˜,åˆ†ä¸ºYoungåŒºå’ŒOldåŒº</li>
</ul>
<p><strong>B+æ ‘</strong>:</p>
<ul>
<li>MySQLç´¢å¼•çš„åº•å±‚æ•°æ®ç»“æ„,éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼,æ‰€æœ‰æ•°æ®åœ¨å¶å­èŠ‚ç‚¹</li>
<li>3å±‚B+æ ‘èƒ½å­˜å‚¨çº¦2000ä¸‡è¡Œæ•°æ®,æŸ¥è¯¢åªéœ€3æ¬¡ç£ç›˜I/O</li>
<li>å¶å­èŠ‚ç‚¹é€šè¿‡åŒå‘é“¾è¡¨è¿æ¥,èŒƒå›´æŸ¥è¯¢é«˜æ•ˆ</li>
</ul>
<p><strong>WAL (Write-Ahead Logging)</strong>:</p>
<ul>
<li>å…ˆå†™æ—¥å¿—,å†å†™æ•°æ®çš„æœºåˆ¶,æ ¸å¿ƒæ˜¯Redo Log</li>
<li>Redo Logé¡ºåºå†™(å¿«),æ•°æ®æ–‡ä»¶éšæœºå†™(æ…¢),å†™å…¥æ€§èƒ½æå‡10-100å€</li>
<li>å´©æºƒæ¢å¤æ—¶é€šè¿‡Redo Logé‡æ”¾,ä¿è¯æ•°æ®ä¸ä¸¢å¤±</li>
</ul>
<p><strong>2PC (Two-Phase Commit)</strong>:</p>
<ul>
<li>ä¸¤é˜¶æ®µæäº¤åè®®,ä¿è¯Redo Logå’ŒBinlogä¸€è‡´æ€§</li>
<li>æµç¨‹: Redo Log prepare â†’ å†™Binlog â†’ Redo Log commit</li>
<li>é¿å…ä¸»ä»æ•°æ®ä¸ä¸€è‡´</li>
</ul>
<hr/>
<h2 data-id="heading-5">äºŒã€MySQLé€»è¾‘æ¶æ„è¯¦è§£</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bd3db2455784f61929c84e1c5cba10a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=xa1KMdQ%2Fm9JVDrtbUB9WBmNUvG8%3D" alt="mysql-architecture.svg" loading="lazy"/></p>
<p>MySQLé‡‡ç”¨<strong>åˆ†å±‚æ¶æ„è®¾è®¡</strong>,ä»ä¸Šåˆ°ä¸‹åˆ†ä¸º3å±‚:è¿æ¥å±‚ã€SQLå±‚(Serverå±‚)ã€å­˜å‚¨å¼•æ“å±‚ã€‚è¿™ç§åˆ†å±‚è®¾è®¡å®ç°äº†Serverå±‚ä¸å­˜å‚¨å¼•æ“çš„è§£è€¦,æ”¯æŒæ’ä»¶å¼å­˜å‚¨å¼•æ“ã€‚</p>
<h3 data-id="heading-6">2.1 ç¬¬1å±‚: è¿æ¥å±‚ (Connector)</h3>
<p><strong>è¿æ¥å±‚è´Ÿè´£å®¢æˆ·ç«¯è¿æ¥ç®¡ç†,åŒ…æ‹¬è¿æ¥å»ºç«‹ã€èº«ä»½éªŒè¯ã€æƒé™è·å–ã€‚</strong></p>
<p><strong>è¿æ¥å»ºç«‹æµç¨‹</strong>:</p>
<ol>
<li><strong>TCPä¸‰æ¬¡æ¡æ‰‹</strong>: å®¢æˆ·ç«¯(å¦‚JDBCã€MySQLå‘½ä»¤è¡Œ)ä¸MySQL Serverå»ºç«‹TCPè¿æ¥</li>
<li><strong>èº«ä»½éªŒè¯</strong>: æœåŠ¡å™¨éªŒè¯ç”¨æˆ·åå’Œå¯†ç ,æŸ¥è¯¢<code>mysql.user</code>è¡¨</li>
<li><strong>æƒé™è·å–</strong>: éªŒè¯é€šè¿‡å,ä»æƒé™è¡¨ä¸­è¯»å–è¯¥ç”¨æˆ·çš„æƒé™ä¿¡æ¯,ç¼“å­˜åˆ°è¿æ¥å¯¹è±¡ä¸­</li>
<li><strong>åŠ å…¥è¿æ¥æ± </strong>: è¿æ¥åŠ å…¥è¿æ¥æ± ,å¯é€šè¿‡<code>SHOW PROCESSLIST</code>æŸ¥çœ‹å½“å‰æ‰€æœ‰è¿æ¥</li>
</ol>
<p><strong>è¿æ¥ç±»å‹</strong>:</p>
<ul>
<li><strong>çŸ­è¿æ¥</strong>: æ¯æ¬¡æŸ¥è¯¢åç«‹å³æ–­å¼€,é€‚åˆä½é¢‘è®¿é—®åœºæ™¯</li>
<li><strong>é•¿è¿æ¥</strong>: ä¿æŒè¿æ¥ä¸æ–­å¼€,é€‚åˆé«˜é¢‘è®¿é—®åœºæ™¯(å¦‚Webåº”ç”¨)</li>
</ul>
<p><strong>é•¿è¿æ¥çš„é—®é¢˜</strong>: é•¿æ—¶é—´ä½¿ç”¨å,MySQL Serverå†…å­˜å ç”¨ä¼šæŒç»­å¢é•¿,å› ä¸ºè¿æ¥è¿‡ç¨‹ä¸­çš„ä¸´æ—¶å†…å­˜ä¸ä¼šé‡Šæ”¾ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ol>
<li><strong>å®šæœŸæ–­å¼€é•¿è¿æ¥</strong>: è¿æ¥ä½¿ç”¨è¶…è¿‡ä¸€å®šæ—¶é—´(å¦‚8å°æ—¶)æˆ–æ‰§è¡Œè¿‡å¤§æŸ¥è¯¢å,ä¸»åŠ¨æ–­å¼€é‡è¿</li>
<li><strong>æ‰§è¡Œ<code>mysql_reset_connection</code></strong>: MySQL 5.7+æ”¯æŒ,é‡ç½®è¿æ¥çŠ¶æ€,é‡Šæ”¾ä¸´æ—¶å†…å­˜,æ— éœ€é‡æ–°å»ºç«‹è¿æ¥</li>
</ol>
<p><strong>å…³é”®å‚æ•°</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">max_connections=1000         <span class="hljs-comment"># æœ€å¤§è¿æ¥æ•°,é»˜è®¤151</span>
wait_timeout=28800           <span class="hljs-comment"># éäº¤äº’è¿æ¥è¶…æ—¶æ—¶é—´(ç§’),é»˜è®¤8å°æ—¶</span>
interactive_timeout=28800    <span class="hljs-comment"># äº¤äº’å¼è¿æ¥è¶…æ—¶æ—¶é—´(ç§’)</span>
</code></pre>
<h3 data-id="heading-7">2.2 ç¬¬2å±‚: SQLå±‚ (Serverå±‚) - æŸ¥è¯¢ç¼“å­˜</h3>
<p><strong>æŸ¥è¯¢ç¼“å­˜æ˜¯MySQL Serverå±‚çš„ç¬¬ä¸€é“å…³å¡,åœ¨MySQL 8.0å·²è¢«ç§»é™¤ã€‚</strong></p>
<p><strong>å·¥ä½œåŸç†</strong>:</p>
<ul>
<li>ä½¿ç”¨SQLè¯­å¥ä½œä¸ºkey,æŸ¥è¯¢ç»“æœä½œä¸ºvalue,å­˜å‚¨åˆ°ç¼“å­˜ä¸­</li>
<li>åç»­å®Œå…¨ç›¸åŒçš„SQLç›´æ¥è¿”å›ç¼“å­˜ç»“æœ,è·³è¿‡åç»­çš„åˆ†æã€ä¼˜åŒ–ã€æ‰§è¡Œæ­¥éª¤</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆè¢«ç§»é™¤?</strong></p>
<ol>
<li><strong>å‘½ä¸­ç‡æä½</strong>: SQLå¿…é¡»å®Œå…¨ç›¸åŒ(åŒ…æ‹¬ç©ºæ ¼ã€å¤§å°å†™),ç¨æœ‰å·®å¼‚å°±æ— æ³•å‘½ä¸­</li>
<li><strong>å¤±æ•ˆé¢‘ç¹</strong>: åªè¦è¡¨æœ‰ä»»ä½•æ›´æ–°(INSERT/UPDATE/DELETE),è¯¥è¡¨çš„æ‰€æœ‰æŸ¥è¯¢ç¼“å­˜å…¨éƒ¨å¤±æ•ˆ</li>
<li><strong>ç»´æŠ¤æˆæœ¬é«˜</strong>: ç¼“å­˜çš„åŠ é”ã€å¤±æ•ˆã€æ·˜æ±°æœºåˆ¶å¸¦æ¥é¢å¤–å¼€é”€</li>
<li><strong>é€‚ç”¨åœºæ™¯å°‘</strong>: åªé€‚åˆé™æ€è¡¨(å¦‚é…ç½®è¡¨ã€å­—å…¸è¡¨),å®é™…ç”Ÿäº§ä¸­æå°‘</li>
</ol>
<p><strong>æ›¿ä»£æ–¹æ¡ˆ</strong>: ä½¿ç”¨Redisã€Memcachedç­‰å¤–éƒ¨ç¼“å­˜ä¸­é—´ä»¶,æ›´çµæ´»ã€å‘½ä¸­ç‡æ›´é«˜ã€‚</p>
<h3 data-id="heading-8">2.3 ç¬¬3å±‚: SQLå±‚ (Serverå±‚) - åˆ†æå™¨</h3>
<p><strong>åˆ†æå™¨è´Ÿè´£å¯¹SQLè¯­å¥è¿›è¡Œè¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æ,ç”Ÿæˆè¯­æ³•æ ‘(AST)ã€‚</strong></p>
<p><strong>è¯æ³•åˆ†æ (Lexical Analysis)</strong>:</p>
<p>å°†SQLå­—ç¬¦ä¸²æ‹†è§£ä¸ºä¸€ä¸ªä¸ªtoken(è¯æ³•å•å…ƒ):</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p>æ‹†è§£ç»“æœ:</p>
<ul>
<li>å…³é”®å­—: SELECT, FROM, WHERE, ORDER BY, LIMIT</li>
<li>æ ‡è¯†ç¬¦: id, name, age, users</li>
<li>å¸¸é‡: 25, 10</li>
<li>è¿ç®—ç¬¦: &gt;, =</li>
</ul>
<p><strong>è¯­æ³•åˆ†æ (Syntax Analysis)</strong>:</p>
<p>æ ¹æ®MySQLçš„è¯­æ³•è§„åˆ™,å°†tokenåºåˆ—ç»„ç»‡æˆè¯­æ³•æ ‘(Parse Tree / AST):</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">SELECT</span>
â”œâ”€â”€ <span class="hljs-keyword">SELECT</span> LIST: id, name, age
â”œâ”€â”€ <span class="hljs-keyword">FROM</span>: users
â”œâ”€â”€ <span class="hljs-keyword">WHERE</span>: age &gt; <span class="hljs-number">25</span>
â”œâ”€â”€ <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span>: id
â””â”€â”€ LIMIT: <span class="hljs-number">10</span>
</code></pre>
<p><strong>è¯­æ³•é”™è¯¯æ£€æŸ¥</strong>:</p>
<p>å¦‚æœSQLä¸ç¬¦åˆè¯­æ³•è§„åˆ™,åˆ†æå™¨æŠ¥é”™:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> FORM users;  <span class="hljs-comment">-- é”™è¯¯: å…³é”®å­—æ‹¼å†™é”™è¯¯(FROMå†™æˆFORM)</span>
</code></pre>
<p>æŠ¥é”™ä¿¡æ¯: <code>You have an error in your SQL syntax; check the manual...</code></p>
<p><strong>è¾“å‡º</strong>: è¯­æ³•æ ‘(AST),ä¾›ä¼˜åŒ–å™¨ä½¿ç”¨ã€‚</p>
<h3 data-id="heading-9">2.4 ç¬¬4å±‚: SQLå±‚ (Serverå±‚) - ä¼˜åŒ–å™¨</h3>
<p><strong>ä¼˜åŒ–å™¨è´Ÿè´£ç”Ÿæˆæœ€ä¼˜çš„æ‰§è¡Œè®¡åˆ’,å†³å®šå¦‚ä½•é«˜æ•ˆåœ°æ‰§è¡ŒSQLã€‚</strong></p>
<p><strong>æ ¸å¿ƒä»»åŠ¡</strong>:</p>
<p><strong>1. ç´¢å¼•é€‰æ‹©</strong>:</p>
<p>æŸ¥è¯¢<code>users</code>è¡¨æœ‰å“ªäº›ç´¢å¼•å¯ç”¨:</p>
<ul>
<li>ä¸»é”®ç´¢å¼•: <code>PRIMARY KEY (id)</code></li>
<li>äºŒçº§ç´¢å¼•: <code>idx_age (age)</code>, <code>idx_name (name)</code>, <code>idx_age_name (age, name)</code></li>
</ul>
<p><strong>æˆæœ¬è®¡ç®— (CBO - Cost-Based Optimizer)</strong>:</p>
<p>MySQLä½¿ç”¨åŸºäºæˆæœ¬çš„ä¼˜åŒ–å™¨,è®¡ç®—æ¯ç§æ‰§è¡Œæ–¹å¼çš„æˆæœ¬,é€‰æ‹©æˆæœ¬æœ€ä½çš„:</p>
<ul>
<li><strong>å…¨è¡¨æ‰«ææˆæœ¬</strong>: è¯»å–æ‰€æœ‰æ•°æ®é¡µçš„I/Oæˆæœ¬ + CPUè®¡ç®—æˆæœ¬</li>
<li><strong>ç´¢å¼•æ‰«ææˆæœ¬</strong>: è¯»å–ç´¢å¼•é¡µçš„I/Oæˆæœ¬ + å›è¡¨I/Oæˆæœ¬ + CPUæˆæœ¬</li>
</ul>
<p>æˆæœ¬å…¬å¼(ç®€åŒ–ç‰ˆ):</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Cost</span> = I/O_cost + CPU_cost
I/<span class="hljs-attr">O_cost</span> = pages_read Ã— io_cost_per_page
<span class="hljs-attr">CPU_cost</span> = rows_examined Ã— cpu_cost_per_row
</code></pre>
<p><strong>ç´¢å¼•é€‰æ‹©ç­–ç•¥</strong>:</p>
<ul>
<li>æ¡ä»¶å­—æ®µæœ‰ç´¢å¼•: ä¼˜å…ˆä½¿ç”¨ç´¢å¼•</li>
<li>å¤šä¸ªç´¢å¼•å¯é€‰: é€‰æ‹©é€‰æ‹©æ€§æœ€é«˜çš„ç´¢å¼•(æ‰«æè¡Œæ•°æœ€å°‘)</li>
<li>ç´¢å¼•æ‰«ææˆæœ¬ &gt; å…¨è¡¨æ‰«ææˆæœ¬: ä½¿ç”¨å…¨è¡¨æ‰«æ(å¦‚æŸ¥è¯¢ç»“æœå è¡¨æ€»è¡Œæ•°çš„30%ä»¥ä¸Š)</li>
</ul>
<p><strong>2. JOINé¡ºåºä¼˜åŒ–</strong>:</p>
<p>å¤šè¡¨JOINæ—¶,JOINé¡ºåºå½±å“æ€§èƒ½:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders o
<span class="hljs-keyword">JOIN</span> users u <span class="hljs-keyword">ON</span> o.user_id <span class="hljs-operator">=</span> u.id
<span class="hljs-keyword">JOIN</span> products p <span class="hljs-keyword">ON</span> o.product_id <span class="hljs-operator">=</span> p.id
<span class="hljs-keyword">WHERE</span> u.age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>;
</code></pre>
<p>å¯èƒ½çš„JOINé¡ºåº:</p>
<ul>
<li><code>orders â†’ users â†’ products</code></li>
<li><code>users â†’ orders â†’ products</code> (ä¼˜åŒ–å™¨å¯èƒ½é€‰æ‹©è¿™ä¸ª,å› ä¸ºå…ˆè¿‡æ»¤users.age &gt; 25,å‡å°‘JOINè¡Œæ•°)</li>
</ul>
<p><strong>3. å­æŸ¥è¯¢æ”¹å†™</strong>:</p>
<p>ä¼˜åŒ–å™¨å¯èƒ½å°†å­æŸ¥è¯¢æ”¹å†™ä¸ºJOIN:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åŸå§‹SQL (å­æŸ¥è¯¢)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> user_id <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>);

<span class="hljs-comment">-- ä¼˜åŒ–å™¨æ”¹å†™ä¸ºJOIN (å¯èƒ½æ›´é«˜æ•ˆ)</span>
<span class="hljs-keyword">SELECT</span> u.<span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users u
<span class="hljs-keyword">JOIN</span> orders o <span class="hljs-keyword">ON</span> u.id <span class="hljs-operator">=</span> o.user_id
<span class="hljs-keyword">WHERE</span> o.status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>è¾“å‡º</strong>: æ‰§è¡Œè®¡åˆ’(Execution Plan),å¯é€šè¿‡<code>EXPLAIN</code>æŸ¥çœ‹ã€‚</p>
<h3 data-id="heading-10">2.5 ç¬¬5å±‚: SQLå±‚ (Serverå±‚) - æ‰§è¡Œå™¨</h3>
<p><strong>æ‰§è¡Œå™¨è´Ÿè´£æ‰§è¡ŒSQL,è°ƒç”¨å­˜å‚¨å¼•æ“æ¥å£é€è¡Œè¯»å–æ•°æ®ã€‚</strong></p>
<p><strong>æ‰§è¡Œæµç¨‹</strong>:</p>
<p><strong>1. æƒé™æ£€æŸ¥</strong>:</p>
<p>æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰è¯¥è¡¨çš„SELECTæƒé™(æƒé™åœ¨è¿æ¥é˜¶æ®µå·²è·å–):</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id, name <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>;
</code></pre>
<p>å¦‚æœæ— æƒé™,æŠ¥é”™: <code>Access denied for user 'xxx'@'xxx' to table 'users'</code></p>
<p><strong>2. è°ƒç”¨å­˜å‚¨å¼•æ“æ¥å£</strong>:</p>
<p>æ‰§è¡Œå™¨è°ƒç”¨InnoDBå¼•æ“çš„readæ¥å£,ä¼ å…¥æ¡ä»¶<code>age &gt; 25</code>:</p>
<pre><code class="hljs language-ini" lang="ini">executor.read(<span class="hljs-attr">table</span>=<span class="hljs-string">"users"</span>, condition=<span class="hljs-string">"age &gt; 25"</span>)
</code></pre>
<p><strong>3. é€è¡Œè¯»å–æ•°æ®</strong>:</p>
<ul>
<li>InnoDBæ ¹æ®æ‰§è¡Œè®¡åˆ’(ä½¿ç”¨idx_ageç´¢å¼•)å®šä½æ•°æ®</li>
<li>é€šè¿‡B+æ ‘æŸ¥æ‰¾age &gt; 25çš„ç¬¬ä¸€è¡Œ</li>
<li>è¿”å›ç»™æ‰§è¡Œå™¨</li>
<li>æ‰§è¡Œå™¨ç»§ç»­è°ƒç”¨readæ¥å£,è¯»å–ä¸‹ä¸€è¡Œ</li>
<li>é‡å¤ç›´åˆ°è¯»å®Œæ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è¡Œ</li>
</ul>
<p><strong>4. è¿‡æ»¤ã€æ’åºã€é™åˆ¶</strong>:</p>
<ul>
<li>è¿‡æ»¤: WHEREæ¡ä»¶è¿‡æ»¤ä¸ç¬¦åˆæ¡ä»¶çš„è¡Œ</li>
<li>æ’åº: ORDER BY id (å¯èƒ½ä½¿ç”¨idx_idç´¢å¼•é¿å…æ’åº,æˆ–ä½¿ç”¨filesort)</li>
<li>é™åˆ¶: LIMIT 10,åªè¿”å›å‰10è¡Œ</li>
</ul>
<p><strong>5. è¿”å›ç»“æœé›†</strong>:</p>
<p>æ‰§è¡Œå™¨å°†ç»“æœé›†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p><strong>6. è®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—</strong>:</p>
<p>å¦‚æœæŸ¥è¯¢æ—¶é—´ &gt; <code>long_query_time</code>(é»˜è®¤10ç§’),è®°å½•åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—:</p>
<pre><code class="hljs language-bash" lang="bash">slow_query_log=ON                          <span class="hljs-comment"># å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</span>
long_query_time=1                          <span class="hljs-comment"># æ…¢æŸ¥è¯¢é˜ˆå€¼1ç§’</span>
slow_query_log_file=/var/log/mysql-slow.log
</code></pre>
<h3 data-id="heading-11">2.6 Serverå±‚æ€»ç»“</h3>
<p><strong>Serverå±‚æ˜¯MySQLçš„å¤§è„‘</strong>,è´Ÿè´£è¿æ¥ç®¡ç†ã€SQLè§£æã€ä¼˜åŒ–ã€æ‰§è¡Œ,ä¸å­˜å‚¨å¼•æ“æ— å…³ã€‚åŒä¸€æ¡SQL,æ— è®ºä½¿ç”¨InnoDBè¿˜æ˜¯MyISAM,Serverå±‚çš„å¤„ç†æµç¨‹å®Œå…¨ç›¸åŒ,åªæ˜¯æœ€åè°ƒç”¨çš„å­˜å‚¨å¼•æ“æ¥å£ä¸åŒã€‚</p>
<p><strong>Serverå±‚ä¸å­˜å‚¨å¼•æ“çš„åˆ†å±‚è®¾è®¡ä¼˜åŠ¿</strong>:</p>
<ul>
<li><strong>è§£è€¦</strong>: Serverå±‚ä¸“æ³¨SQLå¤„ç†,å­˜å‚¨å¼•æ“ä¸“æ³¨æ•°æ®å­˜å‚¨å’Œè¯»å†™</li>
<li><strong>æ’ä»¶å¼æ¶æ„</strong>: å¯è‡ªç”±åˆ‡æ¢å­˜å‚¨å¼•æ“(InnoDB/MyISAM/Memory),æ— éœ€ä¿®æ”¹SQL</li>
<li><strong>çµæ´»æ€§</strong>: ä¸åŒè¡¨å¯ä½¿ç”¨ä¸åŒå­˜å‚¨å¼•æ“,æ»¡è¶³ä¸åŒä¸šåŠ¡éœ€æ±‚</li>
</ul>
<hr/>
<h2 data-id="heading-12">ä¸‰ã€InnoDBå­˜å‚¨å¼•æ“æ¶æ„</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c86e176846d846baa86acc68214e4753~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=4faIJMs8oQZ%2FHUCgKys0oSrPqp4%3D" alt="innodb-architecture.svg" loading="lazy"/>
InnoDBæ˜¯MySQLçš„é»˜è®¤å­˜å‚¨å¼•æ“(MySQL 5.5+),ä¸“ä¸ºäº‹åŠ¡å¤„ç†è®¾è®¡,æ¶æ„åˆ†ä¸º<strong>å†…å­˜ç»“æ„</strong>å’Œ<strong>ç£ç›˜ç»“æ„</strong>ä¸¤å¤§éƒ¨åˆ†ã€‚</p>
<h3 data-id="heading-13">3.1 InnoDBæ•´ä½“æ¶æ„</h3>
<p><strong>InnoDBçš„æ ¸å¿ƒè®¾è®¡æ€æƒ³</strong>: <strong>å†…å­˜ä¼˜å…ˆ + WALæœºåˆ¶ + å´©æºƒæ¢å¤</strong></p>
<ul>
<li><strong>å†…å­˜ä¼˜å…ˆ</strong>: æ•°æ®ä¼˜å…ˆç¼“å­˜åˆ°Buffer Pool,å‡å°‘ç£ç›˜I/O</li>
<li><strong>WAL (Write-Ahead Logging)</strong>: å…ˆå†™æ—¥å¿—(Redo Log),å†å¼‚æ­¥åˆ·è„é¡µ,æå‡å†™å…¥æ€§èƒ½</li>
<li><strong>å´©æºƒæ¢å¤</strong>: é€šè¿‡Redo Logé‡æ”¾,ä¿è¯äº‹åŠ¡æŒä¹…æ€§(Durability)</li>
</ul>
<h3 data-id="heading-14">3.2 å†…å­˜ç»“æ„ (In-Memory Structure)</h3>
<p><strong>1. Buffer Pool (ç¼“å†²æ± )</strong>:</p>
<p><strong>Buffer Poolæ˜¯InnoDBæ€§èƒ½çš„æ ¸å¿ƒ</strong>,ç¼“å­˜æ•°æ®é¡µå’Œç´¢å¼•é¡µ,å‡å°‘ç£ç›˜I/Oã€‚</p>
<p><strong>ç¼“å­˜å†…å®¹</strong>:</p>
<ul>
<li>æ•°æ®é¡µ (Data Page): è¡¨çš„è¡Œæ•°æ®</li>
<li>ç´¢å¼•é¡µ (Index Page): B+æ ‘ç´¢å¼•èŠ‚ç‚¹</li>
<li>æ’å…¥ç¼“å†² (Insert Buffer): äºŒçº§ç´¢å¼•çš„æ’å…¥ç¼“å†²</li>
<li>è‡ªé€‚åº”å“ˆå¸Œç´¢å¼• (Adaptive Hash Index): InnoDBè‡ªåŠ¨åˆ›å»ºçš„å“ˆå¸Œç´¢å¼•</li>
<li>é”ä¿¡æ¯ (Lock Info): è¡Œé”ã€è¡¨é”ä¿¡æ¯</li>
</ul>
<p><strong>LRUé“¾è¡¨ç®¡ç†</strong>:</p>
<p>Buffer Poolé‡‡ç”¨æ”¹è¿›çš„LRU(Least Recently Used)ç®—æ³•ç®¡ç†ç¼“å­˜é¡µ,åˆ†ä¸ºä¸¤ä¸ªåŒºåŸŸ:</p>
<ul>
<li><strong>YoungåŒº</strong> (æ–°æ•°æ®åŒº): å Buffer Poolçš„5/8 (62.5%),å­˜æ”¾çƒ­æ•°æ®</li>
<li><strong>OldåŒº</strong> (è€æ•°æ®åŒº): å Buffer Poolçš„3/8 (37.5%),å­˜æ”¾å†·æ•°æ®</li>
</ul>
<p><strong>Midpointæ’å…¥ç­–ç•¥</strong>:</p>
<p>ä¼ ç»ŸLRUç®—æ³•çš„é—®é¢˜: å…¨è¡¨æ‰«æä¼šå°†å¤§é‡å†·æ•°æ®åŠ è½½åˆ°ç¼“å­˜,æŒ¤æ‰çƒ­æ•°æ®(ç¼“å­˜æ±¡æŸ“)ã€‚</p>
<p><strong>InnoDBçš„æ”¹è¿›</strong>:</p>
<ul>
<li>æ–°æ•°æ®é¡µä¸æ’å…¥é“¾è¡¨å¤´,è€Œæ˜¯æ’å…¥OldåŒºå¤´éƒ¨(Midpointä½ç½®)</li>
<li>åªæœ‰åœ¨OldåŒºåœç•™â‰¥1ç§’(<code>innodb_old_blocks_time=1000</code>)åå†æ¬¡è®¿é—®,æ‰ç§»åŠ¨åˆ°YoungåŒº</li>
<li>å…¨è¡¨æ‰«æçš„æ•°æ®é¡µåªåœç•™åœ¨OldåŒº,ä¸å½±å“YoungåŒºçš„çƒ­æ•°æ®</li>
</ul>
<p><strong>Buffer Poolå‚æ•°é…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">innodb_buffer_pool_size=8G          <span class="hljs-comment"># Buffer Poolå¤§å°,å»ºè®®ç‰©ç†å†…å­˜çš„50-80%</span>
innodb_buffer_pool_instances=8      <span class="hljs-comment"># Buffer Poolå®ä¾‹æ•°,å‡å°‘é”ç«äº‰</span>
innodb_old_blocks_pct=37            <span class="hljs-comment"># OldåŒºå æ¯”37% (é»˜è®¤)</span>
innodb_old_blocks_time=1000         <span class="hljs-comment"># OldåŒºåœç•™æ—¶é—´1ç§’ (é»˜è®¤)</span>
</code></pre>
<p><strong>2. Change Buffer (å†™ç¼“å†²)</strong>:</p>
<p><strong>Change Bufferç”¨äºç¼“å­˜äºŒçº§ç´¢å¼•(éå”¯ä¸€ç´¢å¼•)çš„å˜æ›´æ“ä½œ,å‡å°‘éšæœºI/Oã€‚</strong></p>
<p><strong>å·¥ä½œåŸç†</strong>:</p>
<p>å½“æ›´æ–°éå”¯ä¸€ç´¢å¼•æ—¶:</p>
<ol>
<li>å¦‚æœç´¢å¼•é¡µåœ¨Buffer Pool: ç›´æ¥æ›´æ–°</li>
<li>å¦‚æœç´¢å¼•é¡µä¸åœ¨Buffer Pool: å°†å˜æ›´è®°å½•åˆ°Change Buffer (è€Œä¸æ˜¯ç«‹å³ä»ç£ç›˜åŠ è½½ç´¢å¼•é¡µ)</li>
<li>åç»­è¯»å–è¯¥ç´¢å¼•é¡µæ—¶,åˆå¹¶Change Bufferä¸­çš„å˜æ›´(Mergeæ“ä½œ)</li>
</ol>
<p><strong>é€‚ç”¨åœºæ™¯</strong>: éå”¯ä¸€ç´¢å¼•,å†™å¤šè¯»å°‘çš„åœºæ™¯(å¦‚æ—¥å¿—è¡¨ã€å†å²è®°å½•è¡¨)</p>
<p><strong>ä¸ºä»€ä¹ˆå”¯ä¸€ç´¢å¼•ä¸èƒ½ç”¨Change Buffer?</strong></p>
<p>å”¯ä¸€ç´¢å¼•éœ€è¦æ£€æŸ¥å”¯ä¸€æ€§çº¦æŸ,å¿…é¡»è¯»å–ç´¢å¼•é¡µ,æ— æ³•å»¶è¿Ÿæ›´æ–°ã€‚</p>
<p><strong>3. Adaptive Hash Index (è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•)</strong>:</p>
<p>InnoDBè‡ªåŠ¨åˆ›å»ºçš„å“ˆå¸Œç´¢å¼•,åŠ é€Ÿç­‰å€¼æŸ¥è¯¢ã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>:</p>
<ul>
<li>InnoDBç›‘æ§B+æ ‘ç´¢å¼•çš„è®¿é—®æ¨¡å¼</li>
<li>å¯¹äºé¢‘ç¹è®¿é—®çš„ç´¢å¼•é¡µ,è‡ªåŠ¨åˆ›å»ºå“ˆå¸Œç´¢å¼•</li>
<li>å“ˆå¸ŒæŸ¥è¯¢O(1)æ—¶é—´å¤æ‚åº¦,æ¯”B+æ ‘O(log n)æ›´å¿«</li>
</ul>
<p><strong>é™åˆ¶</strong>: åªæ”¯æŒç­‰å€¼æŸ¥è¯¢(=),ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢(&lt;, &gt;),ç”±InnoDBè‡ªåŠ¨ç®¡ç†,æ— æ³•æ‰‹åŠ¨é…ç½®ã€‚</p>
<p><strong>4. Log Buffer (æ—¥å¿—ç¼“å†²)</strong>:</p>
<p><strong>Log Bufferç¼“å­˜Redo Log,æé«˜æ—¥å¿—å†™å…¥æ€§èƒ½ã€‚</strong></p>
<p><strong>å·¥ä½œæµç¨‹</strong>:</p>
<ol>
<li>äº‹åŠ¡ä¿®æ”¹æ•°æ®æ—¶,å…ˆå†™Redo Log Buffer (å†…å­˜)</li>
<li>äº‹åŠ¡æäº¤æ—¶,å°†Redo Log Bufferåˆ·ç›˜åˆ°ib_logfile0/1 (ç£ç›˜)</li>
<li>åˆ·ç›˜ç­–ç•¥ç”±<code>innodb_flush_log_at_trx_commit</code>æ§åˆ¶</li>
</ol>
<p><strong>å‚æ•°é…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">innodb_log_buffer_size=16M          <span class="hljs-comment"># Log Bufferå¤§å°,é»˜è®¤16MB</span>
innodb_flush_log_at_trx_commit=1   <span class="hljs-comment"># åˆ·ç›˜ç­–ç•¥:</span>
                                    <span class="hljs-comment"># 0: æ¯ç§’åˆ·ç›˜ä¸€æ¬¡ (æ€§èƒ½æœ€å¥½,ä½†å¯èƒ½ä¸¢å¤±1ç§’æ•°æ®)</span>
                                    <span class="hljs-comment"># 1: æ¯æ¬¡äº‹åŠ¡æäº¤åˆ·ç›˜ (æœ€å®‰å…¨,æ¨è)</span>
                                    <span class="hljs-comment"># 2: æ¯æ¬¡æäº¤å†™OSç¼“å­˜,æ¯ç§’åˆ·ç›˜ (æŠ˜ä¸­)</span>
</code></pre>
<h3 data-id="heading-15">3.3 ç£ç›˜ç»“æ„ (On-Disk Structure)</h3>
<p><strong>1. è¡¨ç©ºé—´ (Tablespace)</strong>:</p>
<p><strong>ç³»ç»Ÿè¡¨ç©ºé—´ (System Tablespace)</strong>:</p>
<ul>
<li>æ–‡ä»¶: ibdata1</li>
<li>å­˜å‚¨: æ•°æ®å­—å…¸ã€Undo Logã€Change Bufferã€Doublewrite Buffer</li>
<li>ç‰¹ç‚¹: æ‰€æœ‰è¡¨å…±äº«,ä¸æ¨èå­˜å‚¨ç”¨æˆ·æ•°æ®</li>
</ul>
<p><strong>ç‹¬ç«‹è¡¨ç©ºé—´ (File-Per-Table Tablespace)</strong>:</p>
<ul>
<li>æ–‡ä»¶: æ¯ä¸ªè¡¨ä¸€ä¸ª.ibdæ–‡ä»¶ (å¦‚users.ibd)</li>
<li>å­˜å‚¨: è¡¨çš„æ•°æ®å’Œç´¢å¼•</li>
<li>å‚æ•°: <code>innodb_file_per_table=ON</code> (MySQL 5.6+é»˜è®¤å¼€å¯)</li>
<li>ä¼˜åŠ¿: è¡¨çº§åˆ«ç®¡ç†,DROP TABLEç›´æ¥åˆ é™¤.ibdæ–‡ä»¶,å›æ”¶ç©ºé—´</li>
</ul>
<p><strong>2. æ•°æ®æ–‡ä»¶ç»“æ„</strong>:</p>
<p><strong>è¡¨ç©ºé—´ â†’ æ®µ(Segment) â†’ åŒº(Extent) â†’ é¡µ(Page) â†’ è¡Œ(Row)</strong></p>
<ul>
<li><strong>é¡µ(Page)</strong>: InnoDBæœ€å°I/Oå•ä½,é»˜è®¤16KB (<code>innodb_page_size=16384</code>)</li>
<li><strong>åŒº(Extent)</strong>: è¿ç»­64ä¸ªé¡µ,å¤§å°1MB (64 Ã— 16KB)</li>
<li><strong>æ®µ(Segment)</strong>: æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µ</li>
</ul>
<p><strong>3. Redo Log (é‡åšæ—¥å¿—)</strong>:</p>
<p><strong>Redo Logæ˜¯InnoDBå´©æºƒæ¢å¤çš„æ ¸å¿ƒ,è®°å½•æ•°æ®é¡µçš„ç‰©ç†ä¿®æ”¹ã€‚</strong></p>
<p><strong>æ–‡ä»¶</strong>:</p>
<ul>
<li>ib_logfile0, ib_logfile1 (é»˜è®¤2ä¸ªæ–‡ä»¶)</li>
<li>å¾ªç¯å†™å…¥(Circular Write),å†™æ»¡ib_logfile1åå›åˆ°ib_logfile0</li>
</ul>
<p><strong>ä½œç”¨</strong>:</p>
<ul>
<li><strong>å´©æºƒæ¢å¤</strong>: é‡å¯å,é€šè¿‡Redo Logé‡æ”¾(redo),æ¢å¤æœªåˆ·ç›˜çš„è„é¡µæ•°æ®</li>
<li><strong>äº‹åŠ¡æŒä¹…æ€§(Durability)</strong>: äº‹åŠ¡æäº¤å,å³ä½¿ç«‹å³å´©æºƒ,Redo Logä¿è¯æ•°æ®ä¸ä¸¢å¤±</li>
</ul>
<p><strong>Redo Log vs Binlog</strong>:</p>



































<table><thead><tr><th>ç»´åº¦</th><th>Redo Log</th><th>Binlog</th></tr></thead><tbody><tr><td><strong>å±‚æ¬¡</strong></td><td>InnoDBå¼•æ“å±‚</td><td>MySQL Serverå±‚</td></tr><tr><td><strong>ä½œç”¨</strong></td><td>å´©æºƒæ¢å¤</td><td>ä¸»ä»å¤åˆ¶ã€æ•°æ®å¤‡ä»½</td></tr><tr><td><strong>å†…å®¹</strong></td><td>ç‰©ç†æ—¥å¿—(æ•°æ®é¡µçš„ä¿®æ”¹)</td><td>é€»è¾‘æ—¥å¿—(SQLè¯­å¥æˆ–è¡Œå˜æ›´)</td></tr><tr><td><strong>å†™å…¥æ–¹å¼</strong></td><td>å¾ªç¯å†™(å›ºå®šå¤§å°,è¦†ç›–æ—§æ•°æ®)</td><td>è¿½åŠ å†™(ä¸€ç›´å†™æ–°æ–‡ä»¶)</td></tr><tr><td><strong>äº‹åŠ¡æäº¤</strong></td><td>2PCä¸¤é˜¶æ®µæäº¤</td><td>2PCä¸¤é˜¶æ®µæäº¤</td></tr></tbody></table>
<p><strong>4. Undo Log (å›æ»šæ—¥å¿—)</strong>:</p>
<p><strong>Undo Logç”¨äºäº‹åŠ¡å›æ»šå’ŒMVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚</strong></p>
<p><strong>ä½œç”¨</strong>:</p>
<ol>
<li><strong>äº‹åŠ¡å›æ»š</strong>: è®°å½•ä¿®æ”¹å‰çš„æ—§å€¼,äº‹åŠ¡å¤±è´¥æ—¶é€šè¿‡Undo Logå›æ»š</li>
<li><strong>MVCC</strong>: å…¶ä»–äº‹åŠ¡è¯»å–æ—§ç‰ˆæœ¬æ•°æ®,å®ç°å¿«ç…§è¯»</li>
</ol>
<p><strong>å­˜å‚¨ä½ç½®</strong>: ç³»ç»Ÿè¡¨ç©ºé—´(ibdata1)æˆ–Undoè¡¨ç©ºé—´(undo_001, undo_002)</p>
<h3 data-id="heading-16">3.4 B+æ ‘ç´¢å¼•åŸç†</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cdff00281b9f4e38b1a5175ab8027754~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=CjnbB9eDm5P%2B0f1Rv280ihdLJFI%3D" alt="btree-structure.svg" loading="lazy"/></p>
<p><strong>ä¸ºä»€ä¹ˆMySQLé€‰æ‹©B+æ ‘ä½œä¸ºç´¢å¼•æ•°æ®ç»“æ„?</strong></p>
<p><strong>å¯¹æ¯”å…¶ä»–æ•°æ®ç»“æ„</strong>:</p>
<p><strong>å“ˆå¸Œè¡¨</strong>:</p>
<ul>
<li>âŒ ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢: <code>age &gt; 25</code>æ— æ³•ä½¿ç”¨å“ˆå¸Œç´¢å¼•</li>
<li>âŒ ä¸æ”¯æŒæ’åº: <code>ORDER BY age</code>æ— æ³•ä½¿ç”¨å“ˆå¸Œç´¢å¼•</li>
<li>âŒ ä¸æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢: <code>name LIKE 'abc%'</code>æ— æ³•ä½¿ç”¨å“ˆå¸Œç´¢å¼•</li>
</ul>
<p><strong>äºŒå‰æœç´¢æ ‘(BST)</strong>:</p>
<ul>
<li>âŒ å¯èƒ½é€€åŒ–æˆé“¾è¡¨: æ’å…¥é¡ºåºæ•°æ®(å¦‚1,2,3,4,5)æ—¶,æ ‘å˜æˆé“¾è¡¨</li>
<li>âŒ æ ‘é«˜è¿‡é«˜: ç™¾ä¸‡æ•°æ®æ ‘é«˜çº¦20å±‚,æŸ¥è¯¢éœ€è¦20æ¬¡ç£ç›˜I/O</li>
</ul>
<p><strong>AVLæ ‘ / çº¢é»‘æ ‘</strong>:</p>
<ul>
<li>âŒ æ ‘é«˜ä¾ç„¶è¿‡é«˜: ç™¾ä¸‡æ•°æ®æ ‘é«˜çº¦20å±‚</li>
<li>âŒ ç£ç›˜I/Oæ¬¡æ•°å¤š: æ¯å±‚ä¸€æ¬¡I/O,å¤ªæ…¢</li>
</ul>
<p><strong>Bæ ‘</strong>:</p>
<ul>
<li>âŒ éå¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®: æµªè´¹ç©ºé—´,æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨çš„é”®å€¼æ•°é‡å°‘</li>
<li>âŒ èŒƒå›´æŸ¥è¯¢éœ€è¦ä¸­åºéå†: éœ€è¦å›æº¯åˆ°æ ¹èŠ‚ç‚¹,æ•ˆç‡ä½</li>
</ul>
<p><strong>B+æ ‘ (InnoDBé€‰æ‹©)</strong>:</p>
<ul>
<li>âœ… <strong>éå¶å­èŠ‚ç‚¹åªå­˜å‚¨é”®å€¼</strong>: æ¯ä¸ªèŠ‚ç‚¹èƒ½å­˜å‚¨æ›´å¤šé”®(çº¦1170ä¸ª),æ ‘é«˜ä½(3å±‚çº¦2000ä¸‡è¡Œ)</li>
<li>âœ… <strong>æ‰€æœ‰æ•°æ®åœ¨å¶å­èŠ‚ç‚¹</strong>: æŸ¥è¯¢ç¨³å®š,æ¯æ¬¡æŸ¥è¯¢è·¯å¾„é•¿åº¦ç›¸åŒ</li>
<li>âœ… <strong>å¶å­èŠ‚ç‚¹åŒå‘é“¾è¡¨è¿æ¥</strong>: èŒƒå›´æŸ¥è¯¢åªéœ€é¡ºåºéå†é“¾è¡¨,æ— éœ€å›æº¯</li>
<li>âœ… <strong>ç£ç›˜I/Oæ¬¡æ•°å°‘</strong>: æ ‘é«˜ = I/Oæ¬¡æ•°,3æ¬¡I/Oå³å¯å®šä½ä»»æ„æ•°æ®</li>
</ul>
<p><strong>3å±‚B+æ ‘èƒ½å­˜å¤šå°‘æ•°æ®?</strong></p>
<p><strong>å‰ææ¡ä»¶</strong>:</p>
<ul>
<li>InnoDBé¡µå¤§å°: 16KB (<code>innodb_page_size=16384</code>)</li>
<li>ä¸»é”®(Bigint): 8å­—èŠ‚</li>
<li>æŒ‡é’ˆå¤§å°: 6å­—èŠ‚(InnoDBé¡µå·)</li>
<li>æ¯è¡Œæ•°æ®å¤§å°: å‡è®¾1KB</li>
</ul>
<p><strong>è®¡ç®—è¿‡ç¨‹</strong>:</p>
<p><strong>1. éå¶å­èŠ‚ç‚¹èƒ½å­˜å¤šå°‘ä¸ªé”®?</strong></p>
<p>æ¯ä¸ªé”® = ä¸»é”®(8B) + æŒ‡é’ˆ(6B) = 14å­—èŠ‚</p>
<p>æ¯ä¸ªèŠ‚ç‚¹(16KB) èƒ½å­˜: 16KB / 14B â‰ˆ <strong>1170ä¸ªé”®</strong></p>
<p><strong>2. å¶å­èŠ‚ç‚¹èƒ½å­˜å¤šå°‘è¡Œæ•°æ®?</strong></p>
<p>æ¯è¡Œæ•°æ® = 1KB (å‡è®¾)</p>
<p>æ¯ä¸ªèŠ‚ç‚¹(16KB) èƒ½å­˜: 16KB / 1KB = <strong>16è¡Œæ•°æ®</strong></p>
<p><strong>3. 3å±‚B+æ ‘èƒ½å­˜å¤šå°‘è¡Œ?</strong></p>
<ul>
<li>ç¬¬1å±‚(æ ¹èŠ‚ç‚¹): 1ä¸ªèŠ‚ç‚¹, 1170ä¸ªé”®, æŒ‡å‘1170ä¸ªç¬¬2å±‚èŠ‚ç‚¹</li>
<li>ç¬¬2å±‚: 1170ä¸ªèŠ‚ç‚¹, æ¯ä¸ª1170ä¸ªé”®, æŒ‡å‘ 1170 Ã— 1170 = 1,368,900 ä¸ªå¶å­èŠ‚ç‚¹</li>
<li>ç¬¬3å±‚(å¶å­èŠ‚ç‚¹): 1,368,900 Ã— 16 = <strong>21,902,400 â‰ˆ 2190ä¸‡è¡Œ</strong></li>
</ul>
<p><strong>ç»“è®º</strong>: <strong>3å±‚B+æ ‘, ä»…éœ€3æ¬¡ç£ç›˜I/O, å°±èƒ½å®šä½åˆ°2000ä¸‡æ¡æ•°æ®ä¸­çš„ä»»æ„ä¸€æ¡!</strong></p>
<p><strong>å¯¹æ¯”</strong>: å¦‚æœç”¨çº¢é»‘æ ‘, 2000ä¸‡æ•°æ®æ ‘é«˜çº¦25å±‚, éœ€è¦25æ¬¡I/O,æ€§èƒ½å·®è·1000å€ä»¥ä¸Š!</p>
<p><strong>ä¸ºä»€ä¹ˆæ ‘é«˜è¿™ä¹ˆä½?</strong></p>
<p>éå¶å­èŠ‚ç‚¹ä¸å­˜å‚¨æ•°æ®,åªå­˜å‚¨é”®+æŒ‡é’ˆ,æ¯ä¸ªèŠ‚ç‚¹èƒ½å­˜å‚¨1000+ä¸ªé”®,æ ‘çš„æ‰‡å‡º(Fan-out)æå¤§,æ ‘é«˜æä½ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆI/Oæ¬¡æ•°é‡è¦?</strong></p>
<p>ç£ç›˜éšæœºI/Oæ˜¯æ€§èƒ½ç“¶é¢ˆ:</p>
<ul>
<li>æœºæ¢°ç¡¬ç›˜: çº¦10ms/æ¬¡</li>
<li>SSD: çº¦0.1ms/æ¬¡</li>
</ul>
<p>3æ¬¡I/Oçº¦30ms,25æ¬¡I/Oçº¦250ms,å·®è·10å€!</p>
<hr/>
<h2 data-id="heading-17">å››ã€ä¸€æ¡SQLçš„æ‰§è¡Œæµç¨‹</h2>
<h3 data-id="heading-18">4.1 SELECTè¯­å¥çš„æ‰§è¡Œæµç¨‹</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3668fdf2a47b4fc6b7a39485c724344c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=XOq1yiHJ5qaqmIWIi4yJeMLjeZk%3D" alt="select-execution-flow.svg" loading="lazy"/></p>
<p><strong>ç¤ºä¾‹SQL</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">10</span>;
</code></pre>
<p><strong>å®Œæ•´æµç¨‹</strong>:</p>
<p><strong>æ­¥éª¤1: è¿æ¥å™¨ (Connector)</strong></p>
<ul>
<li>TCPæ¡æ‰‹,å»ºç«‹è¿æ¥</li>
<li>éªŒè¯ç”¨æˆ·åå¯†ç (æŸ¥è¯¢<code>mysql.user</code>è¡¨)</li>
<li>è·å–ç”¨æˆ·æƒé™(ä¿å­˜åˆ°è¿æ¥å¯¹è±¡ä¸­)</li>
<li>åŠ å…¥è¿æ¥æ± (<code>SHOW PROCESSLIST</code>å¯æŸ¥çœ‹)</li>
</ul>
<p><strong>æ­¥éª¤2: æŸ¥è¯¢ç¼“å­˜ (Query Cache, MySQL 8.0å·²ç§»é™¤)</strong></p>
<ul>
<li>ä½¿ç”¨SQLè¯­å¥ä½œä¸ºkey,æŸ¥è¯¢ç»“æœä½œä¸ºvalue</li>
<li><strong>å‘½ä¸­ç¼“å­˜</strong>: ç›´æ¥è¿”å›ç»“æœ,è·³è¿‡åç»­æ­¥éª¤</li>
<li><strong>æœªå‘½ä¸­</strong>: ç»§ç»­æ‰§è¡Œåç»­æ­¥éª¤</li>
<li><strong>è¡¨æ›´æ–°ä¼šæ¸…ç©ºè¯¥è¡¨çš„æ‰€æœ‰ç¼“å­˜</strong>(å‘½ä¸­ç‡æä½)</li>
</ul>
<p><strong>æ­¥éª¤3: åˆ†æå™¨ (Analyzer)</strong></p>
<p><strong>3.1 è¯æ³•åˆ†æ (Lexical Analysis)</strong>:</p>
<ul>
<li>è¯†åˆ«SQLä¸­çš„å…³é”®å­—: SELECT, FROM, WHERE, ORDER BY, LIMIT</li>
<li>è¯†åˆ«è¡¨å: users, å­—æ®µå: id, name, age</li>
</ul>
<p><strong>3.2 è¯­æ³•åˆ†æ (Syntax Analysis)</strong>:</p>
<ul>
<li>æ„å»ºè¯­æ³•æ ‘ (Parse Tree)</li>
<li>æ£€æŸ¥è¯­æ³•é”™è¯¯(å¦‚: <code>SELECT * FORM users</code>)</li>
</ul>
<p><strong>è¾“å‡º</strong>: è¯­æ³•æ ‘(AST)</p>
<p><strong>æ­¥éª¤4: ä¼˜åŒ–å™¨ (Optimizer)</strong></p>
<p><strong>4.1 ç´¢å¼•é€‰æ‹©</strong>:</p>
<ul>
<li>æŸ¥è¯¢usersè¡¨æœ‰å“ªäº›ç´¢å¼•(ä¸»é”®ç´¢å¼•ã€ageç´¢å¼•ã€nameç´¢å¼•...)</li>
<li><strong>æˆæœ¬è®¡ç®— (CBO - Cost-Based Optimizer)</strong>: è®¡ç®—å…¨è¡¨æ‰«æ vs ç´¢å¼•æ‰«æçš„æˆæœ¬</li>
<li>é€‰æ‹©æˆæœ¬æœ€ä½çš„ç´¢å¼•(å‡è®¾é€‰æ‹©idx_ageç´¢å¼•)</li>
</ul>
<p><strong>4.2 æ‰§è¡Œè®¡åˆ’ç”Ÿæˆ</strong>:</p>
<ul>
<li>ç¡®å®šJOINé¡ºåº(å¤šè¡¨æŸ¥è¯¢)</li>
<li>ç¡®å®šæ˜¯å¦ä½¿ç”¨ä¸´æ—¶è¡¨/æ’åº</li>
<li>ç”Ÿæˆæœ€ä¼˜æ‰§è¡Œè®¡åˆ’</li>
</ul>
<p><strong>è¾“å‡º</strong>: æ‰§è¡Œè®¡åˆ’(Execution Plan) - å¯é€šè¿‡<code>EXPLAIN</code>æŸ¥çœ‹</p>
<p><strong>æ­¥éª¤5: æ‰§è¡Œå™¨ (Executor)</strong></p>
<ul>
<li><strong>æƒé™æ£€æŸ¥</strong>: æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰usersè¡¨çš„SELECTæƒé™(ç¬¬1æ­¥å·²è·å–)</li>
<li><strong>è°ƒç”¨å­˜å‚¨å¼•æ“æ¥å£</strong>: InnoDBå¼•æ“çš„readæ¥å£,ä¼ å…¥æ¡ä»¶: <code>age &gt; 25</code></li>
<li><strong>é€è¡Œè¯»å–æ•°æ®</strong>: è¿‡æ»¤ä¸ç¬¦åˆæ¡ä»¶çš„è¡Œ</li>
<li><strong>æ’åº</strong>: <code>ORDER BY id</code></li>
<li><strong>é™åˆ¶ç»“æœ</strong>: <code>LIMIT 10</code></li>
<li><strong>è®°å½•æ…¢æŸ¥è¯¢æ—¥å¿—</strong>(å¦‚è¶…è¿‡é˜ˆå€¼)</li>
</ul>
<p><strong>æ­¥éª¤6: å­˜å‚¨å¼•æ“ (InnoDB)</strong></p>
<p><strong>6.1 æ£€æŸ¥Buffer Pool</strong>:</p>
<ul>
<li><strong>æ•°æ®é¡µåœ¨ç¼“å­˜ä¸­</strong>: ç›´æ¥è¿”å›æ•°æ®(ç¼“å­˜å‘½ä¸­, æ— ç£ç›˜I/O)</li>
<li><strong>æ•°æ®é¡µä¸åœ¨ç¼“å­˜ä¸­</strong>: ä»ç£ç›˜åŠ è½½æ•°æ®é¡µåˆ°Buffer Pool(ç£ç›˜I/O)</li>
</ul>
<p><strong>6.2 è¯»å–æ•°æ®</strong>:</p>
<ul>
<li>é€šè¿‡ageç´¢å¼•å®šä½æ•°æ®(B+æ ‘æŸ¥æ‰¾)</li>
<li><strong>å›è¡¨æŸ¥è¯¢</strong>: é€šè¿‡ä¸»é”®ç´¢å¼•è·å–å®Œæ•´è¡Œ</li>
</ul>
<p><strong>è¿”å›æ•°æ®ç»™æ‰§è¡Œå™¨ â†’ è¿”å›ç»“æœé›†ç»™å®¢æˆ·ç«¯</strong></p>
<p><strong>SELECTæ‰§è¡Œæµç¨‹å…³é”®ç‚¹</strong>:</p>
<ul>
<li>å®Œæ•´æµç¨‹: è¿æ¥å™¨ â†’ æŸ¥è¯¢ç¼“å­˜(8.0å·²ç§»é™¤) â†’ åˆ†æå™¨ â†’ ä¼˜åŒ–å™¨ â†’ æ‰§è¡Œå™¨ â†’ å­˜å‚¨å¼•æ“</li>
<li><strong>æ…¢æŸ¥è¯¢ä¼˜åŒ–é‡ç‚¹</strong>: ä¼˜åŒ–å™¨çš„ç´¢å¼•é€‰æ‹©ã€æ‰§è¡Œå™¨çš„å›è¡¨æ¬¡æ•°ã€å­˜å‚¨å¼•æ“çš„Buffer Poolå‘½ä¸­ç‡</li>
</ul>
<h3 data-id="heading-19">4.2 UPDATEè¯­å¥çš„æ‰§è¡Œæµç¨‹</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/727e8844b0ca4d0e82e704836f61dbc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=rATo1PrVy8cJJiW1E5g4AF2lsE8%3D" alt="update-execution-flow.svg" loading="lazy"/></p>
<p><strong>ç¤ºä¾‹SQL</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> <span class="hljs-number">26</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">100</span>;
</code></pre>
<p><strong>å‰5æ­¥ä¸SELECTç›¸åŒ</strong>: è¿æ¥å™¨ â†’ æŸ¥è¯¢ç¼“å­˜ â†’ åˆ†æå™¨ â†’ ä¼˜åŒ–å™¨ â†’ æ‰§è¡Œå™¨</p>
<p><strong>æ­¥éª¤6: InnoDBæ›´æ–°æµç¨‹ (WAL + 2PC)</strong></p>
<p><strong>6.1 æŸ¥æ‰¾æ•°æ® (WHERE id = 100)</strong></p>
<ul>
<li>å…ˆæŸ¥è¯¢Buffer Poolç¼“å­˜: æ•°æ®é¡µåœ¨ç¼“å­˜ä¸­,ç›´æ¥è¿”å›</li>
<li>æ•°æ®é¡µä¸åœ¨ç¼“å­˜: ä»ç£ç›˜.ibdæ–‡ä»¶åŠ è½½åˆ°Buffer Pool</li>
</ul>
<p><strong>6.2 å†™Undo Log (å›æ»šæ—¥å¿—)</strong></p>
<ul>
<li>è®°å½•æ—§å€¼: <code>id=100, age=25</code> (ç”¨äºäº‹åŠ¡å›æ»š)</li>
<li>ç”¨äºMVCCå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶(å…¶ä»–äº‹åŠ¡è¯»å–æ—§ç‰ˆæœ¬æ•°æ®)</li>
<li>å­˜å‚¨ä½ç½®: Undoè¡¨ç©ºé—´æˆ–ç³»ç»Ÿè¡¨ç©ºé—´(ibdata1)</li>
</ul>
<p><strong>6.3 æ›´æ–°Buffer Poolå†…å­˜æ•°æ®</strong></p>
<ul>
<li>åœ¨Buffer Poolä¸­ä¿®æ”¹æ•°æ®: <code>id=100, age=25 â†’ age=26</code></li>
<li>æ ‡è®°æ•°æ®é¡µä¸º"<strong>è„é¡µ</strong>" (Dirty Page)</li>
<li><strong>æ­¤æ—¶æ•°æ®åªåœ¨å†…å­˜ä¸­æ›´æ–°,å°šæœªå†™å…¥ç£ç›˜</strong> (WALæœºåˆ¶æ ¸å¿ƒ)</li>
</ul>
<p><strong>6.4 å†™Redo Log - prepareé˜¶æ®µ (InnoDBå¼•æ“å±‚)</strong></p>
<ul>
<li>å…ˆå†™Redo Log Buffer (å†…å­˜)</li>
<li>åˆ·ç›˜åˆ°ib_logfile0/1 (ç£ç›˜,é¡ºåºå†™)</li>
<li>è®°å½•å†…å®¹: "å°†usersè¡¨id=100çš„ageå­—æ®µæ”¹ä¸º26"</li>
<li><strong>çŠ¶æ€: prepare</strong> (ä¸¤é˜¶æ®µæäº¤ç¬¬1é˜¶æ®µ)</li>
<li><strong>ä½œç”¨</strong>: å´©æºƒæ¢å¤æ—¶,é€šè¿‡Redo Logé‡æ”¾,ä¿è¯æ•°æ®ä¸ä¸¢å¤±</li>
</ul>
<p><strong>å‚æ•°</strong>: <code>innodb_flush_log_at_trx_commit=1</code> (æ¯æ¬¡äº‹åŠ¡æäº¤åˆ·ç›˜,æœ€å®‰å…¨)</p>
<p><strong>6.5 å†™Binlog (MySQL Serverå±‚)</strong></p>
<ul>
<li>Binlogæ˜¯MySQL Serverå±‚çš„æ—¥å¿—(æ‰€æœ‰å­˜å‚¨å¼•æ“å…±äº«)</li>
<li>è®°å½•å®Œæ•´çš„SQLè¯­å¥æˆ–è¡Œå˜æ›´</li>
<li>åˆ·ç›˜åˆ°binlogæ–‡ä»¶(mysql-bin.000001)</li>
<li><strong>å‚æ•°</strong>: <code>sync_binlog=1</code> (æ¯æ¬¡äº‹åŠ¡æäº¤åˆ·ç›˜,æœ€å®‰å…¨)</li>
<li><strong>ä½œç”¨</strong>: ä¸»ä»å¤åˆ¶ã€æ•°æ®å¤‡ä»½ã€æ•°æ®æ¢å¤(point-in-time recovery)</li>
<li><strong>Binlogæ ¼å¼</strong>: ROW(è¡Œæ¨¡å¼,æ¨è), STATEMENT, MIXED</li>
</ul>
<p><strong>6.6 æäº¤äº‹åŠ¡ - Redo Log commité˜¶æ®µ (ä¸¤é˜¶æ®µæäº¤ç¬¬2é˜¶æ®µ)</strong></p>
<ul>
<li>å°†Redo LogçŠ¶æ€ä»prepareæ”¹ä¸ºcommit</li>
<li>äº‹åŠ¡æ­£å¼æäº¤æˆåŠŸ</li>
<li><strong>2PCä¸¤é˜¶æ®µæäº¤å®Œæˆ</strong>: prepare â†’ å†™Binlog â†’ commit (ä¿è¯Redo Logå’ŒBinlogä¸€è‡´æ€§)</li>
<li><strong>æ­¤æ—¶æ•°æ®ä»åœ¨Buffer Pool,å°šæœªå†™å…¥.ibdæ–‡ä»¶</strong></li>
</ul>
<p><strong>6.7 åˆ·è„é¡µ (Flush Dirty Pages) - å¼‚æ­¥åå°çº¿ç¨‹</strong></p>
<ul>
<li><strong>åå°çº¿ç¨‹å¼‚æ­¥å°†è„é¡µåˆ·å›ç£ç›˜</strong> (.ibdæ•°æ®æ–‡ä»¶, éšæœºå†™)</li>
<li><strong>è§¦å‘æ—¶æœº</strong>:
<ol>
<li>Redo Logæ»¡äº†(å¿…é¡»åˆ·è„é¡µ,è…¾å‡ºRedo Logç©ºé—´)</li>
<li>Buffer Poolç©ºé—´ä¸è¶³(æ·˜æ±°è„é¡µ,éœ€å…ˆåˆ·ç›˜)</li>
<li>MySQLç©ºé—²æ—¶(åå°çº¿ç¨‹å®šæœŸåˆ·ç›˜)</li>
<li>MySQLæ­£å¸¸å…³é—­æ—¶(åˆ·æ‰€æœ‰è„é¡µ)</li>
</ol>
</li>
</ul>
<p><strong>å‚æ•°</strong>:</p>
<ul>
<li><code>innodb_io_capacity=200</code>: åˆ·ç›˜IOPSèƒ½åŠ›(SSDå¯è°ƒé«˜åˆ°1000-5000)</li>
<li><code>innodb_max_dirty_pages_pct=75</code>: è„é¡µæ¯”ä¾‹é˜ˆå€¼75%</li>
</ul>
<p><strong>WAL (Write-Ahead Logging) æœºåˆ¶æ ¸å¿ƒ</strong>:</p>
<p><strong>ä¸ºä»€ä¹ˆå…ˆå†™æ—¥å¿—,å†å¼‚æ­¥åˆ·è„é¡µ?</strong></p>
<ul>
<li><strong>Redo Logé¡ºåºå†™</strong> (appendè¿½åŠ æ¨¡å¼), é€Ÿåº¦æå¿«(ç£ç›˜é¡ºåºI/Oçº¦100MB/s)</li>
<li><strong>æ•°æ®æ–‡ä»¶éšæœºå†™</strong> (.ibdæ–‡ä»¶, é€Ÿåº¦æ…¢, ç£ç›˜éšæœºI/Oçº¦100æ¬¡/s)</li>
<li><strong>äº‹åŠ¡æäº¤æ—¶åªéœ€åˆ·Redo Log</strong>(å¿«), è„é¡µå¼‚æ­¥åˆ·ç›˜(æ…¢,ä½†ä¸é˜»å¡äº‹åŠ¡) â†’ <strong>å†™å…¥æ€§èƒ½æå‡10-100å€</strong></li>
<li><strong>å´©æºƒæ¢å¤</strong>: é‡å¯å,é€šè¿‡Redo Logé‡æ”¾(redo),æ¢å¤æœªåˆ·ç›˜çš„è„é¡µæ•°æ®,ä¿è¯äº‹åŠ¡æŒä¹…æ€§(Durability)</li>
</ul>
<p><strong>2PC (Two-Phase Commit) ä¸¤é˜¶æ®µæäº¤</strong>:</p>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦2PC? ä¿è¯Redo Logå’ŒBinlogä¸€è‡´æ€§</strong></p>
<ul>
<li>Redo Log (InnoDBå¼•æ“å±‚) + Binlog (MySQL Serverå±‚) ä¸¤ä»½æ—¥å¿—,å¿…é¡»ä¿æŒä¸€è‡´</li>
<li><strong>2PCæµç¨‹</strong>: Redo Log prepare â†’ å†™Binlog â†’ Redo Log commit</li>
<li><strong>å´©æºƒæ¢å¤åœºæ™¯</strong>:
<ul>
<li>â‘  prepareæˆåŠŸ,Binlogå¤±è´¥ â†’ å›æ»š</li>
<li>â‘¡ prepareæˆåŠŸ,BinlogæˆåŠŸ,commitå¤±è´¥ â†’ æäº¤(é€šè¿‡Binlogæ¢å¤)</li>
</ul>
</li>
<li><strong>ä¿è¯ä¸»ä»æ•°æ®ä¸€è‡´æ€§</strong>: Binlogç”¨äºä¸»ä»å¤åˆ¶,2PCç¡®ä¿ä¸»åº“Redo Logå’Œä»åº“Binlogä¸€è‡´</li>
</ul>
<p><strong>UPDATEæ‰§è¡Œæµç¨‹å…³é”®ç‚¹</strong>:</p>
<ul>
<li><strong>WALæœºåˆ¶</strong>: å…ˆå†™æ—¥å¿—(Redo Log/Binlog, é¡ºåºI/O), å†å¼‚æ­¥åˆ·è„é¡µ(æ•°æ®æ–‡ä»¶, éšæœºI/O), å†™å…¥æ€§èƒ½æå‡10-100å€</li>
<li><strong>2PCä¸¤é˜¶æ®µæäº¤</strong>: ä¿è¯Redo Logå’ŒBinlogä¸€è‡´æ€§, é¿å…ä¸»ä»æ•°æ®ä¸ä¸€è‡´</li>
<li><strong>äº‹åŠ¡æŒä¹…æ€§ä¿è¯</strong>: äº‹åŠ¡æäº¤å,å³ä½¿ç«‹å³å´©æºƒ,é‡å¯åé€šè¿‡Redo Logé‡æ”¾,æ•°æ®ä¸ä¸¢å¤±</li>
</ul>
<hr/>
<h2 data-id="heading-20">äº”ã€Buffer Poolç¼“å†²æ± åŸç†ä¸ä¼˜åŒ–</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb0fc9da772440ea84459e5530cbdcbd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=N2miBGwfnLffaWt2X2eHxsH8ek0%3D" alt="buffer-pool-lru.svg" loading="lazy"/></p>
<h3 data-id="heading-21">5.1 Buffer Poolæ•´ä½“ç»“æ„</h3>
<p><strong>Buffer Poolæ˜¯InnoDBæ€§èƒ½çš„æ ¸å¿ƒ</strong>,ç¼“å­˜æ•°æ®é¡µå’Œç´¢å¼•é¡µ,å‡å°‘ç£ç›˜I/Oã€‚</p>
<p><strong>Buffer Poolç»“æ„</strong>:</p>
<ul>
<li><strong>YoungåŒº</strong> (æ–°æ•°æ®åŒº): å Buffer Poolçš„5/8 (62.5%),å­˜æ”¾çƒ­æ•°æ®</li>
<li><strong>OldåŒº</strong> (è€æ•°æ®åŒº): å Buffer Poolçš„3/8 (37.5%),å­˜æ”¾å†·æ•°æ®</li>
<li><strong>Midpointåˆ†ç•Œç‚¹</strong>: YoungåŒºå’ŒOldåŒºçš„è¾¹ç•Œ</li>
</ul>
<h3 data-id="heading-22">5.2 æ”¹è¿›çš„LRUé“¾è¡¨</h3>
<p><strong>ä¼ ç»ŸLRUç®—æ³•çš„é—®é¢˜</strong>:</p>
<p>å…¨è¡¨æ‰«æä¼šå°†å¤§é‡å†·æ•°æ®åŠ è½½åˆ°ç¼“å­˜,æŒ¤æ‰çƒ­æ•°æ®(ç¼“å­˜æ±¡æŸ“)ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> large_table;  <span class="hljs-comment">-- å…¨è¡¨æ‰«æ,åŠ è½½å‡ ç™¾ä¸‡è¡Œæ•°æ®åˆ°ç¼“å­˜</span>
</code></pre>
<p>ä¼ ç»ŸLRU: æ–°æ•°æ®æ’å…¥é“¾è¡¨å¤´,çƒ­æ•°æ®è¢«æŒ¤åˆ°é“¾è¡¨å°¾,æœ€ç»ˆè¢«æ·˜æ±° â†’ <strong>ç¼“å­˜æ±¡æŸ“</strong></p>
<p><strong>InnoDBçš„æ”¹è¿› (Midpointæ’å…¥ç­–ç•¥)</strong>:</p>
<ol>
<li><strong>æ–°æ•°æ®é¡µä¸æ’å…¥é“¾è¡¨å¤´,è€Œæ˜¯æ’å…¥OldåŒºå¤´éƒ¨(Midpointä½ç½®)</strong></li>
<li><strong>åªæœ‰åœ¨OldåŒºåœç•™â‰¥1ç§’åå†æ¬¡è®¿é—®,æ‰ç§»åŠ¨åˆ°YoungåŒº</strong></li>
<li><strong>å…¨è¡¨æ‰«æçš„æ•°æ®é¡µåªåœç•™åœ¨OldåŒº,ä¸å½±å“YoungåŒºçš„çƒ­æ•°æ®</strong></li>
</ol>
<p><strong>å‚æ•°</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">innodb_old_blocks_pct=37            <span class="hljs-comment"># OldåŒºå æ¯”37% (é»˜è®¤)</span>
innodb_old_blocks_time=1000         <span class="hljs-comment"># OldåŒºåœç•™æ—¶é—´1ç§’ (é»˜è®¤)</span>
</code></pre>
<p><strong>å¥½å¤„</strong>:</p>
<ul>
<li><strong>å…¨è¡¨æ‰«æçš„æ•°æ®é¡µåªåœç•™åœ¨OldåŒº,ä¸å½±å“YoungåŒºçš„çƒ­æ•°æ®</strong></li>
<li><strong>çœŸæ­£çš„çƒ­æ•°æ®(å¤šæ¬¡è®¿é—®)æ‰ä¼šè¿›å…¥YoungåŒº</strong></li>
<li><strong>æœ‰æ•ˆé˜²æ­¢ç¼“å­˜æ±¡æŸ“</strong></li>
</ul>
<h3 data-id="heading-23">5.3 æ•°æ®é¡µåŠ è½½ä¸æ·˜æ±°æµç¨‹</h3>
<p><strong>åœºæ™¯1: ä»ç£ç›˜åŠ è½½æ–°æ•°æ®é¡µ</strong></p>
<ol>
<li>æ£€æŸ¥Buffer Poolæ˜¯å¦æœ‰ç©ºé—²é¡µ</li>
<li>è‹¥æ— ç©ºé—²,ä»LRUé“¾è¡¨å°¾æ·˜æ±°æœ€ä¹…æœªä½¿ç”¨çš„é¡µ</li>
<li>å°†æ–°æ•°æ®é¡µåŠ è½½åˆ°Buffer Pool</li>
<li><strong>æ’å…¥åˆ°LRUé“¾è¡¨çš„OldåŒºå¤´éƒ¨(Midpoint)</strong></li>
<li>1ç§’åå†æ¬¡è®¿é—®,ç§»åŠ¨åˆ°YoungåŒºå¤´éƒ¨</li>
</ol>
<p><strong>åœºæ™¯2: è„é¡µåˆ·ç›˜</strong></p>
<ul>
<li><strong>è„é¡µ</strong> = å†…å­˜ä¸­å·²ä¿®æ”¹ä½†æœªå†™å…¥ç£ç›˜çš„æ•°æ®é¡µ</li>
<li><strong>åˆ·ç›˜æ—¶æœº</strong>:
<ul>
<li>Redo Logæ»¡äº†</li>
<li>Buffer Poolç©ºé—´ä¸è¶³,éœ€è¦æ·˜æ±°è„é¡µ</li>
<li>MySQLç©ºé—²æ—¶,åå°çº¿ç¨‹åˆ·ç›˜</li>
<li>MySQLæ­£å¸¸å…³é—­æ—¶</li>
</ul>
</li>
</ul>
<p><strong>åœºæ™¯3: é¡µè¢«è®¿é—®</strong></p>
<ol>
<li><strong>é¡µåœ¨YoungåŒº</strong>: ä¸ç§»åŠ¨,é¿å…é¢‘ç¹è°ƒæ•´é“¾è¡¨</li>
<li><strong>é¡µåœ¨OldåŒº</strong>:
<ul>
<li>åˆšè¿›å…¥OldåŒº(&lt;1ç§’): ä¸ç§»åŠ¨</li>
<li>åœ¨OldåŒºåœç•™â‰¥1ç§’: ç§»åŠ¨åˆ°YoungåŒºå¤´éƒ¨</li>
</ul>
</li>
<li><strong>é¡µä¸åœ¨Buffer Pool</strong>: ä»ç£ç›˜åŠ è½½(åœºæ™¯1)</li>
</ol>
<h3 data-id="heading-24">5.4 é¢„è¯»æœºåˆ¶ (Read-Ahead)</h3>
<p><strong>é¢„è¯»æœºåˆ¶</strong>: InnoDBé¢„æµ‹å³å°†è®¿é—®çš„æ•°æ®é¡µ,æå‰åŠ è½½åˆ°Buffer Poolã€‚</p>
<p><strong>1. çº¿æ€§é¢„è¯» (Linear Read-Ahead)</strong>:</p>
<ul>
<li>é¡ºåºè®¿é—®åŒº(Extent, 64ä¸ªè¿ç»­é¡µ)ä¸­çš„é¡µè¾¾åˆ°é˜ˆå€¼,é¢„è¯»ä¸‹ä¸€ä¸ªåŒºçš„æ‰€æœ‰é¡µ</li>
<li>å‚æ•°: <code>innodb_read_ahead_threshold=56</code> (é»˜è®¤56,èŒƒå›´0-64)</li>
<li>é€‚ç”¨: å…¨è¡¨æ‰«æã€èŒƒå›´æŸ¥è¯¢</li>
</ul>
<p><strong>2. éšæœºé¢„è¯» (Random Read-Ahead)</strong>:</p>
<ul>
<li>åŒä¸€ä¸ªåŒºä¸­,å¤šä¸ªé¡µè¢«è®¿é—®,é¢„è¯»æ•´ä¸ªåŒºçš„å…¶ä»–é¡µ</li>
<li>é»˜è®¤å…³é—­: <code>innodb_random_read_ahead=OFF</code></li>
</ul>
<p><strong>é¢„è¯»çš„å½±å“</strong>:</p>
<ul>
<li>âœ… <strong>å¥½å¤„</strong>: å‡å°‘ç£ç›˜I/O,æå‡é¡ºåºè¯»æ€§èƒ½</li>
<li>âŒ <strong>åå¤„</strong>: å¯èƒ½é¢„è¯»æ— ç”¨é¡µ,æµªè´¹Buffer Poolç©ºé—´</li>
</ul>
<h3 data-id="heading-25">5.5 Buffer Poolæ ¸å¿ƒè¦ç‚¹</h3>
<ul>
<li><strong>Buffer Poolæ˜¯InnoDBæ€§èƒ½çš„æ ¸å¿ƒ</strong>,ç¼“å­˜çƒ­æ•°æ®,å‡å°‘ç£ç›˜I/O</li>
<li><strong>æ”¹è¿›çš„LRUç®—æ³•é¿å…å…¨è¡¨æ‰«ææ±¡æŸ“çƒ­æ•°æ®</strong>(OldåŒº+1ç§’å»¶è¿Ÿç­–ç•¥)</li>
<li><strong>è„é¡µå¼‚æ­¥åˆ·ç›˜</strong>,WALæœºåˆ¶ä¿è¯æ€§èƒ½å’Œæ•°æ®æŒä¹…æ€§</li>
</ul>
<hr/>
<h2 data-id="heading-26">å…­ã€å®æˆ˜åœºæ™¯åº”ç”¨</h2>
<h3 data-id="heading-27">6.1 ä½¿ç”¨EXPLAINåˆ†ææ‰§è¡Œè®¡åˆ’</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae6579d53d6d438997a486e111fda543~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54Sh6YeP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766835402&amp;x-signature=goDDkWwvREh9bqhoI0an%2B89a4ik%3D" alt="explain-example.svg" loading="lazy"/></p>
<p><strong>EXPLAINæ˜¯SQLä¼˜åŒ–çš„ç¬¬ä¸€æ­¥</strong>,åˆ†ææ‰§è¡Œè®¡åˆ’,å®šä½æ€§èƒ½ç“¶é¢ˆã€‚</p>
<p><strong>å…³é”®å­—æ®µ</strong>:</p>
<p><strong>type (è®¿é—®ç±»å‹,æ€§èƒ½å…³é”®)</strong>:</p>
<ul>
<li>âœ… <strong>system &gt; const &gt; eq_ref &gt; ref</strong> (ä¼˜ç§€,ä½¿ç”¨ç´¢å¼•ç²¾ç¡®æŸ¥æ‰¾)</li>
<li>âš ï¸ <strong>range &gt; index</strong> (å¯æ¥å—,ç´¢å¼•èŒƒå›´æ‰«ææˆ–ç´¢å¼•å…¨æ‰«æ)</li>
<li>âŒ <strong>ALL</strong> (å…¨è¡¨æ‰«æ,æœ€å·®)</li>
</ul>
<p><strong>key (å®é™…ä½¿ç”¨çš„ç´¢å¼•)</strong>:</p>
<ul>
<li><strong>NULL</strong>: æœªä½¿ç”¨ç´¢å¼•,éœ€ä¼˜åŒ–</li>
<li><strong>idx_name</strong>: ä½¿ç”¨ç´¢å¼•,æ€§èƒ½å¥½</li>
</ul>
<p><strong>rows (æ‰«æçš„è¡Œæ•°)</strong>:</p>
<ul>
<li><strong>è¶Šå°‘è¶Šå¥½</strong>,rowsè¿‡å¤§(å¦‚&gt;10ä¸‡)éœ€æ£€æŸ¥ç´¢å¼•æ˜¯å¦ç”Ÿæ•ˆ</li>
</ul>
<p><strong>Extra (é¢å¤–ä¿¡æ¯)</strong>:</p>
<ul>
<li>âœ… <strong>Using index</strong>: è¦†ç›–ç´¢å¼•,åªè¯»ç´¢å¼•,ä¸å›è¡¨,æ€§èƒ½æœ€ä¼˜</li>
<li>âœ… <strong>Using where</strong>: ä½¿ç”¨WHEREè¿‡æ»¤</li>
<li>âŒ <strong>Using filesort</strong>: æ–‡ä»¶æ’åº,æ€§èƒ½å·®,éœ€ä¼˜åŒ– â†’ åœ¨ORDER BYå­—æ®µä¸Šå»ºç´¢å¼•</li>
<li>âŒ <strong>Using temporary</strong>: ä½¿ç”¨ä¸´æ—¶è¡¨,æ€§èƒ½å·®,éœ€ä¼˜åŒ– â†’ åœ¨GROUP BYå­—æ®µä¸Šå»ºç´¢å¼•</li>
</ul>
<p><strong>ç¤ºä¾‹1: ä¼˜ç§€çš„æ‰§è¡Œè®¡åˆ’</strong></p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;
</code></pre>
<p><strong>ç»“æœ</strong>: type=ref (ä¼˜ç§€), key=idx_age, rows=1000</p>
<p><strong>åˆ†æ</strong>: ä½¿ç”¨idx_ageç´¢å¼•,æ‰«æ1000è¡Œ,æ€§èƒ½è‰¯å¥½</p>
<p><strong>ç¤ºä¾‹2: ç³Ÿç³•çš„æ‰§è¡Œè®¡åˆ’</strong></p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(birthday) <span class="hljs-operator">=</span> <span class="hljs-number">2000</span>;
</code></pre>
<p><strong>ç»“æœ</strong>: type=ALL (å…¨è¡¨æ‰«æ), key=NULL (æœªä½¿ç”¨ç´¢å¼•), rows=5000000</p>
<p><strong>é—®é¢˜</strong>:</p>
<ul>
<li>WHEREæ¡ä»¶ä½¿ç”¨äº†å‡½æ•°<code>YEAR(birthday)</code>,å¯¼è‡´ç´¢å¼•å¤±æ•ˆ</li>
<li>å…¨è¡¨æ‰«æ500ä¸‡è¡Œ,æ€§èƒ½æå·®</li>
</ul>
<p><strong>ä¼˜åŒ–</strong>: æ”¹ä¸º <code>WHERE birthday BETWEEN '2000-01-01' AND '2000-12-31'</code>,å¯ä½¿ç”¨idx_birthdayç´¢å¼•</p>
<p><strong>ç¤ºä¾‹3: æ–‡ä»¶æ’åº</strong></p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN <span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> birthday;
</code></pre>
<p><strong>ç»“æœ</strong>: type=range, key=idx_age, Extra=<strong>Using filesort</strong></p>
<p><strong>é—®é¢˜</strong>: ORDER BYçš„å­—æ®µ(birthday)ä¸WHEREæ¡ä»¶çš„ç´¢å¼•(idx_age)ä¸åŒ,æ— æ³•åˆ©ç”¨ç´¢å¼•æ’åº,éœ€è¦é¢å¤–çš„filesortæ“ä½œ</p>
<p><strong>ä¼˜åŒ–</strong>: åˆ›å»ºè”åˆç´¢å¼•<code>idx_age_birthday(age, birthday)</code>,ORDER BYå­—æ®µåœ¨ç´¢å¼•ä¸­,é¿å…filesort</p>
<h3 data-id="heading-28">6.2 æ…¢æŸ¥è¯¢ä¼˜åŒ–å®æˆ˜</h3>
<p><strong>æ…¢æŸ¥è¯¢æ—¥å¿—é…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">slow_query_log=ON                           <span class="hljs-comment"># å¼€å¯æ…¢æŸ¥è¯¢æ—¥å¿—</span>
long_query_time=1                           <span class="hljs-comment"># æ…¢æŸ¥è¯¢é˜ˆå€¼1ç§’</span>
slow_query_log_file=/var/log/mysql-slow.log
log_queries_not_using_indexes=ON            <span class="hljs-comment"># è®°å½•æœªä½¿ç”¨ç´¢å¼•çš„æŸ¥è¯¢</span>
</code></pre>
<p><strong>æ…¢æŸ¥è¯¢åˆ†æå·¥å…·</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># mysqldumpslow: MySQLè‡ªå¸¦çš„æ…¢æŸ¥è¯¢åˆ†æå·¥å…·</span>
mysqldumpslow -s t -t 10 /var/log/mysql-slow.log  <span class="hljs-comment"># æŒ‰æ—¶é—´æ’åº,æ˜¾ç¤ºå‰10æ¡</span>

<span class="hljs-comment"># pt-query-digest: Percona Toolkitå·¥å…·(æ¨è)</span>
pt-query-digest /var/log/mysql-slow.log
</code></pre>
<p><strong>å¸¸è§æ…¢æŸ¥è¯¢åœºæ™¯ä¸ä¼˜åŒ–</strong>:</p>
<p><strong>åœºæ™¯1: ç´¢å¼•å¤±æ•ˆ - åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ…¢æŸ¥è¯¢ (ç´¢å¼•å¤±æ•ˆ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(birthday) <span class="hljs-operator">=</span> <span class="hljs-number">2000</span>;

<span class="hljs-comment">-- âœ… ä¼˜åŒ– (ä½¿ç”¨ç´¢å¼•)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> birthday <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2000-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2000-12-31'</span>;
</code></pre>
<p><strong>åœºæ™¯2: ç´¢å¼•å¤±æ•ˆ - éšå¼ç±»å‹è½¬æ¢</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ…¢æŸ¥è¯¢ (nameæ˜¯varchar,ä¸æ•°å­—123æ¯”è¾ƒ,å‘ç”Ÿéšå¼ç±»å‹è½¬æ¢,ç´¢å¼•å¤±æ•ˆ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-number">123</span>;

<span class="hljs-comment">-- âœ… ä¼˜åŒ–</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'123'</span>;
</code></pre>
<p><strong>åœºæ™¯3: ç´¢å¼•å¤±æ•ˆ - LIKEå‰ç¼€é€šé…ç¬¦</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ…¢æŸ¥è¯¢ (å‰ç¼€é€šé…ç¬¦,ç´¢å¼•å¤±æ•ˆ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%abc'</span>;

<span class="hljs-comment">-- âœ… ä¼˜åŒ– (åç¼€é€šé…ç¬¦,å¯ä½¿ç”¨ç´¢å¼•)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'abc%'</span>;
</code></pre>
<p><strong>åœºæ™¯4: å›è¡¨æ¬¡æ•°è¿‡å¤š - ä½¿ç”¨è¦†ç›–ç´¢å¼•</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ…¢æŸ¥è¯¢ (å›è¡¨100ä¸‡æ¬¡)</span>
<span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>;  <span class="hljs-comment">-- å‡è®¾è¿”å›100ä¸‡è¡Œ</span>

<span class="hljs-comment">-- âœ… ä¼˜åŒ– (è¦†ç›–ç´¢å¼•,æ— éœ€å›è¡¨)</span>
<span class="hljs-comment">-- åˆ›å»ºè”åˆç´¢å¼• idx_age_name_id(age, name, id)</span>
<span class="hljs-comment">-- æˆ–è€…åªæŸ¥è¯¢ç´¢å¼•åˆ—</span>
<span class="hljs-keyword">SELECT</span> id, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>;
</code></pre>
<p><strong>åœºæ™¯5: æ·±åˆ†é¡µé—®é¢˜</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ…¢æŸ¥è¯¢ (æ‰«æ100ä¸‡+10è¡Œ,ä¸¢å¼ƒ100ä¸‡è¡Œ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">1000000</span>, <span class="hljs-number">10</span>;

<span class="hljs-comment">-- âœ… ä¼˜åŒ–1: ä½¿ç”¨idèŒƒå›´æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">1000000</span> <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">10</span>;

<span class="hljs-comment">-- âœ… ä¼˜åŒ–2: å»¶è¿Ÿå…³è” (å…ˆæŸ¥ä¸»é”®,å†å›è¡¨)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users
<span class="hljs-keyword">WHERE</span> id <span class="hljs-keyword">IN</span> (<span class="hljs-keyword">SELECT</span> id <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> id LIMIT <span class="hljs-number">1000000</span>, <span class="hljs-number">10</span>);
</code></pre>
<p><strong>åœºæ™¯6: æœªæ·»åŠ å¿…è¦ç´¢å¼•</strong></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ æ…¢æŸ¥è¯¢ (WHEREæ¡ä»¶åˆ—æ— ç´¢å¼•)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> orders <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span> <span class="hljs-keyword">AND</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- âœ… ä¼˜åŒ–: åˆ›å»ºè”åˆç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> orders <span class="hljs-keyword">ADD</span> INDEX idx_user_id_status (user_id, status);
</code></pre>
<hr/>
<h2 data-id="heading-29">ä¸ƒã€æœ€ä½³å®è·µä¸æ€»ç»“</h2>
<h3 data-id="heading-30">7.1 SQLç¼–å†™è§„èŒƒ</h3>
<p>**1. é¿å…SELECT ***:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;

<span class="hljs-comment">-- âœ… æ­£ç¡® (åªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ)</span>
<span class="hljs-keyword">SELECT</span> id, name, age <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p><strong>å¥½å¤„</strong>: å‡å°‘ç½‘ç»œä¼ è¾“ã€å‡å°‘Buffer Poolå ç”¨ã€å¯èƒ½ä½¿ç”¨è¦†ç›–ç´¢å¼•</p>
<p><strong>2. WHEREæ¡ä»¶åˆ—æ·»åŠ ç´¢å¼•</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ (ageåˆ—æ— ç´¢å¼•)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>;

<span class="hljs-comment">-- âœ… æ­£ç¡® (æ·»åŠ ç´¢å¼•)</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_age (age);
</code></pre>
<p><strong>3. é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ (ç´¢å¼•å¤±æ•ˆ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">YEAR</span>(birthday) <span class="hljs-operator">=</span> <span class="hljs-number">2000</span>;

<span class="hljs-comment">-- âœ… æ­£ç¡®</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> birthday <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2000-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2000-12-31'</span>;
</code></pre>
<p><strong>4. ä½¿ç”¨LIMITé™åˆ¶æŸ¥è¯¢ç»“æœ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ (è¿”å›å…¨éƒ¨100ä¸‡è¡Œ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span>;

<span class="hljs-comment">-- âœ… æ­£ç¡® (é™åˆ¶è¿”å›1000è¡Œ)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">&gt;</span> <span class="hljs-number">25</span> LIMIT <span class="hljs-number">1000</span>;
</code></pre>
<p><strong>5. é¿å…å¤§äº‹åŠ¡,æ§åˆ¶äº‹åŠ¡èŒƒå›´</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- âŒ é”™è¯¯ (å¤§äº‹åŠ¡,é”å®šæ—¶é—´é•¿)</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> <span class="hljs-number">26</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-comment">-- ... æ‰§è¡Œ100æ¡SQL ...</span>
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-comment">-- âœ… æ­£ç¡® (æ‹†åˆ†ä¸ºå¤šä¸ªå°äº‹åŠ¡)</span>
<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> <span class="hljs-number">26</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-keyword">COMMIT</span>;

<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">UPDATE</span> users <span class="hljs-keyword">SET</span> age <span class="hljs-operator">=</span> <span class="hljs-number">27</span> <span class="hljs-keyword">WHERE</span> id <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h3 data-id="heading-31">7.2 ç´¢å¼•è®¾è®¡æœ€ä½³å®è·µ</h3>
<p><strong>1. é«˜é€‰æ‹©æ€§å­—æ®µä¼˜å…ˆå»ºç´¢å¼•</strong>:</p>
<ul>
<li>âœ… <strong>é€‰æ‹©æ€§é«˜</strong>: ä¸»é”®ã€å”¯ä¸€é”®ã€æ‰‹æœºå·ã€é‚®ç®± (æ¯ä¸ªå€¼å‡ ä¹å”¯ä¸€)</li>
<li>âŒ <strong>é€‰æ‹©æ€§ä½</strong>: æ€§åˆ«ã€çŠ¶æ€ã€ç±»å‹ (åªæœ‰2-5ä¸ªå€¼)</li>
</ul>
<p><strong>2. è”åˆç´¢å¼•éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åˆ›å»ºè”åˆç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_age_name (age, name);

<span class="hljs-comment">-- âœ… èƒ½ä½¿ç”¨ç´¢å¼•</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span>;                    <span class="hljs-comment">-- ä½¿ç”¨age</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> age <span class="hljs-operator">=</span> <span class="hljs-number">25</span> <span class="hljs-keyword">AND</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>; <span class="hljs-comment">-- ä½¿ç”¨age + name</span>

<span class="hljs-comment">-- âŒ ä¸èƒ½ä½¿ç”¨ç´¢å¼• (è¿åæœ€å·¦å‰ç¼€åŸåˆ™)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'Alice'</span>;              <span class="hljs-comment">-- nameä¸æ˜¯æœ€å·¦åˆ—</span>
</code></pre>
<p><strong>3. è¦†ç›–ç´¢å¼•,é¿å…å›è¡¨</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥è¯¢: SELECT id, age FROM users WHERE age &gt; 25;</span>

<span class="hljs-comment">-- âœ… åˆ›å»ºè¦†ç›–ç´¢å¼• (ç´¢å¼•åŒ…å«id, age)</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">ADD</span> INDEX idx_age (age);  <span class="hljs-comment">-- idæ˜¯ä¸»é”®,è‡ªåŠ¨åŒ…å«åœ¨äºŒçº§ç´¢å¼•ä¸­</span>

<span class="hljs-comment">-- æ‰§è¡Œè®¡åˆ’: Extra=Using index (è¦†ç›–ç´¢å¼•,æ— éœ€å›è¡¨)</span>
</code></pre>
<p><strong>4. ç´¢å¼•åˆ—ä¸å®œè¿‡å¤š</strong>:</p>
<ul>
<li>å•è¡¨ç´¢å¼•æ•°é‡å»ºè®® â‰¤ 5ä¸ª</li>
<li>è”åˆç´¢å¼•å­—æ®µæ•°é‡å»ºè®® â‰¤ 3ä¸ª</li>
<li><strong>ç´¢å¼•è¿‡å¤š</strong>: å½±å“INSERT/UPDATE/DELETEæ€§èƒ½,å ç”¨ç©ºé—´</li>
</ul>
<p><strong>5. å®šæœŸæ¸…ç†æ— ç”¨ç´¢å¼•</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥è¯¢æœªä½¿ç”¨çš„ç´¢å¼• (MySQL 5.7+)</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> sys.schema_unused_indexes;

<span class="hljs-comment">-- åˆ é™¤æ— ç”¨ç´¢å¼•</span>
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> users <span class="hljs-keyword">DROP</span> INDEX idx_unused;
</code></pre>
<h3 data-id="heading-32">7.3 Buffer Poolè°ƒä¼˜</h3>
<p><strong>1. åˆç†è®¾ç½®Buffer Poolå¤§å°</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">innodb_buffer_pool_size=8G     <span class="hljs-comment"># å»ºè®®:ç‰©ç†å†…å­˜çš„50-80%</span>
</code></pre>
<p><strong>ç›‘æ§Buffer Poolå‘½ä¸­ç‡</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">GLOBAL</span> STATUS <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'Innodb_buffer_pool%'</span>;

<span class="hljs-comment">-- è®¡ç®—å‘½ä¸­ç‡</span>
Buffer Poolå‘½ä¸­ç‡ <span class="hljs-operator">=</span> (Innodb_buffer_pool_read_requests <span class="hljs-operator">-</span> Innodb_buffer_pool_reads) <span class="hljs-operator">/</span> Innodb_buffer_pool_read_requests

<span class="hljs-comment">-- å»ºè®®: å‘½ä¸­ç‡ â‰¥ 99%</span>
</code></pre>
<p><strong>2. å¤šå®ä¾‹å‡å°‘é”ç«äº‰</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">innodb_buffer_pool_instances=8  <span class="hljs-comment"># Buffer Poolå®ä¾‹æ•°,é»˜è®¤8 (â‰¥1GBæ—¶ç”Ÿæ•ˆ)</span>
</code></pre>
<h3 data-id="heading-33">7.4 æ—¥å¿—å‚æ•°è°ƒä¼˜</h3>
<p><strong>1. Redo Logé…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">innodb_log_file_size=1G              <span class="hljs-comment"># Redo Logå•ä¸ªæ–‡ä»¶å¤§å°</span>
innodb_log_files_in_group=2          <span class="hljs-comment"># Redo Logæ–‡ä»¶æ•°é‡</span>
innodb_flush_log_at_trx_commit=1     <span class="hljs-comment"># åˆ·ç›˜ç­–ç•¥:</span>
                                     <span class="hljs-comment"># 0: æ¯ç§’åˆ·ç›˜ä¸€æ¬¡ (æ€§èƒ½æœ€å¥½,ä½†å¯èƒ½ä¸¢å¤±1ç§’æ•°æ®)</span>
                                     <span class="hljs-comment"># 1: æ¯æ¬¡äº‹åŠ¡æäº¤åˆ·ç›˜ (æœ€å®‰å…¨,æ¨è)</span>
                                     <span class="hljs-comment"># 2: æ¯æ¬¡æäº¤å†™OSç¼“å­˜,æ¯ç§’åˆ·ç›˜ (æŠ˜ä¸­)</span>
</code></pre>
<p><strong>2. Binlogé…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">sync_binlog=1                        <span class="hljs-comment"># æ¯æ¬¡äº‹åŠ¡æäº¤åˆ·ç›˜(æœ€å®‰å…¨)</span>
binlog_format=ROW                    <span class="hljs-comment"># ROWæ¨¡å¼(æ¨è),è®°å½•è¡Œå˜æ›´</span>
expire_logs_days=7                   <span class="hljs-comment"># Binlogä¿ç•™7å¤©</span>
</code></pre>
<h3 data-id="heading-34">7.5 æ€»ç»“</h3>
<p><strong>MySQLæ¶æ„æ ¸å¿ƒè¦ç‚¹</strong>:</p>
<ol>
<li><strong>é€»è¾‘æ¶æ„åˆ†ä¸º3å±‚</strong>: è¿æ¥å±‚ã€SQLå±‚(Serverå±‚)ã€å­˜å‚¨å¼•æ“å±‚,Serverå±‚ä¸å­˜å‚¨å¼•æ“è§£è€¦</li>
<li><strong>InnoDBæ˜¯é»˜è®¤å¼•æ“</strong>: æ”¯æŒäº‹åŠ¡ã€è¡Œçº§é”ã€å¤–é”®ã€å´©æºƒæ¢å¤ã€MVCC,ç”Ÿäº§ç¯å¢ƒé¦–é€‰</li>
<li><strong>Buffer Poolæ˜¯æ€§èƒ½æ ¸å¿ƒ</strong>: ç¼“å­˜æ•°æ®é¡µå’Œç´¢å¼•é¡µ,å‡å°‘ç£ç›˜I/O,æ”¹è¿›çš„LRUç®—æ³•é˜²æ­¢ç¼“å­˜æ±¡æŸ“</li>
<li><strong>B+æ ‘ç´¢å¼•ç»“æ„</strong>: 3å±‚B+æ ‘èƒ½å­˜2000ä¸‡è¡Œ,æŸ¥è¯¢åªéœ€3æ¬¡I/O,èŒƒå›´æŸ¥è¯¢é«˜æ•ˆ</li>
<li><strong>WALæœºåˆ¶</strong>: å…ˆå†™æ—¥å¿—(Redo Log/Binlog),å†å¼‚æ­¥åˆ·è„é¡µ,å†™å…¥æ€§èƒ½æå‡10-100å€</li>
<li><strong>2PCä¸¤é˜¶æ®µæäº¤</strong>: ä¿è¯Redo Logå’ŒBinlogä¸€è‡´æ€§,é¿å…ä¸»ä»æ•°æ®ä¸ä¸€è‡´</li>
<li><strong>EXPLAINæ˜¯SQLä¼˜åŒ–ç¬¬ä¸€æ­¥</strong>: åˆ†ææ‰§è¡Œè®¡åˆ’,å®šä½æ€§èƒ½ç“¶é¢ˆ,typeè¾¾åˆ°refä»¥ä¸Š,é¿å…å…¨è¡¨æ‰«æå’ŒUsing filesort</li>
</ol>
<p><strong>æ€§èƒ½ä¼˜åŒ–å»ºè®®</strong>:</p>
<ul>
<li><strong>åˆç†è®¾è®¡ç´¢å¼•</strong>: é«˜é€‰æ‹©æ€§å­—æ®µä¼˜å…ˆ,éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™,ä½¿ç”¨è¦†ç›–ç´¢å¼•é¿å…å›è¡¨</li>
<li><strong>é¿å…ç´¢å¼•å¤±æ•ˆ</strong>: ä¸åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°,é¿å…éšå¼ç±»å‹è½¬æ¢,LIKEé¿å…å‰ç¼€é€šé…ç¬¦</li>
<li><strong>åˆç†é…ç½®Buffer Pool</strong>: è®¾ç½®ä¸ºç‰©ç†å†…å­˜çš„50-80%,ç›‘æ§å‘½ä¸­ç‡â‰¥99%</li>
<li><strong>ä½¿ç”¨EXPLAINåˆ†ææ¯æ¡SQL</strong>: ä¸Šçº¿å‰å¿…é¡»EXPLAIN,ç¡®ä¿typeè¾¾åˆ°refä»¥ä¸Š</li>
<li><strong>å®šæœŸReviewæ…¢æŸ¥è¯¢æ—¥å¿—</strong>: å‘ç°æ€§èƒ½ç“¶é¢ˆ,åŠæ—¶ä¼˜åŒ–</li>
</ul>
<p>æŒæ¡MySQLæ¶æ„åŸç†ä¸æ‰§è¡Œæµç¨‹,æ˜¯æ¯ä½åç«¯å·¥ç¨‹å¸ˆçš„å¿…å¤‡æŠ€èƒ½ã€‚é€šè¿‡æ·±å…¥ç†è§£MySQLçš„å†…éƒ¨è¿è¡Œæœºåˆ¶,ç»“åˆEXPLAINæ‰§è¡Œè®¡åˆ’åˆ†æå’Œæ…¢æŸ¥è¯¢ä¼˜åŒ–å®æˆ˜,èƒ½å¤Ÿåœ¨é¢è¯•å’Œå®é™…å·¥ä½œä¸­æ¸¸åˆƒæœ‰ä½™,æ„å»ºé«˜æ€§èƒ½ã€é«˜å¯ç”¨çš„æ•°æ®åº“ç³»ç»Ÿã€‚</p>
<hr/>
<p><strong>å‚è€ƒèµ„æ–™</strong>:</p>
<ul>
<li>ã€ŠMySQLæŠ€æœ¯å†…å¹•: InnoDBå­˜å‚¨å¼•æ“ã€‹(ç¬¬2ç‰ˆ) - å§œæ‰¿å°§</li>
<li>ã€Šé«˜æ€§èƒ½MySQLã€‹(ç¬¬4ç‰ˆ) - Baron Schwartzç­‰</li>
<li>MySQLå®˜æ–¹æ–‡æ¡£: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2F" target="_blank" title="https://dev.mysql.com/doc/" ref="nofollow noopener noreferrer">dev.mysql.com/doc/</a></li>
<li>InnoDBå­˜å‚¨å¼•æ“å®˜æ–¹æ–‡æ¡£: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysql.com%2Fdoc%2Frefman%2F8.0%2Fen%2Finnodb-storage-engine.html" target="_blank" title="https://dev.mysql.com/doc/refman/8.0/en/innodb-storage-engine.html" ref="nofollow noopener noreferrer">dev.mysql.com/doc/refman/â€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Javaå¤šçº¿ç¨‹å¼€å‘å®æˆ˜ï¼šè§£é”çº¿ç¨‹å®‰å…¨ä¸æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯]]></title>    <link>https://juejin.cn/post/7585706951583842313</link>    <guid>https://juejin.cn/post/7585706951583842313</guid>    <pubDate>2025-12-20T12:00:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585706951583842313" data-draft-id="7585484081435787315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Javaå¤šçº¿ç¨‹å¼€å‘å®æˆ˜ï¼šè§£é”çº¿ç¨‹å®‰å…¨ä¸æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-20T12:00:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="okseekw"/> <meta itemprop="url" content="https://juejin.cn/user/1933379625032649"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Javaå¤šçº¿ç¨‹å¼€å‘å®æˆ˜ï¼šè§£é”çº¿ç¨‹å®‰å…¨ä¸æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1933379625032649/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    okseekw
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T12:00:17.000Z" title="Sat Dec 20 2025 12:00:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Javaå¤šçº¿ç¨‹å¼€å‘å®æˆ˜ï¼šè§£é”çº¿ç¨‹å®‰å…¨ä¸æ€§èƒ½ä¼˜åŒ–çš„å…³é”®æŠ€æœ¯</h2>
<p>åœ¨ç°ä»£Javaå¼€å‘ä¸­ï¼Œå¤šçº¿ç¨‹æ˜¯æå‡ç¨‹åºæ€§èƒ½ã€ä¼˜åŒ–èµ„æºåˆ©ç”¨ç‡çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ã€‚æ— è®ºæ˜¯é«˜å¹¶å‘çš„ç”µå•†ç³»ç»Ÿã€å®æ—¶é€šä¿¡åº”ç”¨ï¼Œè¿˜æ˜¯åå°æ•°æ®å¤„ç†æœåŠ¡ï¼Œéƒ½ç¦»ä¸å¼€å¤šçº¿ç¨‹çš„æ”¯æŒã€‚æœ¬æ–‡å°†ä»çº¿ç¨‹åŸºç¡€æ¦‚å¿µå‡ºå‘ï¼Œé€æ­¥æ·±å…¥çº¿ç¨‹åˆ›å»ºã€å¸¸ç”¨æ–¹æ³•ã€çº¿ç¨‹å®‰å…¨ã€çº¿ç¨‹æ± ç­‰æ ¸å¿ƒæŠ€æœ¯ï¼Œå¹¶é€šè¿‡å®æˆ˜æ¡ˆä¾‹å¸®åŠ©å¤§å®¶æŒæ¡å¤šçº¿ç¨‹çš„å®é™…åº”ç”¨ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€çº¿ç¨‹ä¸å¤šçº¿ç¨‹åŸºç¡€è®¤çŸ¥</h3>
<h4 data-id="heading-2">1. ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ</h4>
<p>çº¿ç¨‹ï¼ˆThreadï¼‰æ˜¯ç¨‹åºå†…éƒ¨çš„ä¸€æ¡æ‰§è¡Œæµç¨‹ï¼Œä¸€ä¸ªç¨‹åºè‹¥åªæœ‰ä¸€æ¡æ‰§è¡Œæµç¨‹ï¼Œåˆ™ä¸ºå•çº¿ç¨‹ç¨‹åºã€‚ä¾‹å¦‚ï¼Œç®€å•çš„æ§åˆ¶å°è¾“å‡ºç¨‹åºé€šå¸¸æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ã€‚</p>
<h4 data-id="heading-3">2. å¤šçº¿ç¨‹çš„å®šä¹‰ä¸åº”ç”¨åœºæ™¯</h4>
<p>å¤šçº¿ç¨‹æ˜¯æŒ‡ä»è½¯ç¡¬ä»¶å±‚é¢å®ç°å¤šæ¡æ‰§è¡Œæµç¨‹çš„æŠ€æœ¯ï¼Œå¤šæ¡çº¿ç¨‹ç”±CPUè°ƒåº¦æ‰§è¡Œã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äº<strong>æé«˜ç¨‹åºæ‰§è¡Œæ•ˆç‡</strong>ï¼Œè®©å¤šä¸ªä»»åŠ¡å¹¶è¡Œå¤„ç†ã€‚</p>
<p><strong>å…¸å‹åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>12306è´­ç¥¨ç³»ç»Ÿï¼šåŒæ—¶å¤„ç†æˆåƒä¸Šä¸‡ç”¨æˆ·çš„æŸ¥è¯¢ã€è´­ç¥¨è¯·æ±‚</li>
<li>ç™¾åº¦ç½‘ç›˜ä¸Šä¼ ä¸‹è½½ï¼šåå°ä¼ è¾“æ–‡ä»¶çš„åŒæ—¶ï¼Œå‰å°å¯è¿›è¡Œå…¶ä»–æ“ä½œ</li>
<li>ç”µå•†å¹³å°ï¼šè®¢å•å¤„ç†ã€åº“å­˜æ›´æ–°ã€æ¶ˆæ¯æ¨é€ç­‰ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ</li>
</ul>
<h4 data-id="heading-4">3. å¹¶å‘ä¸å¹¶è¡Œçš„åŒºåˆ«</h4>
<ul>
<li><strong>å¹¶å‘</strong>ï¼šCPUè½®è¯¢è°ƒåº¦å¤šä¸ªçº¿ç¨‹ï¼Œç”±äºåˆ‡æ¢é€Ÿåº¦æå¿«ï¼Œç»™äºº"åŒæ—¶æ‰§è¡Œ"çš„é”™è§‰ï¼ˆå®é™…åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œï¼‰</li>
<li><strong>å¹¶è¡Œ</strong>ï¼šåŒä¸€æ—¶åˆ»å¤šä¸ªçº¿ç¨‹è¢«CPUåŒæ—¶è°ƒåº¦æ‰§è¡Œï¼ˆéœ€å¤šæ ¸CPUæ”¯æŒï¼‰</li>
</ul>
<h3 data-id="heading-5">äºŒã€Javaå¤šçº¿ç¨‹çš„ä¸‰ç§åˆ›å»ºæ–¹å¼</h3>
<p>Javaæä¾›äº†ä¸‰ç§ä¸»æµçš„çº¿ç¨‹åˆ›å»ºæ–¹å¼ï¼Œå„æœ‰ä¼˜åŠ£ï¼Œé€‚ç”¨äºä¸åŒåœºæ™¯ã€‚</p>
<h4 data-id="heading-6">1. ç»§æ‰¿Threadç±»</h4>
<p>è¿™æ˜¯æœ€åŸºç¡€çš„åˆ›å»ºæ–¹å¼ï¼Œæ­¥éª¤ç®€å•ç›´æ¥ã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>å®šä¹‰å­ç±»ç»§æ‰¿<code>java.lang.Thread</code></li>
<li>é‡å†™<code>run()</code>æ–¹æ³•ï¼Œç¼–å†™çº¿ç¨‹ä»»åŠ¡é€»è¾‘</li>
<li>åˆ›å»ºå­ç±»å¯¹è±¡ï¼Œè°ƒç”¨<code>start()</code>æ–¹æ³•å¯åŠ¨çº¿ç¨‹</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThreadDemo1</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹å¯¹è±¡</span>
        Thread t1 = <span class="hljs-keyword">new</span> MyThread();
        <span class="hljs-comment">// å¯åŠ¨çº¿ç¨‹ï¼ˆå¿…é¡»è°ƒç”¨start()ï¼Œè€Œéç›´æ¥è°ƒç”¨run()ï¼‰</span>
        t1.start();

        <span class="hljs-comment">// ä¸»çº¿ç¨‹ä»»åŠ¡</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ä¸»çº¿ç¨‹è¾“å‡ºï¼š"</span> + i);
        }
    }
}

<span class="hljs-comment">// è‡ªå®šä¹‰çº¿ç¨‹ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">MyThread</span> <span class="hljs-title">extends</span> <span class="hljs-title">Thread</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> {
        <span class="hljs-comment">// å­çº¿ç¨‹ä»»åŠ¡</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å­çº¿ç¨‹è¾“å‡ºï¼š"</span> + i);
        }
    }
}
</code></pre>
<p><strong>ä¼˜ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šç¼–ç ç®€å•ï¼Œå¯ç›´æ¥ä½¿ç”¨Threadç±»çš„æ–¹æ³•</li>
<li>ç¼ºç‚¹ï¼šJavaå•ç»§æ‰¿é™åˆ¶ï¼Œçº¿ç¨‹ç±»æ— æ³•ç»§æ‰¿å…¶ä»–ç±»ï¼Œæ‰©å±•æ€§å·®</li>
</ul>
<h4 data-id="heading-7">2. å®ç°Runnableæ¥å£</h4>
<p>æ¨èä½¿ç”¨çš„åˆ›å»ºæ–¹å¼ï¼Œè§„é¿äº†å•ç»§æ‰¿é™åˆ¶ï¼Œæ‰©å±•æ€§æ›´å¼ºã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>å®šä¹‰ä»»åŠ¡ç±»å®ç°<code>Runnable</code>æ¥å£</li>
<li>é‡å†™<code>run()</code>æ–¹æ³•ï¼Œç¼–å†™ä»»åŠ¡é€»è¾‘</li>
<li>åˆ›å»ºä»»åŠ¡å¯¹è±¡ï¼Œäº¤ç»™Threadå¤„ç†</li>
<li>è°ƒç”¨<code>start()</code>æ–¹æ³•å¯åŠ¨çº¿ç¨‹</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼ˆå«åŒ¿åå†…éƒ¨ç±»ç®€åŒ–å†™æ³•ï¼‰ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThreadDemo2_2</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-comment">// æ–¹å¼1ï¼šå¸¸è§„å†™æ³•</span>
        Runnable r = <span class="hljs-keyword">new</span> Runnable() {
            @Override
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å­çº¿ç¨‹1è¾“å‡ºï¼š"</span> + i);
                }
            }
        };
        <span class="hljs-keyword">new</span> Thread(r).start();

        <span class="hljs-comment">// æ–¹å¼2ï¼šåŒ¿åå†…éƒ¨ç±»ç®€åŒ–</span>
        <span class="hljs-keyword">new</span> Thread(<span class="hljs-keyword">new</span> Runnable() {
            @Override
            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å­çº¿ç¨‹2è¾“å‡ºï¼š"</span> + i);
                }
            }
        }).start();

        <span class="hljs-comment">// æ–¹å¼3ï¼šLambdaè¡¨è¾¾å¼ï¼ˆJDK8+ï¼‰</span>
        <span class="hljs-keyword">new</span> Thread(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
                System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å­çº¿ç¨‹3è¾“å‡ºï¼š"</span> + i);
            }
        }).start();

        <span class="hljs-comment">// ä¸»çº¿ç¨‹ä»»åŠ¡</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ä¸»çº¿ç¨‹è¾“å‡ºï¼š"</span> + i);
        }
    }
}
</code></pre>
<p><strong>ä¼˜ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šä»»åŠ¡ç±»å¯ç»§æ‰¿å…¶ä»–ç±»ã€å®ç°å…¶ä»–æ¥å£ï¼Œæ‰©å±•æ€§å¼º</li>
<li>ç¼ºç‚¹ï¼šæ— æ³•ç›´æ¥è¿”å›çº¿ç¨‹æ‰§è¡Œç»“æœ</li>
</ul>
<h4 data-id="heading-8">3. å®ç°Callableæ¥å£ï¼ˆJDK5+ï¼‰</h4>
<p>è§£å†³äº†å‰ä¸¤ç§æ–¹å¼æ— æ³•è¿”å›æ‰§è¡Œç»“æœçš„é—®é¢˜ï¼Œé€‚ç”¨äºéœ€è¦è·å–çº¿ç¨‹æ‰§è¡Œç»“æœçš„åœºæ™¯ã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>å®šä¹‰ä»»åŠ¡ç±»å®ç°<code>Callable</code>æ¥å£ï¼ŒæŒ‡å®šè¿”å›å€¼ç±»å‹</li>
<li>é‡å†™<code>call()</code>æ–¹æ³•ï¼ˆå¯æŠ›å‡ºå¼‚å¸¸ï¼‰ï¼Œç¼–å†™ä»»åŠ¡é€»è¾‘å¹¶è¿”å›ç»“æœ</li>
<li>å°†Callableå¯¹è±¡å°è£…ä¸º<code>FutureTask</code>ï¼ˆå…¼å…·Runnableå’Œç»“æœè·å–åŠŸèƒ½ï¼‰</li>
<li>äº¤ç»™Threadå¤„ç†å¹¶å¯åŠ¨çº¿ç¨‹</li>
<li>é€šè¿‡<code>FutureTask.get()</code>æ–¹æ³•è·å–æ‰§è¡Œç»“æœ</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.Callable;
<span class="hljs-keyword">import</span> java.util.concurrent.FutureTask;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadDemo3</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// åˆ›å»ºCallableä»»åŠ¡å¯¹è±¡</span>
        Callable&lt;String&gt; c1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCallable</span>(<span class="hljs-number">100</span>);
        Callable&lt;String&gt; c2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCallable</span>(<span class="hljs-number">50</span>);

        <span class="hljs-comment">// å°è£…ä¸ºFutureTask</span>
        FutureTask&lt;String&gt; f1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(c1);
        FutureTask&lt;String&gt; f2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;&gt;(c2);

        <span class="hljs-comment">// å¯åŠ¨çº¿ç¨‹</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(f1).start();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(f2).start();

        <span class="hljs-comment">// è·å–æ‰§è¡Œç»“æœï¼ˆä¸»çº¿ç¨‹ä¼šé˜»å¡ç›´åˆ°ç»“æœè¿”å›ï¼‰</span>
        System.out.println(f1.get());
        System.out.println(f2.get());
    }
}

<span class="hljs-comment">// è‡ªå®šä¹‰Callableä»»åŠ¡ç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCallable</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Callable</span>&lt;String&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> n;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyCallable</span><span class="hljs-params">(<span class="hljs-type">int</span> n)</span> {
        <span class="hljs-built_in">this</span>.n = n;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">call</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">int</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= n; i++) {
            sum += i;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">"1-"</span> + n + <span class="hljs-string">"çš„å’Œæ˜¯ï¼š"</span> + sum;
    }
}
</code></pre>
<p><strong>ä¼˜ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>ä¼˜ç‚¹ï¼šæ‰©å±•æ€§å¼ºï¼Œå¯è·å–çº¿ç¨‹æ‰§è¡Œç»“æœ</li>
<li>ç¼ºç‚¹ï¼šç¼–ç ç›¸å¯¹å¤æ‚ï¼Œè·å–ç»“æœæ—¶å¯èƒ½é˜»å¡</li>
</ul>
<h3 data-id="heading-9">ä¸‰ã€çº¿ç¨‹å¸¸ç”¨æ ¸å¿ƒæ–¹æ³•</h3>

































<table><thead><tr><th>æ–¹æ³•å</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td><code>start()</code></td><td>å¯åŠ¨çº¿ç¨‹ï¼ŒJVMè°ƒç”¨<code>run()</code>æ–¹æ³•</td></tr><tr><td><code>run()</code></td><td>çº¿ç¨‹ä»»åŠ¡é€»è¾‘æ‰€åœ¨ï¼Œä¸å¯ç›´æ¥è°ƒç”¨</td></tr><tr><td><code>getName()</code>/<code>setName()</code></td><td>è·å–/è®¾ç½®çº¿ç¨‹åç§°</td></tr><tr><td><code>currentThread()</code></td><td>è·å–å½“å‰æ‰§è¡Œçš„çº¿ç¨‹å¯¹è±¡</td></tr><tr><td><code>sleep(long millis)</code></td><td>è®©å½“å‰çº¿ç¨‹ä¼‘çœ æŒ‡å®šæ¯«ç§’æ•°</td></tr><tr><td><code>join()</code></td><td>è®©è°ƒç”¨çº¿ç¨‹å…ˆæ‰§è¡Œå®Œæ¯•ï¼Œå…¶ä»–çº¿ç¨‹å†ç»§ç»­</td></tr></tbody></table>
<p><strong>å…³é”®æ–¹æ³•ç¤ºä¾‹</strong>ï¼š</p>
<ol>
<li><strong>çº¿ç¨‹ä¼‘çœ ï¼ˆsleepï¼‰</strong> ï¼š</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThreadApiDemo2</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"mainçº¿ç¨‹è¾“å‡ºï¼š"</span> + i);
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// ä¼‘çœ 1ç§’</span>
                Thread.sleep(<span class="hljs-number">1000</span>);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}
</code></pre>
<ol start="2">
<li><strong>çº¿ç¨‹æ’é˜Ÿï¼ˆjoinï¼‰</strong> ï¼š</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThreadApiDemo3</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>) throws InterruptedException</span> {
        MyThread2 t1 = <span class="hljs-keyword">new</span> MyThread2();
        t1.start();

        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ä¸»çº¿ç¨‹è¾“å‡ºï¼š"</span> + i);
            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">3</span>) {
                <span class="hljs-comment">// è®©t1çº¿ç¨‹æ’é˜Ÿï¼Œæ‰§è¡Œå®Œæ¯•åä¸»çº¿ç¨‹å†ç»§ç»­</span>
                t1.<span class="hljs-keyword">join</span>();
            }
        }
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title">MyThread2</span> <span class="hljs-title">extends</span> <span class="hljs-title">Thread</span> {
    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) {
            System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"å­çº¿ç¨‹è¾“å‡ºï¼š"</span> + i);
        }
    }
}
</code></pre>
<h3 data-id="heading-10">å››ã€çº¿ç¨‹å®‰å…¨é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-11">1. çº¿ç¨‹å®‰å…¨é—®é¢˜çš„äº§ç”Ÿæ¡ä»¶</h4>
<p>å½“æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶æ—¶ï¼Œä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼š</p>
<ul>
<li>å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ</li>
<li>çº¿ç¨‹å…±äº«åŒä¸€ä¸ªèµ„æº</li>
<li>çº¿ç¨‹å¯¹å…±äº«èµ„æºè¿›è¡Œä¿®æ”¹æ“ä½œ</li>
</ul>
<p><strong>æ¨¡æ‹Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜</strong>ï¼ˆé“¶è¡Œå–æ¬¾æ¡ˆä¾‹ï¼‰ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// è´¦æˆ·ç±»ï¼ˆå…±äº«èµ„æºï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> cardId;
    <span class="hljs-keyword">private</span> double money;

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">drawMoney</span>(<span class="hljs-params">double money</span>) {
        <span class="hljs-title class_">String</span> name = <span class="hljs-title class_">Thread</span>.<span class="hljs-title function_">currentThread</span>().<span class="hljs-title function_">getName</span>();
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">money</span> &gt;= money) {
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(name + <span class="hljs-string">"å–é’±æˆåŠŸï¼Œåå‡º"</span> + money + <span class="hljs-string">"å…ƒ"</span>);
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">money</span> -= money;
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"ä½™é¢ï¼š"</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">money</span> + <span class="hljs-string">"å…ƒ"</span>);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(name + <span class="hljs-string">"å–é’±å¤±è´¥ï¼Œä½™é¢ä¸è¶³"</span>);
        }
    }
}

<span class="hljs-comment">// å–æ¬¾çº¿ç¨‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DrawThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Thread</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Account</span> account;

    <span class="hljs-keyword">public</span> <span class="hljs-title class_">DrawThread</span>(<span class="hljs-title class_">String</span> name, <span class="hljs-title class_">Account</span> account) {
        <span class="hljs-variable language_">super</span>(name);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">account</span> = account;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">run</span>(<span class="hljs-params"/>) {
        account.<span class="hljs-title function_">drawMoney</span>(<span class="hljs-number">100000</span>);
    }
}

<span class="hljs-comment">// æµ‹è¯•ç±»</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadDemo1</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-comment">// åŒä¸€ä¸ªè´¦æˆ·ï¼Œåˆå§‹ä½™é¢10ä¸‡</span>
        <span class="hljs-title class_">Account</span> account = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Account</span>(<span class="hljs-string">"ICBC-110"</span>, <span class="hljs-number">100000</span>);
        <span class="hljs-comment">// ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å–æ¬¾10ä¸‡</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">DrawThread</span>(<span class="hljs-string">"å°æ˜"</span>, account).<span class="hljs-title function_">start</span>();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">DrawThread</span>(<span class="hljs-string">"å°çº¢"</span>, account).<span class="hljs-title function_">start</span>();
    }
}
</code></pre>
<p><strong>é—®é¢˜ç°è±¡</strong>ï¼šå¯èƒ½å‡ºç°å°æ˜å’Œå°çº¢åŒæ—¶å–æ¬¾æˆåŠŸï¼Œä½™é¢å˜ä¸ºè´Ÿæ•°çš„æƒ…å†µã€‚</p>
<h4 data-id="heading-12">2. çº¿ç¨‹åŒæ­¥è§£å†³æ–¹æ¡ˆ</h4>
<p>æ ¸å¿ƒæ€æƒ³ï¼šè®©å¤šä¸ªçº¿ç¨‹<strong>å…ˆåä¾æ¬¡è®¿é—®</strong>å…±äº«èµ„æºï¼Œé¿å…å¹¶å‘ä¿®æ”¹ã€‚</p>
<h5 data-id="heading-13">ï¼ˆ1ï¼‰åŒæ­¥ä»£ç å—</h5>
<p>å°†è®¿é—®å…±äº«èµ„æºçš„æ ¸å¿ƒä»£ç ä¸Šé”ï¼Œæ¯æ¬¡åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è¿›å…¥æ‰§è¡Œã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">synchronized</span> (é”å¯¹è±¡) {
    <span class="hljs-comment">// è®¿é—®å…±äº«èµ„æºçš„æ ¸å¿ƒä»£ç </span>
}
</code></pre>
<p><strong>ä¼˜åŒ–åçš„è´¦æˆ·ç±»</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> {
    <span class="hljs-keyword">private</span> String cardId;
    <span class="hljs-keyword">private</span> double money;

    <span class="hljs-keyword">public</span> void drawMoney(double money) {
        String name = Thread.currentThread().getName();
        <span class="hljs-comment">// é”å¯¹è±¡ï¼šæ¨èä½¿ç”¨å…±äº«èµ„æºæœ¬èº«ï¼ˆthisï¼‰</span>
        synchronized (<span class="hljs-keyword">this</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.money &gt;= money) {
                System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"å–é’±æˆåŠŸï¼Œåå‡º"</span> + money + <span class="hljs-string">"å…ƒ"</span>);
                <span class="hljs-keyword">this</span>.money -= money;
                System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ä½™é¢ï¼š"</span> + <span class="hljs-keyword">this</span>.money + <span class="hljs-string">"å…ƒ"</span>);
            } <span class="hljs-keyword">else</span> {
                System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"å–é’±å¤±è´¥ï¼Œä½™é¢ä¸è¶³"</span>);
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-14">ï¼ˆ2ï¼‰åŒæ­¥æ–¹æ³•</h5>
<p>å°†æ•´ä¸ªæ–¹æ³•ä¸Šé”ï¼Œç®€åŒ–åŒæ­¥ä»£ç å—çš„å†™æ³•ã€‚</p>
<p><strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">ä¿®é¥°ç¬¦ <span class="hljs-keyword">synchronized</span> è¿”å›å€¼ç±»å‹ æ–¹æ³•å(å‚æ•°åˆ—è¡¨) {
    <span class="hljs-comment">// æ“ä½œå…±äº«èµ„æºçš„ä»£ç </span>
}
</code></pre>
<p><strong>ä¼˜åŒ–åçš„å–æ¬¾æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> synchronized <span class="hljs-keyword">void</span> <span class="hljs-title">drawMoney</span>(<span class="hljs-params"><span class="hljs-built_in">double</span> money</span>)</span> {
    String name = Thread.currentThread().getName();
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.money &gt;= money) {
        System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"å–é’±æˆåŠŸï¼Œåå‡º"</span> + money + <span class="hljs-string">"å…ƒ"</span>);
        <span class="hljs-keyword">this</span>.money -= money;
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"ä½™é¢ï¼š"</span> + <span class="hljs-keyword">this</span>.money + <span class="hljs-string">"å…ƒ"</span>);
    } <span class="hljs-keyword">else</span> {
        System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"å–é’±å¤±è´¥ï¼Œä½™é¢ä¸è¶³"</span>);
    }
}
</code></pre>
<p><strong>åº•å±‚åŸç†</strong>ï¼š</p>
<ul>
<li>å®ä¾‹æ–¹æ³•ï¼šé»˜è®¤ä½¿ç”¨<code>this</code>ä½œä¸ºé”å¯¹è±¡</li>
<li>é™æ€æ–¹æ³•ï¼šé»˜è®¤ä½¿ç”¨<code>ç±»å.class</code>ä½œä¸ºé”å¯¹è±¡</li>
</ul>
<h5 data-id="heading-15">ï¼ˆ3ï¼‰Locké”ï¼ˆJDK5+ï¼‰</h5>
<p><code>java.util.concurrent.locks.Lock</code>æ¥å£æä¾›äº†æ›´çµæ´»çš„é”å®šæ“ä½œï¼Œæ¨èä½¿ç”¨å…¶å®ç°ç±»<code>ReentrantLock</code>ã€‚</p>
<p><strong>æ ¸å¿ƒæ–¹æ³•</strong>ï¼š</p>
<ul>
<li><code>lock()</code>ï¼šè·å–é”</li>
<li><code>unlock()</code>ï¼šé‡Šæ”¾é”ï¼ˆå»ºè®®åœ¨<code>finally</code>ä¸­æ‰§è¡Œï¼Œç¡®ä¿é”ä¸€å®šé‡Šæ”¾ï¼‰</li>
</ul>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.locks.Lock;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Account</span> {
    <span class="hljs-keyword">private</span> String cardId;
    <span class="hljs-keyword">private</span> <span class="hljs-type">double</span> money;
    <span class="hljs-comment">// åˆ›å»ºLocké”å¯¹è±¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Lock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">drawMoney</span><span class="hljs-params">(<span class="hljs-type">double</span> money)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> Thread.currentThread().getName();
        lock.lock(); <span class="hljs-comment">// åŠ é”</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.money &gt;= money) {
                System.out.println(name + <span class="hljs-string">"å–é’±æˆåŠŸï¼Œåå‡º"</span> + money + <span class="hljs-string">"å…ƒ"</span>);
                <span class="hljs-built_in">this</span>.money -= money;
                System.out.println(<span class="hljs-string">"ä½™é¢ï¼š"</span> + <span class="hljs-built_in">this</span>.money + <span class="hljs-string">"å…ƒ"</span>);
            } <span class="hljs-keyword">else</span> {
                System.out.println(name + <span class="hljs-string">"å–é’±å¤±è´¥ï¼Œä½™é¢ä¸è¶³"</span>);
            }
        } <span class="hljs-keyword">finally</span> {
            lock.unlock(); <span class="hljs-comment">// é‡Šæ”¾é”ï¼ˆæ— è®ºæ˜¯å¦å¼‚å¸¸ï¼Œéƒ½å¿…é¡»é‡Šæ”¾ï¼‰</span>
        }
    }
}
</code></pre>
<h3 data-id="heading-16">äº”ã€çº¿ç¨‹æ± æŠ€æœ¯ï¼ˆJDK5+ï¼‰</h3>
<h4 data-id="heading-17">1. çº¿ç¨‹æ± çš„æ ¸å¿ƒä»·å€¼</h4>
<ul>
<li>é¿å…é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„å¼€é”€ï¼ˆçº¿ç¨‹åˆ›å»ºæˆæœ¬é«˜ï¼‰</li>
<li>æ§åˆ¶çº¿ç¨‹æ•°é‡ï¼Œé˜²æ­¢çº¿ç¨‹è¿‡å¤šå¯¼è‡´ç³»ç»Ÿèµ„æºè€—å°½</li>
<li>å¤ç”¨çº¿ç¨‹ï¼Œæé«˜ç¨‹åºå“åº”é€Ÿåº¦</li>
</ul>
<h4 data-id="heading-18">2. çº¿ç¨‹æ± çš„åˆ›å»ºæ–¹å¼</h4>
<h5 data-id="heading-19">ï¼ˆ1ï¼‰é€šè¿‡ThreadPoolExecutoræ‰‹åŠ¨åˆ›å»ºï¼ˆæ¨èï¼‰</h5>
<p><code>ThreadPoolExecutor</code>æ˜¯çº¿ç¨‹æ± çš„æ ¸å¿ƒå®ç°ç±»ï¼Œå¯çµæ´»é…ç½®å‚æ•°ã€‚</p>
<p><strong>æ„é€ å™¨å‚æ•°è¯´æ˜</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ThreadPoolExecutor</span><span class="hljs-params">(
    <span class="hljs-type">int</span> corePoolSize, <span class="hljs-comment">// æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆå¸¸é©»çº¿ç¨‹ï¼‰</span>
    <span class="hljs-type">int</span> maximumPoolSize, <span class="hljs-comment">// æœ€å¤§çº¿ç¨‹æ•°ï¼ˆæ ¸å¿ƒ+ä¸´æ—¶çº¿ç¨‹ï¼‰</span>
    <span class="hljs-type">long</span> keepAliveTime, <span class="hljs-comment">// ä¸´æ—¶çº¿ç¨‹ç©ºé—²æ—¶é—´</span>
    TimeUnit unit, <span class="hljs-comment">// æ—¶é—´å•ä½</span>
    BlockingQueue&lt;Runnable&gt; workQueue, <span class="hljs-comment">// ä»»åŠ¡é˜Ÿåˆ—</span>
    ThreadFactory threadFactory, <span class="hljs-comment">// çº¿ç¨‹å·¥å‚ï¼ˆåˆ›å»ºçº¿ç¨‹ï¼‰</span>
    RejectedExecutionHandler handler <span class="hljs-comment">// ä»»åŠ¡æ‹’ç»ç­–ç•¥</span>
)</span>
</span></code></pre>
<p><strong>ä»»åŠ¡æ‹’ç»ç­–ç•¥</strong>ï¼š</p>

























<table><thead><tr><th>ç­–ç•¥</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>AbortPolicy</td><td>ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºå¼‚å¸¸ï¼ˆé»˜è®¤ï¼‰</td></tr><tr><td>DiscardPolicy</td><td>ä¸¢å¼ƒä»»åŠ¡ï¼Œä¸æŠ›å‡ºå¼‚å¸¸</td></tr><tr><td>DiscardOldestPolicy</td><td>ä¸¢å¼ƒé˜Ÿåˆ—ä¸­æœ€ä¹…çš„ä»»åŠ¡ï¼ŒåŠ å…¥æ–°ä»»åŠ¡</td></tr><tr><td>CallerRunsPolicy</td><td>ç”±æäº¤ä»»åŠ¡çš„çº¿ç¨‹ï¼ˆå¦‚ä¸»çº¿ç¨‹ï¼‰ç›´æ¥æ‰§è¡Œ</td></tr></tbody></table>
<p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.*;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExecutorServiceDemo1</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// åˆ›å»ºçº¿ç¨‹æ± </span>
        <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(
            <span class="hljs-number">3</span>, <span class="hljs-comment">// æ ¸å¿ƒçº¿ç¨‹æ•°3</span>
            <span class="hljs-number">5</span>, <span class="hljs-comment">// æœ€å¤§çº¿ç¨‹æ•°5</span>
            <span class="hljs-number">10</span>, <span class="hljs-comment">// ä¸´æ—¶çº¿ç¨‹ç©ºé—²10ç§’åé”€æ¯</span>
            TimeUnit.SECONDS,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">3</span>), <span class="hljs-comment">// ä»»åŠ¡é˜Ÿåˆ—å®¹é‡3</span>
            Executors.defaultThreadFactory(),
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.DiscardOldestPolicy() <span class="hljs-comment">// æ‹’ç»ç­–ç•¥</span>
        );

        <span class="hljs-comment">// æäº¤ä»»åŠ¡ï¼ˆRunnableï¼‰</span>
        <span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRunnable</span>();
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">9</span>; i++) {
            pool.execute(task);
        }

        <span class="hljs-comment">// å…³é—­çº¿ç¨‹æ± ï¼ˆä¸€èˆ¬ä¸ä¸»åŠ¨å…³é—­ï¼Œé™¤éç¨‹åºç»“æŸï¼‰</span>
        <span class="hljs-comment">// pool.shutdown(); // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åå…³é—­</span>
    }
}
</code></pre>
<h5 data-id="heading-20">ï¼ˆ2ï¼‰é€šè¿‡Executorså·¥å…·ç±»åˆ›å»ºï¼ˆä¸æ¨èåœ¨å¤§å‹ç³»ç»Ÿä¸­ä½¿ç”¨ï¼‰</h5>
<p>Executorsæä¾›äº†ç®€åŒ–çš„çº¿ç¨‹æ± åˆ›å»ºæ–¹æ³•ï¼Œä½†å­˜åœ¨èµ„æºè€—å°½é£é™©ï¼š</p>
<ul>
<li><code>newFixedThreadPool(int n)</code>ï¼šå›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± </li>
<li><code>newSingleThreadExecutor()</code>ï¼šå•çº¿ç¨‹çº¿ç¨‹æ± </li>
<li><code>newCachedThreadPool()</code>ï¼šç¼“å­˜çº¿ç¨‹æ± ï¼ˆçº¿ç¨‹æ•°å¯æ— é™å¢é•¿ï¼‰</li>
<li><code>newScheduledThreadPool(int corePoolSize)</code>ï¼šå®šæ—¶ä»»åŠ¡çº¿ç¨‹æ± </li>
</ul>
<p><strong>é£é™©è¯´æ˜</strong>ï¼ˆé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œï¼‰ï¼š</p>
<ul>
<li><code>FixedThreadPool</code>å’Œ<code>SingleThreadExecutor</code>ï¼šä»»åŠ¡é˜Ÿåˆ—é•¿åº¦ä¸º<code>Integer.MAX_VALUE</code>ï¼Œå¯èƒ½å †ç§¯å¤§é‡ä»»åŠ¡å¯¼è‡´OOM</li>
<li><code>CachedThreadPool</code>å’Œ<code>ScheduledThreadPool</code>ï¼šæœ€å¤§çº¿ç¨‹æ•°ä¸º<code>Integer.MAX_VALUE</code>ï¼Œå¯èƒ½åˆ›å»ºå¤§é‡çº¿ç¨‹å¯¼è‡´OOM</li>
</ul>
<h3 data-id="heading-21">å…­ã€å®æˆ˜æ¡ˆä¾‹ï¼šçº¢åŒ…é›¨æ¸¸æˆ</h3>
<h4 data-id="heading-22">éœ€æ±‚è¯´æ˜</h4>
<ul>
<li>100åå‘˜å·¥ï¼ˆ100ä¸ªçº¿ç¨‹ï¼‰æŠ¢200ä¸ªçº¢åŒ…</li>
<li>å°çº¢åŒ…ï¼ˆ1-30å…ƒï¼‰å 80%ï¼ˆ160ä¸ªï¼‰ï¼Œå¤§çº¢åŒ…ï¼ˆ31-100å…ƒï¼‰å 20%ï¼ˆ40ä¸ªï¼‰</li>
<li>è¾“å‡ºæŠ¢çº¢åŒ…è¿‡ç¨‹ï¼Œæ´»åŠ¨ç»“æŸåæŒ‰å‘˜å·¥æŠ¢åˆ°çš„æ€»é‡‘é¢é™åºæ’åº</li>
</ul>
<h4 data-id="heading-23">æ ¸å¿ƒæ€è·¯</h4>
<ol>
<li>ç”Ÿæˆç¬¦åˆè¦æ±‚çš„çº¢åŒ…é›†åˆï¼ˆçº¿ç¨‹å…±äº«èµ„æºï¼‰</li>
<li>100ä¸ªçº¿ç¨‹å¹¶å‘æŠ¢çº¢åŒ…ï¼Œé€šè¿‡åŒæ­¥æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨</li>
<li>ç»Ÿè®¡æ¯ä¸ªå‘˜å·¥æŠ¢åˆ°çš„æ€»é‡‘é¢ï¼Œæ’åºåå±•ç¤º</li>
</ol>
<h4 data-id="heading-24">å®Œæ•´ä»£ç </h4>
<pre><code class="hljs language-csharp" lang="csharp">import java.util.*;

<span class="hljs-comment">// çº¢åŒ…æŠ¢å¤ºçº¿ç¨‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title">PeopleGetRedPacket</span> <span class="hljs-title">extends</span> <span class="hljs-title">Thread</span> {
    <span class="hljs-keyword">private</span> List&lt;Integer&gt; redPackets;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Map&lt;String, Integer&gt; totalMoneyMap = <span class="hljs-keyword">new</span> HashMap&lt;&gt;(); <span class="hljs-comment">// ç»Ÿè®¡æ€»é‡‘é¢</span>

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">PeopleGetRedPacket</span>(<span class="hljs-params">List&lt;Integer&gt; redPackets, String name</span>)</span> {
        super(name);
        <span class="hljs-keyword">this</span>.redPackets = redPackets;
        totalMoneyMap.put(name, <span class="hljs-number">0</span>); <span class="hljs-comment">// åˆå§‹åŒ–æ€»é‡‘é¢ä¸º0</span>
    }

    @Override
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">run</span>()</span> {
        String name = Thread.currentThread().getName();
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            synchronized (redPackets) {
                <span class="hljs-keyword">if</span> (redPackets.isEmpty()) {
                    <span class="hljs-keyword">break</span>;
                }
                <span class="hljs-comment">// éšæœºæŠ¢å¤ºä¸€ä¸ªçº¢åŒ…</span>
                <span class="hljs-built_in">int</span> index = <span class="hljs-keyword">new</span> Random().nextInt(redPackets.size());
                Integer money = redPackets.<span class="hljs-keyword">remove</span>(index);
                System.<span class="hljs-keyword">out</span>.println(name + <span class="hljs-string">"æŠ¢åˆ°çº¢åŒ…ï¼š"</span> + money + <span class="hljs-string">"å…ƒ"</span>);
                <span class="hljs-comment">// æ›´æ–°æ€»é‡‘é¢</span>
                totalMoneyMap.put(name, totalMoneyMap.<span class="hljs-keyword">get</span>(name) + money);
                <span class="hljs-keyword">if</span> (redPackets.isEmpty()) {
                    System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"\nçº¢åŒ…é›¨ç»“æŸï¼"</span>);
                    <span class="hljs-comment">// æ’åºå¹¶å±•ç¤ºç»“æœ</span>
                    showResult();
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
    }

    <span class="hljs-comment">// å±•ç¤ºæŠ¢çº¢åŒ…ç»“æœï¼ˆæŒ‰æ€»é‡‘é¢é™åºï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">showResult</span>()</span> {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"=== æŠ¢çº¢åŒ…ç»“æœæ’å ==="</span>);
        <span class="hljs-comment">// å°†mapè½¬æ¢ä¸ºlistå¹¶æ’åº</span>
        List&lt;Map.Entry&lt;String, Integer&gt;&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;(totalMoneyMap.entrySet());
        list.sort((o1, o2) -&gt; o2.getValue() - o1.getValue());

        <span class="hljs-comment">// è¾“å‡ºæ’å</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; list.size(); i++) {
            Map.Entry&lt;String, Integer&gt; entry = list.<span class="hljs-keyword">get</span>(i);
            System.<span class="hljs-keyword">out</span>.println((i + <span class="hljs-number">1</span>) + <span class="hljs-string">"ã€"</span> + entry.getKey() + <span class="hljs-string">" æ€»é‡‘é¢ï¼š"</span> + entry.getValue() + <span class="hljs-string">"å…ƒ"</span>);
        }
    }
}

<span class="hljs-comment">// æµ‹è¯•ç±»</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ThreadTest</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(<span class="hljs-params">String[] args</span>)</span> {
        <span class="hljs-comment">// ç”Ÿæˆ200ä¸ªçº¢åŒ…</span>
        List&lt;Integer&gt; redPackets = getRedPackets();
        <span class="hljs-comment">// åˆ›å»º100ä¸ªå‘˜å·¥çº¿ç¨‹æŠ¢çº¢åŒ…</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">100</span>; i++) {
            <span class="hljs-keyword">new</span> PeopleGetRedPacket(redPackets, <span class="hljs-string">"å‘˜å·¥"</span> + i).start();
        }
    }

    <span class="hljs-comment">// ç”Ÿæˆçº¢åŒ…ï¼š160ä¸ªå°çº¢åŒ…ï¼Œ40ä¸ªå¤§çº¢åŒ…</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> List&lt;Integer&gt; <span class="hljs-title">getRedPackets</span>()</span> {
        List&lt;Integer&gt; redPackets = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();
        Random random = <span class="hljs-keyword">new</span> Random();
        <span class="hljs-comment">// å°çº¢åŒ…ï¼ˆ1-30å…ƒï¼‰</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">160</span>; i++) {
            redPackets.<span class="hljs-keyword">add</span>(random.nextInt(<span class="hljs-number">30</span>) + <span class="hljs-number">1</span>);
        }
        <span class="hljs-comment">// å¤§çº¢åŒ…ï¼ˆ31-100å…ƒï¼‰</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">40</span>; i++) {
            redPackets.<span class="hljs-keyword">add</span>(random.nextInt(<span class="hljs-number">70</span>) + <span class="hljs-number">31</span>);
        }
        <span class="hljs-keyword">return</span> redPackets;
    }
}
</code></pre>
<h3 data-id="heading-25">ä¸ƒã€æ€»ç»“</h3>
<p>Javaå¤šçº¿ç¨‹æŠ€æœ¯æ˜¯ä¸€æŠŠ"åŒåˆƒå‰‘"ï¼šåˆç†ä½¿ç”¨èƒ½å¤§å¹…æå‡ç¨‹åºæ€§èƒ½ï¼Œä½†å¦‚æœå¤„ç†ä¸å½“ï¼ˆå¦‚çº¿ç¨‹å®‰å…¨é—®é¢˜ã€èµ„æºè€—å°½ï¼‰ï¼Œä¼šå¯¼è‡´ç¨‹åºå¼‚å¸¸ç”šè‡³å´©æºƒã€‚</p>
<p><strong>æ ¸å¿ƒè¦ç‚¹å›é¡¾</strong>ï¼š</p>
<ol>
<li>çº¿ç¨‹åˆ›å»ºä¼˜å…ˆé€‰æ‹©<code>Runnable</code>æˆ–<code>Callable</code>æ¥å£ï¼Œè§„é¿å•ç»§æ‰¿é™åˆ¶</li>
<li>çº¿ç¨‹å®‰å…¨é—®é¢˜éœ€é€šè¿‡åŒæ­¥ä»£ç å—ã€åŒæ­¥æ–¹æ³•æˆ–Locké”è§£å†³</li>
<li>çº¿ç¨‹æ± æ¨èä½¿ç”¨<code>ThreadPoolExecutor</code>æ‰‹åŠ¨åˆ›å»ºï¼Œæ˜ç¡®é…ç½®å‚æ•°</li>
<li>é«˜å¹¶å‘åœºæ™¯éœ€æ³¨æ„èµ„æºæ§åˆ¶ï¼Œé¿å…OOMç­‰é£é™©</li>
</ol>
<p>æŒæ¡å¤šçº¿ç¨‹æŠ€æœ¯éœ€è¦ä¸æ–­å®è·µï¼Œåœ¨å®é™…å¼€å‘ä¸­éœ€æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œå¹³è¡¡æ€§èƒ½ä¸å®‰å…¨æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NestJS æ¶æ„è®¾è®¡ç³»åˆ—ï¼šåº”ç”¨æœåŠ¡ä¸é¢†åŸŸæœåŠ¡çš„åŒºåˆ«]]></title>    <link>https://juejin.cn/post/7585458459166375970</link>    <guid>https://juejin.cn/post/7585458459166375970</guid>    <pubDate>2025-12-20T12:32:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585458459166375970" data-draft-id="7585452404113424399" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NestJS æ¶æ„è®¾è®¡ç³»åˆ—ï¼šåº”ç”¨æœåŠ¡ä¸é¢†åŸŸæœåŠ¡çš„åŒºåˆ«"/> <meta itemprop="keywords" content="åç«¯,æ¶æ„"/> <meta itemprop="datePublished" content="2025-12-20T12:32:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é»„æ°¸æ ‡hyb"/> <meta itemprop="url" content="https://juejin.cn/user/8451822197277"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NestJS æ¶æ„è®¾è®¡ç³»åˆ—ï¼šåº”ç”¨æœåŠ¡ä¸é¢†åŸŸæœåŠ¡çš„åŒºåˆ«
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/8451822197277/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é»„æ°¸æ ‡hyb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T12:32:10.000Z" title="Sat Dec 20 2025 12:32:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ã€Š<a href="https://juejin.cn/post/7578198815729696768" target="_blank" title="https://juejin.cn/post/7578198815729696768">NestJS æ¶æ„è®¾è®¡ï¼š5 åˆ†é’ŸæŠ“ä½ DDD çš„å‘½è„‰</a>ã€‹ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† DDD ï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰çš„ç»å…¸åˆ†å±‚æ¶æ„ã€‚å…¶ä¸­ï¼Œåº”ç”¨å±‚ä¸é¢†åŸŸå±‚åˆ†åˆ«å¯¹åº”ä¸¤ç±»å…³é”®æœåŠ¡ï¼š</p>
<ul>
<li><strong>åº”ç”¨æœåŠ¡ï¼ˆApplication Service / Usecaseï¼‰</strong>ï¼šä½äºåº”ç”¨å±‚ï¼Œè´Ÿè´£æµç¨‹ç¼–æ’ï¼›</li>
<li><strong>é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰</strong>ï¼šä½äºé¢†åŸŸå±‚ï¼Œæ‰¿è½½æ ¸å¿ƒä¸šåŠ¡è§„åˆ™ã€‚</li>
</ul>
<blockquote>
<p>ç®€å•æ¥è¯´ï¼šåº”ç”¨æœåŠ¡è¡¨è¾¾ç”¨æˆ·æƒ³åšä»€ä¹ˆï¼Œé¢†åŸŸæœåŠ¡è¡¨è¾¾ä¸šåŠ¡è¯¥æ€ä¹ˆåšã€‚</p>
</blockquote>
<p>ä»¥åˆ›å»ºè®¢å•ä¸ºä¾‹ï¼š</p>
<ul>
<li><strong>åº”ç”¨æœåŠ¡</strong>ï¼šç”¨æˆ·ç‚¹å‡»ç»“ç®— â†’ è®¡ç®—é‡‘é¢ â†’ å‘èµ·æ”¯ä»˜ â†’ åˆ›å»ºè®¢å• â†’ é€šçŸ¥ç”¨æˆ·ï¼›</li>
<li><strong>é¢†åŸŸæœåŠ¡</strong>ï¼šé‡‘é¢è®¡ç®—ã€æ”¯ä»˜å¤„ç†ã€è®¢å•çŠ¶æ€å˜æ›´ç­‰å…·ä½“ä¸šåŠ¡è§„åˆ™ã€‚</li>
</ul>
<p>åº”ç”¨æœåŠ¡è´Ÿè´£<strong>ä¸²è”æ•´ä¸ªç”¨ä¾‹æµç¨‹</strong>ï¼Œè€Œé¢†åŸŸæœåŠ¡åˆ™ä¸“æ³¨äº<strong>æ¯ä¸ªç¯èŠ‚çš„ä¸šåŠ¡å®ç°</strong>ã€‚</p>
<h2 data-id="heading-1">åº”ç”¨æœåŠ¡ï¼ˆUsecaseï¼‰</h2>
<p>åº”ç”¨æœåŠ¡æ˜¯è¡¨è¾¾å…·ä½“ä¸šåŠ¡åœºæ™¯ï¼ˆå¦‚å–æ¶ˆè®¢å•ã€åˆ›å»ºæ”¯ä»˜ï¼‰çš„ä¸»è¦è½½ä½“ï¼Œå®ƒå¯¹åº”ç”¨æˆ·å‘èµ·çš„ä¸€ä¸ªå®Œæ•´æ“ä½œæµç¨‹ã€‚</p>
<h3 data-id="heading-2">æ ¸å¿ƒèŒè´£</h3>
<p>åº”ç”¨æœåŠ¡æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåè°ƒå™¨ï¼Œå…¶èŒè´£åŒ…æ‹¬ï¼š</p>
<ul>
<li>åè°ƒå¤šä¸ªé¢†åŸŸå¯¹è±¡ä¸é¢†åŸŸæœåŠ¡ï¼›</li>
<li>æ§åˆ¶ä¸šåŠ¡ç”¨ä¾‹çš„æ‰§è¡Œé¡ºåºï¼›</li>
<li>ç»„è£…å¹¶è¿”å›æœ€ç»ˆç»“æœã€‚</li>
</ul>
<p>å°½ç®¡åº”ç”¨å±‚ä¸åº”åŒ…å«æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œä½†å®ƒå¯ä»¥åˆç†å¤„ç†ä»¥ä¸‹éæ ¸å¿ƒä½†å¿…è¦çš„æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼š<strong>æƒé™æ ¡éªŒã€äº‹åŠ¡æ§åˆ¶ã€ç»“æœç»„è£…ã€å‘é€é€šçŸ¥ï¼ˆé‚®ä»¶ã€æ¶ˆæ¯ç­‰éæ ¸å¿ƒä¸šåŠ¡ï¼‰</strong>ã€‚</p>
<h3 data-id="heading-3">ä»£ç ç¤ºä¾‹</h3>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªçœŸå® NestJS é¡¹ç›®ä¸­çš„åº”ç”¨æœåŠ¡ <code>CancelOrderUsecase</code>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">OrderStatus</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/modules/payment/client/constant/Order'</span>;
<span class="hljs-comment">// ... çœç•¥å…¶ä»– imports</span>

@<span class="hljs-title class_">Injectable</span>()
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CancelOrderUsecase</span> {
  @<span class="hljs-title class_">Inject</span>()
  private readonly <span class="hljs-attr">dataAssembler</span>: <span class="hljs-title class_">DataAssembler</span>;

  @<span class="hljs-title class_">Inject</span>()
  private readonly <span class="hljs-attr">cancelOrderByOrderIdService</span>: <span class="hljs-title class_">CancelOrderByOrderIdService</span>;

  @<span class="hljs-title class_">Inject</span>()
  private readonly <span class="hljs-attr">getOrderByOrderIdService</span>: <span class="hljs-title class_">GetOrderByOrderIdService</span>;

  @<span class="hljs-title class_">Inject</span>()
  private readonly <span class="hljs-attr">validatePaymentRelatedEntityPrivilegeService</span>: <span class="hljs-title class_">ValidatePaymentRelatedEntityPrivilegeService</span>;

  @<span class="hljs-title class_">Inject</span>()
  private readonly <span class="hljs-attr">stripeService</span>: <span class="hljs-title class_">StripeService</span>;
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">orderId: number, userId: number</span>) {
    <span class="hljs-comment">// 1. è·å–è®¢å•ä¿¡æ¯</span>
    <span class="hljs-keyword">const</span> order = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">getOrderByOrderIdService</span>.<span class="hljs-title function_">execute</span>(orderId);

    <span class="hljs-comment">// 2. çŠ¶æ€æ ¡éªŒ</span>
    <span class="hljs-keyword">if</span> (order.<span class="hljs-property">status</span> === <span class="hljs-title class_">OrderStatus</span>.<span class="hljs-property">Pending</span>) <span class="hljs-keyword">throw</span> <span class="hljs-title class_">ExceptionFactory</span>.<span class="hljs-title function_">bizException</span>(<span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">INVALID_PARAM</span>);

    <span class="hljs-comment">// 3. æƒé™éªŒè¯</span>
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">validatePaymentRelatedEntityPrivilegeService</span>.<span class="hljs-title function_">execute</span>({
      <span class="hljs-attr">entityId</span>: order.<span class="hljs-property">entityId</span>,
      <span class="hljs-attr">entityType</span>: order.<span class="hljs-property">entityType</span>,
      userId,
    });

    <span class="hljs-comment">// 4. è°ƒç”¨é¢†åŸŸæœåŠ¡æ‰§è¡Œæ ¸å¿ƒä¸šåŠ¡</span>
    <span class="hljs-keyword">const</span> cancelResult = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cancelOrderByOrderIdService</span>.<span class="hljs-title function_">execute</span>(orderId);

    <span class="hljs-comment">// 5. å¤„ç†ç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆéæ ¸å¿ƒä¸šåŠ¡ï¼‰</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">configService</span>.<span class="hljs-property">bizConfig</span>.<span class="hljs-property">isGlobalEdition</span> &amp;&amp; order.<span class="hljs-property">paymentInfo</span>.<span class="hljs-property">invoice</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">stripeService</span>.<span class="hljs-title function_">voidInvoice</span>(order.<span class="hljs-property">paymentInfo</span>.<span class="hljs-property">invoice</span>.<span class="hljs-property">id</span>);
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-comment">// ç¬¬ä¸‰æ–¹è°ƒç”¨å¤±è´¥ä¸å½±å“ä¸»æµç¨‹</span>
      }
    }

    <span class="hljs-comment">// 6. å‘é€é€šçŸ¥ï¼ˆéæ ¸å¿ƒä¸šåŠ¡ï¼‰</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendNotification</span>(order, userId);

    <span class="hljs-comment">// 7. ç»„è£…è¿”å›ç»“æœ</span>
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataAssembler</span>.<span class="hljs-property">assemble</span>&lt;<span class="hljs-title class_">EntityDTO</span>&lt;<span class="hljs-title class_">Order</span>&gt;&gt;({
      <span class="hljs-attr">domainObject</span>: cancelResult,
    });

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">SingleResponse</span>.<span class="hljs-title function_">of</span>(result);
  }
}
</code></pre>
<p>ä»ä»¥ä¸Šä»£ç æˆ‘ä»¬å¯ä»¥çŸ¥é“åº”ç”¨æœåŠ¡çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li><strong>ä¸åŒ…å«ä¸šåŠ¡é€»è¾‘</strong>ï¼šè®¢å•å–æ¶ˆçš„æ ¸å¿ƒé€»è¾‘ç”± <code>CancelOrderByOrderIdService</code> é¢†åŸŸæœåŠ¡å®ç°ï¼›</li>
<li><strong>ç¼–æ’å¤šä¸ªæœåŠ¡</strong>ï¼šä¾æ¬¡è°ƒç”¨æŸ¥è¯¢ã€éªŒè¯ã€å–æ¶ˆç­‰æœåŠ¡ï¼›</li>
<li><strong>å¤„ç†éæ ¸å¿ƒä¸šåŠ¡</strong>ï¼šå‘é€é€šçŸ¥ã€è°ƒç”¨ Stripe ç¬¬ä¸‰æ–¹ APIï¼›</li>
<li><strong>ç»„è£…è¿”å›ç»“æœ</strong>ï¼šé€šè¿‡ <code>DataAssembler</code> å°†é¢†åŸŸå¯¹è±¡è½¬æ¢ä¸º DTOã€‚</li>
</ul>
<h2 data-id="heading-4">é¢†åŸŸæœåŠ¡ï¼ˆDomain Serviceï¼‰</h2>
<p>å¹¶éæ‰€æœ‰ä¸šåŠ¡é€»è¾‘éƒ½èƒ½è‡ªç„¶åœ°å½’å±åˆ°æŸä¸ª<strong>å®ä½“</strong>æˆ–<strong>å€¼å¯¹è±¡</strong>ä¸­ã€‚å½“ä¸€ä¸ªæ“ä½œæ¶‰åŠå¤šä¸ªèšåˆã€éœ€è¦åè°ƒå¤šä¸ªé¢†åŸŸå¯¹è±¡ï¼Œæˆ–æœ¬èº«æ˜¯æ— çŠ¶æ€çš„ä¸šåŠ¡è§„åˆ™æ—¶ï¼Œæˆ‘ä»¬å°±å°†å…¶æŠ½ä¸º<strong>é¢†åŸŸæœåŠ¡</strong>ã€‚</p>
<p>å®ƒæ˜¯é¢†åŸŸå±‚çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œä¸“æ³¨äºå®ç°æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œä½†ä»…é™äºé‚£äº›<strong>ä¸å±äºä»»ä½•å•ä¸€é¢†åŸŸå¯¹è±¡</strong>çš„åœºæ™¯ã€‚</p>
<h3 data-id="heading-5">æ ¸å¿ƒåŸåˆ™</h3>
<p>é¢†åŸŸæœåŠ¡çš„è®¾è®¡éµå¾ªä»¥ä¸‹æ ¸å¿ƒåŸåˆ™ï¼š</p>
<ul>
<li><strong>å•ä¸€èŒè´£</strong>ï¼šæ¯ä¸ªæœåŠ¡ä¸“æ³¨äºä¸€ä¸ªå…·ä½“çš„ä¸šåŠ¡æ“ä½œï¼›</li>
<li><strong>æ— çŠ¶æ€</strong>ï¼šçŠ¶æ€ç”±é¢†åŸŸå¯¹è±¡ï¼ˆå¦‚å®ä½“ Entityï¼‰ä¿å­˜ï¼Œé¢†åŸŸæœåŠ¡æœ¬èº«ä¸æŒæœ‰çŠ¶æ€ï¼›</li>
<li><strong>å¯å¤ç”¨æ€§</strong>ï¼šå¯ä»¥è¢«å¤šä¸ªåº”ç”¨æœåŠ¡è°ƒç”¨ä»¥æ‰§è¡Œç›¸åŒçš„ä¸šåŠ¡é€»è¾‘ï¼›</li>
<li><strong>çº¯ç²¹æ€§</strong>ï¼šåªå¤„ç†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œé¿å…æ··å…¥éä¸šåŠ¡ç›¸å…³çš„ä»£ç ã€‚</li>
</ul>
<h3 data-id="heading-6">ä»€ä¹ˆæ—¶å€™ä½¿ç”¨é¢†åŸŸæœåŠ¡ï¼Ÿ</h3>
<ul>
<li>å½“éœ€è¦æ‰§è¡Œä¸€ä¸ªæ˜¾è‘—çš„ä¸šåŠ¡æ“ä½œè¿‡ç¨‹æ—¶ï¼›</li>
<li>å¯¹é¢†åŸŸå¯¹è±¡è¿›è¡Œè½¬æ¢æˆ–è®¡ç®—ï¼›</li>
<li>å½“ä¸šåŠ¡é€»è¾‘æ¶‰åŠå¤šä¸ªé¢†åŸŸå¯¹è±¡ï¼Œå¹¶ä¸”éœ€è¦è¿”å›ä¸€ä¸ªå€¼å¯¹è±¡ä½œä¸ºç»“æœæ—¶ã€‚</li>
</ul>
<h3 data-id="heading-7">ä»£ç ç¤ºä¾‹</h3>
<p>æˆ‘ä»¬åŒæ ·æ¥çœ‹ä¸€ä¸ªçœŸå® NestJS é¡¹ç›®ä¸­çš„é¢†åŸŸæœåŠ¡ <code>TransferUserCreditToTeamService</code>ï¼ˆç”¨æˆ·ç§¯åˆ†è½¬å›¢é˜Ÿï¼‰ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">async</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">{
  userId,
  teamId,
  transactionId,
  userCreditHistoryData,
  teamCreditHistoryData,
  amount,
}: {
  userId: number;
  teamId: number;
  transactionId: string;
  amount: number;
  userCreditHistoryData: Record&lt;string, unknown&gt;;
  teamCreditHistoryData: Record&lt;string, unknown&gt;;
}</span>) {
  <span class="hljs-comment">// å¼€å¯äº‹åŠ¡å‰çš„å‡†å¤‡å·¥ä½œ</span>
  <span class="hljs-keyword">const</span> knex = <span class="hljs-variable language_">this</span>.<span class="hljs-property">teamCreditRepository</span>.<span class="hljs-title function_">getKnex</span>();
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">validateRedisLock</span>(teamId);
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">teamCreditRepository</span>.<span class="hljs-title function_">findOrCreateOne</span>(teamId);
  <span class="hljs-keyword">const</span> userCredit = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">userCreditRepository</span>.<span class="hljs-title function_">findOrCreateOne</span>(userId);
  
  <span class="hljs-comment">// ä¸šåŠ¡è§„åˆ™æ ¡éªŒï¼šä½™é¢æ˜¯å¦è¶³å¤Ÿ</span>
  <span class="hljs-keyword">if</span> (userCredit.<span class="hljs-property">amount</span> &lt; amount) {
    <span class="hljs-keyword">throw</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`user <span class="hljs-subst">${userId}</span> credit not enough`</span>);
  }
  
  <span class="hljs-comment">// åˆ›å»º Stripe ä½™é¢è®°å½•</span>
  <span class="hljs-keyword">const</span> balanceTransactionId = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createStripeCustomerBalance</span>(...);
  
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> knex.<span class="hljs-title function_">transaction</span>(<span class="hljs-keyword">async</span> (trx) =&gt; {
      <span class="hljs-comment">// äº‹åŠ¡å†…çš„ä¸šåŠ¡é€»è¾‘ï¼š</span>
      <span class="hljs-comment">// 1. æ£€æŸ¥æµæ°´æ˜¯å¦å·²å­˜åœ¨ï¼ˆå¹‚ç­‰æ€§ï¼‰</span>
      <span class="hljs-comment">// 2. æ‰£å‡ç”¨æˆ·ç§¯åˆ†</span>
      <span class="hljs-comment">// 3. å¢åŠ å›¢é˜Ÿç§¯åˆ†</span>
      <span class="hljs-comment">// 4. æ ¡éªŒæœ€ç»ˆçŠ¶æ€</span>
    });
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">throw</span> error;
  }
  
  <span class="hljs-comment">// å‘å¸ƒé¢†åŸŸäº‹ä»¶</span>
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">domainEventPublisher</span>.<span class="hljs-title function_">publishSync</span>(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserCreditHistoryCreatedEvent</span>(...)
  );
  <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">domainEventPublisher</span>.<span class="hljs-title function_">publishSync</span>(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">TeamCreditHistoryCreatedEvent</span>(...)
  );
}
</code></pre>
<p>è¿™ä¸ªé¢†åŸŸæœåŠ¡å…·ä½“å±•ç¤ºäº†ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li><strong>ä¸šåŠ¡è§„åˆ™</strong>ï¼šå¦‚ä½™é¢æ ¡éªŒã€æµæ°´å¹‚ç­‰æ€§æ£€æŸ¥ï¼›</li>
<li><strong>äº‹åŠ¡å¤„ç†</strong>ï¼šç¡®ä¿è½¬è´¦è¿‡ç¨‹ä¸­çš„åŸå­æ€§ï¼Œä¿éšœæ•°æ®ä¸€è‡´æ€§ï¼›</li>
<li><strong>é¢†åŸŸäº‹ä»¶</strong>ï¼šè¿‡å‘å¸ƒé¢†åŸŸäº‹ä»¶é€šçŸ¥å…¶ä»–èšåˆå…³äºç§¯åˆ†å˜åŠ¨çš„ä¿¡æ¯ã€‚</li>
</ul>
<h2 data-id="heading-8">å®ä½“ï¼ˆEntityï¼‰ä¸é¢†åŸŸæœåŠ¡çš„èŒè´£åˆ’åˆ†</h2>
<p>åœ¨å‰é¢ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†<strong>å®ä½“ï¼ˆEntityï¼‰å’Œå€¼å¯¹è±¡</strong>ï¼Œåœ¨ DDD ä¸­ï¼Œ<strong>ä¸šåŠ¡é€»è¾‘åº”ä¼˜å…ˆå†…èšåœ¨å®ä½“æˆ–å€¼å¯¹è±¡ä¸­</strong>ã€‚åªæœ‰å½“æŸä¸ªè¡Œä¸ºæ— æ³•è‡ªç„¶å½’å±äºå•ä¸€å®ä½“ï¼ˆä¾‹å¦‚æ¶‰åŠå¤šä¸ªèšåˆã€æ— çŠ¶æ€æ“ä½œã€æˆ–è·¨å¯¹è±¡åä½œï¼‰æ—¶ï¼Œ<strong>æ‰å°†å…¶æå–ä¸ºé¢†åŸŸæœåŠ¡</strong>ã€‚</p>
<p>é‚£ä¹ˆï¼Œå…·ä½“å¦‚ä½•åˆ¤æ–­ä¸€æ®µé€»è¾‘è¯¥æ”¾åœ¨å“ªé‡Œï¼Ÿå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªç»´åº¦è¿›è¡Œæƒè¡¡ï¼š</p>






























<table><thead><tr><th>ç»´åº¦</th><th>å®ä½“ï¼ˆEntityï¼‰</th><th>é¢†åŸŸæœåŠ¡ï¼ˆDomain Service</th></tr></thead><tbody><tr><td>çŠ¶æ€ä¾èµ–</td><td>é€»è¾‘å¼ºä¾èµ–äºè‡ªèº«çŠ¶æ€ï¼ˆå¦‚å®ä¾‹å±æ€§ï¼‰</td><td>æ— çŠ¶æ€ï¼Œä¸æŒæœ‰æ•°æ®ï¼Œä»…åŸºäºè¾“å…¥å‚æ•°æ‰§è¡Œæ“ä½œ</td></tr><tr><td>ä½œç”¨èŒƒå›´</td><td>ä»…æ“ä½œå½“<strong>å‰å®ä½“å®ä¾‹</strong></td><td>é€šå¸¸æ¶‰åŠ<strong>å¤šä¸ªå®ä½“ã€èšåˆæˆ–å€¼å¯¹è±¡</strong></td></tr><tr><td>èšåˆè¾¹ç•Œ</td><td>ä¸åº”è·¨è¶Šèšåˆè¾¹ç•Œï¼ˆå³ä¸ç›´æ¥æ“ä½œå…¶ä»–èšåˆæ ¹ï¼‰</td><td>å¯åè°ƒ<strong>å¤šä¸ªèšåˆ</strong>ä¹‹é—´çš„äº¤äº’ï¼ˆä½†éœ€è°¨æ…ï¼‰å¤šä¸ªé¢†åŸŸå¯¹è±¡</td></tr><tr><td>å†…èšæ€§</td><td>è¡Œä¸ºæ˜¯è¯¥å®ä½“<strong>å¤©ç„¶å…·å¤‡çš„èƒ½åŠ›</strong>ï¼ˆå¦‚ order.cancel()ï¼‰</td><td>è¡Œä¸ºæ˜¯<strong>å¤–éƒ¨èµ‹äºˆçš„åä½œé€»è¾‘</strong>ï¼ˆå¦‚ transferCredit(user, team)ï¼‰</td></tr></tbody></table>
<p>æ¥çœ‹ä¸€ä¸ªçœŸå® NestJS é¡¹ç›®ä¸­çš„ <code>Order</code> å®ä½“ä¸­çš„è¡Œä¸ºï¼š</p>
<pre><code class="hljs language-js" lang="js">@<span class="hljs-title class_">Property</span>({ <span class="hljs-attr">persist</span>: <span class="hljs-literal">false</span> })
<span class="hljs-keyword">get</span> <span class="hljs-title function_">paymentInfo</span>(): <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_paymentInfo</span> {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> databaseValue =
      <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_paymentInfo</span> === <span class="hljs-string">'string'</span>
        ? <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_paymentInfo</span>)
        : <span class="hljs-variable language_">this</span>.<span class="hljs-property">_paymentInfo</span>;
    <span class="hljs-keyword">const</span> clone = <span class="hljs-title function_">cloneDeep</span>(databaseValue);

    <span class="hljs-comment">// åŸºäºå½“å‰è®¢å• ID ç”Ÿæˆé¢„è§ˆè·¯å¾„ï¼ˆå¼ºä¾èµ– this.idï¼‰</span>
    <span class="hljs-keyword">if</span> (
      clone.<span class="hljs-property">credential</span>?.<span class="hljs-property">receiptFiles</span>?.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>
    ) {
      clone.<span class="hljs-property">credential</span>.<span class="hljs-property">receiptFiles</span> = clone.<span class="hljs-property">credential</span>.<span class="hljs-property">receiptFiles</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span>
        <span class="hljs-title function_">getCredentialImagePreviewPath</span>(<span class="hljs-title class_">String</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>), item)
      );
    }

    <span class="hljs-keyword">return</span> clone;
  } <span class="hljs-keyword">catch</span> {
    <span class="hljs-keyword">return</span> {};
  }
}

<span class="hljs-keyword">set</span> <span class="hljs-title function_">paymentInfo</span>(<span class="hljs-params">value</span>) {
  <span class="hljs-keyword">const</span> parsed = <span class="hljs-title function_">safeJsonParse</span>(value, {});

  <span class="hljs-comment">// æ¸…ç†è·¯å¾„å‰ç¼€ï¼ˆåŒæ ·ä¾èµ– this.idï¼‰</span>
  <span class="hljs-keyword">if</span> (parsed.<span class="hljs-property">credential</span>?.<span class="hljs-property">receiptFiles</span>?.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    parsed.<span class="hljs-property">credential</span>.<span class="hljs-property">receiptFiles</span> = parsed.<span class="hljs-property">credential</span>.<span class="hljs-property">receiptFiles</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span>
      <span class="hljs-title function_">removeCredentialImagePrefix</span>(<span class="hljs-title class_">String</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>), item)
    );
  }

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">_paymentInfo</span> = parsed;
}
</code></pre>
<p>è¿™æ®µé€»è¾‘ï¼š</p>
<ul>
<li>å®Œå…¨åŸºäº <code>this.id</code> å’Œ <code>this._paymentInfo</code> è¿è¡Œï¼›</li>
<li>ä¸è°ƒç”¨å…¶ä»–èšåˆæˆ–æœåŠ¡ï¼›</li>
<li>æ˜¯å¯¹è‡ªèº«æŒä¹…åŒ–æ•°æ®çš„è§†å›¾è½¬æ¢ï¼Œè€Œéä¸šåŠ¡å†³ç­–ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œå®ƒéå¸¸é€‚åˆæ”¾åœ¨å®ä½“å†…éƒ¨ï¼Œæ—¢ä¿æŒäº†å†…èšæ€§ï¼Œåˆé¿å…äº†ä¸å¿…è¦çš„æœåŠ¡è†¨èƒ€ã€‚</p>
<p>æœ€åï¼Œ<strong>åº”ç”¨æœåŠ¡</strong>å’Œ<strong>é¢†åŸŸæœåŠ¡</strong>çš„åŒºåˆ«å·²ä»‹ç»å®Œæ¯•ï¼Œé˜…è¯»æœ¬ç¯‡æ–‡ç« æœ€å¥½ç»“åˆä¸Šç¯‡æ–‡ç« ã€Š<a href="https://juejin.cn/post/7578198815729696768" target="_blank" title="https://juejin.cn/post/7578198815729696768">NestJS æ¶æ„è®¾è®¡ï¼š5 åˆ†é’ŸæŠ“ä½ DDD çš„å‘½è„‰</a>ã€‹ä¸€èµ·é˜…è¯»ï¼Œå¯èƒ½ä¼šæ›´å¥½ç†è§£ï¼Œå¦‚æœä½ è§‰å¾—æœ‰ä»€ä¹ˆåœ°æ–¹é—æ¼ã€ç–‘æƒ‘ï¼Œæ¬¢è¿è¯„è®ºè®¨è®ºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQLä¸»ä»å»¶è¿Ÿé£™å‡ï¼Ÿå…ƒæ•°æ®é”å¯èƒ½æ˜¯â€œçœŸå‡¶â€]]></title>    <link>https://juejin.cn/post/7585706951602946074</link>    <guid>https://juejin.cn/post/7585706951602946074</guid>    <pubDate>2025-12-20T12:46:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585706951602946074" data-draft-id="7585463195201847346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQLä¸»ä»å»¶è¿Ÿé£™å‡ï¼Ÿå…ƒæ•°æ®é”å¯èƒ½æ˜¯â€œçœŸå‡¶â€"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-20T12:46:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æŠ€æœ¯ä¸æ‰“çƒŠ"/> <meta itemprop="url" content="https://juejin.cn/user/893244690677165"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQLä¸»ä»å»¶è¿Ÿé£™å‡ï¼Ÿå…ƒæ•°æ®é”å¯èƒ½æ˜¯â€œçœŸå‡¶â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/893244690677165/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æŠ€æœ¯ä¸æ‰“çƒŠ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T12:46:35.000Z" title="Sat Dec 20 2025 12:46:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b48074932b2460aade85ae0ca5642d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oqA5pyv5LiN5omT54OK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766839594&amp;x-signature=4DwwL750q9J0tMZ7vobEDqA10h8%3D" alt="bdf10e7027a93077604be8d3a1238ffe09d8b8ef055fc8360f5ece011507cb9f_1766233783492.jpg" loading="lazy"/>
ç°è±¡ï¼šIOçº¿ç¨‹æ¬¢å¿«ï¼ŒSQLçº¿ç¨‹å´åœ¨åˆ’æ°´çœ‹åˆ°ä»åº“çš„SecondsBehindMasterä»30ç§’ç›´çº¿é£™å‡åˆ°1000ç§’ï¼Œä½ æ˜¯ä¸æ˜¯å†·æ±—ç›´å†’ï¼Ÿ<br/>
IOçº¿ç¨‹è¿˜åœ¨æ¬¢å¿«åœ°è¯»å–æ—¥å¿—ï¼ŒSQLçº¿ç¨‹å´åƒè¢«å†»ä½äº†ä¸€æ ·ï¼Œä¸€æ­¥ä¸€æ­¥å¾€åæŒªï¼Œè€Œä¸”è¶Šæ¥è¶Šæ…¢ã€‚<br/>
è¿™çœŸçš„ä¸æ˜¯ç½‘ç»œé—®é¢˜ï¼Œè€Œæ˜¯ä½ çš„DDLæ“ä½œåœ¨æš—åœ°é‡Œæç ´åã€‚æˆ‘è§è¿‡å¤ªå¤šçº¿ä¸Šäº‹æ•…çš„æ ¹æºå°±è—åœ¨ä¸€æ¡çœ‹ä¼¼ä¸èµ·çœ¼çš„ALTERTABLEé‡Œâ€”â€”æœ‰ä¸ªå“¥ä»¬æ”¹äº†ä¸€ä¸ªvarchar(5000)å­—æ®µï¼Œæƒ³æ‰©å®¹åˆ°varchar(6000)ï¼Œç»“æœæ•´ä¸ªä»åº“å´©æºƒäº†ã€‚<br/>
ä»Šå¤©å°±ç»™ä½ è®²æ¸…æ¥šè¿™ä¸ªå‘åˆ°åº•æ€ä¹ˆè¸©ï¼Œä»¥åŠæ€ä¹ˆå®‰ç¨³åœ°è·¨è¿‡å»ã€‚é—®é¢˜æœ€åˆçœ‹èµ·æ¥å¾ˆè¯¡å¼‚ã€‚ä½ ç”¨SHOWREPLICASTATUSä¸€çœ‹ï¼ŒSecondsBehindMasterç›´æ¥å†²åˆ°1000+ç§’ï¼Œä¸šåŠ¡å‘Šè¯‰ä½ æ•°æ®æ²¡åŒæ­¥ï¼Œä½†æ˜¯ä½ ç™»ä¸Šä»åº“æŸ¥çœ‹ï¼š</p>
<p>SecondsBehindMaster:1000<br/>
IOThreadRunning:Yes<br/>
SQLThreadRunning:Yes<br/>
RelayLogIORunning:Yes</p>
<p>è¿™è¯´æ˜è¯»æ—¥å¿—çš„çº¿ç¨‹æ´»å¾—å¥½å¥½çš„ï¼Œé—®é¢˜ä¸€å®šå‡ºåœ¨åº”ç”¨æ—¥å¿—çš„çº¿ç¨‹ä¸Šã€‚<br/>
<strong>IOçº¿ç¨‹æ­£å¸¸å·¥ä½œï¼Œè¯´æ˜ä¸»åº“æ²¡é—®é¢˜ï¼Œç½‘ç»œä¹Ÿæ²¡é—®é¢˜ã€‚</strong><br/>
é‚£ä¸ºä»€ä¹ˆSQLçº¿ç¨‹è¿™ä¹ˆæ…¢å‘¢ï¼Ÿå¤šåŠæ˜¯è¢«ä»€ä¹ˆä¸œè¥¿å¡ä½äº†ã€‚å®šä½ï¼šSHOWREPLICASTATUSé‡Œçš„å‡è±¡è¿™é‡Œæœ€è½»æ˜“å‡ºç°çš„å·®é”™å°±æ˜¯çœ‹é”™ä½ç½®ã€‚ä½ æˆ–è®¸ä¼šçœ‹åˆ°SQLDelay:0<br/>
RelayLogPos:1024çœ‹èµ·æ¥SQLDelayæ˜¯0ï¼Œè¯´æ˜æ²¡æœ‰æ•…æ„å»¶è¿Ÿå¤åˆ¶ï¼ŒRelayLogPosä¹Ÿåœ¨é‚£å„¿â€¦â€¦å¯è¿™TMä¸€ä¸ªå°æ—¶éƒ½æ²¡åŠ¨è¿‡ï¼<br/>
<strong>è¿™å°±æ˜¯å…³é”®ä¿¡å·ï¼šä¸­ç»§æ—¥å¿—ä½ç½®ä¸å†å¢é•¿ï¼Œè¯´æ˜SQLçº¿ç¨‹å¡ä½äº†ã€‚</strong><br/>
è¿™æ—¶å€™ï¼Œå¾ˆå¤šäººä¼šå‚»æ„£æ„£åœ°æŸ¥çœ‹ç½‘ç»œã€æ£€æŸ¥ç£ç›˜ç©ºé—´ã€è§‚å¯Ÿç¼“å†²æ± ï¼Œå®Œå…¨æ²¡å¯Ÿè§‰åˆ°ï¼Œé—®é¢˜å°±åœ¨è¿™æ—¶å‡ºç°äº†ï¼šæŸå¼ è¡¨å·²ç»è¢«é”å®šï¼ŒSQLçº¿ç¨‹æ­£åœ¨ä¾æ¬¡æ’é˜Ÿç­‰ç€è§£é”æŠ“é”ï¼šperformanceschemaé‡Œçš„çœŸå‡¶æ‰“å¼€performanceschemaï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å…ƒæ•°æ®é”ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">SELECT * FROM performance_schema.metadata_locksÂ WHEREÂ <span class="hljs-attr">OBJECT_SCHEMA</span>Â =Â <span class="hljs-string">'your_db'</span>Â Â Â ANDÂ OBJECT_NAMEÂ =Â <span class="hljs-string">'your_table'</span>Â Â Â ANDÂ LOCK_TYPEÂ =Â <span class="hljs-string">'EXCLUSIVE'</span><span class="hljs-comment">;</span>
</code></pre>
<p>å¦‚æœè¿™é‡Œè¹¦å‡ºä¸€æ¡è®°å½•ï¼ŒLOCKTYPEæ˜¯EXCLUSIVEï¼ŒçŠ¶æ€æ˜¯WAITINGFORï¼Œé‚£ä½ å°±æ‰¾åˆ°çœŸå‡¶äº†ã€‚
å¤§æ¦‚ç‡æ˜¯ï¼š</p>

































<table><thead><tr><th>å­—æ®µå</th><th>å€¼</th></tr></thead><tbody><tr><td>OBJECTSCHEMA</td><td>yourdb</td></tr><tr><td>OBJECTNAME</td><td>yourtable</td></tr><tr><td>LOCKTYPE</td><td>EXCLUSIVE</td></tr><tr><td>LOCKDURATION</td><td>TRANSACTION</td></tr><tr><td>STATUS</td><td>WAITING FOR TABLE METADATA LOCK</td></tr><tr><td>OBJECTTYPE</td><td>TABLE</td></tr></tbody></table>
<p>è¿™è¯´æ˜æœ‰ä¸ªALTERTABLEæ“ä½œæ­£åœ¨ç­‰å¾…è¡¨çš„å…ƒæ•°æ®é”ï¼Œè€Œå®ƒæˆåŠŸåœ°æŠŠæ•´ä¸ªå¤åˆ¶é˜Ÿåˆ—ç»™å µæ­»äº†ã€‚æ ¹å› ï¼šå¤§å­—æ®µæ”¹åŠ¨è§¦å‘å…¨è¡¨é‡å»ºä½ çš„DBAæˆ–è€…å¼€å‘åœ¨æ”¹è¡¨çš„æ—¶å€™ï¼Œæ‰§è¡Œäº†è¿™æ ·çš„å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span>Â big_table MODIFYÂ <span class="hljs-keyword">COLUMN</span>Â descriptionÂ <span class="hljs-type">varchar</span>(<span class="hljs-number">6000</span>);
</code></pre>
<p>çœ‹èµ·æ¥æ˜¯ä¸ªå¾ˆå°çš„æ”¹åŠ¨å¯¹å§ï¼Ÿ</p>
<p>ä½†æ˜¯é—®é¢˜æ¥äº†ï¼švarchar(5000)æ”¹åˆ°varchar(6000)ï¼Œè™½ç„¶éƒ½æ˜¯å¯å˜é•¿åº¦å­—æ®µï¼Œä½†MySQL5.7å’Œæ—©æœŸçš„8.0ä¸è®¤å•Šï¼<br/>
å®ƒä»¬ä¸èƒ½ç”¨INSTANTç®—æ³•ï¼Œå¿…é¡»é‡å»ºæ•´ä¸ªè¡¨ï¼Œè¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>éœ€è¦ä¸€æŠŠæ’ä»–é”ï¼ˆEXCLUSIVEï¼‰</li>
<li>è¦æŠŠæ‰€æœ‰è¡Œéƒ½é‡æ–°å†™ä¸€é</li>
</ul>
<p>è¦æ˜¯è¡¨æœ‰è¿™10GBæ•°æ®ï¼Œé‚£å¯èƒ½è¦èŠ±10åˆ†ã€‚<br/>
åœ¨è¿™10åˆ†é’Ÿé‡Œï¼Œæ‰€æœ‰è¯•å›¾è®¿é—®è¿™ä¸ªè¡¨çš„æŸ¥è¯¢éƒ½è¢«æŒ¡åœ¨å¤–é¢ã€‚<br/>
<strong>ä»åº“ä¸Šçš„SQLçº¿ç¨‹è¦åŒæ­¥è¿™ä¸ªDDLï¼Œä½†æ˜¯å®ƒæ’åœ¨é˜Ÿä¼æœ€åé¢ï¼Œè¦ç­‰ä¸»åº“ä¸Šçš„æ‰€æœ‰æ•°æ®å˜æ›´éƒ½å¤åˆ¶å®Œäº†æ‰èƒ½è½®åˆ°å®ƒâ€¦â€¦ç»“æœå°±æ˜¯ï¼šå»¶è¿Ÿè¶Šæ¥è¶Šå¤§ï¼Œæœ€åå½»åº•å´©æºƒã€‚</strong> è§£å†³ï¼šMySQL8.0çš„INSTANTé­”æ³•å¦‚æœä½ ç”¨çš„æ˜¯MySQL8.0.12åŠä»¥ä¸Šï¼Œæ­å–œä½ ï¼Œæœ‰ä¸ªç§˜å¯†æ­¦å™¨ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span>Â big_table MODIFYÂ <span class="hljs-keyword">COLUMN</span>Â descriptionÂ <span class="hljs-type">varchar</span>(<span class="hljs-number">6000</span>), ALGORITHM<span class="hljs-operator">=</span>INSTANT;
</code></pre>
<p>åªè¦æ”¹åŠ¨çš„å­—æ®µé•¿åº¦â‰¤255å­—èŠ‚ï¼Œæˆ–è€…åªæ˜¯æ‰©å¤§é•¿åº¦ï¼ˆä»å°åˆ°å¤§ï¼‰ï¼ŒALGORITHM=INSTANTå°±èƒ½ç§’çº§å®Œæˆï¼ŒçœŸçš„ï¼Œå°±æ˜¯ç§’çº§ã€‚</p>
<p>è¿™ä¸ªç®—æ³•æœ‰å¤šçŒ›ï¼š</p>
<ul>
<li>âœ… åªä¿®æ”¹å…ƒæ•°æ®ï¼Œä¸ç¢°è¡¨æ•°æ®</li>
<li>âœ… ä¸éœ€è¦æ’ä»–é”ï¼Œå…¶ä»–æŸ¥è¯¢ç…§å¸¸æ‰§è¡Œ</li>
<li>âœ… ä¸äº§ç”Ÿå¤§é‡binlog</li>
<li>âœ… ä»åº“å®Œå…¨æ— æ„ŸçŸ¥</li>
<li>âœ… SecondsBehindMasterè¿˜æ˜¯0</li>
</ul>
<p>ç§’æ€ï¼ŒçœŸçš„å¤§æ‰©å®¹æ€ä¹ˆåŠï¼Ÿç”¨gh-ostæ•‘å‘½ä½†æ˜¯ï¼Œå¦‚æœä½ è¿™æ ·åš</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span>Â big_table MODIFYÂ <span class="hljs-keyword">COLUMN</span>Â dataÂ <span class="hljs-type">varchar</span>(<span class="hljs-number">5000</span>)Â <span class="hljs-operator">-</span><span class="hljs-operator">&gt;</span>Â <span class="hljs-type">varchar</span>(<span class="hljs-number">50000</span>);
</code></pre>
<p>è¿™è¶…å‡º255å­—èŠ‚çš„è·¨åº¦ï¼ŒINSTANTä¹Ÿçˆ±è«èƒ½åŠ©ï¼Œå¾—é‡æ–°æ„å»ºè¡¨ï¼Œè¿™æ—¶å€™ï¼Œä¸å¯ä»¥è®©ä¸»åº“ç›´æ¥å¼€å±•ALTERæ“ä½œï¼Œå¾—è¿ç”¨ä¸“ä¸šå·¥å…·gh-ostã€‚</p>
<p>gh-ostæ˜¯æ€ä¹ˆæ´»å‘½çš„</p>
<pre><code class="hljs language-scss" lang="scss">gh-ost <span class="hljs-attr">--user</span>="root"Â <span class="hljs-attr">--password</span>="pass"Â <span class="hljs-attr">--host</span>="<span class="hljs-number">127.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.1</span>"Â \Â  <span class="hljs-attr">--database</span>="your_db"Â <span class="hljs-attr">--table</span>="your_table"Â \Â  <span class="hljs-attr">--alter</span>="MODIFY COLUMN data <span class="hljs-built_in">varchar</span>(<span class="hljs-number">50000</span>)"Â \Â  <span class="hljs-attr">--execute</span>
</code></pre>
<p>è¿™ä¸ªå·¥å…·ä¼šåœ¨åå°æ‚„æ‚„åœ°</p>
<ol>
<li>åˆ›å»ºå½±å­è¡¨ï¼ˆè·ŸåŸè¡¨ä¸€æ ·çš„ç»“æ„ï¼‰</li>
<li>è¾¹æ”¹è¡¨è¾¹å¤åˆ¶æ•°æ®ï¼Œä¸šåŠ¡ç…§å¸¸è¯»å†™</li>
<li>åœ¨äºŒè¿›åˆ¶æ—¥å¿—é‡ŒæŠ„ä¸‹å¢é‡æ›´æ–°ï¼Œä¸æ–­åº”ç”¨åˆ°å½±å­è¡¨</li>
<li>åˆ°æœ€åä¸€ç¬é—´ï¼ŒåŸè¡¨å’Œå½±å­è¡¨é—ªç”µåˆ‡æ¢</li>
</ol>
<p>æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼ŒåŸè¡¨ä¸€ç§’éƒ½ä¸é”ï¼Œä¸šåŠ¡æ— æ„ŸçŸ¥ã€‚<br/>
è™½ç„¶æ¯”INSTANTæ…¢ï¼Œä½†ä¹Ÿå°±æ˜¯å‡ åˆ†é’Ÿçš„äº‹ï¼Œé¥é¥å¥½è¿‡ç›´æ¥ALTERè¦èŠ±çš„åŠå°æ—¶ã€‚é¢„é˜²ï¼šæ‰“å¥½è¿™ä¸‰é“ä¿é™©ç¬¬ä¸€é“ï¼šæ‰€æœ‰DDLå…ˆéªŒè¯ä¸€é</p>
<pre><code class="hljs language-scss" lang="scss">pt-online-schema-changeÂ \Â  <span class="hljs-attr">--user</span>=root <span class="hljs-attr">--password</span>=pass <span class="hljs-attr">--host</span>=<span class="hljs-number">127.0</span><span class="hljs-selector-class">.0</span><span class="hljs-selector-class">.1</span>Â \Â  <span class="hljs-attr">--database</span>=your_db <span class="hljs-attr">--table</span>=your_tableÂ \Â  <span class="hljs-attr">--alter</span>="MODIFY COLUMN description <span class="hljs-built_in">varchar</span>(<span class="hljs-number">6000</span>)"Â \Â  <span class="hljs-attr">--dry-run</span>
</code></pre>
<p>--dry-runä¸ä¼šçœŸçš„æ”¹è¡¨ï¼Œä½†ä¼šå‘Šè¯‰ä½ è¿™ä¸ªæ”¹åŠ¨ä¼šèŠ±å¤šé•¿æ—¶é—´ï¼Œéœ€è¦å¤šå°‘èµ„æºã€‚
å¦‚æœè¾“å‡ºæ˜¾ç¤º"æ¨¡æ‹ŸæˆåŠŸ"ï¼ŒçœŸæ­£æ‰§è¡Œçš„æ—¶å€™æˆåŠŸç‡å°±å¾ˆé«˜ã€‚</p>
<p>ç¬¬äºŒé“ï¼šåŠ ä¸Šæ‰§è¡Œæ—¶é—´é™åˆ¶æŠŠè¿™ä¸ªå‚æ•°å†™è¿›my.cnf`</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mysqld]</span><span class="hljs-attr">max_execution_time</span>=<span class="hljs-number">300000</span>
</code></pre>
<p>æ‰€æœ‰æŸ¥è¯¢æœ€å¤šï¼Œè€—è´¹æ—¶é—´300ç§’ï¼ˆä¹Ÿå°±æ˜¯300000æ¯«ç§’ï¼‰ï¼Œè¦æ˜¯è¶…å‡ºæ—¶é—´å°±ä¼šè‡ªåŠ¨æ–­å¼€è¿æ¥ï¼Œä¸è¦è®©æ…¢æŸ¥è¯¢ä¸€ç›´å ç”¨èµ„æºä¸é‡Šæ”¾ã€‚ç¬¬ä¸‰é“ï¼šå…³é”®çš„DDLä¸€å®šåœ¨ä¸šåŠ¡ä½è°·æœŸæ‰§è¡Œã€‚å‡Œæ™¨3ç‚¹ä¿®æ”¹è¡¨æ ¼ï¼Œæ¸…æ™¨8ç‚¹åˆä¸Šçº¿ï¼Œå³ä¾¿å‡ºç°äº›è®¸é—®é¢˜ä¹Ÿä¸ä¼šå½±å“ç™½å¤©çš„ç”¨æˆ·ï¼Œç»“è¯­<strong>MySQLä¸»ä»å»¶è¿Ÿçš„æ ¹æºå¾€å¾€ä¸åœ¨ç½‘ç»œã€ä¸åœ¨ç£ç›˜ã€ä¹Ÿä¸åœ¨ç¼“å†²æ± ï¼Œè€Œåœ¨ä½ å¯¹DDLæ“ä½œçš„æ•¬ç•å¿ƒä¸å¤Ÿã€‚</strong>  ä¸€æ¡å°å°çš„ALTERTABLEï¼Œå¦‚æœå¤„ç†ä¸å½“ï¼Œå°±èƒ½æŠŠæ•´æ¡ä¸»ä»é“¾è·¯ç‚¸æ‰ï¼Œè®©ä½ æ’æŸ¥åŠå¤©è¿˜æ‘¸ä¸ç€å¤´è„‘ã€‚ç‰¢è®°è¿™ä¸ªé¡ºåºï¼Œå…ˆç”¨ï¼Œpt-online-schema-change--dry-runæ¥éªŒè¯ï¼Œå°çš„æ”¹åŠ¨ä½¿ç”¨INSTANTï¼Œå¤§çš„æ”¹åŠ¨é‡‡ç”¨gh-ostï¼Œå…³é”®æ“ä½œï¼Œè®¾ç½®maxexecution_timeï¼Œæ¥ç€æŒ‘é€‰ä¸€ä¸ªä¸šåŠ¡ä½å³°æœŸå»æ‰§è¡Œï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œ1000ç§’çš„å»¶è¿Ÿé›ªå´©ä¾¿æ°¸è¿œä¸ä¼šåˆ°æ¥ã€‚å¦‚æœè¿™ç¯‡æ–‡ç« å¸®ä½ é¿å…äº†ä¸€æ¬¡çº¿ä¸Šäº‹æ•…ï¼Œæœ€å¥½çš„å›æŠ¥å°±æ˜¯å…³æ³¨å’Œè½¬å‘ã€‚<br/>
è®©æ›´å¤šäººçŸ¥é“DDLæ“ä½œçš„æ­£ç¡®æ‰“å¼€æ–¹å¼ï¼Œå’±ä»¬ä¸€èµ·æŠŠæ•°æ®åº“æç¨³å®šã€‚</p>
<p>å£°æ˜ï¼Œæœ¬æ–‡å†…å®¹ä¹æˆæ˜¯æœ¬äººåŸåˆ›ï¼Œå°‘é‡ç´ æç»è¿‡AIè¾…åŠ©ç”Ÿæˆï¼Œå¹¶ä¸”æ‰€æœ‰å†…å®¹éƒ½ç»è¿‡æœ¬äººä¸¥æ ¼æ ¸æŸ¥ï¼Œå›¾ç‰‡ç´ æï¼Œéƒ½æ¥è‡ªçœŸå®ç´ ææˆ–è€…AIåŸåˆ›ï¼Œæ–‡ç« æ—¨åœ¨å®£æ‰¬æ­£èƒ½é‡ï¼Œæ²¡æœ‰ä½ä¿—ä¸è‰¯å¯¼å‘ï¼Œå¸Œæœ›è¯»è€…çŸ¥é“ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€MCPå…¥é—¨ç¯‡ã€‘ä»0åˆ°1æ•™ä½ æ­å»ºMCPæœåŠ¡]]></title>    <link>https://juejin.cn/post/7585452404113522703</link>    <guid>https://juejin.cn/post/7585452404113522703</guid>    <pubDate>2025-12-20T13:06:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585452404113522703" data-draft-id="7585476892976119842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€MCPå…¥é—¨ç¯‡ã€‘ä»0åˆ°1æ•™ä½ æ­å»ºMCPæœåŠ¡"/> <meta itemprop="keywords" content="åç«¯,MCP"/> <meta itemprop="datePublished" content="2025-12-20T13:06:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="omenkk7"/> <meta itemprop="url" content="https://juejin.cn/user/933901076016858"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€MCPå…¥é—¨ç¯‡ã€‘ä»0åˆ°1æ•™ä½ æ­å»ºMCPæœåŠ¡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933901076016858/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    omenkk7
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:06:26.000Z" title="Sat Dec 20 2025 13:06:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MCPåŸºç¡€æ¦‚å¿µè®²è§£</h2>
<h3 data-id="heading-1">ä¸ºä»€ä¹ˆéœ€è¦MCP</h3>
<p>å¯¹äºä¸åŒå‚å•†æä¾›çš„å¤§æ¨¡å‹ å¯¹FunctionCallingçš„æ ¼å¼è¦æ±‚å„ä¸ç›¸åŒ åœ¨å¯¹æ¥å¤šä¸ªå¤§æ¨¡å‹æ—¶</p>
<p>å¼€å‘è€…éœ€è¦ä¸ºæ¯ç§æ¨¡å‹ç¼–å†™é€‚é…é€»è¾‘ è¿™ç§æƒ…å†µä¸‹ç»´æŠ¤æˆæœ¬éå¸¸é«˜</p>
<p>å› æ­¤éœ€è¦æœ‰ä¸€ç§ç»Ÿä¸€çš„è§„èŒƒ è§„èŒƒå·¥å…·çš„æè¿° è°ƒç”¨ å“åº”ç­‰</p>
<p>ä½¿å¾—å·¥å…·æœåŠ¡åªéœ€è¦æŒ‰ç…§è¿™ç§è§„èŒƒå»å®ç° å°±å¯ä»¥è¢«ä»»æ„æ”¯æŒMCPçš„LLMå®¢æˆ·ç«¯è°ƒç”¨</p>
<h3 data-id="heading-2">ä»€ä¹ˆæ˜¯MCP</h3>
<p>MCPå°±æ˜¯<strong>ä¸€ç§æ ‡å‡†åŒ–å·¥å…·è°ƒç”¨åè®®è§„èŒƒ</strong></p>
<p>ä»–è§£å†³äº†ä»¥ä¸‹é—®é¢˜:</p>
<ul>
<li>å·¥å…·æœåŠ¡æ€ä¹ˆæš´éœ²å‡ºèƒ½åŠ›</li>
<li>è°ƒç”¨ç«¯å¦‚ä½•å»å£°æ˜è‡ªå·±æœ‰å“ªäº›å·¥å…·</li>
<li>æ¨¡å‹å¦‚ä½•å‘ç°å¯ç”¨å·¥å…·</li>
<li>æ¨¡å‹å¦‚ä½•å‘èµ·å·¥å…·è°ƒç”¨</li>
<li>è°ƒç”¨ç»“æœå¦‚ä½•è¿”å›å¹¶ä¸”ç»§ç»­æ¨ç†</li>
</ul>
<p><strong>å·¥å…·æœåŠ¡åªéœ€è¦æŒ‰ç…§è¿™ç§è§„èŒƒå»æ„å»ºåº”ç”¨</strong></p>
<p><strong>LLM</strong> <strong>å®¢æˆ·ç«¯åœ¨å’Œ</strong> <strong>å¤§æ¨¡å‹</strong> <strong>è¿›è¡Œäº¤äº’çš„æ—¶å€™ å°†</strong> <strong>MCP</strong> <strong>å·¥å…·æè¿°è½¬æ¢ä¸ºå¯¹åº”æ¨¡å‹æ‰€éœ€è¦çš„Function Toolå‚æ•°</strong></p>
<p><strong>å½“</strong> <strong>å¤§æ¨¡å‹</strong> <strong>å†³å®šè°ƒç”¨å·¥å…·çš„æ—¶å€™ ä¼šè¿”å›ä¸€ä¸ªå·¥å…·è°ƒç”¨çš„è¯·æ±‚</strong> <strong>MCP</strong> <strong>å»æ‹¦æˆªè¯¥è¯·æ±‚ å°†å…¶è½¬å‘ç»™å¯¹åº”çš„MCP Serveræ‰§è¡Œ</strong></p>
<p>å†å°†ç»“æœå›å¡«ç»™å¤§æ¨¡å‹ è®©å¤§æ¨¡å‹ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8039fa6aa4864687801b19319cf499cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb21lbmtrNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766840786&amp;x-signature=0F%2BKpWlvE8l2mxr6eIbPDlyKNI4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">SpringAIæ­å»ºMCP-Server</h2>
<p>æœ¬æ–‡ä»¥Javaè¯­è¨€ é€šè¿‡SpringAIä¸ºä¾‹ è®²è§£Stdio SSEä¸¤ç§å½¢å¼çš„MCP-Serverçš„å®Œæ•´æµç¨‹</p>
<p>å®ç°ä¸€ä¸ªåŠ å‡ä¹˜é™¤çš„Tool é€‚åˆæƒ³è¦å…¥é—¨å­¦ä¹ MCPçš„å°ç™½</p>
<h3 data-id="heading-4">STDIOæ¨¡å¼</h3>
<p>åˆ›å»ºåŸºäºè¿›ç¨‹å†…é€šä¿¡çš„ä¼ è¾“</p>
<p>å½“ä½ ä½¿ç”¨ STDIO ä¼ è¾“æ–¹å¼è¿æ¥ MCP æœåŠ¡æ—¶ï¼Œå®¢æˆ·ç«¯é€šå¸¸ä¼šåˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹æ¥è¿è¡Œä½ çš„ MCP æœåŠ¡ç¨‹åº</p>
<h4 data-id="heading-5">å¼•å…¥ä¾èµ–</h4>
<p>æœ¬æ–‡ä»¥1.0.0-RC1ç‰ˆæœ¬ä¸ºä¾‹ éœ€è¦å¼•å…¥å¦‚ä¸‹ä¾èµ–:</p>
<p>spring-ai-starter-mcp-serveræä¾›äº†å¿«é€Ÿæ„å»º MCPæœåŠ¡å™¨çš„åŠŸèƒ½</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">spring-ai.version</span>&gt;</span>1.0.0-RC1<span class="hljs-tag">&lt;/<span class="hljs-name">spring-ai.version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-starter-mcp-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-bom<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-ai.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>
</code></pre>
<h4 data-id="heading-6">åˆ›å»ºå·¥å…·æœåŠ¡</h4>
<p>SpringAIæä¾›äº†Toolæ³¨è§£ é€šè¿‡Toolæ³¨è§£ å¯ä»¥å°†æˆ‘ä»¬å®šä¹‰çš„æ–¹æ³•å®šä¹‰ä¸ºä¸€ç§å·¥å…·</p>
<p>é€šè¿‡descriptionæ¥æè¿°è¿™ä¸ªå·¥å…·çš„ä½œç”¨ è¿™æ˜¯ç»™AIçœ‹çš„</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> cn.omenkk.service;

<span class="hljs-keyword">import</span> org.springframework.ai.tool.annotation.Tool;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-comment">/**
* <span class="hljs-doctag">@author</span> omenkk7
* <span class="hljs-doctag">@description</span> æ•°å­¦å·¥å…·ç±»ï¼Œæä¾›åŸºæœ¬çš„åŠ å‡ä¹˜é™¤è¿ç®—
* <span class="hljs-doctag">@create</span> 2025/12/20
*/</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MathTool</span> {

    <span class="hljs-comment">/**
* åŠ æ³•è¿ç®—
* <span class="hljs-doctag">@param</span> a ç¬¬ä¸€ä¸ªæ•°
* <span class="hljs-doctag">@param</span> b ç¬¬äºŒä¸ªæ•°
* <span class="hljs-doctag">@return</span> ä¸¤æ•°ä¹‹å’Œ
*/</span>
<span class="hljs-meta">@Tool(description = "æ‰§è¡ŒåŠ æ³•è¿ç®—ï¼Œè®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
        <span class="hljs-keyword">return</span> a + b;
    }

    <span class="hljs-comment">/**
* å‡æ³•è¿ç®—
* <span class="hljs-doctag">@param</span> a è¢«å‡æ•°
* <span class="hljs-doctag">@param</span> b å‡æ•°
* <span class="hljs-doctag">@return</span> ä¸¤æ•°ä¹‹å·®
*/</span>
<span class="hljs-meta">@Tool(description = "æ‰§è¡Œå‡æ³•è¿ç®—ï¼Œè®¡ç®—ä¸¤ä¸ªæ•°çš„å·®")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">subtract</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
        <span class="hljs-keyword">return</span> a - b;
    }

    <span class="hljs-comment">/**
* ä¹˜æ³•è¿ç®—
* <span class="hljs-doctag">@param</span> a ç¬¬ä¸€ä¸ªæ•°
* <span class="hljs-doctag">@param</span> b ç¬¬äºŒä¸ªæ•°
* <span class="hljs-doctag">@return</span> ä¸¤æ•°ä¹‹ç§¯
*/</span>
<span class="hljs-meta">@Tool(description = "æ‰§è¡Œä¹˜æ³•è¿ç®—ï¼Œè®¡ç®—ä¸¤ä¸ªæ•°çš„ç§¯")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">multiply</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
        <span class="hljs-keyword">return</span> a * b;
    }

    <span class="hljs-comment">/**
* é™¤æ³•è¿ç®—
* <span class="hljs-doctag">@param</span> a è¢«é™¤æ•°
* <span class="hljs-doctag">@param</span> b é™¤æ•°
* <span class="hljs-doctag">@return</span> ä¸¤æ•°ä¹‹å•†
* <span class="hljs-doctag">@throws</span> IllegalArgumentException å½“é™¤æ•°ä¸º0æ—¶æŠ›å‡ºå¼‚å¸¸
*/</span>
<span class="hljs-meta">@Tool(description = "æ‰§è¡Œé™¤æ³•è¿ç®—ï¼Œè®¡ç®—ä¸¤ä¸ªæ•°çš„å•†")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">double</span> <span class="hljs-title function_">divide</span><span class="hljs-params">(<span class="hljs-type">double</span> a, <span class="hljs-type">double</span> b)</span> {
        <span class="hljs-keyword">if</span> (b == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"é™¤æ•°ä¸èƒ½ä¸º0"</span>);
        }
        <span class="hljs-keyword">return</span> a / b;
    }

}
</code></pre>
<h4 data-id="heading-7">åˆ›å»ºä½ çš„Spring Application</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpDemo3Application</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">McpDemo3Application</span>.<span class="hljs-property">class</span>, args);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ToolCallbackProvider</span> <span class="hljs-title function_">mathTools</span>(<span class="hljs-params">MathTool mathTool</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">MethodToolCallbackProvider</span>.<span class="hljs-title function_">builder</span>().<span class="hljs-title function_">toolObjects</span>(mathTool).<span class="hljs-title function_">build</span>();
    }
}
</code></pre>
<h4 data-id="heading-8">æ„å»ºé¡¹ç›®</h4>
<p>æ‰§è¡Œmvn package å°†é¡¹ç›®æ‰“æˆjaråŒ…</p>
<h4 data-id="heading-9">åœ¨å®¢æˆ·ç«¯ä½¿ç”¨</h4>
<pre><code class="hljs language-swift" lang="swift">{
  <span class="hljs-string">"mcpServers"</span>: {
    <span class="hljs-string">"è®¡ç®—MCP"</span>: {
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"è®¡ç®—MCP"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">""</span>,
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"stdio"</span>,
      <span class="hljs-string">"command"</span>: <span class="hljs-string">"C:\Users\è¿åº†è¾‰\AppData\Local\Programs\Eclipse Adoptium\jdk-17.0.17.10-hotspot\bin\java.exe"</span>,
      <span class="hljs-string">"args"</span>: [
       <span class="hljs-comment">// ç¦ç”¨ Spring Boot Web åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆSTDIO æ¨¡å¼ä¸éœ€è¦å¯åŠ¨HTTPæœåŠ¡å™¨ï¼‰</span>
        <span class="hljs-string">"-Dspring.main.web-application-type=none"</span>,  
        <span class="hljs-comment">// // å¯ç”¨ MCP æœåŠ¡å™¨çš„ STDIO ä¼ è¾“æ¨¡å¼</span>
        <span class="hljs-string">"-Dspring.ai.mcp.server.stdio=true"</span>,
        <span class="hljs-string">"-jar"</span>,
        <span class="hljs-string">"G:\ai-agent\code\mcp-demo2<span class="hljs-subst">\t</span>arget\mcp-demo2-0.0.1-SNAPSHOT.jar"</span>
      ],
      <span class="hljs-string">"environmentVariables"</span>: {
      },
      <span class="hljs-string">"timeout"</span>: <span class="hljs-number">60</span>
    }
  }
}
</code></pre>
<p>æˆ‘æ˜¯åœ¨Cherry studioä¸Šè·‘çš„ åƒç±»ä¼¼çš„åº”ç”¨ å¦‚cursor Traeä¸Šå‡å¯ä»¥ä½¿ç”¨</p>
<p>è¯»è€…å¯ä»¥æ£€ç´¢èµ„æ–™ å°è¯•åšä¸€ä¸ªMCP Client å¯¹æ¥è‡ªå·±çš„MCP Server</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a92625c4a6cf4bcebcc36f1ac4707c95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb21lbmtrNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766840786&amp;x-signature=j2xArvukl61DJboxrVnCnnYyrZc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">SSEæ¨¡å¼</h3>
<p>SSE æ˜¯åŸºäº HTTP åè®®çš„ä¸€ç§â€œå•å‘ã€æœåŠ¡å™¨ä¸»åŠ¨æ¨é€â€çš„é•¿è¿æ¥é€šä¿¡æœºåˆ¶ å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡SpringMVCæ¥æ„å»º</p>
<p>é€šè¿‡SSEæ¨¡å¼è·‘çš„MCPæœåŠ¡ å¯ä»¥éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸Š é€šè¿‡SSEè¿æ¥å‘å¤–æä¾›åŠŸèƒ½</p>
<p>ä¸‹é¢æˆ‘é‡‡ç”¨çš„æ˜¯1.1.2çš„ç‰ˆæœ¬spring-ai-bom å®ƒèƒ½å¤Ÿå¸®ä½ ç®¡ç†spring-aiç›¸å…³ä¾èµ–çš„ç‰ˆæœ¬</p>
<h4 data-id="heading-11">å¼•å…¥ä¾èµ–</h4>
<p>é‡ç‚¹æ˜¯å¼•å…¥spring-ai-starter-mcp-server-webmvcä¾èµ–:</p>
<ul>
<li>ä½¿ç”¨ Spring MVC çš„åŸºäº HTTP çš„ä¼ è¾“</li>
<li>è‡ªåŠ¨é…ç½® SSE ä¼ è¾“æ‰€éœ€çš„ Web ç«¯ç‚¹ä¸ Controlleræˆ–å¤„ç†æµå¼å“åº”é€»è¾‘ï¼Œæ— éœ€é¢å¤–ç¼–ç ã€‚</li>
<li>å¯é€‰<code>STDIO</code>ä¼ è¾“ï¼ˆé€šè¿‡è®¾ç½®å¯ç”¨<code>spring.ai.mcp.server.stdio=true</code>ï¼‰</li>
<li>åŒ…å«<code>spring-boot-starter-web</code>ä¾èµ–é¡¹</li>
</ul>
<pre><code class="hljs language-xml" lang="xml">
<span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>17<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">spring-ai.version</span>&gt;</span>1.1.2<span class="hljs-tag">&lt;/<span class="hljs-name">spring-ai.version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-bom<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-ai.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.ai<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-ai-starter-mcp-server-webmvc<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># spring.main.web-application-type=none</span>

<span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> You must disable the banner and the console logging</span>
<span class="hljs-comment"># to allow the STDIO transport to work !!!</span>
<span class="hljs-attr">spring.main.banner-mode</span>=<span class="hljs-literal">off</span>
<span class="hljs-comment"># logging.pattern.console=</span>

<span class="hljs-comment"># spring.ai.mcp.server.stdio=false</span>

<span class="hljs-attr">spring.ai.mcp.server.name</span>=my-weather-server
<span class="hljs-attr">spring.ai.mcp.server.version</span>=<span class="hljs-number">0.0</span>.<span class="hljs-number">1</span>

<span class="hljs-attr">spring.ai.mcp.server.protocol</span>=STREAMABLE
<span class="hljs-comment"># spring.ai.mcp.server.protocol=STATELESS</span>

<span class="hljs-attr">logging.file.name</span>=./model-context-protocol/weather/starter-webmvc-server/target/starter-webmvc-server.log
</code></pre>
<h4 data-id="heading-12">åˆ›å»ºå·¥å…·æœåŠ¡</h4>
<p>ä¸SSEæ¨¡å¼ç±»ä¼¼ ä¸å†èµ˜è¿°</p>
<h4 data-id="heading-13">åˆ›å»ºä½ çš„SpringApplication</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpDemo3Application</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">McpDemo3Application</span>.<span class="hljs-property">class</span>, args);
    }

<span class="hljs-comment">//æ˜¾å¼æ‰‹åŠ¨æ³¨å†Œä½ çš„å·¥å…·æœåŠ¡</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ToolCallbackProvider</span> <span class="hljs-title function_">mathTools</span>(<span class="hljs-params">MathTool mathTool</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">MethodToolCallbackProvider</span>.<span class="hljs-title function_">builder</span>().<span class="hljs-title function_">toolObjects</span>(mathTool).<span class="hljs-title function_">build</span>();
    }
}
</code></pre>
<h4 data-id="heading-14">åœ¨å®¢æˆ·ç«¯ä½¿ç”¨</h4>
<p>é¦–å…ˆéœ€è¦åœ¨æœ¬åœ°æˆ–è€…æœåŠ¡å™¨å¯åŠ¨ä½ çš„WebæœåŠ¡ æ¥ä¸‹æ¥ æš´éœ²ä½ çš„æœåŠ¡ç»™å®¢æˆ·ç«¯ è®©ä»–çŸ¥é“æ€ä¹ˆå»è°ƒç”¨ä½ çš„æœåŠ¡</p>
<pre><code class="hljs language-css" lang="css">{
  "mcpServers": {
    "æ•°å­¦è¿ç®—æœåŠ¡<span class="hljs-number">1</span>": {
      "name": <span class="hljs-string">"æ•°å­¦è¿ç®—æœåŠ¡1"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">""</span>,
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"streamableHttp"</span>,
      <span class="hljs-string">"url"</span>: <span class="hljs-string">"http://localhost:8080/mcp"</span>,
      <span class="hljs-string">"headers"</span>: {
        "<span class="hljs-attribute">Content</span>-Type": <span class="hljs-string">"application/json"</span>,
        <span class="hljs-string">"Authorization"</span>: <span class="hljs-string">"Bearer token"</span>
      },
      "timeout": <span class="hljs-number">60</span>,
      <span class="hljs-string">"advancedSettings"</span>: {}
    }
  }
}
</code></pre>
<h4 data-id="heading-15">ç¤ºä¾‹</h4>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42eca20f5cba43d789636c0b9b67cf1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb21lbmtrNw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766840786&amp;x-signature=%2BKZn9cP%2FDoEi7KlYY%2FJpRISLVZs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-16">å°ç»“</h2>
<p>æœ¬æ–‡è®²è§£äº†å…³äºMCP ä»¥åŠç®€å•è®²è§£äº†æ€ä¹ˆä½¿ç”¨SpringAIå»åˆ›å»ºä¸€ä¸ªMCP Server</p>
<p>å¦‚æœå¯¹ä½ æœ‰å¸®åŠ© è¯·ç‚¹ä¸ªèµè°¢è°¢!!!</p>
<p><strong>å‚è€ƒèµ„æ–™:</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.spring.io%2Fspring-ai%2Freference%2F1.0%2Fapi%2Fmcp%2Fmcp-server-boot-starter-docs.html" target="_blank" title="https://docs.spring.io/spring-ai/reference/1.0/api/mcp/mcp-server-boot-starter-docs.html" ref="nofollow noopener noreferrer">docs.spring.io/spring-ai/râ€¦</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fspring-projects%2Fspring-ai-examples" target="_blank" title="https://github.com/spring-projects/spring-ai-examples" ref="nofollow noopener noreferrer">github.com/spring-projâ€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot é’©å­å…¨é›†å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼š`EnvironmentPostProcessor` è¯¦è§£]]></title>    <link>https://juejin.cn/post/7585502118459473939</link>    <guid>https://juejin.cn/post/7585502118459473939</guid>    <pubDate>2025-12-20T13:08:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585502118459473939" data-draft-id="7585474459776843812" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Spring Boot é’©å­å…¨é›†å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼š`EnvironmentPostProcessor` è¯¦è§£"/> <meta itemprop="keywords" content="Java,Spring"/> <meta itemprop="datePublished" content="2025-12-20T13:08:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Webå¤©æ¢¯ä¹‹è·¯"/> <meta itemprop="url" content="https://juejin.cn/user/2825061103052843"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Spring Boot é’©å­å…¨é›†å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼š`EnvironmentPostProcessor` è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2825061103052843/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Webå¤©æ¢¯ä¹‹è·¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:08:11.000Z" title="Sat Dec 20 2025 13:08:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring Boot é’©å­å…¨é›†å®æˆ˜ï¼ˆä¸‰ï¼‰ï¼š<code>EnvironmentPostProcessor</code>Â è¯¦è§£</h2>
<p>åœ¨ä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä»¬èšç„¦äº† Spring Boot å¯åŠ¨æœ€æ—©çš„æ‰©å±•ç‚¹Â <code>SpringApplicationRunListener.starting()</code>ï¼Œè§£å†³äº†å¯åŠ¨ç›‘æ§ã€å¤±è´¥å‘Šè­¦ç­‰æ ¸å¿ƒé—®é¢˜ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ·±å…¥è®²è§£<strong>é…ç½®åŠ è½½é˜¶æ®µçš„æ ¸å¿ƒæ‰©å±•ç‚¹</strong>â€”â€”<code>EnvironmentPostProcessor</code>ï¼Œå®ƒæ˜¯å®šåˆ¶åŒ–é…ç½®åŠ è½½ã€åŠ¨æ€é…ç½®æ³¨å…¥ã€é…ç½®åŠ å¯†è§£å¯†çš„ â€œé»„é‡‘å…¥å£â€ï¼Œä¹Ÿæ˜¯ç”Ÿäº§ç¯å¢ƒä¸­é…ç½®æ²»ç†çš„æ ¸å¿ƒå·¥å…·ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€ä»€ä¹ˆæ˜¯Â <code>EnvironmentPostProcessor</code>ï¼Ÿ</h3>
<p><code>EnvironmentPostProcessor</code>Â æ˜¯ Spring Boot æä¾›çš„é…ç½®åç½®å¤„ç†æ‰©å±•ç‚¹ï¼Œåœ¨ä»¥ä¸‹æ—¶æœºè¢«è§¦å‘ï¼š</p>
<ul>
<li><strong>Environment å·²åˆå§‹åŒ–</strong>ï¼ˆä½†æœªå®Œå…¨åŠ è½½æ‰€æœ‰é…ç½®æºï¼‰ï¼›</li>
<li><strong>åº”ç”¨é…ç½®æ–‡ä»¶ï¼ˆapplication.yml/propertiesï¼‰å·²è¯»å–ï¼Œä½†æœªç”Ÿæ•ˆ</strong>ï¼›</li>
<li><strong>ApplicationContext å°šæœªåˆ›å»º</strong>ï¼Œä½†å¯ä¿®æ”¹ Environment ä¸­çš„é…ç½®ï¼›</li>
<li><strong>æ‰§è¡Œä¼˜å…ˆçº§é«˜äºÂ <code>@Configuration</code>ã€<code>@Value</code>Â ç­‰é…ç½®æ³¨å…¥é€»è¾‘</strong>ã€‚</li>
</ul>
<blockquote>
<p>âœ…Â <strong>æ ¸å¿ƒä»·å€¼</strong>ï¼šåœ¨é…ç½®æœ€ç»ˆç”Ÿæ•ˆå‰ï¼Œå¯¹é…ç½®è¿›è¡ŒåŠ¨æ€ä¿®æ”¹ã€è¡¥å……ã€åŠ å¯†è§£å¯†ï¼Œå®ç°é…ç½®çš„ç»Ÿä¸€æ²»ç†ã€‚</p>
</blockquote>
<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™ä¸ªæ‰©å±•ç‚¹å¸¸ç”¨äºè§£å†³ â€œé…ç½®ä¸­å¿ƒåŒ–â€â€œé…ç½®åŠ å¯†â€â€œå¤šç¯å¢ƒé…ç½®åŠ¨æ€åˆ‡æ¢â€ ç­‰æ ¸å¿ƒé—®é¢˜ã€‚</p>
<h3 data-id="heading-2">äºŒã€åœºæ™¯ 1ï¼šé…ç½®ä¸­å¿ƒæ‹‰å–ï¼ˆæ›¿ä»£åŸç”Ÿé…ç½®æ–‡ä»¶ï¼‰</h3>
<h4 data-id="heading-3">ä¸šåŠ¡ç—›ç‚¹</h4>
<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè‹¥å°†é…ç½®å†™æ­»åœ¨Â <code>application.yml</code>Â ä¸­ï¼Œå­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>é…ç½®ä¸ä»£ç è€¦åˆï¼Œä¿®æ”¹é…ç½®éœ€é‡æ–°æ‰“åŒ…éƒ¨ç½²ï¼›</li>
<li>å¤šç¯å¢ƒï¼ˆdev/test/prodï¼‰é…ç½®ç®¡ç†æ··ä¹±ï¼Œæ˜“å‡ºé”™ï¼›</li>
<li>é…ç½®ç¼ºä¹ç»Ÿä¸€ç®¡æ§ï¼Œæ³„éœ²é£é™©é«˜ã€‚</li>
</ul>
<h4 data-id="heading-4">è§£å†³æ–¹æ¡ˆ</h4>
<p>åŸºäºÂ <code>EnvironmentPostProcessor</code>Â ä»é…ç½®ä¸­å¿ƒï¼ˆå¦‚ Nacos/Apollo/ æºç¨‹ Apolloï¼‰æ‹‰å–é…ç½®ï¼Œè¦†ç›–æœ¬åœ°é…ç½®ï¼Œå®ç°é…ç½®ä¸ä»£ç è§£è€¦ã€‚</p>
<h5 data-id="heading-5">å®ç°ä»£ç </h5>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">demo</span>.<span class="hljs-property">envprocessor</span>;

<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">env</span>.<span class="hljs-property">EnvironmentPostProcessor</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">core</span>.<span class="hljs-property">env</span>.<span class="hljs-property">ConfigurableEnvironment</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">core</span>.<span class="hljs-property">env</span>.<span class="hljs-property">MapPropertySource</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">core</span>.<span class="hljs-property">env</span>.<span class="hljs-property">MutablePropertySources</span>;

<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">HashMap</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Map</span>;

<span class="hljs-comment">/**
 * ç”Ÿäº§çº§é…ç½®ä¸­å¿ƒæ‹‰å–å¤„ç†å™¨
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigCenterEnvironmentPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EnvironmentPostProcessor</span> {

    <span class="hljs-comment">// æ¨¡æ‹Ÿé…ç½®ä¸­å¿ƒå®¢æˆ·ç«¯ï¼ˆç”Ÿäº§ç¯å¢ƒæ›¿æ¢ä¸ºçœŸå®Nacos/Apolloå®¢æˆ·ç«¯ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigCenterClient</span> {
        <span class="hljs-comment">// æ ¹æ®ç¯å¢ƒæ‹‰å–é…ç½®</span>
        <span class="hljs-keyword">public</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; <span class="hljs-title function_">pullConfig</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> env</span>) {
            <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; configMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒä»é…ç½®ä¸­å¿ƒæ‹‰å–çœŸå®é…ç½®</span>
            <span class="hljs-keyword">switch</span> (env) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"prod"</span>:
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.url"</span>, <span class="hljs-string">"jdbc:mysql://prod-mysql:3306/prod_db?useSSL=false"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.username"</span>, <span class="hljs-string">"prod_user"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.password"</span>, <span class="hljs-string">"prod_pass123"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"redis.host"</span>, <span class="hljs-string">"prod-redis:6379"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"app.prod.mode"</span>, <span class="hljs-string">"true"</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"test"</span>:
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.url"</span>, <span class="hljs-string">"jdbc:mysql://test-mysql:3306/test_db?useSSL=false"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.username"</span>, <span class="hljs-string">"test_user"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.password"</span>, <span class="hljs-string">"test_pass123"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"redis.host"</span>, <span class="hljs-string">"test-redis:6379"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"app.prod.mode"</span>, <span class="hljs-string">"false"</span>);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-attr">default</span>:
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.url"</span>, <span class="hljs-string">"jdbc:mysql://localhost:3306/dev_db?useSSL=false"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.username"</span>, <span class="hljs-string">"root"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"spring.datasource.password"</span>, <span class="hljs-string">"root"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"redis.host"</span>, <span class="hljs-string">"localhost:6379"</span>);
                    configMap.<span class="hljs-title function_">put</span>(<span class="hljs-string">"app.prod.mode"</span>, <span class="hljs-string">"false"</span>);
            }
            <span class="hljs-keyword">return</span> configMap;
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">postProcessEnvironment</span>(<span class="hljs-params">ConfigurableEnvironment environment, SpringApplication application</span>) {
        <span class="hljs-comment">// 1. è·å–å½“å‰æ¿€æ´»çš„ç¯å¢ƒï¼ˆé€šè¿‡å¯åŠ¨å‚æ•°/ç³»ç»Ÿå˜é‡ä¼ é€’ï¼‰</span>
        <span class="hljs-title class_">String</span>[] activeProfiles = environment.<span class="hljs-title function_">getActiveProfiles</span>();
        <span class="hljs-title class_">String</span> env = activeProfiles.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> ? activeProfiles[<span class="hljs-number">0</span>] : <span class="hljs-string">"dev"</span>;
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">printf</span>(<span class="hljs-string">"[é…ç½®ä¸­å¿ƒ] å¼€å§‹æ‹‰å– %s ç¯å¢ƒé…ç½®%n"</span>, env);

        <span class="hljs-comment">// 2. ä»é…ç½®ä¸­å¿ƒæ‹‰å–é…ç½®</span>
        <span class="hljs-title class_">ConfigCenterClient</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConfigCenterClient</span>();
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; configMap = client.<span class="hljs-title function_">pullConfig</span>(env);

        <span class="hljs-comment">// 3. å°†é…ç½®æ³¨å…¥Environmentï¼ˆä¼˜å…ˆçº§é«˜äºæœ¬åœ°é…ç½®ï¼‰</span>
        <span class="hljs-title class_">MutablePropertySources</span> propertySources = environment.<span class="hljs-title function_">getPropertySources</span>();
        <span class="hljs-comment">// æ·»åŠ åˆ°æœ€å‰é¢ï¼Œç¡®ä¿ä¼˜å…ˆçº§æœ€é«˜</span>
        propertySources.<span class="hljs-title function_">addFirst</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapPropertySource</span>(<span class="hljs-string">"configCenterProperties"</span>, configMap));

        <span class="hljs-comment">// 4. æ‰“å°åŠ è½½ç»“æœï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®ç”¨SLF4Jï¼‰</span>
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">printf</span>(<span class="hljs-string">"[é…ç½®ä¸­å¿ƒ] æˆåŠŸåŠ è½½ %d ä¸ªé…ç½®é¡¹ï¼Œç¯å¢ƒï¼š%s%n"</span>, configMap.<span class="hljs-title function_">size</span>(), env);
        configMap.<span class="hljs-title function_">forEach</span>((key, value) -&gt; {
            <span class="hljs-comment">// å¯†ç è„±æ•è¾“å‡º</span>
            <span class="hljs-title class_">String</span> displayValue = key.<span class="hljs-title function_">contains</span>(<span class="hljs-string">"password"</span>) ? <span class="hljs-string">"******"</span> : <span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(value);
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">printf</span>(<span class="hljs-string">"[é…ç½®ä¸­å¿ƒ] %s = %s%n"</span>, key, displayValue);
        });
    }
}
</code></pre>
<h5 data-id="heading-6">é…ç½®åŠ è½½</h5>
<p>åœ¨Â <code>resources/META-INF/spring.factories</code>Â ä¸­é…ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">org.springframework.boot.env.EnvironmentPostProcessor</span>=\
com.example.demo.envprocessor.ConfigCenterEnvironmentPostProcessor
</code></pre>
<h5 data-id="heading-7">å¯åŠ¨æµ‹è¯•</h5>
<p>æ·»åŠ å¯åŠ¨å‚æ•°æ¿€æ´»ç”Ÿäº§ç¯å¢ƒï¼š<code>--spring.profiles.active=prod</code></p>
<h5 data-id="heading-8">è¾“å‡º</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> å¼€å§‹æ‹‰å– prod ç¯å¢ƒé…ç½®
<span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> æˆåŠŸåŠ è½½ 5 ä¸ªé…ç½®é¡¹ï¼Œç¯å¢ƒï¼šprod
<span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> <span class="hljs-attr">spring.datasource.username</span> = prod_user
<span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> <span class="hljs-attr">spring.datasource.url</span> = jdbc:mysql://prod-mysql:<span class="hljs-number">3306</span>/prod_db?useSSL=<span class="hljs-literal">false</span>
<span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> <span class="hljs-attr">redis.host</span> = prod-redis:<span class="hljs-number">6379</span>
<span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> <span class="hljs-attr">app.prod.mode</span> = <span class="hljs-literal">true</span>
<span class="hljs-section">[é…ç½®ä¸­å¿ƒ]</span> <span class="hljs-attr">spring.datasource.password</span> = ******

  .   ____          _            __ _ _
 /\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )___ | '_ | '_| | '_ / _` | \ \ \ \
 \/  ___)| |_)| | | | | || (_| |  ) ) ) )
  '  |____| .__|_| |_|_| |___, | / / / /
 =========|_|==============|___/=/_/_/_/

 :: Spring Boot ::                (v3.5.8)

2025-12-11T21:46:23.284+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> com.example.demo.DemoApplication         : Starting DemoApplication using Java 21.0.9 with PID 10075 (/Users/wangmingfei/Documents/ä¸ªäºº/05 javaå¤©æ¢¯ä¹‹è·¯/01 æºç /03 æ¯æ—¥æ‰“å¡ç³»åˆ—/daily-check-in/springbooté’©å­/demo/target/classes started by wangmingfei in /Users/wangmingfei/Documents/ä¸ªäºº/05 javaå¤©æ¢¯ä¹‹è·¯/01 æºç /03 æ¯æ—¥æ‰“å¡ç³»åˆ—/daily-check-in/springbooté’©å­/demo)
2025-12-11T21:46:23.288+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> com.example.demo.DemoApplication         : The following 1 profile is active: "prod"
2025-12-11T21:46:23.575+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8080 (http)
2025-12-11T21:46:23.582+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> o.apache.catalina.core.StandardService   : Starting service <span class="hljs-section">[Tomcat]</span>
2025-12-11T21:46:23.582+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> o.apache.catalina.core.StandardEngine    : Starting Servlet engine: <span class="hljs-section">[Apache Tomcat/10.1.49]</span>
2025-12-11T21:46:23.600+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> o.a.c.c.C.<span class="hljs-section">[Tomcat]</span>.<span class="hljs-section">[localhost]</span>.<span class="hljs-section">[/]</span>       : Initializing Spring embedded WebApplicationContext
2025-12-11T21:46:23.600+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 298 ms
2025-12-11T21:46:23.739+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8080 (http) with context path '/'
2025-12-11T21:46:23.743+08:00  INFO 10075 --- <span class="hljs-section">[           main]</span> com.example.demo.DemoApplication         : Started DemoApplication in 9.056 seconds (process running for 9.206)
</code></pre>
<h5 data-id="heading-9">ç”Ÿäº§ä»·å€¼</h5>
<ul>
<li>é…ç½®ä¸ä»£ç è§£è€¦ï¼Œä¿®æ”¹é…ç½®æ— éœ€é‡æ–°éƒ¨ç½²ï¼›</li>
<li>å¤šç¯å¢ƒé…ç½®ç»Ÿä¸€ç®¡æ§ï¼Œé¿å…é…ç½®æ··ä¹±ï¼›</li>
<li>é…ç½®ä¸­å¿ƒå¯å®ç°é…ç½®çƒ­æ›´æ–°ã€ç°åº¦å‘å¸ƒç­‰é«˜çº§ç‰¹æ€§ï¼›</li>
<li>é…ç½®æ‹‰å–è¿‡ç¨‹å¯å¢åŠ é‰´æƒã€åŠ å¯†ï¼Œæå‡å®‰å…¨æ€§ã€‚</li>
</ul>
<h3 data-id="heading-10">ä¸‰ã€åœºæ™¯ 2ï¼šé…ç½®åŠ å¯†è§£å¯†ï¼ˆæ•æ„Ÿé…ç½®é˜²æ³„éœ²ï¼‰</h3>
<h4 data-id="heading-11">ä¸šåŠ¡ç—›ç‚¹</h4>
<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ•°æ®åº“å¯†ç ã€Redis å¯†ç ã€æ¥å£å¯†é’¥ç­‰æ•æ„Ÿé…ç½®è‹¥æ˜æ–‡å­˜å‚¨ï¼Œå­˜åœ¨ä¸¥é‡å®‰å…¨é£é™©ï¼š</p>
<ul>
<li>é…ç½®æ–‡ä»¶æ³„éœ²å¯¼è‡´æ•æ„Ÿä¿¡æ¯è¢«ç›—ï¼›</li>
<li>è¿ç»´äººå‘˜å¯ç›´æ¥æŸ¥çœ‹æ˜æ–‡å¯†ç ï¼Œä¸ç¬¦åˆå®‰å…¨è§„èŒƒï¼›</li>
<li>å®¡è®¡æ— æ³•è¿½æº¯å¯†ç ä½¿ç”¨è®°å½•ã€‚</li>
</ul>
<h4 data-id="heading-12">è§£å†³æ–¹æ¡ˆ</h4>
<p>åŸºäºÂ <code>EnvironmentPostProcessor</code>Â å¯¹åŠ å¯†çš„é…ç½®è¿›è¡Œè§£å¯†ï¼Œæ•æ„Ÿé…ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­ä»¥å¯†æ–‡å­˜å‚¨ï¼Œè¿è¡Œæ—¶åŠ¨æ€è§£å¯†ã€‚</p>
<h5 data-id="heading-13">å®ç°ä»£ç </h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.envprocessor;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.env.EnvironmentPostProcessor;
<span class="hljs-keyword">import</span> org.springframework.core.env.ConfigurableEnvironment;
<span class="hljs-keyword">import</span> org.springframework.core.env.PropertySource;
<span class="hljs-keyword">import</span> org.springframework.util.StringUtils;

<span class="hljs-keyword">import</span> javax.crypto.Cipher;
<span class="hljs-keyword">import</span> javax.crypto.spec.SecretKeySpec;
<span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;
<span class="hljs-keyword">import</span> java.util.Base64;

<span class="hljs-comment">/** * æ•æ„Ÿé…ç½®è§£å¯†å¤„ç†å™¨ */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EncryptedConfigEnvironmentPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EnvironmentPostProcessor</span> {

    <span class="hljs-comment">// åŠ å¯†å¯†é’¥ï¼ˆç”Ÿäº§ç¯å¢ƒä»å®‰å…¨å­˜å‚¨ä¸­è¯»å–ï¼Œå¦‚KMS/æœ¬åœ°åŠ å¯†æ–‡ä»¶ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ENCRYPT_KEY</span> <span class="hljs-operator">=</span> <span class="hljs-string">"prod_key_1234567"</span>; <span class="hljs-comment">// å®é™…ä½¿ç”¨éœ€16/24/32ä½</span>
    <span class="hljs-comment">// å¯†æ–‡å‰ç¼€æ ‡è¯†</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ENCRYPT_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"encrypt:"</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessEnvironment</span><span class="hljs-params">(ConfigurableEnvironment environment, SpringApplication application)</span> {
        System.out.println(<span class="hljs-string">"[é…ç½®è§£å¯†] å¼€å§‹å¤„ç†æ•æ„Ÿé…ç½®è§£å¯†"</span>);

        <span class="hljs-comment">// éå†æ‰€æœ‰é…ç½®æºï¼Œè§£å¯†æ•æ„Ÿé…ç½®</span>
        <span class="hljs-keyword">for</span> (PropertySource&lt;?&gt; propertySource : environment.getPropertySources()) {
            <span class="hljs-comment">// è·³è¿‡ç³»ç»Ÿé…ç½®æºï¼Œåªå¤„ç†åº”ç”¨é…ç½®</span>
            <span class="hljs-keyword">if</span> (propertySource.getName().startsWith(<span class="hljs-string">"system"</span>) || propertySource.getName().startsWith(<span class="hljs-string">"configCenter"</span>)) {
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-comment">// è§£å¯†æ ¸å¿ƒæ•æ„Ÿé…ç½®</span>
            decryptConfig(environment, <span class="hljs-string">"spring.datasource.password"</span>);
            decryptConfig(environment, <span class="hljs-string">"redis.password"</span>);
            decryptConfig(environment, <span class="hljs-string">"app.api.secret"</span>);
        }

        System.out.println(<span class="hljs-string">"[é…ç½®è§£å¯†] æ•æ„Ÿé…ç½®è§£å¯†å®Œæˆ"</span>);
    }

    <span class="hljs-comment">// è§£å¯†å•ä¸ªé…ç½®é¡¹</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">decryptConfig</span><span class="hljs-params">(ConfigurableEnvironment environment, String configKey)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> environment.getProperty(configKey);
        <span class="hljs-keyword">if</span> (StringUtils.hasText(value) &amp;&amp; value.startsWith(ENCRYPT_PREFIX)) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">// æˆªå–å¯†æ–‡éƒ¨åˆ†</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">cipherText</span> <span class="hljs-operator">=</span> value.substring(ENCRYPT_PREFIX.length());
                <span class="hljs-comment">// è§£å¯†</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">plainText</span> <span class="hljs-operator">=</span> decrypt(cipherText, ENCRYPT_KEY);
                <span class="hljs-comment">// æ›¿æ¢ä¸ºæ˜æ–‡ï¼ˆæ³¨å…¥åˆ°æœ€é«˜ä¼˜å…ˆçº§é…ç½®æºï¼‰</span>
                environment.getSystemProperties().put(configKey, plainText);
                System.out.printf(<span class="hljs-string">"[é…ç½®è§£å¯†] æˆåŠŸè§£å¯†é…ç½®é¡¹ï¼š%s%n"</span>, configKey);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"é…ç½®è§£å¯†å¤±è´¥ï¼š"</span> + configKey, e);
            }
        }
    }

    <span class="hljs-comment">// AESè§£å¯†å®ç°ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨éå¯¹ç§°åŠ å¯†RSAï¼‰</span>
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">decrypt</span><span class="hljs-params">(String cipherText, String key)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">secretKey</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(key.getBytes(StandardCharsets.UTF_8), <span class="hljs-string">"AES"</span>);
        <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(<span class="hljs-string">"AES/ECB/PKCS5Padding"</span>);
        cipher.init(Cipher.DECRYPT_MODE, secretKey);
        <span class="hljs-type">byte</span>[] decryptedBytes = cipher.doFinal(Base64.getDecoder().decode(cipherText));
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(decryptedBytes, StandardCharsets.UTF_8);
    }

    <span class="hljs-comment">// åŠ å¯†æ–¹æ³•ï¼ˆç”¨äºç”Ÿæˆå¯†æ–‡é…ç½®ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">encrypt</span><span class="hljs-params">(String plainText, String key)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">SecretKeySpec</span> <span class="hljs-variable">secretKey</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SecretKeySpec</span>(key.getBytes(StandardCharsets.UTF_8), <span class="hljs-string">"AES"</span>);
        <span class="hljs-type">Cipher</span> <span class="hljs-variable">cipher</span> <span class="hljs-operator">=</span> Cipher.getInstance(<span class="hljs-string">"AES/ECB/PKCS5Padding"</span>);
        cipher.init(Cipher.ENCRYPT_MODE, secretKey);
        <span class="hljs-type">byte</span>[] encryptedBytes = cipher.doFinal(plainText.getBytes(StandardCharsets.UTF_8));
        <span class="hljs-keyword">return</span> Base64.getEncoder().encodeToString(encryptedBytes);
    }

    <span class="hljs-comment">// æµ‹è¯•ç”Ÿæˆå¯†æ–‡</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// ç”Ÿæˆå¯†æ–‡ï¼šencrypt:xxxxxx</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">password</span> <span class="hljs-operator">=</span> <span class="hljs-string">"prod_pass123"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">cipherText</span> <span class="hljs-operator">=</span> encrypt(password, ENCRYPT_KEY);
        System.out.println(<span class="hljs-string">"å¯†æ–‡é…ç½®ï¼šencrypt:"</span> + cipherText);
    }
}
</code></pre>
<h5 data-id="heading-14">é…ç½®åŠ è½½</h5>
<p>åœ¨Â <code>resources/META-INF/spring.factories</code>Â ä¸­é…ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">org.springframework.boot.env.EnvironmentPostProcessor</span>=\
com.example.demo.envprocessor.EncryptedConfigEnvironmentPostProcessor
</code></pre>
<h5 data-id="heading-15">é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://prod-mysql:3306/prod_db?useSSL=false</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">prod_user</span>
    <span class="hljs-comment"># å¯†æ–‡å­˜å‚¨ï¼Œå‰ç¼€æ ‡è¯†éœ€è¦è§£å¯†</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
<span class="hljs-attr">redis:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">prod-redis:6379</span>
  <span class="hljs-attr">password:</span> <span class="hljs-string">encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
<span class="hljs-attr">app:</span>
  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">secret:</span> <span class="hljs-string">encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
</code></pre>
<h5 data-id="heading-16">è¾“å‡º</h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[é…ç½®è§£å¯†]</span> å¼€å§‹å¤„ç†æ•æ„Ÿé…ç½®è§£å¯†
<span class="hljs-selector-attr">[é…ç½®è§£å¯†]</span> æˆåŠŸè§£å¯†é…ç½®é¡¹ï¼šspring<span class="hljs-selector-class">.datasource</span><span class="hljs-selector-class">.password</span>
<span class="hljs-selector-attr">[é…ç½®è§£å¯†]</span> æˆåŠŸè§£å¯†é…ç½®é¡¹ï¼šredis<span class="hljs-selector-class">.password</span>
<span class="hljs-selector-attr">[é…ç½®è§£å¯†]</span> æˆåŠŸè§£å¯†é…ç½®é¡¹ï¼šapp<span class="hljs-selector-class">.api</span><span class="hljs-selector-class">.secret</span>
<span class="hljs-selector-attr">[é…ç½®è§£å¯†]</span> æ•æ„Ÿé…ç½®è§£å¯†å®Œæˆ
</code></pre>
<h5 data-id="heading-17">ç”Ÿäº§ä»·å€¼</h5>
<ul>
<li>æ•æ„Ÿé…ç½®å¯†æ–‡å­˜å‚¨ï¼Œå³ä½¿é…ç½®æ–‡ä»¶æ³„éœ²ä¹Ÿæ— æ³•è·å–æ˜æ–‡ï¼›</li>
<li>è§£å¯†é€»è¾‘é›†ä¸­ç®¡æ§ï¼Œç¬¦åˆç­‰ä¿åˆè§„è¦æ±‚ï¼›</li>
<li>å¯ç»“åˆ KMSï¼ˆå¯†é’¥ç®¡ç†æœåŠ¡ï¼‰å®ç°å¯†é’¥çš„å®‰å…¨å­˜å‚¨ï¼Œé¿å…ç¡¬ç¼–ç ï¼›</li>
<li>è§£å¯†è¿‡ç¨‹å¯å¢åŠ å®¡è®¡æ—¥å¿—ï¼Œè¿½æº¯æ•æ„Ÿé…ç½®ä½¿ç”¨è®°å½•ã€‚</li>
</ul>
<h3 data-id="heading-18">å››ã€åœºæ™¯ 3ï¼šå¤šç¯å¢ƒé…ç½®åŠ¨æ€è¦†ç›–ï¼ˆè§£å†³é…ç½®å†²çªï¼‰</h3>
<h4 data-id="heading-19">ä¸šåŠ¡ç—›ç‚¹</h4>
<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¤šç¯å¢ƒé…ç½®å¸¸å‡ºç°ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ul>
<li>æµ‹è¯•ç¯å¢ƒé…ç½®æ±¡æŸ“ç”Ÿäº§ç¯å¢ƒï¼›</li>
<li>ä¸åŒç¯å¢ƒçš„é…ç½®ä¼˜å…ˆçº§æ··ä¹±ï¼›</li>
<li>ç‰¹æ®Šåœºæ™¯ï¼ˆå¦‚ç°åº¦å‘å¸ƒï¼‰éœ€è¦ä¸´æ—¶è¦†ç›–é…ç½®ã€‚</li>
</ul>
<h4 data-id="heading-20">è§£å†³æ–¹æ¡ˆ</h4>
<p>åŸºäºÂ <code>EnvironmentPostProcessor</code>Â å®ç°é…ç½®çš„åŠ¨æ€è¦†ç›–ï¼Œæ ¹æ®ç¯å¢ƒã€æœºå™¨æ ‡ç­¾ç­‰æ¡ä»¶åŠ¨æ€è°ƒæ•´é…ç½®ä¼˜å…ˆçº§ã€‚</p>
<h5 data-id="heading-21">å®ç°ä»£ç </h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.demo.envprocessor;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.env.EnvironmentPostProcessor;
<span class="hljs-keyword">import</span> org.springframework.core.env.ConfigurableEnvironment;
<span class="hljs-keyword">import</span> org.springframework.core.env.MapPropertySource;
<span class="hljs-keyword">import</span> org.springframework.core.env.MutablePropertySources;

<span class="hljs-keyword">import</span> java.net.InetAddress;
<span class="hljs-keyword">import</span> java.net.UnknownHostException;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/** * å¤šç¯å¢ƒé…ç½®åŠ¨æ€è¦†ç›–å¤„ç†å™¨ */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EnvConfigOverrideProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EnvironmentPostProcessor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">postProcessEnvironment</span><span class="hljs-params">(ConfigurableEnvironment environment, SpringApplication application)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. è·å–æœºå™¨æ ‡è¯†ï¼ˆç”Ÿäº§ç¯å¢ƒå¯ä»æœºå™¨æ ‡ç­¾/ECSå…ƒæ•°æ®è·å–ï¼‰</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">hostName</span> <span class="hljs-operator">=</span> InetAddress.getLocalHost().getHostName();
            <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> InetAddress.getLocalHost().getHostAddress();
            System.out.printf(<span class="hljs-string">"[é…ç½®è¦†ç›–] æœºå™¨ä¿¡æ¯ï¼š%s(%s)%n"</span>, hostName, ip);

            <span class="hljs-comment">// 2. åˆ¤æ–­æ˜¯å¦ä¸ºç°åº¦æœºå™¨</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">isGray</span> <span class="hljs-operator">=</span> hostName.contains(<span class="hljs-string">"gray"</span>) || ip.startsWith(<span class="hljs-string">"192.168.100."</span>);
            <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ä¸ºç”Ÿäº§ç¯å¢ƒ</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">isProd</span> <span class="hljs-operator">=</span> environment.getActiveProfiles().length &gt; <span class="hljs-number">0</span> &amp;&amp;
                    <span class="hljs-string">"prod"</span>.equals(environment.getActiveProfiles()[<span class="hljs-number">0</span>]);

            <span class="hljs-comment">// 3. åŠ¨æ€è¦†ç›–é…ç½®</span>
            Map&lt;String, Object&gt; overrideConfig = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
            <span class="hljs-keyword">if</span> (isProd &amp;&amp; isGray) {
                <span class="hljs-comment">// ç°åº¦æœºå™¨ä½¿ç”¨ç°åº¦é…ç½®</span>
                overrideConfig.put(<span class="hljs-string">"spring.datasource.url"</span>, <span class="hljs-string">"jdbc:mysql://gray-mysql:3306/prod_db?useSSL=false"</span>);
                overrideConfig.put(<span class="hljs-string">"redis.host"</span>, <span class="hljs-string">"gray-redis:6379"</span>);
                overrideConfig.put(<span class="hljs-string">"app.gray.mode"</span>, <span class="hljs-string">"true"</span>);
                System.out.println(<span class="hljs-string">"[é…ç½®è¦†ç›–] ç°åº¦æœºå™¨ï¼ŒåŠ è½½ç°åº¦é…ç½®"</span>);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isProd) {
                <span class="hljs-comment">// ç”Ÿäº§æœºå™¨ä½¿ç”¨ç”Ÿäº§é…ç½®</span>
                overrideConfig.put(<span class="hljs-string">"app.gray.mode"</span>, <span class="hljs-string">"false"</span>);
                overrideConfig.put(<span class="hljs-string">"app.log.level"</span>, <span class="hljs-string">"INFO"</span>);
                System.out.println(<span class="hljs-string">"[é…ç½®è¦†ç›–] ç”Ÿäº§æœºå™¨ï¼ŒåŠ è½½ç”Ÿäº§é…ç½®"</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// æµ‹è¯•/å¼€å‘æœºå™¨æ”¾å®½é…ç½®é™åˆ¶</span>
                overrideConfig.put(<span class="hljs-string">"app.log.level"</span>, <span class="hljs-string">"DEBUG"</span>);
                overrideConfig.put(<span class="hljs-string">"spring.datasource.hikari.maximum-pool-size"</span>, <span class="hljs-string">"10"</span>);
                System.out.println(<span class="hljs-string">"[é…ç½®è¦†ç›–] éç”Ÿäº§æœºå™¨ï¼ŒåŠ è½½æµ‹è¯•é…ç½®"</span>);
            }

            <span class="hljs-comment">// 4. è¦†ç›–é…ç½®ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰</span>
            <span class="hljs-type">MutablePropertySources</span> <span class="hljs-variable">propertySources</span> <span class="hljs-operator">=</span> environment.getPropertySources();
            propertySources.addFirst(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MapPropertySource</span>(<span class="hljs-string">"dynamicOverrideConfig"</span>, overrideConfig));

            <span class="hljs-comment">// 5. æ‰“å°æœ€ç»ˆç”Ÿæ•ˆçš„æ ¸å¿ƒé…ç½®</span>
            System.out.printf(<span class="hljs-string">"[é…ç½®è¦†ç›–] æœ€ç»ˆç”Ÿæ•ˆçš„æ•°æ®åº“åœ°å€ï¼š%s%n"</span>,
                    environment.getProperty(<span class="hljs-string">"spring.datasource.url"</span>));
            System.out.printf(<span class="hljs-string">"[é…ç½®è¦†ç›–] æœ€ç»ˆç”Ÿæ•ˆçš„ç°åº¦æ¨¡å¼ï¼š%s%n"</span>,
                    environment.getProperty(<span class="hljs-string">"app.gray.mode"</span>));

        } <span class="hljs-keyword">catch</span> (UnknownHostException e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–æœºå™¨ä¿¡æ¯å¤±è´¥"</span>, e);
        }
    }
}
</code></pre>
<h5 data-id="heading-22">é…ç½®åŠ è½½</h5>
<p>åœ¨Â <code>resources/META-INF/spring.factories</code>Â ä¸­é…ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">org.springframework.boot.env.EnvironmentPostProcessor</span>=\
com.example.demo.envprocessor.EnvConfigOverrideProcessor
</code></pre>
<h5 data-id="heading-23">è¾“å‡ºï¼ˆç”Ÿäº§æœºå™¨ï¼‰</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[é…ç½®è¦†ç›–]</span> æœºå™¨ä¿¡æ¯ï¼šxxx(127.0.0.1)
<span class="hljs-section">[é…ç½®è¦†ç›–]</span> ç”Ÿäº§æœºå™¨ï¼ŒåŠ è½½ç”Ÿäº§é…ç½®
<span class="hljs-section">[é…ç½®è¦†ç›–]</span> æœ€ç»ˆç”Ÿæ•ˆçš„æ•°æ®åº“åœ°å€ï¼šjdbc:mysql://prod-mysql:3306/prod_db?<span class="hljs-attr">useSSL</span>=<span class="hljs-literal">false</span>
<span class="hljs-section">[é…ç½®è¦†ç›–]</span> æœ€ç»ˆç”Ÿæ•ˆçš„ç°åº¦æ¨¡å¼ï¼šfalse
</code></pre>
<h5 data-id="heading-24">ç”Ÿäº§ä»·å€¼</h5>
<ul>
<li>åŸºäºæœºå™¨æ ‡ç­¾åŠ¨æ€è°ƒæ•´é…ç½®ï¼Œå®ç°ç°åº¦å‘å¸ƒã€è“ç»¿éƒ¨ç½²ï¼›</li>
<li>é¿å…æµ‹è¯•é…ç½®æ±¡æŸ“ç”Ÿäº§ç¯å¢ƒï¼Œé…ç½®éš”ç¦»æ›´å½»åº•ï¼›</li>
<li>ç”Ÿäº§ç¯å¢ƒå¯ä¸´æ—¶è¦†ç›–é…ç½®ï¼Œæ— éœ€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼›</li>
<li>é…ç½®ä¼˜å…ˆçº§å¯ç²¾ç»†åŒ–æ§åˆ¶ï¼Œè§£å†³é…ç½®å†²çªé—®é¢˜ã€‚</li>
</ul>
<h3 data-id="heading-25">äº”ã€åœºæ™¯ 4ï¼šé…ç½®æ ¡éªŒä¸è¡¥å…¨ï¼ˆæå‰æ‹¦æˆªéæ³•é…ç½®ï¼‰</h3>
<h4 data-id="heading-26">ä¸šåŠ¡ç—›ç‚¹</h4>
<p>ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé…ç½®é”™è¯¯å¸¸å¯¼è‡´åº”ç”¨å¯åŠ¨åä¸å¯ç”¨ï¼š</p>
<ul>
<li>æ ¸å¿ƒé…ç½®ç¼ºå¤±ï¼ˆå¦‚æ•°æ®åº“åœ°å€ä¸ºç©ºï¼‰ï¼›</li>
<li>é…ç½®æ ¼å¼é”™è¯¯ï¼ˆå¦‚ç«¯å£å·éæ•°å­—ï¼‰ï¼›</li>
<li>é…ç½®å€¼è¶…å‡ºåˆç†èŒƒå›´ï¼ˆå¦‚çº¿ç¨‹æ± å¤§å°è®¾ç½®ä¸º 0ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-27">è§£å†³æ–¹æ¡ˆ</h4>
<p>åŸºäºÂ <code>EnvironmentPostProcessor</code>Â åœ¨é…ç½®ç”Ÿæ•ˆå‰è¿›è¡Œæ ¡éªŒï¼Œéæ³•é…ç½®ç›´æ¥ç»ˆæ­¢å¯åŠ¨ï¼Œå¹¶ç»™å‡ºæ˜ç¡®çš„é”™è¯¯æç¤ºã€‚</p>
<h5 data-id="heading-28">å®ç°ä»£ç </h5>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">demo</span>.<span class="hljs-property">envprocessor</span>;

<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">env</span>.<span class="hljs-property">EnvironmentPostProcessor</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">core</span>.<span class="hljs-property">env</span>.<span class="hljs-property">ConfigurableEnvironment</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">util</span>.<span class="hljs-property">StringUtils</span>;

<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">regex</span>.<span class="hljs-property">Pattern</span>;

<span class="hljs-comment">/** * é…ç½®æ ¡éªŒä¸è¡¥å…¨å¤„ç†å™¨ */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConfigValidateProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">EnvironmentPostProcessor</span> {

    <span class="hljs-comment">// ç«¯å£å·æ­£åˆ™</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">Pattern</span> <span class="hljs-variable constant_">PORT_PATTERN</span> = <span class="hljs-title class_">Pattern</span>.<span class="hljs-title function_">compile</span>(<span class="hljs-string">"^\d{1,5}$"</span>);
    <span class="hljs-comment">// æ•°æ®åº“URLæ­£åˆ™</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">Pattern</span> <span class="hljs-variable constant_">DB_URL_PATTERN</span> = <span class="hljs-title class_">Pattern</span>.<span class="hljs-title function_">compile</span>(<span class="hljs-string">"^jdbc:\w+://.+:\d+/\w+.*$"</span>);

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">postProcessEnvironment</span>(<span class="hljs-params">ConfigurableEnvironment environment, SpringApplication application</span>) {
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"[é…ç½®æ ¡éªŒ] å¼€å§‹æ ¡éªŒæ ¸å¿ƒé…ç½®"</span>);

        <span class="hljs-comment">// 1. æ ¡éªŒæ ¸å¿ƒé…ç½®æ˜¯å¦å­˜åœ¨</span>
        <span class="hljs-title function_">validateConfigExists</span>(environment, <span class="hljs-string">"spring.datasource.url"</span>);
        <span class="hljs-title function_">validateConfigExists</span>(environment, <span class="hljs-string">"spring.datasource.username"</span>);
        <span class="hljs-title function_">validateConfigExists</span>(environment, <span class="hljs-string">"spring.datasource.password"</span>);
        <span class="hljs-title function_">validateConfigExists</span>(environment, <span class="hljs-string">"redis.host"</span>);

        <span class="hljs-comment">// 2. æ ¡éªŒé…ç½®æ ¼å¼</span>
        <span class="hljs-title function_">validateConfigFormat</span>(environment, <span class="hljs-string">"spring.datasource.url"</span>, <span class="hljs-variable constant_">DB_URL_PATTERN</span>, <span class="hljs-string">"æ•°æ®åº“URLæ ¼å¼éæ³•"</span>);
        <span class="hljs-title function_">validateConfigFormat</span>(environment, <span class="hljs-string">"server.port"</span>, <span class="hljs-variable constant_">PORT_PATTERN</span>, <span class="hljs-string">"ç«¯å£å·æ ¼å¼éæ³•"</span>);

        <span class="hljs-comment">// 3. æ ¡éªŒé…ç½®å€¼èŒƒå›´</span>
        <span class="hljs-title function_">validatePortRange</span>(environment, <span class="hljs-string">"server.port"</span>);
        <span class="hljs-title function_">validateThreadPoolSize</span>(environment, <span class="hljs-string">"spring.datasource.hikari.maximum-pool-size"</span>);

        <span class="hljs-comment">// 4. è¡¥å…¨é»˜è®¤é…ç½®</span>
        <span class="hljs-title function_">supplementDefaultConfig</span>(environment, <span class="hljs-string">"server.port"</span>, <span class="hljs-string">"8080"</span>);
        <span class="hljs-title function_">supplementDefaultConfig</span>(environment, <span class="hljs-string">"spring.datasource.hikari.minimum-idle"</span>, <span class="hljs-string">"5"</span>);

        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"[é…ç½®æ ¡éªŒ] æ ¸å¿ƒé…ç½®æ ¡éªŒé€šè¿‡ï¼Œé»˜è®¤é…ç½®å·²è¡¥å…¨"</span>);
    }

    <span class="hljs-comment">// æ ¡éªŒé…ç½®æ˜¯å¦å­˜åœ¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">validateConfigExists</span>(<span class="hljs-params">ConfigurableEnvironment environment, <span class="hljs-built_in">String</span> configKey</span>) {
        <span class="hljs-title class_">String</span> value = environment.<span class="hljs-title function_">getProperty</span>(configKey);
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">hasText</span>(value)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"æ ¸å¿ƒé…ç½®ç¼ºå¤±ï¼š"</span> + configKey);
        }
    }

    <span class="hljs-comment">// æ ¡éªŒé…ç½®æ ¼å¼</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">validateConfigFormat</span>(<span class="hljs-params">ConfigurableEnvironment environment, <span class="hljs-built_in">String</span> configKey,
                                      Pattern pattern, <span class="hljs-built_in">String</span> errorMsg</span>) {
        <span class="hljs-title class_">String</span> value = environment.<span class="hljs-title function_">getProperty</span>(configKey);
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">hasText</span>(value) &amp;&amp; !pattern.<span class="hljs-title function_">matcher</span>(value).<span class="hljs-title function_">matches</span>()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(errorMsg + <span class="hljs-string">"ï¼Œé…ç½®é¡¹ï¼š"</span> + configKey + <span class="hljs-string">"ï¼Œå€¼ï¼š"</span> + value);
        }
    }

    <span class="hljs-comment">// æ ¡éªŒç«¯å£å·èŒƒå›´</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">validatePortRange</span>(<span class="hljs-params">ConfigurableEnvironment environment, <span class="hljs-built_in">String</span> configKey</span>) {
        <span class="hljs-title class_">String</span> value = environment.<span class="hljs-title function_">getProperty</span>(configKey);
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">hasText</span>(value) &amp;&amp; <span class="hljs-variable constant_">PORT_PATTERN</span>.<span class="hljs-title function_">matcher</span>(value).<span class="hljs-title function_">matches</span>()) {
            int port = <span class="hljs-title class_">Integer</span>.<span class="hljs-built_in">parseInt</span>(value);
            <span class="hljs-keyword">if</span> (port &lt; <span class="hljs-number">1</span> || port &gt; <span class="hljs-number">65535</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ç«¯å£å·è¶…å‡ºèŒƒå›´(1-65535)ï¼š"</span> + configKey + <span class="hljs-string">"="</span> + value);
            }
        }
    }

    <span class="hljs-comment">// æ ¡éªŒçº¿ç¨‹æ± å¤§å°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">validateThreadPoolSize</span>(<span class="hljs-params">ConfigurableEnvironment environment, <span class="hljs-built_in">String</span> configKey</span>) {
        <span class="hljs-title class_">String</span> value = environment.<span class="hljs-title function_">getProperty</span>(configKey);
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">hasText</span>(value)) {
            <span class="hljs-keyword">try</span> {
                int size = <span class="hljs-title class_">Integer</span>.<span class="hljs-built_in">parseInt</span>(value);
                <span class="hljs-keyword">if</span> (size &lt; <span class="hljs-number">1</span> || size &gt; <span class="hljs-number">100</span>) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"çº¿ç¨‹æ± å¤§å°è¶…å‡ºåˆç†èŒƒå›´(1-100)ï¼š"</span> + configKey + <span class="hljs-string">"="</span> + value);
                }
            } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">NumberFormatException</span> e) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"çº¿ç¨‹æ± å¤§å°å¿…é¡»ä¸ºæ•°å­—ï¼š"</span> + configKey + <span class="hljs-string">"="</span> + value);
            }
        }
    }

    <span class="hljs-comment">// è¡¥å…¨é»˜è®¤é…ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">supplementDefaultConfig</span>(<span class="hljs-params">ConfigurableEnvironment environment, <span class="hljs-built_in">String</span> configKey, <span class="hljs-built_in">String</span> defaultValue</span>) {
        <span class="hljs-title class_">String</span> value = environment.<span class="hljs-title function_">getProperty</span>(configKey);
        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">StringUtils</span>.<span class="hljs-title function_">hasText</span>(value)) {
            environment.<span class="hljs-title function_">getSystemProperties</span>().<span class="hljs-title function_">put</span>(configKey, defaultValue);
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">printf</span>(<span class="hljs-string">"[é…ç½®è¡¥å…¨] é…ç½®é¡¹ %s ç¼ºå¤±ï¼Œä½¿ç”¨é»˜è®¤å€¼ï¼š%s%n"</span>, configKey, defaultValue);
        }
    }
}
</code></pre>
<h5 data-id="heading-29">é…ç½®åŠ è½½</h5>
<p>åœ¨Â <code>resources/META-INF/spring.factories</code>Â ä¸­é…ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">org.springframework.boot.env.EnvironmentPostProcessor</span>=\
com.example.demo.envprocessor.ConfigValidateProcessor
</code></pre>
<h5 data-id="heading-30">é…ç½®æ–‡ä»¶</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment">#spring:</span>
<span class="hljs-comment">#  datasource:</span>
<span class="hljs-comment">#    url: jdbc:mysql://prod-mysql:3306/prod_db?useSSL=false</span>
<span class="hljs-comment">#    username: prod_user</span>
<span class="hljs-comment">#    # å¯†æ–‡å­˜å‚¨ï¼Œå‰ç¼€æ ‡è¯†éœ€è¦è§£å¯†</span>
<span class="hljs-comment">#    password: encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
<span class="hljs-attr">redis:</span>
  <span class="hljs-attr">host:</span> <span class="hljs-string">prod-redis:6379</span>
  <span class="hljs-attr">password:</span> <span class="hljs-string">encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
<span class="hljs-attr">app:</span>
  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">secret:</span> <span class="hljs-string">encrypt:DC76b3+IyNwp+f/1QxPiIA==</span>
</code></pre>
<h5 data-id="heading-31">é”™è¯¯è¾“å‡ºç¤ºä¾‹</h5>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[é…ç½®æ ¡éªŒ]</span> å¼€å§‹æ ¡éªŒæ ¸å¿ƒé…ç½®
<span class="hljs-number">22</span>:<span class="hljs-number">15</span>:<span class="hljs-number">56.187</span> [main] ERROR org.springframework.boot.SpringApplication -- Application run failed
java.lang.IllegalArgumentException: æ ¸å¿ƒé…ç½®ç¼ºå¤±ï¼šspring.datasource.url
    at com.example.demo.envprocessor.ConfigValidateProcessor.<span class="hljs-built_in">validateConfigExists</span>(ConfigValidateProcessor.java:<span class="hljs-number">47</span>)
    at com.example.demo.envprocessor.ConfigValidateProcessor.<span class="hljs-built_in">postProcessEnvironment</span>(ConfigValidateProcessor.java:<span class="hljs-number">23</span>)
    at org.springframework.boot.env.EnvironmentPostProcessorApplicationListener.<span class="hljs-built_in">onApplicationEnvironmentPreparedEvent</span>(EnvironmentPostProcessorApplicationListener.java:<span class="hljs-number">132</span>)
    at org.springframework.boot.env.EnvironmentPostProcessorApplicationListener.<span class="hljs-built_in">onApplicationEvent</span>(EnvironmentPostProcessorApplicationListener.java:<span class="hljs-number">115</span>)
    at org.springframework.context.event.SimpleApplicationEventMulticaster.<span class="hljs-built_in">doInvokeListener</span>(SimpleApplicationEventMulticaster.java:<span class="hljs-number">185</span>)
    at org.springframework.context.event.SimpleApplicationEventMulticaster.<span class="hljs-built_in">invokeListener</span>(SimpleApplicationEventMulticaster.java:<span class="hljs-number">178</span>)
    at org.springframework.context.event.SimpleApplicationEventMulticaster.<span class="hljs-built_in">multicastEvent</span>(SimpleApplicationEventMulticaster.java:<span class="hljs-number">156</span>)
    at org.springframework.context.event.SimpleApplicationEventMulticaster.<span class="hljs-built_in">multicastEvent</span>(SimpleApplicationEventMulticaster.java:<span class="hljs-number">138</span>)
    at org.springframework.boot.context.event.EventPublishingRunListener.<span class="hljs-built_in">multicastInitialEvent</span>(EventPublishingRunListener.java:<span class="hljs-number">136</span>)
    at org.springframework.boot.context.event.EventPublishingRunListener.<span class="hljs-built_in">environmentPrepared</span>(EventPublishingRunListener.java:<span class="hljs-number">81</span>)
    at org.springframework.boot.SpringApplicationRunListeners.lambda$environmentPrepared$<span class="hljs-number">2</span>(SpringApplicationRunListeners.java:<span class="hljs-number">64</span>)
    at java.base/java.lang.Iterable.<span class="hljs-built_in">forEach</span>(Iterable.java:<span class="hljs-number">75</span>)
    at org.springframework.boot.SpringApplicationRunListeners.<span class="hljs-built_in">doWithListeners</span>(SpringApplicationRunListeners.java:<span class="hljs-number">118</span>)
    at org.springframework.boot.SpringApplicationRunListeners.<span class="hljs-built_in">doWithListeners</span>(SpringApplicationRunListeners.java:<span class="hljs-number">112</span>)
    at org.springframework.boot.SpringApplicationRunListeners.<span class="hljs-built_in">environmentPrepared</span>(SpringApplicationRunListeners.java:<span class="hljs-number">63</span>)
    at org.springframework.boot.SpringApplication.<span class="hljs-built_in">prepareEnvironment</span>(SpringApplication.java:<span class="hljs-number">353</span>)
    at org.springframework.boot.SpringApplication.<span class="hljs-built_in">run</span>(SpringApplication.java:<span class="hljs-number">313</span>)
    at org.springframework.boot.SpringApplication.<span class="hljs-built_in">run</span>(SpringApplication.java:<span class="hljs-number">1361</span>)
    at org.springframework.boot.SpringApplication.<span class="hljs-built_in">run</span>(SpringApplication.java:<span class="hljs-number">1350</span>)
    at com.example.demo.DemoApplication.<span class="hljs-built_in">main</span>(DemoApplication.java:<span class="hljs-number">11</span>)
å·²ä¸åœ°å€ä¸º <span class="hljs-string">''</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">57589</span><span class="hljs-string">'ï¼Œä¼ è¾“: '</span>å¥—æ¥å­—<span class="hljs-string">''</span> çš„ç›®æ ‡è™šæ‹Ÿæœºæ–­å¼€è¿æ¥
</code></pre>
<h5 data-id="heading-32">ç”Ÿäº§ä»·å€¼</h5>
<ul>
<li>æå‰æ‹¦æˆªéæ³•é…ç½®ï¼Œé¿å…åº”ç”¨å¯åŠ¨åä¸å¯ç”¨ï¼›</li>
<li>é”™è¯¯æç¤ºæ˜ç¡®ï¼Œç¼©çŸ­é…ç½®é—®é¢˜æ’æŸ¥æ—¶é—´ï¼›</li>
<li>è¡¥å…¨é»˜è®¤é…ç½®ï¼Œå‡å°‘é…ç½®æ–‡ä»¶ç»´æŠ¤æˆæœ¬ï¼›</li>
<li>ç»Ÿä¸€æ ¡éªŒè§„åˆ™ï¼Œç¬¦åˆç”Ÿäº§ç¯å¢ƒé…ç½®è§„èŒƒã€‚</li>
</ul>
<h3 data-id="heading-33">å…­ã€æ€»ç»“</h3>
<p><code>EnvironmentPostProcessor</code>Â æ˜¯ Spring Boot é…ç½®æ²»ç†çš„æ ¸å¿ƒæ‰©å±•ç‚¹ï¼Œå®ƒåœ¨é…ç½®æœ€ç»ˆç”Ÿæ•ˆå‰æä¾›äº†å¼ºå¤§çš„å®šåˆ¶åŒ–èƒ½åŠ›ï¼š</p>
<ul>
<li><strong>é…ç½®ä¸­å¿ƒåŒ–</strong>ï¼šä»é…ç½®ä¸­å¿ƒæ‹‰å–é…ç½®ï¼Œè§£è€¦é…ç½®ä¸ä»£ç ï¼›</li>
<li><strong>é…ç½®åŠ å¯†</strong>ï¼šæ•æ„Ÿé…ç½®å¯†æ–‡å­˜å‚¨ï¼Œè¿è¡Œæ—¶åŠ¨æ€è§£å¯†ï¼›</li>
<li><strong>åŠ¨æ€è¦†ç›–</strong>ï¼šåŸºäºç¯å¢ƒ / æœºå™¨æ ‡ç­¾åŠ¨æ€è°ƒæ•´é…ç½®ï¼›</li>
<li><strong>é…ç½®æ ¡éªŒ</strong>ï¼šæå‰æ‹¦æˆªéæ³•é…ç½®ï¼Œä¿éšœåº”ç”¨å¯åŠ¨æˆåŠŸã€‚</li>
</ul>
<p>ç›¸è¾ƒäºÂ <code>SpringApplicationRunListener</code>ï¼Œ<code>EnvironmentPostProcessor</code>Â æ›´èšç„¦äºé…ç½®å±‚é¢çš„æ‰©å±•ï¼Œæ˜¯æ„å»º â€œé…ç½®å³ä»£ç â€â€œé…ç½®ç»Ÿä¸€ç®¡æ§â€ ç”Ÿäº§çº§åº”ç”¨çš„å…³é”®å·¥å…·ã€‚</p>
<p>ğŸ“ŒÂ <strong>å…³æ³¨æˆ‘</strong>ï¼Œæ¯å¤© 5 åˆ†é’Ÿï¼Œå¸¦ä½ ä» Java å°ç™½å˜èº«ç¼–ç¨‹é«˜æ‰‹ï¼</p>
<p>ğŸ‘‰ ç‚¹èµ + å…³æ³¨ + è½¬å‘ï¼Œè®©æ›´å¤šå°ä¼™ä¼´ä¸€èµ·è¿›æ­¥ï¼</p>
<p>ğŸ‘‰ ç§ä¿¡ "SpringBoot é’©å­æºç " è·å–å®Œæ•´æºç ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flinkæºç é˜…è¯»ï¼šCheckpointæœºåˆ¶ï¼ˆä¸‹ï¼‰]]></title>    <link>https://juejin.cn/post/7585458459166507042</link>    <guid>https://juejin.cn/post/7585458459166507042</guid>    <pubDate>2025-12-20T13:59:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585458459166507042" data-draft-id="7585458459166490658" data-original-type="2" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flinkæºç é˜…è¯»ï¼šCheckpointæœºåˆ¶ï¼ˆä¸‹ï¼‰"/> <meta itemprop="keywords" content="Flink,å¤§æ•°æ®"/> <meta itemprop="datePublished" content="2025-12-20T13:59:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¢å‘Googleç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flinkæºç é˜…è¯»ï¼šCheckpointæœºåˆ¶ï¼ˆä¸‹ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¢å‘Googleç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:59:07.000Z" title="Sat Dec 20 2025 13:59:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¹¦æ¥ä¸Šå›ï¼Œå‰æ–‡æˆ‘ä»¬æ¢³ç†çš„ Checkpoint æœºåˆ¶çš„æºç ï¼Œä½†æ˜¯å¯¹äºå¦‚ä½•å†™å…¥çŠ¶æ€æ•°æ®å¹¶æ²¡æœ‰æ·±å…¥äº†è§£ã€‚ä»Šå¤©å°±ä¸€èµ·æ¥æ¢³ç†ä¸€ä¸‹è¿™éƒ¨åˆ†ä»£ç ã€‚</p>
<h3 data-id="heading-0">å†™åœ¨å‰é¢</h3>
<p>å‰é¢æˆ‘ä»¬äº†è§£åˆ°åœ¨ <code>StreamOperatorStateHandler.snapshotState</code> æ–¹æ³•ä¸­ä¼šåˆ›å»ºå››ä¸ª Futureï¼Œç”¨æ¥æ”¯æŒä¸åŒç±»å‹çš„çŠ¶æ€å†™å…¥ã€‚</p>
<pre><code class="hljs language-java" lang="java">snapshotInProgress.setKeyedStateRawFuture(snapshotContext.getKeyedStateStreamFuture());
snapshotInProgress.setOperatorStateRawFuture(
        snapshotContext.getOperatorStateStreamFuture());

<span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != operatorStateBackend) {
    snapshotInProgress.setOperatorStateManagedFuture(
            operatorStateBackend.snapshot(
                    checkpointId, timestamp, factory, checkpointOptions));
}

<span class="hljs-keyword">if</span> (useAsyncState &amp;&amp; <span class="hljs-literal">null</span> != asyncKeyedStateBackend) {
    <span class="hljs-keyword">if</span> (isCanonicalSavepoint(checkpointOptions.getCheckpointType())) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">"Not supported yet."</span>);
    } <span class="hljs-keyword">else</span> {
        snapshotInProgress.setKeyedStateManagedFuture(
                asyncKeyedStateBackend.snapshot(
                        checkpointId, timestamp, factory, checkpointOptions));
    }
}
</code></pre>
<p>æˆ‘ä»¬ä¸»è¦å…³å¿ƒ ManagedStateï¼ŒManagedState éƒ½æ˜¯è°ƒç”¨ <code>Snapshotable.snapshot</code> æ–¹æ³•æ¥å†™å…¥æ•°æ®çš„ï¼Œä¸‹é¢å…·ä½“çœ‹ KeyedState å’Œ OperatorState çš„å…·ä½“å®ç°ã€‚</p>
<h3 data-id="heading-1">KeyedState</h3>
<p>KeyedState æˆ‘ä»¬ä»¥ HeapKeyedStateBackend ä¸ºä¾‹ï¼Œè¿™é‡Œå…ˆæ˜¯åˆ›å»ºäº†ä¸€ä¸ª <code>SnapshotStrategyRunner</code> å®ä¾‹ï¼ŒSnapshotStrategyRunner æ˜¯ä¸€ä¸ªå¿«ç…§ç­–ç•¥çš„ä¸€ä¸ªæ‰§è¡Œç±»ï¼Œåˆ›å»ºå®Œæˆåå°±ä¼šè°ƒç”¨ snapshot æ–¹æ³•ã€‚åœ¨è¿™ä¸ª snapshot æ–¹æ³•ä¸­ä¸»è¦åšäº†åšäº†ä¸‹é¢å‡ ä»¶äº‹ï¼š</p>
<ol>
<li>
<p>åŒæ­¥æ‹·è´çŠ¶æ€æ•°æ®çš„å¼•ç”¨ã€‚</p>
</li>
<li>
<p>åˆ›å»º Checkpoint è¾“å‡ºæµ <code>CheckpointStateOutputStream</code></p>
</li>
<li>
<p>å®Œæˆ Checkpoint æŒä¹…åŒ–</p>
</li>
<li>
<p>è¿”å›å…ƒä¿¡æ¯ç»“æœ</p>
</li>
</ol>
<h4 data-id="heading-2">çŠ¶æ€æ•°æ®å¼•ç”¨æ‹·è´</h4>
<p>åœ¨ HeapSnapshotStrategy çš„ syncPrepareResources æ–¹æ³•ä¸­è°ƒç”¨äº† <code>HeapSnapshotResources.create</code> æ–¹æ³•ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å‚æ•°æ˜¯ registeredKVStatesï¼Œå®ƒä»£è¡¨æˆ‘ä»¬åœ¨ä¸šåŠ¡ä»£ç ä¸­æ³¨å†Œçš„çŠ¶æ€æ•°æ®è¡¨ã€‚</p>
<pre><code class="hljs language-java" lang="java">ValueStateDescriptor&lt;Tuple2&lt;Long, Long&gt;&gt; descriptor =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueStateDescriptor</span>&lt;&gt;(
                <span class="hljs-string">"average"</span>,
                TypeInformation.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeHint</span>&lt;Tuple2&lt;Long, Long&gt;&gt;() {}));
</code></pre>
<p>ä¾‹å¦‚æˆ‘ä»¬è¿™æ ·æ³¨å†ŒçŠ¶æ€æ•°æ®è¡¨ï¼Œé‚£ä¹ˆ registeredKVStates çš„ key å°±æ˜¯ averageï¼Œvalue å°±æ˜¯çŠ¶æ€è¡¨ï¼Œå®ƒé€šå¸¸æ˜¯ä¸€ä¸ª CopyOnWriteStateTableã€‚å…·ä½“çš„çŠ¶æ€æ•°æ®å¼•ç”¨æ‹·è´çš„é€»è¾‘åœ¨ <code>processSnapshotMetaInfoForAllStates</code> æ–¹æ³•ä¸­ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processSnapshotMetaInfoForAllStates</span><span class="hljs-params">(
        List&lt;StateMetaInfoSnapshot&gt; metaInfoSnapshots,
        Map&lt;StateUID, StateSnapshot&gt; cowStateStableSnapshots,
        Map&lt;StateUID, Integer&gt; stateNamesToId,
        Map&lt;String, ? extends StateSnapshotRestore&gt; registeredStates,
        StateMetaInfoSnapshot.BackendStateType stateType)</span> {

    <span class="hljs-keyword">for</span> (Map.Entry&lt;String, ? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">StateSnapshotRestore</span>&gt; kvState :
            registeredStates.entrySet()) {
        <span class="hljs-keyword">final</span> <span class="hljs-type">StateUID</span> <span class="hljs-variable">stateUid</span> <span class="hljs-operator">=</span> StateUID.of(kvState.getKey(), stateType);
        stateNamesToId.put(stateUid, stateNamesToId.size());
        <span class="hljs-type">StateSnapshotRestore</span> <span class="hljs-variable">state</span> <span class="hljs-operator">=</span> kvState.getValue();
        <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> != state) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">StateSnapshot</span> <span class="hljs-variable">stateSnapshot</span> <span class="hljs-operator">=</span> state.stateSnapshot();
            metaInfoSnapshots.add(stateSnapshot.getMetaInfoSnapshot());
            cowStateStableSnapshots.put(stateUid, stateSnapshot);
        }
    }
}
</code></pre>
<p>é’ˆå¯¹æ¯ä¸ª Stateï¼Œè¿™é‡Œéƒ½åˆ›å»ºä¸€ä¸ª CopyOnWriteStateTableSnapshotï¼Œç„¶åå­˜åœ¨ cowStateStableSnapshots é‡Œã€‚è¿™é‡Œ CopyOnWriteStateTableSnapshot å°±æ˜¯æ‹·è´æ•°æ®çš„å¼•ç”¨ï¼Œå› æ­¤å¯ä»¥åŒæ­¥æ‰§è¡Œã€‚</p>
<h4 data-id="heading-3">åˆ›å»º CheckpointStateOutputStream</h4>
<p>åˆ›å»º CheckpointStateOutputStream çš„æ–¹æ³•æ˜¯ <code>CheckpointStreamWithResultProvider.createSimpleStream</code>ï¼Œç”Ÿäº§ç¯å¢ƒé€šå¸¸ä½¿ç”¨çš„æ˜¯ FsCheckpointStateOutputStreamã€‚FsCheckpointStateOutputStream ä¸­çš„å‚æ•°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// çŠ¶æ€æ•°æ®å†™å…¥ç¼“å†²æ•°ç»„ï¼Œæ•°æ®å…ˆå†™åˆ°å†…å­˜ä¸­ï¼Œç„¶å flush åˆ°ç£ç›˜</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">byte</span>[] writeBuffer;

<span class="hljs-comment">// ç¼“å†²æ•°ç»„å½“å‰å†™å…¥ä½ç½®</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">int</span> pos;

<span class="hljs-comment">// æ–‡ä»¶è¾“å‡ºæµ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> FSDataOutputStream outStream;

<span class="hljs-comment">// å†…å­˜ä¸­çŠ¶æ€å¤§å°é˜ˆå€¼ï¼Œè¶…è¿‡é˜ˆå€¼ä¼š flush åˆ°ç£ç›˜ï¼Œé»˜è®¤20KBï¼Œæœ€å¤§1MB</span>
<span class="hljs-comment">// ç›®çš„æ˜¯ä¸ºäº†å‡å°‘å°æ–‡ä»¶æ•°é‡</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> localStateThreshold;

<span class="hljs-comment">// checkpoint åŸºç¡€è·¯å¾„</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Path basePath;

<span class="hljs-comment">// Flink è‡ªå·±å°è£…çš„æ–‡ä»¶ç³»ç»Ÿ</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> FileSystem fs;

<span class="hljs-comment">// çŠ¶æ€æ•°æ®å®Œæ•´è·¯å¾„</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> Path statePath;

<span class="hljs-comment">// ç›¸å¯¹è·¯å¾„</span>
<span class="hljs-keyword">private</span> String relativeStatePath;

<span class="hljs-comment">// æ˜¯å¦å·²å…³é—­</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> closed;

<span class="hljs-comment">// æ˜¯å¦å…è®¸ä½¿ç”¨ç›¸å¯¹è·¯å¾„</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> allowRelativePaths;
</code></pre>
<h4 data-id="heading-4">Checkpoint æŒä¹…åŒ–</h4>
<p>åˆ›å»ºå®Œ CheckpointStateOutputStream ä¹‹åï¼Œä¼šè°ƒç”¨ <code>serializationProxy.write(outView)</code> å†™å…¥çŠ¶æ€çš„å…ƒæ•°æ®ã€‚å…ƒæ•°æ®åŒ…æ‹¬çŠ¶æ€çš„åç§°ã€ç±»å‹ã€åºåˆ—åŒ–å™¨ç­‰ä¸€äº›é…ç½®ã€‚</p>
<p>å…ƒæ•°æ®å†™å®Œä¹‹åï¼Œå°±å¼€å§‹åˆ†ç»„å†™å…¥çŠ¶æ€æ•°æ®ã€‚åœ¨å†™å…¥æ—¶ï¼Œå…ˆå†™ keyGroupIdï¼Œç„¶åå†å†™å½“å‰åˆ†ç»„çš„çŠ¶æ€æ•°æ®</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">keyGroupPos</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        keyGroupPos &lt; keyGroupRange.getNumberOfKeyGroups();
        ++keyGroupPos) {
    <span class="hljs-type">int</span> <span class="hljs-variable">keyGroupId</span> <span class="hljs-operator">=</span> keyGroupRange.getKeyGroupId(keyGroupPos);
    keyGroupRangeOffsets[keyGroupPos] = localStream.getPos();
    <span class="hljs-comment">// å†™ keyGroupId</span>
    outView.writeInt(keyGroupId);

    <span class="hljs-keyword">for</span> (Map.Entry&lt;StateUID, StateSnapshot&gt; stateSnapshot :
            cowStateStableSnapshots.entrySet()) {
        StateSnapshot.<span class="hljs-type">StateKeyGroupWriter</span> <span class="hljs-variable">partitionedSnapshot</span> <span class="hljs-operator">=</span>
                stateSnapshot.getValue().getKeyGroupWriter();
        <span class="hljs-keyword">try</span> (<span class="hljs-type">OutputStream</span> <span class="hljs-variable">kgCompressionOut</span> <span class="hljs-operator">=</span>
                keyGroupCompressionDecorator.decorateWithCompression(localStream)) {
            <span class="hljs-type">DataOutputViewStreamWrapper</span> <span class="hljs-variable">kgCompressionView</span> <span class="hljs-operator">=</span>
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataOutputViewStreamWrapper</span>(kgCompressionOut);
            kgCompressionView.writeShort(stateNamesToId.get(stateSnapshot.getKey()));
            <span class="hljs-comment">// å†™çŠ¶æ€æ•°æ®</span>
            partitionedSnapshot.writeStateInKeyGroup(kgCompressionView, keyGroupId);
        } <span class="hljs-comment">// this will just close the outer compression stream</span>
    }
}
</code></pre>
<p>çŠ¶æ€æ•°æ®å†™å…¥çš„è°ƒç”¨é“¾è·¯å¦‚ä¸‹</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8532e00e4e14497d964c456054bcacba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843949&amp;x-signature=kgoMWNFeh65SzeUp4yF%2F7vhDS5Q%3D" alt="writeState" loading="lazy"/></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeState</span><span class="hljs-params">(
        TypeSerializer&lt;K&gt; keySerializer,
        TypeSerializer&lt;N&gt; namespaceSerializer,
        TypeSerializer&lt;S&gt; stateSerializer,
        <span class="hljs-meta">@Nonnull</span> DataOutputView dov,
        <span class="hljs-meta">@Nullable</span> StateSnapshotTransformer&lt;S&gt; stateSnapshotTransformer)</span>
        <span class="hljs-keyword">throws</span> IOException {
    SnapshotIterator&lt;K, N, S&gt; snapshotIterator =
            getIterator(
                    keySerializer,
                    namespaceSerializer,
                    stateSerializer,
                    stateSnapshotTransformer);

    <span class="hljs-type">int</span> <span class="hljs-variable">size</span> <span class="hljs-operator">=</span> snapshotIterator.size();
    dov.writeInt(size);
    <span class="hljs-keyword">while</span> (snapshotIterator.hasNext()) {
        StateEntry&lt;K, N, S&gt; stateEntry = snapshotIterator.next();
        namespaceSerializer.serialize(stateEntry.getNamespace(), dov);
        keySerializer.serialize(stateEntry.getKey(), dov);
        stateSerializer.serialize(stateEntry.getState(), dov);
    }
}
</code></pre>
<h4 data-id="heading-5">è¿”å›ç»“æœ</h4>
<p>æœ€åä¸€æ­¥å°±æ˜¯å°è£…å¹¶è¿”å›å…ƒä¿¡æ¯ï¼Œè¿™é‡Œæ”¶é›†çš„ä¿¡æ¯åŒ…æ‹¬äº†æ¯ä¸ª keyGroup çš„çŠ¶æ€æ•°æ®åœ¨çŠ¶æ€æ–‡ä»¶ä¸­çš„å­˜å‚¨ä½ç½®ï¼ŒçŠ¶æ€æ•°æ®å­˜å‚¨çš„æ–‡ä»¶è·¯å¾„ã€æ–‡ä»¶å¤§å°ç­‰ã€‚</p>
<h3 data-id="heading-6">OperatorState</h3>
<p>OperatorState çš„å¤„ç†é€»è¾‘æ¯” KeyedState æ›´ç®€å•ä¸€äº›ï¼Œæµç¨‹ä¸Šéƒ½æ˜¯å…ˆåšçŠ¶æ€æ•°æ®çš„å¼•ç”¨å¿«ç…§ï¼Œç„¶åå†™å…¥çŠ¶æ€æ•°æ®å’Œè¿”å›ç»“æœã€‚åœ¨å†™å…¥æ•°æ®æ—¶ï¼Œæ²¡æœ‰äº†åˆ†ç»„å†™å…¥çš„é€»è¾‘ã€‚ç›´æ¥å¤„ç† operatorState å’Œ broadcastStateã€‚è¿™é‡Œå°±åªè´´ä¸€ä¸‹è°ƒç”¨æµç¨‹ï¼Œä¸åšè¿‡å¤šèµ˜è¿°äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50fefebe3e664ff1b639d9d3fbfb4bb1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843949&amp;x-signature=f0ziWpm1rFWYSxSJffCQessZf%2FY%3D" alt="operatorState" loading="lazy"/></p>
<h3 data-id="heading-7">æ€»ç»“</h3>
<p>æœ¬æ–‡æˆ‘ä»¬é‡ç‚¹æ¢³ç†äº† KeyedState æ•°æ®å†™å…¥çš„ä»£ç ã€‚å…¶ä¸»è¦æ­¥éª¤åŒ…æ‹¬ï¼šåŒæ­¥æ‹·è´çŠ¶æ€æ•°æ®çš„å¼•ç”¨ï¼Œåˆ›å»º Checkpoint è¾“å‡ºæµ <code>CheckpointStateOutputStream</code> å¹¶å®Œæˆ Checkpoint æŒä¹…åŒ–ï¼Œæœ€åè¿”å›å…ƒä¿¡æ¯ç»“æœã€‚OperatorState çš„å¤„ç†è¿‡ç¨‹å’Œ KeyedState çš„è¿‡ç¨‹ç±»ä¼¼ï¼Œåªæ˜¯å°‘äº†åˆ†ç»„çš„é€»è¾‘ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flinkæºç é˜…è¯»ï¼šçŠ¶æ€ç®¡ç†]]></title>    <link>https://juejin.cn/post/7585485284152721443</link>    <guid>https://juejin.cn/post/7585485284152721443</guid>    <pubDate>2025-12-20T13:59:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485284152721443" data-draft-id="7585485284152705059" data-original-type="2" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flinkæºç é˜…è¯»ï¼šçŠ¶æ€ç®¡ç†"/> <meta itemprop="keywords" content="Flink,å¤§æ•°æ®"/> <meta itemprop="datePublished" content="2025-12-20T13:59:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¢å‘Googleç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/1063982986695374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flinkæºç é˜…è¯»ï¼šçŠ¶æ€ç®¡ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1063982986695374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¢å‘Googleç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-20T13:59:08.000Z" title="Sat Dec 20 2025 13:59:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº† Flink çŠ¶æ€çš„åˆ†ç±»å’Œåº”ç”¨ã€‚ä»Šå¤©ä»æºç å±‚é¢å†çœ‹ä¸€ä¸‹ Flink æ˜¯å¦‚ä½•ç®¡ç†çŠ¶æ€çš„ã€‚</p>
<h3 data-id="heading-0">State æ¦‚è¿°</h3>
<p>å…³äº State çš„è¯¦ç»†ä»‹ç»å¯ä»¥å‚è€ƒ <a href="https://link.juejin.cn?target=https%3A%2F%2Fjackeyzhe.github.io%2F2025%2F08%2F04%2FFlink%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0%25EF%25BC%259A%25E7%258A%25B6%25E6%2580%2581%25E7%25B1%25BB%25E5%259E%258B%25E5%2592%258C%25E5%25BA%2594%25E7%2594%25A8%2F" target="_blank" title="https://jackeyzhe.github.io/2025/08/04/Flink%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E7%8A%B6%E6%80%81%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%BA%94%E7%94%A8/" ref="nofollow noopener noreferrer">Flinkå­¦ä¹ ç¬”è®°ï¼šçŠ¶æ€ç±»å‹å’Œåº”ç”¨</a> å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fjackeyzhe.github.io%2F2025%2F08%2F24%2FFlink%25E5%25AD%25A6%25E4%25B9%25A0%25E7%25AC%2594%25E8%25AE%25B0%25EF%25BC%259A%25E7%258A%25B6%25E6%2580%2581%25E5%2590%258E%25E7%25AB%25AF%2F" target="_blank" title="https://jackeyzhe.github.io/2025/08/24/Flink%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%9A%E7%8A%B6%E6%80%81%E5%90%8E%E7%AB%AF/" ref="nofollow noopener noreferrer">Flinkå­¦ä¹ ç¬”è®°ï¼šçŠ¶æ€åç«¯</a>è¿™ä¸¤ç¯‡æ–‡ç« ï¼Œä¸ºäº†æ–¹é¢é˜…è¯»ï¼Œè¿™é‡Œæˆ‘ä»¬å†ç®€å•ä»‹ç»ä¸€ä¸‹ã€‚</p>
<h4 data-id="heading-1">State ä½¿ç”¨</h4>
<p>State æ˜¯ Flink åšå¤æ‚é€»è¾‘æ‰€ä¾èµ–çš„æ ¸å¿ƒç»„ä»¶ã€‚å®ƒçš„åˆ†ç±»å¦‚ä¸‹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ad090ad897d49c6960c91af4f4dfcea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843950&amp;x-signature=CCLUmR20a58UhW88Y03xyDuUTDA%3D" alt="State åˆ†ç±»" loading="lazy"/></p>
<p>å¸¸è§çš„æ˜¯ Keyed State å’Œ Operator Stateï¼ŒKeyed State ä½œç”¨äº KeyedStream ä¸Šï¼ŒOperator State å¯ä»¥ä½œç”¨äºæ‰€æœ‰çš„ Operator ä¸Šã€‚Keyed State ä½¿ç”¨æ—¶ï¼Œéœ€è¦å…ˆåˆ›å»º StateDescriptorï¼Œç„¶åå†è°ƒç”¨ getState è·å–ã€‚</p>
<pre><code class="hljs language-java" lang="java">ValueStateDescriptor&lt;Tuple2&lt;Long, Long&gt;&gt; descriptor =
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ValueStateDescriptor</span>&lt;&gt;(
                <span class="hljs-string">"average"</span>,
                TypeInformation.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeHint</span>&lt;Tuple2&lt;Long, Long&gt;&gt;() {}));
ValueState&lt;Tuple2&lt;Long, Long&gt;&gt; sum = getRuntimeContext().getState(descriptor);
</code></pre>
<p>Opeartor State çš„è·å–æ–¹å¼ä¸ Keyed State ç±»ä¼¼ï¼Œéƒ½éœ€è¦ StateDescriptorã€‚Operator State åœ¨å®šä¹‰æ—¶éœ€è¦å®ç° CheckpointedFunctionã€‚</p>
<h4 data-id="heading-2">State å­˜å‚¨</h4>
<p>State Backend ç”¨æ¥ç®¡ç† State å­˜å‚¨ï¼Œæ ¹æ®å­˜å‚¨æ ¼å¼å’Œå­˜å‚¨ç±»å‹çš„ç»„åˆï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ol>
<li>
<p>MemoryStateBackendï¼šHashMapStateBackend å’Œ JobManagerCheckpointStorage çš„ç»„åˆï¼Œå³å°† State ä»¥ Java å¯¹è±¡çš„å½¢å¼å­˜å‚¨åœ¨ JobManager å†…å­˜ä¸­ã€‚</p>
</li>
<li>
<p>FsStateBackendï¼šHashMapStateBackend å’Œ FileSystemCheckpointStorage çš„ç»„åˆï¼Œå°† State ä»¥ Java å¯¹è±¡çš„å½¢å¼å­˜å‚¨åœ¨è¿œç«¯æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚</p>
</li>
<li>
<p>RocksDBStateBackendï¼šEmbeddedRocksDBStateBackend å’Œ FileSystemCheckpointStorage çš„ç»„åˆï¼ŒState åºåˆ—åŒ–åå­˜å‚¨åœ¨ RocksDBã€‚</p>
</li>
</ol>
<h3 data-id="heading-3">åˆ›å»º State Backend</h3>
<p>åˆ›å»º State Backend çš„å…¥å£åœ¨ StreamTaskï¼ŒStreamTask æ˜¯ Flink éƒ¨ç½²å’Œè¿è¡Œåœ¨ TaskManager çš„åŸºæœ¬å•å…ƒã€‚</p>
<p>åœ¨ StreamTask çš„ invoke æ–¹æ³•ä¸­ï¼Œä¼šå…ˆè°ƒç”¨ restoreStateAndGates æ–¹æ³•å»åˆ›å»º State Backendã€‚å®Œæ•´çš„è°ƒç”¨é“¾è·¯å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69608e44b8314186b748a766bb8eef6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843950&amp;x-signature=BVoarsKFnzdP%2BJASPW8XWtPuIoo%3D" alt="stateBackend" loading="lazy"/></p>
<p>åœ¨ streamOperatorStateContext æ–¹æ³•ä¸­ï¼Œåˆ†åˆ«è°ƒç”¨äº† keyedStatedBackend å’Œ operatorStateBackend æ¥åˆ›å»ºä¸¤ç§ State Backendã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ keyedStateBackend çš„é€»è¾‘ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> &lt;K, R <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Disposable</span> &amp; Closeable&gt; R <span class="hljs-title function_">keyedStatedBackend</span><span class="hljs-params">(
        TypeSerializer&lt;K&gt; keySerializer,
        String operatorIdentifierText,
        PrioritizedOperatorSubtaskState prioritizedOperatorSubtaskStates,
        CloseableRegistry backendCloseableRegistry,
        MetricGroup metricGroup,
        <span class="hljs-type">double</span> managedMemoryFraction,
        StateObject.StateObjectSizeStatsCollector statsCollector,
        KeyedStateBackendCreator&lt;K, R&gt; keyedStateBackendCreator)</span>
        <span class="hljs-keyword">throws</span> Exception {

    <span class="hljs-keyword">if</span> (keySerializer == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    ......

    <span class="hljs-keyword">final</span> <span class="hljs-type">KeyGroupRange</span> <span class="hljs-variable">keyGroupRange</span> <span class="hljs-operator">=</span>
            KeyGroupRangeAssignment.computeKeyGroupRangeForOperatorIndex(
                    taskInfo.getMaxNumberOfParallelSubtasks(),
                    taskInfo.getNumberOfParallelSubtasks(),
                    taskInfo.getIndexOfThisSubtask());

    <span class="hljs-comment">// Now restore processing is included in backend building/constructing process, so we need</span>
    <span class="hljs-comment">// to make sure</span>
    <span class="hljs-comment">// each stream constructed in restore could also be closed in case of task cancel, for</span>
    <span class="hljs-comment">// example the data</span>
    <span class="hljs-comment">// input stream opened for serDe during restore.</span>
    <span class="hljs-type">CloseableRegistry</span> <span class="hljs-variable">cancelStreamRegistryForRestore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CloseableRegistry</span>();
    backendCloseableRegistry.registerCloseable(cancelStreamRegistryForRestore);
    BackendRestorerProcedure&lt;R, KeyedStateHandle&gt; backendRestorer =
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">BackendRestorerProcedure</span>&lt;&gt;(
                    (stateHandles) -&gt; {
                        KeyedStateBackendParametersImpl&lt;K&gt; parameters =
                                <span class="hljs-keyword">new</span> <span class="hljs-title class_">KeyedStateBackendParametersImpl</span>&lt;&gt;(...);
                        <span class="hljs-keyword">return</span> keyedStateBackendCreator.create(...),
                                parameters);
                    },
                    backendCloseableRegistry,
                    logDescription);

    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> backendRestorer.createAndRestore(
                prioritizedOperatorSubtaskStates.getPrioritizedManagedKeyedState(),
                statsCollector);
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-keyword">if</span> (backendCloseableRegistry.unregisterCloseable(cancelStreamRegistryForRestore)) {
            IOUtils.closeQuietly(cancelStreamRegistryForRestore);
        }
    }
}
</code></pre>
<p>è¿™é‡Œçš„åˆ›å»ºè¿‡ç¨‹ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå…ˆæ˜¯è·å– KeyGroupRangeï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯å½“å‰ Operator ä¸Šå¤„ç†çš„ key çš„èŒƒå›´ã€‚ç„¶åå°±æ˜¯åˆ›å»º StateBackend å®ä¾‹ï¼Œè¿™é‡Œé€šè¿‡ BackendRestorerProcedure å°è£…ç»Ÿä¸€çš„æ¢å¤ã€å¼‚å¸¸å¤„ç†å’Œèµ„æºæ¸…ç†é€»è¾‘ã€‚operatorStateBackend æ–¹æ³•çš„é€»è¾‘ç›¸æ¯”è¾ƒæ¥è¯´ï¼Œåªæ˜¯å°‘äº† KeyGroupRange çš„å¤„ç†ï¼Œç›´æ¥åˆ›å»º StateBackend å®ä¾‹ã€‚</p>
<h3 data-id="heading-4">åˆ›å»ºå’Œä½¿ç”¨ State</h3>
<h4 data-id="heading-5">åˆ›å»º KeyedState</h4>
<p>KeyedState æ˜¯é€šè¿‡è°ƒç”¨ StreamingRuntimeContext.getState æ–¹æ³•è·å–çš„ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹å®Œæ•´çš„è°ƒç”¨æµç¨‹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9fcfec7f0c14599b878274c903f8105~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Z2i5ZCRR29vZ2xl57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766843950&amp;x-signature=e4sko2oJgvXk7%2BBo4jNViJQjnUY%3D" alt="getState" loading="lazy"/></p>
<p>åœ¨è°ƒç”¨ getState è¿™äº›æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šå…ˆè°ƒç”¨ keyedStateStore æä¾›çš„æ–¹æ³•ï¼Œå®ƒæ˜¯ Flink æä¾›çš„ä¸€ä¸ªå°è£… keyedStateBackend çš„æ¥å£ã€‚è°ƒç”¨æµç¨‹çš„æœ€åï¼Œæ˜¯è°ƒç”¨ keyedStateBackend ä¸­çš„ createOrUpdateInternalState æ–¹æ³•ï¼ˆè¿™é‡Œæˆ‘ä»¬ä»¥ HeapStateBackend ä¸ºä¾‹ï¼‰ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> &lt;N, SV, SEV, S <span class="hljs-keyword">extends</span> <span class="hljs-title class_">State</span>, IS <span class="hljs-keyword">extends</span> <span class="hljs-title class_">S</span>&gt; IS <span class="hljs-title function_">createOrUpdateInternalState</span><span class="hljs-params">(
        <span class="hljs-meta">@Nonnull</span> TypeSerializer&lt;N&gt; namespaceSerializer,
        <span class="hljs-meta">@Nonnull</span> StateDescriptor&lt;S, SV&gt; stateDesc,
        <span class="hljs-meta">@Nonnull</span> StateSnapshotTransformFactory&lt;SEV&gt; snapshotTransformFactory,
        <span class="hljs-type">boolean</span> allowFutureMetadataUpdates)</span>
        <span class="hljs-keyword">throws</span> Exception {
    StateTable&lt;K, N, SV&gt; stateTable =
            tryRegisterStateTable(
                    namespaceSerializer,
                    stateDesc,
                    getStateSnapshotTransformFactory(stateDesc, snapshotTransformFactory),
                    allowFutureMetadataUpdates);

    <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
    <span class="hljs-type">IS</span> <span class="hljs-variable">createdState</span> <span class="hljs-operator">=</span> (IS) createdKVStates.get(stateDesc.getName());
    <span class="hljs-keyword">if</span> (createdState == <span class="hljs-literal">null</span>) {
        <span class="hljs-type">StateCreateFactory</span> <span class="hljs-variable">stateCreateFactory</span> <span class="hljs-operator">=</span> STATE_CREATE_FACTORIES.get(stateDesc.getType());
        <span class="hljs-keyword">if</span> (stateCreateFactory == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlinkRuntimeException</span>(stateNotSupportedMessage(stateDesc));
        }
        createdState =
                stateCreateFactory.createState(stateDesc, stateTable, getKeySerializer());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-type">StateUpdateFactory</span> <span class="hljs-variable">stateUpdateFactory</span> <span class="hljs-operator">=</span> STATE_UPDATE_FACTORIES.get(stateDesc.getType());
        <span class="hljs-keyword">if</span> (stateUpdateFactory == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlinkRuntimeException</span>(stateNotSupportedMessage(stateDesc));
        }
        createdState = stateUpdateFactory.updateState(stateDesc, stateTable, createdState);
    }

    createdKVStates.put(stateDesc.getName(), createdState);
    <span class="hljs-keyword">return</span> createdState;
}


<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;StateDescriptor.Type, StateCreateFactory&gt; STATE_CREATE_FACTORIES =
        Stream.of(
                        Tuple2.of(
                                StateDescriptor.Type.VALUE,
                                (StateCreateFactory) HeapValueState::create),
                        Tuple2.of(
                                StateDescriptor.Type.LIST,
                                (StateCreateFactory) HeapListState::create),
                        Tuple2.of(
                                StateDescriptor.Type.MAP,
                                (StateCreateFactory) HeapMapState::create),
                        Tuple2.of(
                                StateDescriptor.Type.AGGREGATING,
                                (StateCreateFactory) HeapAggregatingState::create),
                        Tuple2.of(
                                StateDescriptor.Type.REDUCING,
                                (StateCreateFactory) HeapReducingState::create))
                .collect(Collectors.toMap(t -&gt; t.f0, t -&gt; t.f1));
</code></pre>
<p>è¿™é‡Œé¦–å…ˆæ˜¯æ³¨å†Œäº†ä¸€ä¸ª StateTableï¼Œè¿™ä¸ªæ˜¯ State ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„æˆå‘˜å˜é‡ï¼Œå®ƒå†…éƒ¨æ˜¯ä¸€ä¸ªç±»ä¼¼ Map çš„ç»“æ„ï¼Œç”¨æ¥ä¿å­˜ key å’Œ key çš„çŠ¶æ€ã€‚</p>
<p>STATE_CREATE_FACTORIES è¿™ä¸ªå˜é‡ä¿å­˜äº†ä¸åŒç±»å‹çš„ State å’Œå®ƒå¯¹åº”çš„åˆ›å»ºæ–¹æ³•ï¼ŒåŒç† STATE_UPDATE_FACTORIES ä¿å­˜çš„æ˜¯ä¸åŒ State å¯¹åº”çš„ æ›´æ–°æ–¹æ³•ã€‚</p>
<h4 data-id="heading-6">åˆ›å»º OperatorState</h4>
<p>çœ‹å®Œäº† KeyedState çš„åˆ›å»ºè¿‡ç¨‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹ OperatorState çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p>
<p>OperatorState çš„åˆ›å»ºæ–¹æ³•æ˜¯é€šè¿‡ FunctionInitializationContext å…ˆè·å–åˆ° OperatorStateStoreï¼Œå®ƒä¸ KeyedStateStore ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯¹ StateBackend çš„æ–¹æ³•è¿›è¡Œäº†å°è£…ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initializeState</span><span class="hljs-params">(FunctionInitializationContext context)</span> <span class="hljs-keyword">throws</span> Exception {
    ListStateDescriptor&lt;Tuple2&lt;String, Integer&gt;&gt; descriptor =
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">ListStateDescriptor</span>&lt;&gt;(
                    <span class="hljs-string">"buffered-elements"</span>,
                    TypeInformation.of(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeHint</span>&lt;Tuple2&lt;String, Integer&gt;&gt;() {}));

    checkpointedState = context.getOperatorStateStore().getListState(descriptor);

    <span class="hljs-keyword">if</span> (context.isRestored()) {
        <span class="hljs-keyword">for</span> (Tuple2&lt;String, Integer&gt; element : checkpointedState.get()) {
            bufferedElements.add(element);
        }
    }
}
</code></pre>
<p>OperatorStateStore çš„ getListState æ–¹æ³•ä¸­ï¼Œç›´æ¥åˆ›å»ºå‡ºäº† PartitionableListStateï¼ŒåŒæ—¶ä¹Ÿåšäº†ä¸€äº›ç¼“å­˜æ“ä½œã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> &lt;S&gt; ListState&lt;S&gt; <span class="hljs-title function_">getListState</span><span class="hljs-params">(
        ListStateDescriptor&lt;S&gt; stateDescriptor, OperatorStateHandle.Mode mode)</span>
        <span class="hljs-keyword">throws</span> StateMigrationException {

    ......
    PartitionableListState&lt;S&gt; partitionableListState =
            (PartitionableListState&lt;S&gt;) registeredOperatorStates.get(name);

    <span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> == partitionableListState) {
        <span class="hljs-comment">// no restored state for the state name; simply create new state holder</span>

        partitionableListState =
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">PartitionableListState</span>&lt;&gt;(
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegisteredOperatorStateBackendMetaInfo</span>&lt;&gt;(
                                name, partitionStateSerializer, mode));

        registeredOperatorStates.put(name, partitionableListState);
    } <span class="hljs-keyword">else</span> {
        ......
    }

    accessedStatesByName.put(name, partitionableListState);
    <span class="hljs-keyword">return</span> partitionableListState;
}
</code></pre>
<p>PartitionableListState å†…éƒ¨æœ‰ä¸€ä¸ª ArrayList ç”¨äºä¿å­˜æ•°æ®ã€‚</p>
<h4 data-id="heading-7">ä½¿ç”¨ KeyedState</h4>
<p>äº†è§£å®Œ State çš„åˆ›å»ºä¹‹åï¼Œæ¥ä¸‹æ¥å°±æ˜¯ State çš„ä½¿ç”¨äº†ã€‚æˆ‘ä»¬ä»¥ HeapValueState ä¸ºä¾‹æ¥çœ‹å¦‚ä½•è·å– Stateã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// HeapValueState ç±»</span>
<span class="hljs-keyword">public</span> V <span class="hljs-title function_">value</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">V</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> stateTable.get(currentNamespace);

    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> getDefaultValue();
    }

    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p>åœ¨ HeapValueState ç±»çš„ value æ–¹æ³•ä¸­ï¼Œç›´æ¥è°ƒç”¨ StateTable çš„ get æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨çš„æ˜¯ CopyOnWriteStateMap çš„ get æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸ HashMap çš„ get æ–¹æ³•æ¯”è¾ƒç±»ä¼¼ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> S <span class="hljs-title function_">get</span><span class="hljs-params">(K key, N namespace)</span> {

    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">hash</span> <span class="hljs-operator">=</span> computeHashForOperationAndDoIncrementalRehash(key, namespace);
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">requiredVersion</span> <span class="hljs-operator">=</span> highestRequiredSnapshotVersion;
    <span class="hljs-keyword">final</span> StateMapEntry&lt;K, N, S&gt;[] tab = selectActiveTable(hash);
    <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> hash &amp; (tab.length - <span class="hljs-number">1</span>);

    <span class="hljs-keyword">for</span> (StateMapEntry&lt;K, N, S&gt; e = tab[index]; e != <span class="hljs-literal">null</span>; e = e.next) {
        <span class="hljs-keyword">final</span> <span class="hljs-type">K</span> <span class="hljs-variable">eKey</span> <span class="hljs-operator">=</span> e.key;
        <span class="hljs-keyword">final</span> <span class="hljs-type">N</span> <span class="hljs-variable">eNamespace</span> <span class="hljs-operator">=</span> e.namespace;
        <span class="hljs-keyword">if</span> ((e.hash == hash &amp;&amp; key.equals(eKey) &amp;&amp; namespace.equals(eNamespace))) {

            <span class="hljs-comment">// copy-on-write check for state</span>
            <span class="hljs-keyword">if</span> (e.stateVersion &lt; requiredVersion) {
                <span class="hljs-comment">// copy-on-write check for entry</span>
                <span class="hljs-keyword">if</span> (e.entryVersion &lt; requiredVersion) {
                    e = handleChainedEntryCopyOnWrite(tab, hash &amp; (tab.length - <span class="hljs-number">1</span>), e);
                }
                e.stateVersion = stateMapVersion;
                e.state = getStateSerializer().copy(e.state);
            }

            <span class="hljs-keyword">return</span> e.state;
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}
</code></pre>
<h4 data-id="heading-8">ä½¿ç”¨ OperatorState</h4>
<p>OperatorState åº•å±‚ä½¿ç”¨çš„æ˜¯ PartitionableListStateï¼Œå‰é¢ä¹Ÿæåˆ°äº†ï¼Œå®ƒçš„å†…éƒ¨ç”¨äº†ä¸€ä¸ª ArrayList æ¥ä¿å­˜æ•°æ®ï¼Œå¯¹äº OperatorState çš„å„ç§æ“ä½œä¹Ÿéƒ½æ˜¯æ¥æ“ä½œè¿™ä¸ª ArrayListã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">clear</span><span class="hljs-params">()</span> {
    internalList.clear();
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> Iterable&lt;S&gt; <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> internalList;
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(S value)</span> {
    Preconditions.checkNotNull(value, <span class="hljs-string">"You cannot add null to a ListState."</span>);
    internalList.add(value);
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">update</span><span class="hljs-params">(List&lt;S&gt; values)</span> {
    internalList.clear();

    addAll(values);
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addAll</span><span class="hljs-params">(List&lt;S&gt; values)</span> {
    Preconditions.checkNotNull(values, <span class="hljs-string">"List of values to add cannot be null."</span>);
    <span class="hljs-keyword">if</span> (!values.isEmpty()) {
        <span class="hljs-keyword">for</span> (S value : values) {
            checkNotNull(value, <span class="hljs-string">"Any value to add to a list cannot be null."</span>);
            add(value);
        }
    }
}
</code></pre>
<h3 data-id="heading-9">æ€»ç»“</h3>
<p>æœ¬æ–‡å¯¹ State çš„ç›¸å…³ä»£ç è¿›è¡Œäº†æ¢³ç†ã€‚åŒ…æ‹¬ StateBackend çš„åˆ›å»ºï¼ŒKeyedState å’Œ OperatorState çš„åˆ›å»ºå’Œä½¿ç”¨ã€‚State å’Œ Checkpoint ä¸¤è€…éœ€è¦ç»“åˆä½¿ç”¨ï¼Œå› æ­¤åé¢æˆ‘ä»¬ä¼šå†æ¢³ç† Checkpoint çš„ç›¸å…³ä»£ç ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java çš„é‡‘é¢è®¡ç®—ç”¨ long è¿˜æ˜¯ BigDecimalï¼Ÿèµ„æ·±ç¨‹åºå‘˜è¿™æ ·é€‰]]></title>    <link>https://juejin.cn/post/7585485074038554630</link>    <guid>https://juejin.cn/post/7585485074038554630</guid>    <pubDate>2025-12-21T02:42:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585485074038554630" data-draft-id="7577705544875589670" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java çš„é‡‘é¢è®¡ç®—ç”¨ long è¿˜æ˜¯ BigDecimalï¼Ÿèµ„æ·±ç¨‹åºå‘˜è¿™æ ·é€‰"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2025-12-21T02:42:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åˆ˜å¤§å"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java çš„é‡‘é¢è®¡ç®—ç”¨ long è¿˜æ˜¯ BigDecimalï¼Ÿèµ„æ·±ç¨‹åºå‘˜è¿™æ ·é€‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åˆ˜å¤§å
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T02:42:38.000Z" title="Sun Dec 21 2025 02:42:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>æœ€è¿‘æ¥è§¦ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå‘ç°ç³»ç»Ÿä¸­æ‰€æœ‰é‡‘é¢ç›¸å…³å­—æ®µéƒ½ä½¿ç”¨<code>long</code>ç±»å‹æ¥è¡¨ç¤ºã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªä¹ æƒ¯ä½¿ç”¨<code>BigDecimal</code>å¤„ç†é‡‘é¢çš„å¼€å‘è€…ï¼Œè¿™è®©æˆ‘äº§ç”Ÿäº†ç–‘æƒ‘ï¼šè¿™ä¼šä¸ä¼šæœ‰ç²¾åº¦é—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿ</p>
<p>â€œç”¨<code>double</code>ä¸è¡Œå—ï¼Ÿå®ƒä¹Ÿèƒ½è¡¨ç¤ºå°æ•°å•Šï¼â€</p>
<p>ç»è¿‡ä¸€ç•ªç ”ç©¶å’Œæ€è€ƒï¼ŒæŠŠæœ€ç»ˆå¾—å‡ºçš„ç»“è®ºæ¥å’Œå¤§å®¶è¯¦ç»†åˆ†äº«ä¸€ä¸‹ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€doubleã€floatç±»å‹æ¯”è¾ƒ</h3>
<p><code>double</code>å’Œ<code>float</code>éƒ½æ˜¯Javaä¸­çš„æµ®ç‚¹æ•°ç±»å‹ï¼Œå®ƒä»¬é‡‡ç”¨IEEE 754æ ‡å‡†æ¥è¡¨ç¤ºå°æ•°ã€‚</p>
<p>è¿™ç§è¡¨ç¤ºæ–¹æ³•ç±»ä¼¼äºç§‘å­¦è®¡æ•°æ³•ï¼Œä½†å­˜åœ¨ä¸€ä¸ªè‡´å‘½é—®é¢˜ï¼š<strong>ä¸æ˜¯æ‰€æœ‰å°æ•°éƒ½èƒ½ç²¾ç¡®è¡¨ç¤º</strong>ã€‚</p>
<p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">double</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.1</span>;
<span class="hljs-type">double</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">0.2</span>;
<span class="hljs-type">double</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> a + b;
System.out.println(result); 
<span class="hljs-comment">// è¾“å‡ºï¼š0.30000000000000004</span>
</code></pre>
<p>ä»€ä¹ˆï¼Ÿç®€å•çš„0.1 + 0.2å±…ç„¶ä¸ç­‰äº0.3ï¼Ÿ</p>
<p>æ˜¯çš„ï¼Œè¿™æ˜¯å› ä¸ºåœ¨äºŒè¿›åˆ¶çš„è®¡ç®—ä¸­ï¼Œæœ‰äº›åè¿›åˆ¶å°æ•°æ²¡æœ‰åŠæ³•ç²¾ç¡®è¡¨ç¤ºï¼Œå°±åƒ1é™¤ä»¥3ä¸€æ ·ï¼Œåœ¨åè¿›åˆ¶ä¸­ä¹Ÿä¸èƒ½ç²¾ç¡®è¡¨ç¤ºï¼ˆ0.33333...ï¼‰ã€‚</p>
<h3 data-id="heading-2">äºŒã€BigDecimal è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-3">BigDecimalçš„æ­£ç¡®ç”¨æ³•</h4>
<p><code>BigDecimal</code>å¯ä»¥è§£å†³ç²¾åº¦é—®é¢˜ï¼Œä½†å¿…é¡»æ­£ç¡®ä½¿ç”¨ã€‚</p>
<p><strong>é”™è¯¯çš„æ„é€ æ–¹å¼</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BigDecimal</span> <span class="hljs-variable">wrong1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.1</span>); 
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">wrong2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.2</span>);
</code></pre>
<p>è¿™ç§ä¼ å…¥æµ®ç‚¹å‹çš„æ„é€ æ–¹å¼è¿˜æ˜¯ä¼šæœ‰ç²¾åº¦é—®é¢˜ã€‚</p>
<p><strong>æ­£ç¡®çš„æ„é€ æ–¹å¼</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BigDecimal</span> <span class="hljs-variable">correct1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.1"</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">correct2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.2"</span>);
System.out.println(<span class="hljs-string">"æ­£ç¡®æ–¹å¼: "</span> + correct1.add(correct2)); <span class="hljs-comment">// 0.3</span>
</code></pre>
<p>é€šè¿‡ä¼ å…¥å­—ç¬¦ä¸²è¿›è¡Œæ„é€ ã€‚</p>
<p><strong>æˆ–è€…ç”¨valueOfï¼ˆå†…éƒ¨ä¹Ÿæ˜¯è½¬å­—ç¬¦ä¸²ï¼‰</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BigDecimal</span> <span class="hljs-variable">safe1</span> <span class="hljs-operator">=</span> BigDecimal.valueOf(<span class="hljs-number">0.1</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">safe2</span> <span class="hljs-operator">=</span> BigDecimal.valueOf(<span class="hljs-number">0.2</span>);
System.out.println(<span class="hljs-string">"å®‰å…¨æ–¹å¼: "</span> + safe1.add(safe2)); <span class="hljs-comment">// 0.3</span>
</code></pre>
<h4 data-id="heading-4">BigDecimalçš„è¿ç®—è§„åˆ™</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigDecimalOperations</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"19.99"</span>);
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">quantity</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"3"</span>);
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">taxRate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.13"</span>);
        
        <span class="hljs-comment">// ä¹˜æ³•</span>
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">subtotal</span> <span class="hljs-operator">=</span> price.multiply(quantity);
        
        <span class="hljs-comment">// é™¤æ³•å¿…é¡»æŒ‡å®šç²¾åº¦å’Œèˆå…¥æ¨¡å¼</span>
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">tax</span> <span class="hljs-operator">=</span> subtotal.multiply(taxRate)
                               .setScale(<span class="hljs-number">2</span>, RoundingMode.HALF_UP);
        
        <span class="hljs-comment">// åŠ æ³•</span>
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> subtotal.add(tax);
        
        System.out.println(<span class="hljs-string">"å°è®¡: "</span> + subtotal); <span class="hljs-comment">// 59.97</span>
        System.out.println(<span class="hljs-string">"ç¨é‡‘: "</span> + tax);      <span class="hljs-comment">// 7.80</span>
        System.out.println(<span class="hljs-string">"æ€»è®¡: "</span> + total);    <span class="hljs-comment">// 67.77</span>
    }
}
</code></pre>
<h4 data-id="heading-5">BigDecimalçš„æ¯”è¾ƒæ“ä½œ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BigDecimalComparison</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"10.00"</span>);
        <span class="hljs-type">BigDecimal</span> <span class="hljs-variable">num2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"10.000"</span>);
        
        <span class="hljs-comment">// é”™è¯¯ï¼šæ¯”è¾ƒå¼•ç”¨</span>
        System.out.println(<span class="hljs-string">"== æ¯”è¾ƒ: "</span> + (num1 == num2)); <span class="hljs-comment">// false</span>
        
        <span class="hljs-comment">// é”™è¯¯ï¼šequalsä¼šæ¯”è¾ƒç²¾åº¦</span>
        System.out.println(<span class="hljs-string">"equalsæ¯”è¾ƒ: "</span> + num1.equals(num2)); <span class="hljs-comment">// false</span>
        
        <span class="hljs-comment">// æ­£ç¡®ï¼šcompareToåªæ¯”è¾ƒæ•°å€¼</span>
        System.out.println(<span class="hljs-string">"compareToæ¯”è¾ƒ: "</span> + (num1.compareTo(num2) == <span class="hljs-number">0</span>)); <span class="hljs-comment">// true</span>
    }
}
</code></pre>
<h4 data-id="heading-6">BigDecimalçš„ç¼ºç‚¹</h4>
<ol>
<li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šå¯¹è±¡åˆ›å»ºå’Œè¿ç®—æˆæœ¬é«˜</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šæ¯ä¸ªå¯¹è±¡éœ€è¦20-30å­—èŠ‚</li>
<li><strong>ä½¿ç”¨å¤æ‚</strong>ï¼šå®¹æ˜“ç”¨é”™æ„é€ æ–¹æ³•å’Œè¿ç®—è§„åˆ™</li>
<li><strong>ä»£ç å†—é•¿</strong>ï¼šç®€å•çš„è¿ç®—ä¹Ÿéœ€è¦å¤šè¡Œä»£ç </li>
</ol>
<h3 data-id="heading-7">ä¸‰ã€longæ–¹æ¡ˆ</h3>
<h4 data-id="heading-8">æ ¸å¿ƒæ€æƒ³ï¼šä»¥åˆ†ä¸ºå•ä½å­˜å‚¨</h4>
<p>ä½¿ç”¨<code>long</code>è¡¨ç¤ºé‡‘é¢çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼šä¸ä»¥å…ƒä¸ºå•ä½ï¼Œè€Œä»¥æœ€å°è´§å¸å•ä½ï¼ˆåˆ†ï¼‰å­˜å‚¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LongAmountDemo</span> {
    <span class="hljs-comment">// å·¥å…·æ–¹æ³•ï¼šå…ƒè½¬åˆ†</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">yuanToFen</span><span class="hljs-params">(<span class="hljs-type">double</span> yuan)</span> {
        <span class="hljs-keyword">return</span> Math.round(yuan * <span class="hljs-number">100</span>);
    }
    
    <span class="hljs-comment">// å·¥å…·æ–¹æ³•ï¼šåˆ†è½¬å…ƒï¼ˆç”¨äºæ˜¾ç¤ºï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">fenToYuanDisplay</span><span class="hljs-params">(<span class="hljs-type">long</span> fen)</span> {
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"Â¥%.2f"</span>, fen / <span class="hljs-number">100.0</span>);
    }
    
    <span class="hljs-comment">// å·¥å…·æ–¹æ³•ï¼šåˆ†è½¬å…ƒï¼ˆç”¨äºè®¡ç®—ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> <span class="hljs-title function_">fenToYuan</span><span class="hljs-params">(<span class="hljs-type">long</span> fen)</span> {
        <span class="hljs-keyword">return</span> fen / <span class="hljs-number">100.0</span>;
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// ä»¥åˆ†ä¸ºå•ä½å­˜å‚¨æ‰€æœ‰é‡‘é¢</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">price</span> <span class="hljs-operator">=</span> yuanToFen(<span class="hljs-number">19.99</span>);  <span class="hljs-comment">// 1999åˆ† = 19.99å…ƒ</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">quantity</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-type">long</span> <span class="hljs-variable">taxRate</span> <span class="hljs-operator">=</span> <span class="hljs-number">13</span>;  <span class="hljs-comment">// 13% = 0.13ï¼Œè¿™é‡Œç”¨æ•´æ•°è¡¨ç¤ºç™¾åˆ†æ¯”</span>
        
        <span class="hljs-comment">// è®¡ç®—è¿‡ç¨‹å…¨éƒ¨ä½¿ç”¨æ•´æ•°è¿ç®—</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">subtotal</span> <span class="hljs-operator">=</span> price * quantity;                    <span class="hljs-comment">// 5997åˆ†</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">tax</span> <span class="hljs-operator">=</span> (subtotal * taxRate) / <span class="hljs-number">100</span>;               <span class="hljs-comment">// 780åˆ†</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">total</span> <span class="hljs-operator">=</span> subtotal + tax;                         <span class="hljs-comment">// 6777åˆ†</span>
        
        System.out.println(<span class="hljs-string">"å°è®¡: "</span> + fenToYuanDisplay(subtotal)); <span class="hljs-comment">// Â¥59.97</span>
        System.out.println(<span class="hljs-string">"ç¨é‡‘: "</span> + fenToYuanDisplay(tax));      <span class="hljs-comment">// Â¥7.80</span>
        System.out.println(<span class="hljs-string">"æ€»è®¡: "</span> + fenToYuanDisplay(total));    <span class="hljs-comment">// Â¥67.77</span>
    }
}
</code></pre>
<h4 data-id="heading-9">longæ–¹æ¡ˆçš„ä¼˜åŠ¿</h4>
<p><strong>1.ç»å¯¹ç²¾ç¡®</strong>
æ•´æ•°è¿ç®—åœ¨è®¡ç®—æœºä¸­æ˜¯ç²¾ç¡®çš„ï¼Œä¸ä¼šå‡ºç°æµ®ç‚¹æ•°çš„ç²¾åº¦é—®é¢˜ã€‚</p>
<p><strong>2.æ€§èƒ½å“è¶Š</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// longè¿ç®— - æœºå™¨æŒ‡ä»¤çº§åˆ«ï¼Œæå¿«</span>
<span class="hljs-type">long</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1000L</span>, b = <span class="hljs-number">2000L</span>;
<span class="hljs-type">long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> a + b;

<span class="hljs-comment">// BigDecimalè¿ç®— - æ–¹æ³•è°ƒç”¨ï¼Œå¯¹è±¡åˆ›å»ºï¼Œè¾ƒæ…¢</span>
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"10.00"</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"20.00"</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">result2</span> <span class="hljs-operator">=</span> c.add(d);
</code></pre>
<p><strong>3.å­˜å‚¨é«˜æ•ˆ</strong></p>
<ul>
<li><code>long</code>ï¼šå›ºå®š8å­—èŠ‚</li>
<li><code>BigDecimal</code>ï¼šå¯¹è±¡å¤´+æ•°å€¼ï¼Œé€šå¸¸20-30å­—èŠ‚</li>
</ul>
<p><strong>4.åºåˆ—åŒ–ç®€å•</strong>
åœ¨æ•°æ®åº“ã€JSONã€ç½‘ç»œä¼ è¾“ä¸­å¤„ç†æ›´ç®€å•ã€‚</p>
<h4 data-id="heading-10">å®é™…ä¸šåŠ¡åº”ç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-comment">// è®¢å•é‡‘é¢ï¼ˆåˆ†ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> orderAmount;
    <span class="hljs-comment">// ä¼˜æƒ é‡‘é¢ï¼ˆåˆ†ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> discountAmount;
    <span class="hljs-comment">// å®ä»˜é‡‘é¢ï¼ˆåˆ†ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> actualAmount;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">calculateOrder</span><span class="hljs-params">(<span class="hljs-type">long</span> unitPrice, <span class="hljs-type">int</span> quantity, <span class="hljs-type">long</span> discountRate)</span> {
        <span class="hljs-comment">// è®¡ç®—è®¢å•é‡‘é¢</span>
        orderAmount = unitPrice * quantity;
        
        <span class="hljs-comment">// è®¡ç®—ä¼˜æƒ é‡‘é¢</span>
        discountAmount = (orderAmount * discountRate) / <span class="hljs-number">100</span>;
        
        <span class="hljs-comment">// è®¡ç®—å®ä»˜é‡‘é¢</span>
        actualAmount = orderAmount - discountAmount;
    }
    
    <span class="hljs-comment">// æ˜¾ç¤ºæ–¹æ³•</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getDisplayAmount</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"è®¢å•é‡‘é¢: %s, ä¼˜æƒ : %s, å®ä»˜: %s"</span>, 
            formatFen(orderAmount),
            formatFen(discountAmount),
            formatFen(actualAmount));
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">formatFen</span><span class="hljs-params">(<span class="hljs-type">long</span> fen)</span> {
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"Â¥%.2f"</span>, fen / <span class="hljs-number">100.0</span>);
    }
}
</code></pre>
<h3 data-id="heading-11">å››ã€å„ç§æ–¹æ¡ˆçš„é€‚ç”¨åœºæ™¯</h3>
<h4 data-id="heading-12">double/floatï¼šç»å¯¹ä¸è¦ç”¨äºé‡‘é¢</h4>
<ul>
<li>ç§‘å­¦è®¡ç®—ã€å›¾å½¢å¤„ç†</li>
<li>ç»Ÿè®¡åˆ†æï¼ˆå…è®¸è¯¯å·®ï¼‰</li>
<li>ç‰©ç†æ¨¡æ‹Ÿ</li>
<li>ä¸é€‚ç”¨äºä»»ä½•é‡‘é¢è®¡ç®—</li>
</ul>
<h4 data-id="heading-13">BigDecimalï¼šå¤æ‚é‡‘èè®¡ç®—</h4>
<ul>
<li>é«˜ç²¾åº¦åˆ©ç‡ã€æ±‡ç‡è®¡ç®—</li>
<li>ç¨åŠ¡è®¡ç®—ï¼ˆéœ€è¦å¤æ‚å°æ•°è¿ç®—ï¼‰</li>
<li>é“¶è¡Œæ ¸å¿ƒç³»ç»Ÿ</li>
<li>éœ€è¦ä»»æ„ç²¾åº¦çš„åœºæ™¯</li>
</ul>
<h4 data-id="heading-14">longï¼šå¤§å¤šæ•°ä¸šåŠ¡ç³»ç»Ÿ</h4>
<ul>
<li>ç”µå•†è®¢å•ç³»ç»Ÿ</li>
<li>æ”¯ä»˜ç³»ç»Ÿ</li>
<li>è´¦æˆ·ä½™é¢ç®¡ç†</li>
<li>ç§¯åˆ†ã€ä¼˜æƒ åˆ¸ç³»ç»Ÿ</li>
</ul>
<h3 data-id="heading-15">äº”ã€BigDecimalçš„æœ€ä½³å®è·µ</h3>
<p>å¦‚æœç¡®å®éœ€è¦ä½¿ç”¨BigDecimalï¼Œè¯·éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š</p>
<h4 data-id="heading-16">1. æ„é€ æ–¹æ³•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// æ¨è</span>
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"0.1"</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> BigDecimal.valueOf(<span class="hljs-number">0.1</span>);  <span class="hljs-comment">// å†…éƒ¨è½¬å­—ç¬¦ä¸²</span>

<span class="hljs-comment">// é¿å…</span>
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-number">0.1</span>);      <span class="hljs-comment">// ç²¾åº¦é—®é¢˜</span>
</code></pre>
<h4 data-id="heading-17">2. è¿ç®—æ§åˆ¶</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BigDecimal</span> <span class="hljs-variable">num1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"10.00"</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">num2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"3.00"</span>);

<span class="hljs-comment">// é™¤æ³•å¿…é¡»æŒ‡å®šç²¾åº¦</span>
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> num1.divide(num2, <span class="hljs-number">4</span>, RoundingMode.HALF_UP);

<span class="hljs-comment">// ä¹˜æ³•å»ºè®®æ§åˆ¶ç²¾åº¦</span>
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> num1.multiply(num2).setScale(<span class="hljs-number">2</span>, RoundingMode.HALF_UP);
</code></pre>
<h4 data-id="heading-18">3. æ•°å€¼æ¯”è¾ƒ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">BigDecimal</span> <span class="hljs-variable">amount1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100.00"</span>);
<span class="hljs-type">BigDecimal</span> <span class="hljs-variable">amount2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BigDecimal</span>(<span class="hljs-string">"100.000"</span>);

<span class="hljs-comment">// æ­£ç¡®</span>
<span class="hljs-keyword">if</span> (amount1.compareTo(amount2) == <span class="hljs-number">0</span>) {
    <span class="hljs-comment">// æ•°å€¼ç›¸ç­‰</span>
}

<span class="hljs-comment">// é”™è¯¯</span>
<span class="hljs-keyword">if</span> (amount1.equals(amount2)) {
    <span class="hljs-comment">// ä¸ä¼šæ‰§è¡Œï¼Œå› ä¸ºç²¾åº¦ä¸åŒ</span>
}
</code></pre>
<h3 data-id="heading-19">å…­ã€longæ–¹æ¡ˆçš„å®æ–½å»ºè®®</h3>
<h4 data-id="heading-20">1. å»ºç«‹å·¥å…·ç±»</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MoneyUtils</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">MoneyUtils</span><span class="hljs-params">()</span> {} <span class="hljs-comment">// å·¥å…·ç±»ï¼Œé˜²æ­¢å®ä¾‹åŒ–</span>
    
    <span class="hljs-comment">// å…ƒè½¬åˆ†</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">yuanToFen</span><span class="hljs-params">(<span class="hljs-type">double</span> yuan)</span> {
        <span class="hljs-keyword">return</span> Math.round(yuan * <span class="hljs-number">100</span>);
    }
    
    <span class="hljs-comment">// åˆ†è½¬å…ƒï¼ˆæ˜¾ç¤ºç”¨ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">fenToDisplayYuan</span><span class="hljs-params">(<span class="hljs-type">long</span> fen)</span> {
        <span class="hljs-keyword">return</span> String.format(<span class="hljs-string">"Â¥%.2f"</span>, fen / <span class="hljs-number">100.0</span>);
    }
    
    <span class="hljs-comment">// åˆ†è½¬å…ƒï¼ˆè®¡ç®—ç”¨ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">double</span> <span class="hljs-title function_">fenToYuan</span><span class="hljs-params">(<span class="hljs-type">long</span> fen)</span> {
        <span class="hljs-keyword">return</span> fen / <span class="hljs-number">100.0</span>;
    }
    
    <span class="hljs-comment">// é‡‘é¢åŠ æ³•ï¼ˆé˜²æ­¢æº¢å‡ºï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">long</span> amount1, <span class="hljs-type">long</span> amount2)</span> {
        <span class="hljs-keyword">return</span> Math.addExact(amount1, amount2);
    }
    
    <span class="hljs-comment">// é‡‘é¢ä¹˜æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">long</span> <span class="hljs-title function_">multiply</span><span class="hljs-params">(<span class="hljs-type">long</span> amount, <span class="hljs-type">int</span> multiplier)</span> {
        <span class="hljs-keyword">return</span> Math.multiplyExact(amount, multiplier);
    }
}
</code></pre>
<h4 data-id="heading-21">2. æ•°æ®åº“è®¾è®¡</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä½¿ç”¨bigintå­˜å‚¨é‡‘é¢ï¼ˆåˆ†ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> orders (
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    order_amount <span class="hljs-type">BIGINT</span> COMMENT <span class="hljs-string">'è®¢å•é‡‘é¢ï¼ˆåˆ†ï¼‰'</span>,
    discount_amount <span class="hljs-type">BIGINT</span> COMMENT <span class="hljs-string">'ä¼˜æƒ é‡‘é¢ï¼ˆåˆ†ï¼‰'</span>,
    actual_amount <span class="hljs-type">BIGINT</span> COMMENT <span class="hljs-string">'å®ä»˜é‡‘é¢ï¼ˆåˆ†ï¼‰'</span>
);
</code></pre>
<h4 data-id="heading-22">3. APIè®¾è®¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¯·æ±‚å’Œå“åº”ä¸­ä½¿ç”¨Longç±»å‹è¡¨ç¤ºé‡‘é¢ï¼ˆåˆ†ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderRequest</span> {
    <span class="hljs-keyword">private</span> Long productId;
    <span class="hljs-keyword">private</span> Integer quantity;
    <span class="hljs-keyword">private</span> Long unitPrice;  <span class="hljs-comment">// å•ä»·ï¼ˆåˆ†ï¼‰</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderResponse</span> {
    <span class="hljs-keyword">private</span> String orderNo;
    <span class="hljs-keyword">private</span> Long totalAmount;  <span class="hljs-comment">// æ€»é‡‘é¢ï¼ˆåˆ†ï¼‰</span>
    <span class="hljs-keyword">private</span> String displayAmount; <span class="hljs-comment">// æ˜¾ç¤ºé‡‘é¢ "Â¥99.99"</span>
}
</code></pre>
<h3 data-id="heading-23">æ€»ç»“ä¸é€‰æ‹©</h3>
<h4 data-id="heading-24">ä¸ºä»€ä¹ˆé‚£ä¸ªé¡¹ç›®é€‰æ‹©longï¼Ÿ</h4>
<p>ç°åœ¨æˆ‘å¯ä»¥ç†è§£é‚£ä¸ªé¡¹ç›®çš„è®¾è®¡æ€è·¯äº†ï¼š</p>
<ol>
<li><strong>ä¸šåŠ¡ç‰¹æ€§</strong>ï¼šä¸»è¦æ˜¯ç®€å•çš„åŠ å‡ä¹˜è¿ç®—ï¼Œæ²¡æœ‰å¤æ‚çš„å°æ•°é™¤æ³•</li>
<li><strong>æ€§èƒ½è¦æ±‚</strong>ï¼šé«˜å¹¶å‘åœºæ™¯ï¼Œéœ€è¦æœ€ä¼˜æ€§èƒ½</li>
<li><strong>å›¢é˜Ÿåä½œ</strong>ï¼šç»Ÿä¸€è§„èŒƒï¼Œé¿å…BigDecimalçš„è¯¯ç”¨</li>
<li><strong>ç³»ç»Ÿå¤æ‚åº¦</strong>ï¼šé™ä½ç³»ç»Ÿå¤æ‚åº¦å’Œç»´æŠ¤æˆæœ¬</li>
</ol>
<h4 data-id="heading-25">å¦‚ä½•é€‰æ‹©ï¼Ÿ</h4>



































<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>ç†ç”±</th></tr></thead><tbody><tr><td>ç®€å•ä¸šåŠ¡ç³»ç»Ÿ</td><td><strong>long</strong></td><td>æ€§èƒ½å¥½ï¼Œç®€å•å¯é </td></tr><tr><td>é“¶è¡Œé‡‘èç³»ç»Ÿ</td><td><strong>BigDecimal</strong></td><td>ç²¾åº¦è¦æ±‚æé«˜</td></tr><tr><td>é«˜å¹¶å‘äº¤æ˜“</td><td><strong>long</strong></td><td>æ€§èƒ½è‡³å…³é‡è¦</td></tr><tr><td>å¤æ‚ç¨åŠ¡è®¡ç®—</td><td><strong>BigDecimal</strong></td><td>éœ€è¦å¤æ‚å°æ•°è¿ç®—</td></tr><tr><td>æ–°é¡¹ç›®å¯åŠ¨</td><td><strong>long</strong></td><td>æŠ€æœ¯å€ºåŠ¡å°‘</td></tr></tbody></table>
<p>æŠ€æœ¯é€‰å‹ä»æ¥éƒ½ä¸æ˜¯å•ä¸€çš„ï¼Œç†è§£ä¸šåŠ¡çš„éœ€æ±‚ï¼Œèƒ½é€‰æ‹©å‡ºæœ€é€‚åˆçš„æŠ€æœ¯æ–¹æ¡ˆå°±æ˜¯æœ€å¥½çš„æ–¹æ¡ˆã€‚</p>
<blockquote>
<p>æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ï¼šç¨‹åºå‘˜åˆ˜å¤§åï¼Œä¸“æ³¨åˆ†äº«å‰åç«¯å¼€å‘çš„å®æˆ˜ç¬”è®°ã€‚å…³æ³¨æˆ‘ï¼Œå°‘èµ°å¼¯è·¯ï¼Œä¸€èµ·è¿›æ­¥ï¼</p>
</blockquote>
<h4 data-id="heading-26">ğŸ“Œå¾€æœŸç²¾å½©</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F6V83qjR6u0nyfzL-14xYAw" target="_blank" title="https://mp.weixin.qq.com/s/6V83qjR6u0nyfzL-14xYAw" ref="nofollow noopener noreferrer">ã€Šasync/await åˆ°åº•è¦ä¸è¦åŠ  try-catchï¼Ÿå¼‚æ­¥é”™è¯¯å¤„ç†æœ€ä½³å®è·µã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPQ_w7CDVoIZPn-CVH2DKJg" target="_blank" title="https://mp.weixin.qq.com/s/PQ_w7CDVoIZPn-CVH2DKJg" ref="nofollow noopener noreferrer">ã€ŠVue3 å’Œ Vue2 çš„æ ¸å¿ƒåŒºåˆ«ï¼Ÿå¾ˆå¤šå¼€å‘è€…éƒ½æ²¡å®Œå…¨ææ‡‚çš„ 10 ä¸ªç»†èŠ‚ã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fp0n2mN5RDDDaIWuHHVRUZQ" target="_blank" title="https://mp.weixin.qq.com/s/p0n2mN5RDDDaIWuHHVRUZQ" ref="nofollow noopener noreferrer">ã€ŠJava å¼€å‘å¿…çœ‹ï¼šä»€ä¹ˆæ—¶å€™ç”¨ forï¼Œä»€ä¹ˆæ—¶å€™ç”¨ Streamï¼Ÿã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqI3TRTdDfRJSH9kCTqAQUw" target="_blank" title="https://mp.weixin.qq.com/s/qI3TRTdDfRJSH9kCTqAQUw" ref="nofollow noopener noreferrer">ã€Šè¿™ 10 ä¸ª MySQL é«˜çº§ç”¨æ³•ï¼Œè®©ä½ çš„ä»£ç åˆå¿«åˆå¥½çœ‹ã€‹</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript åˆ—è¡¨è½¬æ ‘ï¼ˆList to Treeï¼‰è¯¦è§£ï¼šå‰ç«¯é¢è¯•ä¸­å¦‚ä½•ä»é€’å½’ O(nÂ²) ä¼˜åŒ–åˆ°ä¸€æ¬¡éå† O(n)]]></title>    <link>https://juejin.cn/post/7585706951603716122</link>    <guid>https://juejin.cn/post/7585706951603716122</guid>    <pubDate>2025-12-21T02:53:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585706951603716122" data-draft-id="7585534343561822258" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript åˆ—è¡¨è½¬æ ‘ï¼ˆList to Treeï¼‰è¯¦è§£ï¼šå‰ç«¯é¢è¯•ä¸­å¦‚ä½•ä»é€’å½’ O(nÂ²) ä¼˜åŒ–åˆ°ä¸€æ¬¡éå† O(n)"/> <meta itemprop="keywords" content="JavaScript,ç®—æ³•,é¢è¯•"/> <meta itemprop="datePublished" content="2025-12-21T02:53:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç™½å…°åœ°ç©ºç“¶"/> <meta itemprop="url" content="https://juejin.cn/user/191753514127514"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript åˆ—è¡¨è½¬æ ‘ï¼ˆList to Treeï¼‰è¯¦è§£ï¼šå‰ç«¯é¢è¯•ä¸­å¦‚ä½•ä»é€’å½’ O(nÂ²) ä¼˜åŒ–åˆ°ä¸€æ¬¡éå† O(n)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/191753514127514/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç™½å…°åœ°ç©ºç“¶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T02:53:55.000Z" title="Sun Dec 21 2025 02:53:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€ï¼šOffer æ˜¯æ€ä¹ˆæ²¡çš„ï¼Ÿ</h2>
<p>åœ¨å‰ç«¯é¢è¯•çš„æ±Ÿæ¹–é‡Œï¼Œ<strong>ã€Œåˆ—è¡¨è½¬æ ‘ï¼ˆList to Treeï¼‰ã€</strong> æ˜¯ä¸€é“å¦¥å¦¥çš„é«˜é¢‘é¢˜ã€‚</p>
<p>å¾ˆå¤šåŒå­¦ä¸€çœ‹åˆ°è¿™é“é¢˜ï¼Œå†…å¿ƒ OS éƒ½æ˜¯ï¼š</p>
<blockquote>
<p>ğŸ˜ã€Œç®€å•å•Šï¼Œé€’å½’ï¼ã€</p>
</blockquote>
<p>ä»£ç å†™å®Œï¼Œè‡ªä¿¡æŠ¬å¤´ã€‚<br/>
é¢è¯•å®˜å´æ…¢æ‚ æ‚ åœ°é—®äº†ä¸€å¥ï¼š</p>
<blockquote>
<p>ğŸ¤¨ã€Œå¦‚æœæ˜¯ <strong>10 ä¸‡æ¡æ•°æ®</strong> å‘¢ï¼Ÿ<br/>
ğŸ‘‰ æ—¶é—´å¤æ‚åº¦å¤šå°‘ï¼Ÿ<br/>
ğŸ‘‰ ä¼šä¸ä¼šæ ˆæº¢å‡ºï¼Ÿã€</p>
</blockquote>
<p><strong>ç©ºæ°”çªç„¶å®‰é™ã€‚</strong></p>
<p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±æŠŠè¿™é“é¢˜å½»åº•æ‹†å¼€ï¼š<br/>
ä»ã€Œèƒ½å†™ã€åˆ°ã€Œå†™å¾—å¯¹ã€ï¼Œå†åˆ°ã€Œå†™å¾—æ¼‚äº®ã€ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€ä¸ºä»€ä¹ˆé¢è¯•å®˜æ€»ç›¯ç€è¿™æ£µâ€œæ ‘â€ï¼Ÿ</h2>
<p>å› ä¸ºåœ¨çœŸå®ä¸šåŠ¡ä¸­ï¼Œ<strong>åç«¯ç»™ä½ çš„å‡ ä¹æ°¸è¿œæ˜¯æ‰å¹³æ•°æ®</strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">const</span> <span class="hljs-string">list</span> <span class="hljs-string">=</span> [
  { <span class="hljs-attr">id:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">0</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'åŒ—äº¬å¸‚'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">2</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'é¡ºä¹‰åŒº'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">3</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">1</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'æœé˜³åŒº'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">4</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">2</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'åæ²™å³ª'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">121</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">0</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'æ±Ÿè¥¿çœ'</span> },
  { <span class="hljs-attr">id:</span> <span class="hljs-number">155</span>, <span class="hljs-attr">parentId:</span> <span class="hljs-number">121</span>, <span class="hljs-attr">name:</span> <span class="hljs-string">'æŠšå·å¸‚'</span> }
]<span class="hljs-string">;</span>
</code></pre>
<p>è€Œå‰ç«¯ç»„ä»¶ï¼ˆMenuã€Treeã€Cascaderï¼‰è¦çš„å´æ˜¯ğŸ‘‡</p>
<pre><code class="hljs language-markdown" lang="markdown">çœ
 â””â”€ å¸‚
<span class="hljs-code">     â””â”€ åŒº
</span></code></pre>
<hr/>
<h3 data-id="heading-2">ğŸ¯ é¢è¯•å®˜çš„çœŸå®è€ƒç‚¹</h3>
<ul>
<li><strong>æ•°æ®ç»“æ„ç†è§£</strong>ï¼šæ˜¯å¦çœŸæ­£ç†è§£ <code>parentId</code></li>
<li><strong>é€’å½’æ„è¯† &amp; ä»£ä»·</strong>ï¼šä¸åªä¼šå†™ï¼Œè¿˜è¦çŸ¥é“å‘åœ¨å“ª</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–èƒ½åŠ›</strong>ï¼šèƒ½å¦ä» <code>O(nÂ²)</code> ä¼˜åŒ–åˆ° <code>O(n)</code></li>
<li><strong>JS å¼•ç”¨ç†è§£</strong>ï¼šæ˜¯å¦ç†è§£å¯¹è±¡åœ¨å†…å­˜ä¸­çš„è¡¨ç°</li>
</ul>
<hr/>
<h2 data-id="heading-3">äºŒã€ç¬¬ä¸€é‡å¢ƒç•Œï¼šé€’å½’æ³•ï¼ˆèƒ½å†™ï¼Œä½†ä¸ç¨³ï¼‰</h2>
<h3 data-id="heading-4">1ï¸âƒ£ æœ€åŸºç¡€çš„é€’å½’å†™æ³•</h3>
<pre><code class="hljs language-ini" lang="ini">function list2tree(list, <span class="hljs-attr">parentId</span> = <span class="hljs-number">0</span>) {
  return list
    .filter(<span class="hljs-attr">item</span> =&gt; item.parentId === parentId)
    .map(<span class="hljs-attr">item</span> =&gt; ({
      ...item,
      children: list2tree(list, item.id)
    }))<span class="hljs-comment">;</span>
}
</code></pre>
<p>é€»è¾‘éå¸¸ç›´è§‚ï¼š</p>
<ul>
<li>æ‰¾å½“å‰ <code>parentId</code> çš„æ‰€æœ‰å­èŠ‚ç‚¹</li>
<li>å¯¹æ¯ä¸ªå­èŠ‚ç‚¹ç»§ç»­é€’å½’</li>
<li>æ²¡æœ‰å­èŠ‚ç‚¹æ—¶è‡ªç„¶é€€å‡º</li>
</ul>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€è¿›é˜¶ï¼šES6 ä¼˜é›…å†™æ³•ï¼ˆçœ‹èµ·æ¥å¾ˆé«˜çº§ï¼‰</h2>
<p>å¦‚æœä½ åœ¨é¢è¯•ä¸­å†™å‡ºä¸‹é¢è¿™æ®µä»£ç ğŸ‘‡<br/>
<strong>é¢è¯•å®˜å¤§æ¦‚ç‡ä¼šå…ˆç‚¹å¤´ã€‚</strong></p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">list2tree</span> = (list, parentId = <span class="hljs-number">0</span>) =&gt;
  list
    .filter(<span class="hljs-attr">item</span> =&gt; item.parentId === parentId)
    .map(<span class="hljs-attr">item</span> =&gt; ({
      ...item,              // è§£æ„èµ‹å€¼ï¼Œä¿æŒåŸå¯¹è±¡çº¯å‡€
      children: list2tree(list, item.id)
    }))<span class="hljs-comment">;</span>
</code></pre>
<p>è¿™ä¸€ç‰ˆä»£ç ï¼š</p>
<ul>
<li>âœ… ç®­å¤´å‡½æ•°</li>
<li>âœ… <code>filter + map</code> é“¾å¼è°ƒç”¨</li>
<li>âœ… è§£æ„èµ‹å€¼ï¼Œä¸æ±¡æŸ“åŸæ•°æ®</li>
<li>âœ… å¯è¯»æ€§å¾ˆå¥½ï¼Œçœ‹èµ·æ¥å¾ˆâ€œES6â€</li>
</ul>
<p>ğŸ‘‰ <strong>å¾ˆå¤šåŒå­¦åˆ°è¿™ä¸€æ­¥å°±è§‰å¾—ç¨³äº†ã€‚</strong></p>
<hr/>
<h3 data-id="heading-6">ğŸ¤” é¢è¯•å®˜çš„ç»å…¸è¿½é—®</h3>
<blockquote>
<p>ã€Œè¿™ä¸ªæ–¹æ¡ˆï¼Œæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿã€</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">ğŸ¯ æ ‡å‡†å›ç­”ï¼ˆä¸€å®šè¦è¯´å‡ºæ¥ï¼‰</h3>
<blockquote>
<p>ã€Œè¿™ä¸ªæ–¹æ¡ˆçš„æœ¬è´¨æ˜¯ <strong>åµŒå¥—å¾ªç¯</strong>ã€‚<br/>
æ¯ä¸€å±‚é€’å½’ï¼Œéƒ½ä¼šéå†ä¸€æ¬¡å®Œæ•´çš„ <code>list</code>ã€‚</p>
<p>ğŸ‘‰ æ—¶é—´å¤æ‚åº¦æ˜¯ <strong><code>O(nÂ²)</code></strong><br/>
ğŸ‘‰ å¦‚æœå±‚çº§è¿‡æ·±ï¼Œè¿˜å¯èƒ½å¯¼è‡´ <strong>æ ˆæº¢å‡ºï¼ˆStack Overflowï¼‰</strong> ã€‚ã€</p>
</blockquote>
<p>ğŸ“Œ <strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼š</p>
<blockquote>
<p>ES6 å†™æ³•åªæ˜¯â€œçœ‹èµ·æ¥ä¼˜é›…â€ï¼Œ<br/>
æ€§èƒ½é—®é¢˜ä¸ä¼šå› ä¸ºä»£ç å¥½çœ‹å°±è‡ªåŠ¨æ¶ˆå¤±ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-8">å››ã€ç¬¬äºŒé‡å¢ƒç•Œï¼šMap ä¼˜åŒ–ï¼ˆé¢è¯•åŠæ ¼çº¿ï¼‰</h2>
<p>æ—¢ç„¶æ…¢ï¼Œæ˜¯å› ä¸º<strong>åå¤éå†æ‰¾çˆ¶èŠ‚ç‚¹</strong>ï¼Œ<br/>
é‚£å°±ç”¨ <strong>Map å»ºç«‹ç´¢å¼•</strong>ã€‚</p>
<blockquote>
<p>ğŸ‘‰ å…¸å‹çš„ï¼š<strong>ç©ºé—´æ¢æ—¶é—´</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-9">æ ¸å¿ƒæ€è·¯</h3>
<ol>
<li>ç¬¬ä¸€éï¼šæŠŠæ‰€æœ‰èŠ‚ç‚¹æ”¾è¿› <code>Map</code></li>
<li>ç¬¬äºŒéï¼šé€šè¿‡ <code>parentId</code> ç›´æ¥æŒ‚è½½</li>
<li>åˆ©ç”¨ JS <strong>å¯¹è±¡å¼•ç”¨</strong>ï¼Œè‡ªåŠ¨åŒæ­¥æ ‘ç»“æ„</li>
</ol>
<hr/>
<h3 data-id="heading-10">ä»£ç å®ç°</h3>
<pre><code class="hljs language-ini" lang="ini">function listToTreeWithMap(list) {
  const <span class="hljs-attr">map</span> = new Map()<span class="hljs-comment">;</span>
  const <span class="hljs-attr">tree</span> = []<span class="hljs-comment">;</span>

  // åˆå§‹åŒ–
  for (const item of list) {
    map.set(item.id, { ...item, children: <span class="hljs-section">[]</span> })<span class="hljs-comment">;</span>
  }

  // æ„å»ºæ ‘
  for (const item of list) {
    const <span class="hljs-attr">node</span> = map.get(item.id)<span class="hljs-comment">;</span>
    if (<span class="hljs-attr">item.parentId</span> === <span class="hljs-number">0</span>) {
      tree.push(node)<span class="hljs-comment">;</span>
    } else {
      const <span class="hljs-attr">parent</span> = map.get(item.parentId)<span class="hljs-comment">;</span>
      parent &amp;&amp; parent.children.push(node)<span class="hljs-comment">;</span>
    }
  }

  return tree<span class="hljs-comment">;</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-11">â± å¤æ‚åº¦åˆ†æ</h3>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(n)</code></li>
<li>ç©ºé—´å¤æ‚åº¦ï¼š<code>O(n)</code></li>
</ul>
<p>ğŸ“Œ åˆ°è¿™ä¸€æ­¥ï¼Œ<strong>å·²ç»å¯ä»¥åº”ä»˜å¤§å¤šæ•°é¢è¯•</strong>äº†ã€‚</p>
<hr/>
<h2 data-id="heading-12">äº”ã€ç»ˆæå¥¥ä¹‰ï¼šä¸€æ¬¡éå† + å¼•ç”¨é­”æ³•ï¼ˆTop Tierï¼‰</h2>
<blockquote>
<p>é¢è¯•å®˜ï¼š<br/>
ã€Œèƒ½ä¸èƒ½åªéå†ä¸€æ¬¡ï¼Ÿã€</p>
</blockquote>
<p>ç­”æ¡ˆæ˜¯ï¼š<strong>èƒ½ï¼Œè€Œä¸”è¿™æ‰æ˜¯å¤©èŠ±æ¿è§£æ³•ã€‚</strong></p>
<hr/>
<h3 data-id="heading-13">æ ¸å¿ƒç²¾é«“ï¼šå ä½ + å¼•ç”¨åŒæ­¥</h3>
<ul>
<li>å­èŠ‚ç‚¹å¯èƒ½å…ˆäºçˆ¶èŠ‚ç‚¹å‡ºç°</li>
<li>å…ˆåœ¨ Map é‡Œç»™çˆ¶èŠ‚ç‚¹ <strong>å ä½</strong></li>
<li>åç»­å†è¡¥å…¨æ•°æ®</li>
<li>å¼•ç”¨åœ°å€å§‹ç»ˆä¸å˜ï¼Œæ ‘ä¼šâ€œè‡ªå·±é•¿å¥½â€</li>
</ul>
<hr/>
<h3 data-id="heading-14">ä»£ç å®ç°ï¼ˆä¸€æ¬¡éå†ï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini">function listToTreePerfect(list) {
  const <span class="hljs-attr">map</span> = new Map()<span class="hljs-comment">;</span>
  const <span class="hljs-attr">tree</span> = []<span class="hljs-comment">;</span>

  for (const item of list) {
    const { id, parentId } = item<span class="hljs-comment">;</span>

    if (!map.has(id)) {
      map.set(id, { children: <span class="hljs-section">[]</span> })<span class="hljs-comment">;</span>
    }

    const <span class="hljs-attr">node</span> = map.get(id)<span class="hljs-comment">;</span>
    Object.assign(node, item)<span class="hljs-comment">;</span>

    if (<span class="hljs-attr">parentId</span> === <span class="hljs-number">0</span>) {
      tree.push(node)<span class="hljs-comment">;</span>
    } else {
      if (!map.has(parentId)) {
        map.set(parentId, { children: <span class="hljs-section">[]</span> })<span class="hljs-comment">;</span>
      }
      map.get(parentId).children.push(node)<span class="hljs-comment">;</span>
    }
  }

  return tree<span class="hljs-comment">;</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-15">ğŸ† ä¸ºä»€ä¹ˆè¿™æ˜¯ç‹è€…è§£æ³•ï¼Ÿ</h3>
<ul>
<li>âœ… ä¸€æ¬¡éå†ï¼Œ<code>O(n)</code></li>
<li>âœ… æ”¯æŒä¹±åºæ•°æ®</li>
<li>âœ… æ·±åº¦ç†è§£ JS å¼•ç”¨æœºåˆ¶</li>
<li>âœ… é¢è¯•å®˜ä¸€çœ¼å°±æ‡‚ä½ æ˜¯â€œçœŸä¼šâ€</li>
</ul>
<hr/>
<h2 data-id="heading-16">å…­ã€çœŸå®å¼€å‘ä¸­çš„åº”ç”¨åœºæ™¯</h2>
<ul>
<li>ğŸ”¹ æƒé™ / èœå•æ ‘ï¼ˆAnt Design / Elementï¼‰</li>
<li>ğŸ”¹ çœå¸‚åŒº / Cascader</li>
<li>ğŸ”¹ æ–‡ä»¶ç›®å½•ç»“æ„ï¼ˆäº‘ç›˜ã€ç¼–è¾‘å™¨ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-17">ä¸ƒã€é¢è¯•æ€»ç»“ &amp; é¿å‘æŒ‡å—</h2>

























<table><thead><tr><th>æ–¹æ¡ˆ</th><th>æ—¶é—´å¤æ‚åº¦</th><th>è¯„ä»·</th></tr></thead><tbody><tr><td>é€’å½’</td><td><code>O(nÂ²)</code></td><td>èƒ½å†™ï¼Œä½†å±é™©</td></tr><tr><td>Map ä¸¤æ¬¡éå†</td><td><code>O(n)</code></td><td>é¢è¯•åˆæ ¼</td></tr><tr><td>ä¸€æ¬¡éå†</td><td><code>O(n)</code></td><td>é¢è¯•åŠ åˆ†</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">é¢è¯•åŠ åˆ†è¡¨è¾¾</h3>
<ul>
<li>ä¸»åŠ¨æ <strong>ç©ºé—´æ¢æ—¶é—´</strong></li>
<li>ç‚¹å‡º <strong>JS å¯¹è±¡æ˜¯å¼•ç”¨ç±»å‹</strong></li>
<li>è¯¢é—® <code>parentId</code> æ˜¯å¦å¯èƒ½ä¸º <code>null</code></li>
<li>è¯´æ˜æ˜¯å¦ä¼šä¿®æ”¹åŸæ•°æ®ï¼ˆå¿…è¦æ—¶æ·±æ‹·è´ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-19">ç»“è¯­</h2>
<blockquote>
<p>ç®—æ³•ä¸æ˜¯ä¸ºäº†ä¸ºéš¾äººï¼Œ<br/>
è€Œæ˜¯ä¸ºäº†åœ¨å¤æ‚ä¸šåŠ¡ä¸­ï¼Œ<br/>
<strong>é€‰å‡ºé‚£æ¡æœ€ç¨³ã€æœ€ä¼˜é›…çš„è·¯ã€‚</strong></p>
</blockquote>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ğŸ‘‡<br/>
ğŸ‘ ç‚¹ä¸ªèµ<br/>
ğŸ’¬ è¯„è®ºåŒºèŠèŠä½ åœ¨é¡¹ç›®é‡Œé‡åˆ°è¿‡çš„å¥‡è‘©æ•°æ®ç»“æ„</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ¨¡å‹åŸç†å‰–æâ€”â€”ä»æŠ€æœ¯ç‰¹æ€§ã€åº•å±‚æ¶æ„åˆ°è½åœ°é€»è¾‘çš„å…¨ç»´åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7585484081436606515</link>    <guid>https://juejin.cn/post/7585484081436606515</guid>    <pubDate>2025-12-21T02:57:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585484081436606515" data-draft-id="7585463195202502706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ¨¡å‹åŸç†å‰–æâ€”â€”ä»æŠ€æœ¯ç‰¹æ€§ã€åº•å±‚æ¶æ„åˆ°è½åœ°é€»è¾‘çš„å…¨ç»´åº¦è§£æ"/> <meta itemprop="keywords" content="ç®—æ³•"/> <meta itemprop="datePublished" content="2025-12-21T02:57:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‰¾é†’"/> <meta itemprop="url" content="https://juejin.cn/user/708512558088669"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ¨¡å‹åŸç†å‰–æâ€”â€”ä»æŠ€æœ¯ç‰¹æ€§ã€åº•å±‚æ¶æ„åˆ°è½åœ°é€»è¾‘çš„å…¨ç»´åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/708512558088669/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‰¾é†’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T02:57:17.000Z" title="Sun Dec 21 2025 02:57:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>è¿‘å¹´æ¥ï¼Œå¤§æ¨¡å‹ä»¥å…¶é¢ è¦†æ€§çš„æ™ºèƒ½è¡¨ç°å¸­å·æŠ€æœ¯é¢†åŸŸâ€”â€”ä»ç²¾å‡†çš„ä»£ç ç”Ÿæˆåˆ°è‡ªç„¶çš„å¤šè½®å¯¹è¯ï¼Œä»è·¨æ¨¡æ€çš„æ–‡ç”Ÿå›¾åˆ°å¤æ‚çš„é€»è¾‘æ¨ç†ï¼Œå…¶èƒŒåæ˜¯ä¸€å¥—èåˆ<strong>è§„æ¨¡ã€æ¶æ„ã€æ•°æ®ä¸è®­ç»ƒèŒƒå¼</strong>çš„æŠ€æœ¯ä½“ç³»ã€‚æœ¬æ–‡å°†ä»æ ¸å¿ƒç‰¹æ€§ã€æ¶æ„åŸºç¡€ã€è¡Œä¸šç°çŠ¶åˆ°è½åœ°é€»è¾‘ï¼Œæ·±å…¥æ‹†è§£å¤§æ¨¡å‹çš„åº•å±‚è¿è¡ŒåŸç†ã€‚</p>
<h2 data-id="heading-1">ä¸€ã€å¤§æ¨¡å‹çš„æ ¸å¿ƒæŠ€æœ¯ç‰¹æ€§ï¼šâ€œå¤§â€ä¹‹å¤–çš„åº•å±‚é€»è¾‘</h2>
<p>å¤§æ¨¡å‹çš„â€œèƒ½åŠ›å£å’â€å¹¶éä»…æºäºâ€œå‚æ•°å¤šâ€ï¼Œè€Œæ˜¯å¤šç»´åº¦æŠ€æœ¯ç‰¹æ€§çš„ååŒä½œç”¨ï¼š</p>
<h3 data-id="heading-2">1. è¶…å¤§è§„æ¨¡å‚æ•°ä¸è‡ªç›‘ç£é¢„è®­ç»ƒï¼šé€šç”¨è§„å¾‹çš„â€œå­¦ä¹ åº•åº§â€</h3>
<ul>
<li><strong>å‚æ•°è§„æ¨¡çš„æŠ€æœ¯å®šä¹‰</strong>ï¼šå¤§æ¨¡å‹çš„â€œå¤§â€é€šå¸¸æŒ‡<strong>ç™¾äº¿çº§ä»¥ä¸Šçš„å¯è®­ç»ƒå‚æ•°</strong>ï¼ˆå¦‚GPT-3è¾¾1750äº¿å‚æ•°ï¼‰ï¼Œå¯¹åº”æ¨¡å‹ç»“æ„ä¸­Transformerçš„â€œç¼–ç å™¨/è§£ç å™¨å±‚æ•°â€â€œæ³¨æ„åŠ›å¤´æ•°â€â€œéšè—å±‚ç»´åº¦â€ç­‰ç»„ä»¶çš„è§„æ¨¡æ‰©å¼ ï¼ˆä¾‹å¦‚GPT-4çš„Transformerè§£ç å™¨å±‚æ•°è¶…è¿‡90å±‚ï¼‰ã€‚</li>
<li><strong>è‡ªç›‘ç£é¢„è®­ç»ƒçš„æ ¸å¿ƒé€»è¾‘</strong>ï¼šæ¨¡å‹é€šè¿‡â€œæ— æ ‡æ³¨æ•°æ®çš„è‡ªæˆ‘å­¦ä¹ â€æŒæ¡é€šç”¨è¯­ä¹‰ï¼Œå…¸å‹ä»»åŠ¡åŒ…æ‹¬ï¼š
<ul>
<li><strong>æ©ç è¯­è¨€æ¨¡å‹ï¼ˆMLMï¼‰</strong>ï¼šéšæœºé®ç›–æ–‡æœ¬ä¸­çš„éƒ¨åˆ†tokenï¼Œè®©æ¨¡å‹é¢„æµ‹è¢«é®ç›–å†…å®¹ï¼ˆBERTçš„æ ¸å¿ƒé¢„è®­ç»ƒä»»åŠ¡ï¼‰ï¼›</li>
<li><strong>ä¸‹ä¸€å¥é¢„æµ‹ï¼ˆNSPï¼‰</strong>ï¼šè®©æ¨¡å‹åˆ¤æ–­ä¸¤ä¸ªå¥å­æ˜¯å¦ä¸ºè¿ç»­çš„ä¸Šä¸‹æ–‡ï¼›</li>
<li><strong>è‡ªå›å½’è¯­è¨€å»ºæ¨¡</strong>ï¼šä»å·¦åˆ°å³é€tokené¢„æµ‹ä¸‹ä¸€ä¸ªè¯ï¼ˆGPTç³»åˆ—çš„æ ¸å¿ƒä»»åŠ¡ï¼‰ã€‚</li>
</ul>
</li>
<li><strong>æ•°æ®è§„æ¨¡çš„åŒ¹é…è¦æ±‚</strong>ï¼šé¢„è®­ç»ƒéœ€æŠ•å–‚<strong>ä¸‡äº¿çº§tokençš„é«˜è´¨é‡æ•°æ®</strong>ï¼ˆæ¶µç›–æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰ï¼‰ï¼Œæ•°æ®çš„å¤šæ ·æ€§ä¸è¦†ç›–åº¦ç›´æ¥å†³å®šæ¨¡å‹çš„â€œé€šç”¨è®¤çŸ¥èƒ½åŠ›â€ã€‚</li>
</ul>
<h3 data-id="heading-3">2. æ¶Œç°èƒ½åŠ›ï¼šè§„æ¨¡çªç ´åçš„â€œæ™ºèƒ½è·ƒè¿â€</h3>
<p>â€œæ¶Œç°èƒ½åŠ›â€æ˜¯å¤§æ¨¡å‹æœ€ç‹¬ç‰¹çš„å±æ€§â€”â€”å½“å‚æ•°è§„æ¨¡ã€æ•°æ®é‡çªç ´æŸä¸€é˜ˆå€¼åï¼Œæ¨¡å‹ä¼šçªç„¶å…·å¤‡é¢„è®­ç»ƒä»»åŠ¡ä¸­æœªæ˜ç¡®å­¦ä¹ çš„èƒ½åŠ›ï¼ˆå¦‚æ€ç»´é“¾æ¨ç†ã€ä¸Šä¸‹æ–‡å­¦ä¹ ï¼‰ã€‚</p>
<ul>
<li><strong>æŠ€æœ¯æœ¬è´¨</strong>ï¼šç›®å‰å­¦ç•Œè®¤ä¸ºï¼Œå¤§å‚æ•°æ¨¡å‹èƒ½åœ¨é«˜ç»´ç‰¹å¾ç©ºé—´ä¸­æ•æ‰åˆ°æ•°æ®çš„â€œå¤æ‚éšå¼æ¨¡å¼â€ï¼Œå½“è§„æ¨¡è¶³å¤Ÿå¤§æ—¶ï¼Œè¿™äº›æ¨¡å¼ä¼šå½¢æˆâ€œæ³›åŒ–èƒ½åŠ›çš„å åŠ â€ï¼›</li>
<li><strong>å…¸å‹æ¡ˆä¾‹</strong>ï¼šæ€ç»´é“¾ï¼ˆChain-of-Thoughtï¼‰èƒ½åŠ›â€”â€”é€šè¿‡åœ¨æç¤ºè¯ä¸­åŠ å…¥â€œåˆ†æ­¥æ¨ç†â€ç¤ºä¾‹ï¼Œæ¨¡å‹å¯å­¦ä¼šæ‹†è§£å¤æ‚ä»»åŠ¡ï¼ˆå¦‚æ•°å­¦é¢˜ã€é€»è¾‘é¢˜ï¼‰ï¼Œå…¶æœ¬è´¨æ˜¯è°ƒç”¨äº†é¢„è®­ç»ƒä¸­å­¦ä¹ åˆ°çš„â€œå› æœæ¨ç†ç±»ç‰¹å¾â€ã€‚</li>
</ul>
<h3 data-id="heading-4">3. å¤šæ¨¡æ€ä¸é€šç”¨é€‚é…æ€§ï¼šå‘AGIé è¿‘çš„æŠ€æœ¯è·¯å¾„</h3>
<p>å¤§æ¨¡å‹çš„â€œé€šç”¨æ€§â€æºäº<strong>ç»Ÿä¸€çš„è¯­ä¹‰è¡¨ç¤ºæ¡†æ¶</strong>ï¼š</p>
<ul>
<li><strong>å¤šæ¨¡æ€æŠ€æœ¯åŸºç¡€</strong>ï¼šé€šè¿‡â€œè·¨æ¨¡æ€å¯¹é½â€å°†æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ç­‰ä¸åŒç±»å‹æ•°æ®è½¬åŒ–ä¸ºç»Ÿä¸€çš„tokenè¡¨ç¤ºï¼ˆä¾‹å¦‚CLIPæ¨¡å‹é€šè¿‡â€œå›¾æ–‡å¯¹â€æ•°æ®ï¼Œè®©æ–‡æœ¬åµŒå…¥ä¸å›¾åƒåµŒå…¥æ˜ å°„åˆ°åŒä¸€è¯­ä¹‰ç©ºé—´ï¼‰ï¼›</li>
<li><strong>é¢†åŸŸé€‚é…æ–¹å¼</strong>ï¼šæ— éœ€é‡æ–°è®­ç»ƒæ¨¡å‹ï¼Œä»…é€šè¿‡â€œæç¤ºå­¦ä¹ â€æˆ–â€œè½»é‡å¾®è°ƒâ€å³å¯é€‚é…ä¸åŒåœºæ™¯ï¼š
<ul>
<li><strong>å°‘æ ·æœ¬æç¤º</strong>ï¼šç»™æ¨¡å‹1-5ä¸ªä»»åŠ¡ç¤ºä¾‹ï¼Œå³å¯è®©å…¶æ¨¡ä»¿å®Œæˆæ–°ä»»åŠ¡ï¼›</li>
<li><strong>æŒ‡ä»¤å¾®è°ƒ</strong>ï¼šç”¨â€œè‡ªç„¶è¯­è¨€æŒ‡ä»¤+ä»»åŠ¡è¾“å‡ºâ€çš„æ•°æ®é›†å¾®è°ƒæ¨¡å‹ï¼Œæå‡å…¶å¯¹äººç±»æŒ‡ä»¤çš„ç†è§£èƒ½åŠ›ï¼›</li>
<li><strong>RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</strong>ï¼šç»“åˆå¤–éƒ¨çŸ¥è¯†åº“ï¼ˆå¦‚è¡Œä¸šæ–‡æ¡£ã€å®æ—¶æ•°æ®ï¼‰ï¼Œè®©æ¨¡å‹ç”Ÿæˆæ›´ç²¾å‡†çš„é¢†åŸŸå†…å®¹ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5">4. è¶…é•¿ä¸Šä¸‹æ–‡ä¸éå®æ—¶æ€§é™åˆ¶ï¼šèƒ½åŠ›çš„â€œè¾¹ç•Œâ€</h3>
<ul>
<li><strong>è¶…é•¿ä¸Šä¸‹æ–‡çš„æŠ€æœ¯æ”¯æ’‘</strong>ï¼šåŸºäºTransformerçš„â€œæ³¨æ„åŠ›æœºåˆ¶â€ï¼Œé€šè¿‡ä¼˜åŒ–ï¼ˆå¦‚æ»‘åŠ¨çª—å£æ³¨æ„åŠ›ã€ç¨€ç–æ³¨æ„åŠ›ï¼‰å®ç°å¯¹é•¿åºåˆ—çš„å¤„ç†ï¼ˆä¾‹å¦‚GPT-4çš„ä¸Šä¸‹æ–‡çª—å£è¾¾128k tokenï¼Œå¯å®¹çº³çº¦20ä¸‡å­—çš„æ–‡æœ¬ï¼‰ï¼Œå…¶æ ¸å¿ƒæ˜¯è®©æ¨¡å‹èƒ½â€œè®°ä½â€é•¿æ–‡æœ¬ä¸­çš„å…³è”ä¿¡æ¯ï¼›</li>
<li><strong>éå®æ—¶æ€§çš„æ ¹æº</strong>ï¼šå¤§æ¨¡å‹çš„é¢„è®­ç»ƒæ˜¯åŸºäºâ€œé™æ€æ•°æ®å¿«ç…§â€ï¼ˆå¦‚GPT-4çš„è®­ç»ƒæ•°æ®æˆªæ­¢åˆ°2023å¹´10æœˆï¼‰ï¼Œæ¨ç†é˜¶æ®µæ— æ³•å®æ—¶æ¥å…¥æ–°æ•°æ®â€”â€”è¿™æ˜¯å…¶ä¸æœç´¢å¼•æ“çš„æ ¸å¿ƒåŒºåˆ«ï¼ˆæœç´¢å¼•æ“ä¾èµ–å®æ—¶ç´¢å¼•ï¼Œè€Œå¤§æ¨¡å‹ä¾èµ–é¢„è®­ç»ƒçŸ¥è¯†ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-6">äºŒã€å¤§æ¨¡å‹çš„æ¶æ„åŸºç¡€ï¼šTransformerçš„â€œç»Ÿæ²»åŠ›â€</h2>
<p>å½“å‰æ‰€æœ‰å¤§æ¨¡å‹å‡åŸºäº<strong>Transformeræ¶æ„</strong>ï¼ˆ2017å¹´ç”±Googleæå‡ºï¼‰ï¼Œå…¶æ ¸å¿ƒç»„ä»¶å†³å®šäº†æ¨¡å‹çš„â€œè§„æ¨¡æ‰©å±•æ€§â€ä¸â€œè¯­ä¹‰æ•æ‰èƒ½åŠ›â€ï¼š</p>
<ol>
<li><strong>æ³¨æ„åŠ›æœºåˆ¶</strong>ï¼šé€šè¿‡â€œç¼©æ”¾ç‚¹ç§¯æ³¨æ„åŠ›â€è®¡ç®—æ¯ä¸ªtokenä¸å…¶ä»–tokençš„å…³è”æƒé‡ï¼Œè®©æ¨¡å‹åœ¨å¤„ç†æ–‡æœ¬æ—¶â€œèšç„¦å…³é”®ä¿¡æ¯â€ï¼›</li>
<li><strong>Encoder-Decoderç»“æ„</strong>ï¼š
<ul>
<li><strong>Encoder</strong>ï¼šè´Ÿè´£å°†è¾“å…¥æ–‡æœ¬è½¬åŒ–ä¸ºâ€œè¯­ä¹‰åµŒå…¥â€ï¼ˆå¦‚BERTä»…ç”¨Encoderï¼‰ï¼›</li>
<li><strong>Decoder</strong>ï¼šè´Ÿè´£åŸºäºè¯­ä¹‰åµŒå…¥ç”Ÿæˆè¾“å‡ºæ–‡æœ¬ï¼ˆå¦‚GPTä»…ç”¨Decoderï¼‰ï¼›</li>
</ul>
</li>
<li><strong>ä½ç½®ç¼–ç </strong>ï¼šç»™tokenæ·»åŠ ä½ç½®ä¿¡æ¯ï¼ˆå¦‚æ­£å¼¦ä½™å¼¦ç¼–ç ï¼‰ï¼Œè§£å†³Transformerâ€œæ— åºåˆ—æ„ŸçŸ¥â€çš„é—®é¢˜ï¼›</li>
<li><strong>æ®‹å·®è¿æ¥ä¸å±‚å½’ä¸€åŒ–</strong>ï¼šç¼“è§£å¤§æ¨¡å‹è®­ç»ƒä¸­çš„â€œæ¢¯åº¦æ¶ˆå¤±â€é—®é¢˜ï¼Œæ”¯æ’‘è¶…å¤šå±‚æ•°çš„æ¨¡å‹è®­ç»ƒã€‚</li>
</ol>
<h2 data-id="heading-7">ä¸‰ã€å¤§æ¨¡å‹çš„è¡Œä¸šæŠ€æœ¯ç°çŠ¶ï¼šè§„æ¨¡ä¸å£å’çš„åšå¼ˆ</h2>
<h3 data-id="heading-8">1. æ¨¡å‹åŒè´¨åŒ–ï¼šTransformerçš„â€œæŠ€æœ¯é”å®šâ€</h3>
<p>ç›®å‰å‡ ä¹æ‰€æœ‰å¤§æ¨¡å‹å‡åŸºäºTransformerè¡ç”Ÿæ¶æ„ï¼ˆå¦‚GPTçš„Decoder-onlyã€PaLMçš„Pathwaysæ¶æ„ï¼‰ï¼Œæ ¸å¿ƒåŸå› æ˜¯ï¼šTransformerçš„â€œæ³¨æ„åŠ›æœºåˆ¶+æ®‹å·®è¿æ¥â€æ˜¯å½“å‰å”¯ä¸€èƒ½æ”¯æ’‘â€œåƒäº¿çº§å‚æ•°+ä¸‡äº¿çº§æ•°æ®â€è®­ç»ƒçš„æ¶æ„ï¼Œæš‚æ— æ›´ä¼˜æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-9">2. è§„æ¨¡æ•ˆåº”ï¼šâ€œå¤§åŠ›å‡ºå¥‡è¿¹â€çš„æŠ€æœ¯ä¾æ®</h3>
<p>å­¦ç•Œç ”ç©¶æ˜¾ç¤ºï¼Œå¤§æ¨¡å‹çš„æ€§èƒ½ï¼ˆå¦‚å›°æƒ‘åº¦ã€ä»»åŠ¡å‡†ç¡®ç‡ï¼‰ä¸<strong>å‚æ•°è§„æ¨¡ã€è®­ç»ƒæ•°æ®é‡</strong>å‘ˆâ€œå¹‚å¾‹å…³ç³»â€ï¼šå½“å‚æ•°ä»10äº¿æå‡åˆ°1000äº¿æ—¶ï¼Œæ€§èƒ½ä¼šå‡ºç°â€œé˜¶æ¢¯å¼è·ƒå‡â€ï¼ˆä¾‹å¦‚GPT-2ï¼ˆ15äº¿å‚æ•°ï¼‰ä¸GPT-3ï¼ˆ1750äº¿å‚æ•°ï¼‰çš„èƒ½åŠ›å·®è·ï¼‰ã€‚</p>
<h3 data-id="heading-10">3. å¤´éƒ¨å„æ–­ï¼šæŠ€æœ¯é—¨æ§›çš„â€œé©¬å¤ªæ•ˆåº”â€</h3>
<p>å¤§æ¨¡å‹çš„ç ”å‘å­˜åœ¨æé«˜çš„â€œç®—åŠ›+æ•°æ®+èµ„é‡‘â€å£å’ï¼š</p>
<ul>
<li><strong>ç®—åŠ›æˆæœ¬</strong>ï¼šè®­ç»ƒä¸€æ¬¡åƒäº¿çº§å‚æ•°æ¨¡å‹éœ€æ¶ˆè€—â€œæ•°ä¸‡å¼ A100æ˜¾å¡Ã—æ•°æœˆæ—¶é—´â€ï¼Œæˆæœ¬è¶…è¿‡åƒä¸‡ç¾å…ƒï¼›</li>
<li><strong>æ•°æ®å£å’</strong>ï¼šé«˜è´¨é‡è®­ç»ƒæ•°æ®ï¼ˆå°¤å…¶æ˜¯å¤šæ¨¡æ€ã€å¤šè¯­è¨€æ•°æ®ï¼‰è¢«å¤´éƒ¨ä¼ä¸šå„æ–­ï¼›</li>
<li><strong>æŠ€æœ¯é—­ç¯</strong>ï¼šå¤´éƒ¨ä¼ä¸šé€šè¿‡â€œæ¨¡å‹ä¸å¼€æº+APIå•†ä¸šåŒ–â€æ„å»ºå£å’ï¼Œä¸­å°ä¼ä¸šä»…èƒ½åŸºäºAPIè¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚</li>
</ul>
<h2 data-id="heading-11">å››ã€å¤§æ¨¡å‹çš„è½åœ°åº”ç”¨ï¼šæŠ€æœ¯é€»è¾‘çš„åœºæ™¯åŒ–å®ç°</h2>
<p>å¤§æ¨¡å‹çš„åº”ç”¨å¹¶éâ€œé»‘ç®±è°ƒç”¨â€ï¼Œè€Œæ˜¯æŠ€æœ¯ç‰¹æ€§ä¸åœºæ™¯éœ€æ±‚çš„ç²¾å‡†åŒ¹é…ï¼š</p>
<h3 data-id="heading-12">1. æ–‡æœ¬ç”Ÿæˆï¼šè‡ªå›å½’çš„â€œå†…å®¹ç”Ÿäº§é“¾â€</h3>
<ul>
<li><strong>æŠ€æœ¯é€»è¾‘</strong>ï¼šåŸºäºè‡ªå›å½’è¯­è¨€å»ºæ¨¡ï¼Œä»å·¦åˆ°å³é€tokené¢„æµ‹ï¼ˆä¾‹å¦‚ç”Ÿæˆä»£ç æ—¶ï¼Œæ¨¡å‹ä¼šåŸºäºå‰æ–‡çš„è¯­æ³•è§„åˆ™ï¼Œé¢„æµ‹ä¸‹ä¸€ä¸ªå­—ç¬¦/å…³é”®å­—ï¼‰ï¼›</li>
<li><strong>å…¸å‹åœºæ™¯</strong>ï¼šä»£ç ç”Ÿæˆï¼ˆGitHub Copilotï¼‰ã€æ–‡æ¡ˆæ’°å†™ã€æ•°å­¦è§£é¢˜ï¼ˆé€šè¿‡æ€ç»´é“¾æ‹†è§£æ­¥éª¤ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-13">2. æ™ºèƒ½å®¢æœï¼šRAGçš„â€œçŸ¥è¯†å¢å¼ºâ€</h3>
<ul>
<li><strong>æŠ€æœ¯é€»è¾‘</strong>ï¼šå…ˆé€šè¿‡æ£€ç´¢å¼•æ“ä»â€œè¡Œä¸šçŸ¥è¯†åº“â€ï¼ˆå¦‚é“¶è¡Œäº§å“æ‰‹å†Œã€åŒ»é™¢è¯Šç–—æŒ‡å—ï¼‰ä¸­è·å–ç›¸å…³ä¿¡æ¯ï¼Œå†å°†ä¿¡æ¯ä¼ å…¥å¤§æ¨¡å‹ï¼Œç”Ÿæˆç¬¦åˆåœºæ™¯çš„å›å¤ï¼›</li>
<li><strong>ä»·å€¼</strong>ï¼šè§£å†³å¤§æ¨¡å‹â€œçŸ¥è¯†è¿‡æ—¶â€â€œå¹»è§‰ï¼ˆç¼–é€ ä¿¡æ¯ï¼‰â€çš„é—®é¢˜ï¼Œæå‡å›å¤çš„ç²¾å‡†æ€§ã€‚</li>
</ul>
<h3 data-id="heading-14">3. å¤šæ¨¡æ€ä»»åŠ¡ï¼šè·¨æ¨¡æ€å¯¹é½çš„â€œèƒ½åŠ›å»¶ä¼¸â€</h3>
<ul>
<li><strong>æ–‡ç”Ÿå›¾</strong>ï¼šå¤§è¯­è¨€æ¨¡å‹å°†æ–‡æœ¬æè¿°è½¬åŒ–ä¸ºâ€œè¯­ä¹‰åµŒå…¥â€ï¼Œå†è¾“å…¥æ‰©æ•£æ¨¡å‹ï¼ˆå¦‚Stable Diffusionï¼‰ï¼Œç”Ÿæˆä¸è¯­ä¹‰åŒ¹é…çš„å›¾åƒï¼›</li>
<li><strong>çœ‹å›¾è¯´è¯</strong>ï¼šå¤§æ¨¡å‹å°†å›¾åƒè½¬åŒ–ä¸ºâ€œè§†è§‰åµŒå…¥â€ï¼Œå†æ˜ å°„ä¸ºè‡ªç„¶è¯­è¨€æè¿°ï¼ˆä¾èµ–é¢„è®­ç»ƒä¸­çš„å›¾æ–‡å¯¹é½æ•°æ®ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-15">4. æƒ…æ„Ÿåˆ†æï¼šè¯­ä¹‰è¡¨ç¤ºçš„â€œç»†ç²’åº¦ç†è§£â€</h3>
<ul>
<li><strong>æŠ€æœ¯é€»è¾‘</strong>ï¼šå¤§æ¨¡å‹é€šè¿‡é¢„è®­ç»ƒä¸­å­¦ä¹ çš„â€œæƒ…æ„Ÿç±»è¯æ±‡ç‰¹å¾â€ï¼ˆå¦‚â€œå¼€å¿ƒâ€â€œå¤±æœ›â€ï¼‰ï¼Œå¯¹æ–‡æœ¬çš„æƒ…æ„Ÿå€¾å‘ï¼ˆæ­£é¢/è´Ÿé¢/ä¸­æ€§ï¼‰è¿›è¡Œåˆ†ç±»ï¼Œç”šè‡³èƒ½è¯†åˆ«â€œè®½åˆºâ€â€œåè¯â€ç­‰å¤æ‚æƒ…æ„Ÿã€‚</li>
</ul>
<h2 data-id="heading-16">æ€»ç»“</h2>
<p>å¤§æ¨¡å‹çš„æœ¬è´¨æ˜¯â€œæ•°æ®ä¸è§„æ¨¡é©±åŠ¨çš„é€šç”¨è¯­ä¹‰å¼•æ“â€ï¼Œå…¶èƒ½åŠ›è¾¹ç•Œä»åœ¨æ‰©å¼ ï¼Œä½†æŠ€æœ¯åº•å±‚çš„é€»è¾‘ï¼ˆTransformeræ¶æ„ã€è‡ªç›‘ç£é¢„è®­ç»ƒï¼‰å·²ç›¸å¯¹æ¸…æ™°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ•°æ®-190 Filebeatâ†’Kafkaâ†’Logstashâ†’Elasticsearch å®æˆ˜]]></title>    <link>https://juejin.cn/post/7585502118459965459</link>    <guid>https://juejin.cn/post/7585502118459965459</guid>    <pubDate>2025-12-21T01:33:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585502118459965459" data-draft-id="7585502118459949075" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ•°æ®-190 Filebeatâ†’Kafkaâ†’Logstashâ†’Elasticsearch å®æˆ˜"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-21T01:33:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ­¦å­åº·"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ•°æ®-190 Filebeatâ†’Kafkaâ†’Logstashâ†’Elasticsearch å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ­¦å­åº·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T01:33:10.000Z" title="Sun Dec 21 2025 01:33:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>åœºæ™¯ï¼šNginx access.log é‡‡é›†åˆ° Kafkaï¼Œç» Logstash æ¸…æ´—ï¼ˆå« GeoIPï¼‰è½ ES</li>
<li>ç»“è®ºï¼šUbuntu 22.04 ä¸Š Filebeat 7.3 å¯èƒ½å¯åŠ¨å¤±è´¥ï¼Œå‡çº§åˆ° 7.17 å¯ç›´æ¥æ¢å¤</li>
<li>äº§å‡ºï¼šå¯å¤ç”¨çš„ filebeat.yml + logstash_kafka_es.conf åŠå¸¸è§æ•…éšœå®šä½/ä¿®å¤è¡¨</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a079c04ef87c482a83d324b56e56f9b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=xmJV1l6nxgxbX1NyXNAUzSTM12U%3D" alt="å¤§æ•°æ®-190 Filebeatâ†’Kafkaâ†’Logstashâ†’Elasticsearch å®æˆ˜" loading="lazy"/></p>
<h2 data-id="heading-1">ç‰ˆæœ¬çŸ©é˜µ</h2>















































<table><thead><tr><th>ç»„ä»¶</th><th>ç‰ˆæœ¬</th><th>ç¯å¢ƒ/ç³»ç»Ÿ</th><th>å·²éªŒè¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Filebeat</td><td>7.3.0</td><td>Ubuntu 22.04.3</td><td>å¦</td><td>æ–‡ä¸­å‡ºç° cgo/pthread æŠ¥é”™ï¼Œæ— æ³•å¯åŠ¨ï¼ˆåŒæœºå‹/æƒé™åœºæ™¯ä¸‹ï¼‰</td></tr><tr><td>Filebeat</td><td>7.17.0</td><td>Ubuntu 22.04.3</td><td>æ˜¯</td><td>æŒ‰æ–‡ä¸­é…ç½®å¯å¯åŠ¨å¹¶å‘ Kafka å†™å…¥äº‹ä»¶ï¼Œäº‹ä»¶ metadata æ˜¾ç¤º 7.17.0</td></tr><tr><td>Logstash</td><td>7.3.0</td><td>æœªæ˜ç¡®</td><td>éƒ¨åˆ†</td><td>-t é…ç½®æµ‹è¯•é€šè¿‡å¹¶å¯å¯åŠ¨ï¼›ç³»ç»Ÿ/JDK æœªæä¾›ï¼Œè·¨ç¯å¢ƒç»“è®ºä¸å¤–æ¨</td></tr><tr><td>Kafka</td><td>æœªæä¾›</td><td>æœªæä¾›</td><td>éƒ¨åˆ†</td><td>ä»…éªŒè¯åˆ°å¯è¢« filebeat å†™å…¥ã€å¯ç”¨ console-consumer æ¶ˆè´¹ï¼ˆç‰ˆæœ¬/é‰´æƒæœªæè¿°ï¼‰</td></tr><tr><td>Elasticsearch</td><td>æœªæä¾›</td><td>æœªæä¾›</td><td>å¦</td><td>ä»…ç»™å‡º output é…ç½®ä¸ç´¢å¼•å‘½åè§„åˆ™ï¼Œæœªæä¾› ES ç‰ˆæœ¬ä¸è½åº“éªŒè¯æˆªå›¾/æŸ¥è¯¢</td></tr></tbody></table>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbfeaa3325e3420fa2f24eb3f02a8085~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=7ijvokJ3tQ%2BK4nCLJ5wEE1Pxi3k%3D" alt="Elasticsearch" loading="lazy"/></p>
<h2 data-id="heading-2">Filebeat</h2>
<h3 data-id="heading-3">å®˜æ–¹åœ°å€</h3>
<p>Filebeatä¸»è¦ä¸ºäº†è§£å†³Logstashå·¥å…·æ˜¯æ¶ˆè€—èµ„æºæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜ï¼Œå› ä¸ºLogstashæ˜¯Javaè¯­è¨€ç¼–å†™çš„ï¼Œéœ€è¦å¯åŠ¨ä¸€ä¸ªè™šæ‹Ÿæœºã€‚å®˜æ–¹ä¸ºäº†ä¼˜åŒ–è¿™ä¸ªé—®é¢˜æ¨å‡ºäº†ä¸€äº›è½»é‡çº§çš„é‡‡é›†å·¥å…·ï¼ŒBeatsç³»åˆ—ï¼Œå…¶ä¸­æ¯”è¾ƒå¹¿æ³›ä½¿ç”¨çš„æ˜¯Filebeatã€‚</p>
<pre><code class="hljs language-shell" lang="shell">https://www.elastic.co/guide/en/beats/filebeat/7.3/index.html
</code></pre>
<h3 data-id="heading-4">å¯¹æ¯”åŒºåˆ«</h3>
<ul>
<li>Logstashæ˜¯è¿è¡Œåœ¨Javaè™šæ‹Ÿæœºä¸Šçš„ï¼Œå¯åŠ¨ä¸€ä¸ªLogstashéœ€è¦æ¶ˆè€—500Mçš„å†…å­˜ï¼ˆæ‰€ä»¥å¯åŠ¨ç‰¹åˆ«æ…¢ï¼‰ï¼Œè€ŒFilebeatåªéœ€è¦10Må·¦å³</li>
<li>å¸¸ç”¨çš„ELKæ—¥å¿—é‡‡é›†ä¸­ï¼Œå¤§éƒ¨åˆ†çš„åšæ³•å°±æ˜¯å°†æ‰€æœ‰èŠ‚ç‚¹çš„æ—¥å¿—å†…å®¹é€šè¿‡Filebeatå‘é€åˆ°Kafkaé›†ç¾¤ï¼ŒLogstashæ¶ˆè´¹Kafkaï¼Œå†æ ¹æ®é…ç½®æ–‡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œç„¶åå°†è¿‡æ»¤çš„æ–‡ä»¶è¾“å‡ºåˆ°Elasticsearchä¸­ï¼Œå†åˆ°Kibanaå»å±•ç¤ºã€‚</li>
</ul>
<h3 data-id="heading-5">é¡¹ç›®å®‰è£…</h3>
<p>ç›®å‰æˆ‘é€‰æ‹©åœ¨ h121 èŠ‚ç‚¹ä¸Šï¼Œä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„æƒ…å†µæ¥å®‰è£…ã€‚</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/software
wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.3.0-linux-x86_64.tar.gz
</code></pre>
<p>ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcef53d87c9d42559a460f5e876a2aa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=XDQ2WPLzMRQDfKS9FXA%2ByQ3QHTc%3D" alt="Logstash filebeat" loading="lazy"/></p>
<h3 data-id="heading-6">è§£å‹é…ç½®</h3>
<pre><code class="hljs language-shell" lang="shell">tar -zxvf filebeat-7.3.0-linux-x86_64.tar.gz
mv filebeat-7.3.0-linux-x86_64 ../servers
cd ../servers
</code></pre>
<p>å¯¹åº”çš„å†…å®¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/81c0c360a2db41a998ebe8cb7cf527b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=LLRCbuWtU%2BoLUYVawmnRHcl3JWg%3D" alt="FileBeat é…ç½®" loading="lazy"/>
ä¿®æ”¹é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/filebeat-7.3.0-linux-x86_64
vim filebeat.yml
</code></pre>
<p>å½“å‰æ–‡ä»¶å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a51385114eea45709c4a52ae4e1ce7a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=DXi0w6cPFxLrBF%2ByQLuhS8Fwn%2F8%3D" alt="FileBeat é…ç½®æ–‡ä»¶" loading="lazy"/></p>
<h4 data-id="heading-7">inputéƒ¨åˆ†</h4>
<p>ä¿®æ”¹ä¸ºå¦‚ä¸‹çš„å†…å®¹ filebeat.inputs éƒ¨åˆ†çš„å†…å®¹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">- type: log
<span class="hljs-meta prompt_">
  # </span><span class="bash">Change to <span class="hljs-literal">true</span> to <span class="hljs-built_in">enable</span> this input configuration.</span>
  enabled: true
<span class="hljs-meta prompt_">
  # </span><span class="bash">Paths that should be crawled and fetched. Glob based paths.</span>
  paths:
    - /opt/wzk/logs/access.log
    #- c:\programdata\elasticsearch\logs\*
<span class="hljs-meta prompt_">
  # </span><span class="bash">Exclude lines. A list of regular expressions to match. It drops the lines that are</span>
<span class="hljs-meta prompt_">  # </span><span class="bash">matching any regular expression from the list.</span>
<span class="hljs-meta prompt_">  #</span><span class="bash">exclude_lines: [<span class="hljs-string">'^DBG'</span>]</span>
<span class="hljs-meta prompt_">
  # </span><span class="bash">Include lines. A list of regular expressions to match. It exports the lines that are</span>
<span class="hljs-meta prompt_">  # </span><span class="bash">matching any regular expression from the list.</span>
<span class="hljs-meta prompt_">  #</span><span class="bash">include_lines: [<span class="hljs-string">'^ERR'</span>, <span class="hljs-string">'^WARN'</span>]</span>
<span class="hljs-meta prompt_">
  # </span><span class="bash">Exclude files. A list of regular expressions to match. Filebeat drops the files that</span>
<span class="hljs-meta prompt_">  # </span><span class="bash">are matching any regular expression from the list. By default, no files are dropped.</span>
<span class="hljs-meta prompt_">  #</span><span class="bash">exclude_files: [<span class="hljs-string">'.gz$'</span>]</span>
<span class="hljs-meta prompt_">
  # </span><span class="bash">Optional additional fields. These fields can be freely picked</span>
<span class="hljs-meta prompt_">  # </span><span class="bash">to add additional information to the crawled <span class="hljs-built_in">log</span> files <span class="hljs-keyword">for</span> filtering</span>
  fields:
    app: www
    type: nginx-access
  fields_under_root: true
<span class="hljs-meta prompt_">  #</span><span class="bash"><span class="hljs-comment">## Multiline options</span></span>
</code></pre>
<p>ä¿®æ”¹çš„æˆªå›¾å¦‚ä¸‹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4a6b970dd544721b64c02ea4c8eb880~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=1qOOWumgLOO3oVvCqbv6puJWSN4%3D" alt="FileBeat inputé…ç½®" loading="lazy"/></p>
<h4 data-id="heading-8">outputéƒ¨åˆ†</h4>
<pre><code class="hljs language-shell" lang="shell">output.kafka:
  hosts: ["h121.wzk.icu:9092"]
  topic: "nginx_access_log"
</code></pre>
<p>å¯¹åº”çš„æˆªå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b699aec78cfc4b789578f18e2fa48755~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=C7XSkGjA68v4DN77p3diP0EOnn4%3D" alt="FileBeat output é…ç½®" loading="lazy"/></p>
<h3 data-id="heading-9">å¯åŠ¨æœåŠ¡</h3>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/filebeat-7.3.0-linux-x86_64
./filebeat -e -c filebeat.yml
</code></pre>
<p>å¦‚æœä½ åœ¨è¿™é‡Œé‡åˆ°äº† runtime-cgo-pthread-create-failed-operation-not-permitted çš„é”™è¯¯ï¼Œé‚£ä½ å¯ä»¥å°è¯•å°† FileBeat çš„ç‰ˆæœ¬è¿›è¡Œæå‡ï¼Œæˆ‘è¿™é‡Œå°±é‡åˆ°äº†ï¼Œæ‰€ä»¥åç»­è¿›è¡Œç‰ˆæœ¬æå‡</p>
<h3 data-id="heading-10">é‡åˆ°é”™è¯¯ runtime-cgo-pthread-create-failed-operation-not-permitted</h3>
<p>å¦‚æœä½ æ²¡æœ‰é‡åˆ°ï¼Œç›´æ¥è·³è¿‡ï¼
æˆ‘è¿™é‡Œç‰ˆæœ¬ä¸€ç‚¹ç‚¹çš„å¾€ä¸Šå°è¯•ï¼Œå¤§è‡´çŒœæµ‹æ˜¯æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬å¯èƒ½æ–°ä¸€äº›ï¼Œæ‰€ä»¥åŸæ¥çš„Goçš„åº“æ— æ³•æ”¯æŒæ–°çš„æ“ä½œç³»ç»Ÿäº†ï¼ˆçŒœæµ‹çš„ï¼‰ã€‚
è¿™é‡Œæˆ‘æµ‹è¯•åˆ° 7.17 çš„ç‰ˆæœ¬å°±å¥½äº†ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/software
wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.17.0-linux-x86_64.tar.gz
</code></pre>
<p>æ ¹æ®åˆšæ‰çš„æ“ä½œï¼Œæˆ‘å·²ç»é…ç½®å¥½äº†è·¯åŠ²ç­‰å†…å®¹ï¼Œä¸”ä¿®æ”¹äº† filebeat.yml çš„é…ç½®æ–‡ä»¶å†…å®¹
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/098bb25df873458b9e8ad8e234811a6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=V8rd3HwZ22piN9xmglC15X%2FqR%2Bs%3D" alt="FileBeat é…ç½®æ–‡ä»¶" loading="lazy"/>
è¿›è¡Œå¯åŠ¨æµ‹è¯•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/filebeat-7.17.0-linux-x86_64
./filebeat -e -c filebeat.yml
</code></pre>
<p>é¡ºåˆ©å¯åŠ¨ï¼Œå¯åŠ¨ç»“æœå¦‚ä¸‹å›¾ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cffe5bda76fe4ca8af40e2ba94c0a735~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=kKlbCMO15EPTlb1eT1RRZKdLaCc%3D" alt="FileBeat æ—¥å¿—æ–‡ä»¶" loading="lazy"/></p>
<h3 data-id="heading-11">æµ‹è¯•æ•°æ®</h3>
<p>å¯åŠ¨ä¸€åˆ‡æ­£å¸¸ä¹‹åï¼Œæˆ‘ä»¬åœ¨Nginxåˆ·æ–°å‡ æ¬¡ï¼Œæ¥ç”Ÿæˆä¸€äº›æ•°æ®å‡ºæ¥ã€‚</p>
<h3 data-id="heading-12">æŸ¥çœ‹æ¶ˆè´¹</h3>
<pre><code class="hljs language-shell" lang="shell">kafka-console-consumer.sh --bootstrap-server h121.wzk.icu:9092 --topic nginx_access_log --
from-beginning
</code></pre>
<p>å¯ä»¥çœ‹åˆ°æ•°æ®å·²ç»æ¥äº†ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e59e867337ad4ca491316ca4b572cb8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=1Qd59gRGaPJNpfYbWklZcjPmkbo%3D" alt="FileBeat Kafkaæ¶ˆè´¹è€…å¯åŠ¨" loading="lazy"/>
æˆ‘ä»¬è¿›è¡Œä¸€ä¸‹JSONçš„æ ¼å¼åŒ–æ“ä½œï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
	<span class="hljs-attr">"@timestamp"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2024-08-19T08:14:52.073Z"</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"@metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"beat"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"filebeat"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"_doc"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7.17.0"</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"cloud"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"availability_zone"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cn-north-1b"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"service"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
			<span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ECS"</span>
		<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"provider"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"huawei"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"instance"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
			<span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ccf8173b-3e47-468e-be8a-5ea3a03c76e0"</span>
		<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"region"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cn-north-1"</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"log"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2034</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"file"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
			<span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/opt/wzk/logs/access.log"</span>
		<span class="hljs-punctuation">}</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"{ \"@timestamp\": \"2024-08-19T16:14:46+08:00\", \"remote_addr\": \"223.80.101.21\", \"remote_user\": \"-\", \"body_bytes_sent\": \"0\", \"request_time\": \"0.000\", \"status\": \"304\", \"request_uri\": \"/\", \"request_method\": \"GET\", \"http_referrer\": \"-\", \"http_x_forwarded_for\": \"-\", \"http_user_agent\": \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36\"}"</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"fields"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"app"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"www"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nginx-access"</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"input"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"log"</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"agent"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"hostname"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"h121.wzk.icu"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"ephemeral_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ebc9ac86-db92-4bb1-a631-e6a868393270"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"da3cc603-7d17-4b4a-ac3b-6b557805a2e2"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"h121.wzk.icu"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"filebeat"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7.17.0"</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"ecs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.12.0"</span>
	<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
	<span class="hljs-attr">"host"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
		<span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"h121.wzk.icu"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"mac"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"fa:16:3e:6b:c3:30"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"hostname"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"h121.wzk.icu"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"architecture"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"x86_64"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"os"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
			<span class="hljs-attr">"codename"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"jammy"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"linux"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"platform"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ubuntu"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"22.04.3 LTS (Jammy Jellyfish)"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"family"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"debian"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Ubuntu"</span><span class="hljs-punctuation">,</span>
			<span class="hljs-attr">"kernel"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"5.15.0-92-generic"</span>
		<span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"42ed7c7740bf4c19a180c6b736d11bbf"</span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"containerized"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
		<span class="hljs-attr">"ip"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"192.168.0.109"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"fe80::f816:3eff:fe6b:c330"</span><span class="hljs-punctuation">]</span>
	<span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-13">Logstash</h2>
<h3 data-id="heading-14">å®˜æ–¹æ–‡æ¡£</h3>
<p>Logstashç”¨æ¥è¯»å–Kafkaä¸­çš„æ•°æ®</p>
<pre><code class="hljs language-shell" lang="shell">https://www.elastic.co/guide/en/logstash/7.3/plugins-inputs-kafka.html
</code></pre>
<h3 data-id="heading-15">ç¼–å†™é…ç½®</h3>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/logstash-7.3.0/config
vim logstash_kafka_es.conf
</code></pre>
<p>ä¿®æ”¹å¦‚ä¸‹çš„é…ç½®å¦‚ä½•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">input {
    kafka {
        bootstrap_servers =&gt; "h121.wzk.icu:9092"
        topics =&gt; ["nginx_access_log"]
        codec =&gt; "json"
    }
}

filter {
    if [app] == "www" {
        if [type] == "nginx-access" {
            json {
                source =&gt; "message"
                remove_field =&gt; ["message"]
            }
            geoip {
                source =&gt; "remote_addr"
                target =&gt; "geoip"
                database =&gt; "/opt/wzk/GeoLite2-City.mmdb"
                add_field =&gt; ["[geoip][coordinates]", "%{[geoip][longitude]}"]
                add_field =&gt; ["[geoip][coordinates]", "%{[geoip][latitude]}"]
            }
            mutate {
                convert =&gt; ["[geoip][coordinates]", "float"]
            }
        }
    }
}

output {
    elasticsearch {
        hosts =&gt; ["http://h121.wzk.icu:9200"]
        index =&gt; "logstash-%{type}-%{+YYYY.MM.dd}"
    }
    stdout {
        codec =&gt; rubydebug
    }
}

</code></pre>
<h3 data-id="heading-16">ä¸‹è½½ä¾èµ–</h3>
<p>æˆ‘ä»¬çœ‹åˆ°è¿™é‡Œç”¨äº†ä¸€ä¸ª GeoLite2-City.mmdbï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½GeoLite2-City.mmdbï¼š</p>
<pre><code class="hljs language-shell" lang="shell">https://github.com/P3TERX/GeoLite.mmdb?tab=readme-ov-file
</code></pre>
<p>è¿™é‡Œæˆ‘ç›´æ¥ä¸‹è½½ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">cd /opt/wzk/
wget https://git.io/GeoLite2-City.mmdb
</code></pre>
<p>ä¸‹è½½è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9663451f16234837a932d68a4b97846b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=KngFemdDrbsmdqqGV0noVQdReNo%3D" alt="FileBeat Logstash" loading="lazy"/></p>
<h3 data-id="heading-17">æµ‹è¯•æœåŠ¡</h3>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/logstash-7.3.0
bin/logstash -f /opt/servers/logstash-7.3.0/config/logstash_kafka_es.conf -t
</code></pre>
<p>è¿è¡Œçš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e21f4bb28264e0a909e3a96949273f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=jEGfip6EHFR%2FkSVU1S6iYswj%2Fyg%3D" alt="FileBeat Logstash æµ‹è¯•æœåŠ¡" loading="lazy"/></p>
<h3 data-id="heading-18">å¯åŠ¨æœåŠ¡</h3>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/logstash-7.3.0
bin/logstash -f /opt/servers/logstash-7.3.0/config/logstash_kafka_es.conf
</code></pre>
<p>å¯åŠ¨ä¹‹åç»“æœå¦‚ä¸‹å›¾ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b0169c31630494fbcf0b2d42ec20850~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=3hNVl%2FSPmLLkvM7JMwNBQPiTkh0%3D" alt="FileBeat Logstash å¯åŠ¨æµ‹è¯•" loading="lazy"/>
Kafaå¯¹åº”çš„æ—¥å¿—éƒ¨åˆ†ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acc1b7a4814c49d1a2832ce7b081ba22~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=Te2BkM28JiD4hf8IhfTT6RYjKT4%3D" alt="FileBeat Kafkaæ—¥å¿—" loading="lazy"/></p>
<h3 data-id="heading-19">æµ‹è¯•æ•°æ®</h3>
<p>æˆ‘ä»¬åˆ·æ–°Nginxçš„é¡µé¢ï¼Œæä¾›ä¸€äº›æ•°æ®å‡ºæ¥ã€‚
æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Logstash çš„æ§åˆ¶å°è¾“å‡ºäº†å¯¹åº”çš„å†…å®¹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd194aeb840d47249402cb5a90f06a3a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766885590&amp;x-signature=KJQFsQwCRJGDBq6zWQb13vy2sBQ%3D" alt="FileBeat æµ‹è¯•æ•°æ®" loading="lazy"/></p>
<h2 data-id="heading-20">é”™è¯¯é€ŸæŸ¥</h2>















































<table><thead><tr><th>ç—‡çŠ¶</th><th>æ ¹å› </th><th>å®šä½</th><th>ä¿®å¤</th></tr></thead><tbody><tr><td>Filebeat å¯åŠ¨æŠ¥ runtime-cgo-pthread-create-failed-operation-not-permitted</td><td>äºŒè¿›åˆ¶/Go è¿è¡Œæ—¶ä¸ç³»ç»Ÿ/æƒé™/çº¿ç¨‹é™åˆ¶ä¸å…¼å®¹ï¼ˆåœ¨æ–°ç³»ç»Ÿæ›´å¸¸è§ï¼‰</td><td>ç›´æ¥åœ¨ ./filebeat -e -c filebeat.yml æ§åˆ¶å°å¤ç°</td><td>å‡çº§ Filebeat åˆ° 7.17.0ï¼ˆæ–‡ä¸­éªŒè¯å¯ç”¨ï¼‰ï¼Œä¿æŒåŸé…ç½®è¿ç§»</td></tr><tr><td>Kafka ç«¯æ¶ˆè´¹ä¸åˆ°æ•°æ®</td><td>input è·¯å¾„æ— æ–°æ—¥å¿—ã€enabled æœªå¼€ã€topic/hosts é…é”™</td><td>Filebeat æ§åˆ¶å°çœ‹ harvest/publishï¼›Kafka ç”¨ console-consumer éªŒè¯</td><td>ç¡®è®¤ filebeat.inputs.enabled: trueã€paths æŒ‡å‘çœŸå®æ–‡ä»¶ã€output.kafka.hosts/topic æ­£ç¡®ï¼›åˆ·æ–° Nginx äº§ç”Ÿæ–°è¡Œ</td></tr><tr><td>Kafka console-consumer å‘½ä»¤æŠ¥é”™æˆ–ä¸è¾“å‡º</td><td>å‘½ä»¤å‚æ•°è¢«æ¢è¡Œ/æˆªæ–­ï¼ˆ--from-beginning å†™æˆ --\nfrom-beginningï¼‰</td><td>ç›´æ¥çœ‹å‘½ä»¤è¡Œå›æ˜¾</td><td>ä½¿ç”¨å®Œæ•´ä¸€è¡Œå‘½ä»¤ï¼škafka-console-consumer.sh --bootstrap-server ... --topic ... --from-beginning</td></tr><tr><td>Logstash è§£æåå­—æ®µç¼ºå¤±/ä»æ˜¯åŸ message å­—ç¬¦ä¸²</td><td>codec =&gt; json åªè§£æ Kafka å¤–å±‚äº‹ä»¶ï¼›çœŸæ­£ä¸šåŠ¡ JSON åœ¨ message å­—æ®µå†…ï¼Œéœ€è¦äºŒæ¬¡ json filter</td><td>stdout(rubydebug) è§‚å¯Ÿäº‹ä»¶ç»“æ„ï¼šå¤–å±‚å­—æ®µ vs message å­—ç¬¦ä¸²</td><td>ä¿æŒ codec =&gt; jsonï¼Œå†ç”¨ json { source =&gt; "message" remove_field =&gt; ["message"] } äºŒæ¬¡è§£æï¼ˆæ–‡ä¸­å·²é…ç½®ï¼‰</td></tr><tr><td>GeoIP ä¸ç”Ÿæ•ˆæˆ–å¯åŠ¨æŠ¥æ•°æ®åº“è·¯å¾„é”™è¯¯</td><td>mmdb æ–‡ä»¶ä¸å­˜åœ¨/è·¯å¾„ä¸å¯¹/æƒé™ä¸è¶³</td><td>Logstash æ—¥å¿—æœ GeoIP/mmdbï¼›æ£€æŸ¥ /opt/wzk/GeoLite2-City.mmdb</td><td>ç¡®ä¿ mmdb å­˜åœ¨ä¸”å¯è¯»ï¼›è·¯å¾„ä¸é…ç½®ä¸€è‡´ï¼›å¿…è¦æ—¶è°ƒæ•´æ–‡ä»¶æƒé™/å±ä¸»</td></tr><tr><td>ES æ— ç´¢å¼•æˆ–å†™å…¥å¤±è´¥</td><td>ES åœ°å€ä¸å¯è¾¾ã€ç´¢å¼•æƒé™/æ¨¡æ¿é—®é¢˜ã€ç½‘ç»œ/è®¤è¯æœªé…ç½®</td><td>Logstash è¾“å‡ºä¸­çœ‹ elasticsearch output çš„é”™è¯¯å †æ ˆ</td><td>å…ˆç”¨ curl æµ‹ ES è¿é€šï¼›ç¡®è®¤ hosts =&gt; ["<a href="https://link.juejin.cn?target=http%3A%2F%2F...%3A9200" target="_blank" title="http://...:9200" ref="nofollow noopener noreferrer">http://...:9200</a>"] å¯è®¿é—®ï¼›å¦‚å¯ç”¨å®‰å…¨è®¤è¯éœ€è¡¥å……ç”¨æˆ·åå¯†ç /SSL é…ç½®</td></tr></tbody></table>
<h2 data-id="heading-21">å…¶ä»–ç³»åˆ—</h2>
<h3 data-id="heading-22">ğŸš€ AIç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>AIç‚¼ä¸¹æ—¥å¿—-29 - å­—èŠ‚è·³åŠ¨ DeerFlow æ·±åº¦ç ”ç©¶æ¡†<em>æ–œä½“æ ·å¼</em>æ¶ ç§æœ‰éƒ¨ç½² æµ‹è¯•ä¸Šæ‰‹ æ¶æ„ç ”ç©¶</strong>ï¼ŒæŒç»­æ‰“é€ å®ç”¨AIå·¥å…·æŒ‡å—ï¼
<strong>AIç ”ç©¶-132 Java ç”Ÿæ€å‰æ²¿ 2025ï¼šSpringã€Quarkusã€GraalVMã€CRaC ä¸äº‘åŸç”Ÿè½åœ°</strong></p>
<h3 data-id="heading-23">ğŸ’» Javaç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>Java-196 æ¶ˆæ¯é˜Ÿåˆ—é€‰å‹ï¼šRabbitMQ vs RocketMQ vs Kafka</strong>
MyBatis å·²å®Œç»“ï¼ŒSpring å·²å®Œç»“ï¼ŒNginxå·²å®Œç»“ï¼ŒTomcatå·²å®Œç»“ï¼Œåˆ†å¸ƒå¼æœåŠ¡å·²å®Œç»“ï¼ŒDubboå·²å®Œç»“ï¼ŒMySQLå·²å®Œç»“ï¼ŒMongoDBå·²å®Œç»“ï¼ŒNeo4jå·²å®Œç»“ï¼ŒFastDFS å·²å®Œç»“ï¼ŒOSSå·²å®Œç»“ï¼ŒGuavaCacheå·²å®Œç»“ï¼ŒEVCacheå·²å®Œç»“ï¼ŒRabbitMQæ­£åœ¨æ›´æ–°... æ·±å…¥æµ…å‡ºåŠ©ä½ æ‰“ç‰¢åŸºç¡€ï¼</p>
<h3 data-id="heading-24">ğŸ“Š å¤§æ•°æ®æ¿å—å·²å®Œæˆå¤šé¡¹å¹²è´§æ›´æ–°ï¼ˆ300ç¯‡ï¼‰ï¼š</h3>
<p>åŒ…æ‹¬ Hadoopã€Hiveã€Kafkaã€Flinkã€ClickHouseã€Elasticsearch ç­‰äºŒåä½™é¡¹æ ¸å¿ƒç»„ä»¶ï¼Œè¦†ç›–ç¦»çº¿+å®æ—¶æ•°ä»“å…¨æ ˆï¼
<strong>å¤§æ•°æ®-278 Spark MLib - åŸºç¡€ä»‹ç» æœºå™¨å­¦ä¹ ç®—æ³• æ¢¯åº¦æå‡æ ‘ GBDTæ¡ˆä¾‹ è¯¦è§£</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å½“é‡è§ CatchAdmin V5-æ¨¡å—åŒ–è®¾è®¡é‡æ–°å®šä¹‰ Laravel åå°å¼€å‘]]></title>    <link>https://juejin.cn/post/7585474459777187876</link>    <guid>https://juejin.cn/post/7585474459777187876</guid>    <pubDate>2025-12-21T00:07:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585474459777187876" data-draft-id="7585502118459899923" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å½“é‡è§ CatchAdmin V5-æ¨¡å—åŒ–è®¾è®¡é‡æ–°å®šä¹‰ Laravel åå°å¼€å‘"/> <meta itemprop="keywords" content="åç«¯,PHP"/> <meta itemprop="datePublished" content="2025-12-21T00:07:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å½“é‡è§ CatchAdmin V5-æ¨¡å—åŒ–è®¾è®¡é‡æ–°å®šä¹‰ Laravel åå°å¼€å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T00:07:38.000Z" title="Sun Dec 21 2025 00:07:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å½“é‡è§ CatchAdmin V5-æ¨¡å—åŒ–è®¾è®¡é‡æ–°å®šä¹‰ Laravel åå°å¼€å‘</h2>
<h3 data-id="heading-1">é€‰å‹å›°å¢ƒä¸­çš„ä¸€æ¬¡å¶ç„¶</h3>
<p>åš Laravel å¼€å‘è¿™äº›å¹´,æ¯æ¬¡å¯åŠ¨æ–°é¡¹ç›®æ—¶æ€»ä¼šé¢ä¸´åŒä¸€ä¸ªé—®é¢˜:åå°ç®¡ç†ç³»ç»Ÿè¯¥æ€ä¹ˆæ­?è‡ªå·±ä»é›¶å†™ä¸€å¥—æƒé™ã€èœå•ã€ç”¨æˆ·ç®¡ç†?å¤ªè€—æ—¶ã€‚ç”¨ç°æˆçš„æ–¹æ¡ˆ?å¸‚é¢ä¸Šçš„é€‰æ‹©ä¸å°‘,ä½†æ€»æœ‰äº›åœ°æ–¹ä¸å¤Ÿé¡ºæ‰‹ã€‚æœ‰äº›è¿‡äºè‡ƒè‚¿,é›†æˆäº†ä¸€å †ç”¨ä¸ä¸Šçš„åŠŸèƒ½;æœ‰äº›åˆè¿‡äºç®€é™‹,ç¨å¾®å¤æ‚ç‚¹çš„éœ€æ±‚å°±å¾—å¤§æ”¹ã€‚</p>
<p>ç›´åˆ°æŸå¤©åœ¨ GitHub ä¸Šé—²é€›æ—¶,å¶ç„¶çœ‹åˆ°äº† CatchAdmin V5 çš„ä»‹ç»ã€‚"åŸºäº Laravel 12 å’Œ Vue3 çš„æ¨¡å—åŒ–åå°ç®¡ç†ç³»ç»Ÿ"â€”â€”è¿™ä¸ªæ ‡ç­¾ç«‹åˆ»å¸å¼•äº†æˆ‘ã€‚Laravel 12 æ˜¯æœ€æ–°ç‰ˆæœ¬,Vue3 + Element Plus çš„å‰ç«¯ç»„åˆä¹Ÿå¾ˆç°ä»£,ä½†çœŸæ­£è®©æˆ‘ç‚¹è¿›å»çš„,æ˜¯"æ¨¡å—åŒ–"è¿™ä¸‰ä¸ªå­—ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2025-12%2Fcatchadmin-v5-modular-laravel-admin" target="_blank" title="https://catchadmin.com/post/2025-12/catchadmin-v5-modular-laravel-admin" ref="nofollow noopener noreferrer">åŸæ–‡é“¾æ¥ å½“é‡è§ CatchAdmin V5-æ¨¡å—åŒ–è®¾è®¡é‡æ–°å®šä¹‰ Laravel åå°å¼€å‘</a></p>
<h3 data-id="heading-2">ç¬¬ä¸€å°è±¡:å®‰è£…ä½“éªŒå‡ºä¹æ„æ–™</h3>
<p>æŠ±ç€è¯•è¯•çœ‹çš„å¿ƒæ€,æˆ‘å†³å®šåœ¨æœ¬åœ°è·‘ä¸€ä¸‹ã€‚æ•´ä¸ªå®‰è£…è¿‡ç¨‹ç®€å•å¾—è®©äººæ„å¤–:</p>
<pre><code class="hljs language-bash" lang="bash">composer global -W require catchadmin/installer

<span class="hljs-comment"># æ–°å»ºé¡¹ç›®</span>
catch new my-admin

<span class="hljs-comment"># å®‰è£…é¡¹ç›®</span>
<span class="hljs-built_in">cd</span> my-admin &amp;&amp; php artisan catch:install

<span class="hljs-comment"># å¯åŠ¨é¡¹ç›®</span>
composer run dev
</code></pre>
<p>å››è¡Œå‘½ä»¤,ä¸€ä¸ªå®Œæ•´çš„åå°ç®¡ç†ç³»ç»Ÿå°±ç«‹åœ¨äº†çœ¼å‰ã€‚æ²¡æœ‰å¤æ‚çš„é…ç½®æ–‡ä»¶è¦å¡«,æ²¡æœ‰ç¹ççš„ä¾èµ–è¦è£…,ç”šè‡³è¿æ•°æ®åº“è¿ç§»éƒ½æ˜¯è‡ªåŠ¨å®Œæˆçš„ã€‚è¿™ç§"å¼€ç®±å³ç”¨"çš„ä½“éªŒ,è®©æˆ‘æƒ³èµ·äº†ç¬¬ä¸€æ¬¡ç”¨ Laravel æ—¶çš„é‚£ç§æƒŠå–œâ€”â€”ä¸€åˆ‡éƒ½è¢«å®‰æ’å¾—æ°åˆ°å¥½å¤„ã€‚</p>
<p>æ‰“å¼€æµè§ˆå™¨è®¿é—®åå°,ç•Œé¢å¹²å‡€åˆ©è½ã€‚Element Plus çš„ç»„ä»¶é£æ ¼å¾ˆèˆ’æœ,æ²¡æœ‰é‚£ç§"åå°ç³»ç»Ÿç‰¹æœ‰çš„è€æ°”æ„Ÿ"ã€‚ä¾§è¾¹æ ã€è¡¨æ ¼ã€è¡¨å•,æ¯ä¸ªäº¤äº’éƒ½å¾ˆæµç•…ã€‚ä½†è¿™äº›éƒ½è¿˜åªæ˜¯è¡¨é¢,çœŸæ­£è®©æˆ‘çœ¼å‰ä¸€äº®çš„,æ˜¯å®ƒçš„æ¶æ„è®¾è®¡ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea9af422a95f4b85bf7ab74fbbd6c936~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQmluZ29Hbw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766880458&amp;x-signature=RcMjtH%2FufLJEVAQpJGkaEJxrNJY%3D" alt="CatchAdmin v5 æ¬¢è¿å›æ¥" loading="lazy"/></p>
<h3 data-id="heading-3">æ¨¡å—åŒ–è®¾è®¡:ä¸åªæ˜¯è¯´è¯´è€Œå·²</h3>
<p>å¾ˆå¤šæ¡†æ¶éƒ½å£°ç§°è‡ªå·±"æ¨¡å—åŒ–",ä½†å®é™…ç”¨èµ·æ¥,æ¨¡å—ä¹‹é—´å¾€å¾€è¿˜æ˜¯è—•æ–­ä¸è¿ã€‚CatchAdmin åœ¨è¿™æ–¹é¢åšå¾—å¾ˆå½»åº•:æ¯ä¸ªæ¨¡å—éƒ½æœ‰ç‹¬ç«‹çš„æ§åˆ¶å™¨ã€è·¯ç”±ã€æ¨¡å‹ã€æ•°æ®è¡¨,ç”šè‡³é…ç½®æ–‡ä»¶éƒ½æ˜¯éš”ç¦»çš„ã€‚</p>
<p>ä¸¾ä¸ªå…·ä½“ä¾‹å­ã€‚æˆ‘æƒ³ç»™ç³»ç»ŸåŠ ä¸€ä¸ª"æ–‡ç« ç®¡ç†"æ¨¡å—ã€‚ä¼ ç»Ÿåšæ³•æ˜¯åœ¨ç°æœ‰ä»£ç é‡Œä¸œåŠ ä¸€ç‚¹ã€è¥¿æ”¹ä¸€ç‚¹,æœ€åæ•´ä¸ªé¡¹ç›®å˜æˆä¸€å›¢æ„å¤§åˆ©é¢ã€‚ä½†åœ¨ CatchAdmin é‡Œ,æˆ‘å¯ä»¥è¿™æ ·åš:</p>
<pre><code class="hljs language-bash" lang="bash">php artisan catch:module:install
</code></pre>
<p>ç³»ç»Ÿä¼šåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„æ¨¡å—,æˆ‘é€‰æ‹©å®‰è£… <code>permissions</code>(æƒé™ç®¡ç†)æ¨¡å—ã€‚å®‰è£…å®Œæˆå,åˆ·æ–°é¡µé¢,å·¦ä¾§èœå•æ è‡ªåŠ¨å‡ºç°äº†å¯¹åº”çš„èœå•é¡¹,æ•°æ®è¡¨ä¹Ÿè‡ªåŠ¨åˆ›å»ºå¥½äº†ã€‚æ•´ä¸ªè¿‡ç¨‹å®Œå…¨ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä»»ä½•ä»£ç ã€‚</p>
<p>æ›´å¦™çš„æ˜¯,æ¨¡å—çš„é…ç½®ä¹Ÿæ˜¯ç‹¬ç«‹çš„ã€‚ä¸åƒä¼ ç»Ÿ Laravel é¡¹ç›®é‡Œæ‰€æœ‰é…ç½®éƒ½å †åœ¨ <code>config/</code> ç›®å½•ä¸‹,CatchAdmin çš„æ¨¡å—é…ç½®æ˜¯è¿™æ ·è®¿é—®çš„:</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// è®¿é—® permissions æ¨¡å—çš„é…ç½®</span>
<span class="hljs-title function_ invoke__">config</span>(<span class="hljs-string">'permissions.one.some_key'</span>)
</code></pre>
<p>è¿™ç§è®¾è®¡è®©æ¨¡å—ä¹‹é—´çš„è¾¹ç•Œéå¸¸æ¸…æ™°ã€‚æˆ‘å¯ä»¥æ”¾å¿ƒåœ°å¼€å‘è‡ªå·±çš„ä¸šåŠ¡æ¨¡å—,ä¸ç”¨æ‹…å¿ƒä¼šå½±å“åˆ°å…¶ä»–åŠŸèƒ½ã€‚å¦‚æœæŸå¤©ä¸éœ€è¦æŸä¸ªæ¨¡å—äº†,ç›´æ¥å¸è½½å³å¯,ä¸ä¼šç•™ä¸‹ä»»ä½•"é—è¿¹"ã€‚</p>
<h3 data-id="heading-4">ä»£ç ç”Ÿæˆå™¨:ä»é‡å¤åŠ³åŠ¨ä¸­è§£æ”¾</h3>
<p>å¦‚æœè¯´æ¨¡å—åŒ–è®¾è®¡æ˜¯ CatchAdmin çš„éª¨æ¶,é‚£ä»£ç ç”Ÿæˆå™¨å°±æ˜¯å®ƒçš„çµé­‚ã€‚</p>
<p>åšåå°å¼€å‘,æœ€çƒ¦çš„å°±æ˜¯å†™ CRUDã€‚ç”¨æˆ·è¡¨è¦ CRUD,æ–‡ç« è¡¨è¦ CRUD,è®¢å•è¡¨ä¹Ÿè¦ CRUDâ€¦â€¦æ¯æ¬¡éƒ½æ˜¯å¤åˆ¶ç²˜è´´æ”¹å­—æ®µå,æ¯ç‡¥åˆå®¹æ˜“å‡ºé”™ã€‚CatchAdmin çš„ä»£ç ç”Ÿæˆå™¨å½»åº•è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>åœ¨åå°çš„"ä»£ç ç”Ÿæˆ"æ¨¡å—é‡Œ,æˆ‘åªéœ€è¦:</p>
<ol>
<li>é€‰æ‹©ä¸€å¼ æ•°æ®è¡¨(æ¯”å¦‚ <code>articles</code>)</li>
<li>åœ¨å¯è§†åŒ–ç•Œé¢ä¸Šé…ç½®å­—æ®µä¿¡æ¯:å“ªäº›å­—æ®µè¦åœ¨åˆ—è¡¨é¡µæ˜¾ç¤º,å“ªäº›è¦åœ¨è¡¨å•é‡Œç¼–è¾‘,ç”¨ä»€ä¹ˆç»„ä»¶(è¾“å…¥æ¡†ã€ä¸‹æ‹‰æ¡†ã€å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ç­‰)</li>
<li>ç‚¹å‡»"ä¸€é”®ç”Ÿæˆ"</li>
</ol>
<p>ç„¶å,é­”æ³•å‘ç”Ÿäº†ã€‚åç«¯çš„ Controllerã€Modelã€Request éªŒè¯ç±»,å‰ç«¯çš„åˆ—è¡¨é¡µã€æ–°å¢é¡µã€ç¼–è¾‘é¡µ,å…¨éƒ¨è‡ªåŠ¨ç”Ÿæˆå¹¶æ³¨å†Œåˆ°ç³»ç»Ÿä¸­ã€‚åˆ·æ–°é¡µé¢,å·¦ä¾§èœå•æ å·²ç»å‡ºç°äº†"æ–‡ç« ç®¡ç†"é¡¹,å®Œæ•´çš„å¢åˆ æ”¹æŸ¥ã€æœç´¢ã€å¯¼å‡ºåŠŸèƒ½å…¨éƒ½å°±ç»ªã€‚</p>
<p>æˆ‘å‡ ä¹æ²¡æœ‰æ‰‹å†™ä¸€è¡Œä¸šåŠ¡ä»£ç ,å°±å®Œæˆäº†ä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½æ¨¡å—ã€‚è¿™ç§æ•ˆç‡æå‡,æ˜¯è´¨çš„é£è·ƒã€‚</p>
<h3 data-id="heading-5">æƒé™ä½“ç³»:ç»†è‡´åˆ°è®©äººå®‰å¿ƒ</h3>
<p>åå°ç®¡ç†ç³»ç»Ÿçš„æ ¸å¿ƒæ˜¯æƒé™æ§åˆ¶ã€‚CatchAdmin åœ¨è¿™æ–¹é¢åšå¾—å¾ˆæ‰å®ã€‚</p>
<p>å®ƒé‡‡ç”¨çš„æ˜¯æ ‡å‡†çš„ RBAC(åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶)æ¨¡å‹,ä½†åšäº†å¾ˆå¤šç»†èŠ‚ä¼˜åŒ–:</p>
<p><strong>ä¸‰çº§æƒé™ç®¡æ§</strong>:èœå•æƒé™ã€æŒ‰é’®æƒé™ã€æ•°æ®æƒé™ã€‚ä¸ä»…å¯ä»¥æ§åˆ¶ç”¨æˆ·èƒ½çœ‹åˆ°å“ªäº›èœå•,è¿˜èƒ½æ§åˆ¶èƒ½ç‚¹å‡»å“ªäº›æŒ‰é’®(æ¯”å¦‚"åˆ é™¤"æŒ‰é’®),ç”šè‡³èƒ½æ§åˆ¶èƒ½çœ‹åˆ°å“ªäº›æ•°æ®(æ¯”å¦‚"åå—åŒºç»ç†åªèƒ½çœ‹åå—åŒºçš„è®¢å•")ã€‚</p>
<p><strong>éƒ¨é—¨ä¸å²—ä½</strong>:æ”¯æŒæ ‘å½¢çš„éƒ¨é—¨ç»“æ„,å¯ä»¥ç»™ç”¨æˆ·åˆ†é…å²—ä½ã€‚è¿™è®©æƒé™ç®¡ç†æ›´è´´è¿‘å®é™…ä¸šåŠ¡åœºæ™¯ã€‚</p>
<p><strong>åŠ¨æ€èœå•</strong>:èœå•æ˜¯æ ¹æ®ç”¨æˆ·æƒé™åŠ¨æ€ç”Ÿæˆçš„ã€‚ä¸åŒè§’è‰²ç™»å½•åå°,çœ‹åˆ°çš„èœå•å®Œå…¨ä¸åŒã€‚è¿™åœ¨å¤šç§Ÿæˆ·æˆ–å¤šè§’è‰²çš„ç³»ç»Ÿä¸­ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<p>åœ¨åå°çš„"è§’è‰²ç®¡ç†"é¡µé¢,æˆ‘å¯ä»¥ç”¨æ ‘å½¢é€‰æ‹©å™¨å‹¾é€‰æƒé™,éå¸¸ç›´è§‚ã€‚é…ç½®å¥½ä¹‹å,æ•´ä¸ªæƒé™ä½“ç³»å°±è‡ªåŠ¨ç”Ÿæ•ˆäº†,ä¸éœ€è¦åœ¨ä»£ç é‡Œå†™ä¸€å † <code>if</code> åˆ¤æ–­ã€‚</p>
<h3 data-id="heading-6">æ’ä»¶ç”Ÿæ€:æ‹¥æŠ± Composer</h3>
<p>CatchAdmin V5 çš„å¦ä¸€ä¸ªäº®ç‚¹æ˜¯æ’ä»¶ç³»ç»Ÿã€‚å®ƒæ²¡æœ‰è‡ªå·±å‘æ˜ä¸€å¥—æ’ä»¶æœºåˆ¶,è€Œæ˜¯ç›´æ¥ç»‘å®š Composer ç”Ÿæ€ã€‚</p>
<p>è¿™æ„å‘³ç€ä»€ä¹ˆ?ä»»ä½•ä¸€ä¸ª Composer åŒ…éƒ½å¯ä»¥æˆä¸º CatchAdmin çš„æ’ä»¶ã€‚æˆ‘ä¸éœ€è¦å­¦ä¹ æ–°çš„æ’ä»¶å¼€å‘è§„èŒƒ,åªéœ€è¦æŒ‰ç…§ Laravel Package çš„æ ‡å‡†å†™ä»£ç ,ç„¶åé€šè¿‡ Composer å®‰è£…å³å¯ã€‚</p>
<p>è¿™ç§è®¾è®¡éå¸¸èªæ˜ã€‚å®ƒæ²¡æœ‰æŠŠè‡ªå·±å°é—­èµ·æ¥,è€Œæ˜¯æ‹¥æŠ±äº†æ•´ä¸ª PHP ç”Ÿæ€ã€‚æˆ‘å¯ä»¥è½»æ¾åœ°é›†æˆç¬¬ä¸‰æ–¹æœåŠ¡(æ”¯ä»˜ã€çŸ­ä¿¡ã€OSS ç­‰),ä¹Ÿå¯ä»¥æŠŠè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å°è£…æˆæ’ä»¶,åœ¨ä¸åŒé¡¹ç›®é—´å¤ç”¨ã€‚</p>
<h3 data-id="heading-7">å¼€å‘ä½“éªŒ:ç»†èŠ‚é‡Œçš„è´´å¿ƒ</h3>
<p>ç”¨äº†ä¸€æ®µæ—¶é—´å,æˆ‘å‘ç° CatchAdmin åœ¨å¾ˆå¤šç»†èŠ‚ä¸Šéƒ½å¾ˆè´´å¿ƒ:</p>
<p><strong>æ“ä½œæ—¥å¿—</strong>:ç³»ç»Ÿè‡ªåŠ¨è®°å½•ç”¨æˆ·çš„æ‰€æœ‰æ“ä½œ,åŒ…æ‹¬è®¿é—®äº†å“ªä¸ªé¡µé¢ã€ä¿®æ”¹äº†å“ªæ¡æ•°æ®ã€‚è¿™åœ¨æ’æŸ¥é—®é¢˜æˆ–å®¡è®¡æ—¶éå¸¸æœ‰ç”¨ã€‚</p>
<p><strong>ç™»å½•æ—¥å¿—</strong>:è®°å½•æ¯æ¬¡ç™»å½•çš„æ—¶é—´ã€IPã€è®¾å¤‡ä¿¡æ¯ã€‚å¯ä»¥å¿«é€Ÿå‘ç°å¼‚å¸¸ç™»å½•ã€‚</p>
<p><strong>æ•°æ®è¡¨ç»´æŠ¤</strong>:å¯ä»¥åœ¨åå°ç›´æ¥æŸ¥çœ‹æ•°æ®è¡¨ç»“æ„,æ¸…ç†ç¢ç‰‡,ä¼˜åŒ–è¡¨ã€‚ä¸éœ€è¦æ‰“å¼€ phpMyAdmin æˆ– Navicatã€‚</p>
<p><strong>å­—å…¸ç®¡ç†</strong>:å¯¹äºä¸€äº›å›ºå®šçš„æšä¸¾å€¼(æ¯”å¦‚"è®¢å•çŠ¶æ€:å¾…æ”¯ä»˜ã€å·²æ”¯ä»˜ã€å·²å–æ¶ˆ"),å¯ä»¥åœ¨å­—å…¸é‡Œç»Ÿä¸€ç®¡ç†,ç„¶ååœ¨ä»£ç é‡Œå¼•ç”¨ã€‚ç”šè‡³å¯ä»¥ä¸€é”®å¯¼å‡ºæˆ PHP æšä¸¾ç±»ã€‚</p>
<p>è¿™äº›åŠŸèƒ½çœ‹èµ·æ¥ä¸èµ·çœ¼,ä½†åœ¨å®é™…å¼€å‘ä¸­èƒ½çœä¸‹ä¸å°‘æ—¶é—´ã€‚</p>
<h3 data-id="heading-8">å‰ç«¯ä½“éªŒ:Vue3 + Element Plus çš„ç°ä»£æ„Ÿ</h3>
<p>å‰ç«¯æ˜¯åŸºäº Vue3 å’Œ Element Plus æ„å»ºçš„,ä»£ç ç»„ç»‡å¾—å¾ˆæ¸…æ™°ã€‚CatchAdmin å°è£…äº†ä¸€å¥— Composition API çš„ Hooks,ç”¨èµ·æ¥éå¸¸é¡ºæ‰‹:</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// åˆ—è¡¨é¡µ</span>
<span class="hljs-keyword">const</span> { data, query, search, reset, loading } = <span class="hljs-title function_">useGetList</span>(api)
<span class="hljs-keyword">const</span> tableData = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> data.<span class="hljs-property">value</span>?.<span class="hljs-property">data</span>)

<span class="hljs-comment">// æ–°å¢/ç¼–è¾‘</span>
<span class="hljs-keyword">const</span> { formData, form, loading, submitForm, close } = <span class="hljs-title function_">useCreate</span>(props.<span class="hljs-property">api</span>, props.<span class="hljs-property">primary</span>)

<span class="hljs-comment">// åˆ é™¤</span>
<span class="hljs-keyword">const</span> { destroy, deleted } = <span class="hljs-title function_">useDestroy</span>()
</code></pre>
<p>è¿™äº› Hooks æŠŠå¸¸è§çš„ CRUD æ“ä½œéƒ½å°è£…å¥½äº†,æˆ‘åªéœ€è¦ä¼ å…¥ API åœ°å€,å°±èƒ½å¿«é€Ÿæ­å»ºå‡ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„é¡µé¢ã€‚</p>
<p>å‰ç«¯æ”¯æŒ"å³æ—¶æ¸²æŸ“",ä¹Ÿå°±æ˜¯è¯´æˆ‘å¯ä»¥åœ¨ä¸ç¼–è¯‘çš„æƒ…å†µä¸‹ç›´æ¥ä¿®æ”¹ Vue æ–‡ä»¶,åˆ·æ–°æµè§ˆå™¨å°±èƒ½çœ‹åˆ°æ•ˆæœã€‚è¿™åœ¨å¼€å‘é˜¶æ®µéå¸¸æ–¹ä¾¿ã€‚</p>
<h3 data-id="heading-9">ä¸€ä¸ªå…·ä½“çš„åœºæ™¯:å¿«é€Ÿæ­å»º CMS</h3>
<p>å‡è®¾æˆ‘è¦ç”¨ CatchAdmin æ­å»ºä¸€ä¸ªç®€å•çš„å†…å®¹ç®¡ç†ç³»ç»Ÿ(CMS)ã€‚éœ€è¦ç®¡ç†æ–‡ç« ã€åˆ†ç±»ã€æ ‡ç­¾ã€‚</p>
<p><strong>ç¬¬ä¸€æ­¥</strong>:åˆ›å»ºæ•°æ®è¡¨ã€‚æˆ‘å¯ä»¥ç”¨ Laravel çš„ Migration,ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ CatchAdmin çš„"Schema ç®¡ç†"é‡Œå¯è§†åŒ–åˆ›å»ºã€‚</p>
<p><strong>ç¬¬äºŒæ­¥</strong>:ç”¨ä»£ç ç”Ÿæˆå™¨ç”Ÿæˆ CRUD ä»£ç ã€‚é€‰æ‹© <code>articles</code> è¡¨,é…ç½®å­—æ®µ(æ ‡é¢˜ç”¨è¾“å…¥æ¡†,å†…å®¹ç”¨å¯Œæ–‡æœ¬ç¼–è¾‘å™¨,åˆ†ç±»ç”¨ä¸‹æ‹‰æ¡†),ä¸€é”®ç”Ÿæˆã€‚</p>
<p><strong>ç¬¬ä¸‰æ­¥</strong>:é…ç½®æƒé™ã€‚åœ¨"è§’è‰²ç®¡ç†"é‡Œç»™"ç¼–è¾‘"è§’è‰²åˆ†é…"æ–‡ç« ç®¡ç†"æƒé™ã€‚</p>
<p><strong>ç¬¬å››æ­¥</strong>:å¦‚æœéœ€è¦è‡ªå®šä¹‰é€»è¾‘(æ¯”å¦‚æ–‡ç« å‘å¸ƒæ—¶è‡ªåŠ¨æ¨é€é€šçŸ¥),åœ¨ç”Ÿæˆçš„ Controller é‡ŒåŠ å‡ è¡Œä»£ç å³å¯ã€‚</p>
<p>æ•´ä¸ªè¿‡ç¨‹,æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¹‹å¤–çš„ä»£ç ,æˆ‘å‡ ä¹ä¸€è¡Œéƒ½æ²¡å†™ã€‚è¿™å°±æ˜¯ CatchAdmin å¸¦æ¥çš„æ•ˆç‡æå‡ã€‚</p>
<h3 data-id="heading-10">æ€§èƒ½ä¸ç¨³å®šæ€§</h3>
<p>CatchAdmin åŸºäº Laravel 12,å……åˆ†åˆ©ç”¨äº† PHP 8+ çš„ç‰¹æ€§ã€‚åœ¨æˆ‘çš„æµ‹è¯•ç¯å¢ƒé‡Œ(æœ¬åœ° XAMPP,æ²¡åšä»»ä½•ä¼˜åŒ–),å“åº”é€Ÿåº¦å¾ˆå¿«,åˆ—è¡¨é¡µåŠ è½½åŸºæœ¬åœ¨ 100ms ä»¥å†…ã€‚</p>
<p>å½“ç„¶,å®ƒæ¯•ç«Ÿæ˜¯ä¼ ç»Ÿçš„ PHP-FPM æ¨¡å¼,ä¸åƒ Swoole æˆ– Webman é‚£æ ·å¸¸é©»å†…å­˜ã€‚å¦‚æœå¯¹æ€§èƒ½æœ‰æè‡´è¦æ±‚,å¯ä»¥è€ƒè™‘å®˜æ–¹æä¾›çš„ Webman ç‰ˆæœ¬ã€‚ä½†å¯¹äºå¤§å¤šæ•°ä¸­å°å‹é¡¹ç›®æ¥è¯´,Laravel ç‰ˆæœ¬çš„æ€§èƒ½å·²ç»å®Œå…¨å¤Ÿç”¨ã€‚</p>
<h3 data-id="heading-11">é€‚ç”¨åœºæ™¯</h3>
<p>ç”¨äº†ä¸€æ®µæ—¶é—´å,æˆ‘è§‰å¾— CatchAdmin ç‰¹åˆ«é€‚åˆè¿™äº›åœºæ™¯:</p>
<p><strong>ä¼ä¸šå†…éƒ¨ç®¡ç†ç³»ç»Ÿ</strong>:OAã€CRMã€è¿›é”€å­˜ç­‰ã€‚æ¨¡å—åŒ–è®¾è®¡è®©ä½ å¯ä»¥æŒ‰éœ€ç»„åˆåŠŸèƒ½,ä¸ä¼šæœ‰å¤ªå¤šå†—ä½™ã€‚</p>
<p><strong>SaaS å¹³å°çš„ç®¡ç†åå°</strong>:å¤šç§Ÿæˆ·ã€å¤šè§’è‰²çš„æƒé™ç®¡ç†æ˜¯åˆšéœ€,CatchAdmin çš„ RBAC ä½“ç³»èƒ½å¾ˆå¥½åœ°æ»¡è¶³ã€‚</p>
<p><strong>å†…å®¹ç®¡ç†ç³»ç»Ÿ</strong>:CMSã€åšå®¢ã€æ–°é—»ç«™ç­‰ã€‚ä»£ç ç”Ÿæˆå™¨èƒ½å¿«é€Ÿæ­å»ºå‡ºå†…å®¹ç®¡ç†çš„åŸºç¡€æ¡†æ¶ã€‚</p>
<p><strong>å¿«é€ŸåŸå‹å¼€å‘</strong>:å¦‚æœä½ éœ€è¦åœ¨çŸ­æ—¶é—´å†…åšå‡ºä¸€ä¸ªå¯æ¼”ç¤ºçš„åå°ç³»ç»Ÿ,CatchAdmin æ˜¯ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚</p>
<h3 data-id="heading-12">ä¸€äº›æ€è€ƒ</h3>
<p>ä½“éªŒ CatchAdmin V5 çš„è¿‡ç¨‹,è®©æˆ‘å¯¹"æ¡†æ¶"è¿™ä¸ªæ¦‚å¿µæœ‰äº†æ–°çš„ç†è§£ã€‚</p>
<p>å¥½çš„æ¡†æ¶ä¸åº”è¯¥æ˜¯ä¸€ä¸ª"é»‘ç›’",è€Œåº”è¯¥æ˜¯ä¸€ä¸ª"è„šæ‰‹æ¶"ã€‚å®ƒæä¾›äº†åšå®çš„åŸºç¡€å’Œä¾¿æ·çš„å·¥å…·,ä½†ä¸ä¼šé™åˆ¶ä½ çš„å‘æŒ¥ç©ºé—´ã€‚CatchAdmin åœ¨è¿™æ–¹é¢åšå¾—å¾ˆå¥½:æ¨¡å—åŒ–è®¾è®¡è®©ä½ å¯ä»¥è‡ªç”±ç»„åˆåŠŸèƒ½,ä»£ç ç”Ÿæˆå™¨å¸®ä½ å¤„ç†é‡å¤åŠ³åŠ¨,æ’ä»¶ç³»ç»Ÿè®©ä½ å¯ä»¥æ— ç¼é›†æˆç¬¬ä¸‰æ–¹èƒ½åŠ›ã€‚</p>
<p>å®ƒæ²¡æœ‰è¯•å›¾æˆä¸º"å¤§è€Œå…¨"çš„è§£å†³æ–¹æ¡ˆ,è€Œæ˜¯ä¸“æ³¨äºåšå¥½"åå°ç®¡ç†ç³»ç»Ÿ"è¿™ä¸€ä»¶äº‹ã€‚è¿™ç§å…‹åˆ¶,åè€Œè®©å®ƒæ›´åŠ å®ç”¨ã€‚</p>
<h3 data-id="heading-13">å†™åœ¨æœ€å</h3>
<p>å¦‚æœä½ æ­£åœ¨å¯»æ‰¾ä¸€ä¸ªç°ä»£åŒ–çš„ Laravel åå°ç®¡ç†ç³»ç»Ÿæ¡†æ¶,æˆ–è€…å¯¹ç°æœ‰æ–¹æ¡ˆçš„å¼€å‘æ•ˆç‡æ„Ÿåˆ°ä¸æ»¡,æˆ‘å»ºè®®ä½ èŠ±åŠä¸ªå°æ—¶è¯•è¯• CatchAdmin V5ã€‚</p>
<p>å®ƒä¸ä¼šè®©ä½ å¤±æœ›ã€‚æ¨¡å—åŒ–çš„æ¶æ„ã€å¼ºå¤§çš„ä»£ç ç”Ÿæˆå™¨ã€å®Œå–„çš„æƒé™ä½“ç³»,ä»¥åŠå¯¹ Laravel ç”Ÿæ€çš„æ·±åº¦æ•´åˆ,éƒ½è®©å®ƒæˆä¸ºä¸€ä¸ªå€¼å¾—ä¿¡èµ–çš„é€‰æ‹©ã€‚</p>
<p>å¥½çš„å·¥å…·è‡ªå·±ä¼šè¯´è¯ã€‚å½“ä½ ç¬¬ä¸€æ¬¡ç”¨ä»£ç ç”Ÿæˆå™¨ä¸€é”®ç”Ÿæˆå‡ºä¸€ä¸ªå®Œæ•´çš„ CRUD æ¨¡å—æ—¶,ä½ å°±ä¼šæ˜ç™½æˆ‘åœ¨è¯´ä»€ä¹ˆã€‚</p>
<p>Laravel ç”Ÿæ€ä¾ç„¶å……æ»¡æ´»åŠ›,è€Œ CatchAdmin æ­£æ˜¯è¿™ç§æ´»åŠ›çš„è¯æ˜ã€‚å®ƒå‘Šè¯‰æˆ‘ä»¬,PHP åå°å¼€å‘å¯ä»¥æ›´é«˜æ•ˆã€æ›´ä¼˜é›…ã€æ›´ç°ä»£ã€‚</p>
<h3 data-id="heading-14">é¡¹ç›®åœ°å€</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FJaguarJack%2Fcatch-admin" target="_blank" title="https://github.com/JaguarJack/catch-admin" ref="nofollow noopener noreferrer">GitHub åœ°å€</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fcatchadmin%2FcatchAdmin" target="_blank" title="https://gitee.com/catchadmin/catchAdmin" ref="nofollow noopener noreferrer">Gitee åœ°å€</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScriptæ€§èƒ½ä¼˜åŒ–ï¼š7ä¸ªV8å¼•æ“å†…éƒ¨åŸç†å¸®ä½ å‡å°‘90%å†…å­˜æ³„æ¼çš„å®æˆ˜æŠ€å·§]]></title>    <link>https://juejin.cn/post/7585458459167195170</link>    <guid>https://juejin.cn/post/7585458459167195170</guid>    <pubDate>2025-12-21T00:17:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7585458459167195170" data-draft-id="7585476892977152034" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScriptæ€§èƒ½ä¼˜åŒ–ï¼š7ä¸ªV8å¼•æ“å†…éƒ¨åŸç†å¸®ä½ å‡å°‘90%å†…å­˜æ³„æ¼çš„å®æˆ˜æŠ€å·§"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-12-21T00:17:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScriptæ€§èƒ½ä¼˜åŒ–ï¼š7ä¸ªV8å¼•æ“å†…éƒ¨åŸç†å¸®ä½ å‡å°‘90%å†…å­˜æ³„æ¼çš„å®æˆ˜æŠ€å·§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-21T00:17:03.000Z" title="Sun Dec 21 2025 00:17:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-21
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>JavaScriptæ€§èƒ½ä¼˜åŒ–ï¼š7ä¸ªV8å¼•æ“å†…éƒ¨åŸç†å¸®ä½ å‡å°‘90%å†…å­˜æ³„æ¼çš„å®æˆ˜æŠ€å·§</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>åœ¨ç°ä»£Webå¼€å‘ä¸­ï¼ŒJavaScriptçš„æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæ°¸æ’çš„è¯é¢˜ã€‚éšç€åº”ç”¨å¤æ‚åº¦çš„æå‡ï¼Œå†…å­˜æ³„æ¼ã€GCï¼ˆåƒåœ¾å›æ”¶ï¼‰åœé¡¿å’Œä½æ•ˆçš„ä»£ç æ‰§è¡Œæˆä¸ºå¼€å‘è€…é¢ä¸´çš„å¸¸è§é—®é¢˜ã€‚V8å¼•æ“ä½œä¸ºChromeå’ŒNode.jsçš„æ ¸å¿ƒï¼Œå…¶å†…éƒ¨æœºåˆ¶å¯¹JavaScriptçš„æ‰§è¡Œæ•ˆç‡æœ‰ç€å†³å®šæ€§å½±å“ã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æV8å¼•æ“çš„7ä¸ªå…³é”®åŸç†ï¼Œå¹¶ç»“åˆå®æˆ˜æŠ€å·§ï¼Œå¸®åŠ©ä½ å°†å†…å­˜æ³„æ¼å‡å°‘90%ï¼ŒåŒæ—¶æå‡ä»£ç è¿è¡Œæ•ˆç‡ã€‚</p>
<h2 data-id="heading-2">1. ç†è§£V8çš„å†…å­˜æ¨¡å‹</h2>
<h3 data-id="heading-3">å †å†…å­˜çš„åˆ†ä»£ç®¡ç†</h3>
<p>V8å°†å †å†…å­˜åˆ†ä¸º<strong>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰<strong>å’Œ</strong>è€ç”Ÿä»£ï¼ˆOld Generationï¼‰</strong>ï¼š</p>
<ul>
<li><strong>æ–°ç”Ÿä»£</strong>ï¼šå­˜æ”¾å­˜æ´»æ—¶é—´çŸ­çš„å¯¹è±¡ï¼Œé€šè¿‡Scavengeç®—æ³•å¿«é€Ÿå›æ”¶ã€‚</li>
<li><strong>è€ç”Ÿä»£</strong>ï¼šå­˜æ”¾é•¿æœŸå­˜æ´»çš„å¯¹è±¡ï¼Œé‡‡ç”¨æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰å’Œæ ‡è®°-æ•´ç†ï¼ˆMark-Compactï¼‰ç®—æ³•ã€‚</li>
</ul>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>é¿å…é¢‘ç¹åˆ›å»ºå¤§å¯¹è±¡ï¼Œç›´æ¥åˆ†é…åˆ°è€ç”Ÿä»£ä¼šå¢åŠ GCå‹åŠ›ã€‚</li>
<li>ä½¿ç”¨<code>Object.assign</code>æˆ–å±•å¼€è¿ç®—ç¬¦æ›¿ä»£æ·±æ‹·è´ï¼Œå‡å°‘ä¸´æ—¶å¯¹è±¡ç”Ÿæˆã€‚</li>
</ul>
<h2 data-id="heading-4">2. éšè—ç±»ä¸å†…è”ç¼“å­˜ï¼ˆInline Cacheï¼‰</h2>
<h3 data-id="heading-5">éšè—ç±»ï¼ˆHidden Classï¼‰</h3>
<p>V8é€šè¿‡éšè—ç±»ä¼˜åŒ–å±æ€§è®¿é—®é€Ÿåº¦ã€‚å½“å¯¹è±¡ç»“æ„å˜åŒ–æ—¶ï¼ˆå¦‚åŠ¨æ€æ·»åŠ å±æ€§ï¼‰ï¼Œéšè—ç±»ä¼šå¤±æ•ˆï¼Œå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</p>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>åœ¨æ„é€ å‡½æ•°ä¸­ä¸€æ¬¡æ€§åˆå§‹åŒ–æ‰€æœ‰å±æ€§ã€‚</li>
<li>é¿å…ä½¿ç”¨<code>delete</code>åˆ é™¤å¯¹è±¡å±æ€§ï¼Œè¿™ä¼šç ´åéšè—ç±»ã€‚</li>
</ul>
<h3 data-id="heading-6">å†…è”ç¼“å­˜</h3>
<p>V8é€šè¿‡å†…è”ç¼“å­˜ç¼“å­˜æ–¹æ³•è°ƒç”¨è·¯å¾„ï¼ŒåŠ é€Ÿé‡å¤æ“ä½œã€‚</p>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>ä¿æŒå‡½æ•°å‚æ•°ç±»å‹ç¨³å®šï¼Œé¿å…å¤šæ€è°ƒç”¨ï¼ˆå¦‚åŒä¸€å‡½æ•°å¤„ç†å¤šç§ç±»å‹å‚æ•°ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-7">3. é€ƒé€¸åˆ†æä¸æ ˆåˆ†é…</h2>
<h3 data-id="heading-8">é€ƒé€¸åˆ†æï¼ˆEscape Analysisï¼‰</h3>
<p>V8ä¼šåˆ†æå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœå¯¹è±¡æœªé€ƒé€¸å‡ºå‡½æ•°ä½œç”¨åŸŸï¼Œå¯èƒ½è¢«åˆ†é…åˆ°æ ˆä¸Šè€Œéå †ä¸­ï¼Œä»è€Œå‡å°‘GCå‹åŠ›ã€‚</p>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>å°½é‡é™åˆ¶å¯¹è±¡çš„å¯è§èŒƒå›´ï¼ˆå¦‚ä½¿ç”¨é—­åŒ…æ—¶è°¨æ…æš´éœ²å¯¹è±¡ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-9">4. GCè§¦å‘æœºåˆ¶ä¸ä¼˜åŒ–ç­–ç•¥</h2>
<h3 data-id="heading-10">Major GCä¸Minor GC</h3>
<ul>
<li><strong>Minor GC</strong>ï¼šé¢‘ç¹æ¸…ç†æ–°ç”Ÿä»£ï¼Œé€Ÿåº¦å¿«ä½†å¯èƒ½å¼•å‘çŸ­æš‚åœé¡¿ã€‚</li>
<li><strong>Major GC</strong>ï¼šæ¸…ç†è€ç”Ÿä»£ï¼Œè€—æ—¶é•¿ä¸”é˜»å¡ä¸»çº¿ç¨‹ã€‚</li>
</ul>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨<code>weakMap</code>æˆ–<code>weakSet</code>å­˜å‚¨ä¸´æ—¶å¼•ç”¨ï¼Œé¿å…å¹²æ‰°GCã€‚</li>
<li>Node.jsä¸­å¯é€šè¿‡<code>--max-old-space-size</code>è°ƒæ•´è€ç”Ÿä»£å¤§å°ã€‚</li>
</ul>
<h2 data-id="heading-11">5. TurboFanç¼–è¯‘å™¨ä¸çƒ­ç‚¹ä»£ç ä¼˜åŒ–</h2>
<h3 data-id="heading-12">JITç¼–è¯‘æµç¨‹</h3>
<p>V8é€šè¿‡Ignitionè§£é‡Šå™¨ç”Ÿæˆå­—èŠ‚ç ï¼ŒTurboFanå°†çƒ­ç‚¹ä»£ç ç¼–è¯‘ä¸ºé«˜æ•ˆæœºå™¨ç ã€‚</p>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>é¿å…åœ¨çƒ­ç‚¹ä»£ç ä¸­ä½¿ç”¨<code>eval</code>æˆ–<code>with</code>ï¼Œå®ƒä»¬ä¼šé˜»æ­¢TurboFanä¼˜åŒ–ã€‚</li>
<li>ä½¿ç”¨ç±»å‹æ˜ç¡®çš„å˜é‡ï¼ˆå¦‚<code>let sum = 0</code>è€Œé<code>let sum = ''</code>ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-13">6. å†…å­˜æ³„æ¼çš„å¸¸è§æ¨¡å¼ä¸æ’æŸ¥</h2>
<h3 data-id="heading-14">å…¸å‹æ³„æ¼åœºæ™¯</h3>
<ol>
<li><strong>å…¨å±€å˜é‡æ±¡æŸ“</strong>ï¼šæ„å¤–å®šä¹‰çš„å…¨å±€å˜é‡æ— æ³•è¢«å›æ”¶ã€‚</li>
<li><strong>é—­åŒ…å¼•ç”¨</strong>ï¼šæœªé‡Šæ”¾çš„å¤–éƒ¨å˜é‡å¯¼è‡´é—­åŒ…æŒæœ‰å†…å­˜ã€‚</li>
<li><strong>å®šæ—¶å™¨/äº‹ä»¶ç›‘å¬æœªæ¸…é™¤</strong>ï¼šå¦‚æœªæ¸…ç†çš„<code>setInterval</code>æˆ–DOMäº‹ä»¶ç»‘å®šã€‚</li>
</ol>
<p><strong>æ’æŸ¥å·¥å…·</strong>ï¼š</p>
<ul>
<li>Chrome DevToolsçš„Memoryé¢æ¿ï¼ˆHeap Snapshotså¯¹æ¯”ï¼‰ã€‚</li>
<li>Node.jsçš„<code>heapdump</code>æ¨¡å—ç”Ÿæˆå †å¿«ç…§åˆ†æã€‚</li>
</ul>
<h2 data-id="heading-15">7. ArrayBufferä¸SharedArrayBufferçš„é«˜æ•ˆä½¿ç”¨</h2>
<h3 data-id="heading-16">TypedArrayä¸å†…å­˜å…±äº«</h3>
<p>ç›´æ¥æ“ä½œäºŒè¿›åˆ¶æ•°æ®å¯å‡å°‘ä¸­é—´è½¬æ¢å¼€é”€ï¼Œä½†éœ€æ³¨æ„å†…å­˜å®‰å…¨ã€‚</p>
<p><strong>ä¼˜åŒ–æŠ€å·§</strong>ï¼š</p>
<ul>
<li>ä¼˜å…ˆä½¿ç”¨TypedArrayè€Œéæ™®é€šæ•°ç»„å¤„ç†å¤§æ•°æ®é›†ã€‚</li>
<li>SharedArrayBufferéœ€é…åˆAtomicsé¿å…ç«æ€æ¡ä»¶ï¼ˆä»…åœ¨å®‰å…¨ä¸Šä¸‹æ–‡å¯ç”¨ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-17">æ€»ç»“</h2>
<p>ç†è§£V8çš„å†…éƒ¨å·¥ä½œåŸç†æ˜¯æ€§èƒ½ä¼˜åŒ–çš„å…³é”®ã€‚é€šè¿‡åˆç†åˆ©ç”¨éšè—ç±»ã€æ§åˆ¶GCè¡Œä¸ºã€é¿å…å†…å­˜æ³„æ¼æ¨¡å¼ä»¥åŠå–„ç”¨ç¼–è¯‘å™¨ä¼˜åŒ–ç‰¹æ€§ï¼Œå¼€å‘è€…å¯ä»¥æ˜¾è‘—æå‡JavaScriptåº”ç”¨çš„æ•ˆç‡å¹¶å‡å°‘èµ„æºæ¶ˆè€—ã€‚å»ºè®®ç»“åˆChrome DevToolså’ŒNode.jsçš„åˆ†æå·¥å…·æŒç»­ç›‘æ§æ€§èƒ½è¡¨ç°ï¼Œå°†ç†è®ºè½¬åŒ–ä¸ºå®è·µä¸­çš„é«˜æ€§èƒ½ä»£ç ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>