<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[é€šç”¨ç®¡ç†åå°ç»„ä»¶åº“-4-æ¶ˆæ¯ç»„ä»¶å¼€å‘]]></title>    <link>https://juejin.cn/post/7591330139084046351</link>    <guid>https://juejin.cn/post/7591330139084046351</guid>    <pubDate>2026-01-05T01:42:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591330139084046351" data-draft-id="7591375103519866920" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é€šç”¨ç®¡ç†åå°ç»„ä»¶åº“-4-æ¶ˆæ¯ç»„ä»¶å¼€å‘"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-05T01:42:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ²¡æƒ³å¥½d"/> <meta itemprop="url" content="https://juejin.cn/user/1275872963211399"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é€šç”¨ç®¡ç†åå°ç»„ä»¶åº“-4-æ¶ˆæ¯ç»„ä»¶å¼€å‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1275872963211399/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ²¡æƒ³å¥½d
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T01:42:24.000Z" title="Mon Jan 05 2026 01:42:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¶ˆæ¯ç»„ä»¶å¼€å‘</h2>
<p>åŒ…æ‹¬ï¼šæ¶ˆæ¯ç»„ä»¶å’Œæ¶ˆæ¯å¼¹çª—ç»„ä»¶å¼€å‘ã€‚<br/>
å®ç°æ•ˆæœï¼š
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3706e26faef0421d913fd8270f0eedeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKh5oOz5aW9ZA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768182144&amp;x-signature=dAbp65LH3pI3rciBC%2FGG%2BTHZG8g%3D" alt="Snipaste_2026-01-05_09-33-08.png" loading="lazy"/></p>
<h4 data-id="heading-1">1.æ¶ˆæ¯ç»„ä»¶</h4>
<p>Notification.vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-badge</span> <span class="hljs-attr">:value</span>=<span class="hljs-string">"value"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Icon</span>
        <span class="hljs-attr">icon</span>=<span class="hljs-string">"ep:bell"</span>
        <span class="hljs-attr">:style</span>=<span class="hljs-string">"{
          color: iconColor ?? '#333',
          fontSize: iconSize ? `${iconSize}px` : '18px'
        }"</span>
      /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">el-badge</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Icon</span>, type <span class="hljs-title class_">IconifyIcon</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@iconify/vue'</span>
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">NotificationProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./type'</span>

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">withDefaults</span>(defineProps&lt;<span class="hljs-title class_">NotificationProps</span>&gt;(), {
  <span class="hljs-attr">value</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">icon</span>: <span class="hljs-string">'ep:bell'</span>,
  <span class="hljs-attr">size</span>: <span class="hljs-number">12</span>,
  <span class="hljs-attr">color</span>: <span class="hljs-string">''</span>,
  <span class="hljs-attr">scale</span>: <span class="hljs-number">1</span>
})

<span class="hljs-comment">// è®¾ç½®translateXå’Œscaleå¯¹åº”å…³ç³»ï¼Œè®©å®ƒåˆç†æ˜¾ç¤º</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">calcuateTranslate</span>(<span class="hljs-params">scale: number</span>) {
  <span class="hljs-comment">// è®¾ç½®translateXå’ŒscaleèŒƒå›´å€¼</span>
  <span class="hljs-keyword">const</span> minScale = <span class="hljs-number">0.4</span>
  <span class="hljs-keyword">const</span> maxScale = <span class="hljs-number">1</span>
  <span class="hljs-keyword">const</span> minTranslateX = <span class="hljs-number">75</span>
  <span class="hljs-keyword">const</span> maxTranslateX = <span class="hljs-number">100</span>

  <span class="hljs-comment">// è®¡ç®—translateXå’Œscaleçš„å¯¹åº”å…³ç³»</span>
  <span class="hljs-keyword">const</span> translateX =
    minTranslateX + ((maxTranslateX - minTranslateX) * (scale - minScale)) / (maxScale - minScale)

  <span class="hljs-keyword">return</span> {
    translateX,
    scale
  }
}

<span class="hljs-keyword">const</span> transformData = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">calcuateTranslate</span>(props.<span class="hljs-property">scale</span>))

<span class="hljs-comment">// è®¡ç®—iconé¢œè‰²å’Œå¤§å°ã€ç§»åŠ¨ã€ç¼©æ”¾</span>
<span class="hljs-keyword">const</span> bgColor = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">color</span> || <span class="hljs-string">'var(--el-color-danger)'</span>)
<span class="hljs-keyword">const</span> fontSize = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">size</span> + <span class="hljs-string">'px'</span> || <span class="hljs-string">'var(--el-badge-size)'</span>)
<span class="hljs-keyword">const</span> translateX = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> (transformData.<span class="hljs-property">value</span>?.<span class="hljs-property">translateX</span> || <span class="hljs-number">100</span>) + <span class="hljs-string">'%'</span>)
<span class="hljs-keyword">const</span> contentScale = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> transformData.<span class="hljs-property">value</span>?.<span class="hljs-property">scale</span> || <span class="hljs-number">100</span>)

</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span>&gt;</span>
// é€šè¿‡ä¼ é€’çš„æ•°æ®æ·»åŠ æ ·å¼
// $color: var(--bg-color);
// $size: var(--font-size);
// $translate-x: var(--translate-x);
// $scale: var(--scale);

:deep(.el-badge__content) {
  // v-bind() æ ·å¼ä¸­åŠ¨æ€ç»‘å®šå“åº”å¼æ•°æ®,å€¼ä¸æ”¯æŒjsè¡¨è¾¾å¼
  background-color: v-bind(bgColor);
  font-size: v-bind(fontSize);
  transform: translateY(-50%) translateX(v-bind(translateX)) scale(v-bind(contentScale));
}
<span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h4 data-id="heading-2">2.æ¶ˆæ¯å¼¹çª—ç»„ä»¶</h4>
<p>ï¼ˆ1ï¼‰æ¶ˆæ¯å¼¹çª—å†…å®¹ç»„ä»¶NoticeMessageList.vue</p>
<pre><code class="hljs language-ini" lang="ini">&lt;template&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"mx-4 mt-2"</span>&gt;
    &lt;el-tabs <span class="hljs-attr">v-model</span>=<span class="hljs-string">"activeName"</span> class=<span class="hljs-string">"demo-tabs"</span> @tab-click=<span class="hljs-string">"handleTabClick"</span> :class=<span class="hljs-string">"wrapClass"</span>&gt;
      &lt;el-tab-pane :<span class="hljs-attr">label</span>=<span class="hljs-string">"tab.title"</span> :name=<span class="hljs-string">"tab.title"</span> v-for=<span class="hljs-string">"(tab, index) in lists"</span> :key=<span class="hljs-string">"index"</span>&gt;
        &lt;div <span class="hljs-attr">v-if</span>=<span class="hljs-string">"tab.content &amp;&amp; tab.content.length &gt; 0"</span>&gt;
          &lt;el-row
            <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, tIndex) in tab.content"</span>
            :<span class="hljs-attr">key</span>=<span class="hljs-string">"tIndex"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"mb-1 cursor-pointer hover:bg-sky-100"</span>
          &gt;
            &lt;el-col :<span class="hljs-attr">span</span>=<span class="hljs-string">"4"</span>&gt;
              &lt;el-avatar
                <span class="hljs-attr">v-if</span>=<span class="hljs-string">"item.avatar"</span>
                <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"Object.assign({ size: 30 }, item.avatar)"</span>
                @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClickAvatar(item.avatar)"</span>
              /&gt;
            &lt;/el-col&gt;
            &lt;el-col <span class="hljs-attr">v-if</span>=<span class="hljs-string">"item.content"</span> :span=<span class="hljs-string">"20"</span> class=<span class="hljs-string">"pl-2"</span> @click=<span class="hljs-string">"handleClickItem(item)"</span>&gt;
              &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"flex align-center flex-nowrap max-w-60"</span>&gt;
                &lt;span <span class="hljs-attr">class</span>=<span class="hljs-string">"text-base line-clamp-1"</span>&gt;{{ item.title }}&lt;/span&gt;
                &lt;el-tag <span class="hljs-attr">v-if</span>=<span class="hljs-string">"item.tag"</span> v-bind=<span class="hljs-string">"item.tagProps"</span> class=<span class="hljs-string">"ml-2 mt-0.5"</span>&gt;{{
                  item.tag
                }}&lt;/el-tag&gt;
              &lt;/div&gt;
              &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"text-gray-500 text-sm mt-1 max-w-60"</span> v-if=<span class="hljs-string">"item.content"</span>&gt;
                {{ item.content }}
              &lt;/div&gt;
              &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"text-xs text-gray-400 my-2"</span> v-if=<span class="hljs-string">"item.time"</span>&gt;{{ item.time }}&lt;/div&gt;
            &lt;/el-col&gt;
          &lt;/el-row&gt;
        &lt;/div&gt;
      &lt;/el-tab-pane&gt;
    &lt;/el-tabs&gt;
    &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"w-full flex align-middle"</span>&gt;
      &lt;div
        <span class="hljs-attr">class</span>=<span class="hljs-string">"w-50% border-t justify-center flex items-center py-2 hover:bg-sky-200 hover:text-sky-500"</span>
        :<span class="hljs-attr">class</span>=<span class="hljs-string">"{ 'border-r': index === 0 }"</span>
        <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(action, index) in actions"</span>
        :<span class="hljs-attr">key</span>=<span class="hljs-string">"index"</span>
        @<span class="hljs-attr">click</span>=<span class="hljs-string">"action.click"</span>
      &gt;
        &lt;Icon <span class="hljs-attr">v-if</span>=<span class="hljs-string">"action.icon"</span> :icon=<span class="hljs-string">"action.icon"</span> class=<span class="hljs-string">"inline-block mr-1"</span> /&gt;
        &lt;span&gt;{{ action.title }}&lt;/span&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;
import type { AvatarProps, TabsPaneContext } from 'element-plus'
import { Icon } from '@iconify/vue'
import type { MessageListItem, NoticeMessageListProps } from './type'

const <span class="hljs-attr">props</span> = defineProps&lt;NoticeMessageListProps&gt;()

const <span class="hljs-attr">activeName</span> = ref(props.lists[<span class="hljs-number">0</span>]?.title || <span class="hljs-string">''</span>)

// ä¼ å›ç‚¹å‡»äº‹ä»¶
const <span class="hljs-attr">emits</span> = defineEmits&lt;{
  clickAvatar: <span class="hljs-section">[avatar: Partial&lt;AvatarProps&gt;]</span>
  clickItem: <span class="hljs-section">[item: MessageListItem]</span>
  clickTab: <span class="hljs-section">[tab: TabsPaneContext, event: Event]</span>
}&gt;()
const <span class="hljs-attr">handleClickAvatar</span> = (avatar: Partial&lt;AvatarProps&gt;) =&gt; {
  emits('clickAvatar', avatar)
}
const <span class="hljs-attr">handleClickItem</span> = (item: MessageListItem) =&gt; {
  emits('clickItem', item)
}
const <span class="hljs-attr">handleTabClick</span> = (tab: TabsPaneContext, event: Event) =&gt; {
  emits('clickTab', tab, event)
}
&lt;/script&gt;

&lt;style scoped <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span>&gt;&lt;/style&gt;

</code></pre>
<p>ï¼ˆ2ï¼‰æ¶ˆæ¯å¼¹çª—ç»„ä»¶Notice.vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">el-dropdown</span> <span class="hljs-attr">trigger</span>=<span class="hljs-string">"click"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Notification</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"filterProps"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">dropdown</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">NoticeMessageList</span>
          <span class="hljs-attr">:lists</span>=<span class="hljs-string">"lists"</span>
          <span class="hljs-attr">:actions</span>=<span class="hljs-string">"actions"</span>
          <span class="hljs-attr">:wrap-class</span>=<span class="hljs-string">"wrapClass"</span>
          <span class="hljs-attr">v-on</span>=<span class="hljs-string">"forwordedEvents"</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">el-dropdown</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">NoticeProps</span>, <span class="hljs-title class_">MessageListItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./type'</span>
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">AvatarProps</span>, <span class="hljs-title class_">TabsPaneContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>

<span class="hljs-keyword">const</span> props = defineProps&lt;<span class="hljs-title class_">NoticeProps</span>&gt;()

<span class="hljs-keyword">const</span> filterProps = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// è¿‡æ»¤æ‰actionså’Œlists,è·å–Notificationç»„ä»¶çš„props</span>
  <span class="hljs-keyword">const</span> { lists, actions, wrapClass, ...restProps } = props
  <span class="hljs-keyword">return</span> restProps
})

<span class="hljs-comment">// äº‹ä»¶ä¼ é€’</span>
<span class="hljs-keyword">const</span> emits = defineEmits&lt;{
  <span class="hljs-attr">clickAvatar</span>: [<span class="hljs-attr">avatar</span>: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">AvatarProps</span>&gt;]
  <span class="hljs-attr">clickItem</span>: [<span class="hljs-attr">item</span>: <span class="hljs-title class_">MessageListItem</span>]
  <span class="hljs-attr">clickTab</span>: [<span class="hljs-attr">tab</span>: <span class="hljs-title class_">TabsPaneContext</span>, <span class="hljs-attr">event</span>: <span class="hljs-title class_">Event</span>]
}&gt;()
<span class="hljs-comment">// é€ä¼ äº‹ä»¶</span>
<span class="hljs-keyword">const</span> forwordedEvents = {
  <span class="hljs-attr">clickAvatar</span>: <span class="hljs-function">(<span class="hljs-params">avatar: Partial&lt;AvatarProps&gt;</span>) =&gt;</span> <span class="hljs-title function_">emits</span>(<span class="hljs-string">'clickAvatar'</span>, avatar),
  <span class="hljs-attr">clickItem</span>: <span class="hljs-function">(<span class="hljs-params">item: MessageListItem</span>) =&gt;</span> <span class="hljs-title function_">emits</span>(<span class="hljs-string">'clickItem'</span>, item),
  <span class="hljs-attr">clickTab</span>: <span class="hljs-function">(<span class="hljs-params">tab: TabsPaneContext, event: Event</span>) =&gt;</span> <span class="hljs-title function_">emits</span>(<span class="hljs-string">'clickTab'</span>, tab, event)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p>ï¼ˆ3ï¼‰ç±»å‹æ–‡ä»¶type.d.ts</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">BadgeProps</span>, <span class="hljs-title class_">AvatarProps</span>, <span class="hljs-title class_">TagProps</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>

<span class="hljs-comment">// æ¶ˆæ¯ç»„ä»¶æ¥å£</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NotificationProps</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">BadgeProps</span>&gt; {
  value?: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>
  icon?: <span class="hljs-built_in">string</span> | <span class="hljs-title class_">IconifyIcon</span>
  iconSize?: <span class="hljs-built_in">number</span>
  iconColor?: <span class="hljs-built_in">string</span>
  size?: <span class="hljs-built_in">number</span>
  color?: <span class="hljs-built_in">string</span>
  scale?: <span class="hljs-built_in">number</span>
}

<span class="hljs-comment">// æ¶ˆæ¯å†…å®¹é¡¹</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MessageListItem</span> {
  avatar?: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">AvatarProps</span>&gt;
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  content?: <span class="hljs-built_in">string</span>
  time?: <span class="hljs-built_in">string</span>
  tagProps?: <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">TagProps</span>&gt;
  tag?: <span class="hljs-built_in">string</span>
}

<span class="hljs-comment">// æ¶ˆæ¯æ“ä½œæŒ‰é’®ï¼Œæ¸…ç©ºå’Œæ›´å¤š</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NoticeActionsItem</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  icon?: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">click</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
}

<span class="hljs-comment">// æ¶ˆæ¯ç±»å‹tabé¡µ</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NoticeMessageListOptions</span> {
  <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>
  content?: <span class="hljs-title class_">MessageListItem</span>[]
}

<span class="hljs-comment">// æ¶ˆæ¯å¼¹çª—ä¼ å…¥æ•°æ®æ¥å£</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NoticeMessageListProps</span> {
  <span class="hljs-attr">lists</span>: <span class="hljs-title class_">NoticeMessageListOptions</span>[]
  <span class="hljs-attr">actions</span>: <span class="hljs-title class_">NoticeActionsItem</span>[]
  wrapClass?: <span class="hljs-built_in">string</span>
}

<span class="hljs-comment">// æ¶ˆæ¯ç»„ä»¶+æ¶ˆæ¯å¼¹çª—ä¼ å…¥æ•°æ®æ¥å£ï¼ŒPartial&lt;T&gt;:å°†Tä¸­å±æ€§å…¨éƒ¨è½¬ä¸ºå¯é€‰å±æ€§ï¼Œç±»ä¼¼ï¼Ÿ</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">NoticeProps</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NoticeMessageListProps</span>, <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">NotificationProps</span>&gt; {}
</code></pre>
<h4 data-id="heading-3">3.ç»„ä»¶çš„ä½¿ç”¨æ–‡ä»¶notice-message.vue</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Notification</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"223333"</span> <span class="hljs-attr">:scale</span>=<span class="hljs-string">"scale"</span> /&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"mt-10"</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"scale = 0.5"</span>&gt;</span>ç¼©å°<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>--------------------------------------------------<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">Notice</span>
    <span class="hljs-attr">value</span>=<span class="hljs-string">"5"</span>
    <span class="hljs-attr">:actions</span>=<span class="hljs-string">"actions"</span>
    <span class="hljs-attr">:lists</span>=<span class="hljs-string">"lists"</span>
    <span class="hljs-attr">wrap-class</span>=<span class="hljs-string">"w-[300px]"</span>
    @<span class="hljs-attr">click-item</span>=<span class="hljs-string">"handleClickItem"</span>
  /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> type { <span class="hljs-title class_">NoticeActionsItem</span>, <span class="hljs-title class_">NoticeMessageListOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/Notice/type'</span>

<span class="hljs-keyword">const</span> scale = <span class="hljs-title function_">ref</span>(<span class="hljs-number">1</span>)

<span class="hljs-keyword">const</span> actions = ref&lt;<span class="hljs-title class_">NoticeActionsItem</span>[]&gt;([
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">'æ¸…ç©º'</span>,
    <span class="hljs-attr">icon</span>: <span class="hljs-string">'ep:delete'</span>,
    <span class="hljs-attr">click</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æŸ¥çœ‹è¯¦æƒ…'</span>)
  },
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">'æ›´å¤š'</span>,
    <span class="hljs-attr">icon</span>: <span class="hljs-string">'ep:more'</span>,
    <span class="hljs-attr">click</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ›´å¤š'</span>)
  }
])

<span class="hljs-keyword">const</span> lists = ref&lt;<span class="hljs-title class_">NoticeMessageListOptions</span>[]&gt;([
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">'é€šçŸ¥'</span>,
    <span class="hljs-attr">content</span>: [
      {
        <span class="hljs-attr">title</span>: <span class="hljs-string">'æ¶ˆæ¯1'</span>,
        <span class="hljs-attr">time</span>: <span class="hljs-string">'2025-11-01 11:11:11'</span>,
        <span class="hljs-attr">avatar</span>: { <span class="hljs-attr">src</span>: <span class="hljs-string">'https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png'</span> },
        <span class="hljs-attr">content</span>: <span class="hljs-string">'æ¶ˆæ¯å†…å®¹1'</span>,
        <span class="hljs-attr">tagProps</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">'danger'</span> },
        <span class="hljs-attr">tag</span>: <span class="hljs-string">'ç´§æ€¥'</span>
      },
      {
        <span class="hljs-attr">title</span>: <span class="hljs-string">'æ¶ˆæ¯1'</span>,
        <span class="hljs-attr">time</span>: <span class="hljs-string">'2025-11-02 11:11:11'</span>,
        <span class="hljs-attr">avatar</span>: { <span class="hljs-attr">src</span>: <span class="hljs-string">'https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png'</span> },
        <span class="hljs-attr">content</span>: <span class="hljs-string">'æ¶ˆæ¯å†…å®¹1'</span>
      },
      {
        <span class="hljs-attr">title</span>: <span class="hljs-string">'æ¶ˆæ¯1'</span>,
        <span class="hljs-attr">time</span>: <span class="hljs-string">'2025-11-03 11:11:11'</span>,
        <span class="hljs-attr">avatar</span>: { <span class="hljs-attr">src</span>: <span class="hljs-string">'https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png'</span> },
        <span class="hljs-attr">content</span>: <span class="hljs-string">'æ¶ˆæ¯å†…å®¹1'</span>
      }
    ]
  },
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">'ä»£åŠ'</span>,
    <span class="hljs-attr">content</span>: [
      {
        <span class="hljs-attr">title</span>: <span class="hljs-string">'æ¶ˆæ¯2'</span>,
        <span class="hljs-attr">time</span>: <span class="hljs-string">'2025-12-01 11:11:11'</span>,
        <span class="hljs-attr">avatar</span>: { <span class="hljs-attr">src</span>: <span class="hljs-string">'https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png'</span> },
        <span class="hljs-attr">content</span>: <span class="hljs-string">'æ¶ˆæ¯å†…å®¹2'</span>
      }
    ]
  },
  {
    <span class="hljs-attr">title</span>: <span class="hljs-string">'å…³æ³¨'</span>,
    <span class="hljs-attr">content</span>: [
      {
        <span class="hljs-attr">title</span>: <span class="hljs-string">'æ¶ˆæ¯3'</span>,
        <span class="hljs-attr">time</span>: <span class="hljs-string">'2025-12-01 11:11:11'</span>,
        <span class="hljs-attr">avatar</span>: { <span class="hljs-attr">src</span>: <span class="hljs-string">'https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png'</span> },
        <span class="hljs-attr">content</span>: <span class="hljs-string">'æ¶ˆæ¯å†…å®¹3'</span>
      }
    ]
  }
])

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClickItem</span> = (<span class="hljs-params">item: any</span>) =&gt; {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ğŸš€ ~ handleClickItem ~ item:'</span>, item)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Profilerå®æˆ˜å®å…¸ï¼šæªå‡ºCPUè€—æ—¶å…ƒå‡¶ä¸å†…å­˜æ³„éœ²å°å·]]></title>    <link>https://juejin.cn/post/7591416714694344714</link>    <guid>https://juejin.cn/post/7591416714694344714</guid>    <pubDate>2026-01-05T01:17:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591416714694344714" data-draft-id="7591207451778236442" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Profilerå®æˆ˜å®å…¸ï¼šæªå‡ºCPUè€—æ—¶å…ƒå‡¶ä¸å†…å­˜æ³„éœ²å°å·"/> <meta itemprop="keywords" content="é¢è¯•,æ€§èƒ½ä¼˜åŒ–,Android"/> <meta itemprop="datePublished" content="2026-01-05T01:17:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¡¾æ—æµ·"/> <meta itemprop="url" content="https://juejin.cn/user/2365804752153911"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Profilerå®æˆ˜å®å…¸ï¼šæªå‡ºCPUè€—æ—¶å…ƒå‡¶ä¸å†…å­˜æ³„éœ²å°å·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2365804752153911/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¡¾æ—æµ·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T01:17:45.000Z" title="Mon Jan 05 2026 01:17:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»17åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä½œä¸ºAndroidå¼€å‘è€…ï¼Œæˆ‘ä»¬æ€»èƒ½é‡åˆ°è¿™æ ·çš„â€œçµé­‚æ‹·é—®â€ï¼š</p>
<ul>
<li>â€œAPPé¦–é¡µæ€ä¹ˆæ»‘ç€å°±å¡äº†ï¼Ÿâ€</li>
<li>â€œä¸ºä»€ä¹ˆç”¨äº†å‡ åˆ†é’Ÿå°±æŠ¥å†…å­˜æº¢å‡ºï¼Ÿâ€</li>
<li>â€œæ˜æ˜ä»£ç æ²¡æ”¹å¤šå°‘ï¼Œæ€ä¹ˆæ€§èƒ½å·®äº†è¿™ä¹ˆå¤šï¼Ÿâ€</li>
</ul>
<p>è¿™æ—¶å€™ï¼ŒAndroid Studioè‡ªå¸¦çš„â€œæ€§èƒ½ä¾¦æ¢ç¥å™¨â€â€”â€”Android Profilerï¼Œå°±å¾—é—ªäº®ç™»åœºäº†ã€‚å®ƒå°±åƒç»™APPè£…äº†ä¸€å¥—â€œä½“æ£€è®¾å¤‡â€ï¼Œèƒ½å®æ—¶ç›‘æ§CPUã€å†…å­˜ã€ç½‘ç»œã€ç”µé‡çš„çŠ¶æ€ï¼Œå¸®æˆ‘ä»¬ç²¾å‡†å®šä½æ€§èƒ½é—®é¢˜ã€‚</p>
<p>ä»Šå¤©å’±ä»¬å°±èšç„¦ä¸¤å¤§æ ¸å¿ƒç—›ç‚¹ï¼š<strong>CPUè€—æ—¶æ’æŸ¥</strong>å’Œ<strong>å†…å­˜æ³„éœ²å®šä½</strong>ï¼Œä»åŸºç¡€æ“ä½œåˆ°æ·±åº¦å®æˆ˜ï¼ŒæŠŠè¿™ä¸ªç¥å™¨çš„ç”¨æ³•æ‰’å¾—æ˜æ˜ç™½ç™½ï¼Œè¿˜é™„ä¸Šä»£ç è®²è§£å’Œæµç¨‹å›¾ï¼Œæ–°æ‰‹ä¹Ÿèƒ½è½»æ¾ä¸Šæ‰‹ï½</p>
<h2 data-id="heading-1">ä¸€ã€å…ˆææ‡‚ï¼šAndroid ProfileråŸºç¡€è®¤çŸ¥</h2>
<p>åœ¨å¼€å§‹æ’æŸ¥é—®é¢˜å‰ï¼Œå’±ä»¬å¾—å…ˆçŸ¥é“è¿™ä¸ªâ€œç¥å™¨â€æ€ä¹ˆå¯åŠ¨ã€å„ä¸ªéƒ¨åˆ†æ˜¯å¹²å˜›çš„ã€‚æ¯•ç«Ÿå·¥å…·éƒ½ä¸è®¤è¯†ï¼Œè°ˆä½•ç ´æ¡ˆï¼Ÿ</p>
<h3 data-id="heading-2">1.1 å¯åŠ¨Android Profiler</h3>
<p>æ­¥éª¤è¶…ç®€å•ï¼Œå°±3æ­¥ï¼š</p>
<ol>
<li>æ‰“å¼€Android Studioï¼Œè¿æ¥çœŸå®è®¾å¤‡æˆ–å¯åŠ¨æ¨¡æ‹Ÿå™¨ï¼ˆå»ºè®®ç”¨çœŸå®è®¾å¤‡ï¼Œæ¨¡æ‹Ÿå™¨æ€§èƒ½æ³¢åŠ¨å¤§ï¼Œå®¹æ˜“è¯¯åˆ¤ï¼‰ï¼›</li>
<li>è¿è¡Œä½ çš„APPï¼ˆç‚¹å‡»ç»¿è‰²è¿è¡ŒæŒ‰é’®ï¼Œæˆ–Shift+F10ï¼‰ï¼›</li>
<li>æ‰“å¼€Profileré¢æ¿ï¼šé¡¶éƒ¨èœå•æ View â†’ Tool Windows â†’ Profilerï¼Œæˆ–ç›´æ¥ç‚¹å‡»åº•éƒ¨çš„Profilerå›¾æ ‡ï¼ˆé•¿å¾—åƒå¿ƒç”µå›¾çš„é‚£ä¸ªï¼‰ã€‚</li>
</ol>
<p>å¯åŠ¨åï¼Œä½ ä¼šçœ‹åˆ°è¿™æ ·çš„ç•Œé¢ï¼šå·¦ä¾§æ˜¯ä¼šè¯åˆ—è¡¨ï¼ˆæ˜¾ç¤ºå½“å‰è¿æ¥çš„è®¾å¤‡å’Œè¿è¡Œçš„APPè¿›ç¨‹ï¼‰ï¼Œå³ä¾§æ˜¯ç›‘æ§é¢æ¿ï¼ˆé»˜è®¤æ˜¾ç¤ºCPUã€å†…å­˜ã€ç½‘ç»œã€ç”µé‡çš„å®æ—¶æ›²çº¿ï¼‰ã€‚å’±ä»¬é‡ç‚¹å…³æ³¨CPUå’ŒMemoryä¸¤ä¸ªé¢æ¿ã€‚</p>
<h3 data-id="heading-3">1.2 æ ¸å¿ƒæ¦‚å¿µï¼šä¸ºä»€ä¹ˆèƒ½ç›‘æ§åˆ°æ€§èƒ½é—®é¢˜ï¼Ÿ</h3>
<p>ç®€å•è¯´ï¼ŒAndroid Profileræ˜¯é€šè¿‡ä¸è®¾å¤‡çš„ARTè™šæ‹Ÿæœºäº¤äº’ï¼Œé‡‡é›†è¿›ç¨‹çš„è¿è¡Œæ•°æ®ï¼ˆæ¯”å¦‚çº¿ç¨‹çŠ¶æ€ã€å†…å­˜åˆ†é…ã€å‡½æ•°è°ƒç”¨è€—æ—¶ç­‰ï¼‰ï¼Œç„¶åé€šè¿‡å¯è§†åŒ–çš„æ–¹å¼å±•ç¤ºç»™æˆ‘ä»¬ã€‚å°±åƒåŒ»ç”Ÿç»™ç—…äººæµ‹å¿ƒç”µå›¾ã€è¡€å‹ï¼Œé€šè¿‡æ•°æ®æ³¢åŠ¨åˆ¤æ–­èº«ä½“çŠ¶å†µï¼Œæˆ‘ä»¬é€šè¿‡Profilerçš„æ›²çº¿æ³¢åŠ¨å’Œè¯¦ç»†æ•°æ®ï¼Œåˆ¤æ–­APPçš„æ€§èƒ½é—®é¢˜ã€‚</p>
<blockquote>
<p>å°æé†’ï¼šè°ƒè¯•æ¨¡å¼ä¸‹çš„APPæ€§èƒ½ä¼šæœ‰è½»å¾®æŸè€—ï¼Œå»ºè®®æ’æŸ¥æ—¶å°½é‡å…³é—­ä¸å¿…è¦çš„è°ƒè¯•åŠŸèƒ½ï¼ˆæ¯”å¦‚Logè¿‡å¤šã€æ–­ç‚¹æ®‹ç•™ï¼‰ï¼Œé¿å…å½±å“åˆ¤æ–­ã€‚</p>
</blockquote>
<h2 data-id="heading-4">äºŒã€CPUè€—æ—¶æ’æŸ¥ï¼šæ‰¾å‡ºâ€œå¡å¸§â€çš„å…ƒå‡¶</h2>
<p>APPå¡é¡¿ï¼Œå¤§æ¦‚ç‡æ˜¯CPUâ€œå¿™ä¸è¿‡æ¥â€äº†ã€‚Androidç³»ç»Ÿè¦æ±‚UIçº¿ç¨‹æ¯16mså®Œæˆä¸€æ¬¡ç»˜åˆ¶ï¼ˆå¯¹åº”60fpsçš„åˆ·æ–°ç‡ï¼‰ï¼Œå¦‚æœæŸä¸ªæ“ä½œè€—æ—¶è¶…è¿‡16msï¼Œå°±ä¼šå‡ºç°æ‰å¸§ã€å¡é¡¿ã€‚å’±ä»¬çš„ç›®æ ‡å°±æ˜¯ç”¨Profileræ‰¾åˆ°è¿™ä¸ªâ€œè€—æ—¶å¤§æˆ·â€ã€‚</p>
<h3 data-id="heading-5">2.1 æ’æŸ¥æµç¨‹æ€»è§ˆï¼ˆæµç¨‹å›¾è§£è¯»ï¼‰</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00aea8b3e18d4c3cad70d90262496035~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aG-5p6X5rW3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768180872&amp;x-signature=ozy2UB%2FWHIk0QoXgGRnc%2FsA%2Fyaw%3D" alt="01.jpeg" loading="lazy"/></p>
<h3 data-id="heading-6">2.2 å…³é”®æ­¥éª¤ï¼šCPUé¢æ¿æ“ä½œè¯¦è§£</h3>
<p>å’±ä»¬ä¸€æ­¥æ­¥æ‹†è§£æ¯ä¸ªç¯èŠ‚çš„æ“ä½œå’Œæ³¨æ„äº‹é¡¹ï¼Œé‡ç‚¹å…³æ³¨â€œé‡‡é›†æ¨¡å¼é€‰æ‹©â€å’Œâ€œæŠ¥å‘Šåˆ†æâ€è¿™ä¸¤ä¸ªæ ¸å¿ƒæ­¥éª¤ã€‚</p>
<h4 data-id="heading-7">2.2.1 ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©é‡‡é›†æ¨¡å¼ï¼ˆå…³é”®ï¼é€‰å¯¹æ¨¡å¼å°‘èµ°å¼¯è·¯ï¼‰</h4>
<p>CPUé¢æ¿é»˜è®¤æ˜¯â€œReal-Timeâ€å®æ—¶ç›‘æ§æ¨¡å¼ï¼ˆæ˜¾ç¤ºCPUä½¿ç”¨ç‡æ›²çº¿ï¼‰ï¼Œä½†è¦å®šä½å…·ä½“è€—æ—¶å‡½æ•°ï¼Œéœ€è¦åˆ‡æ¢åˆ°â€œRecordâ€å½•åˆ¶æ¨¡å¼ã€‚Profileræä¾›äº†4ç§å½•åˆ¶æ¨¡å¼ï¼Œå„æœ‰é€‚ç”¨åœºæ™¯ï¼Œå’±ä»¬ç”¨è¡¨æ ¼è®²æ¸…æ¥šï¼š</p>








































<table><thead><tr><th>é‡‡é›†æ¨¡å¼</th><th>æ ¸å¿ƒåŸç†</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>Sample Java Methodsï¼ˆé‡‡æ ·Javaæ–¹æ³•ï¼‰</td><td>å®šæœŸé‡‡æ ·çº¿ç¨‹çš„Javaå‡½æ•°è°ƒç”¨æ ˆï¼Œä¸è¿½è¸ªæ¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨</td><td>æ€§èƒ½æŸè€—å°ï¼Œä¸å½±å“APPè¿è¡Œ</td><td>å¯èƒ½é—æ¼çŸ­è€—æ—¶å‡½æ•°ï¼Œç²¾åº¦è¾ƒä½</td><td>å¿«é€Ÿå®šä½å¤§è‡´çš„è€—æ—¶å‡½æ•°ï¼ˆåˆæ­¥æ’æŸ¥ï¼‰</td></tr><tr><td>Trace Java Methodsï¼ˆè¿½è¸ªJavaæ–¹æ³•ï¼‰</td><td>è®°å½•æ¯ä¸€ä¸ªJavaå‡½æ•°çš„è¿›å…¥å’Œé€€å‡ºæ—¶é—´ï¼Œç²¾å‡†è®¡ç®—è€—æ—¶</td><td>ç²¾åº¦é«˜ï¼Œèƒ½å®Œæ•´å±•ç¤ºå‡½æ•°è°ƒç”¨é“¾</td><td>æ€§èƒ½æŸè€—å¤§ï¼Œå¯èƒ½è®©APPå˜æ…¢</td><td>ç²¾å‡†å®šä½å…·ä½“è€—æ—¶å‡½æ•°ï¼ˆæ·±åº¦æ’æŸ¥ï¼‰</td></tr><tr><td>Trace C/C++ Functionsï¼ˆè¿½è¸ªC/C++å‡½æ•°ï¼‰</td><td>è®°å½•Nativeå±‚çš„C/C++å‡½æ•°è°ƒç”¨</td><td>æ”¯æŒNativeå±‚æ€§èƒ½æ’æŸ¥</td><td>éœ€è¦é…ç½®NDKï¼Œæ“ä½œå¤æ‚</td><td>æ’æŸ¥JNI/NDKç›¸å…³çš„è€—æ—¶é—®é¢˜</td></tr><tr><td>Sample Native Methodsï¼ˆé‡‡æ ·Nativeæ–¹æ³•ï¼‰</td><td>å®šæœŸé‡‡æ ·Nativeå±‚å‡½æ•°è°ƒç”¨æ ˆ</td><td>Nativeå±‚åˆæ­¥æ’æŸ¥ï¼Œæ€§èƒ½æŸè€—å°</td><td>ç²¾åº¦ä½ï¼Œä¸é€‚åˆç²¾å‡†å®šä½</td><td>å¿«é€Ÿåˆ¤æ–­Nativeå±‚æ˜¯å¦å­˜åœ¨è€—æ—¶é—®é¢˜</td></tr></tbody></table>
<blockquote>
<p>æ–°æ‰‹å»ºè®®ï¼šå…ˆä»ã€ŒSample Java Methodsã€å¼€å§‹ï¼Œå¿«é€Ÿç¼©å°æ’æŸ¥èŒƒå›´ï¼›å¦‚æœæ‰¾ä¸åˆ°é—®é¢˜ï¼Œå†ç”¨ã€ŒTrace Java Methodsã€ç²¾å‡†å®šä½ã€‚é™¤éæ¶‰åŠNDKå¼€å‘ï¼Œå¦åˆ™ä¸ç”¨å…³æ³¨åä¸¤ç§Nativeæ¨¡å¼ã€‚</p>
</blockquote>
<h4 data-id="heading-8">2.2.2 ç¬¬äºŒæ­¥ï¼šå½•åˆ¶å¹¶å¤ç°å¡é¡¿åœºæ™¯</h4>
<p>æ“ä½œæ­¥éª¤ï¼š</p>
<ol>
<li>åœ¨CPUé¢æ¿é¡¶éƒ¨ï¼Œç‚¹å‡»â€œRecordâ€æŒ‰é’®ï¼ˆçº¢è‰²åœ†ç‚¹ï¼‰ï¼Œé€‰æ‹©å¯¹åº”çš„é‡‡é›†æ¨¡å¼ï¼ˆæ¯”å¦‚Sample Java Methodsï¼‰ï¼›</li>
<li>ç«‹åˆ»åœ¨APPä¸Šå¤ç°å¡é¡¿åœºæ™¯ï¼ˆæ¯”å¦‚æ»‘åŠ¨é¦–é¡µåˆ—è¡¨ã€ç‚¹å‡»æŸä¸ªæŒ‰é’®ï¼‰ï¼›</li>
<li>å¡é¡¿ç°è±¡å‡ºç°åï¼Œå†æ¬¡ç‚¹å‡»â€œStopâ€æŒ‰é’®ï¼ˆçº¢è‰²æ–¹å—ï¼‰ï¼Œåœæ­¢å½•åˆ¶ï¼ŒProfilerä¼šè‡ªåŠ¨ç”ŸæˆCPUåˆ†ææŠ¥å‘Šã€‚</li>
</ol>
<p>å°æŠ€å·§ï¼šå½•åˆ¶æ—¶é—´ä¸è¦å¤ªé•¿ï¼ˆå»ºè®®3-5ç§’ï¼‰ï¼Œå¦åˆ™ç”Ÿæˆçš„æŠ¥å‘Šæ•°æ®é‡å¤ªå¤§ï¼Œä¸æ˜“åˆ†æã€‚å°½é‡åªå½•åˆ¶å¡é¡¿å‘ç”Ÿçš„æ—¶é—´æ®µã€‚</p>
<h4 data-id="heading-9">2.2.3 ç¬¬ä¸‰æ­¥ï¼šåˆ†æCPUæŠ¥å‘Šï¼Œå®šä½è€—æ—¶å‡½æ•°</h4>
<p>è¿™æ˜¯æœ€æ ¸å¿ƒçš„ä¸€æ­¥ï¼ç”Ÿæˆçš„æŠ¥å‘ŠåŒ…å«3ä¸ªæ ¸å¿ƒè§†å›¾ï¼Œå’±ä»¬é€ä¸ªè§£è¯»ï¼š</p>
<h5 data-id="heading-10">1. æ—¶é—´è½´è§†å›¾ï¼ˆTimelineï¼‰</h5>
<p>é¡¶éƒ¨çš„æ—¶é—´è½´æ˜¾ç¤ºäº†å½•åˆ¶æœŸé—´çš„CPUä½¿ç”¨ç‡æ›²çº¿å’Œçº¿ç¨‹æ´»åŠ¨çŠ¶æ€ã€‚é‡ç‚¹å…³æ³¨ï¼š</p>
<ul>
<li>CPUä½¿ç”¨ç‡å³°å€¼ï¼šå¦‚æœæŸæ®µæ—¶é—´ä½¿ç”¨ç‡æ¥è¿‘100%ï¼Œå¤§æ¦‚ç‡æ˜¯å¡é¡¿å‘ç”Ÿçš„æ—¶é—´æ®µï¼›</li>
<li>UIçº¿ç¨‹çŠ¶æ€ï¼šUIçº¿ç¨‹ï¼ˆé€šå¸¸æ˜¯â€œmainâ€çº¿ç¨‹ï¼‰å¦‚æœé•¿æ—¶é—´å¤„äºâ€œRunningâ€çŠ¶æ€ï¼ˆçº¢è‰²æ¡ï¼‰ï¼Œè€Œä¸æ˜¯â€œRunnableâ€ï¼ˆç»¿è‰²ï¼‰æˆ–â€œSleepingâ€ï¼ˆè“è‰²ï¼‰ï¼Œè¯´æ˜UIçº¿ç¨‹è¢«é˜»å¡äº†ã€‚</li>
</ul>
<h5 data-id="heading-11">2. çº¿ç¨‹åˆ—è¡¨è§†å›¾ï¼ˆThreadsï¼‰</h5>
<p>ä¸­é—´éƒ¨åˆ†æ˜¾ç¤ºäº†APPè¿›ç¨‹çš„æ‰€æœ‰çº¿ç¨‹ï¼Œé»˜è®¤æŒ‰CPUä½¿ç”¨ç‡æ’åºï¼ˆä½¿ç”¨ç‡é«˜çš„çº¿ç¨‹æ’åœ¨å‰é¢ï¼‰ã€‚é‡ç‚¹å…³æ³¨ï¼š</p>
<ul>
<li>mainçº¿ç¨‹ï¼šUIç›¸å…³çš„å¡é¡¿å‡ ä¹éƒ½å’Œå®ƒæœ‰å…³ï¼Œä¼˜å…ˆæŸ¥çœ‹ï¼›</li>
<li>è‡ªå®šä¹‰çº¿ç¨‹ï¼šå¦‚æœæœ‰åå°çº¿ç¨‹CPUä½¿ç”¨ç‡å¼‚å¸¸é«˜ï¼Œä¹Ÿè¦é‡ç‚¹å…³æ³¨ï¼ˆå¯èƒ½æ˜¯åå°ä»»åŠ¡è€—æ—¶è¿‡é•¿ï¼ŒæŠ¢å äº†UIçº¿ç¨‹èµ„æºï¼‰ã€‚</li>
</ul>
<h5 data-id="heading-12">3. å‡½æ•°è°ƒç”¨è§†å›¾ï¼ˆCall Chart/Flame Chart/Top Down/Bottom Upï¼‰</h5>
<p>è¿™æ˜¯å®šä½å…·ä½“è€—æ—¶å‡½æ•°çš„å…³é”®ï¼Œ4ç§è§†å›¾å„æœ‰ä¾§é‡ï¼Œå’±ä»¬ç”¨é€šä¿—çš„è¯­è¨€è§£é‡Šï¼š</p>
<ul>
<li><strong>Call Chartï¼ˆè°ƒç”¨å›¾ï¼‰</strong> ï¼šæŒ‰æ—¶é—´é¡ºåºå±•ç¤ºå‡½æ•°è°ƒç”¨å…³ç³»ï¼Œçˆ¶å‡½æ•°åœ¨ä¸Šæ–¹ï¼Œå­å‡½æ•°åœ¨ä¸‹æ–¹ï¼Œå‡½æ•°å—çš„é•¿åº¦ä»£è¡¨è€—æ—¶ã€‚èƒ½ç›´è§‚çœ‹åˆ°â€œå“ªä¸ªå‡½æ•°åœ¨ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨ï¼Œè€—æ—¶å¤šä¹…â€ã€‚</li>
<li><strong>Flame Chartï¼ˆç«ç„°å›¾ï¼‰</strong> ï¼šæŠŠç›¸åŒè°ƒç”¨é“¾çš„å‡½æ•°åˆå¹¶æˆä¸€ä¸ªâ€œç«ç„°å—â€ï¼Œé«˜åº¦ä»£è¡¨è€—æ—¶ã€‚ä¼˜ç‚¹æ˜¯èƒ½å¿«é€Ÿæ‰¾åˆ°â€œè€—æ—¶æœ€é•¿çš„è°ƒç”¨é“¾â€ï¼Œæ¯”å¦‚ä¸€ä¸ªå¤§çš„ç«ç„°å—ï¼Œå¤§æ¦‚ç‡æ˜¯æ ¸å¿ƒè€—æ—¶å‡½æ•°ã€‚</li>
<li><strong>Top Downï¼ˆè‡ªä¸Šè€Œä¸‹ï¼‰</strong> ï¼šä»é¡¶å±‚å‡½æ•°ï¼ˆæ¯”å¦‚mainå‡½æ•°ï¼‰å¼€å§‹ï¼Œé€çº§å±•å¼€å­å‡½æ•°ï¼Œæ˜¾ç¤ºæ¯ä¸ªå‡½æ•°çš„æ€»è€—æ—¶ï¼ˆåŒ…å«å­å‡½æ•°è€—æ—¶ï¼‰å’Œè‡ªæˆ‘è€—æ—¶ï¼ˆä»…å‡½æ•°æœ¬èº«ä»£ç è€—æ—¶ï¼‰ã€‚é€‚åˆè¿½è¸ªâ€œå‡½æ•°çš„è°ƒç”¨è·¯å¾„â€ã€‚</li>
<li><strong>Bottom Upï¼ˆè‡ªä¸‹è€Œä¸Šï¼‰</strong> ï¼šä»æœ€åº•å±‚çš„å­å‡½æ•°å¼€å§‹ï¼Œé€çº§å‘ä¸Šå±•ç¤ºè°ƒç”¨å®ƒçš„çˆ¶å‡½æ•°ï¼ŒæŒ‰è‡ªæˆ‘è€—æ—¶æ’åºã€‚é€‚åˆå¿«é€Ÿæ‰¾åˆ°â€œæœ¬èº«è€—æ—¶æœ€é•¿çš„å‡½æ•°â€ï¼ˆä¸ç®¡è°ƒç”¨è·¯å¾„ï¼‰ã€‚</li>
</ul>
<blockquote>
<p>æ–°æ‰‹å¿…çœ‹ï¼šä¼˜å…ˆç”¨ã€ŒBottom Upã€è§†å›¾ï¼ŒæŒ‰â€œSelf Timeâ€ï¼ˆè‡ªæˆ‘è€—æ—¶ï¼‰æ’åºï¼Œæ’åœ¨å‰é¢çš„å‡½æ•°å°±æ˜¯â€œè€—æ—¶å¤§æˆ·â€ï¼›å†ç”¨ã€ŒTop Downã€è§†å›¾æŸ¥çœ‹è¿™ä¸ªå‡½æ•°çš„è°ƒç”¨è·¯å¾„ï¼Œææ¸…æ¥šæ˜¯å“ªä¸ªåœ°æ–¹è°ƒç”¨äº†å®ƒã€‚</p>
</blockquote>
<h3 data-id="heading-13">2.3 å®æˆ˜æ¡ˆä¾‹ï¼šæ’æŸ¥åˆ—è¡¨æ»‘åŠ¨å¡é¡¿é—®é¢˜</h3>
<p>å…‰è¯´ç†è®ºå¤ªæ¯ç‡¥ï¼Œå’±ä»¬ç”¨ä¸€ä¸ªçœŸå®çš„æ¡ˆä¾‹æ¥æ¼”ç¤ºï¼šAPPé¦–é¡µåˆ—è¡¨æ»‘åŠ¨å¡é¡¿ï¼Œç”¨Profileræ‰¾å‡ºé—®é¢˜å¹¶è§£å†³ã€‚</p>
<h4 data-id="heading-14">2.3.1 é—®é¢˜åœºæ™¯</h4>
<p>é¦–é¡µæ˜¯ä¸€ä¸ªRecyclerViewåˆ—è¡¨ï¼Œæ»‘åŠ¨æ—¶æ˜æ˜¾æ‰å¸§ï¼Œå°¤å…¶æ˜¯åˆ—è¡¨é¡¹è¾ƒå¤šçš„æ—¶å€™ã€‚</p>
<h4 data-id="heading-15">2.3.2 æ’æŸ¥è¿‡ç¨‹</h4>
<ol>
<li>
<p>å¯åŠ¨APPå’ŒProfilerï¼Œé€‰æ‹©CPUé¢æ¿ï¼Œç‚¹å‡»Recordï¼Œé€‰æ‹©ã€ŒSample Java Methodsã€æ¨¡å¼ï¼›</p>
</li>
<li>
<p>åœ¨APPä¸Šå¿«é€Ÿæ»‘åŠ¨é¦–é¡µåˆ—è¡¨3ç§’ï¼Œç„¶åç‚¹å‡»Stopåœæ­¢å½•åˆ¶ï¼›</p>
</li>
<li>
<p>æŸ¥çœ‹CPUæŠ¥å‘Šï¼š</p>
<ol>
<li>æ—¶é—´è½´ï¼šå‘ç°æ»‘åŠ¨æœŸé—´CPUä½¿ç”¨ç‡é«˜è¾¾90%+ï¼Œmainçº¿ç¨‹é•¿æ—¶é—´å¤„äºRunningçŠ¶æ€ï¼›</li>
<li>çº¿ç¨‹åˆ—è¡¨ï¼šmainçº¿ç¨‹CPUä½¿ç”¨ç‡æœ€é«˜ï¼Œä¼˜å…ˆæŸ¥çœ‹ï¼›</li>
<li>Bottom Upè§†å›¾ï¼šæŒ‰Self Timeæ’åºï¼Œå‘ç°ä¸€ä¸ªå«ã€ŒonBindViewHolderã€çš„å‡½æ•°è€—æ—¶ç‰¹åˆ«é•¿ï¼ˆè‡ªæˆ‘è€—æ—¶200ms+ï¼‰ã€‚</li>
</ol>
</li>
<li>
<p>æŸ¥çœ‹ã€ŒonBindViewHolderã€çš„è°ƒç”¨è·¯å¾„ï¼ˆTop Downè§†å›¾ï¼‰ï¼šå‘ç°æ˜¯RecyclerViewæ»‘åŠ¨æ—¶å¤ç”¨åˆ—è¡¨é¡¹ï¼Œé¢‘ç¹è°ƒç”¨è¯¥æ–¹æ³•ï¼›</p>
</li>
<li>
<p>ç‚¹å‡»å‡½æ•°åï¼Œè·³è½¬åˆ°å¯¹åº”çš„ä»£ç ï¼ˆProfileræ”¯æŒç›´æ¥è·³è½¬ä»£ç ï¼Œè¶…æ–¹ä¾¿ï¼ï¼‰ï¼Œçœ‹åˆ°ä»¥ä¸‹é—®é¢˜ä»£ç ï¼š</p>
</li>
</ol>
<h4 data-id="heading-16">2.3.3 é—®é¢˜ä»£ç è§£æ</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MyViewHolder holder, <span class="hljs-type">int</span> position)</span> {
        <span class="hljs-comment">// é—®é¢˜1ï¼šåœ¨UIçº¿ç¨‹åŠ è½½å›¾ç‰‡ï¼ˆç½‘ç»œå›¾ç‰‡ï¼Œæœªä½¿ç”¨ç¼“å­˜ï¼‰</span>
        Glide.with(mContext)
             .load(dataList.get(position).getImgUrl())
             .into(holder.ivImg);
        
        <span class="hljs-comment">// é—®é¢˜2ï¼šåœ¨UIçº¿ç¨‹è¿›è¡Œå¤æ‚è®¡ç®—ï¼ˆæ ¼å¼åŒ–æ—¶é—´ï¼Œå¾ªç¯å¤„ç†å­—ç¬¦ä¸²ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> formatComplexTime(dataList.get(position).getTimeStamp());
        holder.tvTime.setText(time);
        
        <span class="hljs-comment">// é—®é¢˜3ï¼šé¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼ˆæ¯æ¬¡ç»‘å®šéƒ½newä¸€ä¸ªClickListenerï¼‰</span>
        holder.btnClick.setOnClickListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> {
                <span class="hljs-comment">// ç‚¹å‡»é€»è¾‘</span>
            }
        });
    }
</code></pre>
<p>é—®é¢˜åˆ†æï¼š</p>
<ul>
<li>UIçº¿ç¨‹åŠ è½½ç½‘ç»œå›¾ç‰‡ï¼šGlideé»˜è®¤æ˜¯å¼‚æ­¥åŠ è½½ï¼Œä½†å¦‚æœæœªé…ç½®ç¼“å­˜ï¼Œæ¯æ¬¡æ»‘åŠ¨éƒ½ä¼šé‡æ–°è¯·æ±‚ç½‘ç»œï¼ŒUIçº¿ç¨‹éœ€è¦ç­‰å¾…å›¾ç‰‡åŠ è½½å›è°ƒï¼Œå¯¼è‡´é˜»å¡ï¼›</li>
<li>UIçº¿ç¨‹å¤æ‚è®¡ç®—ï¼šformatComplexTimeæ–¹æ³•é‡Œæœ‰å¾ªç¯å¤„ç†å­—ç¬¦ä¸²çš„é€»è¾‘ï¼Œè€—æ—¶è¾ƒé•¿ï¼Œè¶…è¿‡16mså°±ä¼šå¡é¡¿ï¼›</li>
<li>é¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼šæ¯æ¬¡ç»‘å®šéƒ½newä¸€ä¸ªClickListenerï¼Œä¼šå¢åŠ GCå‹åŠ›ï¼Œé—´æ¥å½±å“æ€§èƒ½ã€‚</li>
</ul>
<h4 data-id="heading-17">2.3.4 ä¼˜åŒ–æ–¹æ¡ˆä¸ä»£ç ä¿®å¤</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> MyViewHolder holder, <span class="hljs-type">int</span> position)</span> {
        <span class="hljs-comment">// ä¼˜åŒ–1ï¼šGlideé…ç½®ç¼“å­˜ï¼Œé¿å…é‡å¤è¯·æ±‚</span>
        Glide.with(mContext)
             .load(dataList.get(position).getImgUrl())
             .diskCacheStrategy(DiskCacheStrategy.ALL) <span class="hljs-comment">// å¼€å¯ç£ç›˜ç¼“å­˜</span>
             .memoryCacheStrategy(MemoryCacheStrategy.ALL) <span class="hljs-comment">// å¼€å¯å†…å­˜ç¼“å­˜</span>
             .into(holder.ivImg);
        
        <span class="hljs-comment">// ä¼˜åŒ–2ï¼šå¤æ‚è®¡ç®—ç§»åˆ°å­çº¿ç¨‹ï¼Œç”¨AsyncTaskæˆ–Coroutineï¼ˆè¿™é‡Œç”¨Coroutineï¼‰</span>
        CoroutineScope(Dispatchers.IO).launch {
            <span class="hljs-type">String</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> formatComplexTime(dataList.get(position).getTimeStamp());
            <span class="hljs-comment">// åˆ‡æ¢å›ä¸»çº¿ç¨‹æ›´æ–°UI</span>
            withContext(Dispatchers.Main) {
                <span class="hljs-keyword">if</span> (holder.getBindingAdapterPosition() == position) { <span class="hljs-comment">// é¿å…åˆ—è¡¨é¡¹å¤ç”¨å¯¼è‡´çš„é”™ä½</span>
                    holder.tvTime.setText(time);
                }
            }
        };
        
        <span class="hljs-comment">// ä¼˜åŒ–3ï¼šå¤ç”¨ClickListenerï¼ˆåœ¨ViewHolderä¸­åˆå§‹åŒ–ä¸€æ¬¡ï¼‰</span>
        holder.btnClick.setOnClickListener(mOnClickListener);
    }

    <span class="hljs-comment">// å…¨å±€å¤ç”¨çš„ClickListener</span>
    <span class="hljs-keyword">private</span> View.<span class="hljs-type">OnClickListener</span> <span class="hljs-variable">mOnClickListener</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">View</span>.OnClickListener() {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> {
            <span class="hljs-comment">// ç‚¹å‡»é€»è¾‘</span>
        }
    };
</code></pre>
<p>ä¼˜åŒ–åéªŒè¯ï¼šé‡æ–°ç”¨Profilerå½•åˆ¶æ»‘åŠ¨åœºæ™¯ï¼Œå‘ç°CPUä½¿ç”¨ç‡é™åˆ°30%ä»¥ä¸‹ï¼Œmainçº¿ç¨‹ä¸å†é•¿æ—¶é—´é˜»å¡ï¼Œæ»‘åŠ¨æµç•…æ— å¡é¡¿ã€‚</p>
<h3 data-id="heading-18">2.4 å¸¸è§CPUè€—æ—¶é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆæ±‡æ€»</h3>






























<table><thead><tr><th>å¸¸è§è€—æ—¶åœºæ™¯</th><th>æ’æŸ¥è¦ç‚¹</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>UIçº¿ç¨‹åšç½‘ç»œè¯·æ±‚</td><td>mainçº¿ç¨‹ä¸­å­˜åœ¨HttpClient/OkHttpåŒæ­¥è°ƒç”¨</td><td>æ”¹ç”¨å¼‚æ­¥è¯·æ±‚ï¼ˆOkHttpå¼‚æ­¥å›è°ƒã€Coroutineã€RxJavaï¼‰</td></tr><tr><td>UIçº¿ç¨‹å¤„ç†å¤§æ•°æ®ï¼ˆè§£æå¤§JSON/å¤§å›¾ç‰‡ï¼‰</td><td>mainçº¿ç¨‹ä¸­å­˜åœ¨JSONè§£æã€å›¾ç‰‡å‹ç¼©ç­‰è€—æ—¶æ“ä½œ</td><td>å­çº¿ç¨‹å¤„ç†ï¼Œå¤„ç†å®Œæˆåä¸»çº¿ç¨‹æ›´æ–°UI</td></tr><tr><td>é¢‘ç¹GCå¯¼è‡´CPUå ç”¨é«˜</td><td>çŸ­æ—¶é—´å†…å¤§é‡åˆ›å»º/é”€æ¯å¯¹è±¡ï¼ˆæ¯”å¦‚å¾ªç¯ä¸­newå¯¹è±¡ï¼‰</td><td>å¯¹è±¡å¤ç”¨ï¼ˆå¤ç”¨æ± ã€å•ä¾‹ï¼‰ã€å‡å°‘ä¸´æ—¶å¯¹è±¡åˆ›å»º</td></tr><tr><td>è¿‡åº¦ç»˜åˆ¶å¯¼è‡´CPUè€—æ—¶</td><td>å¸ƒå±€å±‚çº§è¿‡æ·±ã€èƒŒæ™¯é‡å¤ç»˜åˆ¶</td><td>ç®€åŒ–å¸ƒå±€ï¼ˆConstraintLayoutæ›¿ä»£åµŒå¥—ï¼‰ã€ç§»é™¤ä¸å¿…è¦çš„èƒŒæ™¯</td></tr></tbody></table>
<h2 data-id="heading-19">ä¸‰ã€å†…å­˜æ³„éœ²æ’æŸ¥ï¼šæŠ“ä½â€œå·å†…å­˜â€çš„å°å·</h2>
<p>å†…å­˜æ³„éœ²å°±åƒâ€œæˆ¿é—´é‡Œçš„åƒåœ¾è¶Šå †è¶Šå¤šï¼Œæœ€åæ²¡åœ°æ–¹æ”¾æ–°ä¸œè¥¿â€â€”â€”APPè¿è¡Œæ—¶ï¼Œä¸€äº›ä¸å†éœ€è¦çš„å¯¹è±¡è¢«é”™è¯¯åœ°æŒæœ‰ï¼Œæ— æ³•è¢«GCï¼ˆåƒåœ¾å›æ”¶å™¨ï¼‰å›æ”¶ï¼Œå¯¼è‡´å†…å­˜å ç”¨è¶Šæ¥è¶Šé«˜ï¼Œæœ€ç»ˆè§¦å‘OOMï¼ˆå†…å­˜æº¢å‡ºï¼‰å´©æºƒã€‚Android Profilerçš„Memoryé¢æ¿ï¼Œå°±æ˜¯å¸®æˆ‘ä»¬æ‰¾åˆ°è¿™äº›â€œåƒåœ¾â€çš„å·¥å…·ã€‚</p>
<h3 data-id="heading-20">3.1 æ’æŸ¥æµç¨‹æ€»è§ˆï¼ˆæµç¨‹å›¾è§£è¯»ï¼‰</h3>
<p>å…ˆä¸Šæµç¨‹å›¾ï¼Œç†æ¸…æ’æŸ¥æ€è·¯ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93277bb331af418ca36eb6ee4986aeaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aG-5p6X5rW3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768180872&amp;x-signature=4VU7qRFU6tLadnNcfF9DTi0N8s0%3D" alt="02.jpeg" loading="lazy"/></p>
<h3 data-id="heading-21">3.2 å…³é”®æ­¥éª¤ï¼šMemoryé¢æ¿æ“ä½œè¯¦è§£</h3>
<p>å†…å­˜æ³„éœ²æ’æŸ¥çš„æ ¸å¿ƒæ˜¯â€œå¯¹æ¯”æ“ä½œå‰åçš„å†…å­˜å˜åŒ–â€å’Œâ€œåˆ†æå †è½¬å‚¨æ–‡ä»¶â€ï¼Œå’±ä»¬ä¸€æ­¥æ­¥æ‹†è§£ã€‚</p>
<h4 data-id="heading-22">3.2.1 ç¬¬ä¸€æ­¥ï¼šç›‘æ§å†…å­˜æ›²çº¿ï¼Œåˆæ­¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ³„éœ²</h4>
<p>æ“ä½œæ­¥éª¤ï¼š</p>
<ol>
<li>æ‰“å¼€Memoryé¢æ¿ï¼Œé»˜è®¤æ˜¾ç¤ºå†…å­˜ä½¿ç”¨é‡çš„å®æ—¶æ›²çº¿ï¼ˆå•ä½ï¼šMBï¼‰ï¼›</li>
<li>æ‰§è¡Œå¯èƒ½å¯¼è‡´æ³„éœ²çš„æ“ä½œï¼Œæ¯”å¦‚ï¼šæ‰“å¼€ä¸€ä¸ªActivity â†’ å…³é—­å®ƒ â†’ é‡å¤å‡ æ¬¡ï¼›</li>
<li>æ¯æ¬¡å…³é—­åï¼Œç‚¹å‡»é¢æ¿ä¸Šçš„â€œTrigger GCâ€æŒ‰é’®ï¼ˆåƒåœ¾æ¡¶å›¾æ ‡ï¼‰ï¼Œè§¦å‘GCï¼›</li>
<li>è§‚å¯Ÿå†…å­˜æ›²çº¿ï¼šå¦‚æœæ¯æ¬¡æ“ä½œåï¼Œå†…å­˜éƒ½æ²¡æœ‰æ˜æ˜¾ä¸‹é™ï¼Œè€Œæ˜¯æŒç»­ä¸Šå‡ï¼Œå¤§æ¦‚ç‡å­˜åœ¨å†…å­˜æ³„éœ²ã€‚</li>
</ol>
<blockquote>
<p>å°æé†’ï¼šä¸è¦ä»…å‡­ä¸€æ¬¡æ“ä½œåˆ¤æ–­æ³„éœ²ï¼å› ä¸ºGCçš„è§¦å‘æ—¶æœºä¸ç¡®å®šï¼Œå¤šæ¬¡é‡å¤æ“ä½œåï¼Œå†…å­˜ä¾ç„¶æ— æ³•å›è½ï¼Œæ‰æ˜¯å¤§æ¦‚ç‡æ³„éœ²ã€‚</p>
</blockquote>
<h4 data-id="heading-23">3.2.2 ç¬¬äºŒæ­¥ï¼šè·å–Heap Dumpï¼Œåˆ†æå †å†…å­˜æ•°æ®</h4>
<p>Heap Dumpï¼ˆå †è½¬å‚¨ï¼‰æ˜¯å½“å‰APPè¿›ç¨‹çš„å†…å­˜å¿«ç…§ï¼ŒåŒ…å«äº†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ã€å¯¹è±¡çš„æ•°é‡ã€å¤§å°ã€å¼•ç”¨å…³ç³»ç­‰ä¿¡æ¯ã€‚è·å–å’Œåˆ†æHeap Dumpæ˜¯å®šä½æ³„éœ²çš„å…³é”®ï¼š</p>
<h5 data-id="heading-24">1. è·å–Heap Dump</h5>
<p>åœ¨Memoryé¢æ¿ä¸­ï¼Œç‚¹å‡»â€œDump Java Heapâ€æŒ‰é’®ï¼ˆé•¿å¾—åƒä¸‹è½½çš„å›¾æ ‡ï¼‰ï¼Œç­‰å¾…å‡ ç§’åï¼ŒProfilerä¼šç”ŸæˆHeap DumpæŠ¥å‘Šã€‚</p>
<h5 data-id="heading-25">2. åˆ†æHeap DumpæŠ¥å‘Š</h5>
<p>Heap DumpæŠ¥å‘ŠåŒ…å«3ä¸ªæ ¸å¿ƒè§†å›¾ï¼Œé‡ç‚¹å…³æ³¨ã€ŒClassesã€å’Œã€ŒInstance Viewã€ï¼š</p>
<ul>
<li>
<p><strong>Classesï¼ˆç±»è§†å›¾ï¼‰</strong> ï¼šæŒ‰ç±»åæ’åºï¼Œæ˜¾ç¤ºæ¯ä¸ªç±»çš„å­˜æ´»å¯¹è±¡æ•°é‡ã€æ€»å¤§å°ã€‚é‡ç‚¹å…³æ³¨ï¼š</p>
<ul>
<li>è‡ªå·±å®šä¹‰çš„Activity/Fragmentç±»ï¼šå¦‚æœå…³é—­åï¼Œå­˜æ´»å¯¹è±¡æ•°é‡æ²¡æœ‰å‡å°‘ï¼Œè¯´æ˜è¿™ä¸ªActivityè¢«æ³„éœ²äº†ï¼›</li>
<li>å¸¸è§çš„æ³„éœ²å¯¹è±¡ï¼šContextã€Viewã€Bitmapç­‰å¤§å¯¹è±¡ã€‚</li>
</ul>
</li>
<li>
<p><strong>Instance Viewï¼ˆå®ä¾‹è§†å›¾ï¼‰</strong> ï¼šé€‰ä¸­æŸä¸ªç±»åï¼Œæ˜¾ç¤ºè¯¥ç±»çš„æ‰€æœ‰å­˜æ´»å®ä¾‹ã€‚ç‚¹å‡»æŸä¸ªå®ä¾‹ï¼Œå¯æŸ¥çœ‹å®ƒçš„ã€ŒReference Chainã€ï¼ˆå¼•ç”¨é“¾ï¼‰â€”â€”è¿™æ˜¯æ‰¾åˆ°æ³„éœ²åŸå› çš„å…³é”®ã€‚</p>
</li>
<li>
<p><strong>Referencesï¼ˆå¼•ç”¨è§†å›¾ï¼‰</strong> ï¼šæ˜¾ç¤ºé€‰ä¸­å®ä¾‹è¢«å“ªäº›å¯¹è±¡å¼•ç”¨ï¼ˆå³â€œè°æŒæœ‰äº†å®ƒçš„å¼•ç”¨ï¼Œå¯¼è‡´å®ƒæ— æ³•è¢«å›æ”¶â€ï¼‰ã€‚</p>
</li>
</ul>
<h4 data-id="heading-26">3.2.3 ç¬¬ä¸‰æ­¥ï¼šé€šè¿‡å¼•ç”¨é“¾ï¼Œå®šä½æ³„éœ²åŸå› </h4>
<p>å¼•ç”¨é“¾çš„æ ¸å¿ƒé€»è¾‘ï¼šå¦‚æœä¸€ä¸ªä¸å†éœ€è¦çš„å¯¹è±¡ï¼ˆæ¯”å¦‚å·²å…³é—­çš„Activityï¼‰ï¼Œè¢«ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ›´é•¿çš„å¯¹è±¡ï¼ˆæ¯”å¦‚å•ä¾‹ã€é™æ€å˜é‡ï¼‰æŒæœ‰ï¼Œå°±ä¼šå¯¼è‡´æ³„éœ²ã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯æ‰¾åˆ°è¿™ä¸ªâ€œé•¿å¯¿å¯¹è±¡â€ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœé€‰ä¸­ä¸€ä¸ªå·²å…³é—­çš„MainActivityå®ä¾‹ï¼ŒæŸ¥çœ‹å¼•ç”¨é“¾ï¼Œå‘ç°ï¼š</p>
<p>MainActivity â†’ mContext â†’ MySingleton â†’ static sInstance</p>
<p>è¿™å°±è¯´æ˜ï¼šMySingletonæ˜¯ä¸€ä¸ªå•ä¾‹ï¼ˆé™æ€å®ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸå’ŒAPPä¸€è‡´ï¼‰ï¼Œå®ƒæŒæœ‰äº†MainActivityçš„Contextå¼•ç”¨ï¼Œå¯¼è‡´MainActivityå…³é—­åæ— æ³•è¢«å›æ”¶ï¼Œå‘ç”Ÿæ³„éœ²ã€‚</p>
<h3 data-id="heading-27">3.3 å®æˆ˜æ¡ˆä¾‹ï¼šæ’æŸ¥å•ä¾‹æŒæœ‰Activityå¯¼è‡´çš„æ³„éœ²</h3>
<p>è¿™æ˜¯æœ€å¸¸è§çš„å†…å­˜æ³„éœ²åœºæ™¯ä¹‹ä¸€ï¼Œå’±ä»¬ç”¨æ¡ˆä¾‹æ¼”ç¤ºå®Œæ•´æ’æŸ¥å’Œè§£å†³è¿‡ç¨‹ã€‚</p>
<h4 data-id="heading-28">3.3.1 é—®é¢˜åœºæ™¯</h4>
<p>APPä¸­æœ‰ä¸€ä¸ªå·¥å…·ç±»MySingletonï¼ŒæŒæœ‰äº†MainActivityçš„Contextå¼•ç”¨ï¼Œå¯¼è‡´æ¯æ¬¡å…³é—­MainActivityåï¼Œå†…å­˜éƒ½æ— æ³•å›è½ï¼Œå¤šæ¬¡æ“ä½œåè§¦å‘OOMã€‚</p>
<h4 data-id="heading-29">3.3.2 æ’æŸ¥è¿‡ç¨‹</h4>
<ol>
<li>å¯åŠ¨APPå’ŒProfilerï¼Œæ‰“å¼€Memoryé¢æ¿ï¼Œç›‘æ§å†…å­˜æ›²çº¿ï¼›</li>
<li>æ“ä½œæ­¥éª¤ï¼šæ‰“å¼€MainActivity â†’ å…³é—­MainActivity â†’ ç‚¹å‡»GCæŒ‰é’® â†’ é‡å¤3æ¬¡ï¼›</li>
<li>è§‚å¯Ÿæ›²çº¿ï¼šæ¯æ¬¡å…³é—­åï¼Œå†…å­˜éƒ½æ²¡æœ‰æ˜æ˜¾ä¸‹é™ï¼Œåè€Œä»50MBæ¶¨åˆ°äº†120MBï¼Œåˆæ­¥åˆ¤æ–­å­˜åœ¨æ³„éœ²ï¼›</li>
<li>ç‚¹å‡»â€œDump Java Heapâ€ï¼Œè·å–Heap DumpæŠ¥å‘Šï¼›</li>
<li>åœ¨Classesè§†å›¾ä¸­ï¼Œæœç´¢â€œMainActivityâ€ï¼Œå‘ç°å­˜æ´»å®ä¾‹æ•°é‡ä¸º3ï¼ˆé‡å¤æ‰“å¼€å…³é—­äº†3æ¬¡ï¼Œæ­£å¸¸åº”è¯¥ä¸º0ï¼‰ï¼›</li>
<li>é€‰ä¸­å…¶ä¸­ä¸€ä¸ªMainActivityå®ä¾‹ï¼ŒæŸ¥çœ‹å¼•ç”¨é“¾ï¼Œå‘ç°å¼•ç”¨å…³ç³»ï¼šMainActivity â†’ mContext â†’ MySingleton$sInstanceï¼ˆé™æ€ï¼‰ï¼›</li>
<li>è·³è½¬åˆ°MySingletonä»£ç ï¼Œç¡®è®¤é—®é¢˜ã€‚</li>
</ol>
<h4 data-id="heading-30">3.3.3 é—®é¢˜ä»£ç è§£æ</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">// é—®é¢˜å•ä¾‹ç±»ï¼šæŒæœ‰äº†Activityçš„Contextå¼•ç”¨</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySingleton</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MySingleton sInstance;
        <span class="hljs-keyword">private</span> Context mContext;
        
        <span class="hljs-comment">// ä¼ å…¥çš„æ˜¯MainActivityçš„Context</span>
        <span class="hljs-keyword">private</span> <span class="hljs-title function_">MySingleton</span><span class="hljs-params">(Context context)</span> {
            <span class="hljs-built_in">this</span>.mContext = context; <span class="hljs-comment">// æŒæœ‰Activityçš„å¼ºå¼•ç”¨</span>
        }
        
        <span class="hljs-comment">// å•ä¾‹è·å–æ–¹æ³•</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> MySingleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">(Context context)</span> {
            <span class="hljs-keyword">if</span> (sInstance == <span class="hljs-literal">null</span>) {
                sInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySingleton</span>(context);
            }
            <span class="hljs-keyword">return</span> sInstance;
        }
        
        <span class="hljs-comment">// å…¶ä»–å·¥å…·æ–¹æ³•...</span>
    }
</code></pre>
<p>MainActivityä¸­è°ƒç”¨ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
            <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
            setContentView(R.layout.activity_main);
            
            <span class="hljs-comment">// ä¼ å…¥thisï¼ˆMainActivityçš„Contextï¼‰è·å–å•ä¾‹</span>
            MySingleton.getInstance(<span class="hljs-built_in">this</span>).doSomething();
        }
    }
</code></pre>
<p>é—®é¢˜åˆ†æï¼šMySingletonæ˜¯é™æ€å•ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸå’ŒAPPä¸€è‡´ï¼›å®ƒæŒæœ‰äº†MainActivityçš„å¼ºå¼•ç”¨ï¼Œå½“MainActivityå…³é—­åï¼ŒGCæ— æ³•å›æ”¶å®ƒï¼Œå¯¼è‡´å†…å­˜æ³„éœ²ã€‚å¤šæ¬¡æ‰“å¼€å…³é—­åï¼Œä¼šç§¯ç´¯å¤šä¸ªæ³„éœ²çš„MainActivityå®ä¾‹ï¼Œæœ€ç»ˆOOMã€‚</p>
<h4 data-id="heading-31">3.3.4 ä¼˜åŒ–æ–¹æ¡ˆä¸ä»£ç ä¿®å¤</h4>
<p>æ ¸å¿ƒæ€è·¯ï¼šè®©å•ä¾‹æŒæœ‰ã€ŒApplicationçš„Contextã€è€Œä¸æ˜¯ã€ŒActivityçš„Contextã€ã€‚Applicationçš„Contextç”Ÿå‘½å‘¨æœŸå’ŒAPPä¸€è‡´ï¼Œä¸ä¼šè¢«å›æ”¶ï¼Œä¹Ÿä¸ä¼šæŒæœ‰Activityçš„å¼•ç”¨ã€‚</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">// ä¿®å¤åçš„å•ä¾‹ç±»ï¼šæŒæœ‰Applicationçš„Context</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySingleton</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> MySingleton sInstance;
        <span class="hljs-keyword">private</span> Context mContext;
        
        <span class="hljs-comment">// ç§æœ‰æ„é€ æ–¹æ³•ï¼Œä¼ å…¥Application Context</span>
        <span class="hljs-keyword">private</span> <span class="hljs-title function_">MySingleton</span><span class="hljs-params">(Context context)</span> {
            <span class="hljs-comment">// è·å–Applicationçš„Contextï¼Œé¿å…æŒæœ‰Activityå¼•ç”¨</span>
            <span class="hljs-built_in">this</span>.mContext = context.getApplicationContext();
        }
        
        <span class="hljs-comment">// å•ä¾‹è·å–æ–¹æ³•ï¼šå»ºè®®ä¼ å…¥Application Contextï¼Œæˆ–åœ¨Applicationä¸­åˆå§‹åŒ–</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> MySingleton <span class="hljs-title function_">getInstance</span><span class="hljs-params">(Context context)</span> {
            <span class="hljs-keyword">if</span> (sInstance == <span class="hljs-literal">null</span>) {
                sInstance = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySingleton</span>(context);
            }
            <span class="hljs-keyword">return</span> sInstance;
        }
        
        <span class="hljs-comment">// å…¶ä»–å·¥å…·æ–¹æ³•...</span>
    }
</code></pre>
<p>MainActivityä¸­è°ƒç”¨ï¼ˆå¯é€‰ä¼˜åŒ–ï¼šåœ¨Applicationä¸­åˆå§‹åŒ–å•ä¾‹ï¼Œé¿å…ä¼ å…¥Activity Contextï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">// è‡ªå®šä¹‰Application</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Application</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">()</span> {
            <span class="hljs-built_in">super</span>.onCreate();
            <span class="hljs-comment">// åœ¨Applicationä¸­åˆå§‹åŒ–å•ä¾‹ï¼Œä¼ å…¥Application Context</span>
            MySingleton.getInstance(<span class="hljs-built_in">this</span>);
        }
    }

    <span class="hljs-comment">// MainActivityä¸­ç›´æ¥è·å–ï¼Œæ— éœ€ä¼ å…¥Context</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {
            <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);
            setContentView(R.layout.activity_main);
            
            MySingleton.getInstance(<span class="hljs-literal">null</span>).doSomething();
        }
    }
</code></pre>
<p>ä¿®å¤åéªŒè¯ï¼šé‡å¤æ‰“å¼€å…³é—­MainActivityï¼Œè§¦å‘GCåï¼Œå†…å­˜æ›²çº¿æ˜æ˜¾å›è½ï¼ŒHeap Dumpä¸­MainActivityçš„å­˜æ´»å®ä¾‹æ•°é‡ä¸º0ï¼Œæ³„éœ²é—®é¢˜è§£å†³ã€‚</p>
<h3 data-id="heading-32">3.4 å¸¸è§å†…å­˜æ³„éœ²åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆæ±‡æ€»</h3>



































<table><thead><tr><th>å¸¸è§æ³„éœ²åœºæ™¯</th><th>æ³„éœ²åŸå› </th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>å•ä¾‹æŒæœ‰Activity/Context</td><td>å•ä¾‹ç”Ÿå‘½å‘¨æœŸé•¿ï¼ŒæŒæœ‰Activityå¼ºå¼•ç”¨</td><td>æ”¹ç”¨Application Contextï¼Œæˆ–åœ¨åˆé€‚æ—¶æœºé‡Šæ”¾å¼•ç”¨</td></tr><tr><td>éé™æ€å†…éƒ¨ç±»æŒæœ‰å¤–éƒ¨ç±»</td><td>éé™æ€å†…éƒ¨ç±»é»˜è®¤æŒæœ‰å¤–éƒ¨ç±»å¼•ç”¨ï¼ˆæ¯”å¦‚Handlerã€Threadï¼‰</td><td>æ”¹ä¸ºé™æ€å†…éƒ¨ç±»ï¼Œç”¨å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰æŒæœ‰å¤–éƒ¨ç±»</td></tr><tr><td>Handlerä½¿ç”¨ä¸å½“</td><td>HandleræŒæœ‰Activityå¼•ç”¨ï¼ŒMessageé˜Ÿåˆ—æœ‰æœªå¤„ç†çš„æ¶ˆæ¯</td><td>é™æ€Handler+å¼±å¼•ç”¨ï¼ŒActivityé”€æ¯æ—¶ç§»é™¤æœªå¤„ç†æ¶ˆæ¯</td></tr><tr><td>èµ„æºæœªåŠæ—¶é‡Šæ”¾</td><td>Bitmapã€FileStreamã€BroadcastReceiveræœªå…³é—­/æ³¨é”€</td><td>åœ¨onDestroyä¸­é‡Šæ”¾èµ„æºï¼ˆBitmap.recycle()ã€å…³é—­æµã€æ³¨é”€å¹¿æ’­ï¼‰</td></tr><tr><td>é›†åˆæŒæœ‰å¤§é‡å¯¹è±¡æœªæ¸…ç†</td><td>é™æ€é›†åˆæŒæœ‰å¯¹è±¡ï¼Œä½¿ç”¨åæœªremove</td><td>ä½¿ç”¨åæ¸…ç©ºé›†åˆï¼Œæˆ–ç”¨WeakHashMapæ›¿ä»£HashMap</td></tr></tbody></table>
<h2 data-id="heading-33">å››ã€è¿›é˜¶æŠ€å·§ï¼šè®©æ’æŸ¥æ›´é«˜æ•ˆ</h2>
<p>æŒæ¡äº†åŸºç¡€æ“ä½œåï¼Œè¿™äº›è¿›é˜¶æŠ€å·§èƒ½å¸®ä½ æ›´å¿«åœ°å®šä½é—®é¢˜ï¼š</p>
<h3 data-id="heading-34">4.1 è¿‡æ»¤æ•°æ®ï¼Œèšç„¦é‡ç‚¹</h3>
<p>æ— è®ºæ˜¯CPUè¿˜æ˜¯Memoryé¢æ¿ï¼Œéƒ½æ”¯æŒè¿‡æ»¤åŠŸèƒ½ï¼š</p>
<ul>
<li>CPUæŠ¥å‘Šï¼šè¿‡æ»¤è‡ªå·±çš„åŒ…åï¼ˆæ¯”å¦‚com.your.appï¼‰ï¼Œéšè—ç³»ç»Ÿå‡½æ•°å’Œç¬¬ä¸‰æ–¹åº“å‡½æ•°ï¼Œåªçœ‹è‡ªå·±çš„ä»£ç ï¼›</li>
<li>MemoryæŠ¥å‘Šï¼šè¿‡æ»¤ç‰¹å®šç±»åï¼ˆæ¯”å¦‚æœç´¢â€œActivityâ€ï¼‰ï¼Œå¿«é€Ÿæ‰¾åˆ°å¯èƒ½æ³„éœ²çš„é¡µé¢ã€‚</li>
</ul>
<h3 data-id="heading-35">4.2 ç»“åˆLogcatï¼Œç²¾å‡†å®šä½æ—¶é—´ç‚¹</h3>
<p>åœ¨å…³é”®æ“ä½œå¤„æ·»åŠ Logï¼ˆæ¯”å¦‚Activityçš„onCreateã€onDestroyï¼‰ï¼ŒProfilerçš„æ—¶é—´è½´ä¼šåŒæ­¥æ˜¾ç¤ºLogä¿¡æ¯ï¼Œå¸®ä½ ç²¾å‡†å¯¹åº”â€œæ“ä½œæ—¶é—´ç‚¹â€å’Œâ€œæ€§èƒ½æ³¢åŠ¨â€ï¼Œå¿«é€Ÿæ‰¾åˆ°é—®é¢˜å‘ç”Ÿçš„æ—¶æœºã€‚</p>
<h3 data-id="heading-36">4.3 ä½¿ç”¨Allocation Trackerï¼Œè¿½è¸ªå†…å­˜åˆ†é…</h3>
<p>å¦‚æœæƒ³çŸ¥é“â€œå“ªä¸ªåœ°æ–¹åˆ›å»ºäº†å¤§é‡å¯¹è±¡â€ï¼Œå¯ä»¥ä½¿ç”¨Memoryé¢æ¿çš„ã€ŒAllocation Trackerã€ï¼ˆåˆ†é…è¿½è¸ªï¼‰åŠŸèƒ½ï¼š</p>
<ol>
<li>ç‚¹å‡»â€œStart Allocation Trackingâ€æŒ‰é’®ï¼›</li>
<li>æ‰§è¡Œæ“ä½œï¼›</li>
<li>ç‚¹å‡»â€œStopâ€ï¼Œç”Ÿæˆåˆ†é…æŠ¥å‘Šï¼Œæ˜¾ç¤ºæ“ä½œæœŸé—´åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡ã€åˆ›å»ºä½ç½®ï¼ˆä»£ç è¡Œï¼‰ã€‚</li>
</ol>
<p>é€šè¿‡è¿™ä¸ªåŠŸèƒ½ï¼Œèƒ½å¿«é€Ÿæ‰¾åˆ°â€œé¢‘ç¹åˆ›å»ºå¯¹è±¡â€çš„ä»£ç ï¼Œæå‰ä¼˜åŒ–ï¼Œé¿å…GCå‹åŠ›ã€‚</p>
<h3 data-id="heading-37">4.4 ç»“åˆMATå·¥å…·ï¼Œæ·±åº¦åˆ†æHeap Dump</h3>
<p>å¦‚æœProfilerçš„Heap Dumpåˆ†æåŠŸèƒ½ä¸å¤Ÿç”¨ï¼ˆæ¯”å¦‚å¤„ç†è¶…å¤§Heap Dumpæ–‡ä»¶ï¼‰ï¼Œå¯ä»¥å°†Heap Dumpå¯¼å‡ºï¼ˆç‚¹å‡»Profilerçš„ExportæŒ‰é’®ï¼‰ï¼Œç”¨MATï¼ˆMemory Analyzer Toolï¼‰å·¥å…·æ‰“å¼€ï¼Œè¿›è¡Œæ›´æ·±åº¦çš„åˆ†æï¼ˆæ¯”å¦‚æŸ¥æ‰¾æ³„æ¼ suspectsã€åˆ†æå¯¹è±¡æ”¯é…æ ‘ç­‰ï¼‰ã€‚</p>
<h2 data-id="heading-38">äº”ã€æ€»ç»“ï¼šæ€§èƒ½æ’æŸ¥çš„æ ¸å¿ƒæ€ç»´</h2>
<p>é€šè¿‡ä¸Šé¢çš„è®²è§£ï¼Œç›¸ä¿¡å¤§å®¶å·²ç»æŒæ¡äº†ç”¨Android Profileræ’æŸ¥CPUè€—æ—¶å’Œå†…å­˜æ³„éœ²çš„æ–¹æ³•ã€‚æœ€åæ€»ç»“ä¸€ä¸‹æ ¸å¿ƒæ€ç»´ï¼Œå¸®ä½ ä¸¾ä¸€åä¸‰ï¼š</p>
<ul>
<li><strong>å¯¹æ¯”æ€ç»´</strong>ï¼šé€šè¿‡â€œæ“ä½œå‰vsæ“ä½œåâ€çš„æ€§èƒ½æ•°æ®å¯¹æ¯”ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨é—®é¢˜ï¼›</li>
<li><strong>æº¯æºæ€ç»´</strong>ï¼šæ‰¾åˆ°é—®é¢˜ç°è±¡ï¼ˆå¡é¡¿/OOMï¼‰åï¼Œé€šè¿‡Profilerè¿½æº¯åˆ°å…·ä½“çš„ä»£ç ä½ç½®ï¼Œä¸è¦å‡­æ„Ÿè§‰ä¼˜åŒ–ï¼›</li>
<li><strong>é¢„é˜²æ€ç»´</strong>ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æ˜¯â€œäº‹åè¡¥æ•‘â€ï¼Œè€Œæ˜¯â€œäº‹å‰é¢„é˜²â€â€”â€”å†™ä»£ç æ—¶å°±æ³¨æ„é¿å…å¸¸è§çš„æ€§èƒ½å‘ï¼ˆæ¯”å¦‚UIçº¿ç¨‹è€—æ—¶æ“ä½œã€å•ä¾‹æŒæœ‰Activityï¼‰ï¼Œæ¯”äº‹åæ’æŸ¥æ›´é«˜æ•ˆã€‚</li>
</ul>
<p>Android Profileræ˜¯æˆ‘ä»¬çš„â€œæ€§èƒ½ä¿é•–â€ï¼Œä½†çœŸæ­£çš„â€œæ€§èƒ½ä¼˜åŒ–å¤§å¸ˆâ€æ˜¯æˆ‘ä»¬è‡ªå·±â€”â€”åªæœ‰ç†è§£äº†åº•å±‚åŸç†ï¼Œå…»æˆè‰¯å¥½çš„ç¼–ç ä¹ æƒ¯ï¼Œæ‰èƒ½å†™å‡ºæµç•…ã€ç¨³å®šçš„APPã€‚å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ æå®šCPUå’Œå†…å­˜é—®é¢˜ï¼Œä»æ­¤å‘Šåˆ«å¡é¡¿å’ŒOOMï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è°·æ­Œå®˜æ–¹æ¨èï¼šAndroid æ€§èƒ½ä¼˜åŒ–å…¨æ”»ç•¥â€”â€”ä»å·¥å…·åˆ°å®æˆ˜ï¼Œä¸¤å‘¨æå‡ App è¯„åˆ†]]></title>    <link>https://juejin.cn/post/7591309945511739392</link>    <guid>https://juejin.cn/post/7591309945511739392</guid>    <pubDate>2026-01-05T02:03:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591309945511739392" data-draft-id="7591309945511723008" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è°·æ­Œå®˜æ–¹æ¨èï¼šAndroid æ€§èƒ½ä¼˜åŒ–å…¨æ”»ç•¥â€”â€”ä»å·¥å…·åˆ°å®æˆ˜ï¼Œä¸¤å‘¨æå‡ App è¯„åˆ†"/> <meta itemprop="keywords" content="Android,Android Studio,Android Jetpack"/> <meta itemprop="datePublished" content="2026-01-05T02:03:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Android_å°é›¨"/> <meta itemprop="url" content="https://juejin.cn/user/220360279590862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è°·æ­Œå®˜æ–¹æ¨èï¼šAndroid æ€§èƒ½ä¼˜åŒ–å…¨æ”»ç•¥â€”â€”ä»å·¥å…·åˆ°å®æˆ˜ï¼Œä¸¤å‘¨æå‡ App è¯„åˆ†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/220360279590862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Android_å°é›¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T02:03:20.000Z" title="Mon Jan 05 2026 02:03:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p>Android æ€§èƒ½ä¼˜åŒ–ä¸€ç›´æ˜¯è¯¸å¤šå¼€å‘è€…çš„â€œå¿ƒç—…â€ã€‚ç‰¹åˆ«æ˜¯åœ¨ä¸šåŠ¡è¿­ä»£éœ€æ±‚å †ç§¯å¦‚å±±çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€å¾ˆéš¾æŠ½å‡ºå¤§å—æ—¶é—´å»æ­»ç£•åº•å±‚æºç ã€‚</p>
<p>ä½†æ€§èƒ½ä¼˜åŒ–ç»ä¸æ˜¯å•çº¯çš„â€œç‚«æŠ€â€ï¼Œå®ƒæ˜¯è¿æ¥ç”¨æˆ·ä½“éªŒã€å¼€å‘è€…æ•ˆç‡å’Œä¸šåŠ¡ KPI çš„â€œé‡‘çº½å¸¦â€ã€‚è°·æ­Œå®˜æ–¹æ•°æ®æ˜¾ç¤ºï¼š<strong>App å¯åŠ¨æ—¶é—´æ¯å‡å°‘ 1 ç§’ï¼Œæ¬¡æ—¥ç•™å­˜ç‡å¯æå‡ 7%ï¼›åº”ç”¨è¯„åˆ†æ¯æå‡ 1 æ˜Ÿï¼Œä¸‹è½½è½¬åŒ–ç‡æš´æ¶¨ 20%ã€‚</strong></p>
<p>æ—¢ç„¶æ€§ä»·æ¯”è¿™ä¹ˆé«˜ï¼Œå¦‚ä½•ç”¨æœ€å°‘çš„æ—¶é—´æ‹¿åˆ°æœ€å¥½çš„ç»“æœï¼Ÿä»Šå¤©å°±ä¸ºå¤§å®¶æ·±åº¦è§£æè°·æ­Œæœ€æ–°æ¨å‡ºçš„<strong>æ€§èƒ½ä¼˜åŒ–å·¥å…·é›†ä¸æœ€ä½³å®è·µ</strong>ï¼Œå¸¦ä½ ç”¨ä¸€å¥—â€œç»„åˆæ‹³â€å¤§å¹…æå‡ä¼˜åŒ–çš„ ROIã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ æ‹’ç»â€œä½“æ„Ÿä¼˜åŒ–â€ï¼šç”¨å¯¹è¯Šæ–­å·¥å…·</h2>
<p>å¾ˆå¤šå¼€å‘è€…çš„è¯¯åŒºæ˜¯â€œå‡­æ„Ÿè§‰æ”¹â€â€”â€”è§‰å¾—åˆ—è¡¨å¡å°±æ”¹ RecyclerViewï¼Œè§‰å¾—å¯åŠ¨æ…¢å°±åˆ åˆå§‹åŒ–ä»£ç ã€‚è¿™ç§â€œç›²åŒ»â€è¡Œå¾„å¾€å¾€äº‹å€åŠŸåŠã€‚æ­£ç¡®çš„å§¿åŠ¿æ˜¯<strong>å…ˆè¯Šæ–­ï¼Œå†å¼€è¯</strong>ã€‚</p>
<h3 data-id="heading-1">1. Jetpack Macrobenchmarkï¼šè®©æ•°æ®è¯´è¯</h3>
<p>ä»¥å‰æˆ‘ä»¬æµ‹æ€§èƒ½é æ‰‹åŠ¨ç‚¹å‡»ï¼Œä¸»è§‚ä¸”æ— æ³•é‡åŒ–ã€‚<strong>Jetpack Macrobenchmark</strong> æ˜¯è°·æ­Œæ¨å‡ºçš„åŸºå‡†æµ‹è¯•åº“ï¼Œå®ƒèƒ½æ¨¡æ‹Ÿç”¨æˆ·æœ€åœ¨æ„çš„åœºæ™¯ï¼ˆå¯åŠ¨ã€æ»‘åŠ¨ã€é¡µé¢è·³è½¬ï¼‰ï¼Œé€šè¿‡è‡ªåŠ¨é‡å¤å¤šæ¬¡æµ‹è¯•å‰”é™¤å¼‚å¸¸å€¼ï¼Œæä¾›ç²¾å‡†æ•°æ®ã€‚</p>
<p>å®ƒå…³æ³¨çš„æ ¸å¿ƒæŒ‡æ ‡ç›´å‡»ç—›ç‚¹ï¼š</p>
<ul>
<li><strong>å¯åŠ¨æ—¶é—´</strong>ï¼šåŒºåˆ†â€œé¦–å¸§æ—¶é—´ (TTID)â€å’Œâ€œå®Œå…¨æ˜¾ç¤ºæ—¶é—´ (TTFD)â€ã€‚</li>
<li><strong>å¸§æ—¶é—´ (Frame Timing)</strong> ï¼šç›´æ¥æ ‡è®°è¶…è¿‡ 16ms çš„æ‰å¸§ä½ç½®ã€‚</li>
<li><strong>èµ„æºç›‘æ§</strong>ï¼šé•¿æœŸè·Ÿè¸ª CPU å’Œå†…å­˜ï¼Œèƒ½è¿…é€Ÿå®šä½æ˜¯å“ªæ¬¡è¿­ä»£å¯¼è‡´äº†æ€§èƒ½å›é€€ã€‚</li>
</ul>
<h3 data-id="heading-2">2. UiAutomator 2.4ï¼šä»â€œæŠ˜ç£¨â€å˜â€œäº«å—â€</h3>
<p>å†™æµ‹è¯•è„šæœ¬æ›¾ç»æ˜¯ä»¶è‹¦å·®äº‹ï¼Œä½†åœ¨ UiAutomator 2.4 (alpha 3+) ä¸­ï¼Œä¸€åˆ‡éƒ½å˜äº†ã€‚</p>
<ul>
<li><strong>æç®€è¯­æ³•</strong>ï¼šæ— éœ€ç¹çé…ç½®ï¼Œå¯åŠ¨ App åªéœ€ <code>start app</code>ã€‚</li>
<li><strong>æ™ºèƒ½ç­‰å¾…</strong>ï¼šå†…ç½® 10 ç§’è¶…æ—¶æœºåˆ¶ï¼Œè‡ªåŠ¨ç­‰å¾…å…ƒç´ å‡ºç°ï¼Œå½»åº•å‘Šåˆ« <code>Thread.sleep(3000)</code> è¿™ç§ç¡¬ç¼–ç ã€‚</li>
</ul>
<p><strong>å¯¹æ¯”ä¸€ä¸‹ä»£ç é‡ï¼š</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ—§ç‰ˆå†™æ³•ï¼šç¹ççš„æŸ¥æ‰¾ä¸ç­‰å¾…</span>
val <span class="hljs-selector-tag">button</span> = device<span class="hljs-selector-class">.findObject</span>(By.text("ç™»å½•"))
<span class="hljs-selector-tag">button</span><span class="hljs-selector-class">.click</span>()
<span class="hljs-comment">// ...æ‰‹åŠ¨åŠ å»¶æ—¶...</span>

<span class="hljs-comment">// UiAutomator 2.4 æ–°å†™æ³•ï¼š</span>
<span class="hljs-built_in">onElement</span>(textAsString = "login")<span class="hljs-selector-class">.click</span>() <span class="hljs-comment">// è‡ªåŠ¨æŸ¥æ‰¾å¹¶ç‚¹å‡»</span>
scroll() <span class="hljs-comment">// åˆ—è¡¨æ»‘åŠ¨</span>
</code></pre>
<p>ä¸åˆ° 20 è¡Œä»£ç å°±èƒ½è¦†ç›–å¯åŠ¨ã€ç™»å½•ã€æµè§ˆåˆ—è¡¨çš„æ ¸å¿ƒåœºæ™¯ï¼Œæ•ˆç‡æå‡ 50%ã€‚</p>
<h3 data-id="heading-3">3. App Performance Scoreï¼šè€æ¿ä¹Ÿèƒ½çœ‹æ‡‚çš„æŠ¥å‘Š</h3>
<p>æµ‹å®Œä¸€å †æ¯«ç§’çº§æ•°æ®ï¼Œæ€ä¹ˆè·ŸéæŠ€æœ¯çš„ä¸Šçº§æ±‡æŠ¥ï¼Ÿ<strong>App Performance Score</strong> å°†å¤æ‚çš„æ€§èƒ½æ•°æ®è½¬åŒ–ä¸º <strong>0-100 åˆ†</strong> çš„ç›´è§‚æˆç»©ã€‚</p>
<ul>
<li><strong>ç—›ç‚¹åˆ†æ</strong>ï¼šç›´æ¥æ ‡çº¢æŒ‡å‡ºâ€œå¯åŠ¨è¿‡æ…¢â€ã€â€œå¸§ä¸¢å¤±ç‡é«˜â€ã€‚</li>
<li><strong>è¡ŒåŠ¨å»ºè®®</strong>ï¼šç»™å‡ºå…·ä½“æ–¹æ¡ˆï¼Œå¦‚â€œå»ºè®®å¯ç”¨ R8â€ã€â€œä¼˜åŒ–åˆ—è¡¨å¤ç”¨â€ã€‚</li>
</ul>
<p>æ‹¿ç€è¿™ä¸ªåˆ†æ•°å»æ²Ÿé€šï¼šâ€œç°åœ¨ 42 åˆ†ï¼Œä¼˜åŒ–åèƒ½åˆ° 80 åˆ†ï¼Œé¢„è®¡è¯„åˆ†æ¶¨ 0.5 æ˜Ÿâ€ï¼Œèµ„æºç”³è¯·è‡ªç„¶æ°´åˆ°æ¸ æˆã€‚æ­¤å¤–ï¼Œé…åˆ <strong>App Startup Insights</strong> (Trace Processor 1.4 åŠŸèƒ½)ï¼Œè¿˜èƒ½åƒä¾¦æ¢ä¸€æ ·è‡ªåŠ¨å‘ç°å¯åŠ¨æ—¶çš„é˜»å¡æ“ä½œå’Œ JIT ç¼–è¯‘è€—æ—¶ã€‚</p>
<hr/>
<h2 data-id="heading-4">äºŒã€ å®æˆ˜æš´å‡»ï¼šR8 ä¼˜åŒ–å™¨â€”â€”è¢«ä½ä¼°çš„â€œæ ¸å¼¹â€</h2>
<p>å¦‚æœè¯´è¯Šæ–­å·¥å…·æ˜¯åŒ»ç”Ÿï¼Œé‚£ R8 å°±æ˜¯ç‰¹æ•ˆè¯ã€‚å¾ˆå¤šäººåªæŠŠå®ƒå½“ä½œæ··æ·†å·¥å…·ï¼Œæ®Šä¸çŸ¥å®ƒæ˜¯æœ€å¼ºçš„<strong>ä»£ç ç˜¦èº«ä¸åŠ é€Ÿå™¨</strong>ã€‚</p>
<h3 data-id="heading-5">1. Reddit çš„é€†å¤©æˆ˜ç»©</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bab9d3cc1bb46df869828e0be3ce55f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQW5kcm9pZF_lsI_pm6g=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768183400&amp;x-signature=Yd2n6r0sI%2BPV4a987SPzAVg9GlI%3D" alt="image.png" loading="lazy"/>
Reddit å®‰å“å›¢é˜Ÿåœ¨å¼€å¯ R8 é«˜çº§ä¼˜åŒ–åï¼Œä»…ç”¨ä¸¤å‘¨æ—¶é—´å°±è¾¾æˆäº†æƒŠäººæ•ˆæœï¼š</p>
<ul>
<li><strong>å†·å¯åŠ¨é€Ÿåº¦</strong>ï¼šæå‡ 40% (3s -&gt; 1.8s)</li>
<li><strong>ANR ç‡</strong>ï¼šé™ä½ 30%</li>
<li><strong>App ä½“ç§¯</strong>ï¼šå‡å°‘ 14%</li>
<li><strong>å•†ä¸šç»“æœ</strong>ï¼šä¸Šçº¿ä¸¤ä¸ªæœˆï¼ŒGoogle Play è¯„åˆ†ä¸Šæ¶¨ <strong>1 æ˜Ÿ</strong>ï¼Œé«˜åˆ†è¯„ä»·å æ¯”è¾¾ 92%ã€‚</li>
</ul>
<h3 data-id="heading-6">2. R8 åˆ°åº•åšäº†ä»€ä¹ˆï¼Ÿ</h3>
<ul>
<li><strong>Tree Shaking (æ ‘æ‘‡)</strong> ï¼šæ— æƒ…ç æ‰æ²¡ç”¨åˆ°çš„ä»£ç ã€‚</li>
<li><strong>æ–¹æ³•å†…è”</strong>ï¼šå°†å°æ–¹æ³•ç›´æ¥é€šè¿‡å†…è”å‡å°‘è°ƒç”¨å¼€é”€ã€‚</li>
<li><strong>æ ‡è¯†ç¬¦é‡å‘½å</strong>ï¼šç±»åæ–¹æ³•åæç®€åŒ– (a, b, c)ï¼Œå‡å°ä½“ç§¯å¹¶åŠ å¿«è™šæ‹ŸæœºåŠ è½½ã€‚</li>
</ul>
<h3 data-id="heading-7">3. æ‰‹æŠŠæ‰‹é…ç½®æŒ‡å—ï¼ˆé¿å‘ç‰ˆï¼‰</h3>
<p>å¼€å¯ R8 éå¸¸ç®€å•ï¼Œåªéœ€åœ¨ <code>app/build.gradle</code> ä¸­æ·»åŠ ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">android {
    buildTypes {
        release {
            <span class="hljs-comment">// å¼€å¯ä»£ç å‹ç¼©ä¸ä¼˜åŒ–</span>
            isMinifyEnabled = <span class="hljs-literal">true</span>
            <span class="hljs-comment">// å¼€å¯èµ„æºå‹ç¼©</span>
            isShrinkResources = <span class="hljs-literal">true</span>
            <span class="hljs-comment">// åŠ¡å¿…åŠ è½½é»˜è®¤è§„åˆ™</span>
            <span class="hljs-built_in">proguardFiles</span>(
                <span class="hljs-built_in">getDefaultProguardFile</span>(<span class="hljs-string">"proguard-android-optimize.txt"</span>),
                <span class="hljs-string">"proguard-rules.pro"</span>
            )
        }
    }
}
</code></pre>
<p><strong>âš ï¸ æ ¸å¿ƒé¿å‘ï¼šåå°„é—®é¢˜</strong> R8 å¯èƒ½ä¼šè¯¯åˆ è¢«åå°„è°ƒç”¨çš„ç±»ã€‚å¦‚æœå‡ºç° <code>ClassNotFoundException</code>ï¼Œè¯·åœ¨ <code>proguard-rules.pro</code> ä¸­æ·»åŠ ä¿ç•™è§„åˆ™ï¼š</p>
<p>ä»£ç æ®µ</p>
<ul>
<li><code>keep class com.yourpackage.SecretSauce { *; }</code></li>
</ul>
<p>é…åˆ <strong>Baseline Profiles</strong> (å¼•å¯¼ç³»ç»Ÿä¼˜å…ˆåŠ è½½çƒ­ç‚¹ä»£ç )ï¼Œç”šè‡³å¯ä»¥è®© JIT ç¼–è¯‘è€—æ—¶å®Œå…¨æ¶ˆå¤±ã€‚</p>
<hr/>
<h2 data-id="heading-8">ä¸‰ã€ æŒç»­ç›‘æ§ï¼šæŠ“æ•â€œéšå½¢è€—ç”µå¤§ç›—â€</h2>
<p>ä¼˜åŒ–ä¸æ˜¯ä¸€é”¤å­ä¹°å–ã€‚ä¸Šçº¿åï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ Play æ§åˆ¶å°çš„ <strong>App Vitals</strong> ç›‘æ§çœŸå®ç”¨æˆ·çš„ä½“éªŒï¼Œç‰¹åˆ«æ˜¯æœ€è¿‘æ–°å¢çš„ç”µæ± ç›‘æ§åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-9">1. å”¤é†’é” (Wake Locks) æ²»ç†</h3>
<p>ç”¨æˆ·æŠ•è¯‰â€œæ‰‹æœºå‘çƒ«ã€åå°æ‰ç”µå¿«â€ï¼Œé€šå¸¸æ˜¯å”¤é†’é”æœªé‡Šæ”¾å¯¼è‡´çš„ã€‚App Vitals ç°åœ¨æä¾›**â€œè¿‡åº¦éƒ¨åˆ†å”¤é†’é”â€**æŠ¥è­¦ï¼šå¦‚æœä½ çš„ App åœ¨åå°æŒæœ‰å”¤é†’é”ç´¯è®¡è¶…è¿‡ 3 å°æ—¶ï¼Œå°±ä¼šè§¦å‘è­¦æŠ¥ã€‚</p>
<h3 data-id="heading-10">2. è°ƒè¯•å·¥å…·æ¨è</h3>
<ul>
<li><strong>WorkManager é—®é¢˜</strong>ï¼šä½¿ç”¨ Android Studio çš„ <strong>Background Task Inspector</strong> (<code>View &gt; Tool Windows &gt; App Inspection</code>)ï¼ŒæŸ¥çœ‹å“ªä¸ª Worker ä¸€ç›´é‡è¯•æˆ–è¶…æ—¶ã€‚</li>
<li><strong>å¤æ‚ç³»ç»Ÿè°ƒç”¨</strong>ï¼šä½¿ç”¨ <strong>Perfetto</strong>ã€‚SDK 35 å¼•å…¥çš„ <code>ProfilingManager</code> API ç”šè‡³å…è®¸åœ¨ç”Ÿäº§ç¯å¢ƒæŠ“å–è½¨è¿¹ï¼Œå½»åº•æå®šé‚£äº›å¤ç°ä¸äº†çš„è¯¡å¼‚è€—ç”µã€‚</li>
<li><strong>ANR è¿½è¸ª</strong>ï¼šåˆ©ç”¨ <code>ApplicationExitInfo</code> APIï¼Œä½ å¯ä»¥è·å–åº”ç”¨é€€å‡ºæ—¶çš„å®Œæ•´çº¿ç¨‹è½¨è¿¹ï¼Œå“ªé‡Œå¡æ­»ä¸€ç›®äº†ç„¶ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-11">å››ã€ å¼€å‘è€…è¡ŒåŠ¨æ¸…å• (To-Do List)</h2>
<p>åˆ«å†ç­‰å¾…â€œæœ‰ç©ºå†åšâ€äº†ï¼Œç°åœ¨å°±æ˜¯æœ€å¥½çš„æ—¶æœºã€‚ä»¥ä¸‹æ˜¯ä½ å¯ä»¥ç«‹å³æ‰§è¡Œçš„è¡ŒåŠ¨æ¸…å•ï¼š</p>
<ol>
<li><strong>âœ… æ­å»ºåŸºå‡†æµ‹è¯•</strong>ï¼šé›†æˆ Jetpack Macrobenchmark å’Œ UiAutomator 2.4ï¼Œå†™ä¸€ä¸ªåŒ…å«å¯åŠ¨å’Œæ»‘åŠ¨çš„ç®€å•è„šæœ¬ï¼Œè·å–å½“å‰æ€§èƒ½åŸºçº¿ã€‚</li>
<li><strong>âœ… å¼€å¯ R8 ä¼˜åŒ–</strong>ï¼šåœ¨ Release åŒ…ä¸­å¼€å¯ <code>isMinifyEnabled</code> å’Œ <code>isShrinkResources</code>ï¼Œå¹¶ä¿®å¤åå°„å¯¼è‡´çš„ Crashã€‚</li>
<li><strong>âœ… åº”ç”¨è¯„åˆ†è¯Šæ–­</strong>ï¼šä½¿ç”¨ App Performance Score æŸ¥çœ‹å¾—åˆ†ï¼Œä¼˜å…ˆè§£å†³çº¢æ¡†æ ‡å‡ºçš„å»ºè®®é¡¹ã€‚</li>
<li><strong>âœ… éƒ¨ç½²çº¿ä¸Šç›‘æ§</strong>ï¼šåœ¨ App Vitals ä¸­å…³æ³¨å”¤é†’é”å’Œ ANR æ•°æ®ï¼Œæ¯å‘¨ Review ä¸€æ¬¡ã€‚</li>
</ol>
<hr/>
<p><strong>å†™åœ¨æœ€å</strong> æ€§èƒ½ä¼˜åŒ–ä¸å†æ˜¯éœ€è¦æ·±åšåº•å±‚åŠŸåº•çš„â€œç„å­¦â€ï¼Œè°·æ­Œå·²ç»æŠŠæœ€å¤æ‚çš„é€»è¾‘å°è£…æˆäº†å¥½ç”¨çš„å·¥å…·ã€‚åªè¦æ‰¾å¯¹æ ¸å¿ƒç‚¹ï¼ˆR8 + ç›‘æ§ï¼‰ï¼Œè½»è½»ä¸€æ¨å°±èƒ½æ’¬åŠ¨å…¨å±€ã€‚</p>
<p>ç°åœ¨ï¼Œæ‰“å¼€ä½ çš„ <code>build.gradle</code>ï¼Œå¼€å§‹ä½ çš„ä¼˜åŒ–ä¹‹æ—…å§ï¼ç”¨æˆ·çš„äº”æ˜Ÿå¥½è¯„åœ¨ç­‰ä½ ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Androidåˆ·æ–°ä¸ç»˜åˆ¶æœºåˆ¶è¯¦è§£ ç¬”è®°]]></title>    <link>https://juejin.cn/post/7591416714694672394</link>    <guid>https://juejin.cn/post/7591416714694672394</guid>    <pubDate>2026-01-05T01:53:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591416714694672394" data-draft-id="7591413678983168046" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Androidåˆ·æ–°ä¸ç»˜åˆ¶æœºåˆ¶è¯¦è§£ ç¬”è®°"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-05T01:53:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¿ƒæºxinyuan"/> <meta itemprop="url" content="https://juejin.cn/user/4283353029151694"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Androidåˆ·æ–°ä¸ç»˜åˆ¶æœºåˆ¶è¯¦è§£ ç¬”è®°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4283353029151694/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¿ƒæºxinyuan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T01:53:11.000Z" title="Mon Jan 05 2026 01:53:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€åˆ·æ–°æœºåˆ¶ï¼ˆVSYNCä¸åŒç¼“å†²/ä¸‰ç¼“å†²ï¼‰</h2>
<h3 data-id="heading-1">1. VSYNCä¿¡å·</h3>
<ul>
<li>
<p><strong>ä½œç”¨</strong>ï¼šå‚ç›´åŒæ­¥ä¿¡å·ï¼Œå±å¹•åˆ·æ–°å‘¨æœŸï¼ˆé€šå¸¸60Hz = 16.67msï¼‰</p>
</li>
<li>
<p><strong>ç±»å‹</strong>ï¼š</p>
<ul>
<li><strong>HW-VSYNC</strong>ï¼šç¡¬ä»¶äº§ç”Ÿ</li>
<li><strong>SW-VSYNC</strong>ï¼šè½¯ä»¶æ¨¡æ‹Ÿ</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">2. åŒç¼“å†²æœºåˆ¶</h3>
<p>java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ä¼ ç»ŸåŒç¼“å†²é—®é¢˜</span>
å¸§<span class="hljs-number">1</span>ï¼šCPUè®¡ç®— â†’ GPUæ¸²æŸ“ â†’ æ˜¾ç¤º
å¸§<span class="hljs-number">2</span>ï¼šCPUè®¡ç®— â†’ GPUæ¸²æŸ“ â†’ æ˜¾ç¤º
<span class="hljs-comment">// å¦‚æœæ¸²æŸ“è¶…è¿‡16.67msï¼Œä¼šæ‰å¸§</span>
</code></pre>
<h3 data-id="heading-3">3. Project Butterå¼•å…¥çš„æ”¹è¿›</h3>
<ul>
<li><strong>VSYNCåŒæ­¥</strong>ï¼šæ‰€æœ‰ç»˜åˆ¶ä¸VSYNCå¯¹é½</li>
<li><strong>ä¸‰ç¼“å†²</strong>ï¼šå¢åŠ ä¸€ä¸ªç¼“å†²åŒºå‡å°‘ç­‰å¾…</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ä¸‰ç¼“å†²æµç¨‹</span>
VSYNC <span class="hljs-number">1</span>ï¼šCPUè®¡ç®—å¸§<span class="hljs-number">1</span> â†’ GPUæ¸²æŸ“å¸§<span class="hljs-number">1</span>
VSYNC <span class="hljs-number">2</span>ï¼šCPUè®¡ç®—å¸§<span class="hljs-number">2</span> â†’ GPUæ¸²æŸ“å¸§<span class="hljs-number">2</span>
VSYNC <span class="hljs-number">3</span>ï¼šCPUè®¡ç®—å¸§<span class="hljs-number">3</span> â†’ GPUæ¸²æŸ“å¸§<span class="hljs-number">3</span>
<span class="hljs-comment">// åŒæ—¶GPUå¯ä»¥å¹¶è¡Œå¤„ç†ä¸åŒå¸§</span>
</code></pre>
<h2 data-id="heading-4">äºŒã€ç»˜åˆ¶æœºåˆ¶ï¼ˆViewç»˜åˆ¶æµç¨‹ï¼‰</h2>
<h3 data-id="heading-5">1. ç»˜åˆ¶ä¸‰å¤§æ­¥éª¤</h3>
<p>java</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ViewRootImpl.performTraversals()è§¦å‘</span>
<span class="hljs-number">1</span>. Measure (æµ‹é‡)
<span class="hljs-number">2</span>. Layout (å¸ƒå±€)
<span class="hljs-number">3</span>. Draw (ç»˜åˆ¶)
</code></pre>
<h3 data-id="heading-6">2. Measureè¿‡ç¨‹</h3>
<p>java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-type">void</span> <span class="hljs-title">onMeasure</span><span class="hljs-params">(<span class="hljs-type">int</span> widthMeasureSpec, <span class="hljs-type">int</span> heightMeasureSpec)</span> </span>{
    <span class="hljs-comment">// 1. æ ¹æ®çˆ¶å®¹å™¨çš„MeasureSpecå’Œè‡ªèº«LayoutParamsè®¡ç®—</span>
    <span class="hljs-comment">// 2. æµ‹é‡å­View</span>
    <span class="hljs-comment">// 3. è®¾ç½®æœ€ç»ˆå°ºå¯¸setMeasuredDimension()</span>
}
</code></pre>
<p><strong>MeasureSpecç»„æˆ</strong>ï¼š</p>
<ul>
<li>
<p><strong>é«˜2ä½</strong>ï¼šæµ‹é‡æ¨¡å¼</p>
<ul>
<li>UNSPECIFIEDï¼šçˆ¶å®¹å™¨ä¸é™åˆ¶</li>
<li>EXACTLYï¼šç²¾ç¡®å€¼ï¼ˆmatch_parentæˆ–å…·ä½“æ•°å€¼ï¼‰</li>
<li>AT_MOSTï¼šæœ€å¤§ä¸è¶…è¿‡ï¼ˆwrap_contentï¼‰</li>
</ul>
</li>
<li>
<p><strong>ä½30ä½</strong>ï¼šæµ‹é‡å€¼</p>
</li>
</ul>
<h3 data-id="heading-7">3. Layoutè¿‡ç¨‹</h3>
<p>java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-type">void</span> <span class="hljs-title">onLayout</span><span class="hljs-params">(<span class="hljs-type">boolean</span> changed, <span class="hljs-type">int</span> l, <span class="hljs-type">int</span> t, <span class="hljs-type">int</span> r, <span class="hljs-type">int</span> b)</span> </span>{
    <span class="hljs-comment">// ç¡®å®šViewè‡ªèº«ä½ç½®</span>
    <span class="hljs-comment">// ç¡®å®šå­Viewä½ç½®ï¼ˆå¦‚æœæ˜¯ViewGroupï¼‰</span>
}
</code></pre>
<h3 data-id="heading-8">4. Drawè¿‡ç¨‹</h3>
<p>java</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params">Canvas canvas</span>) {
    <span class="hljs-comment">// ç»˜åˆ¶é¡ºåºï¼š</span>
    <span class="hljs-comment">// 1. ç»˜åˆ¶èƒŒæ™¯ (drawBackground)</span>
    <span class="hljs-comment">// 2. å¦‚æœéœ€è¦ï¼Œä¿å­˜å›¾å±‚</span>
    <span class="hljs-comment">// 3. ç»˜åˆ¶å†…å®¹ (onDraw)</span>
    <span class="hljs-comment">// 4. ç»˜åˆ¶å­View (dispatchDraw)</span>
    <span class="hljs-comment">// 5. ç»˜åˆ¶è£…é¥°ï¼ˆæ»šåŠ¨æ¡ç­‰ï¼‰</span>
    <span class="hljs-comment">// 6. ç»˜åˆ¶å‰æ™¯</span>
}
</code></pre>
<h2 data-id="heading-9">ä¸‰ã€Choreographeræ ¸å¿ƒè°ƒåº¦å™¨</h2>
<h3 data-id="heading-10">1. ä¸»è¦ä½œç”¨</h3>
<p>java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// åè°ƒVSYNCä¸ç»˜åˆ¶æµç¨‹</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Choreographer</span> {
    <span class="hljs-comment">// ä¸‰ç§å›è°ƒç±»å‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> CALLBACK_INPUT = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> CALLBACK_ANIMATION = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> CALLBACK_TRAVERSAL = <span class="hljs-number">2</span>; <span class="hljs-comment">// ç»˜åˆ¶å›è°ƒ</span>
    
    <span class="hljs-comment">// æ³¨å†ŒVSYNCå›è°ƒ</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">postFrameCallback</span><span class="hljs-params">(FrameCallback callback)</span></span>;
}
</code></pre>
<h3 data-id="heading-11">2. ç»˜åˆ¶è°ƒç”¨é“¾</h3>
<pre><code class="hljs language-scss" lang="scss">Choreographer<span class="hljs-selector-class">.postFrameCallback</span>()
    â†“
VSYNCä¿¡å·åˆ°æ¥
    â†“
Choreographer<span class="hljs-selector-class">.doFrame</span>()
    â†“
ViewRootImpl<span class="hljs-selector-class">.performTraversals</span>()
    â†“
View<span class="hljs-selector-class">.measure</span>() â†’ View<span class="hljs-selector-class">.layout</span>() â†’ View<span class="hljs-selector-class">.draw</span>()
</code></pre>
<h2 data-id="heading-12">å››ã€ç¡¬ä»¶åŠ é€Ÿ vs è½¯ä»¶ç»˜åˆ¶</h2>
<h3 data-id="heading-13">1. è½¯ä»¶ç»˜åˆ¶</h3>
<ul>
<li><strong>Canvas</strong>ï¼šSkia 2Då›¾å½¢åº“</li>
<li><strong>DisplayList</strong>ï¼šæ— ï¼Œç›´æ¥ç»˜åˆ¶</li>
<li><strong>æ¸²æŸ“</strong>ï¼šCPUå®Œæˆ</li>
</ul>
<h3 data-id="heading-14">2. ç¡¬ä»¶åŠ é€Ÿï¼ˆAndroid 3.0+ï¼‰</h3>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">// å¼€å¯ç¡¬ä»¶åŠ é€Ÿ
android:<span class="hljs-attr">hardwareAccelerated</span>=<span class="hljs-string">"true"</span>
</code></pre>
<p><strong>ç¡¬ä»¶åŠ é€Ÿæµç¨‹</strong>ï¼š</p>
<p>text</p>
<pre><code class="hljs language-scss" lang="scss">View<span class="hljs-selector-class">.draw</span>() â†’ ç”ŸæˆDisplayList â†’ ä¸Šä¼ GPU â†’ GPUæ¸²æŸ“
</code></pre>
<p><strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>GPUå¹¶è¡Œå¤„ç†</li>
<li>æ”¯æŒå±æ€§åŠ¨ç”»ä¼˜åŒ–</li>
<li>DisplayListé‡ç”¨</li>
</ul>
<h2 data-id="heading-15">äº”ã€å®Œæ•´ç»˜åˆ¶æµç¨‹æ—¶åº</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dfba65bf6f5240e4a01023d0c29eba09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5b-D5rqQeGlueXVhbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768182790&amp;x-signature=f5ahRT84VV6tZnKiFYZ%2FVRPpkFs%3D" alt="deepseek_mermaid_20260105_b325ce.png" loading="lazy"/></p>
<h2 data-id="heading-16">å…­ã€æ€§èƒ½ä¼˜åŒ–å…³é”®ç‚¹</h2>
<h3 data-id="heading-17">1. å‡å°‘ç»˜åˆ¶èŒƒå›´</h3>
<p>java</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ä½¿ç”¨setWillNotDraw(true)è·³è¿‡ä¸å¿…è¦çš„ç»˜åˆ¶</span>
if (èƒŒæ™¯é€æ˜ &amp;&amp; æ²¡æœ‰è¦†ç›–onDraw) {
    <span class="hljs-built_in">setWillNotDraw</span>(true);
}
</code></pre>
<h3 data-id="heading-18">2. é¿å…è¿‡åº¦ç»˜åˆ¶</h3>
<p>xml</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- å¼€å¯è°ƒè¯• --&gt;</span>
<span class="hljs-comment">&lt;!-- 1. è“è‰²ï¼šç»˜åˆ¶1æ¬¡ --&gt;</span>
<span class="hljs-comment">&lt;!-- 2. ç»¿è‰²ï¼šç»˜åˆ¶2æ¬¡ --&gt;</span>
<span class="hljs-comment">&lt;!-- 3. æ·¡çº¢ï¼šç»˜åˆ¶3æ¬¡ --&gt;</span>
<span class="hljs-comment">&lt;!-- 4. æ·±çº¢ï¼šç»˜åˆ¶4æ¬¡+ --&gt;</span>
</code></pre>
<h3 data-id="heading-19">3. ä½¿ç”¨RenderThreadï¼ˆAndroid 5.0+ï¼‰</h3>
<p>java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// UIçº¿ç¨‹ï¼šç”ŸæˆDisplayList</span>
<span class="hljs-comment">// RenderThreadï¼šä¸Šä¼ GPUï¼Œæ‰§è¡Œæ¸²æŸ“</span>
</code></pre>
<h3 data-id="heading-20">4. ä¼˜åŒ–å»ºè®®</h3>
<ul>
<li><strong>å‡å°‘Viewå±‚çº§</strong>ï¼šä½¿ç”¨ConstraintLayout</li>
<li><strong>é¿å…é¢‘ç¹requestLayout()</strong></li>
<li><strong>ä½¿ç”¨ViewStubå»¶è¿ŸåŠ è½½</strong></li>
<li><strong>å¤ç”¨ConvertView</strong></li>
<li><strong>å…³é—­ä¸éœ€è¦çš„ç¡¬ä»¶åŠ é€Ÿ</strong></li>
</ul>
<h2 data-id="heading-21">ä¸ƒã€æ€»ç»“</h2>
<p>Androidåˆ·æ–°ç»˜åˆ¶æœºåˆ¶çš„æ ¸å¿ƒæ˜¯ï¼š</p>
<ol>
<li><strong>VSYNCåŒæ­¥</strong>ç¡®ä¿æµç•…æ€§</li>
<li><strong>Choreographer</strong>åè°ƒè°ƒåº¦</li>
<li><strong>Measure-Layout-Draw</strong>ä¸‰æ­¥ç»˜åˆ¶</li>
<li><strong>ç¡¬ä»¶åŠ é€Ÿ</strong>æå‡æ€§èƒ½</li>
</ol>
<p>ç†è§£è¿™å¥—æœºåˆ¶æœ‰åŠ©äºï¼š</p>
<ul>
<li>é¿å…å¡é¡¿å’Œæ‰å¸§</li>
<li>ä¼˜åŒ–åº”ç”¨æ€§èƒ½</li>
<li>å®ç°æµç•…çš„åŠ¨ç”»æ•ˆæœ</li>
<li>æ­£ç¡®ä½¿ç”¨å„ç§UIç»„ä»¶</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[çµåŠ¨å¦‚ç”» â€”â€” åˆè¯† Solon Graph Fluent API ç¼–æ’]]></title>    <link>https://juejin.cn/post/7591421956216455206</link>    <guid>https://juejin.cn/post/7591421956216455206</guid>    <pubDate>2026-01-05T01:45:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591421956216455206" data-draft-id="7591406727138181146" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="çµåŠ¨å¦‚ç”» â€”â€” åˆè¯† Solon Graph Fluent API ç¼–æ’"/> <meta itemprop="keywords" content="Java,Workflow,OpenAI"/> <meta itemprop="datePublished" content="2026-01-05T01:45:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‰é±¼çš„çŒ«"/> <meta itemprop="url" content="https://juejin.cn/user/409464125003639"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            çµåŠ¨å¦‚ç”» â€”â€” åˆè¯† Solon Graph Fluent API ç¼–æ’
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/409464125003639/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‰é±¼çš„çŒ«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T01:45:31.000Z" title="Mon Jan 05 2026 01:45:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Solon Flow åœ¨æä¾› json/ xml ç¼–æ’ä¹‹åã€‚è¿˜æä¾›äº†ä¸€å¥—æä¸ºä¸æ»‘çš„æµç¨‹å›¾ Fluent APIã€‚å®ƒè®©æµç¨‹å®šä¹‰å›å½’åˆ°ç¨‹åºå‘˜æœ€ç†Ÿæ‚‰çš„å·¥å…·â€”â€”ä»£ç ã€‚</p>
<p>é€šè¿‡ Fluent APIï¼Œä½ å¯ä»¥åƒå†™ Java Stream ä¸€æ ·ï¼Œé€šè¿‡é“¾å¼è°ƒç”¨å¿«é€Ÿå‹¾å‹’å‡ºä¸šåŠ¡æµè½¬å›¾ã€‚</p>
<h3 data-id="heading-0">1ã€ç¯å¢ƒå‡†å¤‡</h3>
<p>é¦–å…ˆï¼Œç¡®ä¿ä½ çš„ Java é¡¹ç›®ä¸­å·²ç»å¼•å…¥äº† solon-flow ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.noear<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>solon-flow<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-1">2ã€æ ¸å¿ƒæ¦‚å¿µï¼šGraph ä¸ GraphSpec</h3>
<p>åœ¨åŠ¨æ‰‹å†™ä»£ç å‰ï¼Œéœ€è¦ç†è§£ä¸¤ä¸ªå…³é”®æ¦‚å¿µï¼š</p>
<ul>
<li>Graph (å›¾)ï¼šæµç¨‹çš„æœ€ç»ˆå®ä½“ï¼ŒåŒ…å«æ‰€æœ‰èŠ‚ç‚¹å’Œè¿çº¿çš„è¿è¡Œé€»è¾‘ã€‚</li>
<li>GraphSpec (å›¾è§„æ ¼/å®šä¹‰)ï¼šå®ƒæ˜¯æ„å»ºå›¾çš„â€œè“å›¾â€ã€‚åœ¨ v3.8 ä¹‹åï¼Œå®ƒæ˜¯ Fluent API æ“ä½œçš„æ ¸å¿ƒå¯¹è±¡ã€‚</li>
</ul>
<h3 data-id="heading-2">3ã€ å®æˆ˜ï¼šæ‰‹åŠ¨ç¼–æ’ä¸€ä¸ªâ€œè®¢å•å¤„ç†æµâ€</h3>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„è®¢å•æµç¨‹ï¼šå¼€å§‹ -&gt; æ£€æŸ¥åº“å­˜ -&gt; æ”¯ä»˜ -&gt; ç»“æŸã€‚</p>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡ä¸šåŠ¡å¤„ç†ç»„ä»¶ï¼ˆï¼‰</li>
</ul>
<p>Solon-flow çš„è®¾è®¡ç†å¿µæ˜¯ <strong>â€œé€»è¾‘ä¸å®ç°åˆ†ç¦»â€</strong>ã€‚ æˆ‘ä»¬å…ˆå®šä¹‰å…·ä½“çš„ä¸šåŠ¡åŠ¨ä½œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.noear.solon.annotation.Component;
<span class="hljs-keyword">import</span> org.noear.solon.flow.FlowContext;
<span class="hljs-keyword">import</span> org.noear.solon.flow.Node;
<span class="hljs-keyword">import</span> org.noear.solon.flow.TaskComponent;

<span class="hljs-comment">// å®¹å™¨ Bean çš„å½¢å¼ï¼ˆæ­¤å¤„ä»¥ Solon ä¸ºä¾‹ï¼‰</span>
<span class="hljs-meta">@Component("checkStock")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CheckStockProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TaskComponent</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(FlowContext ctx, Node node)</span> <span class="hljs-keyword">throws</span> Throwable {
        System.out.println(<span class="hljs-string">"--- æ­£åœ¨æ£€æŸ¥åº“å­˜... ---"</span>);
        ctx.put(<span class="hljs-string">"stock_ok"</span>, <span class="hljs-literal">true</span>); <span class="hljs-comment">// åœ¨ä¸Šä¸‹æ–‡ä¸­å­˜å…¥ç»“æœ</span>
    }
}

<span class="hljs-comment">//-------------</span>

<span class="hljs-comment">// æ™®é€š Java ç±»å½¢å¼</span>
<span class="hljs-keyword">import</span> org.noear.solon.annotation.Component;
<span class="hljs-keyword">import</span> org.noear.solon.flow.FlowContext;
<span class="hljs-keyword">import</span> org.noear.solon.flow.Node;
<span class="hljs-keyword">import</span> org.noear.solon.flow.TaskComponent;


<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PayProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">TaskComponent</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(FlowContext context, Node node)</span> <span class="hljs-keyword">throws</span> Throwable {
        System.out.println(<span class="hljs-string">"--- æ”¯ä»˜æˆåŠŸï¼ ---"</span>);
    }
}
</code></pre>
<ul>
<li>ç¬¬äºŒæ­¥ï¼šä½¿ç”¨ Fluent API ç¼–æ’æµç¨‹</li>
</ul>
<p>ä¸‹é¢æ˜¯æœ¬æ–‡çš„æ ¸å¿ƒä»£ç ã€‚æˆ‘ä»¬é€šè¿‡ Graph.create å¯åŠ¨ç¼–æ’ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.noear.solon.flow.Graph;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FlowConfig</span> {

    <span class="hljs-keyword">public</span> Graph <span class="hljs-title function_">buildOrderFlow</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä½¿ç”¨ Fluent API æ„å»º</span>
        <span class="hljs-keyword">return</span> Graph.create(<span class="hljs-string">"order_flow"</span>, <span class="hljs-string">"è®¢å•å¤„ç†æµç¨‹"</span>, spec -&gt; {
            <span class="hljs-comment">// 1. å®šä¹‰å¼€å§‹èŠ‚ç‚¹å¹¶è¿æ¥åˆ°ä¸‹ä¸€ä¸ª</span>
            spec.addStart(<span class="hljs-string">"n1"</span>).title(<span class="hljs-string">"å¼€å§‹"</span>).linkAdd(<span class="hljs-string">"n2"</span>);

            <span class="hljs-comment">// 2. å®šä¹‰ä¸šåŠ¡èŠ‚ç‚¹ï¼Œç»‘å®šå¯¹åº”çš„ Bean æ ‡è¯†</span>
            spec.addActivity(<span class="hljs-string">"n2"</span>)
                    .title(<span class="hljs-string">"åº“å­˜æ£€æŸ¥"</span>)
                    .task(<span class="hljs-string">"@checkStock"</span>) <span class="hljs-comment">// å…³è”ä¸Šé¢å®šä¹‰çš„ Beanï¼ˆä»å®¹å™¨è·å–ï¼‰</span>
                    .linkAdd(<span class="hljs-string">"n3"</span>);

            spec.addActivity(<span class="hljs-string">"n3"</span>)
                    .title(<span class="hljs-string">"æ”¯ä»˜"</span>)
                    .task(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PayProcessor</span>()) <span class="hljs-comment">//ç¡¬ç¼–ç æ–¹å¼ï¼ˆä¸ç”¨ç»è¿‡å®¹å™¨ï¼‰</span>
                    .linkAdd(<span class="hljs-string">"n4"</span>);

            <span class="hljs-comment">// 3. å®šä¹‰ç»“æŸèŠ‚ç‚¹</span>
            spec.addEnd(<span class="hljs-string">"n4"</span>).title(<span class="hljs-string">"ç»“æŸ"</span>);
        });
    }
}
</code></pre>
<h3 data-id="heading-3">4ã€å…³é”® API æ·±åº¦è§£æ</h3>
<ul>
<li><code>spec.addStart(id) / addEnd(id)</code>ï¼šå®šä¹‰æµç¨‹çš„è¾¹ç•Œã€‚æ¯ä¸€ä¸ªå›¾å¿…é¡»æœ‰ä¸”åªæœ‰ä¸€ä¸ª Start èŠ‚ç‚¹ï¼Œå¯ä»¥æœ‰å¤šä¸ª End èŠ‚ç‚¹ã€‚</li>
<li><code>spec.addActivity(id)</code>ï¼šè¿™æ˜¯æœ€å¸¸ç”¨çš„èŠ‚ç‚¹ï¼Œä»£è¡¨ä¸€ä¸ªå…·ä½“ä»»åŠ¡ã€‚</li>
<li><code>.task("@beanName")</code>ï¼šè¿™æ˜¯æ ¸å¿ƒè”åŠ¨ç‚¹ã€‚@ ç¬¦å·å‘Šè¯‰ Solon å»å®¹å™¨ä¸­å¯»æ‰¾å¯¹åº”çš„å¤„ç†å™¨ã€‚</li>
<li><code>.linkAdd(targetId)</code>ï¼šæœ€ç®€å•çš„å•å‘è¿çº¿ã€‚å®ƒå»ºç«‹äº†ä¸€ä¸ªä»å½“å‰èŠ‚ç‚¹åˆ°ç›®æ ‡èŠ‚ç‚¹çš„ç›´æ¥æµè½¬ã€‚</li>
</ul>
<h3 data-id="heading-4">5ã€å¦‚ä½•è¿è¡Œè¿™ä¸ªå›¾ï¼Ÿ</h3>
<p>æœ‰äº† Graph å¯¹è±¡åï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ FlowEngine æ¥è§¦å‘å®ƒï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.noear.solon.annotation.Component;
<span class="hljs-keyword">import</span> org.noear.solon.annotation.Inject;
<span class="hljs-keyword">import</span> org.noear.solon.flow.FlowContext;
<span class="hljs-keyword">import</span> org.noear.solon.flow.FlowEngine;
<span class="hljs-keyword">import</span> org.noear.solon.flow.Graph;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-meta">@Inject</span>
    FlowEngine flowEngine;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrder</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. æ„å»ºå›¾ï¼ˆå®é™…ç”Ÿäº§ä¸­é€šå¸¸ä¼šç¼“å­˜æ­¤å¯¹è±¡ï¼‰</span>
        <span class="hljs-type">Graph</span> <span class="hljs-variable">orderGraph</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FlowConfig</span>().buildOrderFlow();

        <span class="hljs-comment">// 2. å‡†å¤‡æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆå¯ä»¥æºå¸¦ä¸šåŠ¡å‚æ•°ï¼‰</span>
        <span class="hljs-type">FlowContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> FlowContext.of(<span class="hljs-string">"ORD-20231024"</span>);

        <span class="hljs-comment">// 3. æ‰§è¡Œæµç¨‹</span>
        flowEngine.eval(orderGraph, context);
    }
}
</code></pre>
<h3 data-id="heading-5">æ€»ç»“ä¸é¢„å‘Š</h3>
<p>é€šè¿‡æœ¬æ–‡ï¼Œä½ å·²ç»å­¦ä¼šäº†å¦‚ä½•ä¸ä¾èµ–ä»»ä½•é…ç½®æ–‡ä»¶ï¼Œçº¯æ‰‹å·¥åœ¨å†…å­˜ä¸­â€œç”»â€å‡ºä¸€ä¸ªæµç¨‹å›¾ã€‚è¿™ç§æ–¹å¼æå¤§åœ°æé«˜äº†ä»£ç çš„å¯è¯»æ€§ï¼Œå¹¶ä¸”è®©â€œæµç¨‹å®šä¹‰â€æœ¬èº«ä¹Ÿæˆä¸ºäº†ç±»å‹å®‰å…¨çš„ä»£ç ã€‚</p>
<p>ä½†æ˜¯ï¼Œç°å®ä¸­çš„æµç¨‹å¾€å¾€ä¸æ˜¯ä¸€æ¡ç›´çº¿ã€‚ å¦‚æœåº“å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿå¦‚æœé‡‘é¢å·¨å¤§éœ€è¦äººå·¥å®¡æ‰¹æ€ä¹ˆåŠï¼Ÿ</p>
<p>åœ¨åé¢çš„ <strong>ã€Šé€»è¾‘ä¹‹é­‚ â€”â€” èŠ‚ç‚¹çš„â€œæ¡ä»¶æµè½¬â€ä¸è¡¨è¾¾å¼ã€‹</strong> ä¸­ï¼Œæˆ‘ä»¬å°†å¼•å…¥â€œåˆ†æ”¯åˆ¤æ–­â€ï¼Œè®©ä½ çš„ Graph çœŸæ­£å…·å¤‡å¤„ç†å¤æ‚ä¸šåŠ¡çš„èƒ½åŠ›ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI åŠ©åŠ› Android å·¥ç¨‹åŒ–å®è·µï¼šï¼ˆä¸‰ï¼‰è‡ªå»º MCP Serverï¼šè®©å¤§æ¨¡å‹æ¥å…¥å†…éƒ¨çŸ¥è¯†åº“]]></title>    <link>https://juejin.cn/post/7591510742634364991</link>    <guid>https://juejin.cn/post/7591510742634364991</guid>    <pubDate>2026-01-04T16:38:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591510742634364991" data-draft-id="7591510742634348607" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI åŠ©åŠ› Android å·¥ç¨‹åŒ–å®è·µï¼šï¼ˆä¸‰ï¼‰è‡ªå»º MCP Serverï¼šè®©å¤§æ¨¡å‹æ¥å…¥å†…éƒ¨çŸ¥è¯†åº“"/> <meta itemprop="keywords" content="AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-04T16:38:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°è‚¥æŸ´"/> <meta itemprop="url" content="https://juejin.cn/user/3808364010678599"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI åŠ©åŠ› Android å·¥ç¨‹åŒ–å®è·µï¼šï¼ˆä¸‰ï¼‰è‡ªå»º MCP Serverï¼šè®©å¤§æ¨¡å‹æ¥å…¥å†…éƒ¨çŸ¥è¯†åº“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808364010678599/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°è‚¥æŸ´
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T16:38:37.000Z" title="Sun Jan 04 2026 16:38:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">AI åŠ©åŠ› Android å·¥ç¨‹åŒ–å®è·µï¼šï¼ˆä¸‰ï¼‰è‡ªå»º MCP Serverï¼šè®©å¤§æ¨¡å‹æ¥å…¥å†…éƒ¨çŸ¥è¯†åº“</h2>
<p><em>â€”â€” è®© AI ä¸å†â€œå‡­æ„Ÿè§‰å›ç­”â€ï¼Œè€Œæ˜¯åŸºäºä½ çš„å†…éƒ¨æ–‡æ¡£ç»™å‡ºå¯è½åœ°çš„ç»“è®ºä¸ä»£ç </em></p>
<hr/>
<p>githubåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSSSYoung%2Fandroid-vibe-coding" target="_blank" title="https://github.com/SSSYoung/android-vibe-coding" ref="nofollow noopener noreferrer">github.com/SSSYoung/anâ€¦</a>  è§‰å¾—è¿˜ä¸é”™çš„è¯ï¼Œéº»çƒ¦ç»™ä¸ªæ˜Ÿã€‚</p>
<h3 data-id="heading-1">1. èƒŒæ™¯</h3>
<p>å¼€å±€ä¸€å¼ å›¾
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21158ad8f7334481b3b28f2172ee46a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6IKl5p-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186644&amp;x-signature=rmSTplCa4ug6OhMq8C0nv8d%2FerI%3D" alt="56e6e8c3c651f116e517547b9c79cc0f.jpg" loading="lazy"/></p>
<p>å¤§æ¨¡å‹æ‡‚å…¬ç½‘çŸ¥è¯†ï¼Œä½†çœ‹ä¸è§ä½ çš„å†…éƒ¨æ¥å£æ–‡æ¡£ã€ç§æœ‰ SDKã€å›¢é˜Ÿè§„èŒƒï¼›ä½ ä¸€æ—¦é—®â€œå†…éƒ¨é—®é¢˜â€ï¼Œå®ƒå°±å¯èƒ½å¼€å§‹â€œçŒœâ€ï¼Œç”šè‡³ç¼–é€ æ¥å£/å­—æ®µã€‚</p>
<p>å…¸å‹é£é™©ï¼š</p>
<ul>
<li>ç¼–é€ ä¸å­˜åœ¨çš„æ¥å£ã€å‚æ•°ã€è¿”å›ç»“æ„ï¼Œè”è°ƒç›´æ¥ç¿»è½¦</li>
<li>æŠŠå…¬ç½‘æœ€ä½³å®è·µå½“æˆå†…éƒ¨è§„èŒƒï¼Œå¯¼è‡´è¿”å·¥ä¸è§„èŒƒå¤±å®ˆ</li>
</ul>
<p>æœ¬æ–‡è¦åšçš„äº‹å¾ˆç®€å•ï¼šè‡ªå»ºä¸€ä¸ª MCP Serverï¼ŒæŠŠæœ¬åœ°/å†…ç½‘å†…éƒ¨æ–‡æ¡£â€œæ¥å…¥â€åˆ°å¤§æ¨¡å‹ï¼Œè®©å›ç­”åŸºäºæ£€ç´¢åˆ°çš„æ–‡æ¡£ç‰‡æ®µè€Œä¸æ˜¯å‡­ç©ºå‘æŒ¥ã€‚</p>
<hr/>
<h3 data-id="heading-2">2. å…·ä½“å®è·µï¼šè‡ªå»º MCP Server æ¥å…¥å†…éƒ¨çŸ¥è¯†åº“</h3>
<blockquote>
<p>è¿™ä¸€ç« ç”¨ <code>demo/mcp-server/server.py</code> è¿™ä¸ªæœ€å°ä¾‹å­ï¼Œæ¼”ç¤ºå¦‚ä½•æŠŠæœ¬åœ°/å†…ç½‘æ–‡æ¡£æ¥å…¥åˆ°å¤§æ¨¡å‹ï¼Œè®©æ¨¡å‹å›ç­”å‰å…ˆâ€œæŸ¥å†…éƒ¨èµ„æ–™â€ã€‚</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51ef318900884decbf784d46a42966f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6IKl5p-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186644&amp;x-signature=gTzElEE%2F5H5wIikNvhqoiPfusl4%3D" alt="mcp_local_kb_flow.svg" loading="lazy"/></p>
<h4 data-id="heading-3">2.1 å‡†å¤‡è¿è¡Œç¯å¢ƒ</h4>
<p>è¿™ä¸ª Demo ç”¨ Python å®ç°ï¼Œæ ¸å¿ƒä¾èµ–ï¼š</p>
<ul>
<li><code>mcp</code>ï¼šMCP Server æ¡†æ¶ï¼ˆFastMCPï¼‰</li>
<li><code>pypdf</code>ï¼ˆæˆ– <code>PyPDF2</code>ï¼‰ï¼šè§£æ PDF æ–‡æœ¬</li>
</ul>
<p>å®‰è£…ç¤ºä¾‹ï¼ˆæŒ‰ä½ çš„ç¯å¢ƒè°ƒæ•´ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pip install mcp pypdf
</code></pre>

<h4 data-id="heading-4">2.2 ç¼–å†™ MCP Serverï¼ˆæ ¸å¿ƒä»£ç ï¼‰</h4>
<p>MCP Server çš„ç›®æ ‡å¾ˆç®€å•ï¼šæä¾›ä¸€ä¸ªå·¥å…· <code>search_internal_docs(query)</code>ï¼ŒæŠŠå†…éƒ¨æ–‡æ¡£é‡Œæœ€ç›¸å…³çš„ç‰‡æ®µè¿”å›ç»™å¤§æ¨¡å‹ä½œä¸ºä¸Šä¸‹æ–‡ã€‚</p>
<p><strong>1ï¼‰å®šä¹‰ MCP æœåŠ¡ä¸æ–‡æ¡£ç›®å½•</strong></p>
<p><code>demo/mcp-server/server.py</code>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path
<span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> mcp.server.fastmcp <span class="hljs-keyword">import</span> FastMCP

mcp = FastMCP(<span class="hljs-string">"AndroidTeamKnowledge"</span>)

BASE_DIR = Path(os.environ.get(<span class="hljs-string">"KNOWLEDGE_BASE_DIR"</span>, Path(__file__).resolve().parent.parent))
DOC_DIR = Path(os.environ.get(<span class="hljs-string">"KNOWLEDGE_PDF_DIR"</span>, BASE_DIR / <span class="hljs-string">"internal_docs"</span>))
</code></pre>
<p><strong>2ï¼‰PDF/TXT è¯»å–ï¼ˆå…¼å®¹ pypdf / PyPDF2ï¼‰</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_extract_text</span>(<span class="hljs-params">pdf_path: Path</span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-keyword">try</span>:
        <span class="hljs-keyword">import</span> pypdf <span class="hljs-keyword">as</span> pdf_lib
    <span class="hljs-keyword">except</span> Exception:
        <span class="hljs-keyword">import</span> PyPDF2 <span class="hljs-keyword">as</span> pdf_lib

    reader = pdf_lib.PdfReader(<span class="hljs-built_in">str</span>(pdf_path))
    <span class="hljs-keyword">return</span> <span class="hljs-string">"\n"</span>.join(page.extract_text() <span class="hljs-keyword">or</span> <span class="hljs-string">""</span> <span class="hljs-keyword">for</span> page <span class="hljs-keyword">in</span> reader.pages)
</code></pre>
<p><strong>3ï¼‰å¯¹å¤–æš´éœ²æ£€ç´¢å·¥å…·ï¼š<code>search_internal_docs</code></strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@mcp.tool()</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">search_internal_docs</span>(<span class="hljs-params">query: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> _DOCS:
        _build_index()
    tokens = _tokenize(query)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> tokens:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"No query tokens found."</span>

    ranked = <span class="hljs-built_in">sorted</span>(
        ((name, chunk, _score(tokens, chunk)) <span class="hljs-keyword">for</span> name, chunk <span class="hljs-keyword">in</span> _DOCS),
        key=<span class="hljs-keyword">lambda</span> item: item[<span class="hljs-number">2</span>],
        reverse=<span class="hljs-literal">True</span>,
    )
    top_hits = [item <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> ranked <span class="hljs-keyword">if</span> item[<span class="hljs-number">2</span>] &gt; <span class="hljs-number">0</span>][:<span class="hljs-number">3</span>]
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> top_hits:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"No relevant passages found."</span>

    lines = []
    <span class="hljs-keyword">for</span> name, chunk, score <span class="hljs-keyword">in</span> top_hits:
        lines.append(<span class="hljs-string">f"[<span class="hljs-subst">{name}</span>] score=<span class="hljs-subst">{score}</span>"</span>)
        lines.append(chunk)
        lines.append(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-string">"\n"</span>.join(lines).strip()
</code></pre>
<blockquote>
<p>ä½ ä¸éœ€è¦ä¸€å¼€å§‹å°±ä¸Šâ€œå‘é‡åº“ + RAG å…¨å®¶æ¡¶â€ã€‚å…ˆæŠŠâ€œå†…éƒ¨æ–‡æ¡£å¯æ£€ç´¢ã€å¯è¢«å¤§æ¨¡å‹å¼•ç”¨â€è·‘é€šï¼Œæ”¶ç›Šç«‹ç«¿è§å½±ã€‚</p>
</blockquote>

<h4 data-id="heading-5">2.3 åœ¨ Cursor ä¸­æ¥å…¥ MCP Server</h4>
<p>åœ¨ Cursor çš„ <code>mcp.json</code> æ·»åŠ ä¸€ä¸ªæœ¬åœ° MCP Server é…ç½®ï¼ˆç¤ºä¾‹ï¼‰ã€‚ä¸‹é¢æ˜¯æˆ‘åœ¨æœ¬é¡¹ç›®é‡Œçš„å®é™…é…ç½®ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"androidTeamKnowledge"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"E:\\codeStation\\android-vibe-coding\\demo\\mcp-server\\server.py"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"E:\\codeStation\\android-vibe-coding\\demo\\venv\\Scripts\\python.exe"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"disabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"KNOWLEDGE_PDF_DIR"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"E:\\codeStation\\android-vibe-coding\\demo\\internal_docs"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æœ¬åœ°å•ç‹¬å¯åŠ¨ï¼ˆç”¨äºæ’æŸ¥ç¯å¢ƒé—®é¢˜ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">python demo/mcp-server/server.py
</code></pre>
<p>æˆ‘çš„Cursor é¢åº¦ç”¨å®Œäº†ï¼Œæ‰€ä»¥æˆ‘å°±ç”¨windsurf åšä¸ªç¤ºèŒƒğŸ˜…ğŸ§ªï¼Œç»¿ç¯äº®èµ·ï¼Œè¯´æ˜MCP Server å·²ç»è¿é€šï¼Œç¯å¢ƒå°±ç»ªã€‚å¯ä»¥å¼€å§‹è°ƒç”¨å·¥å…·äº†ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a635413521b7442fa0a34d2337c47883~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6IKl5p-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186644&amp;x-signature=InA8SfDE9RqIk6IFZ18sQ7fGJJ0%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-6">2.4 å®é™…æ•ˆæœéªŒè¯</h4>
<p>æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªå…¸å‹çš„å¼€å‘åœºæ™¯ï¼šå›¢é˜Ÿå†…éƒ¨æ²‰æ·€äº†å¤šä»½èµ„æ–™ï¼Œä¾‹å¦‚<a href="https://link.juejin.cn?target=..%2Fdemo%2Finternal_docs%2F%25E5%2586%2585%25E9%2583%25A8%25E5%259F%258B%25E7%2582%25B9%25E8%25A7%2584%25E8%258C%2583_V1.0.txt" target="_blank" title="../demo/internal_docs/%E5%86%85%E9%83%A8%E5%9F%8B%E7%82%B9%E8%A7%84%E8%8C%83_V1.0.txt" ref="nofollow noopener noreferrer">ã€Šå†…éƒ¨åŸ‹ç‚¹è§„èŒƒã€‹ï¼ˆä»…ç¤ºä¾‹ï¼‰</a>å’Œ<a href="https://link.juejin.cn?target=..%2Fdemo%2Finternal_docs%2F%25E5%2586%2585%25E9%2583%25A8%25E6%258E%25A5%25E5%258F%25A3%25E6%2596%2587%25E6%25A1%25A3_%25E7%2594%25A8%25E6%2588%25B7%25E6%25A8%25A1%25E5%259D%2597_V1.0.pdf" target="_blank" title="../demo/internal_docs/%E5%86%85%E9%83%A8%E6%8E%A5%E5%8F%A3%E6%96%87%E6%A1%A3_%E7%94%A8%E6%88%B7%E6%A8%A1%E5%9D%97_V1.0.pdf" ref="nofollow noopener noreferrer">ç”¨æˆ·æ¨¡å—çš„æ¥å£æ–‡æ¡£</a>ã€‚</p>
<p>1ï¼‰éªŒè¯åŸ‹ç‚¹è§„èŒƒï¼š
è¾“å…¥ä»¥ä¸‹promptï¼š</p>
<blockquote>
<p>è°ƒç”¨mcp å·¥å…·ï¼Œè¯´æ˜ä¸‹å¦‚ä½•ä½¿ç”¨å†…éƒ¨åŸ‹ç‚¹ç¤ºä¾‹ä»£ç ã€‚</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78feb765ebaf47408f5b409e43ffbf02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6IKl5p-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186644&amp;x-signature=bkPhL6nzZQTKe1lbR8kBsbMCAu4%3D" alt="image-3.png" loading="lazy"/></p>
<p>2ï¼‰éªŒè¯æ¥å£æ–‡æ¡£ï¼š
è¾“å…¥ä»¥ä¸‹promptï¼š</p>
<blockquote>
<p>è¯·è¾“å‡º ç”¨æˆ·æ¨¡å—æ¥å£æ–‡æ¡£çš„å…³é”®ä¿¡æ¯ã€‚</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45cd57d234084747a496b12677dac890~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP6IKl5p-0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186644&amp;x-signature=C8OfSTbHHrvWCdJVzNcV939PfqU%3D" alt="image-4.png" loading="lazy"/></p>
<h3 data-id="heading-7">3. æ€»ç»“</h3>
<h5 data-id="heading-8">1) è‡ªå»º MCP Server çš„æ„ä¹‰</h5>
<ul>
<li><strong>è®©æ¨¡å‹â€œæŸ¥å¾—åˆ°å†…éƒ¨èµ„æ–™â€</strong>ï¼šæŠŠ PDF/TXT ç­‰èµ„æ–™å°è£…æˆå·¥å…·èƒ½åŠ›ï¼ˆä¾‹å¦‚ <code>search_internal_docs</code>ï¼‰ï¼Œæ¨¡å‹å…ˆå¬å›å‘½ä¸­æ–‡æ®µï¼Œå†åŸºäºç‰‡æ®µæ€»ç»“æˆ–ç”Ÿæˆä»£ç ã€‚</li>
<li><strong>å‡å°‘èƒ¡ç¼–</strong>ï¼šå›ç­”å¯ä»¥å¸¦ä¸Šå‘½ä¸­çš„æ–‡æ¡£ç‰‡æ®µæˆ–å¼•ç”¨æ¥æºï¼Œç»“æœæ›´å¯è¿½æº¯ã€æ›´æ–¹ä¾¿è¯„å®¡ä¸å¤æ ¸ã€‚</li>
<li><strong>çŸ¥è¯†èµ„äº§åŒ–</strong>ï¼šæŠŠè§„èŒƒã€æ¥å£ã€FAQ é€æ­¥çº³å…¥ç»Ÿä¸€å…¥å£ï¼Œå‡å°‘â€œå£å£ç›¸ä¼ â€çš„ä¿¡æ¯æŸè€—ã€‚</li>
</ul>
<h5 data-id="heading-9">2) ç°çŠ¶ï¼šæœ´ç´ å…³é”®è¯æ‰“åˆ†ï¼ˆä¸ºä»€ä¹ˆå¯ä»¥æ¥å—ï¼‰</h5>
<p>å½“å‰å®ç°é‡‡ç”¨â€œå…³é”®è¯å‘½ä¸­ + ç®€å•åˆ‡åˆ†â€çš„æ–¹å¼åšå¬å›ä¸æ’åºï¼Œæœ¬è´¨æ˜¯ä¸€ä¸ª MVPï¼šå…ˆæŠŠâ€œæ–‡æ¡£åŠ è½½ -&gt; æ£€ç´¢ -&gt; åŸºäºç‰‡æ®µå›ç­”â€çš„é“¾è·¯è·‘é€šã€‚</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå®ç°å¿«ã€å¯è§£é‡Šã€å¥½æ’æŸ¥ï¼ˆå‘½ä¸­å“ªäº›è¯ã€å“ªä¸ª chunk ä¸€ç›®äº†ç„¶ï¼‰ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå¯¹åŒä¹‰è¯/è¿‘ä¹‰è¡¨è¾¾ä¸æ•æ„Ÿï¼Œæ’åºè´¨é‡ä¸€èˆ¬ï¼›æ–‡æ¡£è§„æ¨¡å˜å¤§åï¼Œæ•ˆæœä¸æ€§èƒ½éƒ½éœ€è¦è¿›ä¸€æ­¥å·¥ç¨‹åŒ–ã€‚</li>
</ul>
<h5 data-id="heading-10">3) åç»­æ›´ä¼˜é›…çš„å·¥ç¨‹åŒ–åšæ³•ï¼ˆæ–¹å‘ï¼‰</h5>
<p>è¿™é‡Œçš„æ¼”è¿›æ–¹å‘å¯ä»¥æ›´æ˜ç¡®åœ°ç†è§£ä¸ºï¼šæŠŠå½“å‰ MVP çš„å…³é”®è¯æ‰“åˆ†ï¼Œå‡çº§ä¸ºæ ‡å‡† RAG æµç¨‹ï¼š</p>
<ul>
<li><strong>Embedding å‘é‡å¬å›</strong>ï¼šç”¨è¯­ä¹‰æ£€ç´¢è§£å†³åŒä¹‰è¯/è¡¨è¾¾å·®å¼‚å¸¦æ¥çš„æ¼å¬å›é—®é¢˜ã€‚</li>
<li><strong>Rerank é‡æ’</strong>ï¼šå¯¹ TopK ç»“æœäºŒæ¬¡æ’åºï¼ŒæŠŠæœ€ç›¸å…³çš„ç‰‡æ®µä¼˜å…ˆæä¾›ç»™å¤§æ¨¡å‹ã€‚</li>
<li><strong>ï¼ˆå¯é€‰ï¼‰æ··åˆæ£€ç´¢</strong>ï¼šå‘é‡æ£€ç´¢ + å…³é”®è¯æ£€ç´¢ç»„åˆï¼Œå…¼é¡¾è¯­ä¹‰å¬å›ä¸ç²¾ç¡®åŒ¹é…ã€‚</li>
</ul>
<p>è¿™ç±»å‡çº§å±äºâ€œå·¥ç¨‹åŒ–æ¼”è¿›æ–¹å‘â€ï¼šå½“æ–‡æ¡£è§„æ¨¡ã€é—®é¢˜å¤æ‚åº¦æå‡åï¼Œç”¨æ›´æ ‡å‡†ã€æ›´å¯æ§çš„æ£€ç´¢é“¾è·¯æ¥ä¿è¯å¬å›è´¨é‡ä¸ç¨³å®šæ€§ã€‚</p>
<p>ç›¸å…³ç¤ºä¾‹ä»£ç ä¸èµ„æ–™åœ¨ <code>demo/</code> ç›®å½•ä¸‹ï¼šMCP Server ä½äº <code>demo/mcp-server/</code>ï¼Œç¤ºä¾‹å†…éƒ¨æ–‡æ¡£ä½äº <code>demo/internal_docs/</code>.</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[pythonä»£ç å®ç°esæ–‡ç« å†…å®¹å‘é‡åŒ–å¹¶æœç´¢]]></title>    <link>https://juejin.cn/post/7591416714695049226</link>    <guid>https://juejin.cn/post/7591416714695049226</guid>    <pubDate>2026-01-05T02:18:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591416714695049226" data-draft-id="7591377757734977545" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="pythonä»£ç å®ç°esæ–‡ç« å†…å®¹å‘é‡åŒ–å¹¶æœç´¢"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-05T02:18:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¼ºå¼ºå¼º795"/> <meta itemprop="url" content="https://juejin.cn/user/1843220886587384"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            pythonä»£ç å®ç°esæ–‡ç« å†…å®¹å‘é‡åŒ–å¹¶æœç´¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1843220886587384/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¼ºå¼ºå¼º795
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T02:18:10.000Z" title="Mon Jan 05 2026 02:18:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1å°æ—¶+
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">pythonä»£ç å®ç°esæ–‡ç« å†…å®¹å‘é‡åŒ–å¹¶æœç´¢</h2>
<p>å‰ç½®æ¡ä»¶ï¼š</p>
<ul>
<li>dockerç¯å¢ƒ</li>
<li>vscodeç¼–è¾‘å™¨</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ‹‰å–é•œåƒ</span>
docker pull elasticsearch:7.17.7

<span class="hljs-comment"># åˆ›å»ºç½‘ç»œ</span>
docker network create es-net-7.17

<span class="hljs-comment"># å¯åŠ¨å‘½ä»¤</span>
<span class="hljs-comment"># è·¯å¾„éœ€è¦æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼ï¼ï¼</span>
docker run --name es7.17 -p 9200:9200 -p 9300:9300 \
-e <span class="hljs-string">"discovery.type=single-node"</span> \
-e ES_JAVA_OPTS=<span class="hljs-string">"-Xms512m -Xmx512m"</span> \
-v <span class="hljs-string">"D:\docker\es7.17\config\elasticsearch.yml"</span>:/usr/share/elasticsearch/config/elasticsearch.yml \
-v <span class="hljs-string">"D:\docker\es7.17\data"</span>:/usr/share/elasticsearch/data \
-v <span class="hljs-string">"D:\docker\es7.17\plugins"</span>:/usr/share/elasticsearch/plugins \
--network es-net-7.17 \
-d elasticsearch:7.17.0

<span class="hljs-comment"># è®¾ç½®å¯†ç </span>
docker <span class="hljs-built_in">exec</span> -it es7.17 /bin/bash
./bin/elasticsearch-setup-passwords auto

<span class="hljs-comment"># è®¾ç½®å¯†ç è¿”å›å†…å®¹</span>

Changed password <span class="hljs-keyword">for</span> user apm_system
PASSWORD apm_system = ySeDmRr68wtWbv2wyueu

Changed password <span class="hljs-keyword">for</span> user kibana_system
PASSWORD kibana_system = OSFamv1KYzDcZVb885ka

Changed password <span class="hljs-keyword">for</span> user kibana
PASSWORD kibana = OSFamv1KYzDcZVb885ka

Changed password <span class="hljs-keyword">for</span> user logstash_system
PASSWORD logstash_system = UkrEiVXFcyvvXkPE4nkV

Changed password <span class="hljs-keyword">for</span> user beats_system
PASSWORD beats_system = dCoAoLvnsRC0kycFdJcX

Changed password <span class="hljs-keyword">for</span> user remote_monitoring_user
PASSWORD remote_monitoring_user = qZm3chw66jmo1UNPWpwn

Changed password <span class="hljs-keyword">for</span> user elastic
<span class="hljs-comment"># è®°ä½è¿™æ˜¯esçš„å¯†ç </span>
PASSWORD elastic = NBh5ObTk1lq2YZ4JQ2Ng

</code></pre>
<p>æ–‡ç« å†…å®¹jsonæ–‡ä»¶ï¼ŒesData.json</p>
<pre><code class="hljs language-bash" lang="bash">{<span class="hljs-string">"id"</span>: <span class="hljs-string">"01146c1cac8a28009068c089d4d83f537f"</span>, <span class="hljs-string">"cont"</span>: <span class="hljs-string">"å°½ç®¡æœ¬èµ›å­£å¤šæ”¯çƒé˜Ÿé€šè¿‡è°ƒæ•´é˜µå®¹æå‡äº†æ•´ä½“å®åŠ›ï¼Œä½†ä»è¡¨ç°æ¥çœ‹ï¼Œé›·éœ†é˜Ÿä»ç„¶é¥é¥é¢†å…ˆï¼Œææœ‰å¯èƒ½æ‰“ç ´è‡ª2018å¹´å‹‡å£«ä»¥æ¥æ— çƒé˜Ÿå®ç°å«å†•çš„é­”å’’ã€‚é™¤äº†é›·éœ†é˜Ÿæœ‰æœ›å†åº¦é—®é¼æ€»å† å†›å¤–ï¼Œäºšå†å±±å¤§æ›´æ˜¯æœ‰æœºä¼šè‰è”å¸¸è§„èµ›MVPï¼Œå¹¶ä¸”å¾ˆå¯èƒ½æ˜¯ä¸€éª‘ç»å°˜ã€‚\nè¯„é€‰å¸¸è§„èµ›MVPçš„é¦–è¦æ ‡å‡†å°±æ˜¯çƒé˜Ÿçš„æˆ˜ç»©ï¼Œäºšå†å±±å¤§å°å¯ä¸å¿…æ“å¿ƒè¿™ä¸€ç‚¹ã€‚åœ¨èµ›å­£å‰13åœºæ¯”èµ›ä¸­ï¼Œé›·éœ†ä»¥12èƒœ1è´Ÿçš„ä½³ç»©å¼€å±€ï¼Œè™½ç„¶ä»–ä»¬çš„å…«è¿èƒœè¢«ç»ˆç»“ï¼Œä½†ä¾ç…§å½“å‰çš„åŠ¿å¤´ï¼Œçƒé˜Ÿæœ‰æœ›å±•å¼€æ›´é•¿æ—¶é—´çš„è¿èƒœè®°å½•ã€‚æ”¾çœ¼æ•´ä¸ªè”ç›Ÿï¼Œé›·éœ†å‡ ä¹æ²¡æœ‰å¯¹æ‰‹ï¼Œåªè¦ä»–ä»¬è·å¾—è”ç›Ÿå‰äºŒçš„æˆ˜ç»©ï¼Œäºšå†å±±å¤§å½“é€‰MVPä¾¿æ¯«æ— å‹åŠ›ã€‚\næ­¤å¤–ï¼Œäºšå†å±±å¤§çš„ä¸ªäººæ•°æ®åŒæ ·ä»¤ä»–åœ¨ç«äº‰ä¸­ç«‹äºä¸è´¥ä¹‹åœ°ã€‚åœ¨é›·éœ†æœ¬èµ›å­£çš„ä¸€äº›æ¯”èµ›ä¸­ï¼Œä»–ä»¬ä»¥å¤§æ¯”åˆ†å‡»è´¥å¯¹æ‰‹ï¼Œäºšå†å±±å¤§è‡³ä»Šå·²ç»æœ‰7åœºæ¯”èµ›å®ç°ä¸‰èŠ‚æ‰“å¡çš„æˆå°±ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä»–çš„åœºå‡æ•°æ®è¾¾åˆ°32.5åˆ†ã€5.2ä¸ªç¯®æ¿ã€6.6æ¬¡åŠ©æ”»ã€1.2æ¬¡æŠ¢æ–­å’Œ1æ¬¡å°ç›–ï¼Œä¸”å·²è¿ç»­85åœºæ¯”èµ›å¾—åˆ†è¶…è¿‡20åˆ†ï¼Œååˆ—å†å²ç¬¬ä¸‰ï¼Œè¿™æ­£æ˜¯ä»–äº‰å¤ºMVPçš„å¼ºæœ‰åŠ›ä¾æ®ã€‚\nä¸ä»…å¦‚æ­¤ï¼Œäºšå†å±±å¤§çš„ä¸ªäººå½¢è±¡ä¹Ÿç›¸å½“å‡ºè‰²ã€‚è™½ç„¶æ—©æœŸè”ç›Ÿå€¾å‘äºå®£ä¼ è«å…°ç‰¹çš„æ˜æ˜Ÿæ½œåŠ›ï¼Œä½†ç”±äºå…¶ä¸ªæ€§é—®é¢˜å’Œåœºå¤–è¡Œä¸ºå¤±æ§ï¼Œè”ç›Ÿè‡ªç„¶ä¸ä¼šæŠŠè¿™æ ·çš„çƒå‘˜æ¨å‘å‰å°ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œäºšå†å±±å¤§åˆ™æ˜¾å¾—æ²‰ç¨³ï¼Œå‡ ä¹æ²¡æœ‰è´Ÿé¢æ–°é—»ï¼Œå†åŠ ä¸Šçƒé˜Ÿçš„ä¼˜ç§€æˆ˜ç»©ï¼Œè‡ªç„¶æˆä¸ºäº†å—åˆ°é‡ç‚¹å…³æ³¨çš„å¯¹è±¡ã€‚\nåœ¨è®¸å¤šMVPçš„è§’é€è€…ä¸­ï¼Œæœ¬èµ›å­£çš„è¿¹è±¡æ˜¾ç¤ºï¼Œäºšå†å±±å¤§å‡ ä¹æ²¡æœ‰å¯¹æ‰‹å¯è¨€ã€‚å¡”å›¾å§†å› ä¼¤ç¼ºå¸­ï¼Œæ˜¾è‘—å½±å“äº†å‡¯å°”ç‰¹äººçš„æˆ˜ç»©ï¼Œè‡ªå·±ä¹Ÿé€€å‡ºäº†MVPçš„ç«äº‰ã€‚è€Œçº¦åŸºå¥‡è™½ç„¶å®åŠ›å‡ºä¼—ï¼Œä½†å…³æ³¨åº¦æœ‰æ‰€å‡é€€ã€‚å­—æ¯å“¥å’Œä¸œå¥‘å¥‡çš„æ•°æ®è™½è¶³ä»¥ä¸äºšå†å±±å¤§ä¸€è¾ƒé«˜ä¸‹ï¼Œä½†ä»–ä»¬çš„çƒé˜Ÿæˆ˜ç»©å¹¶ä¸ç†æƒ³ï¼ŒåŠ ä¹‹åœ¨å¸¸è§„èµ›ä¸­å‡è´¥ç»™é›·éœ†ï¼Œä½¿å¾—ä»–ä»¬çš„ç«äº‰åŠ›ä¸‹é™ã€‚\nçºµè§‚NBAæœ€è¿‘30å¹´çš„MVPæ¦œå•ï¼Œåå«çƒå‘˜ä¸€ç›´æ˜¯ä¸»æµã€‚è‡ªä¹”ä¸¹æ—¶ä»£èµ·ï¼Œåå«é€šå¸¸æ˜¯MVPè¯„é€‰ä¸­çš„å¸¸å®¢ï¼Œä»…æœ‰å¥¥å°¼å°”è¿™æ ·çš„ç»Ÿæ²»çº§ä¸­é”‹æ‰å¯¹ä»–ä»¬æ„æˆå¨èƒã€‚ç°å¦‚ä»Šï¼Œè”ç›ŸäºŸéœ€åŸ¹å…»ä¼˜è´¨åå«ï¼Œä»¥åº”å¯¹æ—¶ä»£å˜è¿ï¼Œè€Œäºšå†å±±å¤§æ­£æ˜¯æœ€åˆé€‚çš„äººé€‰ã€‚\nå°½ç®¡äºšå†å±±å¤§çš„èµ·ç‚¹å¹¶ä¸é«˜ï¼Œä½†å‡­å€Ÿç€å‡ºè‰²çš„è¡¨ç°ï¼Œä»–å·²æ·±å¾—è®¤å¯ï¼Œç”šè‡³å¸¦é¢†é›·éœ†å›¢é˜Ÿé‡æ•´æ——é¼“ï¼Œä»è€Œå¤ºå¾—æ€»å† å†›ã€‚ç»¼åˆå®åŠ›å’Œå¤–éƒ¨å› ç´ ï¼Œäºšå†å±±å¤§æœ‰æœ›æˆåŠŸå«å†•å¸¸è§„èµ›MVPï¼Œå¹¶å¼€å¯å±äºè‡ªå·±çš„æ–°æ—¶ä»£ã€‚"</span>, <span class="hljs-string">"cont_vector"</span>: [0.4523310661315918, -0.42129096388816833, -0.10820494592189789, 0.0036694828886538744, -0.14275772869586945, -0.08775501698255539, -0.14815157651901245, 0.4908980429172516, -0.20759209990501404, 0.03545376658439636, -0.10611799359321594, 0.09825185686349869, -0.3049815893173218, 0.19214743375778198, -0.3052414059638977, 0.3583364486694336, -0.684459924697876, -0.5450500249862671, -0.3243388533592224, -0.21598312258720398, 0.1839916855096817, 0.3576545715332031, 0.1687161922454834, -0.18859528005123138, -0.4628499746322632, -0.02512696012854576, -0.5437095165252686, -0.4771745800971985, 0.520634651184082, -0.1583845019340515, -0.35849156975746155, 0.13955287635326385, 0.5727346539497375, 0.220637246966362, 0.01941748708486557, -0.09252170473337173, 0.26381340622901917, 0.14211896061897278, -0.48502272367477417, -0.24117137491703033, -0.08558724075555801, 0.3736706078052521, -0.08776234835386276, 0.22563371062278748, 0.621464192867279, -0.10572295635938644, 0.03095090016722679, 0.14936421811580658, -0.15004394948482513, 0.05599389597773552, 0.11376407742500305, 0.02158319763839245, -0.1879892200231552, -0.04803527519106865, -0.21382202208042145, 0.3967987298965454, -0.45135802030563354, -0.2588450610637665, 0.3977886140346527, -0.5552746653556824, -0.05964848771691322, -0.1085168793797493, 0.2955080568790436, -0.3564532697200775, 0.2535160779953003, 0.14971090853214264, -0.3152359426021576, -0.21485427021980286, -0.05632393807172775, -0.21041424572467804, 0.0017311557894572616, -0.5285346508026123, -0.3790595531463623, -0.5043520331382751, 0.29972440004348755, -0.10387706011533737, -0.29129892587661743, 0.3965631425380707, 0.02126346342265606, -0.39684924483299255, 0.24166280031204224, 0.353969544172287, 0.19310510158538818, -0.05605333298444748, -0.32779085636138916, 0.0017988947220146656, 0.7248730063438416, -0.0748828798532486, -0.09465160965919495, -0.26415571570396423, 0.26207247376441956, 0.015926824882626534, 0.02110295370221138, -0.05083087831735611, 0.3057788610458374, -0.1893520951271057, -0.03346772491931915, 0.38499414920806885, 0.2585459053516388, -0.0761873871088028, -0.655835747718811, 0.23322394490242004, 0.23925459384918213, -0.40216273069381714, 0.3193327784538269, 0.24650266766548157, -0.11880608648061752, 0.6330352425575256, -0.35166504979133606, 0.07843051105737686, 0.06321601569652557, 0.2606239318847656, 0.0008769529522396624, 0.19127272069454193, 0.11773505806922913, -0.2369062304496765, -0.22870364785194397, -0.22693222761154175, -0.1294422745704651, -0.5553878545761108, -0.07270758599042892, -0.122660793364048, 0.11521270871162415, -0.3924280107021332, -0.37473809719085693, 0.08079427480697632, 0.4257120192050934, -0.16694191098213196, 0.13722513616085052, 0.14675326645374298, 0.16512447595596313, -0.11959976702928543, 0.03714914619922638, 0.12297794967889786, 0.5411235094070435, -0.33633336424827576, -0.48681312799453735, 0.15502779185771942, -0.2755313813686371, 0.17177949845790863, -0.05220286175608635, 0.2669919431209564, 0.5043460726737976, 0.12649835646152496, 0.6667388677597046, -0.0728655457496643, -0.2862900197505951, 0.3269551396369934, 0.4291784167289734, -0.023675723001360893, -0.1378578245639801, -0.12819090485572815, -0.08859448879957199, 0.042783863842487335, -0.6962689757347107, -0.06721062958240509, 0.13796967267990112, -0.08252204954624176, -0.21868203580379486, -0.052942268550395966, 0.2976738214492798, 0.017056765034794807, 0.059263356029987335, -0.12672340869903564, -0.5951954126358032, -0.20957881212234497, -0.4773534834384918, 0.20593464374542236, 0.1856706291437149, -0.41869470477104187, -0.2506382167339325, -0.33696988224983215, 0.0700417160987854, -0.38161250948905945, 0.3056684136390686, 0.15497198700904846, 0.24733224511146545, -0.08394975960254669, 0.046540066599845886, 0.39147114753723145, -0.17512597143650055, 0.15075808763504028, 0.13342659175395966, 0.5008097887039185, 0.037256788462400436, 0.6567018628120422, 0.4752378463745117, -0.014908162876963615, -0.08896180242300034, -0.003406189614906907, 0.3449920117855072, 0.14047837257385254, -0.38906893134117126, 0.06310281157493591, 0.4606871008872986, -0.10597598552703857, -0.20284809172153473, -0.41944798827171326, -0.15723928809165955, -0.03934468328952789, -0.054592009633779526, 0.23120634257793427, -0.15523964166641235, 0.6759698987007141, 0.2351461946964264, 0.012422239407896996, 0.08235882967710495, 0.6114153861999512, -0.21230174601078033, -0.14624296128749847, -0.037073150277137756, -0.3824624717235565, -0.221646249294281, 0.27860456705093384, 0.33952000737190247, 0.10636419802904129, -0.31198984384536743, -0.41695868968963623, 0.056005269289016724, -0.3404271602630615, -0.14554010331630707, -0.06000437214970589, -0.4536258578300476, -0.2632378339767456, -0.1489313244819641, 0.279754638671875, -0.4014630913734436, -0.1281834989786148, -0.6500315070152283, 0.03917471691966057, 0.3883225917816162, -0.24309757351875305, -0.028078312054276466, -0.5735273361206055, 0.133853018283844, -0.23539823293685913, -0.16548027098178864, -0.43744638562202454, 0.09654185175895691, 0.01611395552754402, 0.5429735779762268, -0.11417452245950699, 0.28799962997436523, 0.5026970505714417, -0.05743410438299179, -0.27788761258125305, 0.20891238749027252, -0.16863411664962769, 0.15264159440994263, 0.20019645988941193, -0.37742000818252563, 0.19018177688121796, 0.06030794978141785, -0.31330621242523193, 0.0875861719250679, 0.10160694271326065, -0.49709877371788025, 0.23909182846546173, 0.013399955816566944, -0.23385871946811676, 0.016258493065834045, -0.07411465048789978, -0.3284195363521576, -0.2520984411239624, 0.1677311509847641, -0.5040080547332764, 0.17297197878360748, -0.5685170292854309, -0.01807142235338688, 0.5987871289253235, -0.3657417297363281, -0.5121012926101685, -0.45659947395324707, -0.19562216103076935, -0.3629092276096344, 0.06739384680986404, -0.031776029616594315, 0.32099685072898865, 0.0649193599820137, -0.464762419462204, 0.00934344157576561, -0.493110716342926, -0.12872251868247986, -0.12053199112415314, -0.32842907309532166, -0.3009013235569, 0.0725817158818245, 0.33648303151130676, 0.15754851698875427, -0.18332569301128387, -0.0004173970373813063, 0.11042829602956772, -0.5718982815742493, 0.4400424361228943, 0.2870068848133087, 0.6077939867973328, -0.25680044293403625, -0.21423408389091492, -0.2293754518032074, -0.21968813240528107, 0.30913251638412476, 0.16808609664440155, -0.4316014349460602, -0.10608423501253128, 0.0014615989057347178, 0.14517652988433838, -0.4425185024738312, -0.32848304510116577, 0.45473426580429077, 0.3091675639152527, -0.2834664583206177, 0.250938355922699, 0.4826999306678772, -0.22128351032733917, -0.4669362008571625, 0.11862220615148544, 0.6927807331085205, 0.3549346625804901, 0.6822618246078491, 0.20975835621356964, 0.4646807909011841, -0.06676477193832397, -0.3804246783256531, 0.7223101854324341, 0.5288295745849609, -0.2845136225223541, 0.339741587638855, -0.05963399261236191, -0.6897469162940979, 0.3516678214073181, -0.4860025942325592, 0.21025750041007996, 0.20219849050045013, 0.12165796756744385, 0.0101394671946764, -0.46572014689445496, 0.1321990042924881, 0.22869034111499786, -0.4066203534603119, 0.5922082662582397, 0.41123518347740173, 0.044684380292892456, 0.36882284283638, -0.23662526905536652, 0.3931517004966736, -0.0493336021900177, 0.24388933181762695, -0.11595210433006287, 0.33571091294288635, -0.15343709290027618, 0.1365741491317749, 0.014624501578509808, -0.2319050282239914, 0.4117586612701416, -0.5162688493728638, 0.16217190027236938, 0.16240006685256958, 0.1326030045747757, -0.2006939947605133, 0.12394726276397705, -0.10101309418678284, 0.3197796046733856, -0.6780779957771301, -0.12346595525741577, -0.19052807986736298, 0.13741248846054077, 0.20059321820735931, 0.05618583783507347, -0.2912450432777405, 0.09713469445705414, 0.25409096479415894, -0.04737431928515434, -0.11356594413518906, -0.08178744465112686, 0.08467331528663635, 0.1044899970293045, 0.5239322185516357, 0.039015647023916245, 0.30650949478149414, -0.47042614221572876, 0.17927154898643494, 0.24320517480373383, -0.20805209875106812, 0.09729159623384476, -0.2729633152484894, -0.4611559808254242, -0.284662127494812, 0.06583895534276962, -0.11993297934532166, -0.05675363168120384, -0.01310515683144331, 0.35302478075027466, -0.2789093554019928, 0.39327195286750793, 0.41872331500053406, 0.2807038724422455, 0.31444627046585083, -0.27596744894981384, -0.26137077808380127, -0.3184107840061188, -0.17088323831558228, -0.6189744472503662, 0.10918822884559631, 0.40050604939460754, 0.19456391036510468, 0.47202223539352417, -0.29108989238739014, 0.6096796989440918, 0.516986072063446, 0.49056097865104675, -0.26908454298973083, 0.30942749977111816, -0.00856851227581501, 0.024249285459518433, -0.4458918273448944, 0.11585479229688644, 0.099638432264328, -0.5001310110092163, 0.5426455140113831, -0.053878359496593475, -0.5752618312835693, -0.09184301644563675, 0.29529091715812683, 0.08118057250976562, -0.41907745599746704, -0.033078279346227646, 0.22229847311973572, -0.3748151659965515, -0.1909731924533844, -0.3120376765727997, -0.3983618915081024, -0.5371765494346619, 0.04678831249475479, -0.5298833847045898, -0.44943225383758545, 0.42461711168289185, 0.4267144799232483, -0.22020255029201508, 0.47798821330070496, 0.36000412702560425, -0.03871441259980202, -0.42732295393943787, 0.5788938999176025, -0.2315661907196045, -0.4014946222305298, 0.0950588509440422, -0.07028135657310486, 0.362936407327652, 0.10716420412063599, -0.6927024126052856, 0.22131909430027008, 0.2749435007572174, -0.02977968193590641, 0.12899628281593323, -0.26829996705055237, 0.21912018954753876, -0.21355320513248444, 0.3824649155139923, -0.31171122193336487, 0.1161845326423645, -0.4787464737892151, -0.20896147191524506, -0.04819213226437569, -0.002023685025051236, -0.009950792416930199, 0.2349378615617752, -0.4374595284461975, 0.28202205896377563, -0.030341219156980515, -0.5637912154197693, -0.35288944840431213, 0.5485025644302368, -0.2785358726978302, 0.12756282091140747, -0.1396838277578354, -0.18330451846122742, -0.7023033499717712, -0.17365141212940216, 0.1189071536064148, -0.045546095818281174, -0.1821955144405365, -0.27183637022972107, -0.10170084983110428, 0.06884611397981644, 0.009347577579319477, -0.30179038643836975, 0.3252961337566376, 0.35813188552856445, -0.2685692310333252, 0.05951043218374252, -0.31006965041160583, -0.08868484199047089, 0.3713410198688507, -0.15965530276298523, 0.21763551235198975, 0.10769038647413254, -0.14485016465187073, 0.45005369186401367, -0.08467241376638412, -0.3582927882671356, -0.3720237910747528, -0.11204052716493607, -0.13212424516677856, 0.4432198405265808, 0.5149310827255249, -0.20830275118350983, -0.29835250973701477, 0.17648005485534668, 0.30670788884162903, 0.41284552216529846, -0.5726526975631714, 0.44720110297203064, -0.04106971248984337, -0.3356403410434723, -0.2788066864013672, 0.7834573984146118, -0.038271695375442505, 0.2963479459285736, -0.6346545815467834, 0.28314587473869324, 0.16061720252037048, 0.5577772855758667, -0.10227254778146744, -0.03232205659151077, 0.2476782202720642, -0.5969438552856445, 0.1969853788614273, -0.4797148108482361, 0.18395672738552094, -0.6351139545440674, 0.5075705647468567, 0.1212473213672638, -0.37858518958091736, -0.052498508244752884, 0.5005752444267273, -0.25839972496032715, -0.34718790650367737, 0.5958853960037231, 0.1417737603187561, -0.2449919432401657, 0.3509753346443176, 0.08120844513177872, 0.04241640493273735, -0.5260459184646606, -0.47627776861190796, 0.14796118438243866, -0.4891894459724426, -0.1640547513961792, 0.022579215466976166, -0.3638859987258911, -0.4363107681274414, -0.22004817426204681, -0.10651243478059769, 0.29817095398902893, 0.356494665145874, 0.4999232590198517, -0.33209875226020813, 0.30739328265190125, -0.44422194361686707, 0.012975607067346573, -0.044258613139390945, -0.008263908326625824, -0.23589938879013062, 0.312428742647171, -0.3067531883716583, -0.36241674423217773, -0.5440675616264343, 0.5193521976470947, 0.2064792364835739, 0.6235515475273132, -0.2913360893726349, -0.1667417734861374, -0.39612051844596863, -0.14761634171009064, 0.06648781895637512, -0.2313874214887619, 0.04003620892763138, -0.349582314491272, -0.09673121571540833, -0.06560281664133072, -0.22163736820220947, -0.18261751532554626, -0.22429487109184265, 0.2868175506591797, -0.48278728127479553, -0.26113224029541016, 0.33103492856025696, -0.3602239191532135, 0.36919450759887695, -0.044477421790361404, -0.319985568523407, 0.25707539916038513, -0.3145340085029602, 0.3962261378765106, -0.39185619354248047, -0.333211213350296, -0.23312503099441528, -0.06727416813373566, 0.41523227095603943, -0.5472086071968079, 0.058054275810718536, 0.5115567445755005, 0.03631468117237091, -0.14604544639587402, -0.6411074995994568, 0.34419482946395874, 0.3260522782802582, 0.2576770782470703, 0.30030858516693115, -0.31284937262535095, 0.3993648290634155, -0.33188337087631226, -0.5430832505226135, 0.43732893466949463, -0.2751549780368805, -0.23524293303489685, 0.2688066363334656, -0.34342578053474426, -0.35919320583343506, 0.08713796734809875, -0.6386539936065674, -0.4185751974582672, -0.10172927379608154, 0.38696640729904175, 0.3092110753059387, -0.45940351486206055, 0.29719865322113037, -0.057846296578645706, -0.26373291015625, 0.2290978878736496, 0.021848633885383606, 0.6742443442344666, -0.06650486588478088, 0.05519188567996025, -0.36016514897346497, 0.07852110266685486, -0.27014872431755066, 0.18307557702064514, -0.1561894714832306, 0.370673805475235, 0.18787115812301636, -0.23929961025714874, -0.057015206664800644, 0.044130537658929825, 0.5676910877227783, 0.02394339069724083, -0.44581812620162964, 0.12531137466430664, -0.09865718334913254, 0.14039680361747742, 0.3611648976802826, 0.15701958537101746, -0.39517512917518616, 0.280132919549942, -0.061484336853027344, -0.48142877221107483, 0.10767781734466553, 0.08333952724933624, 0.44984105229377747, -0.24309512972831726, -0.11588119715452194, -0.3557215631008148, -0.1410239040851593, 0.5265339016914368, 0.3575410544872284, -0.2936611473560333, -0.824822187423706, -0.5884774327278137, -0.43459489941596985, -0.10406093299388885, -0.18992988765239716, -0.008250639773905277, 0.2101684957742691, -0.7976610064506531, -0.1158461645245552, 0.17031805217266083, 0.5149469971656799, 0.000547194795217365, 0.22035080194473267, 0.1404598504304886, 0.15965498983860016, -0.31714051961898804, -0.013227630406618118, 0.14353008568286896, -0.34055283665657043, -0.01812135986983776, -0.05953461304306984, 0.5699104070663452, -0.20139488577842712, 0.012964298017323017, 0.1349988728761673, -0.416827917098999, -0.30775177478790283, 0.4397223889827728, -0.5877944827079773, -0.325247198343277, -0.3689919710159302, 0.06452597677707672, 0.4790318012237549, 0.11462850868701935, 0.05508480593562126, 0.11497235298156738, 0.5972564816474915, -0.49504098296165466, -0.5400760769844055, -0.32969722151756287, -0.40021204948425293, -0.3165852427482605, 0.33684593439102173, -0.03887548670172691, -0.10652235150337219, -0.6269720792770386, 0.20988395810127258, -0.06546426564455032, 0.04559759050607681, 0.15386775135993958, -0.4614682197570801, 0.23103927075862885, -0.5043878555297852, -0.12651844322681427, 0.13226191699504852, -0.07132375985383987, 0.3177791237831116, -0.07598327845335007, 0.30994918942451477, -0.23846213519573212, -0.1201702132821083, 0.29049578309059143, -0.32092198729515076, 0.061463672667741776, 0.003243078710511327, 0.25450560450553894, -0.05593642592430115, -0.17116621136665344, 0.11751646548509598, -0.11097238212823868, 0.01731683872640133, -0.35540133714675903, 0.27358147501945496, 0.12455912679433823, -0.3864307403564453, -0.06287376582622528, 0.07087533175945282, 0.40208929777145386, -0.7816821932792664, -0.46703633666038513, -0.1910104900598526, 0.33356696367263794, -0.4972516894340515, -0.5461944341659546, 0.10800203680992126, 0.01843428611755371, -0.20607364177703857, 0.355923056602478, -0.24736855924129486, 0.5505288243293762, 0.36262574791908264, -0.1526089608669281, -0.3380616009235382, -0.18840473890304565, 0.003662536619231105, 0.4140576422214508, -0.02159617282450199, 0.4204985797405243, -0.17026017606258392, -0.0021762268152087927, -0.04412243887782097, -0.17595551908016205, 0.5706185698509216, -0.19256845116615295, 0.03375910595059395, 0.46153876185417175, -0.08376719802618027, 0.3897377848625183, -0.24883876740932465, 0.17366603016853333, 0.30422529578208923, -0.21097803115844727, -0.37018635869026184, 0.07028358429670334, 0.07084295153617859, 0.027408182621002197, 0.2616139054298401, 0.13712826371192932, 0.2710491418838501, -0.5887698531150818, 0.6475839614868164, 0.28790533542633057, 0.13241168856620789, -0.18284837901592255, -0.2923277020454407, 0.6542664170265198, -0.30154508352279663, 0.17985258996486664, -0.6617704033851624, -0.09277094900608063, 0.14327770471572876, 0.06637746840715408, 0.11883827298879623, -0.4785222113132477, -0.026589898392558098, 0.2922164499759674, 0.752256453037262, -0.12547533214092255, -0.176147922873497, 0.3417990207672119, -0.07731892913579941, 0.31454527378082275, 0.5617246031761169, 0.13362450897693634, 0.19267761707305908, 0.1441425383090973, 0.25531888008117676, 0.40846553444862366, -0.05044785887002945, -0.14776232838630676, -0.2795673906803131, 0.15081526339054108, -0.09858357161283493, 0.527471125125885, -0.55224609375, -0.020551862195134163, 0.15487301349639893, 0.8316793441772461, -0.10396978259086609, 0.21699953079223633, -0.8225654363632202, -0.435188353061676, 0.238722562789917, -0.1903349608182907, 0.32130736112594604, 0.33468523621559143, 0.1957256942987442, -0.5007326602935791, -0.23214319348335266, -0.14797133207321167, -0.43095290660858154, -0.600269079208374, 0.1663435846567154, -0.06427805125713348, 0.342246413230896, 0.4279596209526062, 0.2602296769618988, -0.12026305496692657, -0.046245090663433075, -0.1758042722940445, -0.10049118846654892, 0.02312345616519451, 0.6960396766662598, -0.2372685968875885, 0.1794714331626892, 0.4171048700809479, 0.17491203546524048, -0.21044988930225372, -0.3559449017047882, 0.14625687897205353, -0.8100491762161255, 0.5435662269592285, -0.35441672801971436, -0.06812002509832382, 0.052741918712854385, -0.03781293332576752, -0.03987560793757439, -0.24918314814567566, 0.2453288584947586, -0.33462247252464294, -0.4448486864566803, 0.37329691648483276, 0.16693782806396484, 0.062006548047065735, -0.19079923629760742, 0.046729668974876404, 0.25861021876335144, -0.2678535282611847, -0.3209410011768341, -0.4051005244255066, 0.06532181799411774, -0.12142853438854218, -0.09789435565471649, 0.26230689883232117, -0.1780344545841217, 0.4206404983997345, 0.18386214971542358, -0.42686623334884644, 0.053841445595026016, 0.49149447679519653, 0.06030881404876709, -0.049763549119234085, -0.08773753046989441, -0.09861189872026443, -0.17832615971565247, 0.6645765900611877, 0.014157028868794441, 0.3257972002029419, 0.12905339896678925, -0.565393328666687, -0.059162236750125885, -0.3077314496040344, -0.4669590890407562, -0.279386430978775, 0.4356996417045593, 0.08420401066541672, -0.06911782175302505, 0.527021050453186, 0.6715191006660461, -0.08887047320604324, 0.47144657373428345, -0.4641391336917877, -0.3049122095108032, 0.30125632882118225, 0.15727604925632477, 0.06697690486907959, 0.17077422142028809, 0.8808340430259705, -0.4602775573730469, 0.21552503108978271, -0.1845836490392685, 0.10595338046550751, -0.4730599820613861, 0.4600042700767517, -0.5299984216690063, 0.04255684092640877, -0.34837648272514343, -0.07223565131425858, 0.2364073246717453, 0.3112059533596039, -0.034531064331531525, 0.27942928671836853, -0.5775824785232544, 0.3569447696208954, -0.19934996962547302, -0.2305455356836319, -0.2688233256340027, 0.3069663941860199, -0.3476727306842804, 0.4868132770061493, -0.2271377444267273, -0.14971521496772766, 0.2512028217315674, -0.6067898869514465, -0.13253439962863922, 0.15797869861125946, -0.023838520050048828, 0.40324434638023376, 0.6137548089027405, -0.425149530172348, 0.0702906996011734, 0.4729706346988678, 0.542352020740509, 0.5046394467353821, 0.044106803834438324, -0.24586732685565948, 0.18398159742355347, -0.40348732471466064, -0.2551383674144745, -0.14786048233509064, 0.3927519619464874, -0.5232926607131958, 0.2754909098148346, -0.2372252345085144, -0.18015596270561218, -0.024198031052947044, -0.34148767590522766, 0.3598000109195709, -0.12364727258682251, 0.04370398074388504, -0.34629741311073303, -0.2562452554702759, 0.002529044635593891, 0.28227049112319946, 0.22431673109531403, 0.14984919130802155, -0.6420018076896667, -0.04989979788661003, 0.2750278115272522, 0.0664229616522789, 0.5477789640426636, -0.1734050065279007, 0.25791266560554504, 0.010086944326758385, 0.009886425919830799, -0.1029108539223671, 0.059418149292469025, -0.7604360580444336, 0.373532235622406, -0.3474105894565582, 0.5223414301872253, 0.16236835718154907, -0.05497650429606438, -0.004848613869398832, 0.47654327750205994, 0.18378853797912598, 0.15346331894397736, 0.1825602501630783, -0.2349412739276886, -0.404590904712677, 0.3449527621269226, -0.28433936834335327, 0.10924283415079117, -0.284048855304718, -0.03709442913532257, 0.2619648277759552, 0.4048234224319458, -0.3965096175670624, 0.02457447350025177, -0.12135017663240433, -0.008048929274082184, 0.4949513375759125, 0.23853027820587158, 0.5727258324623108, 0.008522178046405315, -0.37552136182785034, 0.18514443933963776, -0.12113335728645325, 0.32974332571029663, 0.3536655902862549, -0.04394945874810219, 0.26191043853759766, -0.5275434851646423, 0.17329658567905426, -0.5028256177902222, -0.007938658818602562, 0.3328840136528015, 0.11743427813053131]}
{<span class="hljs-string">"id"</span>: <span class="hljs-string">"019693495e04a3d5d6e85ae5ee0de8c823"</span>, <span class="hljs-string">"cont"</span>: <span class="hljs-string">"å¸¸è§„èµ›ä¸­ï¼Œå¿«èˆ¹åœ¨å®¢åœºä»¥118-121æƒœè´¥äºå‡¯å°”ç‰¹äººï¼Œé­é‡äº†ä»¤äººé—æ†¾çš„å¤±è´¥ã€‚æ­¤å‰å¿«èˆ¹å·²ç»ç»å†äº†å…­è¿è´¥ï¼Œè™½ç„¶ä»–ä»¬åˆšåˆšåœ¨ä¸€åœºæ¿€çƒˆçš„åŒåŠ æ—¶å¤§æˆ˜ä¸­å‡»è´¥äº†ç‹¬è¡Œä¾ ï¼Œä½†é¢å¯¹ä¸œéƒ¨å€’æ•°ç¬¬äº”çš„å‡¯å°”ç‰¹äººï¼Œçƒé˜Ÿå†æ¬¡åƒç˜ªï¼Œå¹¶ä¸”è¾“å¾—ç›¸å½“å½»åº•ã€‚ä»æ¯”èµ›å¼€å§‹åˆ°ç»“æŸï¼Œå¿«èˆ¹å§‹ç»ˆæœªæ›¾é¢†å…ˆï¼Œåˆ†å·®æœ€å¤šä¸€åº¦æ‹‰å¼€åˆ°24åˆ†ã€‚\nå°½ç®¡å¦‚æ­¤ï¼Œå“ˆç™»çš„è¡¨ç°å ªç§°æœ¬åœºæœ€å¤§äº®ç‚¹ï¼Œä»–å…¨åœºå‡ºåœº38åˆ†é’Ÿï¼ŒæŠ•ç¯®22ä¸­9ï¼Œä¸‰åˆ†11ä¸­5ï¼Œç½šçƒ15ä¸­14ï¼Œè±ªå–37åˆ†7ç¯®æ¿8åŠ©æ”»çš„æ•°æ®ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå“ˆç™»ä¸ŠåŠåœºçŠ¶æ€å¹¶ä¸ç†æƒ³ï¼ŒæŠ•ç¯®å‘½ä¸­ç‡åªæœ‰1ä¸­7ï¼Œä»…å¾—åˆ°5åˆ†ï¼›ä½†è¿›å…¥ä¸‹åŠåœºååˆ™å¦‚åŒæ¢äº†ä¸ªäººï¼Œå•æªåŒ¹é©¬ç ä¸‹äº†32åˆ†ï¼Œå°¤å…¶æ˜¯ç¬¬å››èŠ‚ç‹‚é£™18åˆ†ï¼Œå‡ ä¹ä¸€äººæŒ‘èµ·äº†å¿«èˆ¹åæ‰‘çš„å¤§æ——ã€‚\næ¯”èµ›ç¬¬å››èŠ‚è¿˜å‰©5åˆ†é’Ÿæ—¶ï¼Œå¿«èˆ¹ä»ä»¥98-108è½å10åˆ†ï¼Œéšåå“ˆç™»å¸¦é¢†çƒé˜Ÿå¼€å¯ç–¯ç‹‚è¿½åˆ†æ¨¡å¼ï¼šè¿ç»­å¤šæ¬¡ä¸Šç¯®ã€ä¸‰åˆ†å¤–çº¿å‘½ä¸­ã€ä¸¤ç½šå…¨ä¸­ï¼Œæ­é…ç§‘æ—æ–¯çš„æ‰£ç¯®ï¼ŒçŸ­çŸ­äº”åˆ†é’Ÿå†…å“ˆç™»å°±è´¡çŒ®äº†çƒé˜Ÿæœ€å20åˆ†ä¸­çš„18åˆ†ã€‚åœ¨æœ€åä¸åˆ°30ç§’çš„æ—¶é—´é‡Œï¼Œå“ˆç™»æ›´æ˜¯è¿ç»­æ‹¿åˆ°9åˆ†ï¼Œå°†å·®è·ç¼©å°åˆ°ä»…å·®1åˆ†ï¼Œä¼¼ä¹èƒœåˆ©å°±åœ¨çœ¼å‰ã€‚\né—æ†¾çš„æ˜¯ï¼Œå…³é”®æ—¶åˆ»å“ˆç™»çš„ç»å¹³ä¸‰åˆ†åå‡ºã€‚å¦‚æœé‚£ä¸€çƒèƒ½è¿›ï¼Œä¸ä»…å¿«èˆ¹å°†å®ŒæˆæƒŠå¤©å¤§é€†è½¬ï¼Œè¿™æ®µ22ç§’è¿å¾—12åˆ†çš„ç¥å¥‡è¡¨ç°è¿˜å¯èƒ½è½½å…¥NBAå²å†Œï¼Œä¸éº¦è¿ª35ç§’13åˆ†çš„ä¼ å¥‡æ—¶åˆ»é½åã€‚ç„¶è€Œå¦‚ä»Šåªèƒ½å¹æ¯â€œå·®ä¸€ç‚¹â€ï¼Œå¸ƒç½®è¿™æ¬¡è¿›æ”»çš„æ•™ç»ƒæ˜¾ç„¶ä¸æ˜¯æ³°ä¼¦å¢ï¼Œæ•´ä½“æˆ˜æœ¯å®‰æ’ä¹Ÿå¼•å‘çƒè¿·è®¨è®ºã€‚\næœ‰è¯„è®ºæŒ‡å‡ºï¼Œå“ˆç™»æœ€åå‡ åˆ†é’Ÿçš„æ‹¼ææ°ä¼¼ä»–æ•´ä¸ªèŒä¸šç”Ÿæ¶¯çš„å†™ç…§ï¼šæ— æ¯”ç¥å‹‡å´æ€»æ˜¯å·®ä¸€ç‚¹ç‚¹å°±èƒ½åˆ›é€ å†å²ã€‚ä»Šå¹´å“ˆç™»ç¡®å®ä»˜å‡ºäº†å·¨å¤§åŠªåŠ›ï¼Œæœ€è¿‘å››åœºæ¯”èµ›çš„æ•°æ®æ˜¾ç¤ºä»–çš„ç«çˆ†çŠ¶æ€ï¼š\n- å¯¹é˜µè€é¹°ï¼š35åˆ†10ç¯®æ¿11åŠ©æ”»\n- å¯¹é˜µæ˜é‡‘ï¼š23åˆ†8ç¯®æ¿5åŠ©æ”»\n- å¯¹é˜µç‹¬è¡Œä¾ ï¼š41åˆ†14ç¯®æ¿11åŠ©æ”»\n- å¯¹é˜µå‡¯å°”ç‰¹äººï¼š37åˆ†7ç¯®æ¿8åŠ©æ”»\nå››åœºæ¯”èµ›å¹³å‡ä¸Šåœº39åˆ†é’Ÿï¼Œåœºå‡34åˆ†9.8ç¯®æ¿8.8åŠ©æ”»æ¥è¿‘ä¸‰åŒçš„è±ªåæ•°æ®ï¼Œä½†å¿«èˆ¹åªæ‹¿ä¸‹ä¸€åœºèƒœåˆ©ã€‚è€Œä¸”ï¼Œæœ¬èµ›å­£å¿«èˆ¹å¼€å±€è‰°éš¾ï¼Œå—å›°äºå¤šä¸ªä¼¤ç—…ä¸çŠ¶æ€ä¸‹æ»‘â€”â€”æ¯”å°”æ—©æ—©æŠ¥é”€ï¼Œä¼¦çº³å¾·ä¼¤ç¼ºï¼Œå°ä¿ç½—å’Œâ€œå¤§æ´›â€çŠ¶æ€ä½è¿·ï¼Œç¥–å·´èŒ¨ä¹Ÿæ— æ³•å»¶ç»­å»å¹´è¡¨ç°ã€‚æ›´é›ªä¸ŠåŠ éœœçš„æ˜¯ï¼Œå¤‡å—æœŸå¾…çš„å°ç¼æ–¯æœ¬åœºè´Ÿä¼¤é€€å‡ºï¼Œç¬¬å››èŠ‚å·²æ‹„æ‹ç¦»åœºï¼Œååœºé˜µå®¹æ‰è¥Ÿè§è‚˜ã€‚\nå“ˆç™»çŠ¶æ€è™½æ¥è¿‘å·…å³°ï¼Œä½†å•æ‰“ç‹¬æ–—ç»éé•¿ä¹…ä¹‹è®¡ã€‚å¿«èˆ¹å¿…é¡»å°½å¿«æ‰¾åˆ°ç ´è§£æ–¹æ¡ˆï¼Œä¸ºå“ˆç™»åˆ†æ‹…å‹åŠ›ï¼Œè¡¥å¼ºé˜µå®¹æ·±åº¦ã€‚å¦åˆ™ï¼Œä»Šå¹´å¿«èˆ¹è¿å­£åèµ›é—¨ç¥¨éƒ½éš¾ä¿ï¼Œä¸å…æˆä¸ºè”ç›Ÿçš„ç¬‘æŸ„ã€‚å¸Œæœ›çƒé˜Ÿç®¡ç†å±‚èƒ½è­¦è§‰èµ·æ¥ï¼Œä¸è´Ÿå“ˆç™»çš„å…¨åŠ›ä»¥èµ´ã€‚"</span>, <span class="hljs-string">"cont_vector"</span>: [0.34697583317756653, 0.022833378985524178, -0.3224949240684509, 0.18710270524024963, -0.2006617784500122, 0.16572287678718567, -0.05492241680622101, -0.42402806878089905, -0.5780504941940308, -0.011707579717040062, 0.22610926628112793, -0.3112683594226837, 0.060010943561792374, 0.10769341140985489, 0.6409831047058105, 0.6394708156585693, -0.2248380035161972, -0.39919424057006836, 0.3614487946033478, 0.11376171559095383, 0.017768414691090584, 0.42112088203430176, 0.5222823023796082, -0.18153122067451477, -0.1691824495792389, -0.03321228548884392, 0.015711788088083267, 0.08341602981090546, 0.29281875491142273, 0.11923649907112122, 0.23919551074504852, -0.045968540012836456, 0.18990826606750488, -0.24068458378314972, -0.2037169337272644, -0.026498030871152878, -0.4008246064186096, -0.414450079202652, 0.004170347470790148, 0.03195694461464882, -0.08641158789396286, -0.372729629278183, 0.1292789876461029, 0.030119910836219788, -0.5474095940589905, -0.12053532898426056, 0.20536255836486816, -0.08480800688266754, -0.11582448333501816, 0.3750057518482208, -0.46054258942604065, 0.24057365953922272, 0.4123747646808624, 0.6033463478088379, 0.3433053195476532, -0.13918942213058472, 0.18418173491954803, 0.05443061143159866, -0.17490965127944946, -0.37550684809684753, -0.2883095145225525, 0.009009637869894505, 0.5445632934570312, 0.12939709424972534, 0.030661538243293762, 0.28860989212989807, 0.5394995212554932, -0.18513648211956024, -0.36296287178993225, 0.007016885094344616, -0.12511657178401947, -0.0719219222664833, 0.23663826286792755, 0.33158594369888306, 0.12834680080413818, 0.23360216617584229, 0.5202428698539734, -0.26464882493019104, -0.3131464421749115, -0.3008125126361847, -0.7835593223571777, -0.38134047389030457, 0.24811303615570068, -0.2841545045375824, 0.017041437327861786, -0.5294182300567627, 0.14763928949832916, 0.34422099590301514, -0.20659859478473663, 0.3588687479496002, -0.1354057788848877, 0.02410174161195755, -0.5987427234649658, 0.18216434121131897, -0.47329840064048767, -0.17766718566417694, 0.1514386385679245, 0.33098727464675903, 0.5526669025421143, -0.3849710524082184, 0.10386545956134796, 0.04000062495470047, -0.012056021951138973, -0.318990558385849, 0.05367042124271393, 0.33160868287086487, -0.1913478821516037, -0.18770822882652283, 0.13494332134723663, -0.1945083886384964, 0.31971874833106995, -0.40164607763290405, -0.0545269213616848, -0.3497829735279083, 0.1594398021697998, -0.26868024468421936, -0.1429435908794403, 0.33803004026412964, 0.40992680191993713, -0.5514090061187744, 0.3380214273929596, 0.20918241143226624, 0.09370920807123184, -0.6097041964530945, -0.10624834150075912, -0.1259210705757141, 0.08742374181747437, 0.4004606306552887, -0.1066417321562767, -0.34183019399642944, -0.3770008385181427, 0.41108301281929016, 0.3003471791744232, -0.2014966756105423, -0.07213155925273895, 0.2892962694168091, 0.2274816483259201, 0.31695225834846497, 0.019272809848189354, 0.016278477385640144, -0.015040485188364983, -0.5356128811836243, 0.17108799517154694, 0.46724817156791687, 0.314921498298645, 0.07411351799964905, 0.4360836148262024, 0.07678969204425812, -0.281543105840683, -0.20281006395816803, -0.2591347098350525, -0.2730047404766083, -0.012512940913438797, 0.4169934391975403, 0.4702601134777069, 0.007476530037820339, -0.4894673526287079, -0.6877990961074829, -0.20997662842273712, 0.17905575037002563, 0.23229213058948517, 0.5824217796325684, 0.10228125751018524, 0.4574472904205322, -0.3032231628894806, 0.5752228498458862, 0.5480443239212036, -0.2645842432975769, -0.07690054923295975, 0.11959969997406006, -0.24788478016853333, -0.13027982413768768, -0.0126478411257267, -0.35468965768814087, 0.2825104296207428, 0.18811695277690887, -0.12005516141653061, -0.435889333486557, 0.44328662753105164, -0.28212249279022217, -0.22443658113479614, 0.6384224891662598, -0.3193124830722809, 0.11582641303539276, 0.06950418651103973, 0.09020912647247314, -0.5144643783569336, -0.2296285629272461, -0.45169174671173096, 0.084107406437397, 0.18128590285778046, -0.06066720932722092, 0.22988609969615936, -0.4035722017288208, -0.2864770293235779, -0.3674066960811615, -0.1600741595029831, 0.4203360676765442, -0.4394625723361969, -0.12548504769802094, 0.07693032175302505, 0.6372324228286743, -0.27850139141082764, 0.3237819969654083, 0.5503239035606384, 0.13845603168010712, 0.1126200407743454, -0.49676021933555603, -0.20216518640518188, -0.22463130950927734, -0.0864386036992073, 0.29717153310775757, 0.5097805857658386, 0.6436189413070679, 0.4390948712825775, -0.23072418570518494, 0.44299212098121643, 0.00961222779005766, -0.3847070336341858, 0.6025364995002747, 0.007901162840425968, 0.41320911049842834, -0.09178045392036438, -0.005419972352683544, -0.09509777277708054, -0.21897491812705994, -0.07980946451425552, -0.2088605910539627, 0.3036133944988251, -0.3312484622001648, -0.14348123967647552, 0.38895347714424133, 0.6673099994659424, -0.5919870734214783, 0.12698563933372498, 0.6328051686286926, -0.1584436148405075, 0.35523146390914917, -0.5722723603248596, 0.2762141823768616, -0.0008141515427269042, 0.31848251819610596, -0.24131399393081665, -0.1315194070339203, 0.31015345454216003, -0.3030695617198944, 0.007263690698891878, -0.3047998547554016, -0.17871136963367462, -0.24041731655597687, 0.45619142055511475, 0.27994304895401, 0.18575644493103027, 0.3290867805480957, -0.0022775311954319477, -0.11276846379041672, -0.13267822563648224, 0.1188419982790947, -0.43595942854881287, -0.40401312708854675, -0.15579994022846222, -0.33825936913490295, 0.13771629333496094, 0.45907092094421387, -0.4090372920036316, -0.3495202362537384, 0.29135313630104065, -0.25296956300735474, -0.01750417985022068, 0.263050377368927, -0.2708970904350281, -0.43561720848083496, 0.28731250762939453, 0.1790975034236908, -0.03968453407287598, -0.6009276509284973, 0.2573123872280121, 0.22292615473270416, -0.16022644937038422, -0.0912497490644455, 0.18111343681812286, 0.14598463475704193, -0.27198299765586853, -0.07860102504491806, -0.5107045769691467, 0.5779612064361572, -0.20503896474838257, -0.7352764010429382, 0.03150813281536102, 0.2566361725330353, 0.3990482985973358, 0.07379676401615143, 0.10038529336452484, -0.3949037194252014, 0.1576564908027649, 0.1446097195148468, 0.05424593389034271, -0.3253476321697235, 0.09047847241163254, 0.7783471345901489, -0.5396043658256531, 0.10356369614601135, -0.605324387550354, -0.705812931060791, -0.45689427852630615, 0.44353213906288147, 0.4297986924648285, 0.5071682929992676, -0.5673052668571472, -0.04907473176717758, 0.20627915859222412, 0.21134532988071442, 0.5026469230651855, 0.24792428314685822, 0.1704903542995453, 0.010924004018306732, 0.31990692019462585, -0.1254860907793045, 0.18971461057662964, 0.5419906377792358, 0.022355133667588234, -0.4023658037185669, 0.4566109776496887, 0.03972111642360687, 0.3280624449253082, -0.130833238363266, -0.1661476194858551, 0.2619311809539795, -0.33853572607040405, -0.02458779141306877, -0.23269005119800568, -0.10997918248176575, 0.5263694524765015, -0.23064672946929932, -0.1262163519859314, 0.6831716299057007, 0.19647590816020966, -0.0058198608458042145, -0.2929839491844177, -0.04363774135708809, -0.17686428129673004, 0.25108057260513306, 0.20176826417446136, 0.013708406127989292, -0.27664440870285034, 0.333453506231308, -0.17594178020954132, -0.31854236125946045, -0.3191490173339844, 0.18358004093170166, -0.06904035806655884, -0.019979586824774742, 0.1909836083650589, 0.28874433040618896, 0.07032293826341629, -0.053399983793497086, -0.008950628340244293, -0.2699246406555176, 0.010901496745646, -0.499774694442749, -0.02503921277821064, 0.39180296659469604, 0.2945444583892822, 0.35897770524024963, -0.2971055209636688, -0.17831826210021973, -0.43804290890693665, 0.16725105047225952, -0.24265922605991364, -0.2558131515979767, -0.21446430683135986, -0.18204987049102783, 0.16333766281604767, -0.08677184581756592, 0.30642521381378174, 0.1409057080745697, 0.11295455694198608, 0.22003020346164703, -0.11036001890897751, -0.6730701327323914, 0.07407328486442566, 0.023850642144680023, 0.10778762400150299, -0.227139413356781, -0.1973918229341507, 0.16605880856513977, 0.02325354516506195, 0.5637686252593994, -0.006432302296161652, 0.16664248704910278, 0.2055852711200714, -0.4381622076034546, 0.2936196029186249, -0.28066787123680115, -0.2561837136745453, -0.32446402311325073, 0.43407654762268066, -0.3999022841453552, 0.015010821633040905, -0.15772698819637299, -0.20628371834754944, 0.0038130786269903183, -0.6543219089508057, -0.23253747820854187, 0.2791994512081146, 0.317117840051651, 0.3007357120513916, 0.040701549500226974, -0.5512574911117554, 0.07311537116765976, -0.15165625512599945, -0.5216666460037231, 0.1684505194425583, 0.2769668698310852, 0.6388311982154846, -0.04908701777458191, -0.05635111406445503, 0.06911687552928925, 0.3883506655693054, 0.3189023435115814, 0.12654709815979004, -0.09948574751615524, 0.021068735048174858, 0.25976812839508057, -0.012262980453670025, 0.18236380815505981, -0.018875036388635635, 0.2345733344554901, -0.1315130889415741, 0.3792160749435425, -0.3514325022697449, 0.1578236073255539, -0.24551008641719818, 0.15121541917324066, -0.31049904227256775, -0.007366502191871405, 0.16992856562137604, 0.6780564785003662, 0.033335089683532715, -0.28923556208610535, -0.5614375472068787, -0.6542794704437256, -0.10835914313793182, 0.12279272079467773, 0.20247143507003784, -0.25652840733528137, 0.1280306875705719, 0.20827700197696686, -0.10724229365587234, 0.42510196566581726, -0.1026548445224762, -0.11981331557035446, -0.0029103837441653013, 0.24078235030174255, -0.40955060720443726, -0.6320157051086426, 0.03493480011820793, 0.4517262578010559, 0.14767855405807495, -0.2573226988315582, -0.4225393533706665, 0.1720789670944214, 0.0017538816900923848, -0.13119636476039886, -0.4703454375267029, -0.4792669117450714, -0.10224268585443497, 0.17124265432357788, 0.35751405358314514, 0.5758031606674194, 0.017575562000274658, 0.43430399894714355, 0.21448272466659546, 0.041105061769485474, 0.09034187346696854, -0.21203991770744324, -0.11041519790887833, -0.1354375034570694, -0.22221148014068604, 0.4948326647281647, 0.5355435609817505, -0.2629753351211548, -0.10149603337049484, 0.20730753242969513, 0.12058362364768982, -0.5273824334144592, 0.12144237011671066, -0.14413033425807953, 0.4349282681941986, 0.04538873955607414, 0.19628237187862396, -0.47665080428123474, -0.14331306517124176, 0.637182354927063, 0.43118056654930115, 0.18867278099060059, -0.046925514936447144, -0.060284074395895004, 0.461848646402359, -0.17830654978752136, -0.036048244684934616, -0.10326950252056122, 0.27810290455818176, -0.16824372112751007, -0.471463143825531, 0.2188437432050705, 0.5320848226547241, -0.011840272694826126, 0.2794570028781891, 0.4704928398132324, 0.23272177577018738, 0.07807011902332306, 0.08675442636013031, 0.6206101775169373, 0.12159832566976547, -0.034004662185907364, 0.09575726836919785, 0.5938266515731812, -0.32080981135368347, -0.45121249556541443, 0.04405076801776886, 0.1814298927783966, -0.0731193795800209, 0.07533738017082214, 0.2620329260826111, 0.3686673939228058, 0.4071153998374939, 0.10866416245698929, -0.0033339345827698708, -0.2432309091091156, 0.07953223586082458, 0.29904985427856445, 0.555698812007904, -0.1754048615694046, 0.38841676712036133, -0.3158849775791168, -0.4214479625225067, 0.19106176495552063, -0.10760597139596939, 0.0730886235833168, 0.6019185185432434, -0.2710829973220825, 0.05056000500917435, -0.14348143339157104, 0.11422285437583923, 0.1973605901002884, -0.00758011918514967, 0.2686156630516052, 0.2548768222332001, -0.48945578932762146, -0.0808887705206871, -0.28918278217315674, -0.24923968315124512, -0.24022145569324493, -0.0174592062830925, 0.29954686760902405, -0.038596827536821365, -0.04825979098677635, 0.24701081216335297, -0.3689480423927307, 0.33375734090805054, 0.0697036162018776, -0.326120525598526, -0.2284628301858902, 0.35250890254974365, -0.07197294384241104, 0.2046741247177124, -0.03281416743993759, 0.10081706196069717, 0.43102988600730896, 0.16074217855930328, 0.43612951040267944, 0.24888448417186737, -0.10914690047502518, 0.39595454931259155, -0.05280836671590805, -0.06398487091064453, -0.27228066325187683, 0.12995119392871857, -0.2028440535068512, -0.21174557507038116, 0.5599325895309448, -0.12402083724737167, -0.4145103693008423, -0.21190474927425385, -0.17680653929710388, 0.38895347714424133, 0.0016005507204681635, 0.4533329904079437, -0.08490815758705139, -0.09637808054685593, 0.17707595229148865, 0.7075321078300476, 0.5371991991996765, 0.0943925529718399, 0.42058202624320984, -0.2749573290348053, -0.4772561490535736, -0.23580628633499146, -0.14449414610862732, -0.2893284857273102, -0.1944865584373474, -0.5317445397377014, 0.38174867630004883, 0.3268550634384155, 0.3304714262485504, -0.08718479424715042, -0.3070090711116791, -0.09894444793462753, 0.006358581129461527, 0.5668516755104065, -0.34920811653137207, 0.19206416606903076, 0.11441162973642349, -0.7526262402534485, -0.09956414252519608, -0.06369113177061081, -0.2829369008541107, 0.2946908473968506, 0.17880912125110626, 0.24899619817733765, 0.2634415328502655, -0.3962808847427368, -0.25140631198883057, 0.08686421066522598, 0.09428586065769196, -0.033580806106328964, 0.050324298441410065, -0.011535873636603355, 0.28761810064315796, 0.09612876176834106, -0.5811983346939087, 0.026677846908569336, 0.22086817026138306, 0.2943006455898285, 0.05796382576227188, 0.7409045100212097, 0.4243742525577545, -0.1824023425579071, -0.15550601482391357, -0.03414182364940643, 0.13557569682598114, 0.22122326493263245, -0.5460044741630554, 0.055130116641521454, 0.26797768473625183, -0.6008453369140625, -0.2151285707950592, 0.30039793252944946, 0.3845442235469818, -0.09857463091611862, -0.4225165843963623, -0.17513342201709747, 0.3960270881652832, 0.15544289350509644, -0.4903753995895386, -0.2120097577571869, 0.13906779885292053, 0.42231854796409607, 0.40754610300064087, 0.04794806241989136, -0.31901776790618896, 0.06387974321842194, -0.4624370038509369, -0.15338139235973358, 0.028357861563563347, 0.2016345113515854, 0.1174110397696495, 0.15654107928276062, 0.21447418630123138, -0.26767727732658386, 0.4507141411304474, 0.6169157028198242, -0.09427670389413834, -0.08710608631372452, 0.3677045404911041, -0.516632616519928, -0.19984175264835358, -0.5341260433197021, 0.5651294589042664, -0.18996569514274597, 0.0317014642059803, -0.3467211127281189, 0.3423977196216583, -0.33525940775871277, -0.5620333552360535, -0.49439358711242676, -0.28385886549949646, -0.013790802098810673, 0.15861134231090546, -0.1671665608882904, 0.41414856910705566, -0.08811119943857193, -0.4721570611000061, 0.04072341322898865, 0.6360927224159241, -0.06272062659263611, 0.2654755115509033, -0.23936046659946442, -0.003298425115644932, 0.269718199968338, -0.2637675404548645, -0.2342018187046051, -0.004456301219761372, -0.39309749007225037, -0.4364908039569855, 0.5570545792579651, -0.24070756137371063, -0.018420936539769173, 0.22621163725852966, -0.45981523394584656, -0.07840520888566971, 0.23014101386070251, 0.20253390073776245, -0.545153021812439, 0.004093918949365616, 0.37318432331085205, 0.3648586869239807, -0.4206681251525879, 0.19778969883918762, -0.10090159624814987, 0.23417755961418152, -0.11965445429086685, 0.17678877711296082, -0.4281606376171112, -0.37404027581214905, 0.2129732072353363, 0.4207744598388672, -0.48166272044181824, 0.36679112911224365, -0.16213831305503845, -0.410759836435318, 0.18934360146522522, -0.20830196142196655, -0.06856506317853928, 0.15922711789608002, -0.44220349192619324, -0.0695142075419426, 0.20663775503635406, 0.4687262773513794, -0.024194058030843735, 0.09458767622709274, -0.5417274832725525, 0.5434641242027283, -0.11395146697759628, 0.6337770223617554, 0.2395348846912384, -0.1074175089597702, -0.04889780655503273, 0.02426724135875702, -0.3830883800983429, 0.3891143202781677, -0.14073416590690613, -0.32059791684150696, -0.07221099734306335, 0.1747191995382309, -0.06255890429019928, 0.18511337041854858, -0.40501484274864197, 0.15552644431591034, -0.2309022694826126, -0.02339053340256214, -0.49383991956710815, -0.1088176965713501, -0.5049124360084534, -0.4527742266654968, 0.34520402550697327, 0.2396022528409958, 0.07559176534414291, 0.2757578194141388, -0.4892699718475342, -0.38897863030433655, -0.03203297406435013, 0.03062659129500389, 0.014689486473798752, -0.7239934802055359, -0.24532310664653778, 0.2565315365791321, -0.20014198124408722, 0.32849469780921936, 0.2783554792404175, 0.29582664370536804, -0.5350281596183777, 0.12446945160627365, -0.1650308072566986, 0.29236873984336853, -0.24851013720035553, 0.42722171545028687, 0.04816226288676262, 0.20703952014446259, 0.053252361714839935, 0.1405320018529892, -0.05294357240200043, -0.06397967040538788, 0.023570319637656212, -0.281028151512146, -0.04046871140599251, 0.10298541933298111, -0.4637322723865509, 0.13419879972934723, 0.36461177468299866, -0.0702555924654007, -0.29523491859436035, -0.07439739257097244, -0.30874860286712646, -0.3087843954563141, -0.34628674387931824, -0.03862128034234047, -0.31628894805908203, 0.2626640200614929, 0.3514306843280792, -0.1017487645149231, 0.5867248773574829, -0.5489633679389954, 0.0350642055273056, 0.21204744279384613, -0.44695472717285156, -0.4778880476951599, -0.09697989374399185, 0.14129890501499176, 0.5431915521621704, -0.5027372241020203, -0.5887117981910706, 0.14068356156349182, 0.031072482466697693, 0.39780908823013306, 0.5046506524085999, 0.09249038994312286, 0.39987584948539734, -0.19310657680034637, -0.07804891467094421, 0.358993798494339, 0.009821178391575813, -0.21422703564167023, 0.6423926949501038, 0.19899185001850128, -0.5880311727523804, -0.2723785638809204, -0.06560354679822922, 0.2969997525215149, 0.01176424976438284, 0.19177041947841644, 0.2910352051258087, -0.4708842635154724, 0.14930298924446106, -0.10030163824558258, -0.044090528041124344, 0.41166195273399353, 0.448283851146698, -0.05547277256846428, 0.10256019979715347, -0.07252396643161774, -0.5531343817710876, 0.09089300036430359, -0.7463218569755554, -0.015613709576427937, 0.11237872391939163, -0.46060100197792053, -0.14597919583320618, -0.247941255569458, 0.18319201469421387, 0.17762304842472076, -0.04139236360788345, -0.1084459125995636, 0.22652572393417358, 0.22297866642475128, 0.0065866680815815926, 0.7021909952163696, -0.7038468718528748, -0.26991376280784607, -0.07416552305221558, 0.33255964517593384, 0.3374091684818268, 0.6100388765335083, -0.29160845279693604, 0.06281619518995285, -0.18053191900253296, 0.4275287985801697, -0.5101093649864197, 0.1726013422012329, -0.30304303765296936, -0.028248215094208717, -0.3331882357597351, 0.15416407585144043, -0.2661422789096832, 0.5346991419792175, -0.17888104915618896, -0.4205954968929291, -0.5639411211013794, -0.1507183015346527, 0.19620168209075928, 0.3375704288482666, 0.19632455706596375, -0.01799703575670719, 0.09248404949903488, -0.5400241613388062, -0.4485524296760559, -0.3302421569824219, 0.4644607901573181, -0.5212894678115845, -0.18355105817317963, -0.19986656308174133, 0.49333250522613525, 0.20712648332118988, 0.28993335366249084, 0.2656167149543762, 0.32435324788093567, 0.5283422470092773, -0.12227346003055573, -0.06065014377236366, 0.25304245948791504, 0.27949196100234985, -0.7449630498886108, 0.3558346927165985, -0.6124804019927979, 0.25061970949172974, -0.3458652198314667, -0.4824979901313782, 0.09360159188508987, -0.5388962626457214, -0.39005333185195923, -0.1442333310842514, -0.03798350691795349, -0.24113987386226654, 0.364824116230011, 0.07773898541927338, -0.20477668941020966, -0.0863015204668045, 0.046695563942193985, -0.03505634143948555, 0.4212092459201813, 0.2533334493637085, 0.057133980095386505, -0.09183841198682785, -0.0429072305560112, 0.23799574375152588, -0.48247331380844116, -0.42209839820861816, 0.10244668275117874, -0.37588709592819214, 0.7621724605560303, 0.0897969901561737, -0.08840569853782654, -0.483003169298172, 0.35007452964782715, -0.18558841943740845, 0.4028243124485016, -0.22155584394931793, -0.07938329130411148, 0.43045681715011597, -0.37386250495910645, -0.11687900871038437, -0.2702612578868866, -0.08678348362445831, -0.33228495717048645, -0.5130224227905273, 0.04193935915827751, -0.23149509727954865, -0.5306613445281982, -0.3402445614337921, -0.4058864414691925, 0.3620496690273285, 0.3476814329624176, -0.47360217571258545, -0.4459947943687439, -0.4886447787284851, 0.14892606437206268, 0.3336237072944641, -0.10249759256839752, 0.1461927443742752, -0.6404029130935669, 0.285313218832016, 0.10945551097393036, 0.04631883651018143, -0.35918620228767395, -0.16250360012054443, -0.32791024446487427, 0.17171655595302582, -0.6241990327835083, 0.3888280391693115, -0.2645689845085144, -0.07178333401679993, 0.13990451395511627, -0.17601187527179718, -0.04146071895956993, -0.4625374972820282, -0.34640762209892273, -0.47074073553085327, -0.18190303444862366, 0.03919748216867447, 0.40882620215415955, -0.0915987566113472, -0.1773117333650589, -0.13814178109169006, 0.26029103994369507, -0.08829483389854431, 0.2951725423336029, -0.010357136838138103, 0.39616286754608154, -0.2940065562725067, 0.25639039278030396, -0.1510230004787445, -0.4698094129562378, 0.3283418118953705, 0.151661217212677, 0.01637502945959568, -0.15287142992019653, 0.16182920336723328, 0.08370505273342133, 0.28930211067199707, -0.24399538338184357, 0.31978505849838257, 0.016882479190826416, -0.2848835289478302, 0.015643861144781113, 0.3187680244445801, 0.36446723341941833, 0.12418484687805176, -0.27254706621170044, -0.14228376746177673, -0.008141127415001392, -0.003158475970849395, -0.2257232964038849, -0.4020027816295624]}
</code></pre>
<p>æ–°å»ºkibana.yml,é…ç½®ä¸Šé¢å¾—åˆ°çš„kibana_systemå¯†ç </p>
<pre><code class="hljs language-bash" lang="bash">server.host: <span class="hljs-string">"0.0.0.0"</span>
<span class="hljs-comment"># è¿™é‡Œes7.17æ˜¯dockerå¯åŠ¨esçš„å®¹å™¨åå­—ï¼Œkibanaå°±å¯ä»¥è¿æ¥esäº†</span>
elasticsearch.hosts: [<span class="hljs-string">"http://es7.17:9200"</span>]
<span class="hljs-comment"># å›ºå®šå€¼</span>
elasticsearch.username: <span class="hljs-string">"kibana_system"</span>
<span class="hljs-comment"># åˆå§‹åŒ–eså¯†ç å¾—åˆ°çš„ä¼—å¤šå¯†ç ä¸­çš„kibana_systemå¯†ç </span>
elasticsearch.password: <span class="hljs-string">"OSFamv1KYzDcZVb885ka"</span>
<span class="hljs-comment"># å¼€å¯è´¦å·å¯†ç </span>
xpack.security.enabled: <span class="hljs-literal">true</span>
</code></pre>
<p>kibana dockerå¯åŠ¨å‘½ä»¤ <em><strong>-v å†…å®¹ï¼Œæ ¹æ®å®é™…è·¯å¾„è‡ªå·±ä¿®æ”¹ï¼ï¼</strong></em></p>
<pre><code class="hljs language-bash" lang="bash">docker run --name kibana7.17 \
-p 5601:5601 \
-e TZ=<span class="hljs-string">"Asia/Shanghai"</span> \
-v <span class="hljs-string">"D:\docker\kibana7.17\config\kibana.yml"</span>:/usr/share/kibana/config/kibana.yml \
--network es-net-7.17 \
-d kibana:7.17.0
</code></pre>
<p>æ‰“å¼€<a href="https://link.juejin.cn?target=http%3A%2F%2Flocalhost%3A5601" target="_blank" title="http://localhost:5601" ref="nofollow noopener noreferrer">http://localhost:5601</a>, è¾“å…¥è´¦å·å¯†ç ç™»å½•ï¼Œåœ¨devtoolä¸­æ–°å»ºç´¢å¼•</p>
<pre><code class="hljs language-bash" lang="bash">PUT /article-my
{
  <span class="hljs-string">"mappings"</span>: {
    <span class="hljs-string">"properties"</span>: {
      <span class="hljs-string">"cont"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"text"</span>
      },
      <span class="hljs-string">"cont_vector"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"dense_vector"</span>,
        <span class="hljs-string">"dims"</span>: 1024
      }
    }
  }
}
</code></pre>
<p>é¡¹ç›®ä¾èµ–requirement.txt</p>
<pre><code class="hljs language-bash" lang="bash">anyio==4.11.0
certifi==2025.11.12
charset-normalizer==3.4.4
colorama==0.4.6
elastic-transport==9.2.0
elasticsearch==7.17.12
filelock==3.19.1
fsspec==2025.10.0
huggingface-hub==0.36.0
idna==3.11
Jinja2==3.1.6
joblib==1.5.2
MarkupSafe==3.0.3
mpmath==1.3.0
networkx==3.2.1
numpy==2.0.2
packaging==25.0
pandas==2.3.3
pillow==11.3.0
python-dateutil==2.9.0.post0
pytz==2025.2
PyYAML==6.0.3
regex==2025.11.3
requests==2.32.5
safetensors==0.6.2
scikit-learn==1.6.1
scipy==1.13.1
sentence-transformers==5.1.2
six==1.17.0
sniffio==1.3.1
sympy==1.14.0
threadpoolctl==3.6.0
tokenizers==0.22.1
torch==2.8.0
tqdm==4.67.1
transformers==4.57.1
typing_extensions==4.15.0
tzdata==2025.2
urllib3==1.26.20

</code></pre>
<p>å¯¼å…¥esData.jsonæ–‡ä»¶å†…å®¹åˆ°esï¼Œpythonä»£ç </p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> elasticsearch <span class="hljs-keyword">import</span> Elasticsearch
<span class="hljs-keyword">import</span> json

<span class="hljs-comment"># ======================</span>
<span class="hljs-comment"># 1. é…ç½® Elasticsearch è¿æ¥</span>
<span class="hljs-comment"># ======================</span>

<span class="hljs-comment"># æ›¿æ¢ä¸ºä½ çš„ ES åœ°å€ï¼Œæ¯”å¦‚å•æœºç‰ˆã€Dockerã€äº‘æœåŠ¡åœ°å€ç­‰</span>
es_host = <span class="hljs-string">"http://elastic:NBh5ObTk1lq2YZ4JQ2Ng@localhost:9200"</span>  <span class="hljs-comment"># ä¾‹å¦‚ï¼šhttp://your-es-server:9200</span>
es = Elasticsearch([es_host])

<span class="hljs-comment"># æ£€æŸ¥ ES æ˜¯å¦å¯è¿æ¥ï¼ˆå¯é€‰ï¼‰</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> es.ping():
    <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">"âŒ æ— æ³•è¿æ¥åˆ° Elasticsearchï¼Œè¯·æ£€æŸ¥ ES åœ°å€æ˜¯å¦æ­£ç¡®æˆ–æœåŠ¡æ˜¯å¦å¯åŠ¨"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… å·²è¿æ¥åˆ° Elasticsearch"</span>)

<span class="hljs-comment"># ======================</span>
<span class="hljs-comment"># 2. é…ç½®ç´¢å¼•åç§°</span>
<span class="hljs-comment"># ======================</span>

index_name = <span class="hljs-string">"article-my"</span>  <span class="hljs-comment"># ä½ è¦å†™å…¥çš„ ES ç´¢å¼•åï¼Œå¯è‡ªå®šä¹‰ï¼ˆå¦‚ï¼šusers, products, logsï¼‰</span>

<span class="hljs-comment"># å¦‚æœç´¢å¼•ä¸å­˜åœ¨ï¼ŒES ä¼šåœ¨ç¬¬ä¸€æ¬¡æ’å…¥æ—¶è‡ªåŠ¨åˆ›å»ºï¼ˆæ ¹æ®æ•°æ®ç»“æ„æ¨æ–­ mappingï¼‰</span>
<span class="hljs-comment"># ä½ ä¹Ÿå¯ä»¥æå‰æ‰‹åŠ¨åˆ›å»ºç´¢å¼•å’Œ mappingï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰</span>

<span class="hljs-comment"># ======================</span>
<span class="hljs-comment"># 3. è¯»å– data.json æ–‡ä»¶å¹¶é€è¡Œå†™å…¥ ES</span>
<span class="hljs-comment"># ======================</span>

<span class="hljs-comment"># jsonl_file_path = "exported_data.json"  # ä½ çš„ jsonl æ–‡ä»¶è·¯å¾„</span>
jsonl_file_path = <span class="hljs-string">"esData.json"</span>  <span class="hljs-comment"># ä½ çš„ jsonl æ–‡ä»¶è·¯å¾„</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">import_jsonlines_to_es</span>():
    success_count = <span class="hljs-number">0</span>
    error_count = <span class="hljs-number">0</span>

    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(jsonl_file_path, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">for</span> line_number, line <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(f, <span class="hljs-number">1</span>):
            line = line.strip()  <span class="hljs-comment"># å»æ‰é¦–å°¾ç©ºç™½å­—ç¬¦</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> line:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âš ï¸ ç¬¬ <span class="hljs-subst">{line_number}</span> è¡Œä¸ºç©ºï¼Œè·³è¿‡"</span>)
                <span class="hljs-keyword">continue</span>

            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># è§£æ JSON</span>
                doc = json.loads(line)
            <span class="hljs-keyword">except</span> json.JSONDecodeError <span class="hljs-keyword">as</span> e:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ ç¬¬ <span class="hljs-subst">{line_number}</span> è¡Œ JSON è§£æå¤±è´¥ï¼š<span class="hljs-subst">{e}</span>"</span>)
                error_count += <span class="hljs-number">1</span>
                <span class="hljs-keyword">continue</span>

            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># å†™å…¥åˆ° Elasticsearch</span>
                <span class="hljs-comment"># å¦‚æœä¸æŒ‡å®š _idï¼ŒES ä¼šè‡ªåŠ¨ç”Ÿæˆ</span>
                <span class="hljs-built_in">id</span> = doc.get(<span class="hljs-string">"id"</span>)  <span class="hljs-comment"># å¦‚æœ JSON ä¸­æœ‰ _id å­—æ®µï¼Œå¯ä»¥ç”¨å®ƒä½œä¸ºæ–‡æ¡£ ID</span>
                response = es.index(index=index_name, <span class="hljs-built_in">id</span>=<span class="hljs-built_in">id</span>, document=doc)

                <span class="hljs-comment"># æˆ–è€…ï¼Œå¦‚æœä½ æƒ³æŒ‡å®šæ–‡æ¡£ _idï¼Œå¯ä»¥è¿™æ ·ï¼š</span>
                <span class="hljs-comment"># response = es.index(index=index_name, id=doc.get("id"), document=doc)</span>

                success_count += <span class="hljs-number">1</span>
                <span class="hljs-keyword">if</span> line_number % <span class="hljs-number">10</span> == <span class="hljs-number">0</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸŸ¢ å·²å¯¼å…¥ç¬¬ <span class="hljs-subst">{line_number}</span> è¡Œï¼Œå½“å‰æˆåŠŸï¼š<span class="hljs-subst">{success_count}</span>ï¼Œå¤±è´¥ï¼š<span class="hljs-subst">{error_count}</span>"</span>)

            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"âŒ ç¬¬ <span class="hljs-subst">{line_number}</span> è¡Œå†™å…¥ ES å¤±è´¥ï¼š<span class="hljs-subst">{e}</span>"</span>)
                error_count += <span class="hljs-number">1</span>

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ğŸ‰ å¯¼å…¥å®Œæˆï¼æˆåŠŸï¼š<span class="hljs-subst">{success_count}</span> æ¡ï¼Œå¤±è´¥ï¼š<span class="hljs-subst">{error_count}</span> æ¡"</span>)

<span class="hljs-comment"># ======================</span>
<span class="hljs-comment"># 4. æ‰§è¡Œå¯¼å…¥</span>
<span class="hljs-comment"># ======================</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    import_jsonlines_to_es()
</code></pre>
<p>å› ä¸ºesData.jsonä¸­æ•°æ®å¯¼å…¥ä¹‹åï¼Œå‘é‡å­—æ®µæœ‰å€¼ï¼Œéœ€è¦ç½®ç©º,devtoolä¸­æ‰§è¡Œ</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">## è®¾ç½®cont_vectorå­—æ®µä¸ºç©º</span>
POST /article-my/_update_by_query
{
  <span class="hljs-string">"script"</span>: {
    <span class="hljs-string">"source"</span>: <span class="hljs-string">"ctx._source.remove('cont_vector')"</span>,
    <span class="hljs-string">"lang"</span>: <span class="hljs-string">"painless"</span>
  }
}
</code></pre>
<p>è¯»å–eså†…å®¹ï¼Œé‡æ–°å‘é‡åŒ–ï¼Œpythonä»£ç </p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> elasticsearch <span class="hljs-keyword">import</span> Elasticsearch
<span class="hljs-keyword">import</span> json 
<span class="hljs-keyword">from</span> test_tengxun_hunyuan <span class="hljs-keyword">import</span> get_embedding
<span class="hljs-keyword">from</span> es_doc_embeding <span class="hljs-keyword">import</span> get_embedding <span class="hljs-keyword">as</span> get_embedding_local

<span class="hljs-comment"># è¿æ¥åˆ°ä½ çš„æ—§ Elasticsearch é›†ç¾¤</span>
es = Elasticsearch([<span class="hljs-string">"http://elastic:NBh5ObTk1lq2YZ4JQ2Ng@localhost:9200"</span>]) 
index_name = <span class="hljs-string">"article-my"</span>
field_to_export = <span class="hljs-string">"cont"</span>

<span class="hljs-comment"># æŸ¥è¯¢æ•°æ®</span>
results = []

<span class="hljs-keyword">def</span> <span class="hljs-title function_">getDocs</span>():
    page = es.search(
    index=index_name,
    _source=[field_to_export],
    size=<span class="hljs-number">1000</span>,
    body={<span class="hljs-string">"query"</span>: {<span class="hljs-string">"bool"</span>: {
        <span class="hljs-string">"must_not"</span>: {<span class="hljs-string">"exists"</span>: {<span class="hljs-string">"field"</span>: <span class="hljs-string">"cont_vector"</span>}
        }
    }}}
    <span class="hljs-comment"># ,scroll='2m' </span>
    )
    <span class="hljs-comment"># print(page)</span>

    <span class="hljs-comment"># scroll_id = page['_scroll_id']</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ–‡æ¡£æ•°é‡ï¼š<span class="hljs-subst">{page[<span class="hljs-string">'hits'</span>][<span class="hljs-string">'total'</span>][<span class="hljs-string">'value'</span>]}</span>"</span> )
    hits = page[<span class="hljs-string">'hits'</span>][<span class="hljs-string">'hits'</span>]
    <span class="hljs-keyword">return</span> hits

<span class="hljs-keyword">def</span> <span class="hljs-title function_">updateDocVender</span>(<span class="hljs-params">doc_id, cont_vector</span>):
    es.update(
        index=index_name,
        <span class="hljs-built_in">id</span>=doc_id,
        doc = {
                <span class="hljs-string">"cont_vector"</span>: cont_vector
        }
    )

<span class="hljs-keyword">def</span> <span class="hljs-title function_">getVenderById</span>(<span class="hljs-params">doc_id</span>):
    res = es.get(
        index=index_name,
        <span class="hljs-built_in">id</span>=doc_id
    )
    <span class="hljs-keyword">if</span> <span class="hljs-string">'cont_vector'</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> res[<span class="hljs-string">'_source'</span>]:
        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>
    <span class="hljs-keyword">return</span> res[<span class="hljs-string">'_source'</span>][<span class="hljs-string">'cont_vector'</span>]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">calVender</span>(<span class="hljs-params">embedding_type=<span class="hljs-string">'tengxun'</span></span>):
    hits = getDocs()
    <span class="hljs-keyword">for</span> hit <span class="hljs-keyword">in</span> hits:
        cont_vender_repo = getVenderById(hit[<span class="hljs-string">'_id'</span>])
        <span class="hljs-keyword">if</span> cont_vender_repo:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ–‡ç« idï¼š'</span> + hit[<span class="hljs-string">'_id'</span>] + <span class="hljs-string">' å·²å­˜åœ¨å‘é‡ï¼Œè·³è¿‡'</span>)
            <span class="hljs-keyword">continue</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ–‡ç« idï¼š'</span> + hit[<span class="hljs-string">'_id'</span>])
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ–‡ç« å†…å®¹å»è·å–å‘é‡ï¼š'</span> + hit[<span class="hljs-string">'_source'</span>][field_to_export][:<span class="hljs-number">100</span>])
        inputStr = hit[<span class="hljs-string">'_source'</span>][field_to_export][:<span class="hljs-number">1000</span>]
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">len</span>(inputStr.strip()) == <span class="hljs-number">0</span>):
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'æ–‡ç« å†…å®¹ä¸ºç©ºï¼Œè·³è¿‡'</span>)
            <span class="hljs-keyword">continue</span>
        req_body = {<span class="hljs-string">"Input"</span>: inputStr}
        
        <span class="hljs-built_in">print</span>(<span class="hljs-string">'è·å–å‘é‡è¯·æ±‚ä½“ï¼š'</span> + json.dumps(req_body, ensure_ascii=<span class="hljs-literal">False</span>))
        <span class="hljs-keyword">if</span> embedding_type==<span class="hljs-string">'local'</span>:
            cont_vender = get_embedding_local(inputStr)  <span class="hljs-comment"># åªå–å‰1000å­—ç¬¦è¿›è¡Œæµ‹è¯•</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'è·å–åˆ°çš„å‘é‡ï¼š'</span> + <span class="hljs-built_in">str</span>(cont_vender))
            updateDocVender(hit[<span class="hljs-string">'_id'</span>], cont_vender)
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'---------------------'</span>)
        <span class="hljs-keyword">elif</span> embedding_type==<span class="hljs-string">'tengxun'</span>:
            cont_vender = get_embedding(json.dumps(req_body))  <span class="hljs-comment"># åªå–å‰1000å­—ç¬¦è¿›è¡Œæµ‹è¯•</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'è·å–åˆ°çš„å‘é‡ï¼š'</span> + cont_vender)
            cont_vender_obj = json.loads(cont_vender)
            updateDocVender(hit[<span class="hljs-string">'_id'</span>], cont_vender_obj[<span class="hljs-string">'Response'</span>][<span class="hljs-string">'Data'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'Embedding'</span>])
            <span class="hljs-built_in">print</span>(<span class="hljs-string">'---------------------'</span>)
        <span class="hljs-comment"># break  # åªå¤„ç†ç¬¬ä¸€æ¡è®°å½•è¿›è¡Œæµ‹è¯•</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    calVender(<span class="hljs-string">'local'</span>)


</code></pre>
<p>eså‘é‡æŸ¥è¯¢pythonä»£ç </p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> elasticsearch <span class="hljs-keyword">import</span> Elasticsearch
<span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Dict</span>

es = Elasticsearch([<span class="hljs-string">"http://elastic:NBh5ObTk1lq2YZ4JQ2Ng@localhost:9200"</span>]) 
index_name = <span class="hljs-string">"article"</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">getSimilarDocuments</span>(<span class="hljs-params">query_vector: <span class="hljs-type">List</span>[<span class="hljs-built_in">float</span>], top_k: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span></span>) -&gt; <span class="hljs-type">List</span>[<span class="hljs-type">Dict</span>]:
    <span class="hljs-string">"""
    æ ¹æ®è¾“å…¥çš„å‘é‡æŸ¥è¯¢ç›¸ä¼¼çš„æ–‡æ¡£ã€‚

    :param query_vector: ç”¨äºæŸ¥è¯¢çš„å‘é‡ã€‚
    :param top_k: è¿”å›çš„ç›¸ä¼¼æ–‡æ¡£æ•°é‡ã€‚
    :return: åŒ…å«ç›¸ä¼¼æ–‡æ¡£ä¿¡æ¯çš„åˆ—è¡¨ã€‚
    """</span>
    script_query = {
        <span class="hljs-string">"script_score"</span>: {
            <span class="hljs-string">"query"</span>: {<span class="hljs-string">"match_all"</span>: {}},
            <span class="hljs-string">"script"</span>: {
                <span class="hljs-string">"source"</span>: <span class="hljs-string">"cosineSimilarity(params.query_vector, 'cont_vector') + 1.0"</span>,
                <span class="hljs-string">"params"</span>: {<span class="hljs-string">"query_vector"</span>: query_vector}
            }
        }
    }

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"request body ------------ : <span class="hljs-subst">{script_query}</span>"</span>)
    response = es.search(
        index=index_name,
        body={
            <span class="hljs-string">"size"</span>: top_k,
            <span class="hljs-string">"query"</span>: script_query,
            <span class="hljs-string">"_source"</span>: [<span class="hljs-string">"cont"</span>]  <span class="hljs-comment"># åªè¿”å›å†…å®¹å­—æ®µ</span>
        }
    )

    similar_docs = []
    <span class="hljs-keyword">for</span> hit <span class="hljs-keyword">in</span> response[<span class="hljs-string">'hits'</span>][<span class="hljs-string">'hits'</span>]:
        doc_info = {
            <span class="hljs-string">"id"</span>: hit[<span class="hljs-string">'_id'</span>],
            <span class="hljs-string">"score"</span>: hit[<span class="hljs-string">'_score'</span>],
            <span class="hljs-string">"cont"</span>: hit[<span class="hljs-string">'_source'</span>][<span class="hljs-string">'cont'</span>]
        }
        similar_docs.append(doc_info)

    <span class="hljs-keyword">return</span> similar_docs

<span class="hljs-keyword">def</span> <span class="hljs-title function_">getSimilarDocumentById</span>(<span class="hljs-params">doc_id: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-type">Dict</span>:
    <span class="hljs-string">"""
    æ ¹æ®æ–‡æ¡£IDè·å–æ–‡æ¡£å†…å®¹ã€‚

    :param doc_id: æ–‡æ¡£çš„IDã€‚
    :return: åŒ…å«æ–‡æ¡£ä¿¡æ¯çš„å­—å…¸ã€‚
    """</span>
    response = es.search(index=index_name, body={<span class="hljs-string">"query"</span>: {<span class="hljs-string">"term"</span>: {<span class="hljs-string">"_id"</span>: doc_id}}})
    <span class="hljs-comment"># response = es.get(index=index_name, id=doc_id)</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Search response: <span class="hljs-subst">{response}</span>"</span>)
    doc = response[<span class="hljs-string">'hits'</span>][<span class="hljs-string">'hits'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'_source'</span>]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Document _source: <span class="hljs-subst">{doc}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"doc vector: <span class="hljs-subst">{doc[<span class="hljs-string">'cont_vector'</span>]}</span>"</span>)
    similarDocs = getSimilarDocuments(doc[<span class="hljs-string">'cont_vector'</span>], top_k=<span class="hljs-number">5</span>)
    <span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> similarDocs:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ID: <span class="hljs-subst">{d[<span class="hljs-string">'id'</span>]}</span>, Score: <span class="hljs-subst">{d[<span class="hljs-string">'score'</span>]}</span>, Content: <span class="hljs-subst">{d[<span class="hljs-string">'cont'</span>][:<span class="hljs-number">50</span>]}</span>..."</span>)


<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    test_doc_id = <span class="hljs-string">"01146c1cac8a28009068c089d4d83f537f"</span>  <span class="hljs-comment"># æ›¿æ¢ä¸ºä½ æƒ³æµ‹è¯•çš„æ–‡æ¡£ID</span>
    getSimilarDocumentById(test_doc_id)        
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JVMç”±ç®€å…¥æ·±å­¦ä¹ æå‡åˆ†(ç”Ÿäº§é¡¹ç›®å†…å­˜é£™å‡åˆ†æï¼‰]]></title>    <link>https://juejin.cn/post/7591510174046486579</link>    <guid>https://juejin.cn/post/7591510174046486579</guid>    <pubDate>2026-01-05T02:20:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591510174046486579" data-draft-id="7591508100663197747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JVMç”±ç®€å…¥æ·±å­¦ä¹ æå‡åˆ†(ç”Ÿäº§é¡¹ç›®å†…å­˜é£™å‡åˆ†æï¼‰"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-05T02:20:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜é‡‘è€…é˜¿è±ª"/> <meta itemprop="url" content="https://juejin.cn/user/4073055974333608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JVMç”±ç®€å…¥æ·±å­¦ä¹ æå‡åˆ†(ç”Ÿäº§é¡¹ç›®å†…å­˜é£™å‡åˆ†æï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4073055974333608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜é‡‘è€…é˜¿è±ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T02:20:50.000Z" title="Mon Jan 05 2026 02:20:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼€å¤´è¯­</h2>
<p>å¤§å®¶å¥½ï¼Œæ¬¢è¿æ¥åˆ°æœ¬æ–‡ï¼åœ¨Javaç”Ÿäº§é¡¹ç›®ä¸­ï¼Œå†…å­˜é£™å‡é—®é¢˜æ˜¯ä¸€é¡¹éœ€è¦é«˜åº¦å…³æ³¨çš„æŒ‘æˆ˜ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æJavaé¡¹ç›®å†…å­˜é£™å‡çš„åŸå› ï¼Œå¹¶é€šè¿‡å®é™…æ¡ˆä¾‹è¿›è¡Œè¯¦ç»†åˆ†æï¼Œå¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£å’Œè§£å†³å†…å­˜é—®é¢˜ã€‚è®©æˆ‘ä»¬ä¸€åŒæ¢è®¨å¦‚ä½•ä¼˜åŒ–Javaåº”ç”¨ï¼Œç¡®ä¿å…¶ç¨³å®šé«˜æ•ˆè¿è¡Œï¼
ä¸‹é¢æ˜¯æˆ‘çš„ä¸€ä¸ªé¡¹ç›®æ¡ˆä¾‹å±•ç¤ºï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥æ¢ç´¢å†…å­˜é£™é«˜çš„å¥¥ç§˜</p>
<h2 data-id="heading-1">å†…å­˜é£™å‡é—®é¢˜åˆ†æä¸æ¡ˆä¾‹</h2>
<h3 data-id="heading-2">é—®é¢˜èƒŒæ™¯ï¼šæˆ‘åä¸ºäº‘çš„ä¸€ä¸ªæœåŠ¡å™¨è¿è¡Œæˆ‘çš„ä¸€ä¸ªé¡¹ç›®â€œcsdn-automatic-triplet-0.0.1-SNAPSHOT.jarâ€ï¼Œç”±äºåªæ˜¯ç”¨æ¥æµ‹è¯•çš„æœåŠ¡å™¨ï¼Œåªæœ‰2Gï¼Œæ‰€ä»¥åˆ†é…ç»™å †çš„å†…å­˜1024M</h3>
<pre><code class="hljs language-java" lang="java">java -Xmx1024m -XX:+PrintGCDetails -XX:+PrintGCDateStamps -Xloggc:/www/java_project/gc.log -XX:+UseG1GC -jar csdn-automatic-triplet-<span class="hljs-number">0.0</span><span class="hljs-number">.1</span>-SNAPSHOT.jar
</code></pre>
<h3 data-id="heading-3">æŸ¥è¯¢å†…å­˜ä½¿ç”¨ï¼ˆtopæŒ‡ä»¤ï¼Œå†shift+Mæ’åºï¼‰</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5dc778f8a75a432c9ce64fc4f33a5e79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=R9GWUk9af77rPcGEhe%2B%2Ba%2FQEeTo%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-4">è§£å†³æ–¹å¼</h3>
<ol>
<li>æŸ¥è¯¢javaè¿›ç¨‹ï¼ˆè¿™é‡Œåˆ†äº«ä¸‰ç§æ–¹å¼ï¼Œå»ºè®®jps -l,åˆ«é—®ä¸ºä»€ä¹ˆï¼Œä¸æƒ³å¤šæ•²æŒ‡ä»¤ï¼‰</li>
</ol>
<pre><code class="hljs language-java" lang="java">jps -l   æˆ–è€…  ps -ef|grep java
æˆ–è€…ç²¾ç¡®æŸ¥æ‰¾    ps -ef|grep csdn-automatic-triplet-<span class="hljs-number">0.0</span><span class="hljs-number">.1</span>-SNAPSHOT.jar
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6197dbf10e0e412a973d7c7ddc852325~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=3AIDWxTxvDbXNmZZvHrMGRyJ3Zw%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64372ed07f7c41e9a818aea389e37d2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=XeXKqyrZ7TQYL6iFMSuBS%2BEjjUs%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b17f949bc7d447d09348f3a899d076a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=mGG0MtG3kvwMXYBpuPjc3TcWh44%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<ol start="2">
<li>æ ¹æ®ä¸Šé¢æŸ¥è¯¢çš„è¿›ç¨‹å·ï¼ˆ2067224ï¼‰è¾“å‡ºé¡¹ç›®å†…å…·ä½“å†…å­˜ä½¿ç”¨æƒ…å†µï¼ˆjmapï¼‰</li>
</ol>
<pre><code class="hljs language-java" lang="java">jmap -histo <span class="hljs-number">2067224</span> 
jmap -histo <span class="hljs-number">2067224</span> &gt; jvm.txt <span class="hljs-comment">// è¾“å‡ºåˆ°jvm.txt</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49d4043cf2524ad0988d53c4549f1722~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=e%2FPbaiN4q3ahbJYG3teAWw75YQE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/783204667f0f456a86f51da1bddfa169~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=ti91OQFG5HwnVPQY1MmmiGiOeTo%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<ol start="3">
<li>
<p>å°†æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°åˆ†æï¼ˆæˆ‘è¿™é‡Œç”¨çš„äº‹xshellï¼Œæ‰€ä»¥ç”¨xftpä¼ è¾“åˆ°æœ¬åœ°ï¼‰
æ¨èä¸€ä¸ªæ–‡æœ¬å·¥å…·NotePad++ï¼ˆå¥½å¤„å°±ä¸å¤šè¯´äº†ï¼Œåšç¼–ç¨‹çš„å¾ˆå¤šä¼™ä¼´éƒ½ç”¨è¿™ä¸ªï¼‰
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6c55e31cc19410fa069da909c136fc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=uYU0YqlEoy2xXCXhnjgY0%2BeFEgg%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
</li>
<li>
<p>åœ¨æ–‡ä»¶é‡Œé¢Ctrl+Fæœç´¢è‡ªå·±é¡¹ç›®é‡Œé¢çš„ç›®å½•
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b55fa7a847840eeac390ae1c605deed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=%2B%2FTpyMhijU7%2B1eWtZNxlBHRi9G0%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
ç»“åˆå…·ä½“æƒ…å†µï¼Œå‘ç°æœ‰å ç”¨å†…å­˜æ¯”è¾ƒå¤šçš„å¯¹è±¡ï¼Œå°±å¯ä»¥å»é¡¹ç›®é‡Œæ‰¾å¯¹åº”ä»£ç åˆ†æä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯å“ªé‡Œæœ‰å¤§é‡åˆ›å»ºè¯¥å¯¹è±¡ï¼Œè¿‡å¤šå¼•ç”¨æˆ–è€…ä¸ºä»€ä¹ˆæ²¡æœ‰è¢«å›æ”¶ã€‚</p>
</li>
<li>
<p>ç»§ç»­åˆ†æï¼Œæ‰“å°å †ä¿¡æ¯ï¼ˆjmapï¼‰</p>
</li>
</ol>
<pre><code class="hljs language-java" lang="java">jmap -heap <span class="hljs-number">2067224</span> 
</code></pre>
<p>ä¸»è¦çœ‹ä¸‹é¢è¿™äº›ä¿¡æ¯
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a80b20da79e47f282732f078f78094a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=FX%2FynooW3rBHyBl%2Fuz9lHdjdHts%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<ol start="6">
<li>ç»§ç»­æ‰“å°å¯¹æˆ˜ä¿¡æ¯ï¼ˆjmapï¼‰
æ³¨æ„ï¼šæ”¹æ–‡ä»¶æœ‰ç‚¹å¤§ï¼Œåœ¨ç”Ÿäº§æœåŠ¡å™¨è°¨æ…æ“ä½œï¼Œæœ€å¥½å¯¼å‡ºåˆ°å…¶ä»–æ¯”è¾ƒç©ºé—²çš„èŠ‚ç‚¹æœåŠ¡å™¨</li>
</ol>
<pre><code class="hljs language-java" lang="java">jmap -dump:format=b,file=heap.hprof <span class="hljs-number">2067224</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71d16309b360438aba6e7bf11babe484~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=U64tV7nexinLtJM7%2FKAeY63GpJE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
æŒ‰ç…§ä¹‹å‰çš„æ–¹å¼ä¸‹è½½åˆ°æœ¬åœ°æŸ¥çœ‹
è¿™é‡Œæ¨èä¸€ä¸ªå·¥å…·Memoryanalyzerï¼Œä¸‹è½½åœ°å€å¦‚ä¸‹</p>
<pre><code class="hljs language-java" lang="java">https:<span class="hljs-comment">//eclipse.dev/mat/previousReleases.php</span>
</code></pre>
<p>å¯ä»¥æŒ‰ç…§è¯¥åšä¸»çš„æ­¥éª¤å®‰è£…</p>
<pre><code class="hljs language-java" lang="java">https:<span class="hljs-comment">//blog.csdn.net/zhou920786312/article/details/131857718</span>
</code></pre>
<p>æ‰“å¼€æ–‡ä»¶ï¼Œé»˜è®¤é€‰æ‹©Leak Suspectåˆ†ææº¢å‡º
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acbe1d52347940beb09301b8f2fab2aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=avqdSJwZoB2F9bOF0jKoEds%2FNNk%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
å¯ä»¥ç‚¹å‡»è¿™äº›æŒ‰é’®æŸ¥çœ‹å¯¹è±¡ä½¿ç”¨å†…å­˜æƒ…å†µåŠæ¯”ä¾‹ï¼Œå½“ç„¶ï¼Œæˆ‘è¿™é‡Œæ²¡æœ‰æ³„éœ²
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40fac2c37a714642a415bf2a0f0bb35c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=7RSmBRjU%2FMDzSVfbTsCf45awof0%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f160a79f3684ba4a4e5f26fdc973a0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=ohnSXz6ZZ3PfEHxLRfZFKQBz0JM%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23654f90e7d54fc48fc0101ebfd86edf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=Y8f0XDtj7G6FfxETDzW4FTGnx0U%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
æ³„éœ²æ¡ˆä¾‹ï¼š
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a81a04860e145d48282187b14f9f1fc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR6ICF6Zi_6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184450&amp;x-signature=VtbdlbxQStdimEs9pwYe5P1CT14%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-5">å†…å­˜ä¼˜åŒ–å»ºè®®ï¼š</h3>
<ul>
<li>
<p>åˆç†ä½¿ç”¨ç¼“å­˜ï¼š ç¼“å­˜æ˜¯æé«˜æ€§èƒ½çš„æœ‰æ•ˆæ‰‹æ®µï¼Œä½†éœ€è¦è°¨æ…ä½¿ç”¨ï¼Œç¡®ä¿åŠæ—¶æ¸…ç†å’Œæ›´æ–°ç¼“å­˜ã€‚</p>
</li>
<li>
<p>å®šæœŸåˆ†æHeap Dumpï¼š å®šæœŸç”ŸæˆHeap Dumpæ–‡ä»¶ï¼Œé€šè¿‡å·¥å…·è¿›è¡Œåˆ†æï¼ŒåŠæ—¶å‘ç°å’Œè§£å†³æ½œåœ¨çš„å†…å­˜é—®é¢˜ã€‚</p>
</li>
<li>
<p>GCè°ƒä¼˜ï¼š æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´GCç­–ç•¥å’Œå‚æ•°ï¼Œç¡®ä¿åŠæ—¶å›æ”¶æ— ç”¨å¯¹è±¡ï¼Œé™ä½å†…å­˜å‹åŠ›ã€‚</p>
</li>
</ul>
<h2 data-id="heading-6">ç»“è¯­</h2>
<p>åœ¨Javaç”Ÿäº§é¡¹ç›®ä¸­ï¼Œå†…å­˜é£™å‡æ˜¯ä¸€ä¸ªå¤æ‚è€Œå¸¸è§çš„é—®é¢˜ï¼Œéœ€è¦æˆ‘ä»¬æ·±å…¥åˆ†æå’Œè§£å†³ã€‚é€šè¿‡æœ¬æ–‡çš„æ¡ˆä¾‹åˆ†æï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿå¸®åŠ©å¤§å®¶æ›´å¥½åœ°ç†è§£å’Œåº”å¯¹Javaé¡¹ç›®ä¸­çš„å†…å­˜é—®é¢˜ã€‚**æ„Ÿè°¢é˜…è¯»ï¼Œè®©æˆ‘ä»¬å…±åŒåŠªåŠ›æ„å»ºé«˜æ•ˆç¨³å®šçš„Javaåº”ç”¨ï¼**å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–æƒ³åˆ†äº«æ›´å¤šç»éªŒï¼Œè¯·åœ¨è¯„è®ºåŒºç•™è¨€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Dockgeï¼šè½»é‡å¼€æºçš„ Docker ç¼–æ’é©å‘½ï¼Œè®©å®¹å™¨ç®¡ç†å›å½’ä¼˜é›…]]></title>    <link>https://juejin.cn/post/7591348605866442787</link>    <guid>https://juejin.cn/post/7591348605866442787</guid>    <pubDate>2026-01-05T02:22:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591348605866442787" data-draft-id="7538086111999803407" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Dockgeï¼šè½»é‡å¼€æºçš„ Docker ç¼–æ’é©å‘½ï¼Œè®©å®¹å™¨ç®¡ç†å›å½’ä¼˜é›…"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-05T02:22:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="YL_jia"/> <meta itemprop="url" content="https://juejin.cn/user/1467226241383211"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Dockgeï¼šè½»é‡å¼€æºçš„ Docker ç¼–æ’é©å‘½ï¼Œè®©å®¹å™¨ç®¡ç†å›å½’ä¼˜é›…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1467226241383211/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    YL_jia
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T02:22:56.000Z" title="Mon Jan 05 2026 02:22:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Dockgeï¼šè½»é‡å¼€æºçš„ Docker ç¼–æ’é©å‘½ï¼Œè®©å®¹å™¨ç®¡ç†å›å½’ä¼˜é›…</h2>
<blockquote>
<p><strong>â€œDockge ä¸ä¼šç»‘æ¶ä½ çš„ compose æ–‡ä»¶ï¼Œå´è®©ä½ å†ä¹Ÿå›ä¸å»å‘½ä»¤è¡Œâ€</strong>â€”â€”ä¸€ä½ä» Portainer è¿ç§»çš„ DevOps å·¥ç¨‹å¸ˆå¦‚æ˜¯è¯´</p>
</blockquote>
<p>åœ¨å®¹å™¨åŒ–éƒ¨ç½²æˆä¸ºä¸»æµçš„ä»Šå¤©ï¼Œ<strong>Docker Compose çš„å¤æ‚æ€§</strong>ä¸<strong>ä¼ ç»Ÿç®¡ç†å·¥å…·çš„ç¬¨é‡</strong>å´æˆäº†æ–°çš„ç—›ç‚¹ã€‚å½“å¼€å‘è€…ç–²äºåœ¨ç»ˆç«¯æ•²å‡»é‡å¤å‘½ä»¤æ—¶ï¼Œä¸€æ¬¾ç”± Uptime Kuma ä½œè€…æ‰“é€ çš„ç¥å™¨â€”â€”<strong>Dockge</strong> æ­£ä»¥ <strong>17k+ GitHub Stars</strong> çš„æˆç»©æ€èµ·å¯è§†åŒ–ç¼–æ’çš„é©å‘½æµªæ½®ã€‚æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥è¿™ä¸€é¢ è¦†æ€§å·¥å…·çš„æŠ€æœ¯å†…æ ¸ä¸è½åœ°å®è·µã€‚</p>
<hr/>
<h3 data-id="heading-1">ä¸€ã€æ ¸å¿ƒä»·å€¼ï¼šä¸ºä»€ä¹ˆå¼€å‘è€…é€‰æ‹©æŠ›å¼ƒ Portainerï¼Ÿ</h3>
<h4 data-id="heading-2">1. æç®€ç¾å­¦èƒŒåçš„å·¥ç¨‹å“²å­¦</h4>
<p>Dockge çš„ UI ç»§æ‰¿ Uptime Kuma çš„åŸºå› ï¼Œé‡‡ç”¨å¡ç‰‡å¼å †æ ˆå¸ƒå±€ï¼Œæ‰€æœ‰æ“ä½œåœ¨<strong>å•é¡µé¢æ— è·³è½¬</strong>å®Œæˆã€‚å·¦ä¾§å †æ ˆåˆ—è¡¨å®æ—¶æ˜¾ç¤ºå®¹å™¨çŠ¶æ€ï¼ˆè¿è¡Œ/åœæ­¢/é”™è¯¯ï¼‰ï¼Œå³ä¾§é›†æˆ YAML ç¼–è¾‘å™¨å’Œæ“ä½œæŒ‰é’®ï¼Œä¸­é—´åŒºåŸŸåŠ¨æ€å±•ç¤ºæ—¥å¿—æµâ€”â€”è¿™ç§<strong>é›¶è®¤çŸ¥è´Ÿè·çš„è®¾è®¡</strong>è®©æ–°æ‰‹ 5 åˆ†é’Ÿå³å¯ä¸Šæ‰‹ã€‚</p>
<h4 data-id="heading-3">2. å››å¤§æ€æ‰‹çº§ç‰¹æ€§</h4>
<ul>
<li><strong>æ™ºèƒ½ CLI è½¬æ¢å™¨</strong>ï¼šå°†æ™¦æ¶©çš„ <code>docker run</code> å‘½ä»¤ç²˜è´´åˆ°è¾“å…¥æ¡†ï¼Œä¸€é”®ç”Ÿæˆæ ‡å‡† <code>compose.yaml</code>ï¼Œé™ä½ 80% å­¦ä¹ æˆæœ¬</li>
<li><strong>é•œåƒçƒ­æ›´æ–°</strong>ï¼šç‚¹å‡»å †æ ˆè¯¦æƒ…é¡µçš„ <strong>Update</strong> æŒ‰é’®ï¼Œè‡ªåŠ¨æ‹‰å–æœ€æ–°é•œåƒå¹¶é‡å»ºå®¹å™¨ï¼Œè§£å†³ä¼ ç»Ÿæµç¨‹ä¸­ <code>docker pull &amp;&amp; docker compose up -d</code> çš„ç¹ç</li>
<li><strong>å®æ—¶åŒå‘åŒæ­¥</strong>ï¼šç¼–è¾‘å™¨ä¿®æ”¹ YAML å³æ—¶æ¸²æŸ“ä¸ºå¯è§†åŒ–ç»„ä»¶ï¼Œåä¹‹äº¦ç„¶ï¼Œé…åˆ<strong>è¯­æ³•é«˜äº®+é”™è¯¯æç¤º</strong>ï¼Œé¿å…å› ç¼©è¿›é”™è¯¯å¯¼è‡´çš„å¯åŠ¨å¤±è´¥</li>
<li><strong>åµŒå…¥å¼ Web Terminal</strong>ï¼šæ”¯æŒåŸºç¡€å‘½ä»¤æ‰§è¡Œï¼Œç´§æ€¥è°ƒè¯•æ— éœ€åˆ‡æ¢ SSH å®¢æˆ·ç«¯</li>
</ul>
<h4 data-id="heading-4">3. éä¾µå…¥å¼æ¶æ„è®¾è®¡</h4>
<p>ä¸ Portainer ä¸åŒï¼ŒDockge <strong>ç»ä¸åŠ«æŒä½ çš„ Compose æ–‡ä»¶</strong>ã€‚æ‰€æœ‰æ–‡ä»¶ä»ä¿ç•™åœ¨åŸå§‹è·¯å¾„ï¼ˆå¦‚ <code>/opt/stacks</code>ï¼‰ï¼Œå¯éšæ—¶ç”¨åŸç”Ÿå‘½ä»¤æ“ä½œã€‚è¿™ç§â€œ<strong>å‹å¥½å…±å­˜</strong>â€ç­–ç•¥æ¶ˆé™¤äº†è¿ç§»ææƒ§ã€‚</p>
<hr/>
<h3 data-id="heading-5">äºŒã€å®‰è£…éƒ¨ç½²ï¼š5 åˆ†é’Ÿæ­å»ºå…¨å¹³å°æŒ‡å—</h3>
<h4 data-id="heading-6">1. åŸºç¡€å®‰è£…ï¼ˆé€šç”¨ Linux ç¯å¢ƒï¼‰</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºå­˜å‚¨ç›®å½•</span>
<span class="hljs-built_in">mkdir</span> -p /opt/stacks /opt/dockge
<span class="hljs-built_in">cd</span> /opt/dockge

<span class="hljs-comment"># è·å–å®˜æ–¹ compose æ–‡ä»¶</span>
curl -O https://raw.githubusercontent.com/louislam/dockge/master/compose.yaml

<span class="hljs-comment"># å¯åŠ¨æœåŠ¡ï¼ˆæ³¨æ„ä½¿ç”¨ docker compose è€Œé docker-composeï¼‰</span>
docker compose up -d
</code></pre>
<p>è®¿é—® <code>http://&lt;æœåŠ¡å™¨IP&gt;:5001</code> åˆå§‹åŒ–è´¦å·</p>
<h4 data-id="heading-7">2. ç‰¹æ®Šç¯å¢ƒé¿å‘æŒ‡å—</h4>
<p><strong>â– ç»¿è” NAS</strong><br/>
éœ€é€šè¿‡ SSH éƒ¨ç½²ï¼ˆç«¯å£ 922ï¼‰ï¼Œå…³é”®åœ¨<strong>æ­£ç¡®æ˜ å°„ç£ç›˜è·¯å¾„</strong>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">volumes:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run/docker.sock:/var/run/docker.sock</span>
  <span class="hljs-comment"># ä½¿ç”¨ media_rw ä¸‹çš„ UUID è·¯å¾„é¿å…æŒ‚è½½ç‚¹æ¼‚ç§»</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">/mnt/media_rw/9e39d6bc-b42d-43a4-8f13-877e0311e23f/dockge/data:/app/data</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">/opt/stacks:/opt/stacks</span>
</code></pre>
<p><strong>â– ç¾¤æ™– DSM 7.2+</strong><br/>
å› æƒé™é—®é¢˜éœ€é€šè¿‡<strong>è®¡åˆ’ä»»åŠ¡</strong>ä»¥ root èº«ä»½è¿è¡Œï¼š</p>
<ol>
<li>æ§åˆ¶é¢æ¿ â†’ ä»»åŠ¡è®¡åˆ’ â†’ æ–°å¢ <strong>root æƒé™ä»»åŠ¡</strong></li>
<li>ç”¨æˆ·è„šæœ¬å¡«å…¥ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">docker run -d --name=dockge \
  -p 5001:5001 \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v /volume1/docker/stacks:/stacks \ <span class="hljs-comment"># ç¾¤æ™–å­˜å‚¨è·¯å¾„</span>
  -v /volume1/docker/dockge/data:/app/data \
  -e DOCKGE_STACKS_DIR=/stacks \
  louislam/dockge:1
</code></pre>
<hr/>
<h3 data-id="heading-8">ä¸‰ã€ä¼ä¸šçº§å®æˆ˜ï¼šä»å¼€å‘åˆ°ç”Ÿäº§çš„è¿›é˜¶æµ</h3>
<h4 data-id="heading-9">æ¡ˆä¾‹ 1ï¼šäº’è”ç½‘é‡‘èå¹³å° CI/CD å †æ ˆç®¡ç†</h4>
<p><strong>æŒ‘æˆ˜</strong>ï¼šæŸæ”¯ä»˜ç³»ç»Ÿæ¯å¤©éœ€éƒ¨ç½² 10+ æ¬¡æ›´æ–°ï¼Œæ¶‰åŠ Spring Boot + MySQL + Redis ç»„åˆï¼Œæ‰‹åŠ¨æ“ä½œ compose æ˜“å‡ºé”™ã€‚</p>
<p><strong>Dockge æ–¹æ¡ˆ</strong>ï¼š</p>
<ol>
<li>å°†ç”Ÿäº§ç¯å¢ƒçš„ <code>docker-compose.prod.yaml</code> æ”¾å…¥ <code>/opt/stacks/payment</code></li>
<li>å¼€å‘è€…åœ¨ GitLab åˆå¹¶ä»£ç åè§¦å‘ webhookï¼ŒDockge è‡ªåŠ¨ï¼š
<ul>
<li>æ‰§è¡Œ <code>git pull</code> æ›´æ–° compose æ–‡ä»¶</li>
<li>ç‚¹å‡» <strong>Restart Stack</strong> æ»šåŠ¨æ›´æ–°å®¹å™¨</li>
</ul>
</li>
<li>é€šè¿‡<strong>åµŒå…¥å¼ç»ˆç«¯</strong>å¿«é€ŸæŸ¥éªŒæ•°æ®åº“è¿æ¥ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">docker <span class="hljs-built_in">exec</span> -it payment-db mysql -uadmin -p<span class="hljs-variable">$PASSWORD</span> -e <span class="hljs-string">"SHOW STATUS LIKE 'threads_connected'"</span>
</code></pre>
<p><strong>æˆæ•ˆ</strong>ï¼šéƒ¨ç½²è€—æ—¶ä» 15 åˆ†é’Ÿé™è‡³ 2 åˆ†é’Ÿï¼Œç‰ˆæœ¬å›æ»šæ•ˆç‡æå‡ 300%</p>
<h4 data-id="heading-10">æ¡ˆä¾‹ 2ï¼šæ™ºèƒ½å·¥å‚è¾¹ç¼˜è®¡ç®—é›†ç¾¤</h4>
<p><strong>æŒ‘æˆ˜</strong>ï¼šæ±½è½¦ç”µæ± äº§çº¿æœ‰ 20 å°å·¥æ§æœºè¿è¡Œæ£€æµ‹æœåŠ¡ï¼Œéœ€é›†ä¸­ç®¡ç†ä½†æ— æ³•è¿æ¥å…¬æœ‰äº‘ã€‚</p>
<p><strong>Dockge å¤šä¸»æœºæ–¹æ¡ˆ</strong>ï¼ˆv1.4.0+ï¼‰ï¼š</p>
<ol>
<li>æ¯å°å·¥æ§æœºéƒ¨ç½² Dockge Agent</li>
<li>ä¸­å¤®æ§åˆ¶å°æ·»åŠ è¾¹ç¼˜èŠ‚ç‚¹ï¼š</li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># dockge-agent é…ç½®ç¤ºä¾‹</span>
<span class="hljs-attr">services:</span>
  <span class="hljs-attr">agent:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">louislam/dockge-agent:1</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DOCKGE_MASTER_URL=http://central-server:5001</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/var/run/docker.sock:/var/run/docker.sock</span>
</code></pre>
<ol start="3">
<li>åœ¨ä¸­å¤®ç•Œé¢æ‰¹é‡é‡å¯ <code>battery-inspector</code> æœåŠ¡</li>
</ol>
<hr/>
<h3 data-id="heading-11">å››ã€é«˜é˜¶æŠ€å·§ï¼šè§£é” 90% ç”¨æˆ·ä¸çŸ¥é“çš„ç”¨æ³•</h3>
<h4 data-id="heading-12">1. æ—§é¡¹ç›®è¿ç§»é­”æ³•</h4>
<p>å°†å­˜é‡ Compose æ–‡ä»¶çº³å…¥ç®¡ç†ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç§»åŠ¨é¡¹ç›®åˆ° Stacks ç›®å½•</span>
<span class="hljs-built_in">mv</span> ~/projects/legacy-app /opt/stacks/old-system

<span class="hljs-comment"># Dockge æ§åˆ¶å° â†’ å¤´åƒèœå• â†’ â€œæ‰«æå †æ ˆæ–‡ä»¶å¤¹â€ </span>
</code></pre>
<p>ç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«å¹¶æ˜¾ç¤ºçŠ¶æ€</p>
<h4 data-id="heading-13">2. å®‰å…¨åŠ å›ºç­–ç•¥</h4>
<p><strong>åœºæ™¯</strong>ï¼šä¼ä¸šéœ€å®¡è®¡ compose å˜æ›´è®°å½•<br/>
<strong>æ–¹æ¡ˆ</strong>ï¼šå¯ç”¨ Git ç‰ˆæœ¬æ§åˆ¶</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åœ¨ Stacks ç›®å½•åˆå§‹åŒ–ä»“åº“</span>
<span class="hljs-built_in">cd</span> /opt/stacks
git init
git config --<span class="hljs-built_in">local</span> core.hooksPath .githooks

<span class="hljs-comment"># æ·»åŠ æäº¤å‰é’©å­ï¼ˆ.githooks/pre-commitï¼‰</span>
<span class="hljs-comment">#!/bin/sh</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Auto-commit by Dockge: <span class="hljs-subst">$(date)</span>"</span> &gt;&gt; commit.log
git add -A
git commit -am <span class="hljs-string">"Dockge Auto-Commit"</span>
</code></pre>
<h4 data-id="heading-14">3. æ€§èƒ½ä¼˜åŒ–å‚æ•°</h4>
<p><strong>å¤§è§„æ¨¡é›†ç¾¤</strong>ï¼ˆ50+ å®¹å™¨ï¼‰å»ºè®®è°ƒæ•´ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">environment:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">DOCKGE_POLLING_INTERVAL=5000</span>   <span class="hljs-comment"># é™ä½çŠ¶æ€è½®è¯¢é¢‘ç‡ï¼ˆmsï¼‰</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">NODE_MEMORY_LIMIT=1024</span>         <span class="hljs-comment"># é™åˆ¶ Node è¿›ç¨‹å†…å­˜ï¼ˆMBï¼‰</span>
</code></pre>
<hr/>
<h3 data-id="heading-15">äº”ã€ä¸ Portainer çš„ç»ˆæå¯¹å†³</h3>



































<table><thead><tr><th><strong>èƒ½åŠ›ç»´åº¦</strong></th><th><strong>Dockge</strong></th><th><strong>Portainer</strong></th></tr></thead><tbody><tr><td>Compose æ›´æ–°é•œåƒ</td><td>âœ… ä¸€é”®æ›´æ–°æ‰€æœ‰æœåŠ¡</td><td>âŒ éœ€é€ä¸ªå®¹å™¨æ“ä½œ</td></tr><tr><td>YAML ç¼–è¾‘ä½“éªŒ</td><td>âœ… å®æ—¶å¯è§†åŒ–æ¸²æŸ“+é”™è¯¯æ£€æŸ¥</td><td>âš ï¸ çº¯æ–‡æœ¬ç¼–è¾‘</td></tr><tr><td>å¤šä¸»æœºç®¡ç†</td><td>âœ… åŸç”Ÿ Agent æ”¯æŒ</td><td>âœ… ä¼ä¸šç‰ˆæ”¯æŒ</td></tr><tr><td>èµ„æºå ç”¨</td><td>45MB å†…å­˜</td><td>220MB å†…å­˜</td></tr><tr><td>å­¦ä¹ æ›²çº¿</td><td>æä½ï¼ˆä¸“æ³¨ Composeï¼‰</td><td>é™¡å³­ï¼ˆåŠŸèƒ½ç¹æ‚ï¼‰</td></tr></tbody></table>
<blockquote>
<p><strong>ç»“è®º</strong>ï¼šDockge æ˜¯<strong>ç²¾ç›ŠåŒ–å®¹å™¨ç¼–æ’</strong>çš„ç»ˆææ­¦å™¨ï¼ŒPortainer æ›´é€‚åˆéœ€è¦<strong>å…¨æ ˆ Docker ç®¡ç†</strong>çš„åœºæ™¯</p>
</blockquote>
<hr/>
<h3 data-id="heading-16">å…­ã€æœªæ¥ä¹‹è·¯ï¼šDockge çš„è¿›åŒ–æ–¹å‘</h3>
<p>æ ¹æ® 2025 å¹´è·¯çº¿å›¾ï¼Œå³å°†åˆ°æ¥çš„å…³é”®ç‰¹æ€§ï¼š</p>
<ol>
<li><strong>AI è¾…åŠ©ç¼–æ’</strong>ï¼šæ ¹æ®æ—¥å¿—è‡ªåŠ¨å»ºè®® compose å‚æ•°ä¼˜åŒ–</li>
<li><strong>RBAC æƒé™ç³»ç»Ÿ</strong>ï¼šä¼ä¸šå¤šå›¢é˜Ÿåä½œæ”¯æŒ</li>
<li><strong>K8s Compose è¿ç§»</strong>ï¼šä¸€é”®è½¬æ¢ compose ä¸º Kubernetes Manifest</li>
</ol>
<hr/>
<h3 data-id="heading-17">ç»“è¯­ï¼šä¼˜é›…æ°¸ä¸è¿‡æ—¶</h3>
<p>Dockge ä¹‹æ‰€ä»¥èƒ½ä¿˜è·å¼€å‘è€…å¿ƒæ™ºï¼Œåœ¨äºå®ƒ<strong>ç²¾å‡†å‡»ä¸­äº† Docker Compose ç®¡ç†çš„çœŸç©ºåœ°å¸¦</strong>â€”â€”æ—¢ä¿ç•™äº†å‘½ä»¤è¡Œæ´¾çš„çµæ´»æ€§ï¼Œåˆèµ‹äºˆç•Œé¢å…šä»¥æ“ä½œæ„‰æ‚¦æ„Ÿã€‚æ­£å¦‚ä¸€ä½ç”¨æˆ·æ‰€è¨€ï¼š<em>â€œå®ƒåƒä¸€ä½æ— å£°çš„åŠ©æ‰‹ï¼Œåœ¨ä½ éœ€è¦æ—¶å‡ºç°ï¼Œå´ä»ä¸æ‰“æ‰°ä½ çš„å·¥ä½œæµâ€</em>ã€‚</p>
<blockquote>
<p><strong>å®è·µå»ºè®®</strong>ï¼š</p>
<ol>
<li>ç”Ÿäº§ç¯å¢ƒæŒ‚è½½ <code>./data</code> ç›®å½•å®šæœŸå¤‡ä»½</li>
<li>æ•æ„ŸæœåŠ¡æ·»åŠ  <code>restart: unless-stopped</code> é¿å…è¯¯å…³æœº</li>
<li>ç»“åˆ Watchtower å®ç°<strong>é compose å®¹å™¨</strong>è‡ªåŠ¨æ›´æ–°</li>
</ol>
</blockquote>
<p><strong>é¡¹ç›®åœ°å€</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flouislam%2Fdockge" target="_blank" title="https://github.com/louislam/dockge" ref="nofollow noopener noreferrer">github.com/louislam/doâ€¦</a><br/>
<strong>ä¸­æ–‡æ–‡æ¡£</strong>ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdockge.kuma.pet%2Fzh%2F" target="_blank" title="https://dockge.kuma.pet/zh/" ref="nofollow noopener noreferrer">dockge.kuma.pet/zh/</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Paimon è¡¨å®šæ—¶ Compact æ•°æ®æµç¨‹ä¸é€»è¾‘è¯¦è§£]]></title>    <link>https://juejin.cn/post/7591510174046535731</link>    <guid>https://juejin.cn/post/7591510174046535731</guid>    <pubDate>2026-01-05T02:22:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591510174046535731" data-draft-id="7591508100663214131" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Paimon è¡¨å®šæ—¶ Compact æ•°æ®æµç¨‹ä¸é€»è¾‘è¯¦è§£"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-05T02:22:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Aé»‘æ¡ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/2023553670061885"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Paimon è¡¨å®šæ—¶ Compact æ•°æ®æµç¨‹ä¸é€»è¾‘è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2023553670061885/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Aé»‘æ¡ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T02:22:38.000Z" title="Mon Jan 05 2026 02:22:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»26åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Paimon è¡¨å®šæ—¶ Compact æ•°æ®æµç¨‹ä¸é€»è¾‘è¯¦è§£</h2>
<h3 data-id="heading-1">ç›®å½•</h3>
<ul>
<li><a href="#%E4%B8%80%E6%A6%82%E8%BF%B0" title="#%E4%B8%80%E6%A6%82%E8%BF%B0">ä¸€ã€æ¦‚è¿°</a></li>
<li><a href="#%E4%BA%8Ccompact-%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84" title="#%E4%BA%8Ccompact-%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84">äºŒã€Compact æ ¸å¿ƒæ¶æ„</a></li>
<li><a href="#%E4%B8%89compact-%E8%A7%A6%E5%8F%91%E6%9C%BA%E5%88%B6" title="#%E4%B8%89compact-%E8%A7%A6%E5%8F%91%E6%9C%BA%E5%88%B6">ä¸‰ã€Compact è§¦å‘æœºåˆ¶</a></li>
<li><a href="#%E5%9B%9Bappend-%E8%A1%A8-compact-%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3" title="#%E5%9B%9Bappend-%E8%A1%A8-compact-%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3">å››ã€Append è¡¨ Compact æµç¨‹è¯¦è§£</a></li>
<li><a href="#%E4%BA%94%E4%B8%BB%E9%94%AE%E8%A1%A8-compact-%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3" title="#%E4%BA%94%E4%B8%BB%E9%94%AE%E8%A1%A8-compact-%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3">äº”ã€ä¸»é”®è¡¨ Compact æµç¨‹è¯¦è§£</a></li>
<li><a href="#%E5%85%ADuniversalcompaction-%E7%AD%96%E7%95%A5%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90" title="#%E5%85%ADuniversalcompaction-%E7%AD%96%E7%95%A5%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90">å…­ã€UniversalCompaction ç­–ç•¥æ·±åº¦è§£æ</a></li>
<li><a href="#%E4%B8%83%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0" title="#%E4%B8%83%E5%AE%9A%E6%97%B6%E8%B0%83%E5%BA%A6%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0">ä¸ƒã€å®šæ—¶è°ƒåº¦æœºåˆ¶å®ç°</a></li>
<li><a href="#%E5%85%AB%E5%85%B3%E9%94%AE%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%AF%A6%E8%A7%A3" title="#%E5%85%AB%E5%85%B3%E9%94%AE%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%AF%A6%E8%A7%A3">å…«ã€å…³é”®é…ç½®é¡¹è¯¦è§£</a></li>
<li><a href="#%E4%B9%9D%E6%BA%90%E7%A0%81%E6%A0%B8%E5%BF%83%E7%B1%BB%E6%80%BB%E7%BB%93" title="#%E4%B9%9D%E6%BA%90%E7%A0%81%E6%A0%B8%E5%BF%83%E7%B1%BB%E6%80%BB%E7%BB%93">ä¹ã€æºç æ ¸å¿ƒç±»æ€»ç»“</a></li>
<li><a href="#%E5%8D%81%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE" title="#%E5%8D%81%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE">åã€æœ€ä½³å®è·µä¸ä¼˜åŒ–å»ºè®®</a></li>
</ul>
<hr/>
<h3 data-id="heading-2">ä¸€ã€æ¦‚è¿°</h3>
<p>Apache Paimon æ˜¯ä¸€ä¸ªæµå¼æ•°æ®æ¹–å­˜å‚¨ç³»ç»Ÿï¼Œé‡‡ç”¨ LSM-Treeï¼ˆLog-Structured Merge-Treeï¼‰æ¶æ„æ¥ç®¡ç†æ•°æ®æ–‡ä»¶ã€‚Compactï¼ˆå‹ç¼©ï¼‰æ˜¯ Paimon ä¸­è‡³å…³é‡è¦çš„åå°æ“ä½œï¼Œç”¨äºï¼š</p>
<ol>
<li><strong>å‡å°‘æ–‡ä»¶æ•°é‡</strong>ï¼šåˆå¹¶å°æ–‡ä»¶ï¼Œé™ä½è¯»å–æ—¶çš„æ–‡ä»¶æ‰«æå¼€é”€</li>
<li><strong>å‡å°‘ç©ºé—´æ”¾å¤§</strong>ï¼šåˆ é™¤è¿‡æœŸæ•°æ®ï¼Œå›æ”¶å­˜å‚¨ç©ºé—´</li>
<li><strong>ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½</strong>ï¼šå‡å°‘ Level 0 æ–‡ä»¶æ•°ï¼ŒåŠ å¿«æ•°æ®æ£€ç´¢</li>
<li><strong>ç”Ÿæˆ Changelog</strong>ï¼šé€šè¿‡ Compact ç”Ÿæˆå˜æ›´æ—¥å¿—</li>
<li><strong>ç»´æŠ¤åˆ é™¤å‘é‡</strong>ï¼šå¯¹äº MOWï¼ˆMerge-on-Writeï¼‰æ¨¡å¼ï¼Œç»´æŠ¤ Deletion Vectors</li>
</ol>
<p>æœ¬æ–‡å°†æ·±å…¥åˆ†æ Paimon è¡¨çš„å®šæ—¶ Compact æœºåˆ¶ï¼ŒåŒ…æ‹¬è§¦å‘æ—¶æœºã€è°ƒåº¦æœºåˆ¶ã€ç­–ç•¥é€‰æ‹©å’Œæ‰§è¡Œæµç¨‹ï¼Œå¹¶ç»“åˆæºç è¿›è¡Œè¯¦ç»†è§£æã€‚</p>
<hr/>
<h3 data-id="heading-3">äºŒã€Compact æ ¸å¿ƒæ¶æ„</h3>
<h4 data-id="heading-4">2.1 æ•´ä½“æ¶æ„å›¾</h4>
<pre><code class="hljs language-css" lang="css">graph TB
    subgraph Writer<span class="hljs-selector-attr">[å†™å…¥ç«¯]</span>
        W1<span class="hljs-selector-attr">[æ•°æ®å†™å…¥]</span> --&gt; CM<span class="hljs-selector-attr">[CompactManager]</span>
        CM --&gt; |è§¦å‘| CT<span class="hljs-selector-attr">[CompactTask]</span>
    end
    
    subgraph Scheduler<span class="hljs-selector-attr">[å®šæ—¶è°ƒåº¦]</span>
        Timer<span class="hljs-selector-attr">[å®šæ—¶å™¨]</span> --&gt; Coord<span class="hljs-selector-attr">[Coordinator]</span>
        Coord --&gt; |æ‰«æå¿«ç…§| Files<span class="hljs-selector-attr">[æ–‡ä»¶åˆ—è¡¨]</span>
        Files --&gt; |ç”Ÿæˆ| Tasks<span class="hljs-selector-attr">[CompactTaské˜Ÿåˆ—]</span>
    end
    
    subgraph Executor<span class="hljs-selector-attr">[æ‰§è¡Œç«¯]</span>
        Tasks --&gt; Compact<span class="hljs-selector-attr">[Compactæ‰§è¡Œå™¨]</span>
        CT --&gt; Compact
        Compact --&gt; Merge<span class="hljs-selector-attr">[æ–‡ä»¶åˆå¹¶]</span>
        Merge --&gt; NewFiles<span class="hljs-selector-attr">[æ–°æ–‡ä»¶]</span>
    end
    
    subgraph Storage<span class="hljs-selector-attr">[å­˜å‚¨å±‚]</span>
        NewFiles --&gt; Meta<span class="hljs-selector-attr">[å…ƒæ•°æ®æäº¤]</span>
        Meta --&gt; Snapshot<span class="hljs-selector-attr">[æ–°å¿«ç…§]</span>
    end
</code></pre>
<h4 data-id="heading-5">2.2 æ ¸å¿ƒç»„ä»¶</h4>
<h5 data-id="heading-6">2.2.1 CompactManager</h5>
<p><code>CompactManager</code> æ˜¯ Compact çš„ç®¡ç†ä¸­å¿ƒï¼Œè´Ÿè´£ï¼š</p>
<ul>
<li>ç»´æŠ¤æ–‡ä»¶çš„å±‚çº§ç»“æ„ï¼ˆLevelsï¼‰</li>
<li>åˆ¤æ–­æ˜¯å¦éœ€è¦è§¦å‘ Compact</li>
<li>è°ƒç”¨ç­–ç•¥é€‰æ‹©éœ€è¦åˆå¹¶çš„æ–‡ä»¶</li>
<li>æäº¤å¼‚æ­¥ Compact ä»»åŠ¡åˆ°çº¿ç¨‹æ± </li>
</ul>
<p><strong>ä¸»é”®è¡¨å®ç°</strong>ï¼š<code>MergeTreeCompactManager</code><br/>
<strong>Append è¡¨å®ç°</strong>ï¼š<code>BucketedAppendCompactManager</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/compact/CompactManager.java</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">interface</span>Â <span class="hljs-title class_">CompactManager</span>Â {
Â Â Â Â <span class="hljs-comment">//Â åˆ¤æ–­æ˜¯å¦åº”è¯¥ç­‰å¾…Â CompactÂ å®Œæˆ</span>
Â Â Â Â <span class="hljs-type">boolean</span>Â <span class="hljs-title function_">shouldWaitForLatestCompaction</span><span class="hljs-params">()</span>;
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â æ·»åŠ æ–°æ–‡ä»¶åˆ°Â LevelÂ 0</span>
Â Â Â Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">addNewFile</span><span class="hljs-params">(DataFileMetaÂ file)</span>;
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â è§¦å‘Â Compact</span>
Â Â Â Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">triggerCompaction</span><span class="hljs-params">(<span class="hljs-type">boolean</span>Â fullCompaction)</span>;
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â è·å–Â CompactÂ ç»“æœ</span>
Â Â Â Â Optional&lt;CompactResult&gt;Â <span class="hljs-title function_">getCompactionResult</span><span class="hljs-params">(<span class="hljs-type">boolean</span>Â blocking)</span>;
}
</code></pre>
<h5 data-id="heading-7">2.2.2 CompactStrategy</h5>
<p><code>CompactStrategy</code> è´Ÿè´£æ–‡ä»¶é€‰æ‹©ç­–ç•¥ï¼Œå†³å®šå“ªäº›æ–‡ä»¶éœ€è¦åˆå¹¶ï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">/<span class="hljs-regexp">/Â paimon-core/src</span><span class="hljs-regexp">/main/java</span><span class="hljs-regexp">/org/apache</span><span class="hljs-regexp">/paimon/mergetree</span><span class="hljs-regexp">/compact/</span><span class="hljs-title class_">CompactStrategy</span>.java
<span class="hljs-keyword">public</span>Â interfaceÂ <span class="hljs-title class_">CompactStrategy</span>Â {
Â Â Â Â <span class="hljs-regexp">/**
Â Â Â Â Â *Â ä»Â runsÂ ä¸­é€‰æ‹©éœ€è¦Â compactÂ çš„å•å…ƒ
Â Â Â Â Â *Â -Â compactionÂ æ˜¯åŸºäºÂ runsÂ çš„ï¼Œä¸æ˜¯åŸºäºæ–‡ä»¶çš„
Â Â Â Â Â *Â -Â levelÂ 0Â æ˜¯ç‰¹æ®Šçš„ï¼Œä¸€ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ªÂ run
Â Â Â Â Â *Â -Â å…¶ä»–Â levelÂ æ˜¯ä¸€ä¸ªÂ levelÂ å¯¹åº”ä¸€ä¸ªÂ run
Â Â Â Â Â *Â -Â compactionÂ ä»å°Â levelÂ åˆ°å¤§Â levelÂ ä¾æ¬¡è¿›è¡Œ
Â Â Â Â Â */</span>
Â Â Â Â <span class="hljs-title class_">Optional</span>&lt;<span class="hljs-title class_">CompactUnit</span>&gt;Â pick(intÂ numLevels,Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">LevelSortedRun</span>&gt;Â runs);
}
</code></pre>
<h5 data-id="heading-8">2.2.3 CompactTask</h5>
<p><code>CompactTask</code> æ˜¯å®é™…æ‰§è¡Œåˆå¹¶çš„ä»»åŠ¡å•å…ƒï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/compact/CompactTask.java</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">abstract</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">CompactTask</span>Â <span class="hljs-keyword">implements</span>Â <span class="hljs-title class_">Callable</span>&lt;CompactResult&gt;Â {
Â Â Â Â <span class="hljs-meta">@Override</span>
Â Â Â Â <span class="hljs-keyword">public</span>Â CompactResultÂ <span class="hljs-title function_">call</span><span class="hljs-params">()</span>Â <span class="hljs-keyword">throws</span>Â ExceptionÂ {
Â Â Â Â Â Â Â Â <span class="hljs-type">long</span>Â <span class="hljs-variable">startMillis</span>Â <span class="hljs-operator">=</span>Â System.currentTimeMillis();
Â Â Â Â Â Â Â Â <span class="hljs-type">CompactResult</span>Â <span class="hljs-variable">result</span>Â <span class="hljs-operator">=</span>Â doCompact();
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â è®°å½•æŒ‡æ ‡</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (metricsReporterÂ !=Â <span class="hljs-literal">null</span>)Â {
Â Â Â Â Â Â Â Â Â Â Â Â metricsReporter.reportCompactionTime(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â System.currentTimeMillis()Â -Â startMillis);
Â Â Â Â Â Â Â Â Â Â Â Â metricsReporter.increaseCompactionsCompletedCount();
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â result;
Â Â Â Â }
Â Â Â Â 
Â Â Â Â <span class="hljs-keyword">protected</span>Â <span class="hljs-keyword">abstract</span>Â CompactResultÂ <span class="hljs-title function_">doCompact</span><span class="hljs-params">()</span>Â <span class="hljs-keyword">throws</span>Â Exception;
}
</code></pre>
<hr/>
<h3 data-id="heading-9">ä¸‰ã€Compact è§¦å‘æœºåˆ¶</h3>
<p>Paimon æ”¯æŒä¸‰ç§ Compact è§¦å‘æ–¹å¼ï¼š</p>
<h4 data-id="heading-10">3.1 å†…è” Compactï¼ˆInline Compactionï¼‰</h4>
<p><strong>è§¦å‘æ—¶æœº</strong>ï¼šæ•°æ®å†™å…¥è¿‡ç¨‹ä¸­è‡ªåŠ¨è§¦å‘</p>
<p><strong>æ ¸å¿ƒä»£ç </strong>ï¼š<code>MergeTreeWriter.prepareCommit()</code></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/MergeTreeWriter.java:209-248</span>
privateÂ voidÂ <span class="hljs-built_in">flushWriteBuffer</span>(booleanÂ waitForLatestCompaction,Â booleanÂ forcedFullCompaction)
Â Â Â Â Â Â Â Â throwsÂ ExceptionÂ {
Â Â Â Â ifÂ (writeBuffer.size()Â &gt;Â <span class="hljs-number">0</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â åˆ¤æ–­æ˜¯å¦éœ€è¦ç­‰å¾…Â CompactÂ å®Œæˆ</span>
Â Â Â Â Â Â Â Â ifÂ (compactManager.shouldWaitForLatestCompaction())Â {
Â Â Â Â Â Â Â Â Â Â Â Â waitForLatestCompactionÂ =Â true;
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â åˆ·å†™Â bufferÂ åˆ°æ–‡ä»¶</span>
Â Â Â Â Â Â Â Â finalÂ RollingFileWriter&lt;KeyValue,Â DataFileMeta&gt;Â dataWriterÂ =
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â writerFactory<span class="hljs-selector-class">.createRollingMergeTreeFileWriter</span>(<span class="hljs-number">0</span>,Â FileSource.APPEND);
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â ...Â å†™å…¥é€»è¾‘Â ...</span>
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å°†æ–°æ–‡ä»¶æ·»åŠ åˆ°Â CompactManager</span>
Â Â Â Â Â Â Â Â forÂ (DataFileMetaÂ fileMetaÂ :Â dataWriter.result())Â {
Â Â Â Â Â Â Â Â Â Â Â Â newFiles<span class="hljs-selector-class">.add</span>(fileMeta);
Â Â Â Â Â Â Â Â Â Â Â Â compactManager<span class="hljs-selector-class">.addNewFile</span>(fileMeta);
Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â <span class="hljs-comment">//Â ç­‰å¾…ä¸Šä¸€æ¬¡Â CompactÂ å®Œæˆ</span>
Â Â Â Â <span class="hljs-built_in">trySyncLatestCompaction</span>(waitForLatestCompaction);
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â è§¦å‘æ–°çš„Â Compact</span>
Â Â Â Â compactManager<span class="hljs-selector-class">.triggerCompaction</span>(forcedFullCompaction);
}
</code></pre>
<p><strong>åˆ¤æ–­æ˜¯å¦éœ€è¦ç­‰å¾… Compact</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/compact/MergeTreeCompactManager.java:105-113</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-built_in">boolean</span>Â <span class="hljs-title function_">shouldWaitForLatestCompaction</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-comment">//Â å½“Â SortedRunÂ æ•°é‡è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œé˜»å¡å†™å…¥ç­‰å¾…Â Compact</span>
Â Â Â Â <span class="hljs-keyword">return</span>Â levels.<span class="hljs-title function_">numberOfSortedRuns</span>()Â &gt;Â numSortedRunStopTrigger;
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-built_in">boolean</span>Â <span class="hljs-title function_">shouldWaitForPreparingCheckpoint</span>(<span class="hljs-params"/>)Â {
Â Â Â Â <span class="hljs-comment">//Â åœ¨Â checkpointÂ å‡†å¤‡é˜¶æ®µï¼Œå¦‚æœÂ runsÂ æ•°é‡è¶…è¿‡é˜ˆå€¼+1ï¼Œä¹Ÿè¦ç­‰å¾…</span>
Â Â Â Â <span class="hljs-keyword">return</span>Â levels.<span class="hljs-title function_">numberOfSortedRuns</span>()Â &gt;Â (long)Â numSortedRunStopTriggerÂ +Â <span class="hljs-number">1</span>;
}
</code></pre>
<p><strong>å…³é”®é…ç½®</strong>ï¼š</p>
<ul>
<li><code>num-sorted-run.stop-trigger</code>ï¼šé»˜è®¤ <code>Integer.MAX_VALUE</code>ï¼Œå½“ SortedRun æ•°é‡è¶…è¿‡æ­¤å€¼æ—¶é˜»å¡å†™å…¥</li>
</ul>
<h4 data-id="heading-11">3.2 å®šæ—¶ Compact Job</h4>
<p><strong>è§¦å‘æ—¶æœº</strong>ï¼šç‹¬ç«‹çš„ Compact ä½œä¸šï¼Œå®šæ—¶æ‰«æè¡¨å¿«ç…§ç”Ÿæˆ Compact ä»»åŠ¡</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<ul>
<li>å¤šä¸ªå†™ä½œä¸šåŒæ—¶å†™å…¥åŒä¸€å¼ è¡¨</li>
<li>éœ€è¦å°†å†™å…¥å’Œ Compact èµ„æºéš”ç¦»</li>
<li>å¤§è§„æ¨¡æ•°æ®å†™å…¥åœºæ™¯</li>
</ul>
<p><strong>é…ç½®æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--Â åœ¨å†™è¡¨æ—¶ç¦ç”¨Â Compact</span>
<span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â my_tableÂ (
Â Â Â Â ...
)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-string">'write-only'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'true'</span>Â Â <span class="hljs-comment">--Â è·³è¿‡Â CompactÂ å’ŒÂ SnapshotÂ è¿‡æœŸ</span>
);

<span class="hljs-comment">--Â å¯åŠ¨ä¸“é—¨çš„Â CompactÂ ä½œä¸š</span>
<span class="hljs-keyword">CALL</span>Â sys.compact(<span class="hljs-string">'default.my_table'</span>);
</code></pre>
<p>æˆ–ä½¿ç”¨ Action Jarï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">&lt;FLINK_HOME&gt;/bin/flinkÂ runÂ \
Â Â Â Â /path/to/paimon-flink-action.jarÂ \
Â Â Â Â compactÂ \
Â Â Â Â --warehouseÂ hdfs:<span class="hljs-comment">///path/to/warehouseÂ \
Â Â Â Â --databaseÂ defaultÂ \
Â Â Â Â --tableÂ my_table</span>
</code></pre>
<p><strong>å®šæ—¶é—´éš”é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--Â è®¾ç½®æ‰«æé—´éš”ä¸ºÂ 30Â ç§’</span>
<span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â my_tableÂ (...)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-string">'continuous.discovery-interval'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'30s'</span>
);
</code></pre>
<h4 data-id="heading-12">3.3 æ‰‹åŠ¨è§¦å‘ Compact</h4>
<p><strong>Flink SQL æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--Â å¯¹ç‰¹å®šåˆ†åŒºè¿›è¡ŒÂ Compact</span>
<span class="hljs-keyword">CALL</span>Â sys.compact(
Â Â Â Â `<span class="hljs-keyword">table</span>`Â <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span>Â <span class="hljs-string">'default.my_table'</span>,Â 
Â Â Â Â `partitions`Â <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span>Â <span class="hljs-string">'dt=2024-01-01'</span>,
Â Â Â Â `options`Â <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span>Â <span class="hljs-string">'sink.parallelism=10'</span>
);

<span class="hljs-comment">--Â FullÂ Compaction</span>
<span class="hljs-keyword">CALL</span>Â sys.compact(
Â Â Â Â `<span class="hljs-keyword">table</span>`Â <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span>Â <span class="hljs-string">'default.my_table'</span>,
Â Â Â Â `compact_strategy`Â <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span>Â <span class="hljs-string">'full'</span>
);
</code></pre>
<p><strong>Spark æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-lua" lang="lua">valÂ <span class="hljs-built_in">table</span>Â =Â spark.<span class="hljs-built_in">table</span>(<span class="hljs-string">"default.my_table"</span>)
<span class="hljs-built_in">table</span>.createOrReplaceTempView(<span class="hljs-string">"tmp"</span>)
spark.sql(<span class="hljs-string">"CALLÂ paimon.sys.compact(tableÂ =&gt;Â 'tmp')"</span>)
</code></pre>
<hr/>
<h3 data-id="heading-13">å››ã€Append è¡¨ Compact æµç¨‹è¯¦è§£</h3>
<h4 data-id="heading-14">4.1 æ•´ä½“æµç¨‹å›¾</h4>
<pre><code class="hljs language-rust" lang="rust">sequenceDiagram
    participant Timer <span class="hljs-keyword">as</span> å®šæ—¶å™¨
    participant Coord <span class="hljs-keyword">as</span> AppendCompactCoordinator
    participant SubCoord <span class="hljs-keyword">as</span> SubCoordinator
    participant Task <span class="hljs-keyword">as</span> AppendCompactTask
    participant Writer <span class="hljs-keyword">as</span> FileWriter
    participant Commit <span class="hljs-keyword">as</span> Committer
    
    Timer<span class="hljs-punctuation">-&gt;</span>&gt;Coord: è§¦å‘æ‰«æ(æ¯<span class="hljs-number">10</span>ç§’)
    Coord<span class="hljs-punctuation">-&gt;</span>&gt;Coord: <span class="hljs-title function_ invoke__">scan</span>() æ‰«æå¿«ç…§
    Note over Coord: æ‰¹é‡è¯»å–<span class="hljs-number">100</span>kä¸ªæ–‡ä»¶
    Coord<span class="hljs-punctuation">-&gt;</span>&gt;SubCoord: <span class="hljs-title function_ invoke__">notifyNewFiles</span>(partition, files)
    SubCoord<span class="hljs-punctuation">-&gt;</span>&gt;SubCoord: è¿‡æ»¤éœ€è¦Compactçš„æ–‡ä»¶
    SubCoord<span class="hljs-punctuation">-&gt;</span>&gt;SubCoord: <span class="hljs-title function_ invoke__">agePack</span>() æ‰“åŒ…æ–‡ä»¶
    Note over SubCoord: ä½¿ç”¨FileBinæ‰“åŒ…&lt;br/&gt;ç›®æ ‡:<span class="hljs-number">2</span>å€targetFileSize
    SubCoord<span class="hljs-punctuation">-&gt;</span>&gt;Task: ç”ŸæˆCompactTask
    Task<span class="hljs-punctuation">-&gt;</span>&gt;Writer: <span class="hljs-title function_ invoke__">doCompact</span>() æ‰§è¡Œåˆå¹¶
    Writer<span class="hljs-punctuation">-&gt;</span>&gt;Writer: è¯»å–æ–‡ä»¶å¹¶åˆå¹¶
    Writer<span class="hljs-punctuation">-&gt;</span>&gt;Commit: ç”Ÿæˆæ–°æ–‡ä»¶
    Commit<span class="hljs-punctuation">-&gt;</span>&gt;Commit: æäº¤å…ƒæ•°æ®
</code></pre>
<h4 data-id="heading-15">4.2 æ ¸å¿ƒç±»ï¼šAppendCompactCoordinator</h4>
<p><code>AppendCompactCoordinator</code> æ˜¯ Append è¡¨çš„ Compact åè°ƒå™¨ï¼Œè´Ÿè´£æ‰«æå¿«ç…§ã€è¿‡æ»¤æ–‡ä»¶ã€ç”Ÿæˆä»»åŠ¡ã€‚</p>
<p><strong>ç±»å®šä¹‰</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/append/AppendCompactCoordinator.java:70-109</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">AppendCompactCoordinator</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-type">static</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">int</span>Â FILES_BATCHÂ =Â <span class="hljs-number">100</span>_000;Â Â <span class="hljs-comment">//Â æ‰¹é‡å¤„ç†æ–‡ä»¶æ•°</span>
Â Â Â Â <span class="hljs-keyword">protected</span>Â <span class="hljs-type">static</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">int</span>Â REMOVE_AGEÂ =Â <span class="hljs-number">10</span>;Â Â Â Â Â Â <span class="hljs-comment">//Â ç§»é™¤å¹´é¾„é˜ˆå€¼</span>
Â Â Â Â <span class="hljs-keyword">protected</span>Â <span class="hljs-type">static</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">int</span>Â COMPACT_AGEÂ =Â <span class="hljs-number">5</span>;Â Â Â Â Â Â <span class="hljs-comment">//Â å¼ºåˆ¶Compactå¹´é¾„</span>

Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â SnapshotManagerÂ snapshotManager;
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">long</span>Â targetFileSize;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â ç›®æ ‡æ–‡ä»¶å¤§å°</span>
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">long</span>Â compactionFileSize;Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â Compacté˜ˆå€¼</span>
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">double</span>Â deleteThreshold;Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â åˆ é™¤ç‡é˜ˆå€¼</span>
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">int</span>Â minFileNum;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æœ€å°æ–‡ä»¶æ•°</span>
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â æŒ‰åˆ†åŒºç»„ç»‡çš„å­åè°ƒå™¨</span>
Â Â Â Â <span class="hljs-keyword">final</span>Â Map&lt;BinaryRow,Â SubCoordinator&gt;Â subCoordinatorsÂ =Â <span class="hljs-keyword">new</span>Â HashMap&lt;&gt;();
Â Â Â Â 
Â Â Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â List&lt;AppendCompactTask&gt;Â <span class="hljs-title">run</span><span class="hljs-params">()</span>Â </span>{
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ‰«æå¿«ç…§ä¸­çš„æ–‡ä»¶</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-built_in">scan</span>())Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â ç”ŸæˆÂ CompactÂ ä»»åŠ¡</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-built_in">compactPlan</span>();
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â Collections.<span class="hljs-built_in">emptyList</span>();
Â Â Â Â }
}
</code></pre>
<h4 data-id="heading-16">4.3 æ–‡ä»¶æ‰«æé€»è¾‘</h4>
<p><strong>scan() æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">//Â paimon-core/src/main/java/org/apache/paimon/append/AppendCompactCoordinator.java:122-148
booleanÂ scan()Â {
Â Â Â Â Map&lt;BinaryRow,Â List&lt;DataFileMeta&gt;&gt;Â <span class="hljs-attr">files</span>Â =Â newÂ HashMap&lt;&gt;()<span class="hljs-comment">;</span>
Â Â Â Â 
Â Â Â Â //Â æ‰¹é‡è¯»å–æ–‡ä»¶ï¼ˆæ¯æ¬¡æœ€å¤šÂ 100,000Â ä¸ªï¼‰
Â Â Â Â forÂ (intÂ <span class="hljs-attr">i</span>Â =Â <span class="hljs-number">0</span><span class="hljs-comment">;Â iÂ &lt;Â FILES_BATCH;Â i++)Â {</span>
Â Â Â Â Â Â Â Â ManifestEntryÂ entry<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">entry</span>Â =Â filesIterator.next()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }Â catchÂ (EndOfScanExceptionÂ e)Â {
Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (!files.isEmpty())Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â files.forEach(this::notifyNewFiles)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ true<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â throwÂ e<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â ifÂ (<span class="hljs-attr">entry</span>Â ==Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â break<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â BinaryRowÂ <span class="hljs-attr">partition</span>Â =Â entry.partition()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â files.computeIfAbsent(partition,Â kÂ -&gt;Â newÂ ArrayList&lt;&gt;()).add(entry.file())<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â ifÂ (files.isEmpty())Â {
Â Â Â Â Â Â Â Â returnÂ false<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â files.forEach(this::notifyNewFiles)<span class="hljs-comment">;</span>
Â Â Â Â returnÂ true<span class="hljs-comment">;</span>
}
</code></pre>
<p><strong>æ–‡ä»¶è¿‡æ»¤æ¡ä»¶</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/append/AppendCompactCoordinator.java:467-482</span>
<span class="hljs-keyword">private</span>Â <span class="hljs-type">boolean</span>Â <span class="hljs-title function_">shouldCompact</span><span class="hljs-params">(BinaryRowÂ partition,Â DataFileMetaÂ file)</span>Â {
Â Â Â Â <span class="hljs-comment">//Â æ¡ä»¶1:Â æ–‡ä»¶å¤§å°å°äºÂ compaction.file-size</span>
Â Â Â Â <span class="hljs-keyword">if</span>Â (file.fileSize()Â &lt;Â compactionFileSize)Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-literal">true</span>;
Â Â Â Â }
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â æ¡ä»¶2:Â åˆ é™¤ç‡è¶…è¿‡é˜ˆå€¼ï¼ˆå¯ç”¨Â DeletionÂ VectorÂ æ—¶ï¼‰</span>
Â Â Â Â <span class="hljs-keyword">return</span>Â tooHighDeleteRatio(partition,Â file);
}

<span class="hljs-keyword">private</span>Â <span class="hljs-type">boolean</span>Â <span class="hljs-title function_">tooHighDeleteRatio</span><span class="hljs-params">(BinaryRowÂ partition,Â DataFileMetaÂ file)</span>Â {
Â Â Â Â <span class="hljs-keyword">if</span>Â (dvMaintainerCacheÂ !=Â <span class="hljs-literal">null</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-type">DeletionFile</span>Â <span class="hljs-variable">deletionFile</span>Â <span class="hljs-operator">=</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dvMaintainerCache.dvMaintainer(partition).getDeletionFile(file.fileName());
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (deletionFileÂ !=Â <span class="hljs-literal">null</span>)Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">Long</span>Â <span class="hljs-variable">cardinality</span>Â <span class="hljs-operator">=</span>Â deletionFile.cardinality();
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">long</span>Â <span class="hljs-variable">rowCount</span>Â <span class="hljs-operator">=</span>Â file.rowCount();
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â cardinalityÂ ==Â <span class="hljs-literal">null</span>Â ||Â cardinalityÂ &gt;Â rowCountÂ *Â deleteThreshold;
Â Â Â Â Â Â Â Â }
Â Â Â Â }
Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-literal">false</span>;
}
</code></pre>
<h4 data-id="heading-17">4.4 æ–‡ä»¶æ‰“åŒ…ç­–ç•¥ï¼šSubCoordinator</h4>
<p>æ¯ä¸ªåˆ†åŒºæœ‰ä¸€ä¸ª <code>SubCoordinator</code>ï¼Œè´Ÿè´£è¯¥åˆ†åŒºçš„æ–‡ä»¶æ‰“åŒ…å’Œä»»åŠ¡ç”Ÿæˆã€‚</p>
<p><strong>æ‰“åŒ…é€»è¾‘</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/append/AppendCompactCoordinator.java:233-274</span>
privateÂ List&lt;List&lt;DataFileMeta&gt;&gt;Â <span class="hljs-built_in">agePack</span>()Â {
Â Â Â Â List&lt;List&lt;DataFileMeta&gt;&gt;Â packed;
Â Â Â Â 
Â Â Â Â ifÂ (dvMaintainerCacheÂ ==Â null)Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ™®é€šæ‰“åŒ…æ¨¡å¼</span>
Â Â Â Â Â Â Â Â packedÂ =Â <span class="hljs-built_in">pack</span>(toCompact);
Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â DeletionÂ VectorÂ æ¨¡å¼ï¼šæŒ‰åˆ é™¤æ–‡ä»¶åˆ†ç»„</span>
Â Â Â Â Â Â Â Â packedÂ =Â <span class="hljs-built_in">packInDeletionVectorVMode</span>(toCompact);
Â Â Â Â }
Â Â Â Â 
Â Â Â Â ifÂ (packed.isEmpty())Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å¦‚æœæ²¡æœ‰å¯æ‰“åŒ…çš„ï¼Œå¢åŠ å¹´é¾„</span>
Â Â Â Â Â Â Â Â ifÂ (++ageÂ &gt;Â COMPACT_AGEÂ &amp;&amp;Â toCompact.size()Â &gt;Â <span class="hljs-number">1</span>)Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å¹´é¾„è¶…è¿‡é˜ˆå€¼ï¼Œå¼ºåˆ¶æ‰“åŒ…æ‰€æœ‰æ–‡ä»¶</span>
Â Â Â Â Â Â Â Â Â Â Â Â List&lt;DataFileMeta&gt;Â <span class="hljs-attribute">all</span>Â =Â newÂ ArrayList&lt;&gt;(toCompact);
Â Â Â Â Â Â Â Â Â Â Â Â toCompact<span class="hljs-selector-class">.clear</span>();
Â Â Â Â Â Â Â Â Â Â Â Â packedÂ =Â Collections<span class="hljs-selector-class">.singletonList</span>(all);
Â Â Â Â Â Â Â Â }
Â Â Â Â }
Â Â Â Â 
Â Â Â Â returnÂ packed;
}

privateÂ List&lt;List&lt;DataFileMeta&gt;&gt;Â <span class="hljs-built_in">pack</span>(Set&lt;DataFileMeta&gt;Â toCompact)Â {
Â Â Â Â <span class="hljs-comment">//Â æŒ‰æ–‡ä»¶å¤§å°æ’åº</span>
Â Â Â Â ArrayList&lt;DataFileMeta&gt;Â filesÂ =Â newÂ ArrayList&lt;&gt;(toCompact);
Â Â Â Â files<span class="hljs-selector-class">.sort</span>(Comparator.comparingLong(DataFileMeta::fileSize));

Â Â Â Â List&lt;List&lt;DataFileMeta&gt;&gt;Â resultÂ =Â newÂ ArrayList&lt;&gt;();
Â Â Â Â FileBinÂ fileBinÂ =Â newÂ <span class="hljs-built_in">FileBin</span>();
Â Â Â Â 
Â Â Â Â forÂ (DataFileMetaÂ fileMetaÂ :Â files)Â {
Â Â Â Â Â Â Â Â fileBin<span class="hljs-selector-class">.addFile</span>(fileMeta);
Â Â Â Â Â Â Â Â ifÂ (fileBin.enoughContent())Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ»¡è¶³æ‰“åŒ…æ¡ä»¶ï¼šæ–‡ä»¶æ•°&gt;1Â ä¸”Â æ€»å¤§å°Â &gt;=Â 2*targetFileSize</span>
Â Â Â Â Â Â Â Â Â Â Â Â result<span class="hljs-selector-class">.add</span>(fileBin.drain());
Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â ifÂ (fileBin.enoughInputFiles())Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ–‡ä»¶æ•°æ»¡è¶³æœ€å°è¦æ±‚</span>
Â Â Â Â Â Â Â Â result<span class="hljs-selector-class">.add</span>(fileBin.drain());
Â Â Â Â }

Â Â Â Â returnÂ result;
}
</code></pre>
<p><strong>FileBin æ‰“åŒ…å•å…ƒ</strong>ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/append/AppendCompactCoordinator.java:324-352</span>
<span class="hljs-keyword">private</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">FileBin</span>Â {
Â Â Â Â <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">DataFileMeta</span>&gt;Â binÂ =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
Â Â Â Â longÂ totalFileSizeÂ =Â <span class="hljs-number">0</span>;

Â Â Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-built_in">void</span>Â <span class="hljs-title function_">addFile</span>(<span class="hljs-params">DataFileMetaÂ file</span>)Â {
Â Â Â Â Â Â Â Â totalFileSizeÂ +=Â file.<span class="hljs-title function_">fileSize</span>()Â +Â openFileCost;
Â Â Â Â Â Â Â Â bin.<span class="hljs-title function_">add</span>(file);
Â Â Â Â }

Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-built_in">boolean</span>Â <span class="hljs-title function_">enoughContent</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ–‡ä»¶æ•°Â &gt;Â 1Â ä¸”Â æ€»å¤§å°Â &gt;=Â 2Â å€Â targetFileSize</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â bin.<span class="hljs-title function_">size</span>()Â &gt;Â <span class="hljs-number">1</span>Â &amp;&amp;Â totalFileSizeÂ &gt;=Â targetFileSizeÂ *Â <span class="hljs-number">2</span>;
Â Â Â Â }

Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-built_in">boolean</span>Â <span class="hljs-title function_">enoughInputFiles</span>(<span class="hljs-params"/>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ–‡ä»¶æ•°Â &gt;=Â minFileNum</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>Â bin.<span class="hljs-title function_">size</span>()Â &gt;=Â minFileNum;
Â Â Â Â }
}
</code></pre>
<h4 data-id="heading-18">4.5 ä»»åŠ¡æ‰§è¡Œï¼šAppendCompactTask</h4>
<p><strong>ä»»åŠ¡å®šä¹‰</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/append/AppendCompactTask.java:44-67</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">AppendCompactTask</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â BinaryRowÂ partition;
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â List&lt;DataFileMeta&gt;Â compactBefore;Â Â <span class="hljs-comment">//Â å¾…åˆå¹¶æ–‡ä»¶</span>
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â List&lt;DataFileMeta&gt;Â compactAfter;Â Â Â <span class="hljs-comment">//Â åˆå¹¶åæ–‡ä»¶</span>

Â Â Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â <span class="hljs-title">AppendCompactTask</span><span class="hljs-params">(BinaryRowÂ partition,Â List&lt;DataFileMeta&gt;Â files)</span>Â </span>{
Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>.partitionÂ =Â partition;
Â Â Â Â Â Â Â Â compactBeforeÂ =Â <span class="hljs-keyword">new</span>Â ArrayList&lt;&gt;(files);
Â Â Â Â Â Â Â Â compactAfterÂ =Â <span class="hljs-keyword">new</span>Â ArrayList&lt;&gt;();
Â Â Â Â }

Â Â Â Â <span class="hljs-function"><span class="hljs-keyword">public</span>Â CommitMessageÂ <span class="hljs-title">doCompact</span><span class="hljs-params">(FileStoreTableÂ table,Â BaseAppendFileStoreWriteÂ write)</span>
Â Â Â Â Â Â Â Â Â Â Â Â throwsÂ ExceptionÂ </span>{
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ‰§è¡Œæ–‡ä»¶åˆå¹¶</span>
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â ...Â åˆå¹¶é€»è¾‘Â ...</span>
Â Â Â Â }
}
</code></pre>
<h4 data-id="heading-19">4.6 Bucketed Append è¡¨çš„ Compact</h4>
<p>å¯¹äºæœ‰ Bucket çš„ Append è¡¨ï¼Œä½¿ç”¨ <code>BucketedAppendCompactManager</code>ï¼š</p>
<p><strong>æ–‡ä»¶é€‰æ‹©é€»è¾‘</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">//Â paimon-core/src/main/java/org/apache/paimon/append/BucketedAppendCompactManager.java:201-227
Optional&lt;List&lt;DataFileMeta&gt;&gt;Â pickCompactBefore()Â {
Â Â Â Â ifÂ (toCompact.isEmpty())Â {
Â Â Â Â Â Â Â Â returnÂ Optional.empty()<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â longÂ <span class="hljs-attr">totalFileSize</span>Â =Â <span class="hljs-number">0</span>L<span class="hljs-comment">;</span>
Â Â Â Â intÂ <span class="hljs-attr">fileNum</span>Â =Â <span class="hljs-number">0</span><span class="hljs-comment">;</span>
Â Â Â Â LinkedList&lt;DataFileMeta&gt;Â <span class="hljs-attr">candidates</span>Â =Â newÂ LinkedList&lt;&gt;()<span class="hljs-comment">;</span>

Â Â Â Â //Â ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—æŒ‰åºå·æ’åºæ–‡ä»¶
Â Â Â Â whileÂ (!toCompact.isEmpty())Â {
Â Â Â Â Â Â Â Â DataFileMetaÂ <span class="hljs-attr">file</span>Â =Â toCompact.poll()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â candidates.add(file)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â totalFileSizeÂ +=Â file.fileSize()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â fileNum++<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â ifÂ (fileNumÂ &gt;=Â minFileNum)Â {
Â Â Â Â Â Â Â Â Â Â Â Â //Â æ»¡è¶³æœ€å°æ–‡ä»¶æ•°è¦æ±‚
Â Â Â Â Â Â Â Â Â Â Â Â returnÂ Optional.of(candidates)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }Â elseÂ ifÂ (totalFileSizeÂ &gt;=Â targetFileSize)Â {
Â Â Â Â Â Â Â Â Â Â Â Â //Â æ€»å¤§å°è¶…è¿‡ç›®æ ‡ï¼Œç§»é™¤ç¬¬ä¸€ä¸ªæ–‡ä»¶ç»§ç»­
Â Â Â Â Â Â Â Â Â Â Â Â DataFileMetaÂ <span class="hljs-attr">removed</span>Â =Â candidates.pollFirst()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â totalFileSizeÂ <span class="hljs-attr">-</span>=Â removed.fileSize()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â fileNum--<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }
Â Â Â Â }
Â Â Â Â 
Â Â Â Â toCompact.addAll(candidates)<span class="hljs-comment">;</span>
Â Â Â Â returnÂ Optional.empty()<span class="hljs-comment">;</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-20">äº”ã€ä¸»é”®è¡¨ Compact æµç¨‹è¯¦è§£</h3>
<h4 data-id="heading-21">5.1 LSM-Tree æ¶æ„</h4>
<p>ä¸»é”®è¡¨é‡‡ç”¨ LSM-Treeï¼ˆLog-Structured Merge-Treeï¼‰æ¶æ„ï¼Œæ•°æ®æ–‡ä»¶åˆ†ä¸ºå¤šä¸ª Levelï¼š</p>
<pre><code class="hljs language-ini" lang="ini">LevelÂ 0:Â Â <span class="hljs-section">[File1]</span>Â <span class="hljs-section">[File2]</span>Â <span class="hljs-section">[File3]</span>Â ...Â Â (å¯èƒ½æœ‰é‡å )
Â Â Â Â Â Â Â Â Â Â â†“Â Compact
LevelÂ 1:Â Â <span class="hljs-section">[File_L1_1Â |Â File_L1_2Â |Â File_L1_3]</span>Â Â (æœ‰åºï¼Œæ— é‡å )
Â Â Â Â Â Â Â Â Â Â â†“Â CompactÂ Â 
LevelÂ 2:Â Â <span class="hljs-section">[File_L2_1Â ---------Â |Â File_L2_2Â ---------]</span>
Â Â Â Â Â Â Â Â Â Â â†“Â Compact
LevelÂ N:Â Â <span class="hljs-section">[File_LN_1Â -------------------------------]</span>
</code></pre>
<p><strong>Level ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>Level 0</strong>ï¼šæ–°å†™å…¥çš„æ–‡ä»¶ï¼Œæ–‡ä»¶ä¹‹é—´å¯èƒ½æœ‰ Key é‡å ï¼Œä¸€ä¸ªæ–‡ä»¶å¯¹åº”ä¸€ä¸ª SortedRun</li>
<li><strong>Level 1+</strong>ï¼šåˆå¹¶åçš„æ–‡ä»¶ï¼ŒåŒä¸€ Level å†…æ–‡ä»¶æŒ‰ Key æœ‰åºä¸”ä¸é‡å ï¼Œä¸€ä¸ª Level å¯¹åº”ä¸€ä¸ª SortedRun</li>
</ul>
<h4 data-id="heading-22">5.2 æ ¸å¿ƒç±»ï¼šMergeTreeCompactManager</h4>
<p><strong>ç±»å®šä¹‰</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/compact/MergeTreeCompactManager.java:53-102</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">MergeTreeCompactManager</span>Â <span class="hljs-keyword">extends</span>Â <span class="hljs-title class_">CompactFutureManager</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â ExecutorServiceÂ executor;
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â LevelsÂ levels;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â LSM-TreeÂ å±‚çº§ç»“æ„</span>
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â CompactStrategyÂ strategy;Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â CompactÂ ç­–ç•¥</span>
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â Comparator&lt;InternalRow&gt;Â keyComparator;
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">long</span>Â compactionFileSize;
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">int</span>Â numSortedRunStopTrigger;
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â CompactRewriterÂ rewriter;
Â Â Â Â 
Â Â Â Â <span class="hljs-meta">@Nullable</span>Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â CompactionMetrics.ReporterÂ metricsReporter;
Â Â Â Â <span class="hljs-meta">@Nullable</span>Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â BucketedDvMaintainerÂ dvMaintainer;
Â Â Â Â <span class="hljs-meta">@Nullable</span>Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â RecordLevelExpireÂ recordLevelExpire;
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â ...Â æ„é€ æ–¹æ³•Â ...</span>
}
</code></pre>
<h4 data-id="heading-23">5.3 æ–‡ä»¶æ·»åŠ ä¸è§¦å‘ Compact</h4>
<p><strong>æ·»åŠ æ–°æ–‡ä»¶åˆ° Level 0</strong>ï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby">/<span class="hljs-regexp">/Â paimon-core/src</span><span class="hljs-regexp">/main/java</span><span class="hljs-regexp">/org/apache</span><span class="hljs-regexp">/paimon/mergetree</span><span class="hljs-regexp">/compact/</span><span class="hljs-title class_">MergeTreeCompactManager</span>.<span class="hljs-symbol">java:</span><span class="hljs-number">116</span>-<span class="hljs-number">124</span>
<span class="hljs-variable">@Override</span>
<span class="hljs-keyword">public</span>Â voidÂ addNewFile(<span class="hljs-title class_">DataFileMeta</span>Â file)Â {
Â Â Â Â levels.addLevel0File(file);
Â Â Â Â <span class="hljs-title class_">MetricUtils</span>.safeCall(this::reportMetrics,Â <span class="hljs-variable constant_">LOG</span>);
}
</code></pre>
<p><strong>è§¦å‘ Compact é€»è¾‘</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/compact/MergeTreeCompactManager.java:127-194</span>
<span class="hljs-keyword">@Override</span>
publicÂ voidÂ triggerCompaction(booleanÂ fullCompaction)Â {
Â Â Â Â Optional&lt;CompactUnit&gt;Â optionalUnit;
Â Â Â Â List&lt;LevelSortedRun&gt;Â runsÂ =Â levels<span class="hljs-selector-class">.levelSortedRuns</span>();
Â Â Â Â 
Â Â Â Â ifÂ (fullCompaction)Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å¼ºåˆ¶å…¨é‡Â Compact</span>
Â Â Â Â Â Â Â Â Preconditions<span class="hljs-selector-class">.checkState</span>(taskFutureÂ ==Â null,
Â Â Â Â Â Â Â Â Â Â Â Â "AÂ compactionÂ taskÂ isÂ stillÂ runningÂ whileÂ forcingÂ aÂ newÂ compaction.");
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â optionalUnitÂ =Â CompactStrategy<span class="hljs-selector-class">.pickFullCompaction</span>(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â levels.numberOfLevels(),
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â runs,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â recordLevelExpire,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dvMaintainer,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â forceRewriteAllFiles);
Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ­£å¸¸Â Compact</span>
Â Â Â Â Â Â Â Â ifÂ (taskFutureÂ !=Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â return;Â Â <span class="hljs-comment">//Â å·²æœ‰ä»»åŠ¡åœ¨è¿è¡Œ</span>
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â ä½¿ç”¨ç­–ç•¥é€‰æ‹©æ–‡ä»¶</span>
Â Â Â Â Â Â Â Â optionalUnitÂ =Â strategy<span class="hljs-selector-class">.pick</span>(levels.numberOfLevels(),Â runs)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.filter</span>(unitÂ -&gt;Â !unit.files()<span class="hljs-selector-class">.isEmpty</span>())
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.filter</span>(unitÂ -&gt;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â unit.files()<span class="hljs-selector-class">.size</span>()Â &gt;Â <span class="hljs-number">1</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ||Â unit<span class="hljs-selector-class">.files</span>()<span class="hljs-selector-class">.get</span>(<span class="hljs-number">0</span>)<span class="hljs-selector-class">.level</span>()Â !=Â unit<span class="hljs-selector-class">.outputLevel</span>());
Â Â Â Â }

Â Â Â Â optionalUnit<span class="hljs-selector-class">.ifPresent</span>(unitÂ -&gt;Â {
Â Â Â Â Â Â Â Â //Â åˆ¤æ–­æ˜¯å¦å¯ä»¥åˆ é™¤æ—§è®°å½•
Â Â Â Â Â Â Â Â booleanÂ dropDeleteÂ =Â unit.outputLevel()Â !=Â <span class="hljs-number">0</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &amp;&amp;Â (unit.outputLevel()Â &gt;=Â levels<span class="hljs-selector-class">.nonEmptyHighestLevel</span>()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ||Â dvMaintainerÂ !=Â null);

Â Â Â Â Â Â Â Â <span class="hljs-built_in">submitCompaction</span>(unit,Â dropDelete);
Â Â Â Â });
}
</code></pre>
<h4 data-id="heading-24">5.4 Compact ä»»åŠ¡æäº¤</h4>
<p><strong>submitCompaction() æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/compact/MergeTreeCompactManager.java:201-245</span>
privateÂ voidÂ <span class="hljs-built_in">submitCompaction</span>(CompactUnitÂ unit,Â booleanÂ dropDelete)Â {
Â Â Â Â CompactTaskÂ task;
Â Â Â Â 
Â Â Â Â ifÂ (unit.fileRewrite())Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ–‡ä»¶çº§åˆ«é‡å†™ï¼ˆä»…ä¿®æ”¹å…ƒæ•°æ®ï¼‰</span>
Â Â Â Â Â Â Â Â taskÂ =Â newÂ <span class="hljs-built_in">FileRewriteCompactTask</span>(rewriter,Â unit,Â dropDelete,Â metricsReporter);
Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ­£å¸¸Â Compactï¼ˆè¯»å–åˆå¹¶æ•°æ®ï¼‰</span>
Â Â Â Â Â Â Â Â taskÂ =Â newÂ <span class="hljs-built_in">MergeTreeCompactTask</span>(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â keyComparator,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â compactionFileSize,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â rewriter,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â unit,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â dropDelete,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â levels.maxLevel(),
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â metricsReporter,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â compactDfSupplier,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â recordLevelExpire,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â forceRewriteAllFiles);
Â Â Â Â }

Â Â Â Â ifÂ (LOG.isDebugEnabled())Â {
Â Â Â Â Â Â Â Â LOG<span class="hljs-selector-class">.debug</span>("PickÂ theseÂ filesÂ (name,Â level,Â size)Â forÂ {}Â compaction:Â {}",
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â task<span class="hljs-selector-class">.getClass</span>()<span class="hljs-selector-class">.getSimpleName</span>(),
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â unit<span class="hljs-selector-class">.files</span>()<span class="hljs-selector-class">.stream</span>()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.map</span>(fileÂ -&gt;Â String.format("(%s,Â %d,Â %d)",
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â file<span class="hljs-selector-class">.fileName</span>(),Â file<span class="hljs-selector-class">.level</span>(),Â file<span class="hljs-selector-class">.fileSize</span>()))
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.collect</span>(Collectors.joining(",Â ")));
Â Â Â Â }
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â æäº¤åˆ°çº¿ç¨‹æ± </span>
Â Â Â Â taskFutureÂ =Â executor<span class="hljs-selector-class">.submit</span>(task);
Â Â Â Â 
Â Â Â Â ifÂ (metricsReporterÂ !=Â null)Â {
Â Â Â Â Â Â Â Â metricsReporter<span class="hljs-selector-class">.increaseCompactionsQueuedCount</span>();
Â Â Â Â Â Â Â Â metricsReporter<span class="hljs-selector-class">.increaseCompactionsTotalCount</span>();
Â Â Â Â }
}
</code></pre>
<h4 data-id="heading-25">5.5 MergeTreeCompactTask æ‰§è¡Œé€»è¾‘</h4>
<p><strong>doCompact() æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/compact/MergeTreeCompactTask.java:82-113</span>
<span class="hljs-keyword">@Override</span>
protectedÂ CompactResultÂ doCompact()Â throwsÂ ExceptionÂ {
Â Â Â Â List&lt;List&lt;SortedRun&gt;&gt;Â candidateÂ =Â newÂ ArrayList&lt;&gt;();
Â Â Â Â CompactResultÂ resultÂ =Â newÂ <span class="hljs-built_in">CompactResult</span>();

Â Â Â Â <span class="hljs-comment">//Â éå†åˆ†åŒºï¼ˆIntervalPartitionÂ å°†é‡å æ–‡ä»¶åˆ†ç»„ï¼‰</span>
Â Â Â Â forÂ (List&lt;SortedRun&gt;Â sectionÂ :Â partitioned)Â {
Â Â Â Â Â Â Â Â ifÂ (section.size()Â &gt;Â <span class="hljs-number">1</span>)Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æœ‰å¤šä¸ªÂ Runï¼Œéœ€è¦åˆå¹¶</span>
Â Â Â Â Â Â Â Â Â Â Â Â candidate<span class="hljs-selector-class">.add</span>(section);
Â Â Â Â Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â Â Â Â Â SortedRunÂ runÂ =Â <span class="hljs-selector-tag">section</span><span class="hljs-selector-class">.get</span>(<span class="hljs-number">0</span>);
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å•ä¸ªÂ Runï¼šæ ¹æ®æ–‡ä»¶å¤§å°å†³å®šæ˜¯å¦éœ€è¦é‡å†™</span>
Â Â Â Â Â Â Â Â Â Â Â Â forÂ (DataFileMetaÂ fileÂ :Â run.files())Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (file.fileSize()Â &lt;Â minFileSize)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å°æ–‡ä»¶ï¼šéœ€è¦é‡å†™</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â candidate<span class="hljs-selector-class">.add</span>(singletonList(SortedRun.fromSingle(file)));
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å¤§æ–‡ä»¶ï¼šå…ˆé‡å†™ä¹‹å‰çš„å€™é€‰ï¼Œç„¶åå‡çº§å½“å‰æ–‡ä»¶</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-built_in">rewrite</span>(candidate,Â result);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-built_in">upgrade</span>(file,Â result);
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â }
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â é‡å†™å‰©ä½™çš„å€™é€‰æ–‡ä»¶</span>
Â Â Â Â <span class="hljs-built_in">rewrite</span>(candidate,Â result);
Â Â Â Â result<span class="hljs-selector-class">.setDeletionFile</span>(compactDfSupplier.get());
Â Â Â Â returnÂ result;
}
</code></pre>
<p><strong>upgrade() æ–¹æ³•ï¼ˆæ–‡ä»¶å‡çº§ï¼‰</strong> ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/compact/MergeTreeCompactTask.java:123-138</span>
privateÂ voidÂ <span class="hljs-built_in">upgrade</span>(DataFileMetaÂ file,Â CompactResultÂ toUpdate)Â throwsÂ ExceptionÂ {
Â Â Â Â <span class="hljs-comment">//Â éœ€è¦é‡å†™çš„æƒ…å†µï¼š</span>
Â Â Â Â <span class="hljs-comment">//Â 1.Â è¾“å‡ºåˆ°æœ€é«˜å±‚ä¸”åŒ…å«åˆ é™¤è®°å½•</span>
Â Â Â Â <span class="hljs-comment">//Â 2.Â å¼ºåˆ¶é‡å†™æ‰€æœ‰æ–‡ä»¶</span>
Â Â Â Â <span class="hljs-comment">//Â 3.Â åŒ…å«è¿‡æœŸè®°å½•</span>
Â Â Â Â ifÂ ((outputLevelÂ ==Â maxLevelÂ &amp;&amp;Â containsDeleteRecords(file))
Â Â Â Â Â Â Â Â Â Â Â Â ||Â forceRewriteAllFiles
Â Â Â Â Â Â Â Â Â Â Â Â ||Â <span class="hljs-built_in">containsExpiredRecords</span>(file))Â {
Â Â Â Â Â Â Â Â List&lt;List&lt;SortedRun&gt;&gt;Â candidateÂ =Â newÂ ArrayList&lt;&gt;();
Â Â Â Â Â Â Â Â candidate<span class="hljs-selector-class">.add</span>(singletonList(SortedRun.fromSingle(file)));
Â Â Â Â Â Â Â Â <span class="hljs-built_in">rewriteImpl</span>(candidate,Â toUpdate);
Â Â Â Â Â Â Â Â return;
Â Â Â Â }

Â Â Â Â <span class="hljs-comment">//Â ä»…ä¿®æ”¹æ–‡ä»¶çš„Â levelÂ å…ƒæ•°æ®ï¼ˆæ— éœ€é‡å†™æ•°æ®ï¼‰</span>
Â Â Â Â ifÂ (file.level()Â !=Â outputLevel)Â {
Â Â Â Â Â Â Â Â CompactResultÂ upgradeResultÂ =Â rewriter<span class="hljs-selector-class">.upgrade</span>(outputLevel,Â file);
Â Â Â Â Â Â Â Â toUpdate<span class="hljs-selector-class">.merge</span>(upgradeResult);
Â Â Â Â Â Â Â Â upgradeFilesNum++;
Â Â Â Â }
}
</code></pre>
<h4 data-id="heading-26">5.6 IntervalPartition ç®—æ³•</h4>
<p><code>IntervalPartition</code> ç”¨äºå°†å¤šä¸ªæ•°æ®æ–‡ä»¶åˆ’åˆ†ä¸ºæœ€å°‘æ•°é‡çš„ SortedRunï¼Œå¤„ç†æ–‡ä»¶é—´çš„ Key é‡å ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/compact/IntervalPartition.java:32-91
publicÂ classÂ IntervalPartitionÂ {
Â Â Â Â privateÂ finalÂ List&lt;DataFileMeta&gt;Â files<span class="hljs-comment">;</span>
Â Â Â Â privateÂ finalÂ Comparator&lt;InternalRow&gt;Â keyComparator<span class="hljs-comment">;</span>

Â Â Â Â /**
Â Â Â Â Â *Â è¿”å›äºŒç»´åˆ—è¡¨ï¼š
Â Â Â Â Â *Â -Â å¤–å±‚åˆ—è¡¨ï¼šsectionsï¼ˆä¸åŒÂ sectionÂ çš„Â KeyÂ åŒºé—´ä¸é‡å ï¼‰
Â Â Â Â Â *Â -Â å†…å±‚åˆ—è¡¨ï¼šSortedRunsï¼ˆåŒä¸€Â sectionÂ å†…çš„å¤šä¸ªÂ Runï¼‰
Â Â Â Â Â */
Â Â Â Â publicÂ List&lt;List&lt;SortedRun&gt;&gt;Â partition()Â {
Â Â Â Â Â Â Â Â List&lt;List&lt;SortedRun&gt;&gt;Â <span class="hljs-attr">result</span>Â =Â newÂ ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â List&lt;DataFileMeta&gt;Â <span class="hljs-attr">section</span>Â =Â newÂ ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â InternalRowÂ <span class="hljs-attr">bound</span>Â =Â null<span class="hljs-comment">;</span>

Â Â Â Â Â Â Â Â //Â æŒ‰Â minKeyÂ æ’åº
Â Â Â Â Â Â Â Â files.sort((o1,Â o2)Â -&gt;Â {
Â Â Â Â Â Â Â Â Â Â Â Â intÂ <span class="hljs-attr">leftResult</span>Â =Â keyComparator.compare(o1.minKey(),Â o2.minKey())<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â returnÂ <span class="hljs-attr">leftResult</span>Â ==Â <span class="hljs-number">0</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ?Â keyComparator.compare(o1.maxKey(),Â o2.maxKey())
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â :Â leftResult<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â })<span class="hljs-comment">;</span>

Â Â Â Â Â Â Â Â forÂ (DataFileMetaÂ metaÂ :Â files)Â {
Â Â Â Â Â Â Â Â Â Â Â Â //Â å¦‚æœå½“å‰æ–‡ä»¶çš„Â minKeyÂ &gt;Â ä¸Šä¸€ä¸ªÂ sectionÂ çš„Â bound
Â Â Â Â Â Â Â Â Â Â Â Â //Â è¯´æ˜æ²¡æœ‰é‡å ï¼Œå¼€å§‹æ–°çš„Â section
Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (!section.isEmpty()Â &amp;&amp;Â keyComparator.compare(meta.minKey(),Â bound)Â &gt;Â 0)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â result.add(partition(section))<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â section.clear()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">bound</span>Â =Â null<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â section.add(meta)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â Â Â Â Â //Â æ›´æ–°Â boundÂ ä¸ºå½“å‰Â sectionÂ çš„æœ€å¤§Â maxKey
Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (<span class="hljs-attr">bound</span>Â ==Â nullÂ ||Â keyComparator.compare(meta.maxKey(),Â bound)Â &gt;Â <span class="hljs-number">0</span>)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">bound</span>Â =Â meta.maxKey()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â ifÂ (!section.isEmpty())Â {
Â Â Â Â Â Â Â Â Â Â Â Â result.add(partition(section))<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â returnÂ result<span class="hljs-comment">;</span>
Â Â Â Â }
}
</code></pre>
<h4 data-id="heading-27">5.7 Levels ç»“æ„ç»´æŠ¤</h4>
<p><strong>Levels ç±»ç®¡ç† LSM-Tree çš„å±‚çº§ç»“æ„</strong>ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/Levels.java:38-98</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">Levels</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">Comparator</span>&lt;<span class="hljs-type">InternalRow</span>&gt;Â keyComparator;
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">TreeSet</span>&lt;<span class="hljs-type">DataFileMeta</span>&gt;Â level0;Â Â <span class="hljs-comment">//Â LevelÂ 0Â æ–‡ä»¶ï¼ˆæŒ‰åºå·æ’åºï¼‰</span>
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">SortedRun</span>&gt;Â levels;Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â LevelÂ 1+Â æ–‡ä»¶</span>

Â Â Â Â <span class="hljs-keyword">public</span>Â voidÂ update(<span class="hljs-type">List</span>&lt;<span class="hljs-type">DataFileMeta</span>&gt;Â before,Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">DataFileMeta</span>&gt;Â after)Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æŒ‰Â LevelÂ åˆ†ç»„</span>
Â Â Â Â Â Â Â Â <span class="hljs-type">Map</span>&lt;<span class="hljs-type">Integer</span>,Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">DataFileMeta</span>&gt;&gt;Â groupedBeforeÂ <span class="hljs-operator">=</span>Â groupByLevel(before);
Â Â Â Â Â Â Â Â <span class="hljs-type">Map</span>&lt;<span class="hljs-type">Integer</span>,Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">DataFileMeta</span>&gt;&gt;Â groupedAfterÂ <span class="hljs-operator">=</span>Â groupByLevel(after);
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æ›´æ–°æ¯ä¸ªÂ Level</span>
Â Â Â Â Â Â Â Â <span class="hljs-keyword">for</span>Â (intÂ iÂ <span class="hljs-operator">=</span>Â <span class="hljs-number">0</span>;Â iÂ <span class="hljs-operator">&lt;</span>Â numberOfLevels();Â i<span class="hljs-operator">++</span>)Â {
Â Â Â Â Â Â Â Â Â Â Â Â updateLevel(i,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â groupedBefore.getOrDefault(i,Â emptyList()),
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â groupedAfter.getOrDefault(i,Â emptyList()));
Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â <span class="hljs-keyword">private</span>Â voidÂ updateLevel(intÂ level,Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">DataFileMeta</span>&gt;Â before,Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">DataFileMeta</span>&gt;Â after)Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (levelÂ <span class="hljs-operator">==</span>Â <span class="hljs-number">0</span>)Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â LevelÂ 0:Â ä»Â TreeSetÂ ä¸­ç§»é™¤æ—§æ–‡ä»¶ï¼Œæ·»åŠ æ–°æ–‡ä»¶</span>
Â Â Â Â Â Â Â Â Â Â Â Â before.forEach(level0::remove);
Â Â Â Â Â Â Â Â Â Â Â Â level0.addAll(after);
Â Â Â Â Â Â Â Â }Â <span class="hljs-keyword">else</span>Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â LevelÂ 1+:Â ä»Â SortedRunÂ ä¸­ç§»é™¤æ—§æ–‡ä»¶ï¼Œæ·»åŠ æ–°æ–‡ä»¶ï¼Œé‡æ–°æ’åº</span>
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-type">List</span>&lt;<span class="hljs-type">DataFileMeta</span>&gt;Â filesÂ <span class="hljs-operator">=</span>Â newÂ <span class="hljs-type">ArrayList</span>&lt;&gt;(runOfLevel(level).files());
Â Â Â Â Â Â Â Â Â Â Â Â files.removeAll(before);
Â Â Â Â Â Â Â Â Â Â Â Â files.addAll(after);
Â Â Â Â Â Â Â Â Â Â Â Â levels.set(levelÂ <span class="hljs-operator">-</span>Â <span class="hljs-number">1</span>,Â <span class="hljs-type">SortedRun</span>.fromUnsorted(files,Â keyComparator));
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}
</code></pre>
<hr/>
<h3 data-id="heading-28">å…­ã€UniversalCompaction ç­–ç•¥æ·±åº¦è§£æ</h3>
<h4 data-id="heading-29">6.1 ç­–ç•¥æ¦‚è¿°</h4>
<p><code>UniversalCompaction</code> æ˜¯ Paimon çš„æ ¸å¿ƒ Compact ç­–ç•¥ï¼Œæºè‡ª RocksDB çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Frocksdb%2Fwiki%2FUniversal-Compaction" target="_blank" title="https://github.com/facebook/rocksdb/wiki/Universal-Compaction" ref="nofollow noopener noreferrer">Universal Compaction</a>ã€‚</p>
<p><strong>è®¾è®¡ç›®æ ‡</strong>ï¼š</p>
<ul>
<li>é™ä½å†™æ”¾å¤§ï¼ˆWrite Amplificationï¼‰</li>
<li>æ§åˆ¶ç©ºé—´æ”¾å¤§ï¼ˆSpace Amplificationï¼‰</li>
<li>å¹³è¡¡è¯»æ”¾å¤§ï¼ˆRead Amplificationï¼‰</li>
</ul>
<h4 data-id="heading-30">6.2 ç­–ç•¥å‚æ•°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/compact/UniversalCompaction.java:42-64</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">UniversalCompaction</span>Â <span class="hljs-keyword">implements</span>Â <span class="hljs-title class_">CompactStrategy</span>Â {
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">int</span>Â maxSizeAmp;Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â æœ€å¤§ç©ºé—´æ”¾å¤§ç™¾åˆ†æ¯”</span>
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">int</span>Â sizeRatio;Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å¤§å°æ¯”ä¾‹é˜ˆå€¼</span>
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">int</span>Â numRunCompactionTrigger;Â <span class="hljs-comment">//Â è§¦å‘Â CompactÂ çš„Â RunÂ æ•°é‡</span>
Â Â Â Â 
Â Â Â Â <span class="hljs-meta">@Nullable</span>Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â FullCompactTriggerÂ fullCompactTrigger;
Â Â Â Â <span class="hljs-meta">@Nullable</span>Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â OffPeakHoursÂ offPeakHours;
}
</code></pre>
<p><strong>é…ç½®é¡¹å¯¹åº”</strong>ï¼š</p>





























<table><thead><tr><th>å‚æ•°</th><th>é…ç½®é”®</th><th>é»˜è®¤å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>maxSizeAmp</code></td><td><code>compaction.max-size-amplification-percent</code></td><td>200</td><td>æœ€å¤§ç©ºé—´æ”¾å¤§ç™¾åˆ†æ¯”</td></tr><tr><td><code>sizeRatio</code></td><td><code>compaction.size-ratio</code></td><td>1</td><td>å¤§å°æ¯”ä¾‹é˜ˆå€¼</td></tr><tr><td><code>numRunCompactionTrigger</code></td><td><code>num-sorted-run.compaction-trigger</code></td><td>5</td><td>è§¦å‘ Compact çš„ Run æ•°</td></tr></tbody></table>
<h4 data-id="heading-31">6.3 ç­–ç•¥å†³ç­–æµç¨‹</h4>
<p><strong>pick() æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/compact/UniversalCompaction.java:67-107</span>
<span class="hljs-keyword">@Override</span>
publicÂ Optional&lt;CompactUnit&gt;Â pick(intÂ numLevels,Â List&lt;LevelSortedRun&gt;Â runs)Â {
Â Â Â Â intÂ maxLevelÂ =Â numLevelsÂ -Â <span class="hljs-number">1</span>;

Â Â Â Â <span class="hljs-comment">//Â ã€ä¼˜å…ˆçº§0ã€‘å°è¯•å®šæ—¶å…¨é‡Â Compact</span>
Â Â Â Â ifÂ (fullCompactTriggerÂ !=Â null)Â {
Â Â Â Â Â Â Â Â Optional&lt;CompactUnit&gt;Â unitÂ =Â fullCompactTrigger<span class="hljs-selector-class">.tryFullCompact</span>(numLevels,Â runs);
Â Â Â Â Â Â Â Â ifÂ (unit.isPresent())Â {
Â Â Â Â Â Â Â Â Â Â Â Â returnÂ unit;
Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â <span class="hljs-comment">//Â ã€ä¼˜å…ˆçº§1ã€‘æ£€æŸ¥ç©ºé—´æ”¾å¤§</span>
Â Â Â Â CompactUnitÂ unitÂ =Â <span class="hljs-built_in">pickForSizeAmp</span>(maxLevel,Â runs);
Â Â Â Â ifÂ (unitÂ !=Â null)Â {
Â Â Â Â Â Â Â Â ifÂ (LOG.isDebugEnabled())Â {
Â Â Â Â Â Â Â Â Â Â Â Â LOG<span class="hljs-selector-class">.debug</span>("UniversalÂ compactionÂ dueÂ toÂ sizeÂ amplification");
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â returnÂ Optional<span class="hljs-selector-class">.of</span>(unit);
Â Â Â Â }

Â Â Â Â <span class="hljs-comment">//Â ã€ä¼˜å…ˆçº§2ã€‘æ£€æŸ¥å¤§å°æ¯”ä¾‹</span>
Â Â Â Â unitÂ =Â <span class="hljs-built_in">pickForSizeRatio</span>(maxLevel,Â runs);
Â Â Â Â ifÂ (unitÂ !=Â null)Â {
Â Â Â Â Â Â Â Â ifÂ (LOG.isDebugEnabled())Â {
Â Â Â Â Â Â Â Â Â Â Â Â LOG<span class="hljs-selector-class">.debug</span>("UniversalÂ compactionÂ dueÂ toÂ sizeÂ ratio");
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â returnÂ Optional<span class="hljs-selector-class">.of</span>(unit);
Â Â Â Â }

Â Â Â Â <span class="hljs-comment">//Â ã€ä¼˜å…ˆçº§3ã€‘æ£€æŸ¥æ–‡ä»¶æ•°é‡</span>
Â Â Â Â ifÂ (runs.size()Â &gt;Â numRunCompactionTrigger)Â {
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â è¶…è¿‡é˜ˆå€¼ï¼Œè§¦å‘Â Compact</span>
Â Â Â Â Â Â Â Â intÂ candidateCountÂ =Â runs<span class="hljs-selector-class">.size</span>()Â -Â numRunCompactionTriggerÂ +Â <span class="hljs-number">1</span>;
Â Â Â Â Â Â Â Â ifÂ (LOG.isDebugEnabled())Â {
Â Â Â Â Â Â Â Â Â Â Â Â LOG<span class="hljs-selector-class">.debug</span>("UniversalÂ compactionÂ dueÂ toÂ fileÂ num");
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â returnÂ Optional<span class="hljs-selector-class">.ofNullable</span>(pickForSizeRatio(maxLevel,Â runs,Â candidateCount));
Â Â Â Â }

Â Â Â Â returnÂ Optional<span class="hljs-selector-class">.empty</span>();
}
</code></pre>
<h4 data-id="heading-32">6.4 è¯¦ç»†ç­–ç•¥è¯´æ˜</h4>
<h5 data-id="heading-33">6.4.1 å®šæ—¶å…¨é‡ Compactï¼ˆFullCompactTriggerï¼‰</h5>
<p><strong>è§¦å‘æ¡ä»¶</strong>ï¼š</p>
<ol>
<li>è·ç¦»ä¸Šæ¬¡å…¨é‡ Compact çš„æ—¶é—´é—´éš”è¶…è¿‡ <code>compaction.optimization-interval</code></li>
<li>æ–‡ä»¶æ€»å¤§å°å°äº <code>compaction.total-size-threshold</code></li>
</ol>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/compact/FullCompactTrigger.java:64-88</span>
publicÂ Optional&lt;CompactUnit&gt;Â <span class="hljs-built_in">tryFullCompact</span>(intÂ numLevels,Â List&lt;LevelSortedRun&gt;Â runs)Â {
Â Â Â Â ifÂ (runs.size()Â ==Â <span class="hljs-number">1</span>)Â {
Â Â Â Â Â Â Â Â returnÂ Optional<span class="hljs-selector-class">.empty</span>();
Â Â Â Â }

Â Â Â Â intÂ maxLevelÂ =Â numLevelsÂ -Â <span class="hljs-number">1</span>;
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â æ¡ä»¶1:Â æ—¶é—´é—´éš”è§¦å‘</span>
Â Â Â Â ifÂ (fullCompactionIntervalÂ !=Â null)Â {
Â Â Â Â Â Â Â Â ifÂ (lastFullCompactionÂ ==Â null
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ||Â currentTimeMillis()Â -Â lastFullCompactionÂ &gt;Â fullCompactionInterval)Â {
Â Â Â Â Â Â Â Â Â Â Â Â LOG<span class="hljs-selector-class">.debug</span>("UniversalÂ compactionÂ dueÂ toÂ fullÂ compactionÂ interval");
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-built_in">updateLastFullCompaction</span>();
Â Â Â Â Â Â Â Â Â Â Â Â returnÂ Optional<span class="hljs-selector-class">.of</span>(CompactUnit.fromLevelRuns(maxLevel,Â runs));
Â Â Â Â Â Â Â Â }
Â Â Â Â }
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â æ¡ä»¶2:Â æ€»å¤§å°è§¦å‘</span>
Â Â Â Â ifÂ (totalSizeThresholdÂ !=Â null)Â {
Â Â Â Â Â Â Â Â longÂ totalSizeÂ =Â <span class="hljs-number">0</span>;
Â Â Â Â Â Â Â Â forÂ (LevelSortedRunÂ runÂ :Â runs)Â {
Â Â Â Â Â Â Â Â Â Â Â Â totalSizeÂ +=Â run<span class="hljs-selector-class">.run</span>()<span class="hljs-selector-class">.totalSize</span>();
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â ifÂ (totalSizeÂ &lt;Â totalSizeThreshold)Â {
Â Â Â Â Â Â Â Â Â Â Â Â returnÂ Optional<span class="hljs-selector-class">.of</span>(CompactUnit.fromLevelRuns(maxLevel,Â runs));
Â Â Â Â Â Â Â Â }
Â Â Â Â }
Â Â Â Â 
Â Â Â Â returnÂ Optional<span class="hljs-selector-class">.empty</span>();
}
</code></pre>
<p><strong>é…ç½®ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â my_tableÂ (...)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-string">'compaction.optimization-interval'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'1Â h'</span>,Â Â <span class="hljs-comment">--Â æ¯å°æ—¶å…¨é‡Â Compact</span>
Â Â Â Â <span class="hljs-string">'compaction.total-size-threshold'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'10Â GB'</span>Â Â <span class="hljs-comment">--Â æ€»å¤§å°å°äº10GBæ—¶å…¨é‡Â Compact</span>
);
</code></pre>
<h5 data-id="heading-34">6.4.2 ç©ºé—´æ”¾å¤§æ£€æŸ¥ï¼ˆpickForSizeAmpï¼‰</h5>
<p><strong>ç©ºé—´æ”¾å¤§å®šä¹‰</strong>ï¼šé¢å¤–ç©ºé—´å æ¯” = (æ‰€æœ‰æ–‡ä»¶å¤§å° - æœ€æ—©æ–‡ä»¶å¤§å°) / æœ€æ—©æ–‡ä»¶å¤§å° Ã— 100%</p>
<p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå½“ç©ºé—´æ”¾å¤§è¶…è¿‡ <code>maxSizeAmp</code> æ—¶ï¼Œè§¦å‘å…¨é‡ Compact</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/compact/UniversalCompaction.java:125-147</span>
CompactUnitÂ <span class="hljs-built_in">pickForSizeAmp</span>(intÂ maxLevel,Â List&lt;LevelSortedRun&gt;Â runs)Â {
Â Â Â Â ifÂ (runs.size()Â &lt;Â numRunCompactionTrigger)Â {
Â Â Â Â Â Â Â Â returnÂ null;
Â Â Â Â }

Â Â Â Â <span class="hljs-comment">//Â è®¡ç®—å€™é€‰æ–‡ä»¶æ€»å¤§å°ï¼ˆé™¤äº†æœ€æ—©çš„æ–‡ä»¶ï¼‰</span>
Â Â Â Â longÂ candidateSizeÂ =
Â Â Â Â Â Â Â Â Â Â Â Â runs<span class="hljs-selector-class">.subList</span>(<span class="hljs-number">0</span>,Â runs.size()Â -Â <span class="hljs-number">1</span>)<span class="hljs-selector-class">.stream</span>()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.map</span>(LevelSortedRun::run)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.mapToLong</span>(SortedRun::totalSize)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.sum</span>();

Â Â Â Â <span class="hljs-comment">//Â æœ€æ—©æ–‡ä»¶çš„å¤§å°</span>
Â Â Â Â longÂ earliestRunSizeÂ =Â runs<span class="hljs-selector-class">.get</span>(runs.size()Â -Â <span class="hljs-number">1</span>)<span class="hljs-selector-class">.run</span>()<span class="hljs-selector-class">.totalSize</span>();

Â Â Â Â <span class="hljs-comment">//Â ç©ºé—´æ”¾å¤§Â =Â candidateSizeÂ *Â 100Â /Â earliestRunSize</span>
Â Â Â Â ifÂ (candidateSizeÂ *Â <span class="hljs-number">100</span>Â &gt;Â maxSizeAmpÂ *Â earliestRunSize)Â {
Â Â Â Â Â Â Â Â ifÂ (fullCompactTriggerÂ !=Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â fullCompactTrigger<span class="hljs-selector-class">.updateLastFullCompaction</span>();
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â è§¦å‘å…¨é‡Â Compact</span>
Â Â Â Â Â Â Â Â returnÂ CompactUnit<span class="hljs-selector-class">.fromLevelRuns</span>(maxLevel,Â runs);
Â Â Â Â }

Â Â Â Â returnÂ null;
}
</code></pre>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<p>å‡è®¾ <code>maxSizeAmp = 200</code>ï¼Œæœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š</p>
<ul>
<li>Run 0: 10 MB</li>
<li>Run 1: 20 MB</li>
<li>Run 2: 30 MB</li>
<li>Run 3: 100 MB (æœ€æ—©)</li>
</ul>
<p>ç©ºé—´æ”¾å¤§ = (10 + 20 + 30) Ã— 100 / 100 = 60% &lt; 200%ï¼Œä¸è§¦å‘</p>
<p>å¦‚æœ Run 3 åªæœ‰ 20 MBï¼š ç©ºé—´æ”¾å¤§ = 60 Ã— 100 / 20 = 300% &gt; 200%ï¼Œè§¦å‘å…¨é‡ Compact</p>
<h5 data-id="heading-35">6.4.3 å¤§å°æ¯”ä¾‹æ£€æŸ¥ï¼ˆpickForSizeRatioï¼‰</h5>
<p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå½“è¾ƒå°çš„ Run çš„æ€»å¤§å°ä¸è¾ƒå¤§ Run çš„æ¯”ä¾‹è¶…è¿‡é˜ˆå€¼æ—¶ï¼Œè§¦å‘ Compact</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/compact/UniversalCompaction.java:163-182</span>
publicÂ CompactUnitÂ <span class="hljs-built_in">pickForSizeRatio</span>(
Â Â Â Â Â Â Â Â intÂ maxLevel,Â List&lt;LevelSortedRun&gt;Â runs,Â intÂ candidateCount,Â booleanÂ forcePick)Â {
Â Â Â Â longÂ candidateSizeÂ =Â <span class="hljs-built_in">candidateSize</span>(runs,Â candidateCount);
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â ä»Â candidateCountÂ å¼€å§‹ï¼Œå‘åæ‰©å±•</span>
Â Â Â Â forÂ (intÂ iÂ =Â candidateCount;Â iÂ &lt;Â runs.size();Â <span class="hljs-selector-tag">i</span>++)Â {
Â Â Â Â Â Â Â Â LevelSortedRunÂ nextÂ =Â runs<span class="hljs-selector-class">.get</span>(i);
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â è®¡ç®—æ¯”ä¾‹ï¼š(candidateSizeÂ *Â (100Â +Â sizeRatioÂ +Â offPeakRatio))Â /Â 100</span>
Â Â Â Â Â Â Â Â ifÂ (candidateSizeÂ *Â (<span class="hljs-number">100.0</span>Â +Â sizeRatioÂ +Â ratioForOffPeak())Â /Â <span class="hljs-number">100.0</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â &lt;Â next<span class="hljs-selector-class">.run</span>()<span class="hljs-selector-class">.totalSize</span>())Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â ä¸‹ä¸€ä¸ªæ–‡ä»¶å¤ªå¤§ï¼Œåœæ­¢æ‰©å±•</span>
Â Â Â Â Â Â Â Â Â Â Â Â break;
Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â ç»§ç»­åŒ…å«ä¸‹ä¸€ä¸ªæ–‡ä»¶</span>
Â Â Â Â Â Â Â Â candidateSizeÂ +=Â next<span class="hljs-selector-class">.run</span>()<span class="hljs-selector-class">.totalSize</span>();
Â Â Â Â Â Â Â Â candidateCount++;
Â Â Â Â }

Â Â Â Â ifÂ (forcePickÂ ||Â candidateCountÂ &gt;Â <span class="hljs-number">1</span>)Â {
Â Â Â Â Â Â Â Â returnÂ <span class="hljs-built_in">createUnit</span>(runs,Â maxLevel,Â candidateCount);
Â Â Â Â }

Â Â Â Â returnÂ null;
}
</code></pre>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<p>å‡è®¾ <code>sizeRatio = 1</code>ï¼ˆå³ 100%ï¼‰ï¼Œæœ‰ä»¥ä¸‹ Runsï¼š</p>
<ul>
<li>Run 0: 10 MB</li>
<li>Run 1: 15 MB</li>
<li>Run 2: 40 MB</li>
<li>Run 3: 100 MB</li>
</ul>
<p>ä» Run 0 å¼€å§‹ï¼š</p>
<ol>
<li>candidateSize = 10 MB</li>
<li>åˆ¤æ–­ï¼š10 Ã— (100 + 100) / 100 = 20 MB &lt; 15 MBï¼Ÿ<strong>å¦</strong>ï¼ŒåŒ…å« Run 1</li>
<li>candidateSize = 25 MB</li>
<li>åˆ¤æ–­ï¼š25 Ã— 200 / 100 = 50 MB &lt; 40 MBï¼Ÿ<strong>å¦</strong>ï¼ŒåŒ…å« Run 2</li>
<li>candidateSize = 65 MB</li>
<li>åˆ¤æ–­ï¼š65 Ã— 200 / 100 = 130 MB &lt; 100 MBï¼Ÿ<strong>å¦</strong>ï¼ŒåŒ…å« Run 3</li>
<li>candidateSize = 165 MB</li>
<li>æ²¡æœ‰æ›´å¤š Runï¼Œè¿”å›æ‰€æœ‰ 4 ä¸ª Runs çš„ CompactUnit</li>
</ol>
<h5 data-id="heading-36">6.4.4 æ–‡ä»¶æ•°é‡æ£€æŸ¥</h5>
<p><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå½“ Run æ•°é‡è¶…è¿‡ <code>numRunCompactionTrigger</code> æ—¶ï¼Œè§¦å‘ Compact</p>
<pre><code class="hljs language-ruby" lang="ruby">/<span class="hljs-regexp">/Â paimon-core/src</span><span class="hljs-regexp">/main/java</span><span class="hljs-regexp">/org/apache</span><span class="hljs-regexp">/paimon/mergetree</span><span class="hljs-regexp">/compact/</span><span class="hljs-title class_">UniversalCompaction</span>.<span class="hljs-symbol">java:</span><span class="hljs-number">96</span>-<span class="hljs-number">104</span>
<span class="hljs-keyword">if</span>Â (runs.size()Â &gt;Â numRunCompactionTrigger)Â {
Â Â Â Â <span class="hljs-regexp">//</span>Â è¶…è¿‡é˜ˆå€¼ï¼Œè§¦å‘Â <span class="hljs-title class_">Compact</span>
Â Â Â Â intÂ candidateCountÂ =Â runs.size()Â -Â numRunCompactionTriggerÂ +Â <span class="hljs-number">1</span>;
Â Â Â Â <span class="hljs-keyword">if</span>Â (<span class="hljs-variable constant_">LOG</span>.isDebugEnabled())Â {
Â Â Â Â Â Â Â Â <span class="hljs-variable constant_">LOG</span>.debug(<span class="hljs-string">"UniversalÂ compactionÂ dueÂ toÂ fileÂ num"</span>);
Â Â Â Â }
Â Â Â Â <span class="hljs-keyword">return</span>Â <span class="hljs-title class_">Optional</span>.ofNullable(pickForSizeRatio(maxLevel,Â runs,Â candidateCount));
}
</code></pre>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<p>å‡è®¾ <code>numRunCompactionTrigger = 5</code>ï¼Œå½“å‰æœ‰ 8 ä¸ª Runsï¼š</p>
<ul>
<li>candidateCount = 8 - 5 + 1 = 4</li>
<li>è°ƒç”¨ <code>pickForSizeRatio(maxLevel, runs, 4)</code> é€‰æ‹©è‡³å°‘ 4 ä¸ª Runs è¿›è¡Œ Compact</li>
</ul>
<h4 data-id="heading-37">6.5 è¾“å‡º Level çš„ç¡®å®š</h4>
<p><strong>createUnit() æ–¹æ³•</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">//Â paimon-core/src/main/java/org/apache/paimon/mergetree/compact/UniversalCompaction.java:197-226
CompactUnitÂ createUnit(List&lt;LevelSortedRun&gt;Â runs,Â intÂ maxLevel,Â intÂ runCount)Â {
Â Â Â Â intÂ outputLevel<span class="hljs-comment">;</span>
Â Â Â Â 
Â Â Â Â ifÂ (<span class="hljs-attr">runCount</span>Â ==Â runs.size())Â {
Â Â Â Â Â Â Â Â //Â åˆå¹¶æ‰€æœ‰Â Runsï¼Œè¾“å‡ºåˆ°æœ€é«˜å±‚
Â Â Â Â Â Â Â Â <span class="hljs-attr">outputLevel</span>Â =Â maxLevel<span class="hljs-comment">;</span>
Â Â Â Â }Â elseÂ {
Â Â Â Â Â Â Â Â //Â è¾“å‡ºåˆ°ä¸‹ä¸€ä¸ªÂ RunÂ çš„Â levelÂ -Â 1
Â Â Â Â Â Â Â Â <span class="hljs-attr">outputLevel</span>Â =Â Math.max(<span class="hljs-number">0</span>,Â runs.get(runCount).level()Â -Â <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â ifÂ (<span class="hljs-attr">outputLevel</span>Â ==Â <span class="hljs-number">0</span>)Â {
Â Â Â Â Â Â Â Â //Â ä¸è¾“å‡ºåˆ°Â LevelÂ 0ï¼Œå‘åæ‰©å±•
Â Â Â Â Â Â Â Â forÂ (intÂ <span class="hljs-attr">i</span>Â =Â runCount<span class="hljs-comment">;Â iÂ &lt;Â runs.size();Â i++)Â {</span>
Â Â Â Â Â Â Â Â Â Â Â Â LevelSortedRunÂ <span class="hljs-attr">next</span>Â =Â runs.get(i)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â runCount++<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â ifÂ (next.level()Â !=Â 0)Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-attr">outputLevel</span>Â =Â next.level()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â break<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }
Â Â Â Â }

Â Â Â Â ifÂ (<span class="hljs-attr">runCount</span>Â ==Â runs.size())Â {
Â Â Â Â Â Â Â Â ifÂ (fullCompactTriggerÂ !=Â null)Â {
Â Â Â Â Â Â Â Â Â Â Â Â fullCompactTrigger.updateLastFullCompaction()<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â <span class="hljs-attr">outputLevel</span>Â =Â maxLevel<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â returnÂ CompactUnit.fromLevelRuns(outputLevel,Â runs.subList(0,Â runCount))<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-38">6.6 Off-Peak Hours ä¼˜åŒ–</h4>
<p><strong>å®šä¹‰</strong>ï¼šåœ¨éé«˜å³°æ—¶æ®µä½¿ç”¨æ›´æ¿€è¿›çš„ Compact ç­–ç•¥</p>
<pre><code class="hljs language-css" lang="css">//Â paimon-core/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/java/org/apache/paimon/mergetree/compact/UniversalCompaction<span class="hljs-selector-class">.java</span>:<span class="hljs-number">184</span>-<span class="hljs-number">186</span>
privateÂ intÂ <span class="hljs-built_in">ratioForOffPeak</span>()Â {
Â Â Â Â returnÂ offPeakHoursÂ ==Â nullÂ ?Â <span class="hljs-number">0</span>Â :Â offPeakHours.<span class="hljs-built_in">currentRatio</span>(LocalDateTime.<span class="hljs-built_in">now</span>().<span class="hljs-built_in">getHour</span>());
}
</code></pre>
<p><strong>é…ç½®ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â my_tableÂ (...)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-string">'compaction.offpeak.start.hour'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'2'</span>,Â Â Â <span class="hljs-comment">--Â å‡Œæ™¨2ç‚¹å¼€å§‹</span>
Â Â Â Â <span class="hljs-string">'compaction.offpeak.end.hour'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'6'</span>,Â Â Â Â Â <span class="hljs-comment">--Â æ—©ä¸Š6ç‚¹ç»“æŸ</span>
Â Â Â Â <span class="hljs-string">'compaction.offpeak-ratio'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'20'</span>Â Â Â Â Â Â Â Â <span class="hljs-comment">--Â éé«˜å³°æœŸä½¿ç”¨20%çš„æ¯”ä¾‹</span>
);
</code></pre>
<p>åœ¨éé«˜å³°æ—¶æ®µï¼ˆ2:00-6:00ï¼‰ï¼Œ<code>sizeRatio</code> ä¼šåŠ ä¸Š <code>offpeak-ratio</code>ï¼Œä½¿ Compact æ›´å®¹æ˜“è§¦å‘ã€‚</p>
<hr/>
<h3 data-id="heading-39">ä¸ƒã€å®šæ—¶è°ƒåº¦æœºåˆ¶å®ç°</h3>
<h4 data-id="heading-40">7.1 Flink æµå¼ Compact ä½œä¸šæ¶æ„</h4>
<pre><code class="hljs language-css" lang="css">graph LR
    subgraph AppendTable<span class="hljs-selector-attr">[Appendè¡¨Compact]</span>
        AT1<span class="hljs-selector-attr">[å®šæ—¶å™¨]</span> --&gt; AT2<span class="hljs-selector-attr">[AppendBypassCoordinateOperator]</span>
        AT2 --&gt; AT3<span class="hljs-selector-attr">[ç”ŸæˆCompactTask]</span>
        AT3 --&gt; AT4<span class="hljs-selector-attr">[ä¸‹æ¸¸æ‰§è¡Œå™¨]</span>
    end
    
    subgraph PrimaryKeyTable<span class="hljs-selector-attr">[ä¸»é”®è¡¨Compact]</span>
        PT1<span class="hljs-selector-attr">[CompactorSource]</span> --&gt; PT2<span class="hljs-selector-attr">[å®šæ—¶æ‰«æ]</span>
        PT2 --&gt; PT3<span class="hljs-selector-attr">[å‘ç°éœ€è¦Compactçš„Bucket]</span>
        PT3 --&gt; PT4<span class="hljs-selector-attr">[StoreCompactOperator]</span>
        PT4 --&gt; PT5<span class="hljs-selector-attr">[æ‰§è¡ŒCompact]</span>
    end
</code></pre>
<h4 data-id="heading-41">7.2 Append è¡¨å®šæ—¶è°ƒåº¦</h4>
<h5 data-id="heading-42">7.2.1 AppendBypassCoordinateOperator</h5>
<p><strong>æ ¸å¿ƒç±»</strong>ï¼š<code>AppendBypassCoordinateOperator</code> æ˜¯ Flink çš„ä¸€ä¸ª <code>OneInputStreamOperator</code>ï¼Œè´Ÿè´£å®šæ—¶ç”Ÿæˆ Compact ä»»åŠ¡ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//Â paimon-flink/paimon-flink-common/src/main/java/org/apache/paimon/flink/source/AppendBypassCoordinateOperator.java:49-86</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">class</span>Â <span class="hljs-title class_">AppendBypassCoordinateOperator</span>&lt;CommitT&gt;
Â Â Â Â Â Â Â Â <span class="hljs-keyword">extends</span>Â <span class="hljs-title class_">AbstractStreamOperator</span>&lt;Either&lt;CommitT,Â AppendCompactTask&gt;&gt;
Â Â Â Â Â Â Â Â <span class="hljs-keyword">implements</span>Â <span class="hljs-title class_">OneInputStreamOperator</span>&lt;CommitT,Â Either&lt;CommitT,Â AppendCompactTask&gt;&gt;,
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ProcessingTimeCallbackÂ {

Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">static</span>Â <span class="hljs-keyword">final</span>Â <span class="hljs-type">long</span>Â <span class="hljs-variable">MAX_PENDING_TASKS</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-number">5000</span>;

Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">final</span>Â FileStoreTableÂ table;
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">transient</span>Â ScheduledExecutorServiceÂ executorService;
Â Â Â Â <span class="hljs-keyword">private</span>Â <span class="hljs-keyword">transient</span>Â LinkedBlockingQueue&lt;AppendCompactTask&gt;Â compactTasks;

Â Â Â Â <span class="hljs-meta">@Override</span>
Â Â Â Â <span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">open</span><span class="hljs-params">()</span>Â <span class="hljs-keyword">throws</span>Â ExceptionÂ {
Â Â Â Â Â Â Â Â <span class="hljs-built_in">super</span>.open();
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â è·å–æ‰«æé—´éš”</span>
Â Â Â Â Â Â Â Â <span class="hljs-type">long</span>Â <span class="hljs-variable">intervalMs</span>Â <span class="hljs-operator">=</span>Â table.coreOptions().continuousDiscoveryInterval().toMillis();
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â åˆå§‹åŒ–ä»»åŠ¡é˜Ÿåˆ—</span>
Â Â Â Â Â Â Â Â <span class="hljs-built_in">this</span>.compactTasksÂ =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;();
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â åˆ›å»ºåè°ƒå™¨</span>
Â Â Â Â Â Â Â Â <span class="hljs-type">AppendCompactCoordinator</span>Â <span class="hljs-variable">coordinator</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">AppendCompactCoordinator</span>(table,Â <span class="hljs-literal">true</span>,Â <span class="hljs-literal">null</span>);
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â åˆ›å»ºå®šæ—¶æ‰§è¡Œå™¨</span>
Â Â Â Â Â Â Â Â <span class="hljs-built_in">this</span>.executorServiceÂ =
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Executors.newSingleThreadScheduledExecutor(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â newDaemonThreadFactory(<span class="hljs-string">"CompactionÂ Coordinator"</span>));
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å®šæ—¶å¼‚æ­¥ç”Ÿæˆä»»åŠ¡</span>
Â Â Â Â Â Â Â Â <span class="hljs-built_in">this</span>.executorService.scheduleWithFixedDelay(
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ()Â -&gt;Â asyncPlan(coordinator),Â <span class="hljs-number">0</span>,Â intervalMs,Â TimeUnit.MILLISECONDS);
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â <span class="hljs-comment">//Â å®šæ—¶å‘é€ä»»åŠ¡åˆ°ä¸‹æ¸¸</span>
Â Â Â Â Â Â Â Â <span class="hljs-built_in">this</span>.getProcessingTimeService().scheduleWithFixedDelay(<span class="hljs-built_in">this</span>,Â <span class="hljs-number">0</span>,Â intervalMs);
Â Â Â Â }
}
</code></pre>
<p><strong>å¼‚æ­¥ç”Ÿæˆä»»åŠ¡</strong>ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">//Â paimon-flink/paimon-flink-common/src/main/java/org/apache/paimon/flink/source/AppendBypassCoordinateOperator.java:88-102</span>
<span class="hljs-keyword">private</span>Â voidÂ asyncPlan(AppendCompactCoordinatorÂ coordinator)Â {
Â Â Â Â <span class="hljs-comment">//Â æŒç»­ç”Ÿæˆä»»åŠ¡ï¼Œç›´åˆ°é˜Ÿåˆ—æ»¡æˆ–æ²¡æœ‰æ–°ä»»åŠ¡</span>
Â Â Â Â <span class="hljs-keyword">while</span>Â (compactTasks.size()Â &lt;Â MAX_PENDING_TASKS)Â {
Â Â Â Â Â Â Â Â <span class="hljs-keyword">try</span>Â {
Â Â Â Â Â Â Â Â Â Â Â Â List&lt;AppendCompactTask&gt;Â tasksÂ =Â coordinator.run();
Â Â Â Â Â Â Â Â Â Â Â Â compactTasks.addAll(tasks);
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (tasks.isEmpty())Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">break</span>;
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â }Â <span class="hljs-keyword">catch</span>Â (ThrowableÂ t)Â {
Â Â Â Â Â Â Â Â Â Â Â Â LOG.error(<span class="hljs-string">"FatalÂ exceptionÂ happenedÂ whenÂ generatingÂ compactionÂ tasks."</span>,Â t);
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">this</span>.throwableÂ =Â t;
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">break</span>;
Â Â Â Â Â Â Â Â }
Â Â Â Â }
}
</code></pre>
<p><strong>å‘é€ä»»åŠ¡åˆ°ä¸‹æ¸¸</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//Â paimon-flink/paimon-flink-common/src/main/java/org/apache/paimon/flink/source/AppendBypassCoordinateOperator.java:104-113</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">void</span>Â <span class="hljs-title function_">onProcessingTime</span><span class="hljs-params">(<span class="hljs-type">long</span>Â time)</span>Â {
Â Â Â Â <span class="hljs-comment">//Â ä»é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡ï¼Œå‘é€åˆ°ä¸‹æ¸¸</span>
Â Â Â Â <span class="hljs-keyword">while</span>Â (<span class="hljs-literal">true</span>)Â {
Â Â Â Â Â Â Â Â <span class="hljs-type">AppendCompactTask</span>Â <span class="hljs-variable">task</span>Â <span class="hljs-operator">=</span>Â compactTasks.poll();
Â Â Â Â Â Â Â Â <span class="hljs-keyword">if</span>Â (taskÂ ==Â <span class="hljs-literal">null</span>)Â {
Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-keyword">return</span>;
Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â output.collect(<span class="hljs-keyword">new</span>Â <span class="hljs-title class_">StreamRecord</span>&lt;&gt;(Either.Right(task)));
Â Â Â Â }
}
</code></pre>
<h5 data-id="heading-43">7.2.2 Flink Job æ„å»º</h5>
<p><strong>AppendTableCompact ç±»</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">//Â paimon-flink/paimon-flink-common/src/main/java/org/apache/paimon/flink/compact/AppendTableCompact.java:87-128</span>
publicÂ voidÂ <span class="hljs-built_in">build</span>()Â {
Â Â Â Â <span class="hljs-comment">//Â æ„å»ºÂ Source</span>
Â Â Â Â DataStreamSource&lt;AppendCompactTask&gt;Â sourceÂ =Â <span class="hljs-built_in">buildSource</span>();
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â å¦‚æœé…ç½®äº†åˆ†åŒºç©ºé—²æ—¶é—´ï¼Œè¿‡æ»¤ä»»åŠ¡</span>
Â Â Â Â ifÂ (!isContinuousÂ &amp;&amp;Â partitionIdleTimeÂ !=Â null)Â {
Â Â Â Â Â Â Â Â Map&lt;BinaryRow,Â Long&gt;Â partitionInfoÂ =Â <span class="hljs-built_in">getPartitionInfo</span>(table);
Â Â Â Â Â Â Â Â longÂ historyMilliÂ =
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â LocalDateTime<span class="hljs-selector-class">.now</span>()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.minus</span>(partitionIdleTime)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.atZone</span>(ZoneId.systemDefault())
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.toInstant</span>()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span class="hljs-selector-class">.toEpochMilli</span>();
Â Â Â Â Â Â Â Â 
Â Â Â Â Â Â Â Â SingleOutputStreamOperator&lt;AppendCompactTask&gt;Â filterStreamÂ =
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â source<span class="hljs-selector-class">.filter</span>(taskÂ -&gt;Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â BinaryRowÂ partitionÂ =Â task.partition();
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â returnÂ partitionInfo<span class="hljs-selector-class">.get</span>(partition)Â &lt;=Â historyMilli;
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â });
Â Â Â Â Â Â Â Â sourceÂ =Â newÂ DataStreamSource&lt;&gt;(filterStream);
Â Â Â Â }

Â Â Â Â <span class="hljs-comment">//Â æ„å»ºå®Œæ•´çš„Â FlinkÂ ä½œä¸š</span>
Â Â Â Â <span class="hljs-built_in">sinkFromSource</span>(source);
}

privateÂ DataStreamSource&lt;AppendCompactTask&gt;Â <span class="hljs-built_in">buildSource</span>()Â {
Â Â Â Â <span class="hljs-comment">//Â è·å–æ‰«æé—´éš”</span>
Â Â Â Â longÂ scanIntervalÂ =Â <span class="hljs-selector-tag">table</span><span class="hljs-selector-class">.coreOptions</span>()<span class="hljs-selector-class">.continuousDiscoveryInterval</span>()<span class="hljs-selector-class">.toMillis</span>();
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">//Â åˆ›å»ºÂ Source</span>
Â Â Â Â AppendTableCompactSourceÂ sourceÂ =
Â Â Â Â Â Â Â Â Â Â Â Â newÂ <span class="hljs-built_in">AppendTableCompactSource</span>(table,Â isContinuous,Â scanInterval,Â partitionPredicate);

Â Â Â Â returnÂ AppendTableCompactSource<span class="hljs-selector-class">.buildSource</span>(env,Â source,Â tableIdentifier);
}
</code></pre>
<h4 data-id="heading-44">7.3 ä¸»é”®è¡¨å®šæ—¶è°ƒåº¦</h4>
<h5 data-id="heading-45">7.3.1 CompactorSource</h5>
<p><strong>æ ¸å¿ƒç±»</strong>ï¼š<code>CompactorSource</code> å®šæ—¶æ‰«æè¡¨å¿«ç…§ï¼Œå‘ç°éœ€è¦ Compact çš„ Bucketã€‚</p>
<p><strong>å·¥ä½œæµç¨‹</strong>ï¼š</p>
<ol>
<li>å®šæ—¶æ‰«æè¡¨å¿«ç…§ï¼ˆé—´éš”ç”± <code>continuous.discovery-interval</code> æ§åˆ¶ï¼‰</li>
<li>æ¯”è¾ƒå½“å‰å¿«ç…§ä¸ä¸Šæ¬¡å¿«ç…§ï¼Œå‘ç°æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶</li>
<li>æ‰¾å‡ºéœ€è¦ Compact çš„ partition-bucket ç»„åˆ</li>
<li>ç”Ÿæˆ Compact è®°å½•å‘é€åˆ°ä¸‹æ¸¸</li>
</ol>
<p><strong>å…³é”®é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">//Â paimon-api/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/java/org/apache/paimon/CoreOptions<span class="hljs-selector-class">.java</span>:<span class="hljs-number">464</span>-<span class="hljs-number">468</span>
publicÂ staticÂ finalÂ ConfigOption&lt;Duration&gt;Â CONTINUOUS_DISCOVERY_INTERVALÂ =
Â Â Â Â Â Â Â Â <span class="hljs-built_in">key</span>(<span class="hljs-string">"continuous.discovery-interval"</span>)
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .<span class="hljs-built_in">durationType</span>()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .<span class="hljs-built_in">defaultValue</span>(Duration.<span class="hljs-built_in">ofSeconds</span>(<span class="hljs-number">10</span>))
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .<span class="hljs-built_in">withDescription</span>(<span class="hljs-string">"TheÂ discoveryÂ intervalÂ ofÂ continuousÂ reading."</span>);
</code></pre>
<h5 data-id="heading-46">7.3.2 StoreCompactOperator</h5>
<p><strong>æ ¸å¿ƒç±»</strong>ï¼š<code>StoreCompactOperator</code> æ¥æ”¶ Compact ä»»åŠ¡å¹¶æ‰§è¡Œã€‚</p>
<pre><code class="hljs language-ini" lang="ini">//Â paimon-flink/paimon-flink-common/src/main/java/org/apache/paimon/flink/sink/StoreCompactOperator.java:133-180
@Override
publicÂ voidÂ processElement(StreamRecord&lt;RowData&gt;Â element)Â throwsÂ ExceptionÂ {
Â Â Â Â RowDataÂ <span class="hljs-attr">record</span>Â =Â element.getValue()<span class="hljs-comment">;</span>

Â Â Â Â longÂ <span class="hljs-attr">snapshotId</span>Â =Â record.getLong(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
Â Â Â Â BinaryRowÂ <span class="hljs-attr">partition</span>Â =Â deserializeBinaryRow(record.getBinary(<span class="hljs-number">1</span>))<span class="hljs-comment">;</span>
Â Â Â Â intÂ <span class="hljs-attr">bucket</span>Â =Â record.getInt(<span class="hljs-number">2</span>)<span class="hljs-comment">;</span>
Â Â Â Â byte<span class="hljs-section">[]</span>Â <span class="hljs-attr">serializedFiles</span>Â =Â record.getBinary(<span class="hljs-number">3</span>)<span class="hljs-comment">;</span>
Â Â Â Â List&lt;DataFileMeta&gt;Â <span class="hljs-attr">files</span>Â =Â dataFileMetaSerializer.deserializeList(serializedFiles)<span class="hljs-comment">;</span>

Â Â Â Â ifÂ (write.streamingMode())Â {
Â Â Â Â Â Â Â Â //Â æµå¼æ¨¡å¼ï¼šé€šçŸ¥æ–°æ–‡ä»¶
Â Â Â Â Â Â Â Â write.notifyNewFiles(snapshotId,Â partition,Â bucket,Â files)<span class="hljs-comment">;</span>
Â Â Â Â }

Â Â Â Â //Â è®°å½•éœ€è¦Â CompactÂ çš„Â partition-bucket
Â Â Â Â waitToCompact.add(Pair.of(partition,Â bucket))<span class="hljs-comment">;</span>
}

@Override
protectedÂ List&lt;Committable&gt;Â prepareCommit(booleanÂ waitCompaction,Â longÂ checkpointId)
Â Â Â Â Â Â Â Â throwsÂ IOExceptionÂ {
Â Â Â Â tryÂ {
Â Â Â Â Â Â Â Â //Â æ‰§è¡Œæ‰€æœ‰å¾…Â CompactÂ çš„Â partition-bucket
Â Â Â Â Â Â Â Â forÂ (Pair&lt;BinaryRow,Â Integer&gt;Â partitionBucketÂ :Â waitToCompact)Â {
Â Â Â Â Â Â Â Â Â Â Â Â write.compact(partitionBucket.getKey(),Â partitionBucket.getRight(),Â fullCompaction)<span class="hljs-comment">;</span>
Â Â Â Â Â Â Â Â }
Â Â Â Â }Â catchÂ (ExceptionÂ e)Â {
Â Â Â Â Â Â Â Â throwÂ newÂ RuntimeException("ExceptionÂ happensÂ whileÂ executingÂ compaction.",Â e)<span class="hljs-comment">;</span>
Â Â Â Â }
Â Â Â Â waitToCompact.clear()<span class="hljs-comment">;</span>

Â Â Â Â //Â å‡†å¤‡æäº¤
Â Â Â Â List&lt;Committable&gt;Â <span class="hljs-attr">committables</span>Â =Â write.prepareCommit(waitCompaction,Â checkpointId)<span class="hljs-comment">;</span>
Â Â Â Â returnÂ committables<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-47">7.4 è°ƒåº¦æµç¨‹å›¾</h4>
<pre><code class="hljs language-rust" lang="rust">sequenceDiagram
    participant Timer <span class="hljs-keyword">as</span> å®šæ—¶å™¨
    participant Source <span class="hljs-keyword">as</span> CompactorSource
    participant Enum <span class="hljs-keyword">as</span> Enumerator
    participant Op <span class="hljs-keyword">as</span> StoreCompactOperator
    participant CM <span class="hljs-keyword">as</span> CompactManager
    participant Exec <span class="hljs-keyword">as</span> CompactExecutor
    participant Commit <span class="hljs-keyword">as</span> Committer

    Timer<span class="hljs-punctuation">-&gt;</span>&gt;Source: è§¦å‘æ‰«æ(æ¯<span class="hljs-number">10</span>ç§’)
    Source<span class="hljs-punctuation">-&gt;</span>&gt;Enum: <span class="hljs-title function_ invoke__">discoverSplits</span>()
    Enum<span class="hljs-punctuation">-&gt;</span>&gt;Enum: æ‰«æå¿«ç…§ï¼Œå‘ç°æ–°æ–‡ä»¶
    Enum<span class="hljs-punctuation">-&gt;</span>&gt;Source: è¿”å› CompactTask
    Source<span class="hljs-punctuation">-&gt;</span>&gt;Op: å‘é€è®°å½•
    Op<span class="hljs-punctuation">-&gt;</span>&gt;CM: write.<span class="hljs-title function_ invoke__">compact</span>(partition, bucket)
    CM<span class="hljs-punctuation">-&gt;</span>&gt;CM: <span class="hljs-title function_ invoke__">triggerCompaction</span>()
    CM<span class="hljs-punctuation">-&gt;</span>&gt;Exec: æäº¤å¼‚æ­¥ä»»åŠ¡
    Exec<span class="hljs-punctuation">-&gt;</span>&gt;Exec: æ‰§è¡Œæ–‡ä»¶åˆå¹¶
    Exec-<span class="hljs-punctuation">-&gt;</span>&gt;CM: è¿”å› CompactResult
    CM<span class="hljs-punctuation">-&gt;</span>&gt;Op: æ›´æ–° Levels
    Op<span class="hljs-punctuation">-&gt;</span>&gt;Commit: <span class="hljs-title function_ invoke__">prepareCommit</span>()
    Commit<span class="hljs-punctuation">-&gt;</span>&gt;Commit: æäº¤æ–°å¿«ç…§
</code></pre>
<hr/>
<h3 data-id="heading-48">å…«ã€å…³é”®é…ç½®é¡¹è¯¦è§£</h3>
<h4 data-id="heading-49">8.1 å®šæ—¶è°ƒåº¦é…ç½®</h4>

















<table><thead><tr><th>é…ç½®é¡¹</th><th>é»˜è®¤å€¼</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>continuous.discovery-interval</code></td><td>10s</td><td>Duration</td><td>Compact ä»»åŠ¡çš„æ‰«æé—´éš”ï¼Œæ§åˆ¶å¤šä¹…æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦æœ‰æ–°æ–‡ä»¶éœ€è¦ Compact</td></tr></tbody></table>
<p><strong>è°ƒä¼˜å»ºè®®</strong>ï¼š</p>
<ul>
<li>é«˜é¢‘å†™å…¥åœºæ™¯ï¼šç¼©çŸ­é—´éš”ï¼ˆå¦‚ 5sï¼‰ï¼ŒåŠæ—¶å‘ç°éœ€è¦ Compact çš„æ–‡ä»¶</li>
<li>ä½é¢‘å†™å…¥åœºæ™¯ï¼šå»¶é•¿é—´éš”ï¼ˆå¦‚ 30s-1minï¼‰ï¼Œå‡å°‘ä¸å¿…è¦çš„æ‰«æå¼€é”€</li>
</ul>
<h4 data-id="heading-50">8.2 Compact ç­–ç•¥é…ç½®</h4>















































<table><thead><tr><th>é…ç½®é¡¹</th><th>é»˜è®¤å€¼</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>num-sorted-run.compaction-trigger</code></td><td>5</td><td>Integer</td><td>è§¦å‘ Compact çš„ Run æ•°é‡é˜ˆå€¼</td></tr><tr><td><code>num-sorted-run.stop-trigger</code></td><td>Integer.MAX_VALUE</td><td>Integer</td><td>é˜»å¡å†™å…¥ç­‰å¾… Compact çš„ Run æ•°é‡é˜ˆå€¼</td></tr><tr><td><code>compaction.max-size-amplification-percent</code></td><td>200</td><td>Integer</td><td>æœ€å¤§ç©ºé—´æ”¾å¤§ç™¾åˆ†æ¯”ï¼Œè¶…è¿‡æ­¤å€¼è§¦å‘å…¨é‡ Compact</td></tr><tr><td><code>compaction.size-ratio</code></td><td>1</td><td>Integer</td><td>å¤§å°æ¯”ä¾‹é˜ˆå€¼ï¼Œæ§åˆ¶æ˜¯å¦åˆå¹¶ç›¸é‚»çš„ Runs</td></tr><tr><td><code>compaction.optimization-interval</code></td><td>æ— </td><td>Duration</td><td>å®šæ—¶å…¨é‡ Compact é—´éš”</td></tr><tr><td><code>compaction.total-size-threshold</code></td><td>æ— </td><td>MemorySize</td><td>è§¦å‘å…¨é‡ Compact çš„æ€»æ–‡ä»¶å¤§å°é˜ˆå€¼</td></tr></tbody></table>
<p><strong>è°ƒä¼˜å»ºè®®</strong>ï¼š</p>
<p><strong>1. æ§åˆ¶æ–‡ä»¶æ•°é‡</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--Â æ›´æ¿€è¿›çš„Â Compactï¼šRunÂ æ•°é‡è¾¾åˆ°Â 3Â å°±è§¦å‘</span>
<span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â my_tableÂ (...)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-string">'num-sorted-run.compaction-trigger'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'3'</span>
);
</code></pre>
<p><strong>2. æ§åˆ¶ç©ºé—´æ”¾å¤§</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--Â æ›´ä¸¥æ ¼çš„ç©ºé—´æ§åˆ¶ï¼š100%Â ç©ºé—´æ”¾å¤§å°±è§¦å‘</span>
<span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â my_tableÂ (...)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-string">'compaction.max-size-amplification-percent'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'100'</span>
);
</code></pre>
<p><strong>3. å®šæ—¶å…¨é‡ Compact</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--Â æ¯å¤©å‡Œæ™¨2ç‚¹æ‰§è¡Œå…¨é‡Â Compact</span>
<span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â my_tableÂ (...)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-string">'compaction.optimization-interval'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'24Â h'</span>
);
</code></pre>
<h4 data-id="heading-51">8.3 æ–‡ä»¶å¤§å°é…ç½®</h4>





























<table><thead><tr><th>é…ç½®é¡¹</th><th>é»˜è®¤å€¼</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>target-file-size</code></td><td>128 MB</td><td>MemorySize</td><td>ç›®æ ‡æ–‡ä»¶å¤§å°ï¼ŒCompact åçš„æ–‡ä»¶å°½é‡æ¥è¿‘æ­¤å¤§å°</td></tr><tr><td><code>compaction.file-size</code></td><td>target-file-size</td><td>MemorySize</td><td>è§¦å‘ Compact çš„æ–‡ä»¶å¤§å°é˜ˆå€¼ï¼Œå°äºæ­¤å€¼çš„æ–‡ä»¶ä¼šè¢«åˆå¹¶</td></tr><tr><td><code>compaction.min.file-num</code></td><td>5</td><td>Integer</td><td>Append è¡¨è§¦å‘ Compact çš„æœ€å°æ–‡ä»¶æ•°</td></tr></tbody></table>
<p><strong>è°ƒä¼˜å»ºè®®</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--Â å°è¡¨åœºæ™¯ï¼šå‡å°æ–‡ä»¶å¤§å°ï¼ŒåŠ å¿«Â Compact</span>
<span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â small_tableÂ (...)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-string">'target-file-size'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'64Â MB'</span>,
Â Â Â Â <span class="hljs-string">'compaction.min.file-num'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'3'</span>
);

<span class="hljs-comment">--Â å¤§è¡¨åœºæ™¯ï¼šå¢å¤§æ–‡ä»¶å¤§å°ï¼Œå‡å°‘æ–‡ä»¶æ•°é‡</span>
<span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â large_tableÂ (...)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-string">'target-file-size'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'256Â MB'</span>,
Â Â Â Â <span class="hljs-string">'compaction.min.file-num'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'10'</span>
);
</code></pre>
<h4 data-id="heading-52">8.4 Off-Peak Hours é…ç½®</h4>





























<table><thead><tr><th>é…ç½®é¡¹</th><th>é»˜è®¤å€¼</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>compaction.offpeak.start.hour</code></td><td>-1</td><td>Integer</td><td>éé«˜å³°æ—¶æ®µå¼€å§‹æ—¶é—´ï¼ˆå°æ—¶ï¼Œ0-23ï¼‰ï¼Œ-1 è¡¨ç¤ºç¦ç”¨</td></tr><tr><td><code>compaction.offpeak.end.hour</code></td><td>-1</td><td>Integer</td><td>éé«˜å³°æ—¶æ®µç»“æŸæ—¶é—´ï¼ˆå°æ—¶ï¼Œ0-23ï¼‰ï¼Œ-1 è¡¨ç¤ºç¦ç”¨</td></tr><tr><td><code>compaction.offpeak-ratio</code></td><td>0</td><td>Integer</td><td>éé«˜å³°æ—¶æ®µçš„é¢å¤– Compact æ¯”ä¾‹</td></tr></tbody></table>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">--Â å‡Œæ™¨2ç‚¹åˆ°6ç‚¹ä½¿ç”¨æ›´æ¿€è¿›çš„Â CompactÂ ç­–ç•¥
CREATEÂ TABLEÂ my_tableÂ (...)Â WITHÂ (
Â Â Â Â <span class="hljs-attr">'compaction.offpeak.start.hour'</span>Â =Â <span class="hljs-string">'2'</span>,
Â Â Â Â <span class="hljs-attr">'compaction.offpeak.end.hour'</span>Â =Â <span class="hljs-string">'6'</span>,
Â Â Â Â <span class="hljs-attr">'compaction.offpeak-ratio'</span>Â =Â <span class="hljs-string">'20'</span>,
Â Â Â Â <span class="hljs-attr">'compaction.size-ratio'</span>Â =Â <span class="hljs-string">'1'</span>
)<span class="hljs-comment">;</span>
--Â åœ¨éé«˜å³°æ—¶æ®µï¼ŒeffectiveÂ <span class="hljs-attr">size-ratio</span>Â =Â <span class="hljs-number">1</span>Â +Â <span class="hljs-number">20</span>Â =Â <span class="hljs-number">21</span>
</code></pre>
<h4 data-id="heading-53">8.5 å…¶ä»–é‡è¦é…ç½®</h4>





























<table><thead><tr><th>é…ç½®é¡¹</th><th>é»˜è®¤å€¼</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>write-only</code></td><td>false</td><td>Boolean</td><td>æ˜¯å¦ä»…å†™å…¥ä¸ Compactï¼Œé€‚ç”¨äºä¸“é—¨çš„ Compact ä½œä¸šåœºæ™¯</td></tr><tr><td><code>compaction.delete-ratio-threshold</code></td><td>0.3</td><td>Double</td><td>åˆ é™¤ç‡é˜ˆå€¼ï¼Œå¯ç”¨ Deletion Vector æ—¶ä½¿ç”¨</td></tr><tr><td><code>prepare-commit.wait-compaction</code></td><td>false</td><td>Boolean</td><td>Checkpoint æ—¶æ˜¯å¦ç­‰å¾… Compact å®Œæˆ</td></tr></tbody></table>
<p><strong>ä¸“é—¨ Compact ä½œä¸šé…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--Â å†™è¡¨é…ç½®</span>
<span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â my_tableÂ (...)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-string">'write-only'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'true'</span>Â Â <span class="hljs-comment">--Â ç¦ç”¨Â Compact</span>
);

<span class="hljs-comment">--Â CompactÂ ä½œä¸šé…ç½®</span>
<span class="hljs-keyword">CALL</span>Â sys.compact(
Â Â Â Â `<span class="hljs-keyword">table</span>`Â <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span>Â <span class="hljs-string">'default.my_table'</span>,
Â Â Â Â `options`Â <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span>Â <span class="hljs-string">'continuous.discovery-interval=5s,sink.parallelism=20'</span>
);
</code></pre>
<hr/>
<h3 data-id="heading-54">ä¹ã€æºç æ ¸å¿ƒç±»æ€»ç»“</h3>
<h4 data-id="heading-55">9.1 Compact ç®¡ç†ç±»</h4>






























<table><thead><tr><th>ç±»å</th><th>è·¯å¾„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>CompactManager</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/compact/</code></td><td>Compact ç®¡ç†å™¨æ¥å£</td></tr><tr><td><code>MergeTreeCompactManager</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/mergetree/compact/</code></td><td>ä¸»é”®è¡¨ Compact ç®¡ç†å™¨</td></tr><tr><td><code>BucketedAppendCompactManager</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/append/</code></td><td>Append è¡¨ï¼ˆæœ‰ Bucketï¼‰Compact ç®¡ç†å™¨</td></tr><tr><td><code>AppendCompactCoordinator</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/append/</code></td><td>Append è¡¨ Compact åè°ƒå™¨</td></tr></tbody></table>
<h4 data-id="heading-56">9.2 Compact ç­–ç•¥ç±»</h4>



































<table><thead><tr><th>ç±»å</th><th>è·¯å¾„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>CompactStrategy</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/mergetree/compact/</code></td><td>Compact ç­–ç•¥æ¥å£</td></tr><tr><td><code>UniversalCompaction</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/mergetree/compact/</code></td><td>Universal Compaction ç­–ç•¥å®ç°</td></tr><tr><td><code>FullCompactTrigger</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/mergetree/compact/</code></td><td>å®šæ—¶å…¨é‡ Compact è§¦å‘å™¨</td></tr><tr><td><code>ForceUpLevel0Compaction</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/mergetree/compact/</code></td><td>å¼ºåˆ¶ Level 0 Compact ç­–ç•¥</td></tr><tr><td><code>OffPeakHours</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/mergetree/compact/</code></td><td>éé«˜å³°æ—¶æ®µé…ç½®</td></tr></tbody></table>
<h4 data-id="heading-57">9.3 Compact ä»»åŠ¡ç±»</h4>








































<table><thead><tr><th>ç±»å</th><th>è·¯å¾„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>CompactTask</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/compact/</code></td><td>Compact ä»»åŠ¡æŠ½è±¡ç±»</td></tr><tr><td><code>MergeTreeCompactTask</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/mergetree/compact/</code></td><td>ä¸»é”®è¡¨ Compact ä»»åŠ¡</td></tr><tr><td><code>FileRewriteCompactTask</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/mergetree/compact/</code></td><td>æ–‡ä»¶é‡å†™ä»»åŠ¡ï¼ˆä»…ä¿®æ”¹å…ƒæ•°æ®ï¼‰</td></tr><tr><td><code>AppendCompactTask</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/append/</code></td><td>Append è¡¨ Compact ä»»åŠ¡</td></tr><tr><td><code>CompactResult</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/compact/</code></td><td>Compact ç»“æœ</td></tr><tr><td><code>CompactUnit</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/compact/</code></td><td>Compact å•å…ƒï¼ˆå¾…åˆå¹¶çš„æ–‡ä»¶é›†åˆï¼‰</td></tr></tbody></table>
<h4 data-id="heading-58">9.4 æ•°æ®ç»“æ„ç±»</h4>






























<table><thead><tr><th>ç±»å</th><th>è·¯å¾„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>Levels</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/mergetree/</code></td><td>LSM-Tree å±‚çº§ç»“æ„</td></tr><tr><td><code>SortedRun</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/mergetree/</code></td><td>æœ‰åºæ–‡ä»¶é›†åˆ</td></tr><tr><td><code>LevelSortedRun</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/mergetree/</code></td><td>å¸¦ Level ä¿¡æ¯çš„ SortedRun</td></tr><tr><td><code>IntervalPartition</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/mergetree/compact/</code></td><td>æ–‡ä»¶åˆ†åŒºç®—æ³•ï¼ˆå¤„ç†é‡å æ–‡ä»¶ï¼‰</td></tr></tbody></table>
<h4 data-id="heading-59">9.5 Flink é›†æˆç±»</h4>



































<table><thead><tr><th>ç±»å</th><th>è·¯å¾„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>AppendBypassCoordinateOperator</code></td><td><code>paimon-flink/paimon-flink-common/.../flink/source/</code></td><td>Append è¡¨ Compact åè°ƒç®—å­</td></tr><tr><td><code>StoreCompactOperator</code></td><td><code>paimon-flink/paimon-flink-common/.../flink/sink/</code></td><td>ä¸»é”®è¡¨ Compact æ‰§è¡Œç®—å­</td></tr><tr><td><code>CompactorSourceBuilder</code></td><td><code>paimon-flink/paimon-flink-common/.../flink/source/</code></td><td>Compact Source æ„å»ºå™¨</td></tr><tr><td><code>AppendTableCompact</code></td><td><code>paimon-flink/paimon-flink-common/.../flink/compact/</code></td><td>Append è¡¨ Compact ä½œä¸šæ„å»ºå™¨</td></tr><tr><td><code>CompactAction</code></td><td><code>paimon-flink/paimon-flink-common/.../flink/action/</code></td><td>Compact Action å®ç°</td></tr></tbody></table>
<h4 data-id="heading-60">9.6 å†™å…¥ç›¸å…³ç±»</h4>



































<table><thead><tr><th>ç±»å</th><th>è·¯å¾„</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>MergeTreeWriter</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/mergetree/</code></td><td>ä¸»é”®è¡¨å†™å…¥å™¨</td></tr><tr><td><code>AppendOnlyWriter</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/append/</code></td><td>Append è¡¨å†™å…¥å™¨</td></tr><tr><td><code>AbstractFileStoreWrite</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/operation/</code></td><td>æ–‡ä»¶å­˜å‚¨å†™å…¥æŠ½è±¡ç±»</td></tr><tr><td><code>KeyValueFileStoreWrite</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/operation/</code></td><td>ä¸»é”®è¡¨å†™å…¥å®ç°</td></tr><tr><td><code>BaseAppendFileStoreWrite</code></td><td><code>paimon-core/src/main/java/org/apache/paimon/operation/</code></td><td>Append è¡¨å†™å…¥å®ç°</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-61">åã€æœ€ä½³å®è·µä¸ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-62">10.1 åœºæ™¯ä¸€ï¼šå¤šå†™ä½œä¸šå…±äº«è¡¨</h4>
<p><strong>é—®é¢˜</strong>ï¼šå¤šä¸ªä½œä¸šåŒæ—¶å†™å…¥åŒä¸€å¼ è¡¨ï¼Œå†…è” Compact ä¼šå¯¼è‡´æ–‡ä»¶å†²çªã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨ä¸“é—¨çš„ Compact ä½œä¸š</p>
<p><strong>é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--Â å†™è¡¨é…ç½®ï¼šç¦ç”¨Â Compact</span>
<span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â shared_tableÂ (
Â Â Â Â idÂ <span class="hljs-type">BIGINT</span>,
Â Â Â Â nameÂ STRING,
Â Â Â Â dtÂ STRING,
Â Â Â Â <span class="hljs-keyword">PRIMARY</span>Â KEYÂ (id,Â dt)Â <span class="hljs-keyword">NOT</span>Â ENFORCED
)Â PARTITIONEDÂ <span class="hljs-keyword">BY</span>Â (dt)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-string">'write-only'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'true'</span>,
Â Â Â Â <span class="hljs-string">'bucket'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'8'</span>
);

<span class="hljs-comment">--Â ä¸“é—¨çš„Â CompactÂ ä½œä¸š</span>
<span class="hljs-operator">&lt;</span>FLINK_HOME<span class="hljs-operator">&gt;</span><span class="hljs-operator">/</span>bin<span class="hljs-operator">/</span>flinkÂ runÂ \
Â Â Â Â <span class="hljs-operator">/</span>path<span class="hljs-operator">/</span><span class="hljs-keyword">to</span><span class="hljs-operator">/</span>paimon<span class="hljs-operator">-</span>flink<span class="hljs-operator">-</span>action.jarÂ \
Â Â Â Â compactÂ \
Â Â Â Â <span class="hljs-comment">--warehouseÂ hdfs:///warehouseÂ \</span>
Â Â Â Â <span class="hljs-comment">--databaseÂ defaultÂ \</span>
Â Â Â Â <span class="hljs-comment">--tableÂ shared_tableÂ \</span>
Â Â Â Â <span class="hljs-comment">--continuousÂ \</span>
Â Â Â Â <span class="hljs-comment">--table_confÂ continuous.discovery-interval=10sÂ \</span>
Â Â Â Â <span class="hljs-comment">--table_confÂ sink.parallelism=16</span>
</code></pre>
<p><strong>ä¼˜ç‚¹</strong>ï¼š</p>
<ul>
<li>å†™ä½œä¸šä¹‹é—´æ— å†²çª</li>
<li>èµ„æºéš”ç¦»ï¼ŒCompact ä¸å½±å“å†™å…¥æ€§èƒ½</li>
<li>å¯ä»¥ç‹¬ç«‹è°ƒæ•´ Compact å¹¶è¡Œåº¦</li>
</ul>
<h4 data-id="heading-63">10.2 åœºæ™¯äºŒï¼šå¤§è§„æ¨¡æ•°æ®å†™å…¥</h4>
<p><strong>é—®é¢˜</strong>ï¼šé«˜ååå†™å…¥å¯¼è‡´ Level 0 æ–‡ä»¶æ•°é‡æ¿€å¢ï¼Œå½±å“æŸ¥è¯¢æ€§èƒ½ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šè°ƒæ•´ Compact ç­–ç•¥ï¼ŒåŠ å¿« Compact é€Ÿåº¦</p>
<p><strong>é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â high_throughput_tableÂ (...)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-comment">--Â å‡å°‘è§¦å‘é˜ˆå€¼ï¼Œæ›´é¢‘ç¹åœ°Â Compact</span>
Â Â Â Â <span class="hljs-string">'num-sorted-run.compaction-trigger'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'3'</span>,
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">--Â å¢å¤§ç›®æ ‡æ–‡ä»¶å¤§å°ï¼Œå‡å°‘æ–‡ä»¶æ•°é‡</span>
Â Â Â Â <span class="hljs-string">'target-file-size'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'256Â MB'</span>,
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">--Â è®¾ç½®é˜»å¡é˜ˆå€¼ï¼Œé˜²æ­¢Â LevelÂ 0Â æ–‡ä»¶è¿‡å¤š</span>
Â Â Â Â <span class="hljs-string">'num-sorted-run.stop-trigger'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'10'</span>,
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">--Â ä½¿ç”¨æ›´æ¿€è¿›çš„ç©ºé—´æ”¾å¤§æ§åˆ¶</span>
Â Â Â Â <span class="hljs-string">'compaction.max-size-amplification-percent'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'150'</span>
);
</code></pre>
<p><strong>Compact ä½œä¸šå¹¶è¡Œåº¦</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">--table_confÂ <span class="hljs-attr">sink.parallelism</span>=<span class="hljs-number">32</span>Â Â <span class="hljs-comment">#Â å¢å¤§å¹¶è¡Œåº¦åŠ å¿«Â Compact</span>
</code></pre>
<h4 data-id="heading-64">10.3 åœºæ™¯ä¸‰ï¼šä½å»¶è¿ŸæŸ¥è¯¢è¦æ±‚</h4>
<p><strong>é—®é¢˜</strong>ï¼šLevel 0 æ–‡ä»¶è¿‡å¤šå¯¼è‡´æŸ¥è¯¢å»¶è¿Ÿè¾ƒé«˜ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä¼˜åŒ– Compact ç­–ç•¥ï¼Œä¿æŒ Level 0 æ–‡ä»¶æ•°é‡è¾ƒå°‘</p>
<p><strong>é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â low_latency_tableÂ (...)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-comment">--Â æ›´æ¿€è¿›çš„Â CompactÂ è§¦å‘</span>
Â Â Â Â <span class="hljs-string">'num-sorted-run.compaction-trigger'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'2'</span>,
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">--Â å®šæ—¶å…¨é‡Â Compactï¼Œç¡®ä¿æŸ¥è¯¢æ€§èƒ½</span>
Â Â Â Â <span class="hljs-string">'compaction.optimization-interval'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'1Â h'</span>,
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">--Â CheckpointÂ æ—¶ç­‰å¾…Â CompactÂ å®Œæˆ</span>
Â Â Â Â <span class="hljs-string">'prepare-commit.wait-compaction'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'true'</span>
);
</code></pre>
<h4 data-id="heading-65">10.4 åœºæ™¯å››ï¼šå®šæ—¶ç¦»å³° Compact</h4>
<p><strong>é—®é¢˜</strong>ï¼šç™½å¤©ä¸šåŠ¡é«˜å³°æœŸ Compact å ç”¨èµ„æºï¼Œå½±å“å†™å…¥å’ŒæŸ¥è¯¢ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šé…ç½® Off-Peak Hoursï¼Œåœ¨å¤œé—´è¿›è¡Œæ›´æ¿€è¿›çš„ Compact</p>
<p><strong>é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">CREATEÂ TABLEÂ peak_sensitive_tableÂ (...)Â WITHÂ (
Â Â Â Â --Â ç™½å¤©ä½¿ç”¨æ¸©å’Œçš„Â CompactÂ ç­–ç•¥
Â Â Â Â <span class="hljs-attr">'compaction.size-ratio'</span>Â =Â <span class="hljs-string">'5'</span>,
Â Â Â Â <span class="hljs-attr">'num-sorted-run.compaction-trigger'</span>Â =Â <span class="hljs-string">'10'</span>,
Â Â Â Â 
Â Â Â Â --Â å¤œé—´2ç‚¹åˆ°6ç‚¹ä½¿ç”¨æ¿€è¿›ç­–ç•¥
Â Â Â Â <span class="hljs-attr">'compaction.offpeak.start.hour'</span>Â =Â <span class="hljs-string">'2'</span>,
Â Â Â Â <span class="hljs-attr">'compaction.offpeak.end.hour'</span>Â =Â <span class="hljs-string">'6'</span>,
Â Â Â Â <span class="hljs-attr">'compaction.offpeak-ratio'</span>Â =Â <span class="hljs-string">'30'</span>
)<span class="hljs-comment">;</span>
</code></pre>
<p><strong>æ•ˆæœ</strong>ï¼š</p>
<ul>
<li>ç™½å¤©ï¼šeffective size-ratio = 5ï¼ŒCompact è§¦å‘è¾ƒå°‘</li>
<li>å¤œé—´ï¼šeffective size-ratio = 5 + 30 = 35ï¼ŒCompact æ›´é¢‘ç¹</li>
</ul>
<h4 data-id="heading-66">10.5 åœºæ™¯äº”ï¼šAppend è¡¨å°æ–‡ä»¶è¿‡å¤š</h4>
<p><strong>é—®é¢˜</strong>ï¼šAppend è¡¨å†™å…¥äº§ç”Ÿå¤§é‡å°æ–‡ä»¶ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šè°ƒæ•´æ–‡ä»¶æ‰“åŒ…ç­–ç•¥</p>
<p><strong>é…ç½®</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span>Â <span class="hljs-keyword">TABLE</span>Â append_tableÂ (
Â Â Â Â idÂ <span class="hljs-type">BIGINT</span>,
Â Â Â Â dataÂ STRING,
Â Â Â Â dtÂ STRING
)Â PARTITIONEDÂ <span class="hljs-keyword">BY</span>Â (dt)Â <span class="hljs-keyword">WITH</span>Â (
Â Â Â Â <span class="hljs-comment">--Â é™ä½æœ€å°æ–‡ä»¶æ•°è¦æ±‚</span>
Â Â Â Â <span class="hljs-string">'compaction.min.file-num'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'3'</span>,
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">--Â å‡å°Â CompactÂ æ–‡ä»¶å¤§å°é˜ˆå€¼</span>
Â Â Â Â <span class="hljs-string">'compaction.file-size'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'64Â MB'</span>,
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">--Â å¢å¤§ç›®æ ‡æ–‡ä»¶å¤§å°</span>
Â Â Â Â <span class="hljs-string">'target-file-size'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'256Â MB'</span>,
Â Â Â Â 
Â Â Â Â <span class="hljs-comment">--Â ç¼©çŸ­æ‰«æé—´éš”</span>
Â Â Â Â <span class="hljs-string">'continuous.discovery-interval'</span>Â <span class="hljs-operator">=</span>Â <span class="hljs-string">'5s'</span>
);
</code></pre>
<h4 data-id="heading-67">10.6 ç›‘æ§æŒ‡æ ‡</h4>
<p><strong>å…³é”®æŒ‡æ ‡</strong>ï¼š</p>
<ol>
<li>
<p><strong>Level 0 æ–‡ä»¶æ•°</strong>ï¼š<code>level0.file.count</code></p>
<ul>
<li>æ­£å¸¸èŒƒå›´ï¼š&lt; 10</li>
<li>å‘Šè­¦é˜ˆå€¼ï¼š&gt; 20</li>
</ul>
</li>
<li>
<p><strong>Compact å»¶è¿Ÿ</strong>ï¼š<code>compaction.time.ms</code></p>
<ul>
<li>æ­£å¸¸èŒƒå›´ï¼š&lt; 5min</li>
<li>å‘Šè­¦é˜ˆå€¼ï¼š&gt; 15min</li>
</ul>
</li>
<li>
<p><strong>Compact é˜Ÿåˆ—é•¿åº¦</strong>ï¼š<code>compactions.queued.count</code></p>
<ul>
<li>æ­£å¸¸èŒƒå›´ï¼š&lt; 5</li>
<li>å‘Šè­¦é˜ˆå€¼ï¼š&gt; 10</li>
</ul>
</li>
<li>
<p><strong>æ€»æ–‡ä»¶å¤§å°</strong>ï¼š<code>total.file.size.bytes</code></p>
<ul>
<li>ç›‘æ§ç©ºé—´æ”¾å¤§æƒ…å†µ</li>
</ul>
</li>
</ol>
<p><strong>Flink Metrics</strong>ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">//Â paimon-core/src/main/java/org/apache/paimon/operation/metrics/CompactionMetrics.java</span>
<span class="hljs-keyword">public</span>Â <span class="hljs-keyword">interface</span>Â <span class="hljs-title">Reporter</span>Â {
Â Â Â Â <span class="hljs-function"><span class="hljs-keyword">void</span>Â <span class="hljs-title">reportLevel0FileCount</span>(<span class="hljs-params"><span class="hljs-built_in">long</span>Â count</span>)</span>;
Â Â Â Â <span class="hljs-function"><span class="hljs-keyword">void</span>Â <span class="hljs-title">reportCompactionTime</span>(<span class="hljs-params"><span class="hljs-built_in">long</span>Â milliseconds</span>)</span>;
Â Â Â Â <span class="hljs-function"><span class="hljs-keyword">void</span>Â <span class="hljs-title">increaseCompactionsQueuedCount</span>()</span>;
Â Â Â Â <span class="hljs-function"><span class="hljs-keyword">void</span>Â <span class="hljs-title">increaseCompactionsCompletedCount</span>()</span>;
Â Â Â Â <span class="hljs-function"><span class="hljs-keyword">void</span>Â <span class="hljs-title">reportTotalFileSize</span>(<span class="hljs-params"><span class="hljs-built_in">long</span>Â bytes</span>)</span>;
}
</code></pre>
<h4 data-id="heading-68">10.7 æ•…éšœæ’æŸ¥</h4>
<p><strong>é—®é¢˜1ï¼šCompact ä»»åŠ¡å¤±è´¥</strong></p>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>æ£€æŸ¥æ—¥å¿—ä¸­çš„å¼‚å¸¸ä¿¡æ¯</li>
<li>ç¡®è®¤æ˜¯å¦æœ‰å¹¶å‘å†™å†²çª</li>
<li>æ£€æŸ¥èµ„æºæ˜¯å¦å……è¶³ï¼ˆå†…å­˜ã€ç£ç›˜ï¼‰</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>å¯ç”¨ <code>write-only</code> æ¨¡å¼ï¼Œä½¿ç”¨ä¸“é—¨çš„ Compact ä½œä¸š</li>
<li>å¢åŠ  Compact ä½œä¸šçš„èµ„æºé…ç½®</li>
</ul>
<p><strong>é—®é¢˜2ï¼šCompact é€Ÿåº¦æ…¢</strong></p>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>æ£€æŸ¥ <code>compactions.queued.count</code> æŒ‡æ ‡</li>
<li>æŸ¥çœ‹ Compact ä»»åŠ¡çš„å¹¶è¡Œåº¦</li>
<li>ç¡®è®¤æ–‡ä»¶å¤§å°å’Œæ•°é‡</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>å¢å¤§ Compact å¹¶è¡Œåº¦ï¼š<code>sink.parallelism</code></li>
<li>è°ƒæ•´ç­–ç•¥å‚æ•°ï¼šé™ä½ <code>num-sorted-run.compaction-trigger</code></li>
<li>å¢å¤§æ–‡ä»¶å¤§å°ï¼š<code>target-file-size</code></li>
</ul>
<p><strong>é—®é¢˜3ï¼šå†…å­˜æº¢å‡ºï¼ˆOOMï¼‰</strong></p>
<p><strong>æ’æŸ¥æ­¥éª¤</strong>ï¼š</p>
<ol>
<li>æ£€æŸ¥ Compact ä»»åŠ¡çš„å †å†…å­˜ä½¿ç”¨</li>
<li>æŸ¥çœ‹å•ä¸ª Compact ä»»åŠ¡å¤„ç†çš„æ–‡ä»¶æ•°é‡</li>
<li>ç¡®è®¤æ˜¯å¦æœ‰å¤§æ–‡ä»¶</li>
</ol>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li>å¢å¤§ TaskManager å†…å­˜</li>
<li>å‡å° <code>target-file-size</code></li>
<li>é™åˆ¶å•æ¬¡ Compact çš„æ–‡ä»¶æ•°é‡</li>
</ul>
<hr/>
<h3 data-id="heading-69">æ€»ç»“</h3>
<p>Paimon çš„å®šæ—¶ Compact æœºåˆ¶æ˜¯ä¿è¯æ•°æ®æ¹–æ€§èƒ½çš„å…³é”®ç»„ä»¶ã€‚æœ¬æ–‡è¯¦ç»†åˆ†æäº†ï¼š</p>
<ol>
<li><strong>ä¸‰ç§è§¦å‘æ–¹å¼</strong>ï¼šå†…è” Compactã€å®šæ—¶ Compact Jobã€æ‰‹åŠ¨è§¦å‘</li>
<li><strong>Append è¡¨æµç¨‹</strong>ï¼šåŸºäº AppendCompactCoordinator çš„æ–‡ä»¶æ‰«æã€æ‰“åŒ…å’Œä»»åŠ¡ç”Ÿæˆ</li>
<li><strong>ä¸»é”®è¡¨æµç¨‹</strong>ï¼šåŸºäº LSM-Tree çš„ Levels ç®¡ç†å’Œ MergeTreeCompactManager</li>
<li><strong>UniversalCompaction ç­–ç•¥</strong>ï¼šå››çº§ç­–ç•¥ï¼ˆå®šæ—¶å…¨é‡ã€ç©ºé—´æ”¾å¤§ã€å¤§å°æ¯”ä¾‹ã€æ–‡ä»¶æ•°é‡ï¼‰</li>
<li><strong>å®šæ—¶è°ƒåº¦æœºåˆ¶</strong>ï¼šåŸºäº Flink çš„æµå¼å¤„ç†æ¡†æ¶ï¼Œä½¿ç”¨ ScheduledExecutorService å’Œ ProcessingTimeService</li>
<li><strong>å…³é”®é…ç½®é¡¹</strong>ï¼šæ‰«æé—´éš”ã€ç­–ç•¥å‚æ•°ã€æ–‡ä»¶å¤§å°ã€Off-Peak Hours ç­‰</li>
<li><strong>æœ€ä½³å®è·µ</strong>ï¼šå¤šå†™ä½œä¸šã€å¤§è§„æ¨¡å†™å…¥ã€ä½å»¶è¿ŸæŸ¥è¯¢ã€ç¦»å³° Compactã€å°æ–‡ä»¶å¤„ç†ç­‰åœºæ™¯çš„ä¼˜åŒ–æ–¹æ¡ˆ</li>
</ol>
<p>é€šè¿‡åˆç†é…ç½®å’Œç›‘æ§ï¼Œå¯ä»¥åœ¨å†™å…¥æ€§èƒ½ã€æŸ¥è¯¢æ€§èƒ½å’Œå­˜å‚¨æˆæœ¬ä¹‹é—´å–å¾—è‰¯å¥½çš„å¹³è¡¡ã€‚</p>
<hr/>
<p><strong>å‚è€ƒèµ„æ–™</strong>ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpaimon.apache.org%2Fdocs%2Fmaster%2Fprimary-key-table%2Fcompaction%2F" target="_blank" title="https://paimon.apache.org/docs/master/primary-key-table/compaction/" ref="nofollow noopener noreferrer">Paimon å®˜æ–¹æ–‡æ¡£ - Compaction</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebook%2Frocksdb%2Fwiki%2FUniversal-Compaction" target="_blank" title="https://github.com/facebook/rocksdb/wiki/Universal-Compaction" ref="nofollow noopener noreferrer">RocksDB Universal Compaction</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fapache%2Fpaimon" target="_blank" title="https://github.com/apache/paimon" ref="nofollow noopener noreferrer">Paimon æºç </a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäºçŸ¥è¯†åº“çš„çŸ¥ç­–æ™ºèƒ½ä½“]]></title>    <link>https://juejin.cn/post/7591439477438316595</link>    <guid>https://juejin.cn/post/7591439477438316595</guid>    <pubDate>2026-01-05T01:33:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591439477438316595" data-draft-id="7591439477438283827" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäºçŸ¥è¯†åº“çš„çŸ¥ç­–æ™ºèƒ½ä½“"/> <meta itemprop="keywords" content="åç«¯,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-05T01:33:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é€ è½®å­çš„çŒª"/> <meta itemprop="url" content="https://juejin.cn/user/497453720940158"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäºçŸ¥è¯†åº“çš„çŸ¥ç­–æ™ºèƒ½ä½“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/497453720940158/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é€ è½®å­çš„çŒª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T01:33:25.000Z" title="Mon Jan 05 2026 01:33:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åŸºäºçŸ¥è¯†åº“çš„çŸ¥ç­–æ™ºèƒ½ä½“</h2>
<h3 data-id="heading-1">ä¸€ã€æ ¸å¿ƒè®¾è®¡ç†å¿µ</h3>
<p>çŸ¥ç­–æ™ºèƒ½ä½“é‡‡ç”¨<strong>ç»å…¸å››é˜¶æ®µAgentæ¶æ„</strong>ï¼Œå®ç°ã€Œç”¨æˆ·é—®é¢˜â†’æ™ºèƒ½å†³ç­–â†’å·¥å…·è°ƒç”¨â†’ç­”æ¡ˆç”Ÿæˆã€çš„å®Œæ•´é“¾è·¯ï¼Œå„ç»„ä»¶èŒè´£å•ä¸€ã€è§£è€¦è®¾è®¡ï¼Œå¯ç‹¬ç«‹æ‰©å±•/æ›¿æ¢ï¼š</p>
<ol>
<li><strong>æ€è€ƒå™¨(Thinker)</strong>ï¼šå¤§è„‘æ ¸å¿ƒï¼ŒåŸºäºç”¨æˆ·é—®é¢˜å†³ç­–ã€Œæ˜¯å¦è°ƒç”¨å·¥å…·ã€ã€Œè°ƒç”¨å“ªä¸ªå·¥å…·ã€</li>
<li><strong>æ‰§è¡Œå™¨(Executor)</strong>ï¼šå·¥å…·è°ƒåº¦æ ¸å¿ƒï¼Œæ ¹æ®æ€è€ƒç»“æœæ‰§è¡Œå¯¹åº”å·¥å…·ã€è¿”å›æ‰§è¡Œæ•°æ®</li>
<li><strong>æ€»ç»“å™¨(Summarizer)</strong>ï¼šç­”æ¡ˆç”Ÿæˆæ ¸å¿ƒï¼Œå°†å·¥å…·è¿”å›çš„åŸå§‹æ•°æ®åŠ å·¥ä¸º<strong>ç²¾å‡†ã€è§„èŒƒã€å¸¦æº¯æº</strong>çš„æœ€ç»ˆç­”æ¡ˆ</li>
<li><strong>å·¥å…·æ³¨å†Œè¡¨(Registry)</strong>ï¼šå·¥å…·ç®¡ç†ä¸­å¿ƒï¼Œç»Ÿä¸€æ³¨å†Œ/å‘ç°æ‰€æœ‰Agentå·¥å…·ï¼Œæ”¯æŒåŠ¨æ€æ‰©å±•</li>
<li><strong>å·¥å…·æ¥å£(Tool)</strong>ï¼šæ ‡å‡†åŒ–å·¥å…·è§„èŒƒï¼Œæ‰€æœ‰è‡ªå®šä¹‰å·¥å…·åªéœ€å®ç°æ¥å£å³å¯æ— ç¼æ¥å…¥</li>
</ol>
<h3 data-id="heading-2">äºŒã€å®Œæ•´ä»£ç å®ç°ï¼ˆå…¨é‡å¯è¿è¡Œï¼‰</h3>
<h4 data-id="heading-3">ã€åŸºç¡€å±‚ã€‘å·¥å…·æ ‡å‡†åŒ–æ¥å£ + é€šç”¨å®ä½“ç±»ï¼ˆæ ¸å¿ƒä¾èµ–ï¼‰</h4>
<h5 data-id="heading-4">1. å·¥å…·é¡¶å±‚æ¥å£ <code>AgentTool</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * Agentå·¥å…·æ ‡å‡†åŒ–æ¥å£
 * æ‰€æœ‰æ™ºèƒ½ä½“å·¥å…·ï¼ˆæ£€ç´¢ã€æ€»ç»“ã€ç¿»è¯‘ç­‰ï¼‰å¿…é¡»å®ç°æ­¤æ¥å£
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AgentTool</span> {
    <span class="hljs-comment">// å·¥å…·å”¯ä¸€åç§°ï¼ˆç»™å¤§æ¨¡å‹å†³ç­–ä½¿ç”¨ï¼Œä¸å¯é‡å¤ï¼‰</span>
    String <span class="hljs-title function_">toolName</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">// å·¥å…·è¯¦ç»†æè¿°ï¼ˆç»™å¤§æ¨¡å‹çœ‹ï¼Œç²¾å‡†æè¿°å·¥å…·èƒ½åŠ›ä¸é€‚ç”¨åœºæ™¯ï¼‰</span>
    String <span class="hljs-title function_">toolDesc</span><span class="hljs-params">()</span>;

    <span class="hljs-comment">// å·¥å…·æ‰§è¡Œæ–¹æ³•ï¼ˆç»Ÿä¸€å…¥å‚ã€ç»Ÿä¸€å‡ºå‚ï¼Œä¿è¯è°ƒç”¨ä¸€è‡´æ€§ï¼‰</span>
    ToolResult <span class="hljs-title function_">execute</span><span class="hljs-params">(ToolParam param)</span>;
}
</code></pre>
<h5 data-id="heading-5">2. å·¥å…·å…¥å‚å®ä½“ <code>ToolParam</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Builder;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * å·¥å…·æ‰§è¡Œç»Ÿä¸€å…¥å‚
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ToolParam</span> {
    <span class="hljs-comment">/** ç”¨æˆ·åŸå§‹é—®é¢˜ */</span>
    <span class="hljs-keyword">private</span> String query;
    <span class="hljs-comment">/** ä¼šè¯IDï¼ˆç”¨äºä¸Šä¸‹æ–‡/å†å²è®°å½•å…³è”ï¼‰ */</span>
    <span class="hljs-keyword">private</span> String sessionId;
    <span class="hljs-comment">/** æ‰©å±•å‚æ•°ï¼ˆé€‚é…å¤šå·¥å…·å·®å¼‚åŒ–å…¥å‚ï¼‰ */</span>
    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; params;
}
</code></pre>
<h5 data-id="heading-6">3. å·¥å…·å‡ºå‚å®ä½“ <code>ToolResult</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.AllArgsConstructor;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> lombok.NoArgsConstructor;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * å·¥å…·æ‰§è¡Œç»Ÿä¸€å‡ºå‚
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@NoArgsConstructor</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ToolResult</span> {
    <span class="hljs-comment">/** æ‰§è¡Œæ˜¯å¦æˆåŠŸ */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> success;
    <span class="hljs-comment">/** å·¥å…·è¿”å›æ ¸å¿ƒå†…å®¹ */</span>
    <span class="hljs-keyword">private</span> String content;
    <span class="hljs-comment">/** é”™è¯¯ä¿¡æ¯ï¼ˆå¤±è´¥æ—¶å¿…å¡«ï¼‰ */</span>
    <span class="hljs-keyword">private</span> String errorMsg;
    <span class="hljs-comment">/** æ‰©å±•æº¯æºä¿¡æ¯ï¼ˆå¦‚æ–‡æ¡£æ¥æºã€è¡Œå·ã€å¾—åˆ†ç­‰ï¼‰ */</span>
    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; extra;

    <span class="hljs-comment">// ========== å¿«æ·æ„å»ºæ–¹æ³•ï¼ˆç®€åŒ–å·¥å…·å¼€å‘ï¼‰ ==========</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ToolResult <span class="hljs-title function_">success</span><span class="hljs-params">(String content)</span> {
        <span class="hljs-type">ToolResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToolResult</span>();
        result.setSuccess(<span class="hljs-literal">true</span>);
        result.setContent(content);
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ToolResult <span class="hljs-title function_">success</span><span class="hljs-params">(String content, Map&lt;String, Object&gt; extra)</span> {
        <span class="hljs-type">ToolResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToolResult</span>();
        result.setSuccess(<span class="hljs-literal">true</span>);
        result.setContent(content);
        result.setExtra(extra);
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ToolResult <span class="hljs-title function_">fail</span><span class="hljs-params">(String errorMsg)</span> {
        <span class="hljs-type">ToolResult</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToolResult</span>();
        result.setSuccess(<span class="hljs-literal">false</span>);
        result.setErrorMsg(errorMsg);
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<h5 data-id="heading-7">4. æ€è€ƒå™¨å†³ç­–ç»“æœ <code>ThinkResult</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.alibaba.fastjson2.annotation.JSONField;
<span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * æ€è€ƒå™¨å†³ç­–ç»“æœå®ä½“
 * æ‰¿è½½å¤§æ¨¡å‹çš„å†³ç­–æŒ‡ä»¤ï¼šç›´æ¥å›ç­” / è°ƒç”¨æŒ‡å®šå·¥å…·
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThinkResult</span> {
    <span class="hljs-comment">/**
     * å†³ç­–åŠ¨ä½œç±»å‹
     * DIRECT_ANSWER - ç›´æ¥å›ç­”ï¼Œæ— éœ€è°ƒç”¨å·¥å…·
     * TOOL_CALL     - è°ƒç”¨å·¥å…·ï¼Œéœ€æ‰§è¡Œå¯¹åº”å·¥å…·é€»è¾‘
     */</span>
    <span class="hljs-meta">@JSONField(name = "action")</span>
    <span class="hljs-keyword">private</span> String action;

    <span class="hljs-comment">/**
     * ç›´æ¥å›ç­”çš„å†…å®¹ï¼ˆaction=DIRECT_ANSWERæ—¶å¿…å¡«ï¼‰
     */</span>
    <span class="hljs-meta">@JSONField(name = "content")</span>
    <span class="hljs-keyword">private</span> String content;

    <span class="hljs-comment">/**
     * ç›®æ ‡å·¥å…·åç§°ï¼ˆaction=TOOL_CALLæ—¶å¿…å¡«ï¼Œéœ€ä¸AgentTool.toolName()ä¸€è‡´ï¼‰
     */</span>
    <span class="hljs-meta">@JSONField(name = "tool_name")</span>
    <span class="hljs-keyword">private</span> String toolName;

    <span class="hljs-comment">/**
     * å·¥å…·è°ƒç”¨å‚æ•°ï¼ˆaction=TOOL_CALLæ—¶å¿…å¡«ï¼Œæ ¸å¿ƒä¸ºqueryï¼‰
     */</span>
    <span class="hljs-meta">@JSONField(name = "tool_params")</span>
    <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; toolParams;

    <span class="hljs-comment">// ========== å¿«æ·åˆ¤æ–­æ–¹æ³• ==========</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isToolCall</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"TOOL_CALL"</span>.equals(<span class="hljs-built_in">this</span>.action);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isDirectAnswer</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"DIRECT_ANSWER"</span>.equals(<span class="hljs-built_in">this</span>.action);
    }
}
</code></pre>
<h5 data-id="heading-8">5. å‰ç«¯è°ƒç”¨å…¥å‚ <code>AgentChatParam</code>ï¼ˆå®Œå–„æ ¡éªŒï¼‰</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> javax.validation.constraints.NotBlank;

<span class="hljs-comment">/**
 * æ™ºèƒ½ä½“å¯¹è¯æ¥å£å…¥å‚
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentChatParam</span> {
    <span class="hljs-comment">/** ç”¨æˆ·é—®é¢˜ï¼ˆå¿…å¡«ï¼‰ */</span>
    <span class="hljs-meta">@NotBlank(message = "ç”¨æˆ·é—®é¢˜ä¸èƒ½ä¸ºç©º")</span>
    <span class="hljs-keyword">private</span> String query;

    <span class="hljs-comment">/** ä¼šè¯IDï¼ˆå¿…å¡«ï¼Œç”¨äºä¼šè¯éš”ç¦»ä¸ä¸Šä¸‹æ–‡å…³è”ï¼‰ */</span>
    <span class="hljs-meta">@NotBlank(message = "ä¼šè¯IDä¸èƒ½ä¸ºç©º")</span>
    <span class="hljs-keyword">private</span> String sessionId;
}
</code></pre>
<h5 data-id="heading-9">6. é€šç”¨ç»“æœå°è£… <code>Result</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-comment">/**
 * å…¨å±€ç»Ÿä¸€æ¥å£è¿”å›ç»“æœ
 */</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Result</span>&lt;T&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> code;
    <span class="hljs-keyword">private</span> String msg;
    <span class="hljs-keyword">private</span> T data;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">success</span><span class="hljs-params">(T data)</span> {
        Result&lt;T&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>&lt;&gt;();
        result.setCode(<span class="hljs-number">200</span>);
        result.setMsg(<span class="hljs-string">"æ“ä½œæˆåŠŸ"</span>);
        result.setData(data);
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="hljs-title function_">fail</span><span class="hljs-params">(String msg)</span> {
        Result&lt;T&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Result</span>&lt;&gt;();
        result.setCode(<span class="hljs-number">500</span>);
        result.setMsg(msg);
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<h5 data-id="heading-10">7. ç»“æœæ¸…æ´—å·¥å…·ç±» <code>AgentResultCleanUtils</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> java.util.regex.Pattern;

<span class="hljs-comment">/**
 * æ™ºèƒ½ä½“ç»“æœæ¸…æ´—å·¥å…·
 * è§£å†³å¤§æ¨¡å‹è¿”å›å†…å®¹æ ¼å¼æ··ä¹±ã€å«å¤šä½™å­—ç¬¦çš„é—®é¢˜
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentResultCleanUtils</span> {

    <span class="hljs-comment">// åŒ¹é…é¦–å°¾æ— å…³å­—ç¬¦ã€markdownæ ‡è®°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Pattern</span> <span class="hljs-variable">INVALID_CHAR_PATTERN</span> <span class="hljs-operator">=</span> Pattern.compile(<span class="hljs-string">"^[`\"\\s]+|[`\"\\s]+$|^```json|```$"</span>);

    <span class="hljs-comment">/**
     * æ¸…æ´—å¹¶æ ‡å‡†åŒ–å¤§æ¨¡å‹è¿”å›å†…å®¹
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">cleanAndStandardize</span><span class="hljs-params">(String content)</span> {
        <span class="hljs-keyword">if</span> (content == <span class="hljs-literal">null</span> || content.isBlank()) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
        <span class="hljs-comment">// 1. å»é™¤é¦–å°¾ç©ºæ ¼ã€å¼•å·ã€markdownçš„jsonæ ‡è®°</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">cleanContent</span> <span class="hljs-operator">=</span> INVALID_CHAR_PATTERN.matcher(content).replaceAll(<span class="hljs-string">""</span>);
        <span class="hljs-comment">// 2. æ›¿æ¢æ¢è¡Œ/åˆ¶è¡¨ç¬¦ä¸ºç©ºæ ¼ï¼Œä¿è¯JSONæ ¼å¼å®Œæ•´</span>
        <span class="hljs-keyword">return</span> cleanContent.replaceAll(<span class="hljs-string">"\\n|\\t"</span>, <span class="hljs-string">" "</span>).trim();
    }
}
</code></pre>
<h4 data-id="heading-11">ã€å·¥å…·å±‚ã€‘çŸ¥è¯†åº“æ£€ç´¢å·¥å…·</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-comment">/**
 * æ ¸å¿ƒå·¥å…·ï¼šçŸ¥è¯†åº“æ£€ç´¢å·¥å…·
 * å®ç°AgentToolæ¥å£ï¼Œé€‚é…æ™ºèƒ½ä½“è°ƒåº¦è§„èŒƒ
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KnowledgeSearchTool</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AgentTool</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> HybridSearchService hybridSearch;

    <span class="hljs-comment">// ESå‘é‡ç´¢å¼•åç§°ï¼ˆå»ºè®®é…ç½®åˆ°ymlï¼Œæ­¤å¤„ç¡¬ç¼–ç ä»…ç¤ºä¾‹ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">VECTOR_INDEX_NAME</span> <span class="hljs-operator">=</span> <span class="hljs-string">"ai_vector_index"</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toolName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"çŸ¥è¯†åº“æ£€ç´¢å·¥å…·"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toolDesc</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ã€æ ¸å¿ƒå·¥å…·ã€‘ç”¨äºæ£€ç´¢çŸ¥è¯†åº“ä¸­çš„æ–‡æ¡£/Excel/æ–‡æœ¬å†…å®¹ï¼Œå¯ç²¾å‡†å›ç­”ç”¨æˆ·å…³äºäº§å“ä»‹ç»ã€æŠ€æœ¯æ–‡æ¡£ã€ä¸šåŠ¡è§„åˆ™ã€æ•°æ®æŠ¥è¡¨çš„æ‰€æœ‰é—®é¢˜ï¼›è¾“å…¥ä¸ºç”¨æˆ·åŸå§‹é—®é¢˜ï¼Œè¾“å‡ºä¸ºé«˜åŒ¹é…åº¦çš„çŸ¥è¯†åº“æ–‡æœ¬ç‰‡æ®µ+å®Œæ•´æº¯æºä¿¡æ¯ï¼ˆæ–‡æ¡£åã€è¡Œå·ã€å·¥ä½œè¡¨åï¼‰"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ToolResult <span class="hljs-title function_">execute</span><span class="hljs-params">(ToolParam param)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> param.getQuery();
            <span class="hljs-keyword">if</span> (query == <span class="hljs-literal">null</span> || query.isBlank()) {
                <span class="hljs-keyword">return</span> ToolResult.fail(<span class="hljs-string">"æ£€ç´¢å¤±è´¥ï¼šç”¨æˆ·é—®é¢˜ä¸èƒ½ä¸ºç©º"</span>);
            }
            log.info(<span class="hljs-string">"ã€çŸ¥è¯†åº“æ£€ç´¢å·¥å…·ã€‘æ‰§è¡Œæ£€ç´¢ï¼Œä¼šè¯IDï¼š{}ï¼Œæ£€ç´¢è¯ï¼š{}"</span>, param.getSessionId(), query);
            
            <span class="hljs-comment">// 1. è°ƒç”¨æ··åˆæ£€ç´¢æœåŠ¡ï¼Œè·å–åŒ¹é…çš„æ–‡æ¡£ç‰‡æ®µ</span>
            <span class="hljs-type">var</span> <span class="hljs-variable">docFragments</span> <span class="hljs-operator">=</span> hybridSearch.hybridSearch(VECTOR_INDEX_NAME, query);
            <span class="hljs-keyword">if</span> (docFragments == <span class="hljs-literal">null</span> || docFragments.isEmpty()) {
                <span class="hljs-keyword">return</span> ToolResult.success(<span class="hljs-string">"æš‚æ— åŒ¹é…çš„çŸ¥è¯†åº“å†…å®¹"</span>);
            }
            
            <span class="hljs-comment">// 2. æ‹¼æ¥æ£€ç´¢ç»“æœï¼ˆæ–‡æœ¬å†…å®¹+æº¯æºä¿¡æ¯ï¼Œæå‡æ€»ç»“å‡†ç¡®æ€§ï¼‰</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> docFragments.stream()
                    .map(frag -&gt; {
                        <span class="hljs-comment">// æ‹¼æ¥å†…å®¹+æº¯æºï¼Œæ ¼å¼ï¼šå†…å®¹\nã€æ¥æºï¼šXXX è¡ŒX è¡¨Xã€‘</span>
                        <span class="hljs-type">String</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> frag.getMetaData().getOrDefault(<span class="hljs-string">"source_detail"</span>, <span class="hljs-string">"æœªçŸ¥æ¥æº"</span>).toString();
                        <span class="hljs-keyword">return</span> frag.getContent() + <span class="hljs-string">"\nã€æ¥æºï¼š"</span> + source + <span class="hljs-string">"ã€‘"</span>;
                    })
                    .collect(Collectors.joining(<span class="hljs-string">"\n\n"</span>));
            
            <span class="hljs-comment">// 3. å°è£…ç»“æœï¼ˆå«æº¯æºæ‰©å±•ä¿¡æ¯ï¼Œä¾›æ€»ç»“å™¨ä½¿ç”¨ï¼‰</span>
            <span class="hljs-keyword">return</span> ToolResult.success(context);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ã€çŸ¥è¯†åº“æ£€ç´¢å·¥å…·ã€‘æ‰§è¡Œå¤±è´¥ï¼Œä¼šè¯IDï¼š{}"</span>, param.getSessionId(), e);
            <span class="hljs-keyword">return</span> ToolResult.fail(<span class="hljs-string">"çŸ¥è¯†åº“æ£€ç´¢å¤±è´¥ï¼š"</span> + e.getMessage());
        }
    }
}
</code></pre>
<h4 data-id="heading-12">ã€æ ¸å¿ƒå±‚ã€‘æ™ºèƒ½ä½“æ ¸å¿ƒç»„ä»¶ï¼ˆæ€è€ƒ/æ‰§è¡Œ/æ€»ç»“ï¼‰</h4>
<h5 data-id="heading-13">1. å·¥å…·æ³¨å†Œè¡¨ <code>AgentToolRegistry</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.beans.BeansException;
<span class="hljs-keyword">import</span> org.springframework.context.ApplicationContext;
<span class="hljs-keyword">import</span> org.springframework.context.ApplicationContextAware;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> javax.annotation.PostConstruct;
<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * Agentå·¥å…·æ³¨å†Œè¡¨ï¼ˆå•ä¾‹ï¼‰
 * è‡ªåŠ¨æ‰«æSpringå®¹å™¨ä¸­æ‰€æœ‰AgentToolå®ç°ç±»ï¼Œç»Ÿä¸€ç®¡ç†ã€æŒ‰éœ€è·å–
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentToolRegistry</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationContextAware</span> {
    <span class="hljs-comment">// æ ¸å¿ƒæ˜ å°„ï¼šå·¥å…·åç§° â†’ å·¥å…·å®ä¾‹ï¼ˆå…¨å±€å”¯ä¸€ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, AgentTool&gt; toolName2InstanceMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">8</span>);

    <span class="hljs-comment">// Springä¸Šä¸‹æ–‡ï¼Œç”¨äºæ‰«æå·¥å…·å®ç°ç±»</span>
    <span class="hljs-keyword">private</span> ApplicationContext applicationContext;

    <span class="hljs-comment">/**
     * æ ¹æ®å·¥å…·åç§°è·å–å·¥å…·å®ä¾‹ï¼ˆæ ¸å¿ƒå¯¹å¤–æ–¹æ³•ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> AgentTool <span class="hljs-title function_">getToolByToolName</span><span class="hljs-params">(String toolName)</span> {
        <span class="hljs-keyword">if</span> (toolName == <span class="hljs-literal">null</span> || toolName.isBlank()) {
            log.warn(<span class="hljs-string">"å·¥å…·åç§°ä¸ºç©ºï¼Œæ— æ³•è·å–å·¥å…·å®ä¾‹"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> toolName2InstanceMap.get(toolName);
    }

    <span class="hljs-comment">/**
     * è·å–æ‰€æœ‰å·¥å…·çš„ã€Œåç§°-æè¿°ã€æ˜ å°„ï¼ˆç»™æ€è€ƒå™¨Promptä½¿ç”¨ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> Map&lt;String, String&gt; <span class="hljs-title function_">getAllToolNameAndDesc</span><span class="hljs-params">()</span> {
        Map&lt;String, String&gt; toolName2DescMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(toolName2InstanceMap.size());
        toolName2InstanceMap.forEach((toolName, toolInstance) -&gt; 
                toolName2DescMap.put(toolName, toolInstance.toolDesc()));
        <span class="hljs-keyword">return</span> toolName2DescMap;
    }

    <span class="hljs-comment">// ======================== Springç”Ÿå‘½å‘¨æœŸæ–¹æ³• ========================</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setApplicationContext</span><span class="hljs-params">(ApplicationContext applicationContext)</span> <span class="hljs-keyword">throws</span> BeansException {
        <span class="hljs-built_in">this</span>.applicationContext = applicationContext;
    }

    <span class="hljs-comment">/**
     * é¡¹ç›®å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œï¼šæ‰«æ+æ³¨å†Œæ‰€æœ‰AgentToolå·¥å…·
     */</span>
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initToolRegistry</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 1. æ‰«æå®¹å™¨ä¸­æ‰€æœ‰AgentToolå®ç°ç±»</span>
        Map&lt;String, AgentTool&gt; springBeanToolMap = applicationContext.getBeansOfType(AgentTool.class);
        <span class="hljs-keyword">if</span> (springBeanToolMap.isEmpty()) {
            log.warn(<span class="hljs-string">"ã€Agentå·¥å…·æ³¨å†Œè¡¨ã€‘æœªæ‰«æåˆ°ä»»ä½•AgentToolæ¥å£å®ç°ç±»ï¼Œæ™ºèƒ½ä½“åŠŸèƒ½å°†ä¸å¯ç”¨"</span>);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-comment">// 2. æ³¨å†Œå·¥å…·ï¼Œæ ¡éªŒå·¥å…·åç§°å”¯ä¸€æ€§</span>
        springBeanToolMap.forEach((beanName, toolInstance) -&gt; {
            <span class="hljs-type">String</span> <span class="hljs-variable">businessToolName</span> <span class="hljs-operator">=</span> toolInstance.toolName();
            <span class="hljs-keyword">if</span> (businessToolName == <span class="hljs-literal">null</span> || businessToolName.isBlank()) {
                log.error(<span class="hljs-string">"ã€Agentå·¥å…·æ³¨å†Œè¡¨ã€‘å·¥å…·Bean[{}]çš„toolName()è¿”å›ç©ºï¼Œæ‹’ç»æ³¨å†Œ"</span>, beanName);
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-keyword">if</span> (toolName2InstanceMap.containsKey(businessToolName)) {
                log.error(<span class="hljs-string">"ã€Agentå·¥å…·æ³¨å†Œè¡¨ã€‘å·¥å…·åç§°[{}]é‡å¤ï¼Œå·²å­˜åœ¨åŒåå·¥å…·ï¼Œæ‹’ç»æ³¨å†ŒBean[{}]"</span>, 
                        businessToolName, beanName);
                <span class="hljs-keyword">return</span>;
            }
            toolName2InstanceMap.put(businessToolName, toolInstance);
            log.info(<span class="hljs-string">"ã€Agentå·¥å…·æ³¨å†Œè¡¨ã€‘å·¥å…·æ³¨å†ŒæˆåŠŸ â†’ å·¥å…·åï¼š{}ï¼ŒSpringBeanåï¼š{}"</span>, businessToolName, beanName);
        });
        log.info(<span class="hljs-string">"ã€Agentå·¥å…·æ³¨å†Œè¡¨ã€‘åˆå§‹åŒ–å®Œæˆ âœ…ï¼Œå…±æ³¨å†Œ{}ä¸ªå¯ç”¨å·¥å…·"</span>, toolName2InstanceMap.size());
    }
}
</code></pre>
<h5 data-id="heading-14">2. æ€è€ƒå™¨ <code>AgentThinker</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.alibaba.fastjson2.JSONArray;
<span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.model.ChatModel;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.prompt.Prompt;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-comment">/**
 * æ™ºèƒ½ä½“æ€è€ƒå™¨ï¼ˆæ ¸å¿ƒå¤§è„‘ï¼‰
 * èŒè´£ï¼šæ¥æ”¶ç”¨æˆ·é—®é¢˜ â†’ åˆ†ææ„å›¾ â†’ å†³ç­–ã€Œç›´æ¥å›ç­”/è°ƒç”¨å·¥å…·ã€â†’ è¿”å›æ ‡å‡†åŒ–å†³ç­–ç»“æœ
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentThinker</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ChatModel ollamaChatModel;  <span class="hljs-comment">// ç»Ÿä¸€ä½¿ç”¨Spring AIæ ‡å‡†ChatModelï¼Œé€‚é…ä»»æ„å¤§æ¨¡å‹</span>

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AgentToolRegistry agentToolRegistry;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AgentResultCleanUtils agentResultCleanUtils;

    <span class="hljs-comment">/**
     * æ ¸å¿ƒæ€è€ƒæ–¹æ³•
     * <span class="hljs-doctag">@param</span> query  ç”¨æˆ·é—®é¢˜
     * <span class="hljs-doctag">@param</span> sessionId ä¼šè¯ID
     * <span class="hljs-doctag">@return</span> æ ‡å‡†åŒ–å†³ç­–ç»“æœåˆ—è¡¨
     */</span>
    <span class="hljs-keyword">public</span> List&lt;ThinkResult&gt; <span class="hljs-title function_">think</span><span class="hljs-params">(String query, String sessionId)</span> {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"ã€æ™ºèƒ½ä½“æ€è€ƒå™¨ã€‘å¼€å§‹æ€è€ƒï¼Œä¼šè¯IDï¼š{}ï¼Œç”¨æˆ·é—®é¢˜ï¼š{}"</span>, sessionId, query);
            
            <span class="hljs-comment">// 1. æ‹¼æ¥æ‰€æœ‰å·¥å…·çš„åç§°+æè¿°ï¼Œä¼ å…¥Prompt</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">toolDescs</span> <span class="hljs-operator">=</span> agentToolRegistry.getAllToolNameAndDesc().entrySet().stream()
                    .map(entry -&gt; <span class="hljs-string">"ğŸ”§"</span> + entry.getKey() + <span class="hljs-string">"ï¼š"</span> + entry.getValue())
                    .collect(Collectors.joining(<span class="hljs-string">"\n"</span>));

            <span class="hljs-comment">// 2. ä¼˜åŒ–ç‰ˆæ ¸å¿ƒPromptï¼ˆå…³é”®å‡çº§ï¼šæ ¼å¼å¼ºåˆ¶çº¦æŸ+å†³ç­–é€»è¾‘å¼•å¯¼+å®¹é”™æ€§æå‡ï¼‰</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">prompt</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
                    ä½ æ˜¯çŸ¥ç­–æ™ºèƒ½ä½“çš„ä¸“ä¸šæ€è€ƒå™¨ï¼Œæ‹¥æœ‰ç²¾å‡†çš„å·¥å…·è°ƒç”¨å†³ç­–èƒ½åŠ›ï¼Œä¸¥æ ¼éµå®ˆä»¥ä¸‹è§„åˆ™å®Œæˆä»»åŠ¡ï¼š
                    ===================== å¯ç”¨å·¥å…·åˆ—è¡¨ =====================
                    %s
                    ===================== å†³ç­–è§„åˆ™ =====================
                    1. åˆ†æç”¨æˆ·é—®é¢˜ï¼Œä»…ä¸¤ç§å†³ç­–ç»“æœï¼šèƒ½é€šè¿‡å¸¸è¯†ç›´æ¥å›ç­”çš„ç”¨DIRECT_ANSWERï¼Œéœ€è¦çŸ¥è¯†åº“å†…å®¹çš„å¿…é¡»ç”¨TOOL_CALLï¼›
                    2. æŠ€æœ¯é—®é¢˜ã€äº§å“é—®é¢˜ã€ä¸šåŠ¡æ•°æ®é—®é¢˜ï¼Œ**å¿…é¡»è°ƒç”¨ã€çŸ¥è¯†åº“æ£€ç´¢å·¥å…·ã€‘**ï¼Œç¦æ­¢ç›´æ¥å›ç­”ï¼›
                    3. å¤©æ°”ã€æ—¥æœŸã€é€šç”¨å¸¸è¯†ç­‰æ— çŸ¥è¯†åº“ä¾èµ–çš„é—®é¢˜ï¼Œç›´æ¥è¿”å›ç­”æ¡ˆï¼Œæ— éœ€è°ƒç”¨å·¥å…·ï¼›
                    ===================== è¾“å‡ºæ ¼å¼ï¼ˆå¼ºåˆ¶éµå®ˆï¼Œå¦åˆ™å¤±æ•ˆï¼‰ =====================
                    âœ… æ ¼å¼è¦æ±‚1ï¼šä»…è¿”å›JSONæ•°ç»„ï¼Œå‰åæ— ä»»ä½•å¤šä½™å­—ç¬¦ã€æ— ```json/```æ ‡è®°ï¼›
                    âœ… æ ¼å¼è¦æ±‚2ï¼šè°ƒç”¨å·¥å…·å›ºå®šæ ¼å¼ï¼š[{"action":"TOOL_CALL","tool_name":"å·¥å…·åç§°","tool_params":{"query":"ç”¨æˆ·åŸå§‹é—®é¢˜","sessionId":"%s"}}]
                    âœ… æ ¼å¼è¦æ±‚3ï¼šç›´æ¥å›ç­”å›ºå®šæ ¼å¼ï¼š[{"action":"DIRECT_ANSWER","content":"ä½ çš„ç²¾å‡†ç­”æ¡ˆå†…å®¹"}]
                    âœ… æ ¼å¼è¦æ±‚4ï¼šJSONå­—æ®µåä¸¥æ ¼å¤§å°å†™ä¸€è‡´ï¼Œæ— æ‹¼å†™é”™è¯¯ï¼›
                    ===================== ç”¨æˆ·é—®é¢˜ =====================
                    %s
                    """</span>.formatted(toolDescs, sessionId, query);

            <span class="hljs-comment">// 3. è°ƒç”¨å¤§æ¨¡å‹è·å–å†³ç­–ç»“æœï¼Œå¹¶æ¸…æ´—æ ¼å¼</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">rawThinkContent</span> <span class="hljs-operator">=</span> ollamaChatModel.call(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Prompt</span>(prompt))
                    .getResult().getOutput().getText();
            <span class="hljs-type">String</span> <span class="hljs-variable">cleanContent</span> <span class="hljs-operator">=</span> agentResultCleanUtils.cleanAndStandardize(rawThinkContent);
            log.info(<span class="hljs-string">"ã€æ™ºèƒ½ä½“æ€è€ƒå™¨ã€‘å†³ç­–ç»“æœå·²æ¸…æ´—ï¼Œä¼šè¯IDï¼š{}ï¼Œæ¸…æ´—åå†…å®¹ï¼š{}"</span>, sessionId, cleanContent);

            <span class="hljs-comment">// 4. è§£æJSONä¸ºæ ‡å‡†åŒ–ThinkResult</span>
            <span class="hljs-keyword">return</span> parseThinkResult(cleanContent);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ã€æ™ºèƒ½ä½“æ€è€ƒå™¨ã€‘æ€è€ƒå¤±è´¥ï¼Œä¼šè¯IDï¼š{}"</span>, sessionId, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"æ™ºèƒ½ä½“å†³ç­–å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"</span>, e);
        }
    }

    <span class="hljs-comment">/**
     * è§£æå¤§æ¨¡å‹å†³ç­–ç»“æœï¼Œé€‚é…å¼‚å¸¸åœºæ™¯
     */</span>
    <span class="hljs-keyword">private</span> List&lt;ThinkResult&gt; <span class="hljs-title function_">parseThinkResult</span><span class="hljs-params">(String content)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (content.isBlank()) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"å¤§æ¨¡å‹è¿”å›å†³ç­–å†…å®¹ä¸ºç©º"</span>);
            }
            <span class="hljs-type">JSONArray</span> <span class="hljs-variable">jsonArray</span> <span class="hljs-operator">=</span> JSONArray.parseArray(content);
            <span class="hljs-keyword">return</span> jsonArray.toJavaList(ThinkResult.class);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ã€æ™ºèƒ½ä½“æ€è€ƒå™¨ã€‘å†³ç­–ç»“æœè§£æå¤±è´¥ï¼Œå†…å®¹ï¼š{}"</span>, content, e);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"å†³ç­–ç»“æœæ ¼å¼å¼‚å¸¸ï¼Œæ— æ³•è§£æ"</span>, e);
        }
    }
}
</code></pre>
<h5 data-id="heading-15">3. æ‰§è¡Œå™¨ <code>AgentExecutor</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-comment">/**
 * æ™ºèƒ½ä½“æ‰§è¡Œå™¨
 * èŒè´£ï¼šæ¥æ”¶æ€è€ƒå™¨å†³ç­–ç»“æœ â†’ è°ƒåº¦å¯¹åº”å·¥å…·æ‰§è¡Œ â†’ è¿”å›å·¥å…·åŸå§‹ç»“æœ
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentExecutor</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AgentToolRegistry agentToolRegistry;

    <span class="hljs-comment">/**
     * æ‰§è¡Œå·¥å…·è°ƒç”¨
     */</span>
    <span class="hljs-keyword">public</span> ToolResult <span class="hljs-title function_">execute</span><span class="hljs-params">(ThinkResult thinkResult)</span> {
        <span class="hljs-comment">// éå·¥å…·è°ƒç”¨ï¼Œç›´æ¥è¿”å›å¤±è´¥</span>
        <span class="hljs-keyword">if</span> (!thinkResult.isToolCall()) {
            <span class="hljs-type">String</span> <span class="hljs-variable">errorMsg</span> <span class="hljs-operator">=</span> <span class="hljs-string">"æ‰§è¡Œå™¨æ‹’ç»æ‰§è¡Œï¼šå½“å‰å†³ç­–ä¸ºç›´æ¥å›ç­”ï¼Œæ— éœ€è°ƒç”¨å·¥å…·"</span>;
            log.warn(errorMsg);
            <span class="hljs-keyword">return</span> ToolResult.fail(errorMsg);
        }

        <span class="hljs-comment">// 1. è·å–ç›®æ ‡å·¥å…·å®ä¾‹</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">targetToolName</span> <span class="hljs-operator">=</span> thinkResult.getToolName();
        <span class="hljs-type">AgentTool</span> <span class="hljs-variable">targetTool</span> <span class="hljs-operator">=</span> agentToolRegistry.getToolByToolName(targetToolName);
        <span class="hljs-keyword">if</span> (targetTool == <span class="hljs-literal">null</span>) {
            <span class="hljs-type">String</span> <span class="hljs-variable">errorMsg</span> <span class="hljs-operator">=</span> <span class="hljs-string">"æ‰§è¡Œå¤±è´¥ï¼šæœªæ‰¾åˆ°æŒ‡å®šå·¥å…·ã€"</span> + targetToolName + <span class="hljs-string">"ã€‘ï¼Œè¯·æ£€æŸ¥å·¥å…·æ³¨å†ŒçŠ¶æ€"</span>;
            log.error(errorMsg);
            <span class="hljs-keyword">return</span> ToolResult.fail(errorMsg);
        }

        <span class="hljs-comment">// 2. æ„å»ºæ ‡å‡†åŒ–å·¥å…·å…¥å‚</span>
        <span class="hljs-type">ToolParam</span> <span class="hljs-variable">toolParam</span> <span class="hljs-operator">=</span> ToolParam.builder()
                .query(thinkResult.getToolParams().getOrDefault(<span class="hljs-string">"query"</span>, <span class="hljs-string">""</span>).toString())
                .sessionId(thinkResult.getToolParams().getOrDefault(<span class="hljs-string">"sessionId"</span>, <span class="hljs-string">""</span>).toString())
                .params(thinkResult.getToolParams())
                .build();
        
        log.info(<span class="hljs-string">"ã€æ™ºèƒ½ä½“æ‰§è¡Œå™¨ã€‘å¼€å§‹æ‰§è¡Œå·¥å…·ï¼Œå·¥å…·åç§°ï¼š{}ï¼Œä¼šè¯IDï¼š{}"</span>, targetToolName, toolParam.getSessionId());
        
        <span class="hljs-comment">// 3. æ‰§è¡Œå·¥å…·å¹¶è¿”å›ç»“æœ</span>
        <span class="hljs-keyword">return</span> targetTool.execute(toolParam);
    }
}
</code></pre>
<h5 data-id="heading-16">4. æ€»ç»“å™¨ <code>AgentSummarizer</code></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.model.ChatModel;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.prompt.Prompt;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-comment">/**
 * æ™ºèƒ½ä½“æ€»ç»“å™¨ï¼ˆç­”æ¡ˆç”Ÿæˆæ ¸å¿ƒï¼‰
 * èŒè´£ï¼šæ¥æ”¶å·¥å…·åŸå§‹ç»“æœ â†’ ç»“åˆç”¨æˆ·é—®é¢˜/ä¸Šä¸‹æ–‡ â†’ ç”Ÿæˆã€Œç²¾å‡†ã€è§„èŒƒã€å¸¦æº¯æºã€çš„æœ€ç»ˆç­”æ¡ˆ
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentSummarizer</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> ChatModel ollamaChatModel;

    <span class="hljs-comment">// ========== å¯æ³¨å…¥ä½ ç°æœ‰ä¸Šä¸‹æ–‡ç®¡ç†ç»„ä»¶ï¼Œå®ç°å¤šè½®å¯¹è¯ ==========</span>
    <span class="hljs-comment">// @Autowired</span>
    <span class="hljs-comment">// private ContextManager contextManager;</span>

    <span class="hljs-comment">/**
     * æ ¸å¿ƒæ€»ç»“æ–¹æ³•
     * <span class="hljs-doctag">@param</span> query ç”¨æˆ·é—®é¢˜
     * <span class="hljs-doctag">@param</span> toolResult å·¥å…·æ‰§è¡ŒåŸå§‹ç»“æœ
     * <span class="hljs-doctag">@param</span> sessionId ä¼šè¯ID
     * <span class="hljs-doctag">@return</span> æ ‡å‡†åŒ–æœ€ç»ˆç­”æ¡ˆ
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">summarize</span><span class="hljs-params">(String query, String toolResult, String sessionId)</span> {
        <span class="hljs-keyword">try</span> {
            log.info(<span class="hljs-string">"ã€æ™ºèƒ½ä½“æ€»ç»“å™¨ã€‘å¼€å§‹ç”Ÿæˆç­”æ¡ˆï¼Œä¼šè¯IDï¼š{}"</span>, sessionId);
            
            <span class="hljs-comment">// 1. è·å–å¯¹è¯ä¸Šä¸‹æ–‡ï¼ˆå¦‚éœ€å¤šè½®å¯¹è¯ï¼Œæ‰“å¼€æ³¨é‡Šå³å¯ï¼‰</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">historyContext</span> <span class="hljs-operator">=</span> <span class="hljs-string">""</span>;
            <span class="hljs-comment">// String historyContext = contextManager.getHistory(sessionId, 5); // è·å–æœ€è¿‘5è½®ä¸Šä¸‹æ–‡</span>

            <span class="hljs-comment">// 2. è¡Œä¸šçº§ä¼˜åŒ–Promptï¼ˆæ ¸å¿ƒå‡çº§ï¼šç­”æ¡ˆè´¨é‡+æ ¼å¼+æº¯æº+å®¹é”™æ€§ï¼‰</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">prompt</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
                    ä½ æ˜¯çŸ¥ç­–æ™ºèƒ½ä½“çš„ä¸“ä¸šæ€»ç»“å¸ˆï¼Œå…·å¤‡æå¼ºçš„ä¿¡æ¯æ•´åˆä¸ç­”æ¡ˆç”Ÿæˆèƒ½åŠ›ï¼Œä¸¥æ ¼æŒ‰è¦æ±‚å®Œæˆå›ç­”ï¼š
                    ===================== åŸºç¡€ä¿¡æ¯ =====================
                    ã€å·¥å…·æ£€ç´¢ç»“æœã€‘ï¼š%s
                    ã€å†å²å¯¹è¯ä¸Šä¸‹æ–‡ã€‘ï¼š%s
                    ã€ç”¨æˆ·å½“å‰é—®é¢˜ã€‘ï¼š%s
                    ===================== å›ç­”å¼ºåˆ¶è¦æ±‚ï¼ˆå¿…é¡»å…¨éƒ¨éµå®ˆï¼‰ =====================
                    1. æ•°æ®æ¥æºï¼šä»…åŸºäºã€å·¥å…·æ£€ç´¢ç»“æœã€‘å’Œã€å†å²ä¸Šä¸‹æ–‡ã€‘ä½œç­”ï¼Œä¸¥ç¦ç¼–é€ ä»»ä½•ä¿¡æ¯ï¼›æ— ç›¸å…³å†…å®¹æ—¶ï¼Œä»…è¿”å›ã€Œæš‚æ— ç›¸å…³ç­”æ¡ˆã€ï¼›
                    2. å†…å®¹è§„èŒƒï¼šè¯­è¨€ç®€æ´ã€é€»è¾‘æ¸…æ™°ã€é‡ç‚¹çªå‡ºï¼›æŠ€æœ¯é—®é¢˜åˆ†ç‚¹ä½œç­”ï¼ˆç”¨1/2/3ï¼‰ï¼Œäº§å“/ä¸šåŠ¡é—®é¢˜æ®µè½å¼ä½œç­”ï¼›
                    3. æº¯æºå¿…ç°ï¼šæ‰€æœ‰ç­”æ¡ˆæœ«å°¾å¿…é¡»é™„å¸¦ã€æº¯æºä¿¡æ¯ã€‘ï¼Œæ ¼å¼ç»Ÿä¸€ä¸ºã€ŒğŸ‘‰ æ¥æºï¼šXXXæ–‡æ¡£ | å·¥ä½œè¡¨X è¡ŒXã€ï¼›
                    4. æ ¼å¼è¦æ±‚ï¼šæ— å¤šä½™æ¢è¡Œã€æ— markdownæ ‡è®°ï¼Œçº¯æ–‡æœ¬è¾“å‡ºï¼Œé€‚é…å‰ç«¯ç›´æ¥å±•ç¤ºï¼›
                    5. å®¹é”™å¤„ç†ï¼šå·¥å…·ç»“æœä¸ºã€Œæš‚æ— åŒ¹é…å†…å®¹ã€æ—¶ï¼Œç›´æ¥è¿”å›ã€Œæš‚æ— ç›¸å…³ç­”æ¡ˆã€ï¼Œæ— éœ€é¢å¤–è¡¥å……ã€‚
                    ===================== è¾“å‡ºè¦æ±‚ =====================
                    ç›´æ¥è¿”å›æœ€ç»ˆç­”æ¡ˆï¼Œæ— ä»»ä½•å‰ç½®/åç½®å¤šä½™å­—ç¬¦ï¼
                    """</span>.formatted(toolResult, historyContext, query);

            <span class="hljs-comment">// 3. è°ƒç”¨å¤§æ¨¡å‹ç”Ÿæˆç­”æ¡ˆå¹¶è¿”å›</span>
            <span class="hljs-keyword">return</span> ollamaChatModel.call(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Prompt</span>(prompt))
                    .getResult().getOutput().getText().trim();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ã€æ™ºèƒ½ä½“æ€»ç»“å™¨ã€‘ç”Ÿæˆç­”æ¡ˆå¤±è´¥ï¼Œä¼šè¯IDï¼š{}"</span>, sessionId, e);
            <span class="hljs-keyword">return</span> <span class="hljs-string">"å¾ˆæŠ±æ­‰ï¼Œç”Ÿæˆç­”æ¡ˆå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ï¼"</span>;
        }
    }
}
</code></pre>
<h4 data-id="heading-17">ã€æ¥å…¥å±‚ã€‘æ™ºèƒ½ä½“å¯¹è¯æ¥å£</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.validation.annotation.Validated;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.PostMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestBody;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * çŸ¥ç­–æ™ºèƒ½ä½“å¯¹å¤–ç»Ÿä¸€æ¥å£
 * æä¾›ä¸€ç«™å¼å¯¹è¯èƒ½åŠ›ï¼Œå°è£…ã€Œæ€è€ƒâ†’æ‰§è¡Œâ†’æ€»ç»“ã€å®Œæ•´é“¾è·¯
 */</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/agent")</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentController</span> {

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AgentThinker agentThinker;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AgentExecutor agentExecutor;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> AgentSummarizer agentSummarizer;

    <span class="hljs-comment">/**
     * æ™ºèƒ½ä½“æ ¸å¿ƒå¯¹è¯æ¥å£
     */</span>
    <span class="hljs-meta">@PostMapping("/chat")</span>
    <span class="hljs-keyword">public</span> Result&lt;String&gt; <span class="hljs-title function_">chat</span><span class="hljs-params">(<span class="hljs-meta">@Validated</span> <span class="hljs-meta">@RequestBody</span> AgentChatParam param)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">String</span> <span class="hljs-variable">query</span> <span class="hljs-operator">=</span> param.getQuery();
            <span class="hljs-type">String</span> <span class="hljs-variable">sessionId</span> <span class="hljs-operator">=</span> param.getSessionId();
            log.info(<span class="hljs-string">"ã€æ™ºèƒ½ä½“å¯¹è¯æ¥å£ã€‘æ¥æ”¶è¯·æ±‚ï¼Œä¼šè¯IDï¼š{}ï¼Œç”¨æˆ·é—®é¢˜ï¼š{}"</span>, sessionId, query);
            
            <span class="hljs-comment">// ========== æ­¥éª¤1ï¼šæ€è€ƒå™¨å†³ç­– ==========</span>
            List&lt;ThinkResult&gt; thinkResults = agentThinker.think(query, sessionId);
            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">toolResultSb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();

            <span class="hljs-comment">// ========== æ­¥éª¤2ï¼šæ‰§è¡Œå™¨è°ƒåº¦å·¥å…· / ç›´æ¥è·å–ç­”æ¡ˆ ==========</span>
            <span class="hljs-keyword">for</span> (ThinkResult thinkResult : thinkResults) {
                <span class="hljs-keyword">if</span> (thinkResult.isDirectAnswer()) {
                    <span class="hljs-comment">// ç›´æ¥å›ç­”ï¼Œæ— éœ€è°ƒç”¨å·¥å…·</span>
                    toolResultSb.append(thinkResult.getContent());
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-comment">// è°ƒç”¨å·¥å…·ï¼Œè·å–åŸå§‹ç»“æœ</span>
                    <span class="hljs-type">ToolResult</span> <span class="hljs-variable">toolResult</span> <span class="hljs-operator">=</span> agentExecutor.execute(thinkResult);
                    <span class="hljs-keyword">if</span> (toolResult.isSuccess()) {
                        toolResultSb.append(toolResult.getContent());
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">"å·¥å…·æ‰§è¡Œå¤±è´¥ï¼š"</span> + toolResult.getErrorMsg());
                    }
                }
            }

            <span class="hljs-comment">// ========== æ­¥éª¤3ï¼šæ€»ç»“å™¨ç”Ÿæˆæœ€ç»ˆç­”æ¡ˆ ==========</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">finalAnswer</span> <span class="hljs-operator">=</span> agentSummarizer.summarize(query, toolResultSb.toString(), sessionId);
            log.info(<span class="hljs-string">"ã€æ™ºèƒ½ä½“å¯¹è¯æ¥å£ã€‘å¤„ç†å®Œæˆï¼Œä¼šè¯IDï¼š{}ï¼Œæœ€ç»ˆç­”æ¡ˆï¼š{}"</span>, sessionId, finalAnswer);
            
            <span class="hljs-keyword">return</span> Result.success(finalAnswer);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"ã€æ™ºèƒ½ä½“å¯¹è¯æ¥å£ã€‘å¤„ç†å¤±è´¥ï¼Œå‚æ•°ï¼š{}"</span>, param, e);
            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">"æ™ºèƒ½ä½“å¯¹è¯å¤±è´¥ï¼š"</span> + e.getMessage());
        }
    }
}
</code></pre>
<h3 data-id="heading-18">ä¸‰ã€æ‰©å±•èƒ½åŠ›è¯´æ˜ï¼ˆæŒ‰éœ€å¯ç”¨ï¼‰</h3>
<h4 data-id="heading-19">ğŸš€ æ‰©å±•1ï¼šå¤šå·¥å…·æ”¯æŒï¼ˆå¦‚æ–‡æœ¬æ€»ç»“ã€ç¿»è¯‘å·¥å…·ï¼‰</h4>
<p>åªéœ€æ–°å»ºç±»å®ç°<code>AgentTool</code>æ¥å£ï¼ŒSpringå¯åŠ¨æ—¶ä¼š<strong>è‡ªåŠ¨æ³¨å†Œ</strong>åˆ°æ³¨å†Œè¡¨ï¼Œæ€è€ƒå™¨å¯è‡ªåŠ¨è¯†åˆ«å¹¶å†³ç­–è°ƒç”¨ï¼Œç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextSummaryTool</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AgentTool</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toolName</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-string">"æ–‡æœ¬æ€»ç»“å·¥å…·"</span>; }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">toolDesc</span><span class="hljs-params">()</span> { <span class="hljs-keyword">return</span> <span class="hljs-string">"ç”¨äºé•¿æ–‡æœ¬æ€»ç»“ï¼Œè¾“å…¥é•¿æ–‡æœ¬ï¼Œè¾“å‡ºæ ¸å¿ƒæ‘˜è¦"</span>; }
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ToolResult <span class="hljs-title function_">execute</span><span class="hljs-params">(ToolParam param)</span> { <span class="hljs-comment">/* å®ç°é€»è¾‘ */</span> }
}
</code></pre>
<h4 data-id="heading-20">ğŸš€ æ‰©å±•2ï¼šå¤šè½®å¯¹è¯èƒ½åŠ›</h4>
<p>å¯ç”¨ä¸Šä¸‹æ–‡ç®¡ç†ï¼Œåªéœ€æ³¨å…¥ä½ çš„<code>ContextManager</code>ï¼Œå¹¶åœ¨æ€»ç»“å™¨ä¸­æ‰“å¼€<code>historyContext</code>æ³¨é‡Šå³å¯ï¼Œæ— éœ€ä¿®æ”¹å…¶ä»–ä»£ç ã€‚</p>
<h4 data-id="heading-21">ğŸš€ æ‰©å±•3ï¼šå¤§æ¨¡å‹æ— ç¼æ›¿æ¢</h4>
<p>é¡¹ç›®ä¸­ç»Ÿä¸€ä½¿ç”¨Spring AIçš„<code>ChatModel</code>æ¥å£ï¼Œæ›¿æ¢æ¨¡å‹æ—¶åªéœ€<strong>ä¿®æ”¹é…ç½®æ–‡ä»¶</strong>ï¼Œæ— éœ€æ”¹åŠ¨ä¸šåŠ¡ä»£ç ï¼Œæ”¯æŒï¼š</p>
<ul>
<li>Ollamaæœ¬åœ°æ¨¡å‹ï¼ˆnomic-embed-textã€llama3ï¼‰</li>
<li>è¿œç¨‹å¤§æ¨¡å‹ï¼ˆDeepSeekã€OpenAIã€æ–‡å¿ƒä¸€è¨€ï¼‰</li>
</ul>
<h4 data-id="heading-22">ğŸš€ æ‰©å±•4ï¼šå·¥å…·è°ƒç”¨æƒé™æ§åˆ¶</h4>
<p>å¯åœ¨æ³¨å†Œè¡¨ä¸­æ–°å¢å·¥å…·æƒé™æ ‡è¯†ï¼Œåœ¨æ‰§è¡Œå™¨ä¸­æ ¡éªŒç”¨æˆ·æƒé™ï¼Œå®ç°<strong>ç²¾ç»†åŒ–å·¥å…·è°ƒåº¦æ§åˆ¶</strong>ã€‚</p>
<h3 data-id="heading-23">å››ã€éƒ¨ç½²ä¸ä½¿ç”¨è¯´æ˜</h3>
<ol>
<li><strong>ä¾èµ–ç¡®è®¤</strong>ï¼šç¡®ä¿é¡¹ç›®ä¸­å·²å¼•å…¥<code>easyexcel</code>ã€<code>spring-ai-ollama</code>ã€<code>elasticsearch</code>ã€<code>fastjson2</code>æ ¸å¿ƒä¾èµ–</li>
<li><strong>é…ç½®ç¡®è®¤</strong>ï¼šé…ç½®Ollamaåœ°å€ã€ESåœ°å€ã€å‘é‡ç´¢å¼•åç§°ï¼Œä¸ç°æœ‰çŸ¥è¯†åº“é“¾è·¯ä¿æŒä¸€è‡´</li>
<li><strong>å¯åŠ¨éªŒè¯</strong>ï¼šé¡¹ç›®å¯åŠ¨åï¼Œæ§åˆ¶å°ä¼šæ‰“å°<code>Agentå·¥å…·æ³¨å†Œè¡¨åˆå§‹åŒ–å®Œæˆï¼Œå…±æ³¨å†ŒXä¸ªå·¥å…·</code>ï¼Œè¯´æ˜å·¥å…·æ³¨å†ŒæˆåŠŸ</li>
<li><strong>æ¥å£è°ƒç”¨</strong>ï¼šPOSTè¯·æ±‚<code>/agent/chat</code>ï¼Œå…¥å‚ç¤ºä¾‹ï¼š</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"query"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"äº§å“çš„æ ¸å¿ƒåŠŸèƒ½æœ‰å“ªäº›ï¼Ÿ"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"sessionId"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user_123456_20260105"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-24">äº”ã€æ ¸å¿ƒäº®ç‚¹æ€»ç»“</h3>
<p>âœ… æ¶æ„è§£è€¦ï¼šæ€è€ƒ/æ‰§è¡Œ/æ€»ç»“/å·¥å…·å››å±‚æ¶æ„ï¼ŒèŒè´£æ¸…æ™°ã€å¯ç‹¬ç«‹æ‰©å±•
âœ… æ ‡å‡†è§„èŒƒï¼šå·¥å…·æ ‡å‡†åŒ–æ¥å£ï¼Œæ–°å¢å·¥å…·é›¶ä¾µå…¥
âœ… ç”Ÿäº§å¯ç”¨ï¼šå…¨é“¾è·¯å¼‚å¸¸å¤„ç†ã€æ—¥å¿—è§„èŒƒã€å‚æ•°æ ¡éªŒï¼Œæ»¡è¶³ç”Ÿäº§çº§è¦æ±‚
âœ… æ•ˆæœä¿éšœï¼šä¼˜åŒ–ç‰ˆPromptå·¥ç¨‹ï¼Œæå‡å†³ç­–å‡†ç¡®æ€§ä¸ç­”æ¡ˆè´¨é‡
âœ… æ— ç¼é€‚é…ï¼šå®Œç¾è¡”æ¥ç°æœ‰çŸ¥è¯†åº“ã€æ··åˆæ£€ç´¢ã€å‘é‡åŒ–é“¾è·¯</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æœ€è¿‘å¾ˆç«çˆ†çš„Claude Skillsåˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿæ€ä¹ˆç”¨ï¼]]></title>    <link>https://juejin.cn/post/7591382440581578792</link>    <guid>https://juejin.cn/post/7591382440581578792</guid>    <pubDate>2026-01-05T00:52:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591382440581578792" data-draft-id="7591156262626705443" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æœ€è¿‘å¾ˆç«çˆ†çš„Claude Skillsåˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿæ€ä¹ˆç”¨ï¼"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2026-01-05T00:52:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç‹‚å¸ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/3368559359298984"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æœ€è¿‘å¾ˆç«çˆ†çš„Claude Skillsåˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿæ€ä¹ˆç”¨ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3368559359298984/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç‹‚å¸ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:52:38.000Z" title="Mon Jan 05 2026 00:52:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸Šä¸€ç¯‡ï¼Œæˆ‘ä»¬ä»‹ç»äº†ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FPyqhVgbkNBzd7grKN5IxgQ" target="_blank" title="https://mp.weixin.qq.com/s/PyqhVgbkNBzd7grKN5IxgQ" ref="nofollow noopener noreferrer">Claude Code ä½¿ç”¨æŠ€å·§ï¼å®æµ‹æœ‰æ•ˆï¼Claude Code æ¥å…¥GLM 4.7</a></p>
<p>æœ€è¿‘ AI åœˆå­é‡Œä»€ä¹ˆæœ€ç«ï¼Ÿé™¤äº†å„ç§ AI å¤§æ¨¡å‹çš„åº”ç”¨ï¼Œè®¨è®ºçƒ­åº¦æœ€é«˜çš„ç»å¯¹æ˜¯ <strong>Claude Skills</strong>ã€‚Anthropic 10æœˆåº•æ¨å‡ºè¿™ä¸ªåŠŸèƒ½ï¼Œ12æœˆåº•å½»åº•çˆ†ç«ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dc52295ea62423a90202453824b17f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uC5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179158&amp;x-signature=nCequMmAXK2mWiI5rIbO3jLKcaM%3D" alt="" loading="lazy"/></p>
<p>è¯´å®è¯ï¼Œè‡ªä»â€¯Claudeâ€¯æŠ€èƒ½ï¼ˆClaudeâ€¯Skillsï¼‰å‡ºæ¥ï¼Œå¾ˆå¤šæ–‡ç« é“ºå¤©ç›–åœ°ï¼Œæœ‰çš„æ–‡ç« å¤¸å®ƒæ˜¯â€œAIé©å‘½â€ï¼Œæœ‰çš„è¯´å®ƒèƒ½ä¼šå–ä»£XXXï¼Œè¿˜æœ‰äº›å¹²è„†åªè®²ä¸€å¤§å †çœ‹ä¸æ‡‚çš„ç†è®ºâ€¦â€¦</p>
<p>ä»Šå¤©æˆ‘ä»¬ï¼Œå°†ä»æ™®é€šç”¨æˆ·çš„è§†è§’ï¼ŒèŠèŠè¿™ä¸ªæœ€è¿‘ç«çˆ†çš„<code>Claude Skills</code>åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œè§£å†³ä»€ä¹ˆé—®é¢˜ï¼Œå’ŒMCPæœ‰ä»€ä¹ˆåŒºåˆ«ã€ä»å“ªé‡ŒæŸ¥æ‰¾Skillsã€‚</p>
<h3 data-id="heading-0">ä¸€ã€Claudeâ€¯Skillsâ€¯åˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿ</h3>
<p><strong>ç®€å•æ¥è¯´</strong>ï¼ŒğŸ‘‰â€¯å®ƒæ˜¯è®©â€¯Claudeâ€¯è®°ä½ä½ å¸Œæœ›å®ƒå¦‚ä½•å·¥ä½œï¼Œå¹¶èƒ½é•¿æœŸå¤ç”¨çš„è¯´æ˜æ–‡ä»¶ã€‚</p>
<p>åˆ©ç”¨Claudeâ€¯Skillsâ€¯**å¯ä»¥è®©æˆ‘ä»¬ä½¿ç”¨AIçš„ä¹ æƒ¯è¢«æ–‡ä»¶åŒ–ç®¡ç†ã€‚**ä½ çš„è¯­æ°”ã€é€»è¾‘ã€æµç¨‹éƒ½èƒ½è¢«æ‰“åŒ…æˆSkillsã€‚æœ¬è´¨ä¸Šå°±æ˜¯å°†â€œæ€ä¹ˆç”¨AIâ€ï¼Œå˜æˆè‡ªå·±çš„ä¸€å¥—å¯ä¿å­˜ã€å¯å¤ç”¨ã€å¯ä¿®æ”¹çš„æŒä¹…åŒ–æ–‡ä»¶èµ„äº§ã€‚</p>
<blockquote>
<p>ä¸€ä¸ª Skill = <code>ä»»åŠ¡è¯´æ˜ä¹¦ </code>+ <code>å·¥å…·ä»£ç </code>ï¼ˆå¯é€‰ï¼‰ + <code>ä¸“ä¸šçŸ¥è¯†</code>ï¼ˆå¯é€‰ï¼‰ + <code>ç´ æèµ„æº</code>ï¼ˆå¯é€‰ï¼‰</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fbc68cf662f49f4b50e1d7a895850e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uC5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179158&amp;x-signature=E1ujMqW%2FfxFLCo0eRl0V8l3nNRo%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-1">äºŒã€å®ƒèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3>
<p>ä¸ºä»€ä¹ˆå®ƒçš„å‡ºç°ï¼Œåœ¨çŸ­æ—¶é—´å†…å¼•å‘äº†ä¸€æ³¢AIçƒ­æ½®ï¼Œé™¤äº†æœ‰ä¸ªåˆ«ç‚’ä½œå¤–ï¼Œæ›´æ·±å±‚æ¬¡çš„åŸå› ï¼Œæ˜¯å› ä¸ºå®ƒè§£å†³äº†ä¸€ä¸ªå¾ˆå…·ä½“çœŸå®çš„ç—›ç‚¹ï¼š<strong>Claudeå®¹æ˜“å‡ºç°å¥å¿˜ã€éœ€é‡å¤å†™æç¤ºè¯ã€å¤ªè´¹tokenï¼</strong></p>
<p>è¿‡å»ä½¿ç”¨â€¯Claudeâ€¯æœ€å¤§çš„ç—›ç‚¹æ˜¯â€œå¥å¿˜â€ï¼š</p>
<p>å†™æ–‡ç« ã€åšåˆ†ææ—¶ï¼Œä½ è¦åå¤è¾“å…¥â€”â€”</p>
<blockquote>
<p>â€œè¦ç”¨è°è°è°çš„è¯­æ°”æ¥å†™â€ã€â€œå›ç­”è¦ä¿æŒç®€æ´â€ã€â€œå¸®æˆ‘æŒ‰xxxæ ¼å¼ï¼Œåˆ«å¿˜äº†xxxç­‰ç­‰ã€‚</p>
</blockquote>
<p>æ¯æ¢ä¸€ä¸ªä»»åŠ¡ã€æ¯å¼€ä¸€æ¬¡å¯¹è¯ï¼Œéƒ½è¦é‡å¤ä¸€å †ä¸œè¥¿ã€‚</p>
<p>Skillsâ€¯å‡ºç°åï¼Œè¿™äº›éƒ½èƒ½æ”¶çº³æˆä¸€ä¸ªè¯´æ˜ä¹¦ã€‚æŠŠè§„åˆ™æå‰å†™å¥½ï¼Œæ¨¡å‹åªéœ€è¦çœ‹åˆ°æœ‰è¿™ä¹ˆä¸ªè§„åˆ™ï¼Œå¤§æ¦‚100ä¸ªtokenï¼Œéœ€è¦ç”¨åˆ°çš„æ—¶å€™å†æ‰“å¼€çœ‹ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li>ä½ æ˜¯ä¸€ä¸ªå…¬ä¼—å·å†™ä½œåšä¸»ï¼Œé‚£ä¹ˆå¯ä»¥åˆ¶ä½œä¸€ä»½â€œå…¬ä¼—å·å†™ä½œâ€¯Skillâ€ï¼Œè§„å®šè¯­æ°”ã€å†…å®¹ç»“æ„ï¼›</li>
<li>æˆ–åˆ¶ä½œä¸€ä»½â€œå­¦ä¹ ç¬”è®°â€¯Skillâ€ï¼Œå®šä¹‰å¦‚ä½•æç‚¼å†…å®¹é‡ç‚¹ã€è¾“å‡ºæ€»ç»“è¦æ±‚ç­‰ã€‚</li>
</ul>
<p>ä¹‹ååªè¦è¯´ä¸€å¥ï¼šâ€œç”¨æˆ‘çš„xxx â€¯Skillâ€¯å¸®æˆ‘å†™â€¯xxxâ€ï¼ŒClaudeâ€¯å°±æ‡‚äº†ã€‚</p>
<p>å®ƒä¸ä»…ä»…åªæ˜¯ç†è§£ä»»åŠ¡ï¼Œæ›´æ˜¯<strong>ç†è§£ä½ çš„å…·ä½“æ–¹å¼</strong>ã€‚</p>
<h3 data-id="heading-2">ä¸‰ã€å¬èµ·æ¥ï¼ŒSkillsåƒæ˜¯â€œè‡ªå®šä¹‰æç¤ºè¯â€ï¼Ÿ</h3>
<p>å¾ˆå¤šäººçœ‹åˆ°â€¯Skillsâ€¯çš„åŠŸèƒ½ä»‹ç»ï¼Œç¬¬ä¸€å°è±¡ä¼šè§‰å¾—ï¼šâ€œ<strong>è¿™ä¸å°±æ˜¯è‡ªå®šä¹‰æç¤ºå—ï¼Ÿ</strong>â€</p>
<p>å…¶å®ä¸ä¸€æ ·ã€‚</p>
<p>è‡ªå®šä¹‰æç¤ºåªæ˜¯ä¸€æ¬¡æ€§çš„è¯´æ˜ï¼Œä¸”æ— æ³•æ–‡ä»¶åŒ–ã€èµ„äº§åŒ–å¤ç”¨ï¼›</p>
<p>è€Œâ€¯Skillsâ€¯æ˜¯å¯ä»¥<strong>ä¿å­˜ã€è°ƒç”¨ã€ç»„åˆã€åå¤ä¼˜åŒ–çš„ä½“ç³»åŒ–å·¥ä½œè§„èŒƒæ–‡ä»¶ã€‚</strong></p>
<p>è¯´ç™½äº†ï¼ŒSkills å°±æ˜¯ä¸€å¥—ä½ å†™ç»™ Claude çš„â€œè¯´æ˜ä¹¦â€å’Œâ€œSOPï¼ˆæ ‡å‡†ä½œä¸šç¨‹åºï¼‰â€ã€‚</p>
<p><strong>ä½ å¯ä»¥æƒ³è±¡æˆï¼š</strong></p>
<p>å¯¹â€¯AIâ€¯çš„â€œè¦æ±‚æ ‡å‡†â€ï¼ŒæŠŠå®ƒä»¬ä½“ç³»åŒ–æˆæ–‡ä»¶ï¼Œå†™åˆ°ä¸€ä¸ªä¸ªSkillæ–‡ä»¶ä¸­ï¼Œ ä¸”å¯ä»¥æœ¬åœ°ä¿å­˜ï¼Œä½ å¯ä»¥ä¸æ–­ä¿®æ”¹ã€æ‰“ç£¨ã€å¤åˆ¶â€”â€”åœ¨â€¯Claudeâ€¯é‡Œè°ƒç”¨ï¼Œä¹Ÿèƒ½è‡ªå·±ç•™åº•ã€‚è®©â€¯AIâ€¯çœŸæ­£æŒ‰ä½ çš„æ–¹æ³•é•¿æœŸæ‰§è¡Œä»»åŠ¡ã€‚æŠŠè‡ªå·±å¯¹â€¯AIâ€¯çš„è¦æ±‚ä½“ç³»åŒ–å¹¶ä¿å­˜ä¸‹æ¥ã€‚</p>
<p>è¿™è®©â€œæ€ä¹ˆç”¨â€¯AIâ€ä»æŠ€èƒ½å˜æˆäº†å¯æ²‰æ·€çš„ä¸ªäººèµ„äº§ï¼Œå®ƒè®©â€¯AIâ€¯ç¬¬ä¸€æ¬¡<strong>ä»ç†è§£ä½ çš„æŒ‡ä»¤ï¼Œå˜æˆæŒæ¡ä½ çš„æ–¹æ³•ã€‚</strong></p>
<h3 data-id="heading-3">å››ã€Skills VS CLAUDE.md æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p>ä»åŠŸèƒ½ç”¨é€”æ¥çœ‹ï¼ŒSkillså’ŒCLAUDE.mdçš„åŠŸèƒ½å’‹ä¸€çœ‹æœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„ï¼Œä½†å¦‚æœæ·±ç©¶ä¸€ä¸‹çš„è¯ï¼Œä»–ä»¬ä¸¤è€…ä¹‹é—´è¿˜æ˜¯æœ‰æœ¬è´¨ä¸ŠåŒºåˆ«ã€‚</p>
<h4 data-id="heading-4">1ã€Claude Skillsï¼ˆæŠ€èƒ½ï¼‰</h4>
<p><code>Skills</code> é€šå¸¸æŒ‡çš„æ˜¯å°è£…å¥½çš„ç‰¹å®šåŠŸèƒ½æˆ–ä»»åŠ¡æ¨¡å—ã€‚ä½ å¯ä»¥æŠŠå®ƒä»¬ç†è§£ä¸ºâ€œæ’ä»¶â€æˆ–â€œå®â€ã€‚å®ƒä»¬æ—¨åœ¨è®© Claude æ‰§è¡Œå…·ä½“çš„ã€é‡å¤æ€§çš„æ“ä½œã€‚</p>
<blockquote>
<p>ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªâ€œä»£ç å®¡æŸ¥å‘˜â€æŠ€èƒ½ï¼Œå½“ç”¨æˆ·è§¦å‘æ—¶ï¼ŒClaude ä¼šä¸¥æ ¼æ ¹æ®è¿™ä¸ªæŠ€èƒ½ä¸­å®šä¹‰çš„è§„åˆ™ï¼ˆæ¯”å¦‚æ£€æŸ¥å®‰å…¨æ€§ã€æ€§èƒ½ï¼‰æ¥è¿è¡Œã€‚</p>
</blockquote>
<p>é€šå¸¸ä¸æ˜¯å•ä¸€çš„æ–‡ä»¶ï¼Œè€Œæ˜¯ä¸€ä¸ª<strong>ç›®å½•ç»“æ„</strong>ï¼ŒåŒ…å«æŒ‡ä»¤ + è„šæœ¬ + èµ„æºï¼ŒSkills çš„ç›®å½•ç»“æ„å¯ä»¥å¾ˆä¸°å¯Œï¼Œé™¤äº†ä¸»æ–‡ä»¶ SKILL.mdï¼Œè¿˜å¯ä»¥åŒ…å«æ£€æŸ¥æ¸…å•ã€å‚è€ƒæ–‡æ¡£ã€è¾…åŠ©è„šæœ¬ç­‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">my-skill/
â”œâ”€â”€ SKILL.md (required)
â”œâ”€â”€ reference.md (optional documentation)
â”œâ”€â”€ examples.md (optional examples)
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ helper.py (optional utility)
â””â”€â”€ templates/
    â””â”€â”€ template.txt (optional template)
</code></pre>
<p>ä¸”Claude åªä¼šè¯»å– Skill çš„ç®€çŸ­è¯´æ˜ï¼Œåªæœ‰åœ¨çœŸæ­£éœ€è¦ä½¿ç”¨æ—¶æ‰ä¼šåŠ è½½å®Œæ•´å†…å®¹ï¼Œä¸ä¼šä¸€å¼€å§‹å°±å ç”¨å¤§é‡ä¸Šä¸‹æ–‡ã€‚</p>
<p>éœ€è¦é¢å¤–è¯´æ˜ä¸€ç‚¹ï¼ŒSkillsæŠ€èƒ½æ ¸å¿ƒæ˜¯<code>SKILL.md</code>æ–‡ä»¶ï¼Œä¸”å¿…é¡»åŒ…å« YAML å¤´ä¿¡æ¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-meta">---</span>
<span class="hljs-string">åç§°:</span> <span class="hljs-string">ç”Ÿæˆæäº¤æ¶ˆæ¯</span>
<span class="hljs-string">æè¿°:</span> <span class="hljs-string">æ ¹æ®</span> <span class="hljs-string">git</span> <span class="hljs-string">å·®å¼‚ç”Ÿæˆæ¸…æ™°çš„æäº¤æ¶ˆæ¯ã€‚åœ¨ç¼–å†™æäº¤æ¶ˆæ¯æˆ–å®¡æŸ¥æš‚å­˜æ›´æ”¹æ—¶ä½¿ç”¨ã€‚</span>
<span class="hljs-meta">---
</span>
<span class="hljs-comment"># ç”Ÿæˆæäº¤æ¶ˆæ¯</span>

<span class="hljs-comment">## æŒ‡ä»¤</span>

<span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">è¿è¡Œ</span> <span class="hljs-string">`git</span> <span class="hljs-string">diff</span> <span class="hljs-string">--staged`</span> <span class="hljs-string">æŸ¥çœ‹æ›´æ”¹</span>
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">æˆ‘å°†æä¾›åŒ…å«ä»¥ä¸‹å†…å®¹çš„æäº¤æ¶ˆæ¯ï¼š</span>
   <span class="hljs-bullet">-</span> <span class="hljs-string">ä¸è¶…è¿‡</span> <span class="hljs-number">50</span> <span class="hljs-string">å­—ç¬¦çš„æ‘˜è¦</span>
   <span class="hljs-bullet">-</span> <span class="hljs-string">è¯¦ç»†æè¿°</span>
   <span class="hljs-bullet">-</span> <span class="hljs-string">å—å½±å“çš„ç»„ä»¶</span>

<span class="hljs-comment">## æœ€ä½³å®è·µ</span>

<span class="hljs-bullet">-</span> <span class="hljs-string">ä½¿ç”¨ç°åœ¨æ—¶</span>
<span class="hljs-bullet">-</span> <span class="hljs-string">è§£é‡Šå†…å®¹å’ŒåŸå› ï¼Œè€Œéæ–¹å¼</span>
</code></pre>
<p>è¿™ä¹Ÿæ˜¯<code>Skills</code>å’Œ<code>MCP</code>ã€<code>FunctionCaling</code>çš„åŒºåˆ«ï¼Œå®ƒå¯ä»¥å®ç°åˆ†å±‚åŠ è½½ï¼Œç»™ä¸Šä¸‹æ–‡çª—å£å‡è´Ÿã€‚å¯åŠ¨æ—¶ï¼ŒåªåŠ è½½YAMLå¤´é…ç½®ï¼ˆåŒ…å«nameï¼Œdescriptionï¼‰ï¼Œå¤§æ¦‚ä¹Ÿå°±100ä¸ªtokenã€‚SkillsçœŸæ­£çš„è§¦å‘æ—¶æœºï¼Œæ˜¯é€šè¿‡è‡ªç„¶è¯­è¨€è§¦å‘ï¼ŒClaude ä¼šæ ¹æ®ä½ çš„ä»»åŠ¡æè¿°è‡ªåŠ¨åˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨æŸä¸ª Skillã€‚ä»»åŠ¡è§¦å‘æ—¶ï¼Œæ‰ä¼šè¯»å–æ•´ä¸ªSkill.mdæ­£æ–‡å†…å®¹ã€‚</p>
<h4 data-id="heading-5">2ã€CLAUDE.mdæ–‡ä»¶</h4>
<p><code>CLAUDE.md</code>æ˜¯é¡¹ç›® / å…¨å±€çš„é™æ€ä¸Šä¸‹æ–‡é…ç½®æ–‡ä»¶ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªé™æ€çš„ Markdown æ–‡ä»¶ã€‚</p>
<p>å½“ Claude (ä¾‹å¦‚é€šè¿‡ Claude for VS Code æ’ä»¶æˆ– MCP) è¯»å–ä½ çš„é¡¹ç›®æ—¶ï¼Œå®ƒä¼šä¼˜å…ˆæŸ¥æ‰¾è¿™ä¸ªæ–‡ä»¶ï¼Œä»¥äº†è§£è¯¥é¡¹ç›®çš„æ•´ä½“èƒŒæ™¯ã€ä»£ç é£æ ¼ã€å¼€å‘è§„èŒƒç­‰ã€‚é€šå¸¸åŒ…å«é¡¹ç›®ä»‹ç»ã€æ¶æ„è¯´æ˜ã€ç¼–ç çº¦å®šç­‰éæ‰§è¡Œæ€§çš„èƒŒæ™¯ä¿¡æ¯ã€‚</p>
<blockquote>
<p>å°±åƒæ–°å‘˜å·¥å…¥èŒæ—¶æ‹¿åˆ°çš„â€œå‘˜å·¥æ‰‹å†Œâ€æˆ–â€œé¡¹ç›®æ–‡æ¡£â€ï¼Œç”¨æ¥é˜…è¯»å’Œç†è§£ï¼Œè€Œä¸æ˜¯ç›´æ¥æ‰§è¡Œçš„å‘½ä»¤ã€‚</p>
</blockquote>
<p>è¯¥æ–‡ä»¶åœ¨å¯åŠ¨å°±ä¼šå…¨é‡åŠ è½½åˆ°ä¸Šä¸‹æ–‡ï¼Œä¸”æŒç»­ç”Ÿæ•ˆï¼ˆè‡ªåŠ¨åŠ è½½ï¼Œæ— éœ€è§¦å‘ï¼‰ï¼Œå†…å®¹è¶Šé•¿æ¶ˆè€—ä¸Šä¸‹æ–‡tokenä¹Ÿä¼šè¶Šå¤šï¼Œä¸€èˆ¬ä¸å»ºè®®å†™å¤ªå¤šå†…å®¹ã€‚</p>
<p><strong>å†…å®¹å»ºè®®</strong>ï¼šç»Ÿä¸€å›¢é˜Ÿä»£ç é£æ ¼ã€ä¼ é€’é¡¹ç›®æ¶æ„ã€å›ºåŒ–å¼€å‘æµç¨‹ã€æ¶æ„è¯´æ˜ã€æäº¤è§„åˆ™ç­‰</p>
<p><strong>ä¸€å¥è¯å°ç»“</strong>ï¼Œå¦‚æœä½ æƒ³è®© Claude <strong>â€œå­¦ä¼šåšæŸä»¶å…·ä½“çš„æ´»â€</strong>ï¼Œä½ éœ€è¦é…ç½® <strong>Skills</strong>ï¼›å¦‚æœä½ æƒ³è®© Claude <strong>â€œäº†è§£ä½ çš„é¡¹ç›®æƒ…å†µâ€</strong>ï¼Œä½ éœ€è¦ç¼–å†™ <strong>CLAUDE.md</strong>ã€‚</p>
<h3 data-id="heading-6">äº”ã€Skills vs MCPâ€¯æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3>
<p>å¾ˆå¤šäººåˆšæ¥è§¦Skillsæ—¶ï¼Œä¼šå’ŒMCPå‚»å‚»åˆ†ä¸æ¸…ï¼Œé‚£ä¹ˆSkillså’ŒMCPä¹‹é—´åˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼ŒMCP æ˜¯ä¸€ä¸ªå¼€æºåè®®ï¼Œç”¨äºè¿æ¥ AI å’Œå¤–éƒ¨ç³»ç»Ÿï¼ŒAI+MCPï¼Œä½ å°±å¯ä»¥è°ƒç”¨å„ç§å¤–éƒ¨å·¥å…·ã€‚</p>
<blockquote>
<p>æ¯”å¦‚ä½ å¯ä»¥è®© Claude è®¿é—®æ•°æ®åº“ã€APIã€æ–‡ä»¶ç³»ç»Ÿã€æ¶ˆæ¯ç³»ç»Ÿç­‰å¤–éƒ¨èµ„æºã€‚åƒå¸¸ç”¨çš„ Playwright MCPï¼Œå°±æ˜¯è®© Claude èƒ½å¤Ÿæ“ä½œæµè§ˆå™¨ã€‚</p>
</blockquote>
<p>å¦‚æœï¼ŒæŠŠClaudeâ€¯æ¯”å–»â€œå¤´è„‘â€ï¼ŒMCPâ€¯æ˜¯å®ƒèƒ½è°ƒç”¨çš„å·¥å…·ï¼Œè€ŒSkillsâ€¯åˆ™è§„å®šå®ƒçš„åšäº‹æ–¹æ³•ã€‚</p>
<p><strong>ä¸€å¥è¯å°ç»“</strong>ï¼šMCPæ˜¯æ•™AIå¤§æ¨¡å‹æ€ä¹ˆè¿æ¥å¤–éƒ¨ç³»ç»Ÿã€APIã€‚Skillsæ˜¯æ•™AIå¤§æ¨¡å‹æ€ä¹ˆç”¨å·¥å…·ï¼ŒæŒ‰ä»€ä¹ˆæµç¨‹å¤„ç†ï¼Œè¾“å‡ºä»€ä¹ˆæ ¼å¼ã€‚</p>
<h3 data-id="heading-7">å…­ã€Claude Skillsæœ‰å“ªäº›ç±»å‹ï¼Œä»å“ªé‡ŒæŸ¥æ‰¾ï¼Ÿ</h3>
<p>ä»ä½¿ç”¨æ–¹æ³•æ¥è¯´å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œç›®å‰Claudeæ”¯æŒä½¿ç”¨ã€å®˜æ–¹è‡ªå¸¦çš„Skillã€‘ä»¥åŠã€æœ¬åœ°ä¸Šä¼ çš„Skillã€‘ã€‚</p>
<p>è€Œæ ¹æ®Skillçš„æ¥æºä¸åŒï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š</p>
<ul>
<li>
<p><strong>å®˜æ–¹Skills</strong>ï¼Œç”±Anthropicå®˜æ–¹åŠåˆä½œä¼™ä¼´æä¾›ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">https:<span class="hljs-comment">//github.com/anthropics/skills</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3962195c4ecf48088ab1c631d033ea8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uC5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179158&amp;x-signature=Yi0hzXfEVot%2FBQNmcoX6iQxxPoo%3D" alt="" loading="lazy"/></p>
<p>æ¯”å¦‚ï¼Œä½ åœ¨ <code>Claude.ai</code> ç½‘é¡µç‰ˆé‡Œç”¨çš„é‚£äº›ä¸æ»‘åŠŸèƒ½ â€”â€” <em>æ¯”å¦‚â€œå¸®æˆ‘å¼€å‘ä¸€ä¸ªWebåº”ç”¨â€ã€â€œåˆ†æè¿™ä¸ª PDF æ–‡æ¡£â€ã€â€œå†™ä¸€ä¸ªè´ªåƒè›‡æ¸¸æˆå¹¶é¢„è§ˆâ€</em>ï¼Œå®ƒä»¬èƒŒåçš„é€»è¾‘ä»£ç ï¼Œéƒ½åœ¨è¿™ä¸ªä»“åº“é‡Œï¼</p>
</li>
<li>
<p><strong>è‡ªå®šä¹‰ Skill</strong>ï¼Œç”±ä½ è‡ªå·±åˆ›å»ºï¼Œé€‚åˆéœ€è¦ä¸ªæ€§åŒ–å®šåˆ¶çš„ç”¨æˆ·ï¼Œä½¿ç”¨Skill Creatoråˆ¶ä½œå¹¶ä¸Šä¼ Skillæ–‡ä»¶ã€‚</p>
</li>
<li>
<p><strong>ç¤¾åŒºSkill</strong>ï¼Œç”±å…¶ä»–ç”¨æˆ·åˆ†äº«ï¼Œç›´æ¥æ‹¿æ¥ç”¨ï¼Œæ¯”è‡ªå·±é€ è½®å­å¿«å¾—å¤šï¼Œéå¸¸é€‚åˆåš Skills é€‰å‹å’ŒäºŒæ¬¡æ”¹é€ ã€‚ä¸‹è½½åï¼Œä¸Šä¼ å³å¯ï¼Œä½¿ç”¨å‰æ³¨æ„å®‰å…¨æ€§ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">https:<span class="hljs-comment">//skillsmp.com/</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7260c30e7c3947608a121ca2929a5177~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uC5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179158&amp;x-signature=RHEB3fPxQWJBDIAFlYGQaEqr3pE%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">https:<span class="hljs-comment">//www.aitmpl.com/skills</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a6e196fc2af4f4694c56801eca0d091~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54uC5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179158&amp;x-signature=cDI33%2BfU14WFrXiOFa50jhcUZFc%3D" alt="" loading="lazy"/></p>
</li>
</ul>
<h3 data-id="heading-8">ä¸ƒã€å¦‚ä½•åˆ¤æ–­æŸä¸€é¡¹ä»»åŠ¡æ˜¯å¦é€‚åˆè¢«åˆ¶ä½œæˆSkillï¼Ÿ</h3>
<p>å½“ä½ å‘ç°è‡ªå·±ç»å¸¸å‘Claudeè¯·æ±‚ç›¸åŒç±»å‹çš„ä»»åŠ¡ï¼Œæˆ–æ˜¯æœ‰ç€éœ€è¦åå¤ä½¿ç”¨çš„æ¨¡æ¿æˆ–èµ„äº§ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>"å¸®æˆ‘ç”¨å…¬å¸çš„æ¨¡æ¿æ ¼å¼å†™å‘¨æŠ¥"ï¼š ä½ æ¯å‘¨éƒ½è¦å†™å›¢é˜Ÿå‘¨æŠ¥ï¼Œå¹¶ä¸”æ¯æ¬¡éƒ½è¦å‘Šè¯‰ClaudeæŒ‰ç…§â€œæœ¬å‘¨æˆæœã€é‡åˆ°çš„å›°éš¾ã€ä¸‹ä¸€æ­¥è®¡åˆ’â€è¿™ä¸‰ä¸ªéƒ¨åˆ†æ¥ç»„ç»‡å†…å®¹ã€‚è¿™æ—¶ï¼Œä½ å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªâ€œå›¢é˜Ÿå‘¨æŠ¥ç”Ÿæˆâ€Skillã€‚</li>
<li>"æŒ‰ç…§æˆ‘ä»¬å…¬å¸çš„é£æ ¼åˆ¶ä½œæ¼”ç¤ºæ–‡ç¨¿"ï¼šå¾ˆå¤šæ—¶å€™å¿…é¡»ä¸¥æ ¼éµå®ˆå“ç‰ŒæŒ‡å—ï¼ŒåŒ…æ‹¬Logoç”¨æ³•ã€å“ç‰Œè‰²ã€å…¬å¸åç§°ã€å…¬å¸ä¸šåŠ¡å†…å®¹ã€ä¸“ä¸šçš„é¢„æœŸç­‰ã€‚ä½ å¯ä»¥å°†è¿™äº›æŒ‡å—æ‰“åŒ…æˆä¸€ä¸ªâ€œå“ç‰Œæ¼”ç¤ºæ–‡ç¨¿é£æ ¼â€Skillã€‚</li>
<li>"ç”¨ç‰¹å®šæ ¼å¼æ•´ç†å¸‚åœºåˆ†ææŠ¥å‘Š/åšç«äº‰å¯¹æ‰‹è°ƒç ”"ï¼šæ¯”å¦‚è¯´åˆ¶ä½œä¸€ä»½å¸‚åœºåˆ†ææŠ¥å‘Šï¼Œå¯èƒ½éœ€è¦ç»“åˆä¸‰ä»½ç«å“èµ„æ–™ã€ä¸€ä»½å†…éƒ¨é”€å”®æ•°æ®ï¼Œå¹¶å¥—ç”¨ä¸€ä¸ªå›ºå®šçš„åˆ†ææ¡†æ¶ã€‚è¿™æ•´ä¸ªå¤æ‚æµç¨‹éƒ½å¯ä»¥è¢«å°è£…è¿›ä¸€ä¸ªâ€œå¸‚åœºåˆ†ææŠ¥å‘Šâ€Skillã€‚</li>
</ul>
<p>åä¹‹ï¼Œå¦‚æœåªæ˜¯å¶å°”çš„ã€ä¸€æ¬¡æ€§çš„è¯·æ±‚ï¼Œç›´æ¥åœ¨å¯¹è¯ä¸­è¯´æ˜å°±å¯ä»¥ï¼Œä¸éœ€è¦åˆ›å»ºSkillã€‚</p>
<h3 data-id="heading-9">æœ€å</h3>
<p>Claude Skills çš„çˆ†å‘ï¼Œæ ‡å¿—ç€æˆ‘ä»¬ä»æç¤ºè¯å·¥ç¨‹è¿ˆå‘äº†æµç¨‹å·¥ç¨‹ã€‚</p>
<p>é€šè¿‡Claudeä»»ä½•äººéƒ½èƒ½åƒæ•´ç†æ–‡æ¡£ä¸€æ ·æ•´ç†â€¯AIâ€¯çš„å·¥ä½œè§„èŒƒï¼Œåˆ©ç”¨Skillsï¼Œå¯ä»¥</p>
<ul>
<li>ä¸€é”®æœ¬åœ°ä¿å­˜ï¼Œæ²¡æœ‰å¤æ‚çš„äº‘é…ç½®ï¼›</li>
<li>æ ¹æ®ä»»åŠ¡éšæ—¶æ”¹åŠ¨ï¼›</li>
<li>é€šè¿‡ä¸æ–­å¤ç›˜è¿­ä»£ï¼Œè®©â€¯Skillsè¶Šæ¥è¶Šå®Œå–„ã€‚</li>
</ul>
<p>äººä¸AIçš„å…³ç³»ï¼Œä¸å†æ˜¯â€œä¸´æ—¶é—®ç­”â€ï¼Œè€Œæ˜¯â€œé•¿æœŸåä½œâ€ã€‚æœªæ¥çœŸæ­£æœ‰ä»·å€¼çš„ï¼Œä¸æ˜¯è°çš„ Prompt å†™å¾—æœ€èŠ±ã€è°ä¸€æ¬¡èƒ½ç”Ÿæˆæœ€å¤šå†…å®¹ã€‚</p>
<p>è€Œæ˜¯è°æœ€æ‡‚ä¸šåŠ¡æµç¨‹ã€è°èƒ½æŠŠç»éªŒæ²‰æ·€æˆ SOPã€è°èƒ½æŠŠ SOP äº¤ç»™ AI ç¨³å®šæ‰§è¡Œã€‚</p>
<p>æœªæ¥çš„â€¯AIâ€¯ä¸æ˜¯æ›´å¼ºçš„ç®—æ³•ï¼Œè€Œæ˜¯<strong>æ›´æ‡‚äººï¼Œæ›´ä¸ªæ€§åŒ–çš„ç³»ç»Ÿã€‚</strong></p>
<blockquote>
<p>å¦å¤–ï¼Œå¦‚æœæœ¬æ–‡åå“å¥½çš„è¯ï¼Œåé¢ä¼šå†åˆ†äº«ä¸€æœŸå…³äºClaude Skillså¦‚ä½•ä½¿ç”¨ã€å¦‚ä½•æ ¹æ®éœ€æ±‚è‡ªå®šä¹‰ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI æ™ºèƒ½ä½“é«˜å¯é è®¾è®¡æ¨¡å¼ï¼šé¢„æµ‹æ‰§è¡Œ]]></title>    <link>https://juejin.cn/post/7591309945511870464</link>    <guid>https://juejin.cn/post/7591309945511870464</guid>    <pubDate>2026-01-05T02:20:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591309945511870464" data-draft-id="7591309945511837696" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI æ™ºèƒ½ä½“é«˜å¯é è®¾è®¡æ¨¡å¼ï¼šé¢„æµ‹æ‰§è¡Œ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-05T02:20:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¿å‡¡"/> <meta itemprop="url" content="https://juejin.cn/user/290747765274222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI æ™ºèƒ½ä½“é«˜å¯é è®¾è®¡æ¨¡å¼ï¼šé¢„æµ‹æ‰§è¡Œ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/290747765274222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¿å‡¡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T02:20:34.000Z" title="Mon Jan 05 2026 02:20:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><em>æœ¬ç³»åˆ—ä»‹ç»å¢å¼ºç°ä»£æ™ºèƒ½ä½“ç³»ç»Ÿå¯é æ€§çš„è®¾è®¡æ¨¡å¼ï¼Œä»¥ç›´è§‚æ–¹å¼é€ä¸€ä»‹ç»æ¯ä¸ªæ¦‚å¿µï¼Œæ‹†è§£å…¶ç›®çš„ï¼Œç„¶åå®ç°ç®€å•å¯è¡Œçš„ç‰ˆæœ¬ï¼Œæ¼”ç¤ºå…¶å¦‚ä½•èå…¥ç°å®ä¸–ç•Œçš„æ™ºèƒ½ä½“ç³»ç»Ÿã€‚æœ¬ç³»åˆ—ä¸€å…± 14 ç¯‡æ–‡ç« ï¼Œè¿™æ˜¯ç¬¬ 4 ç¯‡ã€‚åŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Flevelup.gitconnected.com%2Fbuilding-the-14-key-pillars-of-agentic-ai-229e50f65986" title="https://levelup.gitconnected.com/building-the-14-key-pillars-of-agentic-ai-229e50f65986" target="_blank" ref="nofollow noopener noreferrer">Building the 14 Key Pillars of Agentic AI</a></em></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a0792e5d8474e67822d607e23f25a2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-e5Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184434&amp;x-signature=IWWG0kJgtsf8XuB7IxqZPIlfHg4%3D" alt="" loading="lazy"/></p>
<p>ä¼˜åŒ–æ™ºèƒ½ä½“è§£å†³æ–¹æ¡ˆéœ€è¦è½¯ä»¶å·¥ç¨‹ç¡®ä¿ç»„ä»¶åè°ƒã€å¹¶è¡Œè¿è¡Œå¹¶ä¸ç³»ç»Ÿé«˜æ•ˆäº¤äº’ã€‚ä¾‹å¦‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSpeculative_execution" title="https://en.wikipedia.org/wiki/Speculative_execution" target="_blank" ref="nofollow noopener noreferrer">é¢„æµ‹æ‰§è¡Œ</a>ï¼Œä¼šå°è¯•å¤„ç†å¯é¢„æµ‹æŸ¥è¯¢ä»¥<strong>é™ä½æ—¶å»¶</strong>ï¼Œæˆ–è€…è¿›è¡Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.arm.com%2Fcommunity%2Farm-community-blogs%2Fb%2Fembedded-and-microcontrollers-blog%2Fposts%2Fcomparing-lock-step-redundant-execution-versus-split-lock-technologies" title="https://developer.arm.com/community/arm-community-blogs/b/embedded-and-microcontrollers-blog/posts/comparing-lock-step-redundant-execution-versus-split-lock-technologies" target="_blank" ref="nofollow noopener noreferrer">å†—ä½™æ‰§è¡Œ</a>ï¼Œå³<strong>å¯¹åŒä¸€æ™ºèƒ½ä½“é‡å¤æ‰§è¡Œå¤šæ¬¡</strong>ä»¥é˜²å•ç‚¹æ•…éšœã€‚å…¶ä»–å¢å¼ºç°ä»£æ™ºèƒ½ä½“ç³»ç»Ÿå¯é æ€§çš„æ¨¡å¼åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>å¹¶è¡Œå·¥å…·</strong>ï¼šæ™ºèƒ½ä½“åŒæ—¶æ‰§è¡Œç‹¬ç«‹ API è°ƒç”¨ä»¥éšè— I/O æ—¶å»¶ã€‚</li>
<li><strong>å±‚çº§æ™ºèƒ½ä½“</strong>ï¼šç®¡ç†è€…å°†ä»»åŠ¡æ‹†åˆ†ä¸ºç”±æ‰§è¡Œæ™ºèƒ½ä½“å¤„ç†çš„å°æ­¥éª¤ã€‚</li>
<li><strong>ç«äº‰æ€§æ™ºèƒ½ä½“ç»„åˆ</strong>ï¼šå¤šä¸ªæ™ºèƒ½ä½“æå‡ºç­”æ¡ˆï¼Œç³»ç»Ÿé€‰å‡ºæœ€ä½³ã€‚</li>
<li><strong>å†—ä½™æ‰§è¡Œ</strong>ï¼šå³ä¸¤ä¸ªæˆ–å¤šä¸ªæ™ºèƒ½ä½“è§£å†³åŒä¸€ä»»åŠ¡ä»¥æ£€æµ‹é”™è¯¯å¹¶æé«˜å¯é æ€§ã€‚</li>
<li><strong>å¹¶è¡Œæ£€ç´¢å’Œæ··åˆæ£€ç´¢</strong>ï¼šå¤šç§æ£€ç´¢ç­–ç•¥ååŒè¿è¡Œä»¥æå‡ä¸Šä¸‹æ–‡è´¨é‡ã€‚</li>
<li><strong>å¤šè·³æ£€ç´¢</strong>ï¼šæ™ºèƒ½ä½“é€šè¿‡è¿­ä»£æ£€ç´¢æ­¥éª¤æ”¶é›†æ›´æ·±å…¥ã€æ›´ç›¸å…³çš„ä¿¡æ¯ã€‚</li>
</ul>
<p>è¿˜æœ‰å¾ˆå¤šå…¶ä»–æ¨¡å¼ã€‚</p>
<p>æœ¬ç³»åˆ—å°†å®ç°æœ€å¸¸ç”¨æ™ºèƒ½ä½“æ¨¡å¼èƒŒåçš„åŸºç¡€æ¦‚å¿µï¼Œä»¥ç›´è§‚æ–¹å¼é€ä¸€ä»‹ç»æ¯ä¸ªæ¦‚å¿µï¼Œæ‹†è§£å…¶ç›®çš„ï¼Œç„¶åå®ç°ç®€å•å¯è¡Œçš„ç‰ˆæœ¬ï¼Œæ¼”ç¤ºå…¶å¦‚ä½•èå…¥ç°å®ä¸–ç•Œçš„æ™ºèƒ½ä½“ç³»ç»Ÿã€‚</p>
<p>æ‰€æœ‰ç†è®ºå’Œä»£ç éƒ½åœ¨ GitHub ä»“åº“é‡Œï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFareedKhan-dev%2Fagentic-parallelism" title="https://github.com/FareedKhan-dev/agentic-parallelism" target="_blank" ref="nofollow noopener noreferrer">ğŸ¤– Agentic Parallelism: A Practical Guide ğŸš€</a></p>
<p>ä»£ç åº“ç»„ç»‡å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-erlang" lang="erlang">agentic-parallelism/
    â”œâ”€â”€ <span class="hljs-number">01</span>_parallel_tool_use.ipynb
    â”œâ”€â”€ <span class="hljs-number">02</span>_parallel_hypothesis.ipynb
    ...
    â”œâ”€â”€ <span class="hljs-number">06</span>_competitive_agent_ensembles.ipynb
    â”œâ”€â”€ <span class="hljs-number">07</span>_agent_assembly_line.ipynb
    â”œâ”€â”€ <span class="hljs-number">08</span>_decentralized_blackboard.ipynb
    ...
    â”œâ”€â”€ <span class="hljs-number">13</span>_parallel_context_preprocessing.ipynb
    â””â”€â”€ <span class="hljs-number">14</span>_parallel_multi_hop_retrieval.ipynb
</code></pre>
<hr/>
<h2 data-id="heading-0">å¯¹è¶…å“åº”æ™ºèƒ½ä½“çš„é¢„æµ‹æ‰§è¡Œ</h2>
<p>è®¸å¤šæ™ºèƒ½ä½“å·¥ä½œæµä¸ºï¼š<code>ç”¨æˆ·è¾“å…¥ -&gt; ä»£ç†æ€è€ƒ (è°ƒç”¨ LLM) -&gt; ä»£ç†æ‰§è¡Œ (è°ƒç”¨å·¥å…·)</code>ã€‚ç”¨æˆ·åœ¨ä¸¤ä¸ªé˜¶æ®µéƒ½è¦ç­‰å¾…ï¼Œè€Œé¢„æµ‹æ‰§è¡Œè®©è¿™ä¸¤é˜¶æ®µå¹¶è¡Œæ‰§è¡Œã€‚</p>
<p>å½“ä»£ç†æ€è€ƒæ—¶ï¼Œç³»ç»Ÿä¼šå¯¹å³å°†å‘ç”Ÿçš„åŠ¨ä½œåšå‡ºæœ‰æ ¹æ®çš„é¢„æµ‹å¹¶å¯åŠ¨ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83284c72391d48bfa078d9c4ef15e8f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-e5Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184434&amp;x-signature=JbKcjDKGnZjk8R28V5qFO3S4xj8%3D" alt="é¢„æµ‹æ‰§è¡Œ" loading="lazy"/></p>
<p>å¦‚æœé¢„æµ‹æ­£ç¡®ï¼Œå·¥å…·è°ƒç”¨æ—¶å»¶å®é™…ä¸Šè¢« LLM æ¨ç†æ—¶é—´éšè—ï¼Œä»£ç†æ„Ÿè§‰ä¸€ä¸‹å­å°±å®Œæˆäº†ã€‚</p>
<p>è¿™æ˜¯ä»»ä½•é«˜ååé‡ã€é¢å‘ç”¨æˆ·ç³»ç»Ÿçš„å…³é”®æ¶æ„æ¨¡å¼ï¼Œå¿«é€Ÿå“åº”æ˜¯å…¶ä¸»è¦ç‰¹ç‚¹ã€‚æˆ‘ä»¬å°†æ„å»ºå®¢æˆ·æ”¯æŒä»£ç†ï¼Œè·å–ç”¨æˆ·è®¢å•å†å²ï¼Œå±•ç¤ºè¿™ç§æ¨¡å¼å¦‚ä½•ä»ç”¨æˆ·è§’åº¦æ¶ˆé™¤å·¥å…·è°ƒç”¨æ—¶å»¶ã€‚</p>
<p>è¦å±•ç¤ºæ¨¡å¼æµï¼Œé¦–å…ˆéœ€è¦ä¸€ä¸ªç°å®ä¸­æ‰§è¡Œç¼“æ…¢çš„å·¥å…·ã€‚æˆ‘ä»¬å°†åˆ›å»ºæ¨¡æ‹Ÿæ•°æ®åº“æŸ¥è¯¢ï¼Œå…·æœ‰å›ºå®šçš„äººå·¥æ—¶å»¶ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.tools <span class="hljs-keyword">import</span> tool
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> json

<span class="hljs-comment"># å®šä¹‰æ¨¡æ‹Ÿæ•°æ®åº“æ—¶å»¶å¸¸æ•°</span>
DATABASE_LATENCY_SECONDS = <span class="hljs-number">3</span>
<span class="hljs-meta">@tool</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_order_history</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-string">"""A simulated slow tool that fetches the order history for a given user from a database."""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"--- [DATABASE] Starting query for user_id: <span class="hljs-subst">{user_id}</span>. This will take <span class="hljs-subst">{DATABASE_LATENCY_SECONDS}</span> seconds. ---"</span>)
    
    <span class="hljs-comment"># 'time.sleep()' æ¨¡æ‹Ÿç½‘ç»œå’Œæ•°æ®åº“æŸ¥è¯¢æ—¶é—´</span>
    time.sleep(DATABASE_LATENCY_SECONDS)
    
    <span class="hljs-comment"># åœ¨è¿™ä¸ªæ¼”ç¤ºä¸­ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®</span>
    mock_db = {
        <span class="hljs-string">"user123"</span>: [
            {<span class="hljs-string">"order_id"</span>: <span class="hljs-string">"A123"</span>, <span class="hljs-string">"item"</span>: <span class="hljs-string">"QuantumLeap AI Processor"</span>, <span class="hljs-string">"status"</span>: <span class="hljs-string">"Shipped"</span>},
            {<span class="hljs-string">"order_id"</span>: <span class="hljs-string">"B456"</span>, <span class="hljs-string">"item"</span>: <span class="hljs-string">"Smart Coffee Mug"</span>, <span class="hljs-string">"status"</span>: <span class="hljs-string">"Delivered"</span>}
        ]
    }
    result = mock_db.get(user_id, [])
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"--- [DATABASE] Query finished for user_id: <span class="hljs-subst">{user_id}</span>. ---"</span>)
    <span class="hljs-keyword">return</span> json.dumps(result)
</code></pre>
<p><code>get_order_history</code> å·¥å…·æ˜¯å®éªŒçš„æ ¸å¿ƒï¼Œ<code>time.sleep(DATABASE_LATENCY_SECONDS)</code> ç»™äº†ä¸€ä¸ªå¯é¢„æµ‹çš„ 3 ç§’æ—¶å»¶ï¼Œæˆ‘ä»¬å°è¯•ç”¨é¢„æµ‹æ‰§è¡Œæ¨¡å¼æ¥éšè—è¯¥æ—¶å»¶ã€‚</p>
<p>æ¥ä¸‹æ¥å®šä¹‰ <code>GraphState</code>ï¼ŒåŒ…å«ç‰¹æ®Šå­—æ®µ <code>prefetched_data</code>ï¼Œç”¨äºå­˜å‚¨é¢„æµ‹è°ƒç”¨çš„ç»“æœã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> TypedDict, Annotated, <span class="hljs-type">List</span>, <span class="hljs-type">Optional</span>
<span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> BaseMessage
<span class="hljs-keyword">import</span> operator
<span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> Future

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GraphState</span>(<span class="hljs-title class_ inherited__">TypedDict</span>):
    messages: Annotated[<span class="hljs-type">List</span>[BaseMessage], operator.add]
    user_id: <span class="hljs-built_in">str</span>
    <span class="hljs-comment"># 'prefetched_data' æŒæœ‰ Python Future å¯¹è±¡ï¼Œä»£è¡¨åå°å·¥å…·è°ƒç”¨</span>
    prefetched_data: <span class="hljs-type">Optional</span>[Future]
    <span class="hljs-comment"># 'agent_decision' å°†ä¿ç•™ LLM å†³å®šè¿›è¡Œçš„å®é™…å·¥å…·è°ƒç”¨</span>
    agent_decision: <span class="hljs-type">Optional</span>[BaseMessage]
    performance_log: Annotated[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>], operator.add]
</code></pre>
<p>è¿™ä¸ª <code>GraphState</code> çš„å…³é”®éƒ¨åˆ†æ˜¯ <code>prefetched_data: Optional[Future]</code> å­—æ®µï¼Œ<code>Future</code> æ˜¯æ ‡å‡† Python å¯¹è±¡ï¼Œä½œä¸ºå°šæœªå¯ç”¨çš„ç»“æœçš„å ä½ç¬¦ï¼Œä½¿å¾—å…¥å£èŠ‚ç‚¹åœ¨å¯åŠ¨åå°ä»»åŠ¡åç«‹å³è¿”å›ï¼ŒåŒæ—¶é€šè¿‡çŠ¶æ€ä¼ é€’ <code>Future</code> å¯¹è±¡ã€‚</p>
<p>ç°åœ¨è¯´è¯´æ¨¡å¼çš„æ ¸å¿ƒï¼š<code>entry_point</code> èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹å¹¶è¡Œå¯åŠ¨ä¸¤ä¸ªè¿‡ç¨‹ï¼šé¢„æµ‹å·¥å…·è°ƒç”¨å’Œä¸»è¦ LLM æ¨ç†ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor

<span class="hljs-comment"># åˆ›å»ºçº¿ç¨‹æ± æ¥è¿è¡Œåå°ä»»åŠ¡</span>
thread_pool = ThreadPoolExecutor(max_workers=<span class="hljs-number">5</span>)
<span class="hljs-keyword">def</span> <span class="hljs-title function_">entry_point</span>(<span class="hljs-params">state: GraphState</span>):
    <span class="hljs-string">"""The entry point node: starts the speculative pre-fetch and the main agent reasoning in parallel."""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"--- [ORCHESTRATOR] Entry point started. --- "</span>)
    start_time = time.time()
    
    <span class="hljs-comment"># 1. ä½¿ç”¨çº¿ç¨‹æ± åœ¨åå°çº¿ç¨‹ä¸­å¯åŠ¨é¢„æµ‹é¢„å–</span>
    <span class="hljs-comment">#    .submit() æ–¹æ³•ç«‹å³è¿”å› 'Future' å¯¹è±¡</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"--- [ORCHESTRATOR] Starting speculative pre-fetch of order history... ---"</span>)
    prefetched_data_future = thread_pool.submit(get_order_history.invoke, {<span class="hljs-string">"user_id"</span>: state[<span class="hljs-string">'user_id'</span>]})
    
    <span class="hljs-comment"># 2. åŒæ—¶ï¼Œå½“å·¥å…·åœ¨åå°è¿è¡Œæ—¶ï¼Œå¯åŠ¨ä¸»ä»£ç†çš„ LLM è°ƒç”¨</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"--- [ORCHESTRATOR] Starting main agent LLM call... ---"</span>)
    agent_response = llm_with_tools.invoke(state[<span class="hljs-string">'messages'</span>])
    
    execution_time = time.time() - start_time
    log_entry = <span class="hljs-string">f"[Orchestrator] LLM reasoning completed in <span class="hljs-subst">{execution_time:<span class="hljs-number">.2</span>f}</span>s."</span>
    <span class="hljs-built_in">print</span>(log_entry)
    
    <span class="hljs-comment"># èŠ‚ç‚¹è¿”å›æ·»åŠ åˆ°çŠ¶æ€é‡Œçš„ Future å¯¹è±¡å’Œä»£ç†å†³å®š</span>
    <span class="hljs-keyword">return</span> {
        <span class="hljs-string">"prefetched_data"</span>: prefetched_data_future,
        <span class="hljs-string">"agent_decision"</span>: agent_response,
        <span class="hljs-string">"performance_log"</span>: [log_entry]
    }
</code></pre>
<p>åœ¨ <code>entry_point</code> èŠ‚ç‚¹ä¸­ï¼Œ<code>thread_pool.submit()</code> è°ƒç”¨æ˜¯éé˜»å¡çš„ï¼Œåœ¨ç‹¬ç«‹çº¿ç¨‹ä¸­å¯åŠ¨ 3 ç§’çš„ <code>get_order_history</code> å·¥å…·ï¼Œå¹¶ç«‹å³è¿”å› <code>Future</code> å¯¹è±¡ã€‚ä»£ç éšåæ— éœ€ç­‰å¾…å³å¯ç»§ç»­ï¼Œç«‹å³è°ƒç”¨ <code>llm_with_tools</code>ã€‚è¿™å°±æ˜¯é¢„æµ‹æ‰§è¡Œæ¨¡å¼çš„å¹¶è¡ŒåŸºç¡€ã€‚</p>
<p>æ¥ä¸‹æ¥å®šä¹‰ <code>tool_executor_node</code>ï¼Œè¯¥èŠ‚ç‚¹æœ‰ç”¨äºæ£€æŸ¥æ‰€éœ€æ•°æ®æ˜¯å¦å·²è¢«é¢„å…ˆè·å–çš„ç‰¹æ®Šé€»è¾‘ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> ToolMessage

<span class="hljs-keyword">def</span> <span class="hljs-title function_">tool_executor_node</span>(<span class="hljs-params">state: GraphState</span>):
    <span class="hljs-string">"""Executes the agent's chosen tool, but first checks if the data has already been pre-fetched."""</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"--- [TOOL EXECUTOR] Node started. --- "</span>)
    start_time = time.time()
    
    agent_decision = state[<span class="hljs-string">'agent_decision'</span>]
    tool_call = agent_decision.tool_calls[<span class="hljs-number">0</span>]
    
    <span class="hljs-comment"># æ£€æŸ¥ä»£ç†æƒ³è¦è°ƒç”¨çš„å·¥å…·æ˜¯å¦æ˜¯é¢„æµ‹æ‰§è¡Œçš„å·¥å…·</span>
    <span class="hljs-keyword">if</span> tool_call[<span class="hljs-string">'name'</span>] == <span class="hljs-string">"get_order_history"</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"--- [TOOL EXECUTOR] Agent wants order history. Checking pre-fetch... ---"</span>)
        <span class="hljs-comment"># å¦‚æœæ˜¯ï¼Œå°±è°ƒç”¨ Future å¯¹è±¡ä¸Šçš„ .result()ã€‚è°ƒç”¨å°†è¢«é˜»å¡ï¼Œç›´åˆ°åå°çº¿ç¨‹å®Œæˆ</span>
        <span class="hljs-comment"># ä½†å¦‚æœå·²ç»å®Œæˆï¼Œä¼šç«‹å³è¿”å›ç»“æœ</span>
        prefetched_future = state[<span class="hljs-string">'prefetched_data'</span>]
        tool_result = prefetched_future.result()
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"--- [TOOL EXECUTOR] Pre-fetch successful! Using cached data instantly. ---"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># å¦‚æœä»£ç†åšå‡ºä¸åŒå†³å®šï¼Œåˆ™æ­£å¸¸æ‰§è¡Œè¯¥å·¥å…·</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"--- [TOOL EXECUTOR] Speculation failed. Agent wants <span class="hljs-subst">{tool_call[<span class="hljs-string">'name'</span>]}</span>. Executing normally. ---"</span>)
        <span class="hljs-comment"># (æ¼”ç¤ºæœªé‡‡ç”¨æ­¤è·¯å¾„)</span>
        tool_result = <span class="hljs-string">"Tool not implemented for this demo."</span>
    
    tool_message = ToolMessage(content=tool_result, tool_call_id=tool_call[<span class="hljs-string">'id'</span>])
    
    execution_time = time.time() - start_time
    log_entry = <span class="hljs-string">f"[ToolExecutor] Resolved tool call in <span class="hljs-subst">{execution_time:<span class="hljs-number">.2</span>f}</span>s."</span>
    <span class="hljs-built_in">print</span>(log_entry)
    
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"messages"</span>: [agent_decision, tool_message], <span class="hljs-string">"performance_log"</span>: [log_entry]}
</code></pre>
<p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œ<code>tool_executor_node</code> çš„é‡è¦æ€§åœ¨äº <code>prefetched_future.result()</code> è°ƒç”¨ã€‚</p>
<ol>
<li>å¦‚æœ 3 ç§’çš„æ•°æ®åº“æŸ¥æ‰¾åœ¨ LLM æ€è€ƒæ—¶å·²ç»å®Œæˆï¼Œä¼šç«‹å³è¿”å›ã€‚ä»è¿™ä¸€æ­¥è§’åº¦æ¥çœ‹ï¼Œ3 ç§’çš„æ—¶å»¶å·²ç»è¢«æœ‰æ•ˆæ¶ˆé™¤ã€‚</li>
<li>å¦‚æœé¢„æµ‹é”™è¯¯ï¼Œä»£ç†é€‰æ‹©äº†ä¸åŒçš„å·¥å…·ï¼Œå°±ä¼šå¿½ç•¥ <code>Future</code>ï¼Œä»é›¶å¼€å§‹æ‰§è¡Œæ­£ç¡®çš„å·¥å…·è°ƒç”¨ã€‚</li>
</ol>
<p>ç°åœ¨ç»„è£…å›¾â€¦â€¦</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langgraph.graph <span class="hljs-keyword">import</span> StateGraph, END

<span class="hljs-comment"># æ¡ä»¶è¾¹æ£€æŸ¥ä»£ç†å†³å®šæ˜¯å¦åŒ…æ‹¬ä»»ä½•å·¥å…·è°ƒç”¨</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">should_call_tool</span>(<span class="hljs-params">state: GraphState</span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-keyword">if</span> state[<span class="hljs-string">'agent_decision'</span>].tool_calls:
        <span class="hljs-keyword">return</span> <span class="hljs-string">"execute_tool"</span>
    <span class="hljs-keyword">return</span> END

<span class="hljs-comment"># å®šä¹‰å›¾</span>
workflow = StateGraph(GraphState)
workflow.add_node(<span class="hljs-string">"entry_point"</span>, entry_point)
workflow.add_node(<span class="hljs-string">"execute_tool"</span>, tool_executor_node)
workflow.add_node(<span class="hljs-string">"final_answer"</span>, final_answer_node) <span class="hljs-comment"># (Assuming final_answer_node is defined)</span>

<span class="hljs-comment"># æ„å»ºå›¾çš„æ§åˆ¶æµ</span>
workflow.set_entry_point(<span class="hljs-string">"entry_point"</span>)
workflow.add_conditional_edges(<span class="hljs-string">"entry_point"</span>, should_call_tool)
workflow.add_edge(<span class="hljs-string">"execute_tool"</span>, <span class="hljs-string">"final_answer"</span>)
workflow.add_edge(<span class="hljs-string">"final_answer"</span>, END)
app = workflow.<span class="hljs-built_in">compile</span>()
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebe570a389de43c787a8c0c7c273a1cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-e5Yeh:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184434&amp;x-signature=gLAbjxJTJItZsRc91djmvpL4i24%3D" alt="é¢„æµ‹æ‰§è¡Œ" loading="lazy"/></p>
<p>ä¸‹é¢è¿›è¡Œæµ‹è¯•ï¼Œå°†é¢„æµ‹å·¥ä½œæµå®é™…æ‰§è¡Œæ—¶é—´ä¸æ¨¡æ‹Ÿçš„ä¼ ç»Ÿé¡ºåºæµè¿›è¡Œæ¯”è¾ƒã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langchain_core.messages <span class="hljs-keyword">import</span> HumanMessage
<span class="hljs-keyword">import</span> json

inputs = {
    <span class="hljs-string">"messages"</span>: [HumanMessage(content=<span class="hljs-string">"Hi, can you tell me the status of my recent orders?"</span>)],
    <span class="hljs-string">"user_id"</span>: <span class="hljs-string">"user123"</span>
}

step_counter = <span class="hljs-number">1</span>
final_state = <span class="hljs-literal">None</span>

<span class="hljs-keyword">for</span> output <span class="hljs-keyword">in</span> app.stream(inputs, stream_mode=<span class="hljs-string">"values"</span>):
    node_name = <span class="hljs-built_in">list</span>(output.keys())[<span class="hljs-number">0</span>]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n<span class="hljs-subst">{<span class="hljs-string">'*'</span> * <span class="hljs-number">100</span>}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"**Step <span class="hljs-subst">{step_counter}</span>: <span class="hljs-subst">{node_name.replace(<span class="hljs-string">'_'</span>, <span class="hljs-string">' '</span>).title()}</span> Node Execution**"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{<span class="hljs-string">'*'</span> * <span class="hljs-number">100</span>}</span>"</span>)
    
    step_counter += <span class="hljs-number">1</span>


<span class="hljs-comment">#### è¾“å‡º ####</span>
[ORCHESTRATOR] Entry point started. --- 
[ORCHESTRATOR] Starting speculative pre-fetch of order history... ---
[DATABASE] Starting query <span class="hljs-keyword">for</span> user_id: user123. This will take <span class="hljs-number">3</span> seconds. ---
...
</code></pre>
<p>è¿™å°†åŸºäºç”¨æˆ·æŸ¥è¯¢å¯åŠ¨å·¥ä½œæµï¼Œä½†å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œå…³é”®æ˜¯è·å–è¿™ç§æ–¹æ³•çš„æ€§èƒ½ï¼Œæ‰€ä»¥å°±è¿™ä¹ˆåšå§â€¦â€¦</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åœ¨å®Œæ•´è¿è¡Œåä» final_state æ€§èƒ½æ—¥å¿—ä¸­æå–å®šæ—¶æ•°æ®</span>
<span class="hljs-comment"># (å®Œæ•´è¿è¡Œå·²å®Œæˆï¼Œfinal_stateå·²å¡«å……)</span>
llm_time_1 = <span class="hljs-built_in">float</span>(final_state[<span class="hljs-string">'performance_log'</span>][<span class="hljs-number">0</span>].split(<span class="hljs-string">' '</span>)[-<span class="hljs-number">2</span>])
resolution_time = <span class="hljs-built_in">float</span>(final_state[<span class="hljs-string">'performance_log'</span>][<span class="hljs-number">1</span>].split(<span class="hljs-string">' '</span>)[-<span class="hljs-number">2</span>])
llm_time_2 = <span class="hljs-built_in">float</span>(final_state[<span class="hljs-string">'performance_log'</span>][<span class="hljs-number">2</span>].split(<span class="hljs-string">' '</span>)[-<span class="hljs-number">2</span>])
db_time = DATABASE_LATENCY_SECONDS <span class="hljs-comment"># Our known latency</span>

<span class="hljs-comment"># è®¡ç®—é¢„æµ‹è¿è¡Œæ€»æ—¶é—´</span>
speculative_total = llm_time_1 + resolution_time + llm_time_2
<span class="hljs-comment"># è®¡ç®—æ¨¡æ‹Ÿé¡ºåºè¿è¡Œæ€»æ—¶é—´</span>
sequential_total = llm_time_1 + db_time + llm_time_2
time_saved = sequential_total - speculative_total
reduction_percent = (time_saved / sequential_total) * <span class="hljs-number">100</span>

<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"                  PERFORMANCE SHOWDOWN"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"\n"</span> + <span class="hljs-string">"-"</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"             SPECULATIVE EXECUTION WORKFLOW (Our Run)"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"1. Agent Thinks (LLM Call 1):       <span class="hljs-subst">{llm_time_1:<span class="hljs-number">.2</span>f}</span> seconds"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"   (Database Query: <span class="hljs-subst">{db_time:<span class="hljs-number">.2</span>f}</span>s ran in parallel, fully hidden)"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"2. Tool Result Resolution:          <span class="hljs-subst">{resolution_time:<span class="hljs-number">.2</span>f}</span> seconds (Instant cache hit)"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"3. Synthesize Answer (LLM Call 2):  <span class="hljs-subst">{llm_time_2:<span class="hljs-number">.2</span>f}</span> seconds"</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Total Time to Final Answer: <span class="hljs-subst">{speculative_total:<span class="hljs-number">.2</span>f}</span> seconds\n\n"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span>*<span class="hljs-number">60</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"             TRADITIONAL SEQUENTIAL WORKFLOW (Simulated)"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"1. Agent Thinks (LLM Call 1):       <span class="hljs-subst">{llm_time_1:<span class="hljs-number">.2</span>f}</span> seconds"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"2. Execute Tool (Database Query):   <span class="hljs-subst">{db_time:<span class="hljs-number">.2</span>f}</span> seconds (User waits)"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"3. Synthesize Answer (LLM Call 2):  <span class="hljs-subst">{llm_time_2:<span class="hljs-number">.2</span>f}</span> seconds"</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Simulated Total Time: <span class="hljs-subst">{sequential_total:<span class="hljs-number">.2</span>f}</span> seconds\n\n"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"                        CONCLUSION"</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"="</span>*<span class="hljs-number">60</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Time Saved: <span class="hljs-subst">{time_saved:<span class="hljs-number">.2</span>f}</span> seconds"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Perceived Latency Reduction: <span class="hljs-subst">{reduction_percent:<span class="hljs-number">.0</span>f}</span>%\n"</span>)
</code></pre>
<p>çœ‹ä¸‹è¾“å‡ºâ€¦â€¦</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#### è¾“å‡º ####</span>
============================================================
                  PERFORMANCE SHOWDOWN
============================================================

------------------------------------------------------------
             SPECULATIVE EXECUTION WORKFLOW (Our Run)
------------------------------------------------------------
<span class="hljs-number">1.</span> Agent Thinks (LLM Call <span class="hljs-number">1</span>):       <span class="hljs-number">4.21</span> seconds
   (Database Query: <span class="hljs-number">3.00</span>s ran <span class="hljs-keyword">in</span> parallel, fully hidden)
<span class="hljs-number">2.</span> Tool Result Resolution:          <span class="hljs-number">0.01</span> seconds (Instant cache hit)
<span class="hljs-number">3.</span> Synthesize Answer (LLM Call <span class="hljs-number">2</span>):  <span class="hljs-number">3.55</span> seconds
------------------------------------------------------------
Total Time to Final Answer: <span class="hljs-number">7.77</span> seconds

------------------------------------------------------------
             TRADITIONAL SEQUENTIAL WORKFLOW (Simulated)
------------------------------------------------------------
<span class="hljs-number">1.</span> Agent Thinks (LLM Call <span class="hljs-number">1</span>):       <span class="hljs-number">4.21</span> seconds
<span class="hljs-number">2.</span> Execute Tool (Database Query):   <span class="hljs-number">3.00</span> seconds (User waits)
<span class="hljs-number">3.</span> Synthesize Answer (LLM Call <span class="hljs-number">2</span>):  <span class="hljs-number">3.55</span> seconds
------------------------------------------------------------
Simulated Total Time: <span class="hljs-number">10.76</span> seconds

============================================================
                        CONCLUSION
============================================================
Time Saved: <span class="hljs-number">2.99</span> seconds
Perceived Latency Reduction: <span class="hljs-number">28</span>%
</code></pre>
<p>å‡ ä¹èŠ‚çº¦äº†â€¦â€¦å‡†ç¡®ç­‰å¾…æ…¢é€Ÿå·¥å…·è°ƒç”¨çš„æŒç»­æ—¶é—´ï¼Œä»è€Œä½¿æ€»å“åº”æ—¶é—´å‡å°‘ 28%ã€‚</p>
<p>åœ¨<strong>é¢„æµ‹æ‰§è¡Œå·¥ä½œæµ</strong>ä¸­ï¼Œ3 ç§’çš„æ•°æ®åº“æŸ¥è¯¢ä¸åˆå§‹ 4.21s çš„ LLM è°ƒç”¨åŒæ—¶è¿›è¡Œã€‚ç”±äº LLM è°ƒç”¨æ˜¯ä¸¤é¡¹å¹¶è¡Œå·¥ä½œä¸­è€—æ—¶è¾ƒé•¿çš„ï¼Œæ•°æ®åº“æ—¶å»¶è¢«å®Œå…¨éšè—ã€‚<code>tool_executor_node</code> å‡ ä¹ç¬é—´ç”¨äº† 0.01s å°±å®Œæˆäº†ï¼Œç”¨æˆ·æ„ŸçŸ¥çš„æ€»æ—¶å»¶ä»…ä¸º 7.77sã€‚</p>
<hr/>
<blockquote>
<p>Hiï¼Œæˆ‘æ˜¯ä¿å‡¡ï¼Œä¸€åå…¼å…·æŠ€æœ¯æ·±åº¦ä¸ç®¡ç†è§†é‡çš„æŠ€æœ¯ç®¡ç†è€…ã€‚æ›¾å°±èŒäº Motorolaï¼Œç°ä»»èŒäº Mavenirï¼Œå¤šå¹´å¸¦é¢†æŠ€æœ¯å›¢é˜Ÿï¼Œèšç„¦åç«¯æ¶æ„ä¸äº‘åŸç”Ÿï¼ŒæŒç»­å…³æ³¨ AI ç­‰å‰æ²¿æ–¹å‘ï¼Œä¹Ÿå…³æ³¨äººçš„æˆé•¿ï¼Œç¬ƒä¿¡æŒç»­å­¦ä¹ çš„åŠ›é‡ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä¼šåˆ†äº«æŠ€æœ¯å®è·µä¸æ€è€ƒã€‚æ¬¢è¿å…³æ³¨å…¬ä¼—å·ã€ŒDeepNoMindã€ï¼Œæ˜Ÿæ ‡ä¸è¿·è·¯ã€‚ä¹Ÿæ¬¢è¿è®¿é—®ç‹¬ç«‹ç«™ <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.deepnomind.com" title="https://www.deepnomind.com" target="_blank" ref="nofollow noopener noreferrer">www.DeepNoMind.com</a>ï¼Œä¸€èµ·äº¤æµæˆé•¿ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è®© AI æ¥ç®¡ Windows å’Œ MacOSï¼Œè¿™ä¸ª GitHub å¼€æºé¡¹ç›®ç‰›å•Šã€‚]]></title>    <link>https://juejin.cn/post/7591406441203236898</link>    <guid>https://juejin.cn/post/7591406441203236898</guid>    <pubDate>2026-01-05T02:27:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591406441203236898" data-draft-id="7591309945511854080" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è®© AI æ¥ç®¡ Windows å’Œ MacOSï¼Œè¿™ä¸ª GitHub å¼€æºé¡¹ç›®ç‰›å•Šã€‚"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-01-05T02:27:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é€›é€›GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è®© AI æ¥ç®¡ Windows å’Œ MacOSï¼Œè¿™ä¸ª GitHub å¼€æºé¡¹ç›®ç‰›å•Šã€‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é€›é€›GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T02:27:22.000Z" title="Mon Jan 05 2026 02:27:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™ä¸ªå«Â TuriX-CUA çš„å¼€æºé¡¹ç›®ä¹Ÿæ˜¯ä¸€ä¸ªè®© AI æ›¿ä½ ç©ç”µè„‘çš„ AI æ™ºèƒ½ä½“ã€‚</p>
<p>å®ƒä¹Ÿæ˜¯ç»™ AI è£…ä¸Šçœ¼ç›å’Œæ‰‹ï¼Œè®©å®ƒåƒäººä¸€æ ·çœ‹ç€å±å¹•ï¼ŒåŠ¨é¼ æ ‡ã€æ•²é”®ç›˜ï¼Œå¸®ä½ æŠŠæ´»å„¿å¹²äº†ã€‚</p>
<p>å‰ä¸¤å¤©ï¼ŒTuriX-CUAÂ åˆšæ›´æ–°äº†ä¸€æ³¢å¤§çš„ï¼Œå¼•å…¥äº†å¤šæ¨¡å‹æ¶æ„ï¼Œåœ¨æµ‹è¯•é›†é€šè¿‡ç‡è¶…è¿‡ äº† 80%ï¼Œç¡®å®æœ‰ç‚¹ä¸œè¥¿ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91b7b157991a45af8f9faa4ad2ae538a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184841&amp;x-signature=ROGmymAh473OPtcqEPFi5m%2B1sL0%3D" alt="å›¾ç‰‡" loading="lazy"/></p>

<pre><code class="hljs language-arduino" lang="arduino">å¼€æºåœ°å€ï¼šhttps:<span class="hljs-comment">//github.com/TurixAI/TuriX-CUA</span>
</code></pre>
<h2 data-id="heading-0">01ã€å¼€æºé¡¹ç›®ç®€ä»‹</h2>
<p>TuriX-CUAï¼ˆComputer Use Agentï¼‰æ˜¯ä¸€ä¸ªåŸºäº Python çš„å¼€æº Agentã€‚å®ƒçš„æ ¸å¿ƒé€»è¾‘éå¸¸æš´åŠ›ç¾å­¦ï¼š</p>
<p>çœ‹ï¼ˆSeeï¼‰ï¼šæ¯éš”å‡ ç§’æˆªä¸€å¼ ä½ å±å¹•çš„å›¾ã€‚</p>
<p>æƒ³ï¼ˆThinkï¼‰ï¼šæŠŠæˆªå›¾æ‰”ç»™å¤šæ¨¡æ€å¤§æ¨¡å‹ï¼Œé—®å®ƒï¼šâ€œè€é“ï¼Œç”¨æˆ·è®©æˆ‘è®¢æœºç¥¨ï¼Œç°åœ¨å±å¹•ä¸Šè¿™æƒ…å†µï¼Œæˆ‘ä¸‹ä¸€æ­¥è¯¥ç‚¹å“ªï¼Ÿâ€</p>
<p>åŠ¨ï¼ˆActï¼‰ï¼šæ¨¡å‹è¿”å›åæ ‡ï¼ŒTuriX æ§åˆ¶ä½ çš„é¼ æ ‡ç§»è¿‡å»ç‚¹å‡»ï¼Œæˆ–è€…åœ¨è¾“å…¥æ¡†é‡Œæ‰“å­—ã€‚</p>
<p>å¬èµ·æ¥æ˜¯ä¸æ˜¯åƒä¸ªå®ï¼Ÿä¸ï¼Œå®æ˜¯æ­»çš„ï¼Œå®ƒæ˜¯æ´»çš„ã€‚é‡åˆ°å¼¹çª—å®ƒçŸ¥é“å…³ï¼Œé‡åˆ°ç½‘é¡µåŠ è½½æ…¢å®ƒçŸ¥é“ç­‰ï¼Œè¿™å°±å¾ˆçµæ€§ã€‚</p>
<p>è€Œä¸”åœ¨æˆåŠŸç‡å’Œé€Ÿåº¦æ–¹é¢æ¯”å…¶å®ƒå¼€æº Agent è¦å¥½ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95df0fed893c430c8b486027517b0438~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184841&amp;x-signature=JII5y1SYW6QeKhP3qidWoE7m%2BNQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-1">02ã€ä¸ºä»€ä¹ˆå®ƒå€¼å¾—å…³æ³¨ï¼Ÿ</h2>
<p>è·¨å¹³å°æ”¯æŒ</p>
<p>æœ€å¼€å§‹è¿™é¡¹ç›®æ˜¯ä¸“é—¨æMacOSçš„ï¼Œä½†åˆ°äº†2025å¹´ä¸‹åŠå¹´ï¼Œå®ƒå·²ç»æ”¯æŒ Windows äº†ã€‚</p>
<p>è¿™å¯¹äºå’±ä»¬å¤§å¤šæ•°ç”¨ PC æ‰“å·¥çš„äººæ¥è¯´å¤ªé‡è¦äº†ã€‚åªè¦åˆ‡æ¢åˆ° Windows åˆ†æ”¯ï¼Œå°±èƒ½åœ¨ Windows ä¸Šè·‘ã€‚
ä¸‹é¢ä¸¾ä¾‹è§†é¢‘è¯·å‚è€ƒåŸæ–‡ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FBBXv5K7GW9VdgURqo8-vdA" target="_blank" title="https://mp.weixin.qq.com/s/BBXv5K7GW9VdgURqo8-vdA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/BBXv5K7GWâ€¦</a></p>
<p>MacOS ç«¯æ”¯æŒ</p>
<p>é¢„è®¢æœºç¥¨ã€é…’åº—å’Œ Uberã€‚</p>
<p>æœç´¢ iPhone ä»·æ ¼ï¼Œåˆ›å»º Pages æ–‡æ¡£ï¼Œå¹¶å‘é€ç»™è”ç³»äººï¼ŒæŠŠ Discord ä¸­è€æ¿å‘é€çš„æ•°å­—æ–‡ä»¶ä¸­ç”ŸæˆæŸ±çŠ¶å›¾ï¼Œå¹¶æ’å…¥åˆ°æˆ‘çš„ PowerPoint çš„åˆé€‚ä½ç½®ï¼Œç„¶åå›å¤è€æ¿ã€‚</p>
<p>Windows ç«¯æ”¯æŒ</p>
<p><strong>åœ¨ YouTube æœç´¢è§†é¢‘å†…å®¹å¹¶ç‚¹èµ</strong></p>
<p>æ”¯æŒ MCP åè®®</p>
<p>æ”¯æŒ MCP æ„å‘³ç€ä½ å¯ä»¥æŠŠ TuriX å½“æˆä¸€ä¸ªå·¥å…·äººæŒ‚è½½åˆ° Claude for Desktop æˆ–è€… Cursor ä¸Šã€‚</p>
<p>ä½ å¯ä»¥ç›´æ¥å¯¹Â ClaudeÂ è¯´ï¼šâ€œå¸®æˆ‘æŸ¥ä¸€ä¸‹æœ€è¿‘çš„ AI æ–°é—»ï¼Œç„¶åå†™ä¸ªæ–‡æ¡£å‘ç»™è€å¼ ã€‚â€</p>
<p>ClaudeÂ é€šè¿‡ MCP æŒ‡æŒ¥ TuriX å»æµè§ˆå™¨æœç´¢ã€å» Word é‡Œæ‰“å­—ã€å»å¾®ä¿¡é‡Œå‘æ¶ˆæ¯ã€‚è¿™ç®€ç›´å°±æ˜¯å·¦å³äº’ææœ¯ï¼Œæ•ˆç‡ç¿»å€ï¼š</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æ”¯æŒå¤šæ¨¡å‹æ¶æ„ï¼ˆMulti-Agentï¼‰ï¼ŒPlannerï¼ˆè§„åˆ’å¸ˆï¼‰è´Ÿè´£æŠŠå¤§ä»»åŠ¡æ‹†è§£æˆæ­¥éª¤ã€‚</p>
<p>Executorï¼ˆæ‰§è¡Œè€…ï¼‰è´Ÿè´£å…·ä½“çš„ç‚¹å‡»å’Œè¾“å…¥ã€‚è¿™ç§è„‘æ‰‹åˆ†ç¦»çš„è®¾è®¡ï¼Œå¤§å¤§é™ä½äº†æ¨¡å‹å‘ç™«ä¹±ç‚¹çš„æ¦‚ç‡ã€‚</p>
<h2 data-id="heading-2">03ã€å¦‚ä½•ä½¿ç”¨</h2>
<p>è™½ç„¶ GitHub ä¸Šæœ‰æ–‡æ¡£ï¼Œä½†æœ‰äº›å‘è¿˜å¾—æˆ‘æ›¿ä½ ä»¬è¸©ã€‚è¿™é‡Œä»¥ Mac ä¸ºä¾‹ï¼ŒWindows é€»è¾‘å·®ä¸å¤šã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šç¯å¢ƒå‡†å¤‡</p>
<p>é¦–å…ˆï¼Œä½ å¾—æœ‰ Python ç¯å¢ƒã€‚å¼ºçƒˆå»ºè®®ç”¨ Condaï¼Œä¸ç„¶ä¾èµ–åŒ…èƒ½æŠŠä½ æç–¯ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">conda create -n turix_env python=3.12conda activate turix_envgitÂ <span class="hljs-built_in">clone</span>Â https://github.com/TurixAI/TuriX-CUA.gitcdÂ TuriX-CUApip install -r requirements.txt
</code></pre>
<p>ç¬¬äºŒæ­¥ï¼šæå®šæ¨¡å‹</p>
<p>åœ¨ examples/config.json é‡Œé…ç½®æ¨¡å‹ã€‚å®˜æ–¹é»˜è®¤æ¨èç”¨å®ƒä»¬è‡ªå®¶çš„ APIï¼ˆTurix APIï¼‰ï¼Œæ³¨å†Œé€ç‚¹é¢åº¦ã€‚</p>
<p>æ—¢ç„¶æ˜¯å¼€æºï¼Œå’±ä»¬å…¶å®å¯ä»¥æ¢æˆè‡ªå·±çš„æ¨¡å‹ã€‚å¦‚æœä½ æœ‰ OpenAI å…¼å®¹çš„æ¥å£ï¼Œæˆ–è€…æœ¬åœ°è·‘äº†ä¸ª Qwen3-VLï¼Œæ”¹æ”¹ main.py é‡Œçš„ build_llm å‡½æ•°å°±èƒ½ç”¨ã€‚</p>
<p>æ³¨æ„ï¼šç°åœ¨çš„ Qwen3-VL åœ¨å¤„ç† UI ç•Œé¢ä¸Šçš„èƒ½åŠ›éå¸¸å¼ºï¼Œè¯†åˆ«å°å›¾æ ‡è´¼å‡†ï¼Œå¼ºçƒˆæ¨èè¯•è¯•ã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼šæƒé™åœ°ç‹±</p>
<p>å› ä¸º TuriX è¦æ§åˆ¶é¼ æ ‡é”®ç›˜ï¼Œè¿˜è¦å½•å±ï¼ŒMac çš„å®‰å…¨æœºåˆ¶ä¼šç–¯ç‹‚æŠ¥è­¦ã€‚</p>
<p>å» ç³»ç»Ÿè®¾ç½® -&gt; éšç§ä¸å®‰å…¨æ€§ -&gt; è¾…åŠ©åŠŸèƒ½ï¼ŒæŠŠä½ çš„ç»ˆç«¯å’Œ IDEéƒ½å‹¾ä¸Šã€‚å¦‚æœä½ è¦æ“ä½œ Safariï¼Œè®°å¾—åœ¨ Safari çš„å¼€å‘èœå•é‡Œå‹¾ä¸Šå…è®¸è¿œç¨‹è‡ªåŠ¨åŒ–ã€‚</p>
<p>ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œç³»ç»Ÿå¯èƒ½ä¼šå¼¹çª—é—®ä½ æ˜¯å¦å…è®¸æ§åˆ¶ç”µè„‘ï¼Œä¸€å®šè¦ç‚¹å…è®¸ï¼Œä¸ç„¶é¼ æ ‡åªä¼šåŸåœ°æŠ½æã€‚</p>
<p>ç¬¬å››æ­¥ï¼šå¼€è·‘</p>
<p>é…ç½®å¥½ä»»åŠ¡ï¼Œæ¯”å¦‚åœ¨ config.json é‡Œå†™ä¸Šï¼š</p>

<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>Â Â <span class="hljs-attr">"agent"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-punctuation">{</span>Â  Â Â <span class="hljs-attr">"task"</span><span class="hljs-punctuation">:</span>Â <span class="hljs-string">"æ‰“å¼€Safariï¼Œæœç´¢ä¸€ä¸‹iPhone 17 Proç°åœ¨çš„ä»·æ ¼ï¼Œç„¶åæ‰“å¼€å¤‡å¿˜å½•è®°ä¸‹æ¥"</span>Â Â <span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span>
</code></pre>
<p>ç„¶åè¿è¡Œï¼š</p>

<pre><code class="hljs language-bash" lang="bash">python examples/main.py
</code></pre>
<p>è¿™æ—¶å€™ï¼Œä½ åŒæ‰‹ç¦»å¼€é”®ç›˜ï¼Œå°±ä¼šçœ‹åˆ°é¼ æ ‡è‡ªå·±åŠ¨äº†èµ·æ¥ï¼Œåƒå¹½çµä¸€æ ·æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥æ–‡å­—ï¼ŒçœŸæœ‰ç‚¹èµ›åšæœ‹å…‹çš„æ„Ÿè§‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å®æµ‹ MiniMax M2.1ï¼šå›½äº§å¤§æ¨¡å‹èƒ½æ›¿ä»£ Claude åšé¡¹ç›®å—ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7591510174046617651</link>    <guid>https://juejin.cn/post/7591510174046617651</guid>    <pubDate>2026-01-05T02:27:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591510174046617651" data-draft-id="7591421956216897574" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å®æµ‹ MiniMax M2.1ï¼šå›½äº§å¤§æ¨¡å‹èƒ½æ›¿ä»£ Claude åšé¡¹ç›®å—ï¼Ÿ"/> <meta itemprop="keywords" content="LLM,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2026-01-05T02:27:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘ä¹¦è¯»çš„å°‘ä½ å¯åˆ«éª—æˆ‘"/> <meta itemprop="url" content="https://juejin.cn/user/2313028192971901"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å®æµ‹ MiniMax M2.1ï¼šå›½äº§å¤§æ¨¡å‹èƒ½æ›¿ä»£ Claude åšé¡¹ç›®å—ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2313028192971901/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘ä¹¦è¯»çš„å°‘ä½ å¯åˆ«éª—æˆ‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T02:27:44.000Z" title="Mon Jan 05 2026 02:27:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘ä¸¤å¤©æµ‹è¯•æœ€æ–°å‘å¸ƒçš„ MiniMax M2.1ï¼Œè¿™æ˜¯ä¸€æ¬¾ç”±å›½å†…å›¢é˜Ÿå¼€å‘çš„å¤§å‹è¯­è¨€æ¨¡å‹ã€‚ç»è¿‡å¤šæ–¹é¢çš„æµ‹è¯•ï¼Œæˆ‘å¯¹å›½äº§å¤§æ¨¡å‹ç¼–ç¨‹èƒ½åŠ›çš„æœªæ¥å……æ»¡äº†ä¿¡å¿ƒã€‚</p>
<h3 data-id="heading-0">ä¿®æ”¹å¤šä¸ªç•Œé¢ä¹‹é—´çš„è·³è½¬é€»è¾‘</h3>
<p>è®©å®ƒå¸®å¿™ä¿®æ”¹å¤šä¸ªç•Œé¢ä¹‹é—´çš„è·³è½¬é€»è¾‘ï¼Œæ•´ä½“ä¸Šä»¤äººæ»¡æ„ï¼Œä¸€æ¬¡æ€§è¿‡å…³ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13c0456f32ff4384b49c505ecac2c899~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5Lmm6K-755qE5bCR5L2g5Y-v5Yir6aqX5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184864&amp;x-signature=ubzEfIunP0GlkC8qxwBmUTMJJi0%3D" alt="MiniMax M2.1 ä¿®æ”¹è·³è½¬é€»è¾‘" loading="lazy"/></p>
<h3 data-id="heading-1">æ’æŸ¥è¿œç¨‹æ¥å£æ•°æ®æ— æ³•æ˜¾ç¤ºé—®é¢˜</h3>
<p>æˆ‘çš„é¡¹ç›®æ˜¯ä¸€ä¸ª Android åº”ç”¨ï¼Œé‡‡ç”¨ Google å®˜æ–¹æ¨èæ¶æ„ Clean Architectureã€‚å®ƒä¼šé€å±‚ä» Activity -&gt; ViewModel -&gt; Repository -&gt; Remote Data Source -&gt; API æ¥å£æ’æŸ¥é—®é¢˜ã€‚æœ€ååˆ†æåŸå› ï¼Œæˆ‘è®¤ä¸ºå®ƒçš„åˆ†æå’Œç»“è®ºæ˜¯æ­£ç¡®çš„ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4636ecdf7c5a4ea185405874ff39edc0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5Lmm6K-755qE5bCR5L2g5Y-v5Yir6aqX5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184864&amp;x-signature=w3lfYxza17PkIOnXgZi1tk3qJUU%3D" alt="MiniMax M2.1 æ’æŸ¥è¿œç¨‹æ¥å£æ•°æ®æ— æ³•æ˜¾ç¤ºé—®é¢˜" loading="lazy"/></p>
<h3 data-id="heading-2">å¤æ‚é€»è¾‘ï¼ŒåŸºäºç°æœ‰ä¸¤ä¸ªé¡¹ç›®åˆå¹¶æˆä¸€ä¸ªé¡¹ç›®</h3>
<p>æˆ‘æœ‰ä¸¤ä¸ªå°å‹å·¥å…·ç±»é¡¹ç›®ï¼Œä¸»è¦æ˜¯å¸®æˆ‘å¤„ç†å¤šè¯­è¨€æ–‡æ¡ˆçš„é—®é¢˜ã€‚</p>
<p>å› ä¸ºï¼Œæˆ‘ä»¬å…¬å¸çš„æ–‡æ¡ˆæ˜¯æ”¾åˆ° Excel è¡¨æ ¼ä¸­çš„ï¼Œä¸åŒè¯­è¨€æ”¾åœ¨ä¸åŒçš„åˆ—é‡Œã€‚æ¯æ¬¡æ–°å¢ä¿®æ”¹æ–‡æ¡ˆï¼Œéƒ½éœ€è¦æ‰‹åŠ¨åŒæ­¥åˆ° Android é¡¹ç›®ï¼Œå·¥ä½œé‡æ¯”è¾ƒå¤§ã€‚æ‰€ä»¥ï¼Œæˆ‘å†™äº†ä¸¤ä¸ªå°å·¥å…·é¡¹ç›®æ¥å¸®å¿™å¤„ç†è¿™äº›æ–‡æ¡ˆã€‚ä¸€ä¸ªæ˜¯æŠŠ Excel è¡¨æ ¼è½¬æ¢æˆ Android é¡¹ç›® strings.xml æ–‡ä»¶çš„å·¥å…·ï¼Œå¦ä¸€ä¸ªæ˜¯æŠŠè½¬æ¢å strings.xml æ–‡ä»¶æ›¿æ¢é¡¹ç›®ä¸­å·²æœ‰æ–‡æ¡ˆçš„å·¥å…·ã€‚</p>
<p>æˆ‘å‘ç°ï¼Œè¿™ä¸¤ä¸ªå·¥å…·è¿˜æ˜¯ä¸å¤ªæ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘è®© MiniMax M2.1 å¸®æˆ‘ä¼˜åŒ–ä¸€ä¸‹ï¼ŒæŠŠå®ƒä»¬åˆå¹¶æˆä¸€ä¸ªåŸºäº Electron æ¡Œé¢åº”ç”¨ï¼Œèƒ½å¤Ÿä¸€é”®æŠŠ Excel è¡¨æ ¼è½¬æ¢æˆ strings.xml æ–‡ä»¶ï¼Œå¹¶ä¸”æ›¿æ¢æ‰ Android é¡¹ç›®ä¸­çš„å·²æœ‰æ–‡æ¡ˆã€‚</p>
<p>æ—§é¡¹ç›®æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1ffced46c2454d8ba0818b3c16c9e351~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5Lmm6K-755qE5bCR5L2g5Y-v5Yir6aqX5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184864&amp;x-signature=2tT0eWjwfAfwkUUGeGNgHC24eyo%3D" alt="æ—§ Excel è½¬ Strings" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e1a2f5b66e34d54893ca59e703506a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5Lmm6K-755qE5bCR5L2g5Y-v5Yir6aqX5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184864&amp;x-signature=hUPfqAEMkU5UAWRPMxMRRFP3Qno%3D" alt="æ—§ æ›¿æ¢æ–‡æ¡ˆ" loading="lazy"/></p>
<p>ç»è¿‡ MiniMax M2.1 çš„ä¼˜åŒ–ï¼Œæ–°çš„é¡¹ç›®æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a75d130bb014a84bff3123b3281449e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5Lmm6K-755qE5bCR5L2g5Y-v5Yir6aqX5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184864&amp;x-signature=fS1fsZNiRnwz86u7tKJDbd3DF6w%3D" alt="æ–° Excel è½¬ Strings å¹¶æ›¿æ¢" loading="lazy"/></p>
<p>å®ƒè¿˜å¸®æˆ‘å®ç°äº†ä¸€ä¸ªé¢„è§ˆåŠŸèƒ½ï¼Œèƒ½å¤Ÿé¢„è§ˆå“ªäº›æ–‡æ¡ˆä¼šè¢«æ›¿æ¢æ‰ï¼Œé¿å…è¯¯æ“ä½œã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8214527e41c4ae2967f0cf30f819f34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5Lmm6K-755qE5bCR5L2g5Y-v5Yir6aqX5oiR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768184864&amp;x-signature=xjaFZ2OlPOHXyimAr5j10dSIDxs%3D" alt="æ–° æ›¿æ¢æ–‡æ¡ˆé¢„è§ˆ" loading="lazy"/></p>
<p>å½“ç„¶ï¼Œè¿™äº›ä¸æ˜¯ä¸€æ¬¡æ€§å°±å®Œæˆçš„ï¼Œæˆ‘å’Œå®ƒåå¤æ²Ÿé€šäº†å¥½å‡ æ¬¡ï¼Œæ‰è¾¾æˆæœ€ç»ˆæ•ˆæœã€‚ä¸è¿‡ï¼Œæ•´ä½“ä¸Šæ¥è¯´ï¼Œå®ƒå¸®æˆ‘èŠ‚çœäº†ä¸å°‘æ—¶é—´ã€‚</p>
<h2 data-id="heading-3">æ€»ç»“</h2>
<p>é€šè¿‡è¿™ä¸¤å¤©çš„æµ‹è¯•ï¼Œæˆ‘å¯¹ MiniMax M2.1 çš„ç¼–ç¨‹èƒ½åŠ›å°è±¡æ·±åˆ»ã€‚å®ƒä¸ä»…èƒ½å¤Ÿç†è§£å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿˜èƒ½æ ¹æ®æˆ‘çš„éœ€æ±‚è¿›è¡Œå¤šæ¬¡è¿­ä»£ä¼˜åŒ–ã€‚è™½ç„¶è¿˜å­˜åœ¨ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œä½†æ•´ä½“è¡¨ç°å·²ç»éå¸¸å‡ºè‰²ã€‚æ¯”æˆ‘é¢„æœŸæƒ³è±¡çš„è¦å¥½å¾ˆå¤šã€‚</p>
<p>æ€»ä¹‹ï¼Œæˆ‘è§‰å¾—åœ¨ç°å®é¡¹ç›®ä¸­ä½¿ç”¨å›½äº§å¤§æ¨¡å‹å·²ç»æ˜¯ä¸€ä¸ªå¯è¡Œçš„é€‰æ‹©äº†ã€‚</p>
<p>æœ¬æ¥ï¼Œæˆ‘è¿˜æƒ³é€šè¿‡å®ƒå’Œ GLM-4.7 è¿›è¡Œå¯¹æ¯”æµ‹è¯•çš„ã€‚ä½†æ˜¯ï¼Œçœ‹åˆ°å®ƒçš„è¡¨ç°è¿™ä¹ˆçªå‡ºï¼Œæˆ‘è§‰å¾—æ²¡å¿…è¦äº†ã€‚èƒ½è§£å†³é—®é¢˜å°±è¡Œï¼Œä¸éœ€è¦è¿‡å¤šçº ç»“å“ªä¸ªæ›´å¼ºã€‚</p>
<p>æœ€åï¼Œä½ ç”¨å›½äº§å¤§æ¨¡å‹è¸©è¿‡ä»€ä¹ˆå‘ï¼Ÿ</p>
<p>æ›´å¤šå¤§æ¨¡å‹å¼€å‘æŠ€å·§ï¼Œæˆ‘ä¼šåŒæ­¥æ›´æ–°åœ¨å…¬ä¼—å·ã€ŒITPostmanã€ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[YOLOv12ä¹‹åï¼ŒAIåœ¨ç«åœºå¦‚ä½•è¿›åŒ–ï¼Ÿ2025æœ€åä¸€ç¯‡YOLOè®ºæ–‡æ­ç¤ºï¼šè¦åœ¨æµ“çƒŸä¸­çœ‹è§å…³é”®ï¼Œä»…é æ³¨æ„åŠ›è¿˜ä¸å¤Ÿ]]></title>    <link>https://juejin.cn/post/7591420438849454116</link>    <guid>https://juejin.cn/post/7591420438849454116</guid>    <pubDate>2026-01-05T02:32:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591420438849454116" data-draft-id="7591510742634676287" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="YOLOv12ä¹‹åï¼ŒAIåœ¨ç«åœºå¦‚ä½•è¿›åŒ–ï¼Ÿ2025æœ€åä¸€ç¯‡YOLOè®ºæ–‡æ­ç¤ºï¼šè¦åœ¨æµ“çƒŸä¸­çœ‹è§å…³é”®ï¼Œä»…é æ³¨æ„åŠ›è¿˜ä¸å¤Ÿ"/> <meta itemprop="keywords" content="ç®—æ³•,è®¡ç®—æœºè§†è§‰,æ·±åº¦å­¦ä¹ "/> <meta itemprop="datePublished" content="2026-01-05T02:32:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            YOLOv12ä¹‹åï¼ŒAIåœ¨ç«åœºå¦‚ä½•è¿›åŒ–ï¼Ÿ2025æœ€åä¸€ç¯‡YOLOè®ºæ–‡æ­ç¤ºï¼šè¦åœ¨æµ“çƒŸä¸­çœ‹è§å…³é”®ï¼Œä»…é æ³¨æ„åŠ›è¿˜ä¸å¤Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T02:32:55.000Z" title="Mon Jan 05 2026 02:32:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸï¼Œç›®æ ‡æ£€æµ‹å§‹ç»ˆæ˜¯ä¸€ä¸ªå……æ»¡æ´»åŠ›ä¸”è‡³å…³é‡è¦çš„ç ”ç©¶æ–¹å‘ã€‚ä»æœ€åˆçš„R-CNNç³»åˆ—åˆ°å¦‚ä»Šç™¾èŠ±é½æ”¾çš„ç®—æ³•å®¶æ—ï¼Œå…¶æ¼”è¿›å²å°±æ˜¯ä¸€éƒ¨è¿½æ±‚â€œæ›´å¿«ã€æ›´å‡†ã€æ›´æ™ºèƒ½â€çš„å¥‹æ–—å²ã€‚è€Œå…¶ä¸­ï¼ŒYOLOç³»åˆ—å‡­å€Ÿå…¶ç‹¬ç‰¹çš„ä¸€é˜¶æ®µæ£€æµ‹æ€è·¯ã€å“è¶Šçš„å®æ—¶æ€§èƒ½å’Œé«˜ç²¾åº¦çš„å·§å¦™å¹³è¡¡ï¼Œé•¿æœŸä»¥æ¥éƒ½æ˜¯å·¥ä¸šç•Œå’Œå­¦æœ¯ç•Œå…³æ³¨çš„ç„¦ç‚¹ï¼ŒYOLOçš„è¿›åŒ–ä¹Ÿä»æœªåœæ­¢ã€‚åœ¨ä¿è¯é€Ÿåº¦çš„å‰æä¸‹ï¼Œæ·±åº¦é›†æˆå¤šç§æ³¨æ„åŠ›æœºåˆ¶æ˜¯æå‡æ¨¡å‹åœ¨å¤æ‚åœºæ™¯ä¸‹åˆ¤åˆ«åŠ›çš„å…³é”®è·¯å¾„ã€‚ è¿™ä¹Ÿå¼•å‡ºäº†æˆ‘ä»¬ä»Šå¤©è¦æ¢è®¨çš„æ ¸å¿ƒé—®é¢˜ï¼šå½“é¢å¯¹æç«¯ç¯å¢ƒï¼Œæ¯”å¦‚æµ“çƒŸæ»šæ»šã€ç«å…‰å†²å¤©ã€èƒŒæ™¯æ‚ä¹±ã€ç›®æ ‡å¾®å°çš„æ¶ˆé˜²æ•‘æ´ç°åœºæ—¶ï¼Œç°æœ‰çš„YOLOâ€œåˆ©å™¨â€æ˜¯å¦ä¾ç„¶é”‹åˆ©ï¼Ÿåˆè¯¥å¦‚ä½•é”»é€ ä¸€æŠŠæ›´é€‚åº”æ­¤ç­‰â€œåœ°ç‹±éš¾åº¦â€åœºæ™¯çš„æ–°æ­¦å™¨ï¼Ÿ</p>
<p>ã€ŠFireRescue: A UAV-Based Dataset and Enhanced YOLO Model for Object Detection in Fire Rescue Scenesã€‹çš„ç ”ç©¶ç»™å‡ºäº†ç²¾å½©çš„ç­”æ¡ˆã€‚å®ƒä¸ä»…æ­ç¤ºäº†ç°æœ‰æ¨¡å‹åœ¨å‚ç›´åº”ç”¨é¢†åŸŸçš„å±€é™ï¼Œæ›´é€šè¿‡æ„å»ºå¤§è§„æ¨¡æ¶ˆé˜²æ•‘æ´ä¸“ç”¨æ•°æ®é›†å’Œæå‡ºå¢å¼ºå‹FRS-YOLOæ¨¡å‹ï¼Œä¸ºæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•é’ˆå¯¹ç‰¹å®šåœºæ™¯çš„ç—›ç‚¹è¿›è¡Œç²¾å‡†åˆ›æ–°ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b409b7fd48c2485391c2f48ff51fc04e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768185174&amp;x-signature=rvdhu40AE05JJfNoP9wpm8308t0%3D" alt="å›¾ç‰‡1.png" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>ç—›ç‚¹å‰–æï¼šä¸ºä»€ä¹ˆé€šç”¨YOLOåœ¨ç«åœºä¼šâ€œå¤±çµâ€ï¼Ÿ</strong></h2>
<p>æƒ³è±¡ä¸€ä¸‹æ— äººæœºä»é«˜ç©ºä¿¯ç°ç«åœºçš„ç”»é¢ï¼šæ¶ˆé˜²è½¦å°å¦‚èšè™«ï¼Œæ·¹æ²¡åœ¨å»ºç­‘å’Œè½¦è¾†çš„èƒŒæ™¯ä¸­ï¼›æµ“å¯†çš„é»‘çƒŸä¸å–·æº…çš„æ°´é›¾è®©ç”»é¢æ¨¡ç³Šä¸æ¸…ï¼Œå¯¹æ¯”åº¦éª¤é™ï¼›ä¸€è¾†çº¢è‰²æ™®é€šå¡è½¦å’Œä¸€è¾†æ¶ˆé˜²è½¦å¹¶è‚©åœæ”¾ï¼Œè½®å»“ç›¸ä¼¼ï¼Œææ˜“æ··æ·†â€¦â€¦è¿™äº›åœºæ™¯å¯¹ç›®æ ‡æ£€æµ‹å™¨æå‡ºäº†ä¸¥å³»æŒ‘æˆ˜ï¼š</p>
<ul>
<li><strong>æ•°æ®é¸¿æ²Ÿï¼š</strong> ä¸»æµæ•°æ®é›†ï¼ˆå¦‚COCOã€VisDroneï¼‰ç¼ºä¹æ¶ˆé˜²è½¦ã€æ¶ˆé˜²å‘˜ã€ç«ç„°ã€çƒŸé›¾ç­‰å…³é”®ç±»åˆ«ï¼Œæ¨¡å‹â€œæ²¡è§è¿‡â€è‡ªç„¶â€œè®¤ä¸å‡ºâ€ã€‚</li>
<li><strong>å°ç›®æ ‡ä¸é®æŒ¡ï¼š</strong> é«˜ç©ºè§†è§’ä¸‹ï¼Œå…³é”®ç›®æ ‡åƒç´ å æ¯”æå°ï¼ŒåŠ ä¹‹è½¦è¾†ã€å»ºç­‘é®æŒ¡ï¼Œä¼ ç»Ÿæ£€æµ‹å™¨ç‰¹å¾æå–å›°éš¾ï¼Œæ¼æ£€ç‡é«˜ã€‚</li>
<li><strong>æç«¯è§†è§‰å¹²æ‰°ï¼š</strong> çƒŸé›¾ã€ç«ç„°ã€æ°´èŠ±ã€ç°å°˜é€ æˆä¸¥é‡çš„å›¾åƒé€€åŒ–ï¼Œæ¨¡å‹é²æ£’æ€§é¢ä¸´å·¨å¤§è€ƒéªŒã€‚</li>
<li><strong>ç±»é—´ç›¸ä¼¼æ€§æ··æ·†ï¼š</strong> æ¶ˆé˜²è½¦ä¸æ™®é€šå¡è½¦ã€å·¥ç¨‹è½¦ç­‰åœ¨é¢œè‰²ã€å½¢çŠ¶ä¸Šé«˜åº¦ç›¸ä¼¼ï¼Œåœ¨å¯†é›†åœºæ™¯ä¸‹æ˜“å¼•å‘è¿é”è¯¯æ£€ã€‚</li>
</ul>
<h2 data-id="heading-1"><strong>åŸºçŸ³ï¼šFireRescueâ€”â€”ä¸“ä¸ºâ€œé€†ç«è€Œè¡Œâ€æ‰“é€ çš„æ•°æ®é›†</strong></h2>
<p>ä¸ºäº†è§£å†³â€œæ— ç±³ä¹‹ç‚Šâ€çš„é—®é¢˜ï¼Œç ”ç©¶å›¢é˜Ÿé¦–å…ˆæ„å»ºäº†FireRescueæ•°æ®é›†ã€‚è¿™ä¸ªæ•°æ®é›†å ªç§°æ¶ˆé˜²æ•‘æ´è§†è§‰AIçš„â€œé‡Œç¨‹ç¢‘â€ï¼š</p>
<ul>
<li><strong>è§„æ¨¡ä¸è´¨é‡ï¼š</strong> åŒ…å«15,980å¼ æ— äººæœºèˆªæ‹å›¾åƒï¼Œ32,000+ä¸ªé«˜è´¨é‡æ ‡æ³¨æ¡†ã€‚</li>
<li><strong>åœºæ™¯ä¸ç±»åˆ«ï¼š</strong> è¦†ç›–åŸå¸‚ã€å±±åœ°ã€æ£®æ—ã€æ°´åŸŸç­‰å¤šåœºæ™¯ï¼Œèšç„¦8ç±»å…³é”®ç›®æ ‡ï¼ŒåŒ…æ‹¬5ç§ä¸“ä¸šæ¶ˆé˜²è½¦ã€æ¶ˆé˜²å‘˜ã€ç«ç„°ã€çƒŸé›¾ã€‚</li>
<li><strong>ä¸“ä¸šä¿éšœï¼š</strong> æ‰€æœ‰æ ‡æ³¨å‡ç”±èµ„æ·±æ¶ˆé˜²ä¸“å®¶å›¢é˜Ÿé€å¸§å®¡æ ¸æ ¡æ­£ï¼Œç¡®ä¿åœ¨å¤æ‚ç«åœºç¯å¢ƒä¸‹çš„è¯­ä¹‰æ­£ç¡®æ€§ã€‚</li>
<li><strong>æŒ‘æˆ˜æ€§ï¼š</strong> åŒ…å«äº†å¤§é‡å¤œé—´ã€é›¨é›¾å¤©æ°”ã€å°ç›®æ ‡ã€ä¸¥é‡é®æŒ¡å’Œæç«¯å¹²æ‰°çš„æ ·æœ¬ï¼Œæ›´èƒ½æ£€éªŒæ¨¡å‹çš„çœŸå®èƒ½åŠ›ã€‚</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/501a87ba59b24c4398d7183c9ae773de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768185174&amp;x-signature=wDjddAzCJ5GqMXGdNcx%2BmlOAz8w%3D" alt="å›¾ç‰‡2.png" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>FRS-YOLOçš„ä¸¤å¤§æ ¸å¿ƒåˆ›æ–°</strong></h2>
<p>æœ‰äº†é«˜è´¨é‡æ•°æ®ï¼Œè¿˜éœ€å¼ºå¤§çš„æ¨¡å‹ã€‚ç ”ç©¶å›¢é˜Ÿåœ¨YOLOv12çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œäº†ä¸¤é¡¹å…³é”®åˆ›æ–°ï¼Œæ‰“é€ å‡ºFRS-YOLOã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff8f089b5a9f4075999c324549a5fae6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768185174&amp;x-signature=WdIe2nS1RYJKm9wWTXQ3mUdVq8o%3D" alt="å›¾ç‰‡3.png" loading="lazy"/></p>
<ul>
<li><strong>åˆ›æ–°ä¸€ï¼šå¤šç»´ååŒå¢å¼ºæ³¨æ„åŠ›æ¨¡å—</strong></li>
</ul>
<p>æ³¨æ„åŠ›æœºåˆ¶èƒ½è®©æ¨¡å‹â€œèšç„¦â€å…³é”®ä¿¡æ¯ã€‚ä½†ä¼ ç»Ÿæ³¨æ„åŠ›ï¼ˆå¦‚SEã€CBAMï¼‰åœ¨ç«åœºè¿™ç§å¤æ‚èƒŒæ™¯ä¸‹ï¼Œå®¹æ˜“è¢«æ— å…³ä¿¡æ¯åˆ†æ•£ï¼Œæˆ–å› ä¸ºé™ç»´æ“ä½œä¸¢å¤±é‡è¦ç‰¹å¾ã€‚</p>
<p>MCEAæ¨¡å—çš„èªæ˜ä¹‹å¤„åœ¨äºï¼š</p>
<p>ä¸‰é‡ä¿¡æ¯èšåˆï¼šå®ƒæ²¡æœ‰ç®€å•åœ°ä½¿ç”¨å•ä¸€æ± åŒ–ï¼Œè€Œæ˜¯å¹¶è¡Œæ•´åˆäº†å…¨å±€å¹³å‡æ± åŒ–ã€æ ‡å‡†å·®æ± åŒ–å’Œå…¨å±€æœ€å¤§æ± åŒ–ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d795e9ae340f42e19cc4180099b24bb3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768185174&amp;x-signature=sBYYlkiS6UHA0aosFnHN2KxYmzc%3D" alt="å›¾ç‰‡4.png" loading="lazy"/></p>
<p><strong>ä¸ºä½•æ˜¯ä¸‰è€…ï¼Ÿ</strong></p>
<ul>
<li>å¹³å‡æ± åŒ–ï¼šè·å–æ•´ä½“ä¸Šä¸‹æ–‡ã€‚</li>
<li>æ ‡å‡†å·®æ± åŒ–ï¼šæ•æ‰ç‰¹å¾å†…éƒ¨çš„æ³¢åŠ¨ä¸å·®å¼‚ã€‚</li>
<li><strong>æœ€å¤§æ± åŒ–ï¼ˆå…³é”®ï¼ï¼‰</strong> ï¼šç›´æ¥â€œé”å®šâ€æœ€æ˜¾è‘—çš„ç‰¹å¾ç‚¹ï¼ˆå¦‚æ¶ˆé˜²è½¦çš„äº®çº¢è‰²ã€è­¦ç¤ºç¯çš„é—ªçƒï¼‰ï¼Œé˜²æ­¢å°ç›®æ ‡çš„å¾®å¼±ä¿¡å·è¢«å¤æ‚èƒŒæ™¯â€œæ·¹æ²¡â€ã€‚</li>
<li>è‡ªé€‚åº”èåˆï¼šé€šè¿‡å¯å­¦ä¹ çš„æƒé‡å‚æ•°ï¼Œè®©æ¨¡å‹è‡ªå·±å†³å®šåœ¨ä¸åŒé˜¶æ®µã€å¯¹ä¸åŒç‰¹å¾ï¼Œè¿™ä¸‰ç§ä¿¡æ¯è¯¥å¦‚ä½•ç»„åˆï¼Œå½¢æˆæ›´å…·åˆ¤åˆ«åŠ›çš„ç‰¹å¾æè¿°ç¬¦ã€‚</li>
</ul>
<p>ç®€å•è¯´ï¼ŒMCEAè®©æ¨¡å‹å­¦ä¼šäº†åœ¨æµ“çƒŸä¸­â€œç«çœ¼é‡‘ç›â€ï¼Œæ—¢èƒ½çºµè§‚å…¨å±€ï¼Œåˆèƒ½æŠ“ä½æœ€åˆºçœ¼çš„å…³é”®ç»†èŠ‚ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be64987c7c52418693c3e1d176329386~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768185174&amp;x-signature=tHmoHloEOxR3P%2BHlDbIA3GqQAzM%3D" alt="å›¾ç‰‡5.png" loading="lazy"/></p>
<ul>
<li><strong>åˆ›æ–°äºŒï¼šåŠ¨æ€ä¸Šé‡‡æ ·å™¨</strong></li>
</ul>
<p>åœ¨ç‰¹å¾é‡‘å­—å¡”ä¸­ï¼Œä¸Šé‡‡æ ·è´Ÿè´£å°†ä½åˆ†è¾¨ç‡ç‰¹å¾å›¾æ”¾å¤§ï¼Œä»¥ä¾¿ä¸é«˜å±‚ç‰¹å¾èåˆã€‚ä¼ ç»Ÿçš„æ’å€¼æ–¹æ³•ï¼ˆå¦‚æœ€è¿‘é‚»ï¼‰æ˜¯â€œæ­»æ¿çš„â€ï¼Œå¯¹æ‰€æœ‰åŒºåŸŸä¸€è§†åŒä»ã€‚</p>
<p>ç ”ç©¶å¼•å…¥äº†Dysampleï¼Œä¸€ç§åŠ¨æ€ä¸Šé‡‡æ ·å™¨ï¼š</p>
<p>åŠ¨æ€é‡‡æ ·ç‚¹ï¼šå®ƒæ ¹æ®ç‰¹å¾å›¾å†…å®¹æœ¬èº«ï¼ŒåŠ¨æ€ç”Ÿæˆé‡‡æ ·ç‚¹çš„ä½ç½®åç§»ï¼Œè€Œä¸æ˜¯å›ºå®šæ¨¡å¼ã€‚</p>
<p>æ•ˆæœï¼šè¿™ä½¿å¾—ç‰¹å¾é‡å»ºè¿‡ç¨‹æ›´å…·å†…å®¹è‡ªé€‚åº”æ€§ï¼Œèƒ½æ›´å¥½åœ°æ¢å¤å°ç›®æ ‡çš„ç»†èŠ‚å’Œè½®å»“ï¼Œåœ¨å­˜åœ¨çƒŸé›¾æ¨¡ç³Šã€åƒç´ æŸå¤±çš„æƒ…å†µä¸‹ï¼Œæ˜¾è‘—æå‡å¯¹å°ç›®æ ‡å’Œæ¨¡ç³Šç›®æ ‡çš„å®šä½ç²¾åº¦ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e11268f59924afb8e6e1f0eae97690d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768185174&amp;x-signature=GqTIQ5HYakUb2HZdf5rK9x5Uw5o%3D" alt="å›¾ç‰‡6.png" loading="lazy"/></p>
<h2 data-id="heading-3"><strong>å®æˆ˜æ•ˆæœï¼šæ•°æ®è¯´è¯ï¼Œçœ¼è§ä¸ºå®</strong></h2>
<p>å®éªŒåœ¨FireRescueæ•°æ®é›†ä¸Šè¿›è¡Œï¼Œç»“æœä»¤äººå°è±¡æ·±åˆ»ï¼š</p>
<p>æ¶ˆèå®éªŒï¼šé€é¡¹æ·»åŠ MCEAå’ŒDysampleï¼Œå„é¡¹æŒ‡æ ‡ï¼ˆmAP50ï¼Œ å¬å›ç‡ï¼‰å‡ç¨³æ­¥æå‡ï¼ŒéªŒè¯äº†æ¯ä¸ªæ¨¡å—çš„æœ‰æ•ˆæ€§ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deccc8cf470b4a77b2110a84841622f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768185174&amp;x-signature=verwkp14wPnC5Xd%2B9nfxu%2B0m9Uo%3D" alt="å›¾ç‰‡7.png" loading="lazy"/></p>
<p>å¯¹æ¯”å®éªŒï¼šFRS-YOLOï¼ˆåŒ…æ‹¬nanoå’Œsmallç‰ˆæœ¬ï¼‰åœ¨å‚æ•°é‡å‡ ä¹ä¸å˜ç”šè‡³ç•¥æœ‰å‡å°‘çš„æƒ…å†µä¸‹ï¼Œå…¨é¢è¶…è¶Šäº†åŒè§„æ¨¡çš„YOLOv12ã€YOLOv10ã€YOLOv8ç­‰ä¸»æµæ¨¡å‹ï¼Œåœ¨mAP50å’Œå¬å›ç‡ä¸Šå–å¾—æ˜¾è‘—ä¼˜åŠ¿ã€‚è¿™è¯æ˜äº†æ€§èƒ½æå‡æºäºâ€œæ¶æ„åˆ›æ–°â€ï¼Œè€Œéç²—æš´çš„â€œå †å‚æ•°â€ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a3f44ddb98b468c819988479b2f199e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768185174&amp;x-signature=kjV7mc915WUM%2FWQxpdpjuslE1UA%3D" alt="å›¾ç‰‡8.png" loading="lazy"/></p>
<ul>
<li><strong>å¯è§†åŒ–å¯¹æ¯”ï¼š</strong></li>
</ul>
<p>å°ç›®æ ‡ä¸é®æŒ¡ï¼šåœ¨åŸºçº¿æ¨¡å‹æ¼æ£€ä¸¥é‡çš„æƒ…å†µä¸‹ï¼ŒFRS-YOLOèƒ½é€šè¿‡è½¦è‡‚ç­‰å±€éƒ¨ç‰¹å¾æˆåŠŸæ£€å‡ºè¢«é®æŒ¡çš„æ¶ˆé˜²è½¦ã€‚</p>
<p>æç«¯å¹²æ‰°ï¼šåœ¨æµ“çƒŸç«ç„°ä¸­ï¼ŒFRS-YOLOå¯¹å…³é”®æ•‘æ´è½¦è¾†ä¿æŒäº†æ›´é«˜çš„å¬å›ç‡ã€‚</p>
<p>ç›¸ä¼¼ç›®æ ‡è¾¨åˆ«ï¼šåœ¨è½¦è¾†å¯†é›†å¤„ï¼ŒFRS-YOLOæœ‰æ•ˆé™ä½äº†å°†æ™®é€šå¡è½¦è¯¯åˆ¤ä¸ºæ¶ˆé˜²è½¦çš„æ¦‚ç‡ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0195930be6924578a395448ff7f6b729~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768185174&amp;x-signature=d0b5LczuF7R9L2AihCkbHFTRRbY%3D" alt="å›¾ç‰‡9.png" loading="lazy"/></p>
<p>çƒ­åŠ›å›¾æ´å¯Ÿï¼šGrad-CAMçƒ­åŠ›å›¾æ˜¾ç¤ºï¼ŒåŸºçº¿æ¨¡å‹çš„æ³¨æ„åŠ›å¸¸åˆ†æ•£äºèƒŒæ™¯ï¼Œè€ŒFRS-YOLOçš„æ³¨æ„åŠ›åˆ™å¼ºæœ‰åŠ›åœ°èšç„¦åœ¨ç›®æ ‡æœ¬ä½“åŠå…³é”®éƒ¨ä»¶ä¸Šï¼Œå†³ç­–ä¾æ®æ›´æ¸…æ™°ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c293efc45874116a2861f2ff8d2da50~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768185174&amp;x-signature=FEYMCCRvR0hWx5U7BS%2BkYXHak2A%3D" alt="å›¾ç‰‡10.png" loading="lazy"/></p>
<h2 data-id="heading-4"><strong>ç»“è®º</strong></h2>
<p>æœ¬æ–‡é€šè¿‡å¼•å…¥åŸºäºYOLOv12æ„å»ºçš„å¢å¼ºæ¨¡å‹FRS-YOLOï¼Œåº”å¯¹äº†å¤æ‚æ¶ˆé˜²æ•‘æ´åœºæ™¯ä¸‹ç›®æ ‡æ£€æµ‹çš„æŒ‘æˆ˜ã€‚æœ¬å·¥ä½œçš„ä¸€ä¸ªå…³é”®è´¡çŒ®æ˜¯åˆ›å»ºäº†é¦–ä¸ªä¸“ä¸ºæ¶ˆé˜²æ•‘æ´åœºæ™¯è®¾è®¡çš„ç»¼åˆæ€§æ•°æ®é›†ï¼Œä¸ºè¯¥é¢†åŸŸæœªæ¥ç ”ç©¶æä¾›äº†å®è´µçš„åŸºå‡†ã€‚å…¶ä»–è´¡çŒ®åŒ…æ‹¬è®¾è®¡äº†ä¸€ä¸ªå¤šç»´ååŒå¢å¼ºæ³¨æ„åŠ›æ¨¡å—ï¼Œè¯¥æ¨¡å—æ•´åˆäº†å…¨å±€å¹³å‡æ± åŒ–ã€æ ‡å‡†å·®æ± åŒ–å’Œæœ€å¤§æ± åŒ–ä»¥ä¸°å¯Œç‰¹å¾è¡¨ç¤ºï¼ŒåŒæ—¶é‡æ„äº†ä¸»å¹²ç½‘ç»œä¸­çš„A2C2fæ¨¡å—ä»¥åŠ å¼ºå¯¹åˆ¤åˆ«æ€§åŒºåŸŸçš„å…³æ³¨ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªåŠ¨æ€é‡‡æ ·å™¨ï¼Œè‡ªé€‚åº”åœ°å¢å¼ºäº†æ¨¡å‹å¯¹å›°éš¾æ ·æœ¬çš„å…³æ³¨ï¼Œæ˜¾è‘—æé«˜äº†åœ¨æ¶ˆé˜²æ•‘æ´ç¯å¢ƒä¸­å°¤å…¶å…·æœ‰æŒ‘æˆ˜æ€§çš„å°è€Œæ¨¡ç³Šç›®æ ‡çš„æ£€æµ‹ç²¾åº¦ã€‚å®éªŒè¯„ä¼°è¡¨æ˜ï¼Œæ‰€ææ–¹æ³•åœ¨ç²¾åº¦ã€mAP50ã€mAP50-95å’Œå¬å›ç‡æ–¹é¢ç›¸æ¯”åŸºçº¿æ¨¡å‹å–å¾—äº†æ˜¾è‘—æå‡ï¼ŒåŒæ—¶ä¿æŒäº†ç†æƒ³çš„è½»é‡ç‰¹æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¯¹æ¯”åˆ†æcontainerd vs CRI-Oçš„æ€§èƒ½å·®å¼‚å’Œé€‚ç”¨åœºæ™¯]]></title>    <link>https://juejin.cn/post/7591348605866721315</link>    <guid>https://juejin.cn/post/7591348605866721315</guid>    <pubDate>2026-01-05T02:56:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591348605866721315" data-draft-id="7591382440582447144" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¯¹æ¯”åˆ†æcontainerd vs CRI-Oçš„æ€§èƒ½å·®å¼‚å’Œé€‚ç”¨åœºæ™¯"/> <meta itemprop="keywords" content="Kubernetes"/> <meta itemprop="datePublished" content="2026-01-05T02:56:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¯¹æ¯”åˆ†æcontainerd vs CRI-Oçš„æ€§èƒ½å·®å¼‚å’Œé€‚ç”¨åœºæ™¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T02:56:31.000Z" title="Mon Jan 05 2026 02:56:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨äº‘åŸç”Ÿç”Ÿæ€ä¸­ï¼Œ<strong>containerd</strong>ä¸<strong>cri-o</strong>æ˜¯Kubernetesé›†ç¾¤ä¸­æœ€å¸¸ç”¨çš„ä¸¤ç§å®¹å™¨è¿è¡Œæ—¶ï¼Œå‡ç¬¦åˆOCIï¼ˆOpen Container Initiativeï¼‰æ ‡å‡†ï¼Œä½†ç›´æ¥æœåŠ¡äºä¸åŒçš„åœºæ™¯éœ€æ±‚ã€‚æœ¬æ–‡å°†ä»<strong>æ€§èƒ½å·®å¼‚</strong>ã€<strong>é€‚ç”¨åœºæ™¯</strong>ã€<strong>æ¶æ„è®¾è®¡</strong>ã€<strong>å®‰å…¨ç‰¹æ€§</strong>ç­‰å¤šç»´åº¦å±•å¼€å¯¹æ¯”ï¼Œå¸®åŠ©è¯»è€…ç†è§£ä¸¤è€…çš„æ ¸å¿ƒåŒºåˆ«ä¸é€‰æ‹©é€»è¾‘ã€‚</p>
<h2 data-id="heading-0"><strong>ä¸€ã€æ ¸å¿ƒç»“è®º</strong></h2>
<ul>
<li><strong>containerd</strong>ï¼šç»¼åˆæ€§èƒ½æ›´ä¼˜ï¼ˆå¯åŠ¨é€Ÿåº¦ã€èµ„æºåˆ©ç”¨ç‡ã€ååé‡ï¼‰ï¼Œé€‚åˆ<strong>å¤§è§„æ¨¡ç”Ÿäº§é›†ç¾¤</strong>ã€<strong>é«˜æ€§èƒ½è®¡ç®—åœºæ™¯</strong>ï¼ˆå¦‚llama-stackæ¨ç†æœåŠ¡ï¼‰ï¼Œæ˜¯Kubernetesçš„â€œé»˜è®¤æ¨èâ€è¿è¡Œæ—¶ã€‚</li>
<li><strong>cri-o</strong>ï¼šè½»é‡çº§è®¾è®¡æ›´çªå‡ºï¼Œé€‚åˆ<strong>èµ„æºå—é™çš„è¾¹ç¼˜ç¯å¢ƒ</strong>ã€<strong>å®‰å…¨æ•æ„Ÿåœºæ™¯</strong>ï¼ˆå¦‚é‡‘èæ”¯ä»˜ç³»ç»Ÿï¼‰ï¼Œæ˜¯Kubernetesâ€œåŸç”Ÿé›†æˆâ€çš„è½»é‡çº§é€‰æ‹©ã€‚</li>
</ul>
<h2 data-id="heading-1"><strong>äºŒã€æ€§èƒ½å·®å¼‚å¯¹æ¯”</strong></h2>
<p>æ€§èƒ½æ˜¯å®¹å™¨è¿è¡Œæ—¶æœ€æ ¸å¿ƒçš„ç«äº‰åŠ›ï¼Œä»¥ä¸‹ä»<strong>å¯åŠ¨é€Ÿåº¦</strong>ã€<strong>èµ„æºå ç”¨</strong>ã€<strong>ååé‡</strong>ä¸‰ä¸ªå…³é”®æŒ‡æ ‡å±•å¼€åˆ†æï¼š</p>
<h3 data-id="heading-2"><strong>1. å¯åŠ¨é€Ÿåº¦ï¼šcontainerdæ›´ä¼˜</strong></h3>
<p>å¯åŠ¨é€Ÿåº¦æ˜¯å®¹å™¨è¿è¡Œæ—¶çš„é‡è¦æŒ‡æ ‡ï¼Œç›´æ¥å½±å“æœåŠ¡çš„<strong>å¼¹æ€§ä¼¸ç¼©èƒ½åŠ›</strong>ï¼ˆå¦‚Kubernetesçš„Podæ‰©ç¼©å®¹ï¼‰ã€‚</p>
<ul>
<li><strong>å†·å¯åŠ¨æ—¶é—´</strong>ï¼šcontainerdçš„å†·å¯åŠ¨æ—¶é—´ï¼ˆçº¦160msï¼‰æ˜¾è‘—ä½äºcri-oï¼ˆçº¦190msï¼‰ã€‚è¿™æ˜¯å› ä¸ºcontainerdçš„<strong>åˆ†å±‚æ¶æ„</strong>ï¼ˆcontainerdæ ¸å¿ƒâ†’CRIæ’ä»¶â†’OCIè¿è¡Œæ—¶ï¼‰å‡å°‘äº†ä¸­é—´å±‚å¼€é”€ï¼Œè€Œcri-oçš„â€œç›´æ¥CRIå®ç°â€è™½ç®€åŒ–äº†æµç¨‹ï¼Œä½†åœ¨é•œåƒæ‹‰å–ä¸è§£å‹ç¯èŠ‚ç•¥é€Šã€‚</li>
<li><strong>çƒ­å¯åŠ¨æ—¶é—´</strong>ï¼šcontainerdçš„çƒ­å¯åŠ¨æ—¶é—´ï¼ˆçº¦32msï¼‰åŒæ ·ä¼˜äºcri-oï¼ˆçº¦38msï¼‰ã€‚çƒ­å¯åŠ¨ä¾èµ–äºè¿è¡Œæ—¶çš„<strong>ç¼“å­˜æœºåˆ¶</strong>ï¼Œcontainerdçš„â€œé•œåƒåˆ†å±‚ç¼“å­˜â€ï¼ˆå¦‚overlayfsï¼‰æ›´é«˜æ•ˆï¼Œå‡å°‘äº†é‡å¤è§£å‹çš„å¼€é”€ã€‚</li>
</ul>
<h3 data-id="heading-3"><strong>2. èµ„æºå ç”¨ï¼šcontainerdæ›´é«˜æ•ˆ</strong></h3>
<p>èµ„æºå ç”¨ï¼ˆCPUã€å†…å­˜ï¼‰æ˜¯å¤§è§„æ¨¡é›†ç¾¤çš„å…³é”®æˆæœ¬å› ç´ ï¼Œcontainerdçš„è®¾è®¡æ›´æ³¨é‡<strong>èµ„æºä¼˜åŒ–</strong>ã€‚</p>
<ul>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šcontainerdçš„å†…å­˜å ç”¨ï¼ˆçº¦30-50MBï¼‰ä½äºcri-oï¼ˆçº¦40-60MBï¼‰ã€‚è¿™æ˜¯å› ä¸ºcontainerdçš„<strong>å®ˆæŠ¤è¿›ç¨‹æ•°é‡æ›´å°‘</strong>ï¼ˆä»…1ä¸ªcontainerdè¿›ç¨‹ï¼‰ï¼Œè€Œcri-oéœ€è¦ç»´æŠ¤é¢å¤–çš„â€œCRI-Oå®ˆæŠ¤è¿›ç¨‹â€ä¸â€œOCIè¿è¡Œæ—¶â€ï¼ˆå¦‚runcï¼‰ï¼Œå¯¼è‡´å†…å­˜å¼€é”€ç•¥é«˜ã€‚</li>
<li><strong>CPUå¼€é”€</strong>ï¼šcontainerdçš„CPUå¼€é”€ï¼ˆçº¦ä½5-10%ï¼‰ä½äºcri-oã€‚è¿™å¾—ç›Šäºcontainerdçš„<strong>åŸç”ŸCRIé›†æˆ</strong>ï¼ˆæ¶ˆé™¤äº†Docker-shimçš„è½¬æ¢å¼€é”€ï¼‰ï¼Œè€Œcri-oçš„â€œCRIè¯·æ±‚å¤„ç†â€éœ€é¢å¤–çš„åè®®è½¬æ¢ï¼Œå¯¼è‡´CPUå ç”¨ç•¥é«˜ã€‚</li>
</ul>
<h3 data-id="heading-4"><strong>3. ååé‡ï¼šcontainerdåœ¨é«˜å¹¶å‘ä¸‹æ›´ç¨³</strong></h3>
<p>ååé‡æ˜¯è¡¡é‡å®¹å™¨è¿è¡Œæ—¶<strong>å¤„ç†èƒ½åŠ›</strong>çš„æ ¸å¿ƒæŒ‡æ ‡ï¼Œå°¤å…¶é€‚åˆ<strong>é«˜å¹¶å‘åœºæ™¯</strong>ï¼ˆå¦‚ç”µå•†å¤§ä¿ƒã€AIæ¨ç†æœåŠ¡ï¼‰ã€‚</p>
<ul>
<li><strong>é«˜å¹¶å‘åœºæ™¯</strong>ï¼šåœ¨100ä¸ªå®¹å™¨å¹¶å‘è°ƒåº¦çš„æµ‹è¯•ä¸­ï¼Œcontainerdçš„<strong>90%å®Œæˆæ—¶é—´</strong>ï¼ˆçº¦29sï¼‰ä¸<strong>100%å®Œæˆæ—¶é—´</strong>ï¼ˆçº¦36sï¼‰å‡ä¼˜äºcri-oï¼ˆ35sã€41sï¼‰ã€‚è¿™è¯´æ˜containerdçš„<strong>ä»»åŠ¡è°ƒåº¦ç®—æ³•</strong>ï¼ˆå¦‚â€œå…ˆæ¥å…ˆæœåŠ¡+ä¼˜å…ˆçº§è°ƒæ•´â€ï¼‰æ›´é«˜æ•ˆï¼Œèƒ½æ›´å¥½åœ°åº”å¯¹çªå‘æµé‡ã€‚</li>
<li><strong>GPUåŠ é€Ÿåœºæ™¯</strong>ï¼šå¯¹äºllama-stackç­‰GPUå¯†é›†å‹æ¨ç†æœåŠ¡ï¼Œcontainerdçš„<strong>GPUå…±äº«æ•ˆç‡</strong>ï¼ˆçº¦é«˜15%ï¼‰ä¼˜äºcri-oã€‚è¿™æ˜¯å› ä¸ºcontainerdçš„<strong>CUDAé©±åŠ¨é›†æˆ</strong>æ›´å®Œå–„ï¼Œèƒ½æ›´å¥½åœ°ç®¡ç†GPUèµ„æºçš„åˆ†é…ä¸é‡Šæ”¾ã€‚</li>
</ul>
<h2 data-id="heading-5"><strong>ä¸‰ã€é€‚ç”¨åœºæ™¯å¯¹æ¯”</strong></h2>
<p>æ€§èƒ½å·®å¼‚å†³å®šäº†ä¸¤è€…çš„é€‚ç”¨åœºæ™¯ï¼Œä»¥ä¸‹ç»“åˆ<strong>ä¸šåŠ¡éœ€æ±‚</strong>ä¸<strong>ç¯å¢ƒçº¦æŸ</strong>å±•å¼€åˆ†æï¼š</p>
<h3 data-id="heading-6"><strong>1. containerdï¼šé€‚åˆå¤§è§„æ¨¡ç”Ÿäº§é›†ç¾¤ä¸é«˜æ€§èƒ½åœºæ™¯</strong></h3>
<p>containerdçš„<strong>ç»¼åˆæ€§èƒ½ä¼˜åŠ¿</strong>ä½¿å…¶æˆä¸º<strong>å¤§è§„æ¨¡Kubernetesé›†ç¾¤</strong>çš„é¦–é€‰ï¼Œå°¤å…¶é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li><strong>å¤§è§„æ¨¡å¾®æœåŠ¡é›†ç¾¤</strong>ï¼šå¦‚ç”µå•†å¹³å°çš„â€œè®¢å•æœåŠ¡â€â€œæ”¯ä»˜æœåŠ¡â€ç­‰ï¼Œéœ€è¦é«˜ååé‡ã€ä½å»¶è¿Ÿçš„å®¹å™¨è¿è¡Œæ—¶ï¼Œcontainerdèƒ½æ»¡è¶³è¿™äº›éœ€æ±‚ã€‚</li>
<li><strong>é«˜æ€§èƒ½è®¡ç®—ï¼ˆHPCï¼‰</strong> ï¼šå¦‚llama-stackæ¨ç†æœåŠ¡ã€æ·±åº¦å­¦ä¹ è®­ç»ƒç­‰ï¼Œéœ€è¦é«˜æ•ˆçš„GPUèµ„æºå…±äº«ä¸ä½å»¶è¿Ÿçš„å®¹å™¨å¯åŠ¨ï¼Œcontainerdçš„è¡¨ç°æ›´ä¼˜ã€‚</li>
<li><strong>äº‘åŸç”Ÿç”Ÿæ€é›†æˆ</strong>ï¼šcontainerdä¸Dockerç”Ÿæ€ï¼ˆå¦‚Dockeré•œåƒã€Docker Composeï¼‰å…¼å®¹ï¼Œé€‚åˆéœ€è¦â€œDockerå·¥å…·é“¾â€çš„åœºæ™¯ï¼ˆå¦‚CI/CDæµæ°´çº¿ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-7"><strong>2. cri-oï¼šé€‚åˆèµ„æºå—é™çš„è¾¹ç¼˜ç¯å¢ƒä¸å®‰å…¨æ•æ„Ÿåœºæ™¯</strong></h3>
<p>cri-oçš„<strong>è½»é‡çº§è®¾è®¡</strong>ä¸<strong>å®‰å…¨ç‰¹æ€§</strong>ä½¿å…¶æ›´é€‚åˆ<strong>èµ„æºå—é™çš„è¾¹ç¼˜ç¯å¢ƒ</strong>ä¸<strong>å®‰å…¨æ•æ„Ÿåœºæ™¯</strong>ï¼š</p>
<ul>
<li><strong>è¾¹ç¼˜è®¡ç®—</strong>ï¼šå¦‚æ™ºèƒ½ç»ˆç«¯ã€å·¥ä¸šç½‘å…³ç­‰ï¼Œèµ„æºï¼ˆCPUã€å†…å­˜ï¼‰æœ‰é™ï¼Œcri-oçš„<strong>ä½å†…å­˜å ç”¨</strong>ï¼ˆçº¦40-60MBï¼‰ä¸<strong>å°äºŒè¿›åˆ¶ä½“ç§¯</strong>ï¼ˆçº¦10MBï¼‰æ›´é€‚åˆã€‚</li>
<li><strong>å®‰å…¨æ•æ„Ÿåœºæ™¯</strong>ï¼šå¦‚é‡‘èæ”¯ä»˜ç³»ç»Ÿã€æ”¿åºœæ”¿åŠ¡ç³»ç»Ÿç­‰ï¼Œéœ€è¦<strong>æœ€å°åŒ–æ”»å‡»é¢</strong>ï¼Œcri-oçš„â€œç²¾ç®€æ¶æ„â€ï¼ˆç§»é™¤äº†Dockerçš„å¤šä½™ç»„ä»¶ï¼‰ä¸<strong>é»˜è®¤å®‰å…¨é…ç½®</strong>ï¼ˆå¦‚Seccompã€SELinuxï¼‰æ›´ç¬¦åˆè¦æ±‚ã€‚</li>
<li><strong>KubernetesåŸç”Ÿé›†æˆ</strong>ï¼šcri-oæ˜¯Kubernetesâ€œåŸç”Ÿæ”¯æŒâ€çš„è¿è¡Œæ—¶ï¼Œä¸Kubernetesç‰ˆæœ¬åŒæ­¥ï¼ˆå¦‚Kubernetes 1.28+æ”¯æŒcri-o 1.26+ï¼‰ï¼Œé€‚åˆâ€œçº¯Kubernetesç¯å¢ƒâ€ï¼ˆå¦‚OpenShifté›†ç¾¤ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-8"><strong>å››ã€æ¶æ„ä¸å®‰å…¨ç‰¹æ€§å¯¹æ¯”</strong></h2>
<p>æ¶æ„è®¾è®¡å†³å®šäº†è¿è¡Œæ—¶çš„<strong>æ‰©å±•æ€§</strong>ä¸<strong>å®‰å…¨æ€§</strong>ï¼Œä»¥ä¸‹ä»<strong>æ¶æ„å¤æ‚åº¦</strong>ä¸<strong>å®‰å…¨ç‰¹æ€§</strong>å±•å¼€åˆ†æï¼š</p>
<h3 data-id="heading-9"><strong>1. æ¶æ„è®¾è®¡ï¼šcontainerdæ›´å¤æ‚ï¼Œcri-oæ›´ç²¾ç®€</strong></h3>
<ul>
<li><strong>containerdæ¶æ„</strong>ï¼šé‡‡ç”¨<strong>åˆ†å±‚æ¶æ„</strong>ï¼ˆcontainerdæ ¸å¿ƒâ†’CRIæ’ä»¶â†’OCIè¿è¡Œæ—¶â†’å®¹å™¨ï¼‰ï¼Œæ”¯æŒâ€œæ’ä»¶åŒ–æ‰©å±•â€ï¼ˆå¦‚é•œåƒç®¡ç†ã€ç½‘ç»œç®¡ç†ï¼‰ï¼Œé€‚åˆ<strong>å¤æ‚åœºæ™¯</strong>ï¼ˆå¦‚å¤šäº‘ç¯å¢ƒï¼‰ã€‚</li>
<li><strong>cri-oæ¶æ„</strong>ï¼šé‡‡ç”¨<strong>æ‰å¹³æ¶æ„</strong>ï¼ˆCRI-Oå®ˆæŠ¤è¿›ç¨‹â†’OCIè¿è¡Œæ—¶â†’å®¹å™¨ï¼‰ï¼Œç§»é™¤äº†å¤šä½™ç»„ä»¶ï¼ˆå¦‚Docker Daemonï¼‰ï¼Œé€‚åˆ<strong>ç®€å•åœºæ™¯</strong>ï¼ˆå¦‚è¾¹ç¼˜èŠ‚ç‚¹ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-10"><strong>2. å®‰å…¨ç‰¹æ€§ï¼šä¸¤è€…å‡ç¬¦åˆæ ‡å‡†ï¼Œä½†cri-oæ›´ä¸¥æ ¼</strong></h3>
<ul>
<li><strong>éš”ç¦»æ€§</strong>ï¼šä¸¤è€…å‡æ”¯æŒ<strong>ç”¨æˆ·å‘½åç©ºé—´</strong>ã€<strong>SELinux/AppArmor</strong>ã€<strong>åªè¯»æ ¹æ–‡ä»¶ç³»ç»Ÿ</strong>ç­‰å®‰å…¨ç‰¹æ€§ï¼Œä½†cri-oçš„<strong>é»˜è®¤é…ç½®æ›´ä¸¥æ ¼</strong>ï¼ˆå¦‚â€œç¦æ­¢ç‰¹æƒå®¹å™¨â€é»˜è®¤å¼€å¯ï¼‰ã€‚</li>
<li><strong>æ¼æ´å“åº”</strong>ï¼šcri-oçš„<strong>ä»£ç åº“æ›´å°</strong>ï¼ˆçº¦10ä¸‡è¡Œä»£ç ï¼‰ï¼Œæ¼æ´å“åº”é€Ÿåº¦ï¼ˆçº¦å¿«20%ï¼‰ä¼˜äºcontainerdï¼ˆçº¦20ä¸‡è¡Œä»£ç ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-11"><strong>äº”ã€æ€»ç»“ï¼šå¦‚ä½•é€‰æ‹©ï¼Ÿ</strong></h2>
<p>é€‰æ‹©containerdè¿˜æ˜¯cri-oï¼Œéœ€ç»“åˆ<strong>ä¸šåŠ¡éœ€æ±‚</strong>ä¸<strong>ç¯å¢ƒçº¦æŸ</strong>ï¼š</p>
<ul>
<li><strong>é€‰containerd</strong>ï¼šå¦‚æœéœ€è¦<strong>é«˜ååé‡</strong>ã€<strong>ä½å»¶è¿Ÿ</strong>ã€<strong>å¤§è§„æ¨¡é›†ç¾¤</strong>ï¼Œæˆ–æœ‰<strong>Dockerç”Ÿæ€ä¾èµ–</strong>ï¼ˆå¦‚CI/CDæµæ°´çº¿ï¼‰ï¼Œcontainerdæ˜¯æœ€ä½³é€‰æ‹©ã€‚</li>
<li><strong>é€‰cri-o</strong>ï¼šå¦‚æœç¯å¢ƒ<strong>èµ„æºå—é™</strong>ï¼ˆå¦‚è¾¹ç¼˜èŠ‚ç‚¹ï¼‰ã€<strong>å®‰å…¨æ•æ„Ÿ</strong>ï¼ˆå¦‚é‡‘èç³»ç»Ÿï¼‰ï¼Œæˆ–éœ€è¦<strong>KubernetesåŸç”Ÿé›†æˆ</strong>ï¼ˆå¦‚OpenShifté›†ç¾¤ï¼‰ï¼Œcri-oæ›´é€‚åˆã€‚</li>
</ul>
<h2 data-id="heading-12"><strong>å…­ã€æœªæ¥è¶‹åŠ¿</strong></h2>
<p>éšç€äº‘åŸç”ŸæŠ€æœ¯çš„å‘å±•ï¼Œä¸¤è€…çš„<strong>æ€§èƒ½å·®è·ä¼šé€æ¸ç¼©å°</strong>ï¼ˆå¦‚cri-oçš„â€œGPUåŠ é€Ÿâ€ä¼˜åŒ–ï¼‰ï¼Œä½†<strong>æ ¸å¿ƒå®šä½</strong>ä»ä¼šä¿æŒï¼š</p>
<ul>
<li>containerdï¼šç»§ç»­ä½œä¸º<strong>å¤§è§„æ¨¡ç”Ÿäº§é›†ç¾¤</strong>çš„é¦–é€‰ï¼Œæ³¨é‡<strong>æ€§èƒ½ä¸æ‰©å±•æ€§</strong>ã€‚</li>
<li>cri-oï¼šç»§ç»­ä½œä¸º<strong>è¾¹ç¼˜ç¯å¢ƒä¸å®‰å…¨åœºæ™¯</strong>çš„é¦–é€‰ï¼Œæ³¨é‡<strong>è½»é‡ä¸å®‰å…¨</strong>ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¾¹ç¼˜è®¡ç®—åœºæ™¯ä¸‹ï¼ŒCRI-Oç›¸æ¯”containerdåœ¨èµ„æºèŠ‚çœæ–¹é¢æœ‰å“ªäº›å…·ä½“çš„æŠ€æœ¯å®ç°]]></title>    <link>https://juejin.cn/post/7591348605866737699</link>    <guid>https://juejin.cn/post/7591348605866737699</guid>    <pubDate>2026-01-05T02:58:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591348605866737699" data-draft-id="7591375103520751656" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¾¹ç¼˜è®¡ç®—åœºæ™¯ä¸‹ï¼ŒCRI-Oç›¸æ¯”containerdåœ¨èµ„æºèŠ‚çœæ–¹é¢æœ‰å“ªäº›å…·ä½“çš„æŠ€æœ¯å®ç°"/> <meta itemprop="keywords" content="Kubernetes"/> <meta itemprop="datePublished" content="2026-01-05T02:58:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ITæ©˜å­çš®"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¾¹ç¼˜è®¡ç®—åœºæ™¯ä¸‹ï¼ŒCRI-Oç›¸æ¯”containerdåœ¨èµ„æºèŠ‚çœæ–¹é¢æœ‰å“ªäº›å…·ä½“çš„æŠ€æœ¯å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ITæ©˜å­çš®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T02:58:57.000Z" title="Mon Jan 05 2026 02:58:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨è¾¹ç¼˜è®¡ç®—åœºæ™¯ä¸‹ï¼Œ<strong>CRI-O</strong>é€šè¿‡<strong>ç²¾ç®€æ¶æ„è®¾è®¡</strong>ã€<strong>é«˜æ•ˆOCIè¿è¡Œæ—¶</strong>ã€<strong>å®‰å…¨ç­–ç•¥ä¼˜åŒ–</strong>åŠ<strong>èµ„æºåŠ¨æ€è°ƒæ•´</strong>ç­‰æŠ€æœ¯ï¼Œå®ç°äº†æ¯”containerdæ›´ä¼˜çš„èµ„æºèŠ‚çœæ•ˆæœã€‚ä»¥ä¸‹æ˜¯å…·ä½“çš„æŠ€æœ¯å®ç°ç»†èŠ‚ï¼Œç»“åˆè¾¹ç¼˜åœºæ™¯çš„éœ€æ±‚ï¼ˆèµ„æºå—é™ã€ä½å»¶è¿Ÿã€é«˜å®‰å…¨ï¼‰å±•å¼€è¯´æ˜ï¼š</p>
<h3 data-id="heading-0"><strong>ä¸€ã€ç²¾ç®€æ¶æ„è®¾è®¡ï¼šå‡å°‘ä¸å¿…è¦çš„ç»„ä»¶ä¸ä¾èµ–</strong></h3>
<p>CRI-Oçš„æ ¸å¿ƒè®¾è®¡ç›®æ ‡æ˜¯<strong>ä¸“ä¸ºKubernetesä¼˜åŒ–</strong>ï¼Œå› æ­¤ç§»é™¤äº†ä¼ ç»Ÿå®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚Dockerï¼‰çš„å¤šä½™ç»„ä»¶ï¼ˆå¦‚Docker Daemonã€CLIå·¥å…·é“¾ï¼‰ï¼Œä»…ä¿ç•™<strong>CRIæ¥å£å®ç°</strong>ã€<strong>é•œåƒç®¡ç†</strong>ã€<strong>å®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚è¿™ç§â€œè½»é‡çº§â€æ¶æ„ç›´æ¥é™ä½äº†èµ„æºå ç”¨ï¼š</p>
<ul>
<li><strong>äºŒè¿›åˆ¶ä½“ç§¯</strong>ï¼šCRI-Oçš„äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°çº¦ä¸º<strong>10MB</strong>ï¼ˆcontainerdçº¦ä¸º20MBï¼‰ï¼Œå‡å°‘äº†è¾¹ç¼˜èŠ‚ç‚¹çš„å­˜å‚¨å ç”¨ã€‚</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šCRI-Oçš„å®ˆæŠ¤è¿›ç¨‹å†…å­˜å ç”¨çº¦ä¸º<strong>30-50MB</strong>ï¼ˆcontainerdçº¦ä¸º50-70MBï¼‰ï¼Œæ›´é€‚åˆèµ„æºå—é™çš„è¾¹ç¼˜è®¾å¤‡ï¼ˆå¦‚ARMç›’å­ã€å·¥ä¸šç½‘å…³ï¼‰ã€‚</li>
<li><strong>ä¾èµ–ç®€åŒ–</strong>ï¼šCRI-Oç›´æ¥è°ƒç”¨OCIè¿è¡Œæ—¶ï¼ˆå¦‚crunï¼‰ï¼Œæ— éœ€ä¸­é—´å±‚ï¼ˆå¦‚Dockerçš„<code>dockerd</code>ï¼‰ï¼Œå‡å°‘äº†ç³»ç»Ÿè°ƒç”¨çš„å¼€é”€ã€‚</li>
</ul>
<h3 data-id="heading-1"><strong>äºŒã€é«˜æ•ˆOCIè¿è¡Œæ—¶ï¼šcrunçš„ä¼˜åŒ–ä¸é»˜è®¤æ”¯æŒ</strong></h3>
<p>CRI-O 1.31åŠä»¥ä¸Šç‰ˆæœ¬<strong>é»˜è®¤ä½¿ç”¨crunä½œä¸ºOCIè¿è¡Œæ—¶</strong>ï¼ˆæ›¿ä»£ä¼ ç»Ÿçš„runcï¼‰ï¼Œcrunæ˜¯åŸºäºCè¯­è¨€ç¼–å†™çš„è½»é‡çº§OCIè¿è¡Œæ—¶ï¼Œå…·æœ‰ä»¥ä¸‹èµ„æºèŠ‚çœä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>æ›´å¿«çš„å¯åŠ¨é€Ÿåº¦</strong>ï¼šcrunçš„å†·å¯åŠ¨æ—¶é—´çº¦ä¸º<strong>150ms</strong>ï¼ˆruncçº¦ä¸º200msï¼‰ï¼Œçƒ­å¯åŠ¨æ—¶é—´çº¦ä¸º<strong>30ms</strong>ï¼ˆruncçº¦ä¸º40msï¼‰ï¼Œå‡å°‘äº†è¾¹ç¼˜èŠ‚ç‚¹çš„å®¹å™¨å¯åŠ¨å»¶è¿Ÿã€‚</li>
<li><strong>æ›´ä½çš„å†…å­˜å ç”¨</strong>ï¼šcrunçš„å†…å­˜å¼€é”€æ¯”runcä½<strong>15%</strong> ï¼ˆçº¦ä¸º25MB/å®¹å™¨ï¼‰ï¼Œå› ä¸ºå®ƒç›´æ¥æ“ä½œLinuxå†…æ ¸çš„Namespaceå’ŒCgroupsï¼Œæ— éœ€é¢å¤–çš„æŠ½è±¡å±‚ã€‚</li>
<li><strong>æ›´å¥½çš„å…¼å®¹æ€§</strong>ï¼šcrunæ”¯æŒ<strong>WebAssemblyï¼ˆWasmï¼‰</strong> å’Œ<strong>è¾¹ç¼˜è®¾å¤‡</strong>ï¼ˆå¦‚ARM64ï¼‰ï¼Œé€‚åˆè¾¹ç¼˜åœºæ™¯çš„å¼‚æ„ç¡¬ä»¶ç¯å¢ƒã€‚</li>
</ul>
<h3 data-id="heading-2"><strong>ä¸‰ã€å®‰å…¨ç­–ç•¥ä¼˜åŒ–ï¼šå‡å°‘æ”»å‡»é¢ä¸èµ„æºæ³„æ¼</strong></h3>
<p>è¾¹ç¼˜èŠ‚ç‚¹çš„å®‰å…¨éœ€æ±‚æ›´é«˜ï¼ˆå¦‚é˜²æ­¢å®¹å™¨é€ƒé€¸ã€æ•°æ®æ³„éœ²ï¼‰ï¼ŒCRI-Oé€šè¿‡<strong>é»˜è®¤å®‰å…¨é…ç½®</strong>å’Œ<strong>ç»†ç²’åº¦æƒé™æ§åˆ¶</strong>ï¼Œåœ¨å®ç°å®‰å…¨çš„åŒæ—¶å‡å°‘äº†èµ„æºå ç”¨ï¼š</p>
<ul>
<li><strong>é»˜è®¤å¯ç”¨Seccompä¸SELinux</strong>ï¼šCRI-Oé»˜è®¤åŠ è½½ä¸¥æ ¼çš„Seccompé…ç½®æ–‡ä»¶ï¼ˆé™åˆ¶ä¸å¿…è¦çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå¦‚<code>fork()</code>ã€<code>exec()</code>ï¼‰ï¼Œå¹¶æ”¯æŒSELinuxçš„å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMACï¼‰ï¼Œå‡å°‘äº†æ”»å‡»é¢ã€‚è¿™äº›å®‰å…¨ç­–ç•¥çš„å†…å­˜å¼€é”€çº¦ä¸º<strong>5-10MB</strong>ï¼ˆcontainerdéœ€é¢å¤–é…ç½®ï¼‰ï¼Œä½†æå‡äº†è¾¹ç¼˜èŠ‚ç‚¹çš„å®‰å…¨æ€§ã€‚</li>
<li><strong>Rootlessæ¨¡å¼æ”¯æŒ</strong>ï¼šCRI-Oæ”¯æŒæ— ç‰¹æƒå®¹å™¨ï¼ˆRootlessï¼‰ï¼Œå®¹å™¨è¿›ç¨‹ä»¥æ™®é€šç”¨æˆ·èº«ä»½è¿è¡Œï¼Œé¿å…äº†rootæƒé™çš„èµ„æºæ»¥ç”¨ï¼ˆå¦‚ä¿®æ”¹ç³»ç»Ÿæ–‡ä»¶ï¼‰ã€‚è¿™ç§æ¨¡å¼çš„å†…å­˜å¼€é”€ä¸ç‰¹æƒæ¨¡å¼ç›¸è¿‘ï¼Œä½†å®‰å…¨æ€§æ›´é«˜ã€‚</li>
<li><strong>é•œåƒç­¾åéªŒè¯</strong>ï¼šCRI-Oæ”¯æŒ<strong>sigstoreï¼ˆcosignï¼‰</strong> é•œåƒç­¾åéªŒè¯ï¼Œç¡®ä¿è¾¹ç¼˜èŠ‚ç‚¹æ‹‰å–çš„é•œåƒæœªè¢«ç¯¡æ”¹ã€‚è¿™ç§éªŒè¯çš„å†…å­˜å¼€é”€çº¦ä¸º<strong>2-5MB</strong>ï¼Œä½†é˜²æ­¢äº†æ¶æ„é•œåƒçš„èµ„æºæ¶ˆè€—ï¼ˆå¦‚æŒ–çŸ¿ç¨‹åºï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-3"><strong>å››ã€èµ„æºåŠ¨æ€è°ƒæ•´ï¼šæ ¹æ®è´Ÿè½½ä¼˜åŒ–èµ„æºåˆ†é…</strong></h3>
<p>è¾¹ç¼˜èŠ‚ç‚¹çš„èµ„æºè´Ÿè½½æ³¢åŠ¨å¤§ï¼ˆå¦‚å·¥ä¸šåœºæ™¯çš„é«˜å³°æ—¶æ®µï¼‰ï¼ŒCRI-Oé€šè¿‡<strong>åŠ¨æ€èµ„æºè°ƒæ•´</strong>æœºåˆ¶ï¼Œå®ç°äº†èµ„æºçš„é«˜æ•ˆåˆ©ç”¨ï¼š</p>
<ul>
<li><strong>CPUä¸å†…å­˜é™åˆ¶</strong>ï¼šCRI-Oæ”¯æŒ<strong>CPUä»½é¢ï¼ˆCpuSharesï¼‰</strong> ã€<strong>å†…å­˜é™åˆ¶ï¼ˆMemoryLimitInBytesï¼‰</strong> ç­‰åŠ¨æ€è°ƒæ•´ï¼Œå½“å®¹å™¨è´Ÿè½½é™ä½æ—¶ï¼Œè‡ªåŠ¨å‡å°‘èµ„æºåˆ†é…ï¼ˆå¦‚å°†CPUä»½é¢ä»1024è°ƒæ•´ä¸º512ï¼‰ï¼Œé¿å…èµ„æºæµªè´¹ã€‚</li>
<li><strong>å®¹å™¨ç”Ÿå‘½å‘¨æœŸä¼˜åŒ–</strong>ï¼šCRI-Oä¼˜åŒ–äº†å®¹å™¨çš„åˆ›å»ºä¸åœæ­¢æµç¨‹ï¼Œå‡å°‘äº†å®¹å™¨çŠ¶æ€è½¬æ¢çš„èµ„æºå¼€é”€ï¼ˆå¦‚å®¹å™¨åœæ­¢æ—¶çš„èµ„æºå›æ”¶æ—¶é—´ä»<strong>600ms</strong>ç¼©çŸ­è‡³<strong>400ms</strong>ï¼‰ï¼Œæå‡äº†è¾¹ç¼˜èŠ‚ç‚¹çš„èµ„æºå‘¨è½¬ç‡ã€‚</li>
</ul>
<h3 data-id="heading-4"><strong>äº”ã€é•œåƒç®¡ç†ä¼˜åŒ–ï¼šå‡å°‘é•œåƒæ‹‰å–ä¸å­˜å‚¨å¼€é”€</strong></h3>
<p>è¾¹ç¼˜èŠ‚ç‚¹çš„ç½‘ç»œå¸¦å®½æœ‰é™ï¼ˆå¦‚5Gåˆ‡ç‰‡ç½‘ç»œçš„æ³¢åŠ¨ï¼‰ï¼ŒCRI-Oé€šè¿‡<strong>é•œåƒåˆ†å±‚ç¼“å­˜</strong>å’Œ<strong>ç²¾ç®€é•œåƒæ„å»º</strong>ï¼Œå‡å°‘äº†é•œåƒæ‹‰å–çš„æ—¶é—´ä¸å­˜å‚¨å ç”¨ï¼š</p>
<ul>
<li><strong>é•œåƒåˆ†å±‚ç¼“å­˜</strong>ï¼šCRI-Oæ”¯æŒ<strong>é•œåƒå±‚ç¼“å­˜</strong>ï¼ˆå¦‚OverlayFSï¼‰ï¼Œå½“æ‹‰å–ç›¸åŒåŸºç¡€é•œåƒçš„å®¹å™¨æ—¶ï¼Œå¤ç”¨å·²æœ‰çš„é•œåƒå±‚ï¼Œå‡å°‘äº†ç½‘ç»œä¼ è¾“çš„æ•°æ®é‡ï¼ˆå¦‚æ‹‰å–<code>nginx:alpine</code>çš„æ—¶é—´ä»<strong>30s</strong>ç¼©çŸ­è‡³<strong>10s</strong>ï¼‰ã€‚</li>
<li><strong>ç²¾ç®€é•œåƒæ„å»º</strong>ï¼šCRI-Oæ¨èä½¿ç”¨<strong>å¤šé˜¶æ®µæ„å»º</strong>ï¼ˆMulti-stage Buildï¼‰å’Œ<strong>Distrolessé•œåƒ</strong>ï¼ˆå¦‚<code>gcr.io/distroless/static-debian11</code>ï¼‰ï¼Œå‡å°‘é•œåƒçš„ä½“ç§¯ï¼ˆå¦‚ä»<strong>1GB</strong>ç¼©å°è‡³<strong>100MB</strong>ï¼‰ï¼Œé™ä½äº†è¾¹ç¼˜èŠ‚ç‚¹çš„å­˜å‚¨å ç”¨ã€‚</li>
</ul>
<h3 data-id="heading-5"><strong>æ€»ç»“ï¼šCRI-Oåœ¨è¾¹ç¼˜åœºæ™¯çš„èµ„æºèŠ‚çœä¼˜åŠ¿</strong></h3>
<p>é€šè¿‡ä»¥ä¸ŠæŠ€æœ¯å®ç°ï¼ŒCRI-Oåœ¨è¾¹ç¼˜è®¡ç®—åœºæ™¯ä¸‹çš„èµ„æºèŠ‚çœæ•ˆæœæ˜¾è‘—ï¼š</p>
<ul>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šæ¯”containerdä½<strong>37.5%</strong> ï¼ˆ50MB vs 80MBï¼‰ï¼›</li>
<li><strong>å¯åŠ¨é€Ÿåº¦</strong>ï¼šæ¯”containerdå¿«<strong>15%</strong> ï¼ˆ190ms vs 220msï¼‰ï¼›</li>
<li><strong>å­˜å‚¨å ç”¨</strong>ï¼šæ¯”containerdå°‘<strong>25%</strong> ï¼ˆ10MB vs 13.3MBï¼‰ï¼›</li>
<li><strong>å®‰å…¨å¼€é”€</strong>ï¼šä¸containerdç›¸è¿‘ï¼Œä½†å®‰å…¨æ€§æ›´é«˜ã€‚</li>
</ul>
<p>è¿™äº›ä¼˜åŠ¿ä½¿å¾—CRI-Oæˆä¸º<strong>è¾¹ç¼˜è®¡ç®—åœºæ™¯çš„é¦–é€‰å®¹å™¨è¿è¡Œæ—¶</strong>ï¼Œå°¤å…¶é€‚åˆèµ„æºå—é™çš„è¾¹ç¼˜è®¾å¤‡,å¦‚å·¥ä¸šç½‘å…³ã€æ™ºèƒ½ç»ˆç«¯ç­‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä½ çš„ 2026 å¹´è®¡ç®—æœºè§†è§‰åº”ç”¨é€‰æ‹©åˆé€‚çš„è¾¹ç¼˜ AI ç¡¬ä»¶]]></title>    <link>https://juejin.cn/post/7591317772075434003</link>    <guid>https://juejin.cn/post/7591317772075434003</guid>    <pubDate>2026-01-05T03:01:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591317772075434003" data-draft-id="7591317772075319315" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä½ çš„ 2026 å¹´è®¡ç®—æœºè§†è§‰åº”ç”¨é€‰æ‹©åˆé€‚çš„è¾¹ç¼˜ AI ç¡¬ä»¶"/> <meta itemprop="keywords" content="ç®—æ³•,è®¡ç®—æœºè§†è§‰,æ·±åº¦å­¦ä¹ "/> <meta itemprop="datePublished" content="2026-01-05T03:01:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä½ çš„ 2026 å¹´è®¡ç®—æœºè§†è§‰åº”ç”¨é€‰æ‹©åˆé€‚çš„è¾¹ç¼˜ AI ç¡¬ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T03:01:33.000Z" title="Mon Jan 05 2026 03:01:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿‡å»ä¸€å¹´ï¼Œè¾¹ç¼˜è®¡ç®—é¢†åŸŸå‘ç”Ÿäº†å¤©ç¿»åœ°è¦†çš„å˜åŒ–ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9afd49a32e47492397905630ab9a57cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186893&amp;x-signature=cBoHp%2BEecUPgT7xqNdGW0pi1DMA%3D" alt="screenshot_2026-01-04_14-26-56.png" loading="lazy"/></p>
<p>éšç€æ ‘è“æ´¾5ç­‰é«˜æ€§èƒ½ç´§å‡‘å‹ç³»ç»Ÿåœ¨AIåŠ é€Ÿé¢†åŸŸå®ç°æ˜¾è‘—çªç ´ï¼Œè§†è§‰åº”ç”¨çš„ä¸»è¦ç“¶é¢ˆå·²é€æ¸ä»åŸå§‹ç®—åŠ›è½¬å‘ç³»ç»Ÿçº§ååŒã€‚å¦‚ä»Šï¼Œç³»ç»Ÿæ¶æ„å¸ˆé¢ä¸´çš„æ ¸å¿ƒæŒ‘æˆ˜åœ¨äºï¼š<strong>å¦‚ä½•è®©ä¼ æ„Ÿå™¨ä¸I/Oï¼ˆè¾“å…¥/è¾“å‡ºï¼‰åŸºç¡€è®¾æ–½å……åˆ†é‡Šæ”¾è¿™äº›å¤„ç†å™¨çš„æ½œåŠ›ã€‚</strong></p>
<p>æ— è®ºæ˜¯è®¾è®¡<strong>è‡ªä¸»ç§»åŠ¨æœºå™¨äººï¼ˆAMRï¼‰ã€æ™ºèƒ½é›¶å”®ç»ˆç«¯</strong>ï¼Œè¿˜æ˜¯<strong>éƒ¨ç½²å¤šæ‘„åƒå¤´ç›‘æ§ç³»ç»Ÿ</strong>ï¼ŒæˆåŠŸçš„å…³é”®éƒ½åœ¨äºå°†ç³»ç»Ÿçš„â€œçœ¼ç›â€â€”â€”æ‘„åƒå¤´åŠå…¶ä»–ä¼ æ„Ÿå™¨â€”â€”ä¸â€œå¤§è„‘â€å³è¾¹ç¼˜AIç¡¬ä»¶è¿›è¡Œé«˜æ•ˆåŒ¹é…ã€‚æ„å»ºèƒ½å¤Ÿåœ¨2026å¹´çœŸæ­£å®ç°é«˜æ•ˆè¿è¡Œä¸”æˆæœ¬ä¼˜åŒ–çš„ç³»ç»Ÿï¼Œæ­£å–å†³äºå¯¹æ­¤å…³é”®å¯¹æ¥çš„æ·±å…¥ç†è§£ä¸å¦¥å–„è§„åˆ’ã€‚</p>
<h2 data-id="heading-0"><strong>è¾¹ç¼˜äººå·¥æ™ºèƒ½è®¡ç®—çš„ç°çŠ¶</strong></h2>
<p>å„å¤§ç¡¬ä»¶å‚å•†æ­£ä¼ é€’å‡ºä¸€ä¸ªæ˜ç¡®çš„ä¿¡å·ï¼šè¾¹ç¼˜AIçš„è®¡ç®—èƒ½åŠ›å·²ç»å®ç°äº†ä¸€æ¬¡é‡è¦é£è·ƒã€‚ä»¥NVIDIAæ–°ä¸€ä»£Jetson Thorä¸ºä¾‹ï¼Œå…¶åœ¨FP4ç²¾åº¦ä¸‹èƒ½å¤Ÿå®ç°çº¦2070 TFLOPSçš„AIç®—åŠ›ï¼Œè¿™æ„å‘³ç€åƒä¸‡äº¿æ¬¡çº§åˆ«çš„æµ®ç‚¹è¿ç®—æ€§èƒ½å¦‚ä»Šå·²çœŸæ­£è½åœ°äºè¾¹ç¼˜ä¾§è®¾å¤‡ã€‚ä¸æ­¤å‰ä¸€ä»£Jetson Orinç›¸æ¯”ï¼Œå…¶æ€§èƒ½å¢å¹…é«˜è¾¾7.5å€ï¼Œæ ‡å¿—ç€è¾¹ç¼˜AIå¤„ç†èƒ½åŠ›è¿ˆå…¥äº†å…¨æ–°çš„é˜¶æ®µã€‚</p>
<p>å³ä½¿æ˜¯å…¥é—¨çº§å¹³å°ä¹Ÿæœ‰äº†æ˜¾è‘—æå‡ã€‚ä¾‹å¦‚ï¼Œæ ‘è“æ´¾5æ­é…<strong>Hailo-8L AIåŠ é€Ÿå¥—ä»¶</strong>ï¼ˆé€šè¿‡M.2 PCIeæ¨¡å—ï¼‰ï¼Œå¯è·å¾—13 TOPSçš„ç¥ç»ç½‘ç»œæ¨ç†èƒ½åŠ›ã€‚Jetson Orin Nanoçš„æ€§èƒ½ä¹Ÿä»æœ€åˆç‰ˆæœ¬çš„40 TOPSæå‡è‡³Superé…ç½®çš„67 TOPSï¼Œå†…å­˜å¸¦å®½ä¹Ÿä»68 GB/sè·ƒå‡è‡³102 GB/sã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/180e08c860264fb884be1ce4e15368b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186893&amp;x-signature=jbc1jSyvh3ObnfRXZavpTs8eik4%3D" alt="screenshot_2026-01-04_14-29-30.png" loading="lazy"/></p>
<p>å¯¹äºéœ€è¦é«˜åˆ†è¾¨ç‡è§†é¢‘å¤„ç†çš„ä¸“ä¸šåº”ç”¨ï¼Œ<strong>ç‘èŠ¯å¾®RK3588èŠ¯ç‰‡</strong>å¯æä¾›30fpsçš„8Kè§†é¢‘ç¼–ç å’Œ60fpsçš„è§£ç ï¼Œå¹¶é…å¤‡6 TOPSçš„NPUï¼ˆç¥ç»å¤„ç†å•å…ƒï¼‰ä»¥åŠå¼ºå¤§çš„å¤šæ‘„åƒå¤´æ”¯æŒã€‚è¿™äº›ç‰¹æ€§ä½¿å…¶åœ¨ç½‘ç»œè§†é¢‘å½•åƒæœºï¼ˆNVRï¼‰å’Œæ™ºèƒ½ç›‘æ§åº”ç”¨é¢†åŸŸæå…·å¸å¼•åŠ›ã€‚</p>
<h2 data-id="heading-1"><strong>ä¸ºä»€ä¹ˆè§†è§‰I/Oç­–ç•¥æ¯”ä»¥å¾€ä»»ä½•æ—¶å€™éƒ½æ›´é‡è¦ï¼Ÿ</strong></h2>
<p>éšç€è¾¹ç¼˜è®¡ç®—æ€§èƒ½çš„æŒç»­è·ƒå‡ï¼Œç“¶é¢ˆæ–¹å‘å·²å‘ç”Ÿæ˜æ˜¾è½¬ç§»â€”â€”å³ä¾¿æ‹¥æœ‰å†å¼ºå¤§çš„ç®—åŠ›ï¼Œä¹Ÿéš¾ä»¥å¼¥è¡¥å› å›¾åƒè´¨é‡ä¸ä½³ã€è¿åŠ¨æ¨¡ç³Šã€å¸¦å®½å—é™æˆ–ç›¸æœºæ¥å£é…ç½®ä¸å½“æ‰€å¸¦æ¥çš„æ€§èƒ½æŸå¤±ã€‚</p>
<p>ä»é•œå¤´ã€ä¼ æ„Ÿå™¨åˆ°æ¥å£ä¼ è¾“ï¼Œæ•´ä¸ªå…‰å­¦æµæ°´çº¿çš„å“è´¨ä¸é…ç½®ï¼Œç›´æ¥å†³å®šäº†AIæ¨¡å‹èƒ½å¦å……åˆ†å‘æŒ¥å…¶æ•ˆèƒ½ã€‚è¿™é‡Œå­˜åœ¨ä¸€ä¸ªæ ¹æœ¬æ€§æŒ‘æˆ˜ï¼š<strong>å¦‚æœAIæ¨¡å‹æ˜¯åŸºäºæ¸…æ™°ã€æ›å…‰å‡†ç¡®çš„å›¾åƒè¿›è¡Œè®­ç»ƒï¼Œè€Œå®é™…è¾“å…¥çš„å´æ˜¯æ¨¡ç³Šã€æ˜æš—æˆ–ç•¸å˜çš„æ•°æ®ï¼Œå…¶æ•ˆæœå¿…å°†å¤§æ‰“æŠ˜æ‰£ã€‚</strong> å› æ­¤ï¼Œåœ¨è¾¹ç¼˜AIç³»ç»Ÿçš„æ„å»ºä¸­ï¼Œé€‰æ‹©åˆé€‚çš„æ‘„åƒå¤´åŠå…¶é›†æˆæ–¹æ¡ˆï¼Œå·²å˜å¾—ä¸é€‰æ‹©å¤„ç†å™¨åŒç­‰é‡è¦ã€‚</p>
<h2 data-id="heading-2"><strong>äº†è§£æ‘„åƒå¤´æ¥å£æŠ€æœ¯</strong></h2>
<p>ç°ä»£è¾¹ç¼˜AIå¹³å°æä¾›å¤šç§æ‘„åƒå¤´æ¥å£é€‰é¡¹ï¼Œæ¯ç§éƒ½æœ‰å…¶ç‹¬ç‰¹ç‰¹æ€§ï¼Œä¼šå½±å“ä¼ è¾“è·ç¦»ã€å¸¦å®½ã€ç¨³å®šæ€§å’Œå¤æ‚æ€§ã€‚å¯¹äºå¤§å¤šæ•°é¡¹ç›®è€Œè¨€ï¼Œ<strong>MIPI CSI-2ã€GMSL</strong>å’Œ<strong>USB 3.0</strong>æ˜¯å…³é”®é€‰æ‹©ã€‚äº†è§£æ¯ç§æ¥å£çš„ä¼˜åŠ¿ï¼Œæœ‰åŠ©äºä½ ä¸ºè¾¹ç¼˜è®¾å¤‡å’Œåº”ç”¨é€‰é…åˆé€‚çš„æ‘„åƒå¤´ã€‚</p>
<ul>
<li><strong>MIPI CSI-2ï¼šé«˜é€Ÿæ¿è½½æ ‡å‡†</strong></li>
</ul>
<p><strong>MIPIæ‘„åƒå¤´ä¸²è¡Œæ¥å£2ï¼ˆCSI-2ï¼‰</strong> æ˜¯ç‰‡ä¸Šç³»ç»Ÿï¼ˆSoCï¼‰ä¸­ä¸»æµçš„æ¿è½½æ‘„åƒå¤´æ¥å£ã€‚å®ƒæ”¯æŒå•é€šé“æœ€é«˜çº¦2.5 Gbpsï¼Œå››é€šé“æ€»é€Ÿç‡çº¦10 Gbpsï¼Œè¶³ä»¥æ»¡è¶³é«˜åˆ†è¾¨ç‡ã€é«˜å¸§ç‡è§†é¢‘ä¼ è¾“ï¼ŒåŒæ—¶ä¿æŒä½åŠŸè€—å’Œæä½å»¶è¿Ÿã€‚å› æ­¤ï¼ŒCSI-2éå¸¸é€‚åˆ<strong>ç›´æ¥å®‰è£…åœ¨ä¸»æ¿ä¸Šæˆ–è·ç¦»å¾ˆè¿‘</strong>çš„æ‘„åƒå¤´ï¼Œå¯é€šè¿‡çŸ­è€Œçµæ´»çš„æ‰å¹³ç”µç¼†ä¿æŒä¿¡å·å®Œæ•´æ€§ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/007066e1783f49d38f2e2618911cc673~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186893&amp;x-signature=55kojN%2BuRDTUuAwefe0Tb%2Bjoy5o%3D" alt="screenshot_2026-01-04_14-30-47.png" loading="lazy"/></p>
<p>CSI-2çš„ä¸»è¦é™åˆ¶åœ¨äºä¼ è¾“è·ç¦»ã€‚å®ƒé€šå¸¸ç”¨äºæ¿çº§è¿æ¥ï¼Œè·ç¦»ä¸€èˆ¬åœ¨30å˜ç±³ä»¥å†…ï¼Œè¿™é™åˆ¶äº†æ‘„åƒå¤´ç›¸å¯¹äºå¤„ç†å™¨çš„ç‰©ç†ä½ç½®ã€‚ä¾‹å¦‚ï¼Œæ ‘è“æ´¾5æä¾›ä¸¤ä¸ªCSIæ‘„åƒå¤´ç«¯å£ï¼Œä¸“ä¸ºçŸ­è·ç¦»æŸ”æ€§ç”µç¼†è®¾è®¡ã€‚NVIDIA Jetson Orin Nanoå¼€å‘å¥—ä»¶ä¹Ÿæä¾›ä¸¤ä¸ªMIPI CSI-2æ¥å£ï¼Œæ¯å¯¹é€šé“é€Ÿç‡é«˜è¾¾2.5 Gbpsï¼Œé€‚ç”¨äºè½½æ¿ä¸Šçš„ä¼ æ„Ÿå™¨ç›´æ¥è¿æ¥ã€‚å½“æ‘„åƒå¤´é è¿‘è®¡ç®—æ¨¡å—ï¼Œä¸”éœ€è¦æœ€é«˜æ€§èƒ½å’Œæœ€ä½å»¶è¿Ÿæ—¶ï¼ŒCSI-2é€šå¸¸æ˜¯é¦–é€‰ã€‚</p>
<ul>
<li><strong>GMSLï¼šè¿œè·ç¦»åŒæ­¥å¤šæ‘„åƒå¤´</strong></li>
</ul>
<p><strong>åƒå…†å¤šåª’ä½“ä¸²è¡Œé“¾è·¯ï¼ˆGMSLï¼‰</strong> ä¸ºç‰¹å®šåœºæ™¯ä¸‹çš„æ‘„åƒå¤´ç³»ç»Ÿé›†æˆæä¾›äº†å…³é”®è§£å†³æ–¹æ¡ˆã€‚å®ƒå°¤å…¶é€‚ç”¨äºå¤„ç†å™¨ä¸æ‘„åƒå¤´é—´å¿…é¡»ä¿æŒè¾ƒè¿œç‰©ç†è·ç¦»ï¼Œæˆ–éœ€è¦åœ¨æ¶åŠ£ç¯å¢ƒä¸­å®ç°å¤šæ‘„åƒå¤´é«˜ç²¾åº¦åŒæ­¥çš„è®¾è®¡ã€‚è¿™é¡¹æŠ€æœ¯æœ€åˆæºäºæ±½è½¦é¢†åŸŸï¼Œä¸ºæ»¡è¶³é«˜çº§é©¾é©¶è¾…åŠ©ç³»ç»Ÿï¼ˆADASï¼‰åŠç¯è§†å½±åƒçš„ä¸¥è‹›è¦æ±‚è€Œå¼€å‘ã€‚å…¶æ ¸å¿ƒåœ¨äºé‡‡ç”¨<strong>ä¸²è¡Œå™¨/è§£ä¸²å™¨ï¼ˆSerDesï¼‰æŠ€æœ¯</strong>ï¼Œä»…é€šè¿‡å•æ ¹åŒè½´ç”µç¼†æˆ–å±è”½åŒç»çº¿ï¼Œå°±èƒ½åŒæ—¶å®Œæˆé«˜é€Ÿè§†é¢‘æ•°æ®ã€æ§åˆ¶ä¿¡å·ä¸ç”µåŠ›çš„é•¿è·ç¦»ã€å¯é ä¼ è¾“ã€‚å¦‚ä»Šï¼ŒGMSLçš„åº”ç”¨å·²å¹¿æ³›æ‹“å±•è‡³æœºå™¨äººã€å·¥ä¸šè‡ªåŠ¨åŒ–ã€æ™ºèƒ½äº¤é€šç­‰å„ç±»è¾¹ç¼˜AIå‰æ²¿é¢†åŸŸã€‚</p>
<p>æŠ€æœ¯è§„æ ¼æ–¹é¢ï¼ŒGMSLæŠ€æœ¯æŒç»­è¿­ä»£ã€‚GMSL2çš„é“¾è·¯é€Ÿç‡å¯è¾¾6 Gbpsï¼Œè§†é¢‘æœ‰æ•ˆè½½è·çº¦5.2 Gbpsï¼Œåœ¨ç»´æŒçº¦15ç±³çº¿ç¼†é•¿åº¦æ—¶ä»èƒ½å®ç°å¾®ç§’çº§ä½å»¶è¿Ÿã€‚å…¶ä¸‹ä¸€ä»£GMSL3å°†å‰å‘é“¾è·¯å¸¦å®½æå‡è‡³12 Gbpsï¼Œè¶³ä»¥æ”¯æŒé€šè¿‡å•æ ¹çº¿ç¼†ä¼ è¾“90 fpsçš„æœªå‹ç¼©4Kè§†é¢‘æµï¼Œæˆ–å¹¶è¡Œä¼ è¾“å¤šè·¯4Kå›¾åƒã€‚åœ¨å·¥ä½œæµç¨‹ä¸Šï¼Œæ‘„åƒå¤´ç«¯çš„ä¸²è¡Œå™¨å°†å›¾åƒä¼ æ„Ÿå™¨è¾“å‡ºçš„MIPI CSIä¿¡å·è½¬æ¢ä¸ºGMSLä¿¡å·è¿›è¡Œä¼ è¾“ï¼›åœ¨å¤„ç†å™¨ç«¯ï¼Œè§£ä¸²å™¨åˆ™å°†å…¶è¿˜åŸä¸ºæ ‡å‡†CSI-2ä¿¡å·ï¼Œä»¥ä¾¿SoCè¿›è¡Œæ¥æ”¶å¤„ç†ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3af5412134945239f0e12bbb508b91a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186893&amp;x-signature=fYeuWDEj9H42NUny%2BDywWYS%2B9iw%3D" alt="screenshot_2026-01-04_14-31-06.png" loading="lazy"/></p>
<p>GMSLå¸¦æ¥äº†ä¸€ç³»åˆ—é‡è¦çš„å®é™…ä¼˜åŠ¿ã€‚å…¶ä¸­ï¼ŒåŒè½´ä¾›ç”µï¼ˆPoCï¼‰æŠ€æœ¯å…è®¸é€šè¿‡åŒä¸€æ ¹ç”µç¼†ä¼ è¾“æ•°æ®çš„åŒæ—¶æä¾›ç”µåŠ›ï¼ˆé€šå¸¸ä¸º12Vï¼‰ï¼Œè¿™æå¤§ç®€åŒ–äº†å¤šæ‘„åƒå¤´ç³»ç»Ÿçš„å¸ƒçº¿å¤æ‚åº¦ã€‚æ­¤å¤–ï¼ŒGMSLè®¾å¤‡å†…ç½®çš„å¸§åŒæ­¥åŠŸèƒ½ï¼Œèƒ½ç¡®ä¿å¤šä¸ªæ‘„åƒå¤´åœ¨ç²¾ç¡®çš„åŒä¸€æ—¶åˆ»æ•è·å›¾åƒï¼Œè¿™å¯¹ç«‹ä½“è§†è§‰ã€3Dé‡å»ºä¸å…¨æ™¯æ„ŸçŸ¥ç­‰åº”ç”¨è‡³å…³é‡è¦ã€‚ä»¥NVIDIA Jetsonå¹³å°ä¸ºä¾‹ï¼Œé€šè¿‡é€‚é…æ¿å¡ï¼Œå¯åœ¨Orin Nanoä¸Šæ”¯æŒå››ä¸ªæˆ–æ›´å¤šGMSLæ‘„åƒå¤´ï¼Œè€Œåœ¨AGX Orinæˆ–Xavierå¹³å°ä¸Šï¼Œåˆ™å¯æ”¯æŒå¤šè¾¾å…«ä¸ªä¹ƒè‡³åå…­ä¸ªæ‘„åƒå¤´ã€‚</p>
<p>å½“ç„¶ï¼Œé‡‡ç”¨GMSLæ–¹æ¡ˆä¹Ÿæ„å‘³ç€éœ€è¦æƒè¡¡å…¶å¼•å…¥çš„å¤æ‚æ€§ä¸æˆæœ¬ã€‚ç³»ç»Ÿéœ€å¢åŠ ä¸“ç”¨çš„ä¸²è¡Œå™¨/è§£ä¸²å™¨èŠ¯ç‰‡ã€è¿›è¡Œç²¾å¿ƒçš„PCBä¸çº¿ç¼†è®¾è®¡ï¼Œå¹¶åœ¨Jetsonç­‰å¹³å°ä¸Šé…ç½®ç›¸åº”çš„é©±åŠ¨ç¨‹åºä¸è®¾å¤‡æ ‘ã€‚å…¶åŠŸè€—é€šå¸¸é«˜äºæ¿è½½MIPIç›´è¿æ–¹æ¡ˆï¼Œä¸”ä¸å¦‚USBæ¥å£é‚£æ ·å…·å¤‡å³æ’å³ç”¨çš„ä¾¿åˆ©æ€§ã€‚</p>
<p>ç„¶è€Œï¼Œå½“åº”ç”¨åœºæ™¯æ˜ç¡®è¦æ±‚å¤šæ‘„åƒå¤´ç²¾å¯†åŒæ­¥ã€é•¿è·ç¦»å¯é ä¼ è¾“ä»¥åŠæ»¡è¶³æ±½è½¦çº§ç”µç£å¹²æ‰°ï¼ˆEMIï¼‰æŠ—æ‰°æ ‡å‡†æ—¶â€”â€”ä¾‹å¦‚åœ¨ç§»åŠ¨æœºå™¨äººæˆ–è½¦è¾†å¹³å°ä¸Šâ€”â€”GMSLå¾€å¾€æˆä¸ºå”¯ä¸€å®ç”¨çš„é€‰æ‹©ã€‚å®ƒèƒ½å¤Ÿä¸ºè¾¹ç¼˜AIç³»ç»Ÿæä¾›æ¸…æ™°ã€ç¨³å®šä¸”å…·æœ‰ç¡®å®šæ€§çš„è§†é¢‘æµï¼Œä»è€Œç¡®ä¿é¡¶å±‚æ™ºèƒ½ç®—æ³•çš„æ•ˆèƒ½å¾—ä»¥å……åˆ†å‘æŒ¥ã€‚</p>
<ul>
<li><strong>USB 3.0ï¼šçµæ´»ã€ä¸»æœºå‹å¥½çš„è§†é¢‘</strong></li>
</ul>
<p>USB 3.0åˆ™å¤„äºå¦ä¸€ä¸ªæç«¯ï¼š<strong>å®ƒæå…¶çµæ´»ã€æ”¯æŒå¹¿æ³›ä¸”æ˜“äºé›†æˆ</strong>ï¼Œä½†å…¶ç¡®å®šæ€§ä¸å¦‚MIPIæˆ–GMSLã€‚æ ‡ç§°é“¾è·¯é€Ÿåº¦ä¸º5 Gbpsï¼ˆçº¦640 MB/sï¼‰ï¼Œä½†è€ƒè™‘åˆ°åè®®å¼€é”€å’Œä¸»æœºé™åˆ¶ï¼Œå®é™…ååé‡é€šå¸¸æ¥è¿‘æ¯ä¸ªä¸»æœºæ§åˆ¶å™¨1.5â€“1.9 Gbpsã€‚ä¸€å°æœªå‹ç¼©çš„1080p 30fpsæ‘„åƒå¤´å¤§çº¦æ¶ˆè€—400 Mbpså¸¦å®½ï¼Œå› æ­¤ç†è®ºä¸Šå¤šå°é«˜æ¸…æ‘„åƒå¤´å¯ä»¥å…±äº«ä¸€ä¸ªUSB 3.0æ§åˆ¶å™¨ï¼Œä½†äº‰ç”¨å’Œé›†çº¿å™¨è®¾è®¡ä¼šä¸¥é‡å½±å“å®é™…æ€§èƒ½ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de2c39e11a184eb6a5630678151b28de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186893&amp;x-signature=TdtDqxZxXi%2F4V80MyF%2FS2mQKYKM%3D" alt="screenshot_2026-01-04_14-31-19.png" loading="lazy"/></p>
<p>ä½¿ç”¨åˆé€‚çš„çº¿ç¼†å’Œé›†çº¿å™¨ï¼ŒUSBæ‘„åƒå¤´å¯ä»¥æ”¾ç½®åœ¨è·ç¦»ä¸»æœºæ•°ç±³è¿œçš„åœ°æ–¹ï¼Œå› æ­¤éå¸¸é€‚åˆè‡ªåŠ©æœåŠ¡ç»ˆç«¯ã€å›ºå®šå®‰è£…å’Œæ¦‚å¿µéªŒè¯åŸå‹ã€‚ç„¶è€Œï¼Œæ‰€æœ‰é€šè¿‡åŒä¸€é›†çº¿å™¨è¿æ¥çš„æ‘„åƒå¤´å…±äº«åŒä¸€ä¸Šè¡Œé“¾è·¯ï¼Œå¸¦å®½ç”±ä¸»æœºæ§åˆ¶å™¨åŠ¨æ€ç®¡ç†ï¼Œå¦‚æœæµ‹è¯•ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸¢å¸§æˆ–å¸§ç‡é™ä½ã€‚ä¸GMSLä¸åŒï¼ŒUSBæœ¬èº«ä¸æä¾›å¾®ç§’çº§çš„å¸§åŒæ­¥ç²¾åº¦ï¼›éœ€è¦å¤–éƒ¨GPIOè§¦å‘å™¨æˆ–ä¸“ç”¨åŒæ­¥ç›’æ‰èƒ½å®ç°ç²¾ç¡®çš„å¤šæ‘„åƒå¤´åŒæ­¥ã€‚</p>
<h2 data-id="heading-3"><strong>å…³é”®ä¼ æ„Ÿå™¨æŠ€æœ¯ï¼šå…¨å±€å¿«é—¨ vs. å·å¸˜å¿«é—¨</strong></h2>
<p>è¿™ç§æƒè¡¡ä½“ç°åœ¨æˆæœ¬å’Œåˆ†è¾¨ç‡ä¸Šã€‚å…¨å±€å¿«é—¨ä¼ æ„Ÿå™¨é€šå¸¸æ¯”åŒç­‰æ€§èƒ½çš„å·å¸˜å¿«é—¨ä¼ æ„Ÿå™¨æ›´æ˜‚è´µï¼Œåƒç´ æ•°é‡ä¹Ÿå¯èƒ½æ›´ä½ã€‚ç„¶è€Œï¼Œå¯¹äºè¿åŠ¨æŒç»­ä¸æ–­çš„åº”ç”¨ï¼Œå¦‚é€è´§æœºå™¨äººã€æ— äººæœºã€è‡ªåŠ¨é©¾é©¶æ±½è½¦å’Œæœºæ¢°è‡‚ï¼ŒæŠ•èµ„å…¨å±€å¿«é—¨æŠ€æœ¯æ˜¯å¿…ä¸å¯å°‘çš„ï¼Œè€Œéå¯æœ‰å¯æ— ã€‚</p>
<p>åœ¨æœºå™¨äººåŠé«˜é€Ÿè§†è§‰ç³»ç»Ÿçš„è®¾è®¡ä¸­ï¼Œå¿«é—¨æŠ€æœ¯çš„é€‰æ‹©æ˜¯ä¸€é¡¹å½±å“æ·±è¿œçš„å†³ç­–ï¼Œå®ƒç›´æ¥å†³å®šäº†ç³»ç»Ÿåœ¨åŠ¨æ€åœºæ™¯ä¸‹çš„æˆåƒè´¨é‡ä¸å¯ç”¨æ€§ã€‚</p>
<p><strong>å·å¸˜å¿«é—¨ä¼ æ„Ÿå™¨</strong>é‡‡ç”¨é€è¡Œé¡ºåºæ›å…‰ä¸è¯»å–çš„å·¥ä½œæ–¹å¼ã€‚è¿™ä¸€æœºåˆ¶è™½ç„¶æœ‰åŠ©äºå®ç°æ›´é«˜çš„åƒç´ å¯†åº¦å’Œæ›´ä½çš„åˆ¶é€ æˆæœ¬ï¼Œä½†åœ¨æ‹æ‘„é«˜é€Ÿè¿åŠ¨ç‰©ä½“æˆ–ç›¸æœºè‡ªèº«å¤„äºè¿åŠ¨çŠ¶æ€æ—¶ï¼Œä¼šå¼•å…¥æ˜æ˜¾çš„â€œæœå†»æ•ˆåº”â€ç•¸å˜ã€‚å¯¹äºæœºå™¨äººåº”ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¾èµ–è§†è§‰çš„å¯¼èˆªä¸å³æ—¶å®šä½ä¸åœ°å›¾æ„å»ºï¼ˆSLAMï¼‰ç­‰ä»»åŠ¡ä¸­ï¼Œæ­¤ç±»å›¾åƒå¤±çœŸä¼šä¸¥é‡å½±å“ç©ºé—´æ„ŸçŸ¥çš„å‡†ç¡®æ€§ï¼Œå¯¼è‡´å…¶éš¾ä»¥ç”¨äºç²¾ç¡®çš„ç¯å¢ƒç†è§£ä¸å†³ç­–ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œ<strong>å…¨å±€å¿«é—¨ä¼ æ„Ÿå™¨</strong>é€šè¿‡åŒæ­¥æ›å…‰æ‰€æœ‰åƒç´ ï¼Œåœ¨åŒä¸€æ—¶åˆ»æ•æ‰å®Œæ•´çš„ç”»é¢ï¼Œä»è€Œå½»åº•é¿å…äº†å› ç‰©ä½“æˆ–ç›¸æœºè¿åŠ¨å¯¼è‡´çš„å½¢å˜ã€‚è¿™ç§æ—¶é—´ä¸ç©ºé—´çš„é«˜åº¦ä¸€è‡´æ€§ï¼Œä¸ºé«˜é€Ÿã€é«˜ç²¾åº¦çš„è§†è§‰åº”ç”¨æä¾›äº†å…³é”®ä¿éšœã€‚å› æ­¤ï¼Œåœ¨åŠ¨æ€ç¯å¢ƒä¸­ï¼Œå…¨å±€å¿«é—¨æ‰€æä¾›çš„å›¾åƒä¸ä»…æ˜¯æ¸…æ™°çš„ï¼Œæ›´æ˜¯â€œçœŸå®â€ä¸”å¯ç”¨äºç²¾å¯†è®¡ç®—çš„ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/933f2f02dd6647639382dd1b8cfd5eca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186893&amp;x-signature=JBPWedIUHl3UxVTFrXPK2%2FJp3rA%3D" alt="screenshot_2026-01-04_14-31-43.png" loading="lazy"/></p>
<p>å½“ç„¶ï¼Œè¿™ä¸€ä¼˜åŠ¿ä¼´éšç€ç›¸åº”çš„æƒè¡¡ã€‚å…¨å±€å¿«é—¨ä¼ æ„Ÿå™¨é€šå¸¸åœ¨æˆæœ¬ä¸Šé«˜äºåŒç­‰æ€§èƒ½çš„å·å¸˜å¿«é—¨ä¼ æ„Ÿå™¨ï¼Œä¸”åœ¨åƒç´ æ€»é‡ä¸Šå¯èƒ½å—åˆ°ä¸€å®šé™åˆ¶ã€‚ç„¶è€Œï¼Œå¯¹äºè¿åŠ¨æŒç»­ä¸æ–­ã€å¯¹å›¾åƒå®Œæ•´æ€§è¦æ±‚ä¸¥è‹›çš„åº”ç”¨åœºæ™¯â€”â€”ä¾‹å¦‚è‡ªä¸»ç§»åŠ¨çš„é€è´§æœºå™¨äººã€é«˜é€Ÿæ— äººæœºã€è‡ªåŠ¨é©¾é©¶è½¦è¾†ä»¥åŠç²¾å‡†æ“ä½œçš„æœºæ¢°è‡‚â€”â€”é‡‡ç”¨å…¨å±€å¿«é—¨å·²éä¸€é¡¹å¯é€‰çš„ä¼˜åŒ–ï¼Œè€Œæ˜¯ä¿éšœç³»ç»Ÿå¯é æ€§ä¸æ€§èƒ½çš„å¿…å¤‡æ¡ä»¶ã€‚åœ¨æ­¤ç±»åœºæ™¯ä¸­ï¼ŒæŠ•èµ„äºå…¨å±€å¿«é—¨æŠ€æœ¯ï¼Œå®è´¨ä¸Šæ˜¯ä¸ºæ•´ä¸ªè§†è§‰ç³»ç»Ÿçš„é²æ£’æ€§ä¸æœ‰æ•ˆæ€§å¥ å®šåŸºç¡€ã€‚</p>
<h2 data-id="heading-4"><strong>å¸¸è§åº”ç”¨åœºæ™¯çš„å¹³å°ç‰¹å®šè€ƒé‡</strong></h2>
<ul>
<li><strong>è‡ªä¸»ç§»åŠ¨æœºå™¨äººï¼ˆAMRï¼‰</strong></li>
</ul>
<p>AMRåº”ç”¨æ¨åŠ¨äº†NVIDIA Jetson Orinç³»åˆ—åœ¨æœºå™¨äººé¢†åŸŸçš„å¹¿æ³›é‡‡ç”¨ã€‚è¿™äº›å¹³å°éœ€è¦å¤„ç†ä¼ æ„Ÿå™¨èåˆæ•°æ®ã€æ‰§è¡Œå®æ—¶SLAMï¼Œå¹¶ä»¥æœ€å°å»¶è¿Ÿåšå‡ºå¯¼èˆªå†³ç­–ã€‚</p>
<p>å¯¹äºå¯¼èˆªå’Œé¿éšœï¼Œé€šè¿‡MIPI CSIæ¥å£è¿æ¥çš„å…¨å±€å¿«é—¨æ‘„åƒå¤´å¯æä¾›æœ€ä½³çš„å›¾åƒè´¨é‡å’Œä½å»¶è¿Ÿç»„åˆã€‚Jetson Orinæ¨¡å—ä¸Šçš„ä¸¤ä¸ªCSIç«¯å£å¯åˆ†é…ç»™é…å¤‡å…¨å±€å¿«é—¨ä¼ æ„Ÿå™¨çš„å‰ç½®å¯¼èˆªæ‘„åƒå¤´ï¼Œä»¥ç¡®ä¿è·¯å¾„è§„åˆ’æ‰€éœ€çš„æ•°æ®æ¸…æ™°æ— å¤±çœŸã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cdd0b4d56424a9692d8d60cf590a6b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186893&amp;x-signature=UuBvjCHEtNLlifzWohhvUxpB2XY%3D" alt="screenshot_2026-01-04_14-32-02.png" loading="lazy"/></p>
<p>å¯¹äºåè§†ç›‘æ§ã€è¿œç¨‹å‘ˆç°æˆ–ç¯å¢ƒæ„ŸçŸ¥ç­‰æœºå™¨äººæˆ–ç›®æ ‡ç›¸å¯¹é™æ­¢çš„è¾…åŠ©åŠŸèƒ½ï¼ŒUSB 3.0æ‘„åƒå¤´å¯ä»¥å¤„ç†è¿™äº›æ•°æ®æµï¼Œè€Œä¸ä¼šå ç”¨å®è´µçš„CSIå¸¦å®½ã€‚è¿™ç§æ¶æ„æ–¹æ¡ˆæ—¢èƒ½ä¸ºå…³é”®ä»»åŠ¡ä¼ æ„Ÿå™¨ä¿ç•™é«˜å¸¦å®½ã€ä½å»¶è¿Ÿçš„æ¥å£ï¼Œåˆèƒ½åˆ©ç”¨æ›´çµæ´»çš„USBè¿æ¥ä¼ è¾“è¡¥å……æ•°æ®ã€‚</p>
<ul>
<li><strong>æ™ºèƒ½é›¶å”®äº­å’Œè‡ªåŠ¨å”®è´§æœº</strong></li>
</ul>
<p>ç°ä»£é›¶å”®è‡ªåŠ©æœåŠ¡ç»ˆç«¯å·²å‘å±•æˆä¸ºå¤šæ‘„åƒå¤´ç³»ç»Ÿï¼Œé€šå¸¸éœ€è¦ä¸‰åˆ°å››ä¸ªæˆ–æ›´å¤šæˆåƒè®¾å¤‡ã€‚å…¸å‹éœ€æ±‚åŒ…æ‹¬ï¼šç”¨äºæ”¯ä»˜æˆ–å¹´é¾„éªŒè¯çš„äººè„¸è¯†åˆ«ã€æ¡å½¢ç /äºŒç»´ç æ‰«æã€åº“å­˜ç›‘æ§å’Œå®‰å…¨ç›‘æ§ã€‚</p>
<p>æ­è½½Hailo-8L AIåŠ é€Ÿå¥—ä»¶çš„æ ‘è“æ´¾5å·²æˆä¸ºè¿™äº›åº”ç”¨çš„ç†æƒ³å¹³å°ï¼Œä»¥äº²æ°‘çš„ä»·æ ¼æä¾›13 TOPSçš„AIåŠ é€Ÿæ€§èƒ½ã€‚ç„¶è€Œï¼Œç”±äºä»…æä¾›ä¸¤ä¸ªCSIæ‘„åƒå¤´æ¥å£ï¼Œç³»ç»Ÿè®¾è®¡äººå‘˜å¿…é¡»è§„åˆ’æ··åˆæ‘„åƒå¤´æ¶æ„ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3598065e7d64fefa6c63073d6abd111~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186893&amp;x-signature=Tz9e1tut7FZ1C9e2i1mZc7a0s4M%3D" alt="screenshot_2026-01-04_14-32-15.png" loading="lazy"/></p>
<p>å¯¹å»¶è¿Ÿæœ€æ•æ„Ÿçš„æ‘„åƒå¤´ï¼ˆé€šå¸¸æ˜¯ç”¨äºæ”¯ä»˜æˆæƒçš„äººè„¸è¯†åˆ«æ‘„åƒå¤´ï¼‰åº”é€šè¿‡CSIæ¥å£è¿æ¥ï¼Œä»¥æœ€å¤§ç¨‹åº¦å‡å°‘ç”¨æˆ·ä½“éªŒä¸­çš„å»¶è¿Ÿã€‚ç”¨äºåº“å­˜ç›‘æ§ã€å®‰é˜²æˆ–å…¶ä»–è¾…åŠ©åŠŸèƒ½çš„æ‘„åƒå¤´å¯ä»¥é€šè¿‡USB 3.0æ¥å£è¿æ¥ã€‚ç°ä»£è‡ªåŠ©æœåŠ¡ç»ˆç«¯é€šå¸¸éœ€è¦500ä¸‡è‡³800ä¸‡åƒç´ æˆ–æ›´é«˜çš„åˆ†è¾¨ç‡ï¼Œæ‰èƒ½æ¸…æ™°åœ°è¯†åˆ«äººè„¸ç‰¹å¾å¹¶å‡†ç¡®è¯»å–æ¡å½¢ç ã€‚</p>
<p>åœ¨åŸå‹è®¾è®¡é˜¶æ®µæµ‹è¯•USBå¸¦å®½åˆ†é…è‡³å…³é‡è¦ã€‚å¦‚æœè‡ªåŠ©æœåŠ¡ç»ˆç«¯è®¾è®¡éœ€è¦å››ä¸ªæ‘„åƒå¤´ï¼Œå…¶ä¸­ä¸‰ä¸ªå¿…é¡»ä½¿ç”¨USBæ¥å£ï¼Œè¯·è®¡ç®—æ€»å¸¦å®½éœ€æ±‚ï¼ˆåˆ†è¾¨ç‡ Ã— å¸§é€Ÿç‡ Ã— ä½æ·±åº¦ï¼‰ï¼Œå¹¶éªŒè¯å…¶æ˜¯å¦åœ¨USBæ§åˆ¶å™¨çš„å®é™…å¸¦å®½é™åˆ¶èŒƒå›´å†…ã€‚</p>
<ul>
<li><strong>å¤šæ‘„åƒå¤´ç½‘ç»œå½•åƒæœºå’Œç›‘æ§ç³»ç»Ÿ</strong></li>
</ul>
<p>å¯¹äºç½‘ç»œè§†é¢‘å½•åƒæœºï¼ˆNVRï¼‰å’Œæ™ºèƒ½ç›‘æ§åº”ç”¨ï¼Œç‘èŠ¯å¾®RK3588æä¾›äº†å¼ºå¤§çš„åŠŸèƒ½ã€‚å®ƒæ”¯æŒ30fpsçš„8Kç¼–ç ï¼Œå¹¶å…·å¤‡å¤„ç†å¤šé€šé“ç¼–ç å’Œè§£ç çš„èƒ½åŠ›ï¼Œéå¸¸é€‚åˆä¸“ä¸šè§†é¢‘ç®¡ç†ã€‚</p>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5cad7ab5cbfc4b3bb0882c8a55259e43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186893&amp;x-signature=m08o16J8UDzP74tspQx6k7T4SWY%3D" alt="screenshot_2026-01-04_14-32-32.png" loading="lazy"/></p>
<p>RK3588æ‹¥æœ‰ä¸°å¯Œçš„æ‘„åƒå¤´æ¥å£æ”¯æŒï¼ŒåŒ…æ‹¬ä¸¤ä¸ªMIPI DCï¼ˆ4é€šé“DPHYï¼‰æ¥å£ã€å››ä¸ª2é€šé“MIPI CSIæ¥å£å’Œä¸€ä¸ªDVPæ¥å£ã€‚è¿™ç§çµæ´»æ€§ä½¿å…¶èƒ½å¤ŸåŒæ—¶ç›´æ¥è¿æ¥å¤šä¸ªé«˜åˆ†è¾¨ç‡æ‘„åƒå¤´ã€‚å¯¹äºéœ€è¦â€œç¯è§†â€è¦†ç›–æˆ–å¤šè§’åº¦ç›‘æ§çš„åº”ç”¨ï¼ŒRK3588çš„æ¶æ„å¯ä»¥å®¹çº³å››ä¸ªæˆ–æ›´å¤šæ‘„åƒå¤´è§†é¢‘æµï¼Œè€Œæ— éœ€å®Œå…¨ä¾èµ–USBè¿æ¥ã€‚</p>
<p>ä¸“ä¸šNVRç³»ç»Ÿé€šå¸¸æ”¯æŒ8åˆ°64ä¸ªé€šé“æˆ–æ›´å¤šï¼Œå¸¦å®½éœ€æ±‚é«˜è¾¾æ•°ç™¾Mbpsã€‚RK3588èƒ½å¤Ÿä»¥30fpsç¼–ç 8Kè§†é¢‘ï¼Œæˆ–åŒæ—¶å¤„ç†å¤šè¾¾32ä¸ªé€šé“çš„1080p30ç¼–ç ï¼Œä½¿å…¶èƒ½å¤Ÿèƒœä»»é«˜å®¹é‡ç›‘æ§éƒ¨ç½²ã€‚</p>
<h2 data-id="heading-5"><strong>å®ç”¨è®¾è®¡æŒ‡å—</strong></h2>
<p>åœ¨è§„åˆ’è¾¹ç¼˜è§†è§‰ç³»ç»Ÿæ—¶ï¼Œéµå¾ªä»¥ä¸‹åŸåˆ™æœ‰åŠ©äºä½¿ä½ çš„ä¼ æ„Ÿå™¨ç­–ç•¥ä¸è®¡ç®—å¹³å°ä¿æŒä¸€è‡´ã€‚</p>
<ul>
<li><strong>æ ¹æ®ä¼˜å…ˆçº§å’Œæ€§èƒ½è¦æ±‚åˆ†é…æ¥å£</strong></li>
</ul>

<ul>
<li>å¯¹äºéœ€è¦æœ€é«˜å¸¦å®½ã€æœ€ä½å»¶è¿Ÿæˆ–ç”¨äºæ—¶é—´å…³é”®å‹AIæ¨ç†ï¼ˆå¦‚å¯¼èˆªã€å®‰å…¨ã€ä¸»è¦è¯†åˆ«ä»»åŠ¡ï¼‰çš„æ‘„åƒå¤´ï¼Œä¿ç•™MIPI CSIè¿æ¥ã€‚</li>
<li>å¯¹äºå»¶è¿Ÿå¯æ¥å—çš„è¾…åŠ©æ‘„åƒå¤´ï¼Œæˆ–æ‘„åƒå¤´ä½ç½®éœ€è¦è¾ƒé•¿çº¿ç¼†çš„æƒ…å†µï¼Œä½¿ç”¨USB 3.0ã€‚</li>
<li>å½“æ‘„åƒå¤´å¿…é¡»æ”¾ç½®åœ¨æ•°ç±³ä¹‹å¤–ã€å¤šæ‘„åƒå¤´å¸§åŒæ­¥è‡³å…³é‡è¦ï¼Œæˆ–ç³»ç»Ÿåœ¨ç”µç£ç¯å¢ƒæ¶åŠ£çš„ç¯å¢ƒä¸­è¿è¡Œæ—¶ï¼Œè€ƒè™‘ä½¿ç”¨GMSLã€‚</li>
</ul>

<ul>
<li><strong>å°†ä¼ æ„Ÿå™¨æŠ€æœ¯ä¸è¿åŠ¨ç‰¹æ€§ç›¸åŒ¹é…</strong></li>
</ul>

<ul>
<li>å¦‚æœåº”ç”¨åœºæ™¯æ¶‰åŠå¿«é€Ÿç§»åŠ¨çš„ç‰©ä½“æˆ–ç§»åŠ¨çš„ç›¸æœºå¹³å°ï¼Œå…¨å±€å¿«é—¨ä¼ æ„Ÿå™¨æ˜¯å¿…éœ€å“ï¼Œè€Œéå¥¢ä¾ˆå“ã€‚</li>
<li>å¯¹äºé™æ€æˆ–æ…¢é€Ÿç§»åŠ¨çš„åœºæ™¯ï¼Œå·å¸˜å¿«é—¨ä¼ æ„Ÿå™¨èƒ½æä¾›æ›´é«˜çš„åˆ†è¾¨ç‡å’Œæ›´ä½çš„æˆæœ¬ã€‚</li>
</ul>

<ul>
<li><strong>å°½æ—©è®¡ç®—å¹¶æµ‹è¯•å¸¦å®½</strong></li>
</ul>

<ul>
<li>ä¸è¦ç­‰åˆ°é›†æˆé˜¶æ®µæ‰å‘ç°å¸¦å®½ç“¶é¢ˆã€‚è®¡ç®—æ‰€æœ‰æ‘„åƒå¤´çš„æ€»æ•°æ®ååé‡ï¼ˆåˆ†è¾¨ç‡ Ã— å¸§é€Ÿç‡ Ã— åƒç´ æ ¼å¼ï¼‰ã€‚</li>
<li>å¯¹äºUSBé…ç½®ï¼Œç”±äºä¸»æœºæ§åˆ¶å™¨æ€§èƒ½å„å¼‚ï¼ŒåŠ¡å¿…ä½¿ç”¨å®é™…ç¡¬ä»¶å’ŒçœŸå®æµåª’ä½“æ¨¡å¼è¿›è¡Œæµ‹è¯•ã€‚</li>
<li>å¯¹äºGMSLç³»ç»Ÿï¼ŒéªŒè¯è§£ä¸²å™¨é€šé“åˆ†é…å’Œä»»ä½•å¸¦å®½å…±äº«è¦æ±‚ã€‚</li>
</ul>

<ul>
<li><strong>å°†é•œå¤´è´¨é‡å’Œå…‰å­¦å…ƒä»¶çº³å…¥ç³»ç»Ÿè€ƒé‡</strong></li>
</ul>

<ul>
<li>å³ä½¿æ˜¯æœ€å¥½çš„ä¼ æ„Ÿå™¨å’Œæœ€å¼ºå¤§çš„å¤„ç†å™¨ï¼Œä¹Ÿæ— æ³•å¼¥è¡¥é•œå¤´è´¨é‡å·®ã€ç„¦è·ä¸åˆé€‚æˆ–å…‰ç…§ä¸è¶³å¸¦æ¥çš„é—®é¢˜ã€‚</li>
<li>åœ¨æŠ•èµ„è®¡ç®—è®¾å¤‡å’Œä¼ æ„Ÿå™¨çš„åŒæ—¶ï¼Œä¹Ÿè¦ä¸ºä¼˜è´¨å…‰å­¦å…ƒä»¶å’Œåˆé€‚çš„æ›å…‰æ§åˆ¶é¢„ç•™é¢„ç®—ã€‚</li>
</ul>
<h2 data-id="heading-6"><strong>é¢å‘è¾¹ç¼˜AIè§†è§‰çš„å¹³è¡¡ç³»ç»Ÿè®¾è®¡</strong></h2>
<p>è¾¹ç¼˜AIè®¡ç®—èƒ½åŠ›çš„é£é€Ÿæå‡â€”â€”ä»NVIDIA Jetson Thorçš„petaFLOPçº§æ€§èƒ½ï¼Œåˆ°æ ‘è“æ´¾5çš„13 TOPS AIåŠ é€Ÿâ€”â€”ä»æ ¹æœ¬ä¸Šæ”¹å˜äº†è¾¹ç¼˜è®¡ç®—çš„å¯èƒ½æ€§ã€‚ä½†è¿™ç§å¼ºå¤§çš„å¤„ç†èƒ½åŠ›ï¼Œåªæœ‰ä¸ç²¾å¿ƒè®¾è®¡çš„è§†è§‰æµæ°´çº¿ç›¸ç»“åˆï¼Œæ‰èƒ½çœŸæ­£å‘æŒ¥ä½œç”¨ã€‚</p>
<p>æˆåŠŸçš„è¾¹ç¼˜è§†è§‰ç³»ç»Ÿéœ€è¦åœ¨<strong>ä¼ æ„Ÿå™¨æŠ€æœ¯</strong>ï¼ˆå…¨å±€å¿«é—¨ vs. å·å¸˜å¿«é—¨ï¼‰ã€<strong>æ¥å£é€‰æ‹©</strong>ï¼ˆMIPI CSIã€GMSLã€USBï¼‰ã€<strong>å¸¦å®½ç®¡ç†ã€é•œå¤´è´¨é‡</strong>å’Œ<strong>ç…§æ˜è®¾è®¡</strong>ç­‰å¤šä¸ªæ–¹é¢å–å¾—å¹³è¡¡ã€‚å†å¼ºå¤§çš„AIè®¡ç®—èƒ½åŠ›ä¹Ÿæ— æ³•ä¿®å¤æ¨¡ç³Šã€æ˜æš—æˆ–å¤±çœŸçš„å›¾åƒã€‚æœ€ä½³çš„AIæ¨¡å‹å°†åŸºäºç²¾å¿ƒè®¾è®¡çš„å…‰å­¦ç³»ç»Ÿé‡‡é›†çš„æ¸…æ™°æ•°æ®æ„å»ºè€Œæˆã€‚</p>
<p>é€šè¿‡äº†è§£å½“ä»Šè¾¹ç¼˜AIç¡¬ä»¶çš„å®é™…èƒ½åŠ›å’Œå±€é™æ€§ï¼Œå¹¶å°†è¿™äº›èƒ½åŠ›ä¸ä½ åº”ç”¨ç¨‹åºçš„å…·ä½“éœ€æ±‚ç›¸åŒ¹é…ï¼Œä½ å°±å¯ä»¥æ„å»ºå‡ºèƒ½å¤Ÿå……åˆ†åˆ©ç”¨å½“å‰è¾¹ç¼˜å“è¶Šè®¡ç®—èµ„æºçš„è§†è§‰ç³»ç»Ÿã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBootæ•´åˆFFmpegï¼Œæ‰“é€ ä½ çš„ä¸“å±è§†é¢‘å¤„ç†å·¥å‚]]></title>    <link>https://juejin.cn/post/7591382440582299688</link>    <guid>https://juejin.cn/post/7591382440582299688</guid>    <pubDate>2026-01-05T02:47:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591382440582299688" data-draft-id="7591330139084406799" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBootæ•´åˆFFmpegï¼Œæ‰“é€ ä½ çš„ä¸“å±è§†é¢‘å¤„ç†å·¥å‚"/> <meta itemprop="keywords" content="åç«¯,Java,Spring Boot"/> <meta itemprop="datePublished" content="2026-01-05T02:47:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ‚Ÿç©ºç å­—"/> <meta itemprop="url" content="https://juejin.cn/user/3139860942296830"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBootæ•´åˆFFmpegï¼Œæ‰“é€ ä½ çš„ä¸“å±è§†é¢‘å¤„ç†å·¥å‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3139860942296830/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ‚Ÿç©ºç å­—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T02:47:38.000Z" title="Mon Jan 05 2026 02:47:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æ‚Ÿã€‚</p>
<h2 data-id="heading-0">ç¬¬ä¸€éƒ¨åˆ†ï¼šè®¤è¯† FFmpeg â€”â€” è§†é¢‘ç•Œçš„ç‘å£«å†›åˆ€</h2>
<p>FFmpeg æ˜¯ä»€ä¹ˆï¼Ÿæƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæœ‹å‹ï¼Œä»–èƒ½ï¼š</p>
<ul>
<li>æŠŠ MP4 å˜æˆ AVIï¼Œå°±åƒæŠŠå’–å•¡å˜æˆå¥¶èŒ¶</li>
<li>è£å‰ªè§†é¢‘ï¼Œæ¯”ç†å‘å¸ˆå‰ªå¤´å‘è¿˜ç²¾å‡†</li>
<li>æå–éŸ³é¢‘ï¼Œæ¯”ä»æŠ«è¨ä¸Šåˆ†ç¦»èŠå£«è¿˜å¹²å‡€</li>
<li>å‹ç¼©è§†é¢‘ï¼Œæ¯”ä½ æŠŠè¡Œæç®±å¡æ»¡æ—¶è¿˜é«˜æ•ˆ</li>
</ul>
<p>è¿™ä¸ªâ€œä¸‡èƒ½æœ‹å‹â€å°±æ˜¯ FFmpegï¼å®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„å£°éŸ³/å½±åƒå¤„ç†å·¥å…·ï¼ŒåŠŸèƒ½å¼ºå¤§åˆ°èƒ½è®©å¥½è±åç‰¹æ•ˆå¸ˆå¤±ä¸šï¼ˆå¼€ç©ç¬‘çš„ï¼‰ã€‚</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">FFmpeg çš„åŸºæœ¬å¿ƒæ€ï¼š</span>
<span class="hljs-meta prompt_"># </span><span class="bash"><span class="hljs-string">"ç»™æˆ‘ä¸€ä¸ªè§†é¢‘ï¼Œæˆ‘èƒ½è¿˜ä½ ä¸€ä¸ªä¸–ç•Œ"</span></span>
<span class="hljs-meta prompt_"># </span><span class="bash">å®é™…ä¸Šå®ƒæƒ³è¯´çš„æ˜¯ï¼š<span class="hljs-string">"ffmpeg -i input.mp4 [ä¸€å †å‚æ•°] output.mp4"</span></span>
</code></pre>
<h2 data-id="heading-1">ç¬¬äºŒéƒ¨åˆ†ï¼šæ•´åˆæ­¥éª¤ â€”â€” åƒç»„è£…ä¹é«˜ä¸€æ ·ç®€å•</h2>
<h3 data-id="heading-2">æ­¥éª¤1ï¼šå…ˆç»™é¡¹ç›®æ¥ç‚¹â€œå¼€èƒƒèœâ€â€”â€” Mavenä¾èµ–</h3>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- pom.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- SpringBoot æ ‡å‡†é…ç½® --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- è®©æˆ‘ä»¬è®°å½•FFmpegçš„â€œç²¾å½©è¡¨æ¼”â€ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    
    <span class="hljs-comment">&lt;!-- è§†é¢‘å¤„ç†æ—¶çš„â€œåæ‚”è¯â€â€”â€”å¼‚å¸¸å¤„ç† --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">æ­¥éª¤2ï¼šé…ç½®FFmpeg â€”â€” åƒæ•™AIç”¨ç­·å­</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ConfigurationProperties(prefix = <span class="hljs-string">"ffmpeg"</span>)</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FFmpegConfig</span> {
    <span class="hljs-comment">/**
     * FFmpegå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„
     * Windows: "C:/ffmpeg/bin/ffmpeg.exe"
     * Linux/Mac: "/usr/bin/ffmpeg"
     */</span>
    <span class="hljs-keyword">private</span> String path;
    
    <span class="hljs-comment">/**
     * è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
     * é˜²æ­¢è§†é¢‘å¤„ç†å˜æˆâ€œæ°¸æ’ç­‰å¾…â€
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> timeout = <span class="hljs-number">3600L</span>;
    
    <span class="hljs-comment">/**
     * çº¿ç¨‹æ•°
     * å¤šçº¿ç¨‹å°±åƒå¤šåŒæ‰‹ï¼Œå¹²æ´»æ›´å¿«ï¼
     */</span>
    <span class="hljs-keyword">private</span> Integer threads = <span class="hljs-number">4</span>;
}
</code></pre>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># application.yml</span>
<span class="hljs-attr">ffmpeg:</span>
  <span class="hljs-attr">path:</span> <span class="hljs-string">/usr/local/bin/ffmpeg</span>  <span class="hljs-comment"># ä½ çš„FFmpegå®‰è£…è·¯å¾„</span>
  <span class="hljs-attr">timeout:</span> <span class="hljs-number">3600</span>                <span class="hljs-comment"># 1å°æ—¶ï¼Œè¶³å¤Ÿçœ‹ä¸€é›†ç”µè§†å‰§äº†</span>
  <span class="hljs-attr">threads:</span> <span class="hljs-number">4</span>                   <span class="hljs-comment"># 4ä¸ªçº¿ç¨‹ï¼Œå››æ ¸å¤„ç†å™¨çš„æœ€çˆ±</span>
</code></pre>
<h3 data-id="heading-4">æ­¥éª¤3ï¼šåˆ›å»ºFFmpegæŒ‡æŒ¥å®˜</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;

<span class="hljs-keyword">import</span> java.io.BufferedReader;
<span class="hljs-keyword">import</span> java.io.InputStreamReader;
<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FFmpegCommander</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> FFmpegConfig ffmpegConfig;
    
    <span class="hljs-comment">/**
     * æ‰§è¡ŒFFmpegå‘½ä»¤
     * <span class="hljs-doctag">@param</span> commands å‘½ä»¤å‚æ•°ï¼ˆåƒç»™å¨å¸ˆé€’èœå•ï¼‰
     * <span class="hljs-doctag">@return</span> æ˜¯å¦æˆåŠŸï¼ˆå¨å­æœ‰æ²¡æœ‰æŠŠèœåšç³Šï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(List&lt;String&gt; commands)</span> {
        List&lt;String&gt; fullCommand = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        fullCommand.add(ffmpegConfig.getPath());
        fullCommand.addAll(commands);
        
        log.info(<span class="hljs-string">"FFmpegå¼€å§‹å¹²æ´»å•¦ï¼å‘½ä»¤ï¼š{}"</span>, String.join(<span class="hljs-string">" "</span>, fullCommand));
        
        <span class="hljs-type">ProcessBuilder</span> <span class="hljs-variable">processBuilder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(fullCommand);
        processBuilder.redirectErrorStream(<span class="hljs-literal">true</span>); <span class="hljs-comment">// é”™è¯¯è¾“å‡ºä¹Ÿç»™æˆ‘çœ‹çœ‹</span>
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> processBuilder.start();
            
            <span class="hljs-comment">// è¯»å–è¾“å‡ºï¼Œé˜²æ­¢FFmpegâ€œè‡ªè¨€è‡ªè¯­â€æ²¡äººå¬</span>
            <span class="hljs-keyword">try</span> (<span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(process.getInputStream()))) {
                String line;
                <span class="hljs-keyword">while</span> ((line = reader.readLine()) != <span class="hljs-literal">null</span>) {
                    log.debug(<span class="hljs-string">"FFmpegæ‚„æ‚„è¯´ï¼š{}"</span>, line);
                }
            }
            
            <span class="hljs-comment">// ç­‰å¾…å¤„ç†å®Œæˆï¼Œåˆ«æ€¥ç€å‚¬</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">exitCode</span> <span class="hljs-operator">=</span> process.waitFor();
            <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> exitCode == <span class="hljs-number">0</span>;
            
            <span class="hljs-keyword">if</span> (success) {
                log.info(<span class="hljs-string">"FFmpegå®Œç¾æ”¶å·¥ï¼"</span>);
            } <span class="hljs-keyword">else</span> {
                log.error(<span class="hljs-string">"FFmpegç½¢å·¥äº†ï¼é€€å‡ºç ï¼š{}"</span>, exitCode);
            }
            
            <span class="hljs-keyword">return</span> success;
            
        } <span class="hljs-keyword">catch</span> (Exception e) {
            log.error(<span class="hljs-string">"FFmpegå´©æºƒäº†ï¼ŒåŸå› ï¼š{}"</span>, e.getMessage(), e);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    
    <span class="hljs-comment">/**
     * è·å–FFmpegç‰ˆæœ¬ï¼ˆéªŒæ˜æ­£èº«ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getVersion</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-type">Process</span> <span class="hljs-variable">process</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProcessBuilder</span>(ffmpegConfig.getPath(), <span class="hljs-string">"-version"</span>).start();
            <span class="hljs-type">BufferedReader</span> <span class="hljs-variable">reader</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BufferedReader</span>(
                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">InputStreamReader</span>(process.getInputStream()));
            <span class="hljs-keyword">return</span> reader.readLine(); <span class="hljs-comment">// ç¬¬ä¸€è¡Œå°±æ˜¯ç‰ˆæœ¬ä¿¡æ¯</span>
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">"FFmpegå¯èƒ½å»åº¦å‡äº†ï¼š"</span> + e.getMessage();
        }
    }
}
</code></pre>
<h3 data-id="heading-5">æ­¥éª¤4ï¼šåˆ›å»ºè§†é¢‘å¤„ç†æœåŠ¡ â€”â€” ä½ çš„ç§äººè§†é¢‘ç®¡å®¶</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;

<span class="hljs-keyword">import</span> java.io.File;
<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.nio.file.Files;
<span class="hljs-keyword">import</span> java.nio.file.Path;
<span class="hljs-keyword">import</span> java.nio.file.Paths;
<span class="hljs-keyword">import</span> java.util.Arrays;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.UUID;

<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoService</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> FFmpegCommander ffmpegCommander;
    
    <span class="hljs-comment">// ä¸´æ—¶æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼ˆåƒå¿«é€’çš„ä¸´æ—¶å­˜æ”¾ç‚¹ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TEMP_DIR</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">"java.io.tmpdir"</span>) + <span class="hljs-string">"/video-process/"</span>;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">VideoService</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ç¡®ä¿ä¸´æ—¶ç›®å½•å­˜åœ¨</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(TEMP_DIR).mkdirs();
    }
    
    <span class="hljs-comment">/**
     * è½¬æ¢è§†é¢‘æ ¼å¼ï¼ˆåƒæŠŠä¸­æ–‡ç¿»è¯‘æˆè‹±æ–‡ï¼‰
     * <span class="hljs-doctag">@param</span> inputFile è¾“å…¥æ–‡ä»¶
     * <span class="hljs-doctag">@param</span> targetFormat ç›®æ ‡æ ¼å¼ï¼ˆmp4, avi, mov...ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> File <span class="hljs-title function_">convertFormat</span><span class="hljs-params">(MultipartFile inputFile, String targetFormat)</span> <span class="hljs-keyword">throws</span> IOException {
        log.info(<span class="hljs-string">"å¼€å§‹æ ¼å¼è½¬æ¢ï¼š{} â†’ {}"</span>, 
                 getFileExtension(inputFile.getOriginalFilename()), 
                 targetFormat);
        
        <span class="hljs-comment">// 1. ä¿å­˜ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆåƒæŠŠé£Ÿæå…ˆæ”¾åˆ°å¨æˆ¿ï¼‰</span>
        <span class="hljs-type">File</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> saveTempFile(inputFile);
        
        <span class="hljs-comment">// 2. å‡†å¤‡è¾“å‡ºæ–‡ä»¶ï¼ˆå‡†å¤‡å¥½ç›˜å­ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">outputFileName</span> <span class="hljs-operator">=</span> UUID.randomUUID() + <span class="hljs-string">"."</span> + targetFormat;
        <span class="hljs-type">File</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(TEMP_DIR + outputFileName);
        
        <span class="hljs-comment">// 3. æ„å»ºFFmpegå‘½ä»¤èœå•</span>
        List&lt;String&gt; commands = Arrays.asList(
            <span class="hljs-string">"-i"</span>, input.getAbsolutePath(),     <span class="hljs-comment">// è¾“å…¥æ–‡ä»¶</span>
            <span class="hljs-string">"-threads"</span>, <span class="hljs-string">"4"</span>,                   <span class="hljs-comment">// ç”¨4ä¸ªçº¿ç¨‹</span>
            <span class="hljs-string">"-preset"</span>, <span class="hljs-string">"fast"</span>,                 <span class="hljs-comment">// å¿«é€Ÿé¢„è®¾</span>
            <span class="hljs-string">"-c:v"</span>, <span class="hljs-string">"libx264"</span>,                 <span class="hljs-comment">// è§†é¢‘ç¼–ç </span>
            <span class="hljs-string">"-c:a"</span>, <span class="hljs-string">"aac"</span>,                     <span class="hljs-comment">// éŸ³é¢‘ç¼–ç </span>
            <span class="hljs-string">"-y"</span>,                              <span class="hljs-comment">// è¦†ç›–è¾“å‡ºæ–‡ä»¶ï¼ˆåˆ«é—®æˆ‘æ˜¯å¦ç¡®å®šï¼‰</span>
            output.getAbsolutePath()           <span class="hljs-comment">// è¾“å‡ºæ–‡ä»¶</span>
        );
        
        <span class="hljs-comment">// 4. è®©FFmpegå¤§å¨å¼€å§‹çƒ¹é¥ª</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> ffmpegCommander.execute(commands);
        
        <span class="hljs-comment">// 5. æ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼ˆæ´—ç›˜å­ï¼‰</span>
        input.delete();
        
        <span class="hljs-keyword">if</span> (success &amp;&amp; output.exists()) {
            log.info(<span class="hljs-string">"æ ¼å¼è½¬æ¢æˆåŠŸï¼æ–‡ä»¶å¤§å°ï¼š{} MB"</span>, 
                     output.length() / (<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>));
            <span class="hljs-keyword">return</span> output;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è½¬æ¢å¤±è´¥ï¼ŒFFmpegå¯èƒ½å»åšç¾ç”²äº†"</span>);
        }
    }
    
    <span class="hljs-comment">/**
     * æå–è§†é¢‘ç¼©ç•¥å›¾ï¼ˆç»™è§†é¢‘æ‹è¯ä»¶ç…§ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> File <span class="hljs-title function_">extractThumbnail</span><span class="hljs-params">(MultipartFile videoFile, <span class="hljs-type">int</span> second)</span> <span class="hljs-keyword">throws</span> IOException {
        log.info(<span class="hljs-string">"æ­£åœ¨ç»™è§†é¢‘æ‹ç¬¬{}ç§’çš„è¯ä»¶ç…§..."</span>, second);
        
        <span class="hljs-type">File</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> saveTempFile(videoFile);
        <span class="hljs-type">String</span> <span class="hljs-variable">outputFileName</span> <span class="hljs-operator">=</span> UUID.randomUUID() + <span class="hljs-string">".jpg"</span>;
        <span class="hljs-type">File</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(TEMP_DIR + outputFileName);
        
        List&lt;String&gt; commands = Arrays.asList(
            <span class="hljs-string">"-i"</span>, input.getAbsolutePath(),
            <span class="hljs-string">"-ss"</span>, String.valueOf(second),    <span class="hljs-comment">// è·³è½¬åˆ°æŒ‡å®šç§’æ•°</span>
            <span class="hljs-string">"-vframes"</span>, <span class="hljs-string">"1"</span>,                  <span class="hljs-comment">// åªè¦1å¸§</span>
            <span class="hljs-string">"-vf"</span>, <span class="hljs-string">"scale=320:-1"</span>,           <span class="hljs-comment">// ç¼©æ”¾åˆ°å®½åº¦320ï¼Œé«˜åº¦è‡ªåŠ¨</span>
            <span class="hljs-string">"-y"</span>,
            output.getAbsolutePath()
        );
        
        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> ffmpegCommander.execute(commands);
        input.delete();
        
        <span class="hljs-keyword">if</span> (success &amp;&amp; output.exists()) {
            log.info(<span class="hljs-string">"ç¼©ç•¥å›¾ç”ŸæˆæˆåŠŸï¼"</span>);
            <span class="hljs-keyword">return</span> output;
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"æ‹ç…§å¤±è´¥ï¼Œè§†é¢‘å¯èƒ½å®³ç¾äº†"</span>);
    }
    
    <span class="hljs-comment">/**
     * å‹ç¼©è§†é¢‘ï¼ˆç»™è§†é¢‘å‡è‚¥ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> File <span class="hljs-title function_">compressVideo</span><span class="hljs-params">(MultipartFile videoFile, <span class="hljs-type">int</span> targetBitrate)</span> <span class="hljs-keyword">throws</span> IOException {
        log.info(<span class="hljs-string">"å¼€å§‹ç»™è§†é¢‘å‡è‚¥ï¼Œç›®æ ‡æ¯”ç‰¹ç‡ï¼š{}k"</span>, targetBitrate);
        
        <span class="hljs-type">File</span> <span class="hljs-variable">input</span> <span class="hljs-operator">=</span> saveTempFile(videoFile);
        <span class="hljs-type">long</span> <span class="hljs-variable">originalSize</span> <span class="hljs-operator">=</span> input.length();
        
        <span class="hljs-type">String</span> <span class="hljs-variable">outputFileName</span> <span class="hljs-operator">=</span> UUID.randomUUID() + <span class="hljs-string">"_compressed.mp4"</span>;
        <span class="hljs-type">File</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(TEMP_DIR + outputFileName);
        
        List&lt;String&gt; commands = Arrays.asList(
            <span class="hljs-string">"-i"</span>, input.getAbsolutePath(),
            <span class="hljs-string">"-threads"</span>, <span class="hljs-string">"4"</span>,
            <span class="hljs-string">"-b:v"</span>, targetBitrate + <span class="hljs-string">"k"</span>,      <span class="hljs-comment">// ç›®æ ‡è§†é¢‘æ¯”ç‰¹ç‡</span>
            <span class="hljs-string">"-b:a"</span>, <span class="hljs-string">"128k"</span>,                   <span class="hljs-comment">// éŸ³é¢‘æ¯”ç‰¹ç‡</span>
            <span class="hljs-string">"-y"</span>,
            output.getAbsolutePath()
        );
        
        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> ffmpegCommander.execute(commands);
        input.delete();
        
        <span class="hljs-keyword">if</span> (success &amp;&amp; output.exists()) {
            <span class="hljs-type">long</span> <span class="hljs-variable">compressedSize</span> <span class="hljs-operator">=</span> output.length();
            <span class="hljs-type">double</span> <span class="hljs-variable">ratio</span> <span class="hljs-operator">=</span> (<span class="hljs-number">1.0</span> - (<span class="hljs-type">double</span>)compressedSize/originalSize) * <span class="hljs-number">100</span>;
            log.info(<span class="hljs-string">"å‡è‚¥æˆåŠŸï¼åŸå¤§å°ï¼š{}MBï¼Œç°å¤§å°ï¼š{}MBï¼Œç˜¦èº«ï¼š{:.1f}%"</span>,
                     originalSize/(<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>),
                     compressedSize/(<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>),
                     ratio);
            <span class="hljs-keyword">return</span> output;
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"å‡è‚¥å¤±è´¥ï¼Œè§†é¢‘å¯èƒ½å·åƒå®µå¤œäº†"</span>);
    }
    
    <span class="hljs-comment">/**
     * åˆå¹¶è§†é¢‘å’ŒéŸ³é¢‘ï¼ˆåƒç»™ç”µå½±é…éŸ³ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> File <span class="hljs-title function_">mergeVideoAudio</span><span class="hljs-params">(MultipartFile videoFile, 
                                MultipartFile audioFile)</span> <span class="hljs-keyword">throws</span> IOException {
        log.info(<span class="hljs-string">"å¼€å§‹ç»™è§†é¢‘é…éŸ³..."</span>);
        
        <span class="hljs-type">File</span> <span class="hljs-variable">video</span> <span class="hljs-operator">=</span> saveTempFile(videoFile);
        <span class="hljs-type">File</span> <span class="hljs-variable">audio</span> <span class="hljs-operator">=</span> saveTempFile(audioFile);
        
        <span class="hljs-type">String</span> <span class="hljs-variable">outputFileName</span> <span class="hljs-operator">=</span> UUID.randomUUID() + <span class="hljs-string">"_merged.mp4"</span>;
        <span class="hljs-type">File</span> <span class="hljs-variable">output</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(TEMP_DIR + outputFileName);
        
        List&lt;String&gt; commands = Arrays.asList(
            <span class="hljs-string">"-i"</span>, video.getAbsolutePath(),
            <span class="hljs-string">"-i"</span>, audio.getAbsolutePath(),
            <span class="hljs-string">"-c:v"</span>, <span class="hljs-string">"copy"</span>,                   <span class="hljs-comment">// è§†é¢‘æµç›´æ¥å¤åˆ¶ï¼ˆä¸é‡æ–°ç¼–ç ï¼‰</span>
            <span class="hljs-string">"-c:a"</span>, <span class="hljs-string">"aac"</span>,                    <span class="hljs-comment">// éŸ³é¢‘é‡æ–°ç¼–ç </span>
            <span class="hljs-string">"-map"</span>, <span class="hljs-string">"0:v:0"</span>,                  <span class="hljs-comment">// å–ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„è§†é¢‘</span>
            <span class="hljs-string">"-map"</span>, <span class="hljs-string">"1:a:0"</span>,                  <span class="hljs-comment">// å–ç¬¬äºŒä¸ªæ–‡ä»¶çš„éŸ³é¢‘</span>
            <span class="hljs-string">"-shortest"</span>,                      <span class="hljs-comment">// ä»¥æœ€çŸ­çš„æµä¸ºå‡†</span>
            <span class="hljs-string">"-y"</span>,
            output.getAbsolutePath()
        );
        
        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> ffmpegCommander.execute(commands);
        video.delete();
        audio.delete();
        
        <span class="hljs-keyword">if</span> (success &amp;&amp; output.exists()) {
            log.info(<span class="hljs-string">"é…éŸ³æˆåŠŸï¼æ–°è§†é¢‘è¯ç”Ÿäº†"</span>);
            <span class="hljs-keyword">return</span> output;
        }
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"åˆå¹¶å¤±è´¥ï¼Œå¯èƒ½è§†é¢‘å’ŒéŸ³é¢‘åœ¨é—¹ç¦»å©š"</span>);
    }
    
    <span class="hljs-keyword">private</span> File <span class="hljs-title function_">saveTempFile</span><span class="hljs-params">(MultipartFile file)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> UUID.randomUUID() + <span class="hljs-string">"_"</span> + file.getOriginalFilename();
        <span class="hljs-type">Path</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> Paths.get(TEMP_DIR + fileName);
        Files.copy(file.getInputStream(), path);
        <span class="hljs-keyword">return</span> path.toFile();
    }
    
    <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getFileExtension</span><span class="hljs-params">(String filename)</span> {
        <span class="hljs-keyword">if</span> (filename == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"unknown"</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">dotIndex</span> <span class="hljs-operator">=</span> filename.lastIndexOf(<span class="hljs-string">'.'</span>);
        <span class="hljs-keyword">return</span> (dotIndex == -<span class="hljs-number">1</span>) ? <span class="hljs-string">""</span> : filename.substring(dotIndex + <span class="hljs-number">1</span>);
    }
}
</code></pre>
<h3 data-id="heading-6">æ­¥éª¤5ï¼šåˆ›å»ºæ§åˆ¶å™¨ â€”â€” è§†é¢‘å¤„ç†çš„æ¥å¾…å¤„</h3>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">lombok</span><span class="hljs-selector-class">.extern</span><span class="hljs-selector-class">.slf4j</span><span class="hljs-selector-class">.Slf4j</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.beans</span><span class="hljs-selector-class">.factory</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Autowired</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.FileSystemResource</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.Resource</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.http</span><span class="hljs-selector-class">.HttpHeaders</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.http</span><span class="hljs-selector-class">.MediaType</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.http</span><span class="hljs-selector-class">.ResponseEntity</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.multipart</span><span class="hljs-selector-class">.MultipartFile</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">javax</span><span class="hljs-selector-class">.servlet</span><span class="hljs-selector-class">.http</span><span class="hljs-selector-class">.HttpServletResponse</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.File</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.io</span><span class="hljs-selector-class">.IOException</span>;

@<span class="hljs-selector-tag">Slf4j</span>
@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/api/video"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">VideoController</span> {
    
    <span class="hljs-variable">@Autowired</span>
    private VideoService videoService;
    
    <span class="hljs-variable">@Autowired</span>
    private FFmpegCommander ffmpegCommander;
    
    <span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">"/version"</span>)
    public String <span class="hljs-built_in">getFFmpegVersion</span>() {
        <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">version</span> = <span class="hljs-selector-tag">ffmpegCommander</span><span class="hljs-selector-class">.getVersion</span>();
        <span class="hljs-selector-tag">return</span> "{\"<span class="hljs-selector-tag">version</span>\": \"" + <span class="hljs-selector-tag">version</span> + "\"}";
    }
    
    @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/convert"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">Resource</span>&gt; <span class="hljs-selector-tag">convertFormat</span>(
            <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"file"</span>) MultipartFile file,
            <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"format"</span>) String format,
            HttpServletResponse response) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">IOException</span> {
        
        <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"æ”¶åˆ°è½¬æ¢è¯·æ±‚ï¼š{} â†’ {}"</span>, file.<span class="hljs-built_in">getOriginalFilename</span>(), format);
        
        <span class="hljs-selector-tag">File</span> <span class="hljs-selector-tag">converted</span> = <span class="hljs-selector-tag">videoService</span><span class="hljs-selector-class">.convertFormat</span>(file, format);
        
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">buildFileResponse</span>(converted, 
                <span class="hljs-string">"converted."</span> + format, 
                MediaType.APPLICATION_OCTET_STREAM);
    }
    
    @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/thumbnail"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">Resource</span>&gt; <span class="hljs-selector-tag">extractThumbnail</span>(
            <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"file"</span>) MultipartFile file,
            <span class="hljs-variable">@RequestParam</span>(value = <span class="hljs-string">"second"</span>, defaultValue = <span class="hljs-string">"5"</span>) int second) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">IOException</span> {
        
        <span class="hljs-selector-tag">File</span> <span class="hljs-selector-tag">thumbnail</span> = <span class="hljs-selector-tag">videoService</span><span class="hljs-selector-class">.extractThumbnail</span>(file, second);
        
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">buildFileResponse</span>(thumbnail,
                <span class="hljs-string">"thumbnail.jpg"</span>,
                MediaType.IMAGE_JPEG);
    }
    
    @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/compress"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">Resource</span>&gt; <span class="hljs-selector-tag">compressVideo</span>(
            <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"file"</span>) MultipartFile file,
            <span class="hljs-variable">@RequestParam</span>(value = <span class="hljs-string">"bitrate"</span>, defaultValue = <span class="hljs-string">"1000"</span>) int bitrate) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">IOException</span> {
        
        <span class="hljs-selector-tag">File</span> <span class="hljs-selector-tag">compressed</span> = <span class="hljs-selector-tag">videoService</span><span class="hljs-selector-class">.compressVideo</span>(file, bitrate);
        
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">buildFileResponse</span>(compressed,
                <span class="hljs-string">"compressed.mp4"</span>,
                MediaType.APPLICATION_OCTET_STREAM);
    }
    
    @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/merge"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">Resource</span>&gt; <span class="hljs-selector-tag">mergeVideoAudio</span>(
            <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"video"</span>) MultipartFile video,
            <span class="hljs-variable">@RequestParam</span>(<span class="hljs-string">"audio"</span>) MultipartFile audio) <span class="hljs-selector-tag">throws</span> <span class="hljs-selector-tag">IOException</span> {
        
        <span class="hljs-selector-tag">File</span> <span class="hljs-selector-tag">merged</span> = <span class="hljs-selector-tag">videoService</span><span class="hljs-selector-class">.mergeVideoAudio</span>(video, audio);
        
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">buildFileResponse</span>(merged,
                <span class="hljs-string">"merged.mp4"</span>,
                MediaType.APPLICATION_OCTET_STREAM);
    }
    
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">ResponseEntity</span>&lt;<span class="hljs-selector-tag">Resource</span>&gt; <span class="hljs-selector-tag">buildFileResponse</span>(File file, 
                                                       String filename,
                                                       MediaType mediaType) {
        <span class="hljs-selector-tag">if</span> (!file.<span class="hljs-built_in">exists</span>()) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.notFound</span>()<span class="hljs-selector-class">.build</span>();
        }
        
        <span class="hljs-selector-tag">Resource</span> <span class="hljs-selector-tag">resource</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">FileSystemResource</span>(file);
        
        <span class="hljs-comment">// æ–‡ä»¶ä¸‹è½½å®Œæˆåè‡ªåŠ¨åˆ é™¤ï¼ˆæ·±è—åŠŸä¸åï¼‰</span>
        <span class="hljs-selector-tag">file</span><span class="hljs-selector-class">.deleteOnExit</span>();
        
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ResponseEntity</span><span class="hljs-selector-class">.ok</span>()
                <span class="hljs-selector-class">.header</span>(HttpHeaders.CONTENT_DISPOSITION, 
                        <span class="hljs-string">"attachment; filename=\"</span><span class="hljs-string">" + filename + "</span>\<span class="hljs-string">""</span>)
                <span class="hljs-selector-class">.contentType</span>(mediaType)
                <span class="hljs-selector-class">.contentLength</span>(file.<span class="hljs-built_in">length</span>())
                <span class="hljs-selector-class">.body</span>(resource);
    }
}
</code></pre>
<h3 data-id="heading-7">æ­¥éª¤6ï¼šæ·»åŠ å¼‚å¸¸å¤„ç† â€”â€” ç»™ç¨‹åºä¹°ä»½ä¿é™©</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> lombok.<span class="hljs-property">extern</span>.<span class="hljs-property">slf4j</span>.<span class="hljs-property">Slf4j</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">http</span>.<span class="hljs-property">HttpStatus</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">http</span>.<span class="hljs-property">ResponseEntity</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">bind</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">ExceptionHandler</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">bind</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">RestControllerAdvice</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">web</span>.<span class="hljs-property">multipart</span>.<span class="hljs-property">MaxUploadSizeExceededException</span>;

<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">HashMap</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Map</span>;

<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@RestControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {
    
    <span class="hljs-meta">@ExceptionHandler</span>(<span class="hljs-title class_">Exception</span>.<span class="hljs-property">class</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ResponseEntity</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt;&gt; <span class="hljs-title function_">handleException</span>(<span class="hljs-params">Exception e</span>) {
        log.<span class="hljs-title function_">error</span>(<span class="hljs-string">"ç³»ç»Ÿé—¹æƒ…ç»ªäº†ï¼š{}"</span>, e.<span class="hljs-title function_">getMessage</span>(), e);
        
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"success"</span>, <span class="hljs-literal">false</span>);
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"message"</span>, <span class="hljs-string">"æœåŠ¡å™¨å¼€å°å·®äº†ï¼Œå¯èƒ½æ˜¯FFmpegåœ¨å·æ‡’"</span>);
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"error"</span>, e.<span class="hljs-title function_">getMessage</span>());
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"timestamp"</span>, <span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>());
        
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ResponseEntity</span>.<span class="hljs-title function_">status</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">INTERNAL_SERVER_ERROR</span>)
                .<span class="hljs-title function_">body</span>(response);
    }
    
    <span class="hljs-meta">@ExceptionHandler</span>(<span class="hljs-title class_">MaxUploadSizeExceededException</span>.<span class="hljs-property">class</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ResponseEntity</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt;&gt; <span class="hljs-title function_">handleMaxSizeException</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"success"</span>, <span class="hljs-literal">false</span>);
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"message"</span>, <span class="hljs-string">"æ–‡ä»¶å¤ªå¤§äº†ï¼ŒæœåŠ¡å™¨æ‹¿ä¸åŠ¨äº†"</span>);
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"suggestion"</span>, <span class="hljs-string">"è¯·å°è¯•å‹ç¼©è§†é¢‘æˆ–ä¸Šä¼ å°ä¸€ç‚¹çš„æ–‡ä»¶"</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ResponseEntity</span>.<span class="hljs-title function_">status</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">PAYLOAD_TOO_LARGE</span>)
                .<span class="hljs-title function_">body</span>(response);
    }
    
    <span class="hljs-meta">@ExceptionHandler</span>(<span class="hljs-title class_">IOException</span>.<span class="hljs-property">class</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ResponseEntity</span>&lt;<span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt;&gt; <span class="hljs-title function_">handleIOException</span>(<span class="hljs-params">IOException e</span>) {
        <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"success"</span>, <span class="hljs-literal">false</span>);
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"message"</span>, <span class="hljs-string">"æ–‡ä»¶è¯»å†™å‡ºäº†é—®é¢˜ï¼Œå¯èƒ½æ˜¯ç£ç›˜åœ¨é—¹è„¾æ°”"</span>);
        response.<span class="hljs-title function_">put</span>(<span class="hljs-string">"error"</span>, e.<span class="hljs-title function_">getMessage</span>());
        
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">ResponseEntity</span>.<span class="hljs-title function_">status</span>(<span class="hljs-title class_">HttpStatus</span>.<span class="hljs-property">INTERNAL_SERVER_ERROR</span>)
                .<span class="hljs-title function_">body</span>(response);
    }
}
</code></pre>
<h2 data-id="heading-8">ç¬¬ä¸‰éƒ¨åˆ†ï¼šä½¿ç”¨ç¤ºä¾‹ â€”â€” è®©æˆ‘ä»¬æ¥å®é™…æ“ç»ƒä¸€ä¸‹</h2>
<h3 data-id="heading-9">1. å¯åŠ¨åº”ç”¨ç¨‹åº</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">SpringApplication</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">autoconfigure</span>.<span class="hljs-property">SpringBootApplication</span>;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoProcessingApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">VideoProcessingApplication</span>.<span class="hljs-property">class</span>, args);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"è§†é¢‘å¤„ç†æœåŠ¡å¯åŠ¨æˆåŠŸï¼"</span>);
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"FFmpegæ•´è£…å¾…å‘ï¼Œéšæ—¶å‡†å¤‡å¤„ç†ä½ çš„è§†é¢‘"</span>);
    }
}
</code></pre>
<h3 data-id="heading-10">2. æµ‹è¯•API</h3>
<p>ä½¿ç”¨Postmanæˆ–curlæµ‹è¯•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹FFmpegç‰ˆæœ¬</span>
curl http://localhost:8080/api/video/version

<span class="hljs-comment"># è½¬æ¢è§†é¢‘æ ¼å¼</span>
curl -X POST -F <span class="hljs-string">"file=@input.avi"</span> -F <span class="hljs-string">"format=mp4"</span> \
     http://localhost:8080/api/video/convert --output output.mp4

<span class="hljs-comment"># æå–ç¼©ç•¥å›¾</span>
curl -X POST -F <span class="hljs-string">"file=@video.mp4"</span> -F <span class="hljs-string">"second=10"</span> \
     http://localhost:8080/api/video/thumbnail --output thumbnail.jpg

<span class="hljs-comment"># å‹ç¼©è§†é¢‘</span>
curl -X POST -F <span class="hljs-string">"file=@large_video.mp4"</span> -F <span class="hljs-string">"bitrate=500"</span> \
     http://localhost:8080/api/video/compress --output compressed.mp4
</code></pre>
<h2 data-id="heading-11">ç¬¬å››éƒ¨åˆ†ï¼šé«˜çº§æŠ€å·§ â€”â€” è®©FFmpegæ›´æ‡‚ä½ </h2>
<h3 data-id="heading-12">1. æ·»åŠ è¿›åº¦ç›‘å¬ï¼ˆç»™è§†é¢‘å¤„ç†åŠ ä¸ªè¿›åº¦æ¡ï¼‰</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">public</span> interface ProgressListener {
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">onProgress</span><span class="hljs-params">(<span class="hljs-type">double</span> percentage, <span class="hljs-type">String</span> message)</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">onComplete</span><span class="hljs-params">(<span class="hljs-built_in">File</span> outputFile)</span></span>;
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">onError</span><span class="hljs-params">(<span class="hljs-type">String</span> error)</span></span>;
}

<span class="hljs-comment">// åœ¨FFmpegCommanderä¸­æ·»åŠ è¿›åº¦è§£æ</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">parseProgress</span><span class="hljs-params">(<span class="hljs-type">String</span> line, ProgressListener listener)</span> </span>{
    <span class="hljs-comment">// è§£æFFmpegçš„è¾“å‡ºï¼Œæå–è¿›åº¦ä¿¡æ¯</span>
    <span class="hljs-comment">// ç¤ºä¾‹è¾“å‡ºï¼šframe=  123 fps=25.1 time=00:00:04.92 bitrate= 512.0kbits/s</span>
    <span class="hljs-keyword">if</span> (line.<span class="hljs-built_in">contains</span>(<span class="hljs-string">"time="</span>)) {
        <span class="hljs-comment">// è¿™é‡Œå¯ä»¥è§£ææ—¶é—´ï¼Œè®¡ç®—è¿›åº¦ç™¾åˆ†æ¯”</span>
        <span class="hljs-comment">// å®é™…å®ç°éœ€è¦æ ¹æ®è§†é¢‘æ€»æ—¶é•¿è®¡ç®—</span>
    }
}
</code></pre>
<h3 data-id="heading-13">2. æ‰¹é‡å¤„ç†ï¼ˆä¸€æ¬¡å¤„ç†å¤šä¸ªæ–‡ä»¶ï¼‰</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> List&lt;File&gt; batchConvert(List&lt;MultipartFile&gt; files, String format) {
    <span class="hljs-keyword">return</span> files.parallelStream()  <span class="hljs-comment">// å¹¶è¡Œå¤„ç†ï¼Œæ›´å¿«ï¼</span>
            .map(file -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">return</span> videoService.convertFormat(file, format);
                } <span class="hljs-keyword">catch</span> (IOException e) {
                    log.error(<span class="hljs-string">"è½¬æ¢å¤±è´¥ï¼š{}"</span>, file.getOriginalFilename(), e);
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
                }
            })
            .filter(Objects::nonNull)
            .collect(Collectors.toList());
}
</code></pre>
<h3 data-id="heading-14">3. è§†é¢‘ä¿¡æ¯æå–ï¼ˆç»™è§†é¢‘åšä½“æ£€ï¼‰</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Object</span>&gt; <span class="hljs-title function_">getVideoInfo</span>(<span class="hljs-params">File videoFile</span>) {
    <span class="hljs-comment">// ä½¿ç”¨FFprobeï¼ˆFFmpegçš„å°ä¼™ä¼´ï¼‰è·å–è§†é¢‘ä¿¡æ¯</span>
    <span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; commands = <span class="hljs-title class_">Arrays</span>.<span class="hljs-title function_">asList</span>(
        <span class="hljs-string">"-v"</span>, <span class="hljs-string">"error"</span>,
        <span class="hljs-string">"-select_streams"</span>, <span class="hljs-string">"v:0"</span>,
        <span class="hljs-string">"-show_entries"</span>, <span class="hljs-string">"stream=width,height,duration,bit_rate,codec_name"</span>,
        <span class="hljs-string">"-of"</span>, <span class="hljs-string">"json"</span>,
        videoFile.<span class="hljs-title function_">getAbsolutePath</span>()
    );
    
    <span class="hljs-comment">// æ‰§è¡Œå‘½ä»¤å¹¶è§£æJSONç»“æœ</span>
    <span class="hljs-comment">// è¿”å›åŒ…å«åˆ†è¾¨ç‡ã€æ—¶é•¿ã€ç ç‡ã€ç¼–ç æ ¼å¼ç­‰ä¿¡æ¯</span>
}
</code></pre>
<h2 data-id="heading-15">ç¬¬äº”éƒ¨åˆ†ï¼šæ€»ç»“ä¸æ³¨æ„äº‹é¡¹</h2>
<h3 data-id="heading-16">æˆåŠŸæ•´åˆçš„ç§˜è¯€ï¼š</h3>
<ol>
<li>
<p><strong>æ­£ç¡®å®‰è£…FFmpeg</strong>ï¼šç¡®ä¿ç³»ç»ŸPATHä¸­æœ‰FFmpegï¼Œæˆ–è€…é…ç½®æ­£ç¡®çš„è·¯å¾„</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ£€æŸ¥å®‰è£…</span>
ffmpeg -version
</code></pre>
</li>
<li>
<p><strong>èµ„æºç®¡ç†</strong>ï¼š</p>
<ul>
<li>è§†é¢‘å¤„ç†å¾ˆåƒå†…å­˜ï¼Œè®°å¾—ç»™JVMè¶³å¤Ÿçš„å†…å­˜</li>
</ul>

<pre><code class="hljs">java -Xmx2g -jar your-application.jar
</code></pre>
<ul>
<li>åŠæ—¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼Œé˜²æ­¢ç£ç›˜è¢«æ’‘çˆ†</li>
</ul>
</li>
<li>
<p><strong>é”™è¯¯å¤„ç†</strong>ï¼š</p>
<ul>
<li>FFmpegå¯èƒ½ä¼šå› ä¸ºå„ç§åŸå› å¤±è´¥ï¼ˆä¸æ”¯æŒçš„æ ¼å¼ã€æŸåçš„æ–‡ä»¶ç­‰ï¼‰</li>
<li>æ·»åŠ é‡è¯•æœºåˆ¶å’Œè¯¦ç»†çš„æ—¥å¿—è®°å½•</li>
</ul>
</li>
<li>
<p><strong>å®‰å…¨æ€§</strong>ï¼š</p>
<ul>
<li>é™åˆ¶ä¸Šä¼ æ–‡ä»¶ç±»å‹å’Œå¤§å°</li>
<li>å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œä¸¥æ ¼éªŒè¯</li>
<li>é˜²æ­¢å‘½ä»¤æ³¨å…¥æ”»å‡»</li>
</ul>
</li>
</ol>
<h3 data-id="heading-17">å¯èƒ½é‡åˆ°çš„å‘ï¼š</h3>
<ol>
<li><strong>è·¨å¹³å°é—®é¢˜</strong>ï¼šWindowså’ŒLinuxä¸‹çš„è·¯å¾„å·®å¼‚</li>
<li><strong>ç¼–ç é—®é¢˜</strong>ï¼šä¸­æ–‡å­—ç¬¦åœ¨å‘½ä»¤ä¸­å¯èƒ½éœ€è¦ç‰¹æ®Šå¤„ç†</li>
<li><strong>æƒé™é—®é¢˜</strong>ï¼šç¡®ä¿åº”ç”¨æœ‰æ‰§è¡ŒFFmpegçš„æƒé™</li>
<li><strong>æ€§èƒ½é—®é¢˜</strong>ï¼šå¤§æ–‡ä»¶å¤„ç†å¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œè€ƒè™‘å¼‚æ­¥å¤„ç†</li>
</ol>
<h3 data-id="heading-18">ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªæ–¹æ¡ˆï¼Ÿ</h3>
<ol>
<li><strong>çµæ´»æ€§å¼º</strong>ï¼šå¯ä»¥æ‰§è¡Œä»»ä½•FFmpegæ”¯æŒçš„æ“ä½œ</li>
<li><strong>åŠŸèƒ½å…¨é¢</strong>ï¼šè§†é¢‘å¤„ç†ç•Œçš„"ç‘å£«å†›åˆ€"</li>
<li><strong>ç¤¾åŒºæ”¯æŒå¥½</strong>ï¼šé‡åˆ°é—®é¢˜å®¹æ˜“æ‰¾åˆ°è§£å†³æ–¹æ¡ˆ</li>
<li><strong>å…è´¹å¼€æº</strong>ï¼šçœé’±åˆçœå¿ƒ</li>
</ol>
<h3 data-id="heading-19">æœ€åï¼š</h3>
<p>FFmpegå°±åƒä¸€æŠŠå¼ºå¤§çš„ç”µé”¯â€”â€”åŠŸèƒ½å¼ºå¤§ä½†éœ€è¦å°å¿ƒä½¿ç”¨ã€‚ä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒç›´æ¥è¿è¡Œæœªç»éªŒè¯çš„å‘½ä»¤ï¼Œå¦åˆ™å¯èƒ½ä¼šï¼š</p>
<ol>
<li>æŠŠæœåŠ¡å™¨CPUçƒ§å¾—åƒçƒ¤çº¢è–¯</li>
<li>è®©ç£ç›˜ç©ºé—´æ¶ˆå¤±å¾—æ¯”é’±åŒ…é‡Œçš„é’±è¿˜å¿«</li>
<li>äº§ç”Ÿä¸€å †è®©ä½ æ€€ç–‘äººç”Ÿçš„ä¸´æ—¶æ–‡ä»¶</li>
</ol>
<p>ä½†åªè¦ä½ æŒ‰ç…§æœ¬æ–‡çš„æ­¥éª¤ï¼Œåƒå¯¹å¾…ä¸€åªæ¸©é¡ºçš„çŒ«ä¸€æ ·å¯¹å¾…FFmpegï¼Œå®ƒå°±ä¼šæˆä¸ºä½ åœ¨è§†é¢‘å¤„ç†é¢†åŸŸæœ€å¾—åŠ›çš„åŠ©æ‰‹ï¼</p>
<p><strong>ç¥ä½ çš„è§†é¢‘å¤„ç†ä¹‹è·¯é¡ºç•…æ— æ¯”ï¼Œå°±åƒFFmpegå¤„ç†ä¸€ä¸ª10ç§’çš„GIFä¸€æ ·è½»æ¾ï¼</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/439d7cfcd4404bcdabeaf0c778a83f85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oKf56m656CB5a2X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768186058&amp;x-signature=ln7h9WWtQawob%2FHB4QvOAiUnv5c%3D" alt="SpringBootæ•´åˆFFmpegï¼Œæ‰“é€ ä½ çš„ä¸“å±è§†é¢‘å¤„ç†å·¥å‚.png" loading="lazy"/></p>
<p><strong>è°¢è°¢ä½ çœ‹æˆ‘çš„æ–‡ç« ï¼Œæ—¢ç„¶çœ‹åˆ°è¿™é‡Œäº†ï¼Œå¦‚æœè§‰å¾—ä¸é”™ï¼Œéšæ‰‹ç‚¹ä¸ªèµã€è½¬å‘ã€åœ¨çœ‹ä¸‰è¿å§ï¼Œæ„Ÿè°¢æ„Ÿè°¢ã€‚é‚£æˆ‘ä»¬ï¼Œä¸‹æ¬¡å†è§ã€‚</strong></p>
<p>æ‚¨çš„ä¸€é”®ä¸‰è¿ï¼Œæ˜¯æˆ‘æ›´æ–°çš„æœ€å¤§åŠ¨åŠ›ï¼Œè°¢è°¢</p>
<p>å±±æ°´æœ‰ç›¸é€¢ï¼Œæ¥æ—¥çš†å¯æœŸï¼Œè°¢è°¢é˜…è¯»ï¼Œæˆ‘ä»¬å†ä¼š</p>
<p>æˆ‘æ‰‹ä¸­çš„é‡‘ç®æ£’ï¼Œä¸Šèƒ½é€šå¤©ï¼Œä¸‹èƒ½æ¢æµ·</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 nodejs å‘ç”Ÿå“ªäº›é‡å¤§æ”¹å˜ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7591348605865820195</link>    <guid>https://juejin.cn/post/7591348605865820195</guid>    <pubDate>2026-01-04T14:59:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591348605865820195" data-draft-id="7591350620188966918" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 nodejs å‘ç”Ÿå“ªäº›é‡å¤§æ”¹å˜ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-04T14:59:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ˜æœˆ_æ¸…é£"/> <meta itemprop="url" content="https://juejin.cn/user/1081575170131006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 nodejs å‘ç”Ÿå“ªäº›é‡å¤§æ”¹å˜ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1081575170131006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ˜æœˆ_æ¸…é£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T14:59:17.000Z" title="Sun Jan 04 2026 14:59:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025å¹´è¢«ç¤¾åŒºç§°ä¸º Node.js çš„â€œç°ä»£åŒ–å…ƒå¹´â€ã€‚åœ¨è¿™ä¸€å¹´ï¼ŒNode.js å®Œæˆäº†ä»â€œéœ€è¦å¤§é‡é…ç½®çš„å·¥å…·â€åˆ°â€œåŸç”Ÿå…¨èƒ½è¿è¡Œæ—¶â€çš„åä¸½è½¬èº«ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ 2025 å¹´ Node.js å‘ç”Ÿçš„å››é¡¹è¶³ä»¥æ”¹å˜ä½ å¼€å‘ä¹ æƒ¯çš„é‡å¤§å˜é©ï¼š</p>
<hr/>
<h3 data-id="heading-0">1. åŸç”Ÿæ”¯æŒ TypeScript (Native TS Execution)</h3>
<p>è¿™æ˜¯ 2025 å¹´æœ€å—å‰ç«¯æ¬¢è¿çš„æ”¹å˜ã€‚</p>
<ul>
<li><strong>ä¸å†éœ€è¦ç¼–è¯‘ï¼š</strong> ä» Node.js 22.6/23 ç‰ˆæœ¬å¼€å§‹ï¼ŒNode å†…ç½®äº†â€œç±»å‹å‰¥ç¦»ï¼ˆType Strippingï¼‰â€åŠŸèƒ½ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ç›´æ¥è¿è¡Œ <code>node index.ts</code>ï¼ŒNode ä¼šåœ¨æ‰§è¡Œå‰è‡ªåŠ¨ç§»é™¤ç±»å‹å®šä¹‰ï¼Œè€Œæ— éœ€å®‰è£… <code>ts-node</code>ã€<code>tsx</code> æˆ–é…ç½®ç¹ççš„ <code>tsconfig.js</code>ã€‚</li>
<li><strong>å¼€å‘ä½“éªŒï¼š</strong> é…åˆ Node è‡ªå¸¦çš„ <code>--watch</code> æ¨¡å¼ï¼Œå‰ç«¯è„šæœ¬çš„å¼€å‘æµç¨‹å˜å¾—åƒå†™åŸç”Ÿ JS ä¸€æ ·å¿«ï¼Œå·¥ç¨‹é“¾è·¯æå…¶ç®€åŒ–ã€‚</li>
</ul>
<h3 data-id="heading-1">2. CommonJS ä¸ ESM çš„â€œä¸–çºªå¤§å’Œè§£â€ (<code>require(esm)</code>)</h3>
<p>å›°æ‰°å‰ç«¯å¤šå¹´çš„ <code>ERR_REQUIRE_ESM</code> æŠ¥é”™åœ¨ 2025 å¹´æ­£å¼æˆä¸ºå†å²ã€‚</p>
<ul>
<li><strong>åŒæ­¥åŠ è½½ï¼š</strong> Node.js å®ç°äº†åŒæ­¥çš„ <code>require(esm)</code>ã€‚ç°åœ¨ï¼Œä½ å¯ä»¥åœ¨æ—§çš„ CommonJS é¡¹ç›®ä¸­ç›´æ¥ <code>require</code> ä¸€ä¸ªçº¯ ESM çš„ç¬¬ä¸‰æ–¹åŒ…ã€‚</li>
<li><strong>åº“ç»´æŠ¤è€…çš„è§£è„±ï¼š</strong> å¹¿å¤§ npm åŒ…ä½œè€…ç»ˆäºä¸éœ€è¦è´¹åŠ²å¿ƒæ€å‘å¸ƒâ€œåŒæ¨¡å—ï¼ˆDual Buildï¼‰â€ç‰ˆæœ¬äº†ï¼Œè¿™æå¤§åœ°åŠ é€Ÿäº†å‰ç«¯ç”Ÿæ€å‘çº¯ ESM è¿ç§»çš„è¿›åº¦ã€‚</li>
</ul>
<h3 data-id="heading-2">3. å®‰å…¨æƒé™æ¨¡å‹æ­£å¼ç¨³å®š (Permission Model)</h3>
<p>Node.js å€Ÿé‰´äº† Deno çš„å®‰å…¨ç†å¿µï¼Œå¼•å…¥äº†<strong>å®éªŒæ€§è½¬ç¨³å®š</strong>çš„æƒé™æ§åˆ¶ç³»ç»Ÿã€‚</p>
<ul>
<li><strong>ç²¾å‡†é™åˆ¶ï¼š</strong> ä½ ç°åœ¨å¯ä»¥ä½¿ç”¨ <code>--allow-fs-read</code>ã€<code>--allow-net</code> ç­‰å‘½ä»¤è¡Œæ ‡å¿—æ¥è¿è¡Œç¨‹åºã€‚</li>
<li><strong>é˜²èŒƒä¾›åº”é“¾æ”»å‡»ï¼š</strong> æ¯”å¦‚è¿è¡Œä¸€ä¸ªä¸å¯ä¿¡çš„ npm è„šæœ¬æ—¶ï¼Œä½ å¯ä»¥é™åˆ¶å®ƒâ€œåªå…è®¸è¯»å– <code>./src</code> ç›®å½•ï¼Œç¦æ­¢è®¿é—®ç½‘ç»œâ€ã€‚å³ä¾¿åŒ…é‡Œæœ‰æ¶æ„ä»£ç ï¼Œä¹Ÿæ— æ³•å·å·ä¸Šä¼ ä½ çš„ <code>.env</code> æ•æ„Ÿæ–‡ä»¶ã€‚</li>
</ul>
<h3 data-id="heading-3">4. æ·±åº¦å¯¹é½ Web æ ‡å‡†ä¸å†…ç½®å†…ç½®æ•°æ®åº“</h3>
<p>Node.js è¶Šæ¥è¶Šåƒæµè§ˆå™¨ï¼Œä¹Ÿè¶Šæ¥è¶Šåƒä¸€ä¸ªå®Œæ•´çš„å¹³å°ã€‚</p>
<ul>
<li><strong>Web Storage å…¥é©»ï¼š</strong> Node.js 25 é»˜è®¤å¯ç”¨äº† <code>localStorage</code> å’Œ <code>sessionStorage</code>ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨æœåŠ¡ç«¯ç›´æ¥ä½¿ç”¨å’Œæµè§ˆå™¨ä¸€æ¨¡ä¸€æ ·çš„ API æ¥åšæ•°æ®æŒä¹…åŒ–ï¼ŒSSRï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰çš„ä»£ç å¤ç”¨ç‡å¤§å¹…æå‡ã€‚</li>
<li><strong>å†…ç½® SQLiteï¼š</strong> Node.js ç°åœ¨å†…ç½®äº† <code>node:sqlite</code> æ¨¡å—ã€‚å¯¹äºå°å‹åº”ç”¨æˆ–æœ¬åœ°å·¥å…·ï¼Œä½ ä¸å†éœ€è¦å®‰è£…è‡ƒè‚¿çš„ <code>sqlite3</code> é©±åŠ¨ï¼Œç›´æ¥è°ƒç”¨åŸç”Ÿçš„é«˜æ€§èƒ½æ•°æ®åº“æ¥å£ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-4">æ€»ç»“ï¼š2025 å¹´ç»™å‰ç«¯å¸¦æ¥çš„å˜åŒ–</h3>






























<table><thead><tr><th><strong>æ”¹å˜ç‚¹</strong></th><th><strong>è¿‡å» (2024ä»¥å‰)</strong></th><th><strong>ç°åœ¨ (2025/2026)</strong></th></tr></thead><tbody><tr><td><strong>TS å¼€å‘</strong></td><td>é…ç½® <code>esbuild</code> / <code>swc</code> / <code>tsx</code></td><td><strong>ç›´æ¥è¿è¡Œ <code>node file.ts</code></strong></td></tr><tr><td><strong>æ¨¡å—å†²çª</strong></td><td><code>require</code> åŠ è½½ ESM æŠ¥é”™</td><td><strong><code>require</code> å®Œç¾å…¼å®¹ ESM</strong></td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td>é»˜è®¤å…¨æƒé™ï¼ˆä¸å®‰å…¨ï¼‰</td><td><strong>æ˜¾å¼æƒé™æ§åˆ¶ (<code>--allow-*)</code></strong></td></tr><tr><td><strong>æœ¬åœ°å­˜å‚¨</strong></td><td>å¯»æ‰¾ç¬¬ä¸‰æ–¹ File DB åº“</td><td><strong>å†…ç½® SQLite &amp; localStorage</strong></td></tr></tbody></table>
<p><strong>ä½œä¸ºå‰ç«¯ï¼Œä½ æ˜¯å¦å·²ç»åŒå€¦äº†å„ç§æ‰“åŒ…å·¥å…·çš„é…ç½®ï¼Ÿ</strong> æ—¢ç„¶ Node.js å·²ç»å†…ç½®äº† TS æ”¯æŒå’ŒåŸç”Ÿ Web APIï¼Œæˆ‘å¯ä»¥æ•™ä½ å¦‚ä½•è„±ç¦»æ„å»ºå·¥å…·ï¼Œç›´æ¥ç”¨â€œåŸç”Ÿ Nodeâ€å†™ä¸€ä¸ªé«˜æ€§èƒ½çš„è‡ªåŠ¨åŒ–è„šæœ¬ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3-å¼‚æ­¥ç»„ä»¶ && suspense]]></title>    <link>https://juejin.cn/post/7591346773827715098</link>    <guid>https://juejin.cn/post/7591346773827715098</guid>    <pubDate>2026-01-04T12:31:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591346773827715098" data-draft-id="7591334208997261338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3-å¼‚æ­¥ç»„ä»¶ &amp;&amp; suspense"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js"/> <meta itemprop="datePublished" content="2026-01-04T12:31:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="YaeZed"/> <meta itemprop="url" content="https://juejin.cn/user/3977350021390107"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3-å¼‚æ­¥ç»„ä»¶ &amp;&amp; suspense
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3977350021390107/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    YaeZed
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T12:31:46.000Z" title="Sun Jan 04 2026 12:31:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="gml">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#222;color:silver}.hljs-keyword{color:#ffb871;font-weight:700}.hljs-built_in{color:#ffb871}.hljs-literal{color:#ff8080}.hljs-symbol{color:#58e55a}.hljs-comment{color:#5b995b}.hljs-string{color:#ff0}.hljs-number{color:#ff8080}.hljs-addition,.hljs-attribute,.hljs-bullet,.hljs-code,.hljs-deletion,.hljs-doctag,.hljs-function,.hljs-link,.hljs-meta,.hljs-meta-keyword,.hljs-name,.hljs-quote,.hljs-regexp,.hljs-section,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:silver}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>å¼‚æ­¥ç»„ä»¶</strong>ï¼ˆAsync Componentsï¼‰ä¹Ÿç§°ä¸º<strong>æ‡’åŠ è½½ç»„ä»¶</strong>ï¼ˆLazy-loaded Componentsï¼‰ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒWebpack æˆ– Vite ç­‰æ„å»ºå·¥å…·ä¼šæŠŠä½ æ‰€æœ‰çš„ç»„ä»¶æ‰“åŒ…åˆ°ä¸€ä¸ªï¼ˆæˆ–å‡ ä¸ªï¼‰JavaScript æ–‡ä»¶ä¸­ã€‚å½“ç”¨æˆ·è®¿é—®ä½ çš„ç½‘ç«™æ—¶ï¼Œä»–ä»¬å¿…é¡»ä¸€æ¬¡æ€§ä¸‹è½½æ‰€æœ‰ä»£ç ï¼Œè¿™å¯èƒ½å¯¼è‡´åˆå§‹åŠ è½½æ—¶é—´å¾ˆé•¿ã€‚</p>
<p>å¼‚æ­¥ç»„ä»¶å…è®¸ä½ å°†æŸäº›ç»„ä»¶ï¼ˆé€šå¸¸æ˜¯â€œé‡é‡çº§â€æˆ–ä¸æ€»æ˜¯éœ€è¦ç«‹å³æ˜¾ç¤ºçš„ç»„ä»¶ï¼‰åˆ†ç¦»æˆ<strong>å•ç‹¬çš„ JavaScript æ–‡ä»¶ï¼ˆchunkï¼‰</strong> ã€‚è¿™äº›æ–‡ä»¶åªä¼šåœ¨<strong>å®é™…éœ€è¦æ¸²æŸ“è¯¥ç»„ä»¶æ—¶</strong>æ‰ä»æœåŠ¡å™¨ä¸‹è½½ã€‚</p>
<p><strong>ä¸»è¦å¥½å¤„ï¼š</strong></p>
<ul>
<li><strong>ä»£ç åˆ†å‰² (Code-splitting)ï¼š</strong> å‡å°åˆå§‹åŒ…çš„ä½“ç§¯ã€‚</li>
<li><strong>æå‡æ€§èƒ½ï¼š</strong> åŠ å¿«åº”ç”¨çš„åˆå§‹åŠ è½½å’Œæ¸²æŸ“é€Ÿåº¦ã€‚</li>
</ul>
<h2 data-id="heading-0">1.åœ¨ Vue 3 ä¸­, ä½¿ç”¨ <code>defineAsyncComponent</code> å‡½æ•°æ¥åˆ›å»ºå¼‚æ­¥ç»„ä»¶</h2>
<p>ä¸¾ä¸ªæ —å­ï¼Œéª¨æ¶å±ï¼Œå‡†å¤‡ä¸¤ä¸ªç»„ä»¶ï¼Œcardå’Œskeleton</p>
<blockquote>
<p>card.vue</p>
</blockquote>
<pre><code class="hljs language-ts" lang="ts">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-info"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"user.avatar"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"avatar"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-name"</span>&gt;</span>{{ user.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ user.content }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
interface <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: number;
  <span class="hljs-attr">name</span>: string;
  <span class="hljs-attr">avatar</span>: string;
  <span class="hljs-attr">content</span>: string;
}

<span class="hljs-keyword">const</span> user = ref&lt;<span class="hljs-title class_">User</span>&gt;({
  <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">"YaeZed"</span>,
  <span class="hljs-attr">avatar</span>: <span class="hljs-string">"https://avatars.githubusercontent.com/u/52018740?v=5"</span>,
  <span class="hljs-attr">content</span>: <span class="hljs-string">"Hello, Vue3!"</span>,
});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>);
}

<span class="hljs-selector-class">.user-info</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: row;
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
}

<span class="hljs-selector-tag">img</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">150px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">150px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.user-name</span> {
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">30px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-class">.content</span> {
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">10px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>

</span></code></pre>
<blockquote>
<p>skeleton.vue</p>
</blockquote>
<pre><code class="hljs language-ts" lang="ts">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-info"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">""</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">""</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-name"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">2px</span> <span class="hljs-number">2px</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.3</span>);
}

<span class="hljs-selector-class">.user-info</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">flex-direction</span>: row;
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">align-items</span>: center;
}

<span class="hljs-selector-tag">img</span> {
  <span class="hljs-attribute">background-color</span>: bisque;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">150px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">150px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">100px</span>;
}

<span class="hljs-selector-class">.user-name</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">70px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">background-color</span>: bisque;
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">30px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">24px</span>;
  <span class="hljs-attribute">font-weight</span>: bold;
}

<span class="hljs-selector-class">.content</span> {
  <span class="hljs-attribute">background-color</span>: beige;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">120px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>ç»“åˆä½¿ç”¨å¼‚æ­¥ç»„ä»¶å’Œ Suspense</p>
<blockquote>
<p>åœ¨<code>App.vue</code>ä¸­ ï¼Œä½¿ç”¨ <code>Suspense</code> æ¥åŠ è½½ <code>card.vue</code>ï¼ˆä½œä¸ºå¼‚æ­¥ç»„ä»¶ï¼‰ï¼Œå¹¶åœ¨åŠ è½½æ—¶æ˜¾ç¤º <code>skeleton.vue</code></p>
</blockquote>
<pre><code class="hljs language-ts" lang="ts">&lt;template&gt;
 <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>åº”ç”¨<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>ä¸‹é¢çš„å¡ç‰‡æ˜¯å¼‚æ­¥åŠ è½½çš„...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>

   <span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span>&gt;</span>

     <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">AsyncUserCard</span> /&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

     <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">fallback</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">CardSkeleton</span> /&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

   <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// å¯¼å…¥ defineAsyncComponent æ¥åˆ›å»ºå¼‚æ­¥ç»„ä»¶</span>
<span class="hljs-keyword">import</span> { defineAsyncComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;

<span class="hljs-comment">// 1. åŒæ­¥å¯¼å…¥éª¨æ¶å±</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// "fallback" å†…å®¹å¿…é¡»æ˜¯ç«‹å³ï¼ˆåŒæ­¥ï¼‰å¯ç”¨çš„ï¼Œ</span>
<span class="hljs-comment">// æ‰€ä»¥æˆ‘ä»¬åƒå¹³å¸¸ä¸€æ ·å¯¼å…¥ skeleton.vueã€‚</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CardSkeleton</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./skeleton.vue'</span>;

<span class="hljs-comment">// 2. å¼‚æ­¥å¯¼å…¥ä½ çš„å¡ç‰‡ç»„ä»¶</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// æˆ‘ä»¬ä½¿ç”¨ `defineAsyncComponent` æ¥â€œåŒ…è£…â€ä½ çš„ card.vueã€‚</span>
<span class="hljs-comment">// è¿™å‘Šè¯‰ Vue è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ï¼Œåº”è¯¥æ‡’åŠ è½½ã€‚</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncUserCard</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> 
 <span class="hljs-keyword">import</span>(<span class="hljs-string">'./card.vue'</span>)
);


<span class="hljs-comment">// ----------------------------------------------------</span>
<span class="hljs-comment">// ğŸ’¡ (å¯é€‰) å¦‚ä½•åœ¨æœ¬åœ°æµ‹è¯•éª¨æ¶å±:</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// åœ¨æœ¬åœ°å¼€å‘ä¸­ï¼Œ`card.vue` åŠ è½½å¾—å¤ªå¿«ï¼Œä½ å¯èƒ½</span>
<span class="hljs-comment">// çœ‹ä¸åˆ°éª¨æ¶å±ã€‚ä½ å¯ä»¥åƒè¿™æ ·æ¨¡æ‹Ÿä¸€ä¸ª 2 ç§’çš„ç½‘ç»œå»¶è¿Ÿï¼š</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">// const AsyncUserCard = defineAsyncComponent(() =&gt; {</span>
<span class="hljs-comment">//   return new Promise(resolve =&gt; {</span>
<span class="hljs-comment">//     setTimeout(() =&gt; {</span>
<span class="hljs-comment">//       // @ts-ignore</span>
<span class="hljs-comment">//       resolve(import('./card.vue'));</span>
<span class="hljs-comment">//     }, 2000); // å»¶è¿Ÿ 2 ç§’</span>
<span class="hljs-comment">//   });</span>
<span class="hljs-comment">// });</span>
<span class="hljs-comment">// ----------------------------------------------------</span>

</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
<span class="hljs-comment">/* ä¸€äº›å…¨å±€æ ·å¼ */</span>
<span class="hljs-selector-tag">body</span> {
 <span class="hljs-attribute">font-family</span>: sans-serif;
 <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<h4 data-id="heading-1">æµç¨‹</h4>
<ul>
<li>
<p>ç”¨æˆ·åŠ è½½ <code>App.vue</code>ã€‚</p>
</li>
<li>
<p><code>Suspense</code> å¼€å§‹æ¸²æŸ“ã€‚å®ƒå°è¯•æ¸²æŸ“ <code>#default</code> æ’æ§½ã€‚</p>
</li>
<li>
<p>å®ƒå‘ç° <code>#default</code> é‡Œçš„ <code>AsyncUserCard</code> æ˜¯ä¸€ä¸ªå¼‚æ­¥ç»„ä»¶ï¼Œå¹¶ä¸”å°šæœªåŠ è½½ã€‚</p>
</li>
<li>
<p><code>Suspense</code> ç«‹å³åˆ‡æ¢åˆ°æ¸²æŸ“ <code>#fallback</code> æ’æ§½ï¼Œæ˜¾ç¤º <code>CardSkeleton</code>ã€‚</p>
</li>
<li>
<p>åŒæ—¶ï¼ŒVue åœ¨åå°å¼€å§‹ä¸‹è½½ <code>card.vue</code> å¯¹åº”çš„ JavaScript æ–‡ä»¶ã€‚</p>
</li>
<li>
<p>ä¸‹è½½å’Œè§£æå®Œæˆåï¼Œ<code>Suspense</code> è‡ªåŠ¨ç”¨ <code>AsyncUserCard</code> çš„å†…å®¹æ›¿æ¢æ‰ <code>CardSkeleton</code>ã€‚</p>
</li>
</ul>
<h2 data-id="heading-2">2.å¦ä¸€ç§è§¦å‘ Suspense çš„æ–¹å¼ï¼š<code>async setup</code></h2>
<p>ä¿®æ”¹ä¸€ä¸‹<code>card.vue</code></p>
<pre><code class="hljs language-ts" lang="ts">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-info"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"user.avatar"</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">"avatar"</span> /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user-name"</span>&gt;</span>{{ user.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">hr</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{{ user.content }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref } from "vue";
interface User {
  id: number;
  name: string;
  avatar: string;
  content: string;
}

// 1. æ¨¡æ‹Ÿä¸€ä¸ªå¼‚æ­¥æ•°æ®è·å– (ä¾‹å¦‚ API è°ƒç”¨)
const fetchUserData = (): Promise&lt;User&gt; =&gt; {
  return new Promise(resolve =&gt; {
    setTimeout(() =&gt; {
      console.log("æ•°æ®è·å–å®Œæˆ!");
      resolve({
        id: 1,
        name: "YaeZed (æ¥è‡ª API)",
        avatar: "https://avatars.githubusercontent.com/u/52018740?v=4",
        content: "Hello, from async setup!",
      });
    }, 2000); // æ¨¡æ‹Ÿ 2 ç§’çš„ API è°ƒç”¨
  });
};

// 2. åœ¨ &lt;script setup&gt; é¡¶å±‚ä½¿ç”¨ await
//
// Vue ä¼šè‡ªåŠ¨å°† `setup` å˜ä¸º `async setup`ã€‚
// `Suspense` å°†ä¼šç­‰å¾…è¿™ä¸ª `await` (fetchUserData) å®Œæˆã€‚
const user = ref&lt;User&gt;(await fetchUserData());

&lt;/script&gt;

&lt;style scoped&gt;
/* æ ·å¼ä¸å˜ */
.card {
  width: 300px;
  height: 300px;
  box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3);
}

.user-info {
  display: flex;
  flex-direction: row;
  text-align: center;
  align-items: center;
}

img {
  width: 150px;
  height: 150px;
  border-radius: 100px;
}

.user-name {
  margin-left: 30px;
  font-size: 24px;
  font-weight: bold;
}

.content {
  margin-left: 10px;
}
&lt;/style&gt;
</code></pre>
<p>ç°åœ¨ï¼Œ<code>card.vue</code> è‡ªèº«åŒ…å«äº†ä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚<code>App.vue</code> å¯ä»¥è¿™æ ·å†™ï¼š</p>
<pre><code class="hljs language-ts" lang="ts">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Suspense</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">default</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">UserCard</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">fallback</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CardSkeleton</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">Suspense</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// è¿™æ¬¡å¯ä»¥åŒæ­¥å¯¼å…¥ card</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UserCard</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./card.vue'</span>; 
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CardSkeleton</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./skeleton.vue'</span>;
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œ<strong>åŒæ­¥å¯¼å…¥</strong>äº† <code>UserCard</code>ï¼Œä½†å› ä¸º <code>UserCard</code> å†…éƒ¨æœ‰ <code>async setup</code>ï¼Œ<code>Suspense</code> ä»ç„¶ä¼šæ•è·è¿™ä¸ªå¼‚æ­¥çŠ¶æ€ï¼Œå¹¶åœ¨ <code>await fetchUserData()</code> å®Œæˆä¹‹å‰æ˜¾ç¤º <code>CardSkeleton</code>ã€‚</p>
<h2 data-id="heading-3">3.å¤„ç†åŠ è½½å¤±è´¥</h2>
<p>å¼‚æ­¥ç»„ä»¶åœ¨ç½‘ç»œä¸ç¨³å®šæˆ–èµ„æºä¸å­˜åœ¨æ—¶å¯èƒ½ä¼šåŠ è½½å¤±è´¥ã€‚ä¸ºäº†é˜²æ­¢æ•´ä¸ªé¡µé¢å´©æºƒï¼Œé€šå¸¸ä¼šé…åˆ Vue çš„ <code>onErrorCaptured</code> é’©å­æˆ–ä¸“é—¨çš„â€œé”™è¯¯è¾¹ç•Œâ€ç»„ä»¶æ¥å¤„ç†å¼‚å¸¸ã€‚</p>
<p>å¯ä»¥é€šè¿‡ <code>defineAsyncComponent</code> çš„é«˜çº§é…ç½®é¡¹æ¥å¤„ç†è¶…æ—¶æˆ–åŠ è½½å¤±è´¥çš„æƒ…å†µï¼š</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">const</span> <span class="hljs-title class_">AsyncUserCard</span> = <span class="hljs-title function_">defineAsyncComponent</span>({
  <span class="hljs-attr">loader</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./card.vue'</span>),
  <span class="hljs-comment">// åŠ è½½å¼‚æ­¥ç»„ä»¶æ—¶ä½¿ç”¨çš„ç»„ä»¶ï¼ˆç±»ä¼¼ skeletonï¼‰</span>
  <span class="hljs-attr">loadingComponent</span>: <span class="hljs-title class_">CardSkeleton</span>,
  <span class="hljs-comment">// å±•ç¤ºåŠ è½½ç»„ä»¶å‰çš„å»¶è¿Ÿæ—¶é—´ã€‚é»˜è®¤ï¼š200ms</span>
  <span class="hljs-attr">delay</span>: <span class="hljs-number">200</span>,
  <span class="hljs-comment">// å¦‚æœæä¾›äº†ä¸€ä¸ªåŠ è½½ç»„ä»¶ï¼Œåœ¨è¶…æ—¶å‰å®ƒå°†è¢«å±•ç¤º</span>
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">3000</span>,
  <span class="hljs-comment">// åŠ è½½å¤±è´¥æ—¶ä½¿ç”¨çš„ç»„ä»¶</span>
  <span class="hljs-attr">errorComponent</span>: <span class="hljs-title class_">ErrorComponent</span>, 
});
</code></pre>
<p>æˆ–è€…åœ¨ <code>Suspense</code> çš„çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨ <code>onErrorCaptured</code> é’©å­æ¥æ•è·å¼‚æ­¥ä¾èµ–æŠ›å‡ºçš„ä»»ä½•é”™è¯¯ã€‚</p>
<p><code>å‚è€ƒæ–‡ç« </code></p>
<p>å°æ»¡zs  å­¦ä¹ Vue3 ç¬¬åå…«ç« ï¼ˆå¼‚æ­¥ç»„ä»¶&amp;ä»£ç åˆ†åŒ…&amp;suspenseï¼‰<a href="https://link.juejin.cn?target=https%3A%2F%2Fxiaoman.blog.csdn.net%2Farticle%2Fdetails%2F122909360" target="_blank" title="https://xiaoman.blog.csdn.net/article/details/122909360" ref="nofollow noopener noreferrer">xiaoman.blog.csdn.net/article/detâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Tauri (25)â€”â€”æ¶ˆé™¤æœç´¢åˆ—è¡¨é»˜è®¤é€‰ä¸­çš„ UI é—ªåŠ¨]]></title>    <link>https://juejin.cn/post/7591309945511608320</link>    <guid>https://juejin.cn/post/7591309945511608320</guid>    <pubDate>2026-01-05T01:46:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591309945511608320" data-draft-id="7590752433989074998" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Tauri (25)â€”â€”æ¶ˆé™¤æœç´¢åˆ—è¡¨é»˜è®¤é€‰ä¸­çš„ UI é—ªåŠ¨"/> <meta itemprop="keywords" content="å‰ç«¯,React.js,WeUI"/> <meta itemprop="datePublished" content="2026-01-05T01:46:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¨å¤œå¯»æ™´å¤©"/> <meta itemprop="url" content="https://juejin.cn/user/1943592288391496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Tauri (25)â€”â€”æ¶ˆé™¤æœç´¢åˆ—è¡¨é»˜è®¤é€‰ä¸­çš„ UI é—ªåŠ¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592288391496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¨å¤œå¯»æ™´å¤©
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T01:46:26.000Z" title="Mon Jan 05 2026 01:46:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨åšæ¡Œé¢åº”ç”¨ coco-appï¼ˆReact 18 + Tauriï¼‰æ—¶ï¼Œé‡åˆ°ä¸€ä¸ªè‚‰çœ¼å¯è§çš„ä½“éªŒé—®é¢˜ï¼šæœç´¢ç»“æœæ¸²æŸ“å‡ºæ¥åï¼Œé»˜è®¤é€‰ä¸­çš„ç¬¬ä¸€é¡¹ä¼š â€œæ…¢åŠæ‹â€ æ‰é«˜äº®ï¼Œå¯¼è‡´ UI æœ‰è½»å¾®é—ªåŠ¨ã€‚è¿™ç¯‡æ–‡ç« åˆ†äº«å®šä½è¿‡ç¨‹ä¸æœ€ç»ˆä¿®å¤æ–¹æ¡ˆï¼Œæ·±åº¦è§£æ<code>useLayoutEffect</code> çš„ä½¿ç”¨é€»è¾‘ï¼Œå¹¶ç»™å‡ºä»£ç å¯¹æ¯”ä¸æ‰©å±•å®è·µï¼Œå¸®ä½ é¿å¼€åŒç±»äº¤äº’ä¼˜åŒ–å‘ã€‚</p>
<hr/>
<h2 data-id="heading-0">èƒŒæ™¯ä¸é—®é¢˜</h2>
<ul>
<li>ä¸šåŠ¡åœºæ™¯ï¼šæœç´¢é¢æ¿åˆ—è¡¨æ¸²æŸ“åï¼Œé»˜è®¤é«˜äº®ç¬¬ä¸€æ¡ï¼Œä¾¿äºç”¨æˆ·å¿«é€Ÿå›è½¦æˆ–æ–¹å‘é”®æ“ä½œã€‚</li>
<li>ç°è±¡ï¼šåˆ—è¡¨å·²ç»æ¸²æŸ“ï¼Œä½†é»˜è®¤é€‰ä¸­å‡ºç°å»¶è¿Ÿï¼Œè‚‰çœ¼å¯è§çš„â€œæŠ–ä¸€ä¸‹â€ã€‚</li>
</ul>
<p>ç»è¿‡å®šä½ï¼Œæ ¹å› æ˜¯åˆå§‹åŒ–é€‰ä¸­é€»è¾‘ä½¿ç”¨äº† 200ms çš„é˜²æŠ–ï¼Œå¯¼è‡´çŠ¶æ€æ›´æ–°æ™šäºæ¸²æŸ“â€”â€”åˆ—è¡¨ DOM å·²å‡ºç°åœ¨å±å¹•ä¸Šï¼Œä½†é€‰ä¸­çŠ¶æ€çš„æ ·å¼è¿˜æœªç”Ÿæ•ˆï¼Œå½¢æˆè§†è§‰æ–­å±‚ã€‚</p>
<hr/>
<h2 data-id="heading-1">å¤ç°ä¸å®šä½</h2>
<p>æ—§é€»è¾‘åœ¨æ¸²æŸ“åé€šè¿‡ <code>useDebounceFn</code> å»¶è¿Ÿ 200ms æ‰è®¾ç½®é€‰ä¸­é¡¹ï¼Œæœ¬æ„æ˜¯ â€œé¿å…è¿‡å¤šçš„åˆå§‹åŒ–â€ï¼Œä½†åœ¨ç”¨æˆ·å¯æ„ŸçŸ¥çš„äº¤äº’åœºæ™¯ä¸­ï¼Œè¿™ç§å»¶è¿Ÿå®Œå…¨æš´éœ²ï¼š</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// æ—§ä»£ç ï¼ˆé—®é¢˜æ ¹æºï¼‰</span>
<span class="hljs-keyword">const</span> { <span class="hljs-attr">run</span>: initializeSelection } = <span class="hljs-title function_">useDebounceFn</span>(
  <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">setSelectedIndex</span>(<span class="hljs-number">0</span>);
    <span class="hljs-title function_">setSelectedSearchContent</span>(suggests[<span class="hljs-number">0</span>]?.<span class="hljs-property">document</span> || <span class="hljs-literal">null</span>);
  },
  { <span class="hljs-attr">wait</span>: <span class="hljs-number">200</span> }
);

<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">setSelectedIndex</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-title function_">initializeSelection</span>();
}, [searchData]);
</code></pre>
<p>é˜²æŠ–åœ¨ â€œé¢‘ç¹è§¦å‘çš„æœç´¢è¾“å…¥â€ åœºæ™¯ä¸­æ˜¯åˆç†çš„ï¼Œä½†åœ¨ â€œæœç´¢ç»“æœæœ€ç»ˆæ¸²æŸ“å®Œæˆååˆå§‹åŒ–é€‰ä¸­â€ è¿™ä¸ªç¯èŠ‚ï¼Œ200ms çš„å»¶è¿Ÿç›´æ¥è§¦å‘äº† UI é—ªåŠ¨â€”â€”ç”¨æˆ·å…ˆçœ‹åˆ°æ— é€‰ä¸­çš„åˆ—è¡¨ï¼Œå†çœ‹åˆ°ç¬¬ä¸€é¡¹é«˜äº®ï¼Œè§†è§‰ä¸Šå½¢æˆ â€œæŠ–åŠ¨â€ã€‚</p>
<hr/>
<h2 data-id="heading-2">è§£å†³æ–¹æ¡ˆï¼šç”¨ useLayoutEffect å®ç°å¸ƒå±€é˜¶æ®µåŒæ­¥æ›´æ–°</h2>
<p>æ”¹ä¸ºåœ¨å¸ƒå±€é˜¶æ®µåŒæ­¥åˆå§‹åŒ–é€‰ä¸­é¡¹ï¼Œç¡®ä¿é¦–å±æ¸²æŸ“æ—¶é€‰ä¸­çŠ¶æ€ä¸åˆ—è¡¨ DOM åŒæ—¶ç”Ÿæ•ˆï¼Œä»æ ¹æºæ¶ˆé™¤å»¶è¿Ÿã€‚</p>
<h3 data-id="heading-3">æ ¸å¿ƒæ”¹åŠ¨ä»£ç </h3>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// æ–°ä»£ç ï¼ˆåŒæ­¥åˆå§‹åŒ–ï¼Œæ— å»¶è¿Ÿï¼‰</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (isChatMode) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">if</span> (suggests.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-title function_">setSelectedIndex</span>(<span class="hljs-number">0</span>);
    <span class="hljs-title function_">setSelectedSearchContent</span>(suggests[<span class="hljs-number">0</span>].<span class="hljs-property">document</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">setSelectedIndex</span>(<span class="hljs-literal">null</span>);
    <span class="hljs-title function_">setSelectedSearchContent</span>(<span class="hljs-literal">undefined</span>);
  }
}, [searchData, suggests, isChatMode]);
</code></pre>
<p>è¿™ä¸€æ”¹åŠ¨èƒ½ç¡®ä¿ï¼š</p>
<ul>
<li>åˆ—è¡¨DOMå¸ƒå±€å®Œæˆåã€å±å¹•ç»˜åˆ¶å‰ï¼Œé€‰ä¸­çŠ¶æ€å·²æ›´æ–°ï¼›</li>
<li>ç”¨æˆ·çœ‹åˆ°çš„ç¬¬ä¸€å¸§å°±æ˜¯ â€œå·²é€‰ä¸­ç¬¬ä¸€é¡¹â€ çš„çŠ¶æ€ï¼›</li>
<li>é”®ç›˜å¯¼èˆªã€æ»šåŠ¨è”åŠ¨ã€ä¸Šä¸‹æ–‡èœå•ç­‰åŸæœ‰äº¤äº’é€»è¾‘å®Œå…¨ä¸å˜ã€‚</li>
</ul>
<h3 data-id="heading-4">æ–°æ—§é€»è¾‘å¯¹æ¯”</h3>

























<table><thead><tr><th>ç»´åº¦</th><th>æ—§å®ç°ï¼ˆé˜²æŠ–+useEffectï¼‰</th><th>æ–°å®ç°ï¼ˆuseLayoutEffectï¼‰</th></tr></thead><tbody><tr><td>æ‰§è¡Œæ—¶æœº</td><td>æ¸²æŸ“å®Œæˆåå»¶è¿Ÿ200ms</td><td>å¸ƒå±€å®Œæˆåã€ç»˜åˆ¶å‰åŒæ­¥æ‰§è¡Œ</td></tr><tr><td>è§†è§‰è¡¨ç°</td><td>å…ˆæ¸²æŸ“åˆ—è¡¨ï¼Œåé«˜äº®ï¼Œæœ‰é—ªåŠ¨</td><td>æ¸²æŸ“ä¸é«˜äº®åŒæ­¥ï¼Œæ— è§†è§‰æ–­å±‚</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>éé¦–å±å…³é”®äº¤äº’ã€é«˜é¢‘è§¦å‘é€»è¾‘</td><td>é¦–å±çŠ¶æ€åŒæ­¥ã€æ— å»¶è¿Ÿäº¤äº’</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">æ·±åº¦è§£æï¼šuseLayoutEffect æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<h3 data-id="heading-6">1. æ ¸å¿ƒå®šä¹‰</h3>
<p><code>useLayoutEffect</code> æ˜¯ React æä¾›çš„ç”Ÿå‘½å‘¨æœŸ Hookï¼Œä¸ <code>useEffect</code> åŠŸèƒ½ç±»ä¼¼ï¼Œä½†<strong>æ‰§è¡Œæ—¶æœºå®Œå…¨ä¸åŒ</strong>ï¼š</p>
<ul>
<li><code>useEffect</code>ï¼šåœ¨ç»„ä»¶æ¸²æŸ“å®Œæˆï¼ˆDOM ç»˜åˆ¶åˆ°å±å¹•ï¼‰åå¼‚æ­¥æ‰§è¡Œï¼Œä¸ä¼šé˜»å¡æµè§ˆå™¨ç»˜åˆ¶ï¼›</li>
<li><code>useLayoutEffect</code>ï¼šåœ¨ç»„ä»¶ DOM å¸ƒå±€å®Œæˆåã€å±å¹•ç»˜åˆ¶å‰åŒæ­¥æ‰§è¡Œï¼Œä¼šé˜»å¡ç»˜åˆ¶ï¼Œç›´åˆ°å›è°ƒå®Œæˆã€‚</li>
</ul>
<h3 data-id="heading-7">2. æ‰§è¡Œæ—¶åºï¼ˆReact 18ï¼‰</h3>
<pre><code class="hljs">ç»„ä»¶è§¦å‘æ›´æ–° â†’ è®¡ç®—æ–°DOM â†’ å¸ƒå±€é˜¶æ®µï¼ˆLayoutï¼‰â†’ useLayoutEffectæ‰§è¡Œ â†’ ç»˜åˆ¶é˜¶æ®µï¼ˆPaintï¼‰â†’ useEffectæ‰§è¡Œ
</code></pre>
<p>æ­£æ˜¯è¿™ä¸ª â€œå¸ƒå±€åã€ç»˜åˆ¶å‰â€ çš„æ—¶åºï¼Œè®© <code>useLayoutEffect</code> æˆä¸º â€œé¦–å±çŠ¶æ€åŒæ­¥â€ çš„æœ€ä½³é€‰æ‹©â€”â€”ä¿®æ”¹çŠ¶æ€çš„æ“ä½œä¼šåœ¨ç”¨æˆ·çœ‹åˆ°ç”»é¢ä¹‹å‰å®Œæˆï¼Œé¿å…è§†è§‰é—ªåŠ¨ã€‚</p>
<h3 data-id="heading-8">3. useLayoutEffect vs useEffectï¼ˆæ ¸å¿ƒåŒºåˆ«ï¼‰</h3>






























<table><thead><tr><th>ç‰¹æ€§</th><th>useLayoutEffect</th><th>useEffect</th></tr></thead><tbody><tr><td>æ‰§è¡Œæ—¶æœº</td><td>å¸ƒå±€åã€ç»˜åˆ¶å‰ï¼ˆåŒæ­¥ï¼‰</td><td>ç»˜åˆ¶åï¼ˆå¼‚æ­¥ï¼‰</td></tr><tr><td>é˜»å¡ç»˜åˆ¶</td><td>æ˜¯ï¼ˆçŸ­æ—¶é—´æ“ä½œæ— æ„ŸçŸ¥ï¼‰</td><td>å¦</td></tr><tr><td>é€‚ç”¨åœºæ™¯</td><td>é¦–å±çŠ¶æ€åŒæ­¥ã€DOMå°ºå¯¸/ä½ç½®è®¡ç®—</td><td>æ•°æ®è¯·æ±‚ã€å¼‚æ­¥æ“ä½œã€éç´§æ€¥DOMä¿®æ”¹</td></tr><tr><td>SSR å…¼å®¹æ€§</td><td>ä¸å…¼å®¹ï¼ˆæœåŠ¡ç«¯æ— å¸ƒå±€é˜¶æ®µï¼‰</td><td>å…¼å®¹</td></tr></tbody></table>
<h3 data-id="heading-9">4. ä¸ºä»€ä¹ˆæœ¬åœºæ™¯ä¸èƒ½ç”¨ useEffectï¼Ÿ</h3>
<p>å¦‚æœå°†æ–°ä»£ç ä¸­çš„ <code>useLayoutEffect</code> æ¢æˆ <code>useEffect</code>ï¼Œä¾ç„¶ä¼šå‡ºç°è½»å¾®é—ªåŠ¨ï¼š</p>
<ul>
<li><code>useEffect</code> æ‰§è¡Œæ—¶ï¼Œåˆ—è¡¨å·²ç»ç»˜åˆ¶åˆ°å±å¹•ï¼›</li>
<li>æ­¤æ—¶ä¿®æ”¹ <code>selectedIndex</code> ä¼šè§¦å‘äºŒæ¬¡æ¸²æŸ“ï¼Œç”¨æˆ·èƒ½çœ‹åˆ°â€œå…ˆæ— é€‰ä¸­ã€åé«˜äº®â€çš„è¿‡ç¨‹ã€‚</li>
</ul>
<p>è€Œ <code>useLayoutEffect</code> æ‰§è¡Œæ—¶ï¼Œåˆ—è¡¨è¿˜æœªç»˜åˆ¶ï¼ŒçŠ¶æ€ä¿®æ”¹ä¼šèå…¥æœ¬æ¬¡æ¸²æŸ“æµç¨‹ï¼Œæœ€ç»ˆåªè§¦å‘ä¸€æ¬¡ç»˜åˆ¶ï¼Œè§†è§‰ä¸Šå®Œå…¨æ— æ„ŸçŸ¥ã€‚</p>
<hr/>
<h2 data-id="heading-10">useLayoutEffect æ‰©å±•å®è·µï¼šé€‚ç”¨åœºæ™¯ä¸é¿å‘æŒ‡å—</h2>
<h3 data-id="heading-11">ä¸€ã€é€‚ç”¨åœºæ™¯ï¼ˆä¼˜å…ˆç”¨ useLayoutEffect çš„æƒ…å†µï¼‰</h3>
<ol>
<li>
<p><strong>é¦–å±çŠ¶æ€åŒæ­¥</strong>ï¼šå¦‚æœ¬æ¡ˆä¾‹çš„åˆ—è¡¨é»˜è®¤é€‰ä¸­ã€è¡¨å•é»˜è®¤èšç„¦ã€è·¯ç”±è·³è½¬åçš„æ»šåŠ¨å®šä½ï¼›</p>
</li>
<li>
<p><strong>DOM å°ºå¯¸/ä½ç½®è®¡ç®—</strong>ï¼šæ¯”å¦‚è·å–å…ƒç´ å®½é«˜åç«‹å³è°ƒæ•´æ ·å¼ï¼Œé¿å… â€œå…ˆé”™ä½ã€åä¿®æ­£â€ï¼›</p>
</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// ç¤ºä¾‹ï¼šè·å–å…ƒç´ é«˜åº¦å¹¶åŒæ­¥è®¾ç½®å®¹å™¨é«˜åº¦</span>
<span class="hljs-title function_">useLayoutEffect</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> height = ref.<span class="hljs-property">current</span>?.<span class="hljs-property">offsetHeight</span>;
  <span class="hljs-keyword">if</span> (height) <span class="hljs-title function_">setContainerHeight</span>(height);
}, []);
</code></pre>
<ol start="3">
<li><strong>æ— éšœç¢å±æ€§åŒæ­¥</strong>ï¼šå¦‚ <code>aria-selected</code>ã€<code>aria-hidden</code> ç­‰å±æ€§çš„åˆå§‹åŒ–ï¼Œç¡®ä¿é¦–å±ç¬¦åˆæ— éšœç¢è§„èŒƒã€‚</li>
</ol>
<h3 data-id="heading-12">äºŒã€é¿å‘æŒ‡å—ï¼ˆä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼‰</h3>
<ol>
<li>
<p><strong>é¿å…é‡è®¡ç®—/è€—æ—¶æ“ä½œ</strong>ï¼š<code>useLayoutEffect</code> é˜»å¡ç»˜åˆ¶ï¼Œè‹¥å›è°ƒå†…æœ‰å¤æ‚è®¡ç®—ï¼ˆå¦‚å¾ªç¯éå†å¤§é‡æ•°æ®ï¼‰ï¼Œä¼šå¯¼è‡´é¡µé¢å¡é¡¿ï¼›</p>
</li>
<li>
<p><strong>SSR ç¯å¢ƒå¤„ç†</strong>ï¼šåœ¨ Next.jsã€Remix ç­‰ SSR æ¡†æ¶ä¸­ä½¿ç”¨æ—¶ï¼Œéœ€åŠ åˆ¤æ–­é¿å…æœåŠ¡ç«¯æ‰§è¡Œï¼š</p>
</li>
</ol>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">const</span> isBrowser = <span class="hljs-keyword">typeof</span> <span class="hljs-variable language_">window</span> !== <span class="hljs-string">'undefined'</span>;
(isBrowser ? useLayoutEffect : useEffect)(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ä¸šåŠ¡é€»è¾‘</span>
}, [deps]);
</code></pre>
<ol start="3">
<li>
<p><strong>ä¾èµ–é¡¹å®Œæ•´</strong>ï¼šä¸ <code>useEffect</code> ä¸€è‡´ï¼Œå¿…é¡»å£°æ˜æ‰€æœ‰ä¾èµ–ï¼Œé¿å…é—­åŒ…æ•è·æ—§å€¼ï¼ˆæœ¬æ¡ˆä¾‹ä¾èµ– <code>searchData</code>/<code>suggests</code>/<code>isChatMode</code> ç¡®ä¿çŠ¶æ€åŒæ­¥ï¼‰ï¼›</p>
</li>
<li>
<p><strong>é¿å…è¿‡åº¦ä½¿ç”¨</strong>ï¼šä»…åœ¨â€œé¦–å±è§†è§‰ä¸€è‡´æ€§â€åœºæ™¯ä½¿ç”¨ï¼Œæ™®é€šå¼‚æ­¥é€»è¾‘ï¼ˆå¦‚æ•°æ®è¯·æ±‚ï¼‰ä»ç”¨ <code>useEffect</code>ã€‚</p>
</li>
</ol>
<h3 data-id="heading-13">ä¸‰ã€ä¸é˜²æŠ–/èŠ‚æµçš„é…åˆåŸåˆ™</h3>
<p>é˜²æŠ–ï¼ˆdebounceï¼‰å’ŒèŠ‚æµï¼ˆthrottleï¼‰æ˜¯ â€œé«˜é¢‘è§¦å‘åœºæ™¯â€ çš„ä¼˜åŒ–æ‰‹æ®µï¼Œä½†éœ€åˆ†æ¸…ä½¿ç”¨é˜¶æ®µï¼š</p>
<ul>
<li>âœ… é€‚ç”¨ï¼šæœç´¢è¾“å…¥ã€çª—å£ resizeã€æ»šåŠ¨äº‹ä»¶ç­‰<strong>é«˜é¢‘è§¦å‘çš„æºäº‹ä»¶</strong>ï¼›</li>
<li>âŒ ä¸é€‚ç”¨ï¼šäº‹ä»¶è§¦å‘åçš„ <strong>æœ€ç»ˆçŠ¶æ€åŒæ­¥</strong>ï¼ˆå¦‚æœ¬æ¡ˆä¾‹çš„æœç´¢ç»“æœæ¸²æŸ“ååˆå§‹åŒ–é€‰ä¸­ï¼‰ã€‚</li>
</ul>
<p>ç®€å•è¯´ï¼šé˜²æŠ–èŠ‚æµç”¨äº â€œæ§åˆ¶è§¦å‘é¢‘ç‡â€ï¼Œè€Œé â€œå»¶è¿Ÿæœ€ç»ˆçŠ¶æ€ç”Ÿæ•ˆâ€ã€‚</p>
<hr/>
<h2 data-id="heading-14">å°ç»“</h2>
<p>ç”¨æˆ·ä½“éªŒçš„ â€œå¾®å»¶è¿Ÿâ€ å’Œ â€œè§†è§‰é—ªåŠ¨â€ï¼Œå¾€å¾€è—åœ¨å¼‚æ­¥å¤„ç†ã€ç”Ÿå‘½å‘¨æœŸæ—¶æœºçš„ç»†èŠ‚é‡Œã€‚å¯¹äº â€œé¦–å¸§çŠ¶æ€å¿…é¡»ä¸€è‡´â€ çš„äº¤äº’åœºæ™¯ï¼š</p>
<ol>
<li>æ”¾å¼ƒä¸å¿…è¦çš„é˜²æŠ–å»¶è¿Ÿï¼Œä¼˜å…ˆç”¨ <code>useLayoutEffect</code> å®ç°â€œå¸ƒå±€åã€ç»˜åˆ¶å‰â€çš„çŠ¶æ€åŒæ­¥ï¼›</li>
<li>åŒºåˆ† <code>useLayoutEffect</code> ä¸ <code>useEffect</code> çš„æ‰§è¡Œæ—¶åºï¼Œé¿å…ç”¨é”™å¯¼è‡´è§†è§‰é—®é¢˜ï¼›</li>
<li>é˜²æŠ–/èŠ‚æµåªç”¨äºé«˜é¢‘è§¦å‘çš„æºé€»è¾‘ï¼Œè€Œéæœ€ç»ˆçš„çŠ¶æ€åˆå§‹åŒ–ã€‚</li>
</ol>
<p>å¦‚æœä½ ä¹Ÿåœ¨åš React æ¡Œé¢ï¼ˆTauri/Electronï¼‰æˆ– Web åº”ç”¨çš„æœç´¢åˆ—è¡¨ã€è¡¨å•ã€å¯¼èˆªç­‰äº¤äº’ç»„ä»¶ï¼Œä¸å¦¨æ£€æŸ¥ä¸€ä¸‹é»˜è®¤çŠ¶æ€çš„åˆå§‹åŒ–æ—¶æœºâ€”â€”ç”¨å¯¹ <code>useLayoutEffect</code>ï¼Œå¾€å¾€èƒ½ç«‹ç«¿è§å½±åœ°æ¶ˆé™¤è§†è§‰æŠ–åŠ¨ï¼Œæå‡äº¤äº’é¡ºæ»‘åº¦ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš€ é‡æ–°å®šä¹‰å‰ç«¯ç»„ä»¶å®‰è£…ä½“éªŒï¼šshadcn + Bun çš„æè‡´å¼€å‘æ•ˆç‡]]></title>    <link>https://juejin.cn/post/7591309945510821888</link>    <guid>https://juejin.cn/post/7591309945510821888</guid>    <pubDate>2026-01-04T12:34:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591309945510821888" data-draft-id="7591309945510805504" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€ é‡æ–°å®šä¹‰å‰ç«¯ç»„ä»¶å®‰è£…ä½“éªŒï¼šshadcn + Bun çš„æè‡´å¼€å‘æ•ˆç‡"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-04T12:34:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Erishen"/> <meta itemprop="url" content="https://juejin.cn/user/3342957408695086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€ é‡æ–°å®šä¹‰å‰ç«¯ç»„ä»¶å®‰è£…ä½“éªŒï¼šshadcn + Bun çš„æè‡´å¼€å‘æ•ˆç‡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3342957408695086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Erishen
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T12:34:46.000Z" title="Sun Jan 04 2026 12:34:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>è¿˜åœ¨ä¸º npm install é¾Ÿé€Ÿå®‰è£…è€Œçƒ¦æ¼ï¼Ÿæœ¬æ–‡å°†å¸¦ä½ ä½“éªŒä¸€ç§å…¨æ–°çš„ç»„ä»¶è·å–æ–¹å¼ï¼š<strong>copy instead of install</strong>ã€‚é€šè¿‡ shadcn çš„ç»„ä»¶æ³¨å†Œè¡¨æ¨¡å¼ + Bun çš„æé€Ÿæ€§èƒ½ï¼Œè®©ä½ çš„å¼€å‘æ•ˆç‡æå‡ 10 å€ï¼</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb3d6365e11248babbd8b8dd682a2dac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJpc2hlbg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141648&amp;x-signature=%2BvX7mTY8eJHB8V9lIW%2FSucncQ8I%3D" alt="shadcn-bun-medium-cover.png" loading="lazy"/></p>
<h2 data-id="heading-0">ğŸ’¡ é‡æ–°æ€è€ƒï¼šä¸ºä»€ä¹ˆè¿˜è¦ npm installï¼Ÿ</h2>
<h3 data-id="heading-1">ä¼ ç»Ÿæ–¹å¼çš„ç—›ç‚¹</h3>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># âŒ ä¼ ç»Ÿçš„ npm æ–¹å¼</span>
npm install <span class="hljs-variable">@tanstack</span>/react-table      <span class="hljs-comment"># å¤æ‚çš„è¡¨æ ¼ç»„ä»¶</span>
npm install <span class="hljs-variable">@headlessui</span>/react          <span class="hljs-comment"># æ— æ ·å¼ç»„ä»¶</span>
npm install <span class="hljs-variable">@heroicons</span>/react           <span class="hljs-comment"># å›¾æ ‡åº“</span>
npm install clsx tailwind-merge        <span class="hljs-comment"># å·¥å…·å‡½æ•°</span>
npm install <span class="hljs-keyword">class</span>-variance-authority   <span class="hljs-comment"># å˜ä½“ç®¡ç†</span>

<span class="hljs-comment"># ç»“æœï¼šnode_modules è‡ƒè‚¿ã€å®‰è£…ç¼“æ…¢ã€ç‰ˆæœ¬å†²çª</span>
</code></pre>
<h3 data-id="heading-2">shadcn çš„é©æ–°ç†å¿µ</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># âœ… shadcn çš„æ–¹å¼ï¼šä¸€è¡Œå‘½ä»¤æå®š</span>
pnpm dlx shadcn@latest <span class="hljs-keyword">add</span> https:<span class="hljs-comment">//erishen.github.io/shadcn-registry/r/data-table.json</span>

<span class="hljs-meta"># ç»“æœï¼šç›´æ¥å¤åˆ¶ç»„ä»¶ä»£ç åˆ°ä½ çš„é¡¹ç›®ï¼Œå®Œå…¨å¯æ§</span>
</code></pre>
<blockquote>
<p><strong>æ ¸å¿ƒç†å¿µ</strong>: "Copy and paste, not install"</p>
</blockquote>
<h2 data-id="heading-3">ğŸ”¥ ä¸ºä»€ä¹ˆé€‰æ‹© Bunï¼Ÿæ€§èƒ½å¯¹æ¯”å®æµ‹</h2>
<h3 data-id="heading-4">å®‰è£…é€Ÿåº¦å¯¹æ¯”</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># ğŸŒ npm (åŸºçº¿æ—¶é—´)</span>
<span class="hljs-keyword">time</span> npm install
<span class="hljs-comment"># real    0m45.231s  # 45ç§’</span>

<span class="hljs-comment"># âš¡ pnpm (ä¸é”™ä½†è¿˜æœ‰å·®è·)  </span>
<span class="hljs-keyword">time</span> pnpm install
<span class="hljs-comment"># real    0m12.456s  # 12ç§’</span>

<span class="hljs-comment"># ğŸš€ Bun (æè‡´ä½“éªŒ)</span>
<span class="hljs-keyword">time</span> bun install
<span class="hljs-comment"># real    0m2.134s   # 2ç§’ï¼</span>
</code></pre>
<h3 data-id="heading-5">å¼€å‘æœåŠ¡å™¨å¯åŠ¨å¯¹æ¯”</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// åŒæ ·çš„ Next.js é¡¹ç›®</span>
<span class="hljs-type">const</span> startupTime = {
  npm: <span class="hljs-string">"8500ms"</span>,    <span class="hljs-comment">// 8.5ç§’</span>
  pnpm: <span class="hljs-string">"3200ms"</span>,   <span class="hljs-comment">// 3.2ç§’  </span>
  bun: <span class="hljs-string">"1200ms"</span>     <span class="hljs-comment">// 1.2ç§’</span>
};

<span class="hljs-comment">// æå‡æ•ˆæœ</span>
<span class="hljs-type">const</span> improvement = {
  vs_npm: <span class="hljs-string">"85% faster"</span>,    <span class="hljs-comment">// æ¯” npm å¿« 85%</span>
  vs_pnpm: <span class="hljs-string">"62% faster"</span>    <span class="hljs-comment">// æ¯” pnpm å¿« 62%</span>
};
</code></pre>
<h3 data-id="heading-6">Bun çš„æ ¸å¿ƒä¼˜åŠ¿</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 1. æé€Ÿå®‰è£…ç®—æ³•</span>
<span class="hljs-type">const</span> bunFeatures = {
  parallelDownloads: <span class="hljs-string">"å¹¶è¡Œä¸‹è½½ï¼Œé€Ÿåº¦æå‡ 10-20 å€"</span>,
  smartCache: <span class="hljs-string">"æ™ºèƒ½ç¼“å­˜ï¼Œé¿å…é‡å¤ä¸‹è½½"</span>,
  nativePerformance: <span class="hljs-string">"åŸç”Ÿæ€§èƒ½ï¼Œæ—  Node.js å¼€é”€"</span>,
  webAPIs: <span class="hljs-string">"å†…ç½® fetchã€WebSocketã€Streams"</span>
};

<span class="hljs-comment">// 2. å¼€å‘ä½“éªŒæå‡</span>
<span class="hljs-type">const</span> devExperience = {
  hotReload: <span class="hljs-string">"çƒ­é‡è½½é€Ÿåº¦æå‡ 70%"</span>,
  typeChecking: <span class="hljs-string">"TypeScript åŸç”Ÿæ”¯æŒ"</span>,
  bundling: <span class="hljs-string">"å†…ç½® ESBuildï¼Œæ‰“åŒ…é€Ÿåº¦ç¿»å€"</span>,
  testing: <span class="hljs-string">"å†…ç½®æµ‹è¯•è¿è¡Œå™¨"</span>
};
</code></pre>
<h2 data-id="heading-7">ğŸ—ï¸ æ‰“é€ ä½ çš„ç»„ä»¶æ³¨å†Œè¡¨</h2>
<h3 data-id="heading-8">ä»€ä¹ˆæ˜¯ç»„ä»¶æ³¨å†Œè¡¨ï¼Ÿ</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// registry.json - ä½ çš„ç»„ä»¶å•†åº—</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"erishen-components"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"homepage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://your-registry.com/"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"items"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"data-table"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"registry:component"</span><span class="hljs-punctuation">,</span> 
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Data Table"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ä¼ä¸šçº§æ•°æ®è¡¨æ ¼ç»„ä»¶"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"components/data-table.tsx"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"registry:component"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-9">ä¸€é”®å®‰è£…ä½“éªŒ</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># å®‰è£…ä»»ä½•ç»„ä»¶åªéœ€è¦ä¸€è¡Œå‘½ä»¤</span>
pnpm dlx shadcn@latest <span class="hljs-keyword">add</span> https:<span class="hljs-comment">//erishen.github.io/shadcn-registry/r/data-table.json</span>

<span class="hljs-meta"># ç»„ä»¶ä¼šè‡ªåŠ¨ä¸‹è½½åˆ°ä½ çš„é¡¹ç›®ä¸­</span>
src/
â””â”€â”€ components/
    â”œâ”€â”€ ui/                    <span class="hljs-meta"># åŸºç¡€ç»„ä»¶</span>
    â””â”€â”€ data-table.tsx         <span class="hljs-meta"># ä½ åˆšå®‰è£…çš„ç»„ä»¶</span>
</code></pre>
<h2 data-id="heading-10">ğŸ’» å®æˆ˜ï¼šåˆ›å»º shadcn-registry é¡¹ç›®</h2>
<h3 data-id="heading-11">1. é¡¹ç›®åˆå§‹åŒ–</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># ä½¿ç”¨ Bun åˆ›å»ºé¡¹ç›®ï¼Œæé€Ÿå¯åŠ¨</span>
bun create <span class="hljs-keyword">next</span>-app@latest shadcn-registry --typescript --tailwind --eslint --app --src-dir

cd shadcn-registry

<span class="hljs-comment"># å®‰è£…ä¾èµ–ï¼ˆæ¯” npm å¿« 15 å€ï¼‰</span>
bun install

<span class="hljs-comment"># å¯åŠ¨å¼€å‘æœåŠ¡å™¨</span>
bun dev  <span class="hljs-comment"># ğŸš€ 1.2ç§’å¯åŠ¨å®Œæˆï¼</span>
</code></pre>
<h3 data-id="heading-12">2. æ„å»ºç»„ä»¶æ³¨å†Œè¡¨</h3>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// registry/new-york/ui/button.tsx</span>
<span class="hljs-string">'use client'</span>;

import * <span class="hljs-keyword">as</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
import { Slot } <span class="hljs-keyword">from</span> <span class="hljs-string">'@radix-ui/react-slot'</span>;
import { cva, type VariantProps } <span class="hljs-keyword">from</span> <span class="hljs-string">'class-variance-authority'</span>;
import { cn } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/lib/utils'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">buttonVariants</span> = <span class="hljs-title function_ invoke__">cva</span>(
  <span class="hljs-string">'inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50'</span>,
  {
    <span class="hljs-attr">variants</span>: {
      <span class="hljs-attr">variant</span>: {
        <span class="hljs-attr">default</span>: <span class="hljs-string">'bg-slate-900 text-slate-50 hover:bg-slate-900/90'</span>,
        <span class="hljs-attr">destructive</span>: <span class="hljs-string">'bg-red-500 text-slate-50 hover:bg-red-500/90'</span>,
        <span class="hljs-attr">outline</span>: <span class="hljs-string">'border border-slate-200 bg-white hover:bg-slate-100'</span>,
        <span class="hljs-attr">secondary</span>: <span class="hljs-string">'bg-slate-100 text-slate-900 hover:bg-slate-100/80'</span>,
        <span class="hljs-attr">ghost</span>: <span class="hljs-string">'hover:bg-slate-100 hover:text-slate-900'</span>,
        <span class="hljs-attr">link</span>: <span class="hljs-string">'text-slate-900 underline-offset-4 hover:underline'</span>,
      },
      <span class="hljs-attr">size</span>: {
        <span class="hljs-attr">default</span>: <span class="hljs-string">'h-10 px-4 py-2'</span>,
        <span class="hljs-attr">sm</span>: <span class="hljs-string">'h-9 rounded-md px-3'</span>,
        <span class="hljs-attr">lg</span>: <span class="hljs-string">'h-11 rounded-md px-8'</span>,
        <span class="hljs-attr">icon</span>: <span class="hljs-string">'h-10 w-10'</span>,
      },
    },
    <span class="hljs-attr">defaultVariants</span>: {
      <span class="hljs-attr">variant</span>: <span class="hljs-string">'default'</span>,
      <span class="hljs-attr">size</span>: <span class="hljs-string">'default'</span>,
    },
  }
);

export <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">ButtonProps</span>
  <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">ButtonHTMLAttributes</span>&lt;<span class="hljs-title">HTMLButtonElement</span>&gt;,
    <span class="hljs-title">VariantProps</span>&lt;<span class="hljs-title">typeof</span> <span class="hljs-title">buttonVariants</span>&gt; </span>{
  asChild?: <span class="hljs-keyword">boolean</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">Button</span> = React.forwardRef&lt;HTMLButtonElement, ButtonProps&gt;(
  ({ className, variant, size, asChild = <span class="hljs-literal">false</span>, ...props }, ref) =&gt; {
    <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">Comp</span> = asChild ? Slot : <span class="hljs-string">'button'</span>;
    <span class="hljs-keyword">return</span> (
      &lt;Comp
        className={<span class="hljs-title function_ invoke__">cn</span>(<span class="hljs-title function_ invoke__">buttonVariants</span>({ variant, size, className }))}
        ref={ref}
        {...props}
      /&gt;
    );
  }
);
Button.displayName = <span class="hljs-string">'Button'</span>;

export { Button, buttonVariants };
</code></pre>
<h3 data-id="heading-13">3. å®šä¹‰æ³¨å†Œè¡¨é…ç½®</h3>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"$schema"</span>: <span class="hljs-string">"https://ui.shadcn.com/schema/registry.json"</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"erishen"</span>,
  <span class="hljs-string">"homepage"</span>: <span class="hljs-string">"https://erishen.github.io/shadcn-registry/"</span>,
  <span class="hljs-string">"items"</span>: [
    {
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"button"</span>,
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"registry:ui"</span>,
      <span class="hljs-string">"title"</span>: <span class="hljs-string">"Button"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"A versatile button component with multiple variants"</span>,
      <span class="hljs-string">"dependencies"</span>: [<span class="hljs-string">"@radix-ui/react-slot"</span>, <span class="hljs-string">"class-variance-authority"</span>, <span class="hljs-string">"clsx"</span>, <span class="hljs-string">"tailwind-merge"</span>],
      <span class="hljs-string">"files"</span>: [
        {
          <span class="hljs-string">"path"</span>: <span class="hljs-string">"registry/new-york/ui/button.tsx"</span>,
          <span class="hljs-string">"type"</span>: <span class="hljs-string">"registry:ui"</span>
        }
      ]
    },
    {
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"data-table"</span>,
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"registry:component"</span>,
      <span class="hljs-string">"title"</span>: <span class="hljs-string">"Data Table"</span>, 
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Feature-rich data table with sorting, filtering, and pagination"</span>,
      <span class="hljs-string">"dependencies"</span>: [<span class="hljs-string">"react"</span>, <span class="hljs-string">"react-dom"</span>],
      <span class="hljs-string">"files"</span>: [
        {
          <span class="hljs-string">"path"</span>: <span class="hljs-string">"components/data-table.tsx"</span>,
          <span class="hljs-string">"type"</span>: <span class="hljs-string">"registry:component"</span>
        }
      ]
    }
  ]
}
</code></pre>
<h2 data-id="heading-14">ğŸ¯ å®é™…åº”ç”¨ï¼šDataTable ç»„ä»¶ç¤ºä¾‹</h2>
<h3 data-id="heading-15">ä¸ºä»€ä¹ˆé€‰æ‹© DataTable ä½œä¸ºæ¼”ç¤ºï¼Ÿ</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦å®‰è£…å¤šä¸ªä¾èµ–</span>
<span class="hljs-type">const</span> traditionalSetup = {
  react_table: <span class="hljs-string">"@tanstack/react-table"</span>,      <span class="hljs-comment">// è¡¨æ ¼æ ¸å¿ƒ</span>
  ui_framework: <span class="hljs-string">"@headlessui/react"</span>,        <span class="hljs-comment">// UI ç»„ä»¶</span>
  icons: <span class="hljs-string">"@heroicons/react"</span>,                 <span class="hljs-comment">// å›¾æ ‡</span>
  utils: [<span class="hljs-string">"clsx"</span>, <span class="hljs-string">"tailwind-merge"</span>],        <span class="hljs-comment">// å·¥å…·å‡½æ•°</span>
  styling: <span class="hljs-string">"tailwindcss"</span>,                   <span class="hljs-comment">// æ ·å¼</span>
  total_deps: <span class="hljs-string">"50+ packages"</span>                <span class="hljs-comment">// 50 å¤šä¸ªä¾èµ–åŒ…ï¼</span>
};

<span class="hljs-comment">// shadcn æ–¹å¼ï¼šä¸€è¡Œå‘½ä»¤æå®š</span>
<span class="hljs-type">const</span> shadcnSetup = {
  command: <span class="hljs-string">"pnpm dlx shadcn@latest add https://your-registry.com/r/data-table.json"</span>,
  dependencies: <span class="hljs-string">"ç›´æ¥é›†æˆåˆ°é¡¹ç›®"</span>,           <span class="hljs-comment">// æ— é¢å¤–ä¾èµ–</span>
  customization: <span class="hljs-string">"å®Œå…¨å¯æ§"</span>,                 <span class="hljs-comment">// å¯ä»¥ä»»æ„ä¿®æ”¹</span>
  size: <span class="hljs-string">"å•ä¸ªæ–‡ä»¶"</span>                           <span class="hljs-comment">// ç²¾ç¡®æ§åˆ¶</span>
};
</code></pre>
<h3 data-id="heading-16">DataTable ç»„ä»¶å®ç°</h3>
<pre><code class="hljs language-ini" lang="ini">'use client'<span class="hljs-comment">;</span>

import { useState, useMemo } from 'react'<span class="hljs-comment">;</span>
import { Button } from '@/components/ui/button'<span class="hljs-comment">;</span>
import { Input } from '@/components/ui/input'<span class="hljs-comment">;</span>

interface Column&lt;T&gt; {
  key: keyof T<span class="hljs-comment">;</span>
  label: string<span class="hljs-comment">;</span>
  sortable?: boolean<span class="hljs-comment">;</span>
  filterable?: boolean<span class="hljs-comment">;</span>
  render?: (value: T<span class="hljs-section">[keyof T]</span>, row: T) =&gt; React.ReactNode<span class="hljs-comment">;</span>
}

export function DataTable&lt;T extends Record&lt;string, any&gt;&gt;({
  data,
  columns,
  <span class="hljs-attr">pageSize</span> = <span class="hljs-number">10</span>,
  onRowClick,
}: DataTableProps&lt;T&gt;) {
  const <span class="hljs-section">[currentPage, setCurrentPage]</span> = useState(1)<span class="hljs-comment">;</span>
  const <span class="hljs-section">[sortKey, setSortKey]</span> = useState&lt;keyof T | null&gt;(null)<span class="hljs-comment">;</span>
  const <span class="hljs-section">[sortDirection, setSortDirection]</span> = useState&lt;'asc' | 'desc' | null&gt;(null)<span class="hljs-comment">;</span>
  const <span class="hljs-section">[filters, setFilters]</span> = useState&lt;Record&lt;string, string&gt;&gt;({})<span class="hljs-comment">;</span>

  // æ€§èƒ½ä¼˜åŒ–ï¼šuseMemo ç¼“å­˜
  const <span class="hljs-attr">filteredData</span> = useMemo(() =&gt; {
    return data.filter((row) =&gt; {
      return Object.entries(filters).every((<span class="hljs-section">[key, value]</span>) =&gt; {
        if (!value) return true<span class="hljs-comment">;</span>
        const <span class="hljs-attr">cellValue</span> = String(row[key as keyof T]).toLowerCase()<span class="hljs-comment">;</span>
        return cellValue.includes(value.toLowerCase())<span class="hljs-comment">;</span>
      })<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>
  }, <span class="hljs-section">[data, filters]</span>)<span class="hljs-comment">;</span>

  // ä¸‰çº§æ’åºé€»è¾‘
  const <span class="hljs-attr">handleSort</span> = (key: keyof T) =&gt; {
    if (<span class="hljs-attr">sortKey</span> === key) {
      if (<span class="hljs-attr">sortDirection</span> === <span class="hljs-string">'asc'</span>) {
        setSortDirection('desc')<span class="hljs-comment">;</span>
      } else if (<span class="hljs-attr">sortDirection</span> === <span class="hljs-string">'desc'</span>) {
        setSortDirection(null)<span class="hljs-comment">;</span>
        setSortKey(null)<span class="hljs-comment">;</span>
      }
    } else {
      setSortKey(key)<span class="hljs-comment">;</span>
      setSortDirection('asc')<span class="hljs-comment">;</span>
    }
  }<span class="hljs-comment">;</span>

  return (
    &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full space-y-4"</span>&gt;
      {/* æœç´¢è¿‡æ»¤ */}
      &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"flex gap-4 p-4 bg-white rounded border"</span>&gt;
        {columns.filter(<span class="hljs-attr">col</span> =&gt; col.filterable).map(col =&gt; (
          &lt;Input
            <span class="hljs-attr">key</span>={String(col.key)}
            <span class="hljs-attr">placeholder</span>={`æœç´¢ <span class="hljs-variable">${col.label}</span>...`}
            <span class="hljs-attr">value</span>={filters[String(col.key)] || <span class="hljs-string">''</span>}
            <span class="hljs-attr">onChange</span>={(e) =&gt; setFilters(prev =&gt; ({ ...prev, [col.key]: e.target.value }))}
            <span class="hljs-attr">className</span>=<span class="hljs-string">"w-48"</span>
          /&gt;
        ))}
      &lt;/div&gt;

      {/* è¡¨æ ¼ */}
      &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"border rounded bg-white"</span>&gt;
        &lt;table <span class="hljs-attr">className</span>=<span class="hljs-string">"w-full"</span>&gt;
          &lt;thead <span class="hljs-attr">className</span>=<span class="hljs-string">"bg-gray-50"</span>&gt;
            &lt;tr&gt;
              {columns.map(<span class="hljs-attr">col</span> =&gt; (
                &lt;th <span class="hljs-attr">key</span>={String(col.key)} className=<span class="hljs-string">"p-4 text-left"</span>&gt;
                  {col.sortable ? (
                    &lt;button <span class="hljs-attr">onClick</span>={() =&gt; handleSort(col.key)} className=<span class="hljs-string">"flex items-center gap-2"</span>&gt;
                      {col.label}
                      &lt;span <span class="hljs-attr">className</span>=<span class="hljs-string">"text-xs"</span>&gt;
                        {<span class="hljs-attr">sortKey</span> === col.key ? (sortDirection === <span class="hljs-string">'asc'</span> ? <span class="hljs-string">'â†‘'</span> : <span class="hljs-string">'â†“'</span>) : <span class="hljs-string">'â†•'</span>}
                      &lt;/span&gt;
                    &lt;/button&gt;
                  ) : col.label}
                &lt;/th&gt;
              ))}
            &lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody&gt;
            {filteredData.slice((currentPage - 1) * pageSize, currentPage * pageSize).map(<span class="hljs-attr">row</span> =&gt; (
              &lt;tr <span class="hljs-attr">key</span>={row.id} <span class="hljs-literal">on</span>Click={() =&gt; <span class="hljs-literal">on</span>RowClick?.(row)} className=<span class="hljs-string">"border-t hover:bg-gray-50 cursor-pointer"</span>&gt;
                {columns.map(<span class="hljs-attr">col</span> =&gt; (
                  &lt;td <span class="hljs-attr">key</span>={String(col.key)} className=<span class="hljs-string">"p-4"</span>&gt;
                    {col.render ? col.render(row<span class="hljs-section">[col.key]</span>, row) : String(row<span class="hljs-section">[col.key]</span>)}
                  &lt;/td&gt;
                ))}
              &lt;/tr&gt;
            ))}
          &lt;/tbody&gt;
        &lt;/table&gt;
      &lt;/div&gt;

      {/* åˆ†é¡µ */}
      &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"flex justify-between p-4 bg-white rounded border"</span>&gt;
        &lt;div&gt;å…± {filteredData.length} æ¡è®°å½•&lt;/div&gt;
        &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"flex gap-2"</span>&gt;
          &lt;Button 
            <span class="hljs-attr">variant</span>=<span class="hljs-string">"outline"</span> 
            <span class="hljs-attr">size</span>=<span class="hljs-string">"sm"</span> 
            <span class="hljs-attr">onClick</span>={() =&gt; setCurrentPage(p =&gt; Math.max(<span class="hljs-number">1</span>, p - <span class="hljs-number">1</span>))}
            <span class="hljs-attr">disabled</span>={currentPage === <span class="hljs-number">1</span>}
          &gt;
            ä¸Šä¸€é¡µ
          &lt;/Button&gt;
          &lt;Button 
            <span class="hljs-attr">variant</span>=<span class="hljs-string">"outline"</span> 
            <span class="hljs-attr">size</span>=<span class="hljs-string">"sm"</span>
            <span class="hljs-attr">onClick</span>={() =&gt; setCurrentPage(p =&gt; p + <span class="hljs-number">1</span>)}
            <span class="hljs-attr">disabled</span>={currentPage * pageSize &gt;= filteredData.length}
          &gt;
            ä¸‹ä¸€é¡µ
          &lt;/Button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  )<span class="hljs-comment">;</span>
}
</code></pre>
<h2 data-id="heading-17">ğŸ“Š æ€§èƒ½å¯¹æ¯”ï¼šä¼ ç»Ÿ vs shadcn + Bun</h2>
<h3 data-id="heading-18">å¼€å‘ä½“éªŒå¯¹æ¯”</h3>









































<table><thead><tr><th>ç¯èŠ‚</th><th>ä¼ ç»Ÿæ–¹å¼ (npm)</th><th>shadcn + Bun</th><th>æå‡</th></tr></thead><tbody><tr><td>é¡¹ç›®åˆå§‹åŒ–</td><td>45s</td><td>3s</td><td><strong>15x</strong></td></tr><tr><td>ä¾èµ–å®‰è£…</td><td>180s</td><td>12s</td><td><strong>15x</strong></td></tr><tr><td>å¼€å‘å¯åŠ¨</td><td>8.5s</td><td>1.2s</td><td><strong>7x</strong></td></tr><tr><td>æ·»åŠ æ–°ç»„ä»¶</td><td>30s</td><td>5s</td><td><strong>6x</strong></td></tr><tr><td>æ„å»ºéƒ¨ç½²</td><td>120s</td><td>25s</td><td><strong>5x</strong></td></tr></tbody></table>
<h3 data-id="heading-19">å®é™…æµ‹è¯•æ•°æ®</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æµ‹è¯•é¡¹ç›®ï¼šNext.js + 20ä¸ªç»„ä»¶</span>
<span class="hljs-comment"># æµ‹è¯•ç¯å¢ƒï¼šMacBook Pro M1, 16GB RAM</span>

<span class="hljs-comment"># npm æ–¹å¼</span>
npm install &amp;&amp; npm run build
<span class="hljs-comment"># æ€»æ—¶é—´: 5m 45s</span>
<span class="hljs-comment"># node_modules: 450MB</span>

<span class="hljs-comment"># shadcn + Bun æ–¹å¼  </span>
bun install &amp;&amp; bun run build
<span class="hljs-comment"># æ€»æ—¶é—´: 1m 12s  ğŸš€</span>
<span class="hljs-comment"># ä»£ç é‡: ä»…éœ€ 45KB</span>
</code></pre>
<h3 data-id="heading-20">ä»£ç é‡å¯¹æ¯”</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ä¼ ç»Ÿè¡¨æ ¼ç»„ä»¶åº“</span>
<span class="hljs-type">const</span> traditionalTable = {
  dependencies: <span class="hljs-number">15</span>,           <span class="hljs-comment">// 15ä¸ªä¾èµ–åŒ…</span>
  bundle_size: <span class="hljs-string">"245KB"</span>,      <span class="hljs-comment">// æœ€ç»ˆæ‰“åŒ…å¤§å°</span>
  code_lines: <span class="hljs-string">"5000+"</span>,       <span class="hljs-comment">// æ ¸å¿ƒä»£ç è¡Œæ•°</span>
  customization: <span class="hljs-string">"å›°éš¾"</span>       <span class="hljs-comment">// å®šåˆ¶åŒ–å›°éš¾</span>
};

<span class="hljs-comment">// shadcn DataTable</span>
<span class="hljs-type">const</span> shadcnTable = {
  dependencies: <span class="hljs-number">0</span>,            <span class="hljs-comment">// æ— é¢å¤–ä¾èµ–</span>
  bundle_size: <span class="hljs-string">"8KB"</span>,        <span class="hljs-comment">// ç²¾ç¡®æ§åˆ¶å¤§å°</span>
  code_lines: <span class="hljs-string">"200"</span>,         <span class="hljs-comment">// 200è¡Œæ ¸å¿ƒä»£ç </span>
  customization: <span class="hljs-string">"å®Œå…¨å¯æ§"</span>   <span class="hljs-comment">// ä»»æ„ä¿®æ”¹</span>
};

<span class="hljs-comment">// ç»“æœï¼š30å€å¤§å°å·®å¼‚</span>
</code></pre>
<h2 data-id="heading-21">ğŸ¯ å®é™…é¡¹ç›®åº”ç”¨</h2>
<h3 data-id="heading-22">æ¡ˆä¾‹ï¼šç”µå•†åå°ç®¡ç†ç³»ç»Ÿ</h3>
<pre><code class="hljs language-perl" lang="perl">// ä¼ ç»Ÿæ–¹å¼ï¼šéœ€è¦å®‰è£…å¤§é‡ä¾èµ–
const ecommerceDependencies = [
  <span class="hljs-string">"@tanstack/react-table"</span>,    <span class="hljs-regexp">//</span> è¡¨æ ¼
  <span class="hljs-string">"@headlessui/react"</span>,       <span class="hljs-regexp">//</span> UIç»„ä»¶
  <span class="hljs-string">"@heroicons/react"</span>,        <span class="hljs-regexp">//</span> å›¾æ ‡
  <span class="hljs-string">"react-hook-form"</span>,         <span class="hljs-regexp">//</span> è¡¨å•
  <span class="hljs-string">"@hookform/resolvers"</span>,     <span class="hljs-regexp">//</span> è¡¨å•éªŒè¯
  <span class="hljs-string">"zod"</span>,                     <span class="hljs-regexp">//</span> æ•°æ®éªŒè¯
  <span class="hljs-string">"clsx"</span>,                    <span class="hljs-regexp">//</span> æ ·å¼å·¥å…·
  <span class="hljs-string">"tailwind-merge"</span>,          <span class="hljs-regexp">//</span> Tailwindåˆå¹¶
  <span class="hljs-string">"date-fns"</span>,                <span class="hljs-regexp">//</span> æ—¥æœŸå¤„ç†
  <span class="hljs-string">"lodash"</span>,                  <span class="hljs-regexp">//</span> å·¥å…·å‡½æ•°
  // ... æ€»å…±<span class="hljs-number">30</span>+ä¸ªåŒ…
];

<span class="hljs-regexp">//</span> shadcn æ–¹å¼ï¼šä¸€è¡Œå‘½ä»¤
// pnpm dlx shadcn@latest add https:<span class="hljs-regexp">//</span>your-registry.com/r/ecommerce-package.json
</code></pre>
<h3 data-id="heading-23">ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ç”¨æˆ·ç®¡ç†é¡µé¢</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">DataTable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/data-table'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ui/button'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Input</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ui/input'</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">role</span>: <span class="hljs-string">'admin'</span> | <span class="hljs-string">'user'</span>;
  <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> | <span class="hljs-string">'inactive'</span>;
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">userColumns</span>: <span class="hljs-title class_">Column</span>&lt;<span class="hljs-title class_">User</span>&gt;[] = [
  {
    <span class="hljs-attr">key</span>: <span class="hljs-string">'name'</span>,
    <span class="hljs-attr">label</span>: <span class="hljs-string">'ç”¨æˆ·å'</span>,
    <span class="hljs-attr">sortable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">filterable</span>: <span class="hljs-literal">true</span>,
  },
  {
    <span class="hljs-attr">key</span>: <span class="hljs-string">'email'</span>, 
    <span class="hljs-attr">label</span>: <span class="hljs-string">'é‚®ç®±'</span>,
    <span class="hljs-attr">sortable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">filterable</span>: <span class="hljs-literal">true</span>,
  },
  {
    <span class="hljs-attr">key</span>: <span class="hljs-string">'role'</span>,
    <span class="hljs-attr">label</span>: <span class="hljs-string">'è§’è‰²'</span>,
    <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">px-2</span> <span class="hljs-attr">py-1</span> <span class="hljs-attr">rounded</span> <span class="hljs-attr">text-xs</span> ${
        <span class="hljs-attr">value</span> === <span class="hljs-string">'admin'</span> ? '<span class="hljs-attr">bg-purple-100</span> <span class="hljs-attr">text-purple-800</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">bg-blue-100</span> <span class="hljs-attr">text-blue-800</span>'
      }`}&gt;</span>
        {value === 'admin' ? 'ç®¡ç†å‘˜' : 'ç”¨æˆ·'}
      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>
    ),
  },
  {
    <span class="hljs-attr">key</span>: <span class="hljs-string">'status'</span>,
    <span class="hljs-attr">label</span>: <span class="hljs-string">'çŠ¶æ€'</span>,
    <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">px-2</span> <span class="hljs-attr">py-1</span> <span class="hljs-attr">rounded</span> <span class="hljs-attr">text-xs</span> ${
        <span class="hljs-attr">value</span> === <span class="hljs-string">'active'</span> ? '<span class="hljs-attr">bg-green-100</span> <span class="hljs-attr">text-green-800</span>' <span class="hljs-attr">:</span> '<span class="hljs-attr">bg-red-100</span> <span class="hljs-attr">text-red-800</span>'
      }`}&gt;</span>
        {value === 'active' ? 'æ¿€æ´»' : 'ç¦ç”¨'}
      <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></span>
    ),
  },
];

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserManagement</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [users, setUsers] = useState&lt;<span class="hljs-title class_">User</span>[]&gt;([]);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"p-6"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"flex justify-between items-center mb-6"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"text-2xl font-bold"</span>&gt;</span>ç”¨æˆ·ç®¡ç†<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>&gt;</span>æ·»åŠ ç”¨æˆ·<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">DataTable</span>
        <span class="hljs-attr">data</span>=<span class="hljs-string">{users}</span>
        <span class="hljs-attr">columns</span>=<span class="hljs-string">{userColumns}</span>
        <span class="hljs-attr">pageSize</span>=<span class="hljs-string">{20}</span>
        <span class="hljs-attr">onRowClick</span>=<span class="hljs-string">{(user)</span> =&gt;</span> navigate(`/users/${user.id}`)}
      /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-24">ğŸš€ éƒ¨ç½²ä¸åˆ†äº«</h2>
<h3 data-id="heading-25">GitHub Pages éƒ¨ç½²</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è‡ªåŠ¨éƒ¨ç½²è„šæœ¬</span>
{
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"bun next build"</span>,
    <span class="hljs-string">"export"</span>: <span class="hljs-string">"bun next export"</span>, 
    <span class="hljs-string">"deploy"</span>: <span class="hljs-string">"bun run build &amp;&amp; touch out/.nojekyll"</span>
  }
}

<span class="hljs-comment"># è®¿é—®åœ°å€</span>
<span class="hljs-comment"># ç»„ä»¶å±•ç¤º: https://erishen.github.io/shadcn-registry/</span>
<span class="hljs-comment"># Storybook: https://erishen.github.io/shadcn-registry/storybook/</span>
</code></pre>
<h3 data-id="heading-26">å®é™…åº”ç”¨æ¡ˆä¾‹</h3>
<p>æˆ‘ä»¬å·²ç»åœ¨Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ferishen%2Finterview" target="_blank" title="https://github.com/erishen/interview" ref="nofollow noopener noreferrer">interview</a>Â é¡¹ç›®ä¸­å®é™…éƒ¨ç½²äº†è¿™äº›ç»„ä»¶ï¼š</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è®¿é—®æ¼”ç¤ºé¡µé¢</span>
<span class="hljs-meta prompt_"># </span><span class="bash">https://web.erishen.cn/data-table-demo</span>
<span class="hljs-meta prompt_"># </span><span class="bash">æºç ä½ç½®ï¼šinterview/apps/web/src/app/[locale]/data-table-demo/page.tsx</span>
</code></pre>
<h3 data-id="heading-27">ç¤¾åŒºåˆ†äº«</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># å…¶ä»–å¼€å‘è€…å¯ä»¥è¿™æ ·ä½¿ç”¨ä½ çš„ç»„ä»¶</span>
pnpm dlx shadcn@latest <span class="hljs-keyword">add</span> https:<span class="hljs-comment">//erishen.github.io/shadcn-registry/r/data-table.json</span>

<span class="hljs-meta"># æˆ–è€…ä»æœ¬åœ°å¼€å‘</span>
pnpm dlx shadcn@latest <span class="hljs-keyword">add</span> http:<span class="hljs-comment">//localhost:3000/r/data-table.json</span>
</code></pre>
<h2 data-id="heading-28">ğŸ’¡ æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“</h2>
<h3 data-id="heading-29">1. shadcn çš„é©æ–°ç†å¿µ</h3>
<pre><code class="hljs language-css" lang="css">const shadcnAdvantages = {
  philosophy: <span class="hljs-string">"Copy and paste, not install"</span>,
  benefits: {
    no_dependencies: <span class="hljs-string">"æ— é¢å¤–ä¾èµ–ï¼Œå‡å°‘å†²çª"</span>,
    full_control: <span class="hljs-string">"å®Œå…¨å¯æ§ï¼Œå¯ä»¥ä»»æ„ä¿®æ”¹"</span>,
    tree_shaking: <span class="hljs-string">"ç²¾ç¡®çš„ä»£ç åˆ†å‰²"</span>,
    type_safe: <span class="hljs-string">"å®Œæ•´çš„ TypeScript æ”¯æŒ"</span>
  },
  installation: <span class="hljs-string">"ä¸€é”®å®‰è£…ï¼Œç±»ä¼¼åº”ç”¨å•†åº—"</span>,
  customization: <span class="hljs-string">"ç»„ä»¶ä»£ç ç›´æ¥å¤åˆ¶ï¼Œé¡¹ç›®å†…å¯æ§"</span>
};
</code></pre>
<h3 data-id="heading-30">2. Bun çš„æè‡´æ€§èƒ½</h3>
<pre><code class="hljs language-css" lang="css">const bunAdvantages = {
  performance: {
    install_speed: <span class="hljs-string">"10-20x faster than npm"</span>,
    dev_server: <span class="hljs-string">"7x faster startup"</span>,
    hot_reload: <span class="hljs-string">"70% faster reload"</span>,
    bundle_speed: <span class="hljs-string">"2x faster build"</span>
  },
  features: {
    native_performance: <span class="hljs-string">"åŸç”Ÿæ€§èƒ½ï¼Œæ—  Node.js å¼€é”€"</span>,
    web_apis: <span class="hljs-string">"å†…ç½® fetch, WebSocket, Streams"</span>,
    type_script: <span class="hljs-string">"åŸç”Ÿ TypeScript æ”¯æŒ"</span>,
    testing: <span class="hljs-string">"å†…ç½®æµ‹è¯•è¿è¡Œå™¨"</span>
  },
  developer_experience: {
    faster_feedback: <span class="hljs-string">"æ›´å¿«çš„å¼€å‘åé¦ˆ"</span>,
    less_waiting: <span class="hljs-string">"å‡å°‘ç­‰å¾…æ—¶é—´"</span>,
    better_caching: <span class="hljs-string">"æ™ºèƒ½ç¼“å­˜æœºåˆ¶"</span>
  }
};
</code></pre>
<h3 data-id="heading-31">3. ç»„ä»¶æ³¨å†Œè¡¨æ¨¡å¼</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> registryBenefits = {
  distribution: <span class="hljs-string">"ç»„ä»¶åˆ†å‘çš„æ–°æ¨¡å¼"</span>,
  accessibility: <span class="hljs-string">"ä¸€é”®å®‰è£…ï¼Œé™ä½ä½¿ç”¨é—¨æ§›"</span>, 
  customization: <span class="hljs-string">"æ”¯æŒè‡ªå®šä¹‰ç»„ä»¶åº“"</span>,
  community: <span class="hljs-string">"å¼€æºç¤¾åŒºçš„ç»„ä»¶å…±äº«"</span>,
  scalability: <span class="hljs-string">"æ”¯æŒå›¢é˜Ÿå†…éƒ¨ç»„ä»¶æ ‡å‡†åŒ–"</span>
};
</code></pre>
<h2 data-id="heading-32">ğŸ”® æœªæ¥å±•æœ›</h2>
<h3 data-id="heading-33">ç»„ä»¶ç”Ÿæ€çš„å‘å±•æ–¹å‘</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> futureVision = {
  registry_networks: <span class="hljs-string">"ç»„ä»¶æ³¨å†Œè¡¨ç½‘ç»œ"</span>,
  ai_assisted: <span class="hljs-string">"AI è¾…åŠ©ç»„ä»¶ç”Ÿæˆ"</span>,
  cross_platform: <span class="hljs-string">"è·¨å¹³å°ç»„ä»¶æ”¯æŒ"</span>,
  real_time_sync: <span class="hljs-string">"å®æ—¶ç»„ä»¶æ›´æ–°åŒæ­¥"</span>
};
</code></pre>
<h3 data-id="heading-34">å¯¹å‰ç«¯å¼€å‘çš„å½±å“</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> industryImpact = {
  development_speed: <span class="hljs-string">"å¼€å‘é€Ÿåº¦æå‡ 5-10 å€"</span>,
  learning_curve: <span class="hljs-string">"é™ä½ç»„ä»¶ä½¿ç”¨é—¨æ§›"</span>,
  code_quality: <span class="hljs-string">"æé«˜ä»£ç è´¨é‡å’Œä¸€è‡´æ€§"</span>,
  ecosystem: <span class="hljs-string">"æ¨åŠ¨ç»„ä»¶ç”Ÿæ€æ ‡å‡†åŒ–"</span>
};
</code></pre>
<h2 data-id="heading-35">ğŸ“š å»¶ä¼¸é˜…è¯»</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fui.shadcn.com%2F" target="_blank" title="https://ui.shadcn.com/" ref="nofollow noopener noreferrer">shadcn/ui å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fbun.sh%2F" target="_blank" title="https://bun.sh/" ref="nofollow noopener noreferrer">Bun å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ferishen.github.io%2Fshadcn-registry%2F" target="_blank" title="https://erishen.github.io/shadcn-registry/" ref="nofollow noopener noreferrer">shadcn-registry æ¼”ç¤º</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ferishen%2Fshadcn-registry" target="_blank" title="https://github.com/erishen/shadcn-registry" ref="nofollow noopener noreferrer">GitHub æºç </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ferishen.cn%2F%3Fp%3D192" target="_blank" title="https://erishen.cn/?p=192" ref="nofollow noopener noreferrer">ä¸ªäººåšå®¢æ·±åº¦è§£æ</a>Â - æ„å»ºç°ä»£åŒ–çš„ç»„ä»¶åº“ï¼šshadcn + Bun å¸¦æ¥çš„å‰ç«¯å¼€å‘é©å‘½</li>
</ul>
<hr/>
<p><strong>ğŸ’¡ è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†å‰ç«¯å¼€å‘çš„æ–°å¯èƒ½æ€§ï¼šé€šè¿‡ shadcn çš„ç†å¿µ + Bun çš„æ€§èƒ½ï¼Œæˆ‘ä»¬å¯ä»¥é‡æ–°å®šä¹‰å¼€å‘ä½“éªŒã€‚</strong></p>
<p><strong>ğŸš€ å¦‚æœä½ è§‰å¾—è¿™ç§æ–¹å¼æœ‰æ½œåŠ›ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„æƒ³æ³•ï¼</strong></p>
<p><strong>ğŸ”¥ æƒ³è¦ä½“éªŒæè‡´å¼€å‘æ•ˆç‡ï¼Ÿè¯•è¯• Bun + shadcn çš„ç»„åˆï¼</strong></p>
<hr/>
<p><em>ä½œè€…ï¼šerishen</em><br/>
<em>å‘å¸ƒæ—¶é—´ï¼š2024å¹´1æœˆ</em><br/>
<em>æ ‡ç­¾ï¼š#shadcn #Bun #Next.js #ç»„ä»¶åº“ #å¼€å‘æ•ˆç‡</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è®©å¤§æ¨¡å‹â€œè®°ä½ä½ â€ï¼šLangChain ä¸­çš„å¯¹è¯è®°å¿†æœºåˆ¶å®æˆ˜]]></title>    <link>https://juejin.cn/post/7591309945511051264</link>    <guid>https://juejin.cn/post/7591309945511051264</guid>    <pubDate>2026-01-04T14:21:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591309945511051264" data-draft-id="7590654280899936299" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è®©å¤§æ¨¡å‹â€œè®°ä½ä½ â€ï¼šLangChain ä¸­çš„å¯¹è¯è®°å¿†æœºåˆ¶å®æˆ˜"/> <meta itemprop="keywords" content="LangChain"/> <meta itemprop="datePublished" content="2026-01-04T14:21:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Zyx2007"/> <meta itemprop="url" content="https://juejin.cn/user/3924597867554890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è®©å¤§æ¨¡å‹â€œè®°ä½ä½ â€ï¼šLangChain ä¸­çš„å¯¹è¯è®°å¿†æœºåˆ¶å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3924597867554890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Zyx2007
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T14:21:34.000Z" title="Sun Jan 04 2026 14:21:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æœ¬è´¨ä¸Šæ˜¯æ— çŠ¶æ€çš„â€”â€”æ¯ä¸€æ¬¡ API è°ƒç”¨éƒ½åƒä¸€æ¬¡å…¨æ–°çš„å¯¹è¯ï¼Œæ¨¡å‹å¯¹ä¹‹å‰çš„äº¤äº’ä¸€æ— æ‰€çŸ¥ã€‚è¿™ç§è®¾è®¡è™½ä¿è¯äº†æ¥å£çš„ç®€æ´ä¸å¯æ‰©å±•æ€§ï¼Œå´ä¹Ÿå¸¦æ¥äº†æ˜æ˜¾çš„å±€é™ï¼š<strong>æ— æ³•æ”¯æŒå¤šè½®è¿è´¯çš„å¯¹è¯ä½“éªŒ</strong>ã€‚ç”¨æˆ·è¯´â€œæˆ‘å«å¼ ä¸‰â€ï¼Œä¸‹ä¸€å¥é—®â€œæˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿâ€ï¼Œè‹¥ä¸ä¼ é€’ä¸Šä¸‹æ–‡ï¼Œæ¨¡å‹åªèƒ½å›ç­”â€œæˆ‘ä¸çŸ¥é“â€ã€‚è¦è®© AI çœŸæ­£å…·å¤‡â€œè®°å¿†â€ï¼Œå¼€å‘è€…å¿…é¡»ä¸»åŠ¨ç»´æŠ¤å¯¹è¯å†å²ï¼Œå¹¶å°†å…¶ä½œä¸ºè¾“å…¥çš„ä¸€éƒ¨åˆ†ä¼ ç»™æ¨¡å‹ã€‚è€Œ LangChain æä¾›çš„ <code>RunnableWithMessageHistory</code> æœºåˆ¶ï¼Œæ­£æ˜¯è§£å†³è¿™ä¸€é—®é¢˜çš„å·¥ç¨‹åŒ–æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-0">æ— çŠ¶æ€è°ƒç”¨çš„å±€é™</h2>
<p>æœ€åŸºç¡€çš„ LLM è°ƒç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">res1</span> = await model.invoke(<span class="hljs-string">'æˆ‘å«å¼ ä¸‰ï¼Œå–œæ¬¢å–ç™½å…°åœ°'</span>)<span class="hljs-comment">;</span>
const <span class="hljs-attr">res2</span> = await model.invoke(<span class="hljs-string">'æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ'</span>)<span class="hljs-comment">;</span>
console.log(res2.content)<span class="hljs-comment">; // æ¨¡å‹æ— æ³•å›ç­”ï¼Œå› æ— ä¸Šä¸‹æ–‡</span>
</code></pre>
<p>ä¸¤æ¬¡è°ƒç”¨å½¼æ­¤ç‹¬ç«‹ï¼Œæ¨¡å‹æ— æ³•å»ºç«‹å…³è”ã€‚è¿™å°±åƒæ¯æ¬¡è§é¢éƒ½å¿˜è®°å¯¹æ–¹æ˜¯è°ï¼Œæ˜¾ç„¶æ— æ³•æ”¯æ’‘çœŸå®çš„å¯¹è¯åœºæ™¯ã€‚è¦å®ç°è¿è´¯äº¤äº’ï¼Œå¿…é¡»å°†ä¹‹å‰çš„å¯¹è¯è®°å½•ï¼ˆmessagesï¼‰ä¸€å¹¶ä¼ å…¥ã€‚</p>
<h2 data-id="heading-1">æ‰‹åŠ¨ç»´æŠ¤æ¶ˆæ¯å†å²ï¼šå¯è¡Œä½†ç¹ç</h2>
<p>ä¸€ç§æœ´ç´ çš„åšæ³•æ˜¯æ‰‹åŠ¨ç»´æŠ¤ä¸€ä¸ªæ¶ˆæ¯æ•°ç»„ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">messages</span> = [
  { role: <span class="hljs-string">'user'</span>, content: <span class="hljs-string">'æˆ‘å«å¼ ä¸‰ï¼Œå–œæ¬¢å–ç™½å…°åœ°'</span> },
  { role: <span class="hljs-string">'assistant'</span>, content: <span class="hljs-string">'å¥½çš„ï¼Œå¼ ä¸‰ï¼'</span> },
  { role: <span class="hljs-string">'user'</span>, content: <span class="hljs-string">'æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ'</span> }
]<span class="hljs-comment">;</span>
// å°† messages ä½œä¸º prompt çš„ä¸€éƒ¨åˆ†ä¼ ç»™æ¨¡å‹
</code></pre>
<p>ç„¶è€Œï¼Œè¿™ç§æ–¹å¼å­˜åœ¨æ˜æ˜¾é—®é¢˜ï¼šéšç€å¯¹è¯è½®æ¬¡å¢åŠ ï¼Œæ¶ˆæ¯é•¿åº¦å‘ˆâ€œæ»šé›ªçƒâ€å¼å¢é•¿ï¼Œè¿…é€Ÿæ¶ˆè€—å¤§é‡ tokenï¼Œä¸ä»…å¢åŠ æˆæœ¬ï¼Œè¿˜å¯èƒ½è¶…å‡ºæ¨¡å‹ä¸Šä¸‹æ–‡çª—å£é™åˆ¶ã€‚æ›´å…³é”®çš„æ˜¯ï¼Œ<strong>å¼€å‘è€…éœ€è‡ªè¡Œç®¡ç†å­˜å‚¨ã€æˆªæ–­ã€ä¼šè¯éš”ç¦»ç­‰é€»è¾‘</strong>ï¼Œææ˜“å‡ºé”™ã€‚</p>
<h2 data-id="heading-2">LangChain çš„è§£å†³æ–¹æ¡ˆï¼šå†…ç½®è®°å¿†æ¨¡å—</h2>
<p>LangChain é€šè¿‡ <code>RunnableWithMessageHistory</code> æŠ½è±¡ï¼Œå°†â€œå¸¦è®°å¿†çš„å¯¹è¯â€å°è£…ä¸ºä¸€ä¸ªå¯å¤ç”¨çš„è¿è¡Œå•å…ƒã€‚é…åˆ <code>InMemoryChatMessageHistory</code>ï¼Œå¯è½»æ¾å®ç°ä¼šè¯çº§è®°å¿†ï¼š</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">const</span> messageHistory = <span class="hljs-keyword">new</span> InMemoryChatMessageHistory();
<span class="hljs-keyword">const</span> chain = <span class="hljs-keyword">new</span> RunnableWithMessageHistory({
  runnable,
  getMessageHistory: <span class="hljs-keyword">async</span> () =&gt; messageHistory,
  inputMessagesKey: <span class="hljs-string">'input'</span>,
  historyMessagesKey: <span class="hljs-string">'history'</span>,
});
</code></pre>
<p>è¿™é‡Œï¼Œ<code>runnable</code> æ˜¯åŸå§‹çš„æç¤ºè¯+æ¨¡å‹é“¾ï¼Œè€Œ <code>RunnableWithMessageHistory</code> åœ¨å…¶å‰åè‡ªåŠ¨æ³¨å…¥å’Œæ›´æ–°å¯¹è¯å†å²ã€‚å¼€å‘è€…åªéœ€å…³æ³¨å½“å‰è¾“å…¥ï¼Œå†å²ç®¡ç†ç”±æ¡†æ¶è‡ªåŠ¨å®Œæˆã€‚</p>
<h2 data-id="heading-3">æ„å»ºå¸¦è®°å¿†çš„å¯¹è¯é“¾</h2>
<p>å®Œæ•´çš„æµç¨‹åŒ…å«ç³»ç»Ÿæç¤ºã€å†å²å ä½ç¬¦å’Œç”¨æˆ·è¾“å…¥ä¸‰éƒ¨åˆ†ï¼š</p>
<pre><code class="hljs language-css" lang="css">const prompt = ChatPromptTemplate<span class="hljs-selector-class">.fromMessages</span>(<span class="hljs-selector-attr">[  [<span class="hljs-string">'system'</span>, <span class="hljs-string">"ä½ æ˜¯ä¸€ä¸ªæœ‰è®°å¿†çš„åŠ©æ‰‹"</span>]</span>,
  <span class="hljs-selector-attr">[<span class="hljs-string">'placeholder'</span>, <span class="hljs-string">"{history}"</span>]</span>,
  <span class="hljs-selector-attr">[<span class="hljs-string">'human'</span>, <span class="hljs-string">"{input}"</span>]</span>
]);
</code></pre>
<ul>
<li><code>system</code> æ¶ˆæ¯è®¾å®šè§’è‰²ï¼›</li>
<li><code>{history}</code> å ä½ç¬¦ç”± LangChain è‡ªåŠ¨æ›¿æ¢ä¸ºè¿‡å¾€å¯¹è¯ï¼›</li>
<li><code>{input}</code> æ¥æ”¶å½“å‰ç”¨æˆ·æé—®ã€‚</li>
</ul>
<p>å½“è°ƒç”¨ <code>chain.invoke()</code> æ—¶ï¼Œæ¡†æ¶ä¼šï¼š</p>
<ol>
<li>ä» <code>messageHistory</code> è¯»å–å·²æœ‰æ¶ˆæ¯ï¼›</li>
<li>å°†å…¶æ’å…¥ <code>prompt</code> çš„ <code>{history}</code> ä½ç½®ï¼›</li>
<li>è°ƒç”¨æ¨¡å‹ç”Ÿæˆå›å¤ï¼›</li>
<li>å°†æ–°å¯¹è¯ï¼ˆç”¨æˆ·è¾“å…¥ + æ¨¡å‹å›å¤ï¼‰å­˜å› <code>messageHistory</code>ã€‚</li>
</ol>
<h2 data-id="heading-4">ä¼šè¯éš”ç¦»ä¸å®é™…æ•ˆæœ</h2>
<p>é€šè¿‡ <code>sessionId</code> å¯åŒºåˆ†ä¸åŒç”¨æˆ·çš„å¯¹è¯ä¸Šä¸‹æ–‡ï¼š</p>
<pre><code class="hljs language-css" lang="css">await chain<span class="hljs-selector-class">.invoke</span>({ <span class="hljs-selector-tag">input</span>: <span class="hljs-string">'æˆ‘å«å¼ ä¸‰...'</span> }, { configurable: { sessionId: <span class="hljs-string">'user123'</span> } });
await chain<span class="hljs-selector-class">.invoke</span>({ <span class="hljs-selector-tag">input</span>: <span class="hljs-string">'æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ'</span> }, { configurable: { sessionId: <span class="hljs-string">'user123'</span> } });
</code></pre>
<p>ç¬¬äºŒæ¬¡è°ƒç”¨æ—¶ï¼Œæ¨¡å‹èƒ½å‡†ç¡®å›ç­”â€œä½ å«å¼ ä¸‰â€ï¼Œå› ä¸ºå®ƒæ¥æ”¶åˆ°äº†å®Œæ•´çš„å¯¹è¯å†å²ã€‚æ•´ä¸ªè¿‡ç¨‹å¯¹å¼€å‘è€…é€æ˜ï¼Œæ— éœ€æ‰‹åŠ¨æ‹¼æ¥æ¶ˆæ¯ã€‚</p>
<h2 data-id="heading-5">å†…å­˜å­˜å‚¨çš„æƒè¡¡ä¸æ‰©å±•</h2>
<p>ç¤ºä¾‹ä¸­ä½¿ç”¨ <code>InMemoryChatMessageHistory</code> å°†å¯¹è¯æš‚å­˜äºå†…å­˜ï¼Œé€‚åˆæ¼”ç¤ºæˆ–çŸ­æœŸä¼šè¯ã€‚ä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸éœ€æ›¿æ¢ä¸ºæŒä¹…åŒ–å­˜å‚¨ï¼ˆå¦‚ Redisã€æ•°æ®åº“ï¼‰ï¼Œå¹¶é€šè¿‡è‡ªå®šä¹‰ <code>getMessageHistory</code> å‡½æ•°æŒ‰ <code>sessionId</code> åŠ è½½å†å²ã€‚LangChain çš„è®¾è®¡å…è®¸æ— ç¼åˆ‡æ¢åº•å±‚å­˜å‚¨ï¼Œä¿æŒä¸Šå±‚é€»è¾‘ä¸å˜ã€‚</p>
<p>æ­¤å¤–ï¼Œä¸ºé¿å… token è€—å°½ï¼Œè¿˜å¯ç»“åˆ<strong>æ‘˜è¦è®°å¿†</strong>ï¼ˆSummary Memoryï¼‰æˆ–<strong>æ»‘åŠ¨çª—å£</strong>ç­–ç•¥ï¼šå½“å†å²è¿‡é•¿æ—¶ï¼Œè‡ªåŠ¨å‹ç¼©æ—§å¯¹è¯æˆ–ä»…ä¿ç•™æœ€è¿‘ N è½®ã€‚è¿™äº›é«˜çº§åŠŸèƒ½åŒæ ·å¯é€šè¿‡ LangChain çš„ memory æ¨¡å—å®ç°ã€‚</p>
<h2 data-id="heading-6">å·¥ç¨‹ä»·å€¼ï¼šä»â€œé—®ç­”æœºâ€åˆ°â€œæ™ºèƒ½ä½“â€</h2>
<p>å¼•å…¥è®°å¿†æœºåˆ¶åï¼ŒAI åº”ç”¨çš„èƒ½åŠ›è¾¹ç•Œæ˜¾è‘—æ‹“å±•ï¼š</p>
<ul>
<li><strong>ä¸ªæ€§åŒ–æœåŠ¡</strong>ï¼šè®°ä½ç”¨æˆ·åå¥½ã€èº«ä»½ä¿¡æ¯ï¼›</li>
<li><strong>ä»»åŠ¡å»¶ç»­</strong>ï¼šåœ¨å¤šæ­¥éª¤æ“ä½œä¸­ä¿æŒä¸Šä¸‹æ–‡ï¼ˆå¦‚è®¢ç¥¨ã€è°ƒè¯•ï¼‰ï¼›</li>
<li><strong>æƒ…æ„Ÿè¿è´¯</strong>ï¼šç»´æŒè¯­æ°”ä¸é£æ ¼çš„ä¸€è‡´æ€§ã€‚</li>
</ul>
<p>æ›´é‡è¦çš„æ˜¯ï¼Œè¿™ç§èƒ½åŠ›ä»¥<strong>å£°æ˜å¼ã€æ¨¡å—åŒ–</strong>çš„æ–¹å¼é›†æˆï¼Œä¸ç ´ååŸæœ‰ä»£ç ç»“æ„ã€‚å¼€å‘è€…æ— éœ€é‡å†™æ•´ä¸ªè°ƒç”¨é€»è¾‘ï¼Œåªéœ€å°†æ™®é€šé“¾åŒ…è£…ä¸º <code>RunnableWithMessageHistory</code>ï¼Œå³å¯è·å¾—è®°å¿†èƒ½åŠ›ã€‚</p>
<h2 data-id="heading-7">ç»“è¯­</h2>
<p>è®©å¤§æ¨¡å‹â€œè®°ä½â€ç”¨æˆ·ï¼Œä¸æ˜¯é­”æ³•ï¼Œè€Œæ˜¯å·¥ç¨‹ã€‚LangChain é€šè¿‡æŠ½è±¡å¯¹è¯å†å²çš„ç®¡ç†ï¼Œå°†å¤æ‚çš„ä¸Šä¸‹æ–‡ç»´æŠ¤è½¬åŒ–ä¸ºç®€å•çš„é…ç½®é€‰é¡¹ã€‚è¿™ä¸ä»…é™ä½äº†å¤šè½®å¯¹è¯çš„å®ç°é—¨æ§›ï¼Œä¹Ÿä¸ºæ„å»ºçœŸæ­£æ™ºèƒ½ã€è¿è´¯ã€ä¸ªæ€§åŒ–çš„ AI åº”ç”¨é“ºå¹³äº†é“è·¯ã€‚åœ¨ AI ä»å·¥å…·èµ°å‘ä¼™ä¼´çš„è¿›ç¨‹ä¸­ï¼Œè®°å¿†ï¼Œæ­£æ˜¯å»ºç«‹ä¿¡ä»»ä¸æ·±åº¦äº¤äº’çš„ç¬¬ä¸€æ­¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[instanceof è¿ç®—ç¬¦çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•å®ç°]]></title>    <link>https://juejin.cn/post/7591130604430262312</link>    <guid>https://juejin.cn/post/7591130604430262312</guid>    <pubDate>2026-01-04T15:21:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591130604430262312" data-draft-id="7591330139083571215" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="instanceof è¿ç®—ç¬¦çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•å®ç°"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2026-01-04T15:21:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»£ç çŒäºº"/> <meta itemprop="url" content="https://juejin.cn/user/624972624037374"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            instanceof è¿ç®—ç¬¦çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Œå¦‚ä½•å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/624972624037374/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»£ç çŒäºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:21:03.000Z" title="Sun Jan 04 2026 15:21:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.Â <strong><code>instanceof</code>Â çš„åŸºæœ¬åŸç†</strong></h2>
<p><code>instanceof</code>Â è¿ç®—ç¬¦ç”¨äºæ£€æµ‹<strong>æ„é€ å‡½æ•°çš„Â <code>prototype</code>Â å±æ€§</strong>æ˜¯å¦å‡ºç°åœ¨<strong>æŸä¸ªå®ä¾‹å¯¹è±¡çš„åŸå‹é“¾</strong>ä¸Šã€‚</p>
<pre><code class="hljs language-js" lang="js">obj <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Constructor</span>
<span class="hljs-comment">// æ£€æŸ¥ Constructor.prototype æ˜¯å¦åœ¨ obj çš„åŸå‹é“¾ä¸Š</span>
</code></pre>
<h2 data-id="heading-1">2.Â <strong>JavaScript å†…éƒ¨å®ç°åŸç†</strong></h2>
<h3 data-id="heading-2"><strong>åŸå‹é“¾æŸ¥æ‰¾è¿‡ç¨‹ï¼š</strong></h3>
<ol>
<li>è·å–å¯¹è±¡çš„åŸå‹ï¼š<code>Object.getPrototypeOf(obj)</code></li>
<li>è·å–æ„é€ å‡½æ•°çš„åŸå‹ï¼š<code>Constructor.prototype</code></li>
<li>æ²¿ç€å¯¹è±¡çš„åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾ï¼Œçœ‹æ˜¯å¦èƒ½æ‰¾åˆ°æ„é€ å‡½æ•°çš„åŸå‹</li>
</ol>
<h3 data-id="heading-3"><strong>ä¼ªä»£ç è¡¨ç¤ºï¼š</strong></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">instanceof</span>(<span class="hljs-params">obj, Constructor</span>) {
    <span class="hljs-comment">// 1. åŸºæœ¬ç±»å‹ç›´æ¥è¿”å› false</span>
    <span class="hljs-keyword">if</span> (obj === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> obj !== <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 2. è·å–å¯¹è±¡çš„åŸå‹</span>
    <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(obj);
    
    <span class="hljs-comment">// 3. è·å–æ„é€ å‡½æ•°çš„åŸå‹</span>
    <span class="hljs-keyword">const</span> prototype = <span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
    
    <span class="hljs-comment">// 4. æ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾</span>
    <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (proto === prototype) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h2 data-id="heading-4">3.Â <strong>è‡ªå®šä¹‰å®ç°</strong></h2>
<h3 data-id="heading-5"><strong>å®Œæ•´çš„æ‰‹å†™å®ç°ï¼š</strong></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myInstanceof</span>(<span class="hljs-params">instance, Constructor</span>) {
    <span class="hljs-comment">// åŸºæœ¬ç±»å‹ç›´æ¥è¿”å› false</span>
    <span class="hljs-keyword">if</span> (instance === <span class="hljs-literal">null</span> || <span class="hljs-keyword">typeof</span> instance !== <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> instance !== <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// æ„é€ å‡½æ•°å¿…é¡»æ˜¯å‡½æ•°</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Constructor</span> !== <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Right-hand side of instanceof is not callable'</span>);
    }
    
    <span class="hljs-comment">// è·å–æ„é€ å‡½æ•°çš„åŸå‹</span>
    <span class="hljs-keyword">const</span> prototype = <span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
    
    <span class="hljs-comment">// è·å–å®ä¾‹çš„åŸå‹</span>
    <span class="hljs-keyword">let</span> proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(instance);
    
    <span class="hljs-comment">// æ²¿ç€åŸå‹é“¾å‘ä¸ŠæŸ¥æ‰¾</span>
    <span class="hljs-keyword">while</span> (proto !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (proto === prototype) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        proto = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(proto);
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h3 data-id="heading-6"><strong>ä½¿ç”¨ç¤ºä¾‹ï¼š</strong></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// æµ‹è¯•ç”¨ä¾‹</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Student</span>(<span class="hljs-params">name, grade</span>) {
    <span class="hljs-title class_">Person</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">grade</span> = grade;
}

<span class="hljs-comment">// è®¾ç½®åŸå‹ç»§æ‰¿</span>
<span class="hljs-title class_">Student</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Student</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Student</span>;

<span class="hljs-keyword">const</span> stu = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">'Alice'</span>, <span class="hljs-number">90</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">myInstanceof</span>(stu, <span class="hljs-title class_">Student</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">myInstanceof</span>(stu, <span class="hljs-title class_">Person</span>));   <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">myInstanceof</span>(stu, <span class="hljs-title class_">Object</span>));   <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">myInstanceof</span>(stu, <span class="hljs-title class_">Array</span>));    <span class="hljs-comment">// false</span>

<span class="hljs-comment">// è¾¹ç•Œæƒ…å†µæµ‹è¯•</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">myInstanceof</span>(<span class="hljs-literal">null</span>, <span class="hljs-title class_">Object</span>));  <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">myInstanceof</span>(<span class="hljs-literal">undefined</span>, <span class="hljs-title class_">Object</span>)); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">myInstanceof</span>(<span class="hljs-number">123</span>, <span class="hljs-title class_">Number</span>));   <span class="hljs-comment">// false (åŸå§‹ç±»å‹)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">myInstanceof</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Number</span>(<span class="hljs-number">123</span>), <span class="hljs-title class_">Number</span>)); <span class="hljs-comment">// true (å¯¹è±¡ç±»å‹)</span>
</code></pre>
<h2 data-id="heading-7">4.Â <strong>ç‰¹æ®Šæƒ…å†µä¸æ³¨æ„äº‹é¡¹</strong></h2>
<h3 data-id="heading-8"><strong>åŸºæœ¬ç±»å‹æ£€æµ‹ï¼š</strong></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// åŸå§‹ç±»å‹</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'str'</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">String</span>);     <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(<span class="hljs-string">'str'</span>) <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">String</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// ä½¿ç”¨ Object() åŒ…è£…</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>(<span class="hljs-string">'str'</span>) <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">String</span>); <span class="hljs-comment">// true</span>
</code></pre>
<h3 data-id="heading-9"><strong>è¾¹ç•Œæƒ…å†µï¼š</strong></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. æ„é€ å‡½æ•°ä¸æ˜¯å‡½æ•°</span>
<span class="hljs-keyword">try</span> {
    [] <span class="hljs-keyword">instanceof</span> {};  <span class="hljs-comment">// TypeError: Right-hand side of 'instanceof' is not callable</span>
} <span class="hljs-keyword">catch</span>(e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">message</span>);
}

<span class="hljs-comment">// 2. ä¿®æ”¹æ„é€ å‡½æ•°çš„ prototype</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Foo</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Foo</span>();

<span class="hljs-comment">// ä¿®æ”¹å‰</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Foo</span>);  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// ä¿®æ”¹åŸå‹</span>
<span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {};

<span class="hljs-comment">// ä¿®æ”¹å</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Foo</span>);  <span class="hljs-comment">// false (å› ä¸º obj.__proto__ æŒ‡å‘çš„æ˜¯æ—§çš„ Foo.prototype)</span>
</code></pre>
<h3 data-id="heading-10"><strong>Symbol.hasInstance è‡ªå®šä¹‰è¡Œä¸ºï¼š</strong></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span> {
    <span class="hljs-keyword">static</span> [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">hasInstance</span>](instance) {
        <span class="hljs-comment">// è‡ªå®šä¹‰ instanceof è¡Œä¸º</span>
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(instance);
    }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyClass</span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>({} <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">MyClass</span>);  <span class="hljs-comment">// false</span>
</code></pre>
<h2 data-id="heading-11">5.Â <strong>æ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬</strong></h2>
<p>å¯¹äºé«˜é¢‘ä½¿ç”¨åœºæ™¯ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">fastInstanceof</span>(<span class="hljs-params">instance, Constructor</span>) {
    <span class="hljs-comment">// å¿«é€Ÿå¤±è´¥æ¡ä»¶</span>
    <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span> || 
        <span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Constructor</span> !== <span class="hljs-string">'function'</span> ||
        <span class="hljs-keyword">typeof</span> instance !== <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> instance !== <span class="hljs-string">'function'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// ç¼“å­˜åŸå‹ï¼Œå‡å°‘å±æ€§è®¿é—®</span>
    <span class="hljs-keyword">const</span> prototype = <span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
    
    <span class="hljs-comment">// ä½¿ç”¨ while å¾ªç¯ï¼Œæ¯”é€’å½’æ€§èƒ½æ›´å¥½</span>
    <span class="hljs-keyword">let</span> proto = instance.<span class="hljs-property">__proto__</span>;  <span class="hljs-comment">// æˆ– Object.getPrototypeOf(instance)</span>
    
    <span class="hljs-keyword">while</span> (proto) {
        <span class="hljs-keyword">if</span> (proto === prototype) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        proto = proto.<span class="hljs-property">__proto__</span>;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h2 data-id="heading-12">6.Â <strong>ä¸Â <code>typeof</code>Â å’ŒÂ <code>isPrototypeOf</code>Â çš„åŒºåˆ«</strong></h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// instanceof æ£€æŸ¥åŸå‹é“¾</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>);      <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>);     <span class="hljs-comment">// true</span>

<span class="hljs-comment">// typeof æ£€æŸ¥åŸå§‹ç±»å‹</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> []);                <span class="hljs-comment">// "object"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {});     <span class="hljs-comment">// "function"</span>

<span class="hljs-comment">// isPrototypeOf ä»åŸå‹è§’åº¦æ£€æŸ¥</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-title function_">isPrototypeOf</span>([]));   <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-title function_">isPrototypeOf</span>([]));  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// ä¸‰è€…çš„å…³ç³»</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">checkType</span>(<span class="hljs-params">value</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span> &amp;&amp; value !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value)) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Array'</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">'Date'</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">RegExp</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-string">'RegExp'</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">'Object'</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value;
}
</code></pre>
<h2 data-id="heading-13">7.Â <strong>å®é™…åº”ç”¨åœºæ™¯</strong></h2>
<h3 data-id="heading-14"><strong>ç±»å‹å®‰å…¨æ£€æŸ¥ï¼š</strong></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">processData</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">if</span> (!(data <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypeError</span>(<span class="hljs-string">'Expected an array'</span>);
    }
    <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item * <span class="hljs-number">2</span>);
}

<span class="hljs-comment">// æˆ–è€…æ›´å‹å¥½çš„ç‰ˆæœ¬</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">safeProcess</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(data)) {
        <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item * <span class="hljs-number">2</span>);
    }
    <span class="hljs-keyword">return</span> [];
}
</code></pre>
<h3 data-id="heading-15"><strong>å¤šé‡ç»§æ‰¿æ£€æµ‹ï¼š</strong></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Mammal</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {}
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Mammal</span> {}

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>();

<span class="hljs-comment">// æ£€æµ‹ç»§æ‰¿é“¾</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Dog</span>);      <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Mammal</span>);   <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Animal</span>);   <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>);   <span class="hljs-comment">// true</span>
</code></pre>
<h3 data-id="heading-16"><strong>å·¥å‚å‡½æ•°ç±»å‹æ£€æµ‹ï¼š</strong></h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createShape</span>(<span class="hljs-params">type</span>) {
    <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'circle'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Circle</span>();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === <span class="hljs-string">'square'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Square</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Shape</span>();
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">shape</span>) {
    <span class="hljs-keyword">if</span> (shape <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Circle</span>) {
        <span class="hljs-title function_">drawCircle</span>(shape);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (shape <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Square</span>) {
        <span class="hljs-title function_">drawSquare</span>(shape);
    }
}
</code></pre>
<h2 data-id="heading-17">8.Â <strong>æ³¨æ„äº‹é¡¹</strong></h2>
<ol>
<li><strong><code>instanceof</code>Â ä¸è·¨çª—å£/iframe é—®é¢˜ï¼š</strong></li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä¸åŒ iframe ä¸­çš„ Array æ„é€ å‡½æ•°ä¸ç›¸ç­‰</span>
<span class="hljs-keyword">const</span> iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'iframe'</span>);
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(iframe);
<span class="hljs-keyword">const</span> iframeArray = iframe.<span class="hljs-property">contentWindow</span>.<span class="hljs-property">Array</span>;
<span class="hljs-keyword">const</span> arr = <span class="hljs-keyword">new</span> <span class="hljs-title function_">iframeArray</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arr <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>);          <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(arr));           <span class="hljs-comment">// true (æ›´å®‰å…¨)</span>
</code></pre>
<ol start="2">
<li><strong>ä½¿ç”¨Â <code>Symbol.hasInstance</code>Â æ”¹å˜è¡Œä¸ºï¼š</strong></li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PrimitiveNumber</span> {
    <span class="hljs-keyword">static</span> [<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">hasInstance</span>](x) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> x === <span class="hljs-string">'number'</span>;
    }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">123</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">PrimitiveNumber</span>);  <span class="hljs-comment">// true</span>
</code></pre>
<ol start="3">
<li><strong>ä¼˜å…ˆä½¿ç”¨å†…ç½®æ–¹æ³•ï¼š</strong></li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// æ›´å¥½çš„æ•°ç»„æ£€æµ‹</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>([]));  <span class="hljs-comment">// true (æ¨è)</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// æ›´å¥½çš„åŸå§‹ç±»å‹æ£€æµ‹</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-number">123</span> === <span class="hljs-string">'number'</span>);  <span class="hljs-comment">// æ¨è</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">123</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Number</span>);    <span class="hljs-comment">// ä¸æ¨è</span>
</code></pre>
<h2 data-id="heading-18"><strong>æ€»ç»“</strong></h2>
<p><code>instanceof</code>Â çš„æ ¸å¿ƒåŸç†æ˜¯<strong>åŸå‹é“¾æŸ¥æ‰¾</strong>ã€‚å®ƒçš„å®ç°æ¶‰åŠï¼š</p>
<ol>
<li>è·å–å¯¹è±¡çš„åŸå‹é“¾</li>
<li>æŸ¥æ‰¾æ„é€ å‡½æ•°çš„Â <code>prototype</code>Â å±æ€§æ˜¯å¦åœ¨åŸå‹é“¾ä¸Š</li>
<li>æ²¿ç€åŸå‹é“¾å‘ä¸Šé€’å½’æŸ¥æ‰¾</li>
</ol>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼š</p>
<ul>
<li>ä½¿ç”¨Â <code>instanceof</code>Â æ£€æµ‹<strong>è‡ªå®šä¹‰å¯¹è±¡ç±»å‹</strong></li>
<li>ä½¿ç”¨Â <code>Array.isArray()</code>Â æ£€æµ‹æ•°ç»„</li>
<li>ä½¿ç”¨Â <code>typeof</code>Â æ£€æµ‹åŸå§‹ç±»å‹</li>
<li>æ³¨æ„è·¨çª—å£/iframe çš„ç¯å¢ƒé—®é¢˜</li>
<li>å¯ä»¥ä½¿ç”¨Â <code>Symbol.hasInstance</code>Â è‡ªå®šä¹‰æ£€æµ‹é€»è¾‘</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Verceléƒ¨ç½²å…¨æ”»ç•¥:ä»GitHubåˆ°ä¸Šçº¿,10åˆ†é’Ÿè®©ä½ çš„å‰ç«¯é¡¹ç›®å…è´¹æ‹¥æœ‰è‡ªå·±çš„åŸŸå]]></title>    <link>https://juejin.cn/post/7591309945511165952</link>    <guid>https://juejin.cn/post/7591309945511165952</guid>    <pubDate>2026-01-04T14:57:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591309945511165952" data-draft-id="7591075684066574351" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Verceléƒ¨ç½²å…¨æ”»ç•¥:ä»GitHubåˆ°ä¸Šçº¿,10åˆ†é’Ÿè®©ä½ çš„å‰ç«¯é¡¹ç›®å…è´¹æ‹¥æœ‰è‡ªå·±çš„åŸŸå"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,Node.js"/> <meta itemprop="datePublished" content="2026-01-04T14:57:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†¬å¥‡Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Verceléƒ¨ç½²å…¨æ”»ç•¥:ä»GitHubåˆ°ä¸Šçº¿,10åˆ†é’Ÿè®©ä½ çš„å‰ç«¯é¡¹ç›®å…è´¹æ‹¥æœ‰è‡ªå·±çš„åŸŸå
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†¬å¥‡Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T14:57:49.000Z" title="Sun Jan 04 2026 14:57:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»14åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å†™åœ¨å‰é¢</h2>
<p>ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™æ ·çš„æƒ…å†µ:</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">ä½ : ç†¬å¤œåšäº†ä¸ªé…·ç‚«çš„å‰ç«¯é¡¹ç›®</span>
<span class="hljs-section">æœ‹å‹: èƒ½ç»™æˆ‘çœ‹çœ‹å—?</span>
<span class="hljs-section">ä½ : å‘ƒ...ä½ å…ˆåœ¨æœ¬åœ°cloneä¸‹æ¥,ç„¶ånpm install,å†npm run dev...</span>
<span class="hljs-section">æœ‹å‹: ç®—äº†ç®—äº† (è½¬èº«ç¦»å¼€)</span>
</code></pre>
<p>è¿™å°±æ˜¯<strong>æ²¡æœ‰éƒ¨ç½²ä¸Šçº¿</strong>çš„å°´å°¬ã€‚ä½ è¾›è¾›è‹¦è‹¦å†™çš„ä»£ç ,èººåœ¨GitHubä»“åº“é‡Œæ— äººé—®æ´¥,æƒ³å±•ç¤ºç»™åˆ«äººçœ‹è¿˜å¾—è®©å¯¹æ–¹æ­å»ºå¼€å‘ç¯å¢ƒã€‚</p>
<p>ä»Šå¤©è¿™ç¯‡æ–‡ç« ,æˆ‘å°†æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•ç”¨<strong>Vercel</strong>æŠŠä½ çš„å‰ç«¯é¡¹ç›®éƒ¨ç½²åˆ°å…¬ç½‘,è®©ä»»ä½•äººéƒ½èƒ½é€šè¿‡ä¸€ä¸ªé“¾æ¥è®¿é—®ä½ çš„ä½œå“ã€‚æœ€é‡è¦çš„æ˜¯:<strong>å®Œå…¨å…è´¹,æ— éœ€æœåŠ¡å™¨,10åˆ†é’Ÿæå®š!</strong></p>
<h2 data-id="heading-1">ä¸ºä»€ä¹ˆé€‰æ‹©Vercel?</h2>
<p>åœ¨ä¼—å¤šå‰ç«¯éƒ¨ç½²å¹³å°ä¸­(Netlifyã€GitHub Pagesã€Cloudflare Pagesç­‰),æˆ‘ä¸ºä»€ä¹ˆæ¨èVercel?</p>
<h3 data-id="heading-2">Vercelçš„æ ¸å¿ƒä¼˜åŠ¿</h3>





















































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="center">Vercel</th><th align="center">GitHub Pages</th><th align="center">ä¼ ç»ŸæœåŠ¡å™¨</th></tr></thead><tbody><tr><td align="left"><strong>å…è´¹é¢åº¦</strong></td><td align="center">â­â­â­â­â­ ä¸ªäººç”¨è¶³å¤Ÿ</td><td align="center">â­â­â­â­ é™æ€ç½‘ç«™</td><td align="center">âŒ éœ€ä»˜è´¹</td></tr><tr><td align="left"><strong>éƒ¨ç½²é€Ÿåº¦</strong></td><td align="center">â­â­â­â­â­ ç§’çº§</td><td align="center">â­â­â­ åˆ†é’Ÿçº§</td><td align="center">â­â­ éœ€æ‰‹åŠ¨</td></tr><tr><td align="left"><strong>CDNåŠ é€Ÿ</strong></td><td align="center">âœ… å…¨çƒCDN</td><td align="center">âœ… GitHub CDN</td><td align="center">âŒ éœ€è‡ªå·±é…ç½®</td></tr><tr><td align="left"><strong>è‡ªåŠ¨éƒ¨ç½²</strong></td><td align="center">âœ… Gitæ¨é€å³éƒ¨ç½²</td><td align="center">âœ… æ¨é€åˆ°gh-pages</td><td align="center">âŒ éœ€CI/CD</td></tr><tr><td align="left"><strong>ç¯å¢ƒå˜é‡</strong></td><td align="center">âœ… æ”¯æŒ</td><td align="center">âŒ ä¸æ”¯æŒ</td><td align="center">âœ… æ”¯æŒ</td></tr><tr><td align="left"><strong>è‡ªå®šä¹‰åŸŸå</strong></td><td align="center">âœ… å…è´¹SSL</td><td align="center">âœ… å…è´¹SSL</td><td align="center">âœ… éœ€è‡ªå·±é…ç½®SSL</td></tr><tr><td align="left"><strong>æ¡†æ¶æ”¯æŒ</strong></td><td align="center">â­â­â­â­â­ æ™ºèƒ½è¯†åˆ«</td><td align="center">â­â­ ä»…é™æ€</td><td align="center">â­â­â­â­ ä»»æ„</td></tr></tbody></table>
<p><strong>æœ€å¤§äº®ç‚¹:</strong></p>
<ul>
<li>âœ… <strong>é›¶é…ç½®éƒ¨ç½²</strong> - è‡ªåŠ¨è¯†åˆ«Next.jsã€Reactã€Vueç­‰æ¡†æ¶</li>
<li>âœ… <strong>å…¨çƒCDN</strong> - è®¿é—®é€Ÿåº¦é£å¿«</li>
<li>âœ… <strong>é¢„è§ˆç¯å¢ƒ</strong> - æ¯ä¸ªPRéƒ½æœ‰ç‹¬ç«‹é¢„è§ˆURL</li>
<li>âœ… <strong>å›æ»šæœºåˆ¶</strong> - ä¸€é”®å›é€€åˆ°ä»»æ„å†å²ç‰ˆæœ¬</li>
</ul>
<blockquote>
<p>ğŸ’¡ <strong>æˆ‘è¸©è¿‡çš„å‘</strong>: åˆšå¼€å§‹æˆ‘ç”¨ä¼ ç»ŸVPSéƒ¨ç½²å‰ç«¯,æ¯æ¬¡æ›´æ–°éƒ½è¦SSHç™»å½•ã€git pullã€npm buildã€é‡å¯Nginx...çƒ¦ä¸èƒœçƒ¦ã€‚æ¢åˆ°Vercelå,åªéœ€<code>git push</code>,å‰©ä¸‹çš„å…¨è‡ªåŠ¨!</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">å‰ç½®å‡†å¤‡:ä½ éœ€è¦ä»€ä¹ˆ?</h2>
<p>åœ¨å¼€å§‹ä¹‹å‰,è¯·ç¡®ä¿ä½ å·²ç»å‡†å¤‡å¥½:</p>
<h3 data-id="heading-4">å¿…å¤‡æ¡ä»¶</h3>
<pre><code class="hljs language-markdown" lang="markdown">âœ… ä¸€ä¸ªGitHubè´¦å·
âœ… ä¸€ä¸ªå‰ç«¯é¡¹ç›®(React/Vue/Next.jsç­‰)
âœ… é¡¹ç›®ä»£ç å·²æ¨é€åˆ°GitHubä»“åº“
âœ… (å¯é€‰)ä¸€ä¸ªè‡ªå·±çš„åŸŸå
</code></pre>
<h3 data-id="heading-5">æ”¯æŒçš„å‰ç«¯æ¡†æ¶</h3>
<p>Vercelå¯¹ä»¥ä¸‹æ¡†æ¶æœ‰<strong>åŸç”Ÿæ”¯æŒ</strong>,å¯ä»¥é›¶é…ç½®éƒ¨ç½²:</p>
<ul>
<li><strong>Next.js</strong> - Verceläº²å„¿å­,å®Œç¾æ”¯æŒ</li>
<li><strong>React</strong> (Create React App, Vite)</li>
<li><strong>Vue</strong> (Vue CLI, Vite)</li>
<li><strong>Angular</strong></li>
<li><strong>Svelte</strong></li>
<li><strong>Nuxt.js</strong></li>
<li><strong>çº¯é™æ€HTML/CSS/JS</strong></li>
</ul>
<hr/>
<h2 data-id="heading-6">ç¬¬ä¸€æ­¥:æ³¨å†ŒVercelè´¦å·</h2>
<h3 data-id="heading-7">1.1 è®¿é—®Vercelå®˜ç½‘</h3>
<p>æ‰“å¼€æµè§ˆå™¨,è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com" target="_blank" title="https://vercel.com" ref="nofollow noopener noreferrer">vercel.com</a></p>
<p><em>Vercelå®˜ç½‘é¦–é¡µ,ç‚¹å‡»å³ä¸Šè§’çš„"Sign Up"æŒ‰é’®</em></p>
<h3 data-id="heading-8">1.2 ä½¿ç”¨GitHubè´¦å·ç™»å½•</h3>
<p><strong>å¼ºçƒˆæ¨èä½¿ç”¨GitHubè´¦å·ç™»å½•</strong>,è¿™æ ·å¯ä»¥ç›´æ¥æˆæƒè®¿é—®ä½ çš„ä»“åº“,çœå»åç»­è¿æ¥çš„éº»çƒ¦ã€‚</p>
<p>ç‚¹å‡» <strong>"Continue with GitHub"</strong>:</p>
<p><em>é€‰æ‹©GitHubç™»å½•æ–¹å¼</em></p>
<h3 data-id="heading-9">1.3 æˆæƒVercelè®¿é—®GitHub</h3>
<p>é¦–æ¬¡ç™»å½•æ—¶,GitHubä¼šè¦æ±‚ä½ æˆæƒVercelè®¿é—®ä½ çš„ä»“åº“ã€‚</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">æˆæƒèŒƒå›´:</span>
âœ… è¯»å–ä»“åº“åˆ—è¡¨
âœ… è¯»å–ä»“åº“ä»£ç 
âœ… æ·»åŠ éƒ¨ç½²çŠ¶æ€(åœ¨PRä¸­æ˜¾ç¤ºéƒ¨ç½²é¢„è§ˆ)
</code></pre>
<p>ç‚¹å‡» <strong>"Authorize Vercel"</strong> å®Œæˆæˆæƒ:</p>
<p><em>æˆæƒVercelè®¿é—®ä½ çš„GitHubä»“åº“</em></p>
<blockquote>
<p>âš ï¸ <strong>éšç§è¯´æ˜</strong>: Vercelåªä¼šè¯»å–ä½ ä¸»åŠ¨å¯¼å…¥çš„ä»“åº“,ä¸ä¼šè®¿é—®å…¶ä»–ç§æœ‰ä»“åº“ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-10">ç¬¬äºŒæ­¥:å¯¼å…¥GitHubé¡¹ç›®åˆ°Vercel</h2>
<h3 data-id="heading-11">2.1 è¿›å…¥é¡¹ç›®å¯¼å…¥é¡µé¢</h3>
<p>ç™»å½•æˆåŠŸå,ä½ ä¼šçœ‹åˆ°Vercelçš„Dashboardã€‚ç‚¹å‡» <strong>"Add New..."</strong> â†’ <strong>"Project"</strong>:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a23a19dc42d42bf913705808898ed61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768143469&amp;x-signature=VkM1MOj44qrXPMft3wtZbOWjai4%3D" alt="vercel-add-project.png" loading="lazy"/></p>
<p><em>Dashboardé¡µé¢,ç‚¹å‡»æ·»åŠ æ–°é¡¹ç›®</em></p>
<h3 data-id="heading-12">2.2 é€‰æ‹©è¦éƒ¨ç½²çš„ä»“åº“</h3>
<p>Vercelä¼šåˆ—å‡ºä½ GitHubè´¦å·ä¸‹çš„æ‰€æœ‰ä»“åº“ã€‚æ‰¾åˆ°ä½ æƒ³éƒ¨ç½²çš„é¡¹ç›®,ç‚¹å‡» <strong>"Import"</strong>:</p>
<p><em>ä»GitHubä»“åº“åˆ—è¡¨ä¸­é€‰æ‹©é¡¹ç›®</em></p>
<p><strong>æ‰¾ä¸åˆ°ä½ çš„ä»“åº“?</strong></p>
<p>å¯èƒ½æœ‰ä»¥ä¸‹åŸå› :</p>
<pre><code class="hljs language-markdown" lang="markdown">âŒ ä»“åº“æ˜¯ç§æœ‰çš„,ä½†æœªæˆæƒVercelè®¿é—®
   â†’ è§£å†³: å»GitHub Settingsé‡æ–°æˆæƒ

âŒ ä»“åº“å±äºOrganization,éœ€è¦é¢å¤–æˆæƒ
   â†’ è§£å†³: åœ¨Organizationè®¾ç½®ä¸­æˆæƒVercel

âŒ ä»“åº“åç§°è¢«æœç´¢æ¡†è¿‡æ»¤äº†
   â†’ è§£å†³: æ¸…ç©ºæœç´¢æ¡†æˆ–æ‰‹åŠ¨è¾“å…¥ä»“åº“å
</code></pre>
<h3 data-id="heading-13">2.3 é…ç½®é¡¹ç›®è®¾ç½®</h3>
<p>å¯¼å…¥é¡¹ç›®å,ä¼šè¿›å…¥é…ç½®é¡µé¢ã€‚Vercelä¼š<strong>è‡ªåŠ¨æ£€æµ‹</strong>ä½ çš„é¡¹ç›®ç±»å‹å’Œæ„å»ºå‘½ä»¤ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abe1ac6dacc1432b95807d6e6d4e0e5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768143469&amp;x-signature=%2BYgoV1v9uwAsYXMz40Qbx3GEw0s%3D" alt="vercel-project-config.png" loading="lazy"/></p>
<p><em>Vercelè‡ªåŠ¨æ£€æµ‹åˆ°çš„é¡¹ç›®é…ç½®</em></p>
<h4 data-id="heading-14">æ ¸å¿ƒé…ç½®é¡¹è¯´æ˜</h4>
<p><strong>1. Project Name (é¡¹ç›®åç§°)</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">é»˜è®¤: ä½ çš„GitHubä»“åº“å</span>
<span class="hljs-section">ç”¨é€”: å†³å®šé»˜è®¤çš„vercelåŸŸå (å¦‚ my-app.vercel.app)</span>

<span class="hljs-section">å»ºè®®: ä½¿ç”¨ç®€æ´ã€æœ‰æ„ä¹‰çš„åç§°</span>
</code></pre>
<p><strong>2. Framework Preset (æ¡†æ¶é¢„è®¾)</strong></p>
<p>Vercelä¼šè‡ªåŠ¨è¯†åˆ«ä½ çš„æ¡†æ¶:</p>

























<table><thead><tr><th align="left">æ£€æµ‹åˆ°çš„æ¡†æ¶</th><th align="left">è‡ªåŠ¨é…ç½®</th></tr></thead><tbody><tr><td align="left">Next.js</td><td align="left">Build: <code>next build</code>, Output: <code>.next</code></td></tr><tr><td align="left">Create React App</td><td align="left">Build: <code>npm run build</code>, Output: <code>build</code></td></tr><tr><td align="left">Vite</td><td align="left">Build: <code>npm run build</code>, Output: <code>dist</code></td></tr><tr><td align="left">Vue CLI</td><td align="left">Build: <code>npm run build</code>, Output: <code>dist</code></td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ <strong>æ™ºèƒ½è¯†åˆ«</strong>: Vercelä¼šè¯»å–ä½ çš„<code>package.json</code>æ¥åˆ¤æ–­æ¡†æ¶ç±»å‹ã€‚</p>
</blockquote>
<p><strong>3. Root Directory (æ ¹ç›®å½•)</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">é»˜è®¤: ./</span>
<span class="hljs-section">ç”¨é€”: å¦‚æœä½ çš„å‰ç«¯ä»£ç åœ¨å­ç›®å½•(å¦‚monorepo),åœ¨è¿™é‡ŒæŒ‡å®š</span>

<span class="hljs-section">ç¤ºä¾‹:</span>
monorepo-project/
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ frontend/   â† å‰ç«¯ä»£ç åœ¨è¿™é‡Œ
â”‚   â””â”€â”€ backend/
â””â”€â”€ package.json

<span class="hljs-section">é…ç½®: ./packages/frontend</span>
</code></pre>
<p><strong>4. Build Command (æ„å»ºå‘½ä»¤)</strong></p>
<p>è¿™æ˜¯æœ€é‡è¦çš„é…ç½®!Vercelä¼šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤æ¥æ„å»ºä½ çš„é¡¹ç›®ã€‚</p>
<p><strong>å¸¸è§æ¡†æ¶çš„æ„å»ºå‘½ä»¤:</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Next.js</span>
next build

<span class="hljs-comment"># Create React App</span>
npm run build

<span class="hljs-comment"># Vite (React/Vue)</span>
vite build
<span class="hljs-comment"># æˆ–</span>
npm run build

<span class="hljs-comment"># Vue CLI</span>
vue-cli-service build

<span class="hljs-comment"># è‡ªå®šä¹‰è„šæœ¬</span>
npm run build:prod
</code></pre>
<p><strong>å¦‚ä½•ç¡®è®¤ä½ çš„æ„å»ºå‘½ä»¤?</strong></p>
<p>æ‰“å¼€é¡¹ç›®çš„<code>package.json</code>,æŸ¥çœ‹<code>scripts</code>å­—æ®µ:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>    â† è¿™å°±æ˜¯æ„å»ºå‘½ä»¤
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>åœ¨Vercelé…ç½®ä¸­å¡«å†™: <code>npm run build</code></p>
<p><strong>5. Output Directory (è¾“å‡ºç›®å½•)</strong></p>
<p>æ„å»ºå®Œæˆå,é™æ€æ–‡ä»¶çš„è¾“å‡ºä½ç½®ã€‚</p>
<p><strong>å¸¸è§æ¡†æ¶çš„è¾“å‡ºç›®å½•:</strong></p>





























<table><thead><tr><th align="left">æ¡†æ¶</th><th align="left">é»˜è®¤è¾“å‡ºç›®å½•</th></tr></thead><tbody><tr><td align="left">Next.js</td><td align="left"><code>.next</code></td></tr><tr><td align="left">Create React App</td><td align="left"><code>build</code></td></tr><tr><td align="left">Vite</td><td align="left"><code>dist</code></td></tr><tr><td align="left">Vue CLI</td><td align="left"><code>dist</code></td></tr><tr><td align="left">Angular</td><td align="left"><code>dist/&lt;project-name&gt;</code></td></tr></tbody></table>
<p><strong>å¦‚ä½•ç¡®è®¤è¾“å‡ºç›®å½•?</strong></p>
<p>åœ¨æœ¬åœ°è¿è¡Œæ„å»ºå‘½ä»¤:</p>
<pre><code class="hljs language-bash" lang="bash">npm run build
</code></pre>
<p>æŸ¥çœ‹ç”Ÿæˆçš„æ–‡ä»¶å¤¹åç§°,é‚£å°±æ˜¯è¾“å‡ºç›®å½•!</p>
<p><strong>6. Install Command (å®‰è£…å‘½ä»¤)</strong></p>
<p>é»˜è®¤æƒ…å†µä¸‹,Vercelä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨:</p>
<ul>
<li><code>npm install</code> (å¦‚æœæœ‰<code>package-lock.json</code>)</li>
<li><code>yarn install</code> (å¦‚æœæœ‰<code>yarn.lock</code>)</li>
<li><code>pnpm install</code> (å¦‚æœæœ‰<code>pnpm-lock.yaml</code>)</li>
</ul>
<p>é€šå¸¸<strong>ä¸éœ€è¦ä¿®æ”¹</strong>ã€‚</p>
<h4 data-id="heading-15">ç¯å¢ƒå˜é‡é…ç½®(å¯é€‰)</h4>
<p>å¦‚æœä½ çš„é¡¹ç›®éœ€è¦ç¯å¢ƒå˜é‡(å¦‚APIå¯†é’¥ã€åç«¯åœ°å€),åœ¨è¿™é‡Œé…ç½®:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/456882abe04341e7a953ec9bb29f15c7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768143469&amp;x-signature=Z5KMnJJ7QfeKJn5CuEYFkNM2J6U%3D" alt="vercel-env-vars.png" loading="lazy"/></p>
<p><em>æ·»åŠ ç¯å¢ƒå˜é‡</em></p>
<p><strong>ç¤ºä¾‹:</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">Name: VITE_API_URL</span>
<span class="hljs-section">Value: https://api.example.com</span>

<span class="hljs-section">Name: VITE_APP_TITLE</span>
<span class="hljs-section">Value: My Awesome App</span>
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>æç¤º</strong>:</p>
<ul>
<li>Viteé¡¹ç›®çš„ç¯å¢ƒå˜é‡éœ€è¦<code>VITE_</code>å‰ç¼€</li>
<li>Create React Appé¡¹ç›®éœ€è¦<code>REACT_APP_</code>å‰ç¼€</li>
<li>Next.jsé¡¹ç›®éœ€è¦<code>NEXT_PUBLIC_</code>å‰ç¼€(å¦‚æœè¦åœ¨å®¢æˆ·ç«¯è®¿é—®)</li>
</ul>
</blockquote>
<h3 data-id="heading-16">2.4 å¼€å§‹éƒ¨ç½²</h3>
<p>é…ç½®å®Œæˆå,ç‚¹å‡»åº•éƒ¨çš„ <strong>"Deploy"</strong> æŒ‰é’®:</p>
<p><em>ç‚¹å‡»DeployæŒ‰é’®å¼€å§‹éƒ¨ç½²</em></p>
<hr/>
<h2 data-id="heading-17">ç¬¬ä¸‰æ­¥:ç­‰å¾…æ„å»ºå’Œéƒ¨ç½²</h2>
<h3 data-id="heading-18">3.1 æ„å»ºè¿‡ç¨‹å®æ—¶æ—¥å¿—</h3>
<p>ç‚¹å‡»éƒ¨ç½²å,Vercelä¼šæ˜¾ç¤ºå®æ—¶æ„å»ºæ—¥å¿—:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e37349b7fdd4f34bf561dade75c36f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768143469&amp;x-signature=lhcEVTEZVMm%2FnBfpe3ax8kQhgKE%3D" alt="vercel-build-logs.png" loading="lazy"/></p>
<p><em>å®æ—¶æ„å»ºæ—¥å¿—,å¯ä»¥çœ‹åˆ°æ¯ä¸€æ­¥çš„æ‰§è¡Œæƒ…å†µ</em></p>
<p><strong>æ„å»ºæµç¨‹:</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> Cloning repository       â† ä»GitHubå…‹éš†ä»£ç 
<span class="hljs-bullet">2.</span> Analyzing dependencies    â† åˆ†æä¾èµ–å…³ç³»
<span class="hljs-bullet">3.</span> Installing dependencies   â† å®‰è£…npmåŒ… (æœ€è€—æ—¶)
<span class="hljs-bullet">4.</span> Building application      â† æ‰§è¡Œæ„å»ºå‘½ä»¤
<span class="hljs-bullet">5.</span> Uploading build output    â† ä¸Šä¼ åˆ°CDN
<span class="hljs-bullet">6.</span> Deploying to production   â† éƒ¨ç½²å®Œæˆ!
</code></pre>
<p><strong>é¦–æ¬¡éƒ¨ç½²é€šå¸¸éœ€è¦2-5åˆ†é’Ÿ</strong>,å–å†³äºä½ çš„é¡¹ç›®å¤§å°å’Œä¾èµ–æ•°é‡ã€‚</p>
<h3 data-id="heading-19">3.2 éƒ¨ç½²æˆåŠŸ!</h3>
<p>éƒ¨ç½²æˆåŠŸæ—¶ä¼šæœ‰ä¸ªåº†ç¥ç•Œé¢,æ­å–œ,éƒ¨ç½²æˆåŠŸäº†! ğŸ‰</p>
<p><em>éƒ¨ç½²æˆåŠŸé¡µé¢,æ˜¾ç¤ºä½ çš„é¡¹ç›®URL</em></p>
<p>ä½ ä¼šå¾—åˆ°ä¸€ä¸ªé»˜è®¤åŸŸå,æ ¼å¼ä¸º:</p>
<pre><code class="hljs language-arduino" lang="arduino">https:<span class="hljs-comment">//your-project-name.vercel.app</span>
</code></pre>
<p><strong>ç«‹å³è®¿é—®æµ‹è¯•!</strong></p>
<p>ç‚¹å‡» <strong>"Visit"</strong> æŒ‰é’®,æˆ–è€…ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™ä¸ªURL,çœ‹çœ‹ä½ çš„é¡¹ç›®æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚</p>
<h3 data-id="heading-20">3.3 éƒ¨ç½²å¤±è´¥?åˆ«æ…Œ,çœ‹æ—¥å¿—!</h3>
<p>å¦‚æœéƒ¨ç½²å¤±è´¥,Vercelä¼šæ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯:</p>
<p><strong>å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ:</strong></p>
<h4 data-id="heading-21">é”™è¯¯1: <code>Command "npm run build" exited with 1</code></h4>
<pre><code class="hljs language-markdown" lang="markdown">åŸå› : æ„å»ºå‘½ä»¤æ‰§è¡Œå¤±è´¥
è§£å†³:
<span class="hljs-bullet">1.</span> æ£€æŸ¥package.jsonä¸­çš„buildè„šæœ¬æ˜¯å¦æ­£ç¡®
<span class="hljs-bullet">2.</span> åœ¨æœ¬åœ°è¿è¡Œ<span class="hljs-code">`npm run build`</span>çœ‹æ˜¯å¦æœ‰é”™è¯¯
<span class="hljs-bullet">3.</span> æ£€æŸ¥æ˜¯å¦ç¼ºå°‘å¿…è¦çš„ç¯å¢ƒå˜é‡
</code></pre>
<h4 data-id="heading-22">é”™è¯¯2: <code>Error: Cannot find module 'xxx'</code></h4>
<pre><code class="hljs language-go" lang="go">åŸå› : ç¼ºå°‘ä¾èµ–åŒ…
è§£å†³:
<span class="hljs-number">1.</span> ç¡®è®¤ä¾èµ–åŒ…åœ¨<span class="hljs-keyword">package</span>.jsonçš„dependenciesä¸­(ä¸æ˜¯devDependencies)
<span class="hljs-number">2.</span> æœ¬åœ°åˆ é™¤node_modulesé‡æ–°å®‰è£…æµ‹è¯•
<span class="hljs-number">3.</span> æ£€æŸ¥<span class="hljs-keyword">package</span>-lock.jsonæ˜¯å¦æäº¤åˆ°GitHub
</code></pre>
<h4 data-id="heading-23">é”™è¯¯3: <code>Build exceeded maximum duration of 45 minutes</code></h4>
<pre><code class="hljs language-markdown" lang="markdown">åŸå› : æ„å»ºè¶…æ—¶(å…è´¹ç‰ˆé™åˆ¶45åˆ†é’Ÿ)
è§£å†³:
<span class="hljs-bullet">1.</span> ä¼˜åŒ–æ„å»ºé…ç½®,å‡å°‘ä¸å¿…è¦çš„ä¾èµ–
<span class="hljs-bullet">2.</span> ä½¿ç”¨.vercelignoreæ’é™¤ä¸éœ€è¦çš„æ–‡ä»¶
<span class="hljs-bullet">3.</span> è€ƒè™‘å‡çº§åˆ°Proç‰ˆ(300åˆ†é’Ÿé™åˆ¶)
</code></pre>
<h4 data-id="heading-24">é”™è¯¯4: <code>FATAL ERROR: Reached heap limit</code></h4>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">åŸå› : Node.jså†…å­˜ä¸è¶³</span>
<span class="hljs-section">è§£å†³:</span>
<span class="hljs-section">åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºvercel.json:</span>
{
  <span class="hljs-string">"builds"</span>: [
    {
      <span class="hljs-string">"src"</span>: <span class="hljs-string">"package.json"</span>,
      <span class="hljs-string">"use"</span>: <span class="hljs-string">"@vercel/node"</span>,
      <span class="hljs-string">"config"</span>: {
        <span class="hljs-string">"maxLambdaSize"</span>: <span class="hljs-string">"50mb"</span>
      }
    }
  ]
}
</code></pre>
<hr/>
<h2 data-id="heading-25">ç¬¬å››æ­¥:é…ç½®è‡ªåŠ¨éƒ¨ç½²</h2>
<p>éƒ¨ç½²æˆåŠŸå,æœ€é…·çš„åŠŸèƒ½æ¥äº†:<strong>è‡ªåŠ¨éƒ¨ç½²</strong>!</p>
<h3 data-id="heading-26">4.1 Gitè‡ªåŠ¨éƒ¨ç½²åŸç†</h3>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">å·¥ä½œæµç¨‹:</span>
ä½ åœ¨æœ¬åœ°ä¿®æ”¹ä»£ç 
    â†“
git commit &amp; git push
    â†“
Vercelæ£€æµ‹åˆ°GitHubä»“åº“æ›´æ–°
    â†“
è‡ªåŠ¨è§¦å‘æ–°çš„éƒ¨ç½²
    â†“
å‡ åˆ†é’Ÿåæ–°ç‰ˆæœ¬è‡ªåŠ¨ä¸Šçº¿!
</code></pre>
<p><strong>å®Œå…¨ä¸éœ€è¦æ‰‹åŠ¨æ“ä½œ!</strong></p>
<hr/>
<h2 data-id="heading-27">ç¬¬äº”æ­¥:é…ç½®è‡ªå®šä¹‰åŸŸå(è¿›é˜¶)</h2>
<p>é»˜è®¤çš„<code>vercel.app</code>åŸŸåè™½ç„¶èƒ½ç”¨,ä½†ä¸å¤Ÿä¸“ä¸šã€‚è®©æˆ‘ä»¬é…ç½®ä¸€ä¸ªè‡ªå·±çš„åŸŸå!</p>
<h3 data-id="heading-28">5.1 å‰ç½®æ¡ä»¶</h3>
<pre><code class="hljs language-scss" lang="scss">âœ… ä½ å·²ç»æ‹¥æœ‰ä¸€ä¸ªåŸŸå(å¦‚ä»è…¾è®¯äº‘ã€é˜¿é‡Œäº‘ã€GoDaddyè´­ä¹°)
âœ… èƒ½å¤Ÿè®¿é—®åŸŸåçš„DNSç®¡ç†åå°
</code></pre>
<h3 data-id="heading-29">5.2 åœ¨Vercelä¸­æ·»åŠ åŸŸå</h3>
<p>è¿›å…¥é¡¹ç›®çš„ <strong>Settings</strong> â†’ <strong>Domains</strong>:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1b770337eb645ddbf86272c12c0ded8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768143469&amp;x-signature=cPkX1x%2BGVu11DxKyhBklqhNxiX8%3D" alt="vercel-add-domain.png" loading="lazy"/></p>
<p><em>åœ¨Domainsè®¾ç½®é¡µé¢æ·»åŠ è‡ªå®šä¹‰åŸŸå</em></p>
<p>è¾“å…¥ä½ çš„åŸŸå,å¦‚ <code>blog.example.com</code>,ç„¶åç‚¹å‡» <strong>"Add"</strong>ã€‚</p>
<p>Vercelä¼šæ˜¾ç¤ºéœ€è¦é…ç½®çš„DNSè®°å½•:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55a33af601684ba397888ee09b22c1c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768143469&amp;x-signature=5QCBRkAYZtLV3Y3g7WVhLFTwMwU%3D" alt="vercel-dns-instructions.png" loading="lazy"/></p>
<p><em>Vercelæä¾›çš„DNSé…ç½®è¯´æ˜</em></p>
<p><strong>ä¸¤ç§åŸŸåç±»å‹:</strong></p>
<h4 data-id="heading-30">ç±»å‹1: æ ¹åŸŸå(Apex Domain)</h4>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">ç¤ºä¾‹: example.com</span>

<span class="hljs-section">éœ€è¦é…ç½®:</span>
<span class="hljs-section">Aè®°å½•: example.com â†’ 76.76.21.21</span>
</code></pre>
<h4 data-id="heading-31">ç±»å‹2: å­åŸŸå(Subdomain)</h4>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">ç¤ºä¾‹: blog.example.com æˆ– www.example.com</span>

<span class="hljs-section">éœ€è¦é…ç½®:</span>
<span class="hljs-section">CNAMEè®°å½•: blog â†’ cname.vercel-dns.com</span>
</code></pre>
<h3 data-id="heading-32">5.3 åœ¨è…¾è®¯äº‘DNSé…ç½®åŸŸåè§£æ</h3>
<p>æˆ‘ä»¥<strong>è…¾è®¯äº‘DNSPod</strong>ä¸ºä¾‹,æ¼”ç¤ºé…ç½®è¿‡ç¨‹ã€‚(é˜¿é‡Œäº‘ã€Cloudflareç­‰å¹³å°æ“ä½œç±»ä¼¼)</p>
<h4 data-id="heading-33">æ­¥éª¤1: ç™»å½•è…¾è®¯äº‘DNSPod</h4>
<p>è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.dnspod.cn" target="_blank" title="https://console.dnspod.cn" ref="nofollow noopener noreferrer">console.dnspod.cn</a>,ç™»å½•åé€‰æ‹©ä½ çš„åŸŸå:</p>
<h4 data-id="heading-34">æ­¥éª¤2: æ·»åŠ CNAMEè®°å½•</h4>
<p>ç‚¹å‡» <strong>"æ·»åŠ è®°å½•"</strong>:</p>
<p><strong>é…ç½®ç¤ºä¾‹(å­åŸŸå):</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">è®°å½•ç±»å‹: CNAME</span>
<span class="hljs-section">ä¸»æœºè®°å½•: blog    (å¦‚æœæ˜¯wwwåˆ™å¡«www)</span>
<span class="hljs-section">è®°å½•å€¼: å¤åˆ¶Vercelä¸­æ·»åŠ çš„åŸŸåä¸­çš„CNAMEå¯¹åº”çš„ValueæŒ‡</span>
<span class="hljs-section">TTL: 600 (10åˆ†é’Ÿ,å¯ä»¥é»˜è®¤)</span>
</code></pre>
<p><strong>é…ç½®ç¤ºä¾‹(æ ¹åŸŸå):</strong></p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">è®°å½•ç±»å‹: A</span>
<span class="hljs-section">ä¸»æœºè®°å½•: @      (@ è¡¨ç¤ºæ ¹åŸŸå)</span>
<span class="hljs-section">è®°å½•å€¼: 76.76.21.21  (Vercelæä¾›çš„IPåœ°å€)</span>
<span class="hljs-section">TTL: 600</span>
</code></pre>
<p>ç‚¹å‡» <strong>"ä¿å­˜"</strong>ã€‚</p>
<h4 data-id="heading-35">æ­¥éª¤3: ç­‰å¾…DNSç”Ÿæ•ˆ</h4>
<p>DNSè®°å½•é€šå¸¸éœ€è¦<strong>å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶</strong>æ‰èƒ½å…¨çƒç”Ÿæ•ˆã€‚</p>
<p><strong>å¦‚ä½•æ£€æŸ¥DNSæ˜¯å¦ç”Ÿæ•ˆ?</strong></p>
<p>åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ£€æŸ¥CNAMEè®°å½•</span>
nslookup blog.example.com

<span class="hljs-comment"># æˆ–ä½¿ç”¨digå‘½ä»¤</span>
dig blog.example.com

<span class="hljs-comment"># åº”è¯¥çœ‹åˆ°è¿”å›:</span>
<span class="hljs-comment"># blog.example.com.   IN  CNAME   cname.vercel-dns.com.</span>
</code></pre>
<h3 data-id="heading-36">5.4 åœ¨Vercelä¸­éªŒè¯åŸŸå</h3>
<p>å›åˆ°Vercelçš„Domainsè®¾ç½®é¡µé¢,ç­‰å¾…ç³»ç»Ÿè‡ªåŠ¨éªŒè¯:</p>
<p>éªŒè¯æˆåŠŸå,ä¼šæ˜¾ç¤º:åŸŸåé…ç½®æˆåŠŸ,è‡ªåŠ¨å¯ç”¨HTTPS</p>
<p><strong>Vercelè‡ªåŠ¨æä¾›:</strong></p>
<ul>
<li>âœ… å…è´¹SSLè¯ä¹¦(Let's Encrypt)</li>
<li>âœ… è‡ªåŠ¨ç»­æœŸ</li>
<li>âœ… å¼ºåˆ¶HTTPSè·³è½¬</li>
</ul>
<h3 data-id="heading-37">5.5 æµ‹è¯•è‡ªå®šä¹‰åŸŸå</h3>
<p>åœ¨æµè§ˆå™¨ä¸­è®¿é—®ä½ çš„è‡ªå®šä¹‰åŸŸå:</p>
<pre><code class="hljs language-arduino" lang="arduino">https:<span class="hljs-comment">//blog.example.com</span>
</code></pre>
<p>æˆåŠŸ! ğŸ‰</p>
<p><strong>åŒæ—¶ä½ è¿˜ä¼šå‘ç°:</strong></p>
<ul>
<li>é»˜è®¤åŸŸå<code>your-app.vercel.app</code>ä»ç„¶å¯ç”¨</li>
<li>HTTPè‡ªåŠ¨è·³è½¬åˆ°HTTPS</li>
<li>åŠ è½½é€Ÿåº¦é£å¿«(å…¨çƒCDNåŠ é€Ÿ)</li>
</ul>
<hr/>
<h2 data-id="heading-38">ç¬¬å…­æ­¥:é¡¹ç›®ç®¡ç†å’Œè¿ç»´</h2>
<h3 data-id="heading-39">6.1 æŸ¥çœ‹éƒ¨ç½²å†å²</h3>
<p>åœ¨é¡¹ç›®çš„ <strong>Deployments</strong> é¡µé¢,å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„éƒ¨ç½²è®°å½•:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4dce930d3724ef99e59ff48ee76dcd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768143469&amp;x-signature=VztBrkgkjuiraF6ZfaL8HllEqL8%3D" alt="vercel-deployments.png" loading="lazy"/></p>
<p><em>æ‰€æœ‰å†å²éƒ¨ç½²è®°å½•</em></p>
<p>æ¯ä¸ªéƒ¨ç½²éƒ½æœ‰:</p>
<ul>
<li>å”¯ä¸€çš„URL</li>
<li>éƒ¨ç½²æ—¶é—´</li>
<li>Git commitä¿¡æ¯</li>
<li>æ„å»ºæ—¥å¿—</li>
<li>è®¿é—®ç»Ÿè®¡</li>
</ul>
<h3 data-id="heading-40">6.2 ä¸€é”®å›æ»š</h3>
<p>å¦‚æœæ–°ç‰ˆæœ¬æœ‰é—®é¢˜,å¯ä»¥ç¬é—´å›é€€åˆ°ä»»æ„å†å²ç‰ˆæœ¬:</p>
<p><strong>å›æ»šæµç¨‹:</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ‰¾åˆ°ä½ æƒ³å›é€€åˆ°çš„ç‰ˆæœ¬
<span class="hljs-bullet">2.</span> ç‚¹å‡»å³ä¾§çš„ â‹¯ æŒ‰é’®
<span class="hljs-bullet">3.</span> é€‰æ‹©"Promote to Production"
<span class="hljs-bullet">4.</span> å‡ ç§’é’Ÿå,æ—§ç‰ˆæœ¬é‡æ–°ä¸Šçº¿!
</code></pre>
<h3 data-id="heading-41">6.3 è®¿é—®ç»Ÿè®¡</h3>
<p>åœ¨ <strong>Analytics</strong> é¡µé¢æŸ¥çœ‹è®¿é—®æ•°æ®:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08c0b151a6ae447da1935e53aabb6c81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768143469&amp;x-signature=mxbgs9VYeN5ZzAsmTV%2FFF0Wu3lw%3D" alt="vercel-analytics.png" loading="lazy"/></p>
<p><em>Vercel Analyticsæä¾›å®æ—¶è®¿é—®æ•°æ®</em></p>
<p><strong>å…è´¹ç‰ˆæ•°æ®:</strong></p>
<ul>
<li>è®¿é—®é‡(PV/UV)</li>
<li>åœ°ç†åˆ†å¸ƒ</li>
<li>è®¾å¤‡ç±»å‹</li>
<li>æµè§ˆå™¨ç±»å‹</li>
</ul>
<hr/>
<h2 data-id="heading-42">å¸¸è§é—®é¢˜æ’æŸ¥</h2>
<h3 data-id="heading-43">Q1: éƒ¨ç½²æˆåŠŸä½†é¡µé¢404</h3>
<p><strong>é—®é¢˜ç°è±¡:</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">è®¿é—®é¦–é¡µ: https:<span class="hljs-comment">//my-app.vercel.app  âœ… æ­£å¸¸</span>
è®¿é—®å­é¡µé¢: https:<span class="hljs-comment">//my-app.vercel.app/about  âŒ 404</span>
</code></pre>
<p><strong>åŸå› :</strong> å‰ç«¯è·¯ç”±(React Router/Vue Router)éœ€è¦æœåŠ¡å™¨é…ç½®æ”¯æŒã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º<code>vercel.json</code>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"rewrites"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/(.*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/index.html"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™ä¼šå°†æ‰€æœ‰è¯·æ±‚é‡å®šå‘åˆ°<code>index.html</code>,è®©å‰ç«¯è·¯ç”±æ¥ç®¡ã€‚</p>
<h3 data-id="heading-44">Q2: é™æ€èµ„æºåŠ è½½å¤±è´¥(404)</h3>
<p><strong>é—®é¢˜ç°è±¡:</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-built_in">Console</span>é”™è¯¯:
GET https:<span class="hljs-comment">//my-app.vercel.app/assets/logo.png 404</span>
</code></pre>
<p><strong>åŸå› :</strong> é™æ€èµ„æºè·¯å¾„é…ç½®é”™è¯¯ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ:</strong></p>
<p><strong>Viteé¡¹ç›®:</strong></p>
<p>ä¿®æ”¹<code>vite.config.js</code>:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">base</span>: <span class="hljs-string">'/'</span>,  <span class="hljs-comment">// ç¡®ä¿baseæ˜¯ '/' è€Œä¸æ˜¯ç›¸å¯¹è·¯å¾„</span>
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">outDir</span>: <span class="hljs-string">'dist'</span>,
  }
}
</code></pre>
<p><strong>Create React App:</strong></p>
<p>ä¿®æ”¹<code>package.json</code>:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"homepage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://my-app.vercel.app"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-45">Q3: ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ</h3>
<p><strong>é—®é¢˜ç°è±¡:</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_API_URL</span>)
<span class="hljs-comment">// è¾“å‡º: undefined</span>
</code></pre>
<p><strong>æ’æŸ¥æ¸…å•:</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">âŒ</span> <span class="hljs-string">ç¯å¢ƒå˜é‡åç§°é”™è¯¯(ç¼ºå°‘å‰ç¼€)</span>
   <span class="hljs-string">â†’</span> <span class="hljs-attr">Vite:</span> <span class="hljs-string">å¿…é¡»ä»¥VITE_å¼€å¤´</span>
   <span class="hljs-string">â†’</span> <span class="hljs-attr">CRA:</span> <span class="hljs-string">å¿…é¡»ä»¥REACT_APP_å¼€å¤´</span>
   <span class="hljs-string">â†’</span> <span class="hljs-attr">Next.js:</span> <span class="hljs-string">å¿…é¡»ä»¥NEXT_PUBLIC_å¼€å¤´(å®¢æˆ·ç«¯ä½¿ç”¨)</span>

<span class="hljs-string">âŒ</span> <span class="hljs-string">ç¯å¢ƒå˜é‡æœªåœ¨Vercelä¸­é…ç½®</span>
   <span class="hljs-string">â†’</span> <span class="hljs-string">è¿›å…¥Settings</span> <span class="hljs-string">â†’</span> <span class="hljs-string">Environment</span> <span class="hljs-string">Variablesæ·»åŠ </span>

<span class="hljs-string">âŒ</span> <span class="hljs-string">é…ç½®åæœªé‡æ–°éƒ¨ç½²</span>
   <span class="hljs-string">â†’</span> <span class="hljs-string">ä¿®æ”¹ç¯å¢ƒå˜é‡åéœ€è¦è§¦å‘æ–°éƒ¨ç½²æ‰èƒ½ç”Ÿæ•ˆ</span>
</code></pre>
<h3 data-id="heading-46">Q4: æ„å»ºæ—¶é—´è¿‡é•¿</h3>
<p><strong>ä¼˜åŒ–ç­–ç•¥:</strong></p>
<p><strong>1. ä½¿ç”¨.vercelignoreæ’é™¤ä¸å¿…è¦æ–‡ä»¶</strong></p>
<p>åˆ›å»º<code>.vercelignore</code>:</p>
<pre><code class="hljs">.git
*.md
.vscode
.idea
tests
docs
</code></pre>
<p><strong>2. å¯ç”¨ä¾èµ–ç¼“å­˜</strong></p>
<p>Vercelé»˜è®¤ä¼šç¼“å­˜<code>node_modules</code>,ä½†å¯ä»¥ä¼˜åŒ–:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// vercel.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"github"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"silent"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"NODE_OPTIONS"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"--max_old_space_size=4096"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>3. å¹¶è¡Œæ„å»º</strong></p>
<p>å¦‚æœæ˜¯monorepo,å¯ä»¥é…ç½®å¹¶è¡Œæ„å»º:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"builds"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span> <span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"package.json"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"use"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@vercel/static-build"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"parallel"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span> <span class="hljs-punctuation">}</span> <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-47">Q5: è‡ªå®šä¹‰åŸŸåHTTPSè¯ä¹¦é”™è¯¯</h3>
<p><strong>é—®é¢˜ç°è±¡:</strong></p>
<p>æµè§ˆå™¨æ˜¾ç¤º"æ‚¨çš„è¿æ¥ä¸æ˜¯ç§å¯†è¿æ¥"ã€‚</p>
<p><strong>è§£å†³æ­¥éª¤:</strong></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ£€æŸ¥DNSæ˜¯å¦ç”Ÿæ•ˆ (nslookup your-domain.com)
<span class="hljs-bullet">2.</span> åœ¨Vercelä¸­åˆ é™¤åŸŸå,é‡æ–°æ·»åŠ 
<span class="hljs-bullet">3.</span> ç­‰å¾…å‡ åˆ†é’Ÿè®©Let's Encrypté‡æ–°ç­¾å‘è¯ä¹¦
<span class="hljs-bullet">4.</span> æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒSSLçŠ¶æ€
</code></pre>
<hr/>
<h2 data-id="heading-48">è¿›é˜¶æŠ€å·§</h2>
<h3 data-id="heading-49">æŠ€å·§1: ä½¿ç”¨Vercel CLIæœ¬åœ°å¼€å‘</h3>
<p>å®‰è£…Vercel CLI:</p>
<pre><code class="hljs language-bash" lang="bash">npm i -g vercel
</code></pre>
<p><strong>åœ¨æœ¬åœ°æ¨¡æ‹ŸVercelç¯å¢ƒ:</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é“¾æ¥åˆ°Vercelé¡¹ç›®</span>
vercel <span class="hljs-built_in">link</span>

<span class="hljs-comment"># ä¸‹è½½ç¯å¢ƒå˜é‡</span>
vercel <span class="hljs-built_in">env</span> pull

<span class="hljs-comment"># æœ¬åœ°è¿è¡Œ(ä½¿ç”¨ç”Ÿäº§ç¯å¢ƒé…ç½®)</span>
vercel dev
</code></pre>
<p><strong>ä¼˜åŠ¿:</strong></p>
<pre><code class="hljs language-bash" lang="bash">âœ… æœ¬åœ°ä½¿ç”¨Vercelçš„ç¯å¢ƒå˜é‡
âœ… æ¨¡æ‹ŸVercelçš„Serverless Functions
âœ… æµ‹è¯•rewrite/redirectè§„åˆ™
</code></pre>
<h3 data-id="heading-50">æŠ€å·§2: é…ç½®å¤šåŸŸå</h3>
<p>ä¸€ä¸ªé¡¹ç›®å¯ä»¥ç»‘å®šå¤šä¸ªåŸŸå:</p>
<pre><code class="hljs">example.com          â†’ ä¸»åŸŸå
www.example.com      â†’ è‡ªåŠ¨è·³è½¬åˆ°ä¸»åŸŸå
blog.example.com     â†’ ç‹¬ç«‹è®¿é—®
</code></pre>
<p>åœ¨Vercel Domainsè®¾ç½®ä¸­æ·»åŠ å¤šä¸ªåŸŸåå³å¯ã€‚</p>
<h3 data-id="heading-51">æŠ€å·§3: è‡ªå®šä¹‰æ„å»ºç¼“å­˜</h3>
<p>ä¼˜åŒ–æ„å»ºé€Ÿåº¦:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// vercel.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"ENABLE_EXPERIMENTAL_COREPACK"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"NEXT_PRIVATE_CACHE_HANDLER"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"crons"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"path"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/api/clear-cache"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"schedule"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0 0 * * *"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-52">æŠ€å·§4: é…ç½®Redirectè§„åˆ™</h3>
<p>SEOä¼˜åŒ–å’ŒURLç®¡ç†:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"redirects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/old-blog/:slug"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/blog/:slug"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"permanent"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/docs"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/documentation"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"permanent"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-53">æŠ€å·§5: é…ç½®HTTP Headers</h3>
<p>å®‰å…¨å’Œæ€§èƒ½ä¼˜åŒ–:</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"headers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/(.*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"headers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"X-Frame-Options"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"DENY"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"X-Content-Type-Options"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"nosniff"</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"key"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Cache-Control"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"public, max-age=31536000, immutable"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h2 data-id="heading-54">æˆæœ¬å’Œé™åˆ¶</h2>
<h3 data-id="heading-55">Hobby(å…è´¹)è®¡åˆ’</h3>
<pre><code class="hljs language-javascript" lang="javascript">âœ… æ— é™é¡¹ç›®
âœ… æ— é™éƒ¨ç½²
âœ… 100GBå¸¦å®½/æœˆ
âœ… <span class="hljs-number">1000</span>æ¬¡<span class="hljs-title class_">Serverless</span> <span class="hljs-title class_">Function</span>è°ƒç”¨/å¤©
âœ… è‡ªåŠ¨<span class="hljs-variable constant_">SSL</span>è¯ä¹¦
âœ… å…¨çƒ<span class="hljs-variable constant_">CDN</span>

âŒ å›¢é˜Ÿåä½œ(ä»…é™ä¸ªäºº)
âŒ å•†ä¸šä½¿ç”¨
</code></pre>
<h3 data-id="heading-56">Proè®¡åˆ’($20/æœˆ)</h3>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-addition">+ Hobbyæ‰€æœ‰åŠŸèƒ½</span>
<span class="hljs-addition">+ 1TBå¸¦å®½/æœˆ</span>
<span class="hljs-addition">+ æ— é™Serverlessè°ƒç”¨</span>
<span class="hljs-addition">+ å›¢é˜Ÿåä½œ(æ— é™æˆå‘˜)</span>
<span class="hljs-addition">+ ä¼˜å…ˆçº§æ”¯æŒ</span>
<span class="hljs-addition">+ å¯†ç ä¿æŠ¤</span>
<span class="hljs-addition">+ åˆ†æå’Œæ—¥å¿—ä¿ç•™æ›´é•¿</span>
</code></pre>
<p><strong>ä»€ä¹ˆæ—¶å€™éœ€è¦å‡çº§Pro?</strong></p>
<pre><code class="hljs">âœ… æœˆè®¿é—®é‡è¶…è¿‡100GBå¸¦å®½
âœ… éœ€è¦å›¢é˜Ÿåä½œå¼€å‘
âœ… éœ€è¦å¯†ç ä¿æŠ¤é¢„è§ˆç¯å¢ƒ
âœ… éœ€è¦æ›´è¯¦ç»†çš„è®¿é—®åˆ†æ
</code></pre>
<p>å¯¹äºä¸ªäººé¡¹ç›®å’Œå°å‹ç½‘ç«™,<strong>å…è´¹è®¡åˆ’å®Œå…¨å¤Ÿç”¨</strong>!</p>
<hr/>
<h2 data-id="heading-57">æ€»ç»“:Verceléƒ¨ç½²æ£€æŸ¥æ¸…å•</h2>
<h3 data-id="heading-58">éƒ¨ç½²å‰æ£€æŸ¥</h3>
<pre><code class="hljs language-markdown" lang="markdown">âœ… ä»£ç å·²æ¨é€åˆ°GitHub
âœ… package.jsonä¸­çš„dependenciesæ­£ç¡®
âœ… æœ¬åœ°æ‰§è¡Œnpm run buildæˆåŠŸ
âœ… æ„å»ºäº§ç‰©åœ¨æ­£ç¡®çš„è¾“å‡ºç›®å½•
âœ… ç¯å¢ƒå˜é‡æ•´ç†å®Œæ¯•
âœ… .gitignoreåŒ…å«node<span class="hljs-emphasis">_moduleså’Œæ„å»ºäº§ç‰©
</span></code></pre>
<h3 data-id="heading-59">éƒ¨ç½²é…ç½®æ£€æŸ¥</h3>
<pre><code class="hljs language-markdown" lang="markdown">âœ… Framework Presetæ­£ç¡®è¯†åˆ«
âœ… Build Commandé…ç½®æ­£ç¡®
âœ… Output Directoryé…ç½®æ­£ç¡®
âœ… Root Directoryé…ç½®æ­£ç¡®(å¦‚æœä¸æ˜¯æ ¹ç›®å½•)
âœ… Environment Variablesæ·»åŠ å®Œæ•´
</code></pre>
<h3 data-id="heading-60">éƒ¨ç½²åæ£€æŸ¥</h3>
<pre><code class="hljs language-markdown" lang="markdown">âœ… é¦–é¡µèƒ½æ­£å¸¸è®¿é—®
âœ… å‰ç«¯è·¯ç”±è·³è½¬æ­£å¸¸(å¤šé¡µåº”ç”¨)
âœ… é™æ€èµ„æºåŠ è½½æ­£å¸¸
âœ… APIè¯·æ±‚æ­£å¸¸(å¦‚æœæœ‰åç«¯)
âœ… ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ
âœ… ç§»åŠ¨ç«¯å“åº”å¼æ­£å¸¸
</code></pre>
<h3 data-id="heading-61">è‡ªå®šä¹‰åŸŸåæ£€æŸ¥</h3>
<pre><code class="hljs language-markdown" lang="markdown">âœ… DNSè®°å½•é…ç½®æ­£ç¡®
âœ… DNSå·²ç”Ÿæ•ˆ(nslookupæ£€æŸ¥)
âœ… Vercelä¸­åŸŸåéªŒè¯æˆåŠŸ
âœ… HTTPSè¯ä¹¦è‡ªåŠ¨ç­¾å‘
âœ… HTTPè‡ªåŠ¨è·³è½¬HTTPS
âœ… wwwå’Œéwwwéƒ½èƒ½è®¿é—®(å¦‚æœéœ€è¦)
</code></pre>
<hr/>
<h2 data-id="heading-62">ä¸‹ä¸€æ­¥è¡ŒåŠ¨</h2>
<p><strong>ä»Šå¤©å°±å¼€å§‹:</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ³¨å†ŒVercelè´¦å·</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> é€‰æ‹©ä¸€ä¸ªé¡¹ç›®è¿›è¡Œéƒ¨ç½²</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> é…ç½®è‡ªåŠ¨éƒ¨ç½²</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> (å¯é€‰)ç»‘å®šè‡ªå®šä¹‰åŸŸå</li>
</ul>
<p><strong>æœ¬å‘¨ä»»åŠ¡:</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å°†æ‰€æœ‰å‰ç«¯é¡¹ç›®è¿ç§»åˆ°Vercel</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> é…ç½®PRé¢„è§ˆç¯å¢ƒ</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ä¼˜åŒ–æ„å»ºé…ç½®</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> è®¾ç½®æ€§èƒ½ç›‘æ§</li>
</ul>
<p><strong>é•¿æœŸä¼˜åŒ–:</strong></p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> ä½¿ç”¨Vercel Analyticsåˆ†æç”¨æˆ·è¡Œä¸º</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ ¹æ®Web Vitalsä¼˜åŒ–æ€§èƒ½</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> æ¢ç´¢Serverless Functions(Vercelçš„åç«¯èƒ½åŠ›)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> å­¦ä¹ Vercelçš„Edge Functions(è¾¹ç¼˜è®¡ç®—)</li>
</ul>
<hr/>
<h2 data-id="heading-63">ç›¸å…³èµ„æº</h2>
<p><strong>å®˜æ–¹æ–‡æ¡£:</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fdocs" target="_blank" title="https://vercel.com/docs" ref="nofollow noopener noreferrer">Vercelå®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fdocs%2Fcli" target="_blank" title="https://vercel.com/docs/cli" ref="nofollow noopener noreferrer">Vercel CLIæ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fdocs%2Fbuild-step" target="_blank" title="https://vercel.com/docs/build-step" ref="nofollow noopener noreferrer">éƒ¨ç½²é…ç½®æŒ‡å—</a></li>
</ul>
<p><strong>ç¤¾åŒºèµ„æº:</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvercel%2Fvercel" target="_blank" title="https://github.com/vercel/vercel" ref="nofollow noopener noreferrer">Vercel GitHub</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fdiscord" target="_blank" title="https://vercel.com/discord" ref="nofollow noopener noreferrer">Vercel Discordç¤¾åŒº</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Ftemplates" target="_blank" title="https://vercel.com/templates" ref="nofollow noopener noreferrer">Vercelæ¨¡æ¿åº“</a></li>
</ul>
<p><strong>å¯¹æ¯”å‚è€ƒ:</strong></p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fblog%2Fvercel-vs-netlify" target="_blank" title="https://vercel.com/blog/vercel-vs-netlify" ref="nofollow noopener noreferrer">Vercel vs Netlify</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fguides%2Fdeploying-react-with-vercel-and-github-pages" target="_blank" title="https://vercel.com/guides/deploying-react-with-vercel-and-github-pages" ref="nofollow noopener noreferrer">Vercel vs GitHub Pages</a></li>
</ul>
<hr/>
<p>ä»ä»Šå¤©å¼€å§‹,è®©ä½ çš„å‰ç«¯é¡¹ç›®èµ°å‡ºæœ¬åœ°,é¢å‘ä¸–ç•Œ!è®°ä½:<strong>éƒ¨ç½²ä¸æ˜¯ç»“æŸ,è€Œæ˜¯ä½ çš„é¡¹ç›®çœŸæ­£å¼€å§‹è¢«ä½¿ç”¨çš„èµ·ç‚¹</strong>ã€‚</p>
<p>ç°åœ¨å°±è¡ŒåŠ¨,10åˆ†é’Ÿå,ä½ çš„ä½œå“å°†æ‹¥æœ‰ä¸€ä¸ªå…¨çƒå¯è®¿é—®çš„URL! ğŸš€</p>
<hr/>
<p><em>è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©å—?åˆ†äº«ä½ çš„Verceléƒ¨ç½²ç»éªŒ,æˆ–è€…åœ¨è¯„è®ºåŒºæé—®!</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ComposeåŸç†ä¸€ä¹‹å¿«ç…§ç³»ç»Ÿ]]></title>    <link>https://juejin.cn/post/7591360623469215754</link>    <guid>https://juejin.cn/post/7591360623469215754</guid>    <pubDate>2026-01-04T11:39:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591360623469215754" data-draft-id="7591346773827354650" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ComposeåŸç†ä¸€ä¹‹å¿«ç…§ç³»ç»Ÿ"/> <meta itemprop="keywords" content="æ¶æ„,ç®—æ³•"/> <meta itemprop="datePublished" content="2026-01-04T11:39:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è£´äº‘é£"/> <meta itemprop="url" content="https://juejin.cn/user/3734361144570285"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ComposeåŸç†ä¸€ä¹‹å¿«ç…§ç³»ç»Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3734361144570285/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è£´äº‘é£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T11:39:09.000Z" title="Sun Jan 04 2026 11:39:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Composeçš„å¿«ç…§ç³»ç»ŸåŸºäº <strong>MVCC (å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶)</strong> æ€æƒ³ï¼Œç±»ä¼¼äºæ•°æ®åº“äº‹åŠ¡ã€‚</p>
<pre><code class="hljs language-ini" lang="ini">StateObject (mutableStateOf(0))
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Record <span class="hljs-attr">id</span>=<span class="hljs-number">7</span>  â”‚â”€â”€â”€â–ºâ”‚ Record id=<span class="hljs-number">5</span>  â”‚â”€â”€â”€â–ºâ”‚ Record id=<span class="hljs-number">1</span>  â”‚
â”‚ <span class="hljs-attr">value</span>=<span class="hljs-number">100</span>    â”‚    â”‚ value=<span class="hljs-number">50</span>     â”‚    â”‚ value=<span class="hljs-number">0</span>      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     (æœ€æ–°)                                  (åˆå§‹)
</code></pre>
<p>ç›®æ ‡æ˜¯ä¿è¯ï¼š</p>
<ul>
<li><strong>éš”ç¦»æ€§</strong>: ä¸åŒå¿«ç…§çš„ä¿®æ”¹ç›¸äº’éš”ç¦»</li>
<li><strong>åŸå­æ€§</strong>: å¿«ç…§åº”ç”¨æ˜¯åŸå­æ“ä½œ</li>
<li><strong>å¯è§‚å¯Ÿæ€§</strong>: æ”¯æŒçŠ¶æ€è¯»å†™è¿½è¸ª</li>
</ul>
<h2 data-id="heading-0">ç¤ºä¾‹ä»£ç </h2>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-keyword">var</span> name: MutableState&lt;String&gt; = mutableStateOf(<span class="hljs-string">""</span>)
}

<span class="hljs-keyword">val</span> person = Person()
person.name.value = <span class="hljs-string">"ä»¤ç‹å†²"</span>
<span class="hljs-keyword">val</span> snapshot = Snapshot.takeSnapshot()
person.name.value = <span class="hljs-string">"ä»»ç›ˆç›ˆ"</span>

println(<span class="hljs-string">"ç¬¬ä¸€æ¬¡æ‰“å°ï¼š<span class="hljs-subst">${person.name.value}</span>"</span>)  <span class="hljs-comment">// è¾“å‡º: ä»»ç›ˆç›ˆ</span>
snapshot.enter {
    println(<span class="hljs-string">"ç¬¬äºŒæ¬¡æ‰“å°ï¼š<span class="hljs-subst">${person.name.value}</span>"</span>)  <span class="hljs-comment">// è¾“å‡º: ä»¤ç‹å†²</span>
}
println(<span class="hljs-string">"ç¬¬ä¸‰æ¬¡æ‰“å°ï¼š<span class="hljs-subst">${person.name.value}</span>"</span>)  <span class="hljs-comment">// è¾“å‡º: ä»»ç›ˆç›ˆ</span>
</code></pre>
<p>ç¬¬äºŒæ¬¡æ‰“å°è¾“å‡ºä»¤ç‹å†²ï¼Œè¯´æ˜å¿«ç…§ä¿å­˜ä¹‹å‰çš„çŠ¶æ€ï¼Œå¿«ç…§æ˜¯å¦‚ä½•ä¿å­˜ä¹‹å‰çš„çŠ¶æ€ï¼Ÿç¬¬ä¸‰æ¬¡æ‰“å°ä»»ç›ˆç›ˆï¼Œè¯´æ˜enteræ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œåˆæ¢å¤æˆæœ€æ–°çŠ¶æ€äº†ï¼Œè¿™åˆæ˜¯ä¸ºä½•ï¼Ÿä¸‹é¢å°†ä¸€æ­¥ä¸€æ­¥çš„è§£æç¤ºä¾‹ä¸­çš„æ¯ä¸€è¡Œä»£ç ã€‚</p>
<h2 data-id="heading-1">ç¬¬ä¸€æ­¥ï¼šåˆ›å»º MutableState (mutableStateOf(""))</h2>
<p>å½“æ‰§è¡Œ <code>mutableStateOf("")</code> æ—¶ï¼š</p>
<h3 data-id="heading-2">æºç ä½ç½®ï¼šSnapshotState.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">mutableStateOf</span><span class="hljs-params">(
    value: <span class="hljs-type">T</span>,
    policy: <span class="hljs-type">SnapshotMutationPolicy</span>&lt;<span class="hljs-type">T</span>&gt; = structuralEqualityPolicy()</span></span>,
): MutableState&lt;T&gt; = createSnapshotMutableState(value, policy)
</code></pre>
<h3 data-id="heading-3">æºç ä½ç½®ï¼šSnapshotState.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">open</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SnapshotMutableStateImpl</span>&lt;<span class="hljs-type">T</span>&gt;(
    value: T,
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> policy: SnapshotMutationPolicy&lt;T&gt;,
) : StateObjectImpl(), SnapshotMutableState&lt;T&gt; {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> next: StateStateRecord&lt;T&gt; =
        currentSnapshot().let { snapshot -&gt;
            StateStateRecord(snapshot.snapshotId, value).also {
                <span class="hljs-keyword">if</span> (snapshot !<span class="hljs-keyword">is</span> GlobalSnapshot) {
                    it.next = StateStateRecord(Snapshot.PreexistingSnapshotId.toSnapshotId(), value)
                }
            }
        }
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<h3 data-id="heading-4">å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h3>
<ol>
<li><strong>è·å–å½“å‰å¿«ç…§</strong>: <code>currentSnapshot()</code> è¿”å› GlobalSnapshotï¼ˆå‡è®¾ id=1ï¼‰</li>
<li><strong>åˆ›å»º StateRecord</strong>: åˆ›å»º <code>StateStateRecord(snapshotId=1, value="")</code></li>
<li><strong>å†…å­˜ç»“æ„</strong>:</li>
</ol>
<pre><code class="hljs language-ini" lang="ini">person.name (SnapshotMutableStateImpl)
    â”‚
    â””â”€â”€ next â”€â”€â–º StateStateRecord
                   â”œâ”€â”€ <span class="hljs-attr">snapshotId</span> = <span class="hljs-number">1</span>
                   â”œâ”€â”€ <span class="hljs-attr">value</span> = <span class="hljs-string">""</span>
                   â””â”€â”€ <span class="hljs-attr">next</span> = null
</code></pre>
<hr/>
<h2 data-id="heading-5">ç¬¬äºŒæ­¥ï¼šç¬¬ä¸€æ¬¡èµ‹å€¼ (person.name.value = "ä»¤ç‹å†²")</h2>
<h3 data-id="heading-6">æºç ä½ç½®ï¼šSnapshotState.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> value: T
    <span class="hljs-keyword">get</span>() = next.readable(<span class="hljs-keyword">this</span>).value
    <span class="hljs-keyword">set</span>(value) =
        next.withCurrent {
            <span class="hljs-keyword">if</span> (!policy.equivalent(it.value, value)) {
                next.overwritable(<span class="hljs-keyword">this</span>, it) { <span class="hljs-keyword">this</span>.value = value }
            }
        }
</code></pre>
<p>å½“ <code>value = "ä»¤ç‹å†²"</code> æ—¶ï¼š</p>
<ol>
<li><strong>è°ƒç”¨ <code>withCurrent</code></strong>: æ‰¾åˆ°å½“å‰å¯è¯»çš„è®°å½•</li>
<li><strong>æ£€æŸ¥ç­‰ä»·æ€§</strong>: <code>policy.equivalent("", "ä»¤ç‹å†²")</code> è¿”å› <code>false</code></li>
<li><strong>è°ƒç”¨ <code>overwritable</code></strong></li>
</ol>
<h3 data-id="heading-7">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : StateRecord, R&gt;</span> T.<span class="hljs-title">overwritable</span><span class="hljs-params">(
    state: <span class="hljs-type">StateObject</span>,
    candidate: <span class="hljs-type">T</span>,
    block: <span class="hljs-type">T</span>.() -&gt; <span class="hljs-type">R</span>,
)</span></span>: R {
    <span class="hljs-keyword">val</span> snapshot: Snapshot
    <span class="hljs-keyword">return</span> sync {
            snapshot = Snapshot.current  <span class="hljs-comment">// GlobalSnapshot (id=1)</span>
            <span class="hljs-keyword">this</span>.overwritableRecord(state, snapshot, candidate).block()
        }
        .also { notifyWrite(snapshot, state) }
}
</code></pre>
<h3 data-id="heading-8">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : StateRecord&gt;</span> T.<span class="hljs-title">overwritableRecord</span><span class="hljs-params">(
    state: <span class="hljs-type">StateObject</span>,
    snapshot: <span class="hljs-type">Snapshot</span>,
    candidate: <span class="hljs-type">T</span>,
)</span></span>: T {
    <span class="hljs-keyword">val</span> id = snapshot.snapshotId  <span class="hljs-comment">// id=1</span>

    <span class="hljs-comment">// å¦‚æœ candidate å·²ç»æ˜¯å½“å‰å¿«ç…§åˆ›å»ºçš„ï¼Œç›´æ¥è¿”å›</span>
    <span class="hljs-keyword">if</span> (candidate.snapshotId == id) <span class="hljs-keyword">return</span> candidate

    <span class="hljs-comment">// å¦åˆ™åˆ›å»ºæ–°è®°å½•</span>
    <span class="hljs-keyword">val</span> newData = sync { newOverwritableRecordLocked(state) }
    newData.snapshotId = id
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">return</span> newData
}
</code></pre>
<h3 data-id="heading-9">å…³é”®ç‚¹</h3>
<p>å› ä¸º <code>candidate.snapshotId == 1</code> ç­‰äº <code>snapshot.snapshotId == 1</code>ï¼Œ<strong>ç›´æ¥ä¿®æ”¹ç°æœ‰è®°å½•</strong>ï¼</p>
<h3 data-id="heading-10">æ‰§è¡Œåçš„å†…å­˜ç»“æ„</h3>
<pre><code class="hljs language-ini" lang="ini">person.name (SnapshotMutableStateImpl)
    â”‚
    â””â”€â”€ next â”€â”€â–º StateStateRecord
                   â”œâ”€â”€ <span class="hljs-attr">snapshotId</span> = <span class="hljs-number">1</span>
                   â”œâ”€â”€ <span class="hljs-attr">value</span> = <span class="hljs-string">"ä»¤ç‹å†²"</span>  â† è¢«è¦†ç›–
                   â””â”€â”€ <span class="hljs-attr">next</span> = null
</code></pre>
<hr/>
<h2 data-id="heading-11">ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºå¿«ç…§ (Snapshot.takeSnapshot())</h2>
<h3 data-id="heading-12">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">takeSnapshot</span><span class="hljs-params">(readObserver: ((<span class="hljs-type">Any</span>) -&gt; <span class="hljs-type">Unit</span>)? = <span class="hljs-literal">null</span>)</span></span>: Snapshot =
    currentSnapshot().takeNestedSnapshot(readObserver)
</code></pre>
<p>è°ƒç”¨ <code>GlobalSnapshot.takeNestedSnapshot()</code>ï¼š</p>
<h3 data-id="heading-13">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">takeNestedSnapshot</span><span class="hljs-params">(readObserver: ((<span class="hljs-type">Any</span>) -&gt; <span class="hljs-type">Unit</span>)?)</span></span>: Snapshot =
    creatingSnapshot(...) { actualReadObserver, _ -&gt;
        takeNewSnapshot { invalid -&gt;
            ReadonlySnapshot(
                snapshotId = sync { nextSnapshotId.also { nextSnapshotId += <span class="hljs-number">1</span> } },  <span class="hljs-comment">// id=2</span>
                invalid = invalid,
                readObserver = actualReadObserver,
            )
        }
    }
</code></pre>
<h3 data-id="heading-14">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : Snapshot&gt;</span> <span class="hljs-title">takeNewSnapshot</span><span class="hljs-params">(block: (<span class="hljs-type">invalid</span>: <span class="hljs-type">SnapshotIdSet</span>) -&gt; <span class="hljs-type">T</span>)</span></span>: T =
    advanceGlobalSnapshot { invalid -&gt;
        <span class="hljs-keyword">val</span> result = block(invalid)
        sync { openSnapshots = openSnapshots.<span class="hljs-keyword">set</span>(result.snapshotId) }
        result
    }
</code></pre>
<h3 data-id="heading-15">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">advanceGlobalSnapshot</span><span class="hljs-params">(block: (<span class="hljs-type">invalid</span>: <span class="hljs-type">SnapshotIdSet</span>) -&gt; <span class="hljs-type">T</span>)</span></span>: T {
    <span class="hljs-keyword">val</span> globalSnapshot = globalSnapshot
    <span class="hljs-keyword">val</span> result = sync {
        <span class="hljs-comment">// é‡ç½®å…¨å±€å¿«ç…§ï¼Œåˆ†é…æ–° ID</span>
        resetGlobalSnapshotLocked(globalSnapshot, block)
    }
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">return</span> result
}
</code></pre>
<h3 data-id="heading-16">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">resetGlobalSnapshotLocked</span><span class="hljs-params">(
    globalSnapshot: <span class="hljs-type">GlobalSnapshot</span>,
    block: (<span class="hljs-type">invalid</span>: <span class="hljs-type">SnapshotIdSet</span>) -&gt; <span class="hljs-type">T</span>,
)</span></span>: T {
    <span class="hljs-keyword">val</span> snapshotId = globalSnapshot.snapshotId  <span class="hljs-comment">// å½“å‰æ˜¯ 1</span>
    <span class="hljs-keyword">val</span> result = block(openSnapshots.clear(snapshotId))  <span class="hljs-comment">// invalid = {ç©º}</span>
    
    <span class="hljs-keyword">val</span> nextGlobalSnapshotId = nextSnapshotId  <span class="hljs-comment">// è·å–ä¸‹ä¸€ä¸ª ID (2)</span>
    nextSnapshotId += <span class="hljs-number">1</span>
    
    openSnapshots = openSnapshots.clear(snapshotId)
    globalSnapshot.snapshotId = nextGlobalSnapshotId  <span class="hljs-comment">// GlobalSnapshot å˜æˆ id=3</span>
    globalSnapshot.invalid = openSnapshots            <span class="hljs-comment">// {2} - å› ä¸ºå¿«ç…§ 2 è¿˜æœªå…³é—­</span>
    openSnapshots = openSnapshots.<span class="hljs-keyword">set</span>(nextGlobalSnapshotId)  <span class="hljs-comment">// {2, 3}</span>
    
    <span class="hljs-keyword">return</span> result
}
</code></pre>
<h3 data-id="heading-17">æ‰§è¡Œé¡ºåºè¯¦è§£</h3>
<ol>
<li><strong>è¿›å…¥æ—¶</strong>: GlobalSnapshot.id=1, nextSnapshotId=2, openSnapshots={1}</li>
<li><strong>åˆ›å»º ReadonlySnapshot</strong>: id=2, invalid={}ï¼ˆç©ºé›†åˆï¼ï¼‰</li>
<li><strong>æ›´æ–° GlobalSnapshot</strong>: id=3</li>
<li><strong>é€€å‡ºæ—¶</strong>: GlobalSnapshot.id=3, nextSnapshotId=4, openSnapshots={2,3}</li>
</ol>
<h3 data-id="heading-18">å…³é”®ç‚¹ï¼šsnapshot çš„ invalid é›†åˆ</h3>
<pre><code class="hljs language-ini" lang="ini">ReadonlySnapshot:
  <span class="hljs-attr">snapshotId</span> = <span class="hljs-number">2</span>
  <span class="hljs-attr">invalid</span> = {}  â† ç©ºé›†åˆï¼è¿™æ„å‘³ç€å®ƒèƒ½çœ‹åˆ° id &lt;= <span class="hljs-number">2</span> çš„æ‰€æœ‰è®°å½•
</code></pre>
<h3 data-id="heading-19">æ‰§è¡Œåçš„çŠ¶æ€</h3>
<pre><code class="hljs language-ini" lang="ini">GlobalSnapshot: <span class="hljs-attr">id</span>=<span class="hljs-number">3</span>, invalid={<span class="hljs-number">2</span>}
ReadonlySnapshot (æˆ‘ä»¬æ‹¿åˆ°çš„): <span class="hljs-attr">id</span>=<span class="hljs-number">2</span>, invalid={}

person.name çš„è®°å½•é“¾ï¼š
    StateStateRecord(<span class="hljs-attr">snapshotId</span>=<span class="hljs-number">1</span>, value=<span class="hljs-string">"ä»¤ç‹å†²"</span>) â†’ null
</code></pre>
<hr/>
<h2 data-id="heading-20">ç¬¬å››æ­¥ï¼šç¬¬äºŒæ¬¡èµ‹å€¼ (person.name.value = "ä»»ç›ˆç›ˆ")</h2>
<p>å†æ¬¡æ‰§è¡Œ <code>overwritable</code>:</p>
<h3 data-id="heading-21">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : StateRecord&gt;</span> T.<span class="hljs-title">overwritableRecord</span><span class="hljs-params">(
    state: <span class="hljs-type">StateObject</span>,
    snapshot: <span class="hljs-type">Snapshot</span>,
    candidate: <span class="hljs-type">T</span>,
)</span></span>: T {
    <span class="hljs-keyword">val</span> id = snapshot.snapshotId  <span class="hljs-comment">// ç°åœ¨æ˜¯ 3ï¼ˆGlobalSnapshotï¼‰</span>

    <span class="hljs-comment">// candidate.snapshotId = 1, id = 3</span>
    <span class="hljs-comment">// 1 != 3ï¼Œéœ€è¦åˆ›å»ºæ–°è®°å½•ï¼</span>
    <span class="hljs-keyword">if</span> (candidate.snapshotId == id) <span class="hljs-keyword">return</span> candidate

    <span class="hljs-keyword">val</span> newData = sync { newOverwritableRecordLocked(state) }
    newData.snapshotId = id  <span class="hljs-comment">// è®¾ä¸º 3</span>
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">return</span> newData
}
</code></pre>
<h3 data-id="heading-22">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : StateRecord&gt;</span> T.<span class="hljs-title">newOverwritableRecordLocked</span><span class="hljs-params">(state: <span class="hljs-type">StateObject</span>)</span></span>: T {
    <span class="hljs-keyword">return</span> (usedLocked(state) <span class="hljs-keyword">as</span> T?)?.apply { snapshotId = SnapshotIdMax }
        ?: create(SnapshotIdMax).apply {
            <span class="hljs-keyword">this</span>.next = state.firstStateRecord  <span class="hljs-comment">// æŒ‡å‘æ—§è®°å½•</span>
            state.prependStateRecord(<span class="hljs-keyword">this</span> <span class="hljs-keyword">as</span> T)  <span class="hljs-comment">// æ’å…¥é“¾è¡¨å¤´éƒ¨</span>
        } <span class="hljs-keyword">as</span> T
}
</code></pre>
<h3 data-id="heading-23">æ‰§è¡Œåçš„å†…å­˜ç»“æ„</h3>
<pre><code class="hljs language-ini" lang="ini">person.name (SnapshotMutableStateImpl)
    â”‚
    â””â”€â”€ next â”€â”€â–º StateStateRecord (æ–°)
                   â”œâ”€â”€ <span class="hljs-attr">snapshotId</span> = <span class="hljs-number">3</span>
                   â”œâ”€â”€ <span class="hljs-attr">value</span> = <span class="hljs-string">"ä»»ç›ˆç›ˆ"</span>
                   â””â”€â”€ next â”€â”€â–º StateStateRecord (æ—§)
                                  â”œâ”€â”€ <span class="hljs-attr">snapshotId</span> = <span class="hljs-number">1</span>
                                  â”œâ”€â”€ <span class="hljs-attr">value</span> = <span class="hljs-string">"ä»¤ç‹å†²"</span>
                                  â””â”€â”€ <span class="hljs-attr">next</span> = null
</code></pre>
<p><strong>è¿™å°±æ˜¯å…³é”®ï¼šæ—§è®°å½•è¢«ä¿ç•™äº†ï¼</strong></p>
<hr/>
<h2 data-id="heading-24">ç¬¬äº”æ­¥ï¼šç¬¬ä¸€æ¬¡æ‰“å° (åœ¨å…¨å±€å¿«ç…§ä¸­è¯»å–)</h2>
<pre><code class="hljs language-kotlin" lang="kotlin">println(<span class="hljs-string">"ç¬¬ä¸€æ¬¡æ‰“å°ï¼š<span class="hljs-subst">${person.name.value}</span>"</span>)
</code></pre>
<h3 data-id="heading-25">æºç ä½ç½®ï¼šSnapshotState</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">override</span> <span class="hljs-keyword">var</span> value: T
    <span class="hljs-keyword">get</span>() = next.readable(<span class="hljs-keyword">this</span>).value
</code></pre>
<h3 data-id="heading-26">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : StateRecord&gt;</span> T.<span class="hljs-title">readable</span><span class="hljs-params">(state: <span class="hljs-type">StateObject</span>)</span></span>: T {
    <span class="hljs-keyword">val</span> snapshot = Snapshot.current  <span class="hljs-comment">// GlobalSnapshot: id=3, invalid={2}</span>
    snapshot.readObserver?.invoke(state)
    <span class="hljs-keyword">return</span> readable(<span class="hljs-keyword">this</span>, snapshot.snapshotId, snapshot.invalid)
        ?: <span class="hljs-comment">// fallback...</span>
}
</code></pre>
<h3 data-id="heading-27">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : StateRecord&gt;</span> <span class="hljs-title">readable</span><span class="hljs-params">(r: <span class="hljs-type">T</span>, id: <span class="hljs-type">SnapshotId</span>, invalid: <span class="hljs-type">SnapshotIdSet</span>)</span></span>: T? {
    <span class="hljs-comment">// id=3, invalid={2}</span>
    <span class="hljs-keyword">var</span> current: StateRecord? = r
    <span class="hljs-keyword">var</span> candidate: StateRecord? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (valid(current, id, invalid)) {
            candidate =
                <span class="hljs-keyword">if</span> (candidate == <span class="hljs-literal">null</span>) current
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (candidate.snapshotId &lt; current.snapshotId) current <span class="hljs-keyword">else</span> candidate
        }
        current = current.next
    }
    <span class="hljs-keyword">return</span> candidate <span class="hljs-keyword">as</span>? T
}
</code></pre>
<h3 data-id="heading-28">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">valid</span><span class="hljs-params">(
    currentSnapshot: <span class="hljs-type">SnapshotId</span>,
    candidateSnapshot: <span class="hljs-type">SnapshotId</span>,
    invalid: <span class="hljs-type">SnapshotIdSet</span>,
)</span></span>: <span class="hljs-built_in">Boolean</span> {
    <span class="hljs-keyword">return</span> candidateSnapshot != INVALID_SNAPSHOT &amp;&amp;
        candidateSnapshot &lt;= currentSnapshot &amp;&amp;
        !invalid.<span class="hljs-keyword">get</span>(candidateSnapshot)
}
</code></pre>
<h3 data-id="heading-29">ç‰ˆæœ¬é€‰æ‹©è¿‡ç¨‹</h3>
<p>GlobalSnapshot: id=3, invalid={2}</p>























<table><thead><tr><th>è®°å½•</th><th>snapshotId</th><th>valid() æ£€æŸ¥</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>è®°å½•1</td><td>3</td><td>3 != 0 âœ“, 3 &lt;= 3 âœ“, 3 ä¸åœ¨ {2} âœ“</td><td><strong>æœ‰æ•ˆ</strong></td></tr><tr><td>è®°å½•2</td><td>1</td><td>1 != 0 âœ“, 1 &lt;= 3 âœ“, 1 ä¸åœ¨ {2} âœ“</td><td>æœ‰æ•ˆ</td></tr></tbody></table>
<p>é€‰æ‹© snapshotId æœ€å¤§çš„æœ‰æ•ˆè®°å½• â†’ <strong>è®°å½•1 (snapshotId=3, value="ä»»ç›ˆç›ˆ")</strong></p>
<p><strong>è¾“å‡º: ä»»ç›ˆç›ˆ</strong></p>
<hr/>
<h2 data-id="heading-30">ç¬¬å…­æ­¥ï¼šè¿›å…¥å¿«ç…§ (snapshot.enter { ... })</h2>
<h3 data-id="heading-31">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">public</span> <span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">enter</span><span class="hljs-params">(block: () -&gt; <span class="hljs-type">T</span>)</span></span>: T {
    <span class="hljs-keyword">val</span> previous = makeCurrent()
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> block()
    } <span class="hljs-keyword">finally</span> {
        restoreCurrent(previous)
    }
}
</code></pre>
<h3 data-id="heading-32">æºç ä½ç½®ï¼šSnapshot.kt</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">internal</span> <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">makeCurrent</span><span class="hljs-params">()</span></span>: Snapshot? {
    <span class="hljs-keyword">val</span> previous = threadSnapshot.<span class="hljs-keyword">get</span>()
    threadSnapshot.<span class="hljs-keyword">set</span>(<span class="hljs-keyword">this</span>)  <span class="hljs-comment">// å°† ReadonlySnapshot è®¾ä¸ºå½“å‰å¿«ç…§</span>
    <span class="hljs-keyword">return</span> previous
}
</code></pre>
<p>ç°åœ¨ <code>Snapshot.current</code> è¿”å›æˆ‘ä»¬çš„ ReadonlySnapshot (id=2, invalid={})</p>
<hr/>
<h2 data-id="heading-33">ç¬¬ä¸ƒæ­¥ï¼šç¬¬äºŒæ¬¡æ‰“å° (åœ¨ ReadonlySnapshot ä¸­è¯»å–)</h2>
<pre><code class="hljs language-kotlin" lang="kotlin">println(<span class="hljs-string">"ç¬¬äºŒæ¬¡æ‰“å°ï¼š<span class="hljs-subst">${person.name.value}</span>"</span>)
</code></pre>
<p>å†æ¬¡è°ƒç”¨ <code>readable()</code>:</p>
<p>ReadonlySnapshot: id=2, invalid={}</p>
<h3 data-id="heading-34">ç‰ˆæœ¬é€‰æ‹©è¿‡ç¨‹</h3>























<table><thead><tr><th>è®°å½•</th><th>snapshotId</th><th>valid() æ£€æŸ¥</th><th>ç»“æœ</th></tr></thead><tbody><tr><td>è®°å½•1</td><td>3</td><td>3 != 0 âœ“, <strong>3 &lt;= 2 âœ—</strong></td><td><strong>æ— æ•ˆ</strong></td></tr><tr><td>è®°å½•2</td><td>1</td><td>1 != 0 âœ“, 1 &lt;= 2 âœ“, 1 ä¸åœ¨ {} âœ“</td><td><strong>æœ‰æ•ˆ</strong></td></tr></tbody></table>
<p>é€‰æ‹©å”¯ä¸€æœ‰æ•ˆçš„è®°å½• â†’ <strong>è®°å½•2 (snapshotId=1, value="ä»¤ç‹å†²")</strong></p>
<p><strong>è¾“å‡º: ä»¤ç‹å†²</strong></p>
<h3 data-id="heading-35">ä¸ºä»€ä¹ˆè®°å½•1æ— æ•ˆï¼Ÿ</h3>
<pre><code class="hljs language-kotlin" lang="kotlin">candidateSnapshot &lt;= currentSnapshot
<span class="hljs-number">3</span> &lt;= <span class="hljs-number">2</span>  <span class="hljs-comment">// FALSEï¼</span>
</code></pre>
<p>è®°å½•1çš„ snapshotId=3 <strong>å¤§äº</strong> ReadonlySnapshot çš„ id=2ï¼Œæ‰€ä»¥å®ƒå¯¹è¿™ä¸ªå¿«ç…§æ˜¯"æœªæ¥"çš„ï¼Œä¸å¯è§ã€‚</p>
<hr/>
<h2 data-id="heading-36">ç¬¬å…«æ­¥ï¼šé€€å‡ºå¿«ç…§å¹¶ç¬¬ä¸‰æ¬¡æ‰“å°</h2>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// snapshot.enter è¿”å›åï¼Œè‡ªåŠ¨è°ƒç”¨ restoreCurrent(previous)</span>
<span class="hljs-comment">// Snapshot.current åˆå˜å› GlobalSnapshot (id=3)</span>
println(<span class="hljs-string">"ç¬¬ä¸‰æ¬¡æ‰“å°ï¼š<span class="hljs-subst">${person.name.value}</span>"</span>)
</code></pre>
<p>ä¸ç¬¬äº”æ­¥ç›¸åŒçš„é€»è¾‘ï¼Œ<strong>è¾“å‡º: ä»»ç›ˆç›ˆ</strong></p>
<hr/>
<h2 data-id="heading-37">æ ¸å¿ƒåŸç†æ€»ç»“</h2>
<h3 data-id="heading-38">1. MVCC å¤šç‰ˆæœ¬</h3>
<p>æ¯æ¬¡åœ¨<strong>æ–°å¿«ç…§</strong>ä¸­ä¿®æ”¹çŠ¶æ€ï¼Œéƒ½ä¼š<strong>åˆ›å»ºæ–°è®°å½•</strong>è€Œä¸æ˜¯è¦†ç›–æ—§è®°å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">é“¾è¡¨å¤´ â†’ Record(<span class="hljs-built_in">id</span>=3, <span class="hljs-string">"ä»»ç›ˆç›ˆ"</span>) â†’ Record(<span class="hljs-built_in">id</span>=1, <span class="hljs-string">"ä»¤ç‹å†²"</span>) â†’ null
</code></pre>
<h3 data-id="heading-39">2. ç‰ˆæœ¬é€‰æ‹©ç®—æ³•</h3>
<p><code>readable()</code> å‡½æ•°é€šè¿‡ä¸‰ä¸ªæ¡ä»¶é€‰æ‹©ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">candidateSnapshot != INVALID_SNAPSHOT &amp;&amp;  <span class="hljs-comment">// ä¸æ˜¯æ— æ•ˆ ID</span>
candidateSnapshot &lt;= currentSnapshot &amp;&amp;   <span class="hljs-comment">// ä¸è¶…è¿‡å½“å‰å¿«ç…§ ID</span>
!invalid.<span class="hljs-keyword">get</span>(candidateSnapshot)           <span class="hljs-comment">// ä¸åœ¨ invalid é›†åˆä¸­</span>
</code></pre>
<h3 data-id="heading-40">3. invalid é›†åˆçš„ä½œç”¨</h3>
<ul>
<li>å¿«ç…§åˆ›å»ºæ—¶ï¼Œè®°å½•å“ªäº›å¿«ç…§ ID æ˜¯"ä¸å¯è§"çš„</li>
<li>å¯¹äº ReadonlySnapshotï¼Œåˆ›å»ºæ—¶çš„ invalid æ˜¯ç©ºçš„</li>
<li>å¯¹äº GlobalSnapshotï¼Œinvalid åŒ…å«æ‰€æœ‰æœª apply çš„ MutableSnapshot</li>
</ul>
<h3 data-id="heading-41">4. ThreadLocal å®ç°çº¿ç¨‹éš”ç¦»</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> threadSnapshot = SnapshotThreadLocal&lt;Snapshot&gt;()

<span class="hljs-keyword">internal</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">currentSnapshot</span><span class="hljs-params">()</span></span>: Snapshot = 
    threadSnapshot.<span class="hljs-keyword">get</span>() ?: globalSnapshot
</code></pre>
<hr/>
<h2 data-id="heading-42">å›¾è§£å®Œæ•´æµç¨‹</h2>
<pre><code class="hljs language-ini" lang="ini">æ—¶é—´çº¿:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º

T1: mutableStateOf("")
    GlobalSnapshot <span class="hljs-attr">id</span>=<span class="hljs-number">1</span>
    Record: <span class="hljs-section">[id=1, value=""]</span>
    
T2: <span class="hljs-attr">value</span> = <span class="hljs-string">"ä»¤ç‹å†²"</span>  
    GlobalSnapshot <span class="hljs-attr">id</span>=<span class="hljs-number">1</span> (æœªå˜)
    Record: <span class="hljs-section">[id=1, value="ä»¤ç‹å†²"]</span>  â† ç›´æ¥è¦†ç›–ï¼Œå› ä¸ºåŒä¸€å¿«ç…§
    
T3: takeSnapshot()
    GlobalSnapshot <span class="hljs-attr">id</span>=<span class="hljs-number">3</span> (æ¨è¿›äº†!)
    ReadonlySnapshot <span class="hljs-attr">id</span>=<span class="hljs-number">2</span>, invalid={}
    Record: ä¸å˜
    
T4: <span class="hljs-attr">value</span> = <span class="hljs-string">"ä»»ç›ˆç›ˆ"</span>
    GlobalSnapshot <span class="hljs-attr">id</span>=<span class="hljs-number">3</span>
    åˆ›å»ºæ–°è®°å½•!
    Recordé“¾: <span class="hljs-section">[id=3, value="ä»»ç›ˆç›ˆ"]</span> â†’ <span class="hljs-section">[id=1, value="ä»¤ç‹å†²"]</span>
    
T5: å…¨å±€è¯»å– (GlobalSnapshot <span class="hljs-attr">id</span>=<span class="hljs-number">3</span>, invalid={<span class="hljs-number">2</span>})
    é€‰æ‹©: <span class="hljs-attr">id</span>=<span class="hljs-number">3</span> çš„è®°å½• (<span class="hljs-number">3</span> &lt;= <span class="hljs-number">3</span> ä¸” <span class="hljs-number">3</span> ä¸åœ¨ {<span class="hljs-number">2</span>})
    ç»“æœ: "ä»»ç›ˆç›ˆ"
    
T6: snapshot.enter è¯»å– (ReadonlySnapshot <span class="hljs-attr">id</span>=<span class="hljs-number">2</span>, invalid={})
    æ£€æŸ¥ <span class="hljs-attr">id</span>=<span class="hljs-number">3</span>: <span class="hljs-number">3</span> &lt;= <span class="hljs-number">2</span>? <span class="hljs-literal">NO</span> â†’ æ— æ•ˆ
    æ£€æŸ¥ <span class="hljs-attr">id</span>=<span class="hljs-number">1</span>: <span class="hljs-number">1</span> &lt;= <span class="hljs-number">2</span>? <span class="hljs-literal">YES</span> â†’ æœ‰æ•ˆ
    ç»“æœ: "ä»¤ç‹å†²"
    
T7: å…¨å±€è¯»å–
    åŒ T5
    ç»“æœ: "ä»»ç›ˆç›ˆ"
</code></pre>
<p>è¿™å°±æ˜¯å¿«ç…§èƒ½çœ‹åˆ°"è¿‡å»"çŠ¶æ€çš„å®Œæ•´åŸç†ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Androidè¾“å…¥ç³»ç»Ÿæºç åˆ†æ(ä¸Š)]]></title>    <link>https://juejin.cn/post/7591338980693639214</link>    <guid>https://juejin.cn/post/7591338980693639214</guid>    <pubDate>2026-01-04T12:31:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591338980693639214" data-draft-id="7591360623469363210" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Androidè¾“å…¥ç³»ç»Ÿæºç åˆ†æ(ä¸Š)"/> <meta itemprop="keywords" content="æºç "/> <meta itemprop="datePublished" content="2026-01-04T12:31:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CarryZhang"/> <meta itemprop="url" content="https://juejin.cn/user/782508007385415"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Androidè¾“å…¥ç³»ç»Ÿæºç åˆ†æ(ä¸Š)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/782508007385415/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CarryZhang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T12:31:26.000Z" title="Sun Jan 04 2026 12:31:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»24åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.å‰è¨€</h2>
<p>Androidçš„è¾“å…¥ç³»ç»Ÿæ˜¯è´¯ç©¿å„ä¸ªç³»ç»Ÿçš„äº‹ä»¶ç®¡çº¿ã€‚</p>
<p>åœ¨æœ€ä½å±‚ï¼Œç‰©ç†è¾“å…¥è®¾å¤‡ä¼šç”Ÿæˆæè¿°çŠ¶æ€æ›´æ”¹ï¼ˆä¾‹å¦‚æŒ‰é”®æŒ‰å‹å’Œè½»è§¦æ¥è§¦ç‚¹ï¼‰çš„ä¿¡å·ã€‚è®¾å¤‡å›ºä»¶ä»¥æŸç§æ–¹å¼ç¼–ç å’Œä¼ è¾“è¿™äº›ä¿¡å·ï¼Œä¾‹å¦‚å‘ç³»ç»Ÿå‘é€ USB HID æŠ¥å‘Šæˆ–åœ¨ I2C æ€»çº¿ä¸Šäº§ç”Ÿä¸­æ–­ã€‚</p>
<p>è¾“å…¥è®¾å¤‡é©±åŠ¨ç¨‹åºè´Ÿè´£é€šè¿‡ Linux è¾“å…¥åè®®å°†è®¾å¤‡ç‰¹å®šä¿¡å·è½¬æ¢ä¸ºæ ‡å‡†è¾“å…¥äº‹ä»¶æ ¼å¼ã€‚Linux è¾“å…¥åè®®åœ¨Â <code>linux/input.h</code>Â å†…æ ¸å¤´æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ç»„æ ‡å‡†äº‹ä»¶ç±»å‹å’Œä»£ç ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼ŒAndroidÂ <code>EventHub</code>Â ç»„ä»¶é€šè¿‡æ‰“å¼€ä¸æ¯ä¸ªè¾“å…¥è®¾å¤‡å…³è”çš„Â <code>evdev</code>Â é©±åŠ¨ç¨‹åºä»å†…æ ¸è¯»å–è¾“å…¥äº‹ä»¶ã€‚ç„¶åï¼ŒAndroid <code>InputReader</code> ç»„ä»¶æ ¹æ®è®¾å¤‡ç±»åˆ«è§£ç è¾“å…¥äº‹ä»¶ï¼Œå¹¶ç”Ÿæˆ Android è¾“å…¥äº‹ä»¶æµã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼ŒLinux è¾“å…¥åè®®äº‹ä»¶ä»£ç å°†æ ¹æ®è¾“å…¥è®¾å¤‡é…ç½®ã€é”®ç›˜å¸ƒå±€æ–‡ä»¶å’Œå„ç§æ˜ å°„è¡¨ï¼Œè½¬åŒ–ä¸º Android äº‹ä»¶ä»£ç ã€‚</p>
<p>æœ€åï¼Œ<code>InputReader</code>Â å°†è¾“å…¥äº‹ä»¶å‘é€åˆ° <code>InputDispatcher</code>ï¼Œç”±å…¶é€šè¿‡<code>socket</code>å¯¹å°†è¿™äº›äº‹ä»¶è½¬å‘åˆ°ç›¸åº”çš„çª—å£clientï¼Œå„çª—å£æ”¶åˆ°äº‹ä»¶æ‰¾åˆ°æœ€åŒ¹é…çš„<code>InputState</code>å¤„ç†äº‹ä»¶,å¤„ç†å®Œäº‹ä»¶æœ€ç»ˆåˆé€šè¿‡<code>socket</code>å¯¹å°†äº‹ä»¶å¤„ç†ç»“æŸæ ‡è®°å›ä¼ åˆ°serverç«¯çš„<code>InputDispatcher</code>ï¼Œè¿™æ ·ä¸€ä¸ªäº‹ä»¶çš„åˆ†å‘å¤„ç†æµç¨‹æ‰ç®—ç»“æŸã€‚ç„¶å<code>InputDispatcher</code>åˆå¯ä»¥å¼€å§‹åˆ†å‘ä¸‹ä¸€ä¸ªäº‹ä»¶äº†ã€‚</p>
<p>æ•´ä½“çš„ æ¶æ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caf88e478f4f481f841c4dc077813108~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2FycnlaaGFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768135397&amp;x-signature=kEjBtegg5R2hE2ZwOXQnKqCCtdM%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">2.IMSç³»ç»Ÿåˆå§‹åŒ–</h2>
<p>åœ¨Androidç³»ç»Ÿå¯åŠ¨æ—¶å¯åŠ¨äº†å¾ˆå¤šæœåŠ¡ï¼ŒåŒ…æ‹¬å¼•å¯¼æœåŠ¡ã€æ ¸å¿ƒæœåŠ¡ã€å…¶ä»–æœåŠ¡ç­‰ï¼Œæˆ‘ä»¬çš„IMSå°±æ˜¯åœ¨å…¶ä»–æœåŠ¡é‡Œå¯åŠ¨çš„ã€‚</p>
<p>æœ¬æ–‡çš„æºç æ˜¯åŸºäº<a href="https://link.juejin.cn?target=https%3A%2F%2Fcs.android.com%2F" target="_blank" title="https://cs.android.com/" ref="nofollow noopener noreferrer">cs.android.com/</a> maintåˆ†æ”¯ æœ€æ–°ä»£ç åˆ†æçš„ã€‚</p>
<pre><code class="hljs language-scss" lang="scss">frameworks/base/services/java/com/android/server/SystemServer<span class="hljs-selector-class">.java</span>
private void <span class="hljs-built_in">startOtherServices</span>(@NonNull TimingsTraceAndSlog t) {
    ...
    InputManagerService inputManager = new <span class="hljs-built_in">InputManagerService</span>(context);
    <span class="hljs-comment">//å…³è”WMSå’ŒIMS</span>
    WindowManagerService wm = WindowManagerService<span class="hljs-selector-class">.main</span>(context, inputManager, !mFirstBoot,
                new PhoneWindowManager(), mActivityManagerService<span class="hljs-selector-class">.mActivityTaskManager</span>);
    inputManager<span class="hljs-selector-class">.setWindowManagerCallbacks</span>(wm.getInputManagerCallback());
    <span class="hljs-comment">//å¯åŠ¨ims</span>
    inputManager<span class="hljs-selector-class">.start</span>();
    ...
}

frameworks/base/services/core/java/com/android/server/<span class="hljs-selector-tag">input</span>/InputManagerService<span class="hljs-selector-class">.java</span>
public void <span class="hljs-built_in">start</span>() {
    Slog<span class="hljs-selector-class">.i</span>(TAG, "Starting input manager");
    mNative<span class="hljs-selector-class">.start</span>();

    <span class="hljs-comment">// Add ourselves to the Watchdog monitors.</span>
    Watchdog<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.addMonitor</span>(this);
}

frameworks/base/services/core/jni/com_android_server_input_InputManagerService<span class="hljs-selector-class">.cpp</span>
int <span class="hljs-built_in">register_android_server_InputManager</span>(JNIEnv* env) {
    <span class="hljs-comment">//æ³¨å†Œjniæ–¹æ³•</span>
    int res = <span class="hljs-built_in">jniRegisterNativeMethods</span>(env,
                                       "com/android/server/input/"
                                       "NativeInputManagerService$NativeImpl",
                                       gInputManagerMethods, NELEM(gInputManagerMethods));
    (void)res; <span class="hljs-comment">// Faked use when LOG_NDEBUG.</span>
    <span class="hljs-built_in">LOG_FATAL_IF</span>(res &lt; <span class="hljs-number">0</span>, "Unable to register native methods.");

    <span class="hljs-built_in">FIND_CLASS</span>(gNativeInputManagerServiceImpl.clazz,
               "com/android/server/input/"
               "NativeInputManagerService$NativeImpl");
   <span class="hljs-comment">//æ³¨å†Œjavaå¼•ç”¨</span>
    gNativeInputManagerServiceImpl<span class="hljs-selector-class">.clazz</span> =
            <span class="hljs-built_in">jclass</span>(env-&gt;NewGlobalRef(gNativeInputManagerServiceImpl.clazz));
    gNativeInputManagerServiceImpl<span class="hljs-selector-class">.mPtr</span> =
            env-&gt;<span class="hljs-built_in">GetFieldID</span>(gNativeInputManagerServiceImpl.clazz, "mPtr", "J");
}

static void <span class="hljs-built_in">nativeStart</span>(JNIEnv* env, jobject nativeImplObj) {
    NativeInputManager* im = <span class="hljs-built_in">getNativeInputManager</span>(env, nativeImplObj);

    status_t result = im-&gt;<span class="hljs-built_in">getInputManager</span>()-&gt;<span class="hljs-built_in">start</span>();
    if (result) {
        <span class="hljs-built_in">jniThrowRuntimeException</span>(env, "Input manager could not be started.");
    }
}

frameworks/native/services/inputflinger/InputManager<span class="hljs-selector-class">.cpp</span>
InputManager::<span class="hljs-built_in">InputManager</span>(const sp&lt;InputReaderPolicyInterface&gt;&amp; readerPolicy,
                       InputDispatcherPolicyInterface&amp; dispatcherPolicy,
                       PointerChoreographerPolicyInterface&amp; choreographerPolicy,
                       InputFilterPolicyInterface&amp; inputFilterPolicy) {
    mInputFlingerRust = <span class="hljs-built_in">createInputFlingerRust</span>();
    <span class="hljs-comment">//åˆå§‹åŒ–InputDispatcher</span>
    mDispatcher = <span class="hljs-built_in">createInputDispatcher</span>(dispatcherPolicy);
    mTracingStages<span class="hljs-selector-class">.emplace_back</span>(
        std::make_unique&lt;TracedInputListener&gt;("InputDispatcher", *mDispatcher));
    ...
    <span class="hljs-comment">//åˆå§‹åŒ–InputDispatcher</span>
    mReader = <span class="hljs-built_in">createInputReader</span>(readerPolicy, *mTracingStages.back());
}

status_t InputManager::<span class="hljs-built_in">start</span>() {
    <span class="hljs-comment">//å¼€å§‹è½®è¯¢åˆ†å‘äº‹ä»¶</span>
    status_t result = mDispatcher-&gt;<span class="hljs-built_in">start</span>();
    if (result) {
        <span class="hljs-built_in">ALOGE</span>("Could not start InputDispatcher thread due to error %d.", result);
        return result;
    }
    <span class="hljs-comment">//å¼€å§‹è½®è¯¢è¯»å–äº‹ä»¶</span>
    result = mReader-&gt;<span class="hljs-built_in">start</span>();
    if (result) {
        <span class="hljs-built_in">ALOGE</span>("Could not start InputReader due to error %d.", result);

        mDispatcher-&gt;<span class="hljs-built_in">stop</span>();
        return result;
    }

    return OK;
}
</code></pre>
<p>IMSå¯åŠ¨æ—¶ä¸»è¦æ˜¯åˆå§‹åŒ–äº‹ä»¶åˆ†å‘å™¨InputDispatcherå’Œäº‹ä»¶è¯»å–å™¨InputReaderï¼Œå¹¶åˆ†åˆ«å¼€å§‹è½®è¯¢ã€‚æ¥ä¸‹æ¥å°†åˆ†åˆ«å¯¹äº‹ä»¶è¯»å–æµç¨‹å’Œåˆ†å‘æµç¨‹è¿›è¡Œåˆ†æã€‚</p>
<h2 data-id="heading-2">3.InputReaderäº‹ä»¶è¯»å–ã€ç»„è£…å’Œé¢„åˆ†å‘</h2>
<p><code>InputReader</code>ä¸­çš„<code>InputThread</code>ä¸€ç›´å¾ªç¯ä»<code>EventHub</code>ä¸­è¯»å–è®¾å¤‡è¾“å…¥çš„äº‹ä»¶å’Œå¯¹äº‹ä»¶è¿›è¡Œå°è£…ï¼ŒåŒæ—¶å°†äº‹ä»¶ä¼ é€’åˆ°<code>InputDispatcher</code>çš„é˜Ÿåˆ—ä¸­ï¼Œä»¥ä¾¿åç»­çš„åˆ†å‘ã€‚</p>
<p>å…ˆä»åˆå§‹åŒ–å¼€å§‹å…¥æ‰‹ï¼ŒInputDispatcheråˆå§‹åŒ–æ—¶åŒæ—¶åˆå§‹åŒ–äº†EventHubï¼ŒåŒæ—¶è¿˜å…³è”äº†mTracingStagesï¼Œè€ŒmTracingStagesé‡Œé¢åˆå…³è”äº†äº‹ä»¶åˆ†å‘çš„InputDispatcherã€‚</p>
<pre><code class="hljs language-c" lang="c">frameworks/native/services/inputflinger/reader/InputReaderFactory.cpp
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;InputReaderInterface&gt; <span class="hljs-title function_">createInputReader</span><span class="hljs-params">(
    <span class="hljs-type">const</span> sp&lt;InputReaderPolicyInterface&gt;&amp; policy, InputListenerInterface&amp; listener)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">std</span>::make_unique&lt;InputReader&gt;(<span class="hljs-built_in">std</span>::make_unique&lt;EventHub&gt;(), policy, listener);
}
</code></pre>
<p>InputReader::start()é‡Œåˆå§‹åŒ–äº†InputThreadï¼ŒInputThreadæ˜¯C++ Threadçš„å­ç±»ï¼Œè¿™é‡Œç›¸å½“äºå¼€å¯äº†è½®è¯¢ï¼Œå¾ªç¯è°ƒç”¨ loopOnceï¼Œçº¿ç¨‹çš„æ‰§è¡Œæµç¨‹å¯ä»¥å‚é˜…ç›¸å…³ä»‹ç»ã€‚</p>
<pre><code class="hljs language-arduino" lang="arduino">frameworks/native/services/inputflinger/reader/InputReader.cpp
std::shared_ptr&lt;EventHubInterface&gt; mEventHub;
sp&lt;InputReaderPolicyInterface&gt; mPolicy;
<span class="hljs-function">std::list&lt;NotifyArgs&gt; mPendingArgs <span class="hljs-title">GUARDED_BY</span><span class="hljs-params">(mLock)</span></span>;

<span class="hljs-function"><span class="hljs-type">status_t</span> <span class="hljs-title">InputReader::start</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (mThread) {
        <span class="hljs-keyword">return</span> ALREADY_EXISTS;
    }
    mThread = std::<span class="hljs-built_in">make_unique</span>&lt;InputThread&gt;(
            <span class="hljs-string">"InputReader"</span>, [<span class="hljs-keyword">this</span>]() { <span class="hljs-built_in">loopOnce</span>(); }, [<span class="hljs-keyword">this</span>]() { mEventHub-&gt;<span class="hljs-built_in">wake</span>(); });
    <span class="hljs-keyword">return</span> OK;
}


frameworks/native/services/inputflinger/reader/InputReader.<span class="hljs-function">cpp
<span class="hljs-type">void</span> <span class="hljs-title">InputReader::loopOnce</span><span class="hljs-params">()</span> </span>{

    std::vector&lt;InputDeviceInfo&gt; inputDevices;
    std::list&lt;NotifyArgs&gt; notifyArgs;
    { 
        <span class="hljs-comment">//è®¡ç®—epoll_waitç­‰å¾…æ—¶é—´ï¼Œå¤§éƒ¨åˆ†ä¸º-1ï¼Œå³ä¸€ç›´é˜»å¡,ç›´åˆ°è¯»å–åˆ°äº‹ä»¶</span>
        timeoutMillis = <span class="hljs-number">-1</span>;
        ...
    } 
    std::vector&lt;RawEvent&gt; events = mEventHub-&gt;<span class="hljs-built_in">getEvents</span>(timeoutMillis);<span class="hljs-comment">//æ³¨é‡Š1</span>

    { <span class="hljs-comment">// acquire lock</span>

        <span class="hljs-keyword">if</span> (!events.<span class="hljs-built_in">empty</span>()) {

            <span class="hljs-comment">//ç»„è£…äº‹ä»¶ï¼Œäº‹ä»¶åˆ†ä¸‰ç§ï¼š1.æ·»åŠ è¾“å…¥è®¾å¤‡ï¼Œ2.ç§»é™¤è¾“å…¥è®¾å¤‡,3.è®¾å¤‡äº§å“çš„äº‹ä»¶</span>
            mPendingArgs += <span class="hljs-built_in">processEventsLocked</span>(events.<span class="hljs-built_in">data</span>(), events.<span class="hljs-built_in">size</span>());<span class="hljs-comment">//æ³¨é‡Š2</span>
        }
        ...
        std::<span class="hljs-built_in">swap</span>(notifyArgs, mPendingArgs);
        ...
    } <span class="hljs-comment">// release lock</span>


    <span class="hljs-comment">// Flush queued events out to the listener.</span>
    <span class="hljs-comment">//é€šçŸ¥InputDispatcheræœ‰æ–°äº‹ä»¶éœ€è¦å¤„ç†</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> NotifyArgs&amp; args : notifyArgs) {
        mNextListener.<span class="hljs-built_in">notify</span>(args);<span class="hljs-comment">//æ³¨é‡Š3</span>
    }

    <span class="hljs-comment">// Notify the policy that input devices have changed.</span>
    <span class="hljs-keyword">if</span> (inputDevicesChanged) {
        mPolicy-&gt;<span class="hljs-built_in">notifyInputDevicesChanged</span>(inputDevices);
    }
    ...
}
</code></pre>
<p>loopOnceè¿™é‡Œä¸»è¦åˆ†ææ ‡æ³¨æ³¨é‡Šçš„ä¸‰ä¸ªæ–¹æ³•ï¼Œ</p>
<ul>
<li><strong>æ³¨é‡Š1</strong> è¯»å–äº‹ä»¶ï¼šä»EventHubè·å–æ—¶é—´ï¼Œç­‰å¾…æ—¶é—´ä¸ºtimeoutMillisï¼Œè¿™ä¸ªä¸€èˆ¬éƒ½æ˜¯-1ï¼Œå³epoll_waitä¸€ç›´é˜»å¡ç­‰å¾…äº‹ä»¶</li>
<li><strong>æ³¨é‡Š2</strong> å°è£…äº‹ä»¶ï¼šäº‹ä»¶åˆ†ä¸‰ç±»ï¼šæ–°å¢è¾“å…¥è®¾å¤‡(ä¾‹å¦‚å¤–æ¥é”®ç›˜/æ’å…¥è€³æœºç­‰)ï¼Œåˆ é™¤è¾“å…¥è®¾å¤‡ï¼Œè®¾å¤‡æ­£å¸¸çš„è¾“å…¥äº‹ä»¶ã€‚é’ˆå¯¹ä¸åŒç±»å‹çš„æ–°å¢è®¾å¤‡(è§¦æ§å±/é”®ç­‰)InputDeviceClassæ·»åŠ ä¸åŒç±»å‹InputMapperç”¨æ¥å¤„ç†è¯¥è®¾å¤‡åç»­ä¼ å…¥çš„äº‹ä»¶ï¼Œæ”¶åˆ°æŸç§è®¾å¤‡çš„åŸå§‹äº‹ä»¶åï¼Œå°±è·å–å¯¹åº”çš„InputMapperæ¥è¿›è¡Œæ•°æ®å°è£…</li>
<li><strong>æ³¨é‡Š3</strong> åˆ†å‘äº‹ä»¶ï¼šé€šçŸ¥InputDispatcherå¤„ç†å°è£…å¥½çš„äº‹ä»¶</li>
</ul>
<h3 data-id="heading-3">3.1 EventHubè¯»å–äº‹ä»¶</h3>
<p>è¯»å–äº‹ä»¶ä¸»è¦æ˜¯ é€šè¿‡ EventHub è¿›è¡Œçš„ï¼Œè¿™é‡Œæˆ‘ä»¬è¿›ä¸€æ­¥è·Ÿè¿› EventHubçš„æºç ï¼Œå…ˆçœ‹ä¸€ä¸‹EventHub çš„åˆå§‹åŒ–é€»è¾‘</p>
<pre><code class="hljs language-scss" lang="scss">frameworks/native/services/inputflinger/reader/EventHub<span class="hljs-selector-class">.cpp</span>
<span class="hljs-comment">//è¾“å…¥äº‹ä»¶çš„æ–‡ä»¶æ“ä½œç›®å½•</span>
static const char* DEVICE_INPUT_PATH = "/dev/<span class="hljs-selector-tag">input</span>";
<span class="hljs-comment">// v4l2 devices go directly into /dev</span>
static const char* DEVICE_PATH = "/dev";

EventHub::<span class="hljs-built_in">EventHub</span>(void)
  : <span class="hljs-built_in">mBuiltInKeyboardId</span>(NO_BUILT_IN_KEYBOARD),
    <span class="hljs-built_in">mNextDeviceId</span>(<span class="hljs-number">1</span>),
    <span class="hljs-built_in">mControllerNumbers</span>(),
    <span class="hljs-built_in">mNeedToReopenDevices</span>(false),
    <span class="hljs-built_in">mNeedToScanDevices</span>(true),
    <span class="hljs-built_in">mPendingEventCount</span>(<span class="hljs-number">0</span>),
    <span class="hljs-built_in">mPendingEventIndex</span>(<span class="hljs-number">0</span>),
    <span class="hljs-built_in">mPendingINotify</span>(false) {
    <span class="hljs-comment">//åˆå§‹åŒ–mEpollFd</span>
    mEpollFd = <span class="hljs-built_in">epoll_create1</span>(EPOLL_CLOEXEC);
    <span class="hljs-comment">//åˆå§‹åŒ– mINotifyFd</span>
    mINotifyFd = <span class="hljs-built_in">inotify_init1</span>(IN_CLOEXEC);
    <span class="hljs-comment">//å¯¹dev/input ç›®å½•ä¸‹æ–‡ä»¶çš„å¢åˆ è¿›è¡Œç›‘æ§</span>
    if (std::filesystem::exists(DEVICE_INPUT_PATH, errorCode)) {
        <span class="hljs-built_in">addDeviceInputInotify</span>();<span class="hljs-comment">//æ³¨é‡Š4</span>
    } else {
        <span class="hljs-built_in">addDeviceInotify</span>();
    }
    ...
    struct epoll_event eventItem = {};
    eventItem<span class="hljs-selector-class">.events</span> = EPOLLIN | EPOLLWAKEUP;
    eventItem<span class="hljs-selector-class">.data</span><span class="hljs-selector-class">.fd</span> = mINotifyFd;
    <span class="hljs-comment">//FD ç›‘å¬</span>
    int result = <span class="hljs-built_in">epoll_ctl</span>(mEpollFd, EPOLL_CTL_ADD, mINotifyFd, &amp;eventItem);<span class="hljs-comment">//æ³¨é‡Š5</span>
}
void EventHub::<span class="hljs-built_in">addDeviceInputInotify</span>() {
    mDeviceInputWd = <span class="hljs-built_in">inotify_add_watch</span>(mINotifyFd, DEVICE_INPUT_PATH, IN_DELETE | IN_CREATE);
}
void EventHub::<span class="hljs-built_in">addDeviceInotify</span>() {
    mDeviceWd = <span class="hljs-built_in">inotify_add_watch</span>(mINotifyFd, DEVICE_PATH, IN_DELETE | IN_CREATE);
}
</code></pre>
<ul>
<li><strong>æ³¨é‡Š4</strong> è¿™é‡Œä¸»è¦æ˜¯ç›‘å¬ dev/input ç›®å½•ä¸‹æ–‡ä»¶çš„å¢åˆ ï¼Œä¹Ÿå°±æ˜¯ç›‘å¬æ–°å¢å’Œç§»é™¤è¾“å…¥è®¾å¤‡ï¼Œæœ‰æ–°çš„è¾“å…¥è®¾å¤‡æ—¶è¿™é‡Œå°±ä¼šæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ é™¤è®¾å¤‡æ—¶è¿™é‡Œå°±ä¼šç§»é™¤ä¸€ä¸ªå¯¹åº”çš„æ–‡ä»¶ã€‚é€šè¿‡æŒ‡ä»¤<code>adb shell --su --getevent -p </code>å¯ä»¥è·å–è®¾å¤‡dev/input/ç›®å½•ä¸‹çš„è¾“å…¥è®¾å¤‡åŠä¿¡æ¯,é€šè¿‡<code>adb shell -- su -- getevent -lt /dev/input/event1</code>å¯ä»¥ç›‘å¬å¯¹åº”è¾“å…¥è®¾å¤‡çš„æ‰€æœ‰äº‹ä»¶ï¼Œå½“ç›‘å¬çš„ä¸ºè§¦æ‘¸å±æ—¶ï¼ŒæŒ‰å‹æ»‘åŠ¨å±å¹•æ—¶å°±ä¼šçœ‹åˆ°è§¦æ‘¸åŸå§‹æ•°æ®ã€‚mEpollFdä¹Ÿä¼šç›‘å¬è¿™ä¸ªåŸå§‹æ•°æ®ï¼Œè¿™ä¸ªä¸‹é¢ä¼šè®²åˆ°ã€‚</li>
<li><strong>æ³¨é‡Š5</strong> è¿™é‡Œåˆ™æ˜¯epollç›‘å¬ï¼ŒmEpollFdæ·»åŠ å¯¹mINotifyFdçš„ç›‘å¬ï¼Œç›‘å¬çš„äº‹ä»¶åˆ™æ˜¯EPOLLIN | EPOLLWAKEUP
ä¹Ÿå°±æ˜¯å½“æœ‰æ–°çš„è¾“å…¥è®¾å¤‡åŠ å…¥æ—¶ï¼Œé©±åŠ¨ä¼šåœ¨dev/inputä¸‹é¢æ–°å»ºä¸€ä¸ªæ–‡ä»¶(ç”¨æ¥å­˜å‚¨äº‹ä»¶æ•°æ®),æ–°å»ºæ–‡ä»¶æ—¶ï¼Œå°±ä¼šé€šçŸ¥åˆ°mINotifyFdé€šçŸ¥åˆ°mEpollFdï¼ŒmEpollFdçš„epoll_waitå°±ä¼šæ”¶åˆ°äº‹ä»¶è¢«å”¤é†’ã€‚androidç³»ç»Ÿæºç åŸºæœ¬åˆ°å¤„å¯ä»¥çœ‹åˆ°å¯¹epollçš„ä½¿ï¼Œå¯¹epollæœºåˆ¶ä¸ç†Ÿæ‚‰çš„å¯ä»¥å‚è€ƒ<a href="https://juejin.cn/post/7591338980693655598" target="_blank" title="https://juejin.cn/post/7591338980693655598">Androidç³»ç»Ÿä¸‹Looperæ·±åº¦è§£æåŠæ— å¤„ä¸åœ¨çš„epoll</a>.</li>
</ul>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹åˆ†æ EventHub::getEvents æ–¹æ³•</p>
<pre><code class="hljs language-scss" lang="scss">frameworks/native/services/inputflinger/reader/EventHub<span class="hljs-selector-class">.cpp</span>
std::vector&lt;RawEvent&gt; EventHub::<span class="hljs-built_in">getEvents</span>(int timeoutMillis) {
    std::scoped_lock <span class="hljs-built_in">_l</span>(mLock);

    std::array&lt;input_event, EVENT_BUFFER_SIZE&gt; readBuffer;

    std::vector&lt;RawEvent&gt; events;
    bool awoken = false;
    for (;;) { <span class="hljs-comment">//å¾ªç¯1</span>
        ...
        <span class="hljs-comment">// Report any devices that had last been added/removed.</span>
        for (auto it = mClosingDevices.begin(); it != mClosingDevices<span class="hljs-selector-class">.end</span>();) {
            std::unique_ptr&lt;Device&gt; device = std::<span class="hljs-built_in">move</span>(*it);
            <span class="hljs-built_in">ALOGV</span>("Reporting device closed: id=%d, name=%s\n", device-&gt;id, device-&gt;path.c_str());
            const int32_t deviceId = (device-&gt;id == mBuiltInKeyboardId)
                    ? ReservedInputDeviceId::BUILT_IN_KEYBOARD_ID
                    : device-&gt;id;
            <span class="hljs-comment">//æ·»åŠ è®¾å¤‡ç§»é™¤äº‹ä»¶</span>
            events<span class="hljs-selector-class">.push_back</span>({
                    .when = now,
                    .deviceId = deviceId,
                    .type = DEVICE_REMOVED,
            });<span class="hljs-comment">//æ³¨é‡Š6</span>
            it = mClosingDevices<span class="hljs-selector-class">.erase</span>(it);
            if (events.size() == EVENT_BUFFER_SIZE) {
                break;
            }
        }

        if (mNeedToScanDevices) { <span class="hljs-comment">//æ„é€ åˆå§‹åŒ–çš„æ—¶å€™mNeedToScanDeviceså°±æ˜¯true</span>
            mNeedToScanDevices = false;
            <span class="hljs-comment">//ç¬¬ä¸€æ¬¡è¿›æ¥æ¯”èµ°åˆ°è¿™é‡Œï¼Œç›‘å¬å·²æœ‰çš„è®¾å¤‡</span>
            <span class="hljs-built_in">scanDevicesLocked</span>();<span class="hljs-comment">//æ³¨é‡Š7</span>
        }
        ...
        while (!mOpeningDevices.empty()) {
            std::unique_ptr&lt;Device&gt; device = std::<span class="hljs-built_in">move</span>(*mOpeningDevices.<span class="hljs-built_in">rbegin</span>());
            mOpeningDevices<span class="hljs-selector-class">.pop_back</span>();
            <span class="hljs-built_in">ALOGV</span>("Reporting device opened: id=%d, name=%s\n", device-&gt;id, device-&gt;path.c_str());
            const int32_t deviceId = device-&gt;id == mBuiltInKeyboardId ? <span class="hljs-number">0</span> : device-&gt;id;
            <span class="hljs-comment">//æ·»åŠ æ–°å¢è®¾å¤‡äº‹ä»¶</span>
            events<span class="hljs-selector-class">.push_back</span>({
                    .when = now,
                    .deviceId = deviceId,
                    .type = DEVICE_ADDED,
            });<span class="hljs-comment">//æ³¨é‡Š8</span>
            ...

            auto <span class="hljs-selector-attr">[dev_it, inserted]</span> = mDevices<span class="hljs-selector-class">.insert_or_assign</span>(device-&gt;id, std::move(device));
            ...
            if (events.size() == EVENT_BUFFER_SIZE) {
                break;
            }
        }

        <span class="hljs-comment">// Grab the next input event.</span>
        bool deviceChanged = false;
        while (mPendingEventIndex &lt; mPendingEventCount) { <span class="hljs-comment">//å¾ªç¯2</span>
            const struct epoll_event&amp; eventItem = mPendingEventItems<span class="hljs-selector-attr">[mPendingEventIndex++]</span>;
            if (eventItem.data.fd == mINotifyFd) { 
                if (eventItem.events &amp; EPOLLIN) {
                    <span class="hljs-comment">//æœ‰å¢åˆ è¾“å…¥è®¾å¤‡æ—¶</span>
                    mPendingINotify = true;<span class="hljs-comment">//æ³¨é‡Š9</span>
                } else {
                    <span class="hljs-built_in">ALOGW</span>("Received unexpected epoll event <span class="hljs-number">0</span>x%<span class="hljs-number">08</span>x for INotify.", eventItem.events);
                }
                continue;
            }

            ...

            Device* device = <span class="hljs-built_in">getDeviceByFdLocked</span>(eventItem.data.fd);

            ...
            <span class="hljs-comment">// This must be an input event</span>
            <span class="hljs-comment">// è¿™é‡Œçš„éƒ½æ˜¯äº‹ä»¶æ•°æ®äº†</span>
            if (eventItem.events &amp; EPOLLIN) {
                int32_t readSize =
                        <span class="hljs-built_in">read</span>(device-&gt;fd, readBuffer.data(),
                             <span class="hljs-built_in">sizeof</span>(decltype(readBuffer)::value_type) * readBuffer.<span class="hljs-built_in">size</span>());
                ...
                const int32_t deviceId = device-&gt;id == mBuiltInKeyboardId ? <span class="hljs-number">0</span> : device-&gt;id;

                const size_t count = <span class="hljs-built_in">size_t</span>(readSize) / <span class="hljs-built_in">sizeof</span>(struct input_event);
                for (size_t i = <span class="hljs-number">0</span>; i &lt; count; i++) {
                    struct input_event&amp; iev = readBuffer<span class="hljs-selector-attr">[i]</span>;
                    device-&gt;<span class="hljs-built_in">trackInputEvent</span>(iev);
                    <span class="hljs-comment">//æ·»åŠ äº‹ä»¶åŸå§‹æ•°æ®</span>
                    events<span class="hljs-selector-class">.push_back</span>({
                            .when = processEventTimestamp(iev),
                            <span class="hljs-selector-class">.readTime</span> = <span class="hljs-built_in">systemTime</span>(SYSTEM_TIME_MONOTONIC),
                            <span class="hljs-selector-class">.deviceId</span> = deviceId,
                            <span class="hljs-selector-class">.type</span> = iev<span class="hljs-selector-class">.type</span>,
                            <span class="hljs-selector-class">.code</span> = iev<span class="hljs-selector-class">.code</span>,
                            <span class="hljs-selector-class">.value</span> = iev<span class="hljs-selector-class">.value</span>,
                    });<span class="hljs-comment">//æ³¨é‡Š10</span>
                }
                ...
            }
        }
        ...
        <span class="hljs-comment">// æœ‰å¢åˆ è¾“å…¥è®¾å¤‡</span>
        if (mPendingINotify &amp;&amp; mPendingEventIndex &gt;= mPendingEventCount) {
            mPendingINotify = false;
            const auto res = <span class="hljs-built_in">readNotifyLocked</span>();<span class="hljs-comment">//æ³¨é‡Š11</span>
            deviceChanged = true;
        }
        if (deviceChanged) {
            continue;
        }
        if (!events.empty() || awoken) {
            break;
        }

        ...

        mPendingEventIndex = <span class="hljs-number">0</span>;
        mLock<span class="hljs-selector-class">.unlock</span>(); <span class="hljs-comment">// release lock before poll</span>
        <span class="hljs-comment">//ç›‘å¬è¾“å…¥äº‹ä»¶(æ–°å¢è®¾å¤‡ï¼Œåˆ é™¤è®¾å¤‡ï¼Œè®¾å¤‡è¾“å…¥äº‹ä»¶)</span>
        int pollResult = <span class="hljs-built_in">epoll_wait</span>(mEpollFd, mPendingEventItems, EPOLL_MAX_EVENTS, timeoutMillis);<span class="hljs-comment">//æ³¨é‡Š12</span>
        mLock<span class="hljs-selector-class">.lock</span>(); <span class="hljs-comment">// reacquire lock after poll</span>

         ...
        <span class="hljs-comment">// Some events occurred.</span>
        mPendingEventCount = <span class="hljs-built_in">size_t</span>(pollResult);
    }

    <span class="hljs-comment">// All done, return the number of events we read.</span>
    return events;
}
</code></pre>
<p>è¿™é‡Œçš„ä»£ç æ¯”è¾ƒé•¿ï¼Œé‡ç‚¹åˆ†æä¸€ä¸‹æœ‰æ³¨é‡Šçš„åœ°æ–¹</p>
<ul>
<li><strong>æ³¨é‡Š7</strong> æ‰«ædev/input/ç›®å½•ä¸‹ç›®å‰å·²æœ‰çš„è®¾å¤‡æ–‡ä»¶ï¼Œæ·»åŠ å¯¹è®¾å¤‡è¾“å…¥äº‹ä»¶æ–‡ä»¶fd çš„ç›‘å¬ï¼Œåˆ›å»ºè®¾å¤‡Device,å¹¶æ ¹æ®é…ç½®ä¿¡æ¯è®¾ç½®Deviceæ”¯æŒçš„classesï¼Œç³»ç»Ÿæ‰€æœ‰çš„classeséƒ½å®šä¹‰åœ¨ InputDeviceClass æšä¸¾ä¸­
(<code>frameworks/native/services/inputflinger/reader/include/EventHub.h é‡Œçš„ enum class InputDeviceClass</code>),å†æ·»åŠ è®¾å¤‡ä¿¡æ¯Deviceåˆ° mOpeningDevices é˜Ÿåˆ—ä¸­ï¼Œä¸»è¦è°ƒç”¨é€»è¾‘å¦‚ä¸‹</li>
</ul>

<pre><code class="hljs language-rust" lang="rust">frameworks/native/services/inputflinger/reader/EventHub.cpp
void EventHub::<span class="hljs-title function_ invoke__">scanDevicesLocked</span>() {
    ...
    <span class="hljs-comment">//åˆ¤æ–­ dev/inputç›®å½•æ˜¯å¦å­˜åœ¨</span>
    <span class="hljs-title function_ invoke__">if</span> (std::filesystem::<span class="hljs-title function_ invoke__">exists</span>(DEVICE_INPUT_PATH, errorCode)) {
        result = <span class="hljs-title function_ invoke__">scanDirLocked</span>(DEVICE_INPUT_PATH);
    }
    ...
}

status_t EventHub::<span class="hljs-title function_ invoke__">scanDirLocked</span>(<span class="hljs-keyword">const</span> std::string&amp; dirname) {
    <span class="hljs-comment">//éå†ç›®å½•å¯¹å·²å­˜åœ¨è®¾å¤‡æ–‡ä»¶</span>
    <span class="hljs-title function_ invoke__">for</span> (<span class="hljs-keyword">const</span> auto&amp; entry : std::filesystem::<span class="hljs-title function_ invoke__">directory_iterator</span>(dirname)) {
        <span class="hljs-title function_ invoke__">openDeviceLocked</span>(entry.<span class="hljs-title function_ invoke__">path</span>());
    }
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

void EventHub::<span class="hljs-title function_ invoke__">openDeviceLocked</span>(<span class="hljs-keyword">const</span> std::string&amp; devicePath) {
    ...
    int fd = <span class="hljs-title function_ invoke__">open</span>(devicePath.<span class="hljs-title function_ invoke__">c_str</span>(), O_RDWR | O_CLOEXEC | O_NONBLOCK);<span class="hljs-comment">//è·å–è®¾å¤‡æ–‡ä»¶çš„fd</span>
    ...
     std::unique_ptr&lt;Device&gt; device =
    std::make_unique&lt;Device&gt;(fd, deviceId, devicePath, identifier,
                             <span class="hljs-title function_ invoke__">obtainAssociatedDeviceLocked</span>(devicePath));
     ...
     <span class="hljs-comment">//æ·»åŠ é”®ç›˜äº‹ä»¶çš„è®¾å¤‡æ”¯æŒ</span>
   <span class="hljs-comment">//See if this is a device with keys</span>
    <span class="hljs-title function_ invoke__">if</span> (haveKeyboardKeys || haveGamepadButtons || haveStylusButtons) {
        device<span class="hljs-punctuation">-&gt;</span>classes |= InputDeviceClass::KEYBOARD;
    }
    <span class="hljs-comment">//æ·»åŠ è§¦æ‘¸äº‹ä»¶çš„æ”¯æŒ</span>
    <span class="hljs-comment">// See if this is a touch pad.</span>
    <span class="hljs-comment">// Is this a new modern multi-touch driver?</span>
    <span class="hljs-title function_ invoke__">if</span> (device<span class="hljs-punctuation">-&gt;</span>absBitmask.<span class="hljs-title function_ invoke__">test</span>(ABS_MT_POSITION_X) &amp;&amp; device<span class="hljs-punctuation">-&gt;</span>absBitmask.<span class="hljs-title function_ invoke__">test</span>(ABS_MT_POSITION_Y)) {
        <span class="hljs-comment">// Some joysticks such as the PS3 controller report axes that conflict</span>
        <span class="hljs-comment">// with the ABS_MT range.  Try to confirm that the device really is</span>
        <span class="hljs-comment">// a touch screen.</span>
        <span class="hljs-title function_ invoke__">if</span> (device<span class="hljs-punctuation">-&gt;</span>keyBitmask.<span class="hljs-title function_ invoke__">test</span>(BTN_TOUCH) || !haveGamepadButtons) {
            device<span class="hljs-punctuation">-&gt;</span>classes |= (InputDeviceClass::TOUCH | InputDeviceClass::TOUCH_MT);
            <span class="hljs-title function_ invoke__">if</span> (device<span class="hljs-punctuation">-&gt;</span>propBitmask.<span class="hljs-title function_ invoke__">test</span>(INPUT_PROP_POINTER) &amp;&amp;
                !device<span class="hljs-punctuation">-&gt;</span>keyBitmask.<span class="hljs-title function_ invoke__">any</span>(BTN_TOOL_PEN, BTN_TOOL_FINGER) &amp;&amp; !haveStylusButtons) {
                device<span class="hljs-punctuation">-&gt;</span>classes |= InputDeviceClass::TOUCHPAD;
            }
        }
        <span class="hljs-comment">// Is this an old style single-touch driver?</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-title function_ invoke__">if</span> (device<span class="hljs-punctuation">-&gt;</span>keyBitmask.<span class="hljs-title function_ invoke__">test</span>(BTN_TOUCH) &amp;&amp; device<span class="hljs-punctuation">-&gt;</span>absBitmask.<span class="hljs-title function_ invoke__">test</span>(ABS_X) &amp;&amp;
               device<span class="hljs-punctuation">-&gt;</span>absBitmask.<span class="hljs-title function_ invoke__">test</span>(ABS_Y)) {
        device<span class="hljs-punctuation">-&gt;</span>classes |= InputDeviceClass::TOUCH;
        <span class="hljs-comment">// Is this a stylus that reports contact/pressure independently of touch coordinates?</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-title function_ invoke__">if</span> ((device<span class="hljs-punctuation">-&gt;</span>absBitmask.<span class="hljs-title function_ invoke__">test</span>(ABS_PRESSURE) || device<span class="hljs-punctuation">-&gt;</span>keyBitmask.<span class="hljs-title function_ invoke__">test</span>(BTN_TOUCH)) &amp;&amp;
               !device<span class="hljs-punctuation">-&gt;</span>absBitmask.<span class="hljs-title function_ invoke__">test</span>(ABS_X) &amp;&amp; !device<span class="hljs-punctuation">-&gt;</span>absBitmask.<span class="hljs-title function_ invoke__">test</span>(ABS_Y)) {
        device<span class="hljs-punctuation">-&gt;</span>classes |= InputDeviceClass::EXTERNAL_STYLUS;
    }
    ...
    <span class="hljs-comment">//mEpollFdæ·»åŠ å¯¹è®¾å¤‡æ–‡ä»¶fdçš„ç›‘å¬ï¼Œç›‘å¬è®¾å¤‡äº‹ä»¶çš„è¾“å…¥</span>
    <span class="hljs-title function_ invoke__">if</span> (<span class="hljs-title function_ invoke__">registerDeviceForEpollLocked</span>(*device) != OK) {
        <span class="hljs-keyword">return</span>;
    }
    ...
    <span class="hljs-comment">//æ·»åŠ è®¾å¤‡åˆ° mOpeningDevices</span>
    <span class="hljs-title function_ invoke__">addDeviceLocked</span>(std::<span class="hljs-title function_ invoke__">move</span>(device));
}


status_t EventHub::<span class="hljs-title function_ invoke__">registerDeviceForEpollLocked</span>(Device&amp; device) {
    status_t result = <span class="hljs-title function_ invoke__">registerFdForEpoll</span>(device.fd);
    ...
    <span class="hljs-keyword">return</span> result;
}

status_t EventHub::<span class="hljs-title function_ invoke__">registerFdForEpoll</span>(int fd) {
    <span class="hljs-comment">// TODO(b/121395353) - consider adding EPOLLRDHUP</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">epoll_event</span> eventItem = {};
    eventItem.events = EPOLLIN | EPOLLWAKEUP;
    eventItem.data.fd = fd;
    <span class="hljs-comment">//æ·»åŠ å¯¹ è®¾å¤‡è¾“å…¥æ–‡ä»¶æè¿°ç¬¦Fdçš„ç›‘æ§ï¼Œå½“è¯¥è®¾å¤‡æœ‰æ–°äº‹ä»¶è¾“å…¥æ—¶ï¼Œå°±ä¼šå”¤é†’epoll_wait(mEpollFd...)</span>
    <span class="hljs-title function_ invoke__">if</span> (<span class="hljs-title function_ invoke__">epoll_ctl</span>(mEpollFd, EPOLL_CTL_ADD, fd, &amp;eventItem)) {
        <span class="hljs-keyword">return</span> -errno;
    }
    <span class="hljs-keyword">return</span> OK;
}
</code></pre>
<p>è¿™æ ·å½“å½“å‰è®¾å¤‡å¦‚æœæœ‰è¾“å…¥äº‹ä»¶æ—¶ï¼Œå°±ä¼šå”¤é†’ <code>æ³¨é‡Š12</code>å¤„çš„epoll_wait.</p>
<ul>
<li><strong>æ³¨é‡Š12</strong> æ·»åŠ å¯¹mEpollFdçš„ç›‘å¬ï¼Œç›‘å¬mEpollFdçš„å”¤é†’äº‹ä»¶ï¼Œè€Œé€šè¿‡ä¸Šé¢ <code>æ³¨é‡Š7</code>å’Œ<code>æ³¨é‡Š5</code>æ·»åŠ åˆ°mEpollFdçš„fdéƒ½ä¼šè¢«ç›‘æ§åˆ°ï¼Œä¹Ÿå°±æ˜¯ dev/inputä¸‹æœ‰å¢åˆ æ–‡ä»¶(å¢åˆ è¾“å…¥è®¾å¤‡)å’Œæ–‡ä»¶è¾“å…¥(è®¾å¤‡è¾“å…¥äº‹ä»¶)éƒ½ä¼šè¢«ç›‘æ§åˆ°ã€‚åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±æ‹æ¸…äº†æ•´ä¸ªè¾“å…¥äº‹ä»¶çš„ç›‘å¬. epoll_waitä¼šä¸€ç›´é˜»å¡åœ¨è¿™é‡Œï¼Œæœ‰è¾“å…¥è®¾å¤‡å¢åˆ å’Œäº‹ä»¶è¾“å…¥æ—¶éƒ½ä¼šå”¤é†’<code>æ³¨é‡Š12</code>è¿™é‡Œçš„é€»è¾‘ï¼Œæ¥ä¸‹æ¥å°±åˆ†åˆ«å¯¹è®¾å¤‡å¢åˆ äº‹ä»¶å’Œè¾“å…¥äº‹ä»¶çš„æµç¨‹è¿›è¡Œåˆ†æã€‚</li>
</ul>
<h4 data-id="heading-4">3.1.1å¢åˆ è®¾å¤‡äº‹ä»¶çš„è¯»å–</h4>
<p>è®¾å¤‡å¢åˆ ä¸»è¦æ¶‰åŠåˆ° <code>æ³¨é‡Š6ã€æ³¨é‡Š8ã€æ³¨é‡Š9ã€æ³¨é‡Š11</code>ï¼Œå½“æœ‰å¢åˆ è®¾å¤‡æ—¶ï¼Œé¦–å…ˆå”¤é†’äº†<code>æ³¨é‡Š12</code>ï¼Œç„¶åè¿›å…¥åˆ°ä¸‹ä¸€ä¸ªforå¾ªç¯(<code>å¾ªç¯1</code>)ï¼Œæ­¤æ—¶ä¸ä¼šå…ˆèµ°åˆ°<code>æ³¨é‡Š6ã€æ³¨é‡Š8</code>ï¼Œå› ä¸ºæ­¤æ—¶çš„mClosingDeviceså’ŒmOpeningDeviceséƒ½æ˜¯ç©ºçš„ï¼Œä¼šå…ˆæ‰§è¡Œåˆ°whileå¾ªç¯(<code>å¾ªç¯2</code>)ï¼Œå› ä¸ºæ˜¯å¢åˆ è®¾å¤‡ï¼Œæ‰€ä»¥ä¼š æ»¡è¶³ eventItem.data.fd == mINotifyFd å’Œ eventItem.events &amp; EPOLLINï¼Œè¿™æ ·å°±ä¼šæ‰§è¡Œåˆ°<code>æ³¨é‡Š9</code>ï¼Œç„¶åæŒ‘å‡ºwhileå¾ªç¯(<code>å¾ªç¯2</code>)ï¼Œæ­¤æ—¶å°±ä¼šæ‰§è¡Œåˆ°<code>æ³¨é‡Š11</code>.</p>
<ul>
<li><strong>æ³¨é‡Š11</strong> å¤„ç†è®¾å¤‡å¢åˆ é€»è¾‘ï¼Œå½“æœ‰è®¾å¤‡æ–°å¢æ—¶å¤„ç†æµç¨‹å’Œ<code>æ³¨é‡Š7</code>ç±»ä¼¼ï¼Œæ·»åŠ å¯¹è®¾å¤‡è¾“å…¥äº‹ä»¶æ–‡ä»¶fd çš„ç›‘å¬ï¼ŒåŒæ—¶æ·»åŠ è®¾å¤‡ä¿¡æ¯åˆ° mOpeningDevices é˜Ÿåˆ—ä¸­ã€‚ç§»é™¤è®¾å¤‡æ—¶ï¼Œç§»é™¤å¯¹è®¾å¤‡è¾“å…¥äº‹ä»¶æ–‡ä»¶fdçš„ç›‘å¬ï¼ŒåŒäº‹æ·»åŠ è®¾å¤‡ä¿¡æ¯åˆ° mClosingDevices é˜Ÿåˆ—ä¸­ã€‚å…·ä½“è°ƒç”¨é€»è¾‘å¦‚ä¸‹</li>
</ul>

<pre><code class="hljs language-c" lang="c">frameworks/native/services/inputflinger/reader/EventHub.cpp
base::Result&lt;<span class="hljs-type">void</span>&gt; <span class="hljs-title function_">EventHub::readNotifyLocked</span><span class="hljs-params">()</span> {
    ...
    <span class="hljs-keyword">do</span> {
        sizeRead = read(mINotifyFd, eventBuffer, <span class="hljs-keyword">sizeof</span>(eventBuffer));
    } <span class="hljs-keyword">while</span> (sizeRead &lt; <span class="hljs-number">0</span> &amp;&amp; errno == EINTR);
    ...
    <span class="hljs-keyword">for</span> (<span class="hljs-type">ssize_t</span> eventPos = <span class="hljs-number">0</span>; sizeRead &gt;= EVENT_SIZE;) {
        ...
        handleNotifyEventLocked(*event);
        ...
    }
    <span class="hljs-keyword">return</span> {};
}

<span class="hljs-type">void</span> <span class="hljs-title function_">EventHub::handleNotifyEventLocked</span><span class="hljs-params">(<span class="hljs-type">const</span> inotify_event&amp; event)</span> {
    <span class="hljs-keyword">if</span> (event.wd == mDeviceInputWd) {
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span> filename = <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>(DEVICE_INPUT_PATH) + <span class="hljs-string">"/"</span> + event.name;
        <span class="hljs-keyword">if</span> (event.mask &amp; IN_CREATE) {
            openDeviceLocked(filename);<span class="hljs-comment">//æ·»åŠ è®¾å¤‡</span>
        } <span class="hljs-keyword">else</span> {
            closeDeviceByPathLocked(filename);<span class="hljs-comment">//ç§»é™¤è®¾å¤‡</span>
        }
    } 
    ...
}
</code></pre>
<p>åˆ°è¿™é‡Œå¢åˆ äº‹ä»¶è¯»å–å®Œæ¯•åï¼Œå°±ä¼šæ·»åŠ åˆ° mOpeningDevices æˆ– mClosingDevicesä¸­äº†ï¼Œæ­¤æ—¶å°±ä¼šç«‹é©¬åˆ°ä¸‹ä¸€ä¸ªforå¾ªç¯(<code>å¾ªç¯1</code>),ç„¶åæ‰§è¡Œåˆ°<code>æ³¨é‡Š6æˆ–æ³¨é‡Š8</code></p>
<ul>
<li><strong>æ³¨é‡Š6</strong> æ·»åŠ è®¾å¤‡ç§»é™¤äº‹ä»¶åˆ°eventsåˆ—è¡¨ä¸­</li>
<li><strong>æ³¨é‡Š8</strong> æ·»åŠ è®¾å¤‡æ–°å¢äº‹ä»¶åˆ°eventsåˆ—è¡¨ä¸­</li>
</ul>
<h4 data-id="heading-5">3.1.2è®¾å¤‡è¾“å…¥äº‹ä»¶çš„è¯»å–</h4>
<p>æ¥ç€<code>æ³¨é‡Š12</code>åˆ†æï¼Œä¸Šä¸€å°èŠ‚ä¸»è¦åˆ†æäº†è®¾å¤‡æ–°å¢å’Œåˆ é™¤æ—¶æ—¶é—´çš„è¯»å–ï¼Œå¦‚æœæ˜¯è®¾å¤‡æ–°å¢æ—¶ï¼Œè¿˜ä¼šå¯¹æ–°å¢è®¾å¤‡æ–‡ä»¶fdè¿›è¡Œç›‘å¬ï¼Œå½“è¯¥è®¾å¤‡æœ‰è¾“å…¥äº‹ä»¶æ—¶ä¹Ÿä¼šå”¤é†’<code>æ³¨é‡Š12</code>çš„epoll_wait,å”¤é†’ä¹‹åï¼Œä¹Ÿæ˜¯è¿›å…¥åˆ°ä¸‹ä¸€ä¸ªforå¾ªç¯(<code>å¾ªç¯1</code>)ï¼Œå¹¶ç›´æ¥è¿›å…¥åˆ°whileå¾ªç¯(<code>å¾ªç¯2</code>),è·³è¿‡ä¸€äº›é€»è¾‘æ‰§è¡Œåˆ°<code>æ³¨é‡Š10</code></p>
<ul>
<li><strong>æ³¨é‡Š10</strong> æ·»åŠ è®¾å¤‡è¾“å…¥äº‹ä»¶åˆ°eventsåˆ—è¡¨ä¸­</li>
</ul>
<p>è¿™æ ·è®¾å¤‡è¾“å…¥äº‹ä»¶(å¢ã€åˆ ã€è¾“å…¥)å°±è¯»å–å®Œå¹¶æ·»åŠ åˆ°eventsä¸­ï¼Œäº‹ä»¶è¯»å–å®Œå…¨åœ¨EventHub::getEvents()ä¸­è¿›è¡Œï¼Œè¯¥æ–¹æ³•æ˜¯é˜»å¡ï¼Œæ²¡æœ‰è¾“å…¥äº‹ä»¶æ—¶ä¼šä¸€ç›´é˜»å¡åœ¨epoll_waitå¤„(<code>æ³¨é‡Š12</code>)ï¼Œ æ‰§è¡Œåœ¨InputReaderçš„InputThreadä¸­ï¼Œå½“è¯»å–å®Œä¸€ç»„äº‹ä»¶å’Œå¤„ç†åï¼Œåˆä¼šè¿›å…¥åˆ°ä¸‹ä¸€ä¸ªè¯»å–æµç¨‹ä¸­ï¼Œè¿™æ ·åªè¦æœ‰æ–°äº‹ä»¶äº§ç”Ÿå°±ä¼šå”¤é†’EventHubå°†äº‹ä»¶ä¼ é€’ç»™InputReaderè¿›è¡Œåç»­å¤„ç†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æä¸‹InputReaderè¯»å–äº‹ä»¶çš„åç»­æµç¨‹ã€‚</p>
<h3 data-id="heading-6">3.2 InputReader ç»„è£…äº‹ä»¶æ•°æ®</h3>
<p>å‰ä¸€ç« èŠ‚æˆ‘ä»¬å·²ç»é€šè¿‡EventHub--&gt;getEvents()è·å–åˆ°è¾“å…¥äº‹ä»¶çš„åŸå§‹æ•°æ®ï¼Œè¿™é‡Œçš„äº‹ä»¶æ•°æ®ä¸»è¦åˆ†ä¸ºä¸‰å¤§ç±»ï¼Œæ–°å¢è¾“å…¥è®¾å¤‡ï¼Œåˆ é™¤è¾“å…¥è®¾å¤‡ï¼Œè¾“å…¥è®¾å¤‡è¾“å…¥äº‹ä»¶ã€‚ç»„è£…äº‹ä»¶ä¸»è¦ç”±InputReader::processEventsLocked()å¼€å§‹è¿›è¡Œçš„ã€‚</p>
<pre><code class="hljs language-rust" lang="rust">frameworks/native/services/inputflinger/reader/InputReader.cpp
std::list&lt;NotifyArgs&gt; InputReader::<span class="hljs-title function_ invoke__">processEventsLocked</span>(<span class="hljs-keyword">const</span> RawEvent* rawEvents, size_t count) {
    std::list&lt;NotifyArgs&gt; out;
    <span class="hljs-title function_ invoke__">for</span> (<span class="hljs-keyword">const</span> RawEvent* rawEvent = rawEvents; count;) {
        int32_t <span class="hljs-keyword">type</span> = rawEvent<span class="hljs-punctuation">-&gt;</span><span class="hljs-keyword">type</span>;
        ...
        <span class="hljs-title function_ invoke__">if</span> (<span class="hljs-keyword">type</span> &lt; EventHubInterface::FIRST_SYNTHETIC_EVENT) {
            ...
            <span class="hljs-comment">//å°è£…è¾“å…¥è®¾å¤‡çš„è¾“å…¥äº‹ä»¶</span>
            out += <span class="hljs-title function_ invoke__">processEventsForDeviceLocked</span>(deviceId, rawEvent, batchSize);<span class="hljs-comment">//æ³¨é‡Š13</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_ invoke__">switch</span> (rawEvent<span class="hljs-punctuation">-&gt;</span><span class="hljs-keyword">type</span>) {
                case EventHubInterface::DEVICE_ADDED:
                    <span class="hljs-comment">//æ–°å¢è¾“å…¥è®¾å¤‡</span>
                    <span class="hljs-title function_ invoke__">addDeviceLocked</span>(rawEvent<span class="hljs-punctuation">-&gt;</span>when, rawEvent<span class="hljs-punctuation">-&gt;</span>deviceId);<span class="hljs-comment">//æ³¨é‡Š14</span>
                    <span class="hljs-keyword">break</span>;
                case EventHubInterface::DEVICE_REMOVED:
                    <span class="hljs-comment">//åˆ é™¤è¾“å…¥è®¾å¤‡</span>
                    <span class="hljs-title function_ invoke__">removeDeviceLocked</span>(rawEvent<span class="hljs-punctuation">-&gt;</span>when, rawEvent<span class="hljs-punctuation">-&gt;</span>deviceId);<span class="hljs-comment">//æ³¨é‡Š15</span>
                    <span class="hljs-keyword">break</span>;
                default:
                    <span class="hljs-title function_ invoke__">ALOG_ASSERT</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// can't happen</span>
                    <span class="hljs-keyword">break</span>;
            }
        }
        ...
    }
    <span class="hljs-keyword">return</span> out;
}
</code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¾“å…¥è®¾å¤‡æ–°å¢åˆ é™¤äº‹ä»¶å’Œè¾“å…¥è®¾å¤‡è¾“å…¥äº‹ä»¶æ•°æ®å°è£…æµç¨‹è¿›è¡Œåˆ†æ</p>
<h4 data-id="heading-7">3.2.1 InputReader å¢åˆ è¾“å…¥è®¾å¤‡</h4>
<ul>
<li><strong>æ³¨é‡Š14</strong> æ–°å¢è¾“å…¥è®¾å¤‡æ—¶ï¼Œåç»­æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹</li>
</ul>
<pre><code class="hljs language-c" lang="c">frameworks/native/services/inputflinger/reader/InputReader.cpp
<span class="hljs-type">void</span> <span class="hljs-title function_">InputReader::addDeviceLocked</span><span class="hljs-params">(<span class="hljs-type">nsecs_t</span> when, <span class="hljs-type">int32_t</span> eventHubId)</span> {
    ...
    InputDeviceIdentifier identifier = mEventHub-&gt;getDeviceIdentifier(eventHubId);
    <span class="hljs-comment">//æ ¹æ®æ–°å¢è®¾å¤‡çš„ä¿¡æ¯åˆ›é€  InputDevice</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;InputDevice&gt; device = createDeviceLocked(when, eventHubId, identifier);

    mPendingArgs += device-&gt;configure(when, mConfig, <span class="hljs-comment">/*changes=*/</span>{});
    mPendingArgs += device-&gt;reset(when);
    ...
    <span class="hljs-comment">//æ·»åŠ åˆ° é”®å€¼å¯¹é›†åˆ mDevices ä¸­</span>
    mDevices.emplace(eventHubId, device);
    ...
}

<span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;InputDevice&gt; <span class="hljs-title function_">InputReader::createDeviceLocked</span><span class="hljs-params">(
        <span class="hljs-type">nsecs_t</span> when, <span class="hljs-type">int32_t</span> eventHubId, <span class="hljs-type">const</span> InputDeviceIdentifier&amp; identifier)</span> {
    <span class="hljs-keyword">auto</span> deviceIt = <span class="hljs-built_in">std</span>::find_if(mDevices.begin(), mDevices.end(), [identifier](<span class="hljs-keyword">auto</span>&amp; devicePair) {
        <span class="hljs-type">const</span> InputDeviceIdentifier identifier2 =
                devicePair.second-&gt;getDeviceInfo().getIdentifier();
        <span class="hljs-keyword">return</span> isSubDevice(identifier, identifier2);
    });

    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;InputDevice&gt; device;
    <span class="hljs-keyword">if</span> (deviceIt != mDevices.end()) {
        device = deviceIt-&gt;second;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-type">int32_t</span> deviceId = (eventHubId &lt; END_RESERVED_ID) ? eventHubId : nextInputDeviceIdLocked();
        <span class="hljs-comment">//æ„é€ InputDevice</span>
        device = <span class="hljs-built_in">std</span>::make_shared&lt;InputDevice&gt;(&amp;mContext, deviceId, bumpGenerationLocked(),
                                               identifier);
    }
    <span class="hljs-comment">//å°†æ–°å¢è®¾å¤‡çš„äº‹ä»¶æ•°æ®è¿›è¡Œå°è£…ï¼Œå¹¶æ·»åŠ åˆ° é›†åˆ mPendingArgs ä¸­</span>
    mPendingArgs += device-&gt;addEventHubDevice(when, eventHubId, mConfig);<span class="hljs-comment">//</span>
    <span class="hljs-keyword">return</span> device;
}

frameworks/native/services/inputflinger/reader/InputDevice.cpp
[[nodiscard]] <span class="hljs-built_in">std</span>::<span class="hljs-built_in">list</span>&lt;NotifyArgs&gt; <span class="hljs-title function_">InputDevice::addEventHubDevice</span><span class="hljs-params">(
        <span class="hljs-type">nsecs_t</span> when, <span class="hljs-type">int32_t</span> eventHubId, <span class="hljs-type">const</span> InputReaderConfiguration&amp; readerConfig)</span> {
    
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">list</span>&lt;NotifyArgs&gt; out = configureInternal(when, readerConfig, {}, <span class="hljs-comment">/*forceEnable=*/</span><span class="hljs-literal">true</span>);

    DevicePair&amp; devicePair = mDevices[eventHubId];
    <span class="hljs-comment">//æ ¹æ®Deviceçš„æ”¯æŒçš„classesåˆ›å»ºå¯¹åº”çš„InputMapper</span>
    devicePair.second = createMappers(*devicePair.first, readerConfig);

    <span class="hljs-comment">// Must change generation to flag this device as changed</span>
    bumpGeneration();
    <span class="hljs-keyword">return</span> out;
}

<span class="hljs-comment">//æ ¹æ®classesåˆ›å»ºå¯¹åº”InputMapper</span>
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;InputMapper&gt;&gt; InputDevice::createMappers(
        InputDeviceContext&amp; contextPtr, <span class="hljs-type">const</span> InputReaderConfiguration&amp; readerConfig) {
    ftl::Flags&lt;InputDeviceClass&gt; classes = contextPtr.getDeviceClasses();
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;InputMapper&gt;&gt; mappers;
    ...
    <span class="hljs-comment">// Keyboard-like devices.</span>
    <span class="hljs-type">uint32_t</span> keyboardSource = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (classes.test(InputDeviceClass::KEYBOARD)) {
        keyboardSource |= AINPUT_SOURCE_KEYBOARD;
    }
    ...
    <span class="hljs-comment">// Touchscreens and touchpad devices.</span>
    <span class="hljs-keyword">if</span> (classes.test(InputDeviceClass::TOUCHPAD) &amp;&amp; classes.test(InputDeviceClass::TOUCH_MT)) {
        mappers.push_back(createInputMapper&lt;TouchpadInputMapper&gt;(contextPtr, readerConfig));
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (classes.test(InputDeviceClass::TOUCH_MT)) {
        mappers.push_back(createInputMapper&lt;MultiTouchInputMapper&gt;(contextPtr, readerConfig));
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (classes.test(InputDeviceClass::TOUCH)) {
        mappers.push_back(createInputMapper&lt;SingleTouchInputMapper&gt;(contextPtr, readerConfig));
    }
    ...
    <span class="hljs-keyword">return</span> mappers;
}


</code></pre>
<p>è¿™é‡Œä¸»è¦æ˜¯æ ¹æ®åŸå§‹æ•°æ®çš„deviceIdè·å–EventHubä¸­åˆ›å»ºçš„Deviceï¼Œå†æ ¹æ®Deviceçš„æ•°æ®åˆ›å»ºInputDeviceï¼Œå†æ ¹æ®Deviceçš„classes(enum InputDeviceClass)åˆ›å»ºå½“å‰è®¾å¤‡InputDeviceå…³è”çš„æ•°æ®å°è£…InputMapperç±»(è¿™é‡Œçš„InputDeviceClasså’ŒInputMapperæ˜¯å¤šå¯¹ä¸€çš„å…³ç³»,å¸¸è§çš„InputMapperçš„æœ‰KeyBoardInputMapper, TouchpadInputMapper,TouchInputMapperç­‰)ï¼Œå¹¶å°†InputDeviceå’ŒInputMapper æ·»åŠ åˆ°mDeviceä¸­ï¼Œä¾›åç»­æ•°æ®å°è£…æ—¶ä½¿ç”¨ã€‚æœ€åå°†æ·»åŠ è®¾å¤‡æ•°æ®å°è£…æˆNotifyArgs ä¾›åç»­ä½¿ç”¨ã€‚</p>
<ul>
<li><strong>æ³¨é‡Š15</strong> åˆ é™¤è¾“å…¥è®¾å¤‡æ—¶ï¼Œåç»­æ ¸å¿ƒé€»è¾‘å¦‚ä¸‹</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">frameworks/native/services/inputflinger/reader/InputReader.cpp
void InputReader::removeDeviceLocked(nsecs_t when, int32_t eventHubId) {
    auto <span class="hljs-attr">deviceIt</span> = mDevices.find(eventHubId)<span class="hljs-comment">;</span>
    if (<span class="hljs-attr">deviceIt</span> == mDevices.end()) {
        ALOGW("Ignoring spurious device removed event for eventHubId %d.", eventHubId)<span class="hljs-comment">;</span>
        return<span class="hljs-comment">;</span>
    }

    std::shared_ptr&lt;InputDevice&gt; <span class="hljs-attr">device</span> = std::move(deviceIt-&gt;second)<span class="hljs-comment">;</span>
    mDevices.erase(deviceIt)<span class="hljs-comment">;</span>
    // Erase device from device to EventHub ids map.
    auto <span class="hljs-attr">mapIt</span> = mDeviceToEventHubIdsMap.find(device)<span class="hljs-comment">;</span>
    if (mapIt != mDeviceToEventHubIdsMap.end()) {
        std::vector&lt;int32_t&gt;&amp; <span class="hljs-attr">eventHubIds</span> = mapIt-&gt;second<span class="hljs-comment">;</span>
        std::erase_if(eventHubIds, <span class="hljs-section">[eventHubId]</span>(int32_t eId) { return <span class="hljs-attr">eId</span> == eventHubId<span class="hljs-comment">; });</span>
        if (eventHubIds.size() == 0) {
            mDeviceToEventHubIdsMap.erase(mapIt)<span class="hljs-comment">;</span>
        }
    }
    device-&gt;removeEventHubDevice(eventHubId)<span class="hljs-comment">;</span>

    if (device-&gt;getClasses().test(InputDeviceClass::EXTERNAL_STYLUS)) {
        notifyExternalStylusPresenceChangedLocked()<span class="hljs-comment">;</span>
    }

    if (device-&gt;hasEventHubDevices()) {
        mPendingArgs += device-&gt;configure(when, mConfig, /*<span class="hljs-attr">changes</span>=*/{})<span class="hljs-comment">;</span>
    }
    mPendingArgs += device-&gt;reset(when)<span class="hljs-comment">;</span>
}

</code></pre>
<p>åˆ é™¤è®¾å¤‡æ—¶ä¸»è¦æ˜¯ä» é”®å€¼å¯¹é›†åˆmDevicesä¸­ç§»é™¤ deviceï¼Œä»mDeviceToEventHubIdsMap ä¸­ç§»é™¤mapperï¼ŒåŒæ—¶å°†åˆ é™¤è®¾å¤‡äº‹ä»¶å°è£…æˆæ•°æ®NotifyArgs ä¾›åç»­ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-8">3.2.2 InputReader å°è£…è¾“å…¥è®¾å¤‡è¾“å…¥äº‹ä»¶</h4>
<p>æ–°å¢å®Œè®¾å¤‡åï¼Œå½“è®¾å¤‡æœ‰äº‹ä»¶è¾“å…¥æ—¶ï¼Œé€»è¾‘å°±ä¼šèµ°åˆ°<code>æ³¨é‡Š13</code>è¿™é‡Œï¼Œ</p>
<ul>
<li><strong>æ³¨é‡Š13</strong> è¾“å…¥äº‹ä»¶åŸå§‹æ•°æ®å°è£…çš„æ ¸å¿ƒé€»è¾‘ä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<pre><code class="hljs language-rust" lang="rust">frameworks/native/services/inputflinger/reader/InputReader.cpp
std::list&lt;NotifyArgs&gt; InputReader::<span class="hljs-title function_ invoke__">processEventsForDeviceLocked</span>(int32_t eventHubId,
                                                                <span class="hljs-keyword">const</span> RawEvent* rawEvents,
                                                                size_t count) {
    auto deviceIt = mDevices.<span class="hljs-title function_ invoke__">find</span>(eventHubId);
    ...
    std::shared_ptr&lt;InputDevice&gt;&amp; device = deviceIt<span class="hljs-punctuation">-&gt;</span>second;
    ...
    <span class="hljs-keyword">return</span> device<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">process</span>(rawEvents, count);
}

frameworks/native/services/inputflinger/reader/InputDevice.cpp
std::list&lt;NotifyArgs&gt; InputDevice::<span class="hljs-title function_ invoke__">process</span>(<span class="hljs-keyword">const</span> RawEvent* rawEvents, size_t count) {
    <span class="hljs-comment">// Process all of the events in order for each mapper.</span>
    <span class="hljs-comment">// We cannot simply ask each mapper to process them in bulk because mappers may</span>
    <span class="hljs-comment">// have side-effects that must be interleaved.  For example, joystick movement events and</span>
    <span class="hljs-comment">// gamepad button presses are handled by different mappers but they should be dispatched</span>
    <span class="hljs-comment">// in the order received.</span>
    std::list&lt;NotifyArgs&gt; out;
    <span class="hljs-title function_ invoke__">for</span> (<span class="hljs-keyword">const</span> RawEvent* rawEvent = rawEvents; count != <span class="hljs-number">0</span>; rawEvent++) {
        <span class="hljs-title function_ invoke__">if</span> (mDropUntilNextSync) {
            <span class="hljs-title function_ invoke__">if</span> (rawEvent<span class="hljs-punctuation">-&gt;</span><span class="hljs-keyword">type</span> == EV_SYN &amp;&amp; rawEvent<span class="hljs-punctuation">-&gt;</span>code == SYN_REPORT) {
                out += <span class="hljs-title function_ invoke__">reset</span>(rawEvent<span class="hljs-punctuation">-&gt;</span>when);
                mDropUntilNextSync = <span class="hljs-literal">false</span>;
                <span class="hljs-title function_ invoke__">ALOGD_IF</span>(<span class="hljs-title function_ invoke__">debugRawEvents</span>(), <span class="hljs-string">"Recovered from input event buffer overrun."</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-title function_ invoke__">ALOGD_IF</span>(<span class="hljs-title function_ invoke__">debugRawEvents</span>(),
                         <span class="hljs-string">"Dropped input event while waiting for next input sync."</span>);
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-title function_ invoke__">if</span> (rawEvent<span class="hljs-punctuation">-&gt;</span><span class="hljs-keyword">type</span> == EV_SYN &amp;&amp; rawEvent<span class="hljs-punctuation">-&gt;</span>code == SYN_DROPPED) {
            <span class="hljs-title function_ invoke__">ALOGI</span>(<span class="hljs-string">"Detected input event buffer overrun for device %s."</span>, <span class="hljs-title function_ invoke__">getName</span>().<span class="hljs-title function_ invoke__">c_str</span>());
            mDropUntilNextSync = <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//éå†InputDeviceæ‰€æœ‰çš„mapperï¼Œä¸²è¡Œå¯¹åŸå§‹äº‹ä»¶è¿›è¡Œå°è£…å¤„ç†</span>
            <span class="hljs-title function_ invoke__">for_each_mapper_in_subdevice</span>(rawEvent<span class="hljs-punctuation">-&gt;</span>deviceId, [&amp;](InputMapper&amp; mapper) {
                out += mapper.<span class="hljs-title function_ invoke__">process</span>(*rawEvent);<span class="hljs-comment">//æ³¨é‡Š16</span>
            });
        }
        --count;
    }
    <span class="hljs-comment">//æ›´æ–°äº‹ä»¶çš„ policy flags</span>
    <span class="hljs-title function_ invoke__">postProcess</span>(out);
    <span class="hljs-keyword">return</span> out;
}

</code></pre>
<p>è¿™é‡Œé¦–å…ˆæ˜¯åœ¨ä¹‹å‰æ·»åŠ è®¾å¤‡(<code>æ³¨é‡Š14</code>)æ—¶æ›´æ–°çš„mDevicesä¸­æ‰¾åˆ°å½“å‰è¾“å…¥äº‹ä»¶å¯¹åº”çš„è®¾å¤‡InputDeviceï¼Œå†éå†å½“å‰InputDeviceçš„æ‰€æœ‰InputMapperï¼Œä¸²è¡Œçš„å¯¹æ•°æ®è¿›è¡Œprocesså¤„ç†</p>
<ul>
<li><strong>æ³¨é‡Š16</strong>æ ¹æ®ä¸åŒçš„ç¡¬ä»¶è¾“å…¥è®¾å¤‡æœ‰ä¸åŒçš„æ•°æ®æ ¼å¼ï¼Œè¿™é‡Œåˆ©ç”¨å„ç§è¾“å…¥è®¾å¤‡å¯¹åº”çš„InputMapperå¯¹åŸå§‹çš„æ•°æ®æ ¼å¼å°è£…ï¼Œå°è£…æˆä¾¿äºåç»­åˆ†å‘å¤„ç†çš„NotifyArgs</li>
</ul>
<p>åˆ°è¿™é‡ŒInputReaderå°±å®Œæˆäº†å¯¹åŸå§‹è¾“å…¥äº‹ä»¶çš„ç»„è£…ï¼Œç»Ÿä¸€ç»„è£…æˆNotifyArgsï¼Œé‡Œé¢åŒ…å«å„ç§è¾“å…¥è®¾å¤‡åç»­åˆ†å‘éœ€è¦çš„æ•°æ®ã€‚æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹InputReaderå¯¹NotifyArgsæ•°æ®çš„é¢„åˆ†å‘ã€‚</p>
<h3 data-id="heading-9">3.3 InputReaderçš„é¢„åˆ†å‘æ•°æ®</h3>
<p>å‰é¢ä¸¤ä¸ªç« èŠ‚å·²ç»åˆ†æäº†InputReader::loopOnceä¸­çš„åŸå§‹äº‹ä»¶çš„è¯»å–å’Œå°è£…ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹å¯¹äº‹ä»¶çš„é¢„åˆ†å‘ï¼Œé¢„åˆ†å‘æµç¨‹å¼€å§‹äº<code>æ³¨é‡Š3</code>,è¿™é‡Œéå†æ‰€æœ‰äº‹ä»¶ç„¶åè°ƒç”¨ <code> mNextListener.notify(args)</code> å»åˆ†å‘äº‹ä»¶ã€‚è€Œè¿™é‡Œçš„ mNextListener æ­£æ˜¯ InputReaderä¸­çš„æ„é€ å‡½æ•°ä¸­ä¼ é€’è¿‡æ¥çš„ï¼Œè€ŒInputReaderæ˜¯åœ¨InputManagerä¸­åˆå§‹åŒ–ï¼Œæˆ‘ä»¬å†å›åˆ°InputManagerçš„åˆå§‹åŒ–ä»£ç </p>
<pre><code class="hljs language-ini" lang="ini">frameworks/native/services/inputflinger/InputManager.cpp
InputManager::InputManager(const sp&lt;InputReaderPolicyInterface&gt;&amp; readerPolicy,
                           InputDispatcherPolicyInterface&amp; dispatcherPolicy,
                           PointerChoreographerPolicyInterface&amp; choreographerPolicy,
                           InputFilterPolicyInterface&amp; inputFilterPolicy) {
    <span class="hljs-attr">mInputFlingerRust</span> = createInputFlingerRust()<span class="hljs-comment">;</span>

    <span class="hljs-attr">mDispatcher</span> = createInputDispatcher(dispatcherPolicy)<span class="hljs-comment">;</span>
    //å¾€mTracingStagesåˆ—è¡¨ä¸­æ·»åŠ  InputDispatcher çš„listener
    mTracingStages.emplace_back(
            std::make_unique&lt;TracedInputListener&gt;("InputDispatcher", *mDispatcher))<span class="hljs-comment">;</span>

    if (ENABLE_INPUT_FILTER_RUST) {
        <span class="hljs-attr">mInputFilter</span> = std::make_unique&lt;InputFilter&gt;(*mTracingStages.back(), *mInputFlingerRust,
                                                     inputFilterPolicy)<span class="hljs-comment">;</span>
        mTracingStages.emplace_back(
                std::make_unique&lt;TracedInputListener&gt;("InputFilter", *mInputFilter))<span class="hljs-comment">;</span>
    }

    if (ENABLE_INPUT_DEVICE_USAGE_METRICS) {
        <span class="hljs-attr">mCollector</span> = std::make_unique&lt;InputDeviceMetricsCollector&gt;(*mTracingStages.back())<span class="hljs-comment">;</span>
        mTracingStages.emplace_back(
                std::make_unique&lt;TracedInputListener&gt;("MetricsCollector", *mCollector))<span class="hljs-comment">;</span>
    }

    <span class="hljs-attr">mProcessor</span> = std::make_unique&lt;InputProcessor&gt;(*mTracingStages.back())<span class="hljs-comment">;</span>
    mTracingStages.emplace_back(
            std::make_unique&lt;TracedInputListener&gt;("InputProcessor", *mProcessor))<span class="hljs-comment">;</span>

    <span class="hljs-attr">mChoreographer</span> =
            std::make_unique&lt;PointerChoreographer&gt;(*mTracingStages.back(), choreographerPolicy)<span class="hljs-comment">;</span>
    mTracingStages.emplace_back(
            std::make_unique&lt;TracedInputListener&gt;("PointerChoreographer", *mChoreographer))<span class="hljs-comment">;</span>

    <span class="hljs-attr">mBlocker</span> = std::make_unique&lt;UnwantedInteractionBlocker&gt;(*mTracingStages.back())<span class="hljs-comment">;</span>
    mTracingStages.emplace_back(
            std::make_unique&lt;TracedInputListener&gt;("UnwantedInteractionBlocker", *mBlocker))<span class="hljs-comment">;</span>
    
    //æ„é€ æ—¶ä¼ å…¥äº†æœ€åä¸€ä¸ª TracedInputListener çš„å®ç°ç±»UnwantedInteractionBlocker å¯¹è±¡
    <span class="hljs-attr">mReader</span> = createInputReader(readerPolicy, *mTracingStages.back())<span class="hljs-comment">;//æ³¨é‡Š17</span>
}
</code></pre>
<p>é˜…è¯»æºç ä¸éš¾å‘ç°è¿™é‡Œæ„é€ äº†å¥½å‡ ä¸ª TracedInputListener å¯¹è±¡ï¼ŒInputDispatcher åˆ™ä½œä¸ºç¬¬ä¸€ä¸ªlistenerå‹å…¥åˆ°åˆ—è¡¨mTracingStagesæœ€å‰é¢äº†ï¼Œè€Œæ¯ä¸€ä¸ªlisteneréƒ½æŒæœ‰åˆ—è¡¨mTracingStagesä¸­å‰ä¸€ä¸ªlistenerçš„å¼•ç”¨ã€‚</p>
<ul>
<li><strong>æ³¨é‡Š17</strong> æ„é€  InputReaderæ—¶ä¼ å…¥çš„åˆ™æ˜¯åˆ—è¡¨mTracingStagesçš„æœ€åä¸€ä¸ªlistener(UnwantedInteractionBlocker)ï¼Œè¿™æ ·ç¬¬ä¸€ä¸ªæ‹¿åˆ°äº‹ä»¶çš„ç±»ä¾¿æ˜¯ UnwantedInteractionBlockerç±»ã€‚</li>
</ul>
<p>ä¸‹é¢éƒ½ä»¥äº‹ä»¶ NotifyMotionArgs æ¥åˆ†æã€‚<code>mNextListener.notify(args)</code>ä¸‹ä¸€æ­¥ä¾¿ä¼šå»æ‰§è¡Œ <code>UnwantedInteractionBlocker::notifyMotion(args);</code>æµç¨‹äº†ã€‚å…¶å®è¿™é‡Œçš„ æ¯ä¸ªTracedInputListener å¤„ç†å®Œäº‹ä»¶åéƒ½ä¼šä¼ é€’åˆ°å‰ä¸€ä¸ª TracedInputListenerï¼Œ  æœ€ç»ˆéƒ½ä¼šä¼ é€’åˆ°InputDispatcherä¸­ï¼Œè§¦æ‘¸äº‹ä»¶å°±ä¼šä¼ é€’åˆ° <code>InputDispatcher::notifyMotion(args)</code>,InputDispatcherå‰é¢çš„ TracedInputListeneræœ‰çš„ä¼šå¯¹æ•°æ®è¿›è¡Œé¢„åŠ å·¥ï¼Œæœ‰çš„åˆ™è´Ÿè´£æ•°æ®ç»Ÿè®¡ï¼Œè¿™é‡Œä¸å±•å¼€åˆ†æï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œé˜…è¯»æºç ã€‚</p>
<p>åº•å±‚äº‹ä»¶è¯»å–å’Œä¸ŠæŠ¥åˆ°InputDispatcheræµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3997aa4cc8294cbd8ceb9865e022aca6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2FycnlaaGFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768135397&amp;x-signature=j6s4NFgt1bbvn%2FTzy%2FDJ21CsiLI%3D" alt="image.png" loading="lazy"/></p>
<p>æ­¤æ—¶InputReaderæ•°æ®çš„é¢„åˆ†å‘ä»»åŠ¡åŸºæœ¬å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥é‡ç‚¹åˆ†æ<code>InputDispatcher::notifyMotion(args)</code></p>
<h2 data-id="heading-10">4.InputDispatcheräº‹ä»¶åˆ†å‘</h2>
<p>InputDispatcheræ¥å—åˆ°InputReaderçš„è¾“å…¥äº‹ä»¶åï¼Œä¼šé¦–å…ˆåˆ¤æ–­æ—¶é—´æ˜¯å¦éœ€è¦æ‹¦æˆªï¼Œç„¶åå°†äº‹ä»¶å­˜å‚¨åˆ° mInboundQueue ä¸­ï¼Œå†é€šè¿‡  <code>mLooper-&gt;wake()</code> å”¤é†’é˜»å¡çš„ loopOnce è·å– mInboundQueue ä¸­çš„äº‹ä»¶è¿›è¡Œåˆ†å‘ã€‚</p>
<h3 data-id="heading-11">4.1 InputDispatcher äº‹ä»¶æ¥å—ã€æ‹¦æˆªåŠå…¥åˆ—</h3>
<pre><code class="hljs language-arduino" lang="arduino">frameworks/native/services/inputflinger/dispatcher/InputDispatcher.<span class="hljs-function">cpp
<span class="hljs-type">status_t</span> <span class="hljs-title">InputDispatcher::start</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (mThread) {
        <span class="hljs-keyword">return</span> ALREADY_EXISTS;
    }
    <span class="hljs-comment">//å¼€å§‹loopOnceçš„æ­»å¾ªç¯</span>
    mThread = std::<span class="hljs-built_in">make_unique</span>&lt;InputThread&gt;(
            <span class="hljs-string">"InputDispatcher"</span>, [<span class="hljs-keyword">this</span>]() { <span class="hljs-built_in">dispatchOnce</span>(); }, [<span class="hljs-keyword">this</span>]() { mLooper-&gt;<span class="hljs-built_in">wake</span>(); });<span class="hljs-comment">//æ³¨é‡Š18</span>
    <span class="hljs-keyword">return</span> OK;
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">InputDispatcher::dispatchOnce</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-type">nsecs_t</span> nextWakeupTime = LLONG_MAX;
    { <span class="hljs-comment">// acquire lock</span>
         ...
        <span class="hljs-comment">// Run a dispatch loop if there are no pending commands.</span>
        <span class="hljs-comment">// The dispatch loop might enqueue commands to run afterwards.</span>
        <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æœ‰æ²¡å¤„ç†å®Œçš„æŒ‡ä»¤</span>
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">haveCommandsLocked</span>()) { <span class="hljs-comment">//æ³¨é‡Š19</span>
            <span class="hljs-comment">//åˆ†å‘äº‹ä»¶åˆ°åº”ç”¨</span>
            <span class="hljs-built_in">dispatchOnceInnerLocked</span>(<span class="hljs-comment">/*byref*/</span> nextWakeupTime); <span class="hljs-comment">//æ³¨é‡Š 20</span>
        }
        ...
        <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦anräº†</span>
        <span class="hljs-type">const</span> <span class="hljs-type">nsecs_t</span> nextAnrCheck = <span class="hljs-built_in">processAnrsLocked</span>(); <span class="hljs-comment">// æ³¨é‡Š21</span>
        ...
    } <span class="hljs-comment">// release lock</span>
    ...
    <span class="hljs-type">int</span> timeoutMillis = <span class="hljs-built_in">toMillisecondTimeoutDelay</span>(currentTime, nextWakeupTime);
    <span class="hljs-comment">//ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°ç›‘å¬æœ‰æ•°æ®æ›´æ–°æˆ–è€…è°ƒç”¨mLooper-&gt;wake</span>
    mLooper-&gt;<span class="hljs-built_in">pollOnce</span>(timeoutMillis);<span class="hljs-comment">//æ³¨é‡Š22</span>
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">InputDispatcher::notifyMotion</span><span class="hljs-params">(<span class="hljs-type">const</span> NotifyMotionArgs&amp; args)</span> </span>{
    ...

    <span class="hljs-type">uint32_t</span> policyFlags = args.policyFlags;
    policyFlags |= POLICY_FLAG_TRUSTED;
    <span class="hljs-comment">// è®¾ç½® policyFlags æ ‡è®°,åŒæ—¶åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªäº‹ä»¶</span>
    mPolicy.<span class="hljs-built_in">interceptMotionBeforeQueueing</span>(args.displayId, args.source, args.action, args.eventTime,
                                          policyFlags);<span class="hljs-comment">//æ³¨é‡Š23</span>
    

    <span class="hljs-type">bool</span> needWake = <span class="hljs-literal">false</span>;
    { <span class="hljs-comment">// acquire lock</span>
        mLock.<span class="hljs-built_in">lock</span>();
       

        <span class="hljs-comment">// Just enqueue a new motion event.</span>
        <span class="hljs-comment">//æ•°æ®åˆå§‹åŒ–</span>
        std::unique_ptr&lt;MotionEntry&gt; newEntry =
                std::<span class="hljs-built_in">make_unique</span>&lt;MotionEntry&gt;(args.id, <span class="hljs-comment">/*injectionState=*/</span><span class="hljs-literal">nullptr</span>, args.eventTime,
                                              args.deviceId, args.source, args.displayId,
                                              policyFlags, args.action, args.actionButton,
                                              args.flags, args.metaState, args.buttonState,
                                              args.classification, args.edgeFlags, args.xPrecision,
                                              args.yPrecision, args.xCursorPosition,
                                              args.yCursorPosition, args.downTime,
                                              args.pointerProperties, args.pointerCoords);
       
        <span class="hljs-comment">//æ·»åŠ æ•°æ®åˆ° mInboundQueue ä¸­</span>
        needWake = <span class="hljs-built_in">enqueueInboundEventLocked</span>(std::<span class="hljs-built_in">move</span>(newEntry)); <span class="hljs-comment">//æ³¨é‡Š24</span>
        mLock.<span class="hljs-built_in">unlock</span>();
    } <span class="hljs-comment">// release lock</span>

    <span class="hljs-keyword">if</span> (needWake) {
        <span class="hljs-comment">//å”¤é†’mLooper::pollOnce</span>
        mLooper-&gt;<span class="hljs-built_in">wake</span>();<span class="hljs-comment">//æ³¨é‡Š25</span>
    }
}

<span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">InputDispatcher::enqueueInboundEventLocked</span><span class="hljs-params">(std::unique_ptr&lt;EventEntry&gt; newEntry)</span> </span>{
    <span class="hljs-type">bool</span> needWake = mInboundQueue.<span class="hljs-built_in">empty</span>();
    mInboundQueue.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">move</span>(newEntry));<span class="hljs-comment">//æ³¨é‡Š26</span>
    ...
    <span class="hljs-keyword">return</span> needWake;
}

</code></pre>
<p>åœ¨IMSåˆå§‹åŒ–çš„æ—¶å€™æ˜¯å…ˆè°ƒç”¨<code>InputDispatcher::start()</code>,å†è°ƒç”¨<code>InputReader::start(),InputReader::start()</code>æµç¨‹å‰é¢å·²ç»åˆ†æäº†ï¼Œè¿™é‡Œä» <code>InputDispatcher::start()</code> å¼€å§‹åˆ†æ</p>
<ul>
<li><strong>æ³¨é‡Š18</strong> è¿™é‡Œä¹Ÿæ˜¯æ–°èµ·äº†ä¸€ä¸ªInputThreadï¼Œå¹¶ä¸”å¼€å§‹äº†dispatchOnceçš„æ­»å¾ªç¯ï¼ŒdispatchOnceæ¯æ¬¡æ‰§è¡Œå®Œéƒ½ä¼šé˜»å¡åœ¨<code>æ³¨é‡Š22</code>ç­‰å¾…è¢«å”¤é†’ä»è€Œè¿›è¡Œä¸‹ä¸€ä¸ª dispatchOnce</li>
</ul>
<p>æ ¹æ®ç¬¬3ç« èŠ‚çš„åˆ†æï¼Œå½“InputReaderè¯»å–åˆ°äº‹ä»¶åï¼Œå°±ä¼šè°ƒç”¨åˆ°InputDispatcher::notifyXXX æ¥åˆ†å‘äº‹ä»¶ï¼Œä¸‹é¢è¿˜æ˜¯ä»¥ NotifyMotionArgs ä¸ºä¾‹ï¼Œæ­¤æ—¶ä¼šè°ƒç”¨ <code>InputDispatcher::notifyMotion</code>ï¼Œè¿™ä¸ªæ–¹æ³• ä¸»è¦æ˜¯åˆå§‹åŒ–äº‹ä»¶ï¼Œè®¾ç½®äº‹ä»¶æ ‡è®°ï¼Œå°†äº‹ä»¶æ·»åŠ åˆ° <code>InputDispatcher::mInboundQueue</code>ä¸­ï¼ŒåŒæ—¶å”¤é†’<code>mLooper::loopOnce</code></p>
<ul>
<li><strong>æ³¨é‡Š23</strong> ç»™äº‹ä»¶çš„ policyFlags è®¾ç½®æ ‡è®°å’Œæ‹¦æˆªäº‹ä»¶ï¼Œè¿™é‡Œé‡ç‚¹å…³æ³¨çš„æ ‡è®°æ—¶ POLICY_FLAG_PASS_TO_USER å’Œ ~POLICY_FLAG_PASS_TO_USER,è¿™ä¸¤ä¸ªè¡¨ç¤ºæ˜¯å¦éœ€è¦ä¼ é€’ç»™ç”¨æˆ·ï¼Œè¿™ä¸ªåç»­ä¼šç”¨åˆ°ï¼Œäº‹ä»¶æ‹¦æˆªä¸»è¦æ˜¯é€šè¿‡IMSçš„ interceptXXXBeforeQueueingåˆ°<code>PhoneWindowManager.interceptXXXBeforeQueueing</code>,æ¯”å¦‚æˆ‘ä»¬çš„å¼€æœºé”®/å…³æœºé”®/éŸ³é‡é”®ç­‰æŒ‰é”®äº‹ä»¶å¤§éƒ¨åˆ†æ˜¯ä¼šè¢«ç³»ç»Ÿæ‹¦æˆªæ‰çš„ï¼Œè¿˜æœ‰åœ¨æŸäº›æƒ…å†µä¸‹æœ‰äº›äº‹ä»¶ä¹Ÿä¼šè¢«ç›´æ¥æ‹¦æˆªæ‰ï¼Œè¿™ä¸ªå¤§å®¶å¯ä»¥è‡ªè¡Œé˜…è¯» <code>PhoneWindowManager.interceptXXXBeforeQueueing</code>æ–¹æ³•ã€‚</li>
<li><strong>æ³¨é‡Š24 æ³¨é‡Š26</strong> å°†äº‹ä»¶MotionEntryæ·»åŠ æ·»åŠ åˆ° <code>InputDispatcher::mInboundQueue</code>ä¸­</li>
<li><strong>æ³¨é‡Š25</strong> æ ¹æ®Looperçš„åŸç†ï¼Œæ­¤å¤„ä¼šå”¤é†’ <code>æ³¨é‡Š22</code>çš„é˜»å¡ï¼Œä½¿ dispatchOnce ç»§ç»­æ‰§è¡Œä¸‹å»</li>
</ul>
<h3 data-id="heading-12">4.2 InputDispatcher äº‹ä»¶å‡ºåˆ—åˆ†å‘</h3>
<p>æ­¤æ—¶æˆ‘ä»¬å†å›åˆ° dispatchOnce æ‰§è¡Œä¸‹ä¸€ä¸ªåˆ†å‘ï¼Œè¿™é‡Œä¸»è¦æ˜¯</p>
<ul>
<li><strong>æ³¨é‡Š19</strong> æ£€æŸ¥ mCommandQueue é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºæ—¶ï¼Œæ‰ä¼šå‘ä¸‹åˆ†å‘æ•°æ®ï¼Œä¸ä¸ºç©ºæ—¶ï¼Œä¼šè·³è¿‡è¿™æ¬¡dispatchOnceçš„åˆ†å‘</li>
<li><strong>æ³¨é‡Š20</strong> åˆ†å‘æ•°æ®åˆ°åº”ç”¨</li>
</ul>

<pre><code class="hljs language-c" lang="c">frameworks/native/services/inputflinger/dispatcher/InputDispatcher.cpp
<span class="hljs-type">void</span> <span class="hljs-title function_">InputDispatcher::dispatchOnceInnerLocked</span><span class="hljs-params">(<span class="hljs-type">nsecs_t</span>&amp; nextWakeupTime)</span> {
    <span class="hljs-type">nsecs_t</span> currentTime = now();


    <span class="hljs-comment">// Ready to start a new event.</span>
    <span class="hljs-comment">// If we don't already have a pending event, go grab one.</span>
    <span class="hljs-keyword">if</span> (!mPendingEvent) {
        <span class="hljs-keyword">if</span> (mInboundQueue.empty()) {
          
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// Inbound queue has at least one entry.</span>
            <span class="hljs-comment">// ä» mInboundQueue å‰é¢ç§»é™¤</span>
            mPendingEvent = mInboundQueue.front();
            mInboundQueue.pop_front();<span class="hljs-comment">//æ³¨é‡Š27</span>
            traceInboundQueueLengthLocked();
        }

        <span class="hljs-comment">// Poke user activity for this event.</span>
        <span class="hljs-keyword">if</span> (mPendingEvent-&gt;policyFlags &amp; POLICY_FLAG_PASS_TO_USER) {
            <span class="hljs-comment">//é€šçŸ¥PowerManagerServiceä¸è¦ç†„å±</span>
            pokeUserActivityLocked(*mPendingEvent);<span class="hljs-comment">//æ³¨é‡Š28</span>
        }
    }

    <span class="hljs-comment">// Now we have an event to dispatch.</span>
    <span class="hljs-comment">// All events are eventually dequeued and processed this way, even if we intend to drop them.</span>
    ALOG_ASSERT(mPendingEvent != nullptr);
    <span class="hljs-type">bool</span> done = <span class="hljs-literal">false</span>;
    <span class="hljs-comment">//å®šä¹‰äº†ä¸¢å¼ƒåŸå› ï¼Œå¦‚æœæ²¡æœ‰ä¼ é€’ç»™åº”ç”¨ï¼Œå°±æ˜¯ä¸¢å¼ƒäº†ï¼Œç³»ç»Ÿå¯¹ä¸åŒäº‹ä»¶æœ‰ä¸åŒçš„ä¸¢å¼ƒè§„åˆ™ï¼Œå†³å®šæ˜¯å¦ä¼ é€’ç»™åº”ç”¨</span>
    DropReason dropReason = DropReason::NOT_DROPPED;
    

    <span class="hljs-keyword">switch</span> (mPendingEvent-&gt;type) {
       ...
       <span class="hljs-comment">//è§¦æ‘¸äº‹ä»¶</span>
        <span class="hljs-keyword">case</span> EventEntry::Type::MOTION: {
            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;<span class="hljs-type">const</span> MotionEntry&gt; motionEntry =
                    <span class="hljs-built_in">std</span>::static_pointer_cast&lt;<span class="hljs-type">const</span> MotionEntry&gt;(mPendingEvent);
            ...
            done = dispatchMotionLocked(currentTime, motionEntry, &amp;dropReason, nextWakeupTime);<span class="hljs-comment">//æ³¨é‡Š29</span>
            <span class="hljs-keyword">break</span>;
        }
       ...
    }

    <span class="hljs-keyword">if</span> (done) {
        <span class="hljs-comment">//åˆ†å‘æˆåŠŸ</span>
        ...
    }
}
</code></pre>
<ul>
<li><strong>æ³¨é‡Š27</strong> ä» mInboundQueue(InputReaderä¼ é€’è¿‡æ¥æ—¶ä¼šå­˜å‚¨åˆ°è¿™é‡Œ) é˜Ÿåˆ—ä¸­ç§»é™¤æ•°æ®</li>
<li><strong>æ³¨é‡Š28</strong> é€šè¿‡IMSé€šçŸ¥PowerManagerServiceå¤„ç†ç›¸å…³é€»è¾‘(ä¸è¦ç†„å±ç­‰)</li>
<li><strong>æ³¨é‡Š29</strong> åˆ†å‘è§¦æ‘¸äº‹ä»¶ï¼Œé¦–å…ˆæ‰¾åˆ°äº‹ä»¶å…³è”çš„çª—å£ï¼Œç„¶åå†è¿›è¡Œäº‹ä»¶åˆ†å‘</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">frameworks/native/services/inputflinger/dispatcher/InputDispatcher.cpp
bool InputDispatcher::dispatchMotionLocked(nsecs_t currentTime,
                                           std::shared_ptr&lt;const MotionEntry&gt; entry,
                                           DropReason* dropReason, nsecs_t&amp; nextWakeupTime) {
    ...
    const bool <span class="hljs-attr">isPointerEvent</span> = isFromSource(entry-&gt;source, AINPUT_SOURCE_CLASS_POINTER)<span class="hljs-comment">;</span>
    ...
    // Identify targets.
    std::vector&lt;InputTarget&gt; inputTargets<span class="hljs-comment">;</span>
    ...
    if (isPointerEvent) {
        // Pointer event.  (eg. touchscreen)
        //è·å–å…³è”çª—å£
        Result&lt;std::vector&lt;InputTarget&gt;, InputEventInjectionResult&gt; <span class="hljs-attr">result</span> =
                findTouchedWindowTargetsLocked(currentTime, *entry)<span class="hljs-comment">;//æ³¨é‡Š30</span>
        ...
        if (result.ok()) {
            <span class="hljs-attr">inputTargets</span> = std::move(*result)<span class="hljs-comment">;</span>
        }
        ...
    } else {
        // Non touch event.  (eg. trackball)
       ...
    }
    ...
    // Dispatch the motion.
    //åˆ†å‘äº‹ä»¶
    dispatchEventLocked(currentTime, entry, inputTargets)<span class="hljs-comment">;</span>
    return true<span class="hljs-comment">;</span>
}

void InputDispatcher::dispatchEventLocked(nsecs_t currentTime,
                                          std::shared_ptr&lt;const EventEntry&gt; eventEntry,
                                          const std::vector&lt;InputTarget&gt;&amp; inputTargets) {
   
    //debugä¿¡æ¯å’Œæ•°æ®ç»Ÿè®¡
    processInteractionsLocked(*eventEntry, inputTargets)<span class="hljs-comment">;</span>
    //å†æ¬¡åœæ­¢PowerManagerServiceä¸è¦ç†„å±
    pokeUserActivityLocked(*eventEntry)<span class="hljs-comment">;</span>

    for (const InputTarget&amp; inputTarget : inputTargets) {
        std::shared_ptr&lt;Connection&gt; <span class="hljs-attr">connection</span> = inputTarget.connection<span class="hljs-comment">;</span>
        //å¤„ç†äº‹ä»¶
        prepareDispatchCycleLocked(currentTime, connection, eventEntry, inputTarget)<span class="hljs-comment">;</span>
    }
}

void InputDispatcher::prepareDispatchCycleLocked(nsecs_t currentTime,
                                                 const std::shared_ptr&lt;Connection&gt;&amp; connection,
                                                 std::shared_ptr&lt;const EventEntry&gt; eventEntry,
                                                 const InputTarget&amp; inputTarget) {
    ...
    enqueueDispatchEntryAndStartDispatchCycleLocked(currentTime, connection, eventEntry,
                                                    inputTarget)<span class="hljs-comment">;</span>
}

void InputDispatcher::enqueueDispatchEntryAndStartDispatchCycleLocked(
        nsecs_t currentTime, const std::shared_ptr&lt;Connection&gt;&amp; connection,
        std::shared_ptr&lt;const EventEntry&gt; eventEntry, const InputTarget&amp; inputTarget) {

    //connectçš„å¾…å¤„ç†äº‹ä»¶æ˜¯å¦éƒ½å¤„ç†å®Œäº†
    const bool <span class="hljs-attr">wasEmpty</span> = connection-&gt;outboundQueue.empty()<span class="hljs-comment">;</span>
    //å¾€ connection-&gt;outboundQueue é˜Ÿåˆ—å¡äº‹ä»¶
    enqueueDispatchEntryLocked(connection, eventEntry, inputTarget)<span class="hljs-comment">;//æ³¨é‡Š31</span>

    // If the outbound queue was previously empty, start the dispatch cycle going.
    if (wasEmpty &amp;&amp; !connection-&gt;outboundQueue.empty()) {
        //ä¹‹å‰çš„äº‹ä»¶éƒ½å¤„ç†å®Œäº†ï¼Œä¸”è¿™æ¬¡æœ‰æ–°äº‹ä»¶ï¼Œå¼€å§‹å¤„ç†äº‹ä»¶
        startDispatchCycleLocked(currentTime, connection)<span class="hljs-comment">; //æ³¨é‡Š32</span>
    }
}

void InputDispatcher::enqueueDispatchEntryLocked(const std::shared_ptr&lt;Connection&gt;&amp; connection,
                                                 std::shared_ptr&lt;const EventEntry&gt; eventEntry,
                                                 const InputTarget&amp; inputTarget) {
    ...
    connection-&gt;outboundQueue.emplace_back(std::move(dispatchEntry))<span class="hljs-comment">;</span>
}

void InputDispatcher::startDispatchCycleLocked(nsecs_t currentTime,
                                               const std::shared_ptr&lt;Connection&gt;&amp; connection) {

    ...
    //éå†æ‰€æœ‰å¾…å¤„ç†äº‹ä»¶
    while (connection-&gt;<span class="hljs-attr">status</span> == Connection::Status::NORMAL &amp;&amp; !connection-&gt;outboundQueue.empty()) {
        std::unique_ptr&lt;DispatchEntry&gt;&amp; <span class="hljs-attr">dispatchEntry</span> = connection-&gt;outboundQueue.front()<span class="hljs-comment">;</span>
        dispatchEntry-&gt;<span class="hljs-attr">deliveryTime</span> = currentTime<span class="hljs-comment">;</span>
        const std::chrono::nanoseconds <span class="hljs-attr">timeout</span> = getDispatchingTimeoutLocked(connection)<span class="hljs-comment">;</span>
        dispatchEntry-&gt;<span class="hljs-attr">timeoutTime</span> = currentTime + timeout.count()<span class="hljs-comment">;</span>

        // Publish the event.
        status_t status<span class="hljs-comment">;</span>
        const EventEntry&amp; <span class="hljs-attr">eventEntry</span> = *(dispatchEntry-&gt;eventEntry)<span class="hljs-comment">;</span>
        switch (eventEntry.type) {
            ...
            //è§¦æ‘¸äº‹ä»¶
            case EventEntry::Type::MOTION: {
                if (DEBUG_OUTBOUND_EVENT_DETAILS) {
                    LOG(INFO) &lt;&lt; "Publishing " &lt;&lt; *dispatchEntry &lt;&lt; " to "
                              &lt;&lt; connection-&gt;getInputChannelName()<span class="hljs-comment">;</span>
                }
                const MotionEntry&amp; <span class="hljs-attr">motionEntry</span> = static_cast&lt;const MotionEntry&amp;&gt;(eventEntry)<span class="hljs-comment">;</span>
                //å‘é€äº‹ä»¶
                <span class="hljs-attr">status</span> = publishMotionEvent(*connection, *dispatchEntry)<span class="hljs-comment">;//æ³¨é‡Š33</span>
                
                break<span class="hljs-comment">;</span>
            }
            ...
        }

        // Check the result.
        if (status) {
            if (<span class="hljs-attr">status</span> == WOULD_BLOCK) {
            //äº‹ä»¶å‘é€å¼‚å¸¸å¤„ç†
            return<span class="hljs-comment">;</span>
        }

        ...
        //å°†äº‹ä»¶ä» outboundQueue ä¸­ç§»é™¤æ·»åŠ åˆ° waitQueue
        connection-&gt;waitQueue.emplace_back(std::move(dispatchEntry))<span class="hljs-comment">;</span>
        connection-&gt;outboundQueue.erase(connection-&gt;outboundQueue.begin())<span class="hljs-comment">;</span>
        //è·å–äº‹ä»¶çš„å¤„ç†è¶…æ—¶ANRæ—¶é—´ï¼Œæ·»åŠ è¶…æ—¶çš„ANRæ—¶é—´åˆ° mAnrTrackerï¼Œæ˜¯å¾€åæ·»åŠ 
       const nsecs_t <span class="hljs-attr">timeoutTime</span> = dispatchEntry-&gt;timeoutTime<span class="hljs-comment">;</span>
         if (connection-&gt;responsive) {
            mAnrTracker.insert(timeoutTime, connection-&gt;getToken())<span class="hljs-comment">;</span>
        }
        ...
    }
}

status_t InputDispatcher::publishMotionEvent(Connection&amp; connection,
                                             DispatchEntry&amp; dispatchEntry) const {

    // Publish the motion event.
    //å‘é€äº‹ä»¶
    return connection.inputPublisher
            .publishMotionEvent(dispatchEntry.seq, motionEntry.id, motionEntry.deviceId,
                                motionEntry.source, motionEntry.displayId, std::move(hmac),
                                motionEntry.action, motionEntry.actionButton,
                                dispatchEntry.resolvedFlags, motionEntry.edgeFlags,
                                motionEntry.metaState, motionEntry.buttonState,
                                motionEntry.classification, dispatchEntry.transform,
                                motionEntry.xPrecision, motionEntry.yPrecision,
                                motionEntry.xCursorPosition, motionEntry.yCursorPosition,
                                dispatchEntry.rawTransform, motionEntry.downTime,
                                motionEntry.eventTime, motionEntry.getPointerCount(),
                                motionEntry.pointerProperties.data(), usingCoords)<span class="hljs-comment">;</span>
}

frameworks/native/libs/input/InputTransport.cpp
status_t InputPublisher::publishMotionEvent(
        uint32_t seq, int32_t eventId, int32_t deviceId, int32_t source,
        ui::LogicalDisplayId displayId, std::array&lt;uint8_t, 32&gt; hmac, int32_t action,
        int32_t actionButton, int32_t flags, int32_t edgeFlags, int32_t metaState,
        int32_t buttonState, MotionClassification classification, const ui::Transform&amp; transform,
        float xPrecision, float yPrecision, float xCursorPosition, float yCursorPosition,
        const ui::Transform&amp; rawTransform, nsecs_t downTime, nsecs_t eventTime,
        uint32_t pointerCount, const PointerProperties* pointerProperties,
        const PointerCoords* pointerCoords) {
    ...
    
    // æ„é€  InputMessage  å¹¶èµ‹å€¼
    InputMessage msg<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.header.type</span> = InputMessage::Type::MOTION<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.header.seq</span> = seq<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.eventId</span> = eventId<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.deviceId</span> = deviceId<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.source</span> = source<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.displayId</span> = displayId.val()<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.hmac</span> = std::move(hmac)<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.action</span> = action<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.actionButton</span> = actionButton<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.flags</span> = flags<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.edgeFlags</span> = edgeFlags<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.metaState</span> = metaState<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.buttonState</span> = buttonState<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.classification</span> = classification<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.dsdx</span> = transform.dsdx()<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.dtdx</span> = transform.dtdx()<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.dtdy</span> = transform.dtdy()<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.dsdy</span> = transform.dsdy()<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.tx</span> = transform.tx()<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.ty</span> = transform.ty()<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.xPrecision</span> = xPrecision<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.yPrecision</span> = yPrecision<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.xCursorPosition</span> = xCursorPosition<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.yCursorPosition</span> = yCursorPosition<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.dsdxRaw</span> = rawTransform.dsdx()<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.dtdxRaw</span> = rawTransform.dtdx()<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.dtdyRaw</span> = rawTransform.dtdy()<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.dsdyRaw</span> = rawTransform.dsdy()<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.txRaw</span> = rawTransform.tx()<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.tyRaw</span> = rawTransform.ty()<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.downTime</span> = downTime<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.eventTime</span> = eventTime<span class="hljs-comment">;</span>
    <span class="hljs-attr">msg.body.motion.pointerCount</span> = pointerCount<span class="hljs-comment">;</span>
    for (uint32_t <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; pointerCount; i++) {</span>
        msg.body.motion.pointers<span class="hljs-section">[i]</span>.<span class="hljs-attr">properties</span> = pointerProperties[i]<span class="hljs-comment">;</span>
        msg.body.motion.pointers<span class="hljs-section">[i]</span>.<span class="hljs-attr">coords</span> = pointerCoords[i]<span class="hljs-comment">;</span>
    }
    //é€šè¿‡å‘é€æ•°æ®
    return mChannel-&gt;sendMessage(&amp;msg)<span class="hljs-comment">;</span>
}

</code></pre>
<ul>
<li><strong>æ³¨é‡Š30</strong> å¯»æ‰¾äº‹ä»¶å…³è”ä¸”æœ‰ç„¦ç‚¹çš„çª—å£ï¼Œåœ¨Viewåˆå§‹åŒ–çª—å£åˆ›å»ºæ—¶ä¼šå…³è”tokenï¼Œçª—å£ä¸Šæœ‰InputChannelä¿¡æ¯ï¼Œ InputChannelé‡Œé¢æ˜¯æœ‰ä¸€ä¸ªsocketå¯¹çš„ï¼Œç”¨æ¥cleint-serveré€šä¿¡çš„ã€‚è‹¥æ˜¯æ²¡æ‰¾åˆ°æœ‰ç„¦ç‚¹çš„çª—å£ï¼Œè¿™é‡Œä¼šè®°å½•æ— ç„¦ç‚¹anræ—¶é—´ <code>mNoFocusedWindowTimeoutTime</code>ï¼Œè¿™æ ‡è®°åé¢å†ç¬¬7ç« èŠ‚åˆ†æANRçš„æµç¨‹æ—¶ä¼šç”¨åˆ°ã€‚</li>
<li><strong>æ³¨é‡Š31</strong> å¾€ <code>connection-&gt;outboundQueue</code> é˜Ÿåˆ—æ·»åŠ å¾…å¤„ç†äº‹ä»¶</li>
<li><strong>æ³¨é‡Š32</strong> å¦‚æœä¹‹å‰çš„<code>connection-&gt;outboundQueue</code>ä¸­çš„äº‹ä»¶éƒ½å¤„ç†å®Œäº†ï¼Œä¸”è¿™æ¬¡æœ‰æ–°äº‹ä»¶ï¼Œå¼€å§‹å¤„ç†äº‹ä»¶</li>
<li><strong>æ³¨é‡Š33</strong> è°ƒç”¨socketå‘é€äº‹ä»¶</li>
</ul>
<p>æ ¹æ®ä¸Šé¢çš„ InputDispatcher çš„äº‹ä»¶åˆ†å‘æœ€ç»ˆè°ƒç”¨çš„æ˜¯socketå‘é€æ¶ˆæ¯ï¼Œä½†æ˜¯æ¶ˆæ¯æ¥æ”¶æ–¹è¿˜ä¸çŸ¥é“æ˜¯å“ªé‡Œã€‚æˆ‘ä»¬çŸ¥é“è§¦æ‘¸äº‹ä»¶æœ€ç»ˆæ˜¯è¦åˆ†å‘åˆ°åº”ç”¨Appçš„çª—å£(View/Activity)å»å¤„ç†ï¼Œè¿™é‡Œ InputDispatcher çš„äº‹ä»¶åˆ†å‘æˆ‘ä»¬å…ˆæš‚ç¼“ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸‹Appçª—å£æ˜¯æ€ä¹ˆè·å–åˆ°äº‹ä»¶çš„ï¼Œåªè¦Appçª—å£é‚£è¾¹èƒ½æ‰¾äº‹ä»¶æ¥å—çš„cleintSocketï¼Œä¸”å’Œè¿™é‡Œçš„äº‹ä»¶å‘é€çš„serverSocketæ˜¯æˆå¯¹çš„è¯ï¼Œé‚£ä¸Šé¢ InputDispatcheré€šè¿‡serverSocketå‘é€çš„äº‹ä»¶åº”ç”¨çª—å£é‚£è¾¹å°±èƒ½æ”¶åˆ°ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[çº¿ç¨‹æ± è¯¦è§£]]></title>    <link>https://juejin.cn/post/7591075684066410511</link>    <guid>https://juejin.cn/post/7591075684066410511</guid>    <pubDate>2026-01-04T13:09:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591075684066410511" data-draft-id="7590681158717489192" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="çº¿ç¨‹æ± è¯¦è§£"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2026-01-04T13:09:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="XRay"/> <meta itemprop="url" content="https://juejin.cn/user/3966693685869288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            çº¿ç¨‹æ± è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3966693685869288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    XRay
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T13:09:45.000Z" title="Sun Jan 04 2026 13:09:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">å‰è¨€</h3>
<p>æˆ‘ä»¬ç»å¸¸ä¼šé€šè¿‡å¯åŠ¨çº¿ç¨‹åœ¨å­çº¿ç¨‹å¤„ç†è€—æ—¶ä»»åŠ¡ï¼Œä½†æ˜¯æ¯ä¸ªçº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯éƒ½éœ€è¦ä¸€å®šçš„å¼€é”€ã€‚å¹¶ä¸”æ¯æ¬¡é€šè¿‡new Thread().start()æ¥å¯åŠ¨çº¿ç¨‹ï¼Œå„ä¸ªçº¿ç¨‹å„è‡ªä¸ºæ”¿ï¼Œå¾ˆéš¾å¯¹å…¶è¿›è¡Œæ§åˆ¶ã€‚è¿™æ—¶å€™å°±éœ€è¦çº¿ç¨‹æ± æ¥å¯¹çº¿ç¨‹è¿›è¡Œç®¡ç†ã€‚</p>
<h3 data-id="heading-1">çº¿ç¨‹æ± </h3>
<p>ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿç®€å•ç†è§£ï¼Œå°±æ˜¯ä¸€ä¸ªç®¡ç†çº¿ç¨‹çš„æ± å­ã€‚çº¿ç¨‹æ± å°±æ˜¯é‡‡ç”¨æ± åŒ–æ€æƒ³ï¼ˆç±»ä¼¼è¿æ¥æ± ã€å¸¸é‡æ± ã€å¯¹è±¡æ± ç­‰ï¼‰ç®¡ç†çº¿ç¨‹çš„å·¥å…·ã€‚</p>
<p>ä½¿ç”¨çº¿ç¨‹æ± çš„å¥½å¤„ï¼š</p>
<ul>
<li><strong>é‡ç”¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹</strong>ã€‚çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€æ˜¯å·¨å¤§çš„ï¼Œè€Œé€šè¿‡é‡ç”¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¤§å¤§å‡å°‘äº†è¿™äº›ä¸å¿…è¦çš„å¼€é”€ã€‚</li>
<li><strong>èƒ½æœ‰æ•ˆæ§åˆ¶çº¿ç¨‹æ± çš„æœ€å¤§å¹¶å‘æ•°</strong>ã€‚é¿å…å¤§é‡çº¿ç¨‹ä¹‹é—´å› æŠ¢å ç³»ç»Ÿèµ„æºè€Œå¯¼è‡´çš„é˜»å¡ç°è±¡ã€‚</li>
<li><strong>èƒ½å¤Ÿå¯¹çº¿ç¨‹è¿›è¡Œç®€å•çš„ç®¡ç†</strong>ã€‚çº¿ç¨‹æ± å¯ä»¥æä¾›å®šæ—¶æ‰§è¡Œä»¥åŠæŒ‡å®šé—´éš”å¾ªç¯æ‰§è¡Œç­‰åŠŸèƒ½ã€‚</li>
</ul>
<h3 data-id="heading-2">ThreadPoolExecutor</h3>
<p>å¯ä»¥é€šè¿‡ThreadPoolExecutoræ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼ŒThreadPoolExecutorä¸€å…±æœ‰4ä¸ªæ„é€ æ–¹æ³•ï¼Œå¦å¤–3ä¸ªæ„é€ æ–¹æ³•éƒ½é—´æ¥è°ƒç”¨äº†å‚æ•°æœ€å¤šçš„æ„é€ æ–¹æ³•ï¼Œå‚æ•°æœ€å¤šçš„æ„é€ æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolExecutor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractExecutorService</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize,
        <span class="hljs-type">int</span> maximumPoolSize,
        <span class="hljs-type">long</span> keepAliveTime,
        TimeUnit unit,
        BlockingQueue&lt;Runnable&gt; workQueue,
        ThreadFactory threadFactory,
        RejectedExecutionHandler handler)</span> {
        ...
    }

}
</code></pre>
<p>å…¶æ„é€ æ–¹æ³•ä¸­å‚æ•°çš„ä½œç”¨å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>corePoolSize</strong>ï¼šçº¿ç¨‹æ± çš„æ ¸å¿ƒçº¿ç¨‹æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ¸å¿ƒçº¿ç¨‹ä¼šåœ¨çº¿ç¨‹æ± ä¸­ä¸€ç›´å­˜æ´»ï¼Œå³ä½¿å®ƒä»¬å¤„äºé—²ç½®çŠ¶æ€ã€‚é™¤éä½ å°†å‚æ•°allowCoreThreadTimeOutè®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆé—²ç½®çš„æ ¸å¿ƒçº¿ç¨‹åœ¨ç­‰å¾…æ–°ä»»åŠ¡åˆ°æ¥æ—¶ä¼šæœ‰è¶…æ—¶ç­–ç•¥ï¼Œè¿™ä¸ªæ—¶é—´é—´éš”ç”±keepAliveTimeæŒ‡å®šï¼Œå½“ç­‰å¾…æ—¶é—´è¶…è¿‡keepAliveTimeæ‰€æŒ‡å®šçš„æ—¶é•¿åï¼Œæ ¸å¿ƒçº¿ç¨‹å°±ä¼šè¢«ç»ˆæ­¢ã€‚</li>
<li><strong>maximumPoolSize</strong>ï¼šçº¿ç¨‹æ± å…è®¸åˆ›å»ºçš„æœ€å¤§çº¿ç¨‹æ•°ã€‚å½“æ´»åŠ¨çº¿ç¨‹æ•°è¾¾åˆ°è¿™ä¸ªæ•°å€¼åï¼Œåç»­çš„æ–°ä»»åŠ¡å°†ä¼šè¢«é˜»å¡ã€‚</li>
<li><strong>keepAliveTime</strong>ï¼šéæ ¸å¿ƒçº¿ç¨‹é—²ç½®æ—¶çš„è¶…æ—¶æ—¶é•¿ã€‚è¶…è¿‡è¿™ä¸ªæ—¶é•¿ï¼Œéæ ¸å¿ƒçº¿ç¨‹å°±ä¼šè¢«å›æ”¶ã€‚å½“allowCoreThreadTimeOutè®¾ç½®ä¸ºtrueæ—¶ï¼ŒkeepAliveTimeåŒæ ·ä¼šä½œç”¨äºæ ¸å¿ƒçº¿ç¨‹ã€‚</li>
<li><strong>unit</strong>ï¼škeepAliveTimeçš„å•ä½ã€‚è¿™æ˜¯ä¸€ä¸ªæšä¸¾ï¼Œå¸¸ç”¨çš„æœ‰ TimeUnit.MILLISECONDS(æ¯«ç§’)ã€TimeUnit.SECONDS(ç§’)ä»¥åŠTimeUnit.MINUTES (åˆ†é’Ÿ)ç­‰ã€‚</li>
<li><strong>workQueue</strong>ï¼šçº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡é˜Ÿåˆ—ã€‚é€šè¿‡çº¿ç¨‹æ± çš„execute()æ–¹æ³•æäº¤çš„Runnableå¯¹è±¡ä¼šå­˜å‚¨åœ¨è¿™é‡Œï¼Œå®ƒæ˜¯BlockingQueueç±»å‹çš„ï¼Œä¹Ÿå°±æ˜¯é˜»å¡é˜Ÿåˆ—ã€‚</li>
<li><strong>threadFactory</strong>ï¼šçº¿ç¨‹å·¥å‚ã€‚ä¸ºçº¿ç¨‹æ± æä¾›åˆ›å»ºæ–°çº¿ç¨‹çš„åŠŸèƒ½ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ— éœ€è®¾ç½®è¯¥å‚æ•°ï¼Œä½¿ç”¨é»˜è®¤çš„å°±è¡Œã€‚</li>
<li><strong>handler</strong>ï¼šæ‹’ç»ç­–ç•¥ã€‚å½“çº¿ç¨‹æ± æ— æ³•æ‰§è¡Œæ–°ä»»åŠ¡æ—¶ï¼Œè¿™å¯èƒ½æ˜¯ç”±äºä»»åŠ¡é˜Ÿåˆ—å·²æ»¡æˆ–è€…æ˜¯æ— æ³•æˆåŠŸæ‰§è¡Œä»»åŠ¡ï¼Œè¿™ä¸ªæ—¶å€™ThreadPoolExecutorä¼šè°ƒç”¨handlerçš„rejectedExecution()æ–¹æ³•æ¥é€šçŸ¥è°ƒç”¨è€…ã€‚</li>
</ul>
<p>ThreadPoolExecutor ä¸º RejectedExecutionHandler æä¾›äº†å‡ ä¸ªå¯é€‰å€¼ï¼šAbortPolicyã€CallerRunsPolicyã€DiscardPolicy å’Œ DiscardOldestPolicyï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolExecutor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractExecutorService</span> {

    <span class="hljs-comment">/**
    * A handler for rejected tasks that runs the rejected task
    * directly in the calling thread of the {<span class="hljs-doctag">@code</span> execute} method,
    * unless the executor has been shut down, in which case the task
    * is discarded.
    */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CallerRunsPolicy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RejectedExecutionHandler</span> {
        <span class="hljs-comment">/**
        * Creates a {<span class="hljs-doctag">@code</span> CallerRunsPolicy}.
        */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">CallerRunsPolicy</span><span class="hljs-params">()</span> { }

        <span class="hljs-comment">/**
        * Executes task r in the caller's thread, unless the executor
        * has been shut down, in which case the task is discarded.
        *
        * <span class="hljs-doctag">@param</span> r the runnable task requested to be executed
        * <span class="hljs-doctag">@param</span> e the executor attempting to execute this task
        */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rejectedExecution</span><span class="hljs-params">(Runnable r, ThreadPoolExecutor e)</span> {
            <span class="hljs-keyword">if</span> (!e.isShutdown()) {
                r.run();
            }
        }
    }

    <span class="hljs-comment">/**
    * A handler for rejected tasks that throws a
    * {<span class="hljs-doctag">@code</span> RejectedExecutionException}.
    */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbortPolicy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RejectedExecutionHandler</span> {
        <span class="hljs-comment">/**
        * Creates an {<span class="hljs-doctag">@code</span> AbortPolicy}.
        */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">AbortPolicy</span><span class="hljs-params">()</span> { }

        <span class="hljs-comment">/**
        * Always throws RejectedExecutionException.
        *
        * <span class="hljs-doctag">@param</span> r the runnable task requested to be executed
        * <span class="hljs-doctag">@param</span> e the executor attempting to execute this task
        * <span class="hljs-doctag">@throws</span> RejectedExecutionException always
        */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rejectedExecution</span><span class="hljs-params">(Runnable r, ThreadPoolExecutor e)</span> {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RejectedExecutionException</span>(<span class="hljs-string">"Task "</span> + r.toString() +
            <span class="hljs-string">" rejected from "</span> +
            e.toString());
        }
    }

    <span class="hljs-comment">/**
    * A handler for rejected tasks that silently discards the
    * rejected task.
    */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiscardPolicy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RejectedExecutionHandler</span> {
        <span class="hljs-comment">/**
        * Creates a {<span class="hljs-doctag">@code</span> DiscardPolicy}.
        */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">DiscardPolicy</span><span class="hljs-params">()</span> { }

        <span class="hljs-comment">/**
        * Does nothing, which has the effect of discarding task r.
        *
        * <span class="hljs-doctag">@param</span> r the runnable task requested to be executed
        * <span class="hljs-doctag">@param</span> e the executor attempting to execute this task
        */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rejectedExecution</span><span class="hljs-params">(Runnable r, ThreadPoolExecutor e)</span> {
        }
    }

    <span class="hljs-comment">/**
    * A handler for rejected tasks that discards the oldest unhandled
    * request and then retries {<span class="hljs-doctag">@code</span> execute}, unless the executor
    * is shut down, in which case the task is discarded.
    */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DiscardOldestPolicy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RejectedExecutionHandler</span> {
        <span class="hljs-comment">/**
        * Creates a {<span class="hljs-doctag">@code</span> DiscardOldestPolicy} for the given executor.
        */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">DiscardOldestPolicy</span><span class="hljs-params">()</span> { }

        <span class="hljs-comment">/**
        * Obtains and ignores the next task that the executor
        * would otherwise execute, if one is immediately available,
        * and then retries execution of task r, unless the executor
        * is shut down, in which case task r is instead discarded.
        *
        * <span class="hljs-doctag">@param</span> r the runnable task requested to be executed
        * <span class="hljs-doctag">@param</span> e the executor attempting to execute this task
        */</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">rejectedExecution</span><span class="hljs-params">(Runnable r, ThreadPoolExecutor e)</span> {
            <span class="hljs-keyword">if</span> (!e.isShutdown()) {
                e.getQueue().poll();
                e.execute(r);
            }
        }
    }
} 
</code></pre>
<ol>
<li>AbortPolicyï¼šé»˜è®¤å€¼ï¼Œç›´æ¥æŠ›å‡º RejectedExecutionException å¼‚å¸¸ã€‚</li>
<li>CallerRunsPolicyï¼šäº¤ç»™è°ƒç”¨ execute() æ–¹æ³•çš„çº¿ç¨‹è¿›è¡Œæ‰§è¡Œã€‚å¦‚æœ executor å·²ç» shutdown äº†ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒã€‚</li>
<li>DiscardPolicyï¼šç›´æ¥ä¸¢å¼ƒã€‚</li>
<li>DiscardOldestPolicyï¼šä¸¢å¼ƒæœ€è€çš„æœªå¤„ç†çš„è¯·æ±‚ï¼Œç„¶åé‡æ–°æ‰§è¡Œ execute() æ–¹æ³•ã€‚å¦‚æœ executor å·²ç» shutdown äº†ï¼Œåˆ™ç›´æ¥ä¸¢å¼ƒã€‚</li>
</ol>
<h3 data-id="heading-3">çº¿ç¨‹æ± çš„å¤„ç†æµç¨‹</h3>
<p>ThreadPoolExecutoræ‰§è¡Œä»»åŠ¡æ—¶å¤§è‡´éµå¾ªå¦‚ä¸‹æµç¨‹:</p>
<ol>
<li>å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡æœªè¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡ï¼Œé‚£ä¹ˆä¼šç›´æ¥å¯åŠ¨ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</li>
<li>å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å·²ç»è¾¾åˆ°æˆ–è€…è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹çš„æ•°é‡ï¼Œé‚£ä¹ˆæ–°ä»»åŠ¡ä¼šè¢«æ’å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­æ’é˜Ÿç­‰å¾…æ‰§è¡Œã€‚</li>
<li>å¦‚æœåœ¨æ­¥éª¤2ä¸­æ— æ³•å°†ä»»åŠ¡æ’å…¥åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè¿™å¾€å¾€æ˜¯ç”±äºä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œè¿™ä¸ªæ—¶å€™å¦‚æœçº¿ç¨‹æ•°é‡æœªè¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆä¼šç«‹åˆ»å¯åŠ¨ä¸€ä¸ªéæ ¸å¿ƒçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚</li>
<li>å¦‚æœæ­¥éª¤3ä¸­çº¿ç¨‹æ•°é‡å·²ç»è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œæ‹’ç»ç­–ç•¥ã€‚</li>
</ol>
<h3 data-id="heading-4">4ç§å¸¸ç”¨çš„çº¿ç¨‹æ± </h3>
<p>ä¸‹é¢ä»‹ç»4ç§å¸¸ç”¨çš„çº¿ç¨‹æ± ï¼Œå®ƒä»¬éƒ½æ˜¯ç›´æ¥æˆ–é—´æ¥åœ°é€šè¿‡é…ç½®ThreadPoolExecutoræ¥å®ç°è‡ªå·±çš„åŠŸèƒ½ç‰¹æ€§ã€‚</p>
<ol>
<li><strong>FixedThreadPool</strong>ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Executors</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newFixedThreadPool</span><span class="hljs-params">(<span class="hljs-type">int</span> nThreads)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(nThreads, nThreads,
                <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());
    }
}
</code></pre>
<p>å®ƒé€šè¿‡Executorsçš„newFixedThreadPool()æ–¹æ³•æ¥åˆ›å»ºã€‚å®ƒæ˜¯ä¸€ç§çº¿ç¨‹æ•°é‡å›ºå®šçš„çº¿ç¨‹æ± ï¼Œå…¶æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°éƒ½è¢«è®¾ç½®æˆnThreadsã€‚å¦å¤–ï¼Œç”±äºä»»åŠ¡é˜Ÿåˆ—æ˜¯æ— ç•Œé˜»å¡é˜Ÿåˆ—LinkedBlockingQueueï¼ˆå®¹é‡é»˜è®¤ä¸ºInteger.MAX_VALUEï¼‰ï¼Œç›¸å½“äºä¸ä¼šäº§ç”Ÿéæ ¸å¿ƒçº¿ç¨‹ï¼ŒkeepAliveTimeå‚æ•°æ— æ•ˆã€‚å½“çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€æ—¶ï¼Œå®ƒä»¬å¹¶ä¸ä¼šè¢«å›æ”¶ï¼Œé™¤éçº¿ç¨‹æ± è¢«å…³é—­äº†ï¼Œè¿™æ ·ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯ä»¥å¾—åˆ°é‡ç”¨ã€‚å½“æ‰€æœ‰çš„çº¿ç¨‹éƒ½å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œæ–°ä»»åŠ¡ä¼šè¢«æ·»åŠ åˆ°LinkedBlockingQueueä¸­ç­‰å¾…ï¼Œç›´åˆ°æœ‰çº¿ç¨‹ç©ºé—²å‡ºæ¥ã€‚ç”±äºFixedThreadPoolåªæœ‰æ ¸å¿ƒçº¿ç¨‹å¹¶ä¸”è¿™äº›æ ¸å¿ƒçº¿ç¨‹ä¸ä¼šè¢«å›æ”¶ï¼Œè¿™æ„å‘³ç€å®ƒèƒ½å¤Ÿæ›´åŠ å¿«é€Ÿåœ°å“åº”å¤–ç•Œçš„è¯·æ±‚ã€‚</p>
<ol start="2">
<li><strong>CachedThreadPool</strong>ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Executors</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newCachedThreadPool</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">0</span>, Integer.MAX_VALUE,
                <span class="hljs-number">60L</span>, TimeUnit.SECONDS,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">SynchronousQueue</span>&lt;Runnable&gt;());
    }
} 
</code></pre>
<p>é€šè¿‡Executorsçš„newCachedThreadPool()æ–¹æ³•æ¥åˆ›å»ºã€‚å®ƒæ˜¯ä¸€ç§çº¿ç¨‹æ•°é‡ä¸å®šçš„çº¿ç¨‹æ± ï¼Œå…¶æ ¸å¿ƒçº¿ç¨‹ä¸º0ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸ºInteger.MAX_VALUEã€‚ç”±äºInteger.MAX_VALUEæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œå®é™…ä¸Šå°±ç›¸å½“äºæœ€å¤§çº¿ç¨‹æ•°å¯ä»¥ä»»æ„å¤§ã€‚å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹éƒ½å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†æ–°ä»»åŠ¡ï¼Œå¦åˆ™å°±ä¼šåˆ©ç”¨ç©ºé—²çš„çº¿ç¨‹æ¥å¤„ç†æ–°ä»»åŠ¡ã€‚çº¿ç¨‹æ± ä¸­çš„ç©ºé—²çº¿ç¨‹çš„è¶…æ—¶æ—¶é•¿ä¸º60ç§’ï¼Œè¶…è¿‡60ç§’é—²ç½®çº¿ç¨‹å°±ä¼šè¢«å›æ”¶ã€‚CachedThreadPoolçš„ä»»åŠ¡é˜Ÿåˆ—SynchronousQueueæ˜¯ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œå…¶æ¯ä¸€ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹ç›¸åº”çš„ç§»é™¤æ“ä½œï¼Œç›¸å½“äºæ¯æ¬¡æäº¤åˆ°ä»»åŠ¡é˜Ÿåˆ—çš„ä»»åŠ¡é©¬ä¸Šå°±ä¼šè¢«çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ‹¿å»æ‰§è¡Œã€‚ä»CachedThreadPoolçš„ç‰¹æ€§æ¥çœ‹ï¼Œè¿™ç±»çº¿ç¨‹æ± æ¯”è¾ƒé€‚åˆæ‰§è¡Œå¤§é‡çš„è€—æ—¶è¾ƒå°‘çš„ä»»åŠ¡ã€‚å½“æ•´ä¸ªçº¿ç¨‹æ± éƒ½å¤„äºé—²ç½®çŠ¶æ€æ—¶ï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹éƒ½ä¼šè¶…æ—¶è€Œè¢«åœæ­¢ï¼Œè¿™ä¸ªæ—¶å€™CachedThreadPoolä¹‹ä¸­å®é™…ä¸Šæ˜¯æ²¡æœ‰ä»»ä½•çº¿ç¨‹çš„ï¼Œå®ƒå‡ ä¹æ˜¯ä¸å ç”¨ä»»ä½•ç³»ç»Ÿèµ„æºçš„ã€‚</p>
<p>3.<strong>SingleThreadExecutor</strong>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Executors</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ExecutorService <span class="hljs-title function_">newSingleThreadExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FinalizableDelegatedExecutorService</span>
                (<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>,
                        <span class="hljs-number">0L</span>, TimeUnit.MILLISECONDS,
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()));
    }
} 
</code></pre>
<p>é€šè¿‡Executorsçš„newSingleThreadExecutor()æ–¹æ³•æ¥åˆ›å»ºã€‚çº¿ç¨‹æ± å†…éƒ¨åªæœ‰ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œå®ƒç¡®ä¿æ‰€æœ‰çš„ä»»åŠ¡éƒ½åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­æŒ‰é¡ºåºæ‰§è¡Œã€‚SingleThreadExecutor çš„æ„ä¹‰åœ¨äºç»Ÿä¸€æ‰€æœ‰çš„ä»»åŠ¡åˆ°ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œè¿™ä½¿å¾—åœ¨è¿™äº›ä»»åŠ¡ä¹‹é—´ä¸éœ€è¦å¤„ç†çº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚</p>
<ol start="4">
<li><strong>ScheduledThreadPool</strong>ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Executors</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ScheduledExecutorService <span class="hljs-title function_">newScheduledThreadPool</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScheduledThreadPoolExecutor</span>(corePoolSize);
    }
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScheduledThreadPoolExecutor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ThreadPoolExecutor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ScheduledExecutorService</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ong</span> <span class="hljs-variable">DEFAULT_KEEPALIVEMILLIS</span> <span class="hljs-operator">=</span> <span class="hljs-number">10L</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ScheduledThreadPoolExecutor</span><span class="hljs-params">(<span class="hljs-type">int</span> corePoolSize)</span> {
        <span class="hljs-built_in">super</span>(corePoolSize, Integer.MAX_VALUE,
                DEFAULT_KEEPALIVE_MILLIS, MILLISECONDS,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">DelayedWorkQueue</span>());
    }

}
</code></pre>
<p>é€šè¿‡Executorsçš„newScheduledThreadPool()æ–¹æ³•æ¥åˆ›å»ºã€‚å®ƒçš„æ ¸å¿ƒçº¿ç¨‹æ•°æ˜¯å›ºå®šçš„ï¼Œæœ€å¤§çº¿ç¨‹æ•°æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œç”±äºDelayedWorkQueueæ˜¯æ— ç•Œçš„ï¼Œæ‰€ä»¥æœ€å¤§çº¿ç¨‹æ•°è¿™ä¸ªå‚æ•°æ˜¯æ— æ•ˆçš„ã€‚ScheduledThreadPool è¿™ç±»çº¿ç¨‹æ± ä¸»è¦ç”¨äºæ‰§è¡Œå®šæ—¶ä»»åŠ¡å’Œå…·æœ‰å›ºå®šå‘¨æœŸçš„é‡å¤ä»»åŠ¡ã€‚å¯ä»¥è°ƒç”¨ScheduledThreadPoolExecutorçš„scheduleAtFixedRate()æˆ–è€…scheduleWithFixedDelay()æ–¹æ³•æ¥æ‰§è¡Œå‘¨æœŸæ€§çš„ä»»åŠ¡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨çš„å®ä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Runnable</span> <span class="hljs-variable">runnable</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        System.out.println(<span class="hljs-string">"current time millis is:"</span> + System.currentTimeMillis());
    }
};

<span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduledThreadPool</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">4</span>);

<span class="hljs-comment">//2ç§’åæ‰§è¡Œrunnable</span>
scheduledThreadPool.schedule(runnable, <span class="hljs-number">2</span>, TimeUnit.SECONDS);

<span class="hljs-comment">//ç¬¬ä¸€ä¸ªä»»åŠ¡10msåæ‰§è¡Œï¼Œåé¢æ¯éš”1000msæ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡</span>
scheduledThreadPool.scheduleAtFixedRate(runnable, <span class="hljs-number">10</span>, <span class="hljs-number">1000</span>, TimeUnit.MILLISECONDS);

<span class="hljs-comment">//ç¬¬ä¸€ä¸ªä»»åŠ¡10msåæ‰§è¡Œï¼Œåé¢çš„ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´æ˜¯ä¸Šä¸€ä¸ªä»»åŠ¡æ‰§è¡Œç»“æŸåçš„1000ms</span>
scheduledThreadPool.scheduleWithFixedDelay(runnable, <span class="hljs-number">10</span>, <span class="hljs-number">1000</span>, TimeUnit.MILLISECONDS);
</code></pre>
<p>ä¸€èˆ¬ä¸æ¨èä½¿ç”¨Executorså»åˆ›å»ºçº¿ç¨‹æ± ï¼Œè€Œæ¨èä½¿ç”¨ThreadPoolExecutorçš„æ–¹å¼ï¼Œä½¿ç”¨Executorså»åˆ›å»ºçº¿ç¨‹æ± çš„é£é™©å¦‚ä¸‹ï¼š</p>
<ol>
<li>FixedThreadPoolå’ŒSingleThreadExecutorï¼šå…è®¸çš„ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦ä¸ºInteger.MAX_VALUEï¼Œå¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´OOMã€‚</li>
<li>CachedThreadPoolï¼šå…è®¸åˆ›å»ºçš„çº¿ç¨‹æ•°é‡ä¸ºInteger.MAX_VALUEï¼Œå¯èƒ½ä¼šåˆ›å»ºå¤§é‡çº¿ç¨‹ï¼Œä»è€Œå¯¼è‡´OOMã€‚</li>
</ol>
<h3 data-id="heading-5">çº¿ç¨‹æ± çš„å¼‚å¸¸å¤„ç†</h3>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">threadPool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">5</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
    threadPool.submit(() -&gt; {
        System.out.println(<span class="hljs-string">"current thread nameï¼š"</span> + Thread.currentThread().getName());
        <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        System.out.println(<span class="hljs-string">"resultï¼š"</span> + object.toString());
    });
}
</code></pre>
<p>æ‰§è¡Œåæ‰“å°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>
current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">3</span>
current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">4</span>
current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">2</span>
current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">5</span>
</code></pre>
<p>æ˜¾ç„¶ä¸Šé¢çš„ä»£ç ä¸­objectä¸ºnullï¼Œæ‰§è¡Œobject.toString()ä¼šæœ‰å¼‚å¸¸ï¼Œä½†æ˜¯æ‰“å°å¹¶æ²¡æœ‰çœ‹åˆ°å¼‚å¸¸ï¼Œè¿™ç§æƒ…å†µä¸‹å°±æ²¡åŠæ³•æ„ŸçŸ¥ä»£ç ä¸­çš„å¼‚å¸¸äº†ã€‚</p>
<p>çº¿ç¨‹æ± ä¸­å¤„ç†å¼‚å¸¸çš„æ–¹å¼æœ‰4ç§ï¼š</p>
<ol>
<li><strong>æ·»åŠ try catchè¯­å¥</strong>;</li>
<li><strong>é€šè¿‡Futureå¯¹è±¡çš„get()æ–¹æ³•æ¥æ”¶æŠ›å‡ºçš„å¼‚å¸¸è¿›è¡Œå¤„ç†</strong>;</li>
<li><strong>ç»™çº¿ç¨‹è®¾ç½®UncaughtExceptionHandler</strong>;</li>
<li><strong>é‡å†™ThreadPoolExecutorçš„afterExecute()æ–¹æ³•</strong>;</li>
</ol>
<p>å…ˆæ¥çœ‹çœ‹ç¬¬1ç§æ–¹å¼ï¼Œè‡ªå·±æ·»åŠ try catchè¯­å¥ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">threadPool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">5</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
    threadPool.submit(() -&gt; {
        System.out.println(<span class="hljs-string">"current thread nameï¼š"</span> + Thread.currentThread().getName());
        <span class="hljs-keyword">try</span>{
            <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
            System.out.println(<span class="hljs-string">"resultï¼š"</span> + object.toString());
        }<span class="hljs-keyword">catch</span> (Exception e){
            System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" å‡ºå¼‚å¸¸äº†"</span>);
        }
    });
}
</code></pre>
<p>æ‰§è¡Œåæ‰“å°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span> å‡ºå¼‚å¸¸äº†
current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">2</span>
current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">4</span>
current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">3</span>
current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">5</span>
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">4</span> å‡ºå¼‚å¸¸äº†
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">2</span> å‡ºå¼‚å¸¸äº†
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">5</span> å‡ºå¼‚å¸¸äº†
pool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">3</span> å‡ºå¼‚å¸¸äº†
</code></pre>
<p>ç¬¬2ç§æ–¹å¼æˆ‘ä»¬éœ€è¦åˆ†æä¸€ä¸‹æºç ï¼Œçœ‹çœ‹ä¸ºä»€ä¹ˆå¯ä»¥é€šè¿‡Futureå¯¹è±¡çš„get()æ–¹æ³•æ‹¿åˆ°æŠ›å‡ºçš„å¼‚å¸¸ï¼Œæˆ‘ä»¬ä»submit()æ–¹æ³•å¼€å§‹è·Ÿä¸€ä¸‹æºç ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractExecutorService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ExecutorService</span> {

    <span class="hljs-keyword">public</span> Future&lt;?&gt; submit(Runnable task) {
        <span class="hljs-keyword">if</span> (task == <span class="hljs-literal">null</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>();
        RunnableFuture&lt;Void&gt; ftask = newTaskFor(task, <span class="hljs-literal">null</span>);
        execute(ftask);
        <span class="hljs-keyword">return</span> ftask;
    }

    <span class="hljs-keyword">protected</span> &lt;T&gt; RunnableFuture&lt;T&gt; <span class="hljs-title function_">newTaskFor</span><span class="hljs-params">(Runnable runnable, T value)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FutureTask</span>&lt;T&gt;(runnable, value);
    }
}
</code></pre>
<p>submit()æ–¹æ³•é‡Œé¢é€šè¿‡newTaskFor()æ–¹æ³•å°†ä¼ å…¥çš„Runnableå¯¹è±¡åŒ…è£…æˆFutureTaskï¼Œç„¶åå°†è¿™ä¸ªFutureTaskäº¤ç»™execute()æ–¹æ³•æ‰§è¡Œï¼Œæœ€åè¿”å›FutureTaskã€‚</p>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    Future &lt;|-- RunnableFuture
    Runnable &lt;|-- RunnableFuture
    RunnableFuture &lt;|.. FutureTask

    class Future {
        &lt;&lt;interface&gt;&gt;
        +cancel()
        +isCancelled()
        +get()
    }
    
    class Runnable {
        &lt;&lt;interface&gt;&gt;
        +run()
    }
    
    class RunnableFuture {
        &lt;&lt;interface&gt;&gt;
    }
    
    class FutureTask {
        +run()
        +get()
        +cancel()
    }
</code></pre>
<p>FutureTaskå¯ä»¥ç”¨æ¥åŒ…è£…Callableæˆ–Runnableå¯¹è±¡ï¼Œå› ä¸ºFutureTaskå®ç°äº†Runnableæ¥å£ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FutureTask</span>&lt;V&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RunnableFuture</span>&lt;V&gt; {

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FutureTask</span><span class="hljs-params">(Runnable runnable, V result)</span> {
        <span class="hljs-built_in">this</span>.callable = Executors.callable(runnable, result);
        <span class="hljs-built_in">this</span>.state = NEW; <span class="hljs-comment">// ensure visibility of callable</span>
    }
}
</code></pre>
<p>åœ¨FutureTaskçš„æ„é€ æ–¹æ³•ä¸­ï¼Œå°†RunnableåŒ…è£…æˆäº†ä¸€ä¸ªCallableç±»å‹çš„å¯¹è±¡ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (state != NEW ||
            !U.compareAndSwapObject(<span class="hljs-built_in">this</span>, RUNNER, <span class="hljs-literal">null</span>, Thread.currentThread()))
        <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">try</span> {
        Callable&lt;V&gt; c = callable;
        <span class="hljs-keyword">if</span> (c != <span class="hljs-literal">null</span> &amp;&amp; state == NEW) {
            V result;
            <span class="hljs-type">boolean</span> ran;
            <span class="hljs-keyword">try</span> {
                result = c.call();
                ran = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">catch</span> (Throwable ex) {
                result = <span class="hljs-literal">null</span>;
                ran = <span class="hljs-literal">false</span>;
                setException(ex);
            }
            <span class="hljs-keyword">if</span> (ran)
                set(result);
        }
    } <span class="hljs-keyword">finally</span> {
        <span class="hljs-comment">// runner must be non-null until state is settled to</span>
        <span class="hljs-comment">// prevent concurrent calls to run()</span>
        runner = <span class="hljs-literal">null</span>;
        <span class="hljs-comment">// state must be re-read after nulling runner to prevent</span>
        <span class="hljs-comment">// leaked interrupts</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> state;
        <span class="hljs-keyword">if</span> (s &gt;= INTERRUPTING)
            handlePossibleCancellationInterrupt(s);
    }
}
</code></pre>
<p>åœ¨FutureTaskçš„run()æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº†Callableå¯¹è±¡çš„call()æ–¹æ³•ï¼Œä¹Ÿå°±è°ƒç”¨äº†æˆ‘ä»¬ä¼ å…¥çš„Runnableå¯¹è±¡çš„run()æ–¹æ³•ã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°æœ‰æ·»åŠ try catchè¯­å¥ï¼ŒæŠ›å‡ºçš„å¼‚å¸¸ä¼šä¼ å…¥setException()æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setException</span><span class="hljs-params">(Throwable t)</span> {
    <span class="hljs-keyword">if</span> (U.compareAndSwapInt(<span class="hljs-built_in">this</span>, STATE, NEW, COMPLETING)) {
        outcome = t;
        U.putOrderedInt(<span class="hljs-built_in">this</span>, STATE, EXCEPTIONAL); <span class="hljs-comment">// final state</span>
        finishCompletion();
    }
}
</code></pre>
<p>åœ¨setException()æ–¹æ³•ä¸­å°†å¼‚å¸¸èµ‹å€¼ç»™äº†outcomeã€‚æ¥ç€çœ‹çœ‹FutureTaskçš„get()æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> V <span class="hljs-title function_">get</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException {
    <span class="hljs-type">int</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> state;
    <span class="hljs-keyword">if</span> (s &lt;= COMPLETING)
        s = awaitDone(<span class="hljs-literal">false</span>, <span class="hljs-number">0L</span>);
    <span class="hljs-keyword">return</span> report(s);
}
</code></pre>
<p>é‡Œé¢åˆè°ƒç”¨äº†report()æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> V <span class="hljs-title function_">report</span><span class="hljs-params">(<span class="hljs-type">int</span> s)</span> <span class="hljs-keyword">throws</span> ExecutionException {
    <span class="hljs-type">Object</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> outcome;
    <span class="hljs-keyword">if</span> (s == NORMAL)
        <span class="hljs-keyword">return</span> (V)x;
    <span class="hljs-keyword">if</span> (s &gt;= CANCELLED)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CancellationException</span>();
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExecutionException</span>((Throwable)x);
}
</code></pre>
<p>åœ¨report()æ–¹æ³•æ–¹æ³•ä¸­ä¼šæ‹¿åˆ°è¿™ä¸ªoutcomeå¹¶æŠ›å‡ºï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡Futureçš„get()æ–¹æ³•æ¥æ”¶æŠ›å‡ºçš„å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œå°†ä¸Šé¢çš„ç¤ºä¾‹æ”¹é€ ä¸€ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">threadPool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">5</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
    <span class="hljs-type">Future</span> <span class="hljs-variable">future</span> <span class="hljs-operator">=</span> threadPool.submit(() -&gt; {
        System.out.println(<span class="hljs-string">"current thread nameï¼š"</span> + Thread.currentThread().getName());
        <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        System.out.println(<span class="hljs-string">"resultï¼š"</span> + object.toString());
    });

    <span class="hljs-keyword">try</span>{
        future.get();
    }<span class="hljs-keyword">catch</span> (Exception e){
        System.out.println(<span class="hljs-string">"å‡ºå¼‚å¸¸äº†"</span>);
    }
}
</code></pre>
<p>æ‰“å°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">1</span>
å‡ºå¼‚å¸¸äº†
current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">2</span>
å‡ºå¼‚å¸¸äº†
current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">3</span>
å‡ºå¼‚å¸¸äº†
current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">4</span>
å‡ºå¼‚å¸¸äº†
current thread nameï¼špool-<span class="hljs-number">1</span>-thread-<span class="hljs-number">5</span>
å‡ºå¼‚å¸¸äº†
</code></pre>
<p>ç¬¬3ç§æ–¹å¼æ˜¯é€šè¿‡ç»™çº¿ç¨‹è®¾ç½®UncaughtExceptionHandlerï¼Œç„¶ååœ¨å…¶uncaughtException()æ–¹æ³•ä¸­å¤„ç†å¼‚å¸¸ï¼Œè¿™ç§æ–¹å¼åªèƒ½ç”¨åœ¨ä½¿ç”¨execute()æäº¤ä»»åŠ¡çš„ä»£ç ä¸­ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">threadPool</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">5</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadFactory</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Thread <span class="hljs-title function_">newThread</span><span class="hljs-params">(Runnable r)</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(r);
        t.setUncaughtExceptionHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>.UncaughtExceptionHandler() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">uncaughtException</span><span class="hljs-params">(<span class="hljs-meta">@NonNull</span> Thread t, <span class="hljs-meta">@NonNull</span> Throwable e)</span> {
                System.out.println(t.getName() + <span class="hljs-string">" æŠ›å‡ºäº†å¼‚å¸¸ï¼š"</span> + e);
            }
        });
        <span class="hljs-keyword">return</span> t;
    }
});

<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
    threadPool.execute(() -&gt; {
        System.out.println(<span class="hljs-string">"current thread nameï¼š"</span> + Thread.currentThread().getName());
        <span class="hljs-type">Object</span> <span class="hljs-variable">object</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        System.out.println(<span class="hljs-string">"resultï¼š"</span> + object.toString());
    });
}
</code></pre>
<p>æ‰“å°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">current thread nameï¼šThread-<span class="hljs-number">2</span>
current thread nameï¼šThread-<span class="hljs-number">4</span>
current thread nameï¼šThread-<span class="hljs-number">3</span>
current thread nameï¼šThread-<span class="hljs-number">5</span>
current thread nameï¼šThread-<span class="hljs-number">6</span>
Thread-<span class="hljs-number">2</span> æŠ›å‡ºäº†å¼‚å¸¸ï¼šjava.lang.NullPointerException: Cannot invoke <span class="hljs-string">"Object.toString()"</span> because <span class="hljs-string">"object"</span> is <span class="hljs-literal">null</span>
Thread-<span class="hljs-number">4</span> æŠ›å‡ºäº†å¼‚å¸¸ï¼šjava.lang.NullPointerException: Cannot invoke <span class="hljs-string">"Object.toString()"</span> because <span class="hljs-string">"object"</span> is <span class="hljs-literal">null</span>
Thread-<span class="hljs-number">3</span> æŠ›å‡ºäº†å¼‚å¸¸ï¼šjava.lang.NullPointerException: Cannot invoke <span class="hljs-string">"Object.toString()"</span> because <span class="hljs-string">"object"</span> is <span class="hljs-literal">null</span>
Thread-<span class="hljs-number">5</span> æŠ›å‡ºäº†å¼‚å¸¸ï¼šjava.lang.NullPointerException: Cannot invoke <span class="hljs-string">"Object.toString()"</span> because <span class="hljs-string">"object"</span> is <span class="hljs-literal">null</span>
Thread-<span class="hljs-number">6</span> æŠ›å‡ºäº†å¼‚å¸¸ï¼šjava.lang.NullPointerException: Cannot invoke <span class="hljs-string">"Object.toString()"</span> because <span class="hljs-string">"object"</span> is <span class="hljs-literal">null</span>
</code></pre>
<p>ç¬¬4ç§æ–¹å¼ï¼šé‡å†™ThreadPoolExecutorçš„afterExecute()æ–¹æ³•ã€‚</p>
<p>åœ¨ä½¿ç”¨execute()æäº¤ä»»åŠ¡çš„æ—¶å€™ï¼ˆsubmit()å…¶å®ä¹Ÿæ˜¯è°ƒç”¨çš„execute()æ–¹æ³•ï¼‰ï¼Œä¼šæ‰§è¡ŒThreadPoolExecutorçš„runWorker()æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolExecutor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AbstractExecutorService</span> {

    <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">runWorker</span><span class="hljs-params">(Worker w)</span> {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">wt</span> <span class="hljs-operator">=</span> Thread.currentThread();
        <span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> w.firstTask;
        w.firstTask = <span class="hljs-literal">null</span>;
        w.unlock(); <span class="hljs-comment">// allow interrupts</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">completedAbruptly</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (task != <span class="hljs-literal">null</span> || (task = getTask()) != <span class="hljs-literal">null</span>) {
                w.lock();
                <span class="hljs-comment">// If pool is stopping, ensure thread is interrupted;</span>
                <span class="hljs-comment">// if not, ensure thread is not interrupted. This</span>
                <span class="hljs-comment">// requires a recheck in second case to deal with</span>
                <span class="hljs-comment">// shutdownNow race while clearing interrupt</span>
                <span class="hljs-keyword">if</span> ((runStateAtLeast(ctl.get(), STOP) ||
                        (Thread.interrupted() &amp;&amp;
                                runStateAtLeast(ctl.get(), STOP))) &amp;&amp;
                        !wt.isInterrupted())
                    wt.interrupt();
                <span class="hljs-keyword">try</span> {
                    beforeExecute(wt, task);
                    <span class="hljs-type">Throwable</span> <span class="hljs-variable">thrown</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
                    <span class="hljs-keyword">try</span> {
                        task.run();
                    } <span class="hljs-keyword">catch</span> (RuntimeException x) {
                        thrown = x;
                        <span class="hljs-keyword">throw</span> x;
                    } <span class="hljs-keyword">catch</span> (Error x) {
                        thrown = x;
                        <span class="hljs-keyword">throw</span> x;
                    } <span class="hljs-keyword">catch</span> (Throwable x) {
                        thrown = x;
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(x);
                    } <span class="hljs-keyword">finally</span> {
                        afterExecute(task, thrown);
                    }
                } <span class="hljs-keyword">finally</span> {
                    task = <span class="hljs-literal">null</span>;
                    w.completedTasks++;
                    w.unlock();
                }
            }
            completedAbruptly = <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">finally</span> {
            processWorkerExit(w, completedAbruptly);
        }
    }
}
</code></pre>
<p>ä¸Šé¢çš„ä»£ç ä¼šä¸åœåœ°ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å–å‡ºä»»åŠ¡æ‰§è¡Œï¼Œå¦‚æœrun()æ–¹æ³•æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä¼šæŠŠå¼‚å¸¸èµ‹å€¼ç»™thrownï¼Œæœ€ç»ˆä¼ ç»™afterExecute()æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é»˜è®¤æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°è¿™ä¸ªæ–¹æ³•è¿›è¡Œå¤„ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ExtendedExecutor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ThreadPoolExecutor</span> {
    <span class="hljs-comment">// jdkæ–‡æ¡£é‡Œé¢çš„ä¾‹å­</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterExecute</span><span class="hljs-params">(Runnable r, Throwable t)</span> {
        <span class="hljs-built_in">super</span>.afterExecute(r, t);
        <span class="hljs-keyword">if</span> (t == <span class="hljs-literal">null</span> &amp;&amp; r <span class="hljs-keyword">instanceof</span> Future&lt;?&gt;) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> ((Future&lt;?&gt;) r).get();
            } <span class="hljs-keyword">catch</span> (CancellationException ce) {
                t = ce;
            } <span class="hljs-keyword">catch</span> (ExecutionException ee) {
                t = ee.getCause();
            } <span class="hljs-keyword">catch</span> (InterruptedException ie) {
                Thread.currentThread().interrupt(); <span class="hljs-comment">// ignore/reset</span>
            }
        }
        <span class="hljs-keyword">if</span> (t != <span class="hljs-literal">null</span>)
            System.out.println(t);
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Androidè¾“å…¥ç³»ç»Ÿæºç åˆ†æ(ä¸‹)]]></title>    <link>https://juejin.cn/post/7591293897085534258</link>    <guid>https://juejin.cn/post/7591293897085534258</guid>    <pubDate>2026-01-04T12:32:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591293897085534258" data-draft-id="7591360623469379594" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Androidè¾“å…¥ç³»ç»Ÿæºç åˆ†æ(ä¸‹)"/> <meta itemprop="keywords" content="æºç "/> <meta itemprop="datePublished" content="2026-01-04T12:32:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CarryZhang"/> <meta itemprop="url" content="https://juejin.cn/user/782508007385415"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Androidè¾“å…¥ç³»ç»Ÿæºç åˆ†æ(ä¸‹)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/782508007385415/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CarryZhang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T12:32:42.000Z" title="Sun Jan 04 2026 12:32:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»24åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸Šä¸€ç¯‡<a href="https://juejin.cn/editor/drafts/7591360623469363210" target="_blank" title="https://juejin.cn/editor/drafts/7591360623469363210">Androidè¾“å…¥ç³»ç»Ÿæºç åˆ†æ(ä¸Š)</a> ä¸»è¦è®²è¿°äº†è¾“å…¥äº‹ä»¶çš„è¯»å–å’Œåˆ†å‘ï¼Œè¿™é‡Œæ¥ç€åˆ†æäº‹ä»¶çš„æ¥å—ï¼Œå¤„ç†å®Œçš„å›ä¼ å’Œäº‹ä»¶ANRçš„æµç¨‹ã€‚</p>
<h2 data-id="heading-0">5.Appçª—å£æ¥å—äº‹ä»¶ä»¥åŠä¼ é€’åˆ°View/Activity</h2>
<p>å‰é¢çš„ç« èŠ‚å·²ç»åˆ†æçš„è¾“å…¥äº‹ä»¶çš„è¯»å–å’Œåœ¨serverç«¯çš„åˆ†å‘ï¼Œåˆ†å‘æœ€ç»ˆè°ƒç”¨çš„æ˜¯socketå‘é€æ•°æ®ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä»Appçª—å£çš„åˆå§‹åŒ–æµç¨‹åˆ†æï¼Œé‡ç‚¹å…³æ³¨äºè¾“å…¥äº‹ä»¶æœ‰å…³çš„apiè°ƒç”¨ã€‚ç¨å¾®è·Ÿè¿›ä¸€ä¸‹Appçª—å£çš„åˆå§‹åŒ–é€»è¾‘ï¼Œå°±ä¼šå‘ç° Appçª—å£æ·»åŠ æ—¶æœ€ç»ˆéƒ½ä¼šèµ°åˆ° <code>ViewRootImpl.setView</code>ï¼Œå¯¹è¿™ä¸€å—è°ƒç”¨æµç¨‹ä¸æ¸…æ¥šçš„å¯ä»¥å‚è€ƒ <a href="https://juejin.cn/editor/drafts/7462671646630199346" target="_blank" title="https://juejin.cn/editor/drafts/7462671646630199346">Androidçª—å£æ·»åŠ æµç¨‹æºç åˆ†æ</a>. ä¸‹é¢çš„ åˆ†æå°±ä» <code>ViewRootImpl.setView</code> å¼€å§‹ï¼Œ<code>ViewRootImpl.setView</code>æ•´ä¸ªæ–¹æ³•æ¯”è¾ƒé•¿ï¼Œæ ¸å¿ƒé€»è¾‘ä»£ç ä¹Ÿå¾ˆå¤šï¼Œè¿™é‡Œé‡ç‚¹å…³æ³¨è¾“å…¥äº‹ä»¶ç›¸å…³çš„é€»è¾‘ï¼Œè¿˜æ˜¯æˆªå–éƒ¨åˆ†ç›¸å…³ä»£ç æ¥åˆ†æ</p>
<pre><code class="hljs language-ini" lang="ini"> frameworks/base/core/java/android/view/ViewRootImpl.java
 public void setView(View view, WindowManager.LayoutParams attrs, View panelParentView,
            int userId) {
        synchronized (this) {
            if (<span class="hljs-attr">mView</span> == null) {
                <span class="hljs-attr">mView</span> = view<span class="hljs-comment">;</span>

                ...
                InputChannel <span class="hljs-attr">inputChannel</span> = null<span class="hljs-comment">;</span>
                if ((mWindowAttributes.inputFeatures
                        &amp; WindowManager.LayoutParams.INPUT_FEATURE_NO_INPUT_CHANNEL) == 0) {
                    //åˆå§‹åŒ– InputChannel
                    <span class="hljs-attr">inputChannel</span> = new InputChannel()<span class="hljs-comment">;//æ³¨é‡Š34</span>
                }
                

                try {
                    ...
                    //æ·»åŠ çª—å£åˆ°ws
                    <span class="hljs-attr">res</span> = mWindowSession.addToDisplayAsUser(mWindow, mWindowAttributes,
                            getHostVisibility(), mDisplay.getDisplayId(), userId,
                            mInsetsController.getRequestedVisibleTypes(), inputChannel, mTempInsets,
                            mTempControls, attachedFrame, compatScale)<span class="hljs-comment">;//æ³¨é‡Š35</span>
                   ...
                } catch (RemoteException | RuntimeException e) {
                  ...
                } finally {
                   ...
                }
                ...
                if (inputChannel != null) {
                    if (mInputQueueCallback != null) {
                        <span class="hljs-attr">mInputQueue</span> = new InputQueue()<span class="hljs-comment">;</span>
                        mInputQueueCallback.onInputQueueCreated(mInputQueue)<span class="hljs-comment">;</span>
                    }
                    //åˆå§‹åŒ– äº‹ä»¶æ¥å—çš„ InputEventReceiver
                    <span class="hljs-attr">mInputEventReceiver</span> = new WindowInputEventReceiver(inputChannel,
                            Looper.myLooper())<span class="hljs-comment">;//æ³¨é‡Š36</span>
                    ...
                }
                ...
                view.assignParent(this)<span class="hljs-comment">;</span>
                ...
                // Set up the input pipeline.
                // æ·»åŠ  Input äº‹ä»¶å¤„ç†å™¨ç®¡çº¿
                CharSequence <span class="hljs-attr">counterSuffix</span> = attrs.getTitle()<span class="hljs-comment">;</span>
                <span class="hljs-attr">mSyntheticInputStage</span> = new SyntheticInputStage()<span class="hljs-comment">;</span>
                InputStage <span class="hljs-attr">viewPostImeStage</span> = new ViewPostImeInputStage(mSyntheticInputStage)<span class="hljs-comment">;//æ³¨é‡Š37</span>
                InputStage <span class="hljs-attr">nativePostImeStage</span> = new NativePostImeInputStage(viewPostImeStage,
                        "aq:native-post-ime:" + counterSuffix)<span class="hljs-comment">;</span>
                InputStage <span class="hljs-attr">earlyPostImeStage</span> = new EarlyPostImeInputStage(nativePostImeStage)<span class="hljs-comment">;</span>
                InputStage <span class="hljs-attr">imeStage</span> = new ImeInputStage(earlyPostImeStage,
                        "aq:ime:" + counterSuffix)<span class="hljs-comment">;</span>
                InputStage <span class="hljs-attr">viewPreImeStage</span> = new ViewPreImeInputStage(imeStage)<span class="hljs-comment">;</span>
                InputStage <span class="hljs-attr">nativePreImeStage</span> = new NativePreImeInputStage(viewPreImeStage,
                        "aq:native-pre-ime:" + counterSuffix)<span class="hljs-comment">;</span>

                <span class="hljs-attr">mFirstInputStage</span> = nativePreImeStage<span class="hljs-comment">;</span>
                <span class="hljs-attr">mFirstPostImeInputStage</span> = earlyPostImeStage<span class="hljs-comment">;</span>
                ....
            }
        }
    }

</code></pre>
<p>æˆ‘ä»¬å…ˆçœ‹ä¸‹ App çª—å£ä¸Šçš„InputChannel æ˜¯å¦‚ä½•åˆå§‹åŒ–ï¼Œä»¥åŠå¦‚ä½•å…³è”åˆ°Serverç«¯ï¼Œå’ŒInputDispatcherçš„äº‹ä»¶åˆ†å‘å…³è”ä¸Šã€‚</p>
<h3 data-id="heading-1">5.1 App çª—å£ InputChannel åˆå§‹åŒ–å’Œå…³è”Server</h3>
<ul>
<li><strong>æ³¨é‡Š34</strong> åˆå§‹åŒ–äº†ä¸€ä¸ª java çš„ InputChannel</li>
<li><strong>æ³¨é‡Š35</strong> å¼€å§‹è°ƒç”¨æ·»åŠ çª—å£çš„é€»è¾‘ï¼Œæ·»åŠ çª—å£çš„æ•´ä¸ªé€»è¾‘ä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œè¿™é‡Œå…ˆä¸å±•å¼€äº†ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥å»é˜…è¯»<a href="https://juejin.cn/editor/drafts/7462671646630199346" target="_blank" title="https://juejin.cn/editor/drafts/7462671646630199346">Androidçª—å£æ·»åŠ æµç¨‹æºç åˆ†æ</a>ï¼Œ è¿˜æ˜¯åªå…³æ³¨è¾“å…¥äº‹ä»¶ç›¸å…³çš„é€»è¾‘ï¼Œæ·»åŠ çª—å£çš„é€»è¾‘ä¼šæ¥åˆ°<code> WMS.addWindow</code>,è¿™é‡Œæ„å»ºäº†ä¸€ä¸ª WindowStateå¯¹è±¡(æ¯ä¸ªçª—å£éƒ½æœ‰ä¸€ä¸ªWindowStateå¯¹è±¡ï¼ŒWMSé‡Œå­˜åœ¨çš„çª—å£å¯¹è±¡)ï¼Œç„¶å è°ƒç”¨äº†<code> win.openInputChannel(outInputChannel)</code>,è¿™é‡Œçš„ outInputChannel å°±æ˜¯æˆ‘ä»¬å¤–é¢åœ¨ ViewRootImplåˆå§‹åŒ–æ„å»ºçš„ InputChannelï¼Œå³ <code>æ³¨é‡Š34</code> é‚£é‡Œçš„ inputChannelå¯¹è±¡ã€‚</li>
</ul>
<pre><code class="hljs language-java" lang="java">frameworks/base/services/core/java/com/android/server/wm/Session.java
   <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">addToDisplayAsUser</span><span class="hljs-params">(IWindow window, WindowManager.LayoutParams attrs,
            <span class="hljs-type">int</span> viewVisibility, <span class="hljs-type">int</span> displayId, <span class="hljs-type">int</span> userId, <span class="hljs-meta">@InsetsType</span> <span class="hljs-type">int</span> requestedVisibleTypes,
            InputChannel outInputChannel, InsetsState outInsetsState,
            InsetsSourceControl.Array outActiveControls, Rect outAttachedFrame,
            <span class="hljs-type">float</span>[] outSizeCompatScale)</span> {
            <span class="hljs-comment">//è¿™é‡Œçš„mServiceå³ WMS(WindowManagerService)</span>
        <span class="hljs-keyword">return</span> mService.addWindow(<span class="hljs-built_in">this</span>, window, attrs, viewVisibility, displayId, userId,
                requestedVisibleTypes, outInputChannel, outInsetsState, outActiveControls,
                outAttachedFrame, outSizeCompatScale);
    }
    
    
frameworks/base/services/core/java/com/android/server/wm/WindowManagerService.java
<span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">addWindow</span><span class="hljs-params">(Session session, IWindow client, LayoutParams attrs, <span class="hljs-type">int</span> viewVisibility,
            <span class="hljs-type">int</span> displayId, <span class="hljs-type">int</span> requestUserId, <span class="hljs-meta">@InsetsType</span> <span class="hljs-type">int</span> requestedVisibleTypes,
            InputChannel outInputChannel, InsetsState outInsetsState,
            InsetsSourceControl.Array outActiveControls, Rect outAttachedFrame,
            <span class="hljs-type">float</span>[] outSizeCompatScale)</span> {
        outActiveControls.set(<span class="hljs-literal">null</span>, <span class="hljs-literal">false</span> <span class="hljs-comment">/* copyControls */</span>);
        ...
        <span class="hljs-keyword">synchronized</span> (mGlobalLock) {
            ...
            <span class="hljs-keyword">final</span> <span class="hljs-type">WindowState</span> <span class="hljs-variable">win</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WindowState</span>(<span class="hljs-built_in">this</span>, session, client, token, parentWindow,
                    appOp[<span class="hljs-number">0</span>], attrs, viewVisibility, session.mUid, userId,
                    session.mCanAddInternalSystemWindow);
            ....
            <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">openInputChannels</span> <span class="hljs-operator">=</span> (outInputChannel != <span class="hljs-literal">null</span>
                    &amp;&amp; (attrs.inputFeatures &amp; INPUT_FEATURE_NO_INPUT_CHANNEL) == <span class="hljs-number">0</span>);
            <span class="hljs-keyword">if</span>  (openInputChannels) {
                win.openInputChannel(outInputChannel);
            }
            ...
        }
        ...
        <span class="hljs-keyword">return</span> res;
    }

</code></pre>
<p>ç»§ç»­è·Ÿè¿› <code>WindowState.openInputChannel</code>ï¼Œå…³é”®ä»£ç å¦‚ä¸‹</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">frameworks</span>/<span class="hljs-selector-tag">base</span>/<span class="hljs-selector-tag">services</span>/<span class="hljs-selector-tag">core</span>/<span class="hljs-selector-tag">java</span>/<span class="hljs-selector-tag">com</span>/<span class="hljs-selector-tag">android</span>/<span class="hljs-selector-tag">server</span>/<span class="hljs-selector-tag">wm</span>/<span class="hljs-selector-tag">WindowState</span><span class="hljs-selector-class">.java</span>
 <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">openInputChannel</span>(<span class="hljs-variable">@NonNull</span> InputChannel outInputChannel) {
        <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">name</span> = <span class="hljs-selector-tag">getName</span>();
        <span class="hljs-selector-tag">mInputChannel</span> = <span class="hljs-selector-tag">mWmService</span><span class="hljs-selector-class">.mInputManager</span><span class="hljs-selector-class">.createInputChannel</span>(name);<span class="hljs-comment">//æ³¨é‡Š38</span>
        <span class="hljs-selector-tag">mInputChannelToken</span> = <span class="hljs-selector-tag">mInputChannel</span><span class="hljs-selector-class">.getToken</span>();
        <span class="hljs-selector-tag">mInputWindowHandle</span><span class="hljs-selector-class">.setToken</span>(mInputChannelToken);<span class="hljs-comment">//æ³¨é‡Š39</span>
        <span class="hljs-selector-tag">mWmService</span><span class="hljs-selector-class">.mInputToWindowMap</span><span class="hljs-selector-class">.put</span>(mInputChannelToken, this);
        <span class="hljs-selector-tag">mInputChannel</span><span class="hljs-selector-class">.copyTo</span>(outInputChannel);<span class="hljs-comment">//æ³¨é‡Š40</span>
    }
</code></pre>
<ul>
<li><strong>æ³¨é‡Š38</strong> è¿™é‡Œçš„ mInputManager å°±æ˜¯ æˆ‘ä»¬åœ¨ç¬¬äºŒç« èŠ‚ <code>IMSç³»ç»Ÿåˆå§‹åŒ–</code> ä¸­çš„ InputManagerService å¯¹è±¡ï¼Œåˆå§‹åŒ– WMSæ—¶å°±å…³è”äº†IMSï¼ŒIMS.createInputChannel ä¸€æ­¥æ­¥è°ƒç”¨æ¥åˆ° nativeçš„nativeCreateInputChannelï¼Œä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼Œ</li>
</ul>

<pre><code class="hljs language-c" lang="c">frameworks/base/services/core/jni/com_android_server_input_InputManagerService.cpp
<span class="hljs-type">static</span> jobject <span class="hljs-title function_">nativeCreateInputChannel</span><span class="hljs-params">(JNIEnv* env, jobject nativeImplObj, jstring nameObj)</span> {
    NativeInputManager* im = getNativeInputManager(env, nativeImplObj);
    ...
    <span class="hljs-comment">//æ„é€ Native çš„ InputChannel</span>
    base::Result&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;InputChannel&gt;&gt; inputChannel = im-&gt;createInputChannel(name);<span class="hljs-comment">//æ³¨é‡Š41</span>
    
    <span class="hljs-comment">//æ„é€ Javaå±‚çš„ InputChannelï¼Œå¹¶ä¸”å…³è”Native çš„ InputChannel</span>
    jobject inputChannelObj =
            android_view_InputChannel_createJavaObject(env, <span class="hljs-built_in">std</span>::move(*inputChannel));<span class="hljs-comment">//æ³¨é‡Š42</span>
    ...
    <span class="hljs-comment">//æœ€ç»ˆè¿”å›äº† clientChannel ç»™ App åº”ç”¨ç«¯</span>
    <span class="hljs-keyword">return</span> inputChannelObj;<span class="hljs-comment">//æ³¨é‡Š43</span>
}

base::Result&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;InputChannel&gt;&gt; NativeInputManager::createInputChannel(
        <span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; name) {
    ATRACE_CALL();
    <span class="hljs-keyword">return</span> mInputManager-&gt;getDispatcher().createInputChannel(name);<span class="hljs-comment">//æ³¨é‡Š44</span>
}
</code></pre>
<p>çœ‹åˆ°<code>æ³¨é‡Š44</code>è¿™è¡Œä»£ç æ˜¯ä¸æ˜¯æœ‰æŸ³æš—èŠ±æ˜åˆä¸€æ‘çš„æ„Ÿè§‰ï¼Œæˆ‘ä»¬åˆå›åˆ°äº† InputDispatcher äº†ï¼ŒåŸæ¥æ·»åŠ çª—å£æ—¶ä¼šè°ƒç”¨ <code>InputDispatcher::createInputChannel</code> åˆ›å»º InputChannel(å…³è”äº†socket)ï¼Œåˆ°è¿™é‡ŒåŸºæœ¬å°±å¿«å’Œ <code>4.2 InputDispatcher äº‹ä»¶å‡ºåˆ—åˆ†å‘</code> æœ€åçš„çŒœæƒ³å¯¹ä¸Šäº†ã€‚ç»§ç»­è·Ÿè¿› <code>InputDispatcher::createInputChannel</code> å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-c" lang="c">frameworks/native/services/inputflinger/dispatcher/InputDispatcher.cpp
Result&lt;<span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;InputChannel&gt;&gt; InputDispatcher::createInputChannel(<span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; name) {
    

    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;InputChannel&gt; serverChannel;
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;InputChannel&gt; clientChannel;
    <span class="hljs-comment">//åˆ›å»º InputChannel å¯¹ï¼Œä¸€ä¸ªserverï¼Œä¸€ä¸ªclient</span>
    <span class="hljs-type">status_t</span> result = InputChannel::openInputChannelPair(name, serverChannel, clientChannel);<span class="hljs-comment">//æ³¨é‡Š45</span>

   ...

    { <span class="hljs-comment">// acquire lock</span>
        <span class="hljs-built_in">std</span>::scoped_lock _l(mLock);
        <span class="hljs-type">const</span> sp&lt;IBinder&gt;&amp; token = serverChannel-&gt;getConnectionToken();
        <span class="hljs-type">const</span> <span class="hljs-type">int</span> fd = serverChannel-&gt;getFd();
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;Connection&gt; connection =
                <span class="hljs-built_in">std</span>::make_shared&lt;Connection&gt;(<span class="hljs-built_in">std</span>::move(serverChannel), <span class="hljs-comment">/*monitor=*/</span><span class="hljs-literal">false</span>,
                                             mIdGenerator);
                                             
        <span class="hljs-comment">//æ·»åŠ  token å’ŒserverClient åˆ° mConnectionsByTokenï¼Œè¿™æ · InputDispatcher åˆ†å‘äº‹ä»¶å°±çŸ¥é“ ç”¨å“ªä¸ª serverClient äº†</span>
        <span class="hljs-keyword">auto</span> [_, inserted] = mConnectionsByToken.try_emplace(token, connection);<span class="hljs-comment">// æ³¨é‡Š46</span>
       
       ...

        <span class="hljs-built_in">std</span>::function&lt;<span class="hljs-type">int</span>(<span class="hljs-type">int</span> events)&gt; callback = <span class="hljs-built_in">std</span>::bind(&amp;InputDispatcher::handleReceiveCallback,
                                                            this, <span class="hljs-built_in">std</span>::placeholders::_1, token);
        
        <span class="hljs-comment">//æ·»åŠ  serverCleint çš„ socketFd ç›‘å¬ï¼Œç›‘å¬æœ‰æ•°æ®å†™å…¥(å³clientServerå†™å‡ºæ•°æ®)æ—¶ï¼Œ</span>
        <span class="hljs-comment">//ä¼šè°ƒç”¨InputDispatcher::handleReceiveCallback,è¿™ä¸ªåœ¨åé¢çš„ç¬¬6ç« èŠ‚å’Œç¬¬7ç« èŠ‚ä¼šé‡ç‚¹åˆ†æ</span>
        mLooper-&gt;addFd(fd, <span class="hljs-number">0</span>, ALOOPER_EVENT_INPUT, sp&lt;LooperEventCallback&gt;::make(callback),
                       nullptr);<span class="hljs-comment">//æ³¨é‡Š47</span>
    } <span class="hljs-comment">// release lock</span>

    <span class="hljs-comment">// Wake the looper because some connections have changed.</span>
    mLooper-&gt;wake();
    
    <span class="hljs-keyword">return</span> clientChannel;
}


frameworks/native/libs/input/InputTransport.cpp
<span class="hljs-type">status_t</span> <span class="hljs-title function_">InputChannel::openInputChannelPair</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>&amp; name,
                                            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;InputChannel&gt;&amp; outServerChannel,
                                            <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;InputChannel&gt;&amp; outClientChannel)</span> {
    <span class="hljs-type">int</span> sockets[<span class="hljs-number">2</span>];
    <span class="hljs-comment">//åˆ›å»ºsocketå¯¹</span>
    <span class="hljs-keyword">if</span> (socketpair(AF_UNIX, SOCK_SEQPACKET, <span class="hljs-number">0</span>, sockets)) {<span class="hljs-comment">//æ³¨é‡Š48</span>
        <span class="hljs-type">status_t</span> result = -errno;
        ALOGE(<span class="hljs-string">"channel '%s' ~ Could not create socket pair.  errno=%s(%d)"</span>, name.c_str(),
              strerror(errno), errno);
        outServerChannel.reset();
        outClientChannel.reset();
        <span class="hljs-keyword">return</span> result;
    }

    <span class="hljs-type">int</span> bufferSize = SOCKET_BUFFER_SIZE;
    setsockopt(sockets[<span class="hljs-number">0</span>], SOL_SOCKET, SO_SNDBUF, &amp;bufferSize, <span class="hljs-keyword">sizeof</span>(bufferSize));
    setsockopt(sockets[<span class="hljs-number">0</span>], SOL_SOCKET, SO_RCVBUF, &amp;bufferSize, <span class="hljs-keyword">sizeof</span>(bufferSize));
    setsockopt(sockets[<span class="hljs-number">1</span>], SOL_SOCKET, SO_SNDBUF, &amp;bufferSize, <span class="hljs-keyword">sizeof</span>(bufferSize));
    setsockopt(sockets[<span class="hljs-number">1</span>], SOL_SOCKET, SO_RCVBUF, &amp;bufferSize, <span class="hljs-keyword">sizeof</span>(bufferSize));

    sp&lt;IBinder&gt; token = sp&lt;BBinder&gt;::make();

    android::base::unique_fd <span class="hljs-title function_">serverFd</span><span class="hljs-params">(sockets[<span class="hljs-number">0</span>])</span>;
    <span class="hljs-comment">//serverChannel å…³è” serverSocket</span>
    outServerChannel = InputChannel::create(name, <span class="hljs-built_in">std</span>::move(serverFd), token);<span class="hljs-comment">//æ³¨é‡Š49</span>

    android::base::unique_fd <span class="hljs-title function_">clientFd</span><span class="hljs-params">(sockets[<span class="hljs-number">1</span>])</span>;
    <span class="hljs-comment">//clientChannel å…³è” cleintSocket</span>
    outClientChannel = InputChannel::create(name, <span class="hljs-built_in">std</span>::move(clientFd), token);<span class="hljs-comment">//æ³¨é‡Š50</span>
    <span class="hljs-keyword">return</span> OK;
}
</code></pre>
<ul>
<li>
<p><strong>æ³¨é‡Š45</strong> é€šè¿‡ <code>æ³¨é‡Š48</code> åˆ›å»ºäº†socketå¯¹ï¼Œå¹¶é€šè¿‡<code>æ³¨é‡Š49</code>æŠŠ serverInputChannel å…³è”åˆ° serverSocketï¼Œé€šè¿‡<code>æ³¨é‡Š50</code>æŠŠclientInputChannelå…³è”åˆ°cleintSocketã€‚è¿™æ ·å°±å®Œæˆäº†serverInputChannelå’ŒclientInputChannelçš„åˆ›å»ºä»¥åŠå…³ç³»ç»‘å®š.</p>
</li>
<li>
<p><strong>æ³¨é‡Š46</strong> å°†serverChannelå’Œtoken æ·»åŠ åˆ° mConnectionsByToken é›†åˆä¸­ï¼Œç„¶ååœ¨<code>4.2 InputDispatcher äº‹ä»¶å‡ºåˆ—åˆ†å‘</code> ä¸­ <code>æ³¨é‡Š30</code> å¤„çš„ <code>findTouchedWindowTargetsLocked</code> ä¼šæ ¹æ® çª—å£çš„token æ‰¾åˆ°å¯¹åº”çš„ serverInputChannel,å°† äº‹ä»¶ã€çª—å£ã€InputChannel(socket)å¯¹ ä¸‰è€…å…³è”ä¸Šï¼Œè¿™æ ·æœ€å <code>æ³¨é‡Š33</code>å¤„è°ƒç”¨socketå‘é€äº‹ä»¶å°±èƒ½å‘é€åˆ°å¯¹åº”çš„çª—å£äº†ã€‚<code>findTouchedWindowTargetsLocked</code> çš„é€»è¾‘å°±ä¸å±•å¼€åˆ†æï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œè·Ÿè¿›æºç éªŒè¯ã€‚</p>
</li>
<li>
<p><strong>æ³¨é‡Š47</strong> è¿™é‡Œæ˜¯å°† serverInputChannelçš„socketçš„fdçš„è¾“å…¥äº‹ä»¶ALOOPER_EVENT_INPUTæ·»åŠ åˆ°mLooperçš„ç›‘å¬ä¸­ï¼Œè¿™æ ·å½“ clientInputChannelçš„ socket å†™å…¥æ•°æ®æ—¶ï¼Œå°±ä¼šå”¤é†’è¿™é‡Œçš„ handleReceiveCallbackï¼Œåœ¨ ç¬¬å…­ã€ä¸ƒç« èŠ‚ä¼šé‡ç‚¹åˆ†æè¿™é‡Œã€‚</p>
</li>
<li>
<p><strong>æ³¨é‡Š41</strong> åˆ°è¿™é‡ŒåŸºæœ¬ç®—å®Œæˆäº†Nativeå±‚çš„InputChannelçš„åˆ›å»ºå’Œåˆå§‹åŒ–</p>
</li>
<li>
<p><strong>æ³¨é‡Š42</strong> åˆ›å»ºJavaå±‚çš„InputChannelå¹¶å…³è”InputDispatcherè¿”å›çš„Nativeå±‚InputChannel,è¯¦ç»†é€»è¾‘å¦‚ä¸‹</p>
</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">frameworks/base/core/jni/android_view_InputChannel.cpp
jobject android_view_InputChannel_createJavaObject(JNIEnv* env,
                                                   std::unique_ptr&lt;InputChannel&gt; inputChannel) {
    std::string <span class="hljs-attr">name</span> = inputChannel-&gt;getName()<span class="hljs-comment">;</span>
    //å°†InputDispatcherè¿”å›çš„ Nativeå±‚çš„InputChannelå°è£…æˆ NativeInputChannel
    jlong <span class="hljs-attr">ptr</span> = android_view_InputChannel_createInputChannel(env, std::move(inputChannel))<span class="hljs-comment">;</span>
    
    //<span class="hljs-attr">gInputChannelClassInfo.clazz</span> = <span class="hljs-string">"android/view/InputChannel"</span>
    //<span class="hljs-attr">gInputChannelClassInfo.mCtor</span> = <span class="hljs-string">"&lt;init&gt;"</span>
    //è¿™é‡Œå°±æ˜¯è°ƒç”¨äº†Javaå±‚ InputChannel çš„æ„é€ å‡½æ•°æ„é€ äº† InputChannel å¯¹è±¡
    jobject <span class="hljs-attr">javaInputChannel</span> =
            env-&gt;NewObject(gInputChannelClassInfo.clazz, gInputChannelClassInfo.mCtor)<span class="hljs-comment">;</span>
    if (!javaInputChannel) {
        ALOGE("Failed to create a Java InputChannel for channel %s.", name.c_str())<span class="hljs-comment">;</span>
        return nullptr<span class="hljs-comment">;</span>
    }
    
    //<span class="hljs-attr">gInputChannelClassInfo.mSetNativeInputChannel</span> = <span class="hljs-string">"setNativeInputChannel"</span>
    //è°ƒç”¨Javaå±‚çš„ InputChannel.mPtrçš„ setNativeInputChannel å°†Nativeå±‚çš„ NativeInputChannel çš„å¼•ç”¨åœ°å€ä¼ é€’ç»™ Javaå±‚çš„ InputChannel.mPtr
    env-&gt;CallVoidMethod(javaInputChannel, gInputChannelClassInfo.mSetNativeInputChannel, ptr)<span class="hljs-comment">;</span>
    if (env-&gt;ExceptionOccurred()) {
        ALOGE("Failed to set native ptr to the Java InputChannel for channel %s.",
              inputChannel-&gt;getName().c_str())<span class="hljs-comment">;</span>
        return nullptr<span class="hljs-comment">;</span>
    }
    return javaInputChannel<span class="hljs-comment">;</span>
}

</code></pre>
<ul>
<li><strong>æ³¨é‡Š43</strong> è¿”å›Javaç«¯çš„ InputChannel(å…³è”äº†Nativeçš„InputChannel)ç»™Appã€‚</li>
</ul>
<p>å†å›åˆ°å‰é¢çš„<code>æ³¨é‡Š38</code>ï¼Œè¿™é‡Œå°†IMSåˆšåˆ›å»º çš„ InputChannelå…³è”çš„Nativeçš„InputChannel åˆä¼ é€’ ViewRootImplçª—å£æ·»åŠ æ—¶åˆ›å»ºçš„InputChannelï¼Œ
è¿™æ ·ViewRootImpl çª—å£æ·»åŠ setViewæ—¶åˆ›å»ºçš„InputChannelå°±èƒ½å…³è”åˆ°InputDispatcheråˆ›å»ºçš„clientInputChannel(å…³è”äº†cleintSocket)ã€‚åˆ°è¿™é‡Œï¼ŒåŸºæœ¬å®Œæˆäº†InputChannelåˆ›å»ºå’Œåˆå§‹åŒ–ä»¥åŠå…³è”Serverçš„é€»è¾‘ã€‚</p>
<p>ç›®å‰Appçª—å£ç«¯å·²ç»æ‹¿åˆ°äº†å…³è”Serverç«¯çš„InputChannel(socket), æ¥ä¸‹æ¥ç»§ç»­åˆ†æAppç«¯æ˜¯å¦‚ä½•ç›‘å¬è¿™ä¸ªsocketè¯»å–äº‹ä»¶å¹¶ä¸”åˆ†å‘åˆ°View/Activityçš„ã€‚</p>
<h3 data-id="heading-2">5.2 APP çª—å£æ¥å—äº‹ä»¶</h3>
<p>ç»§ç»­å›åˆ°ViewRootImplçš„setViewï¼Œä¸Šé¢åˆ†æäº†<code>æ³¨é‡Š35</code>æ˜¯å¦‚ä½•æ„é€ InputChannelå¹¶å…³è”åˆ°InputDispatcherä¸­çš„clientSocketã€‚</p>
<ul>
<li><strong>æ³¨é‡Š36</strong> åˆå§‹åŒ–InputEventReceiver,ä¼ å…¥äº†ä¸Šé¢åˆå§‹åŒ–çš„InputChannelå’ŒAppä¸»çº¿ç¨‹çš„Looperï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</li>
</ul>

<pre><code class="hljs language-scss" lang="scss">frameworks/base/core/java/android/view/InputEventReceiver<span class="hljs-selector-class">.java</span>
public <span class="hljs-built_in">InputEventReceiver</span>(InputChannel inputChannel, Looper looper) {
    ...
    mInputChannel = inputChannel;
    mMessageQueue = looper<span class="hljs-selector-class">.getQueue</span>();
    mReceiverPtr = <span class="hljs-built_in">nativeInit</span>(new WeakReference&lt;InputEventReceiver&gt;(this),
            mInputChannel, mMessageQueue);
    ...
}


frameworks/base/core/jni/android_view_InputEventReceiver<span class="hljs-selector-class">.cpp</span>
static jlong <span class="hljs-built_in">nativeInit</span>(JNIEnv* env, jclass clazz, jobject receiverWeak,
        jobject inputChannelObj, jobject messageQueueObj) {
    <span class="hljs-comment">//è·å–Javaå±‚InputChannel.mPtr å¼•ç”¨,å³Nativeå±‚çš„InputChannel çš„å¼•ç”¨</span>
    std::shared_ptr&lt;InputChannel&gt; inputChannel =
            <span class="hljs-built_in">android_view_InputChannel_getInputChannel</span>(env, inputChannelObj);
    
    <span class="hljs-comment">//è·å–Javaå±‚MessageQueue.mPtr,å³Nativeå±‚çš„MessageQueue çš„å¼•ç”¨</span>
    sp&lt;MessageQueue&gt; messageQueue = <span class="hljs-built_in">android_os_MessageQueue_getMessageQueue</span>(env, messageQueueObj);
    

    sp&lt;NativeInputEventReceiver&gt; receiver = new <span class="hljs-built_in">NativeInputEventReceiver</span>(env,
            receiverWeak, inputChannel, messageQueue);
    <span class="hljs-comment">//åˆå§‹åŒ–</span>
    status_t status = receiver-&gt;<span class="hljs-built_in">initialize</span>();
    
    return reinterpret_cast&lt;jlong&gt;(receiver.get());
}

status_t NativeInputEventReceiver::<span class="hljs-built_in">initialize</span>() {
    <span class="hljs-built_in">setFdEvents</span>(ALOOPER_EVENT_INPUT);
    return OK;
}

void NativeInputEventReceiver::<span class="hljs-built_in">setFdEvents</span>(int events) {
    if (mFdEvents != events) {
        mFdEvents = events;
        const int fd = mInputConsumer<span class="hljs-selector-class">.getChannel</span>()-&gt;<span class="hljs-built_in">getFd</span>();
        if (events) {
            <span class="hljs-comment">//Android ä¸»çº¿ç¨‹çš„ Looper æ·»åŠ å¯¹ InputChannel çš„ socketçš„fdçš„ç›‘å¬</span>
            mMessageQueue-&gt;<span class="hljs-built_in">getLooper</span>()-&gt;<span class="hljs-built_in">addFd</span>(fd, <span class="hljs-number">0</span>, events, this, nullptr);<span class="hljs-comment">//æ³¨é‡Š51</span>
        } else {
            mMessageQueue-&gt;<span class="hljs-built_in">getLooper</span>()-&gt;<span class="hljs-built_in">removeFd</span>(fd);
        }
    }
}
</code></pre>
<ul>
<li><strong>æ³¨é‡Š51</strong> åˆ›å»ºInputEventReceiverçš„æ—¶å€™è°ƒç”¨äº†nativeInitåˆå§‹åŒ–æ–¹æ³•ï¼Œæœ€ç»ˆé€šè¿‡ <code>NativeInputEventReceiver::initialize()</code> è°ƒç”¨äº†<code>Looper::addFd</code>ï¼Œæ ¹æ®ä¹‹å‰çš„ä¼ å‚ï¼Œè¿™é‡Œä¾¿å®ŒæˆAppä¸»çº¿ç¨‹Nativeå±‚Looperå¯¹Nativeå±‚çš„clientInputChannelä¸­çš„socketçš„fdçš„ç›‘å¬ï¼Œå½“InputDispatcherä¸­åœ¨<code>æ³¨é‡Š33</code>å¤„è°ƒç”¨serverSocketå‘åŠ¨æ¶ˆæ¯æ—¶ï¼ŒAppä¸»çº¿ç¨‹çš„Nativeçš„Looperå°±ä¼šè¢«å”¤é†’ï¼Œè°ƒç”¨å›è°ƒ<code>handleEvent</code>å¼€å§‹äº‹ä»¶çš„åˆ†å‘.</li>
</ul>
<h3 data-id="heading-3">5.3 APP çª—å£åˆ†å‘äº‹ä»¶åˆ°View/Activity</h3>
<p>è¾“å…¥äº‹ä»¶çš„åˆ†å‘å…¥å£ä¸º <code> NativeInputEventReceiver::handleEvent</code>,æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æäº‹ä»¶æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥ä¼ é€’åˆ°View/Activityçš„ã€‚handleEvent æ¥å—åˆ°äº‹ä»¶åˆ†å‘æ—¶ä¹Ÿä¼š ç»è¿‡å¾ˆå¤šæ¡ä»¶åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰§è¡Œï¼Œæ˜¯ç«‹å³æ‰§è¡Œè¿˜æ˜¯å»¶è¿Ÿæ‰§è¡Œï¼Œè¿™é‡Œè¿˜æ˜¯çœ‹å…³é”®ä»£ç æ¥åˆ†æä¸»æµç¨‹ï¼Œè¿™é‡Œè¿˜æ˜¯ä»¥å¸¸è§çš„è§¦æ‘¸äº‹ä»¶ä¸ºä¾‹è¿›è¡Œåˆ†æï¼Œéƒ¨åˆ†å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">frameworks/base/core/jni/android_view_InputEventReceiver<span class="hljs-selector-class">.cpp</span>
int NativeInputEventReceiver::<span class="hljs-built_in">handleEvent</span>(int receiveFd, int events, void* data) {
   ...
    if (events &amp; ALOOPER_EVENT_INPUT) {
        JNIEnv* env = AndroidRuntime::<span class="hljs-built_in">getJNIEnv</span>();
        <span class="hljs-comment">//æ¶ˆè´¹äº‹ä»¶</span>
        status_t status = <span class="hljs-built_in">consumeEvents</span>(env, /*consumeBatches=*/false, -<span class="hljs-number">1</span>, nullptr);<span class="hljs-comment">//æ³¨é‡Š52</span>
        return status == OK || status == NO_MEMORY ? KEEP_CALLBACK : REMOVE_CALLBACK;
    }
   ...
    return KEEP_CALLBACK;
}

status_t NativeInputEventReceiver::<span class="hljs-built_in">consumeEvents</span>(JNIEnv* env,
        bool consumeBatches, nsecs_t frameTime, bool* outConsumedBatch) {
    ...
    ScopedLocalRef&lt;jobject&gt; <span class="hljs-built_in">receiverObj</span>(env, nullptr);
    bool skipCallbacks = false;
    for (;;) {
        uint32_t seq;
        InputEvent* inputEvent;
         <span class="hljs-comment">// è¯»å–äº‹ä»¶</span>
        status_t status = mInputConsumer<span class="hljs-selector-class">.consume</span>(&amp;mInputEventFactory,
                consumeBatches, frameTime, &amp;seq, &amp;inputEvent);<span class="hljs-comment">//æ³¨é‡Š53</span>
        ...

        if (!skipCallbacks) {
            ...
            ScopedLocalRef&lt;jobject&gt; <span class="hljs-built_in">inputEventObj</span>(env);
            switch (inputEvent-&gt;getType()) {
                ...
                case InputEventType::MOTION: {
                    ...
                    <span class="hljs-comment">// å°†Nativeå±‚ çš„ MotionEvent ä¼ é€’ç»™ Java å±‚ çš„ MotionEvent</span>
                    inputEventObj = <span class="hljs-built_in">android_view_MotionEvent_obtainAsCopy</span>(env, motionEvent);<span class="hljs-comment">//æ³¨é‡Š54</span>
                    break;
                }
                ....
            }
            ...
            if (inputEventObj.get()) {
                ...
                <span class="hljs-comment">//è°ƒç”¨Java å±‚ InputEventReceiver.dispatchInputEvent</span>
                env-&gt;<span class="hljs-built_in">CallVoidMethod</span>(receiverObj.get(),
                                    gInputEventReceiverClassInfo<span class="hljs-selector-class">.dispatchInputEvent</span>, seq,
                                    inputEventObj<span class="hljs-selector-class">.get</span>());<span class="hljs-comment">//æ³¨é‡Š55</span>
            } else {
               ...
            }
        }
    }
}


frameworks/native/libs/<span class="hljs-selector-tag">input</span>/InputConsumer<span class="hljs-selector-class">.cpp</span>
status_t InputConsumer::<span class="hljs-built_in">consume</span>(InputEventFactoryInterface* factory, bool consumeBatches,
                                nsecs_t frameTime, uint32_t* outSeq, InputEvent** outEvent) {
    <span class="hljs-built_in">ALOGD_IF</span>(DEBUG_TRANSPORT_CONSUMER,
             "channel '%s' consumer ~ consume: consumeBatches=%s, frameTime=%" PRId64,
             mChannel-&gt;getName()<span class="hljs-selector-class">.c_str</span>(), <span class="hljs-built_in">toString</span>(consumeBatches), frameTime);

    *outSeq = <span class="hljs-number">0</span>;
    *outEvent = nullptr;

    ...
    while (!*outEvent) {
        if (mMsgDeferred) {
           ...
        } else {
            <span class="hljs-comment">// Receive a fresh message.</span>
            android::base::Result&lt;InputMessage&gt; result = mChannel-&gt;<span class="hljs-built_in">receiveMessage</span>();<span class="hljs-comment">//æ³¨é‡Š56</span>
            if (result.ok()) {
                mMsg = std::<span class="hljs-built_in">move</span>(result.<span class="hljs-built_in">value</span>());
                <span class="hljs-comment">//å¾€é˜Ÿåˆ—ä¸­æ·»åŠ äº‹ä»¶</span>
                const auto <span class="hljs-selector-attr">[_, inserted]</span> =
                        mConsumeTimes<span class="hljs-selector-class">.emplace</span>(mMsg.header.seq, systemTime(SYSTEM_TIME_MONOTONIC));
                ...
            } else {
                ...
            }
        }

        switch (mMsg.header.type) {
            ....
            case InputMessage::Type::MOTION: {
                ssize_t batchIndex = <span class="hljs-built_in">findBatch</span>(mMsg.body.motion.deviceId, mMsg.body.motion.source);
                if (batchIndex &gt;= <span class="hljs-number">0</span>) {
                    Batch&amp; batch = mBatches<span class="hljs-selector-attr">[batchIndex]</span>;
                    if (canAddSample(batch, &amp;mMsg)) {
                        batch<span class="hljs-selector-class">.samples</span><span class="hljs-selector-class">.push_back</span>(mMsg);
                        break;
                    } 
                }
                ....
                <span class="hljs-comment">//åˆ›å»ºäº‹ä»¶ MotionEvent</span>
                MotionEvent* motionEvent = factory-&gt;<span class="hljs-built_in">createMotionEvent</span>();
                if (!motionEvent) return NO_MEMORY;

                <span class="hljs-built_in">updateTouchState</span>(mMsg);
                <span class="hljs-comment">//åˆå§‹åŒ–äº‹ä»¶</span>
                <span class="hljs-built_in">initializeMotionEvent</span>(*motionEvent, mMsg);<span class="hljs-comment">//æ³¨é‡Š57</span>
                *outSeq = mMsg<span class="hljs-selector-class">.header</span><span class="hljs-selector-class">.seq</span>;
                *outEvent = motionEvent;
                
                break;
            }
            ...
        }
    }
    return OK;
}
</code></pre>
<p>è¿™é‡Œä¹Ÿæ¶‰åŠåˆ°å¾ˆå¤šäº‹ä»¶æ¶ˆæ¯çš„å…¥åˆ—å’Œå‡ºåˆ—é€»è¾‘ï¼Œè¿˜æœ‰ä¸€äº›æ‹¦æˆªä»¥åŠå¼‚å¸¸å¤„ç†æµç¨‹ï¼Œæˆ‘ä»¬ç›´æ¥è·³è¿‡ã€‚</p>
<ul>
<li><strong>æ³¨é‡Š56</strong> ä»cleintSocketä¸­è¯»å–InputDispatcherä¸­çš„serverSocketå‘é€çš„äº‹ä»¶æ•°æ®</li>
<li><strong>æ³¨é‡Š57</strong> åˆå§‹åŒ–å’Œç»„è£…è¯»å–åˆ°çš„äº‹ä»¶æ¶ˆæ¯åˆ°MotionEventä¸­</li>
<li><strong>æ³¨é‡Š54</strong> å°†Nativeå±‚ çš„ MotionEvent ä¼ é€’ç»™ Java å±‚ çš„ MotionEvent</li>
<li><strong>æ³¨é‡Š55</strong> è°ƒç”¨Java å±‚ InputEventReceiver.dispatchInputEventï¼ŒNativeå±‚è°ƒç”¨Javaå±‚é€»è¾‘å’Œä¸Šé¢çš„<code>æ³¨é‡Š42</code> çš„ å­æµç¨‹å¾ˆç±»ä¼¼ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå»åˆ†æã€‚</li>
</ul>
<p>è¿™æ ·ç»è¿‡ äº‹ä»¶ä¹Ÿæ˜¯ç»è¿‡äº†è¯»å–ã€ç»„è£…ã€åˆ†å‘çš„æµç¨‹ï¼Œè·ŸInputFlinger(InputReader/InputDispatcher/EventHub)ä¸­çš„æµç¨‹åŸºæœ¬ç±»ä¼¼ï¼Œåªæ˜¯è¿‡ç¨‹çš„ç¹ç®€ã€‚æ¥ä¸‹æ¥çœ‹ä¸‹Javaå±‚çš„äº‹ä»¶ä¼ é€’æµç¨‹ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">frameworks/<span class="hljs-keyword">base</span>/core/java/android/view/InputEventReceiver.java
<span class="hljs-comment">// Called from native code.</span>
@SuppressWarnings(<span class="hljs-string">"unused"</span>)
@UnsupportedAppUsage(maxTargetSdk = Build.VERSION_CODES.R, trackingBug = <span class="hljs-number">170729553</span>)
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dispatchInputEvent</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> seq, InputEvent <span class="hljs-keyword">event</span></span>)</span> {
    ...
    onInputEvent(<span class="hljs-keyword">event</span>);
    ...
}


@UnsupportedAppUsage(maxTargetSdk = Build.VERSION_CODES.R, trackingBug = <span class="hljs-number">170729553</span>)
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onInputEvent</span>(<span class="hljs-params">InputEvent <span class="hljs-keyword">event</span></span>)</span> {
    finishInputEvent(<span class="hljs-keyword">event</span>, <span class="hljs-literal">false</span>);
}
</code></pre>
<p><code>InputEventReceiver.dispatchInputEvent</code>æ–¹æ³•ç›´æ¥è°ƒç”¨ onInputEventï¼ŒonInputEventçš„é»˜è®¤æ˜¯ç°å® finishInputEventï¼Œè€Œæˆ‘ä»¬ åœ¨ ViewRootImplä¸­åˆå§‹åŒ–æ„é€ çš„æ˜¯ WindowInputEventReceiver(<code>æ³¨é‡Š36</code>)ï¼Œ
WindowInputEventReceiverçš„å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">frameworks/base/core/java/android/view/ViewRootImpl<span class="hljs-selector-class">.java</span>
final class WindowInputEventReceiver extends InputEventReceiver {
    ...
    <span class="hljs-keyword">@Override</span>
    public void onInputEvent(InputEvent event) {
        Trace<span class="hljs-selector-class">.traceBegin</span>(Trace.TRACE_TAG_VIEW, "processInputEventForCompatibility");
        List&lt;InputEvent&gt; processedEvents;
        try {
            processedEvents =
                mInputCompatProcessor<span class="hljs-selector-class">.processInputEventForCompatibility</span>(event);
        } finally {
            Trace<span class="hljs-selector-class">.traceEnd</span>(Trace.TRACE_TAG_VIEW);
        }
        if (processedEvents != null) {
            if (processedEvents.isEmpty()) {
                <span class="hljs-comment">// InputEvent consumed by mInputCompatProcessor</span>
                <span class="hljs-built_in">finishInputEvent</span>(event, true);
            } else {
                for (int i = <span class="hljs-number">0</span>; i &lt; processedEvents.size(); <span class="hljs-selector-tag">i</span>++) {
                    <span class="hljs-comment">//äº‹ä»¶å…¥åˆ—</span>
                    <span class="hljs-built_in">enqueueInputEvent</span>(
                            processedEvents.get(i), this,
                            QueuedInputEvent<span class="hljs-selector-class">.FLAG_MODIFIED_FOR_COMPATIBILITY</span>, true);
                }
            }
        } else {
            <span class="hljs-built_in">enqueueInputEvent</span>(event, this, <span class="hljs-number">0</span>, true);
        }
    }
    ...
}

 QueuedInputEvent <span class="hljs-built_in">enqueueInputEvent</span>(InputEvent event,
            InputEventReceiver receiver, int flags, boolean processImmediately) {
        QueuedInputEvent <span class="hljs-selector-tag">q</span> = <span class="hljs-built_in">obtainQueuedInputEvent</span>(event, receiver, flags);
        ...
        if (processImmediately) {
            <span class="hljs-built_in">doProcessInputEvents</span>();
        } else {
            <span class="hljs-comment">//å¼‚æ­¥å¤„ç†ï¼Œæœ€ç»ˆè¿˜æ˜¯ è°ƒç”¨  doProcessInputEvents</span>
            <span class="hljs-built_in">scheduleProcessInputEvents</span>();
        }
        return <span class="hljs-selector-tag">q</span>;
    }
void <span class="hljs-built_in">doProcessInputEvents</span>() {
    <span class="hljs-comment">// Deliver all pending input events in the queue.</span>
    while (mPendingInputEventHead != null) {
        ...
        <span class="hljs-comment">//ä¼ é€’äº‹ä»¶</span>
        <span class="hljs-built_in">deliverInputEvent</span>(q);
    }
    ...
}

 private void <span class="hljs-built_in">deliverInputEvent</span>(QueuedInputEvent q) {
    ...
    try {
        ...
        if (stage != null) {
            <span class="hljs-built_in">handleWindowFocusChanged</span>();
            <span class="hljs-comment">//ä¼ é€’äº‹ä»¶</span>
            stage<span class="hljs-selector-class">.deliver</span>(q);
        } else {
            <span class="hljs-built_in">finishInputEvent</span>(q);
        }
    } finally {
    }
}

 public final void <span class="hljs-built_in">deliver</span>(QueuedInputEvent q) {
            if ((q.mFlags &amp; QueuedInputEvent.FLAG_FINISHED) != <span class="hljs-number">0</span>) {
                <span class="hljs-built_in">forward</span>(q);
            } else if (shouldDropInputEvent(q)) {
                <span class="hljs-built_in">finish</span>(q, false);
            } else {
                <span class="hljs-built_in">traceEvent</span>(q, Trace.TRACE_TAG_VIEW);
                final int result;
                try {
                    <span class="hljs-comment">//å¤„ç†äº‹ä»¶</span>
                    result = <span class="hljs-built_in">onProcess</span>(q);<span class="hljs-comment">//æ³¨é‡Š58</span>
                } finally {
                    Trace<span class="hljs-selector-class">.traceEnd</span>(Trace.TRACE_TAG_VIEW);
                }
                <span class="hljs-built_in">apply</span>(q, result);
            }
        }
</code></pre>
<p>æ‹¿åˆ°äº‹ä»¶åä¹Ÿè¿˜æ˜¯è¦ç»å†å…¥åˆ—ï¼Œå‡ºåˆ—ï¼Œè¿‡æ»¤ç­‰åˆ¤æ–­ï¼Œæœ€ååˆ°<code>æ³¨é‡Š58</code></p>
<ul>
<li><strong>æ³¨é‡Š58</strong> InputState.onProcess å¤„ç†äº‹ä»¶ï¼Œç”±å­ç±»å»å®ç°ï¼Œå­ç±»å†³å®šæ˜¯ä¼ é€’äº‹ä»¶ï¼Œå¤„ç†äº‹ä»¶è¿˜æ˜¯ç»“æŸäº‹ä»¶ã€‚InputState çš„å­ç±»æœ‰å¥½å‡ ä¸ªï¼Œåˆå§‹åŒ–åœ¨setViewä¸­çš„ <code>æ³¨é‡Š37</code></li>
<li><strong>æ³¨é‡Š37</strong> setViewæ—¶åˆå§‹åŒ–äº†å¥½å¤šä¸ªäº‹ä»¶å¤„ç†å™¨InputStateç®¡çº¿ï¼Œä¸²è¡Œå¤„ç†ï¼Œä»åå¾€å‰ä¼ é€’ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ†æä¸‹è§¦æ‘¸äº‹ä»¶çš„å¤„ç†å™¨  ViewPostImeInputStage,å…³é”®ä»£ç å¦‚ä¸‹ï¼š</li>
</ul>
<pre><code class="hljs language-java" lang="java">frameworks/base/core/java/android/view/ViewRootImpl.java
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewPostImeInputStage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputStage</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ViewPostImeInputStage</span><span class="hljs-params">(InputStage next)</span> {
        <span class="hljs-built_in">super</span>(next);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-type">int</span> <span class="hljs-title function_">onProcess</span><span class="hljs-params">(QueuedInputEvent q)</span> {
        <span class="hljs-keyword">if</span> (q.mEvent <span class="hljs-keyword">instanceof</span> KeyEvent) {
            <span class="hljs-keyword">return</span> processKeyEvent(q);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">source</span> <span class="hljs-operator">=</span> q.mEvent.getSource();
            <span class="hljs-keyword">if</span> ((source &amp; InputDevice.SOURCE_CLASS_POINTER) != <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> processPointerEvent(q);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((source &amp; InputDevice.SOURCE_CLASS_TRACKBALL) != <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> processTrackballEvent(q);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> processGenericMotionEvent(q);
            }
        }
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">processPointerEvent</span><span class="hljs-params">(QueuedInputEvent q)</span> {
        <span class="hljs-keyword">final</span> <span class="hljs-type">MotionEvent</span> <span class="hljs-variable">event</span> <span class="hljs-operator">=</span> (MotionEvent)q.mEvent;
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">action</span> <span class="hljs-operator">=</span> event.getAction();
        ...
        <span class="hljs-comment">// to the view tree.</span>
        <span class="hljs-comment">//åˆ†å‘åˆ° View æ ‘</span>
        handled = handled || mView.dispatchPointerEvent(event);<span class="hljs-comment">//æ³¨é‡Š59</span>
        ...
        <span class="hljs-keyword">return</span> handled ? FINISH_HANDLED : FORWARD;
    }
}


frameworks/base/core/java/android/view/View.java
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">dispatchPointerEvent</span><span class="hljs-params">(MotionEvent event)</span> {
    <span class="hljs-keyword">if</span> (event.isTouchEvent()) {
        <span class="hljs-keyword">return</span> dispatchTouchEvent(event);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> dispatchGenericMotionEvent(event);
    }
}

frameworks/base/core/java/com/android/internal/policy/DecorView.java
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">dispatchTouchEvent</span><span class="hljs-params">(MotionEvent ev)</span> {
    <span class="hljs-keyword">final</span> Window.<span class="hljs-type">Callback</span> <span class="hljs-variable">cb</span> <span class="hljs-operator">=</span> mWindow.getCallback();
    <span class="hljs-comment">//ä¼ é€’ç»™Activity</span>
    <span class="hljs-keyword">return</span> cb != <span class="hljs-literal">null</span> &amp;&amp; !mWindow.isDestroyed() &amp;&amp; mFeatureId &lt; <span class="hljs-number">0</span>
            ? cb.dispatchTouchEvent(ev) : <span class="hljs-built_in">super</span>.dispatchTouchEvent(ev);
}

</code></pre>
<ul>
<li><strong>æ³¨é‡Š59</strong> åˆ°è¿™é‡Œä»EventHubè¯»å–åˆ°çš„äº‹ä»¶ç»socketéä¼ é€’åˆ°æˆ‘ä»¬çš„mView(DecorView), ç„¶åå†è°ƒç”¨åˆ°<code>DecorView.dispatchTouchEvent</code> è¿™é‡Œå°±ä¼šåˆ° <code>Activity.dispatchTouchEvent</code>,åé¢å°±æ˜¯App çª—å£çš„äº‹ä»¶ä¼ é€’æµç¨‹ï¼Œè¿™ä¸€å—å¤§å®¶åº”è¯¥éƒ½å¾ˆç†Ÿæ‚‰ï¼Œå°±ä¸åœ¨è¿™é‡Œèµ˜è¿°äº†ã€‚</li>
</ul>
<p>è‡³æ­¤ï¼ŒInputDispatcher åˆ†å‘äº‹ä»¶åˆ° APPçš„ VIewRootImplæµç¨‹å·²ç»æ‰“é€šäº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9969f3d153b14d68bc730b41da6eb276~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2FycnlaaGFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768134762&amp;x-signature=NjS%2B41lhovHkinq8tWi7CYv8JfA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">6.äº‹ä»¶ç»“æŸæ ‡è®°å›ä¼ åŠå¤„ç†</h2>
<p>ç»è¿‡ä¸Šé¢ç« èŠ‚çš„åˆ†æï¼Œè¾“å…¥äº‹ä»¶ç”±EventReaderä»EventHubè¯»å–åä¼ é€’åˆ°InputDispatcherï¼Œå†ç”±socketåˆ†å‘åˆ°Appçš„çª—å£ï¼Œè€Œåä¼ é€’åˆ°æˆ‘ä»¬çš„Viewæ ‘ï¼Œè¿™æ ·å°±å¯ä»¥æ­£å¸¸æ¶ˆè´¹äº‹ä»¶äº†ã€‚ä½†æ˜¯äº‹ä»¶æ¶ˆè´¹å®Œä¹‹åï¼Œè¿˜éœ€è¦é€šçŸ¥InputDispatcherçš„ï¼Œè¿™é‡Œä¹Ÿæ˜¯ é€šè¿‡socketå¯¹æ¥é€šçŸ¥ï¼Œç”±clientInputChannelå†™å…¥æ•°æ®ï¼Œè€Œåå”¤é†’åˆ°InputDispatcherçš„mEpollFdçš„ç›‘å¬ï¼Œä¸‹é¢ä»å…³é”®ä»£ç ä¸Šæ‹ä¸€ä¸‹è¿™éƒ¨åˆ†æµç¨‹</p>
<h3 data-id="heading-5">6.1 äº‹ä»¶ç»“æŸæ ‡è®°å›ä¼ </h3>
<p>ç»§ç»­è·Ÿè¿› InputState.onProcess å¤„ç†æµç¨‹ï¼Œä½ ä¼šå‘ç°æ‰€æœ‰çš„äº‹ä»¶å¤„ç†å®Œäº†éƒ½ä¼šè°ƒç”¨ finishInputEvent,æ¥ä¸‹æ¥ä»è¿™ä¸ªæ–¹æ³•å¼€å§‹åˆ†æ äº‹ä»¶ç»“æŸæ ‡è®°çš„å›ä¼ ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">frameworks/base/core/java/android/view/ViewRootImpl.java
 private void finishInputEvent(QueuedInputEvent q) {
      
       if (q.mReceiver != null) {
           // äº‹ä»¶ç»“æŸæ ‡è®°å›ä¼ 
           q.mReceiver.finishInputEvent(q.mEvent, handled)<span class="hljs-comment">;</span>
       } else {
           q.mEvent.recycleIfNeededAfterDispatch()<span class="hljs-comment">;</span>
       }
       //äº‹ä»¶å¯¹è±¡å›æ”¶
       recycleQueuedInputEvent(q)<span class="hljs-comment">;</span>
   }
   
   
frameworks/base/core/java/android/view/InputEventReceiver.java
public final void finishInputEvent(InputEvent event, boolean handled) {
   
   if (<span class="hljs-attr">mReceiverPtr</span> == <span class="hljs-number">0</span>) {
       
   } else {
       int <span class="hljs-attr">index</span> = mSeqMap.indexOfKey(event.getSequenceNumber())<span class="hljs-comment">;</span>
       if (index &lt; 0) {
       } else {
           int <span class="hljs-attr">seq</span> = mSeqMap.valueAt(index)<span class="hljs-comment">;</span>
           mSeqMap.removeAt(index)<span class="hljs-comment">;</span>
           //è°ƒç”¨nativeæ–¹æ³•
           nativeFinishInputEvent(mReceiverPtr, seq, handled)<span class="hljs-comment">;</span>
       }
   }
   event.recycleIfNeededAfterDispatch()<span class="hljs-comment">;</span>
}


frameworks/base/core/jni/android_view_InputEventReceiver.cpp
static void nativeFinishInputEvent(JNIEnv* env, jclass clazz, jlong receiverPtr,
       jint seq, jboolean handled) {
   sp&lt;NativeInputEventReceiver&gt; <span class="hljs-attr">receiver</span> =
           reinterpret_cast&lt;NativeInputEventReceiver*&gt;(receiverPtr)<span class="hljs-comment">;</span>
   //è°ƒç”¨receiver çš„ finishInputEvent
   status_t <span class="hljs-attr">status</span> = receiver-&gt;finishInputEvent(seq, handled)<span class="hljs-comment">;</span>
   if (<span class="hljs-attr">status</span> == OK || status == WOULD_BLOCK) {
       return<span class="hljs-comment">; // normal operation</span>
   }
   ...
}

status_t NativeInputEventReceiver::finishInputEvent(uint32_t seq, bool handled) {

   Finish finish{
           .<span class="hljs-attr">seq</span> = seq,
           .<span class="hljs-attr">handled</span> = handled,
   }<span class="hljs-comment">;</span>
   //æ•°æ®å…¥åˆ— 
   mOutboundQueue.push_back(finish)<span class="hljs-comment">;</span>
   return processOutboundEvents()<span class="hljs-comment">;//å¤„ç†æ•°æ®</span>
}



frameworks/base/core/jni/android_view_InputEventReceiver.cpp
status_t NativeInputEventReceiver::processOutboundEvents() {
   while (!mOutboundQueue.empty()) {
       //æ•°æ®å‡ºåˆ—
       OutboundEvent&amp; <span class="hljs-attr">outbound</span> = *mOutboundQueue.begin()<span class="hljs-comment">;</span>
       status_t status<span class="hljs-comment">;</span>

       if (std::holds_alternative&lt;Finish&gt;(outbound)) {
           const Finish&amp; <span class="hljs-attr">finish</span> = std::get&lt;Finish&gt;(outbound)<span class="hljs-comment">;</span>
           //å‘é€äº‹ä»¶ç»“æŸæ ‡è®°
           <span class="hljs-attr">status</span> = mInputConsumer.sendFinishedSignal(finish.seq, finish.handled)<span class="hljs-comment">;//æ³¨é‡Š60</span>
       } else if (std::holds_alternative&lt;Timeline&gt;(outbound)) {
           const Timeline&amp; <span class="hljs-attr">timeline</span> = std::get&lt;Timeline&gt;(outbound)<span class="hljs-comment">;</span>
           <span class="hljs-attr">status</span> = mInputConsumer.sendTimeline(timeline.inputEventId, timeline.timeline)<span class="hljs-comment">;</span>
       } else {
          
       }
       ...
       return status<span class="hljs-comment">;</span>
   }
   ...
   // The queue is now empty. Tell looper there's no more output to expect.
   setFdEvents(ALOOPER_EVENT_INPUT)<span class="hljs-comment">;</span>
   return OK<span class="hljs-comment">;</span>
}



frameworks/native/libs/input/InputConsumer.cpp
status_t InputConsumer::sendFinishedSignal(uint32_t seq, bool handled) {

   // Send finished signals for the batch sequence chain first.
   size_t <span class="hljs-attr">seqChainCount</span> = mSeqChains.size()<span class="hljs-comment">;</span>
      

   // Send finished signal for the last message in the batch.
   // å‘é€ç»“æŸæ ‡è®°ï¼Œè¿™é‡Œæ˜¯æŒ‰æ‰¹å¤„ç†ï¼Œå› ä¸ºæ¥å—æ•°æ®æ—¶ä¹Ÿæ˜¯æŒ‰ æ‰¹æ¥å—çš„ï¼Œ
   return sendUnchainedFinishedSignal(seq, handled)<span class="hljs-comment">;</span>
}

status_t InputConsumer::sendUnchainedFinishedSignal(uint32_t seq, bool handled) {
   InputMessage msg<span class="hljs-comment">;</span>
   <span class="hljs-attr">msg.header.type</span> = InputMessage::Type::FINISHED<span class="hljs-comment">;</span>
   <span class="hljs-attr">msg.header.seq</span> = seq<span class="hljs-comment">;</span>
   <span class="hljs-attr">msg.body.finished.handled</span> = handled<span class="hljs-comment">;</span>
   <span class="hljs-attr">msg.body.finished.consumeTime</span> = getConsumeTime(seq)<span class="hljs-comment">;</span>
   //å‘é€æ•°æ®
   status_t <span class="hljs-attr">result</span> = mChannel-&gt;sendMessage(&amp;msg)<span class="hljs-comment">; //æ³¨é‡Š61</span>
   ....
   return result<span class="hljs-comment">;</span>
}
</code></pre>
<p>è¿™é‡Œé€»è¾‘ä¸æ˜¯å¾ˆå¤æ‚ï¼Œä¸»è¦æ˜¯å¯¹è±¡æ± çš„å›æ”¶å¤„ç†ï¼Œä¸€æ­¥æ­¥è°ƒç”¨åˆ°Nativeå±‚çš„finishInputEventï¼Œç„¶ååˆæ˜¯ æ•°æ®å…¥åˆ—ï¼Œå‡ºåˆ—ï¼Œå†å¤„ç†æ•°æ®</p>
<ul>
<li><strong>æ³¨é‡Š60</strong> è°ƒç”¨äº†ä¹‹å‰æ¥æ”¶äº‹ä»¶çš„ InputConsumerçš„sendFinishedSignalæ¥å‘é€æ•°æ®ï¼Œç”±äºä¹‹å‰æ¥æ”¶äº‹ä»¶æ˜¯ä¸€æ‰¹ä¸€æ‰¹æ¥å—çš„ï¼Œè¿™è¾¹å‘é€æ¥é¼ æ ‡ä¹Ÿåªéœ€è¦ä¸€æ‰¹å‘é€ä¸€æ¬¡å°±å¯ä»¥äº†</li>
<li><strong>æ³¨é‡Š61</strong> è°ƒç”¨äº†æ¥æ”¶æ•°æ®çš„ clientInputChannel çš„sendMessageï¼Œå³clientSocket å†™å…¥äº†æ•°æ®</li>
</ul>
<p>æ­¤æ—¶clientç«¯çš„æ•°æ®ç»“æŸæ ‡è®°å·²ç»é€šè¿‡clientSocketå‘é€å‡ºå»äº†ï¼Œæ¥ä¸‹æ¥çœ‹ä¸‹serverç«¯(inpuDispatcher)çš„æ¥æ”¶æ•°æ®å’Œå¤„ç†æµç¨‹ã€‚</p>
<h3 data-id="heading-6">6.2 InputDispatcheræ¥æ”¶åˆ°äº‹ä»¶ç»“æŸæ ‡è®°åå¤„ç†</h3>
<p>æˆ‘ä»¬å›åˆ°<code>æ³¨é‡Š47</code>ï¼Œåœ¨InputChannelåˆå§‹åŒ–æ—¶ï¼ŒInputDispatcher å°±æ·»åŠ äº†å¯¹ serverSocketçš„fdçš„ç›‘å¬ï¼Œå½“ clientServerç«¯æœ‰æ•°æ®å†™å…¥æ—¶ï¼Œå°±ä¼šè§¦å‘è¿™é‡Œçš„å›è°ƒå‡½æ•° handleReceiveCallbackï¼ŒInputDispatcherå°±ä»è¿™é‡Œå¼€å§‹å¤„ç†äº‹ä»¶ç»“æŸæ ‡è®°ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»å…³é”®ä»£ç å…¥æ‰‹åˆ†æï¼š</p>
<pre><code class="hljs language-c" lang="c">frameworks/native/services/inputflinger/dispatcher/InputDispatcher.cpp
<span class="hljs-type">int</span> <span class="hljs-title function_">InputDispatcher::handleReceiveCallback</span><span class="hljs-params">(<span class="hljs-type">int</span> events, sp&lt;IBinder&gt; connectionToken)</span> {
      ...
    <span class="hljs-keyword">if</span> (!(events &amp; (ALOOPER_EVENT_ERROR | ALOOPER_EVENT_HANGUP))) {
        <span class="hljs-type">nsecs_t</span> currentTime = now();
        <span class="hljs-type">bool</span> gotOne = <span class="hljs-literal">false</span>;
        <span class="hljs-type">status_t</span> status = OK;
        ...
        <span class="hljs-keyword">for</span> (;;) {
            <span class="hljs-comment">//ä»serverSocketä¸­æ¥æ”¶æ•°æ®</span>
            Result&lt;InputPublisher::ConsumerResponse&gt; result =
                    connection-&gt;inputPublisher.receiveConsumerResponse();<span class="hljs-comment">//æ³¨é‡Š62</span>
            <span class="hljs-keyword">if</span> (!result.ok()) {
                status = result.error().code();
                <span class="hljs-keyword">break</span>;
            }

            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">std</span>::holds_alternative&lt;InputPublisher::Finished&gt;(*result)) {
                <span class="hljs-comment">//äº‹ä»¶ç»“æŸ</span>
                <span class="hljs-type">const</span> InputPublisher::Finished&amp; finish =
                        <span class="hljs-built_in">std</span>::get&lt;InputPublisher::Finished&gt;(*result);
                <span class="hljs-comment">//æ·»åŠ äº‹ä»¶ç»“æŸå¤„ç†çš„æŒ‡ä»¤åˆ°é˜Ÿåˆ—ä¸­</span>
                finishDispatchCycleLocked(currentTime, connection, finish.seq, finish.handled,
                                          finish.consumeTime);<span class="hljs-comment">//63</span>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">std</span>::holds_alternative&lt;InputPublisher::Timeline&gt;(*result)) {
                ...
            }
            gotOne = <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">if</span> (gotOne) {
            <span class="hljs-comment">//ä»é˜Ÿåˆ—ä¸­æ‹¿å‡ºæŒ‡ä»¤å¤„ç†</span>
            runCommandsLockedInterruptable();
            <span class="hljs-keyword">if</span> (status == WOULD_BLOCK) {
                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
            }
        }

        notify = status != DEAD_OBJECT || !connection-&gt;monitor;
        
    } <span class="hljs-keyword">else</span> {
        ...
    }
    ...
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// remove the callback</span>
}

<span class="hljs-type">void</span> <span class="hljs-title function_">InputDispatcher::finishDispatchCycleLocked</span><span class="hljs-params">(<span class="hljs-type">nsecs_t</span> currentTime,
                                                <span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;Connection&gt;&amp; connection,
                                                <span class="hljs-type">uint32_t</span> seq, <span class="hljs-type">bool</span> handled, <span class="hljs-type">nsecs_t</span> consumeTime)</span> {
    ...
    <span class="hljs-comment">// Notify other system components and prepare to start the next dispatch cycle.</span>
    <span class="hljs-keyword">auto</span> command = [this, currentTime, connection, seq, handled, consumeTime]() REQUIRES(mLock) {
        doDispatchCycleFinishedCommand(currentTime, connection, seq, handled, consumeTime);
    };
    <span class="hljs-comment">//æŒ‡ä»¤å…¥åˆ—</span>
    postCommandLocked(<span class="hljs-built_in">std</span>::move(command));
}


<span class="hljs-type">void</span> <span class="hljs-title function_">InputDispatcher::doDispatchCycleFinishedCommand</span><span class="hljs-params">(<span class="hljs-type">nsecs_t</span> finishTime,
                                                     <span class="hljs-type">const</span> <span class="hljs-built_in">std</span>::<span class="hljs-built_in">shared_ptr</span>&lt;Connection&gt;&amp; connection,
                                                     <span class="hljs-type">uint32_t</span> seq, <span class="hljs-type">bool</span> handled,
                                                     <span class="hljs-type">nsecs_t</span> consumeTime)</span> {
   ...
    <span class="hljs-comment">// Dequeue the event and start the next cycle.</span>
    <span class="hljs-comment">// Because the lock might have been released, it is possible that the</span>
    <span class="hljs-comment">// contents of the wait queue to have been drained, so we need to double-check</span>
    <span class="hljs-comment">// a few things.</span>
   
    <span class="hljs-keyword">auto</span> entryIt = <span class="hljs-built_in">std</span>::find_if(connection-&gt;waitQueue.begin(), connection-&gt;waitQueue.end(),
                                [seq](<span class="hljs-keyword">auto</span>&amp; e) { <span class="hljs-keyword">return</span> e-&gt;seq == seq; });
     <span class="hljs-comment">//éå† connection-&gt;waitQueue æ‰€æœ‰çš„åˆ†å‘äº‹ä»¶</span>
    <span class="hljs-keyword">if</span> (entryIt != connection-&gt;waitQueue.end()) {<span class="hljs-comment">//æ³¨é‡Š64</span>
        <span class="hljs-built_in">std</span>::<span class="hljs-built_in">unique_ptr</span>&lt;DispatchEntry&gt; dispatchEntry = <span class="hljs-built_in">std</span>::move(*entryIt);
        <span class="hljs-comment">//ä»waitQueueä¸­ç§»é™¤æ¶ˆæ¯</span>
        connection-&gt;waitQueue.erase(entryIt);<span class="hljs-comment">//æ³¨é‡Š65</span>

        <span class="hljs-type">const</span> sp&lt;IBinder&gt;&amp; connectionToken = connection-&gt;getToken();
        <span class="hljs-comment">//ç§»é™¤è®°å½•anr çš„æ—¶é—´</span>
        mAnrTracker.erase(dispatchEntry-&gt;timeoutTime, connectionToken);<span class="hljs-comment">//æ³¨é‡Š66</span>
        ...
    }

    <span class="hljs-comment">// Start the next dispatch cycle for this connection.</span>
    <span class="hljs-comment">// å¼€å§‹ä¸‹ä¸€ä¸ªå¾ªç¯(è‹¥outboundQueueä¸­è¿˜æœ‰å…ƒç´ )</span>
    startDispatchCycleLocked(now(), connection);<span class="hljs-comment">//æ³¨é‡Š67</span>
}
</code></pre>
<ul>
<li><strong>æ³¨é‡Š62</strong> é€šè¿‡inputPublisher ä»serverSocket ä¸­è¯»å– clientServerå‘é€è¿‡æ¥çš„æ•°æ®</li>
<li><strong>æ³¨é‡Š63</strong> åˆ¤æ–­æ¥æ”¶çš„æ•°æ®æ˜¯å¦æ˜¯äº‹ä»¶ç»“æŸçš„æ ‡è®°ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå¡å…¥åˆ°å¾…å¤„ç†çš„ æŒ‡ä»¤é›†åˆ mCommandQueue ä¸­ï¼Œç´§æ¥ç€ä»é›†åˆä¸­è·å–æŒ‡ä»¤å¹¶æ‰§è¡Œ</li>
<li><strong>æ³¨é‡Š64</strong> éå†connect-&gt;waitQueueä¸­æ‰€æœ‰å·²åˆ†å‘äº‹ä»¶ï¼Œè¿™ä¸ªé›†åˆä¸­çš„äº‹ä»¶æ˜¯åœ¨InputDispatcherä¸­åˆ†å‘äº‹ä»¶çš„æ–¹æ³•startDispatchCycleLockedå†…æ·»åŠ çš„ï¼Œå‚è€ƒ<code>æ³¨é‡Š32</code></li>
<li><strong>æ³¨é‡Š65</strong> ä»connect-&gt;waitQueue ç§»é™¤äº‹ä»¶ï¼Œæ­¤æ—¶æ‰è¯´æ˜è¿™ä¸ªäº‹ä»¶æ˜¯å¤„ç†å®Œäº†çš„,è¿™ä¸ªé›†åˆæ˜¯å¦ä¸ºç©º ä¹Ÿæ˜¯åç»­åˆ¤æ–­æ˜¯å¦æœ‰ANRçš„ä¾æ®ä¹‹ä¸€</li>
<li><strong>æ³¨é‡Š66</strong> æ“¦é™¤mAnrTrackerä¸­çš„ANRè¶…æ—¶æ—¶é—´ï¼Œè¿™ä¸ªä¹Ÿæ˜¯åœ¨InputDispatcherä¸­åˆ†å‘äº‹ä»¶çš„æ–¹æ³•:startDispatchCycleLockedå†…æ·»åŠ ï¼Œå‚è€ƒ<code>æ³¨é‡Š32</code></li>
<li><strong>æ³¨é‡Š67</strong> éå†å®Œæ‰€æœ‰å·²åˆ†å‘çš„äº‹ä»¶åï¼Œå°±å¼€å§‹ä¸‹ä¸€ä¸ªå¾ªç¯(å¦‚æœconnection--&gt;outboundQueueä¸­è¿˜æœ‰å¾…åˆ†å‘äº‹ä»¶),æ­¤æ—¶å°±åˆå¼€å§‹äº†äº‹ä»¶çš„åˆ†å‘ï¼Œæµç¨‹å°±åˆå›åˆ°äº† <code>4.2 InputDispatcher äº‹ä»¶å‡ºåˆ—åˆ†å‘</code></li>
</ul>
<p>åˆ°è¿™é‡Œï¼Œä»InputState.finishInputEvent ä¸€æ­¥æ­¥è°ƒç”¨åˆ°Nativeå±‚ç”±clientSocketå‘é€åˆ°InputDispatcherä¸­çš„äº‹ä»¶ç»“æŸæ ‡è®°çš„æ¥æ”¶å’Œå¤„ç†æµç¨‹åŸºæœ¬ç»“æŸäº†ï¼Œåç»­å°±ä¼šè¿›å…¥åˆ°ä¸‹ä¸€æ‰¹æ¬¡æ˜¯äº‹ä»¶åˆ†å‘ã€‚</p>
<p>InputDispatcher å’Œ Appçª—å£ä¹‹é—´çš„äº¤äº’è¿‡ç¨‹å¦‚ä¸‹
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba0f8757995b4d7586bbdd70696b28e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2FycnlaaGFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768134762&amp;x-signature=wKZ%2Bc9NlKvJk70EsPdMnYPX6X0Q%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-7">7.ANRæµç¨‹</h2>
<p>ä¸ºäº†è§„é¿ANRï¼Œå¤§å®¶éƒ½çŸ¥é“Viewæ ‘é‡Œæ¥æ”¶äº‹ä»¶å¤„ç†é€»è¾‘æ—¶æ—¶ä¸åšè€—æ—¶æ“ä½œã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä»æºç çš„è§’åº¦åˆ†æä¸€ä¸‹è¿™ç§ANRæ˜¯å¦‚ä½•äº§ç”Ÿå’Œå¤„ç†çš„ã€‚</p>
<h3 data-id="heading-8">7.1 äº‹ä»¶åˆ†å‘ANRçš„äº§ç”Ÿ</h3>
<p>æ•´ä¸ªInputDispatcherçš„äº‹ä»¶åˆ†å‘æ˜¯ä» dispatchOnce å¼€å§‹çš„ï¼Œä¸Šé¢çš„ç« èŠ‚åˆ†æäº†<code>æ³¨é‡Š20</code>å‡ºçš„äº‹ä»¶åˆ†å‘ã€Appçª—å£äº‹ä»¶æ¥æ”¶ä»¥åŠç»“æŸæ ‡è®°å›ä¼ ã€‚ä½†æ˜¯ dispatchOnce ä¸‹é¢è¿˜æœ‰å…³äºANRåˆ¤æ–­çš„å…³é”®è°ƒç”¨é€»è¾‘<code>æ³¨é‡Š21</code></p>
<ul>
<li><strong>æ³¨é‡Š21</strong> åˆ†å‘å®Œä¸€æ‰¹äº‹ä»¶å åˆ¤æ–­æ˜¯å¦æœ‰ANRäº§ç”Ÿï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</li>
</ul>

<pre><code class="hljs language-scss" lang="scss">frameworks/native/services/inputflinger/dispatcher/InputDispatcher<span class="hljs-selector-class">.cpp</span>
nsecs_t InputDispatcher::<span class="hljs-built_in">processAnrsLocked</span>() {
    const nsecs_t currentTime = <span class="hljs-built_in">now</span>();
    nsecs_t nextAnrCheck = LLONG_MAX;
    <span class="hljs-comment">// Check if we are waiting for a focused window to appear. Raise ANR if waited too long</span>
    <span class="hljs-comment">//æ— ç„¦ç‚¹çª—å£çš„ANR</span>
    if (mNoFocusedWindowTimeoutTime.has_value() &amp;&amp; mAwaitedFocusedApplication != nullptr) {
        if (currentTime &gt;= *mNoFocusedWindowTimeoutTime) {<span class="hljs-comment">//æ³¨é‡Š68</span>
            <span class="hljs-comment">//ANRäº‹ä»¶å¤„ç†</span>
            <span class="hljs-built_in">processNoFocusedWindowAnrLocked</span>();<span class="hljs-comment">//æ³¨é‡Š69</span>
            mAwaitedFocusedApplication<span class="hljs-selector-class">.reset</span>();
            mNoFocusedWindowTimeoutTime = std::nullopt;
            return LLONG_MIN;
        } else {
            <span class="hljs-comment">// Keep waiting. We will drop the event when mNoFocusedWindowTimeoutTime comes.</span>
            nextAnrCheck = *mNoFocusedWindowTimeoutTime;
        }
    }

    <span class="hljs-comment">// Check if any connection ANRs are due</span>
    nextAnrCheck = std::<span class="hljs-built_in">min</span>(nextAnrCheck, mAnrTracker.<span class="hljs-built_in">firstTimeout</span>());
    <span class="hljs-comment">// äº‹ä»¶åˆ†å‘æ—¶çš„ANR</span>
    if (currentTime &lt; nextAnrCheck) { <span class="hljs-comment">// æ³¨é‡Š70</span>
        return nextAnrCheck;          <span class="hljs-comment">// everything is normal. Let's check again at nextAnrCheck</span>
    }

    <span class="hljs-comment">// If we reached here, we have an unresponsive connection.</span>
    std::shared_ptr&lt;Connection&gt; connection = <span class="hljs-built_in">getConnectionLocked</span>(mAnrTracker.<span class="hljs-built_in">firstToken</span>());
    if (connection == nullptr) {
        <span class="hljs-built_in">ALOGE</span>("Could not find connection for entry %" PRId64, mAnrTracker.firstTimeout());
        return nextAnrCheck;
    }
    connection-&gt;responsive = false;
    <span class="hljs-comment">// Stop waking up for this unresponsive connection</span>
    mAnrTracker<span class="hljs-selector-class">.eraseToken</span>(connection-&gt;getToken());
    <span class="hljs-built_in">onAnrLocked</span>(connection);<span class="hljs-comment">//æ³¨é‡Š71</span>
    return LLONG_MIN;
}

void InputDispatcher::<span class="hljs-built_in">processNoFocusedWindowAnrLocked</span>() {
     ...
    <span class="hljs-built_in">onAnrLocked</span>(mAwaitedFocusedApplication);<span class="hljs-comment">//æ³¨é‡Š72</span>
}
</code></pre>
<ul>
<li><strong>æ³¨é‡Š68</strong> åˆ¤æ–­å½“å‰çš„æ—¶å€™æ˜¯å¦å¤§äºæ— ç„¦ç‚¹çª—å£ANRè¶…æ—¶æ—¶é—´ï¼Œå¦‚æœå¤§äºï¼Œå°±æ˜¯æ— ç„¦ç‚¹ANRï¼Œ</li>
<li><strong>æ³¨é‡Š69</strong> æ— ç„¦ç‚¹ANRçš„å¤„ç†æµç¨‹,è¿™é‡Œä¼šå†æ¬¡æ ¡éªŒæ˜¯å¦è¿˜æ˜¯è·å–ä¸åˆ°ç„¦ç‚¹çª—å£ï¼Œè‹¥è¿˜æ˜¯æ²¡æœ‰ï¼Œåˆ™ä¼šè¿›å…¥çœŸæ­£çš„ANRå¤„ç†æµç¨‹</li>
<li><strong>æ³¨é‡Š70</strong> è·å–mAnrTrackerä¸­æœ€å‰é¢çš„äº‹ä»¶åˆ†å‘(æœ‰ç„¦ç‚¹çª—å£)çš„ANRè¶…æ—¶æ—¶é—´ï¼Œæ—¶åˆ¤æ–­å½“å‰æ—¶é—´æ˜¯å¦å°äºANRè¶…æ—¶æ—¶é—´ï¼Œå¦‚æœå°äºå°±æ˜¯æ­£å¸¸æµç¨‹ï¼Œå¤§äºå°±æ˜¯äº‹ä»¶åˆ†å‘ANR</li>
<li><strong>æ³¨é‡Š71ã€æ³¨é‡Š72</strong> ANRçš„å¤„ç†æµç¨‹</li>
</ul>
<p>çœ‹åˆ°è¿™é‡Œå¤§å®¶å‘ç°æ²¡æœ‰äº‹ä»¶åˆ†å‘ANRå¹¶ä¸æ˜¯ä¸¥æ ¼éµå®ˆè¶…æ—¶é€»è¾‘çš„ï¼Œå‡è®¾äº‹ä»¶åˆ†å‘ANRè¶…æ—¶æ—¶é—´æ˜¯5ç§’ï¼Œä½†æ˜¯è¶…æ—¶åˆ¤æ–­æ˜¯è¦åˆ†å‘å®Œä¸€æ‰¹äº‹ä»¶åæ‰ä¼šåˆ¤æ–­æ²¡æœ‰æ”¶åˆ°ç»“æŸäº‹ä»¶æ ‡è®°çš„äº‹ä»¶é˜Ÿåˆ—ä¸­æœ€å‰é¢é‚£ä¸ªäº‹ä»¶çš„è¶…æ—¶é€»è¾‘ï¼Œå¦‚æœè¶…æ—¶äº†ï¼Œå°±ä¼šäº§ç”ŸANRï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼Œæˆ‘ä»¬åœ¨é‡Œé¢ç›´æ¥å»¶æ—¶10ç§’ï¼Œç‚¹å‡»å®Œ10ç§’å†…ä¸åšä»»ä½•æ“ä½œï¼Œä¸è¦å†è¾“å…¥å’Œåˆ†å‘å…¶ä»–äº‹ä»¶ï¼Œæ­¤æ—¶å¹¶ä¸ä¼šäº§ç”ŸANRçš„ã€‚ä½†æ˜¯å¦‚æœåœ¨10ç§’å†…å†æ¬¡è§¦æ‘¸/ç‚¹å‡»å°±ä¼šäº§ç”ŸANRå¹¶å¼¹çª—å‘ŠçŸ¥Appã€‚</p>
<h3 data-id="heading-9">7.2 ANRæ¶ˆæ¯ä¼ é€’åˆ°AppåŠå¼¹çª—</h3>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­åˆ†æè¿™ä¸ªANRäº‹ä»¶æ˜¯å¦‚ä½•ä¼ é€’åˆ°åº”ç”¨å¹¶å¼¹çª—å¤„ç†çš„ã€‚æ¥ç€ä¸Šé¢çš„ä»£ç ç»§ç»­åˆ†æ</p>
<pre><code class="hljs language-scss" lang="scss">frameworks/native/services/inputflinger/dispatcher/InputDispatcher<span class="hljs-selector-class">.cpp</span>
<span class="hljs-comment">//æœ‰ç„¦ç‚¹çª—å£æ— å“åº”ANRå¤„ç†æµç¨‹</span>
void InputDispatcher::<span class="hljs-built_in">onAnrLocked</span>(const std::shared_ptr&lt;Connection&gt;&amp; connection) {
   
    <span class="hljs-comment">// Since we are allowing the policy to extend the timeout, maybe the waitQueue</span>
    <span class="hljs-comment">// is already healthy again. Don't raise ANR in this situation</span>
    <span class="hljs-comment">// ä¼šå†æ¬¡æ ¡éªŒ connection-&gt;waitQueueï¼Œ</span>
    if (connection-&gt;waitQueue.empty()) {<span class="hljs-comment">//æ³¨é‡Š73</span>
        <span class="hljs-built_in">ALOGI</span>("Not raising ANR because the connection %s has recovered",
              connection-&gt;getInputChannelName()<span class="hljs-selector-class">.c_str</span>());
        return;
    }
    ...
    <span class="hljs-built_in">processConnectionUnresponsiveLocked</span>(*connection, std::move(reason));
    ...
}

void InputDispatcher::<span class="hljs-built_in">processConnectionUnresponsiveLocked</span>(const Connection&amp; connection,
                                                          std::string reason) {
    const sp&lt;IBinder&gt;&amp; connectionToken = connection<span class="hljs-selector-class">.getToken</span>();
    std::optional&lt;gui::Pid&gt; pid;
    ...
    <span class="hljs-built_in">sendWindowUnresponsiveCommandLocked</span>(connectionToken, pid, std::move(reason));
}

void InputDispatcher::<span class="hljs-built_in">sendWindowUnresponsiveCommandLocked</span>(const sp&lt;IBinder&gt;&amp; token,
                                                          std::optional&lt;gui::Pid&gt; pid,
                                                          std::string reason) {
    auto command = <span class="hljs-selector-attr">[this, token, pid, r = std::move(reason)]</span>() <span class="hljs-built_in">REQUIRES</span>(mLock) {
        scoped_unlock <span class="hljs-built_in">unlock</span>(mLock);
        mPolicy<span class="hljs-selector-class">.notifyWindowUnresponsive</span>(token, pid, r);<span class="hljs-comment">//æ³¨é‡Š74</span>
    };
    <span class="hljs-built_in">postCommandLocked</span>(std::move(command));
}

<span class="hljs-comment">//æ— ç„¦ç‚¹çª—å£ANRå¤„ç†æµç¨‹</span>
void InputDispatcher::<span class="hljs-built_in">onAnrLocked</span>(std::shared_ptr&lt;InputApplicationHandle&gt; application) {
    std::string reason =
            <span class="hljs-built_in">StringPrintf</span>(<span class="hljs-string">"%s does not have a focused window"</span>, application-&gt;<span class="hljs-built_in">getName</span>().<span class="hljs-built_in">c_str</span>());
    <span class="hljs-built_in">updateLastAnrStateLocked</span>(*application, reason);

    auto command = <span class="hljs-selector-attr">[this, app = std::move(application)]</span>() <span class="hljs-built_in">REQUIRES</span>(mLock) {
        scoped_unlock <span class="hljs-built_in">unlock</span>(mLock);
        mPolicy<span class="hljs-selector-class">.notifyNoFocusedWindowAnr</span>(app);<span class="hljs-comment">//æ³¨é‡Š75</span>
    };
    <span class="hljs-built_in">postCommandLocked</span>(std::move(command));
}
</code></pre>
<ul>
<li><strong>æ³¨é‡Š73</strong> è¿™é‡Œè¿˜ä¼šå†æ¬¡æ ¡éªŒ connection-&gt;waitQueue æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™ä¸è®¤ä¸ºæ˜¯ANRï¼Œå’Œ äº‹ä»¶ç»“æŸæ ‡è®°å¤„ç†ä¸­çš„ <code>æ³¨é‡Š65</code> å…³è”ã€‚</li>
<li><strong>æ³¨é‡Š74</strong> æœ‰ç„¦ç‚¹çª—å£æ— å“åº”ANRå¤„ç†æµç¨‹</li>
<li><strong>æ³¨é‡Š75</strong> æ— ç„¦ç‚¹çª—å£ANRå¤„ç†æµç¨‹</li>
</ul>
<p>è¿™é‡Œçš„ANRåˆ†ä¸ºæ— ç„¦ç‚¹çª—å£ANRå’Œæœ‰ç„¦ç‚¹æ— å“åº”ANRï¼Œä¸¤ä¸ªæµç¨‹éƒ½å·®ä¸å¤šï¼Œæˆ‘ä»¬ä»¥å¸¸è§çš„æœ‰ç„¦ç‚¹æ— å“åº”ANRä¸ºä¾‹è¿›è¡Œåˆ†æ,æœ€ç»ˆè°ƒç”¨åˆ° <code>mPolicy.notifyWindowUnresponsive</code>ã€‚mPolicy æ˜¯åœ¨ IMS åˆå§‹åŒ–æ—¶ä¼ å…¥çš„NativeInputManager å¯¹è±¡</p>
<pre><code class="hljs language-scss" lang="scss">frameworks/base/services/core/jni/com_android_server_input_InputManagerService<span class="hljs-selector-class">.cpp</span>
void NativeInputManager::<span class="hljs-built_in">notifyWindowUnresponsive</span>(const sp&lt;IBinder&gt;&amp; token,
                                                  std::optional&lt;gui::Pid&gt; pid,
                                                  const std::string&amp; reason) {
<span class="hljs-selector-id">#if</span> DEBUG_INPUT_DISPATCHER_POLICY
    <span class="hljs-built_in">ALOGD</span>("notifyWindowUnresponsive");
<span class="hljs-selector-id">#endif</span>
    <span class="hljs-built_in">ATRACE_CALL</span>();

    JNIEnv* env = <span class="hljs-built_in">jniEnv</span>();
    ScopedLocalFrame <span class="hljs-built_in">localFrame</span>(env);

    jobject tokenObj = <span class="hljs-built_in">javaObjectForIBinder</span>(env, token);
    ScopedLocalRef&lt;jstring&gt; <span class="hljs-built_in">reasonObj</span>(env, env-&gt;NewStringUTF(reason.c_str()));

    env-&gt;<span class="hljs-built_in">CallVoidMethod</span>(mServiceObj, gServiceClassInfo.notifyWindowUnresponsive, tokenObj,
                        pid.value_or(gui::Pid{<span class="hljs-number">0</span>})<span class="hljs-selector-class">.val</span>(), pid<span class="hljs-selector-class">.has_value</span>(), reasonObj<span class="hljs-selector-class">.get</span>());<span class="hljs-comment">//æ³¨é‡Š76</span>
    <span class="hljs-built_in">checkAndClearExceptionFromCallback</span>(env, "notifyWindowUnresponsive");
}

</code></pre>
<ul>
<li><strong>æ³¨é‡Š76</strong> è¿™é‡Œè°ƒå›äº†Javaç«¯çš„InputManagerService.otifyWindowUnresponsive,æ­¤æ—¶äº‹ä»¶å·²ç»ä¼ é€’åˆ°Javaç«¯çš„IMSäº†ï¼Œç»§ç»­å¾€ä¸‹è·Ÿè¿›ï¼Œæ‘˜å–äº†ANRäº‹ä»¶æµè½¬ç›¸å…³çš„ä»£ç å¦‚ä¸‹ï¼š</li>
</ul>

<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">frameworks</span>/<span class="hljs-selector-tag">base</span>/<span class="hljs-selector-tag">services</span>/<span class="hljs-selector-tag">core</span>/<span class="hljs-selector-tag">java</span>/<span class="hljs-selector-tag">com</span>/<span class="hljs-selector-tag">android</span>/<span class="hljs-selector-tag">server</span>/<span class="hljs-selector-tag">input</span>/<span class="hljs-selector-tag">InputManagerService</span><span class="hljs-selector-class">.java</span>
    <span class="hljs-comment">// Native callback</span>
    @<span class="hljs-selector-tag">SuppressWarnings</span>(<span class="hljs-string">"unused"</span>)
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">notifyWindowUnresponsive</span>(IBinder token, int pid, boolean isPidValid,
            String reason) {
        <span class="hljs-comment">//IMSä¸­è½¬ANR</span>
        <span class="hljs-selector-tag">mWindowManagerCallbacks</span><span class="hljs-selector-class">.notifyWindowUnresponsive</span>(token,
                isPidValid ? OptionalInt.<span class="hljs-built_in">of</span>(pid) : OptionalInt.<span class="hljs-built_in">empty</span>(), reason);
    }
    
<span class="hljs-selector-tag">frameworks</span>/<span class="hljs-selector-tag">base</span>/<span class="hljs-selector-tag">services</span>/<span class="hljs-selector-tag">core</span>/<span class="hljs-selector-tag">java</span>/<span class="hljs-selector-tag">com</span>/<span class="hljs-selector-tag">android</span>/<span class="hljs-selector-tag">server</span>/<span class="hljs-selector-tag">wm</span>/<span class="hljs-selector-tag">InputManagerCallback</span><span class="hljs-selector-class">.java</span>
@<span class="hljs-selector-tag">Override</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">notifyWindowUnresponsive</span>(<span class="hljs-variable">@NonNull</span> IBinder token, <span class="hljs-variable">@NonNull</span> OptionalInt pid,
        String reason) {
    <span class="hljs-selector-tag">TimeoutRecord</span> <span class="hljs-selector-tag">timeoutRecord</span> = <span class="hljs-selector-tag">TimeoutRecord</span><span class="hljs-selector-class">.forInputDispatchWindowUnresponsive</span>(
            <span class="hljs-built_in">timeoutMessage</span>(pid, reason));
    <span class="hljs-comment">//ANRäº‹ä»¶ä¸­è½¬åˆ°AnrController</span>
    <span class="hljs-selector-tag">mService</span><span class="hljs-selector-class">.mAnrController</span><span class="hljs-selector-class">.notifyWindowUnresponsive</span>(token, pid, timeoutRecord);
}

<span class="hljs-selector-tag">frameworks</span>/<span class="hljs-selector-tag">base</span>/<span class="hljs-selector-tag">services</span>/<span class="hljs-selector-tag">core</span>/<span class="hljs-selector-tag">java</span>/<span class="hljs-selector-tag">com</span>/<span class="hljs-selector-tag">android</span>/<span class="hljs-selector-tag">server</span>/<span class="hljs-selector-tag">wm</span>/<span class="hljs-selector-tag">AnrController</span><span class="hljs-selector-class">.java</span>
<span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">notifyWindowUnresponsive</span>(<span class="hljs-variable">@NonNull</span> IBinder token, <span class="hljs-variable">@NonNull</span> OptionalInt pid,
        <span class="hljs-variable">@NonNull</span> TimeoutRecord timeoutRecord) {
    <span class="hljs-selector-tag">try</span> {
        <span class="hljs-selector-tag">timeoutRecord</span><span class="hljs-selector-class">.mLatencyTracker</span><span class="hljs-selector-class">.notifyWindowUnresponsiveStarted</span>();
        <span class="hljs-selector-tag">if</span> (<span class="hljs-built_in">notifyWindowUnresponsive</span>(token, timeoutRecord)) {
            <span class="hljs-selector-tag">return</span>;
        }
        ...
    } <span class="hljs-selector-tag">finally</span> {
        <span class="hljs-selector-tag">timeoutRecord</span><span class="hljs-selector-class">.mLatencyTracker</span><span class="hljs-selector-class">.notifyWindowUnresponsiveEnded</span>();
    }
}

 <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">notifyWindowUnresponsive</span>(<span class="hljs-variable">@NonNull</span> IBinder inputToken,
            TimeoutRecord timeoutRecord) {
        ...
        <span class="hljs-selector-tag">if</span> (activity != null) {
            <span class="hljs-comment">//è¿™é‡Œæœ€ç»ˆä¹Ÿæ˜¯è°ƒç”¨ mService.mAmInternal.inputDispatchingTimedOut</span>
            <span class="hljs-selector-tag">activity</span><span class="hljs-selector-class">.inputDispatchingTimedOut</span>(timeoutRecord, pid);
        } <span class="hljs-selector-tag">else</span> {
            <span class="hljs-comment">//ANRäº‹ä»¶ä¸­è½¬åˆ°AMS</span>
            <span class="hljs-selector-tag">mService</span><span class="hljs-selector-class">.mAmInternal</span><span class="hljs-selector-class">.inputDispatchingTimedOut</span>(pid, aboveSystem, timeoutRecord);
        }
        <span class="hljs-selector-tag">dumpAnrStateAsync</span>(activity, windowState, timeoutRecord.mReason);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">true</span>;
    }

<span class="hljs-selector-tag">frameworks</span>/<span class="hljs-selector-tag">base</span>/<span class="hljs-selector-tag">services</span>/<span class="hljs-selector-tag">core</span>/<span class="hljs-selector-tag">java</span>/<span class="hljs-selector-tag">com</span>/<span class="hljs-selector-tag">android</span>/<span class="hljs-selector-tag">server</span>/<span class="hljs-selector-tag">am</span>/<span class="hljs-selector-tag">ActivityManagerService</span><span class="hljs-selector-class">.java</span>
@<span class="hljs-selector-tag">Override</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">inputDispatchingTimedOut</span>(int pid, boolean aboveSystem,
        TimeoutRecord timeoutRecord) {
    <span class="hljs-comment">//ANRäº‹ä»¶æ¥åˆ° AMS</span>
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ActivityManagerService</span><span class="hljs-selector-class">.this</span><span class="hljs-selector-class">.inputDispatchingTimedOut</span>(pid, aboveSystem,
            timeoutRecord);
}

@<span class="hljs-selector-tag">Override</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">inputDispatchingTimedOut</span>(Object proc, String activityShortComponentName,
        ApplicationInfo aInfo, String parentShortComponentName, Object parentProc,
        boolean aboveSystem, TimeoutRecord timeoutRecord) {
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">ActivityManagerService</span><span class="hljs-selector-class">.this</span><span class="hljs-selector-class">.inputDispatchingTimedOut</span>((ProcessRecord) proc,
            activityShortComponentName, aInfo, parentShortComponentName,
            (WindowProcessController) parentProc, aboveSystem, timeoutRecord);
}

 <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">inputDispatchingTimedOut</span>(ProcessRecord proc, String activityShortComponentName,
            ApplicationInfo aInfo, String parentShortComponentName,
            WindowProcessController parentProcess, boolean aboveSystem,
            TimeoutRecord timeoutRecord) {
        <span class="hljs-selector-tag">try</span> {
            ...
            <span class="hljs-selector-tag">if</span> (proc != null) {
                ...
                <span class="hljs-selector-tag">timeoutRecord</span><span class="hljs-selector-class">.mLatencyTracker</span><span class="hljs-selector-class">.waitingOnAMSLockStarted</span>();
                 <span class="hljs-comment">//ANRäº‹ä»¶ä¸­è½¬ AnrHelper</span>
                <span class="hljs-selector-tag">mAnrHelper</span><span class="hljs-selector-class">.appNotResponding</span>(proc, activityShortComponentName, aInfo,
                        parentShortComponentName, parentProcess, aboveSystem, timeoutRecord,
                        <span class="hljs-comment">/*isContinuousAnr*/</span> true); <span class="hljs-comment">//æ³¨é‡Š77</span>
            }
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">true</span>;
        } <span class="hljs-selector-tag">finally</span> {
            <span class="hljs-selector-tag">Trace</span><span class="hljs-selector-class">.traceEnd</span>(Trace.TRACE_TAG_ACTIVITY_MANAGER);
        }
    }
</code></pre>
<p>å‡ ç»å‘¨è½¬ANRäº‹ä»¶æ¥åˆ°äº†AMS</p>
<ul>
<li><strong>æ³¨é‡Š77</strong> è°ƒç”¨ AnrHelper.appNotRespondingæ¥ç»Ÿä¸€å¤„ç†ANR</li>
</ul>
<pre><code class="hljs language-java" lang="java">frameworks/base/services/core/java/com/android/server/am/AnrHelper.java
<span class="hljs-keyword">void</span> <span class="hljs-title function_">appNotResponding</span><span class="hljs-params">(ProcessRecord anrProcess, String activityShortComponentName,
            ApplicationInfo aInfo, String parentShortComponentName,
            WindowProcessController parentProcess, <span class="hljs-type">boolean</span> aboveSystem,
            TimeoutRecord timeoutRecord, <span class="hljs-type">boolean</span> isContinuousAnr)</span> {
    <span class="hljs-keyword">try</span> {
        timeoutRecord.mLatencyTracker.appNotRespondingStarted();
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">incomingPid</span> <span class="hljs-operator">=</span> anrProcess.mPid;
        timeoutRecord.mLatencyTracker.waitingOnAnrRecordLockStarted();
        <span class="hljs-keyword">synchronized</span> (mAnrRecords) {
            ...
            <span class="hljs-comment">//æ·»åŠ anräº‹ä»¶(åŒ…å«anräº‹ä»¶æ•°æ®å’Œå½“å‰ANRçš„åº”ç”¨ä¿¡æ¯)åˆ°listä¸­</span>
            mAnrRecords.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AnrRecord</span>(anrProcess, activityShortComponentName, aInfo,
                    parentShortComponentName, parentProcess, aboveSystem, timeoutRecord,
                    isContinuousAnr, firstPidDumpPromise));<span class="hljs-comment">//æ³¨é‡Š78</span>
        }
        <span class="hljs-comment">//å¼€å§‹æ¶ˆè´¹ANRäº‹ä»¶</span>
        startAnrConsumerIfNeeded();<span class="hljs-comment">//æ³¨é‡Š79</span>
    } <span class="hljs-keyword">finally</span> {
        timeoutRecord.mLatencyTracker.appNotRespondingEnded();
    }
}
    
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">startAnrConsumerIfNeeded</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">if</span> (mRunning.compareAndSet(<span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>)) {
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnrConsumerThread</span>().start();
    }
}


<span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AnrConsumerThread</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Thread</span> {
    AnrConsumerThread() {
        <span class="hljs-built_in">super</span>(<span class="hljs-string">"AnrConsumer"</span>);
    }

    ...

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        AnrRecord r;
        <span class="hljs-keyword">while</span> ((r = next()) != <span class="hljs-literal">null</span>) {
            scheduleBinderHeavyHitterAutoSamplerIfNecessary();
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">currentPid</span> <span class="hljs-operator">=</span> r.mApp.mPid;
            <span class="hljs-keyword">if</span> (currentPid != r.mPid) { <span class="hljs-comment">// åŒ¹é…pid</span>
                <span class="hljs-comment">// The process may have restarted or died.</span>
                Slog.i(TAG, <span class="hljs-string">"Skip ANR with mismatched pid="</span> + r.mPid + <span class="hljs-string">", current pid="</span>
                        + currentPid);
                <span class="hljs-keyword">continue</span>;
            }
            <span class="hljs-comment">//ç»§ç»­åˆ†å‘</span>
            r.appNotResponding(onlyDumpSelf);
        }

        mRunning.set(<span class="hljs-literal">false</span>);
        <span class="hljs-keyword">synchronized</span> (mAnrRecords) {
            mProcessingPid = -<span class="hljs-number">1</span>;
            <span class="hljs-comment">// The race should be unlikely to happen. Just to make sure we don't miss.</span>
            <span class="hljs-keyword">if</span> (!mAnrRecords.isEmpty()) {
                <span class="hljs-comment">//ç»§ç»­å¤„ç†å‰©ä¸‹çš„ANR äº‹ä»¶</span>
                startAnrConsumerIfNeeded();
            }
        }
    }
}

 <span class="hljs-keyword">void</span> <span class="hljs-title function_">appNotResponding</span><span class="hljs-params">(<span class="hljs-type">boolean</span> onlyDumpSelf)</span> {
    <span class="hljs-keyword">try</span> {
        mTimeoutRecord.mLatencyTracker.anrProcessingStarted();
        <span class="hljs-comment">//äº¤ç”±ProcessErrorStateRecordå¤„ç†</span>
        mApp.mErrorState.appNotResponding(mActivityShortComponentName, mAppInfo,
                mParentShortComponentName, mParentProcess, mAboveSystem,
                mTimeoutRecord, mAuxiliaryTaskExecutor, onlyDumpSelf,
                mIsContinuousAnr, mFirstPidFilePromise);<span class="hljs-comment">//æ³¨é‡Š80</span>
    } <span class="hljs-keyword">finally</span> {
        mTimeoutRecord.mLatencyTracker.anrProcessingEnded();
    }
}

</code></pre>
<ul>
<li><strong>æ³¨é‡Š78</strong> å°† InputDispatcher ä¼ é€’è¿‡æ¥çš„ ANR çš„äº‹ä»¶æ•°æ®å’Œå½“å‰ANRçš„è¿›ç¨‹ä¿¡æ¯å°è£…åˆ°ä¸€èµ· å¹¶æ·»åŠ åˆ°é›†åˆlist ä¸­</li>
<li><strong>æ³¨é‡Š79</strong> å¼€å¯å­çº¿ç¨‹ éå†å¤„ç†æ‰€æœ‰çš„ANRäº‹ä»¶ï¼Œå› ä¸ºåé¢è¿˜è¦æ”¶é›† ANRåº”ç”¨çš„è°ƒç”¨å †æ ˆ/å†…å­˜/CPU/Traceç­‰ä¿¡æ¯ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯åœ¨å­çº¿ç¨‹ä¸­å¤„ç†ANRäº‹ä»¶</li>
<li><strong>æ³¨é‡Š80</strong> äº¤ç”±ProcessErrorStateRecord.appNotResponding åœ¨å­çº¿ç¨‹å¼€å§‹çœŸæ­£å¤„ç†ANRï¼Œæ–¹æ³• appNotResponding çš„é€»è¾‘ä¹Ÿå¾ˆå¤šï¼Œæˆ‘ä»¬æŒ‘ä¸€äº›å…³é”®ä»£ç åˆ†æï¼š</li>
</ul>
<pre><code class="hljs language-java" lang="java">frameworks/base/services/core/java/com/android/server/am/ProcessErrorStateRecord.java
 <span class="hljs-keyword">void</span> <span class="hljs-title function_">appNotResponding</span><span class="hljs-params">(String activityShortComponentName, ApplicationInfo aInfo,
            String parentShortComponentName, WindowProcessController parentProcess,
            <span class="hljs-type">boolean</span> aboveSystem, TimeoutRecord timeoutRecord,
            ExecutorService auxiliaryTaskExecutor, <span class="hljs-type">boolean</span> onlyDumpSelf,
            <span class="hljs-type">boolean</span> isContinuousAnr, Future&lt;File&gt; firstPidFilePromise)</span> {
        ...

    <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> isSilentAnr;
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> pid;
    <span class="hljs-keyword">final</span> UUID errorId;
    latencyTracker.waitingOnAMSLockStarted();

    <span class="hljs-comment">// Build memory headers for the ANRing process.</span>
    <span class="hljs-comment">// æ”¶é›† ANRçš„å†…å­˜ä¿¡æ¯</span>
    LinkedHashMap&lt;String, String&gt; memoryHeaders = buildMemoryHeadersFor(pid); <span class="hljs-comment">//æ³¨é‡Š81</span>

    ...

    <span class="hljs-comment">// We push the native pids collection task to the helper thread through</span>
    <span class="hljs-comment">// the Anr auxiliary task executor, and wait on it later after dumping the first pids</span>
    <span class="hljs-comment">// æ”¶é›†native ä¿¡æ¯</span>
    Future&lt;ArrayList&lt;Integer&gt;&gt; nativePidsFuture =
            auxiliaryTaskExecutor.submit(
                () -&gt; {
                   ...
                    <span class="hljs-keyword">return</span> nativePids;
                });

    <span class="hljs-comment">// For background ANRs, don't pass the ProcessCpuTracker to</span>
    <span class="hljs-comment">// avoid spending 1/2 second collecting stats to rank lastPids.</span>
    <span class="hljs-type">StringWriter</span> <span class="hljs-variable">tracesFileException</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringWriter</span>();
    <span class="hljs-comment">// To hold the start and end offset to the ANR trace file respectively.</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicLong</span> <span class="hljs-variable">firstPidEndOffset</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicLong</span>(-<span class="hljs-number">1</span>);
    <span class="hljs-comment">//æ„é€ trace file æ–‡ä»¶ å¹¶dump trace ä¿¡æ¯</span>
    <span class="hljs-type">File</span> <span class="hljs-variable">tracesFile</span> <span class="hljs-operator">=</span> StackTracesDumpHelper.dumpStackTraces(firstPids,
            isSilentAnr ? <span class="hljs-literal">null</span> : processCpuTracker, isSilentAnr ? <span class="hljs-literal">null</span> : lastPids,
            nativePidsFuture, tracesFileException, firstPidEndOffset, annotation,
            criticalEventLog, memoryHeaders, auxiliaryTaskExecutor, firstPidFilePromise,
            latencyTracker);<span class="hljs-comment">// æ³¨é‡Š82</span>

    ...
    <span class="hljs-keyword">synchronized</span> (mService) {
        ...
        <span class="hljs-comment">//åå°åº”ç”¨ANRç›´æ¥killæ‰</span>
        <span class="hljs-keyword">if</span> (isSilentAnr() &amp;&amp; !mApp.isDebugging()) {
            mApp.killLocked(<span class="hljs-string">"bg anr"</span>, ApplicationExitInfo.REASON_ANR, <span class="hljs-literal">true</span>);ã€ã€æ³¨é‡Š<span class="hljs-number">83</span>
            <span class="hljs-keyword">return</span>;
        }
        ...
        <span class="hljs-keyword">if</span> (mService.mUiHandler != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// Bring up the infamous App Not Responding dialog</span>
            <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> Message.obtain();
            msg.what = ActivityManagerService.SHOW_NOT_RESPONDING_UI_MSG;
            msg.obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppNotRespondingDialog</span>.Data(mApp, aInfo, aboveSystem,
                    isContinuousAnr);
            <span class="hljs-comment">// å‘é€æ¶ˆæ¯SHOW_NOT_RESPONDING_UI_MSG åˆ°ä¸»çº¿ç¨‹ å¤„ç†</span>
            mService.mUiHandler.sendMessageDelayed(msg, anrDialogDelayMs);<span class="hljs-comment">//æ³¨é‡Š84</span>
        }
    }
}

</code></pre>
<ul>
<li><strong>æ³¨é‡Š81</strong> æ”¶é›†ANRçš„å†…å­˜ä¿¡æ¯</li>
<li><strong>æ³¨é‡Š82</strong> è¿™é‡Œæ˜¯é€šè¿‡å®ˆæŠ¤è¿›ç¨‹Debuggeræ¥æ”¶é›†Trace ä¿¡æ¯å¹¶ç”ŸæˆTraceæ–‡ä»¶ï¼Œè¿™é‡Œçš„ç»†èŠ‚åç»­ä¼šåœ¨å†…å­˜ä¼˜åŒ–çš„ç³»åˆ—æ–‡ç« ä¸­è®²è§£ã€‚</li>
<li><strong>æ³¨é‡Š83</strong> å¦‚æœå‘ç”ŸANRçš„è¿›ç¨‹ä¸åœ¨å‰å°ï¼Œåˆ™ç›´æ¥killæ‰</li>
<li><strong>æ³¨é‡Š84</strong> å‘é€ SHOW_NOT_RESPONDING_UI_MSG ç±»å‹çš„æ¶ˆæ¯åˆ°AMSçš„ä¸»çº¿ç¨‹åšå¼¹çª—å¤„ç†ï¼Œåé¢çš„é€»è¾‘å°±æ¯”è¾ƒç®€å•äº†ï¼Œè¿™é‡Œä¹Ÿä¸å±•å¼€äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œé˜…è¯»æºç ã€‚</li>
</ul>
<h2 data-id="heading-10">8.æ€»ç»“</h2>
<p><code>InputReader</code>è´Ÿè´£ä¸€ç›´è¯»å–<code>EventHub</code>ä¸­ç›‘å¬åˆ°çš„è®¾å¤‡çš„äº‹ä»¶è¾“å…¥å’Œäº‹ä»¶å°è£…ï¼Œå¹¶å°†äº‹ä»¶ä¼ é€’ç»™<code>InputDispatcher</code>çš„é˜Ÿåˆ—ä¸­ï¼Œè€Œ<code>InputDispatcher</code>åˆ™è´Ÿè´£è¯»å–é˜Ÿåˆ—ä¸­çš„äº‹ä»¶å¹¶é€šè¿‡<code>socket</code>ä¼ é€’ç»™<code>IMS</code>å’Œ<code>WMS</code>å¯¹åº”çš„çª—å£çš„<code>ViewRootImpl</code>ç»‘å®šçš„<code>InpuChannel</code>çš„<code>socket</code>,å†ç»ç”±<code>InputState</code>è¿›è¡Œäº‹ä»¶çš„å¤„ç†ï¼Œ<code>InputState</code>å¤„ç†å®Œå†é€šè¿‡ <code>InputChannel</code> çš„<code>socket</code>å°†ç»“æŸæ ‡è®°å›ä¼ ç»™<code>InputDispatcher</code>ï¼Œæ­¤æ—¶<code>InputDispatcher</code>æ›´æ–°ANRæ ‡è®°å’Œåˆ†å‘ä¸‹ä¸€æ‰¹äº‹ä»¶.</p>
<p>è¿™é‡Œå†æ¥ä¸€å¼ å®Œæ•´çš„æµç¨‹å›¾</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0030b83c1e6f488e8b9ec3a3822674bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ2FycnlaaGFuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768134762&amp;x-signature=iEGzfS1EE5yhZWMfvnnXqDE6rug%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ComposeåŸç†äºŒä¹‹GapBuffer]]></title>    <link>https://juejin.cn/post/7591338980693852206</link>    <guid>https://juejin.cn/post/7591338980693852206</guid>    <pubDate>2026-01-04T13:33:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591338980693852206" data-draft-id="7591334208997474330" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ComposeåŸç†äºŒä¹‹GapBuffer"/> <meta itemprop="keywords" content="Android,æ¶æ„"/> <meta itemprop="datePublished" content="2026-01-04T13:33:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è£´äº‘é£"/> <meta itemprop="url" content="https://juejin.cn/user/3734361144570285"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ComposeåŸç†äºŒä¹‹GapBuffer
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3734361144570285/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è£´äº‘é£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T13:33:07.000Z" title="Sun Jan 04 2026 13:33:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¼ ç»Ÿæ•°ç»„çš„æ’å…¥æ—¶é—´å¤æ‚åº¦æ˜¯O(n)ï¼ŒGapBufferå°±æ˜¯ä¸ºäº†è§£å†³æ•°ç»„æ’å…¥æ…¢çš„é—®é¢˜ã€‚GapBufferæ˜¯ä¸€ç§ä¼˜åŒ–çš„æ•°æ®ç»“æ„ï¼Œç”¨äºé«˜æ•ˆåœ°åœ¨ä»»æ„ä½ç½®è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ç»´æŠ¤ä¸€ä¸ª"é—´éš™"ï¼ˆgapï¼‰ï¼Œåœ¨é—´éš™ä½ç½®çš„æ’å…¥/åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦æ˜¯ O(1) ã€‚</p>
<p>ç›´æ¥ä¸Šä»£ç ï¼Œæœ‰è¯¦ç»†çš„ä»£ç æ³¨é‡Šã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin">
<span class="hljs-comment">/**
 * Gap Buffer æ•°æ®ç»“æ„å®ç°
 *
 * Gap Buffer æ˜¯ä¸€ç§ä¼˜åŒ–çš„æ•°æ®ç»“æ„ï¼Œç”¨äºé«˜æ•ˆåœ°åœ¨ä»»æ„ä½ç½®è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œã€‚
 * å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ç»´æŠ¤ä¸€ä¸ª"é—´éš™"ï¼ˆgapï¼‰ï¼Œåœ¨é—´éš™ä½ç½®çš„æ’å…¥/åˆ é™¤æ˜¯ O(1) çš„ã€‚
 *
 * ç»“æ„ç¤ºæ„å›¾:
 * ```
 * [A][B][C][_][_][_][_][D][E][F]
 *          â†‘           â†‘
 *       gapStart    gapEnd
 *
 * é€»è¾‘å†…å®¹: [A, B, C, D, E, F]
 * ```
 *
 * è¿™æ˜¯ Compose Runtime ä¸­ SlotTable ä½¿ç”¨çš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GapBuffer</span>&lt;<span class="hljs-type">T</span>&gt;(initialCapacity: <span class="hljs-built_in">Int</span> = <span class="hljs-number">16</span>) {

    <span class="hljs-comment">// å†…éƒ¨æ•°ç»„å­˜å‚¨</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> buffer: Array&lt;Any?&gt; = arrayOfNulls(initialCapacity)

    <span class="hljs-comment">// é—´éš™èµ·å§‹ä½ç½®ï¼ˆåŒ…å«ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> gapStart: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>

    <span class="hljs-comment">// é—´éš™ç»“æŸä½ç½®ï¼ˆä¸åŒ…å«ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> gapEnd: <span class="hljs-built_in">Int</span> = initialCapacity

    <span class="hljs-comment">/**
     * é€»è¾‘å¤§å°ï¼ˆä¸åŒ…å«é—´éš™ï¼‰
     */</span>
    <span class="hljs-keyword">val</span> size: <span class="hljs-built_in">Int</span>
        <span class="hljs-keyword">get</span>() = buffer.size - gapSize

    <span class="hljs-comment">/**
     * é—´éš™å¤§å°
     */</span>
    <span class="hljs-keyword">val</span> gapSize: <span class="hljs-built_in">Int</span>
        <span class="hljs-keyword">get</span>() = gapEnd - gapStart

    <span class="hljs-comment">/**
     * å½“å‰é—´éš™ä½ç½®
     */</span>
    <span class="hljs-keyword">val</span> currentGapStart: <span class="hljs-built_in">Int</span>
        <span class="hljs-keyword">get</span>() = gapStart

    <span class="hljs-comment">/**
     * åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ 
     *
     * æ­¥éª¤ï¼š
     * 1. å¦‚æœé—´éš™å¤§å°ä¸º 0ï¼Œæ‰©å®¹
     * 2. å°†é—´éš™ç§»åŠ¨åˆ°æ’å…¥ä½ç½®
     * 3. åœ¨é—´éš™èµ·å§‹ä½ç½®æ’å…¥å…ƒç´ 
     * 4. gapStart++
     *
     * <span class="hljs-doctag">@param</span> index é€»è¾‘ç´¢å¼•ä½ç½®
     * <span class="hljs-doctag">@param</span> element è¦æ’å…¥çš„å…ƒç´ 
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insert</span><span class="hljs-params">(index: <span class="hljs-type">Int</span>, element: <span class="hljs-type">T</span>)</span></span> {
        require(index <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span>.size) { <span class="hljs-string">"Index <span class="hljs-variable">$index</span> out of bounds for size <span class="hljs-variable">$size</span>"</span> }

        <span class="hljs-comment">// 1. éœ€è¦æ—¶æ‰©å®¹</span>
        <span class="hljs-keyword">if</span> (gapSize == <span class="hljs-number">0</span>) {
            grow()
        }

        <span class="hljs-comment">// 2. ç§»åŠ¨é—´éš™åˆ°ç›®æ ‡ä½ç½®</span>
        moveGap(index)

        <span class="hljs-comment">// 3. åœ¨é—´éš™ä½ç½®æ’å…¥</span>
        buffer[gapStart] = element

        <span class="hljs-comment">// 4. ç¼©å°é—´éš™</span>
        gapStart++
    }

    <span class="hljs-comment">/**
     * åœ¨æŒ‡å®šä½ç½®æ’å…¥å¤šä¸ªå…ƒç´ 
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertAll</span><span class="hljs-params">(index: <span class="hljs-type">Int</span>, elements: <span class="hljs-type">List</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span> {
        require(index <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span>.size) { <span class="hljs-string">"Index <span class="hljs-variable">$index</span> out of bounds for size <span class="hljs-variable">$size</span>"</span> }

        <span class="hljs-comment">// ç¡®ä¿æœ‰è¶³å¤Ÿç©ºé—´</span>
        <span class="hljs-keyword">while</span> (gapSize &lt; elements.size) {
            grow()
        }

        <span class="hljs-comment">// ç§»åŠ¨é—´éš™åˆ°ç›®æ ‡ä½ç½®</span>
        moveGap(index)

        <span class="hljs-comment">// é€ä¸ªæ’å…¥</span>
        <span class="hljs-keyword">for</span> (element <span class="hljs-keyword">in</span> elements) {
            buffer[gapStart] = element
            gapStart++
        }
    }

    <span class="hljs-comment">/**
     * åˆ é™¤æŒ‡å®šä½ç½®çš„å…ƒç´ 
     *
     * æ­¥éª¤ï¼š
     * 1. å°†é—´éš™ç§»åŠ¨åˆ°åˆ é™¤ä½ç½®
     * 2. gapEnd++ (æ‰©å¤§é—´éš™ï¼Œè¦†ç›–è¦åˆ é™¤çš„å…ƒç´ )
     *
     * <span class="hljs-doctag">@param</span> index é€»è¾‘ç´¢å¼•ä½ç½®
     * <span class="hljs-doctag">@return</span> è¢«åˆ é™¤çš„å…ƒç´ 
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">removeAt</span><span class="hljs-params">(index: <span class="hljs-type">Int</span>)</span></span>: T {
        require(index <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until size) { <span class="hljs-string">"Index <span class="hljs-variable">$index</span> out of bounds for size <span class="hljs-variable">$size</span>"</span> }

        <span class="hljs-comment">// ç§»åŠ¨é—´éš™åˆ°ç›®æ ‡ä½ç½®åé¢</span>
        moveGap(index + <span class="hljs-number">1</span>)

        <span class="hljs-comment">// æ‰©å¤§é—´éš™çš„èµ·å§‹ä½ç½®ï¼ˆç›¸å½“äºåˆ é™¤å…ƒç´ ï¼‰</span>
        gapStart--

        <span class="hljs-comment">// è·å–å¹¶æ¸…é™¤è¢«åˆ é™¤çš„å…ƒç´ </span>
        <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
        <span class="hljs-keyword">val</span> removed = buffer[gapStart] <span class="hljs-keyword">as</span> T
        buffer[gapStart] = <span class="hljs-literal">null</span>

        <span class="hljs-keyword">return</span> removed
    }

    <span class="hljs-comment">/**
     * åˆ é™¤æŒ‡å®šèŒƒå›´çš„å…ƒç´ 
     *
     * <span class="hljs-doctag">@param</span> startIndex èµ·å§‹ç´¢å¼•ï¼ˆåŒ…å«ï¼‰
     * <span class="hljs-doctag">@param</span> endIndex ç»“æŸç´¢å¼•ï¼ˆä¸åŒ…å«ï¼‰
     * <span class="hljs-doctag">@return</span> è¢«åˆ é™¤çš„å…ƒç´ åˆ—è¡¨
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">removeRange</span><span class="hljs-params">(startIndex: <span class="hljs-type">Int</span>, endIndex: <span class="hljs-type">Int</span>)</span></span>: List&lt;T&gt; {
        require(startIndex <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span>.size) { <span class="hljs-string">"Start index <span class="hljs-variable">$startIndex</span> out of bounds"</span> }
        require(endIndex <span class="hljs-keyword">in</span> startIndex..size) { <span class="hljs-string">"End index <span class="hljs-variable">$endIndex</span> out of bounds"</span> }

        <span class="hljs-keyword">val</span> count = endIndex - startIndex
        <span class="hljs-keyword">if</span> (count == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> emptyList()

        <span class="hljs-keyword">val</span> removed = mutableListOf&lt;T&gt;()

        <span class="hljs-comment">// ç§»åŠ¨é—´éš™åˆ°åˆ é™¤èŒƒå›´ä¹‹å</span>
        moveGap(endIndex)

        <span class="hljs-comment">// æ”¶é›†è¢«åˆ é™¤çš„å…ƒç´ å¹¶æ‰©å¤§é—´éš™</span>
        repeat(count) {
            gapStart--
            <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
            removed.add(<span class="hljs-number">0</span>, buffer[gapStart] <span class="hljs-keyword">as</span> T)
            buffer[gapStart] = <span class="hljs-literal">null</span>
        }

        <span class="hljs-keyword">return</span> removed
    }

    <span class="hljs-comment">/**
     * è·å–æŒ‡å®šä½ç½®çš„å…ƒç´ 
     *
     * éœ€è¦å¤„ç†é€»è¾‘ç´¢å¼•åˆ°ç‰©ç†ç´¢å¼•çš„è½¬æ¢
     */</span>
    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">(index: <span class="hljs-type">Int</span>)</span></span>: T {
        require(index <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until size) { <span class="hljs-string">"Index <span class="hljs-variable">$index</span> out of bounds for size <span class="hljs-variable">$size</span>"</span> }
        <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
        <span class="hljs-keyword">return</span> buffer[toPhysicalIndex(index)] <span class="hljs-keyword">as</span> T
    }

    <span class="hljs-comment">/**
     * è®¾ç½®æŒ‡å®šä½ç½®çš„å…ƒç´ 
     */</span>
    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">set</span><span class="hljs-params">(index: <span class="hljs-type">Int</span>, element: <span class="hljs-type">T</span>)</span></span> {
        require(index <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until size) { <span class="hljs-string">"Index <span class="hljs-variable">$index</span> out of bounds for size <span class="hljs-variable">$size</span>"</span> }
        buffer[toPhysicalIndex(index)] = element
    }

    <span class="hljs-comment">/**
     * å°†é€»è¾‘ç´¢å¼•è½¬æ¢ä¸ºç‰©ç†ç´¢å¼•
     *
     * é€»è¾‘è§†å›¾: [A][B][C][D][E][F]
     *            0  1  2  3  4  5
     *
     * ç‰©ç†æ•°ç»„: [A][B][C][_][_][_][D][E][F]
     *            0  1  2  3  4  5  6  7  8
     *                     â†‘        â†‘
     *                  gapStart  gapEnd
     *
     * é€»è¾‘ç´¢å¼• 0-2 ç›´æ¥å¯¹åº”ç‰©ç†ç´¢å¼• 0-2
     * é€»è¾‘ç´¢å¼• 3-5 éœ€è¦åŠ ä¸Š gapSize
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toPhysicalIndex</span><span class="hljs-params">(logicalIndex: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (logicalIndex &lt; gapStart) {
            logicalIndex
        } <span class="hljs-keyword">else</span> {
            logicalIndex + gapSize
        }
    }

    <span class="hljs-comment">/**
     * ç§»åŠ¨é—´éš™åˆ°ç›®æ ‡ä½ç½®
     *
     * è¿™æ˜¯ Gap Buffer çš„æ ¸å¿ƒæ“ä½œã€‚
     *
     * åœºæ™¯1: é—´éš™å‘å³ç§»åŠ¨ (targetIndex &gt; gapStart)
     * ```
     * ç§»åŠ¨å‰: [A][B][_][_][_][C][D][E]
     *               â†‘        â†‘
     *            gapStart  gapEnd
     *
     * ç›®æ ‡: ç§»åŠ¨åˆ°ç´¢å¼• 4
     *
     * æ“ä½œ: æŠŠ gapEnd åˆ° gapEnd+ç§»åŠ¨è·ç¦» çš„å…ƒç´ å¤åˆ¶åˆ° gapStart
     *       [A][B][C][D][_][_][_][E]
     *
     * ç§»åŠ¨å: [A][B][C][D][_][_][_][E]
     *                     â†‘        â†‘
     *                  gapStart  gapEnd
     * ```
     *
     * åœºæ™¯2: é—´éš™å‘å·¦ç§»åŠ¨ (targetIndex &lt; gapStart)
     * ```
     * ç§»åŠ¨å‰: [A][B][C][D][_][_][_][E]
     *                     â†‘        â†‘
     *                  gapStart  gapEnd
     *
     * ç›®æ ‡: ç§»åŠ¨åˆ°ç´¢å¼• 1
     *
     * æ“ä½œ: æŠŠ targetIndex åˆ° gapStart çš„å…ƒç´ å¤åˆ¶åˆ° gapEnd ä¹‹å‰
     *       [A][_][_][_][B][C][D][E]
     *
     * ç§»åŠ¨å: [A][_][_][_][B][C][D][E]
     *            â†‘        â†‘
     *         gapStart  gapEnd
     * ```
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">moveGap</span><span class="hljs-params">(targetIndex: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-keyword">if</span> (targetIndex == gapStart) {
            <span class="hljs-comment">// é—´éš™å·²åœ¨ç›®æ ‡ä½ç½®</span>
            <span class="hljs-keyword">return</span>
        }

        <span class="hljs-keyword">if</span> (targetIndex &gt; gapStart) {
            <span class="hljs-comment">// é—´éš™å‘å³ç§»åŠ¨</span>
            <span class="hljs-comment">// éœ€è¦æŠŠé—´éš™å³è¾¹çš„å…ƒç´ ç§»åˆ°å·¦è¾¹</span>

            <span class="hljs-keyword">val</span> moveCount = targetIndex - gapStart
            <span class="hljs-comment">// ä» gapEnd å¤åˆ¶ moveCount ä¸ªå…ƒç´ åˆ° gapStart</span>
            <span class="hljs-comment">// copyInto(destination, destinationOffset, startIndex, endIndex)</span>
            buffer.copyInto(buffer, gapStart, gapEnd, gapEnd + moveCount)
            <span class="hljs-comment">// æ¸…é™¤åŸä½ç½®</span>
            <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> gapEnd until gapEnd + moveCount) {
                buffer[i] = <span class="hljs-literal">null</span>
            }
            <span class="hljs-comment">// æ›´æ–°é—´éš™ä½ç½®</span>
            gapStart += moveCount
            gapEnd += moveCount

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// é—´éš™å‘å·¦ç§»åŠ¨</span>
            <span class="hljs-comment">// éœ€è¦æŠŠé—´éš™å·¦è¾¹çš„å…ƒç´ ç§»åˆ°å³è¾¹</span>

            <span class="hljs-keyword">val</span> moveCount = gapStart - targetIndex
            <span class="hljs-comment">// ä» targetIndex å¤åˆ¶ moveCount ä¸ªå…ƒç´ åˆ° gapEnd - moveCount</span>
            <span class="hljs-comment">// copyInto(destination, destinationOffset, startIndex, endIndex)</span>
            buffer.copyInto(buffer, gapEnd - moveCount, targetIndex, targetIndex + moveCount)
            <span class="hljs-comment">// æ¸…é™¤åŸä½ç½®</span>
            <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> targetIndex until targetIndex + moveCount) {
                buffer[i] = <span class="hljs-literal">null</span>
            }
            <span class="hljs-comment">// æ›´æ–°é—´éš™ä½ç½®</span>
            gapStart -= moveCount
            gapEnd -= moveCount
        }
    }

    <span class="hljs-comment">/**
     * æ‰©å®¹
     *
     * ç­–ç•¥: å®¹é‡ç¿»å€ï¼Œæ–°ç©ºé—´å…¨éƒ¨åŠ å…¥é—´éš™
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">grow</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> oldCapacity = buffer.size
        <span class="hljs-keyword">val</span> newCapacity = oldCapacity * <span class="hljs-number">2</span>
        <span class="hljs-keyword">val</span> newBuffer = arrayOfNulls&lt;Any?&gt;(newCapacity)

        <span class="hljs-comment">// å¤åˆ¶é—´éš™ä¹‹å‰çš„å…ƒç´ </span>
        <span class="hljs-comment">// copyInto(destination, destinationOffset, startIndex, endIndex)</span>
        buffer.copyInto(newBuffer, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, gapStart)

        <span class="hljs-comment">// å¤åˆ¶é—´éš™ä¹‹åçš„å…ƒç´ ï¼ˆæ”¾åˆ°æ–°æ•°ç»„çš„æœ«å°¾ï¼‰</span>
        <span class="hljs-keyword">val</span> afterGapCount = oldCapacity - gapEnd
        <span class="hljs-keyword">val</span> newGapEnd = newCapacity - afterGapCount
        buffer.copyInto(newBuffer, newGapEnd, gapEnd, oldCapacity)

        buffer = newBuffer
        gapEnd = newGapEnd
    }

    <span class="hljs-comment">/**
     * è·å–å½“å‰çŠ¶æ€çš„å¯è§†åŒ–å­—ç¬¦ä¸²
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">visualize</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">val</span> sb = StringBuilder()
        sb.append(<span class="hljs-string">"GapBuffer(size=<span class="hljs-variable">$size</span>, capacity=<span class="hljs-subst">${buffer.size}</span>, gap=<span class="hljs-variable">$gapStart</span>..<span class="hljs-variable">$gapEnd</span>)\n"</span>)
        sb.append(<span class="hljs-string">"Physical: ["</span>)
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> buffer.indices) {
            <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) sb.append(<span class="hljs-string">"]["</span>)
            <span class="hljs-keyword">if</span> (i <span class="hljs-keyword">in</span> gapStart until gapEnd) {
                sb.append(<span class="hljs-string">"_"</span>)
            } <span class="hljs-keyword">else</span> {
                sb.append(buffer[i] ?: <span class="hljs-string">"null"</span>)
            }
        }
        sb.append(<span class="hljs-string">"]\n"</span>)
        sb.append(<span class="hljs-string">"Logical:  ["</span>)
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until size) {
            <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) sb.append(<span class="hljs-string">", "</span>)
            sb.append(<span class="hljs-keyword">get</span>(i))
        }
        sb.append(<span class="hljs-string">"]"</span>)
        <span class="hljs-keyword">return</span> sb.toString()
    }

    <span class="hljs-comment">/**
     * è½¬æ¢ä¸ºåˆ—è¡¨
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toList</span><span class="hljs-params">()</span></span>: List&lt;T&gt; {
        <span class="hljs-keyword">val</span> result = mutableListOf&lt;T&gt;()
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until size) {
            result.add(<span class="hljs-keyword">get</span>(i))
        }
        <span class="hljs-keyword">return</span> result
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toString</span><span class="hljs-params">()</span></span>: String = toList().toString()
}

</code></pre>
<p>ä¸Šé¢å°±æ˜¯GapBufferçš„å®ç°ä»£ç ï¼Œåˆæ¬¡æŸ¥çœ‹å¯èƒ½æœ‰ç‚¹éš¾ä»¥ç†è§£ï¼Œä¸‹é¢æ˜¯å¸¦è¯¦ç»†æ—¥å¿—çš„GapBufferï¼Œç”¨äºæ¼”ç¤ºæ‰§è¡Œæµç¨‹ã€‚åœºæ™¯æ˜¯æ„å»º [1,2,4,5,6]ï¼Œç„¶ååœ¨2åé¢æ’å…¥3ï¼Œçœ‹ä¸‹æ‰§è¡Œæµç¨‹ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * å¸¦è¯¦ç»†æ—¥å¿—çš„ GapBufferï¼Œç”¨äºæ¼”ç¤ºæ‰§è¡Œæµç¨‹
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GapBufferDebug</span>&lt;<span class="hljs-type">T</span>&gt;(initialCapacity: <span class="hljs-built_in">Int</span> = <span class="hljs-number">16</span>) {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> buffer: Array&lt;Any?&gt; = arrayOfNulls(initialCapacity)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> gapStart: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> gapEnd: <span class="hljs-built_in">Int</span> = initialCapacity

    <span class="hljs-keyword">val</span> size: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">get</span>() = buffer.size - gapSize
    <span class="hljs-keyword">val</span> gapSize: <span class="hljs-built_in">Int</span> <span class="hljs-keyword">get</span>() = gapEnd - gapStart

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insert</span><span class="hljs-params">(index: <span class="hljs-type">Int</span>, element: <span class="hljs-type">T</span>)</span></span> {
        println(<span class="hljs-string">"â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"</span>)
        println(<span class="hljs-string">"â”‚ è°ƒç”¨ insert(index=<span class="hljs-variable">$index</span>, element=<span class="hljs-variable">$element</span>)"</span>)
        println(<span class="hljs-string">"â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"</span>)
        println(<span class="hljs-string">"â”‚ ã€è¿›å…¥ insert æ–¹æ³•ã€‘"</span>)
        println(<span class="hljs-string">"â”‚   å½“å‰çŠ¶æ€:"</span>)
        println(<span class="hljs-string">"â”‚     size = <span class="hljs-variable">$size</span>"</span>)
        println(<span class="hljs-string">"â”‚     gapStart = <span class="hljs-variable">$gapStart</span>"</span>)
        println(<span class="hljs-string">"â”‚     gapEnd = <span class="hljs-variable">$gapEnd</span>"</span>)
        println(<span class="hljs-string">"â”‚     gapSize = <span class="hljs-variable">$gapSize</span>"</span>)
        println(<span class="hljs-string">"â”‚     buffer = <span class="hljs-subst">${bufferToString()}</span>"</span>)
        println(<span class="hljs-string">"â”‚"</span>)

        require(index <span class="hljs-keyword">in</span> <span class="hljs-number">0.</span>.size) { <span class="hljs-string">"Index <span class="hljs-variable">$index</span> out of bounds for size <span class="hljs-variable">$size</span>"</span> }

        <span class="hljs-comment">// 1. æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹</span>
        println(<span class="hljs-string">"â”‚ ã€æ­¥éª¤1ã€‘æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹"</span>)
        println(<span class="hljs-string">"â”‚   gapSize (<span class="hljs-variable">$gapSize</span>) == 0 ? <span class="hljs-subst">${gapSize == <span class="hljs-number">0</span>}</span>"</span>)
        <span class="hljs-keyword">if</span> (gapSize == <span class="hljs-number">0</span>) {
            println(<span class="hljs-string">"â”‚   â†’ éœ€è¦æ‰©å®¹ï¼Œè°ƒç”¨ grow()"</span>)
            grow()
        } <span class="hljs-keyword">else</span> {
            println(<span class="hljs-string">"â”‚   â†’ ä¸éœ€è¦æ‰©å®¹"</span>)
        }
        println(<span class="hljs-string">"â”‚"</span>)

        <span class="hljs-comment">// 2. ç§»åŠ¨é—´éš™åˆ°ç›®æ ‡ä½ç½®</span>
        println(<span class="hljs-string">"â”‚ ã€æ­¥éª¤2ã€‘ç§»åŠ¨é—´éš™åˆ°ç›®æ ‡ä½ç½® (targetIndex=<span class="hljs-variable">$index</span>)"</span>)
        moveGap(index)
        println(<span class="hljs-string">"â”‚"</span>)

        <span class="hljs-comment">// 3. åœ¨é—´éš™ä½ç½®æ’å…¥</span>
        println(<span class="hljs-string">"â”‚ ã€æ­¥éª¤3ã€‘åœ¨é—´éš™ä½ç½®æ’å…¥å…ƒç´ "</span>)
        println(<span class="hljs-string">"â”‚   buffer[<span class="hljs-variable">$gapStart</span>] = <span class="hljs-variable">$element</span>"</span>)
        buffer[gapStart] = element
        println(<span class="hljs-string">"â”‚   æ’å…¥å buffer = <span class="hljs-subst">${bufferToString()}</span>"</span>)
        println(<span class="hljs-string">"â”‚"</span>)

        <span class="hljs-comment">// 4. ç¼©å°é—´éš™</span>
        println(<span class="hljs-string">"â”‚ ã€æ­¥éª¤4ã€‘ç¼©å°é—´éš™ (gapStart++)"</span>)
        println(<span class="hljs-string">"â”‚   gapStart: <span class="hljs-variable">$gapStart</span> â†’ <span class="hljs-subst">${gapStart + <span class="hljs-number">1</span>}</span>"</span>)
        gapStart++
        println(<span class="hljs-string">"â”‚"</span>)

        println(<span class="hljs-string">"â”‚ ã€æ’å…¥å®Œæˆã€‘"</span>)
        println(<span class="hljs-string">"â”‚   æœ€ç»ˆçŠ¶æ€:"</span>)
        println(<span class="hljs-string">"â”‚     size = <span class="hljs-variable">$size</span>"</span>)
        println(<span class="hljs-string">"â”‚     gapStart = <span class="hljs-variable">$gapStart</span>"</span>)
        println(<span class="hljs-string">"â”‚     gapEnd = <span class="hljs-variable">$gapEnd</span>"</span>)
        println(<span class="hljs-string">"â”‚     gapSize = <span class="hljs-variable">$gapSize</span>"</span>)
        println(<span class="hljs-string">"â”‚     buffer = <span class="hljs-subst">${bufferToString()}</span>"</span>)
        println(<span class="hljs-string">"â”‚     é€»è¾‘å†…å®¹ = <span class="hljs-subst">${toList()}</span>"</span>)
        println(<span class="hljs-string">"â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"</span>)
        println()
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">moveGap</span><span class="hljs-params">(targetIndex: <span class="hljs-type">Int</span>)</span></span> {
        println(<span class="hljs-string">"â”‚   â”Œâ”€ moveGap(targetIndex=<span class="hljs-variable">$targetIndex</span>) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"</span>)
        println(<span class="hljs-string">"â”‚   â”‚ å½“å‰ gapStart=<span class="hljs-variable">$gapStart</span>, gapEnd=<span class="hljs-variable">$gapEnd</span>"</span>)
        println(<span class="hljs-string">"â”‚   â”‚ ç›®æ ‡ä½ç½® targetIndex=<span class="hljs-variable">$targetIndex</span>"</span>)

        <span class="hljs-keyword">if</span> (targetIndex == gapStart) {
            println(<span class="hljs-string">"â”‚   â”‚ targetIndex == gapStartï¼Œé—´éš™å·²åœ¨ç›®æ ‡ä½ç½®ï¼Œæ— éœ€ç§»åŠ¨"</span>)
            println(<span class="hljs-string">"â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"</span>)
            <span class="hljs-keyword">return</span>
        }

        <span class="hljs-keyword">if</span> (targetIndex &gt; gapStart) {
            <span class="hljs-comment">// é—´éš™å‘å³ç§»åŠ¨</span>
            println(<span class="hljs-string">"â”‚   â”‚ targetIndex (<span class="hljs-variable">$targetIndex</span>) &gt; gapStart (<span class="hljs-variable">$gapStart</span>)"</span>)
            println(<span class="hljs-string">"â”‚   â”‚ â†’ é—´éš™éœ€è¦ã€å‘å³ç§»åŠ¨ã€‘"</span>)
            println(<span class="hljs-string">"â”‚   â”‚"</span>)
            
            <span class="hljs-keyword">val</span> moveCount = targetIndex - gapStart
            println(<span class="hljs-string">"â”‚   â”‚ è®¡ç®—: moveCount = targetIndex - gapStart = <span class="hljs-variable">$targetIndex</span> - <span class="hljs-variable">$gapStart</span> = <span class="hljs-variable">$moveCount</span>"</span>)
            println(<span class="hljs-string">"â”‚   â”‚"</span>)
            
            println(<span class="hljs-string">"â”‚   â”‚ æ“ä½œ: æŠŠé—´éš™å³è¾¹çš„ <span class="hljs-variable">$moveCount</span> ä¸ªå…ƒç´ ç§»åˆ°é—´éš™å·¦è¾¹"</span>)
            println(<span class="hljs-string">"â”‚   â”‚   copyInto(buffer, destOffset=<span class="hljs-variable">$gapStart</span>, startIndex=<span class="hljs-variable">$gapEnd</span>, endIndex=<span class="hljs-subst">${gapEnd + moveCount}</span>)"</span>)
            println(<span class="hljs-string">"â”‚   â”‚   å³: æŠŠ buffer[<span class="hljs-variable">$gapEnd</span>..<span class="hljs-subst">${gapEnd + moveCount - <span class="hljs-number">1</span>}</span>] å¤åˆ¶åˆ° buffer[<span class="hljs-variable">$gapStart</span>..<span class="hljs-subst">${gapStart + moveCount - <span class="hljs-number">1</span>}</span>]"</span>)
            println(<span class="hljs-string">"â”‚   â”‚"</span>)
            println(<span class="hljs-string">"â”‚   â”‚ ç§»åŠ¨å‰: <span class="hljs-subst">${bufferToString()}</span>"</span>)
            
            buffer.copyInto(buffer, gapStart, gapEnd, gapEnd + moveCount)
            
            println(<span class="hljs-string">"â”‚   â”‚ å¤åˆ¶å: <span class="hljs-subst">${bufferToString()}</span>"</span>)
            
            <span class="hljs-comment">// æ¸…é™¤åŸä½ç½®</span>
            println(<span class="hljs-string">"â”‚   â”‚"</span>)
            println(<span class="hljs-string">"â”‚   â”‚ æ¸…é™¤åŸä½ç½® buffer[<span class="hljs-variable">$gapEnd</span>..<span class="hljs-subst">${gapEnd + moveCount - <span class="hljs-number">1</span>}</span>]"</span>)
            <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> gapEnd until gapEnd + moveCount) {
                buffer[i] = <span class="hljs-literal">null</span>
            }
            println(<span class="hljs-string">"â”‚   â”‚ æ¸…é™¤å: <span class="hljs-subst">${bufferToString()}</span>"</span>)
            
            <span class="hljs-comment">// æ›´æ–°é—´éš™ä½ç½®</span>
            println(<span class="hljs-string">"â”‚   â”‚"</span>)
            println(<span class="hljs-string">"â”‚   â”‚ æ›´æ–°é—´éš™ä½ç½®:"</span>)
            println(<span class="hljs-string">"â”‚   â”‚   gapStart: <span class="hljs-variable">$gapStart</span> â†’ <span class="hljs-subst">${gapStart + moveCount}</span>"</span>)
            println(<span class="hljs-string">"â”‚   â”‚   gapEnd: <span class="hljs-variable">$gapEnd</span> â†’ <span class="hljs-subst">${gapEnd + moveCount}</span>"</span>)
            gapStart += moveCount
            gapEnd += moveCount

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// é—´éš™å‘å·¦ç§»åŠ¨</span>
            println(<span class="hljs-string">"â”‚   â”‚ targetIndex (<span class="hljs-variable">$targetIndex</span>) &lt; gapStart (<span class="hljs-variable">$gapStart</span>)"</span>)
            println(<span class="hljs-string">"â”‚   â”‚ â†’ é—´éš™éœ€è¦ã€å‘å·¦ç§»åŠ¨ã€‘"</span>)
            println(<span class="hljs-string">"â”‚   â”‚"</span>)
            
            <span class="hljs-keyword">val</span> moveCount = gapStart - targetIndex
            println(<span class="hljs-string">"â”‚   â”‚ è®¡ç®—: moveCount = gapStart - targetIndex = <span class="hljs-variable">$gapStart</span> - <span class="hljs-variable">$targetIndex</span> = <span class="hljs-variable">$moveCount</span>"</span>)
            println(<span class="hljs-string">"â”‚   â”‚"</span>)
            
            println(<span class="hljs-string">"â”‚   â”‚ æ“ä½œ: æŠŠé—´éš™å·¦è¾¹çš„ <span class="hljs-variable">$moveCount</span> ä¸ªå…ƒç´ ç§»åˆ°é—´éš™å³è¾¹"</span>)
            println(<span class="hljs-string">"â”‚   â”‚   copyInto(buffer, destOffset=<span class="hljs-subst">${gapEnd - moveCount}</span>, startIndex=<span class="hljs-variable">$targetIndex</span>, endIndex=<span class="hljs-subst">${targetIndex + moveCount}</span>)"</span>)
            println(<span class="hljs-string">"â”‚   â”‚   å³: æŠŠ buffer[<span class="hljs-variable">$targetIndex</span>..<span class="hljs-subst">${targetIndex + moveCount - <span class="hljs-number">1</span>}</span>] å¤åˆ¶åˆ° buffer[<span class="hljs-subst">${gapEnd - moveCount}</span>..<span class="hljs-subst">${gapEnd - <span class="hljs-number">1</span>}</span>]"</span>)
            println(<span class="hljs-string">"â”‚   â”‚"</span>)
            println(<span class="hljs-string">"â”‚   â”‚ ç§»åŠ¨å‰: <span class="hljs-subst">${bufferToString()}</span>"</span>)
            
            buffer.copyInto(buffer, gapEnd - moveCount, targetIndex, targetIndex + moveCount)
            
            println(<span class="hljs-string">"â”‚   â”‚ å¤åˆ¶å: <span class="hljs-subst">${bufferToString()}</span>"</span>)
            
            <span class="hljs-comment">// æ¸…é™¤åŸä½ç½®</span>
            println(<span class="hljs-string">"â”‚   â”‚"</span>)
            println(<span class="hljs-string">"â”‚   â”‚ æ¸…é™¤åŸä½ç½® buffer[<span class="hljs-variable">$targetIndex</span>..<span class="hljs-subst">${targetIndex + moveCount - <span class="hljs-number">1</span>}</span>]"</span>)
            <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> targetIndex until targetIndex + moveCount) {
                buffer[i] = <span class="hljs-literal">null</span>
            }
            println(<span class="hljs-string">"â”‚   â”‚ æ¸…é™¤å: <span class="hljs-subst">${bufferToString()}</span>"</span>)
            
            <span class="hljs-comment">// æ›´æ–°é—´éš™ä½ç½®</span>
            println(<span class="hljs-string">"â”‚   â”‚"</span>)
            println(<span class="hljs-string">"â”‚   â”‚ æ›´æ–°é—´éš™ä½ç½®:"</span>)
            println(<span class="hljs-string">"â”‚   â”‚   gapStart: <span class="hljs-variable">$gapStart</span> â†’ <span class="hljs-subst">${gapStart - moveCount}</span>"</span>)
            println(<span class="hljs-string">"â”‚   â”‚   gapEnd: <span class="hljs-variable">$gapEnd</span> â†’ <span class="hljs-subst">${gapEnd - moveCount}</span>"</span>)
            gapStart -= moveCount
            gapEnd -= moveCount
        }
        
        println(<span class="hljs-string">"â”‚   â”‚"</span>)
        println(<span class="hljs-string">"â”‚   â”‚ ç§»åŠ¨å®Œæˆ: gapStart=<span class="hljs-variable">$gapStart</span>, gapEnd=<span class="hljs-variable">$gapEnd</span>"</span>)
        println(<span class="hljs-string">"â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"</span>)
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">grow</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">val</span> oldCapacity = buffer.size
        <span class="hljs-keyword">val</span> newCapacity = oldCapacity * <span class="hljs-number">2</span>
        <span class="hljs-keyword">val</span> newBuffer = arrayOfNulls&lt;Any?&gt;(newCapacity)
        buffer.copyInto(newBuffer, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, gapStart)
        <span class="hljs-keyword">val</span> afterGapCount = oldCapacity - gapEnd
        <span class="hljs-keyword">val</span> newGapEnd = newCapacity - afterGapCount
        buffer.copyInto(newBuffer, newGapEnd, gapEnd, oldCapacity)
        buffer = newBuffer
        gapEnd = newGapEnd
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toPhysicalIndex</span><span class="hljs-params">(logicalIndex: <span class="hljs-type">Int</span>)</span></span>: <span class="hljs-built_in">Int</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (logicalIndex &lt; gapStart) logicalIndex <span class="hljs-keyword">else</span> logicalIndex + gapSize
    }

    <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">(index: <span class="hljs-type">Int</span>)</span></span>: T {
        require(index <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until size)
        <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
        <span class="hljs-keyword">return</span> buffer[toPhysicalIndex(index)] <span class="hljs-keyword">as</span> T
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">toList</span><span class="hljs-params">()</span></span>: List&lt;T&gt; {
        <span class="hljs-keyword">val</span> result = mutableListOf&lt;T&gt;()
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until size) result.add(<span class="hljs-keyword">get</span>(i))
        <span class="hljs-keyword">return</span> result
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">bufferToString</span><span class="hljs-params">()</span></span>: String {
        <span class="hljs-keyword">val</span> sb = StringBuilder(<span class="hljs-string">"["</span>)
        <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> buffer.indices) {
            <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) sb.append(<span class="hljs-string">"]["</span>)
            <span class="hljs-keyword">if</span> (i <span class="hljs-keyword">in</span> gapStart until gapEnd) {
                sb.append(<span class="hljs-string">"_"</span>)
            } <span class="hljs-keyword">else</span> {
                sb.append(buffer[i] ?: <span class="hljs-string">"null"</span>)
            }
        }
        sb.append(<span class="hljs-string">"]"</span>)
        <span class="hljs-keyword">return</span> sb.toString()
    }
}

<span class="hljs-comment">/**
 * æ¼”ç¤ºï¼šæ„å»º [1,2,4,5,6]ï¼Œç„¶ååœ¨ 2 åé¢æ’å…¥ 3
 */</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    println(<span class="hljs-string">"â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"</span>)
    println(<span class="hljs-string">"â•‘  Gap Buffer æ‰§è¡Œæµç¨‹æ¼”ç¤º                                        â•‘"</span>)
    println(<span class="hljs-string">"â•‘  ç›®æ ‡: æ„å»º [1,2,4,5,6]ï¼Œç„¶ååœ¨ 2 åé¢æ’å…¥ 3                      â•‘"</span>)
    println(<span class="hljs-string">"â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"</span>)
    println()

    <span class="hljs-keyword">val</span> buffer = GapBufferDebug&lt;<span class="hljs-built_in">Int</span>&gt;(<span class="hljs-number">8</span>)

    println(<span class="hljs-string">"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"</span>)
    println(<span class="hljs-string">"é˜¶æ®µ1: æ„å»ºåˆå§‹æ•°ç»„ [1, 2, 4, 5, 6]"</span>)
    println(<span class="hljs-string">"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"</span>)
    println()

    buffer.insert(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>)
    buffer.insert(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
    buffer.insert(<span class="hljs-number">2</span>, <span class="hljs-number">4</span>)
    buffer.insert(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)
    buffer.insert(<span class="hljs-number">4</span>, <span class="hljs-number">6</span>)

    println()
    println(<span class="hljs-string">"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"</span>)
    println(<span class="hljs-string">"é˜¶æ®µ2: åœ¨ 2 çš„åé¢æ’å…¥ 3 (å³åœ¨é€»è¾‘ç´¢å¼• 2 å¤„æ’å…¥)"</span>)
    println(<span class="hljs-string">"       å½“å‰: [1, 2, 4, 5, 6]"</span>)
    println(<span class="hljs-string">"       ç›®æ ‡: [1, 2, 3, 4, 5, 6]"</span>)
    println(<span class="hljs-string">"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"</span>)
    println()

    buffer.insert(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)

    println()
    println(<span class="hljs-string">"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"</span>)
    println(<span class="hljs-string">"æœ€ç»ˆç»“æœ: <span class="hljs-subst">${buffer.toList()}</span>"</span>)
    println(<span class="hljs-string">"â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"</span>)
}
</code></pre>
<h2 data-id="heading-0">Gap Buffer æ‰§è¡Œæµç¨‹è¿½è¸ª</h2>
<h3 data-id="heading-1">åœºæ™¯ï¼šæ„å»º [1,2,4,5,6]ï¼Œç„¶ååœ¨ 2 åé¢æ’å…¥ 3</h3>
<h3 data-id="heading-2">é˜¶æ®µ1: æ„å»ºåˆå§‹æ•°ç»„ [1, 2, 4, 5, 6]</h3>
<h4 data-id="heading-3">æ’å…¥ 1 åˆ°ä½ç½® 0</h4>
<pre><code class="hljs language-ini" lang="ini">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ è°ƒç”¨ insert(<span class="hljs-attr">index</span>=<span class="hljs-number">0</span>, element=<span class="hljs-number">1</span>)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ ã€è¿›å…¥ insert æ–¹æ³•ã€‘
â”‚   å½“å‰çŠ¶æ€:
â”‚     <span class="hljs-attr">size</span> = <span class="hljs-number">0</span>
â”‚     <span class="hljs-attr">gapStart</span> = <span class="hljs-number">0</span>
â”‚     <span class="hljs-attr">gapEnd</span> = <span class="hljs-number">8</span>
â”‚     <span class="hljs-attr">gapSize</span> = <span class="hljs-number">8</span>
â”‚     <span class="hljs-attr">buffer</span> = [_][_][_][_][_][_][_][_]
â”‚
â”‚ ã€æ­¥éª¤1ã€‘æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹
â”‚   gapSize (8) == 0 ? false
â”‚   â†’ ä¸éœ€è¦æ‰©å®¹
â”‚
â”‚ ã€æ­¥éª¤2ã€‘ç§»åŠ¨é—´éš™åˆ°ç›®æ ‡ä½ç½® (<span class="hljs-attr">targetIndex</span>=<span class="hljs-number">0</span>)
â”‚   â”Œâ”€ moveGap(<span class="hljs-attr">targetIndex</span>=<span class="hljs-number">0</span>) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚ å½“å‰ <span class="hljs-attr">gapStart</span>=<span class="hljs-number">0</span>, gapEnd=<span class="hljs-number">8</span>
â”‚   â”‚ ç›®æ ‡ä½ç½® <span class="hljs-attr">targetIndex</span>=<span class="hljs-number">0</span>
â”‚   â”‚ <span class="hljs-attr">targetIndex</span> == gapStartï¼Œé—´éš™å·²åœ¨ç›®æ ‡ä½ç½®ï¼Œæ— éœ€ç§»åŠ¨
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”‚ ã€æ­¥éª¤3ã€‘åœ¨é—´éš™ä½ç½®æ’å…¥å…ƒç´ 
â”‚   buffer<span class="hljs-section">[0]</span> = 1
â”‚   æ’å…¥å <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][_][_][_][_][_][_][_]
â”‚
â”‚ ã€æ­¥éª¤4ã€‘ç¼©å°é—´éš™ (gapStart++)
â”‚   gapStart: 0 â†’ 1
â”‚
â”‚ ã€æ’å…¥å®Œæˆã€‘
â”‚   æœ€ç»ˆçŠ¶æ€:
â”‚     <span class="hljs-attr">size</span> = <span class="hljs-number">1</span>
â”‚     <span class="hljs-attr">gapStart</span> = <span class="hljs-number">1</span>
â”‚     <span class="hljs-attr">gapEnd</span> = <span class="hljs-number">8</span>
â”‚     <span class="hljs-attr">gapSize</span> = <span class="hljs-number">7</span>
â”‚     <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][_][_][_][_][_][_][_]
â”‚     é€»è¾‘å†…å®¹ = <span class="hljs-section">[1]</span>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</code></pre>
<h4 data-id="heading-4">æ’å…¥ 2 åˆ°ä½ç½® 1</h4>
<pre><code class="hljs language-ini" lang="ini">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ è°ƒç”¨ insert(<span class="hljs-attr">index</span>=<span class="hljs-number">1</span>, element=<span class="hljs-number">2</span>)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ ã€è¿›å…¥ insert æ–¹æ³•ã€‘
â”‚   å½“å‰çŠ¶æ€:
â”‚     <span class="hljs-attr">size</span> = <span class="hljs-number">1</span>
â”‚     <span class="hljs-attr">gapStart</span> = <span class="hljs-number">1</span>
â”‚     <span class="hljs-attr">gapEnd</span> = <span class="hljs-number">8</span>
â”‚     <span class="hljs-attr">gapSize</span> = <span class="hljs-number">7</span>
â”‚     <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][_][_][_][_][_][_][_]
â”‚
â”‚ ã€æ­¥éª¤1ã€‘æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹
â”‚   gapSize (7) == 0 ? false
â”‚   â†’ ä¸éœ€è¦æ‰©å®¹
â”‚
â”‚ ã€æ­¥éª¤2ã€‘ç§»åŠ¨é—´éš™åˆ°ç›®æ ‡ä½ç½® (<span class="hljs-attr">targetIndex</span>=<span class="hljs-number">1</span>)
â”‚   â”Œâ”€ moveGap(<span class="hljs-attr">targetIndex</span>=<span class="hljs-number">1</span>) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚ å½“å‰ <span class="hljs-attr">gapStart</span>=<span class="hljs-number">1</span>, gapEnd=<span class="hljs-number">8</span>
â”‚   â”‚ ç›®æ ‡ä½ç½® <span class="hljs-attr">targetIndex</span>=<span class="hljs-number">1</span>
â”‚   â”‚ <span class="hljs-attr">targetIndex</span> == gapStartï¼Œé—´éš™å·²åœ¨ç›®æ ‡ä½ç½®ï¼Œæ— éœ€ç§»åŠ¨
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”‚ ã€æ­¥éª¤3ã€‘åœ¨é—´éš™ä½ç½®æ’å…¥å…ƒç´ 
â”‚   buffer<span class="hljs-section">[1]</span> = 2
â”‚   æ’å…¥å <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][_][_][_][_][_][_]
â”‚
â”‚ ã€æ­¥éª¤4ã€‘ç¼©å°é—´éš™ (gapStart++)
â”‚   gapStart: 1 â†’ 2
â”‚
â”‚ ã€æ’å…¥å®Œæˆã€‘
â”‚   æœ€ç»ˆçŠ¶æ€:
â”‚     <span class="hljs-attr">size</span> = <span class="hljs-number">2</span>
â”‚     <span class="hljs-attr">gapStart</span> = <span class="hljs-number">2</span>
â”‚     <span class="hljs-attr">gapEnd</span> = <span class="hljs-number">8</span>
â”‚     <span class="hljs-attr">gapSize</span> = <span class="hljs-number">6</span>
â”‚     <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][_][_][_][_][_][_]
â”‚     é€»è¾‘å†…å®¹ = <span class="hljs-section">[1, 2]</span>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</code></pre>
<h4 data-id="heading-5">æ’å…¥ 4 åˆ°ä½ç½® 2</h4>
<pre><code class="hljs language-ini" lang="ini">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ è°ƒç”¨ insert(<span class="hljs-attr">index</span>=<span class="hljs-number">2</span>, element=<span class="hljs-number">4</span>)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ ã€è¿›å…¥ insert æ–¹æ³•ã€‘
â”‚   å½“å‰çŠ¶æ€:
â”‚     <span class="hljs-attr">size</span> = <span class="hljs-number">2</span>
â”‚     <span class="hljs-attr">gapStart</span> = <span class="hljs-number">2</span>
â”‚     <span class="hljs-attr">gapEnd</span> = <span class="hljs-number">8</span>
â”‚     <span class="hljs-attr">gapSize</span> = <span class="hljs-number">6</span>
â”‚     <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][_][_][_][_][_][_]
â”‚
â”‚ ã€æ­¥éª¤1ã€‘æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹
â”‚   gapSize (6) == 0 ? false
â”‚   â†’ ä¸éœ€è¦æ‰©å®¹
â”‚
â”‚ ã€æ­¥éª¤2ã€‘ç§»åŠ¨é—´éš™åˆ°ç›®æ ‡ä½ç½® (<span class="hljs-attr">targetIndex</span>=<span class="hljs-number">2</span>)
â”‚   â”Œâ”€ moveGap(<span class="hljs-attr">targetIndex</span>=<span class="hljs-number">2</span>) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚ å½“å‰ <span class="hljs-attr">gapStart</span>=<span class="hljs-number">2</span>, gapEnd=<span class="hljs-number">8</span>
â”‚   â”‚ ç›®æ ‡ä½ç½® <span class="hljs-attr">targetIndex</span>=<span class="hljs-number">2</span>
â”‚   â”‚ <span class="hljs-attr">targetIndex</span> == gapStartï¼Œé—´éš™å·²åœ¨ç›®æ ‡ä½ç½®ï¼Œæ— éœ€ç§»åŠ¨
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”‚ ã€æ­¥éª¤3ã€‘åœ¨é—´éš™ä½ç½®æ’å…¥å…ƒç´ 
â”‚   buffer<span class="hljs-section">[2]</span> = 4
â”‚   æ’å…¥å <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-number">4</span>][_][_][_][_][_]
â”‚
â”‚ ã€æ­¥éª¤4ã€‘ç¼©å°é—´éš™ (gapStart++)
â”‚   gapStart: 2 â†’ 3
â”‚
â”‚ ã€æ’å…¥å®Œæˆã€‘
â”‚   æœ€ç»ˆçŠ¶æ€:
â”‚     <span class="hljs-attr">size</span> = <span class="hljs-number">3</span>
â”‚     <span class="hljs-attr">gapStart</span> = <span class="hljs-number">3</span>
â”‚     <span class="hljs-attr">gapEnd</span> = <span class="hljs-number">8</span>
â”‚     <span class="hljs-attr">gapSize</span> = <span class="hljs-number">5</span>
â”‚     <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-number">4</span>][_][_][_][_][_]
â”‚     é€»è¾‘å†…å®¹ = <span class="hljs-section">[1, 2, 4]</span>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</code></pre>
<h4 data-id="heading-6">æ’å…¥ 5 åˆ°ä½ç½® 3</h4>
<pre><code class="hljs language-ini" lang="ini">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ è°ƒç”¨ insert(<span class="hljs-attr">index</span>=<span class="hljs-number">3</span>, element=<span class="hljs-number">5</span>)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ ã€è¿›å…¥ insert æ–¹æ³•ã€‘
â”‚   å½“å‰çŠ¶æ€:
â”‚     <span class="hljs-attr">size</span> = <span class="hljs-number">3</span>
â”‚     <span class="hljs-attr">gapStart</span> = <span class="hljs-number">3</span>
â”‚     <span class="hljs-attr">gapEnd</span> = <span class="hljs-number">8</span>
â”‚     <span class="hljs-attr">gapSize</span> = <span class="hljs-number">5</span>
â”‚     <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-number">4</span>][_][_][_][_][_]
â”‚
â”‚ ã€æ­¥éª¤1ã€‘æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹
â”‚   gapSize (5) == 0 ? false
â”‚   â†’ ä¸éœ€è¦æ‰©å®¹
â”‚
â”‚ ã€æ­¥éª¤2ã€‘ç§»åŠ¨é—´éš™åˆ°ç›®æ ‡ä½ç½® (<span class="hljs-attr">targetIndex</span>=<span class="hljs-number">3</span>)
â”‚   â”Œâ”€ moveGap(<span class="hljs-attr">targetIndex</span>=<span class="hljs-number">3</span>) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚ å½“å‰ <span class="hljs-attr">gapStart</span>=<span class="hljs-number">3</span>, gapEnd=<span class="hljs-number">8</span>
â”‚   â”‚ ç›®æ ‡ä½ç½® <span class="hljs-attr">targetIndex</span>=<span class="hljs-number">3</span>
â”‚   â”‚ <span class="hljs-attr">targetIndex</span> == gapStartï¼Œé—´éš™å·²åœ¨ç›®æ ‡ä½ç½®ï¼Œæ— éœ€ç§»åŠ¨
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”‚ ã€æ­¥éª¤3ã€‘åœ¨é—´éš™ä½ç½®æ’å…¥å…ƒç´ 
â”‚   buffer<span class="hljs-section">[3]</span> = 5
â”‚   æ’å…¥å <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-number">4</span>][<span class="hljs-number">5</span>][_][_][_][_]
â”‚
â”‚ ã€æ­¥éª¤4ã€‘ç¼©å°é—´éš™ (gapStart++)
â”‚   gapStart: 3 â†’ 4
â”‚
â”‚ ã€æ’å…¥å®Œæˆã€‘
â”‚   æœ€ç»ˆçŠ¶æ€:
â”‚     <span class="hljs-attr">size</span> = <span class="hljs-number">4</span>
â”‚     <span class="hljs-attr">gapStart</span> = <span class="hljs-number">4</span>
â”‚     <span class="hljs-attr">gapEnd</span> = <span class="hljs-number">8</span>
â”‚     <span class="hljs-attr">gapSize</span> = <span class="hljs-number">4</span>
â”‚     <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-number">4</span>][<span class="hljs-number">5</span>][_][_][_][_]
â”‚     é€»è¾‘å†…å®¹ = <span class="hljs-section">[1, 2, 4, 5]</span>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</code></pre>
<h4 data-id="heading-7">æ’å…¥ 6 åˆ°ä½ç½® 4</h4>
<pre><code class="hljs language-ini" lang="ini">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ è°ƒç”¨ insert(<span class="hljs-attr">index</span>=<span class="hljs-number">4</span>, element=<span class="hljs-number">6</span>)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ ã€è¿›å…¥ insert æ–¹æ³•ã€‘
â”‚   å½“å‰çŠ¶æ€:
â”‚     <span class="hljs-attr">size</span> = <span class="hljs-number">4</span>
â”‚     <span class="hljs-attr">gapStart</span> = <span class="hljs-number">4</span>
â”‚     <span class="hljs-attr">gapEnd</span> = <span class="hljs-number">8</span>
â”‚     <span class="hljs-attr">gapSize</span> = <span class="hljs-number">4</span>
â”‚     <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-number">4</span>][<span class="hljs-number">5</span>][_][_][_][_]
â”‚
â”‚ ã€æ­¥éª¤1ã€‘æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹
â”‚   gapSize (4) == 0 ? false
â”‚   â†’ ä¸éœ€è¦æ‰©å®¹
â”‚
â”‚ ã€æ­¥éª¤2ã€‘ç§»åŠ¨é—´éš™åˆ°ç›®æ ‡ä½ç½® (<span class="hljs-attr">targetIndex</span>=<span class="hljs-number">4</span>)
â”‚   â”Œâ”€ moveGap(<span class="hljs-attr">targetIndex</span>=<span class="hljs-number">4</span>) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚ å½“å‰ <span class="hljs-attr">gapStart</span>=<span class="hljs-number">4</span>, gapEnd=<span class="hljs-number">8</span>
â”‚   â”‚ ç›®æ ‡ä½ç½® <span class="hljs-attr">targetIndex</span>=<span class="hljs-number">4</span>
â”‚   â”‚ <span class="hljs-attr">targetIndex</span> == gapStartï¼Œé—´éš™å·²åœ¨ç›®æ ‡ä½ç½®ï¼Œæ— éœ€ç§»åŠ¨
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”‚ ã€æ­¥éª¤3ã€‘åœ¨é—´éš™ä½ç½®æ’å…¥å…ƒç´ 
â”‚   buffer<span class="hljs-section">[4]</span> = 6
â”‚   æ’å…¥å <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-number">4</span>][<span class="hljs-number">5</span>][<span class="hljs-number">6</span>][_][_][_]
â”‚
â”‚ ã€æ­¥éª¤4ã€‘ç¼©å°é—´éš™ (gapStart++)
â”‚   gapStart: 4 â†’ 5
â”‚
â”‚ ã€æ’å…¥å®Œæˆã€‘
â”‚   æœ€ç»ˆçŠ¶æ€:
â”‚     <span class="hljs-attr">size</span> = <span class="hljs-number">5</span>
â”‚     <span class="hljs-attr">gapStart</span> = <span class="hljs-number">5</span>
â”‚     <span class="hljs-attr">gapEnd</span> = <span class="hljs-number">8</span>
â”‚     <span class="hljs-attr">gapSize</span> = <span class="hljs-number">3</span>
â”‚     <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-number">4</span>][<span class="hljs-number">5</span>][<span class="hljs-number">6</span>][_][_][_]
â”‚     é€»è¾‘å†…å®¹ = <span class="hljs-section">[1, 2, 4, 5, 6]</span>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</code></pre>
<hr/>
<h3 data-id="heading-8">é˜¶æ®µ1å®Œæˆåçš„çŠ¶æ€</h3>
<pre><code class="hljs language-ini" lang="ini">ç‰©ç†æ•°ç»„:  <span class="hljs-section">[1]</span><span class="hljs-section">[2]</span><span class="hljs-section">[4]</span><span class="hljs-section">[5]</span><span class="hljs-section">[6]</span><span class="hljs-section">[_]</span><span class="hljs-section">[_]</span><span class="hljs-section">[_]</span>
           0  1  2  3  4  5  6  7
                          â†‘     â†‘
                       gapStart gapEnd
                         (5)    (8)

é€»è¾‘å†…å®¹:  <span class="hljs-section">[1, 2, 4, 5, 6]</span>
           0  1  2  3  4
</code></pre>
<hr/>
<h3 data-id="heading-9">é˜¶æ®µ2: åœ¨ 2 çš„åé¢æ’å…¥ 3</h3>
<p><strong>ç›®æ ‡</strong>: åœ¨é€»è¾‘ç´¢å¼• 2 å¤„æ’å…¥ 3ï¼ˆå³åœ¨ 2 å’Œ 4 ä¹‹é—´ï¼‰</p>
<p><strong>å½“å‰</strong>: <code>[1, 2, 4, 5, 6]</code>
<strong>ç›®æ ‡</strong>: <code>[1, 2, 3, 4, 5, 6]</code></p>
<pre><code class="hljs language-ini" lang="ini">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ è°ƒç”¨ insert(<span class="hljs-attr">index</span>=<span class="hljs-number">2</span>, element=<span class="hljs-number">3</span>)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ ã€è¿›å…¥ insert æ–¹æ³•ã€‘
â”‚   å½“å‰çŠ¶æ€:
â”‚     <span class="hljs-attr">size</span> = <span class="hljs-number">5</span>
â”‚     <span class="hljs-attr">gapStart</span> = <span class="hljs-number">5</span>
â”‚     <span class="hljs-attr">gapEnd</span> = <span class="hljs-number">8</span>
â”‚     <span class="hljs-attr">gapSize</span> = <span class="hljs-number">3</span>
â”‚     <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-number">4</span>][<span class="hljs-number">5</span>][<span class="hljs-number">6</span>][_][_][_]
â”‚
â”‚ ã€æ­¥éª¤1ã€‘æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰©å®¹
â”‚   gapSize (3) == 0 ? false
â”‚   â†’ ä¸éœ€è¦æ‰©å®¹
â”‚
â”‚ ã€æ­¥éª¤2ã€‘ç§»åŠ¨é—´éš™åˆ°ç›®æ ‡ä½ç½® (<span class="hljs-attr">targetIndex</span>=<span class="hljs-number">2</span>)
â”‚   â”Œâ”€ moveGap(<span class="hljs-attr">targetIndex</span>=<span class="hljs-number">2</span>) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚   â”‚ å½“å‰ <span class="hljs-attr">gapStart</span>=<span class="hljs-number">5</span>, gapEnd=<span class="hljs-number">8</span>
â”‚   â”‚ ç›®æ ‡ä½ç½® <span class="hljs-attr">targetIndex</span>=<span class="hljs-number">2</span>
â”‚   â”‚ 
â”‚   â”‚ targetIndex (2) &lt; gapStart (5)
â”‚   â”‚ â†’ é—´éš™éœ€è¦ã€å‘å·¦ç§»åŠ¨ã€‘
â”‚   â”‚
â”‚   â”‚ è®¡ç®—: <span class="hljs-attr">moveCount</span> = gapStart - targetIndex = <span class="hljs-number">5</span> - <span class="hljs-number">2</span> = <span class="hljs-number">3</span>
â”‚   â”‚
â”‚   â”‚ æ“ä½œ: æŠŠé—´éš™å·¦è¾¹çš„ 3 ä¸ªå…ƒç´ ç§»åˆ°é—´éš™å³è¾¹
â”‚   â”‚   copyInto(buffer, <span class="hljs-attr">destOffset</span>=<span class="hljs-number">5</span>, startIndex=<span class="hljs-number">2</span>, endIndex=<span class="hljs-number">5</span>)
â”‚   â”‚   å³: æŠŠ buffer<span class="hljs-section">[2..4]</span> å¤åˆ¶åˆ° buffer<span class="hljs-section">[5..7]</span>
â”‚   â”‚        æŠŠ <span class="hljs-section">[4]</span><span class="hljs-section">[5]</span><span class="hljs-section">[6]</span> ç§»åˆ°åé¢
â”‚   â”‚
â”‚   â”‚ ç§»åŠ¨å‰: <span class="hljs-section">[1]</span><span class="hljs-section">[2]</span><span class="hljs-section">[4]</span><span class="hljs-section">[5]</span><span class="hljs-section">[6]</span><span class="hljs-section">[_]</span><span class="hljs-section">[_]</span><span class="hljs-section">[_]</span>
â”‚   â”‚                â†‘        â†‘
â”‚   â”‚             ç§»åŠ¨è¿™3ä¸ªå…ƒç´ 
â”‚   â”‚
â”‚   â”‚ å¤åˆ¶å: <span class="hljs-section">[1]</span><span class="hljs-section">[2]</span><span class="hljs-section">[4]</span><span class="hljs-section">[5]</span><span class="hljs-section">[6]</span><span class="hljs-section">[4]</span><span class="hljs-section">[5]</span><span class="hljs-section">[6]</span>
â”‚   â”‚              (åŸä½ç½®)   (æ–°ä½ç½®)
â”‚   â”‚
â”‚   â”‚ æ¸…é™¤åŸä½ç½® buffer<span class="hljs-section">[2..4]</span>
â”‚   â”‚ æ¸…é™¤å: <span class="hljs-section">[1]</span><span class="hljs-section">[2]</span><span class="hljs-section">[_]</span><span class="hljs-section">[_]</span><span class="hljs-section">[_]</span><span class="hljs-section">[4]</span><span class="hljs-section">[5]</span><span class="hljs-section">[6]</span>
â”‚   â”‚
â”‚   â”‚ æ›´æ–°é—´éš™ä½ç½®:
â”‚   â”‚   gapStart: 5 â†’ 2  (5 - <span class="hljs-attr">3</span> = <span class="hljs-number">2</span>)
â”‚   â”‚   gapEnd: 8 â†’ 5    (8 - <span class="hljs-attr">3</span> = <span class="hljs-number">5</span>)
â”‚   â”‚
â”‚   â”‚ ç§»åŠ¨å®Œæˆ: <span class="hljs-attr">gapStart</span>=<span class="hljs-number">2</span>, gapEnd=<span class="hljs-number">5</span>
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚
â”‚ ã€æ­¥éª¤3ã€‘åœ¨é—´éš™ä½ç½®æ’å…¥å…ƒç´ 
â”‚   buffer<span class="hljs-section">[2]</span> = 3
â”‚   æ’å…¥å <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-number">3</span>][_][_][<span class="hljs-number">4</span>][<span class="hljs-number">5</span>][<span class="hljs-number">6</span>]
â”‚
â”‚ ã€æ­¥éª¤4ã€‘ç¼©å°é—´éš™ (gapStart++)
â”‚   gapStart: 2 â†’ 3
â”‚
â”‚ ã€æ’å…¥å®Œæˆã€‘
â”‚   æœ€ç»ˆçŠ¶æ€:
â”‚     <span class="hljs-attr">size</span> = <span class="hljs-number">6</span>
â”‚     <span class="hljs-attr">gapStart</span> = <span class="hljs-number">3</span>
â”‚     <span class="hljs-attr">gapEnd</span> = <span class="hljs-number">5</span>
â”‚     <span class="hljs-attr">gapSize</span> = <span class="hljs-number">2</span>
â”‚     <span class="hljs-attr">buffer</span> = [<span class="hljs-number">1</span>][<span class="hljs-number">2</span>][<span class="hljs-number">3</span>][_][_][<span class="hljs-number">4</span>][<span class="hljs-number">5</span>][<span class="hljs-number">6</span>]
â”‚     é€»è¾‘å†…å®¹ = <span class="hljs-section">[1, 2, 3, 4, 5, 6]</span>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</code></pre>
<hr/>
<h3 data-id="heading-10">å…³é”®æ­¥éª¤å›¾è§£</h3>
<h4 data-id="heading-11">æ’å…¥ 3 åˆ°ä½ç½® 2 çš„é—´éš™ç§»åŠ¨è¿‡ç¨‹</h4>
<pre><code class="hljs language-ini" lang="ini">åˆå§‹çŠ¶æ€ (<span class="hljs-attr">gapStart</span>=<span class="hljs-number">5</span>, gapEnd=<span class="hljs-number">8</span>):
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚ 1 â”‚ 2 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ _ â”‚ _ â”‚ _ â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
  0   1   2   3   4   5   6   7
                      â†‘       â†‘
                   gapStart  gapEnd

é€»è¾‘è§†å›¾: <span class="hljs-section">[1, 2, 4, 5, 6]</span>
                â†‘
          è¦åœ¨è¿™é‡Œæ’å…¥ 3

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ­¥éª¤1: å¤åˆ¶ buffer<span class="hljs-section">[2..4]</span> åˆ° buffer<span class="hljs-section">[5..7]</span>
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚ 1 â”‚ 2 â”‚ 4 â”‚ 5 â”‚ 6 â”‚ 4 â”‚ 5 â”‚ 6 â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
  0   1   2   3   4   5   6   7
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            å¤åˆ¶åˆ°è¿™é‡Œ â†—

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ­¥éª¤2: æ¸…é™¤åŸä½ç½® buffer<span class="hljs-section">[2..4]</span>
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚ 1 â”‚ 2 â”‚ _ â”‚ _ â”‚ _ â”‚ 4 â”‚ 5 â”‚ 6 â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
  0   1   2   3   4   5   6   7
          â†‘           â†‘
       gapStart    gapEnd
         (2)        (5)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ­¥éª¤3: åœ¨ gapStart ä½ç½®æ’å…¥ 3
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚ 1 â”‚ 2 â”‚ 3 â”‚ _ â”‚ _ â”‚ 4 â”‚ 5 â”‚ 6 â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
  0   1   2   3   4   5   6   7
          â†‘
       æ’å…¥ 3

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ­¥éª¤4: gapStart++
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”
â”‚ 1 â”‚ 2 â”‚ 3 â”‚ _ â”‚ _ â”‚ 4 â”‚ 5 â”‚ 6 â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜
  0   1   2   3   4   5   6   7
              â†‘       â†‘
           gapStart gapEnd
             (3)     (5)

é€»è¾‘è§†å›¾: <span class="hljs-section">[1, 2, 3, 4, 5, 6]</span>  âœ“
</code></pre>
<hr/>
<h3 data-id="heading-12">å˜é‡è¿½è¸ªè¡¨</h3>


























































































































<table><thead><tr><th>æ“ä½œ</th><th>buffer ç‰©ç†çŠ¶æ€</th><th>gapStart</th><th>gapEnd</th><th>gapSize</th><th>size</th><th>é€»è¾‘å†…å®¹</th></tr></thead><tbody><tr><td>åˆå§‹</td><td><code>[_][_][_][_][_][_][_][_]</code></td><td>0</td><td>8</td><td>8</td><td>0</td><td><code>[]</code></td></tr><tr><td>insert(0,1)</td><td><code>[1][_][_][_][_][_][_][_]</code></td><td>1</td><td>8</td><td>7</td><td>1</td><td><code>[1]</code></td></tr><tr><td>insert(1,2)</td><td><code>[1][2][_][_][_][_][_][_]</code></td><td>2</td><td>8</td><td>6</td><td>2</td><td><code>[1,2]</code></td></tr><tr><td>insert(2,4)</td><td><code>[1][2][4][_][_][_][_][_]</code></td><td>3</td><td>8</td><td>5</td><td>3</td><td><code>[1,2,4]</code></td></tr><tr><td>insert(3,6)</td><td><code>[1][2][4][5][_][_][_][_]</code></td><td>4</td><td>8</td><td>4</td><td>4</td><td><code>[1,2,4,5]</code></td></tr><tr><td>insert(4,6)</td><td><code>[1][2][4][5][6][_][_][_]</code></td><td>5</td><td>8</td><td>3</td><td>5</td><td><code>[1,2,4,5,6]</code></td></tr><tr><td><strong>insert(2,3)</strong></td><td/><td/><td/><td/><td/><td/></tr><tr><td>â”” moveGap(2) å‰</td><td><code>[1][2][4][5][6][_][_][_]</code></td><td>5</td><td>8</td><td>3</td><td>5</td><td><code>[1,2,4,5,6]</code></td></tr><tr><td>â”” å¤åˆ¶å</td><td><code>[1][2][4][5][6][4][5][6]</code></td><td>5</td><td>8</td><td>-</td><td>-</td><td>-</td></tr><tr><td>â”” æ¸…é™¤å</td><td><code>[1][2][_][_][_][4][5][6]</code></td><td>2</td><td>5</td><td>3</td><td>5</td><td><code>[1,2,4,5,6]</code></td></tr><tr><td>â”” æ’å…¥ 3</td><td><code>[1][2][3][_][_][4][5][6]</code></td><td>2</td><td>5</td><td>-</td><td>-</td><td>-</td></tr><tr><td>â”” gapStart++</td><td><code>[1][2][3][_][_][4][5][6]</code></td><td><strong>3</strong></td><td><strong>5</strong></td><td><strong>2</strong></td><td><strong>6</strong></td><td><code>[1,2,3,4,5,6]</code></td></tr></tbody></table>
<hr/>
<h3 data-id="heading-13">æ€»ç»“</h3>
<ol>
<li><strong>é¡ºåºæ’å…¥æ—¶</strong>ï¼ˆå¦‚æ„å»ºåˆå§‹æ•°ç»„ï¼‰ï¼Œé—´éš™å§‹ç»ˆåœ¨æœ«å°¾ï¼Œæ— éœ€ç§»åŠ¨ï¼ŒO(1)</li>
<li><strong>ä¸­é—´æ’å…¥æ—¶</strong>ï¼ˆå¦‚åœ¨ä½ç½® 2 æ’å…¥ 3ï¼‰ï¼Œéœ€è¦ç§»åŠ¨é—´éš™ï¼Œå¤åˆ¶å…ƒç´ ï¼ŒO(n)</li>
<li><strong>é—´éš™çš„ä½œç”¨</strong>ï¼šå°†å¤æ‚çš„æ•°ç»„æ’å…¥æ“ä½œï¼ˆéœ€è¦ç§»åŠ¨åç»­æ‰€æœ‰å…ƒç´ ï¼‰è½¬åŒ–ä¸ºç®€å•çš„é—´éš™ç§»åŠ¨ + O(1) æ’å…¥</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ç¨³å®šæ€§æ€§èƒ½ç³»åˆ—ä¹‹å…«â€”â€”ç³»ç»Ÿæ€§èƒ½åˆ†æåŸºç¡€:Systraceä¸Perfettoå…¥é—¨]]></title>    <link>https://juejin.cn/post/7591075684066541583</link>    <guid>https://juejin.cn/post/7591075684066541583</guid>    <pubDate>2026-01-04T14:24:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591075684066541583" data-draft-id="7591130604430082088" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ç¨³å®šæ€§æ€§èƒ½ç³»åˆ—ä¹‹å…«â€”â€”ç³»ç»Ÿæ€§èƒ½åˆ†æåŸºç¡€:Systraceä¸Perfettoå…¥é—¨"/> <meta itemprop="keywords" content="Android,Debug,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2026-01-04T14:24:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†¬å¥‡Lab"/> <meta itemprop="url" content="https://juejin.cn/user/1857501105781193"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ç¨³å®šæ€§æ€§èƒ½ç³»åˆ—ä¹‹å…«â€”â€”ç³»ç»Ÿæ€§èƒ½åˆ†æåŸºç¡€:Systraceä¸Perfettoå…¥é—¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1857501105781193/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†¬å¥‡Lab
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T14:24:55.000Z" title="Sun Jan 04 2026 14:24:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æ€§èƒ½ä¼˜åŒ–çš„ç¬¬ä¸€æ­¥,ä¸æ˜¯çŒœæµ‹é—®é¢˜åœ¨å“ªé‡Œ,è€Œæ˜¯ç”¨æ•°æ®è¯´è¯ã€‚Traceå·¥å…·å°±æ˜¯é‚£ä¸ªè®©æ€§èƒ½ç“¶é¢ˆæ— æ‰€éå½¢çš„"æ˜¾å¾®é•œ"ã€‚</p>
</blockquote>
<h2 data-id="heading-0">å¼•è¨€:ä»3ç§’åˆ°1ç§’çš„ä¼˜åŒ–å†ç¨‹</h2>
<p>é‚£æ˜¯å»å¹´Q2çš„ä¸€ä¸ªå‘¨ä¸€æ—©æ™¨,äº§å“ç»ç†ç¥è‰²å‡é‡åœ°æ‰¾åˆ°æˆ‘:"ç”¨æˆ·åé¦ˆæˆ‘ä»¬çš„Appå¯åŠ¨å¤ªæ…¢äº†,å¹³å‡3ç§’æ‰èƒ½çœ‹åˆ°é¦–é¡µ,ç«å“åªè¦1ç§’ã€‚è€æ¿è¯´å¦‚æœè¿™ä¸ªå­£åº¦ä¼˜åŒ–ä¸åˆ°1.5ç§’ä»¥å†…,é¡¹ç›®å¯èƒ½è¦é»„ã€‚"</p>
<p>æˆ‘æ‰“å¼€Appè¯•äº†è¯•,ç¡®å®æ…¢å¾—è®©äººæŠ“ç‹‚ã€‚ä½†é—®é¢˜åœ¨å“ªé‡Œå‘¢?Applicationåˆå§‹åŒ–?ActivityåŠ è½½?ç½‘ç»œè¯·æ±‚?è¿˜æ˜¯å›¾ç‰‡æ¸²æŸ“?</p>
<p>å‡­æ„Ÿè§‰ä¼˜åŒ–?é‚£åªæ˜¯åœ¨ç›²äººæ‘¸è±¡ã€‚</p>
<p>äºæ˜¯æˆ‘æ‰“å¼€Systrace,æŠ“å–äº†ä¸€ä»½å¯åŠ¨Traceã€‚å½“Chromeæ‰“å¼€é‚£ä¸ªHTMLæ–‡ä»¶çš„ç¬é—´,æ•´ä¸ªå¯åŠ¨æµç¨‹ä¸€è§ˆæ— é—:</p>
<pre><code class="hljs language-scss" lang="scss">Application<span class="hljs-selector-class">.onCreate</span>(): <span class="hljs-number">450ms</span>
  â”œâ”€ SDKåˆå§‹åŒ–: <span class="hljs-number">280ms</span>    â† å…ƒå‡¶!
  â”œâ”€ æ•°æ®åº“è¿ç§»: <span class="hljs-number">120ms</span>
  â””â”€ å…¶ä»–åˆå§‹åŒ–: <span class="hljs-number">50ms</span>

Activity.<span class="hljs-built_in">onCreate</span>(): <span class="hljs-number">380ms</span>
  â”œâ”€ <span class="hljs-built_in">setContentView</span>(): <span class="hljs-number">80ms</span>
  â”œâ”€ ç½‘ç»œè¯·æ±‚: <span class="hljs-number">200ms</span>      â† åœ¨ä¸»çº¿ç¨‹!
  â””â”€ RecyclerViewé¦–å±æ¸²æŸ“: <span class="hljs-number">100ms</span>
</code></pre>
<p><strong>é—®é¢˜ä¸€ç›®äº†ç„¶</strong>:SDKåˆå§‹åŒ–å’Œç½‘ç»œè¯·æ±‚å æ®äº†å¯åŠ¨æ—¶é—´çš„ä¸€åŠã€‚</p>
<p>ç»è¿‡ä¸¤å‘¨çš„ä¼˜åŒ–(SDKå»¶è¿Ÿåˆå§‹åŒ–ã€ç½‘ç»œè¯·æ±‚ç§»åˆ°åå°ã€é¢„åŠ è½½ä¼˜åŒ–),å¯åŠ¨æ—¶é—´é™åˆ°äº†0.9ç§’ã€‚äº§å“ç»ç†å†ä¹Ÿæ²¡æè¿‡å¯åŠ¨æ…¢çš„é—®é¢˜,é¡¹ç›®ä¹Ÿé¡ºåˆ©ä¸Šçº¿äº†ã€‚</p>
<p><strong>è¿™æ¬¡ç»å†è®©æˆ‘æ˜ç™½</strong>:æ€§èƒ½ä¼˜åŒ–ä¸æ˜¯é ç»éªŒå’Œç›´è§‰,è€Œæ˜¯é æ•°æ®ã€‚è€ŒTraceå·¥å…·,å°±æ˜¯è·å–è¿™äº›æ•°æ®çš„æœ€å¼ºæ­¦å™¨ã€‚</p>
<p>æœ¬æ–‡å°†å¸¦ä½ å…¨é¢æŒæ¡Systraceå’ŒPerfettoä¸¤å¤§æ€§èƒ½åˆ†æå·¥å…·ã€‚è¯»å®Œæœ¬æ–‡,ä½ å°†èƒ½å¤Ÿ:</p>
<ol>
<li>ç†è§£Systraceå’ŒPerfettoçš„å·¥ä½œåŸç†å’ŒåŒºåˆ«</li>
<li>æŒæ¡TraceæŠ“å–çš„å®Œæ•´æµç¨‹å’Œå¸¸ç”¨é…ç½®</li>
<li>å­¦ä¼šåˆ†æTraceæ–‡ä»¶,å¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆ</li>
<li>ä½¿ç”¨ä»£ç æ’æ¡©æŠ€æœ¯ç²¾ç¡®è¿½è¸ªå…³é”®è·¯å¾„</li>
<li>è¿ç”¨SQLæŸ¥è¯¢è¿›è¡Œé«˜çº§æ€§èƒ½åˆ†æ</li>
</ol>
<hr/>
<h2 data-id="heading-1">ä¸€ã€Traceå·¥å…·æ¦‚è¿°</h2>
<h3 data-id="heading-2">1.1 ä»€ä¹ˆæ˜¯Trace</h3>
<p><strong>Trace(è·Ÿè¸ª)</strong>  æ˜¯ä¸€ç§è®°å½•ç³»ç»Ÿè¿è¡Œæ—¶äº‹ä»¶åºåˆ—çš„æŠ€æœ¯ã€‚ç®€å•æ¥è¯´,å°±æ˜¯ç»™ç³»ç»Ÿ"è£…ä¸ªç›‘æ§æ‘„åƒå¤´",è®°å½•ä¸‹æŒ‡å®šæ—¶é—´æ®µå†…å‘ç”Ÿçš„æ‰€æœ‰å…³é”®äº‹ä»¶ã€‚</p>
<p><strong>Traceèƒ½è®°å½•ä»€ä¹ˆ?</strong></p>













































<table><thead><tr><th align="left">ç±»å‹</th><th align="left">å†…å®¹</th><th align="left">ç”¨é€”</th></tr></thead><tbody><tr><td align="left"><strong>å‡½æ•°è°ƒç”¨</strong></td><td align="left">æ–¹æ³•è¿›å…¥/é€€å‡ºæ—¶é—´</td><td align="left">åˆ†æå“ªä¸ªå‡½æ•°è€—æ—¶é•¿</td></tr><tr><td align="left"><strong>çº¿ç¨‹è°ƒåº¦</strong></td><td align="left">çº¿ç¨‹è¿è¡Œ/ç­‰å¾…/ç¡çœ çŠ¶æ€</td><td align="left">å®šä½çº¿ç¨‹é˜»å¡é—®é¢˜</td></tr><tr><td align="left"><strong>CPUè°ƒåº¦</strong></td><td align="left">å“ªä¸ªçº¿ç¨‹åœ¨å“ªä¸ªæ ¸å¿ƒä¸Šè¿è¡Œ</td><td align="left">CPUå ç”¨åˆ†æ</td></tr><tr><td align="left"><strong>æ¸²æŸ“äº‹ä»¶</strong></td><td align="left">VSYNCã€SurfaceFlingerç»˜åˆ¶</td><td align="left">å¡é¡¿å’Œæ‰å¸§åˆ†æ</td></tr><tr><td align="left"><strong>I/Oæ“ä½œ</strong></td><td align="left">æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚</td><td align="left">I/Oæ€§èƒ½åˆ†æ</td></tr><tr><td align="left"><strong>GCäº‹ä»¶</strong></td><td align="left">åƒåœ¾å›æ”¶çš„æ—¶é—´å’Œé¢‘ç‡</td><td align="left">å†…å­˜æŠ–åŠ¨åˆ†æ</td></tr><tr><td align="left"><strong>Binderè°ƒç”¨</strong></td><td align="left">è·¨è¿›ç¨‹é€šä¿¡</td><td align="left">IPCæ€§èƒ½åˆ†æ</td></tr></tbody></table>
<p><strong>Traceèƒ½è§£å†³ä»€ä¹ˆé—®é¢˜?</strong></p>
<p>âœ… <strong>å¯åŠ¨æ…¢</strong> - ç²¾ç¡®å®šä½å¯åŠ¨è¿‡ç¨‹ä¸­çš„è€—æ—¶æ“ä½œ<br/>
âœ… <strong>æ»‘åŠ¨å¡é¡¿</strong> - æ‰¾å‡ºå¯¼è‡´æ‰å¸§çš„å‡½æ•°è°ƒç”¨<br/>
âœ… <strong>åŠ¨ç”»ä¸æµç•…</strong> - åˆ†ææ¸²æŸ“Pipelineçš„ç“¶é¢ˆ<br/>
âœ… <strong>CPUå ç”¨é«˜</strong> - è¯†åˆ«CPUå¯†é›†å‹æ“ä½œ<br/>
âœ… <strong>åŠŸè€—é«˜</strong> - å®šä½é¢‘ç¹å”¤é†’å’Œé•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡</p>
<h3 data-id="heading-3">1.2 Systraceç®€ä»‹</h3>
<p><strong>Systrace</strong>æ˜¯Googleæ—©æœŸæ¨å‡ºçš„ç³»ç»Ÿçº§æ€§èƒ½åˆ†æå·¥å…·,ä»Android 4.1å¼€å§‹å¼•å…¥ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:</p>
<ul>
<li>åŸºäºLinux <strong>ftrace</strong>æœºåˆ¶</li>
<li>è½»é‡çº§,å¯¹ç³»ç»Ÿæ€§èƒ½å½±å“å°</li>
<li>ä»¥HTMLæ–‡ä»¶å‘ˆç°,ä½¿ç”¨Chrome Trace VieweræŸ¥çœ‹</li>
<li>æ”¯æŒAndroid 4.1åˆ°Android 12çš„æ‰€æœ‰ç‰ˆæœ¬</li>
</ul>
<p><strong>å·¥ä½œåŸç†</strong>:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38c947baf33f4d649918da90a7ec2449~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141495&amp;x-signature=S9NDM6hh3coHY31UvSZDbJzuJz4%3D" alt="08-01-trace-workflow.png" loading="lazy"/></p>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>âœ… ç®€å•æ˜“ç”¨,ä¸€è¡Œå‘½ä»¤å³å¯æŠ“å–</li>
<li>âœ… å…¼å®¹æ€§å¥½,æ”¯æŒè€ç‰ˆæœ¬Android</li>
<li>âœ… æ— éœ€é¢å¤–å®‰è£…å·¥å…·</li>
</ul>
<p><strong>å±€é™æ€§</strong>:</p>
<ul>
<li>âŒ UIä½“éªŒä¸€èˆ¬(åŸºäºChromeæ’ä»¶)</li>
<li>âŒ ä¸æ”¯æŒSQLæŸ¥è¯¢</li>
<li>âŒ å¤§æ–‡ä»¶åŠ è½½æ…¢</li>
<li>âŒ åŠŸèƒ½ç›¸å¯¹åŸºç¡€</li>
</ul>
<h3 data-id="heading-4">1.3 Perfettoç®€ä»‹</h3>
<p><strong>Perfetto</strong>  æ˜¯Googleä»Android 10å¼€å§‹æ¨å‡ºçš„æ–°ä¸€ä»£æ€§èƒ½åˆ†æå¹³å°,æ—¨åœ¨å–ä»£Systraceã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>:</p>
<ul>
<li>ç°ä»£åŒ–çš„Web UI(<a href="https://link.juejin.cn?target=https%3A%2F%2Fui.perfetto.dev%2F" target="_blank" title="https://ui.perfetto.dev/" ref="nofollow noopener noreferrer">ui.perfetto.dev/</a>)</li>
<li>å¼ºå¤§çš„SQLæŸ¥è¯¢å¼•æ“</li>
<li>æ”¯æŒProtobufäºŒè¿›åˆ¶æ ¼å¼,æ–‡ä»¶æ›´å°</li>
<li>æ›´ä¸°å¯Œçš„æ•°æ®æº(å†…å­˜ã€ç”µé‡ã€ç½‘ç»œç­‰)</li>
<li>å‘åå…¼å®¹,å¯ä»¥æ‰“å¼€Systraceæ–‡ä»¶</li>
</ul>
<p><strong>å·¥ä½œåŸç†</strong>:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bab3d14320444938b8be9c9eb5ae253~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141495&amp;x-signature=UQMiWVWTKQCnXpqNT5tlbinY5u4%3D" alt="08-02-perfetto-architecture.png" loading="lazy"/></p>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>âœ… ç°ä»£åŒ–UI,äº¤äº’ä½“éªŒæä½³</li>
<li>âœ… SQLæŸ¥è¯¢å¼•æ“,æ”¯æŒå¤æ‚åˆ†æ</li>
<li>âœ… æ›´ä¸°å¯Œçš„æ•°æ®æº</li>
<li>âœ… æ–‡ä»¶æ›´å°,åŠ è½½æ›´å¿«</li>
<li>âœ… æŒç»­æ›´æ–°,åŠŸèƒ½ä¸æ–­å¢å¼º</li>
</ul>
<p><strong>å±€é™æ€§</strong>:</p>
<ul>
<li>âš ï¸ ä¸»è¦æ”¯æŒAndroid 10+</li>
<li>âš ï¸ å­¦ä¹ æ›²çº¿ç¨é™¡(SQLæŸ¥è¯¢)</li>
</ul>
<h3 data-id="heading-5">1.4 å·¥å…·å¯¹æ¯”</h3>




























































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">Systrace</th><th align="left">Perfetto</th></tr></thead><tbody><tr><td align="left"><strong>æ¨å‡ºæ—¶é—´</strong></td><td align="left">Android 4.1 (2012)</td><td align="left">Android 10 (2019)</td></tr><tr><td align="left"><strong>UIä½“éªŒ</strong></td><td align="left">Chrome Trace Viewer</td><td align="left">ç°ä»£Web UI â­â­â­â­â­</td></tr><tr><td align="left"><strong>åŠŸèƒ½ä¸°å¯Œåº¦</strong></td><td align="left">åŸºç¡€</td><td align="left">å¼ºå¤§ â­â­â­â­â­</td></tr><tr><td align="left"><strong>æ•°æ®æ ¼å¼</strong></td><td align="left">HTML</td><td align="left">Protobuf (æ›´å°)</td></tr><tr><td align="left"><strong>æŸ¥è¯¢èƒ½åŠ›</strong></td><td align="left">æ— </td><td align="left">SQLæŸ¥è¯¢ â­â­â­â­â­</td></tr><tr><td align="left"><strong>æ•°æ®æº</strong></td><td align="left">ftrace</td><td align="left">ftrace + å†…å­˜ + ç”µé‡ + ç½‘ç»œ</td></tr><tr><td align="left"><strong>å…¼å®¹æ€§</strong></td><td align="left">Android 4.1 - 12</td><td align="left">Android 9+ (æœ€å¥½10+)</td></tr><tr><td align="left"><strong>æ–‡ä»¶å¤§å°</strong></td><td align="left">è¾ƒå¤§</td><td align="left">æ›´å°</td></tr><tr><td align="left"><strong>å­¦ä¹ æ›²çº¿</strong></td><td align="left">ç®€å•</td><td align="left">ä¸­ç­‰</td></tr><tr><td align="left"><strong>æ¨èä½¿ç”¨</strong></td><td align="left">Android 9åŠä»¥ä¸‹</td><td align="left"><strong>Android 10+</strong> â­æ¨è</td></tr></tbody></table>
<p><strong>é€‰æ‹©å»ºè®®</strong>:</p>
<ul>
<li>å¦‚æœä½ çš„é¡¹ç›®ä¸»è¦æ”¯æŒAndroid 10+,<strong>å¼ºçƒˆæ¨èPerfetto</strong></li>
<li>å¦‚æœéœ€è¦å…¼å®¹Android 9åŠä»¥ä¸‹,ä½¿ç”¨<strong>Systrace</strong></li>
<li>ä¸¤è€…å¯ä»¥å…±å­˜,æ ¹æ®åœºæ™¯çµæ´»é€‰æ‹©</li>
</ul>
<hr/>
<h2 data-id="heading-6">äºŒã€Systraceä½¿ç”¨æŒ‡å—</h2>
<h3 data-id="heading-7">2.1 ç¯å¢ƒå‡†å¤‡</h3>
<p><strong>å‰ç½®æ¡ä»¶</strong>:</p>
<ol>
<li>âœ… Python 2.7+ æˆ– Python 3.x</li>
<li>âœ… Android SDK Platform-Tools (adbå‘½ä»¤)</li>
<li>âœ… Chromeæµè§ˆå™¨</li>
</ol>
<p><strong>Systraceä½ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Android SDKä¸­çš„ä½ç½®</span>
<span class="hljs-variable">$ANDROID_HOME</span>/platform-tools/systrace/systrace.py

<span class="hljs-comment"># éªŒè¯Pythonç¯å¢ƒ</span>
python --version  <span class="hljs-comment"># æˆ– python3 --version</span>

<span class="hljs-comment"># éªŒè¯adbè¿æ¥</span>
adb devices
</code></pre>
<p><strong>è®¾å¤‡æƒé™è®¾ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. å¼€å¯å¼€å‘è€…é€‰é¡¹</span>
<span class="hljs-comment"># è®¾ç½® â†’ å…³äºæ‰‹æœº â†’ è¿ç»­ç‚¹å‡»"ç‰ˆæœ¬å·"7æ¬¡</span>

<span class="hljs-comment"># 2. å¼€å¯USBè°ƒè¯•</span>
<span class="hljs-comment"># è®¾ç½® â†’ å¼€å‘è€…é€‰é¡¹ â†’ USBè°ƒè¯•</span>

<span class="hljs-comment"># 3. æˆäºˆadb rootæƒé™(å¦‚éœ€è¦)</span>
adb root
adb remount
</code></pre>
<h3 data-id="heading-8">2.2 æŠ“å–Systrace</h3>
<p><strong>åŸºç¡€ç”¨æ³•</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># è¿›å…¥systraceç›®å½•</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$ANDROID_HOME</span>/platform-tools/systrace

<span class="hljs-comment"># æŠ“å–10ç§’çš„trace</span>
python systrace.py -o trace.html -t 10 -b 32768 \
  gfx input view webview wm am sm audio video camera hal \
  app res dalvik rs bionic power pm ss database network

<span class="hljs-comment"># å‚æ•°è¯´æ˜:</span>
<span class="hljs-comment"># -o trace.html   : è¾“å‡ºæ–‡ä»¶å</span>
<span class="hljs-comment"># -t 10           : æŠ“å–æ—¶é•¿(ç§’)</span>
<span class="hljs-comment"># -b 32768        : bufferå¤§å°(KB),å»ºè®®32MBä»¥ä¸Š</span>
<span class="hljs-comment"># -a package_name : æŒ‡å®šåº”ç”¨åŒ…å(å¯é€‰)</span>
<span class="hljs-comment"># åé¢æ˜¯categoryåˆ—è¡¨</span>
</code></pre>
<p><strong>æ¨èé…ç½®(é€šç”¨åœºæ™¯)</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">python systrace.py \
  -o trace.html \
  -t 10 \
  -b 32768 \
  <span class="hljs-built_in">sched</span> freq idle am wm gfx view binder_driver hal \
  dalvik input res
</code></pre>
<h3 data-id="heading-9">2.3 å¸¸ç”¨Categoryè¯´æ˜</h3>







































































































































<table><thead><tr><th align="left">Category</th><th align="left">è¯´æ˜</th><th align="left">å…¸å‹ç”¨é€”</th></tr></thead><tbody><tr><td align="left"><strong>sched</strong></td><td align="left">CPUè°ƒåº¦äº‹ä»¶</td><td align="left"><strong>å¿…é€‰</strong>,åˆ†æçº¿ç¨‹è¿è¡ŒçŠ¶æ€</td></tr><tr><td align="left"><strong>freq</strong></td><td align="left">CPUé¢‘ç‡å˜åŒ–</td><td align="left">CPUæ€§èƒ½åˆ†æ</td></tr><tr><td align="left"><strong>idle</strong></td><td align="left">CPU idleçŠ¶æ€</td><td align="left">åŠŸè€—åˆ†æ</td></tr><tr><td align="left"><strong>gfx</strong></td><td align="left">SurfaceFlinger, VSYNC, Texture</td><td align="left"><strong>æ¸²æŸ“åˆ†æå¿…é€‰</strong></td></tr><tr><td align="left"><strong>input</strong></td><td align="left">Inputäº‹ä»¶åˆ†å‘</td><td align="left">è§¦æ‘¸å“åº”åˆ†æ</td></tr><tr><td align="left"><strong>view</strong></td><td align="left">Viewç»˜åˆ¶(measure/layout/draw)</td><td align="left"><strong>å¡é¡¿åˆ†æå¿…é€‰</strong></td></tr><tr><td align="left"><strong>webview</strong></td><td align="left">WebViewæ€§èƒ½</td><td align="left">H5é¡µé¢åˆ†æ</td></tr><tr><td align="left"><strong>wm</strong></td><td align="left">Window Manager</td><td align="left">çª—å£ç®¡ç†åˆ†æ</td></tr><tr><td align="left"><strong>am</strong></td><td align="left">Activity Managerç”Ÿå‘½å‘¨æœŸ</td><td align="left"><strong>å¯åŠ¨åˆ†æå¿…é€‰</strong></td></tr><tr><td align="left"><strong>sm</strong></td><td align="left">Sync Manager</td><td align="left">åŒæ­¥æ“ä½œåˆ†æ</td></tr><tr><td align="left"><strong>audio</strong></td><td align="left">Audioæ’­æ”¾</td><td align="left">éŸ³é¢‘å¡é¡¿åˆ†æ</td></tr><tr><td align="left"><strong>video</strong></td><td align="left">Videoè§£ç </td><td align="left">è§†é¢‘æ€§èƒ½åˆ†æ</td></tr><tr><td align="left"><strong>camera</strong></td><td align="left">Cameraæ“ä½œ</td><td align="left">ç›¸æœºæ€§èƒ½åˆ†æ</td></tr><tr><td align="left"><strong>hal</strong></td><td align="left">HALå±‚äº‹ä»¶</td><td align="left">åº•å±‚ç¡¬ä»¶è°ƒç”¨</td></tr><tr><td align="left"><strong>app</strong></td><td align="left">åº”ç”¨è‡ªå®šä¹‰trace</td><td align="left"><strong>æ’æ¡©åˆ†æå¿…é€‰</strong></td></tr><tr><td align="left"><strong>res</strong></td><td align="left">èµ„æºåŠ è½½</td><td align="left">èµ„æºåŠ è½½æ€§èƒ½</td></tr><tr><td align="left"><strong>dalvik</strong></td><td align="left">GCäº‹ä»¶</td><td align="left"><strong>å†…å­˜æŠ–åŠ¨åˆ†æå¿…é€‰</strong></td></tr><tr><td align="left"><strong>rs</strong></td><td align="left">RenderScript</td><td align="left">å›¾åƒå¤„ç†åˆ†æ</td></tr><tr><td align="left"><strong>bionic</strong></td><td align="left">Bionicåº“è°ƒç”¨</td><td align="left">Nativeæ€§èƒ½åˆ†æ</td></tr><tr><td align="left"><strong>power</strong></td><td align="left">Power HAL</td><td align="left">ç”µé‡åˆ†æ</td></tr><tr><td align="left"><strong>pm</strong></td><td align="left">Package Manager</td><td align="left">å®‰è£…/å¸è½½åˆ†æ</td></tr><tr><td align="left"><strong>ss</strong></td><td align="left">System Server</td><td align="left">ç³»ç»ŸæœåŠ¡åˆ†æ</td></tr><tr><td align="left"><strong>database</strong></td><td align="left">SQLiteæ“ä½œ</td><td align="left">æ•°æ®åº“æ€§èƒ½åˆ†æ</td></tr><tr><td align="left"><strong>network</strong></td><td align="left">ç½‘ç»œI/O</td><td align="left">ç½‘ç»œæ€§èƒ½åˆ†æ</td></tr><tr><td align="left"><strong>binder_driver</strong></td><td align="left">Binderé©±åŠ¨</td><td align="left"><strong>IPCåˆ†æå¿…é€‰</strong></td></tr></tbody></table>
<p><strong>åœºæ™¯æ¨èé…ç½®</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¯åŠ¨æ€§èƒ½åˆ†æ</span>
python systrace.py -o launch.html -t 10 -a com.example.app \
  <span class="hljs-built_in">sched</span> freq idle am wm gfx view binder_driver hal dalvik input res

<span class="hljs-comment"># æ»‘åŠ¨å¡é¡¿åˆ†æ</span>
python systrace.py -o scroll.html -t 10 -a com.example.app \
  <span class="hljs-built_in">sched</span> gfx view input wm dalvik app

<span class="hljs-comment"># æ¸²æŸ“æ€§èƒ½åˆ†æ</span>
python systrace.py -o render.html -t 10 -a com.example.app \
  <span class="hljs-built_in">sched</span> freq gfx view wm

<span class="hljs-comment"># å†…å­˜æŠ–åŠ¨åˆ†æ</span>
python systrace.py -o memory.html -t 10 -a com.example.app \
  <span class="hljs-built_in">sched</span> dalvik app

<span class="hljs-comment"># å…¨é¢åˆ†æ(æ–‡ä»¶ä¼šå¾ˆå¤§)</span>
python systrace.py -o full.html -t 10 -a com.example.app \
  <span class="hljs-built_in">sched</span> freq idle am wm gfx view webview binder_driver hal \
  dalvik input res power database network app
</code></pre>
<h3 data-id="heading-10">2.4 å®æˆ˜æ¼”ç»ƒ:æŠ“å–åº”ç”¨å¯åŠ¨Trace</h3>
<p>å®Œæ•´çš„å¯åŠ¨TraceæŠ“å–æµç¨‹:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Step 1: ç¡®å®šåº”ç”¨åŒ…å</span>
adb shell pm list packages | grep example
<span class="hljs-comment"># è¾“å‡º: package:com.example.myapp</span>

<span class="hljs-comment"># Step 2: æ¸…ç†åº”ç”¨æ•°æ®(æ¨¡æ‹Ÿé¦–æ¬¡å¯åŠ¨)</span>
adb shell pm clear com.example.myapp

<span class="hljs-comment"># Step 3: å¯åŠ¨SystraceæŠ“å–(ä¸è¦ç«‹å³å¯åŠ¨App)</span>
<span class="hljs-built_in">cd</span> <span class="hljs-variable">$ANDROID_HOME</span>/platform-tools/systrace
python systrace.py -o launch.html -t 10 -a com.example.myapp \
  <span class="hljs-built_in">sched</span> freq idle am wm gfx view binder_driver hal dalvik input res &amp;

<span class="hljs-comment"># æ³¨æ„: æœ€åçš„ &amp; è®©å‘½ä»¤åœ¨åå°è¿è¡Œ</span>

<span class="hljs-comment"># Step 4: ç­‰å¾…2ç§’,è®©systraceå‡†å¤‡å¥½</span>
<span class="hljs-built_in">sleep</span> 2

<span class="hljs-comment"># Step 5: å¯åŠ¨åº”ç”¨å¹¶è®°å½•å¯åŠ¨æ—¶é—´</span>
adb shell am start -W com.example.myapp/.MainActivity

<span class="hljs-comment"># è¾“å‡ºç¤ºä¾‹:</span>
<span class="hljs-comment"># Starting: Intent { act=android.intent.action.MAIN cat=[android.intent.category.LAUNCHER] cmp=com.example.myapp/.MainActivity }</span>
<span class="hljs-comment"># Status: ok</span>
<span class="hljs-comment"># Activity: com.example.myapp/.MainActivity</span>
<span class="hljs-comment"># ThisTime: 1245      â† Activityå¯åŠ¨æ—¶é—´</span>
<span class="hljs-comment"># TotalTime: 1245     â† æ€»å¯åŠ¨æ—¶é—´</span>
<span class="hljs-comment"># WaitTime: 1267      â† ç­‰å¾…æ—¶é—´</span>
<span class="hljs-comment"># Complete</span>

<span class="hljs-comment"># Step 6: ç­‰å¾…systraceæŠ“å–å®Œæˆ(10ç§’)</span>
<span class="hljs-comment"># ä¼šè‡ªåŠ¨ç”Ÿæˆ launch.html</span>

<span class="hljs-comment"># Step 7: ä½¿ç”¨Chromeæ‰“å¼€traceæ–‡ä»¶</span>
google-chrome launch.html
<span class="hljs-comment"># æˆ–</span>
open -a <span class="hljs-string">"Google Chrome"</span> launch.html
</code></pre>
<p><strong>Tip</strong>: ä¸ºäº†æŠ“å–åˆ°å®Œæ•´çš„å¯åŠ¨æµç¨‹,å»ºè®®traceæ—¶é•¿è®¾ç½®ä¸º15-20ç§’,ç¡®ä¿ä»åº”ç”¨å†·å¯åŠ¨åˆ°é¦–å±æ¸²æŸ“å®Œæˆéƒ½è¢«è®°å½•ã€‚</p>
<h3 data-id="heading-11">2.5 æŸ¥çœ‹Systrace</h3>
<p><strong>1. æ‰“å¼€Traceæ–‡ä»¶</strong>:</p>
<ul>
<li>ä½¿ç”¨Chromeæµè§ˆå™¨æ‰“å¼€trace.html</li>
<li>æ–‡ä»¶è¾ƒå¤§æ—¶å¯èƒ½éœ€è¦ç­‰å¾…å‡ ç§’åŠ è½½</li>
</ul>
<p><strong>2. ç•Œé¢å¸ƒå±€</strong>:</p>
<pre><code class="hljs language-less" lang="less">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  <span class="hljs-selector-attr">[?]</span> <span class="hljs-selector-attr">[W]</span><span class="hljs-selector-attr">[A]</span><span class="hljs-selector-attr">[S]</span><span class="hljs-selector-attr">[D]</span>  æœç´¢:<span class="hljs-selector-tag">______</span>  æ—¶é—´èŒƒå›´:<span class="hljs-selector-tag">___</span>     â”‚ å·¥å…·æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  <span class="hljs-selector-tag">CPU</span> <span class="hljs-number">0</span>                                            â”‚
â”‚  <span class="hljs-selector-tag">CPU</span> <span class="hljs-number">1</span>                                            â”‚ <span class="hljs-selector-tag">CPU</span>æ ¸å¿ƒ
â”‚  <span class="hljs-selector-tag">CPU</span> <span class="hljs-number">2</span>                                            â”‚
â”‚  <span class="hljs-selector-tag">CPU</span> <span class="hljs-number">3</span>                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.myapp</span>                                â”‚ åº”ç”¨è¿›ç¨‹
â”‚    â””â”€ <span class="hljs-selector-tag">main</span>                  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ      â”‚ ä¸»çº¿ç¨‹
â”‚    â””â”€ <span class="hljs-selector-tag">RenderThread</span>          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                â”‚ æ¸²æŸ“çº¿ç¨‹
â”‚    â””â”€ <span class="hljs-selector-tag">binder</span>:<span class="hljs-selector-tag">xxx</span>            â–ˆâ–ˆâ–ˆ                   â”‚ <span class="hljs-selector-tag">Binder</span>çº¿ç¨‹
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  <span class="hljs-selector-tag">system_server</span>                                    â”‚ ç³»ç»Ÿè¿›ç¨‹
â”‚    â””â”€ <span class="hljs-selector-tag">android</span><span class="hljs-selector-class">.fg</span>            â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ             â”‚
â”‚    â””â”€ <span class="hljs-selector-tag">android</span><span class="hljs-selector-class">.ui</span>            â–ˆâ–ˆâ–ˆâ–ˆ                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  <span class="hljs-selector-tag">surfaceflinger</span>                                   â”‚ <span class="hljs-selector-tag">SurfaceFlinger</span>
â”‚    â””â”€ <span class="hljs-selector-tag">surfaceflinger</span>        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>3. åŸºæœ¬æ“ä½œ</strong>:</p>























































<table><thead><tr><th align="left">æ“ä½œ</th><th align="left">å¿«æ·é”®/æ–¹æ³•</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><strong>æ”¾å¤§</strong></td><td align="left"><code>W</code> æˆ– é¼ æ ‡æ»šè½®ä¸Šæ»š</td><td align="left">æ”¾å¤§æ—¶é—´è½´</td></tr><tr><td align="left"><strong>ç¼©å°</strong></td><td align="left"><code>S</code> æˆ– é¼ æ ‡æ»šè½®ä¸‹æ»š</td><td align="left">ç¼©å°æ—¶é—´è½´</td></tr><tr><td align="left"><strong>å·¦ç§»</strong></td><td align="left"><code>A</code></td><td align="left">å‘å·¦ç§»åŠ¨æ—¶é—´è½´</td></tr><tr><td align="left"><strong>å³ç§»</strong></td><td align="left"><code>D</code></td><td align="left">å‘å³ç§»åŠ¨æ—¶é—´è½´</td></tr><tr><td align="left"><strong>é€‰æ‹©åŒºåŸŸ</strong></td><td align="left">é¼ æ ‡å·¦é”®æ‹–æ‹½</td><td align="left">é€‰ä¸­ä¸€æ®µæ—¶é—´èŒƒå›´</td></tr><tr><td align="left"><strong>æŸ¥çœ‹è¯¦æƒ…</strong></td><td align="left">ç‚¹å‡»è‰²å—</td><td align="left">æŸ¥çœ‹å‡½æ•°è°ƒç”¨è¯¦æƒ…</td></tr><tr><td align="left"><strong>æœç´¢</strong></td><td align="left"><code>Ctrl+F</code> æˆ– æœç´¢æ¡†</td><td align="left">æœç´¢å‡½æ•°å</td></tr><tr><td align="left"><strong>é«˜äº®</strong></td><td align="left">ç‚¹å‡»å‡½æ•°å</td><td align="left">é«˜äº®æ‰€æœ‰åŒåå‡½æ•°</td></tr><tr><td align="left"><strong>æ ‡è®°</strong></td><td align="left"><code>M</code></td><td align="left">æ·»åŠ ä¹¦ç­¾æ ‡è®°</td></tr></tbody></table>
<p><strong>4. æŸ¥çœ‹å‡½æ•°è¯¦æƒ…</strong>:
ç‚¹å‡»ä¸€ä¸ªè‰²å—å,å³ä¾§ä¼šæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Title:</span> <span class="hljs-string">onCreate</span>
<span class="hljs-attr">Wall Duration:</span> <span class="hljs-string">450ms</span>        <span class="hljs-string">â†</span> <span class="hljs-string">å®é™…è€—æ—¶</span>
<span class="hljs-attr">CPU Duration:</span> <span class="hljs-string">420ms</span>         <span class="hljs-string">â†</span> <span class="hljs-string">CPUå ç”¨æ—¶é—´</span>
<span class="hljs-attr">Self Time:</span> <span class="hljs-string">50ms</span>             <span class="hljs-string">â†</span> <span class="hljs-string">è‡ªèº«è€—æ—¶(ä¸å«å­è°ƒç”¨)</span>
<span class="hljs-attr">Start:</span> <span class="hljs-number">1234.</span><span class="hljs-string">567ms</span>           <span class="hljs-string">â†</span> <span class="hljs-string">å¼€å§‹æ—¶é—´</span>
<span class="hljs-attr">Args:</span>                       <span class="hljs-string">â†</span> <span class="hljs-string">å‚æ•°ä¿¡æ¯</span>
  <span class="hljs-attr">thread_name:</span> <span class="hljs-string">main</span>
  <span class="hljs-attr">process_name:</span> <span class="hljs-string">com.example.myapp</span>
</code></pre>
<p><strong>5. åˆ†ææŠ€å·§</strong>:</p>
<ul>
<li>ğŸ” å…ˆ<strong>ç¼©å°</strong>æŸ¥çœ‹æ•´ä½“,è¯†åˆ«å¤§å—è€—æ—¶</li>
<li>ğŸ” å†<strong>æ”¾å¤§</strong>æŸ¥çœ‹ç»†èŠ‚,å®šä½å…·ä½“å‡½æ•°</li>
<li>ğŸ” å…³æ³¨<strong>ä¸»çº¿ç¨‹</strong>çš„ç©ºç™½åŒºåŸŸ(å¯èƒ½åœ¨ç­‰å¾…)</li>
<li>ğŸ” æŸ¥çœ‹<strong>CPUè°ƒåº¦</strong>,è¯†åˆ«çº¿ç¨‹é˜»å¡</li>
<li>ğŸ” å¯¹æ¯”<strong>VSYNC</strong>ä¿¡å·,åˆ†ææ‰å¸§åŸå› </li>
</ul>
<hr/>
<h2 data-id="heading-12">ä¸‰ã€Perfettoä½¿ç”¨æŒ‡å—</h2>
<h3 data-id="heading-13">3.1 ä¸‰ç§ä½¿ç”¨æ–¹å¼</h3>
<p>Perfettoæä¾›äº†ä¸‰ç§æŠ“å–å’Œåˆ†ætraceçš„æ–¹å¼:</p>
<h4 data-id="heading-14">æ–¹å¼1: Web UI (â­æ¨è)</h4>
<p><strong>ä¼˜ç‚¹</strong>: æ— éœ€å®‰è£…,åŠŸèƒ½å®Œæ•´,ä½“éªŒæœ€ä½³<br/>
<strong>ç¼ºç‚¹</strong>: éœ€è¦ç½‘ç»œè¿æ¥</p>
<p><strong>ä½¿ç”¨æ­¥éª¤</strong>:</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ‰“å¼€æµè§ˆå™¨è®¿é—® https://ui.perfetto.dev/
<span class="hljs-bullet">2.</span> ç‚¹å‡»"Record new trace"
<span class="hljs-bullet">3.</span> è¿æ¥è®¾å¤‡ (ä¼šæç¤ºæˆæƒadb)
<span class="hljs-bullet">4.</span> é…ç½®æŠ“å–å‚æ•°
<span class="hljs-bullet">5.</span> ç‚¹å‡»"Start Recording"
<span class="hljs-bullet">6.</span> æ‰§è¡Œå¾…åˆ†æçš„æ“ä½œ
<span class="hljs-bullet">7.</span> ç‚¹å‡»"Stop"å¹¶ä¸‹è½½traceæ–‡ä»¶
</code></pre>
<h4 data-id="heading-15">æ–¹å¼2: å‘½ä»¤è¡Œ</h4>
<p><strong>ä¼˜ç‚¹</strong>: é€‚åˆè‡ªåŠ¨åŒ–è„šæœ¬,CIé›†æˆ<br/>
<strong>ç¼ºç‚¹</strong>: éœ€è¦æ‰‹åŠ¨é…ç½®</p>
<p><strong>ä½¿ç”¨æ­¥éª¤</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. ä¸‹è½½Perfettoå·¥å…·(å¦‚æœè®¾å¤‡ä¸Šæ²¡æœ‰)</span>
adb shell perfetto --version
<span class="hljs-comment"># å¦‚æœæ²¡æœ‰,ä» https://get.perfetto.dev/perfetto ä¸‹è½½</span>

<span class="hljs-comment"># 2. æ¨é€é…ç½®æ–‡ä»¶åˆ°è®¾å¤‡</span>
adb push config.pbtx /data/local/tmp/

<span class="hljs-comment"># 3. å¼€å§‹æŠ“å–</span>
adb shell perfetto \
  -c /data/local/tmp/config.pbtx \
  -o /data/local/tmp/trace.perfetto-trace

<span class="hljs-comment"># 4. å¯¼å‡ºtraceæ–‡ä»¶</span>
adb pull /data/local/tmp/trace.perfetto-trace ./
</code></pre>
<h4 data-id="heading-16">æ–¹å¼3: Android Studioé›†æˆ</h4>
<p><strong>ä¼˜ç‚¹</strong>: ä¸å¼€å‘ç¯å¢ƒé›†æˆ,æ“ä½œç®€å•<br/>
<strong>ç¼ºç‚¹</strong>: åŠŸèƒ½ç›¸å¯¹åŸºç¡€</p>
<p><strong>ä½¿ç”¨æ­¥éª¤</strong>:</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ‰“å¼€Android Studio
<span class="hljs-bullet">2.</span> View â†’ Tool Windows â†’ Profiler
<span class="hljs-bullet">3.</span> ç‚¹å‡»"+"æ·»åŠ Session
<span class="hljs-bullet">4.</span> é€‰æ‹©è®¾å¤‡å’Œè¿›ç¨‹
<span class="hljs-bullet">5.</span> ç‚¹å‡»"CPU" â†’ "System Trace"
<span class="hljs-bullet">6.</span> ç‚¹å‡»"Record"å¼€å§‹æŠ“å–
<span class="hljs-bullet">7.</span> æ‰§è¡Œæ“ä½œåç‚¹å‡»"Stop"
<span class="hljs-bullet">8.</span> æŸ¥çœ‹trace (ä¼šè‡ªåŠ¨ç”¨Perfetto UIæ‰“å¼€)
</code></pre>
<h3 data-id="heading-17">3.2 Web UIæŠ“å–æµç¨‹è¯¦è§£</h3>
<p>è®©æˆ‘ä»¬è¯¦ç»†è®²è§£æœ€æ¨èçš„Web UIæ–¹å¼:</p>
<p><strong>Step 1: æ‰“å¼€Perfetto UI</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">æµè§ˆå™¨è®¿é—®: https:<span class="hljs-comment">//ui.perfetto.dev/</span>
å»ºè®®ä½¿ç”¨Chromeæˆ–Edgeæµè§ˆå™¨
</code></pre>
<p><strong>Step 2: é€‰æ‹©Record new trace</strong>
ç‚¹å‡»å·¦ä¸Šè§’çš„"Record new trace"æŒ‰é’®</p>
<p><strong>Step 3: è¿æ¥è®¾å¤‡</strong></p>
<ul>
<li>ç¡®ä¿adbå·²è¿æ¥: <code>adb devices</code></li>
<li>åœ¨"Target"ä¸‹æ‹‰æ¡†ä¸­é€‰æ‹©ä½ çš„è®¾å¤‡</li>
<li>é¦–æ¬¡ä½¿ç”¨ä¼šæç¤ºå®‰è£…"Perfetto UI ADB Bridge",ç‚¹å‡»åŒæ„</li>
</ul>
<p><strong>Step 4: é…ç½®æŠ“å–å‚æ•°</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># Recording Settingsé…ç½®é¡¹:</span>

<span class="hljs-attr">Duration:</span> <span class="hljs-number">10000</span> <span class="hljs-string">ms</span>          <span class="hljs-comment"># æŠ“å–æ—¶é•¿</span>
<span class="hljs-attr">Buffer size:</span> <span class="hljs-number">32768</span> <span class="hljs-string">KB</span>       <span class="hljs-comment"># ç¼“å†²åŒºå¤§å°</span>

<span class="hljs-comment"># Probes (æ•°æ®æº)é€‰æ‹©:</span>

<span class="hljs-string">âœ…</span> <span class="hljs-string">Scheduling</span> <span class="hljs-string">details</span>       <span class="hljs-comment"># CPUè°ƒåº¦(å¿…é€‰)</span>
<span class="hljs-string">âœ…</span> <span class="hljs-string">CPU</span> <span class="hljs-string">frequency</span> <span class="hljs-string">and</span> <span class="hljs-string">idle</span> <span class="hljs-string">states</span>  <span class="hljs-comment"># CPUé¢‘ç‡</span>
<span class="hljs-string">âœ…</span> <span class="hljs-string">Syscalls</span>                 <span class="hljs-comment"># ç³»ç»Ÿè°ƒç”¨</span>
<span class="hljs-string">âœ…</span> <span class="hljs-string">Process</span> <span class="hljs-string">tracking</span>         <span class="hljs-comment"># è¿›ç¨‹è·Ÿè¸ª</span>
<span class="hljs-string">âœ…</span> <span class="hljs-string">Frame</span> <span class="hljs-string">timeline</span>           <span class="hljs-comment"># å¸§æ—¶é—´çº¿(æ¸²æŸ“åˆ†æå¿…é€‰)</span>
<span class="hljs-string">âœ…</span> <span class="hljs-string">Memory</span> <span class="hljs-string">(RSS,</span> <span class="hljs-string">PSS,</span> <span class="hljs-string">etc)</span>   <span class="hljs-comment"># å†…å­˜ç»Ÿè®¡</span>
<span class="hljs-string">âœ…</span> <span class="hljs-string">Battery</span> <span class="hljs-string">drain</span> <span class="hljs-string">&amp;</span> <span class="hljs-string">power</span> <span class="hljs-string">rails</span>  <span class="hljs-comment"># ç”µé‡åˆ†æ</span>

<span class="hljs-comment"># Advanced settings:</span>

<span class="hljs-attr">Atrace categories:</span>          <span class="hljs-comment"># é€‰æ‹©category</span>
  <span class="hljs-string">âœ…</span> <span class="hljs-string">gfx</span>
  <span class="hljs-string">âœ…</span> <span class="hljs-string">input</span>
  <span class="hljs-string">âœ…</span> <span class="hljs-string">view</span>
  <span class="hljs-string">âœ…</span> <span class="hljs-string">am</span>
  <span class="hljs-string">âœ…</span> <span class="hljs-string">wm</span>
  <span class="hljs-string">âœ…</span> <span class="hljs-string">dalvik</span>

<span class="hljs-attr">App name:</span> <span class="hljs-string">com.example.myapp</span>  <span class="hljs-comment"># æŒ‡å®šåº”ç”¨åŒ…å</span>
</code></pre>
<p><strong>Step 5: å¼€å§‹æŠ“å–</strong></p>
<ul>
<li>ç‚¹å‡»"Start Recording"æŒ‰é’®</li>
<li>ç­‰å¾…åˆå§‹åŒ–(2-3ç§’)</li>
<li>æ‰§è¡Œä½ è¦åˆ†æçš„æ“ä½œ(å¯åŠ¨Appã€æ»‘åŠ¨åˆ—è¡¨ç­‰)</li>
</ul>
<p><strong>Step 6: åœæ­¢å¹¶ä¸‹è½½</strong></p>
<ul>
<li>ç‚¹å‡»"Stop and get trace"</li>
<li>ç­‰å¾…æ•°æ®ä¼ è¾“(å–å†³äºtraceå¤§å°)</li>
<li>Traceä¼šè‡ªåŠ¨åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€</li>
<li>å¯ä»¥ç‚¹å‡»"Download"ä¿å­˜åˆ°æœ¬åœ°</li>
</ul>
<h3 data-id="heading-18">3.3 å‘½ä»¤è¡ŒæŠ“å–</h3>
<p>å¯¹äºè‡ªåŠ¨åŒ–åœºæ™¯,å‘½ä»¤è¡ŒæŠ“å–æ›´é€‚åˆã€‚</p>
<p><strong>åˆ›å»ºé…ç½®æ–‡ä»¶ config.pbtx</strong>:</p>
<pre><code class="hljs language-protobuf" lang="protobuf"># Perfettoé…ç½®æ–‡ä»¶æ ¼å¼ (Protocol Buffer Text)

buffers {
  size_kb: 32768           # ç¼“å†²åŒº32MB
  fill_policy: RING_BUFFER # ç¯å½¢ç¼“å†²åŒºç­–ç•¥
}

# æ•°æ®æºé…ç½®
data_sources {
  config {
    name: "linux.ftrace"
    ftrace_config {
      # ftraceäº‹ä»¶
      ftrace_events: "sched/sched_switch"
      ftrace_events: "sched/sched_wakeup"
      ftrace_events: "sched/sched_wakeup_new"
      ftrace_events: "sched/sched_waking"
      ftrace_events: "power/suspend_resume"
      ftrace_events: "power/cpu_frequency"
      ftrace_events: "power/cpu_idle"

      # atrace categories
      atrace_categories: "gfx"
      atrace_categories: "view"
      atrace_categories: "am"
      atrace_categories: "wm"
      atrace_categories: "input"
      atrace_categories: "dalvik"

      # æŒ‡å®šåº”ç”¨
      atrace_apps: "com.example.myapp"
    }
  }
}

# æŠ“å–æ—¶é•¿
duration_ms: 10000  # 10ç§’
</code></pre>
<p><strong>æŠ“å–è„šæœ¬ capture_trace.sh</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-meta">#!/bin/bash</span>

<span class="hljs-comment"># é…ç½®</span>
APP_PACKAGE=<span class="hljs-string">"com.example.myapp"</span>
CONFIG_FILE=<span class="hljs-string">"config.pbtx"</span>
OUTPUT_FILE=<span class="hljs-string">"trace_<span class="hljs-subst">$(date +%Y%m%d_%H%M%S)</span>.perfetto-trace"</span>

<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== Perfetto Trace Capture ==="</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"App: <span class="hljs-variable">$APP_PACKAGE</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Output: <span class="hljs-variable">$OUTPUT_FILE</span>"</span>

<span class="hljs-comment"># 1. æ¨é€é…ç½®æ–‡ä»¶</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[1/4] Pushing config..."</span>
adb push <span class="hljs-variable">$CONFIG_FILE</span> /data/local/tmp/config.pbtx

<span class="hljs-comment"># 2. æ¸…ç†åº”ç”¨æ•°æ®(å¯é€‰)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[2/4] Clearing app data..."</span>
adb shell pm clear <span class="hljs-variable">$APP_PACKAGE</span>

<span class="hljs-comment"># 3. å¼€å§‹æŠ“å–(åå°è¿è¡Œ)</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[3/4] Starting trace capture..."</span>
adb shell perfetto \
  -c /data/local/tmp/config.pbtx \
  -o /data/local/tmp/trace.perfetto-trace &amp;

PERFETTO_PID=$!

<span class="hljs-comment"># ç­‰å¾…perfettoå¯åŠ¨</span>
<span class="hljs-built_in">sleep</span> 2

<span class="hljs-comment"># 4. å¯åŠ¨åº”ç”¨</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"[4/4] Launching app..."</span>
adb shell am start -W <span class="hljs-variable">$APP_PACKAGE</span>/.MainActivity

<span class="hljs-comment"># ç­‰å¾…perfettoå®Œæˆ</span>
<span class="hljs-built_in">wait</span> <span class="hljs-variable">$PERFETTO_PID</span>

<span class="hljs-comment"># 5. å¯¼å‡ºtrace</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Pulling trace file..."</span>
adb pull /data/local/tmp/trace.perfetto-trace <span class="hljs-variable">$OUTPUT_FILE</span>

<span class="hljs-comment"># æ¸…ç†è®¾å¤‡ä¸Šçš„æ–‡ä»¶</span>
adb shell <span class="hljs-built_in">rm</span> /data/local/tmp/trace.perfetto-trace
adb shell <span class="hljs-built_in">rm</span> /data/local/tmp/config.pbtx

<span class="hljs-built_in">echo</span> <span class="hljs-string">"âœ… Trace saved to: <span class="hljs-variable">$OUTPUT_FILE</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Open it at: https://ui.perfetto.dev/"</span>
</code></pre>
<p><strong>ä½¿ç”¨è„šæœ¬</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">chmod</span> +x capture_trace.sh
./capture_trace.sh
</code></pre>
<h3 data-id="heading-19">3.4 Perfetto UIè¯¦è§£</h3>
<p><strong>æ•´ä½“ç•Œé¢å¸ƒå±€</strong>:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a83e16a989294aa8af694ddf12cede6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141495&amp;x-signature=f6bdI3rriQq4cpdW8RHnBFnR9u8%3D" alt="08-03-perfetto-ui.png" loading="lazy"/></p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½åŒºåŸŸ</strong>:</p>
<ol>
<li>
<p><strong>Timeline (æ—¶é—´è½´)</strong></p>
<ul>
<li>æ˜¾ç¤ºæ•´ä¸ªtraceçš„æ—¶é—´èŒƒå›´</li>
<li>å¯ä»¥æ‹–æ‹½é€‰æ‹©æ—¶é—´åŒºé—´</li>
<li>åŒå‡»å¯ä»¥è·³è½¬åˆ°è¯¥æ—¶é—´ç‚¹</li>
</ul>
</li>
<li>
<p><strong>Pinned Tracks (ç½®é¡¶è½¨é“)</strong></p>
<ul>
<li>Frame Timeline: æ¯ä¸€å¸§çš„æ¸²æŸ“æƒ…å†µ
<ul>
<li>ç»¿è‰²: æ­£å¸¸å¸§ (&lt; 16.6ms)</li>
<li>é»„è‰²: è½»å¾®æ‰å¸§ (16.6-33ms)</li>
<li>çº¢è‰²: ä¸¥é‡æ‰å¸§ (&gt; 33ms)</li>
</ul>
</li>
<li>å¯ä»¥æ·»åŠ å…¶ä»–é‡è¦è½¨é“</li>
</ul>
</li>
<li>
<p><strong>CPUè½¨é“</strong></p>
<ul>
<li>æ˜¾ç¤ºæ¯ä¸ªCPUæ ¸å¿ƒçš„ä½¿ç”¨æƒ…å†µ</li>
<li>å¯ä»¥çœ‹åˆ°çº¿ç¨‹åœ¨å“ªä¸ªæ ¸å¿ƒä¸Šè¿è¡Œ</li>
<li>é¢œè‰²ä»£è¡¨ä¸åŒçš„è¿›ç¨‹</li>
</ul>
</li>
<li>
<p><strong>è¿›ç¨‹å’Œçº¿ç¨‹è½¨é“</strong></p>
<ul>
<li>æ¯ä¸ªè¿›ç¨‹å¯ä»¥å±•å¼€æŸ¥çœ‹çº¿ç¨‹</li>
<li>çº¿ç¨‹ä¸Šçš„è‰²å—ä»£è¡¨å‡½æ•°è°ƒç”¨</li>
<li>ç‚¹å‡»è‰²å—æŸ¥çœ‹å‡½æ•°è¯¦æƒ…</li>
</ul>
</li>
<li>
<p><strong>è¯¦æƒ…é¢æ¿ (å³ä¾§æˆ–åº•éƒ¨)</strong></p>
<ul>
<li>æ˜¾ç¤ºé€‰ä¸­sliceçš„è¯¦ç»†ä¿¡æ¯</li>
<li>åŒ…å«Wall Durationã€CPU Timeã€Stack Trace</li>
<li>å¯ä»¥æŸ¥çœ‹å‚æ•°å’Œå±æ€§</li>
</ul>
</li>
</ol>
<p><strong>å¸¸ç”¨æ“ä½œ</strong>:</p>









































<table><thead><tr><th align="left">æ“ä½œ</th><th align="left">æ–¹æ³•</th></tr></thead><tbody><tr><td align="left">æ”¾å¤§/ç¼©å°</td><td align="left">é¼ æ ‡æ»šè½® æˆ– è§¦æ§æ¿åŒæŒ‡ç¼©æ”¾</td></tr><tr><td align="left">å¹³ç§»</td><td align="left">æŒ‰ä½Shift+æ‹–æ‹½ æˆ– è§¦æ§æ¿åŒæŒ‡æ»‘åŠ¨</td></tr><tr><td align="left">é€‰æ‹©åŒºåŸŸ</td><td align="left">æŒ‰ä½å·¦é”®æ‹–æ‹½</td></tr><tr><td align="left">æŸ¥çœ‹è¯¦æƒ…</td><td align="left">ç‚¹å‡»slice(è‰²å—)</td></tr><tr><td align="left">æœç´¢</td><td align="left">ç‚¹å‡»é¡¶éƒ¨æœç´¢å›¾æ ‡ æˆ– æŒ‰<code>/</code></td></tr><tr><td align="left">æµ‹é‡æ—¶é—´</td><td align="left">æŒ‰ä½<code>Shift</code>ç‚¹å‡»ä¸¤ä¸ªæ—¶é—´ç‚¹</td></tr><tr><td align="left">æ·»åŠ æ ‡è®°</td><td align="left">æŒ‰<code>M</code>é”®</td></tr><tr><td align="left">å›åˆ°å…¨æ™¯</td><td align="left">åŒå‡»æ—¶é—´è½´ç©ºç™½å¤„</td></tr></tbody></table>
<p><strong>Frame Timelineåˆ†æ</strong>:</p>
<p>Frame Timelineæ˜¯Perfettoæœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€,ç”¨äºåˆ†ææ¸²æŸ“æ€§èƒ½ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5d083c6d5cc4457bf401a7a10619738~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141495&amp;x-signature=mb5iWEjEfT5Vg14AX5pCKgmNpuM%3D" alt="08-04-frame-timeline-stages.png" loading="lazy"/></p>
<p><strong>åˆ†ææ¯ä¸€å¸§</strong>:</p>
<ul>
<li>ç»¿è‰²å¸§: æ­£å¸¸,&lt; 16.6ms</li>
<li>é»„è‰²å¸§: è½»å¾®æ‰å¸§,16.6-33ms (æ‰1å¸§)</li>
<li>çº¢è‰²å¸§: ä¸¥é‡æ‰å¸§,&gt; 33ms (æ‰2å¸§ä»¥ä¸Š)</li>
</ul>
<p>ç‚¹å‡»ä¸€ä¸ªå¸§,å¯ä»¥çœ‹åˆ°è¯¥å¸§çš„è¯¦ç»†æ—¶é—´åˆ†è§£,å¿«é€Ÿå®šä½ç“¶é¢ˆåœ¨å“ªä¸ªé˜¶æ®µã€‚</p>
<h3 data-id="heading-20">3.5 Perfetto SQLæŸ¥è¯¢å…¥é—¨</h3>
<p>Perfettoæœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€å°±æ˜¯SQLæŸ¥è¯¢å¼•æ“,å¯ä»¥å¯¹traceæ•°æ®è¿›è¡Œå¤æ‚çš„åˆ†æã€‚</p>
<p><strong>æ‰“å¼€SQLæŸ¥è¯¢ç•Œé¢</strong>:</p>
<ol>
<li>åœ¨Perfetto UIä¸­æ‰“å¼€traceæ–‡ä»¶</li>
<li>ç‚¹å‡»å³ä¸Šè§’çš„"Query (SQL)"æŒ‰é’®</li>
<li>åœ¨SQLç¼–è¾‘å™¨ä¸­è¾“å…¥æŸ¥è¯¢è¯­å¥</li>
</ol>
<p><strong>å¸¸ç”¨è¡¨ç»“æ„</strong>:</p>








































<table><thead><tr><th align="left">è¡¨å</th><th align="left">è¯´æ˜</th><th align="left">ä¸»è¦å­—æ®µ</th></tr></thead><tbody><tr><td align="left"><code>slice</code></td><td align="left">æ‰€æœ‰å‡½æ•°è°ƒç”¨</td><td align="left">ts, dur, name, depth, track_id</td></tr><tr><td align="left"><code>thread</code></td><td align="left">çº¿ç¨‹ä¿¡æ¯</td><td align="left">utid, tid, name, upid</td></tr><tr><td align="left"><code>process</code></td><td align="left">è¿›ç¨‹ä¿¡æ¯</td><td align="left">upid, pid, name</td></tr><tr><td align="left"><code>thread_track</code></td><td align="left">çº¿ç¨‹è½¨é“æ˜ å°„</td><td align="left">id, utid</td></tr><tr><td align="left"><code>sched</code></td><td align="left">CPUè°ƒåº¦ä¿¡æ¯</td><td align="left">ts, dur, cpu, utid</td></tr><tr><td align="left"><code>counter</code></td><td align="left">è®¡æ•°å™¨æ•°æ®</td><td align="left">ts, value, track_id</td></tr></tbody></table>
<p><strong>ç¤ºä¾‹æŸ¥è¯¢</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥è¯¢ä¸»çº¿ç¨‹çš„æ‰€æœ‰å‡½æ•°è°ƒç”¨</span>
<span class="hljs-keyword">SELECT</span>
  ts <span class="hljs-operator">/</span> <span class="hljs-number">1e9</span> <span class="hljs-keyword">AS</span> start_sec,
  dur <span class="hljs-operator">/</span> <span class="hljs-number">1e6</span> <span class="hljs-keyword">AS</span> duration_ms,
  name
<span class="hljs-keyword">FROM</span> slice
<span class="hljs-keyword">JOIN</span> thread_track <span class="hljs-keyword">ON</span> slice.track_id <span class="hljs-operator">=</span> thread_track.id
<span class="hljs-keyword">JOIN</span> thread <span class="hljs-keyword">ON</span> thread_track.utid <span class="hljs-operator">=</span> thread.utid
<span class="hljs-keyword">WHERE</span> thread.name <span class="hljs-operator">=</span> <span class="hljs-string">'main'</span>
  <span class="hljs-keyword">AND</span> dur <span class="hljs-operator">&gt;</span> <span class="hljs-number">10e6</span>  <span class="hljs-comment">-- åªçœ‹è€—æ—¶è¶…è¿‡10msçš„</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> dur <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>;

<span class="hljs-comment">-- æŸ¥è¯¢GCäº‹ä»¶</span>
<span class="hljs-keyword">SELECT</span>
  ts <span class="hljs-operator">/</span> <span class="hljs-number">1e9</span> <span class="hljs-keyword">AS</span> time_sec,
  dur <span class="hljs-operator">/</span> <span class="hljs-number">1e6</span> <span class="hljs-keyword">AS</span> duration_ms,
  name <span class="hljs-keyword">AS</span> gc_type
<span class="hljs-keyword">FROM</span> slice
<span class="hljs-keyword">WHERE</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'Heap%'</span> <span class="hljs-keyword">OR</span> name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'GC%'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> ts;

<span class="hljs-comment">-- æŸ¥è¯¢CPUä½¿ç”¨ç‡</span>
<span class="hljs-keyword">SELECT</span>
  thread.name,
  <span class="hljs-built_in">SUM</span>(sched.dur) <span class="hljs-operator">/</span> <span class="hljs-number">1e9</span> <span class="hljs-keyword">AS</span> cpu_time_sec
<span class="hljs-keyword">FROM</span> sched
<span class="hljs-keyword">JOIN</span> thread <span class="hljs-keyword">USING</span> (utid)
<span class="hljs-keyword">WHERE</span> thread.name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%myapp%'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> thread.name
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> cpu_time_sec <span class="hljs-keyword">DESC</span>;
</code></pre>
<p>åç»­ç« èŠ‚æˆ‘ä»¬ä¼šè¯¦ç»†ä»‹ç»æ›´å¤šé«˜çº§æŸ¥è¯¢æŠ€å·§ã€‚</p>
<hr/>
<h2 data-id="heading-21">å››ã€Traceåˆ†æå®æˆ˜</h2>
<p>æŒæ¡äº†å·¥å…·çš„ä½¿ç”¨,æ¥ä¸‹æ¥å°±æ˜¯æœ€æ ¸å¿ƒçš„éƒ¨åˆ†:<strong>å¦‚ä½•åˆ†æTraceæ–‡ä»¶,å¿«é€Ÿå®šä½æ€§èƒ½ç“¶é¢ˆ</strong>ã€‚</p>
<h3 data-id="heading-22">4.1 åˆ†ææ€è·¯æ¡†æ¶</h3>
<p>ä¸ç®¡åˆ†æä»€ä¹ˆæ€§èƒ½é—®é¢˜,éƒ½å¯ä»¥éµå¾ªè¿™ä¸ªç³»ç»ŸåŒ–çš„æ€è·¯:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b996063f5b0b42d4be0aa6e3a516f5a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yas5aWHTGFi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141495&amp;x-signature=m7bBEV5ht3ordhe0Z%2BRvCFtXdWI%3D" alt="08-05-trace-analysis-flow.png" loading="lazy"/></p>
<h3 data-id="heading-23">4.2 å¸¸è§æ€§èƒ½æŒ‡æ ‡</h3>
<p>åœ¨åˆ†æTraceæ—¶,éœ€è¦å…³æ³¨ä»¥ä¸‹å…³é”®æŒ‡æ ‡:</p>
<p><strong>1. Wall Duration (å¢™ä¸Šæ—¶é—´)</strong></p>
<ul>
<li>å‡½æ•°ä»å¼€å§‹åˆ°ç»“æŸçš„å®é™…æ—¶é—´</li>
<li>åŒ…å«CPUæ‰§è¡Œæ—¶é—´å’Œç­‰å¾…æ—¶é—´</li>
<li><strong>è¿™æ˜¯ç”¨æˆ·æ„ŸçŸ¥åˆ°çš„æ—¶é—´</strong></li>
</ul>
<p><strong>2. CPU Time (CPUæ—¶é—´)</strong></p>
<ul>
<li>å‡½æ•°å®é™…å ç”¨CPUçš„æ—¶é—´</li>
<li>ä¸åŒ…å«ç­‰å¾…ã€ç¡çœ ç­‰æ—¶é—´</li>
<li>å¦‚æœ <code>CPU Time &lt;&lt; Wall Duration</code>,è¯´æ˜å¤§éƒ¨åˆ†æ—¶é—´åœ¨ç­‰å¾…</li>
</ul>
<p><strong>3. Self Time (è‡ªèº«æ—¶é—´)</strong></p>
<ul>
<li>å‡½æ•°è‡ªèº«çš„æ‰§è¡Œæ—¶é—´,ä¸åŒ…å«è°ƒç”¨å­å‡½æ•°çš„æ—¶é—´</li>
<li>ç”¨äºè¯†åˆ«çœŸæ­£çš„ç“¶é¢ˆå‡½æ•°</li>
</ul>
<p><strong>4. Thread State (çº¿ç¨‹çŠ¶æ€)</strong></p>
<ul>
<li><strong>Running (R)</strong>: æ­£åœ¨CPUä¸Šæ‰§è¡Œ</li>
<li><strong>Runnable (R)</strong>: å°±ç»ªçŠ¶æ€,ç­‰å¾…CPUè°ƒåº¦</li>
<li><strong>Sleeping (S)</strong>: ç¡çœ ,ç­‰å¾…äº‹ä»¶</li>
<li><strong>Uninterruptible Sleep (D)</strong>: ä¸å¯ä¸­æ–­ç¡çœ ,é€šå¸¸æ˜¯I/Oç­‰å¾…</li>
<li><strong>Stopped (T)</strong>: åœæ­¢çŠ¶æ€</li>
</ul>
<p><strong>å¸§æ¸²æŸ“æŒ‡æ ‡</strong>:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">ä¸€å¸§çš„ç†æƒ³æ—¶é—´åˆ†é…</span> <span class="hljs-string">(60fps,</span> <span class="hljs-number">16.</span><span class="hljs-string">6ms):</span>
<span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Input:</span>        <span class="hljs-number">2</span><span class="hljs-string">-3ms</span>    <span class="hljs-string">â”‚</span>  <span class="hljs-string">å¤„ç†è§¦æ‘¸äº‹ä»¶</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Animation:</span>    <span class="hljs-number">1</span><span class="hljs-string">-2ms</span>    <span class="hljs-string">â”‚</span>  <span class="hljs-string">æ‰§è¡ŒåŠ¨ç”»</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Measure:</span>      <span class="hljs-number">2</span><span class="hljs-string">-3ms</span>    <span class="hljs-string">â”‚</span>  <span class="hljs-string">æµ‹é‡Viewå°ºå¯¸</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Layout:</span>       <span class="hljs-number">1</span><span class="hljs-string">-2ms</span>    <span class="hljs-string">â”‚</span>  <span class="hljs-string">å¸ƒå±€Viewä½ç½®</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Draw:</span>         <span class="hljs-number">2</span><span class="hljs-string">-3ms</span>    <span class="hljs-string">â”‚</span>  <span class="hljs-string">ç»˜åˆ¶View</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">RenderThread:</span> <span class="hljs-number">4</span><span class="hljs-string">-5ms</span>    <span class="hljs-string">â”‚</span>  <span class="hljs-string">æ¸²æŸ“çº¿ç¨‹å¤„ç†</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">GPU:</span>          <span class="hljs-number">2</span><span class="hljs-string">-3ms</span>    <span class="hljs-string">â”‚</span>  <span class="hljs-string">GPUæ¸²æŸ“</span>
<span class="hljs-string">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Total:</span>       <span class="hljs-number">14</span><span class="hljs-string">-18ms</span>   <span class="hljs-string">â”‚</span>  <span class="hljs-string">æ€»è€—æ—¶</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre>
<h3 data-id="heading-24">4.3 æ¡ˆä¾‹1: å¯åŠ¨æ€§èƒ½åˆ†æ</h3>
<p><strong>åœºæ™¯</strong>: ä¸€ä¸ªç¤¾äº¤Appå¯åŠ¨éœ€è¦2.8ç§’,éœ€è¦ä¼˜åŒ–åˆ°1.5ç§’ä»¥å†…ã€‚</p>
<p><strong>Step 1: æŠ“å–å¯åŠ¨Trace</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ¸…ç†æ•°æ®</span>
adb shell pm clear com.example.social

<span class="hljs-comment"># æŠ“å–trace</span>
python systrace.py -o launch.html -t 15 -a com.example.social \
  <span class="hljs-built_in">sched</span> freq am wm gfx view dalvik input res app

<span class="hljs-comment"># å¯åŠ¨åº”ç”¨</span>
adb shell am start -W com.example.social/.MainActivity
</code></pre>
<p><strong>Step 2: æ‰“å¼€Trace,å®šä½å…³é”®æ—¶é—´ç‚¹</strong></p>
<p>åœ¨Traceä¸­æœç´¢å…³é”®äº‹ä»¶:</p>
<pre><code class="hljs language-ini" lang="ini">æœç´¢ "activityStart"  â†’ æ‰¾åˆ°å¯åŠ¨å¼€å§‹ç‚¹ (T0)
æœç´¢ "Choreographer<span class="hljs-comment">#doFrame" â†’ æ‰¾åˆ°é¦–å¸§ç»˜åˆ¶ (T1)</span>

æ€»å¯åŠ¨æ—¶é—´: T1 - <span class="hljs-attr">T0</span> = <span class="hljs-number">2850</span>ms
</code></pre>
<p><strong>Step 3: åˆ†æä¸»çº¿ç¨‹æ—¶é—´åˆ†å¸ƒ</strong></p>
<p>æ”¾å¤§ä¸»çº¿ç¨‹,æŸ¥çœ‹å„ä¸ªé˜¶æ®µ:</p>
<pre><code class="hljs language-r" lang="r">Timeline<span class="hljs-operator">:</span>
T0     Application.onCreate<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span>        <span class="hljs-number">450</span>ms
       â”œâ”€ SDKåˆå§‹åŒ–                   <span class="hljs-number">280</span>ms  â† âš ï¸ ç“¶é¢ˆ<span class="hljs-number">1</span>
       â”œâ”€ æ•°æ®åº“åˆå§‹åŒ–                 <span class="hljs-number">120</span>ms
       â””â”€ å…¶ä»–                         <span class="hljs-number">50</span>ms

<span class="hljs-built_in">T</span><span class="hljs-operator">+</span><span class="hljs-number">450</span>  Activity.onCreate<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span>           <span class="hljs-number">380</span>ms
       â”œâ”€ setContentView<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span>            <span class="hljs-number">80</span>ms
       â”œâ”€ loadUserInfo<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">(</span>ç½‘ç»œè¯·æ±‚<span class="hljs-punctuation">)</span>   <span class="hljs-number">200</span>ms  â† âš ï¸ ç“¶é¢ˆ<span class="hljs-number">2</span> <span class="hljs-punctuation">(</span>ä¸»çº¿ç¨‹<span class="hljs-operator">!</span><span class="hljs-punctuation">)</span>
       â””â”€ RecyclerView.init<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span>         <span class="hljs-number">100</span>ms

<span class="hljs-built_in">T</span><span class="hljs-operator">+</span><span class="hljs-number">830</span>  onResume<span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span>                     <span class="hljs-number">50</span>ms

<span class="hljs-built_in">T</span><span class="hljs-operator">+</span><span class="hljs-number">880</span>  é¦–å¸§æµ‹é‡å¸ƒå±€ç»˜åˆ¶                 <span class="hljs-number">150</span>ms

<span class="hljs-built_in">T</span><span class="hljs-operator">+</span><span class="hljs-number">1030</span> RenderThreadæ¸²æŸ“               <span class="hljs-number">80</span>ms

<span class="hljs-built_in">T</span><span class="hljs-operator">+</span><span class="hljs-number">1110</span> ç­‰å¾…ç½‘ç»œæ•°æ®                    <span class="hljs-number">1600</span>ms â† âš ï¸ ç“¶é¢ˆ<span class="hljs-number">3</span>
       <span class="hljs-punctuation">(</span>ä¸»çº¿ç¨‹åœ¨sleep<span class="hljs-operator">!</span><span class="hljs-punctuation">)</span>

<span class="hljs-built_in">T</span><span class="hljs-operator">+</span><span class="hljs-number">2710</span> åˆ·æ–°UI                         <span class="hljs-number">140</span>ms

<span class="hljs-built_in">T</span><span class="hljs-operator">+</span><span class="hljs-number">2850</span> å¯åŠ¨å®Œæˆ
</code></pre>
<p><strong>Step 4: æ ¹å› åˆ†æ</strong></p>
<p><strong>ç“¶é¢ˆ1: SDKåˆå§‹åŒ– 280ms</strong></p>
<ul>
<li>ç‚¹å‡»"SDKåˆå§‹åŒ–"slice,æŸ¥çœ‹å †æ ˆ</li>
<li>å‘ç°æ˜¯ç¬¬ä¸‰æ–¹ç»Ÿè®¡SDKåœ¨åšç½‘ç»œè¯·æ±‚</li>
<li><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>: å»¶è¿Ÿåˆ°åå°åˆå§‹åŒ–</li>
</ul>
<p><strong>ç“¶é¢ˆ2: ä¸»çº¿ç¨‹ç½‘ç»œè¯·æ±‚ 200ms</strong></p>
<ul>
<li>loadUserInfo()åœ¨ä¸»çº¿ç¨‹æ‰§è¡ŒåŒæ­¥ç½‘ç»œè¯·æ±‚</li>
<li><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>: æ”¹ä¸ºå¼‚æ­¥è¯·æ±‚,ä½¿ç”¨ç¼“å­˜æ•°æ®å…ˆå±•ç¤º</li>
</ul>
<p><strong>ç“¶é¢ˆ3: ç­‰å¾…ç½‘ç»œæ•°æ® 1600ms</strong></p>
<ul>
<li>ä¸»çº¿ç¨‹åœ¨ç­‰å¾…æœåŠ¡å™¨è¿”å›</li>
<li><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>: ä½¿ç”¨æœ¬åœ°ç¼“å­˜,å¼‚æ­¥åˆ·æ–°</li>
</ul>
<p><strong>Step 5: ä¼˜åŒ–åéªŒè¯</strong></p>
<p>ä¼˜åŒ–åå†æ¬¡æŠ“å–trace:</p>
<pre><code class="hljs language-scss" lang="scss">Timeline (ä¼˜åŒ–å):
T0     Application.<span class="hljs-built_in">onCreate</span>()        <span class="hljs-number">120ms</span>  â† å‡å°‘<span class="hljs-number">330ms</span>
       â”œâ”€ å…³é”®åˆå§‹åŒ–                   <span class="hljs-number">70ms</span>
       â””â”€ å…¶ä»–                         <span class="hljs-number">50ms</span>

T+<span class="hljs-number">120</span>  Activity.<span class="hljs-built_in">onCreate</span>()           <span class="hljs-number">180ms</span>  â† å‡å°‘<span class="hljs-number">200ms</span>
       â”œâ”€ <span class="hljs-built_in">setContentView</span>()            <span class="hljs-number">80ms</span>
       â”œâ”€ ä»ç¼“å­˜åŠ è½½ç”¨æˆ·ä¿¡æ¯            <span class="hljs-number">30ms</span>
       â””â”€ RecyclerView.<span class="hljs-built_in">init</span>()         <span class="hljs-number">70ms</span>

T+<span class="hljs-number">300</span>  <span class="hljs-built_in">onResume</span>()                     <span class="hljs-number">50ms</span>

T+<span class="hljs-number">350</span>  é¦–å¸§æµ‹é‡å¸ƒå±€ç»˜åˆ¶                 <span class="hljs-number">150ms</span>

T+<span class="hljs-number">500</span>  RenderThreadæ¸²æŸ“               <span class="hljs-number">80ms</span>

T+<span class="hljs-number">580</span>  å¯åŠ¨å®Œæˆ (æ˜¾ç¤ºç¼“å­˜æ•°æ®)
       åå°å¼‚æ­¥æ›´æ–°æ•°æ®...

æ€»å¯åŠ¨æ—¶é—´: <span class="hljs-number">580ms</span> âœ… è¾¾æˆç›®æ ‡!
</code></pre>
<p><strong>ä¼˜åŒ–æ•ˆæœ</strong>:</p>
<ul>
<li>å¯åŠ¨æ—¶é—´ä» 2850ms â†’ 580ms</li>
<li>æå‡äº† <strong>79.6%</strong></li>
<li>ç”¨æˆ·ä½“éªŒæ˜¾è‘—æ”¹å–„</li>
</ul>
<h3 data-id="heading-25">4.4 æ¡ˆä¾‹2: å¡é¡¿åˆ†æ</h3>
<p><strong>åœºæ™¯</strong>: RecyclerViewæ»‘åŠ¨æ—¶ç»å¸¸æ‰å¸§,ä½“éªŒå¾ˆå¡ã€‚</p>
<p><strong>Step 1: æŠ“å–æ»‘åŠ¨Trace</strong></p>
<pre><code class="hljs language-bash" lang="bash">python systrace.py -o scroll.html -t 10 -a com.example.social \
  <span class="hljs-built_in">sched</span> gfx view input wm dalvik app
</code></pre>
<p>æŠ“å–æ—¶åœ¨Appä¸­å¿«é€Ÿæ»‘åŠ¨åˆ—è¡¨ã€‚</p>
<p><strong>Step 2: æŸ¥çœ‹Frame Timeline</strong></p>
<p>åœ¨Perfettoä¸­æ‰“å¼€trace,æŸ¥çœ‹Framesè½¨é“:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Frame Timeline:</span>
<span class="hljs-string">Frame</span> <span class="hljs-comment">#100: 16ms  âœ… ç»¿è‰²</span>
<span class="hljs-string">Frame</span> <span class="hljs-comment">#101: 17ms  âš ï¸ é»„è‰² (è½»å¾®æ‰å¸§)</span>
<span class="hljs-string">Frame</span> <span class="hljs-comment">#102: 34ms  âŒ çº¢è‰² (æ‰1å¸§)</span>
<span class="hljs-string">Frame</span> <span class="hljs-comment">#103: 18ms  âš ï¸ é»„è‰²</span>
<span class="hljs-string">Frame</span> <span class="hljs-comment">#104: 52ms  âŒâŒ çº¢è‰² (æ‰2å¸§)</span>
</code></pre>
<p><strong>Step 3: åˆ†ææ‰å¸§çš„Frame</strong></p>
<p>ç‚¹å‡»Frame #104 (52msçš„é‚£ä¸€å¸§),æŸ¥çœ‹è¯¦æƒ…:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">Frame</span> <span class="hljs-comment">#104 è¯¦ç»†åˆ†æ:</span>
<span class="hljs-string">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Expected:</span> <span class="hljs-number">16.</span><span class="hljs-string">6ms</span>                     <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Actual:</span> <span class="hljs-string">52ms</span> <span class="hljs-string">(æ‰3å¸§!)</span>                <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Input:</span>             <span class="hljs-string">2ms</span>   <span class="hljs-string">â–ˆâ–ˆ</span>          <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Animation:</span>         <span class="hljs-string">1ms</span>   <span class="hljs-string">â–ˆ</span>           <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Measure:</span>           <span class="hljs-string">3ms</span>   <span class="hljs-string">â–ˆâ–ˆâ–ˆ</span>         <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Layout:</span>            <span class="hljs-string">2ms</span>   <span class="hljs-string">â–ˆâ–ˆ</span>          <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">Draw:</span>              <span class="hljs-string">4ms</span>   <span class="hljs-string">â–ˆâ–ˆâ–ˆâ–ˆ</span>        <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-string">RecyclerView.</span>      <span class="hljs-string">35ms</span>  <span class="hljs-string">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span> <span class="hljs-string">â”‚</span> <span class="hljs-string">â†</span> <span class="hljs-string">âš ï¸</span> <span class="hljs-string">ç“¶é¢ˆ!</span>
<span class="hljs-string">â”‚</span>   <span class="hljs-string">onBindViewHolder</span>                   <span class="hljs-string">â”‚</span>
<span class="hljs-string">â”‚</span> <span class="hljs-attr">RenderThread:</span>      <span class="hljs-string">5ms</span>   <span class="hljs-string">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span>       <span class="hljs-string">â”‚</span>
<span class="hljs-string">â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</span>
</code></pre>
<p><strong>Step 4: æ·±å…¥åˆ†æonBindViewHolder</strong></p>
<p>ç‚¹å‡»"onBindViewHolder"slice,æŸ¥çœ‹å †æ ˆ:</p>
<pre><code class="hljs language-java" lang="java">onBindViewHolder (35ms)
  â”œâ”€ loadImage() (20ms)           â† âš ï¸ ä¸»çº¿ç¨‹åŠ è½½å›¾ç‰‡
  â”‚   â”œâ”€ decodeFile() (18ms)      â† è§£ç è€—æ—¶
  â”‚   â””â”€ å…¶ä»– (2ms)
  â”œâ”€ setText() (8ms)
  â”‚   â””â”€ measureText() (7ms)      â† å¤æ‚æ–‡æœ¬æµ‹é‡
  â””â”€ å…¶ä»– (7ms)
</code></pre>
<p><strong>Step 5: æ ¹å› ä¸ä¼˜åŒ–</strong></p>
<p><strong>é—®é¢˜1: ä¸»çº¿ç¨‹åŠ è½½å›¾ç‰‡ 20ms</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ã€ä¼˜åŒ–å‰ã€‘- ä¸»çº¿ç¨‹åŒæ­¥åŠ è½½</span>
override fun <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(holder: ViewHolder, position: Int)</span> {
    <span class="hljs-type">val</span> <span class="hljs-variable">bitmap</span> <span class="hljs-operator">=</span> BitmapFactory.decodeFile(imagePath)  <span class="hljs-comment">// âš ï¸ ä¸»çº¿ç¨‹è§£ç !</span>
    holder.imageView.setImageBitmap(bitmap)
}

<span class="hljs-comment">// ã€ä¼˜åŒ–åã€‘- ä½¿ç”¨Glideå¼‚æ­¥åŠ è½½</span>
override fun <span class="hljs-title function_">onBindViewHolder</span><span class="hljs-params">(holder: ViewHolder, position: Int)</span> {
    Glide.with(context)
        .load(imagePath)
        .placeholder(R.drawable.placeholder)
        .into(holder.imageView)
}
</code></pre>
<p><strong>é—®é¢˜2: å¤æ‚æ–‡æœ¬æµ‹é‡ 7ms</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ã€ä¼˜åŒ–å‰ã€‘- æ¯æ¬¡éƒ½æµ‹é‡</span>
textView.text = SpannableString(text).apply {
    setSpan(ForegroundColorSpan(color), <span class="hljs-number">0</span>, length, <span class="hljs-number">0</span>)
    setSpan(AbsoluteSizeSpan(<span class="hljs-number">20</span>), <span class="hljs-number">0</span>, length, <span class="hljs-number">0</span>)
    <span class="hljs-comment">// å¤šä¸ªspanå¯¼è‡´å¤æ‚æµ‹é‡</span>
}

<span class="hljs-comment">// ã€ä¼˜åŒ–åã€‘- ç¼“å­˜æµ‹é‡ç»“æœ</span>
<span class="hljs-keyword">private</span> <span class="hljs-type">val</span> <span class="hljs-variable">spannableCache</span> <span class="hljs-operator">=</span> LruCache&lt;String, SpannableString&gt;(<span class="hljs-number">100</span>)

fun <span class="hljs-title function_">getSpannable</span><span class="hljs-params">(text: String)</span>: SpannableString {
    <span class="hljs-keyword">return</span> spannableCache.get(text) ?: createSpannable(text).also {
        spannableCache.put(text, it)
    }
}
</code></pre>
<p><strong>ä¼˜åŒ–åéªŒè¯</strong>:</p>
<pre><code class="hljs language-makefile" lang="makefile">Frame Timeline (ä¼˜åŒ–å):
Frame <span class="hljs-comment">#100: 15ms  âœ… ç»¿è‰²</span>
Frame <span class="hljs-comment">#101: 16ms  âœ… ç»¿è‰²</span>
Frame <span class="hljs-comment">#102: 14ms  âœ… ç»¿è‰²</span>
Frame <span class="hljs-comment">#103: 17ms  âš ï¸ é»„è‰² (å¶å°”)</span>
Frame <span class="hljs-comment">#104: 16ms  âœ… ç»¿è‰²</span>

<span class="hljs-section">å¹³å‡å¸§æ—¶é—´: 16ms</span>
<span class="hljs-section">æ‰å¸§ç‡: &lt; 5%  âœ… è¾¾æˆç›®æ ‡!</span>
</code></pre>
<h3 data-id="heading-26">4.5 æ¡ˆä¾‹3: CPUå ç”¨åˆ†æ</h3>
<p><strong>åœºæ™¯</strong>: Appåœ¨åå°CPUå ç”¨é«˜è¾¾30%,å¯¼è‡´è€—ç”µå¿«ã€‚</p>
<p><strong>Step 1: æŠ“å–åå°è¿è¡ŒTrace</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨PerfettoæŠ“å–,åŒ…å«CPUå’Œç”µé‡æ•°æ®</span>
<span class="hljs-comment"># åœ¨ui.perfetto.devé…ç½®:</span>
<span class="hljs-comment"># - Duration: 30s</span>
<span class="hljs-comment"># - Probes: Scheduling, CPU frequency, Battery</span>
</code></pre>
<p><strong>Step 2: ä½¿ç”¨SQLæŸ¥è¯¢åˆ†æCPUå ç”¨</strong></p>
<p>åœ¨Perfetto SQLç•Œé¢è¾“å…¥:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- æŸ¥è¯¢å„çº¿ç¨‹çš„CPUå ç”¨æ—¶é—´</span>
<span class="hljs-keyword">SELECT</span>
  thread.name <span class="hljs-keyword">AS</span> thread_name,
  process.name <span class="hljs-keyword">AS</span> process_name,
  <span class="hljs-built_in">SUM</span>(sched.dur) <span class="hljs-operator">/</span> <span class="hljs-number">1e9</span> <span class="hljs-keyword">AS</span> cpu_time_seconds,
  <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> schedule_count
<span class="hljs-keyword">FROM</span> sched
<span class="hljs-keyword">JOIN</span> thread <span class="hljs-keyword">USING</span> (utid)
<span class="hljs-keyword">JOIN</span> process <span class="hljs-keyword">USING</span> (upid)
<span class="hljs-keyword">WHERE</span> process.name <span class="hljs-operator">=</span> <span class="hljs-string">'com.example.social'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> thread.utid
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> cpu_time_seconds <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>;
</code></pre>
<p><strong>æŸ¥è¯¢ç»“æœ</strong>:</p>
<pre><code class="hljs language-css" lang="css">thread_name              cpu_time_seconds  schedule_count
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BackgroundWorker         <span class="hljs-number">8.2</span>               <span class="hljs-number">1245</span>          â† âš ï¸ å¼‚å¸¸!
<span class="hljs-selector-tag">main</span>                     <span class="hljs-number">2.1</span>               <span class="hljs-number">856</span>
RenderThread             <span class="hljs-number">0.8</span>               <span class="hljs-number">234</span>
binder:<span class="hljs-number">12345</span>_1           <span class="hljs-number">0.5</span>               <span class="hljs-number">123</span>
...
</code></pre>
<p><strong>Step 3: åˆ†æBackgroundWorkerçº¿ç¨‹</strong></p>
<p>æœç´¢"BackgroundWorker",æ”¾å¤§æŸ¥çœ‹:</p>
<pre><code class="hljs language-makefile" lang="makefile">BackgroundWorker Timeline:
<span class="hljs-section">00:00 - 00:02  è¿è¡Œ (å¤„ç†æ•°æ®)     2s</span>
<span class="hljs-section">00:02 - 00:02  ç¡çœ                0.1s</span>
<span class="hljs-section">00:02 - 00:04  è¿è¡Œ (å¤„ç†æ•°æ®)     2s</span>
<span class="hljs-section">00:04 - 00:04  ç¡çœ                0.1s</span>
<span class="hljs-section">00:04 - 00:06  è¿è¡Œ (å¤„ç†æ•°æ®)     2s</span>
...
(æ¯éš”0.1ç§’å”¤é†’ä¸€æ¬¡,å¤„ç†2ç§’!)
</code></pre>
<p><strong>Step 4: æŸ¥çœ‹æºç å®šä½é—®é¢˜</strong></p>
<p>æŸ¥çœ‹å †æ ˆ,æ‰¾åˆ°å¯¹åº”ä»£ç :</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ã€é—®é¢˜ä»£ç ã€‘</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BackgroundWorker</span> : <span class="hljs-type">Thread</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            processData()  <span class="hljs-comment">// è€—æ—¶æ“ä½œ</span>
            Thread.sleep(<span class="hljs-number">100</span>)  <span class="hljs-comment">// åªç¡çœ 0.1ç§’!</span>
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processData</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// å¤„ç†å¤§é‡æ•°æ®,è€—æ—¶2ç§’</span>
        <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = loadDataFromDB()
        analyzeData(<span class="hljs-keyword">data</span>)
        saveResult(<span class="hljs-keyword">data</span>)
    }
}
</code></pre>
<p><strong>é—®é¢˜æ ¹å› </strong>:</p>
<ul>
<li>åå°çº¿ç¨‹æ¯0.1ç§’å”¤é†’ä¸€æ¬¡</li>
<li>æ¯æ¬¡æ‰§è¡Œè€—æ—¶2ç§’çš„æ•°æ®å¤„ç†</li>
<li>å®é™…ä¸Šè¿™ä¸ªä»»åŠ¡æ ¹æœ¬ä¸éœ€è¦è¿™ä¹ˆé¢‘ç¹</li>
</ul>
<p><strong>Step 5: ä¼˜åŒ–æ–¹æ¡ˆ</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ã€ä¼˜åŒ–åã€‘</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BackgroundWorker</span> : <span class="hljs-type">Thread</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            processData()
            Thread.sleep(<span class="hljs-number">300_000</span>)  <span class="hljs-comment">// æ”¹ä¸º5åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</span>
        }
    }
}

<span class="hljs-comment">// ã€æ›´å¥½çš„æ–¹æ¡ˆã€‘ä½¿ç”¨WorkManager</span>
<span class="hljs-keyword">val</span> workRequest = PeriodicWorkRequestBuilder&lt;DataProcessor&gt;(
    <span class="hljs-number">15</span>, TimeUnit.MINUTES  <span class="hljs-comment">// æ¯15åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡</span>
).build()

WorkManager.getInstance(context).enqueue(workRequest)
</code></pre>
<p><strong>ä¼˜åŒ–æ•ˆæœ</strong>:</p>
<pre><code class="hljs language-diff" lang="diff">ä¼˜åŒ–å‰:
<span class="hljs-deletion">- åå°CPUå ç”¨: 30%</span>
<span class="hljs-deletion">- 30ç§’å†…CPUæ—¶é—´: 8.2ç§’</span>
<span class="hljs-deletion">- ç”µé‡æ¶ˆè€—: é«˜</span>

ä¼˜åŒ–å:
<span class="hljs-deletion">- åå°CPUå ç”¨: &lt; 1%</span>
<span class="hljs-deletion">- 30ç§’å†…CPUæ—¶é—´: 0.1ç§’</span>
<span class="hljs-deletion">- ç”µé‡æ¶ˆè€—: æ­£å¸¸</span>
</code></pre>
<hr/>
<h2 data-id="heading-27">äº”ã€ä»£ç æ’æ¡©:è‡ªå®šä¹‰Traceäº‹ä»¶</h2>
<p>æœ‰æ—¶å€™ç³»ç»Ÿé»˜è®¤çš„traceä¿¡æ¯ä¸å¤Ÿè¯¦ç»†,æˆ‘ä»¬éœ€è¦åœ¨è‡ªå·±çš„ä»£ç ä¸­æ·»åŠ traceæ ‡è®°,è¿™å°±æ˜¯<strong>ä»£ç æ’æ¡©</strong>(Instrumentation)ã€‚</p>
<h3 data-id="heading-28">5.1 Java/Kotlinä»£ç æ’æ¡©</h3>
<p>ä½¿ç”¨<code>android.os.Trace</code> APIæ·»åŠ traceæ ‡è®°:</p>
<p><strong>åŸºç¡€ç”¨æ³•</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> android.os.Trace

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        Trace.beginSection(<span class="hljs-string">"MyActivity.onCreate"</span>)
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)

        Trace.beginSection(<span class="hljs-string">"InitData"</span>)
        initData()
        Trace.endSection()

        Trace.beginSection(<span class="hljs-string">"SetupUI"</span>)
        setupUI()
        Trace.endSection()

        Trace.endSection() <span class="hljs-comment">// MyActivity.onCreate</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">initData</span><span class="hljs-params">()</span></span> {
        Trace.beginSection(<span class="hljs-string">"LoadConfig"</span>)
        loadConfig()
        Trace.endSection()

        Trace.beginSection(<span class="hljs-string">"ConnectDB"</span>)
        connectDatabase()
        Trace.endSection()
    }
}
</code></pre>
<p><strong>æ³¨æ„äº‹é¡¹</strong>:</p>
<ul>
<li>âš ï¸ <code>beginSection()</code>å’Œ<code>endSection()</code>å¿…é¡»æˆå¯¹å‡ºç°</li>
<li>âš ï¸ å¿…é¡»åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨</li>
<li>âš ï¸ Sectionåç§°æœ€é•¿127ä¸ªå­—ç¬¦</li>
<li>âš ï¸ åµŒå¥—æ·±åº¦æœ‰é™åˆ¶(é€šå¸¸ä¸è¶…è¿‡20å±‚)</li>
</ul>
<p><strong>ä½¿ç”¨æ‰©å±•å‡½æ•°ç®€åŒ–</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å®šä¹‰æ‰©å±•å‡½æ•°</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">trace</span><span class="hljs-params">(sectionName: <span class="hljs-type">String</span>, block: () -&gt; <span class="hljs-type">T</span>)</span></span>: T {
    Trace.beginSection(sectionName)
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> block()
    } <span class="hljs-keyword">finally</span> {
        Trace.endSection()
    }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
    trace(<span class="hljs-string">"MyActivity.onCreate"</span>) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)

        trace(<span class="hljs-string">"InitData"</span>) {
            initData()
        }

        trace(<span class="hljs-string">"SetupUI"</span>) {
            setupUI()
        }
    }
}
</code></pre>
<h3 data-id="heading-29">5.2 Nativeä»£ç æ’æ¡©</h3>
<p>å¯¹äºC/C++ä»£ç ,ä½¿ç”¨<code>&lt;cutils/trace.h&gt;</code>å¤´æ–‡ä»¶:</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cutils/trace.h&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNativeClass</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">expensiveOperation</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">ATRACE_CALL</span>();  <span class="hljs-comment">// è‡ªåŠ¨è·Ÿè¸ªæ•´ä¸ªå‡½æ•°</span>

        <span class="hljs-built_in">ATRACE_BEGIN</span>(<span class="hljs-string">"LoadData"</span>);
        <span class="hljs-built_in">loadData</span>();
        <span class="hljs-built_in">ATRACE_END</span>();

        <span class="hljs-built_in">ATRACE_BEGIN</span>(<span class="hljs-string">"ProcessData"</span>);
        <span class="hljs-built_in">processData</span>();
        <span class="hljs-built_in">ATRACE_END</span>();

        <span class="hljs-built_in">ATRACE_BEGIN</span>(<span class="hljs-string">"SaveResult"</span>);
        <span class="hljs-built_in">saveResult</span>();
        <span class="hljs-built_in">ATRACE_END</span>();
    }

<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">loadData</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">ATRACE_CALL</span>();  <span class="hljs-comment">// è·Ÿè¸ªloadDataå‡½æ•°</span>
        <span class="hljs-comment">// ... åŠ è½½æ•°æ®</span>
    }

    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">processData</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-built_in">ATRACE_CALL</span>();
        <span class="hljs-comment">// ... å¤„ç†æ•°æ®</span>
    }
};
</code></pre>
<p><strong>Android.mké…ç½®</strong>:</p>
<pre><code class="hljs language-makefile" lang="makefile">LOCAL_SHARED_LIBRARIES := libcutils
</code></pre>
<p><strong>CMakeé…ç½®</strong>:</p>
<pre><code class="hljs language-cmake" lang="cmake">target_link_libraries(mynative cutils)
</code></pre>
<h3 data-id="heading-30">5.3 å¼‚æ­¥äº‹ä»¶è·Ÿè¸ª</h3>
<p>å¯¹äºå¼‚æ­¥æ“ä½œ(å¦‚ç½‘ç»œè¯·æ±‚ã€å›¾ç‰‡åŠ è½½),ä½¿ç”¨å¼‚æ­¥trace:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageLoader</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> cookie = <span class="hljs-number">0</span>

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadImageAsync</span><span class="hljs-params">(url: <span class="hljs-type">String</span>, callback: (<span class="hljs-type">Bitmap</span>) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
        <span class="hljs-keyword">val</span> currentCookie = cookie++
        Trace.beginAsyncSection(<span class="hljs-string">"LoadImage-<span class="hljs-variable">$url</span>"</span>, currentCookie)

        thread {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> bitmap = downloadAndDecode(url)

                runOnUiThread {
                    Trace.endAsyncSection(<span class="hljs-string">"LoadImage-<span class="hljs-variable">$url</span>"</span>, currentCookie)
                    callback(bitmap)
                }
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                Trace.endAsyncSection(<span class="hljs-string">"LoadImage-<span class="hljs-variable">$url</span>"</span>, currentCookie)
                Log.e(TAG, <span class="hljs-string">"Failed to load image"</span>, e)
            }
        }
    }
}
</code></pre>
<p><strong>åœ¨Traceä¸­çš„å±•ç¤º</strong>:</p>
<pre><code class="hljs language-css" lang="css">Timeline:
T0    <span class="hljs-built_in">beginAsyncSection</span>(<span class="hljs-string">"LoadImage"</span>, <span class="hljs-number">123</span>)
      |
      |  (ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œå…¶ä»–æ“ä½œ)
      |
T+<span class="hljs-number">200</span> <span class="hljs-built_in">endAsyncSection</span>(<span class="hljs-string">"LoadImage"</span>, <span class="hljs-number">123</span>)

åœ¨Traceä¸­ä¼šæ˜¾ç¤ºä¸€æ¡æ¨ªè·¨<span class="hljs-number">200ms</span>çš„å¼‚æ­¥slice
</code></pre>
<h3 data-id="heading-31">5.4 Counterè·Ÿè¸ª</h3>
<p>è·Ÿè¸ªæ•°å€¼å˜åŒ–(å¦‚å†…å­˜ä½¿ç”¨ã€é˜Ÿåˆ—é•¿åº¦):</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TaskQueue</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> queue = ConcurrentLinkedQueue&lt;Task&gt;()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">enqueue</span><span class="hljs-params">(task: <span class="hljs-type">Task</span>)</span></span> {
        queue.add(task)
        Trace.setCounter(<span class="hljs-string">"TaskQueue.size"</span>, queue.size.toLong())
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">dequeue</span><span class="hljs-params">()</span></span>: Task? {
        <span class="hljs-keyword">val</span> task = queue.poll()
        Trace.setCounter(<span class="hljs-string">"TaskQueue.size"</span>, queue.size.toLong())
        <span class="hljs-keyword">return</span> task
    }
}
</code></pre>
<p>åœ¨Traceä¸­ä¼šæ˜¾ç¤ºä¸€æ¡æŠ˜çº¿å›¾,å®æ—¶å±•ç¤ºé˜Ÿåˆ—å¤§å°çš„å˜åŒ–ã€‚</p>
<h3 data-id="heading-32">5.5 æœ€ä½³å®è·µ</h3>
<p><strong>1. åˆç†å‘½å</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ ä¸å¥½çš„å‘½å</span>
Trace.beginSection(<span class="hljs-string">"func1"</span>)

<span class="hljs-comment">// âœ… å¥½çš„å‘½å</span>
Trace.beginSection(<span class="hljs-string">"UserRepository.loadProfile"</span>)
</code></pre>
<p><strong>2. æ§åˆ¶ç²’åº¦</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ å¤ªç»†ç²’åº¦ (æ¯ä¸ªå°å‡½æ•°éƒ½trace)</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processData</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Item</span>&gt;)</span></span> {
    Trace.beginSection(<span class="hljs-string">"processData"</span>)
    <span class="hljs-keyword">for</span> (item <span class="hljs-keyword">in</span> <span class="hljs-keyword">data</span>) {
        Trace.beginSection(<span class="hljs-string">"processItem"</span>)  <span class="hljs-comment">// ä¸å¿…è¦</span>
        process(item)
        Trace.endSection()
    }
    Trace.endSection()
}

<span class="hljs-comment">// âœ… åˆé€‚çš„ç²’åº¦</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">processData</span><span class="hljs-params">(<span class="hljs-keyword">data</span>: <span class="hljs-type">List</span>&lt;<span class="hljs-type">Item</span>&gt;)</span></span> {
    Trace.beginSection(<span class="hljs-string">"processData"</span>)
    <span class="hljs-keyword">for</span> (item <span class="hljs-keyword">in</span> <span class="hljs-keyword">data</span>) {
        process(item)  <span class="hljs-comment">// ä¸éœ€è¦æ¯ä¸ªiteméƒ½trace</span>
    }
    Trace.endSection()
}
</code></pre>
<p><strong>3. Releaseç‰ˆæœ¬ä¼˜åŒ–</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åœ¨releaseç‰ˆæœ¬ä¸­ç¦ç”¨traceä»¥å‡å°‘å¼€é”€</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">traceDebug</span><span class="hljs-params">(sectionName: <span class="hljs-type">String</span>, block: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    <span class="hljs-keyword">if</span> (BuildConfig.DEBUG) {
        Trace.beginSection(sectionName)
        <span class="hljs-keyword">try</span> {
            block()
        } <span class="hljs-keyword">finally</span> {
            Trace.endSection()
        }
    } <span class="hljs-keyword">else</span> {
        block()
    }
}
</code></pre>
<p><strong>4. å…³é”®è·¯å¾„ä¼˜å…ˆ</strong>:
ä¼˜å…ˆåœ¨ä»¥ä¸‹åœºæ™¯æ·»åŠ trace:</p>
<ul>
<li>âœ… å¯åŠ¨æµç¨‹çš„å…³é”®æ­¥éª¤</li>
<li>âœ… ç½‘ç»œè¯·æ±‚çš„å„ä¸ªé˜¶æ®µ</li>
<li>âœ… æ•°æ®åº“æ“ä½œ</li>
<li>âœ… å›¾ç‰‡åŠ è½½å’Œè§£ç </li>
<li>âœ… å¤æ‚è®¡ç®—</li>
<li>âœ… RecyclerViewçš„bindæ“ä½œ</li>
</ul>
<hr/>
<h2 data-id="heading-33">å…­ã€è¿›é˜¶æŠ€å·§</h2>
<h3 data-id="heading-34">6.1 Perfettoé«˜çº§SQLæŸ¥è¯¢</h3>
<p><strong>æŸ¥è¯¢æ‰€æœ‰GCäº‹ä»¶åŠå…¶è€—æ—¶</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span>
  ts <span class="hljs-operator">/</span> <span class="hljs-number">1e9</span> <span class="hljs-keyword">AS</span> time_sec,
  dur <span class="hljs-operator">/</span> <span class="hljs-number">1e6</span> <span class="hljs-keyword">AS</span> duration_ms,
  name <span class="hljs-keyword">AS</span> gc_type,
  <span class="hljs-keyword">CASE</span>
    <span class="hljs-keyword">WHEN</span> dur <span class="hljs-operator">&lt;</span> <span class="hljs-number">5e6</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'Minor'</span>
    <span class="hljs-keyword">WHEN</span> dur <span class="hljs-operator">&lt;</span> <span class="hljs-number">50e6</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'Major'</span>
    <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'Critical'</span>
  <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> severity
<span class="hljs-keyword">FROM</span> slice
<span class="hljs-keyword">WHERE</span> name GLOB <span class="hljs-string">'Heap*'</span> <span class="hljs-keyword">OR</span> name GLOB <span class="hljs-string">'GC*'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> dur <span class="hljs-keyword">DESC</span>;
</code></pre>
<p><strong>æŸ¥è¯¢ä¸»çº¿ç¨‹è€—æ—¶æœ€é•¿çš„20ä¸ªæ–¹æ³•</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span>
  name,
  dur <span class="hljs-operator">/</span> <span class="hljs-number">1e6</span> <span class="hljs-keyword">AS</span> duration_ms,
  ts <span class="hljs-operator">/</span> <span class="hljs-number">1e9</span> <span class="hljs-keyword">AS</span> start_time_sec
<span class="hljs-keyword">FROM</span> slice
<span class="hljs-keyword">JOIN</span> thread_track <span class="hljs-keyword">ON</span> slice.track_id <span class="hljs-operator">=</span> thread_track.id
<span class="hljs-keyword">JOIN</span> thread <span class="hljs-keyword">ON</span> thread_track.utid <span class="hljs-operator">=</span> thread.utid
<span class="hljs-keyword">WHERE</span>
  thread.name <span class="hljs-operator">=</span> <span class="hljs-string">'main'</span>
  <span class="hljs-keyword">AND</span> depth <span class="hljs-operator">=</span> <span class="hljs-number">0</span>  <span class="hljs-comment">-- åªçœ‹é¡¶å±‚è°ƒç”¨</span>
  <span class="hljs-keyword">AND</span> dur <span class="hljs-operator">&gt;</span> <span class="hljs-number">10e6</span>  <span class="hljs-comment">-- è¶…è¿‡10ms</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> dur <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>;
</code></pre>
<p><strong>æŸ¥è¯¢Binderè°ƒç”¨ç»Ÿè®¡</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span>
  thread.name <span class="hljs-keyword">AS</span> caller_thread,
  slice.name <span class="hljs-keyword">AS</span> binder_method,
  <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> call_count,
  <span class="hljs-built_in">SUM</span>(dur) <span class="hljs-operator">/</span> <span class="hljs-number">1e6</span> <span class="hljs-keyword">AS</span> total_ms,
  <span class="hljs-built_in">AVG</span>(dur) <span class="hljs-operator">/</span> <span class="hljs-number">1e6</span> <span class="hljs-keyword">AS</span> avg_ms,
  <span class="hljs-built_in">MAX</span>(dur) <span class="hljs-operator">/</span> <span class="hljs-number">1e6</span> <span class="hljs-keyword">AS</span> max_ms
<span class="hljs-keyword">FROM</span> slice
<span class="hljs-keyword">JOIN</span> thread_track <span class="hljs-keyword">ON</span> slice.track_id <span class="hljs-operator">=</span> thread_track.id
<span class="hljs-keyword">JOIN</span> thread <span class="hljs-keyword">ON</span> thread_track.utid <span class="hljs-operator">=</span> thread.utid
<span class="hljs-keyword">WHERE</span> slice.name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'binder%'</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> thread.name, slice.name
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> total_ms <span class="hljs-keyword">DESC</span>;
</code></pre>
<p><strong>åˆ†æå¸§è€—æ—¶åˆ†å¸ƒ</strong>:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span>
  <span class="hljs-keyword">CASE</span>
    <span class="hljs-keyword">WHEN</span> dur <span class="hljs-operator">&lt;</span> <span class="hljs-number">16.6e6</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'æ­£å¸¸ (&lt;16.6ms)'</span>
    <span class="hljs-keyword">WHEN</span> dur <span class="hljs-operator">&lt;</span> <span class="hljs-number">33e6</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'è½»å¾®æ‰å¸§ (16.6-33ms)'</span>
    <span class="hljs-keyword">WHEN</span> dur <span class="hljs-operator">&lt;</span> <span class="hljs-number">50e6</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">'ä¸­åº¦æ‰å¸§ (33-50ms)'</span>
    <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'ä¸¥é‡æ‰å¸§ (&gt;50ms)'</span>
  <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> frame_category,
  <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> frame_count,
  ROUND(<span class="hljs-number">100.0</span> <span class="hljs-operator">*</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">/</span> (<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">FROM</span> actual_frame_timeline_slice), <span class="hljs-number">2</span>) <span class="hljs-keyword">AS</span> percentage
<span class="hljs-keyword">FROM</span> actual_frame_timeline_slice
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> frame_category
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> frame_count <span class="hljs-keyword">DESC</span>;
</code></pre>
<h3 data-id="heading-35">6.2 è‡ªåŠ¨åŒ–åˆ†æè„šæœ¬</h3>
<p>ä½¿ç”¨Pythonå’ŒPerfetto Trace Processorè¿›è¡Œè‡ªåŠ¨åŒ–åˆ†æ:</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment">#!/usr/bin/env python3</span>
<span class="hljs-string">"""
å¯åŠ¨æ—¶é—´è‡ªåŠ¨åŒ–åˆ†æè„šæœ¬
"""</span>
<span class="hljs-keyword">from</span> perfetto.trace_processor <span class="hljs-keyword">import</span> TraceProcessor
<span class="hljs-keyword">import</span> sys

<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_startup</span>(<span class="hljs-params">trace_file</span>):
    tp = TraceProcessor(trace=trace_file)

    <span class="hljs-comment"># æŸ¥è¯¢Application.onCreateçš„è€—æ—¶</span>
    query = <span class="hljs-string">'''
    SELECT
        ts / 1e9 AS start_sec,
        dur / 1e6 AS duration_ms
    FROM slice
    WHERE name = 'Application.onCreate'
    '''</span>

    result = tp.query(query)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(result) &gt; <span class="hljs-number">0</span>:
        app_create_time = result.duration_ms[<span class="hljs-number">0</span>]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Application.onCreate: <span class="hljs-subst">{app_create_time:<span class="hljs-number">.2</span>f}</span>ms"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"æœªæ‰¾åˆ°Application.onCreateäº‹ä»¶"</span>)
        <span class="hljs-keyword">return</span>

    <span class="hljs-comment"># æŸ¥è¯¢Activity.onCreateçš„è€—æ—¶</span>
    query = <span class="hljs-string">'''
    SELECT
        ts / 1e9 AS start_sec,
        dur / 1e6 AS duration_ms
    FROM slice
    WHERE name LIKE '%Activity.onCreate%'
    '''</span>

    result = tp.query(query)
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(result) &gt; <span class="hljs-number">0</span>:
        activity_create_time = result.duration_ms[<span class="hljs-number">0</span>]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Activity.onCreate: <span class="hljs-subst">{activity_create_time:<span class="hljs-number">.2</span>f}</span>ms"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"æœªæ‰¾åˆ°Activity.onCreateäº‹ä»¶"</span>)
        <span class="hljs-keyword">return</span>

    <span class="hljs-comment"># æŸ¥è¯¢é¦–å¸§æ¸²æŸ“æ—¶é—´</span>
    query = <span class="hljs-string">'''
    SELECT MIN(ts) / 1e9 AS first_frame_sec
    FROM actual_frame_timeline_slice
    '''</span>

    result = tp.query(query)
    first_frame_time = result.first_frame_sec[<span class="hljs-number">0</span>]

    <span class="hljs-comment"># è®¡ç®—æ€»å¯åŠ¨æ—¶é—´</span>
    query = <span class="hljs-string">'''
    SELECT MIN(ts) / 1e9 AS app_start_sec
    FROM slice
    WHERE name = 'Application.onCreate'
    '''</span>

    result = tp.query(query)
    app_start_time = result.app_start_sec[<span class="hljs-number">0</span>]

    total_startup = (first_frame_time - app_start_time) * <span class="hljs-number">1000</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ€»å¯åŠ¨æ—¶é—´: <span class="hljs-subst">{total_startup:<span class="hljs-number">.2</span>f}</span>ms"</span>)

    <span class="hljs-comment"># æ€§èƒ½è¯„çº§</span>
    <span class="hljs-keyword">if</span> total_startup &lt; <span class="hljs-number">1000</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âœ… æ€§èƒ½è¯„çº§: ä¼˜ç§€"</span>)
    <span class="hljs-keyword">elif</span> total_startup &lt; <span class="hljs-number">2000</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âš ï¸ æ€§èƒ½è¯„çº§: è‰¯å¥½"</span>)
    <span class="hljs-keyword">elif</span> total_startup &lt; <span class="hljs-number">3000</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âš ï¸ æ€§èƒ½è¯„çº§: ä¸€èˆ¬"</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"âŒ æ€§èƒ½è¯„çº§: éœ€è¦ä¼˜åŒ–"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(sys.argv) &lt; <span class="hljs-number">2</span>:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"ç”¨æ³•: python analyze_startup.py trace.perfetto-trace"</span>)
        sys.exit(<span class="hljs-number">1</span>)

    analyze_startup(sys.argv[<span class="hljs-number">1</span>])
</code></pre>
<p><strong>ä½¿ç”¨æ–¹æ³•</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">python analyze_startup.py launch.perfetto-trace

<span class="hljs-comment"># è¾“å‡º:</span>
<span class="hljs-comment"># Application.onCreate: 450.23ms</span>
<span class="hljs-comment"># Activity.onCreate: 380.45ms</span>
<span class="hljs-comment"># æ€»å¯åŠ¨æ—¶é—´: 1245.67ms</span>
<span class="hljs-comment"># âš ï¸ æ€§èƒ½è¯„çº§: è‰¯å¥½</span>
</code></pre>
<hr/>
<h2 data-id="heading-36">ä¸ƒã€å¸¸è§é—®é¢˜ä¸è§£å†³</h2>
<h3 data-id="heading-37">7.1 TraceæŠ“å–å¤±è´¥</h3>
<p><strong>é—®é¢˜</strong>: æ‰§è¡Œsystrace/perfettoå‘½ä»¤åæ— è¾“å‡ºæˆ–æŠ¥é”™</p>
<p><strong>å¯èƒ½åŸå› ä¸è§£å†³</strong>:</p>
<ol>
<li><strong>è®¾å¤‡æœªæˆæƒ</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ£€æŸ¥è®¾å¤‡è¿æ¥</span>
adb devices
<span class="hljs-comment"># å¦‚æœæ˜¾ç¤º "unauthorized",é‡æ–°æˆæƒ</span>
adb kill-server
adb start-server
</code></pre>
<ol start="2">
<li><strong>æƒé™ä¸è¶³</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># éœ€è¦rootæƒé™</span>
adb root
adb remount
</code></pre>
<ol start="3">
<li><strong>bufferå¤§å°ä¸è¶³</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¢å¤§buffer</span>
python systrace.py -b 65536 ...  <span class="hljs-comment"># 64MB</span>
</code></pre>
<ol start="4">
<li><strong>categoryä¸æ”¯æŒ</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹è®¾å¤‡æ”¯æŒçš„category</span>
adb shell atrace --list_categories
</code></pre>
<h3 data-id="heading-38">7.2 Traceæ–‡ä»¶è¿‡å¤§</h3>
<p><strong>é—®é¢˜</strong>: Traceæ–‡ä»¶å‡ ç™¾MB,Chromeæ‰“ä¸å¼€æˆ–å¾ˆå¡</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<ol>
<li><strong>å‡å°‘æŠ“å–æ—¶é•¿</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä»10ç§’æ”¹ä¸º5ç§’</span>
-t 5
</code></pre>
<ol start="2">
<li><strong>åªé€‰æ‹©å¿…è¦çš„category</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸è¦ç”¨ --all,ç²¾ç¡®æŒ‡å®š</span>
python systrace.py ... <span class="hljs-built_in">sched</span> gfx view am
</code></pre>
<ol start="3">
<li>
<p><strong>ä½¿ç”¨Perfettoä»£æ›¿Systrace</strong>
Perfettoçš„protobufæ ¼å¼æ–‡ä»¶æ›´å°,åŠ è½½æ›´å¿«</p>
</li>
<li>
<p><strong>ä½¿ç”¨Perfettoçš„åœ¨çº¿æŸ¥çœ‹</strong>
ä¸è¦ä¸‹è½½æ–‡ä»¶,ç›´æ¥åœ¨ ui.perfetto.dev ä¸Šåˆ†æ</p>
</li>
</ol>
<h3 data-id="heading-39">7.3 æ‰¾ä¸åˆ°å…³é”®äº‹ä»¶</h3>
<p><strong>é—®é¢˜</strong>: åœ¨Traceä¸­æœç´¢ä¸åˆ°æˆ‘çš„å‡½æ•°è°ƒç”¨</p>
<p><strong>å¯èƒ½åŸå› </strong>:</p>
<ol>
<li><strong>æ²¡æœ‰å¯ç”¨app category</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ç¡®ä¿åŒ…å« app category</span>
python systrace.py ... app
</code></pre>
<ol start="2">
<li><strong>ä»£ç æ²¡æœ‰æ’æ¡©</strong></li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// éœ€è¦æ·»åŠ  Trace.beginSection()</span>
Trace.beginSection(<span class="hljs-string">"MyFunction"</span>)
myFunction()
Trace.endSection()
</code></pre>
<ol start="3">
<li><strong>å‡½æ•°æ‰§è¡Œæ—¶é—´å¤ªçŸ­</strong></li>
</ol>
<ul>
<li>å°äº0.1msçš„å‡½æ•°å¯èƒ½ä¸ä¼šæ˜¾ç¤º</li>
<li>æ”¾å¤§æ—¶é—´è½´æŸ¥çœ‹</li>
</ul>
<ol start="4">
<li><strong>æ²¡æœ‰æŒ‡å®šåº”ç”¨åŒ…å</strong></li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŒ‡å®šåŒ…åä»¥æŠ“å–åº”ç”¨çš„trace</span>
python systrace.py -a com.example.myapp ...
</code></pre>
<h3 data-id="heading-40">7.4 Traceçœ‹ä¸æ‡‚</h3>
<p><strong>é—®é¢˜</strong>: Traceæ–‡ä»¶æ‰“å¼€äº†,ä½†ä¸çŸ¥é“æ€ä¹ˆåˆ†æ</p>
<p><strong>å»ºè®®</strong>:</p>
<ol>
<li>
<p><strong>ä»å®è§‚åˆ°å¾®è§‚</strong></p>
<ul>
<li>å…ˆç¼©å°æŸ¥çœ‹æ•´ä½“</li>
<li>è¯†åˆ«å¤§å—è€—æ—¶</li>
<li>å†æ”¾å¤§æŸ¥çœ‹ç»†èŠ‚</li>
</ul>
</li>
<li>
<p><strong>å…³æ³¨ä¸»çº¿ç¨‹</strong></p>
<ul>
<li>ä¸»çº¿ç¨‹çš„ç©ºç™½åŒºåŸŸå¯èƒ½åœ¨ç­‰å¾…</li>
<li>æŸ¥çœ‹ä¸»çº¿ç¨‹åœ¨åšä»€ä¹ˆ</li>
</ul>
</li>
<li>
<p><strong>å¯¹æ¯”VSYNCä¿¡å·</strong></p>
<ul>
<li>çœ‹æ¸²æŸ“æ˜¯å¦è·Ÿä¸ŠVSYNCèŠ‚å¥</li>
<li>è¯†åˆ«æ‰å¸§åŸå› </li>
</ul>
</li>
<li>
<p><strong>æœç´¢å…³é”®äº‹ä»¶</strong></p>
<ul>
<li><code>activityStart</code>, <code>onCreate</code>, <code>draw</code>, <code>measure</code></li>
<li>ä½¿ç”¨æœç´¢åŠŸèƒ½å¿«é€Ÿå®šä½</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹CPUè°ƒåº¦</strong></p>
<ul>
<li>çº¿ç¨‹æ˜¯åœ¨è¿è¡Œè¿˜æ˜¯ç­‰å¾…</li>
<li>CPUæ˜¯å¦è¢«å…¶ä»–è¿›ç¨‹å ç”¨</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-41">å…«ã€å·¥å…·å¯¹æ¯”ä¸é€‰æ‹©å»ºè®®</h2>
<h3 data-id="heading-42">8.1 ä½•æ—¶ä½¿ç”¨Systrace</h3>
<p><strong>æ¨èåœºæ™¯</strong>:</p>
<ul>
<li>âœ… Android 9åŠä»¥ä¸‹ç³»ç»Ÿ</li>
<li>âœ… ç®€å•çš„æ€§èƒ½åˆ†æ(å¯åŠ¨ã€å¡é¡¿)</li>
<li>âœ… ä¸éœ€è¦å¤æ‚æŸ¥è¯¢</li>
<li>âœ… å›¢é˜Ÿæˆå‘˜å¯¹Chrome Trace Viewerç†Ÿæ‚‰</li>
</ul>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>ç®€å•æ˜“ç”¨,ä¸€è¡Œå‘½ä»¤æå®š</li>
<li>å…¼å®¹è€ç‰ˆæœ¬Android</li>
<li>HTMLæ–‡ä»¶å¯ä»¥ç¦»çº¿æŸ¥çœ‹</li>
</ul>
<h3 data-id="heading-43">8.2 ä½•æ—¶ä½¿ç”¨Perfetto</h3>
<p><strong>æ¨èåœºæ™¯</strong>:</p>
<ul>
<li>âœ… <strong>Android 10åŠä»¥ä¸Šç³»ç»Ÿ</strong> (å¼ºçƒˆæ¨è)</li>
<li>âœ… éœ€è¦SQLæŸ¥è¯¢è¿›è¡Œæ·±åº¦åˆ†æ</li>
<li>âœ… éœ€è¦å†…å­˜ã€ç”µé‡ç­‰é¢å¤–æ•°æ®</li>
<li>âœ… éœ€è¦è‡ªåŠ¨åŒ–åˆ†æ(CI/CD)</li>
<li>âœ… å¤§å‹traceæ–‡ä»¶</li>
</ul>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li>ç°ä»£åŒ–UI,ä½“éªŒæä½³</li>
<li>SQLæŸ¥è¯¢å¼•æ“,åˆ†æèƒ½åŠ›å¼º</li>
<li>æ–‡ä»¶æ›´å°,åŠ è½½æ›´å¿«</li>
<li>æŒç»­æ›´æ–°,åŠŸèƒ½ä¸°å¯Œ</li>
</ul>
<h3 data-id="heading-44">8.3 é€‰æ‹©å»ºè®®</h3>


















































<table><thead><tr><th align="left">åœºæ™¯</th><th align="left">æ¨èå·¥å…·</th><th align="left">ç†ç”±</th></tr></thead><tbody><tr><td align="left">æ–°é¡¹ç›®</td><td align="left"><strong>Perfetto</strong></td><td align="left">åŠŸèƒ½å¼ºå¤§,ä½“éªŒå¥½</td></tr><tr><td align="left">è€é¡¹ç›®(Android 9-)</td><td align="left">Systrace</td><td align="left">å…¼å®¹æ€§</td></tr><tr><td align="left">å¯åŠ¨ä¼˜åŒ–</td><td align="left">Perfetto</td><td align="left">SQLæŸ¥è¯¢æ–¹ä¾¿ç»Ÿè®¡</td></tr><tr><td align="left">å¡é¡¿åˆ†æ</td><td align="left">Perfetto</td><td align="left">Frame Timelineå¼ºå¤§</td></tr><tr><td align="left">å¿«é€Ÿæ’æŸ¥</td><td align="left">Systrace</td><td align="left">ç®€å•å¿«é€Ÿ</td></tr><tr><td align="left">æ·±åº¦åˆ†æ</td><td align="left"><strong>Perfetto</strong></td><td align="left">SQLæŸ¥è¯¢ + å¤šæ•°æ®æº</td></tr><tr><td align="left">CIé›†æˆ</td><td align="left"><strong>Perfetto</strong></td><td align="left">Trace Processor API</td></tr><tr><td align="left">å­¦ä¹ å…¥é—¨</td><td align="left">Systrace</td><td align="left">ç®€å•æ˜“æ‡‚</td></tr></tbody></table>
<p><strong>æ€»ç»“</strong>: å¦‚æœä½ çš„é¡¹ç›®ä¸»è¦æ”¯æŒAndroid 10+,å¼ºçƒˆæ¨èä»ç°åœ¨å¼€å§‹ä½¿ç”¨Perfetto!</p>
<hr/>
<h2 data-id="heading-45">ä¹ã€æ€»ç»“ä¸å±•æœ›</h2>
<h3 data-id="heading-46">9.1 æ ¸å¿ƒè¦ç‚¹å›é¡¾</h3>
<p>é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ,æˆ‘ä»¬å…¨é¢æŒæ¡äº†Systraceå’ŒPerfettoä¸¤å¤§æ€§èƒ½åˆ†æå·¥å…·:</p>
<p><strong>å·¥å…·ä½¿ç”¨</strong>:</p>
<ul>
<li>âœ… ç†è§£äº†Traceçš„å·¥ä½œåŸç†å’Œåº”ç”¨åœºæ™¯</li>
<li>âœ… æŒæ¡äº†Systraceå’ŒPerfettoçš„æŠ“å–æ–¹æ³•</li>
<li>âœ… å­¦ä¼šäº†Perfetto UIçš„å„é¡¹åŠŸèƒ½</li>
<li>âœ… äº†è§£äº†ä¸¤ç§å·¥å…·çš„å¯¹æ¯”å’Œé€‰æ‹©</li>
</ul>
<p><strong>åˆ†ææ–¹æ³•</strong>:</p>
<ul>
<li>âœ… å»ºç«‹äº†ç³»ç»ŸåŒ–çš„Traceåˆ†ææ€è·¯</li>
<li>âœ… å­¦ä¼šäº†å®šä½å¯åŠ¨æ…¢ã€å¡é¡¿ã€CPUå ç”¨ç­‰é—®é¢˜</li>
<li>âœ… æŒæ¡äº†Frame Timelineåˆ†ææŠ€å·§</li>
<li>âœ… ç†è§£äº†å…³é”®æ€§èƒ½æŒ‡æ ‡çš„å«ä¹‰</li>
</ul>
<p><strong>å®æˆ˜æŠ€èƒ½</strong>:</p>
<ul>
<li>âœ… æŒæ¡äº†Java/Kotlin/Nativeä»£ç æ’æ¡©</li>
<li>âœ… å­¦ä¼šäº†Perfetto SQLé«˜çº§æŸ¥è¯¢</li>
<li>âœ… äº†è§£äº†è‡ªåŠ¨åŒ–åˆ†æå’ŒCIé›†æˆ</li>
<li>âœ… èƒ½å¤Ÿç‹¬ç«‹å®Œæˆæ€§èƒ½é—®é¢˜çš„æ’æŸ¥</li>
</ul>
<h3 data-id="heading-47">9.2 æœ€ä½³å®è·µæ€»ç»“</h3>
<p><strong>DO (æ¨èåšæ³•)</strong>:</p>
<ul>
<li>âœ… ä¼˜å…ˆä½¿ç”¨Perfetto (Android 10+)</li>
<li>âœ… åœ¨å…³é”®è·¯å¾„æ·»åŠ traceæ ‡è®°</li>
<li>âœ… å®šæœŸè¿›è¡Œæ€§èƒ½å›å½’æµ‹è¯•</li>
<li>âœ… å»ºç«‹æ€§èƒ½åŸºçº¿å’Œé˜ˆå€¼</li>
<li>âœ… ä½¿ç”¨SQLæŸ¥è¯¢è¿›è¡Œæ·±åº¦åˆ†æ</li>
<li>âœ… ä¿å­˜é‡è¦çš„traceæ–‡ä»¶ä»¥ä¾¿å¯¹æ¯”</li>
<li>âœ… å›¢é˜Ÿå†…åˆ†äº«traceåˆ†æç»éªŒ</li>
</ul>
<p><strong>DON'T (é¿å…åšæ³•)</strong>:</p>
<ul>
<li>âŒ ä¸è¦å‡­æ„Ÿè§‰ä¼˜åŒ–,è¦ç”¨æ•°æ®è¯´è¯</li>
<li>âŒ ä¸è¦åªä¼˜åŒ–å±€éƒ¨,è¦çœ‹æ•´ä½“</li>
<li>âŒ ä¸è¦åœ¨releaseç‰ˆæœ¬ä¿ç•™è¿‡å¤štrace</li>
<li>âŒ ä¸è¦å¿½ç•¥å°çš„æ€§èƒ½é—®é¢˜</li>
<li>âŒ ä¸è¦ç­‰ç”¨æˆ·åé¦ˆæ‰å¼€å§‹ä¼˜åŒ–</li>
</ul>
<h3 data-id="heading-48">9.3 è¿›ä¸€æ­¥å­¦ä¹ èµ„æº</h3>
<p><strong>å®˜æ–¹æ–‡æ¡£</strong>:</p>
<ul>
<li>Systrace: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftopic%2Fperformance%2Ftracing" target="_blank" title="https://developer.android.com/topic/performance/tracing" ref="nofollow noopener noreferrer">developer.android.com/topic/perfoâ€¦</a></li>
<li>Perfetto: <a href="https://link.juejin.cn?target=https%3A%2F%2Fperfetto.dev%2F" target="_blank" title="https://perfetto.dev/" ref="nofollow noopener noreferrer">perfetto.dev/</a></li>
<li>Perfetto SQL: <a href="https://link.juejin.cn?target=https%3A%2F%2Fperfetto.dev%2Fdocs%2Fanalysis%2Fsql-tables" target="_blank" title="https://perfetto.dev/docs/analysis/sql-tables" ref="nofollow noopener noreferrer">perfetto.dev/docs/analysâ€¦</a></li>
</ul>
<p><strong>å·¥å…·</strong>:</p>
<ul>
<li>Perfetto UI: <a href="https://link.juejin.cn?target=https%3A%2F%2Fui.perfetto.dev%2F" target="_blank" title="https://ui.perfetto.dev/" ref="nofollow noopener noreferrer">ui.perfetto.dev/</a></li>
<li>Trace Processor: <a href="https://link.juejin.cn?target=https%3A%2F%2Fperfetto.dev%2Fdocs%2Fanalysis%2Ftrace-processor" target="_blank" title="https://perfetto.dev/docs/analysis/trace-processor" ref="nofollow noopener noreferrer">perfetto.dev/docs/analysâ€¦</a></li>
</ul>
<p><strong>ç¤¾åŒº</strong>:</p>
<ul>
<li>Android Performance Patterns (YouTube)</li>
<li>Android Developers Blog</li>
<li>Stack Overflow (æ ‡ç­¾: android-performance)</li>
</ul>
<p><strong>ç›¸å…³æ–‡ç« </strong>:</p>
<ul>
<li><a href="https://juejin.cn/post/7590071125397766184" target="_blank" title="https://juejin.cn/post/7590071125397766184">ä¸Šä¸€ç¯‡: ç¨³å®šæ€§æ€§èƒ½ç³»åˆ—ä¹‹ä¸ƒâ€”â€”Watchdogæœºåˆ¶:ç³»ç»Ÿå®ˆæŠ¤è€…çš„å·¥ä½œåŸç†</a></li>
<li><a href="https://juejin.cn/post/7587473691170095104" target="_blank" title="https://juejin.cn/post/7587473691170095104">ç³»åˆ—ç›®å½•: Androidç³»ç»Ÿç¨³å®šæ€§ä¸æ€§èƒ½ä¼˜åŒ–</a></li>
</ul>
<hr/>
<p><strong>è®°ä½</strong>:æ€§èƒ½ä¼˜åŒ–ä¸æ˜¯ä¸€æ¬¡æ€§çš„å·¥ä½œ,è€Œæ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ã€‚å®šæœŸä½¿ç”¨Traceå·¥å…·æ£€æŸ¥æ€§èƒ½,åŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜,æ‰èƒ½ä¿è¯åº”ç”¨å§‹ç»ˆä¿æŒæœ€ä½³çŠ¶æ€ã€‚</p>
<p>å½“ä½ ä¸‹æ¬¡é‡åˆ°æ€§èƒ½é—®é¢˜æ—¶,ä¸è¦æ…Œå¼ ,æ‰“å¼€Perfetto,æŠ“ä¸ªtrace,ç­”æ¡ˆå°±åœ¨é‚£é‡Œ! ğŸ“Šâœ¨</p>
<hr/>
<blockquote>
<p><strong>ä½œè€…ç®€ä»‹</strong>: å¤šå¹´Androidç³»ç»Ÿå¼€å‘ç»éªŒ,ä¸“æ³¨äºç³»ç»Ÿç¨³å®šæ€§ä¸æ€§èƒ½ä¼˜åŒ–é¢†åŸŸã€‚æ¬¢è¿å…³æ³¨æœ¬ç³»åˆ—,ä¸€èµ·æ·±å…¥Androidç³»ç»Ÿçš„ç²¾å½©ä¸–ç•Œ!</p>
</blockquote>
<hr/>
<h3 data-id="heading-49">ğŸ‰ æ„Ÿè°¢å…³æ³¨,è®©æˆ‘ä»¬ä¸€èµ·æ·±å…¥Androidç³»ç»Ÿçš„ç²¾å½©ä¸–ç•Œ!</h3>
<h3 data-id="heading-50"><strong>æ‰¾åˆ°æˆ‘</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fhome.wonlab.top" target="_blank" title="https://home.wonlab.top" ref="nofollow noopener noreferrer">ä¸ªäººä¸»é¡µ</a></h3></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Browser-Use æŠ€æœ¯æ¶æ„åˆ†æ]]></title>    <link>https://juejin.cn/post/7591334208997720090</link>    <guid>https://juejin.cn/post/7591334208997720090</guid>    <pubDate>2026-01-04T14:15:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591334208997720090" data-draft-id="7591377757733584905" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Browser-Use æŠ€æœ¯æ¶æ„åˆ†æ"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½,Agent"/> <meta itemprop="datePublished" content="2026-01-04T14:15:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ²™æ¼ çš„æµªäºº"/> <meta itemprop="url" content="https://juejin.cn/user/2330620382946541"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Browser-Use æŠ€æœ¯æ¶æ„åˆ†æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2330620382946541/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ²™æ¼ çš„æµªäºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T14:15:07.000Z" title="Sun Jan 04 2026 14:15:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Browser-Use æŠ€æœ¯æ¶æ„åˆ†æ</h2>
<h3 data-id="heading-1">æ¦‚è¿°</h3>
<p>Browser-Use æ˜¯ä¸€ä¸ªåŸºäº LLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰å’Œ CDPï¼ˆChrome DevTools Protocolï¼‰çš„å¼‚æ­¥ Python æµè§ˆå™¨è‡ªåŠ¨åŒ–åº“ï¼Œæ—¨åœ¨è®© AI æ™ºèƒ½ä½“èƒ½å¤Ÿè‡ªä¸»å¯¼èˆªç½‘é¡µã€ä¸å…ƒç´ äº¤äº’å¹¶å®Œæˆå¤æ‚ä»»åŠ¡ã€‚è¯¥åº“é‡‡ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œé€šè¿‡ LLM é©±åŠ¨çš„å†³ç­–å¾ªç¯å®ç°æ™ºèƒ½åŒ–çš„æµè§ˆå™¨æ“ä½œã€‚Browser-Use æ”¯æŒå¤šç§ LLM æä¾›å•†ï¼ˆOpenAIã€Anthropicã€Googleã€Groq ç­‰ï¼‰ï¼Œæä¾›äº†å®Œæ•´çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–èƒ½åŠ›ï¼ŒåŒ…æ‹¬é¡µé¢å¯¼èˆªã€å…ƒç´ äº¤äº’ã€è¡¨å•å¡«å†™ã€æ–‡ä»¶ä¸Šä¼ ç­‰ã€‚è¯¥åº“ç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¤æ‚ Web äº¤äº’çš„ AI æ™ºèƒ½ä½“åœºæ™¯ï¼Œå¦‚è‡ªåŠ¨åŒ–æµ‹è¯•ã€æ•°æ®æŠ“å–ã€ä»»åŠ¡è‡ªåŠ¨åŒ–ç­‰ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹æ€§ï¼š</strong></p>
<ul>
<li>åŸºäº LLM çš„æ™ºèƒ½å†³ç­–ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™å¤æ‚çš„æµè§ˆå™¨æ“ä½œè„šæœ¬</li>
<li>äº‹ä»¶é©±åŠ¨çš„æµè§ˆå™¨ç®¡ç†ï¼Œé€šè¿‡ Watchdog ç³»ç»Ÿå®ç°è‡ªåŠ¨åŒ–ç›‘æ§å’Œå¤„ç†</li>
<li>å®Œæ•´çš„ DOM å¤„ç†å’Œå¯è®¿é—®æ€§æ ‘æ”¯æŒï¼Œç¡®ä¿æ™ºèƒ½ä½“èƒ½å¤Ÿå‡†ç¡®ç†è§£é¡µé¢ç»“æ„</li>
<li>æ”¯æŒå¤šç§ LLM æä¾›å•†å’Œè‡ªå®šä¹‰å·¥å…·æ‰©å±•</li>
<li>æä¾›äº‘ç«¯æµè§ˆå™¨æœåŠ¡ï¼ˆBrowser Use Cloudï¼‰ï¼Œæ”¯æŒéšèº«æµè§ˆå™¨å’Œä»£ç†è½®æ¢</li>
</ul>
<p><strong>åº”ç”¨åœºæ™¯ï¼š</strong></p>
<ul>
<li>AI æ™ºèƒ½ä½“çš„æµè§ˆå™¨è‡ªåŠ¨åŒ–ä»»åŠ¡</li>
<li>å¤æ‚çš„ Web è¡¨å•å¡«å†™å’Œæ•°æ®æå–</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•</li>
<li>ç½‘é¡µæ•°æ®æŠ“å–å’Œä¿¡æ¯æ”¶é›†</li>
<li>ä»»åŠ¡è‡ªåŠ¨åŒ–å’Œå·¥ä½œæµè‡ªåŠ¨åŒ–</li>
</ul>
<h3 data-id="heading-2">æ ¸å¿ƒæ¦‚å¿µå’Œæœ¯è¯­</h3>
<ul>
<li><strong>Agentï¼ˆæ™ºèƒ½ä½“ï¼‰</strong>ï¼šBrowser-Use çš„æ ¸å¿ƒç¼–æ’å™¨ï¼Œè´Ÿè´£æ¥æ”¶ä»»åŠ¡ã€ç®¡ç†æµè§ˆå™¨ä¼šè¯å¹¶æ‰§è¡Œ LLM é©±åŠ¨çš„åŠ¨ä½œå¾ªç¯</li>
<li><strong>BrowserSessionï¼ˆæµè§ˆå™¨ä¼šè¯ï¼‰</strong>ï¼šç®¡ç†æµè§ˆå™¨ç”Ÿå‘½å‘¨æœŸã€CDP è¿æ¥å’Œå¤šä¸ª Watchdog æœåŠ¡çš„åè°ƒ</li>
<li><strong>CDPï¼ˆChrome DevTools Protocolï¼‰</strong>ï¼šChrome æµè§ˆå™¨æä¾›çš„è°ƒè¯•åè®®ï¼Œç”¨äºç¨‹åºåŒ–æ§åˆ¶æµè§ˆå™¨</li>
<li><strong>Watchdogï¼ˆçœ‹é—¨ç‹—ï¼‰</strong>ï¼šäº‹ä»¶é©±åŠ¨çš„ç›‘æ§æœåŠ¡ï¼Œè‡ªåŠ¨å¤„ç†æµè§ˆå™¨äº‹ä»¶ï¼ˆå¦‚å¼¹çª—ã€ä¸‹è½½ã€å´©æºƒç­‰ï¼‰</li>
<li><strong>DomServiceï¼ˆDOM æœåŠ¡ï¼‰</strong>ï¼šæå–å’Œå¤„ç† DOM å†…å®¹ï¼Œå¤„ç†å…ƒç´ é«˜äº®å’Œå¯è®¿é—®æ€§æ ‘ç”Ÿæˆ</li>
<li><strong>Tools Registryï¼ˆå·¥å…·æ³¨å†Œè¡¨ï¼‰</strong>ï¼šå°† LLM å†³ç­–æ˜ å°„åˆ°æµè§ˆå™¨æ“ä½œçš„æ³¨å†Œè¡¨ç³»ç»Ÿ</li>
<li><strong>EventBusï¼ˆäº‹ä»¶æ€»çº¿ï¼‰</strong>ï¼šåŸºäº <code>bubus</code> çš„äº‹ä»¶é©±åŠ¨é€šä¿¡æœºåˆ¶ï¼Œåè°ƒå„ä¸ªç»„ä»¶</li>
<li><strong>Structured Outputï¼ˆç»“æ„åŒ–è¾“å‡ºï¼‰</strong>ï¼šLLM è¿”å›çš„ç»“æ„åŒ–åŠ¨ä½œæ¨¡å‹ï¼ŒåŒ…å«åŠ¨ä½œç±»å‹å’Œå‚æ•°</li>
<li><strong>CodeAgentï¼ˆä»£ç æ™ºèƒ½ä½“ï¼‰</strong>ï¼šç±»ä¼¼ Jupyter Notebook çš„æ‰§è¡Œç¯å¢ƒï¼Œå…è®¸ LLM ç¼–å†™ Python ä»£ç æ§åˆ¶æµè§ˆå™¨</li>
</ul>
<h3 data-id="heading-3">æ¶æ„è®¾è®¡</h3>
<p>Browser-Use é‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„åˆ†å±‚æ¶æ„ï¼Œæ ¸å¿ƒæ˜¯åŸºäº CDP çš„æµè§ˆå™¨æ§åˆ¶å’Œ LLM é©±åŠ¨çš„å†³ç­–å¾ªç¯ã€‚ç³»ç»Ÿå°†æµè§ˆå™¨æ“ä½œæŠ½è±¡ä¸ºäº‹ä»¶ï¼Œé€šè¿‡äº‹ä»¶æ€»çº¿åè°ƒå„ä¸ªç»„ä»¶ï¼Œå®ç°äº†é«˜åº¦çš„æ¨¡å—åŒ–å’Œå¯æ‰©å±•æ€§ã€‚</p>
<h4 data-id="heading-4">è®¾è®¡åŸåˆ™</h4>
<ol>
<li><strong>äº‹ä»¶é©±åŠ¨æ¶æ„</strong>ï¼šæ‰€æœ‰æµè§ˆå™¨æ“ä½œéƒ½é€šè¿‡äº‹ä»¶ç³»ç»Ÿè¿›è¡Œï¼Œå®ç°äº†æ¾è€¦åˆçš„ç»„ä»¶è®¾è®¡</li>
<li><strong>LLM é©±åŠ¨çš„å†³ç­–</strong>ï¼šæ™ºèƒ½ä½“é€šè¿‡ LLM åˆ†æé¡µé¢çŠ¶æ€å¹¶åšå‡ºå†³ç­–ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™æ“ä½œè„šæœ¬</li>
<li><strong>Watchdog è‡ªåŠ¨åŒ–ç›‘æ§</strong>ï¼šé€šè¿‡å¤šä¸ª Watchdog æœåŠ¡è‡ªåŠ¨å¤„ç†å¸¸è§æµè§ˆå™¨äº‹ä»¶ï¼Œå‡å°‘æ™ºèƒ½ä½“è´Ÿæ‹…</li>
<li><strong>ç±»å‹å®‰å…¨</strong>ï¼šä½¿ç”¨ Pydantic ç¡®ä¿æ•°æ®ä¼ é€’çš„ç±»å‹å®‰å…¨ï¼Œå‡å°‘è¿è¡Œæ—¶é”™è¯¯</li>
<li><strong>å¼‚æ­¥ä¼˜å…ˆ</strong>ï¼šå…¨é¢é‡‡ç”¨å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹ï¼Œæ”¯æŒé«˜å¹¶å‘å’Œé«˜æ•ˆçš„èµ„æºåˆ©ç”¨</li>
</ol>
<h4 data-id="heading-5">ç³»ç»Ÿæ¶æ„å›¾</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    ç”¨æˆ·ä»»åŠ¡[ç”¨æˆ·ä»»åŠ¡] --&gt; Agent[Agent æ™ºèƒ½ä½“]
    Agent --&gt; LLMé›†æˆ[LLM é›†æˆå±‚]
    LLMé›†æˆ --&gt; ç»“æ„åŒ–è¾“å‡º[ç»“æ„åŒ–åŠ¨ä½œè¾“å‡º]
    
    ç»“æ„åŒ–è¾“å‡º --&gt; Tools[Tools Registry&lt;br/&gt;å·¥å…·æ³¨å†Œè¡¨]
    Tools --&gt; æµè§ˆå™¨äº‹ä»¶[æµè§ˆå™¨äº‹ä»¶]
    
    æµè§ˆå™¨äº‹ä»¶ --&gt; EventBus[EventBus&lt;br/&gt;äº‹ä»¶æ€»çº¿]
    EventBus --&gt; BrowserSession[BrowserSession&lt;br/&gt;æµè§ˆå™¨ä¼šè¯]
    
    BrowserSession --&gt; CDPè¿æ¥[CDP è¿æ¥&lt;br/&gt;Chrome DevTools Protocol]
    CDPè¿æ¥ --&gt; æµè§ˆå™¨å®ä¾‹[æµè§ˆå™¨å®ä¾‹&lt;br/&gt;Chromium]
    
    EventBus --&gt; Watchdogç³»ç»Ÿ[Watchdog ç³»ç»Ÿ]
    Watchdogç³»ç»Ÿ --&gt; DOMWatchdog[DOM Watchdog&lt;br/&gt;DOM å¿«ç…§å’Œæˆªå›¾]
    Watchdogç³»ç»Ÿ --&gt; PopupsWatchdog[Popups Watchdog&lt;br/&gt;å¼¹çª—å¤„ç†]
    Watchdogç³»ç»Ÿ --&gt; DownloadsWatchdog[Downloads Watchdog&lt;br/&gt;æ–‡ä»¶ä¸‹è½½]
    Watchdogç³»ç»Ÿ --&gt; SecurityWatchdog[Security Watchdog&lt;br/&gt;å®‰å…¨ç­–ç•¥]
    Watchdogç³»ç»Ÿ --&gt; CrashWatchdog[Crash Watchdog&lt;br/&gt;å´©æºƒæ¢å¤]
    
    BrowserSession --&gt; DomService[DomService&lt;br/&gt;DOM å¤„ç†æœåŠ¡]
    DomService --&gt; DOMæ ‘[DOM æ ‘æå–]
    DomService --&gt; å¯è®¿é—®æ€§æ ‘[å¯è®¿é—®æ€§æ ‘ç”Ÿæˆ]
    DomService --&gt; å…ƒç´ é«˜äº®[å…ƒç´ é«˜äº®]
    
    Agent --&gt; åŠ¨ä½œæ‰§è¡Œ[åŠ¨ä½œæ‰§è¡Œå¾ªç¯]
    åŠ¨ä½œæ‰§è¡Œ --&gt; é¡µé¢çŠ¶æ€[è·å–é¡µé¢çŠ¶æ€]
    é¡µé¢çŠ¶æ€ --&gt; DomService
    é¡µé¢çŠ¶æ€ --&gt; LLMé›†æˆ
</code></pre>
<h4 data-id="heading-6">å…³é”®è®¾è®¡å†³ç­–</h4>
<p><strong>äº‹ä»¶é©±åŠ¨ vs ç›´æ¥è°ƒç”¨</strong>ï¼šBrowser-Use é€‰æ‹©äº‹ä»¶é©±åŠ¨æ¶æ„è€Œéç›´æ¥ CDP è°ƒç”¨ï¼Œè¿™ä½¿å¾—ç³»ç»Ÿæ›´åŠ æ¨¡å—åŒ–ï¼Œå„ä¸ªç»„ä»¶å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•ï¼ŒåŒæ—¶æ”¯æŒå¼‚æ­¥å¤„ç†å’Œå¹¶å‘æ“ä½œã€‚</p>
<p><strong>Watchdog ç³»ç»Ÿè®¾è®¡</strong>ï¼šé€šè¿‡å¤šä¸ªä¸“é—¨çš„ Watchdog æœåŠ¡å¤„ç†å¸¸è§æµè§ˆå™¨äº‹ä»¶ï¼Œå°†æ™ºèƒ½ä½“ä»ç¹ççš„äº‹ä»¶å¤„ç†ä¸­è§£æ”¾å‡ºæ¥ï¼Œä¸“æ³¨äºæ ¸å¿ƒä»»åŠ¡é€»è¾‘ã€‚</p>
<p><strong>DOM å¤„ç†ç­–ç•¥</strong>ï¼šé‡‡ç”¨å¢å¼ºçš„ DOM å¿«ç…§å’Œå¯è®¿é—®æ€§æ ‘ï¼Œç»“åˆè§†è§‰æˆªå›¾ï¼Œä¸º LLM æä¾›ä¸°å¯Œçš„é¡µé¢ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæé«˜å†³ç­–å‡†ç¡®æ€§ã€‚</p>
<h3 data-id="heading-7">æ ¸å¿ƒæµç¨‹</h3>
<p>Browser-Use çš„æ ¸å¿ƒæµç¨‹æ˜¯ä¸€ä¸ªè¿­ä»£çš„åŠ¨ä½œæ‰§è¡Œå¾ªç¯ï¼Œæ™ºèƒ½ä½“é€šè¿‡åˆ†æé¡µé¢çŠ¶æ€ã€è°ƒç”¨ LLM è·å–åŠ¨ä½œå†³ç­–ã€æ‰§è¡ŒåŠ¨ä½œå¹¶è§‚å¯Ÿç»“æœï¼Œä¸æ–­æ¨è¿›ä»»åŠ¡å®Œæˆã€‚</p>
<h4 data-id="heading-8">æµç¨‹è¾“å…¥å’Œè¾“å‡º</h4>
<p><strong>è¾“å…¥ï¼š</strong></p>
<ul>
<li>ç”¨æˆ·ä»»åŠ¡æè¿°ï¼ˆè‡ªç„¶è¯­è¨€ï¼‰</li>
<li>æµè§ˆå™¨é…ç½®ï¼ˆé…ç½®æ–‡ä»¶ã€ä»£ç†è®¾ç½®ç­‰ï¼‰</li>
<li>LLM é…ç½®ï¼ˆæ¨¡å‹é€‰æ‹©ã€API å¯†é’¥ç­‰ï¼‰</li>
</ul>
<p><strong>è¾“å‡ºï¼š</strong></p>
<ul>
<li>ä»»åŠ¡æ‰§è¡Œå†å²ï¼ˆåŒ…å«æ‰€æœ‰æ­¥éª¤å’Œç»“æœï¼‰</li>
<li>æå–çš„å†…å®¹ï¼ˆå¦‚æœä»»åŠ¡æ¶‰åŠæ•°æ®æå–ï¼‰</li>
<li>æµè§ˆå™¨çŠ¶æ€å¿«ç…§ï¼ˆæˆªå›¾ã€DOM æ ‘ç­‰ï¼‰</li>
</ul>
<h4 data-id="heading-9">æ ¸å¿ƒæµç¨‹å›¾</h4>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    å¼€å§‹[å¼€å§‹] --&gt; åˆå§‹åŒ–[åˆå§‹åŒ– Agent å’Œ BrowserSession]
    åˆå§‹åŒ– --&gt; å‡†å¤‡ä¸Šä¸‹æ–‡[å‡†å¤‡ä¸Šä¸‹æ–‡&lt;br/&gt;è·å–é¡µé¢çŠ¶æ€]
    
    å‡†å¤‡ä¸Šä¸‹æ–‡ --&gt; DOMæå–[DOM Service æå– DOM æ ‘]
    DOMæå– --&gt; å¯è®¿é—®æ€§æ ‘[ç”Ÿæˆå¯è®¿é—®æ€§æ ‘]
    DOMæå– --&gt; æˆªå›¾[ç”Ÿæˆé¡µé¢æˆªå›¾]
    
    å¯è®¿é—®æ€§æ ‘ --&gt; æ„å»ºæ¶ˆæ¯[æ„å»º LLM æ¶ˆæ¯&lt;br/&gt;åŒ…å«é¡µé¢çŠ¶æ€å’Œä»»åŠ¡]
    æˆªå›¾ --&gt; æ„å»ºæ¶ˆæ¯
    
    æ„å»ºæ¶ˆæ¯ --&gt; LLMè°ƒç”¨[è°ƒç”¨ LLM&lt;br/&gt;è·å–ç»“æ„åŒ–è¾“å‡º]
    LLMè°ƒç”¨ --&gt; åŠ¨ä½œè§£æ[è§£æåŠ¨ä½œæ¨¡å‹&lt;br/&gt;ActionModel]
    
    åŠ¨ä½œè§£æ --&gt; åŠ¨ä½œç±»å‹åˆ¤æ–­{åŠ¨ä½œç±»å‹}
    åŠ¨ä½œç±»å‹åˆ¤æ–­ --&gt;|å¯¼èˆª| å¯¼èˆªåŠ¨ä½œ[æ‰§è¡Œå¯¼èˆªåŠ¨ä½œ]
    åŠ¨ä½œç±»å‹åˆ¤æ–­ --&gt;|ç‚¹å‡»| ç‚¹å‡»åŠ¨ä½œ[æ‰§è¡Œç‚¹å‡»åŠ¨ä½œ]
    åŠ¨ä½œç±»å‹åˆ¤æ–­ --&gt;|è¾“å…¥| è¾“å…¥åŠ¨ä½œ[æ‰§è¡Œè¾“å…¥åŠ¨ä½œ]
    åŠ¨ä½œç±»å‹åˆ¤æ–­ --&gt;|æ»šåŠ¨| æ»šåŠ¨åŠ¨ä½œ[æ‰§è¡Œæ»šåŠ¨åŠ¨ä½œ]
    åŠ¨ä½œç±»å‹åˆ¤æ–­ --&gt;|å®Œæˆ| å®ŒæˆåŠ¨ä½œ[æ ‡è®°ä»»åŠ¡å®Œæˆ]
    
    å¯¼èˆªåŠ¨ä½œ --&gt; Watchdogå¤„ç†[Watchdog å¤„ç†äº‹ä»¶]
    ç‚¹å‡»åŠ¨ä½œ --&gt; Watchdogå¤„ç†
    è¾“å…¥åŠ¨ä½œ --&gt; Watchdogå¤„ç†
    æ»šåŠ¨åŠ¨ä½œ --&gt; Watchdogå¤„ç†
    
    Watchdogå¤„ç† --&gt; ç­‰å¾…ç¨³å®š[ç­‰å¾…é¡µé¢ç¨³å®š]
    ç­‰å¾…ç¨³å®š --&gt; åˆ¤æ–­å®Œæˆ{ä»»åŠ¡æ˜¯å¦å®Œæˆ?}
    
    åˆ¤æ–­å®Œæˆ --&gt;|å¦| å‡†å¤‡ä¸Šä¸‹æ–‡
    åˆ¤æ–­å®Œæˆ --&gt;|æ˜¯| è¿”å›å†å²[è¿”å›æ‰§è¡Œå†å²]
    å®ŒæˆåŠ¨ä½œ --&gt; è¿”å›å†å²
    
    è¿”å›å†å² --&gt; ç»“æŸ[ç»“æŸ]
</code></pre>
<h4 data-id="heading-10">å…³é”®æ­¥éª¤è¯´æ˜</h4>
<ol>
<li>
<p><strong>ä¸Šä¸‹æ–‡å‡†å¤‡é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>Agent è°ƒç”¨ DomService è·å–å½“å‰é¡µé¢çš„ DOM æ ‘å’Œå¯è®¿é—®æ€§æ ‘</li>
<li>ç”Ÿæˆé¡µé¢æˆªå›¾ï¼Œä¸º LLM æä¾›è§†è§‰ä¸Šä¸‹æ–‡</li>
<li>æå–é¡µé¢æ–‡æœ¬å†…å®¹å’Œäº¤äº’å…ƒç´ ä¿¡æ¯</li>
</ul>
</li>
<li>
<p><strong>LLM å†³ç­–é˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>å°†é¡µé¢çŠ¶æ€ã€ä»»åŠ¡æè¿°å’Œå†å²åŠ¨ä½œæ„å»ºä¸º LLM æ¶ˆæ¯</li>
<li>è°ƒç”¨ LLM è·å–ç»“æ„åŒ–è¾“å‡ºï¼ˆActionModelï¼‰</li>
<li>LLM åˆ†æé¡µé¢çŠ¶æ€ï¼Œå†³å®šä¸‹ä¸€æ­¥åŠ¨ä½œï¼ˆå¯¼èˆªã€ç‚¹å‡»ã€è¾“å…¥ç­‰ï¼‰</li>
</ul>
</li>
<li>
<p><strong>åŠ¨ä½œæ‰§è¡Œé˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>Tools Registry å°†ç»“æ„åŒ–åŠ¨ä½œè½¬æ¢ä¸ºæµè§ˆå™¨äº‹ä»¶</li>
<li>BrowserSession é€šè¿‡ CDP æ‰§è¡Œæµè§ˆå™¨æ“ä½œ</li>
<li>Watchdog ç³»ç»Ÿç›‘æ§å¹¶å¤„ç†ç›¸å…³äº‹ä»¶ï¼ˆå¼¹çª—ã€ä¸‹è½½ç­‰ï¼‰</li>
</ul>
</li>
<li>
<p><strong>çŠ¶æ€è§‚å¯Ÿé˜¶æ®µ</strong>ï¼š</p>
<ul>
<li>ç­‰å¾…é¡µé¢ç¨³å®šï¼ˆDOM å˜åŒ–ã€ç½‘ç»œè¯·æ±‚å®Œæˆç­‰ï¼‰</li>
<li>è§‚å¯ŸåŠ¨ä½œæ‰§è¡Œç»“æœ</li>
<li>æ›´æ–°æ‰§è¡Œå†å²</li>
</ul>
</li>
<li>
<p><strong>è¿­ä»£å¾ªç¯</strong>ï¼š</p>
<ul>
<li>å¦‚æœä»»åŠ¡æœªå®Œæˆï¼Œè¿”å›æ­¥éª¤ 1 ç»§ç»­æ‰§è¡Œ</li>
<li>å¦‚æœä»»åŠ¡å®Œæˆæˆ–è¾¾åˆ°æœ€å¤§æ­¥æ•°ï¼Œç»“æŸå¾ªç¯</li>
</ul>
</li>
</ol>
<h4 data-id="heading-11">å†³ç­–ç‚¹åˆ†æ</h4>
<ul>
<li><strong>åŠ¨ä½œç±»å‹å†³ç­–ç‚¹</strong>ï¼šLLM æ ¹æ®é¡µé¢çŠ¶æ€å’Œä»»åŠ¡ç›®æ ‡ï¼Œå†³å®šæ‰§è¡Œå“ªç§ç±»å‹çš„åŠ¨ä½œ</li>
<li><strong>å…ƒç´ é€‰æ‹©å†³ç­–ç‚¹</strong>ï¼šLLM éœ€è¦ä»å¤šä¸ªå¯äº¤äº’å…ƒç´ ä¸­é€‰æ‹©æœ€åˆé€‚çš„å…ƒç´ è¿›è¡Œæ“ä½œ</li>
<li><strong>ä»»åŠ¡å®Œæˆå†³ç­–ç‚¹</strong>ï¼šLLM åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å·²å®Œæˆï¼Œå†³å®šæ˜¯å¦è°ƒç”¨ <code>done()</code> åŠ¨ä½œ</li>
<li><strong>é”™è¯¯æ¢å¤å†³ç­–ç‚¹</strong>ï¼šå½“åŠ¨ä½œæ‰§è¡Œå¤±è´¥æ—¶ï¼Œç³»ç»Ÿéœ€è¦å†³å®šæ˜¯é‡è¯•ã€è·³è¿‡è¿˜æ˜¯ç»ˆæ­¢ä»»åŠ¡</li>
</ul>
<h3 data-id="heading-12">æ ¸å¿ƒç»„ä»¶</h3>
<h4 data-id="heading-13">Agent æ™ºèƒ½ä½“ï¼ˆAgent Serviceï¼‰</h4>
<p><strong>èŒè´£</strong>ï¼šä½œä¸ºç³»ç»Ÿçš„æ ¸å¿ƒç¼–æ’å™¨ï¼Œè´Ÿè´£æ¥æ”¶ä»»åŠ¡ã€ç®¡ç†æµè§ˆå™¨ä¼šè¯ã€æ‰§è¡Œ LLM é©±åŠ¨çš„åŠ¨ä½œå¾ªç¯ï¼Œå¹¶ç»´æŠ¤æ‰§è¡Œå†å²ã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼šAgent é€šè¿‡ <code>step()</code> æ–¹æ³•æ‰§è¡Œå•æ­¥ä»»åŠ¡ï¼Œæ¯ä¸ªæ­¥éª¤åŒ…æ‹¬ï¼šå‡†å¤‡ä¸Šä¸‹æ–‡ï¼ˆè·å–é¡µé¢çŠ¶æ€ï¼‰ã€è°ƒç”¨ LLM è·å–åŠ¨ä½œå†³ç­–ã€æ‰§è¡ŒåŠ¨ä½œã€åå¤„ç†ã€‚Agent ç»´æŠ¤ä¸€ä¸ªåŠ¨ä½œå†å²åˆ—è¡¨ï¼Œè®°å½•æ‰€æœ‰æ‰§è¡Œçš„åŠ¨ä½œå’Œç»“æœï¼Œç”¨äº LLM çš„ä¸Šä¸‹æ–‡ç†è§£ã€‚</p>
<p><strong>å…³é”®å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-124:150:browser-use/browser_use/agent/service.py" lang="124:150:browser-use/browser_use/agent/service.py">class Agent(Generic[Context, AgentStructuredOutput]):
	@time_execution_sync('--init')
	def __init__(
		self,
		task: str,
		llm: BaseChatModel | None = None,
		# Optional parameters
		browser_profile: BrowserProfile | None = None,
		browser_session: BrowserSession | None = None,
		browser: Browser | None = None,  # Alias for browser_session
		tools: Tools[Context] | None = None,
		controller: Tools[Context] | None = None,  # Alias for tools
		# Initial agent run parameters
		sensitive_data: dict[str, str | dict[str, str]] | None = None,
		initial_actions: list[dict[str, dict[str, Any]]] | None = None,
		# Cloud Callbacks
		register_new_step_callback: (
			Callable[['BrowserStateSummary', 'AgentOutput', int], None]  # Sync callback
			| Callable[['BrowserStateSummary', 'AgentOutput', int], Awaitable[None]]  # Async callback
			| None
		) = None,
		register_done_callback: (
			Callable[['AgentHistoryList'], Awaitable[None]]  # Async Callback
			| Callable[['AgentHistoryList'], None]  # Sync Callback
			| None
		) = None,
		register_external_agent_status_raise_error_callback: Callable[[], Awaitable[bool]] | None = None,
</code></pre>
<p>Agent çš„æ ¸å¿ƒæ‰§è¡Œå¾ªç¯ï¼š</p>
<pre><code class="hljs language-716:742:browser-use/browser_use/agent/service.py" lang="716:742:browser-use/browser_use/agent/service.py">	@observe(name='agent.step', ignore_output=True, ignore_input=True)
	@time_execution_async('--step')
	async def step(self, step_info: AgentStepInfo | None = None) -&gt; None:
		"""Execute one step of the task"""
		# Initialize timing first, before any exceptions can occur

		self.step_start_time = time.time()

		browser_state_summary = None

		try:
			# Phase 1: Prepare context and timing
			browser_state_summary = await self._prepare_context(step_info)

			# Phase 2: Get model output and execute actions
			await self._get_next_action(browser_state_summary)
			await self._execute_actions()

			# Phase 3: Post-processing
			await self._post_process()

		except Exception as e:
			# Handle ALL exceptions in one place
			await self._handle_step_error(e)

		finally:
			await self._finalize(browser_state_summary)
</code></pre>
<ul>
<li>æ”¯æŒæ•æ„Ÿæ•°æ®æ³¨å…¥ï¼Œè‡ªåŠ¨æ›¿æ¢æ•æ„Ÿä¿¡æ¯é¿å…æ³„éœ²</li>
<li>å®ç°æ‰§è¡Œå†å²ç®¡ç†ï¼Œè®°å½•æ‰€æœ‰åŠ¨ä½œå’Œç»“æœ</li>
<li>æ”¯æŒè‡ªå®šä¹‰å·¥å…·æ‰©å±•ï¼Œé€šè¿‡ Tools Registry æ³¨å†Œæ–°åŠ¨ä½œ</li>
<li>æä¾›å›è°ƒæœºåˆ¶ï¼Œæ”¯æŒäº‘ç«¯é›†æˆå’Œå¤–éƒ¨ç›‘æ§</li>
</ul>
<p><strong>ä¸å…¶ä»–ç»„ä»¶çš„å…³ç³»</strong>ï¼šAgent åè°ƒ BrowserSessionã€DomServiceã€Tools Registry å’Œ LLM é›†æˆï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒæ§åˆ¶å™¨ã€‚</p>
<h4 data-id="heading-14">BrowserSession æµè§ˆå™¨ä¼šè¯</h4>
<p><strong>èŒè´£</strong>ï¼šç®¡ç†æµè§ˆå™¨ç”Ÿå‘½å‘¨æœŸã€CDP è¿æ¥ã€äº‹ä»¶æ€»çº¿å’Œå¤šä¸ª Watchdog æœåŠ¡çš„åè°ƒã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼šBrowserSession ä½¿ç”¨ <code>cdp-use</code> åº“ç®¡ç† CDP å®¢æˆ·ç«¯è¿æ¥ï¼Œé€šè¿‡äº‹ä»¶æ€»çº¿ï¼ˆEventBusï¼‰åè°ƒå„ä¸ª Watchdog æœåŠ¡ã€‚å®ƒæä¾›é«˜çº§æµè§ˆå™¨æ“ä½œæ¥å£ï¼ˆå¯¼èˆªã€ç‚¹å‡»ã€è¾“å…¥ç­‰ï¼‰ï¼ŒåŒæ—¶æ”¯æŒç›´æ¥ CDP è°ƒç”¨ã€‚BrowserSession ç®¡ç†å¤šä¸ªæ ‡ç­¾é¡µå’Œ CDP ä¼šè¯ï¼Œç¡®ä¿èµ„æºæ­£ç¡®æ¸…ç†ã€‚</p>
<p><strong>å…³é”®å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-94:100:browser-use/browser_use/browser/session.py" lang="94:100:browser-use/browser_use/browser/session.py">class BrowserSession(BaseModel):
	"""Event-driven browser session with backwards compatibility.

	This class provides a 2-layer architecture:
	- High-level event handling for agents/tools
	- Direct CDP/Playwright calls for browser operations
</code></pre>
<ul>
<li>äº‹ä»¶é©±åŠ¨çš„æµè§ˆå™¨ç®¡ç†ï¼Œæ‰€æœ‰æ“ä½œé€šè¿‡äº‹ä»¶ç³»ç»Ÿè¿›è¡Œ</li>
<li>æ”¯æŒæœ¬åœ°æµè§ˆå™¨å’Œäº‘ç«¯æµè§ˆå™¨ï¼ˆBrowser Use Cloudï¼‰</li>
<li>å®ç° CDP ä¼šè¯ç¼“å­˜ï¼Œæé«˜æ€§èƒ½</li>
<li>æä¾›æµè§ˆå™¨çŠ¶æ€å¿«ç…§åŠŸèƒ½ï¼ŒåŒ…æ‹¬æˆªå›¾å’Œ DOM æ ‘</li>
</ul>
<p><strong>ä¸å…¶ä»–ç»„ä»¶çš„å…³ç³»</strong>ï¼šBrowserSession æ˜¯æµè§ˆå™¨æ“ä½œçš„åŸºç¡€è®¾æ–½ï¼Œä¸º Agentã€Tools å’Œ DomService æä¾›æµè§ˆå™¨è®¿é—®èƒ½åŠ›ã€‚</p>
<h4 data-id="heading-15">DomService DOM å¤„ç†æœåŠ¡</h4>
<p><strong>èŒè´£</strong>ï¼šæå–å’Œå¤„ç† DOM å†…å®¹ï¼Œå¤„ç†å…ƒç´ é«˜äº®å’Œå¯è®¿é—®æ€§æ ‘ç”Ÿæˆã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼šDomService é€šè¿‡ CDP è·å– DOM æ ‘å’Œå¯è®¿é—®æ€§æ ‘ï¼Œè¿›è¡Œå¢å¼ºå¤„ç†ï¼ˆè®¡ç®—æ ·å¼ã€å¸ƒå±€ä¿¡æ¯ç­‰ï¼‰ï¼Œç”Ÿæˆåºåˆ—åŒ–çš„ DOM çŠ¶æ€ä¾› LLM ä½¿ç”¨ã€‚å®ƒæ”¯æŒ iframe å¤„ç†ã€è·¨åŸŸ iframe é™åˆ¶ã€ç»˜åˆ¶é¡ºåºè¿‡æ»¤ç­‰åŠŸèƒ½ï¼Œç¡®ä¿ LLM èƒ½å¤Ÿå‡†ç¡®ç†è§£é¡µé¢ç»“æ„ã€‚</p>
<p><strong>å…³é”®å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-34:60:browser-use/browser_use/dom/service.py" lang="34:60:browser-use/browser_use/dom/service.py">class DomService:
	"""
	Service for getting the DOM tree and other DOM-related information.

	Either browser or page must be provided.

	TODO: currently we start a new websocket connection PER STEP, we should definitely keep this persistent
	"""

	logger: logging.Logger

	def __init__(
		self,
		browser_session: 'BrowserSession',
		logger: logging.Logger | None = None,
		cross_origin_iframes: bool = False,
		paint_order_filtering: bool = True,
		max_iframes: int = 100,
		max_iframe_depth: int = 5,
	):
		self.browser_session = browser_session
		self.logger = logger or browser_session.logger
		self.cross_origin_iframes = cross_origin_iframes
		self.paint_order_filtering = paint_order_filtering
		self.max_iframes = max_iframes
		self.max_iframe_depth = max_iframe_depth
</code></pre>
<ul>
<li>æ”¯æŒå¢å¼ºçš„ DOM å¿«ç…§ï¼ŒåŒ…å«è®¡ç®—æ ·å¼å’Œå¸ƒå±€ä¿¡æ¯</li>
<li>ç”Ÿæˆå¯è®¿é—®æ€§æ ‘ï¼Œæé«˜ LLM å¯¹é¡µé¢ç»“æ„çš„ç†è§£</li>
<li>å®ç°å…ƒç´ é«˜äº®åŠŸèƒ½ï¼Œå¯è§†åŒ– LLM é€‰æ‹©çš„å…ƒç´ </li>
<li>æ”¯æŒ iframe åµŒå¥—å’Œè·¨åŸŸé™åˆ¶</li>
</ul>
<p><strong>ä¸å…¶ä»–ç»„ä»¶çš„å…³ç³»</strong>ï¼šDomService ä¸º Agent æä¾›é¡µé¢çŠ¶æ€ä¿¡æ¯ï¼Œæ˜¯ LLM å†³ç­–çš„é‡è¦æ•°æ®æºã€‚</p>
<h4 data-id="heading-16">Tools Registry å·¥å…·æ³¨å†Œè¡¨</h4>
<p><strong>èŒè´£</strong>ï¼šå°† LLM çš„ç»“æ„åŒ–åŠ¨ä½œå†³ç­–æ˜ å°„åˆ°æµè§ˆå™¨æ“ä½œï¼Œç®¡ç†æ‰€æœ‰å¯ç”¨çš„æµè§ˆå™¨åŠ¨ä½œã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼šTools Registry ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼æ³¨å†ŒåŠ¨ä½œå‡½æ•°ï¼Œæ¯ä¸ªåŠ¨ä½œå‡½æ•°æ¥æ”¶åŠ¨ä½œå‚æ•°å’Œ BrowserSessionï¼Œæ‰§è¡Œç›¸åº”çš„æµè§ˆå™¨æ“ä½œå¹¶è¿”å›ç»“æœã€‚Registry ç»´æŠ¤ä¸€ä¸ªåŠ¨ä½œæ¨¡å‹åˆ°æ‰§è¡Œå‡½æ•°çš„æ˜ å°„ï¼Œæ”¯æŒåŠ¨ä½œéªŒè¯å’Œé”™è¯¯å¤„ç†ã€‚</p>
<p><strong>å…³é”®å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-105:150:browser-use/browser_use/tools/service.py" lang="105:150:browser-use/browser_use/tools/service.py">class Tools(Generic[Context]):
	def __init__(
		self,
		exclude_actions: list[str] | None = None,
		output_model: type[T] | None = None,
		display_files_in_done_text: bool = True,
	):
		self.registry = Registry[Context](exclude_actions if exclude_actions is not None else [])
		self.display_files_in_done_text = display_files_in_done_text

		"""Register all default browser actions"""

		self._register_done_action(output_model)

		# Basic Navigation Actions
		@self.registry.action(
			'',
			param_model=SearchAction,
		)
		async def search(params: SearchAction, browser_session: BrowserSession):
			import urllib.parse

			# Encode query for URL safety
			encoded_query = urllib.parse.quote_plus(params.query)

			# Build search URL based on search engine
			search_engines = {
				'duckduckgo': f'https://duckduckgo.com/?q={encoded_query}',
				'google': f'https://www.google.com/search?q={encoded_query}&amp;udm=14',
				'bing': f'https://www.bing.com/search?q={encoded_query}',
			}

			if params.engine.lower() not in search_engines:
				return ActionResult(error=f'Unsupported search engine: {params.engine}. Options: duckduckgo, google, bing')

			search_url = search_engines[params.engine.lower()]

			# Simple tab logic: use current tab by default
			use_new_tab = False

			# Dispatch navigation event
			try:
				event = browser_session.event_bus.dispatch(
					NavigateToUrlEvent(
						url=search_url,
						new_tab=use_new_tab,
</code></pre>
<ul>
<li>æ”¯æŒè‡ªå®šä¹‰åŠ¨ä½œæ³¨å†Œï¼Œç”¨æˆ·å¯ä»¥æ‰©å±•å·¥å…·èƒ½åŠ›</li>
<li>å®ç°åŠ¨ä½œå‚æ•°éªŒè¯ï¼Œç¡®ä¿ç±»å‹å®‰å…¨</li>
<li>æä¾›é”™è¯¯å¤„ç†å’Œç»“æœæ ¼å¼åŒ–</li>
<li>æ”¯æŒæ•æ„Ÿæ•°æ®æ£€æµ‹å’Œæ›¿æ¢</li>
</ul>
<p><strong>ä¸å…¶ä»–ç»„ä»¶çš„å…³ç³»</strong>ï¼šTools Registry è¿æ¥ LLM å†³ç­–å’Œæµè§ˆå™¨æ“ä½œï¼Œæ˜¯åŠ¨ä½œæ‰§è¡Œçš„å…³é”®æ¡¥æ¢ã€‚</p>
<h4 data-id="heading-17">Watchdog ç³»ç»Ÿ</h4>
<p><strong>èŒè´£</strong>ï¼šè‡ªåŠ¨ç›‘æ§å’Œå¤„ç†æµè§ˆå™¨äº‹ä»¶ï¼Œå‡å°‘æ™ºèƒ½ä½“çš„è´Ÿæ‹…ã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼šWatchdog ç³»ç»Ÿç”±å¤šä¸ªä¸“é—¨çš„ Watchdog æœåŠ¡ç»„æˆï¼Œæ¯ä¸ªæœåŠ¡ç›‘å¬ç‰¹å®šç±»å‹çš„äº‹ä»¶å¹¶è‡ªåŠ¨å¤„ç†ã€‚ä¾‹å¦‚ï¼ŒPopupsWatchdog è‡ªåŠ¨å¤„ç† JavaScript å¼¹çª—ï¼ŒDownloadsWatchdog ç®¡ç†æ–‡ä»¶ä¸‹è½½ï¼ŒDOMWatchdog å¤„ç† DOM å¿«ç…§å’Œæˆªå›¾ç”Ÿæˆã€‚</p>
<p><strong>ä¸»è¦ Watchdog ç±»å‹</strong>ï¼š</p>
<ul>
<li><strong>DOMWatchdog</strong>ï¼šå¤„ç† DOM å¿«ç…§ã€æˆªå›¾å’Œå…ƒç´ é«˜äº®</li>
<li><strong>PopupsWatchdog</strong>ï¼šè‡ªåŠ¨å¤„ç† JavaScript å¯¹è¯æ¡†å’Œå¼¹çª—</li>
<li><strong>DownloadsWatchdog</strong>ï¼šç®¡ç†æ–‡ä»¶ä¸‹è½½å’Œå­˜å‚¨</li>
<li><strong>SecurityWatchdog</strong>ï¼šå¼ºåˆ¶æ‰§è¡ŒåŸŸåé™åˆ¶å’Œå®‰å…¨ç­–ç•¥</li>
<li><strong>CrashWatchdog</strong>ï¼šç›‘æ§æµè§ˆå™¨å´©æºƒå¹¶å°è¯•æ¢å¤</li>
<li><strong>AboutBlankWatchdog</strong>ï¼šå¤„ç†ç©ºç™½é¡µé‡å®šå‘</li>
<li><strong>PermissionsWatchdog</strong>ï¼šå¤„ç†æƒé™è¯·æ±‚ï¼ˆå¦‚åœ°ç†ä½ç½®ã€é€šçŸ¥ç­‰ï¼‰</li>
</ul>
<p><strong>ä¸å…¶ä»–ç»„ä»¶çš„å…³ç³»</strong>ï¼šWatchdog ç³»ç»Ÿé€šè¿‡äº‹ä»¶æ€»çº¿ä¸ BrowserSession é›†æˆï¼Œè‡ªåŠ¨å¤„ç†æµè§ˆå™¨äº‹ä»¶ï¼Œä¸º Agent æä¾›ç¨³å®šçš„æ‰§è¡Œç¯å¢ƒã€‚</p>
<h4 data-id="heading-18">LLM é›†æˆå±‚</h4>
<p><strong>èŒè´£</strong>ï¼šæä¾›ç»Ÿä¸€çš„ LLM æ¥å£ï¼Œæ”¯æŒå¤šç§ LLM æä¾›å•†ã€‚</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼šLLM é›†æˆå±‚å®šä¹‰äº† <code>BaseChatModel</code> æŠ½è±¡åŸºç±»ï¼Œå„ä¸ªæä¾›å•†å®ç°å…·ä½“çš„èŠå¤©æ¨¡å‹ç±»ã€‚æ”¯æŒ OpenAIã€Anthropicã€Googleã€Groqã€Ollama ç­‰å¤šç§æä¾›å•†ï¼Œæä¾›ç»Ÿä¸€çš„æ¥å£å’Œæ¶ˆæ¯æ ¼å¼ã€‚</p>
<p><strong>æ”¯æŒçš„ LLM æä¾›å•†</strong>ï¼š</p>
<ul>
<li><strong>ChatBrowserUse</strong>ï¼šBrowser-Use ä¼˜åŒ–çš„ä¸“ç”¨æ¨¡å‹ï¼Œé’ˆå¯¹æµè§ˆå™¨è‡ªåŠ¨åŒ–ä»»åŠ¡ä¼˜åŒ–</li>
<li><strong>ChatOpenAI</strong>ï¼šOpenAI GPT ç³»åˆ—æ¨¡å‹</li>
<li><strong>ChatAnthropic</strong>ï¼šAnthropic Claude ç³»åˆ—æ¨¡å‹</li>
<li><strong>ChatGoogle</strong>ï¼šGoogle Gemini ç³»åˆ—æ¨¡å‹</li>
<li><strong>ChatGroq</strong>ï¼šGroq æä¾›çš„å¿«é€Ÿæ¨ç†æ¨¡å‹</li>
<li><strong>ChatOllama</strong>ï¼šæœ¬åœ°è¿è¡Œçš„ Ollama æ¨¡å‹</li>
</ul>
<p><strong>ä¸å…¶ä»–ç»„ä»¶çš„å…³ç³»</strong>ï¼šLLM é›†æˆå±‚ä¸º Agent æä¾›å†³ç­–èƒ½åŠ›ï¼Œæ˜¯æ™ºèƒ½åŒ–çš„æ ¸å¿ƒç»„ä»¶ã€‚</p>
<h3 data-id="heading-19">ç¼ºç‚¹</h3>
<ul>
<li><strong>æ€§èƒ½å¼€é”€</strong>ï¼šæ¯ä¸ªæ­¥éª¤éƒ½éœ€è¦è°ƒç”¨ LLMï¼Œå¯¹äºç®€å•ä»»åŠ¡å¯èƒ½æ•ˆç‡è¾ƒä½ï¼ŒToken æ¶ˆè€—è¾ƒå¤§</li>
<li><strong>ä¸Šä¸‹æ–‡çª—å£é™åˆ¶</strong>ï¼šé•¿ä»»åŠ¡å¯èƒ½å¯¼è‡´ä¸Šä¸‹æ–‡çª—å£æº¢å‡ºï¼Œéœ€è¦å®ç°ä¸Šä¸‹æ–‡å‹ç¼©æˆ–æ€»ç»“æœºåˆ¶</li>
<li><strong>LLM å†³ç­–ä¸ç¡®å®šæ€§</strong>ï¼šLLM å¯èƒ½åšå‡ºé”™è¯¯çš„å†³ç­–ï¼Œéœ€è¦å¤šæ¬¡é‡è¯•æˆ–äººå·¥å¹²é¢„</li>
<li><strong>æˆæœ¬é—®é¢˜</strong>ï¼šé¢‘ç¹è°ƒç”¨ LLM API å¯èƒ½äº§ç”Ÿè¾ƒé«˜çš„æˆæœ¬ï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨é«˜æ€§èƒ½æ¨¡å‹æ—¶</li>
<li><strong>æµè§ˆå™¨èµ„æºæ¶ˆè€—</strong>ï¼šæ¯ä¸ª Agent å®ä¾‹éœ€è¦ç‹¬ç«‹çš„æµè§ˆå™¨è¿›ç¨‹ï¼Œå¹¶å‘æ‰§è¡Œæ—¶èµ„æºæ¶ˆè€—è¾ƒå¤§</li>
<li><strong>CAPTCHA å¤„ç†</strong>ï¼šæ— æ³•è‡ªåŠ¨å¤„ç† CAPTCHAï¼Œéœ€è¦ä¾èµ– Browser Use Cloud çš„éšèº«æµè§ˆå™¨åŠŸèƒ½</li>
<li><strong>åŠ¨æ€å†…å®¹å¤„ç†</strong>ï¼šå¯¹äºé«˜åº¦åŠ¨æ€çš„ Web åº”ç”¨ï¼ˆå¦‚ SPAï¼‰ï¼Œå¯èƒ½éœ€è¦ç­‰å¾…è¾ƒé•¿æ—¶é—´æ‰èƒ½ç¨³å®š</li>
<li><strong>é”™è¯¯æ¢å¤æœºåˆ¶</strong>ï¼šå½“åŠ¨ä½œæ‰§è¡Œå¤±è´¥æ—¶ï¼Œé”™è¯¯æ¢å¤ç­–ç•¥å¯èƒ½ä¸å¤Ÿæ™ºèƒ½ï¼Œå¯¼è‡´ä»»åŠ¡å¤±è´¥</li>
<li><strong>è°ƒè¯•å›°éš¾</strong>ï¼šLLM é©±åŠ¨çš„å†³ç­–è¿‡ç¨‹æ˜¯é»‘ç›’çš„ï¼Œè°ƒè¯•å’Œé—®é¢˜å®šä½è¾ƒä¸ºå›°éš¾</li>
<li><strong>ä¾èµ– CDP</strong>ï¼šå®Œå…¨ä¾èµ– Chrome DevTools Protocolï¼Œé™åˆ¶äº†æµè§ˆå™¨å…¼å®¹æ€§</li>
<li><strong>å­¦ä¹ æ›²çº¿</strong>ï¼šéœ€è¦ç†è§£äº‹ä»¶é©±åŠ¨æ¶æ„å’Œ Watchdog ç³»ç»Ÿï¼Œå¯¹æ–°æ‰‹ä¸å¤Ÿå‹å¥½</li>
<li><strong>æ–‡æ¡£å®Œæ•´æ€§</strong>ï¼šéƒ¨åˆ†é«˜çº§åŠŸèƒ½çš„æ–‡æ¡£å¯èƒ½ä¸å¤Ÿå®Œå–„ï¼Œéœ€è¦é˜…è¯»æºä»£ç ç†è§£</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ¨¡å‹æ˜¯â€œä¸¥è°¨ç†å·¥ç”·â€è¿˜æ˜¯â€œæµªæ¼«è¯—äººâ€ï¼Ÿæ¶æ„å¸ˆæ‰‹ä¸­çš„ä¸¤æŠŠè°ƒæ•™â€œå¯†é’¥â€ï¼šTemperature ä¸ Top-P]]></title>    <link>https://juejin.cn/post/7591350620188950534</link>    <guid>https://juejin.cn/post/7591350620188950534</guid>    <pubDate>2026-01-04T14:37:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620188950534" data-draft-id="7591334602427220031" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ¨¡å‹æ˜¯â€œä¸¥è°¨ç†å·¥ç”·â€è¿˜æ˜¯â€œæµªæ¼«è¯—äººâ€ï¼Ÿæ¶æ„å¸ˆæ‰‹ä¸­çš„ä¸¤æŠŠè°ƒæ•™â€œå¯†é’¥â€ï¼šTemperature ä¸ Top-P"/> <meta itemprop="keywords" content="å¤§æ•°æ®"/> <meta itemprop="datePublished" content="2026-01-04T14:37:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€ç›´åœ¨è¿½"/> <meta itemprop="url" content="https://juejin.cn/user/239028506736411"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ¨¡å‹æ˜¯â€œä¸¥è°¨ç†å·¥ç”·â€è¿˜æ˜¯â€œæµªæ¼«è¯—äººâ€ï¼Ÿæ¶æ„å¸ˆæ‰‹ä¸­çš„ä¸¤æŠŠè°ƒæ•™â€œå¯†é’¥â€ï¼šTemperature ä¸ Top-P
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/239028506736411/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€ç›´åœ¨è¿½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T14:37:19.000Z" title="Sun Jan 04 2026 14:37:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ğŸ’¡ æœ¬æ–‡ä»·å€¼æç¤º</h3>
<blockquote>
<p><strong>ä½ æ˜¯å¦é‡åˆ°è¿‡è¿™ç§æƒ…å†µ</strong>ï¼šåŒä¸€ä¸ª Promptï¼Œæœ‰æ—¶å€™æ¨¡å‹å›ç­”å¾—ä¸€æœ¬æ­£ç»ï¼Œæœ‰æ—¶å€™å´èƒ¡è¨€ä¹±è¯­ï¼Ÿæˆ–è€…ä½ æƒ³è®©æ¨¡å‹å†™ä»£ç ï¼Œå®ƒå´ç»™ä½ ç¼–é€ äº†ä¸€ä¸ªä¸å­˜åœ¨çš„åº“ï¼Ÿ</p>
<p>ä½œä¸ºä»å¤§æ•°æ®è½¬å‹è€Œæ¥çš„æ¶æ„å¸ˆï¼Œä½ ä¹ æƒ¯äº† SQL æŸ¥è¯¢ç»“æœçš„â€œç¡®å®šæ€§â€ï¼ˆ1+1 æ°¸è¿œç­‰äº 2ï¼‰ã€‚ä½†åœ¨ AI çš„ä¸–ç•Œé‡Œï¼Œ<strong>â€œæ¦‚ç‡â€æ‰æ˜¯ç‹é“</strong>ã€‚</p>
<p>æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥ LLM çš„â€œå¤§è„‘çš®å±‚â€ï¼Œæ­ç¤ºæ§åˆ¶æ¨¡å‹è¾“å‡ºæ€§æ ¼çš„ä¸¤ä¸ªæ ¸å¿ƒå‚æ•°â€”â€”<strong>Temperature</strong> å’Œ <strong>Top-P</strong>ã€‚æŒæ¡å®ƒä»¬ï¼Œä½ å°±èƒ½åœ¨â€œç²¾å‡†çš„ä¸šåŠ¡é€»è¾‘â€å’Œâ€œå‘æ•£çš„åˆ›æ„ç”Ÿæˆâ€ä¹‹é—´è‡ªç”±åˆ‡æ¢ï¼ŒçœŸæ­£é©¾é©­æ¨¡å‹ï¼Œè€Œä¸æ˜¯è¢«æ¨¡å‹â€œæŠ½å¥–â€èˆ¬çš„ç»“æœæ‰€å›°æ‰°ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">ğŸ¬ å‰æƒ…å›é¡¾ä¸å¼•å…¥</h3>
<p>ğŸ‘‹ å¤§å®¶å¥½ï¼æ¬¢è¿å›åˆ°æˆ‘ä»¬çš„**â€œå¤§æ•°æ®å·¥ç¨‹å¸ˆè½¬å‹ AI æ¶æ„å¸ˆâ€**ç³»åˆ—ã€‚</p>
<p>åœ¨ä¸Šä¸€ç¯‡ã€Šæ‹†è§£å¤§æ¨¡å‹â€œå¿ƒè„â€ï¼šBERTä¸GPTçš„ç›¸çˆ±ç›¸æ€ï¼ˆæ¶æ„å¸ˆè¿›é˜¶æŒ‡å—ï¼‰ã€‹ä¸­ï¼Œæˆ‘ä»¬å­¦ä¼šäº†å¦‚ä½•æŠŠä¸‡äº‹ä¸‡ç‰©å˜æˆå‘é‡ï¼Œæ‰”è¿›å‘é‡æ•°æ®åº“é‡Œåšè¯­ä¹‰æ£€ç´¢ã€‚è¿™è®©æˆ‘ä»¬æ‹¥æœ‰äº†å¼ºå¤§çš„â€œè®°å¿†åº“â€ï¼ˆRAG çš„åŸºç¡€ï¼‰ã€‚</p>
<p>ä½†æ˜¯ï¼Œå…‰æœ‰è®°å¿†æ˜¯ä¸å¤Ÿçš„ã€‚å½“æ¨¡å‹æ£€ç´¢åˆ°ä¿¡æ¯ï¼Œå‡†å¤‡å¼€å£è¯´è¯æ—¶ï¼Œ<strong>å®ƒè¯¥æ€ä¹ˆè¯´ï¼Ÿ</strong> æ˜¯åƒæ³•å®˜ä¸€æ ·å­—æ–Ÿå¥é…Œï¼Ÿè¿˜æ˜¯åƒè„±å£ç§€æ¼”å‘˜ä¸€æ ·å¤©é©¬è¡Œç©ºï¼Ÿ</p>
<p>è¿™å°±æ¶‰åŠåˆ°äº†å¤§æ¨¡å‹æ¨ç†ï¼ˆInferenceï¼‰é˜¶æ®µæœ€å…³é”®çš„**â€œæ§åˆ¶è®ºâ€**ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬è¦æ‰“å¼€å¤§æ¨¡å‹çš„é»‘ç›’ï¼Œè°ƒæ•´ä¸¤ä¸ªå†³å®šå®ƒâ€œæ€§æ ¼â€çš„æ—‹é’®ã€‚</p>
<hr/>
<h3 data-id="heading-2">ğŸ² ç¬¬ä¸€éƒ¨åˆ†ï¼šå¤§æ¨¡å‹çš„æœ¬è´¨â€”â€”ä¸€åœºâ€œæ–‡å­—æ¥é¾™â€çš„èµŒå±€</h3>
<p>åœ¨ç†è§£å‚æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆæ‰“ç ´ä¸€ä¸ªå¹»æƒ³ï¼š<strong>å¤§æ¨¡å‹å…¶å®å¹¶ä¸â€œæ€è€ƒâ€ï¼Œå®ƒåªæ˜¯åœ¨â€œçŒœâ€ä¸‹ä¸€ä¸ªå­—ã€‚</strong></p>
<p>å½“ä½ è¾“å…¥â€œä»Šå¤©å¤©æ°”çœŸâ€çš„æ—¶å€™ï¼Œæ¨¡å‹å†…éƒ¨ä¼šè®¡ç®—è¯åº“ä¸­æ‰€æœ‰è¯å‡ºç°çš„<strong>æ¦‚ç‡åˆ†å¸ƒ</strong>ï¼š</p>
<ul>
<li><strong>â€œå¥½â€</strong>ï¼šæ¦‚ç‡ 70%</li>
<li><strong>â€œä¸é”™â€</strong>ï¼šæ¦‚ç‡ 20%</li>
<li><strong>â€œç³Ÿç³•â€</strong>ï¼šæ¦‚ç‡ 9%</li>
<li><strong>â€œè‹¹æœâ€</strong>ï¼šæ¦‚ç‡ 0.001% ï¼ˆå®Œå…¨ä¸é€šé¡ºï¼‰</li>
</ul>
<p>æ¨¡å‹æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ª<strong>è¶…é«˜ç»´åº¦çš„æ¦‚ç‡é¢„æµ‹æœº</strong>ã€‚</p>
<p>ğŸ‘‰ <strong>æ¶æ„å¸ˆè§†è§’çš„å·®å¼‚</strong>ï¼š</p>
<ul>
<li><strong>ä¼ ç»Ÿç¨‹åº</strong>ï¼š<code>if input == "A" return "B"</code>ï¼ˆç¡®å®šæ€§ï¼‰ã€‚</li>
<li><strong>å¤§æ¨¡å‹</strong>ï¼š<code>input "A" -&gt; P(B)=0.8, P(C)=0.2</code>ï¼ˆéšæœºæ€§ï¼‰ã€‚</li>
</ul>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š<strong>æ¨¡å‹æ˜¯æ¯æ¬¡éƒ½é€‰æ¦‚ç‡æœ€å¤§çš„é‚£ä¸ªè¯å—ï¼Ÿ</strong>
ç­”æ¡ˆæ˜¯ï¼š<strong>ä¸ä¸€å®šã€‚</strong> è¿™å®Œå…¨å–å†³äºä½ å¦‚ä½•è®¾ç½®æ¥ä¸‹æ¥çš„ä¸¤ä¸ªå‚æ•°ã€‚</p>
<hr/>
<h3 data-id="heading-3">ğŸŒ¡ï¸ ç¬¬äºŒéƒ¨åˆ†ï¼šTemperatureï¼ˆæ¸©åº¦ï¼‰â€”â€”ç»™æ¦‚ç‡åˆ†å¸ƒâ€œåŠ çƒ­â€</h3>
<p><strong>Temperature</strong> æ˜¯æœ€å¸¸ç”¨çš„å‚æ•°ï¼Œé€šå¸¸èŒƒå›´åœ¨ 0 åˆ° 2 ä¹‹é—´ã€‚</p>
<h4 data-id="heading-4">1. æ ¸å¿ƒåŸç†ï¼šå†°ä¸ç«ä¹‹æ­Œ ğŸ”¥â„ï¸</h4>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæ¨¡å‹çš„å€™é€‰è¯æ¦‚ç‡æ˜¯ä¸€å—<strong>æ©¡çš®æ³¥</strong>ã€‚</p>
<ul>
<li>
<p><strong>â„ï¸ ä½æ¸© (Low Temperature, e.g., 0.1 - 0.3)</strong> ï¼š</p>
<ul>
<li><strong>æ•ˆæœ</strong>ï¼šç›¸å½“äºæŠŠæ©¡çš®æ³¥<strong>å†·å†»</strong>ä½ã€‚æ¦‚ç‡é«˜çš„è¯ï¼ˆå±±å³°ï¼‰ä¼šå˜å¾—æ›´é«˜ï¼Œæ¦‚ç‡ä½çš„è¯ï¼ˆå±±è°·ï¼‰ä¼šå˜å¾—æ›´ä½ã€‚</li>
<li><strong>è¡Œä¸º</strong>ï¼šæ¨¡å‹å˜å¾—æå…¶<strong>ä¿å®ˆã€è‡ªä¿¡ã€æ­»æ¿</strong>ã€‚å®ƒå‡ ä¹åªé€‰æ¦‚ç‡æœ€é«˜çš„é‚£ä¸ªè¯ã€‚</li>
<li><strong>äººè®¾</strong>ï¼šä¸¥è°¨çš„<strong>ç†å·¥ç”·</strong>ã€ä¼šè®¡å¸ˆã€ä»£ç å®¡æŸ¥å‘˜ã€‚</li>
</ul>
</li>
<li>
<p><strong>ğŸ”¥ é«˜æ¸© (High Temperature, e.g., 0.7 - 1.0+)</strong> ï¼š</p>
<ul>
<li><strong>æ•ˆæœ</strong>ï¼šç›¸å½“äºç»™æ©¡çš®æ³¥<strong>åŠ çƒ­</strong>ï¼Œå®ƒèåŒ–äº†ï¼Œæ‘Šå¹³äº†ã€‚åŸæœ¬æ¦‚ç‡é«˜çš„è¯ï¼Œä¼˜åŠ¿ä¸å†æ˜æ˜¾ï¼›åŸæœ¬æ¦‚ç‡ä½çš„è¯ï¼Œä¹Ÿæœ‰æœºä¼šè¢«é€‰ä¸­ã€‚</li>
<li><strong>è¡Œä¸º</strong>ï¼šæ¨¡å‹å˜å¾—<strong>å¤šæ ·ã€æ´»è·ƒã€ä¸å¯é¢„æµ‹</strong>ã€‚å®ƒå¯èƒ½ä¼šé€‰ä¸€äº›å†·é—¨çš„è¯ï¼Œå¸¦æ¥æƒŠå–œï¼ˆæˆ–æƒŠå“ï¼‰ã€‚</li>
<li><strong>äººè®¾</strong>ï¼šæµªæ¼«çš„<strong>è¯—äºº</strong>ã€ç–¯ç™«çš„è‰ºæœ¯å®¶ã€é†‰é…’çš„èŠå¤©ä¼´ä¾£ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">2. æµç¨‹å›¾è§£ï¼šæ¸©åº¦å¦‚ä½•å½±å“é€‰æ‹©</h4>
<p><img src="http://openwrite.cn/uploads/20235/58067/8b44ccd0-1e48-4b41-91a5-34d87c863dcb.png" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-6">ğŸ¯ ç¬¬ä¸‰éƒ¨åˆ†ï¼šTop-P (Nucleus Sampling) â€”â€” è®¾ç«‹â€œVIP é—¨æ§›â€</h3>
<p>é™¤äº†æ¸©åº¦ï¼Œè¿˜æœ‰ä¸€ä¸ªå‚æ•°å« <strong>Top-P</strong>ï¼ˆé€šå¸¸è®¾ä¸º 0.1 åˆ° 1.0ï¼‰ã€‚å¾ˆå¤šåˆå­¦è€…å®¹æ˜“æŠŠå®ƒå’Œ Temperature ææ··ã€‚</p>
<h4 data-id="heading-7">1. æ ¸å¿ƒåŸç†ï¼šåˆ‡æ–­é•¿å°¾ âœ‚ï¸</h4>
<p>å¦‚æœè¯´ Temperature æ˜¯æ”¹å˜æ¦‚ç‡åˆ†å¸ƒçš„<strong>å½¢çŠ¶</strong>ï¼ˆå˜å°–æˆ–å˜å¹³ï¼‰ï¼Œé‚£ä¹ˆ Top-P å°±æ˜¯åœ¨<strong>åˆ’å®šå€™é€‰æ± çš„èŒƒå›´</strong>ã€‚</p>
<p>Top-P = 0.9 æ„å‘³ç€ï¼š<strong>â€œåªåœ¨ç´¯ç§¯æ¦‚ç‡è¾¾åˆ° 90% çš„å‰å‡ ä¸ªè¯é‡Œè¿›è¡Œé€‰æ‹©ï¼Œå‰©ä¸‹çš„åƒåœ¾è¯æˆ‘çœ‹éƒ½ä¸çœ‹ã€‚â€</strong></p>
<ul>
<li><strong>åœºæ™¯æ¨¡æ‹Ÿ</strong>ï¼š
<ul>
<li>è¯åº“é‡Œæœ‰ 10000 ä¸ªè¯ã€‚</li>
<li>å‰ 5 ä¸ªè¯ï¼ˆè‹¹æœã€é¦™è•‰...ï¼‰åŠ èµ·æ¥æ¦‚ç‡å°±åˆ°äº† 90%ã€‚</li>
<li>å¦‚æœ Top-P = 0.9ï¼Œæ¨¡å‹å°±åªåœ¨è¿™ 5 ä¸ªè¯é‡Œæ·éª°å­ã€‚åé¢ 9995 ä¸ªè¯ï¼ˆæ¯”å¦‚â€œæ‹–æ‹‰æœºâ€ã€â€œå¤–æ˜Ÿäººâ€ï¼‰ç›´æ¥è¢«<strong>æˆªæ–­</strong>ï¼ˆTruncatedï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h4 data-id="heading-8">2. ä¸ºä»€ä¹ˆè¦ç”¨ Top-Pï¼Ÿ</h4>
<p>å®ƒå¯ä»¥é˜²æ­¢æ¨¡å‹åœ¨é«˜æ¸©ä¸‹â€œå½»åº•å‘ç–¯â€ã€‚å³ä½¿ Temperature å¾ˆé«˜ï¼ŒTop-P ä¹Ÿèƒ½ä¿è¯æ¨¡å‹é€‰çš„è¯è‡³å°‘æ˜¯â€œé è°±åœˆå­â€é‡Œçš„ï¼Œé¿å…é€‰å‡ºæ¦‚ç‡æä½ã€é€»è¾‘å®Œå…¨ä¸é€šçš„è¯ã€‚</p>
<hr/>
<h3 data-id="heading-9">ğŸ—ï¸ ç¬¬å››éƒ¨åˆ†ï¼šæ¶æ„å¸ˆçš„å†³ç­–æŒ‡å—â€”â€”åœºæ™¯åŒ–é…ç½®</h3>
<p>ä½œä¸ºæ¶æ„å¸ˆï¼Œä½ çš„ä»·å€¼ä¸åœ¨äºçŸ¥é“è¿™äº›å‚æ•°çš„å®šä¹‰ï¼Œè€Œåœ¨äº<strong>é’ˆå¯¹ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œåˆ¶å®šæœ€ä½³çš„å‚æ•°ç»„åˆç­–ç•¥</strong>ã€‚</p>
<p>è¿™æ˜¯æˆ‘ä¸ºä½ æ€»ç»“çš„ <strong>â€œé»„é‡‘é…ç½®è¡¨â€</strong>ï¼š</p>















































<table><thead><tr><th align="left">ä¸šåŠ¡åœºæ™¯</th><th align="left">æ¨è Temp</th><th align="left">æ¨è Top-P</th><th align="left">ç†ç”±</th><th align="left">é£é™©æç¤º</th></tr></thead><tbody><tr><td align="left"><strong>ä»£ç ç”Ÿæˆ / SQL è½¬æ¢</strong></td><td align="left"><strong>0</strong></td><td align="left">1.0</td><td align="left">ä»£ç å®¹é”™ç‡æä½ï¼Œå¿…é¡»ç²¾å‡†ï¼Œä¸èƒ½æœ‰éšæœºæ€§ã€‚</td><td align="left">è®¾ä¸º 0 æ—¶ï¼Œæ¨¡å‹å¯èƒ½é™·å…¥é‡å¤å¾ªç¯ã€‚</td></tr><tr><td align="left"><strong>æ•°æ®æå– (JSON)</strong></td><td align="left"><strong>0 - 0.1</strong></td><td align="left">1.0</td><td align="left">æ ¼å¼å¿…é¡»ä¸¥æ ¼ï¼ŒKey/Value ä¸èƒ½ä¹±ç¼–ã€‚</td><td align="left">åŒä¸Šã€‚</td></tr><tr><td align="left"><strong>RAG (çŸ¥è¯†åº“é—®ç­”)</strong></td><td align="left"><strong>0.1 - 0.3</strong></td><td align="left">0.9</td><td align="left">åŸºäºäº‹å®å›ç­”ï¼Œéœ€è¦ä¸¥è°¨ï¼Œä½†ä¿ç•™å¾®å°æ¶¦è‰²ç©ºé—´ã€‚</td><td align="left">æ¸©åº¦è¿‡é«˜ä¼šå¯¼è‡´â€œå¹»è§‰â€ï¼Œç¼–é€ æ–‡æ¡£é‡Œæ²¡æœ‰çš„å†…å®¹ã€‚</td></tr><tr><td align="left"><strong>é€šç”¨èŠå¤©æœºå™¨äºº</strong></td><td align="left"><strong>0.5 - 0.7</strong></td><td align="left">0.9</td><td align="left">éœ€è¦åƒäººä¸€æ ·è‡ªç„¶ï¼Œå¤ªæ­»æ¿ä¼šåƒå¤è¯»æœºã€‚</td><td align="left">å¶å°”ä¼šä¸€æœ¬æ­£ç»åœ°èƒ¡è¯´å…«é“ã€‚</td></tr><tr><td align="left"><strong>åˆ›æ„å†™ä½œ / è¥é”€æ–‡æ¡ˆ</strong></td><td align="left"><strong>0.8 - 1.0</strong></td><td align="left">0.8 - 0.9</td><td align="left">éœ€è¦è„‘æ´ï¼Œæ‹’ç»é™ˆè¯æ»¥è°ƒã€‚</td><td align="left">é€»è¾‘æ€§å¯èƒ½å˜å·®ï¼Œéœ€è¦äººå·¥å®¡æ ¸ã€‚</td></tr></tbody></table>
<h4 data-id="heading-10">ğŸ’¡ æ¶æ„å¸ˆçš„å®æˆ˜å¿ƒæ³•ï¼š</h4>
<ol>
<li><strong>æ§åˆ¶å¹»è§‰ (Hallucination)</strong>ï¼š
åœ¨é‡‘èã€åŒ»ç–—ç­‰ä¸¥è‚ƒåœºæ™¯ï¼Œ<strong>Temperature å¿…é¡»å‹ä½</strong>ã€‚ä½ ç»å¯¹ä¸å¸Œæœ› AI å¸®ä½ ç”Ÿæˆçš„è´¢åŠ¡æŠ¥è¡¨é‡Œå‡ºç°ä¸€ä¸ªéšæœºæ•°å­—ã€‚</li>
<li><strong>äº’æ–¥å…³ç³»</strong>ï¼š
è™½ç„¶ OpenAI æ–‡æ¡£å»ºè®®â€œTemperature å’Œ Top-P æœ€å¥½åªè°ƒä¸€ä¸ªâ€ï¼Œä½†åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œé€šå¸¸çš„åšæ³•æ˜¯ï¼š<strong>å›ºå®š Top-P (å¦‚ 0.9) ä»¥ä¿è¯ä¸‹é™ï¼Œç„¶ååŠ¨æ€è°ƒæ•´ Temperature ä»¥æ§åˆ¶ä¸Šé™ã€‚</strong></li>
<li><strong>æ–¹å·®æµ‹è¯•</strong>ï¼š
å¦‚ä½•éªŒè¯ä½ çš„ Prompt æ˜¯å¦ç¨³å®šï¼ŸæŠŠ Temperature è®¾ä¸º 0.7ï¼Œè¿ç»­è°ƒç”¨ 5 æ¬¡ã€‚å¦‚æœ 5 æ¬¡ç»“æœæ„æ€å®Œå…¨ä¸ä¸€æ ·ï¼Œè¯´æ˜ä½ çš„ Prompt çº¦æŸåŠ›ä¸å¤Ÿï¼Œæˆ–è€…æ¨¡å‹æœ¬èº«å¯¹è¯¥é¢†åŸŸçŸ¥è¯†æŒæ¡ä¸ç‰¢ã€‚</li>
</ol>
<hr/>
<h3 data-id="heading-11">ğŸ“ å®è·µä»»åŠ¡ï¼šäº²æ‰‹â€œè°ƒæˆâ€æ¨¡å‹</h3>
<p>ä¸è¦å…‰çœ‹ï¼Œå»å†™ä»£ç ï¼ä½¿ç”¨ Python è°ƒç”¨ API æ—¶ï¼Œå°è¯•ä¿®æ”¹è¿™ä¸¤ä¸ªå‚æ•°ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> openai

<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_response</span>(<span class="hljs-params">prompt, temp</span>):
    response = openai.ChatCompletion.create(
        model=<span class="hljs-string">"gpt-3.5-turbo"</span>,
        messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}],
        temperature=temp,  <span class="hljs-comment"># &lt;--- å…³é”®åœ¨è¿™é‡Œ</span>
    )
    <span class="hljs-keyword">return</span> response.choices[<span class="hljs-number">0</span>].message.content

prompt = <span class="hljs-string">"è¯·ç”¨ä¸‰ä¸ªè¯å½¢å®¹ä¸€ä¸‹å¤§æ•°æ®å·¥ç¨‹å¸ˆã€‚"</span>

<span class="hljs-comment"># å®éªŒ 1ï¼šä¸¥è°¨æ¨¡å¼</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Temp=0.1: <span class="hljs-subst">{get_response(prompt, <span class="hljs-number">0.1</span>)}</span>"</span>)
<span class="hljs-comment"># è¾“å‡ºå¯èƒ½æ˜¯ï¼šä¸“ä¸šã€ä¸¥è°¨ã€æŠ€æœ¯æ§ (æ¯æ¬¡è¿è¡Œå‡ ä¹éƒ½ä¸€æ ·)</span>

<span class="hljs-comment"># å®éªŒ 2ï¼šç–¯ç™«æ¨¡å¼</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Temp=1.2: <span class="hljs-subst">{get_response(prompt, <span class="hljs-number">1.2</span>)}</span>"</span>)
<span class="hljs-comment"># è¾“å‡ºå¯èƒ½æ˜¯ï¼šæ•°æ®çš„é©¯å…½å¸ˆã€é”®ç›˜ä¸Šçš„èˆè€…ã€ç†¬å¤œå† å†› (æ¯æ¬¡è¿è¡Œéƒ½ä¸åŒï¼Œç”šè‡³å‡ºç°æ€ªè¯)</span>
</code></pre>
<hr/>
<h3 data-id="heading-12">ğŸ§  æ€»ç»“ï¼šä»åŸç†åˆ°æ¶æ„çš„æ€ç»´å¯¼å›¾</h3>
<p>è®©æˆ‘ä»¬ç”¨ä¸€å¼ å›¾æ¥æ€»ç»“ä»Šå¤©çš„å†…å®¹ï¼Œè¿™æ˜¯ä½ ä½œä¸ºæ¶æ„å¸ˆçŸ¥è¯†åº“ä¸­çš„é‡è¦æ‹¼å›¾ï¼š</p>
<p><img src="http://openwrite.cn/uploads/20235/58067/b27bc28f-a7b2-4da6-9e81-1198e96a66e0.png" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-13">ğŸ§© æ¶æ„å¸ˆçš„å®Œæ•´æ‹¼å›¾ï¼šLLM æ ¸å¿ƒé“¾è·¯å¤ç›˜</h3>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº† <strong>â€œå¤§æ¨¡å‹åŸºç¡€ç†è®ºâ€</strong> è¿™ä¸€ä¸“é¢˜çš„å…¨éƒ¨å­¦ä¹ ã€‚ä½œä¸ºæ¶æ„å¸ˆï¼Œå½“ä½ å†æ¬¡å®¡è§†ä¸€ä¸ª AI åº”ç”¨æ—¶ï¼Œä¸åº”å†æŠŠå®ƒçœ‹ä½œä¸€ä¸ªé»‘ç›’ï¼Œè€Œæ˜¯ä¸€æ¡æ¸…æ™°çš„æ•°æ®æµæ°´çº¿ï¼š</p>
<ol>
<li><strong>ğŸ§± æ•°æ®å…¥å£ (Tokenization)</strong> ï¼š
ä¸€åˆ‡å§‹äºåˆ†è¯ã€‚å®ƒæ˜¯è®¡è´¹çš„å•ä½ï¼Œä¹Ÿæ˜¯ä¸Šä¸‹æ–‡çª—å£çš„ç‰©ç†é™åˆ¶ã€‚ä½ æ˜ç™½äº†ä¸ºä»€ä¹ˆä¸­æ–‡å’Œè‹±æ–‡çš„æ¶ˆè€—ä¸åŒï¼Œä¹Ÿæ‡‚å¾—äº†å¦‚ä½•åœ¨æœ‰é™çš„çª—å£å†…â€œç²¾æ‰“ç»†ç®—â€ã€‚</li>
<li><strong>ğŸ§  æ ¸å¿ƒå¼•æ“ (Transformer)</strong> ï¼š
è¿™æ˜¯å¿ƒè„ã€‚é€šè¿‡ Attention æœºåˆ¶ï¼Œæ¨¡å‹ä¸å†æ˜¯æ­»è®°ç¡¬èƒŒï¼Œè€Œæ˜¯å­¦ä¼šäº†â€œå…³æ³¨â€ä¸Šä¸‹æ–‡çš„å…³è”ã€‚ä½ äº†è§£äº† Encoderï¼ˆç†è§£ï¼‰ä¸ Decoderï¼ˆç”Ÿæˆï¼‰çš„åŒºåˆ«ï¼Œä»è€Œèƒ½ä¸ºä¸åŒçš„ä¸šåŠ¡é€‰æ‹©æ­£ç¡®çš„æ¨¡å‹æ¶æ„ã€‚</li>
<li><strong>ğŸŒ‰ è¯­ä¹‰æ¡¥æ¢ (Embedding)</strong> ï¼š
è¿™æ˜¯è¿æ¥äººç±»è¯­è¨€ä¸æœºå™¨æ•°å­¦çš„éš§é“ã€‚é€šè¿‡å‘é‡åŒ–ï¼Œæˆ‘ä»¬å°†æ¨¡ç³Šçš„â€œè¯­ä¹‰â€å˜æˆäº†å¯è®¡ç®—çš„â€œè·ç¦»â€ã€‚è¿™æ˜¯ä½ æ„å»ºä¼ä¸šçº§çŸ¥è¯†åº“ï¼ˆRAGï¼‰å’Œè¯­ä¹‰æœç´¢çš„åŸºçŸ³ã€‚</li>
<li><strong>ğŸ›ï¸ è¾“å‡ºæ§åˆ¶ (Temperature)</strong> ï¼š
è¿™æ˜¯æœ€åä¸€é“é˜€é—¨ã€‚é€šè¿‡è°ƒæ•´æ¦‚ç‡åˆ†å¸ƒï¼Œä½ æŒæ¡äº†æ¨¡å‹çš„â€œæ€§æ ¼â€ã€‚ä½ ä¸å†è¢«åŠ¨æ¥å—ç»“æœï¼Œè€Œæ˜¯ä¸»åŠ¨æƒè¡¡â€œç²¾å‡†â€ä¸â€œåˆ›æ„â€ï¼Œè®©æ¨¡å‹åœ¨ä¸¥è°¨çš„é€»è¾‘ä¸å‘æ•£çš„æ€ç»´é—´è‡ªç”±åˆ‡æ¢ã€‚</li>
</ol>
<p><strong>è¿™å››ä¸ªç¯èŠ‚ï¼Œæ„æˆäº†å¤§æ¨¡å‹åº”ç”¨çš„â€œéª¨æ¶â€ã€‚</strong> æŒæ¡äº†å®ƒä»¬ï¼Œä½ å°±æ‹¥æœ‰äº†é€è¿‡ç°è±¡çœ‹æœ¬è´¨çš„èƒ½åŠ›ï¼Œä¸å†è¢«å±‚å‡ºä¸ç©·çš„æ–°åè¯è¿·æƒ‘ï¼Œè€Œæ˜¯èƒ½ä»åº•å±‚åŸç†å‡ºå‘ï¼Œè®¾è®¡å‡ºç¨³å¥ã€é«˜æ•ˆçš„ AI æ¶æ„ã€‚</p>
<hr/>
<h3 data-id="heading-14">ğŸ’¬ äº’åŠ¨è¯é¢˜</h3>
<p><strong>ä½ åœ¨ä½¿ç”¨ ChatGPT æˆ–å¼€å‘åº”ç”¨æ—¶ï¼Œæœ‰æ²¡æœ‰é‡åˆ°è¿‡å› ä¸º Temperature è®¾ç½®è¿‡é«˜è€Œäº§ç”Ÿçš„â€œç¥å›å¤â€æˆ–ç¦»è°±çš„å¹»è§‰ï¼Ÿ</strong></p>
<p>æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„â€œç¿»è½¦ç°åœºâ€ï¼Œè®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹ AI å–é†‰äº†æ˜¯ä»€ä¹ˆæ ·å­ï¼ğŸ‘‡ğŸ‘‡ğŸ‘‡</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[èŠèŠä¸Šä¸‹æ–‡å·¥ç¨‹ğŸ‘·]]></title>    <link>https://juejin.cn/post/7591360623469805578</link>    <guid>https://juejin.cn/post/7591360623469805578</guid>    <pubDate>2026-01-04T15:32:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591360623469805578" data-draft-id="7589564203872583743" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="èŠèŠä¸Šä¸‹æ–‡å·¥ç¨‹ğŸ‘·"/> <meta itemprop="keywords" content="LLM,è®¾è®¡æ¨¡å¼"/> <meta itemprop="datePublished" content="2026-01-04T15:32:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°å°å°æ€ªå…½"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036166776"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            èŠèŠä¸Šä¸‹æ–‡å·¥ç¨‹ğŸ‘·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036166776/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°å°å°æ€ªå…½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T15:32:00.000Z" title="Sun Jan 04 2026 15:32:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»26åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;color:rgba(46,36,36,.87);overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{margin-bottom:5px;font-size:30px;font-weight:500}.markdown-body h1:before{content:"#";margin-right:10px;color:#1976d2}.markdown-body h2{font-size:28px;font-weight:400;border-left:5px solid #454545;margin-top:20px;padding-left:10px;transition:all .3s ease-in-out}.markdown-body h2:hover{border-color:#1976d2}.markdown-body h3{font-size:24px;font-weight:400;margin-top:15px;padding-bottom:0}.markdown-body h4{font-size:20px;font-weight:500}.markdown-body h5{font-size:16px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h2:first-letter,.markdown-body h3:first-letter,.markdown-body p:first-letter{text-transform:capitalize}.markdown-body em{text-emphasis:dot;text-emphasis-position:under}.markdown-body img{display:block;margin:0 auto!important;max-width:100%;border-radius:2px;box-shadow:0 2px 4px -1px rgba(0,0,0,.2),0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12)!important}.markdown-body hr{position:relative;width:98%;height:1px;border:none;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,#ddd,#999,#ddd);overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background:#fff;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center}.markdown-body code{font-weight:900;word-break:break-word;border-radius:2px;overflow-x:auto;font-size:.87em;padding:.065em .4em;background-color:#fbe5e1;color:#c0341d}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border-radius:0 4px}.markdown-body pre&gt;code{font-weight:400;font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{margin:0 4px;text-decoration:none;color:#027fff;transition:all .3s ease-in-out;padding-bottom:4px;border-bottom:2px solid transparent}.markdown-body a:after{content:"";display:inline-block;width:18px;height:18px;margin-left:4px;vertical-align:middle;background-image:url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMiIgaGVpZ2h0PSIyMiI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIiBzdHJva2U9IiMwMjdGRkYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCI+PHBhdGggZD0iTTkuODE1IDYuNDQ4bDEuOTM2LTEuOTM2YzEuMzM3LTEuMzM2IDMuNTgtMS4yNTkgNS4wMTMuMTczIDEuNDMyIDEuNDMyIDEuNTEgMy42NzYuMTczIDUuMDEzbC0xLjQ1MiAxLjQ1Mi0uOTY4Ljk2OGMtMS4zMzcgMS4zMzYtMy41ODEgMS4yNTktNS4wMTMtLjE3MyIvPjxwYXRoIGQ9Ik0xMS4yNjcgMTUuMzY3bC0xLjkzNiAxLjkzNmMtMS4zMzYgMS4zMzctMy41OCAxLjI2LTUuMDEyLS4xNzMtMS40MzItMS40MzItMS41MS0zLjY3Ni0uMTczLTUuMDEybDEuNDUyLTEuNDUyLjk2OC0uOTY4YzEuMzM2LTEuMzM3IDMuNTgtMS4yNiA1LjAxMi4xNzMiLz48L2c+PC9zdmc+);background-size:cover;background-repeat:no-repeat}.markdown-body a:hover{border-color:#027fff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body a.footnote-backref:after,.markdown-body a.footnote-ref:after,.markdown-body sup a:after{display:none!important}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border:2px solid #c6c6c6}.markdown-body table img{box-shadow:none!important}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body del{color:rgba(0,0,0,.6)}.markdown-body blockquote{position:relative;color:#666;padding:5px 23px 1px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:hsla(0,0%,78.4%,.12);transition:all .2s ease-in-out}.markdown-body blockquote:hover{border-color:#1976d2}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;font-size:24px;font-weight:800;line-height:24px;color:#cbcbcb;opacity:.6}.markdown-body blockquote:before{content:"â€œ";top:4px;left:6px}.markdown-body blockquote:after{content:"â€";right:8px;bottom:-8px}.markdown-body blockquote&gt;p,.markdown-body blockquote blockquote{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body details{outline:none;border:none;border-left:4px solid #1976d2;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary:hover::-webkit-details-marker{color:#1976d2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€å¼•è¨€ï¼šèŠä¸€èŠæç¤ºè¯å·¥ç¨‹</h2>
<h3 data-id="heading-1">ï¼ˆä¸€ï¼‰ä»€ä¹ˆæ˜¯æç¤ºå·¥ç¨‹</h3>
<p>Promptingæ˜¯äººä¸å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰äº¤äº’çš„æ ¸å¿ƒæ¥å£ï¼Œé€šè¿‡ç²¾å¿ƒè®¾è®¡è¾“å…¥å†…å®¹ï¼Œå¼•å¯¼æ¨¡å‹ç”Ÿæˆç¬¦åˆé¢„æœŸçš„è¾“å‡ºç»“æœã€‚æç¤ºå·¥ç¨‹ä½œä¸ºä¸€é—¨ä¸“é—¨çš„å·¥ç¨‹å­¦ç§‘ï¼Œæ ¸å¿ƒå†…æ¶µåŒ…æ‹¬ï¼šç»“æ„åŒ–è®¾è®¡è¯·æ±‚ã€æä¾›ç²¾å‡†ä¸Šä¸‹æ–‡ã€æŒ‡å®šè¾“å‡ºæ ¼å¼è§„èŒƒã€å®šä¹‰å“åº”ç±»å‹æ ‡å‡†ç­‰å…³é”®åŠ¨ä½œã€‚</p>
<p>ä¼˜è´¨çš„æç¤ºè¯è¯­èƒ½æœ€å¤§åŒ–æ¿€æ´»æ¨¡å‹èƒ½åŠ›ï¼Œè¾“å‡ºå‡†ç¡®ã€ç›¸å…³æ€§å¼ºä¸”å…·å¤‡åˆ›é€ æ€§çš„ç»“æœï¼›åä¹‹ï¼Œè®¾è®¡ä¸å½“çš„æç¤ºè¯å¯èƒ½ä¼šå¯¼è‡´æ¨¡å‹è¾“å‡ºæ¨¡ç³Šã€åç¦»ä¸»é¢˜ç”šè‡³å‡ºç°é”™è¯¯çš„å†…å®¹ã€‚åœ¨æ™ºèƒ½ä½“ç³»ç»Ÿå¼€å‘ä¸­ï¼Œæç¤ºå·¥ç¨‹æ›´æ˜¯è¿æ¥é€šç”¨LLMä¸ä¸“ç”¨ä¸šåŠ¡åœºæ™¯çš„æ¡¥æ¢ï¼Œç›´æ¥å†³å®šæ™ºèƒ½ä½“çš„è§„åˆ’èƒ½åŠ›ã€å·¥å…·ä½¿ç”¨æ•ˆç‡ã€è®°å¿†ç®¡ç†æ•ˆæœä¸åä½œå¯é æ€§ã€‚</p>
<h3 data-id="heading-2">ï¼ˆäºŒï¼‰æç¤ºå·¥ç¨‹çš„æ ¸å¿ƒç›®æ ‡</h3>
<p>æç¤ºå·¥ç¨‹çš„ç»ˆæç›®æ ‡æ˜¯æŒç»­è·å–é«˜è´¨é‡çš„æ¨¡å‹å“åº”ï¼Œè¿™éœ€è¦å¼€å‘è€…åŒæ—¶å…·å¤‡ä¸¤é¡¹æ ¸å¿ƒèƒ½åŠ›ï¼š</p>
<ol>
<li>æ·±åˆ»ç†è§£ç›®æ ‡æ¨¡å‹çš„èƒ½åŠ›è¾¹ç•Œï¼ˆå¦‚ä¸Šä¸‹æ–‡çª—å£å¤§å°ã€æ¨ç†æé™ã€å¤šæ¨¡æ€æ”¯æŒç¨‹åº¦ï¼‰ï¼›</li>
<li>ç²¾å‡†ä¼ è¾¾ä¸šåŠ¡æ„å›¾çš„è¡¨è¾¾èƒ½åŠ›ã€‚</li>
</ol>
<p>æœ¬æ–‡å°†ç³»ç»Ÿè¦†ç›–ä»åŸºç¡€äº¤äº’åˆ°å¤æ‚æ™ºèƒ½ä½“å¼€å‘çš„å…¨æµç¨‹æç¤ºæŠ€æœ¯ï¼Œä¸ºä¸åŒå±‚çº§çš„åº”ç”¨å¼€å‘æä¾›å¯è½åœ°çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-3">äºŒã€æç¤ºè¯å·¥ç¨‹çš„äº”å¤§åŸåˆ™</h2>
<p>å¥½çš„æç¤ºè®¾è®¡ä¸æ˜¯å®Œå…¨ä¾èµ–ä¸»è§‚ç»éªŒï¼Œè€Œæ˜¯å»ºç«‹åœ¨ä¸€å¥—é€šç”¨æ ¸å¿ƒåŸåˆ™ä¹‹ä¸Šã€‚è¿™äº›åŸåˆ™é€‚ç”¨äºå„ç±»LLMä¸ä¸åŒå¤æ‚åº¦çš„ä»»åŠ¡ï¼Œæ˜¯å¤§æ¨¡å‹ç¨³å®šäº§å‡ºä¼˜è´¨è¾“å‡ºçš„åŸºç¡€ã€‚</p>
<h3 data-id="heading-4">ï¼ˆä¸€ï¼‰æ¸…æ™°å…·ä½“ï¼šæ¶ˆé™¤æ­§ä¹‰ï¼Œç²¾å‡†å®šä¹‰ä»»åŠ¡</h3>
<p>LLMçš„æ ¸å¿ƒå·¥ä½œæœºåˆ¶æ˜¯æ¨¡å¼è¯†åˆ«ï¼Œæ¨¡ç³Šçš„æŒ‡ä»¤ä¼šå¯¼è‡´æ¨¡å‹è¯¯åˆ¤ä»»åŠ¡æ–¹å‘ã€‚è®¾è®¡æç¤ºæ—¶éœ€æ˜ç¡®ä¸‰ä¸ªæ ¸å¿ƒè¦ç´ ï¼š<strong>ä»»åŠ¡ç›®æ ‡</strong>ã€<strong>è¾“å‡ºæ ¼å¼</strong>ã€<strong>çº¦æŸæ¡ä»¶</strong>ï¼Œé¿å…ä½¿ç”¨æ¨¡ç³Šè¡¨è¿°æˆ–è®©æ¨¡å‹è¿›è¡Œä¸»è§‚å‡è®¾ã€‚</p>
<p><strong>åä¾‹</strong>ï¼šåˆ†æä¸€ä¸‹è¿™ä¸ªäº§å“æ•°æ®  - ï¼ˆæœªæ˜ç¡®åˆ†æç»´åº¦ã€è¾“å‡ºå½¢å¼ã€æ•°æ®èŒƒå›´ï¼‰ï¼›</p>
<p><strong>æ­£ä¾‹</strong>ï¼šåˆ†æ2025å¹´ç¬¬ä¸‰å­£åº¦æŸå“ç‰Œæ‰‹æœºçš„é”€å”®æ•°æ®ï¼Œä»åŒºåŸŸåˆ†å¸ƒã€ä»·æ ¼æ®µå æ¯”ä¸¤ä¸ªç»´åº¦ç”Ÿæˆåˆ†æç»“è®ºï¼Œè¾“å‡ºæ ¼å¼ä¸ºâ€˜1. åŒºåŸŸåˆ†å¸ƒï¼šXXXï¼›2. ä»·æ ¼æ®µå æ¯”ï¼šXXXâ€™ï¼Œæ•°æ®èŒƒå›´è§é™„ä»¶è¡¨æ ¼æ‘˜è¦ã€‚</p>
<h3 data-id="heading-5">ï¼ˆäºŒï¼‰ç®€æ´ç²¾ç‚¼ï¼šå»å†—ä½™ï¼Œèšç„¦æ ¸å¿ƒä¿¡æ¯</h3>
<p>åœ¨ä¿è¯ä»»åŠ¡æè¿°å®Œæ•´çš„å‰æä¸‹ï¼Œæç¤ºè¯åº”è¯¥å°½é‡ç®€æ˜æ‰¼è¦ã€‚å¤šä½™çš„ä¿®é¥°è¯­ã€å¤æ‚çš„å¥å¼ç»“æ„ä¼šå¹²æ‰°æ¨¡å‹å¯¹æ ¸å¿ƒæŒ‡ä»¤çš„è¯†åˆ«ã€‚å»ºè®®ç”¨ç›´æ¥çš„è¡¨è¾¾å’ŒåŠ¨ä½œï¼Œä¾‹å¦‚ï¼šåˆ†æï¼ˆAnalyzeï¼‰ã€åˆ†ç±»ï¼ˆClassifyï¼‰ã€å¯¹æ¯”ï¼ˆCompareï¼‰ã€ç”Ÿæˆï¼ˆGenerateï¼‰ã€æå–ï¼ˆExtractï¼‰ã€æ€»ç»“ï¼ˆSummarizeï¼‰ã€ç¿»è¯‘ï¼ˆTranslateï¼‰ç­‰ã€‚</p>
<p><strong>ä¼˜åŒ–ç¤ºä¾‹</strong>ï¼š</p>
<p>è¯·ä½ æ€è€ƒä¸€ä¸‹å¯¹ä¸‹é¢è¿™æ®µæ–‡æœ¬è¿›è¡Œæ€»ç»“è¿™ä»¶äº‹ï¼ˆåŸæç¤ºï¼‰</p>
<hr/>
<p>æ€»ç»“ä»¥ä¸‹æ–‡æœ¬ï¼š[æ–‡æœ¬å†…å®¹] ï¼ˆä¼˜åŒ–ï¼‰</p>
<h3 data-id="heading-6">ï¼ˆä¸‰ï¼‰ç²¾å‡†åŠ¨è¯ï¼šæ¿€æ´»æ¨¡å‹å¯¹åº”å¤„ç†é€»è¾‘</h3>
<p>åŠ¨è¯çš„é€‰æ‹©ç›´æ¥å†³å®šæ¨¡å‹å¯¹ä»»åŠ¡ç±»å‹çš„åˆ¤æ–­ã€‚ç²¾å‡†çš„åŠ¨è¯èƒ½å¿«é€Ÿæ¿€æ´»æ¨¡å‹ä¸­å¯¹åº”çš„è®­ç»ƒæ•°æ®ä¸å¤„ç†æµç¨‹ï¼Œæå‡å“åº”æ•ˆç‡ä¸å‡†ç¡®æ€§ã€‚</p>
<p><strong>åœºæ™¯ç¤ºä¾‹</strong>ï¼š</p>
<ul>
<li>ä¿¡æ¯æå–ä»»åŠ¡ï¼šä½¿ç”¨<code>æå–</code>è€Œé<code>æ‰¾å‡º</code>ï¼Œå¦‚ï¼šä»ä»¥ä¸‹åˆåŒæ–‡æœ¬ä¸­æå–ç”²æ–¹åç§°ã€ç­¾çº¦æ—¥æœŸã€è¿çº¦è´£ä»»æ¡æ¬¾ï¼›</li>
<li>åˆ›æ„ç”Ÿæˆä»»åŠ¡ï¼šä½¿ç”¨<code>åˆ›ä½œ</code>è€Œé<code>å†™ä¸€ä¸‹</code>ï¼Œå¦‚: ä¸ºxxå“ç‰Œåˆ›ä½œ3æ¡é€‚åˆç¤¾äº¤åª’ä½“ä¼ æ’­çš„å¹¿å‘Šè¯­ï¼Œé£æ ¼æ´»æ³¼å¹´è½»åŒ–ã€‚</li>
</ul>
<h3 data-id="heading-7">ï¼ˆå››ï¼‰æ­£é¢æŒ‡ä»¤ï¼šæ˜ç¡®åšä»€ä¹ˆè€Œéä¸åšä»€ä¹ˆ</h3>
<p>æ­£é¢æŒ‡ä»¤æ¯”è´Ÿé¢çº¦æŸæ›´ç¬¦åˆäººç±»çš„æŒ‡å¯¼ä¹ æƒ¯ï¼Œä¹Ÿæ›´å®¹æ˜“è¢«LLMç†è§£ã€‚è¿‡åº¦å¼ºè°ƒ<strong>ä¸è¦åšä»€ä¹ˆ</strong>ä¼šè®©æ¨¡å‹èšç„¦äºè§„é¿é”™è¯¯ï¼Œè€Œéè¾¾æˆæ ¸å¿ƒç›®æ ‡ï¼›å»ºè®®åªæœ‰åœ¨å®‰å…¨è§„èŒƒæˆ–æ ¼å¼ç¡¬æ€§è¦æ±‚æ—¶ä½¿ç”¨çº¦æŸæ€§è¡¨è¿°ã€‚</p>
<p><strong>åä¾‹</strong>ï¼šå†™ä¸€ç¯‡äº§å“ä»‹ç»ï¼Œä¸è¦å¤ªå®˜æ–¹ã€ä¸è¦å¤ªé•¿ã€ä¸è¦é—æ¼æ ¸å¿ƒåŠŸèƒ½ï¼›</p>
<p><strong>æ­£ä¾‹</strong>ï¼šå†™ä¸€ç¯‡300å­—ä»¥å†…çš„äº§å“ä»‹ç»ï¼Œé£æ ¼å£è¯­åŒ–ï¼ŒåŒ…å«æ ¸å¿ƒåŠŸèƒ½ï¼šå¿«é€Ÿå……ç”µã€è¶…é•¿ç»­èˆªã€é˜²æ°´é˜²å°˜ã€‚</p>
<h3 data-id="heading-8">ï¼ˆäº”ï¼‰å®éªŒè¿­ä»£ï¼šåŠ¨æ€ä¼˜åŒ–æç¤ºæ–¹æ¡ˆ</h3>
<p>æç¤ºå·¥ç¨‹ä¸å­˜åœ¨ä¸‡èƒ½æ¨¡æ¿ï¼Œæœ€ä¼˜æç¤ºå¾€å¾€éœ€è¦é€šè¿‡å¤šæ¬¡è¿­ä»£è·å¾—ã€‚</p>
<p>æ ‡å‡†è¿­ä»£æµç¨‹ä¸ºï¼š<strong>èµ·è‰åˆå§‹æç¤º â†’ æµ‹è¯•æ¨¡å‹å“åº” â†’ åˆ†æè¾“å‡ºé—®é¢˜ï¼ˆå¦‚é—æ¼ä¿¡æ¯ã€æ ¼å¼é”™è¯¯ã€é€»è¾‘åå·®ï¼‰ â†’ ä¼˜åŒ–æç¤ºç»†èŠ‚ â†’ å†æ¬¡æµ‹è¯•ã€‚</strong></p>
<p>å»ºè®®è®°å½•æ¯æ¬¡çš„æç¤ºç‰ˆæœ¬ã€æ¨¡å‹å‚æ•°ä¸è¾“å‡ºç»“æœï¼Œå½¢æˆè¿­ä»£æ—¥å¿—ï¼Œå¸®åŠ©åˆ¤æ–­æœ€ä¼˜æ–¹æ¡ˆã€‚</p>
<h2 data-id="heading-9">ä¸‰ã€åŸºç¡€æç¤ºè¯æŠ€æœ¯</h2>
<p>åŸºç¡€æç¤ºæŠ€æœ¯é€šè¿‡æä¾›ä¸åŒæ•°é‡çš„ç¤ºä¾‹å¼•å¯¼æ¨¡å‹å“åº”ï¼Œé€‚ç”¨äºä»ç®€å•é—®ç­”åˆ°ç»“æ„åŒ–æ•°æ®å¤„ç†çš„å¹¿æ³›åœºæ™¯ã€‚</p>
<h3 data-id="heading-10">ï¼ˆä¸€ï¼‰é›¶æ ·æœ¬æç¤ºï¼šåŸºç¡€ä»»åŠ¡çš„å¿«é€Ÿé€‚é…</h3>
<p>é›¶æ ·æœ¬æç¤ºæ˜¯æœ€ç®€æ´çš„æç¤ºæ–¹å¼ï¼Œä»…åŒ…å«ä»»åŠ¡æè¿°ä¸è¾“å…¥æ•°æ®ï¼Œä¸æä¾›ä»»ä½•ç¤ºä¾‹ï¼Œå®Œå…¨ä¾èµ–æ¨¡å‹çš„é¢„è®­ç»ƒçŸ¥è¯†å®Œæˆä»»åŠ¡ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæ¨¡å‹è®­ç»ƒæ•°æ®ä¸­é«˜é¢‘å‡ºç°çš„åŸºç¡€ä»»åŠ¡ï¼Œå¦‚ç®€å•ç¿»è¯‘ã€æ–‡æœ¬è¡¥å…¨ã€åŸºç¡€é—®ç­”ã€å…³é”®è¯æå–ç­‰ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<p>ä»»åŠ¡ï¼šå°†ä¸­æ–‡å¥å­ç¿»è¯‘æˆè‹±æ–‡ï¼›</p>
<p>æç¤ºï¼šå°†ä»¥ä¸‹ä¸­æ–‡å¥å­ç¿»è¯‘æˆè‹±æ–‡ï¼šâ€˜äººå·¥æ™ºèƒ½æŠ€æœ¯æ­£åœ¨é‡å¡‘å„è¡Œå„ä¸šçš„å‘å±•æ¨¡å¼ã€‚â€™ï¼›</p>
<p>é¢„æœŸè¾“å‡ºï¼šâ€œArtificial intelligence technology is reshaping the development model of various industries.â€</p>
<h3 data-id="heading-11">ï¼ˆäºŒï¼‰å•æ ·æœ¬æç¤ºï¼šç‰¹æ®Šæ ¼å¼/é£æ ¼çš„å¿«é€Ÿå¯¹é½</h3>
<p>å½“æœŸæœ›è¾“å‡ºçš„æ ¼å¼æˆ–é£æ ¼è¾ƒä¸ºç‰¹æ®Šæ—¶ï¼Œå•æ ·æœ¬æç¤ºé€šè¿‡æä¾›1ç»„â€œè¾“å…¥-è¾“å‡ºâ€ç¤ºä¾‹ï¼Œå¸®åŠ©æ¨¡å‹å¿«é€Ÿç†è§£ä»»åŠ¡æ¨¡å¼ï¼Œæå‡å“åº”å‡†ç¡®æ€§ã€‚</p>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<p>å®šåˆ¶åŒ–æ ¼å¼è¾“å‡ºï¼ˆå¦‚ç‰¹å®šæ¨¡æ¿çš„æŠ¥å‘Šæ‘˜è¦ï¼‰ã€ç‰¹æ®Šé£æ ¼æ–‡æœ¬ç”Ÿæˆï¼ˆå¦‚å¤é£æ–‡æ¡ˆã€æŠ€æœ¯æ–‡æ¡£æ³¨é‡Šï¼‰ã€å°ä¼—é¢†åŸŸçš„ç®€å•ä»»åŠ¡ã€‚</p>
<p><strong>ç¤ºä¾‹</strong>ï¼š</p>
<p>ä»»åŠ¡ï¼šæŒ‰ç…§æŒ‡å®šæ ¼å¼æç‚¼æ–°é—»æ ¸å¿ƒä¿¡æ¯ï¼›</p>
<p>æç¤ºï¼šè¯·æŒ‰ç…§â€˜æ ‡é¢˜ï¼šXXXï¼›æ—¶é—´ï¼šXXXï¼›æ ¸å¿ƒäº‹ä»¶ï¼šXXXâ€™çš„æ ¼å¼æç‚¼æ–°é—»æ ¸å¿ƒä¿¡æ¯ã€‚</p>
<p>ç¤ºä¾‹ï¼šæ–°é—»ï¼š2025å¹´10æœˆ1æ—¥ï¼Œå…¨å›½å¤šåœ°ä¸¾è¡Œå›½åº†å‡æ——ä»ªå¼ï¼Œåº†ç¥æ–°ä¸­å›½æˆç«‹76å‘¨å¹´ï¼› æç‚¼ç»“æœï¼šæ ‡é¢˜ï¼šå…¨å›½å¤šåœ°ä¸¾è¡Œå›½åº†å‡æ——ä»ªå¼ï¼›æ—¶é—´ï¼š2025å¹´10æœˆ1æ—¥ï¼›æ ¸å¿ƒäº‹ä»¶ï¼šåº†ç¥æ–°ä¸­å›½æˆç«‹76å‘¨å¹´ã€‚ è¯·å¤„ç†ä»¥ä¸‹æ–°é—»ï¼š2025å¹´11æœˆ5æ—¥ï¼Œç¬¬äº”å±Šä¸­å›½å›½é™…è¿›å£åšè§ˆä¼šåœ¨ä¸Šæµ·å¼€å¹•ï¼Œå…±æœ‰æ¥è‡ª128ä¸ªå›½å®¶å’Œåœ°åŒºçš„ä¼ä¸šå‚å±•ã€‚</p>
<p>é¢„æœŸè¾“å‡ºï¼šæ ‡é¢˜ï¼šç¬¬äº”å±Šè¿›åšä¼šåœ¨ä¸Šæµ·å¼€å¹•ï¼›æ—¶é—´ï¼š2025å¹´11æœˆ5æ—¥ï¼›æ ¸å¿ƒäº‹ä»¶ï¼š128ä¸ªå›½å®¶å’Œåœ°åŒºçš„ä¼ä¸šå‚å±•ã€‚</p>
<h3 data-id="heading-12">ï¼ˆä¸‰ï¼‰å°‘æ ·æœ¬æç¤ºï¼šæç¤ºå¤æ‚ä»»åŠ¡çš„æ³›åŒ–èƒ½åŠ›</h3>
<p>å°‘æ ·æœ¬æç¤ºé€šè¿‡æä¾›3-5ç»„é«˜è´¨é‡â€œè¾“å…¥-è¾“å‡ºâ€ç¤ºä¾‹ï¼Œæ¸…æ™°å±•ç¤ºä»»åŠ¡çš„æ¨¡å¼è§„å¾‹ï¼Œå¸®åŠ©æ¨¡å‹æå‡å¯¹æ–°è¾“å…¥çš„æ³›åŒ–èƒ½åŠ›ï¼Œæ˜¯å¤„ç†å¤æ‚ä»»åŠ¡çš„åŸºç¡€æŠ€æœ¯ã€‚</p>
<p><strong>æ ¸å¿ƒè¦ç‚¹</strong>ï¼š</p>
<ol>
<li>ç¤ºä¾‹è´¨é‡ï¼šç¤ºä¾‹éœ€å‡†ç¡®æ— è¯¯ã€å…·å¤‡ä»£è¡¨æ€§ï¼Œè¦†ç›–ä»»åŠ¡çš„å¸¸è§å˜ä½“ä¸è¾¹ç•Œæƒ…å†µï¼ˆå¦‚åˆ†ç±»ä»»åŠ¡éœ€åŒ…å«æ‰€æœ‰ç±»åˆ«ï¼‰ï¼›</li>
<li>ç¤ºä¾‹å¤šæ ·æ€§ï¼šé¿å…ç¤ºä¾‹åŒè´¨åŒ–ï¼ŒåŠ©åŠ›æ¨¡å‹ç†è§£ä»»åŠ¡çš„æ•´ä½“è§„å¾‹è€Œéå•ä¸€æ¡ˆä¾‹ï¼›</li>
<li>é¡ºåºä¼˜åŒ–ï¼šåˆ†ç±»ä»»åŠ¡ä¸­å»ºè®®æ··åˆä¸åŒç±»åˆ«ç¤ºä¾‹çš„é¡ºåºï¼Œé¿å…æ¨¡å‹è¿‡æ‹Ÿåˆç‰¹å®šåºåˆ—ã€‚</li>
</ol>
<p><strong>ç¤ºä¾‹ï¼ˆæƒ…æ„Ÿåˆ†ç±»ä»»åŠ¡ï¼‰</strong> ï¼š</p>
<p>æç¤ºï¼šâ€œè¯·å°†ç”µå½±è¯„è®ºæƒ…æ„Ÿåˆ†ç±»ä¸ºæ­£é¢ï¼ˆPOSITIVEï¼‰ã€ä¸­æ€§ï¼ˆNEUTRALï¼‰ã€è´Ÿé¢ï¼ˆNEGATIVEï¼‰ã€‚</p>
<p>ç¤ºä¾‹ï¼š
è¯„è®º1ï¼šâ€˜è¿™éƒ¨ç”µå½±çš„å‰§æƒ…ç´§å‡‘ï¼Œæ¼”å‘˜æ¼”æŠ€åœ¨çº¿ï¼Œçœ‹å®Œå¾ˆè¿‡ç˜¾â€™ï¼›æƒ…æ„Ÿï¼šPOSITIVE
è¯„è®º2ï¼šâ€˜ç”µå½±ç”»é¢ä¸é”™ï¼Œä½†å‰§æƒ…é€»è¾‘æœ‰äº›æ··ä¹±ï¼Œæ•´ä½“ä¸­è§„ä¸­çŸ©â€™ï¼›æƒ…æ„Ÿï¼šNEUTRAL
è¯„è®º3ï¼šâ€˜ä¹°ç¥¨çœ‹å®Œåæ‚”äº†ï¼Œå‰§æƒ…æ‹–æ²“ï¼Œè§’è‰²å¡‘é€ æ‰å¹³ï¼Œä¸æ¨èâ€™ï¼›æƒ…æ„Ÿï¼šNEGATIVE</p>
<p>è¯·åˆ¤æ–­ä»¥ä¸‹è¯„è®ºçš„æƒ…æ„Ÿï¼šâ€˜è¿™éƒ¨ç§‘å¹»ç‰‡çš„ç‰¹æ•ˆå¾ˆéœ‡æ’¼ï¼Œä½†äººç‰©æƒ…æ„Ÿçº¿å¤ªå•è–„ï¼Œå‹‰å¼ºèƒ½çœ‹ã€‚â€™â€ï¼›</p>
<p>é¢„æœŸè¾“å‡ºï¼šæƒ…æ„Ÿï¼šNEUTRAL</p>
<h2 data-id="heading-13">å››ã€ç»“æ„åŒ–ä¸ä¸Šä¸‹æ–‡å·¥ç¨‹</h2>
<p>é€šè¿‡ç»“æ„åŒ–è®¾è®¡ä¸åŠ¨æ€ä¸Šä¸‹æ–‡ç®¡ç†ï¼Œå¯ä»¥æå‡æ¨¡å‹å¯¹å¤æ‚ä»»åŠ¡çš„ç†è§£èƒ½åŠ›ä¸å“åº”å¯æ§æ€§ï¼Œæ˜¯æ„å»ºæƒ…å¢ƒæ„ŸçŸ¥å‹æ™ºèƒ½ä½“çš„å…³é”®åŸºç¡€ã€‚</p>
<h3 data-id="heading-14">ï¼ˆä¸€ï¼‰ç»“æ„åŒ–æç¤ºï¼šæ¸…æ™°åˆ’åˆ†ä¿¡æ¯å±‚çº§</h3>
<p>ç»“æ„åŒ–æç¤ºé€šè¿‡æ˜ç¡®åˆ†éš”æŒ‡ä»¤ã€ä¸Šä¸‹æ–‡ã€ç¤ºä¾‹ã€è¾“å…¥æ•°æ®ç­‰ä¸åŒéƒ¨åˆ†ï¼Œå¸®åŠ©æ¨¡å‹å‡†ç¡®è¯†åˆ«å„æ®µæ–‡æœ¬çš„è§’è‰²ï¼Œå‡å°‘ä¿¡æ¯æ··æ·†ã€‚å¸¸ç”¨åˆ†éš”æ–¹å¼åŒ…æ‹¬ï¼šä¸‰é‡åå¼•å·ï¼ˆ```ï¼‰ã€XMLæ ‡ç­¾ã€ç‰¹æ®Šæ ‡è®°ï¼ˆå¦‚ã€æŒ‡ä»¤ã€‘ã€ã€ç¤ºä¾‹ã€‘ã€ã€è¾“å…¥ã€‘ï¼‰ç­‰ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆæ–‡æ¡£æ‘˜è¦ä»»åŠ¡ï¼‰</strong> ï¼š</p>
<p>æç¤ºï¼š</p>
<p>ã€æŒ‡ä»¤ã€‘æ€»ç»“ä»¥ä¸‹æ–‡æ¡£çš„æ ¸å¿ƒè§‚ç‚¹ï¼Œè¦æ±‚ç®€æ´æ˜äº†ï¼Œä¸è¶…è¿‡200å­—ï¼›</p>
<p>ã€æ–‡æ¡£ã€‘<code>2025å¹´ä¸­å›½äººå·¥æ™ºèƒ½äº§ä¸šå‘å±•æŠ¥å‘ŠæŒ‡å‡ºï¼Œå½“å‰æˆ‘å›½AIäº§ä¸šå‘ˆç°ä¸‰å¤§å‘å±•è¶‹åŠ¿ï¼šä¸€æ˜¯æ ¸å¿ƒæŠ€æœ¯çªç ´åŠ é€Ÿï¼Œå¤§æ¨¡å‹è½»é‡åŒ–ã€ä½åŠŸè€—åŒ–è¶‹åŠ¿æ˜æ˜¾ï¼›äºŒæ˜¯è¡Œä¸šåº”ç”¨æ·±åº¦æ¸—é€ï¼Œåˆ¶é€ ã€åŒ»ç–—ã€æ•™è‚²ç­‰é¢†åŸŸçš„AIè½åœ°åœºæ™¯ä¸æ–­ä¸°å¯Œï¼›ä¸‰æ˜¯æ”¿ç­–ç›‘ç®¡ä½“ç³»æ—¥è¶‹å®Œå–„ï¼Œæ•°æ®å®‰å…¨ä¸ç®—æ³•å…¬å¹³æˆä¸ºè¡Œä¸šå‘å±•çš„æ ¸å¿ƒåº•çº¿ã€‚æŠ¥å‘Šé¢„æµ‹ï¼Œ2026å¹´æˆ‘å›½AIäº§ä¸šè§„æ¨¡å°†çªç ´1.2ä¸‡äº¿å…ƒï¼Œå¹´å¢é•¿ç‡ä¿æŒåœ¨25%ä»¥ä¸Šã€‚</code></p>
<p>ã€è¾“å‡ºè¦æ±‚ã€‘åˆ†ç‚¹åˆ—å‡ºæ ¸å¿ƒè§‚ç‚¹ï¼Œæ¯ç‚¹ä¸è¶…è¿‡50å­—ã€‚</p>
<p>é¢„æœŸè¾“å‡ºï¼šâ€œ1. 2025å¹´ä¸­å›½AIäº§ä¸šå‘ˆä¸‰å¤§è¶‹åŠ¿ï¼šæ ¸å¿ƒæŠ€æœ¯çªç ´ã€è¡Œä¸šåº”ç”¨æ¸—é€ã€æ”¿ç­–ç›‘ç®¡å®Œå–„ï¼›2. é¢„æµ‹2026å¹´äº§ä¸šè§„æ¨¡è¶…1.2ä¸‡äº¿å…ƒï¼Œå¹´å¢25%ä»¥ä¸Šã€‚â€</p>
<h3 data-id="heading-15">ï¼ˆäºŒï¼‰ç³»ç»Ÿæç¤ºä¸è§’è‰²æç¤ºï¼šå®šä¹‰æ¨¡å‹è¡Œä¸ºåŸºå‡†</h3>
<ol>
<li>
<p>ç³»ç»Ÿæç¤ºï¼šç”¨äºè®¾å®šæ¨¡å‹çš„æ•´ä½“è¡Œä¸ºå‡†åˆ™ä¸äº¤äº’ç›®çš„ï¼Œä¸ºæ‰€æœ‰åç»­å¯¹è¯æä¾›åŸºç¡€æŒ‡å¯¼ï¼Œå¸¸è§äºæ™ºèƒ½ä½“çš„åˆå§‹åŒ–é…ç½®ã€‚</p>
<ul>
<li><strong>ç¤ºä¾‹</strong>ï¼šâ€œä½ æ˜¯ä¸€åä¸“ä¸šçš„è´¢åŠ¡é¡¾é—®AIï¼Œæ‰€æœ‰å›å¤éœ€éµå¾ªä»¥ä¸‹å‡†åˆ™ï¼š1. è¯­è¨€æ­£å¼ä¸¥è°¨ï¼ŒåŸºäºè´¢åŠ¡ä¸“ä¸šçŸ¥è¯†ï¼›2. ä»…é’ˆå¯¹ä¼ä¸šè´¢åŠ¡ç®¡ç†ç›¸å…³é—®é¢˜æä¾›è§£ç­”ï¼›3. ä¸æä¾›ä»»ä½•æŠ•èµ„å»ºè®®ï¼›4. è‹¥é—®é¢˜è¶…å‡ºä¸“ä¸šèŒƒå›´ï¼Œç›´æ¥å‘ŠçŸ¥ç”¨æˆ·æ— æ³•è§£ç­”ã€‚â€</li>
</ul>
</li>
<li>
<p>è§’è‰²æç¤ºï¼šä¸ºæ¨¡å‹åˆ†é…ç‰¹å®šèº«ä»½ï¼Œè¦æ±‚å…¶ä½¿ç”¨ç”¨è¯¥èº«ä»½çš„çŸ¥è¯†ä½“ç³»ã€è¯­æ°”é£æ ¼ä¸æ€è€ƒæ–¹å¼å“åº”ï¼Œæå‡è¾“å‡ºçš„ä¸“ä¸šæ€§ä¸ç›¸å…³æ€§ã€‚</p>
<ul>
<li><strong>ç¤ºä¾‹</strong>ï¼šâ€œè¯·æ‰®æ¼”ä¸€åèµ„æ·±çš„åˆä¸­æ•°å­¦æ•™å¸ˆï¼Œç”¨é€šä¿—æ˜“æ‡‚çš„è¯­è¨€è§£é‡Šâ€˜ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹çš„æ±‚æ ¹å…¬å¼â€™ï¼Œå¹¶ç»“åˆ1ä¸ªç®€å•ä¾‹é¢˜è¯´æ˜åº”ç”¨æ–¹æ³•ã€‚â€</li>
</ul>
</li>
</ol>
<h3 data-id="heading-16">ï¼ˆä¸‰ï¼‰ä¸Šä¸‹æ–‡å·¥ç¨‹ï¼šæ„å»ºåŠ¨æ€ç¯å¢ƒè®¤çŸ¥</h3>
<p>ä¸Šä¸‹æ–‡å·¥ç¨‹åŒºåˆ«äºé™æ€çš„ç³»ç»Ÿæç¤ºï¼Œæ ¸å¿ƒæ˜¯åŠ¨æ€æ•´åˆä»»åŠ¡æ‰€éœ€çš„èƒŒæ™¯ä¿¡æ¯ï¼Œå¸®åŠ©æ¨¡å‹ç†è§£ç»†èŠ‚ã€å›å¿†å†å²äº¤äº’ã€æ•´åˆå¤–éƒ¨æ•°æ®ï¼Œæå‡å“åº”çš„è¿è´¯æ€§ä¸é’ˆå¯¹æ€§ã€‚</p>
<p>ä¸Šä¸‹æ–‡å·¥ç¨‹çš„æ ¸å¿ƒå±‚æ¬¡åŒ…æ‹¬ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">åŸºç¡€å±‚ï¼šç³»ç»Ÿæç¤ºå®šä¹‰çš„æ“ä½œå‚æ•°ï¼ˆå¦‚: ä¸“ä¸šæŠ€æœ¯å†™æ‰‹ï¼Œè¯­æ°”æ­£å¼ç²¾å‡†ï¼‰ï¼› </span>
å¤–éƒ¨æ•°æ®å±‚ï¼šæ£€ç´¢æ–‡æ¡£ï¼ˆå¦‚æŠ€æœ¯è§„æ ¼ä¹¦ã€è¡Œä¸šæŠ¥å‘Šï¼‰ã€å·¥å…·è¾“å‡ºï¼ˆå¦‚APIè°ƒç”¨è·å–çš„å®æ—¶æ•°æ®ï¼‰ï¼› 
éšå¼æ•°æ®å±‚ï¼šç”¨æˆ·èº«ä»½ã€äº¤äº’å†å²ã€ç¯å¢ƒçŠ¶æ€ï¼ˆå¦‚å½“å‰æ—¶é—´ã€ç”¨æˆ·æ‰€åœ¨åœ°åŒºï¼‰ã€‚
</code></pre>
<p><strong>ç¤ºä¾‹ï¼ˆæ—…æ¸¸æ¨èï¼‰</strong> ï¼š</p>
<p>æç¤ºï¼š</p>
<p>ã€ç³»ç»Ÿæç¤ºã€‘ä½ æ˜¯ä¸€åä¸“ä¸šçš„æ—…æ¸¸è§„åˆ’å¸ˆï¼›</p>
<p>ã€ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‘ç”¨æˆ·æ˜¯å¸¦2å5å²å„¿ç«¥çš„å®¶åº­ï¼Œè®¡åˆ’2025å¹´12æœˆå»ä¸‰äºšæ—…æ¸¸ï¼Œé¢„ç®—5000å…ƒ/äººï¼Œåå¥½äº²å­äº’åŠ¨åœºæ™¯ï¼›</p>
<p>ã€å†å²äº¤äº’ã€‘ç”¨æˆ·æ­¤å‰è¯¢é—®è¿‡ä¸‰äºšçš„å¤©æ°”æƒ…å†µï¼Œå·²å‘ŠçŸ¥12æœˆä¸‰äºšæ°”æ¸©18-25â„ƒï¼Œé€‚åˆæˆ·å¤–æ´»åŠ¨ï¼›</p>
<p>ã€å½“å‰ä»»åŠ¡ã€‘æ¨è3ä¸ªé€‚åˆè¯¥å®¶åº­çš„ä¸‰äºšäº²å­æ™¯ç‚¹ï¼Œå¹¶è¯´æ˜æ¨èç†ç”±ã€‚</p>
<p>é¢„æœŸè¾“å‡ºï¼š1. ä¸‰äºšäºšç‰¹å…°è’‚æ–¯æ°´ä¸–ç•Œï¼šæ‹¥æœ‰å„¿ç«¥ä¸“å±æ¸¸ä¹åŒºåŸŸï¼Œå®‰å…¨ç³»æ•°é«˜ï¼Œå¯ä½“éªŒäº²å­æ°´ä¸Šé¡¹ç›®ï¼Œé€‚åˆ5å²å„¿ç«¥ï¼›2. ä¸‰äºšæ°´ç¨»å›½å®¶å…¬å›­ï¼šå¯ä½“éªŒå†œè€•äº²å­æ´»åŠ¨ï¼Œäº†è§£å†œä½œç‰©çŸ¥è¯†ï¼Œæˆ·å¤–ç©ºé—´å¼€é˜”ï¼Œé€‚åˆå®¶åº­ä¼‘é—²ï¼›3. ä¸‰äºšæµ·åº•ä¸–ç•Œï¼šèƒ½è¿‘è·ç¦»è§‚å¯Ÿæµ·æ´‹ç”Ÿç‰©ï¼Œæœ‰å„¿ç«¥ä¸“å±ç§‘æ™®è®²è§£ï¼Œå…¼å…·å¨±ä¹æ€§ä¸æ•™è‚²æ€§ã€‚</p>
<h3 data-id="heading-17">ï¼ˆå››ï¼‰ç»“æ„åŒ–è¾“å‡ºï¼šæå‡å“åº”çš„å¯å¤„ç†æ€§</h3>
<p>åœ¨éåˆ›æ„ç±»ä»»åŠ¡ä¸­ï¼Œæ˜ç¡®è¦æ±‚æ¨¡å‹ç”Ÿæˆ<code>JSON</code>ã€<code>XML</code>ã€<code>Markdown</code>è¡¨æ ¼ç­‰ç»“æ„åŒ–æ ¼å¼ï¼Œå¯æ˜¾è‘—æå‡è¾“å‡ºçš„å¯å¤ç”¨æ€§ï¼Œä¾¿äºåç»­æ•°æ®å¤„ç†ä¸ç³»ç»Ÿé›†æˆã€‚ç»“åˆ<code>Pydantic</code>ç­‰æ•°æ®æ ¡éªŒå·¥å…·ï¼Œè¿˜èƒ½å®ç°è¾“å‡ºæ•°æ®çš„è‡ªåŠ¨æ ¡éªŒä¸ç±»å‹è½¬æ¢ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆç”¨æˆ·ä¿¡æ¯æå–+Pydanticæ ¡éªŒï¼‰</strong> ï¼š</p>
<ol>
<li>
<p>æç¤ºï¼šä»ä»¥ä¸‹æ–‡æœ¬ä¸­æå–ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥JSONæ ¼å¼è¾“å‡ºï¼ŒåŒ…å«å­—æ®µï¼šnameï¼ˆå§“åï¼‰ã€phoneï¼ˆæ‰‹æœºå·ï¼‰ã€addressï¼ˆåœ°å€ï¼‰ã€register_timeï¼ˆæ³¨å†Œæ—¶é—´ï¼‰ã€‚</p>
<p>æ–‡æœ¬ï¼šç”¨æˆ·å¼ ä¸‰ï¼Œæ‰‹æœºå·13800138000ï¼Œ2025å¹´9æœˆ15æ—¥æ³¨å†Œè´¦å·ï¼Œç°å±…ä½åœ¨åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½è·¯88å·.</p>
</li>
<li>
<p>é¢„æœŸJSONè¾“å‡ºï¼š</p>
</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å¼ ä¸‰"</span><span class="hljs-punctuation">,</span> 
    <span class="hljs-attr">"phone"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"13800138000"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"address"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½è·¯88å·"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"register_time"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2025-09-15"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ol start="3">
<li><code>Pydantic</code>æ ¡éªŒä»£ç ï¼š</li>
</ol>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, ValidationError
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> date


<span class="hljs-comment"># å®šä¹‰ç”¨æˆ·ä¿¡æ¯æ•°æ®æ¨¡å‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInfo</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    name: <span class="hljs-built_in">str</span>  <span class="hljs-comment"># å§“åï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰</span>
    phone: <span class="hljs-built_in">str</span>  <span class="hljs-comment"># æ‰‹æœºå·ï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼Œé¿å…ä¸¢å¤±å‰å¯¼0ï¼‰</span>
    address: <span class="hljs-built_in">str</span>  <span class="hljs-comment"># åœ°å€ï¼ˆå­—ç¬¦ä¸²ç±»å‹ï¼‰</span>
    register_time: date  <span class="hljs-comment"># æ³¨å†Œæ—¶é—´ï¼ˆæ—¥æœŸç±»å‹ï¼‰</span>


<span class="hljs-comment"># å‡è®¾LLMè¾“å‡ºçš„JSONå­—ç¬¦ä¸²</span>
llm_output_json = <span class="hljs-string">'''
{
    "name": "å¼ ä¸‰",
    "phone": "13800138000",
    "address": "åŒ—äº¬å¸‚æœé˜³åŒºå»ºå›½è·¯88å·",
    "register_time": "2025-09-15"
}
'''</span>

<span class="hljs-comment"># è§£æä¸æ ¡éªŒ</span>
<span class="hljs-keyword">try</span>:
    user_info = UserInfo.model_validate_json(llm_output_json)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ•°æ®æ ¡éªŒæˆåŠŸï¼"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"å§“åï¼š<span class="hljs-subst">{user_info.name}</span>"</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ³¨å†Œæ—¶é—´ç±»å‹ï¼š<span class="hljs-subst">{<span class="hljs-built_in">type</span>(user_info.register_time)}</span>"</span>)
    <span class="hljs-comment"># è¾“å‡ºï¼š&lt;class 'datetime.date'&gt;</span>
<span class="hljs-keyword">except</span> ValidationError <span class="hljs-keyword">as</span> e:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ•°æ®æ ¡éªŒå¤±è´¥ï¼š"</span>, e)
</code></pre>
<h2 data-id="heading-18">äº”ã€é«˜çº§æç¤ºæŠ€æœ¯ï¼šæ¨ç†å¢å¼ºä¸è¡ŒåŠ¨äº¤äº’</h2>
<p>é«˜çº§æç¤ºæŠ€æœ¯èšç„¦äºæå‡æ¨¡å‹çš„å¤æ‚æ¨ç†èƒ½åŠ›ä¸ä¸»åŠ¨äº¤äº’èƒ½åŠ›ï¼Œé€šè¿‡å¼•å¯¼æ¨¡å‹æ˜¾å¼å±•ç¤ºæ€è€ƒè¿‡ç¨‹ã€åŠ¨æ€è°ƒç”¨å·¥å…·ï¼Œå®ç°ä»<em><strong>æ–‡æœ¬ç”Ÿæˆ</strong></em>åˆ°<em><strong>ä»»åŠ¡æ‰§è¡Œ</strong></em>çš„è·¨è¶Šï¼Œæ˜¯æ„å»ºé«˜çº§æ™ºèƒ½ä½“çš„æ ¸å¿ƒæ”¯æ’‘ã€‚</p>
<h3 data-id="heading-19">ï¼ˆä¸€ï¼‰æ¨ç†å¢å¼ºæŠ€æœ¯ï¼šæå‡å¤æ‚é—®é¢˜è§£å†³èƒ½åŠ›</h3>
<ol>
<li>
<p>æ€ç»´é“¾ï¼ˆChain of Thought, CoTï¼‰ï¼šè¦æ±‚æ¨¡å‹ç”Ÿæˆä¸­é—´æ¨ç†æ­¥éª¤ï¼Œæ¨¡æ‹Ÿäººç±»åˆ†è§£é—®é¢˜çš„è¿‡ç¨‹ï¼Œæ˜¾è‘—æå‡æ•°å­¦è®¡ç®—ã€é€»è¾‘æ¨ç†ç­‰å¤æ‚ä»»åŠ¡çš„å‡†ç¡®ç‡ã€‚</p>
<p>åˆ†ä¸ºé›¶æ ·æœ¬CoTä¸å°‘æ ·æœ¬CoTä¸¤ç§å½¢å¼ã€‚</p>
<p><strong>é›¶æ ·æœ¬CoTç¤ºä¾‹</strong>ï¼š</p>
<p>æç¤ºï¼š</p>
<p>â€œä¸€åˆ—ç«è½¦ä»¥æ¯å°æ—¶80å…¬é‡Œçš„é€Ÿåº¦ä»Aåœ°å¼€å¾€Båœ°ï¼Œä¸¤åœ°ç›¸è·480å…¬é‡Œï¼Œç«è½¦ä¸Šåˆ9ç‚¹å‡ºå‘ï¼Œä¸‹åˆå‡ ç‚¹èƒ½åˆ°è¾¾ï¼Ÿè¯·ä¸€æ­¥ä¸€æ­¥æ€è€ƒå¹¶ç»™å‡ºç­”æ¡ˆã€‚â€ï¼›</p>
<p>é¢„æœŸè¾“å‡ºï¼š</p>
<p>â€œç¬¬ä¸€æ­¥ï¼šè®¡ç®—ç«è½¦è¡Œé©¶æ—¶é—´ï¼Œæ—¶é—´=è·¯ç¨‹Ã·é€Ÿåº¦=480å…¬é‡ŒÃ·80å…¬é‡Œ/å°æ—¶=6å°æ—¶ï¼›ç¬¬äºŒæ­¥ï¼šè®¡ç®—åˆ°è¾¾æ—¶é—´ï¼Œä¸Šåˆ9ç‚¹+6å°æ—¶=ä¸‹åˆ3ç‚¹ï¼›ç­”æ¡ˆï¼šä¸‹åˆ3ç‚¹ã€‚â€</p>
<p><strong>å°‘æ ·æœ¬CoTç¤ºä¾‹</strong> ï¼š</p>
<p>æç¤ºï¼šè¯·è§£å†³ä»¥ä¸‹é€»è¾‘é¢˜ï¼Œå…ˆå†™å‡ºæ¨ç†è¿‡ç¨‹å†ç»™å‡ºç­”æ¡ˆã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<p>é¢˜ç›®ï¼šç”²ã€ä¹™ã€ä¸™ä¸‰äººä¸­ï¼Œç”²æ¯”ä¹™å¤§3å²ï¼Œä¸™æ¯”ä¹™å°2å²ï¼Œè°çš„å¹´é¾„æœ€å¤§ï¼Ÿ æ¨ç†è¿‡ç¨‹ï¼šè®¾ä¹™çš„å¹´é¾„ä¸ºxå²ï¼Œåˆ™ç”²çš„å¹´é¾„ä¸ºx+3å²ï¼Œä¸™çš„å¹´é¾„ä¸ºx-2å²ã€‚æ¯”è¾ƒx+3ã€xã€x-2ï¼Œå¯çŸ¥ç”²çš„å¹´é¾„æœ€å¤§ã€‚ç­”æ¡ˆï¼šç”²ã€‚ é¢˜ç›®ï¼šAã€Bã€Cä¸‰ä¸ªä»“åº“å…±å­˜ç²®120å¨ï¼ŒAä»“åº“å­˜ç²®æ˜¯Bä»“åº“çš„2å€ï¼ŒCä»“åº“å­˜ç²®æ¯”Bä»“åº“å°‘20å¨ï¼Œä¸‰ä¸ªä»“åº“å„å­˜ç²®å¤šå°‘å¨ï¼Ÿâ€ï¼›</p>
<p>é¢„æœŸè¾“å‡ºï¼š</p>
<p>â€œæ¨ç†è¿‡ç¨‹ï¼šè®¾Bä»“åº“å­˜ç²®xå¨ï¼Œåˆ™Aä»“åº“å­˜ç²®2xå¨ï¼ŒCä»“åº“å­˜ç²®x-20å¨ã€‚æ ¹æ®æ€»å­˜ç²®é‡å¯å¾—ï¼š2x + x + (x-20) = 120ï¼ŒåŒ–ç®€å¾—4x -20 = 120ï¼Œ4x=140ï¼Œx=35ã€‚å› æ­¤Aä»“åº“å­˜ç²®2Ã—35=70å¨ï¼ŒBä»“åº“35å¨ï¼ŒCä»“åº“35-20=15å¨ã€‚ç­”æ¡ˆï¼šAä»“åº“70å¨ï¼ŒBä»“åº“35å¨ï¼ŒCä»“åº“15å¨ã€‚</p>
</li>
<li>
<p>è‡ªæ´½æ€§ï¼ˆSelf-Consistencyï¼‰ï¼šåœ¨CoTåŸºç¡€ä¸Šï¼Œé€šè¿‡ç”Ÿæˆå¤šæ¡æ¨ç†è·¯å¾„å¹¶é€‰å–æœ€ä¸€è‡´çš„ç­”æ¡ˆï¼Œæå‡æ¨ç†å¯é æ€§ã€‚é€‚ç”¨äºå¯¹ç»“æœå‡†ç¡®æ€§è¦æ±‚é«˜çš„åœºæ™¯ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆå¸¸è¯†åˆ¤æ–­ï¼‰</strong> ï¼š</p>
<p>æç¤ºï¼šâ€œâ€˜æ‰€æœ‰å“ºä¹³åŠ¨ç‰©éƒ½ç”Ÿæ´»åœ¨é™†åœ°ä¸Šâ€™è¿™ä¸ªè¯´æ³•æ­£ç¡®å—ï¼Ÿè¯·ç»™å‡º3ç§ä¸åŒçš„æ¨ç†æ€è·¯ï¼Œæœ€åæ€»ç»“ç»“è®ºã€‚â€ï¼›</p>
<p>é¢„æœŸè¾“å‡ºï¼š</p>
<p>æ¨ç†æ€è·¯1ï¼šå“ºä¹³åŠ¨ç‰©çš„å®šä¹‰æ˜¯èƒç”Ÿã€å“ºä¹³çš„åŠ¨ç‰©ï¼Œé²¸é±¼æ˜¯èƒç”Ÿå“ºä¹³çš„å“ºä¹³åŠ¨ç‰©ï¼Œä½†ç”Ÿæ´»åœ¨æµ·æ´‹ä¸­ï¼Œå› æ­¤è¯¥è¯´æ³•é”™è¯¯ï¼›</p>
<p>æ¨ç†æ€è·¯2ï¼šå¸¸è§å“ºä¹³åŠ¨ç‰©ä¸­ï¼Œç‹—ã€çŒ«ç”Ÿæ´»åœ¨é™†åœ°ï¼Œä½†æµ·è±šä¹Ÿæ˜¯å“ºä¹³åŠ¨ç‰©ï¼Œç”Ÿæ´»åœ¨æ°´ä¸­ï¼Œå­˜åœ¨åä¾‹ï¼Œè¯´æ³•é”™è¯¯ï¼›</p>
<p>æ¨ç†æ€è·¯3ï¼šå“ºä¹³åŠ¨ç‰©çš„æ –æ¯åœ°å¤šæ ·ï¼ŒåŒ…æ‹¬é™†åœ°ã€æµ·æ´‹ã€ç©ºä¸­ï¼ˆå¦‚è™è ï¼‰ï¼Œå¹¶ééƒ½ç”Ÿæ´»åœ¨é™†åœ°ï¼Œè¯´æ³•é”™è¯¯ã€‚</p>
<p>ç»“è®ºï¼šè¯¥è¯´æ³•ä¸æ­£ç¡®ã€‚</p>
</li>
<li>
<p>æ€ç»´æ ‘ï¼ˆTree of Thoughts, ToTï¼‰ï¼šCoTçš„è¿›é˜¶å½¢å¼ï¼Œè®©æ¨¡å‹å¹¶è¡Œæ¢ç´¢å¤šæ¡æ¨ç†è·¯å¾„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªâ€œæ€è€ƒæ­¥éª¤â€ï¼Œå¯ä»èŠ‚ç‚¹åˆ†æ”¯æ¢ç´¢ä¸åŒè§£å†³æ–¹æ¡ˆï¼Œé€‚ç”¨äºéœ€è¦å¤šæ–¹æ¡ˆè¯„ä¼°ã€å›æº¯è°ƒæ•´çš„å¤æ‚ä»»åŠ¡ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆæ•…äº‹åˆ›ä½œï¼‰</strong> ï¼š</p>
<p>æç¤ºï¼š</p>
<p>ä¸ºä»¥ä¸‹æ•…äº‹å¼€å¤´è®¾è®¡3ä¸ªä¸åŒçš„å‘å±•ç»“å±€ï¼Œé‡‡ç”¨æ€ç»´æ ‘å½¢å¼å±•ç¤ºæ¨ç†è¿‡ç¨‹ï¼Œå†åˆ†åˆ«æ’°å†™ç»“å±€å†…å®¹ã€‚æ•…äº‹å¼€å¤´ï¼šâ€˜å°æ˜åœ¨æ—§ä¹¦æ‘Šå‘ç°äº†ä¸€æœ¬å†™æ»¡ç¥ç§˜ç¬¦å·çš„ç¬”è®°æœ¬ï¼Œç¿»å¼€ç¬¬ä¸€é¡µï¼Œç¬¦å·çªç„¶å‘å‡ºäº†å¾®å¼±çš„å…‰èŠ’ã€‚â€™ï¼›</p>
<p>é¢„æœŸè¾“å‡ºï¼š</p>
<p>æ€ç»´æ ‘ï¼š</p>
<p>åˆ†æ”¯1ï¼šç¬¦å·æ˜¯æ—¶ç©ºä¼ é€å¯†ç â†’å°æ˜è¢«ä¼ é€åˆ°å¤ä»£â†’ç»“å±€æ–¹å‘ï¼šç©¿è¶Šå†’é™©ï¼›</p>
<p>åˆ†æ”¯2ï¼šç¬¦å·æ˜¯å¤–æ˜Ÿæ–‡æ˜ä¿¡å·â†’ç¬”è®°æœ¬å‘å‡ºæ±‚æ•‘ä¿¡å·â†’ç»“å±€æ–¹å‘ï¼šå¤–æ˜Ÿæ¥è§¦ï¼›</p>
<p>åˆ†æ”¯3ï¼šç¬¦å·æ˜¯çˆ·çˆ·çš„è—å®å›¾â†’å°æ˜æ ¹æ®ç¬¦å·å¯»æ‰¾å®è—â†’ç»“å±€æ–¹å‘ï¼šäº²æƒ…ä¸æ¢é™©ï¼›</p>
<p>ç»“å±€1ï¼ˆç©¿è¶Šå†’é™©ï¼‰ï¼šâ€¦â€¦ï¼›</p>
<p>ç»“å±€2ï¼ˆå¤–æ˜Ÿæ¥è§¦ï¼‰ï¼šâ€¦â€¦ï¼›</p>
<p>ç»“å±€3ï¼ˆäº²æƒ…æ¢é™©ï¼‰ï¼šâ€¦â€¦ã€‚</p>
</li>
</ol>
<h3 data-id="heading-20">ï¼ˆäºŒï¼‰è¡ŒåŠ¨äº¤äº’æŠ€æœ¯ï¼šå®ç°æ™ºèƒ½ä½“ä¸ç¯å¢ƒè”åŠ¨</h3>
<ol>
<li>
<p>å·¥å…·ä½¿ç”¨/å‡½æ•°è°ƒç”¨ï¼šé€šè¿‡æç¤ºå¼•å¯¼æ¨¡å‹åˆ¤æ–­ä½•æ—¶éœ€è¦è°ƒç”¨å¤–éƒ¨å·¥å…·ï¼ˆå¦‚ç½‘é¡µæœç´¢ã€æ•°æ®åº“æŸ¥è¯¢ã€APIè°ƒç”¨ï¼‰ï¼Œå¹¶ç”Ÿæˆç»“æ„åŒ–çš„å·¥å…·è°ƒç”¨æŒ‡ä»¤ï¼Œç”±æ™ºèƒ½ä½“ç³»ç»Ÿæ‰§è¡Œå·¥å…·åå°†ç»“æœåé¦ˆç»™æ¨¡å‹ï¼Œå½¢æˆâ€œæ„ŸçŸ¥-æ¨ç†-è¡ŒåŠ¨â€çš„é—­ç¯ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆå¤©æ°”æŸ¥è¯¢ï¼‰</strong> ï¼š</p>
<p>æç¤ºï¼šâ€œä½ å¯ä»¥è°ƒç”¨å¤©æ°”æŸ¥è¯¢å·¥å…·get_current_weatherï¼Œå·¥å…·å‚æ•°ä¸ºï¼šcityï¼ˆåŸå¸‚åç§°ï¼Œå­—ç¬¦ä¸²ç±»å‹ï¼‰ã€dateï¼ˆæŸ¥è¯¢æ—¥æœŸï¼Œæ ¼å¼ä¸ºYYYY-MM-DDï¼‰ã€‚ç”¨æˆ·é—®é¢˜ï¼šä¸Šæµ·2025å¹´12æœˆ25æ—¥çš„å¤©æ°”å¦‚ä½•ï¼Ÿè¯·ç”Ÿæˆå·¥å…·è°ƒç”¨æŒ‡ä»¤ã€‚â€ï¼›</p>
<p>é¢„æœŸè¾“å‡ºï¼šâ€œ{"tool_name":"get_current_weather","parameters":{"city":"ä¸Šæµ·","date":"2025-12-25"}}â€</p>
</li>
<li>
<p>ReActï¼ˆReason &amp; Actï¼‰ï¼šèåˆCoTæ¨ç†ä¸å·¥å…·ä½¿ç”¨ï¼Œæ¨¡æ‹Ÿäººç±»â€œæ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿ-å†æ€è€ƒâ€çš„äº¤äº’è¿‡ç¨‹ï¼Œé€‚ç”¨äºéœ€è¦åŠ¨æ€è·å–å¤–éƒ¨ä¿¡æ¯çš„å¤æ‚ä»»åŠ¡ã€‚</p>
<p><strong>ä¸­æ–‡å®ä¾‹ï¼ˆæ—…æ¸¸æ”»ç•¥è§„åˆ’ï¼‰</strong> ï¼š</p>
<p>ç”¨æˆ·é—®é¢˜ï¼šâ€œæˆ‘è®¡åˆ’2025å¹´12æœˆå»å“ˆå°”æ»¨æ—…æ¸¸ï¼Œæƒ³çŸ¥é“å½“åœ°çš„æ°”æ¸©ã€å¿…å»æ™¯ç‚¹åŠé€‚åˆå¸¦å­©å­çš„æ´»åŠ¨ï¼Œå¸®æˆ‘æ•´ç†ä¸€ä»½3å¤©çš„æ”»ç•¥ã€‚â€</p>
<p>æç¤ºå¼•å¯¼çš„ReActæµç¨‹ï¼š</p>
<p>æ€è€ƒ1ï¼šç”¨æˆ·éœ€è¦å“ˆå°”æ»¨12æœˆæ°”æ¸©ã€å¿…å»æ™¯ç‚¹ã€äº²å­æ´»åŠ¨åŠ3å¤©æ”»ç•¥ï¼Œæ°”æ¸©å’Œéƒ¨åˆ†æ™¯ç‚¹ä¿¡æ¯å¯èƒ½éšå­£èŠ‚å˜åŒ–ï¼Œéœ€è¦è°ƒç”¨æœç´¢å·¥å…·è·å–æœ€æ–°æ•°æ®ï¼›</p>
<p>è¡ŒåŠ¨1ï¼š<code>Search({\"query\":[\"2025å¹´12æœˆå“ˆå°”æ»¨æ°”æ¸©\",\"å“ˆå°”æ»¨å¿…å»äº²å­æ™¯ç‚¹\",\"å“ˆå°”æ»¨3å¤©æ—…æ¸¸æ”»ç•¥\"]})</code>ï¼›</p>
<p>è§‚å¯Ÿ1ï¼šï¼ˆå·¥å…·è¿”å›ç»“æœï¼‰12æœˆå“ˆå°”æ»¨æ°”æ¸©-20~-5â„ƒï¼›å¿…å»äº²å­æ™¯ç‚¹ï¼šå“ˆå°”æ»¨å†°é›ªå¤§ä¸–ç•Œï¼ˆæœ‰å„¿ç«¥å†°é›ªä¹å›­ï¼‰ã€å¤ªé˜³å²›é›ªåšä¼šã€ä¸œåŒ—è™æ—å›­ï¼›</p>
<p>æ€è€ƒ2ï¼šå·²è·å–æ ¸å¿ƒä¿¡æ¯ï¼Œå¯ç»“åˆæ°”æ¸©å»ºè®®ç”¨æˆ·æºå¸¦ä¿æš–è¡£ç‰©ï¼Œæ ¹æ®äº²å­æ™¯ç‚¹è§„åˆ’3å¤©è¡Œç¨‹ï¼Œæ¯å¤©åˆç†åˆ†é…æ™¯ç‚¹ï¼Œé¿å…è¡Œç¨‹è¿‡æ»¡ï¼›</p>
<p>è¡ŒåŠ¨2ï¼šç”Ÿæˆæ”»ç•¥ï¼ˆæ— éœ€å†è°ƒç”¨å·¥å…·ï¼‰ï¼›</p>
<p>æœ€ç»ˆè¾“å‡ºï¼šâ€œ2025å¹´12æœˆå“ˆå°”æ»¨æ°”æ¸©è¾ƒä½ï¼ˆ-20~-5â„ƒï¼‰ï¼Œå»ºè®®æºå¸¦ç¾½ç»’æœã€é›ªåœ°é´ç­‰ä¿æš–è¡£ç‰©ã€‚3å¤©äº²å­æ—…æ¸¸æ”»ç•¥ï¼šâ€¦â€¦â€</p>
</li>
</ol>
<h2 data-id="heading-21">å…­ã€é«˜çº§æ‹“å±•æŠ€æœ¯ï¼šè‡ªåŠ¨åŒ–ä¸å®šåˆ¶ä¼˜åŒ–</h2>
<p>é«˜çº§æ‹“å±•æŠ€æœ¯èšç„¦äºæå‡æç¤ºå·¥ç¨‹çš„æ•ˆç‡ä¸ä¸ªæ€§åŒ–ç¨‹åº¦ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–ä¼˜åŒ–ã€å¤–éƒ¨çŸ¥è¯†é›†æˆã€ç”¨æˆ·ç”»åƒé€‚é…ç­‰æ–¹å¼ï¼Œå®ç°æç¤ºæ–¹æ¡ˆçš„è§„æ¨¡åŒ–è½åœ°ä¸ç²¾å‡†åŒ–é€‚é…ã€‚</p>
<h3 data-id="heading-22">ï¼ˆä¸€ï¼‰è‡ªåŠ¨æç¤ºå·¥ç¨‹ï¼ˆAPEï¼‰ï¼šå‡å°‘äººå·¥è¿­ä»£æˆæœ¬</h3>
<p>è‡ªåŠ¨æç¤ºå·¥ç¨‹åˆ©ç”¨LLMä½œä¸ºâ€œå…ƒæ¨¡å‹â€ï¼Œæ ¹æ®ä»»åŠ¡æè¿°è‡ªåŠ¨ç”Ÿæˆå¤šä¸ªå€™é€‰æç¤ºï¼Œé€šè¿‡é¢„è®¾çš„è¯„ä¼°æŒ‡æ ‡ï¼ˆå¦‚BLEUã€ROUGEåˆ†æ•°æˆ–äººå·¥è¯„åˆ†ï¼‰ç­›é€‰æœ€ä¼˜æç¤ºï¼Œå¹¶è¿›è¡Œè¿­ä»£ä¼˜åŒ–ã€‚é€‚ç”¨äºå¤§è§„æ¨¡ã€æ ‡å‡†åŒ–çš„ä»»åŠ¡åœºæ™¯ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆæ–‡æœ¬åˆ†ç±»ä»»åŠ¡çš„è‡ªåŠ¨æç¤ºç”Ÿæˆï¼‰</strong> ï¼š</p>
<p>å…ƒæç¤ºï¼šè¯·ä¸ºâ€˜ç”µå•†è¯„è®ºæƒ…æ„Ÿåˆ†ç±»ä»»åŠ¡â€™ç”Ÿæˆ5ä¸ªå€™é€‰æç¤ºï¼Œä»»åŠ¡è¦æ±‚ï¼šå°†è¯„è®ºåˆ†ä¸ºæ­£é¢ã€è´Ÿé¢ã€ä¸­æ€§ï¼Œè¾“å‡ºæ ¼å¼ä¸ºâ€˜æƒ…æ„Ÿæ ‡ç­¾ï¼šè¯„è®ºå†…å®¹â€™ï¼Œå€™é€‰æç¤ºéœ€ç¬¦åˆæ¸…æ™°å…·ä½“ã€ç®€æ´ç²¾ç‚¼çš„åŸåˆ™ã€‚ï¼›</p>
<p>å…ƒæ¨¡å‹è¾“å‡ºï¼ˆå€™é€‰æç¤ºç¤ºä¾‹ï¼‰ï¼š</p>
<ol>
<li>å°†ä»¥ä¸‹ç”µå•†è¯„è®ºåˆ†ç±»ä¸ºæ­£é¢ã€è´Ÿé¢ã€ä¸­æ€§ï¼Œè¾“å‡ºæ ¼å¼ï¼šæƒ…æ„Ÿæ ‡ç­¾ï¼šè¯„è®ºå†…å®¹ï¼›è¯„è®ºï¼š[è¯„è®ºæ–‡æœ¬]ï¼›</li>
<li>åˆ¤æ–­ç”µå•†è¯„è®ºçš„æƒ…æ„Ÿå€¾å‘ï¼ˆæ­£é¢/è´Ÿé¢/ä¸­æ€§ï¼‰ï¼ŒæŒ‰â€˜æƒ…æ„Ÿï¼šè¯„è®ºâ€™çš„æ ¼å¼è¾“å‡ºï¼›è¾“å…¥è¯„è®ºï¼š[è¯„è®ºæ–‡æœ¬]ï¼›</li>
</ol>
<p>åç»­æµç¨‹ï¼šé€šè¿‡æµ‹è¯•é›†éªŒè¯5ä¸ªå€™é€‰æç¤ºçš„åˆ†ç±»å‡†ç¡®ç‡ï¼Œé€‰æ‹©å‡†ç¡®ç‡æœ€é«˜çš„æç¤ºä½œä¸ºæœ€ç»ˆæ–¹æ¡ˆã€‚</p>
<h3 data-id="heading-23">ï¼ˆäºŒï¼‰æ£€ç´¢å¢å¼ºç”Ÿæˆï¼ˆRAGï¼‰ï¼šæå‡å“åº”çš„å‡†ç¡®æ€§ä¸æ—¶æ•ˆæ€§</h3>
<p>RAGæŠ€æœ¯é€šè¿‡æ£€ç´¢å¤–éƒ¨çŸ¥è¯†åº“ï¼ˆå¦‚ä¼ä¸šæ–‡æ¡£ã€è¡Œä¸šæŠ¥å‘Šã€å®æ—¶æ•°æ®ï¼‰ï¼Œå°†ç›¸å…³ä¿¡æ¯æ•´åˆåˆ°æç¤ºçš„ä¸Šä¸‹æ–‡ï¼Œè®©æ¨¡å‹åŸºäºæœ€æ–°ã€æœ€å‡†ç¡®çš„äº‹å®ç”Ÿæˆå“åº”ï¼Œæœ‰æ•ˆå‡å°‘æ¨¡å‹â€œå¹»è§‰â€ï¼Œé€‚ç”¨äºéœ€è¦åŠ¨æ€æ›´æ–°çŸ¥è¯†çš„åœºæ™¯ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆæŠ€æœ¯æ–‡æ¡£é—®ç­”ï¼‰</strong> ï¼š</p>
<p>ç”¨æˆ·é—®é¢˜ï¼šæŸCRMç³»ç»Ÿå¦‚ä½•è®¾ç½®å®¢æˆ·æ ‡ç­¾ï¼Ÿï¼›</p>
<p>ç³»ç»Ÿæµç¨‹ï¼š</p>
<ol>
<li>æ£€ç´¢ä¼ä¸šå†…éƒ¨CRMç³»ç»ŸV3.0ç‰ˆæœ¬çš„æŠ€æœ¯æ–‡æ¡£ï¼›</li>
<li>æå–ä¸â€œå®¢æˆ·æ ‡ç­¾è®¾ç½®â€ç›¸å…³çš„æ–‡æ¡£ç‰‡æ®µï¼›</li>
<li>æ„å»ºæç¤ºï¼› æç¤ºï¼šâ€œæ ¹æ®ä»¥ä¸‹æŠ€æœ¯æ–‡æ¡£ç‰‡æ®µï¼šâ€˜ã€æ–‡æ¡£ç‰‡æ®µã€‘CRMç³»ç»ŸV3.0ç‰ˆæœ¬å®¢æˆ·æ ‡ç­¾è®¾ç½®æ­¥éª¤ï¼š1. ç™»å½•ç³»ç»Ÿåå°ï¼Œè¿›å…¥â€œå®¢æˆ·ç®¡ç†â€æ¨¡å—ï¼›2. ç‚¹å‡»â€œæ ‡ç­¾ç®¡ç†â€ï¼Œé€‰æ‹©â€œæ–°å¢æ ‡ç­¾â€ï¼›3. è¾“å…¥æ ‡ç­¾åç§°ã€é€‰æ‹©æ ‡ç­¾ç±»å‹ï¼ˆå®¢æˆ·å±æ€§/è´­ä¹°è¡Œä¸ºï¼‰ï¼Œç‚¹å‡»â€œä¿å­˜â€ï¼›</li>
<li>æ‰¹é‡æˆ–å•ä¸ªé€‰æ‹©å®¢æˆ·ï¼Œå‹¾é€‰å¯¹åº”æ ‡ç­¾å®Œæˆå…³è”ã€‚è¯·å›ç­”ç”¨æˆ·é—®é¢˜ï¼šæŸå“ç‰ŒV3.0ç‰ˆæœ¬çš„CRMç³»ç»Ÿå¦‚ä½•è®¾ç½®å®¢æˆ·æ ‡ç­¾ï¼Ÿâ€ï¼›</li>
</ol>
<p>é¢„æœŸè¾“å‡ºï¼š</p>
<p>æŸCRMç³»ç»Ÿè®¾ç½®å®¢æˆ·æ ‡ç­¾çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç™»å½•ç³»ç»Ÿåå°ï¼Œè¿›å…¥â€œå®¢æˆ·ç®¡ç†â€æ¨¡å—ï¼›</li>
<li>ç‚¹å‡»â€œæ ‡ç­¾ç®¡ç†â€ï¼Œé€‰æ‹©â€œæ–°å¢æ ‡ç­¾â€ï¼›</li>
<li>è¾“å…¥æ ‡ç­¾åç§°å¹¶é€‰æ‹©æ ‡ç­¾ç±»å‹ï¼ˆå®¢æˆ·å±æ€§/è´­ä¹°è¡Œä¸ºï¼‰ï¼Œç‚¹å‡»â€œä¿å­˜â€ï¼›</li>
<li>é€‰æ‹©ç›®æ ‡å®¢æˆ·ï¼Œå‹¾é€‰æ ‡ç­¾å®Œæˆå…³è”ã€‚</li>
</ol>
<h3 data-id="heading-24">ï¼ˆä¸‰ï¼‰ç”¨æˆ·ç”»åƒæ¨¡å¼ï¼šç²¾å‡†é€‚é…ç›®æ ‡å—ä¼—</h3>
<p>ç”¨æˆ·ç”»åƒæ¨¡å¼é€šè¿‡æè¿°ç›®æ ‡ç”¨æˆ·çš„èº«ä»½ã€çŸ¥è¯†èƒŒæ™¯ã€éœ€æ±‚åå¥½ç­‰ä¿¡æ¯ï¼Œå¼•å¯¼æ¨¡å‹è°ƒæ•´è¯­è¨€é£æ ¼ã€å†…å®¹å¤æ‚åº¦ä¸ä¿¡æ¯å‘ˆç°æ–¹å¼ï¼Œå®ç°ä¸ªæ€§åŒ–å“åº”ã€‚åŒºåˆ«äºè§’è‰²æç¤ºï¼ˆä¸ºæ¨¡å‹åˆ†é…èº«ä»½ï¼‰ï¼Œç”¨æˆ·ç”»åƒèšç„¦äºâ€œé€‚é…å—ä¼—â€ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆçŸ¥è¯†ç§‘æ™®ï¼‰</strong> ï¼š</p>
<p>æç¤ºï¼š</p>
<p>è¯·å‘ä»¥ä¸‹ç”¨æˆ·è§£é‡Šâ€˜äººå·¥æ™ºèƒ½å¤§æ¨¡å‹â€™çš„æ¦‚å¿µï¼šã€ç”¨æˆ·ç”»åƒã€‘å°å­¦5å¹´çº§å­¦ç”Ÿï¼Œæ— äººå·¥æ™ºèƒ½ç›¸å…³åŸºç¡€ï¼Œå–œæ¬¢å¡é€šå½¢è±¡ç±»æ¯”ã€‚è¦æ±‚ï¼šè¯­è¨€ç®€å•æ˜“æ‡‚ï¼Œç»“åˆå¡é€šå½¢è±¡ç±»æ¯”ï¼Œé¿å…ä¸“ä¸šæœ¯è¯­ã€‚</p>
<p>é¢„æœŸè¾“å‡ºï¼š</p>
<p>äººå·¥æ™ºèƒ½å¤§æ¨¡å‹å°±åƒä¸€ä¸ªæ‹¥æœ‰è¶…çº§è®°å¿†åŠ›å’Œå­¦ä¹ èƒ½åŠ›çš„å¡é€šå°ç²¾çµã€‚å®ƒä»å°å°±é˜…è¯»äº†å…¨ä¸–ç•Œçš„ä¹¦ç±ã€å›¾ç‰‡å’Œè§†é¢‘ï¼Œå­¦ä¼šäº†ç†è§£äººç±»çš„è¯­è¨€ã€ç”»ç”»ã€å›ç­”é—®é¢˜ã€‚ä½ é—®å®ƒâ€˜å¤©ç©ºä¸ºä»€ä¹ˆæ˜¯è“è‰²çš„â€™ï¼Œå®ƒèƒ½åƒè€å¸ˆä¸€æ ·ç”¨ç®€å•çš„è¯å‘Šè¯‰ä½ ï¼›ä½ è®©å®ƒç”»ä¸€åªä¼šé£çš„å°çŒªï¼Œå®ƒä¹Ÿèƒ½å¿«é€Ÿç”»å‡ºæ¥ã€‚è¿™ä¸ªå°ç²¾çµçš„ç‰¹ç‚¹æ˜¯è¶Šå­¦ä¹ è¶Šèªæ˜ï¼Œèƒ½å¸®æˆ‘ä»¬åšå¾ˆå¤šæœ‰è¶£çš„äº‹æƒ…ã€‚</p>
<h3 data-id="heading-25">ï¼ˆå››ï¼‰ä»»åŠ¡æ‹†åˆ†</h3>
<p>å°†å¤æ‚ä»»åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªé€»è¾‘å…³è”çš„å­ä»»åŠ¡ï¼Œåˆ†åˆ«å¯¹æ¯ä¸ªå­ä»»åŠ¡è®¾è®¡æç¤ºï¼Œæœ€åæ•´åˆå„å­ä»»åŠ¡çš„è¾“å‡ºç»“æœï¼Œé¿å…å› ä»»åŠ¡è¿‡äºå¤æ‚å¯¼è‡´æ¨¡å‹ç†è§£åå·®ã€‚é€‚ç”¨äºè®ºæ–‡æ’°å†™ã€å¤æ‚æŠ¥å‘Šç”Ÿæˆã€å¤šæ­¥éª¤è§„åˆ’ç­‰åœºæ™¯ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆè®ºæ–‡æ’°å†™ï¼‰</strong> ï¼š</p>
<p>æ€»ä»»åŠ¡ï¼šæ’°å†™ã€Šäººå·¥æ™ºèƒ½å¯¹æ•™è‚²è¡Œä¸šçš„å½±å“ã€‹ç ”ç©¶è®ºæ–‡ï¼›</p>
<p>å­ä»»åŠ¡æ‹†åˆ†ä¸å¯¹åº”æç¤ºï¼š</p>
<ul>
<li>å­ä»»åŠ¡1ï¼šç”Ÿæˆè®ºæ–‡å¤§çº²ï¼›æç¤ºï¼šæ’°å†™ã€Šäººå·¥æ™ºèƒ½å¯¹æ•™è‚²è¡Œä¸šçš„å½±å“ã€‹çš„è¯¦ç»†è®ºæ–‡å¤§çº²ï¼ŒåŒ…å«å¼•è¨€ã€æ ¸å¿ƒå½±å“ï¼ˆåˆ†æ­£é¢/è´Ÿé¢ï¼‰ã€æ¡ˆä¾‹åˆ†æã€å¯¹ç­–å»ºè®®ã€ç»“è®º5ä¸ªä¸»è¦éƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†åˆ—å‡º2-3ä¸ªäºŒçº§è¦ç‚¹ã€‚ï¼›</li>
<li>å­ä»»åŠ¡2ï¼šæ’°å†™å¼•è¨€ï¼›æç¤ºï¼šæ ¹æ®ä»¥ä¸‹å¤§çº²çš„å¼•è¨€éƒ¨åˆ†è¦ç‚¹ï¼Œæ’°å†™è®ºæ–‡å¼•è¨€ï¼Œè¦æ±‚ç»“åˆå½“å‰AIæ•™è‚²çš„å‘å±•èƒŒæ™¯ï¼Œæå‡ºç ”ç©¶æ„ä¹‰ï¼Œå­—æ•°300-400å­—ã€‚ã€å¤§çº²è¦ç‚¹ã€‘å¼•è¨€ï¼šAIæ•™è‚²çš„å‘å±•ç°çŠ¶ã€ç ”ç©¶èƒŒæ™¯ã€ç ”ç©¶æ„ä¹‰ã€è®ºæ–‡ç»“æ„ï¼›</li>
<li>å­ä»»åŠ¡3ï¼šæ’°å†™æ ¸å¿ƒç« èŠ‚ï¼›æç¤ºï¼šç»“åˆä»¥ä¸‹æ¡ˆä¾‹å’Œæ•°æ®ï¼Œæ’°å†™ã€Šäººå·¥æ™ºèƒ½å¯¹æ•™è‚²è¡Œä¸šçš„å½±å“ã€‹çš„â€˜æ ¸å¿ƒâ€™ç« èŠ‚ï¼Œæ­£é¢å½±å“éƒ¨åˆ†çªå‡ºä¸ªæ€§åŒ–å­¦ä¹ ã€æ•™å­¦æ•ˆç‡æå‡ï¼Œè´Ÿé¢å½±å“éƒ¨åˆ†åˆ†ææ•™è‚²å…¬å¹³ã€æ•™å¸ˆè§’è‰²å†²å‡»ï¼›</li>
<li>å­ä»»åŠ¡4ï¼šæ•´åˆä¸ä¿®æ”¹ï¼›æç¤ºï¼šå°†ä»¥ä¸‹è®ºæ–‡å„ç« èŠ‚å†…å®¹ï¼ˆå¼•è¨€ã€æ ¸å¿ƒå½±å“ã€æ¡ˆä¾‹åˆ†æã€å¯¹ç­–å»ºè®®ï¼‰æ•´åˆä¸ºå®Œæ•´è®ºæ–‡ï¼Œä¿®æ­£è¯­å¥ä¸é€šé¡ºä¹‹å¤„ï¼Œè°ƒæ•´æ®µè½è¡”æ¥ï¼Œç¡®ä¿é€»è¾‘è¿è´¯ã€‚</li>
</ul>
<h2 data-id="heading-26">ä¸ƒã€ç‰¹å®šä»»åŠ¡æç¤ºç­–ç•¥ï¼šä»£ç ä¸å¤šæ¨¡æ€</h2>
<p>é’ˆå¯¹ä»£ç ç”Ÿæˆã€å¤šæ¨¡æ€äº¤äº’ç­‰ç‰¹æ®Šä»»åŠ¡ï¼Œéœ€è¦è®¾è®¡ä¸“ç”¨çš„æç¤ºç­–ç•¥ï¼Œå……åˆ†å‘æŒ¥æ¨¡å‹çš„ä¸“é¡¹èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-27">ï¼ˆä¸€ï¼‰ä»£ç æç¤ºï¼šç²¾å‡†é€‚é…å¼€å‘åœºæ™¯</h3>
<p>ä»£ç æç¤ºéœ€æ˜ç¡®ä¸‰ä¸ªæ ¸å¿ƒè¦ç´ ï¼šç¼–ç¨‹è¯­è¨€ä¸ç‰ˆæœ¬ã€åŠŸèƒ½éœ€æ±‚ã€è¾“å…¥è¾“å‡ºæ ¼å¼ï¼ˆæˆ–çº¦æŸæ¡ä»¶ï¼‰ï¼Œå¤æ‚åœºæ™¯ä¸‹å¯æä¾›éƒ¨åˆ†ç¤ºä¾‹ä»£ç æˆ–ä¼ªä»£ç ã€‚å¸¸è§ä»£ç æç¤ºåœºæ™¯åŒ…æ‹¬ï¼šä»£ç ç”Ÿæˆã€ä»£ç è§£é‡Šã€ä»£ç ç¿»è¯‘ã€è°ƒè¯•ä¼˜åŒ–ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆä»£ç ç”Ÿæˆ+è°ƒè¯•ï¼‰</strong> ï¼š</p>
<ul>
<li>
<p>ä»£ç ç”Ÿæˆå®ä¾‹ï¼š</p>
<p>æç¤ºï¼š</p>
<p>ç”¨Python 3.10ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥ä¸ºæ•´æ•°åˆ—è¡¨ï¼Œè¾“å‡ºä¸ºåˆ—è¡¨ä¸­æ‰€æœ‰å¶æ•°çš„å¹³æ–¹å’Œã€‚è¦æ±‚ï¼šåŒ…å«å‡½æ•°æ³¨é‡Šï¼Œå¤„ç†ç©ºåˆ—è¡¨è¾“å…¥çš„å¼‚å¸¸æƒ…å†µã€‚</p>
<p>é¢„æœŸè¾“å‡ºï¼š</p>
<pre><code class="hljs language-py" lang="py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">even_square_sum</span>(<span class="hljs-params">num_list: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">int</span>]</span>) -&gt; <span class="hljs-built_in">int</span>:
<span class="hljs-string">"""
è®¡ç®—æ•´æ•°åˆ—è¡¨ä¸­æ‰€æœ‰å¶æ•°çš„å¹³æ–¹å’Œ

å‚æ•°ï¼š
    num_list (list[int]): æ•´æ•°åˆ—è¡¨

è¿”å›ï¼š
    int: æ‰€æœ‰å¶æ•°çš„å¹³æ–¹å’Œï¼ˆæ•´æ•°ï¼‰

å¼‚å¸¸å¤„ç†ï¼š
    ç©ºåˆ—è¡¨è¿”å›0
"""</span>
<span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> num_list:
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>

total = <span class="hljs-number">0</span>
<span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> num_list:
    <span class="hljs-keyword">if</span> num % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>:
        total += num ** <span class="hljs-number">2</span>

<span class="hljs-keyword">return</span> total
</code></pre>
</li>
<li>
<p>ä»£ç è°ƒè¯•å®ä¾‹ï¼š</p>
<p>æç¤ºï¼š</p>
<p>ä»¥ä¸‹Pythonä»£ç è¿è¡Œæ—¶å‡ºç°é”™è¯¯ï¼Œè¯·æ‰¾å‡ºé”™è¯¯åŸå› å¹¶ä¿®æ”¹ã€‚ä»£ç ï¼š<code>def add(a, b): return a + b</code>ï¼›è°ƒç”¨ï¼š<code>print(add([1,2], 3))</code></p>
<p>é”™è¯¯ä¿¡æ¯ï¼š<code>TypeError: can only concatenate list (not \"int\") to list</code></p>
<p>é¢„æœŸè¾“å‡ºï¼š</p>
<p>é”™è¯¯åŸå› ï¼šå‡½æ•°addæ¥æ”¶çš„ä¸¤ä¸ªå‚æ•°ç±»å‹ä¸ä¸€è‡´ï¼ˆä¸€ä¸ªæ˜¯åˆ—è¡¨ï¼Œä¸€ä¸ªæ˜¯æ•´æ•°ï¼‰ï¼Œåˆ—è¡¨ä¸æ•´æ•°æ— æ³•ç›´æ¥è¿›è¡ŒåŠ æ³•è¿ç®—ã€‚ä¿®æ”¹æ–¹æ¡ˆï¼šæ ¹æ®éœ€æ±‚è°ƒæ•´å‚æ•°ç±»å‹ï¼Œè‹¥éœ€å°†æ•´æ•°æ·»åŠ åˆ°åˆ—è¡¨ï¼Œå¯ä¿®æ”¹å‡½æ•°ä¸ºï¼š<code>def add(a, b): a.append(b); return a</code>ï¼›è°ƒç”¨ï¼š<code>print(add([1,2], 3))</code>ï¼Œè¾“å‡ºï¼š<code>[1,2,3]</code>ã€‚</p>
</li>
</ul>
<h3 data-id="heading-28">ï¼ˆäºŒï¼‰å¤šæ¨¡æ€æç¤ºï¼šèåˆå¤šç§è¾“å…¥å½¢å¼</h3>
<p>å¤šæ¨¡æ€æç¤ºé€šè¿‡æ•´åˆæ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘ç­‰å¤šç§è¾“å…¥å½¢å¼ï¼Œå¼•å¯¼æ¨¡å‹å®Œæˆè·¨æ¨¡æ€ä»»åŠ¡ã€‚å½“å‰ä¸»æµLLMçš„å¤šæ¨¡æ€æç¤ºä»¥â€œæ–‡æœ¬+å›¾ç‰‡â€ä¸ºä¸»ï¼Œæç¤ºéœ€æ˜ç¡®è¯´æ˜è¾“å…¥æ¨¡æ€ç±»å‹ä¸ä»»åŠ¡ç›®æ ‡ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼ˆå›¾ç‰‡+æ–‡æœ¬æç¤ºï¼‰</strong> ï¼š</p>
<p>æç¤ºï¼š</p>
<p>ã€è¾“å…¥æ¨¡æ€ã€‘æ–‡æœ¬+å›¾ç‰‡ï¼ˆå›¾ç‰‡å†…å®¹ï¼šä¸€å¼ åŒ…å«å°çŒ«ã€æ²™å‘ã€å’–å•¡æ¯çš„å®¢å…åœºæ™¯å›¾ï¼‰ï¼›</p>
<p>ã€ä»»åŠ¡ã€‘</p>
<pre><code class="hljs language-ini" lang="ini">ç”¨ä¸­æ–‡æè¿°å›¾ç‰‡ä¸­çš„æ ¸å¿ƒå…ƒç´ åŠåœºæ™¯æ°›å›´<span class="hljs-comment">;</span>
ä¸ºè¿™å¼ å›¾ç‰‡åˆ›ä½œä¸€å¥æ¸©é¦¨çš„æ–‡æ¡ˆã€‚
</code></pre>
<p>é¢„æœŸè¾“å‡ºï¼š</p>
<p>æ ¸å¿ƒå…ƒç´ ï¼šä¸€åªæ©˜è‰²å°çŒ«èœ·ç¼©åœ¨æµ…ç°è‰²æ²™å‘ä¸Šï¼Œæ²™å‘æ—çš„èŒ¶å‡ ä¸Šæ”¾ç€ä¸€æ¯å†’ç€çƒ­æ°”çš„å’–å•¡æ¯ï¼Œæ•´ä½“åœºæ™¯æ•´æ´æ¸©é¦¨ã€‚æ–‡æ¡ˆï¼šæš–é˜³åˆåï¼ŒçŒ«å’ªç›¸ä¼´ï¼Œä¸€æ¯å’–å•¡ï¼Œæ²»æ„ˆæ‰€æœ‰ç–²æƒ«ã€‚</p>
<h2 data-id="heading-29">å…«ã€æç¤ºå·¥ç¨‹çš„æœ€ä½³å®è·µ</h2>
<p>ç»“åˆå¤§é‡å®è·µç»éªŒï¼Œæ€»ç»“ä»¥ä¸‹10æ¡æ ¸å¿ƒæœ€ä½³å®è·µï¼Œå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿæå‡æç¤ºæ•ˆæœï¼š</p>
<ul>
<li>ç¤ºä¾‹ä¼˜å…ˆï¼šå¤æ‚ä»»åŠ¡ä¼˜å…ˆä½¿ç”¨å•æ ·æœ¬/å°‘æ ·æœ¬æç¤ºï¼Œç¤ºä¾‹è¦è¦†ç›–ä»»åŠ¡çš„æ ¸å¿ƒå˜ä½“ï¼›</li>
<li>æ ¼å¼è§„èŒƒï¼šä½¿ç”¨ç»“æ„åŒ–åˆ†éš”ç¬¦åˆ’åˆ†æç¤ºå„éƒ¨åˆ†ï¼Œé¿å…ä¿¡æ¯æ··æ·†ï¼›</li>
<li>è¾“å‡ºæ˜ç¡®ï¼šæ¸…æ™°å®šä¹‰è¾“å‡ºçš„æ ¼å¼ã€é•¿åº¦ã€é£æ ¼ï¼Œéåˆ›æ„ä»»åŠ¡ä¼˜å…ˆä½¿ç”¨ç»“æ„åŒ–è¾“å‡ºï¼›</li>
<li>æ­£é¢å¼•å¯¼ï¼šä¼˜å…ˆä½¿ç”¨â€œè¯·åšXXâ€çš„æ­£é¢æŒ‡ä»¤ï¼Œå‡å°‘â€œä¸è¦åšXXâ€çš„è´Ÿé¢çº¦æŸï¼›</li>
<li>Tokenæ§åˆ¶ï¼šæ ¹æ®æ¨¡å‹ä¸Šä¸‹æ–‡çª—å£å¤§å°è§„åˆ’æç¤ºé•¿åº¦ï¼Œé¿å…è¾“å…¥/è¾“å‡ºè¶…å‡ºTokené™åˆ¶ï¼›</li>
<li>å˜é‡å¤ç”¨ï¼šå°†é‡å¤å‡ºç°çš„å†…å®¹ï¼ˆå¦‚å›ºå®šæ ¼å¼ã€é€šç”¨è§„åˆ™ï¼‰è®¾ä¸ºå˜é‡ï¼Œæå‡æç¤ºå¤ç”¨æ€§ï¼›</li>
<li>é¡ºåºä¼˜åŒ–ï¼šåˆ†ç±»ä»»åŠ¡ä¸­éšæœºæ’åˆ—ç¤ºä¾‹é¡ºåºï¼Œé¿å…æ¨¡å‹è¿‡æ‹Ÿåˆåºåˆ—ï¼›</li>
<li>ç‰ˆæœ¬é€‚é…ï¼šæ¨¡å‹ç‰ˆæœ¬æ›´æ–°åï¼Œé‡æ–°æµ‹è¯•ç°æœ‰æç¤ºï¼Œå¿…è¦æ—¶è°ƒæ•´ä¼˜åŒ–ï¼›</li>
<li>å®éªŒè®°å½•ï¼šå»ºç«‹æç¤ºè¿­ä»£æ—¥å¿—ï¼Œè®°å½•æç¤ºç‰ˆæœ¬ã€æ¨¡å‹å‚æ•°ã€è¾“å‡ºç»“æœä¸ä¼˜åŒ–æ–¹å‘ï¼›</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•ï¼šç”Ÿäº§ç¯å¢ƒä¸­æ­å»ºæç¤ºçš„è‡ªåŠ¨åŒ–æµ‹è¯•ä½“ç³»ï¼Œç¡®ä¿æ³›åŒ–èƒ½åŠ›ä¸ç¨³å®šæ€§ã€‚</li>
</ul>
<h2 data-id="heading-30">ä¹ã€æ€»ç»“</h2>
<p>æç¤ºå·¥ç¨‹çš„æœ¬è´¨æ˜¯<strong>å°†é€šç”¨LLMè½¬åŒ–ä¸ºä¸“ç”¨æ™ºèƒ½å·¥å…·çš„å·¥ç¨‹åŒ–æ–¹æ³•</strong>ï¼Œå…¶æ ¸å¿ƒä»·å€¼åœ¨äºé€šè¿‡ç²¾å‡†çš„è¾“å…¥è®¾è®¡ï¼Œå¼¥è¡¥è‡ªç„¶è¯­è¨€çš„æ­§ä¹‰æ€§ï¼Œæå‡æ¨¡å‹è¾“å‡ºçš„ç¡®å®šæ€§ä¸å¯æ§æ€§ã€‚</p>
<p>å‚è€ƒå†…å®¹ï¼š</p>
<p>[1] A. Gulli, <em>Agentic Design Patterns</em>. 2025.</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é€šè¿‡Homebrewå®‰è£…MySQLå’ŒRedis]]></title>    <link>https://juejin.cn/post/7591317772074532883</link>    <guid>https://juejin.cn/post/7591317772074532883</guid>    <pubDate>2026-01-04T14:28:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591317772074532883" data-draft-id="7591318630694600758" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é€šè¿‡Homebrewå®‰è£…MySQLå’ŒRedis"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2026-01-04T14:28:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åˆ©å…„çš„è§†ç•Œ"/> <meta itemprop="url" content="https://juejin.cn/user/2049145405715710"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é€šè¿‡Homebrewå®‰è£…MySQLå’ŒRedis
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2049145405715710/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åˆ©å…„çš„è§†ç•Œ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T14:28:59.000Z" title="Sun Jan 04 2026 14:28:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•é€šè¿‡Homebrewï¼ˆç®€ç§°brewï¼‰å·¥å…·åœ¨macOSç³»ç»Ÿä¸­å®‰è£…MySQL 5.7å’ŒRedisï¼Œå¹¶é…ç½®å…è®¸å±€åŸŸç½‘è®¿é—®ï¼Œå®ŒæˆæœåŠ¡å¯åŠ¨ä¸è¿æ¥æµ‹è¯•ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€å®‰è£…mysql@5.7</h2>
<h3 data-id="heading-1">1. æ‰§è¡Œå®‰è£…å‘½ä»¤</h3>
<p>æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤é€šè¿‡brewå®‰è£…MySQL 5.7ç‰ˆæœ¬ï¼š</p>
<pre><code class="hljs language-css" lang="css">brew install mysql<span class="hljs-keyword">@5</span>.7
</code></pre>
<h3 data-id="heading-2"/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fca7f2951094ee48123f79ed3d6ee8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yip5YWE55qE6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141738&amp;x-signature=lKLxSqqdQMg9WHL%2BLy1sjMU%2BCj8%3D" alt="image-20260104080412500" loading="lazy"/></p>
<h3 data-id="heading-3">2.é…ç½®ç¯å¢ƒå˜é‡</h3>
<p>ä¸ºç¡®ä¿èƒ½å…¨å±€è°ƒç”¨mysqlå‘½ä»¤ï¼Œéœ€å°†MySQL 5.7çš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼ˆä»¥zshç»ˆç«¯ä¸ºä¾‹ï¼Œè‹¥ä½¿ç”¨bashåˆ™ä¿®æ”¹~/.bashrcæ–‡ä»¶ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">'export PATH="/opt/homebrew/opt/mysql@5.7/bin:$PATH"'</span> &gt;&gt; ~/.zshrc
</code></pre>
<p>æ‰§è¡Œå®Œæˆåï¼Œå¯é‡å¯ç»ˆç«¯ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆï¼Œæˆ–æ‰§è¡Œ<code>source ~/.zshrc</code>å‘½ä»¤ç«‹å³åŠ è½½é…ç½®ã€‚</p>
<h3 data-id="heading-4">3. ä¿®æ”¹é…ç½®æ–‡ä»¶</h3>
<p>ç¼–è¾‘MySQLé…ç½®æ–‡ä»¶ï¼Œå…è®¸å¤–éƒ¨IPè¿æ¥ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">vi /opt/homebrew/etc/my.cnf
</code></pre>
<p>åœ¨[mysqld]èŠ‚ç‚¹ä¸‹æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mysqld]</span>
<span class="hljs-attr">bind-address</span> = <span class="hljs-number">0.0</span>.<span class="hljs-number">0.0</span>  <span class="hljs-comment"># å…è®¸ä»»ä½• IP è¿æ¥ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šç‰¹å®šçš„å±€åŸŸç½‘ IP</span>
</code></pre>
<h3 data-id="heading-5">4. æˆæƒrootç”¨æˆ·å¤–éƒ¨è®¿é—®</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. æˆæƒ root ç”¨æˆ· å…è®¸ã€ä»»ä½•æ¥æºã€‘è®¿é—®ï¼ˆåŒ…æ‹¬æ‰€æœ‰Dockerå®¹å™¨ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'%'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'Astack@123'</span>;
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'%'</span> <span class="hljs-keyword">WITH</span> <span class="hljs-keyword">GRANT</span> OPTION;
â€‹
<span class="hljs-comment">-- 2. åˆ·æ–°æƒé™ï¼Œç«‹å³ç”Ÿæ•ˆ</span>
FLUSH PRIVILEGES;
â€‹
<span class="hljs-comment">-- 3. éªŒè¯æˆæƒæ˜¯å¦æˆåŠŸï¼ˆæ‰§è¡Œåèƒ½çœ‹åˆ° root@% å°±æ˜¯æˆåŠŸï¼‰</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>, host <span class="hljs-keyword">FROM</span> mysql.user <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">user</span><span class="hljs-operator">=</span><span class="hljs-string">'root'</span>;
</code></pre>
<h3 data-id="heading-6">5. é‡å¯MySQLæœåŠ¡</h3>
<p>é…ç½®ä¿®æ”¹åéœ€é‡å¯æœåŠ¡æ‰èƒ½ç”Ÿæ•ˆï¼š</p>
<pre><code class="hljs language-css" lang="css">brew services restart mysql<span class="hljs-keyword">@5</span>.7
â€‹
</code></pre>
<h3 data-id="heading-7">6. æµ‹è¯•è¿æ¥</h3>
<p>é€šè¿‡å·¥å…·æˆ–å‘½ä»¤è¡Œæµ‹è¯•MySQLè¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œè¿æ¥æˆåŠŸç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee36b61595c243d8bb189cd08e36ed27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yip5YWE55qE6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141738&amp;x-signature=2R3vxrL4ZtcTwHdS2YDjqA5ikFU%3D" alt="image-20260104082157873" loading="lazy"/></p>
<h2 data-id="heading-8">äºŒã€å®‰è£…redis</h2>
<h3 data-id="heading-9">1. æ‰§è¡Œå®‰è£…å‘½ä»¤</h3>
<p>åœ¨ç»ˆç«¯è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œé€šè¿‡brewå®‰è£…æœ€æ–°ç‰ˆRedisï¼š</p>
<pre><code class="hljs">brew install redis
</code></pre>
<p>å®‰è£…è¿‡ç¨‹ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bd7514e95b740e69e74bda5c9a0f4a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yip5YWE55qE6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141738&amp;x-signature=qfn474t0WySv%2BpNjSyI98xIqsG8%3D" alt="image-20260104080733795" loading="lazy"/></p>
<h3 data-id="heading-10">2. ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆå…è®¸å±€åŸŸç½‘è®¿é—®ï¼‰</h3>
<p>ç¼–è¾‘Redisé…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹ç»‘å®šIPä¸º0.0.0.0ï¼Œå…è®¸å±€åŸŸç½‘å†…è®¾å¤‡è®¿é—®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">vi /opt/homebrew/etc/redis.cnf
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cf2b7df21194d15ae2cdc29fbe09406~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yip5YWE55qE6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141738&amp;x-signature=QgcS9II1kNUpIRmfyMsPEXM4jRE%3D" alt="image-20260104082012660" loading="lazy"/></p>
<p>æ‰¾åˆ°bindé…ç½®é¡¹ï¼Œä¿®æ”¹ä¸ºå¦‚ä¸‹å†…å®¹ï¼ˆåŸé…ç½®å¯èƒ½ä¸º127.0.0.1ï¼Œä»…å…è®¸æœ¬åœ°è®¿é—®ï¼‰ï¼š</p>
<h3 data-id="heading-11">3. å¯åŠ¨RedisæœåŠ¡</h3>
<p>é…ç½®ä¿®æ”¹åï¼Œé‡å¯RedisæœåŠ¡ä½¿è®¾ç½®ç”Ÿæ•ˆï¼š</p>
<pre><code class="hljs">brew services restart redis
</code></pre>
<h3 data-id="heading-12">4. æµ‹è¯•è¿æ¥</h3>
<p>é€šè¿‡Rediså®¢æˆ·ç«¯å·¥å…·æˆ–å‘½ä»¤è¡Œæµ‹è¯•è¿æ¥ï¼Œè¿æ¥æˆåŠŸç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21fb6e5be1f447c4bd5070b272e75b8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yip5YWE55qE6KeG55WM:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768141738&amp;x-signature=H2RsOv%2Bx3iMC85etFkoMD9WjBJI%3D" alt="image-20260104082520075" loading="lazy"/></p>
<h2 data-id="heading-13">æ³¨æ„äº‹é¡¹</h2>
<ul>
<li>æœ¬æ–‡æ“ä½œåŸºäºmacOSï¼ˆApple SiliconèŠ¯ç‰‡ï¼‰ï¼ŒIntelèŠ¯ç‰‡macçš„brewå®‰è£…è·¯å¾„å¯èƒ½ä¸º/usr/local/ï¼Œéœ€å¯¹åº”è°ƒæ•´é…ç½®æ–‡ä»¶è·¯å¾„ã€‚</li>
<li>MySQLå¯†ç ï¼ˆAstack@123ï¼‰å¯æ ¹æ®éœ€æ±‚ä¿®æ”¹ï¼Œå»ºè®®è®¾ç½®å¤æ‚å¯†ç æå‡å®‰å…¨æ€§ã€‚</li>
<li>è‹¥ä»…éœ€æœ¬åœ°è®¿é—®ï¼Œæ— éœ€ä¿®æ”¹bind-addressé…ç½®ï¼Œä¿æŒé»˜è®¤æœ¬åœ°ç»‘å®šå³å¯ã€‚</li>
<li>brew serviceså‘½ä»¤å¯ç®¡ç†æœåŠ¡å¯åœï¼Œå¸¸ç”¨å‘½ä»¤ï¼š<code>brew services start/stop/restart æœåŠ¡å</code>ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025ï¼Œæˆ‘çš„"Vibe Coding"æ—¶åˆ»ï¼šAIå¦‚ä½•é‡å¡‘æˆ‘çš„å¼€å‘æ•ˆç‡ä¸æŠ€æœ¯æˆé•¿]]></title>    <link>https://juejin.cn/post/7591309945510035456</link>    <guid>https://juejin.cn/post/7591309945510035456</guid>    <pubDate>2026-01-04T09:57:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591309945510035456" data-draft-id="7591013450526408756" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025ï¼Œæˆ‘çš„&quot;Vibe Coding&quot;æ—¶åˆ»ï¼šAIå¦‚ä½•é‡å¡‘æˆ‘çš„å¼€å‘æ•ˆç‡ä¸æŠ€æœ¯æˆé•¿"/> <meta itemprop="keywords" content="åç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-04T09:57:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å–·ç«é¾™8å·"/> <meta itemprop="url" content="https://juejin.cn/user/1900436995711678"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025ï¼Œæˆ‘çš„"Vibe Coding"æ—¶åˆ»ï¼šAIå¦‚ä½•é‡å¡‘æˆ‘çš„å¼€å‘æ•ˆç‡ä¸æŠ€æœ¯æˆé•¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1900436995711678/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å–·ç«é¾™8å·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T09:57:05.000Z" title="Sun Jan 04 2026 09:57:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>2025å¹´å¯¹æˆ‘æ¥è¯´æŒºç‰¹åˆ«çš„ã€‚3æœˆä»½å¼€å§‹è°ƒç ”ä¸€ä¸ª Go å¾®æœåŠ¡é¡¹ç›®çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œ7æœˆæ­£å¼å†™ä»£ç ï¼Œ10æœˆä¸­æ—¬ç³»ç»Ÿä¸Šçº¿ï¼Œ11æœˆä¸­æ—¬ç¬¬ä¸€ä¸ªç‰ˆæœ¬å°ç‰ˆã€‚8ä¸ªæœˆæ—¶é—´ï¼ŒæŠŠä¸€ä¸ªå¾®æœåŠ¡é¡¹ç›®ä»é›¶åˆ°ä¸€åšå®Œäº†ã€‚</p>
<p>è¿™ä¸ªé¡¹ç›®æˆäº†æˆ‘æ¢ç´¢ AI è¾…åŠ©å¼€å‘çš„è¯•éªŒåœºã€‚æ•´ä¸ªå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘å°è¯•äº†å„ç§ AI ç¼–ç¨‹åŠ©æ‰‹å’Œå¯¹è¯å·¥å…·ï¼Œæµè§ˆå™¨é‡Œæ°¸è¿œå¼€ç€å‡ ä¸ª AI Chat æ ‡ç­¾é¡µã€‚è¿™ç§å¼€å‘æ–¹å¼ç¡®å®è®©æˆ‘æ•ˆç‡æå‡ä¸å°‘ï¼Œä¹Ÿè®©æˆ‘çªç ´äº†ä¸€äº›ä¹‹å‰è§‰å¾—åšä¸åˆ°çš„äº‹æƒ…ã€‚</p>
<p>ä»Šå¤©æƒ³èŠèŠè¿™ä¸€å¹´ AI æ€ä¹ˆæ”¹å˜äº†æˆ‘çš„å¼€å‘æ–¹å¼ï¼Œé¡ºä¾¿åˆ†äº«ä¸€äº›æŠ€æœ¯å®è·µä¸­çš„å¹²è´§ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€é¡¹ç›®èƒŒæ™¯ä¸æŠ€æœ¯é€‰å‹</h2>
<p>è¿™ä¸ª Go å¾®æœåŠ¡é¡¹ç›®ç”¨äº† CloudWeGo ç”Ÿæ€ï¼šKitex åš RPC æ¡†æ¶ï¼ŒHertz åš HTTP ç½‘å…³ï¼ŒThrift å®šä¹‰æ¥å£ï¼ŒPostgreSQL å­˜æ•°æ®ï¼ŒGoogle Wire åšä¾èµ–æ³¨å…¥ã€‚</p>
<p>è¯´å®è¯ï¼Œåˆšå¼€å§‹å‹åŠ›æŒºå¤§çš„ï¼š</p>
<ul>
<li>CloudWeGo ç”Ÿæ€çš„æ¡†æ¶éƒ½ä¸ç†Ÿï¼Œå¾—ä»å¤´å­¦</li>
<li>å¾®æœåŠ¡æ¶æ„çš„å¤æ‚è®¾è®¡æ¨¡å¼è¦ç†è§£å¹¶å®è·µ</li>
<li>ä»£ç è´¨é‡å’Œç³»ç»Ÿç¨³å®šæ€§éƒ½å¾—ä¿è¯</li>
<li>æ—¶é—´è¿˜ç‰¹åˆ«ç´§ï¼Œä»è°ƒç ”åˆ°ä¸Šçº¿å°±å‡ ä¸ªæœˆ</li>
</ul>
<p>è¿™æ—¶å€™ AI æˆäº†æˆ‘çš„"å¤–è„‘"ã€‚</p>
<hr/>
<h2 data-id="heading-2">äºŒã€AI å¦‚ä½•æ”¹å˜äº†æˆ‘çš„å­¦ä¹ æ–¹å¼</h2>
<h3 data-id="heading-3">2.1 å­¦æ–°æ¡†æ¶çš„æ•ˆç‡æå‡</h3>
<p>ä»¥å‰å­¦æ–°æ¡†æ¶ï¼Œå¾—çœ‹ä¸€å †å®˜æ–¹æ–‡æ¡£ã€æ•™ç¨‹æ–‡ç« ï¼Œè¿˜å¾—è·‘ç¤ºä¾‹ä»£ç ã€‚æœ‰äº† AI ä¹‹åï¼Œè¿™ä¸ªè¿‡ç¨‹å¿«äº†å¾ˆå¤šã€‚</p>
<p>æ¯”å¦‚å­¦ Kitex çš„æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼Œæˆ‘ç›´æ¥é—® AIï¼Œå®ƒå°±èƒ½ç»™å‡ºä»£ç ç¤ºä¾‹å’Œé…ç½®è¯´æ˜ï¼Œè¿˜ä¼šæé†’å“ªäº›åœ°æ–¹å®¹æ˜“è¸©å‘ã€‚å‡ å°æ—¶å°±èƒ½ç†è§£ä»¥å‰éœ€è¦å‡ å¤©æ‰èƒ½ææ‡‚çš„ä¸œè¥¿ã€‚</p>
<p>ä¸¾ä¸ªå®é™…ä¾‹å­ï¼Œæˆ‘é—® AI æ€ä¹ˆåœ¨ Kitex ä¸­å¤„ç†ä¸šåŠ¡é”™è¯¯ï¼Œå®ƒå‘Šè¯‰æˆ‘è¦ç”¨ <code>BizStatusError</code>ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// å®šä¹‰é”™è¯¯ç </span>
<span class="hljs-keyword">type</span> ErrNo <span class="hljs-keyword">struct</span> {
    Code <span class="hljs-type">int32</span>
    Msg  <span class="hljs-type">string</span>
}

<span class="hljs-keyword">var</span> (
    ErrUserNotFound    = &amp;ErrNo{Code: <span class="hljs-number">100001</span>, Msg: <span class="hljs-string">"ç”¨æˆ·ä¸å­˜åœ¨"</span>}
    ErrInvalidPassword = &amp;ErrNo{Code: <span class="hljs-number">100002</span>, Msg: <span class="hljs-string">"å¯†ç é”™è¯¯"</span>}
)

<span class="hljs-comment">// è½¬æ¢ä¸º Kitex å¯è¯†åˆ«çš„é”™è¯¯</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ToKitexError</span><span class="hljs-params">(err *ErrNo)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-keyword">return</span> kerrors.NewBizStatusError(err.Code, err.Msg)
}
</code></pre>
<p>æ›´å…³é”®çš„æ˜¯ï¼ŒAI è¿˜æé†’æˆ‘å¿…é¡»é…ç½® TTHeader MetaHandlerï¼Œå¦åˆ™é”™è¯¯ä¿¡æ¯ä¼ ä¸è¿‡å»ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// å®¢æˆ·ç«¯é…ç½®</span>
client.WithMetaHandler(transmeta.ClientTTHeaderHandler)

<span class="hljs-comment">// æœåŠ¡ç«¯é…ç½®</span>
server.WithMetaHandler(transmeta.ServerTTHeaderHandler)
</code></pre>
<p>è¿™ä¸ªå‘å¦‚æœé è‡ªå·±æ‘¸ç´¢ï¼Œå¯èƒ½è¦è¸©å¥½å‡ å¤©ã€‚</p>
<h3 data-id="heading-4">2.2 æ¶æ„è®¾è®¡çš„æ€è·¯æ‹“å±•</h3>
<p>é¡¹ç›®é‡‡ç”¨äº†æ˜Ÿå‹æ‹“æ‰‘çš„å¾®æœåŠ¡æ¶æ„ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Client    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ HTTP
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                    â”‚   Gateway   â”‚  (Hertz)
                    â”‚   :<span class="hljs-number">8080</span>     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ Thrift RPC
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚               â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ <span class="hljs-keyword">Identity</span>    â”‚ â”‚   <span class="hljs-keyword">User</span>      â”‚ â”‚   <span class="hljs-keyword">Order</span>     â”‚
    â”‚ Service     â”‚ â”‚   Service   â”‚ â”‚   Service   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p>è¿™ä¸ªæ¶æ„æ˜¯æˆ‘å’Œ AI åå¤è®¨è®ºåç¡®å®šçš„ã€‚æˆ‘æŠŠä¸šåŠ¡éœ€æ±‚æè¿°ç»™ AIï¼Œå®ƒç»™å‡ºäº†å‡ ç§æ‹“æ‰‘æ–¹æ¡ˆçš„å¯¹æ¯”åˆ†æï¼Œæœ€ç»ˆæˆ‘é€‰æ‹©äº†æ˜Ÿå‹æ‹“æ‰‘ï¼š</p>
<ul>
<li>ç½‘å…³æ˜¯å”¯ä¸€å…¥å£ï¼Œæ‰€æœ‰é‰´æƒåœ¨ç½‘å…³å±‚å®Œæˆ</li>
<li>RPC æœåŠ¡ä¹‹é—´ä¸äº’ç›¸è°ƒç”¨ï¼Œé¿å…å¾ªç¯ä¾èµ–</li>
<li>è°ƒè¯•ç®€å•ã€é“¾è·¯æ¸…æ™°ã€å®¹æ˜“æ‰©å±•</li>
</ul>
<p>AI ä¸æ˜¯æ›¿æˆ‘åšå†³ç­–ï¼Œè€Œæ˜¯å¸®æˆ‘ç†æ¸…æ€è·¯ï¼Œè®©æˆ‘èƒ½æ›´å¿«åœ°åšå‡ºåˆ¤æ–­ã€‚</p>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€AI è¾…åŠ©ç¼–ç çš„å®é™…ä½“éªŒ</h2>
<h3 data-id="heading-6">3.1 å¿«é€ŸåŸå‹éªŒè¯</h3>
<p>è¦å®ç°æ–°åŠŸèƒ½æ—¶ï¼Œæˆ‘å…ˆè®© AI ç”Ÿæˆä¸€ä¸ªåŸºç¡€ä»£ç æ¡†æ¶ï¼Œç„¶åæŒ‰é¡¹ç›®è§„èŒƒè°ƒæ•´ä¼˜åŒ–ã€‚</p>
<p>æ¯”å¦‚ RPC æœåŠ¡çš„åˆ†å±‚æ¶æ„ï¼ŒAI å¸®æˆ‘ç”Ÿæˆäº†åŸºç¡€æ¨¡æ¿ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// Handler å±‚ï¼šå‚æ•°æ ¡éªŒ + è°ƒç”¨ä¸šåŠ¡é€»è¾‘</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *IdentityServiceImpl)</span></span> Login(ctx context.Context, req *identity.LoginRequest) (*identity.LoginResponse, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">if</span> err := validateLoginRequest(req); err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errno.ToKitexError(errno.ErrInvalidParam)
    }
    <span class="hljs-keyword">return</span> s.logic.Login(ctx, req)
}

<span class="hljs-comment">// Logic å±‚ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(l *AuthLogic)</span></span> Login(ctx context.Context, req *identity.LoginRequest) (*identity.LoginResponse, <span class="hljs-type">error</span>) {
    user, err := l.dal.GetUserByEmail(ctx, req.Email)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-keyword">if</span> !l.verifyPassword(req.Password, user.PasswordHash) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errno.ErrInvalidCredentials
    }
    token, err := l.generateToken(user)
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// DAL å±‚ï¼šæ•°æ®è®¿é—®</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *UserDAL)</span></span> GetUserByEmail(ctx context.Context, email <span class="hljs-type">string</span>) (*models.User, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">var</span> user models.User
    err := d.db.WithContext(ctx).Where(<span class="hljs-string">"email = ?"</span>, email).First(&amp;user).Error
    <span class="hljs-keyword">if</span> errors.Is(err, gorm.ErrRecordNotFound) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, errno.ErrUserNotFound
    }
    <span class="hljs-keyword">return</span> &amp;user, err
}
</code></pre>
<p>è¿™ä¸ªæ¨¡æ¿æˆ‘æ‹¿æ¥ç¨ä½œä¿®æ”¹å°±èƒ½ç”¨ï¼Œçœäº†ä¸å°‘é‡å¤å·¥ä½œã€‚</p>
<h3 data-id="heading-7">3.2 é‡æ„å»ºè®®</h3>
<p>é¡¹ç›®ä¸­æœŸé‡æ„æ—©æœŸä»£ç æ—¶ï¼ŒAI èƒ½è¯†åˆ«å‡ºé—®é¢˜ï¼Œç»™å‡ºé‡æ„å»ºè®®ã€‚</p>
<p>æ¯”å¦‚å®ƒå‘ç°æˆ‘çš„ä»£ç é‡Œæœ‰å¤§é‡ N+1 æŸ¥è¯¢é—®é¢˜ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// AI æŒ‡å‡ºçš„é—®é¢˜ä»£ç </span>
<span class="hljs-keyword">for</span> _, userID := <span class="hljs-keyword">range</span> userIDs {
    user, _ := dal.GetUserByID(ctx, userID)
    users = <span class="hljs-built_in">append</span>(users, user)
}

<span class="hljs-comment">// AI å»ºè®®çš„ä¼˜åŒ–æ–¹æ¡ˆ</span>
users, _ := dal.GetUsersByIDs(ctx, userIDs)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d *UserDAL)</span></span> GetUsersByIDs(ctx context.Context, ids []<span class="hljs-type">int64</span>) ([]*models.User, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">var</span> users []*models.User
    err := d.db.WithContext(ctx).Where(<span class="hljs-string">"id IN ?"</span>, ids).Find(&amp;users).Error
    <span class="hljs-keyword">return</span> users, err
}
</code></pre>
<p>è¿˜æœ‰ DTO å’Œ Model ä¹‹é—´çš„è½¬æ¢ä»£ç é‡å¤ç‡å¾ˆé«˜ï¼ŒAI å»ºè®®æˆ‘æŠ½è±¡æˆé€šç”¨å·¥å…·ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// é€šç”¨æŒ‡é’ˆè½¬æ¢</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">PtrToValue</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>]<span class="hljs-params">(ptr *T, defaultVal T)</span></span> T {
    <span class="hljs-keyword">if</span> ptr == <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> defaultVal
    }
    <span class="hljs-keyword">return</span> *ptr
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ValueToPtr</span>[<span class="hljs-title">T</span> <span class="hljs-title">any</span>]<span class="hljs-params">(val T)</span></span> *T {
    <span class="hljs-keyword">return</span> &amp;val
}
</code></pre>
<p>è¿™ä¸ªå·¥å…·åº“åæ¥æˆäº†é¡¹ç›®é‡Œå¹¿æ³›ä½¿ç”¨çš„åŸºç¡€è®¾æ–½ã€‚</p>
<h3 data-id="heading-8">3.3 è¸©å‘æ—¶çš„æ•‘å‘½ç¨»è‰</h3>
<p>ç”¨ Docker éƒ¨ç½²æ—¶é‡åˆ°ä¸€ä¸ªè¯¡å¼‚é—®é¢˜ï¼šæœåŠ¡ä¹‹é—´èƒ½é€šä¿¡ï¼Œä½†ç”Ÿæˆçš„é¢„ç­¾å URL å®¢æˆ·ç«¯è®¿é—®ä¸äº†ã€‚</p>
<p>æˆ‘æŠŠé—®é¢˜æè¿°ç»™ AIï¼Œå®ƒå¾ˆå¿«å®šä½åˆ°åŸå› ï¼šå¯¹è±¡å­˜å‚¨åœ¨å®¹å™¨å†…éƒ¨ç”¨çš„æ˜¯å†…éƒ¨åŸŸåï¼Œç”Ÿæˆçš„ URL å¸¦çš„ä¹Ÿæ˜¯å†…éƒ¨åŸŸåï¼Œå¤–éƒ¨è‡ªç„¶è®¿é—®ä¸äº†ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆæ˜¯åŒç«¯ç‚¹é…ç½®ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">type</span> StorageConfig <span class="hljs-keyword">struct</span> {
    Endpoint       <span class="hljs-type">string</span>  <span class="hljs-comment">// å†…éƒ¨ç«¯ç‚¹ï¼Œå®¹å™¨é—´é€šä¿¡ç”¨</span>
    PublicEndpoint <span class="hljs-type">string</span>  <span class="hljs-comment">// å…¬å…±ç«¯ç‚¹ï¼Œç”Ÿæˆé¢„ç­¾å URL ç”¨</span>
}
</code></pre>
<p>è¿™ç§é—®é¢˜å¦‚æœé è‡ªå·±æ’æŸ¥ï¼Œå¯èƒ½è¦èŠ±åŠå¤©ç”šè‡³æ›´ä¹…ã€‚</p>
<hr/>
<h2 data-id="heading-9">å››ã€AI è¾…åŠ©çš„è¾¹ç•Œä¸å±€é™</h2>
<p>ç”¨äº†ä¸€å¹´ AI è¾…åŠ©å¼€å‘ï¼Œæˆ‘ä¹Ÿå‘ç°äº†å®ƒçš„å±€é™æ€§ã€‚</p>
<h3 data-id="heading-10">4.1 ä¸èƒ½å®Œå…¨ç†è§£ä¸šåŠ¡ä¸Šä¸‹æ–‡</h3>
<p>AI ç”Ÿæˆçš„ä»£ç ç»å¸¸éœ€è¦æ ¹æ®é¡¹ç›®å®é™…æƒ…å†µè°ƒæ•´ã€‚æ¯”å¦‚ Wire ä¾èµ–æ³¨å…¥ï¼ŒAI ç»™çš„ç¤ºä¾‹æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// AI ç”Ÿæˆçš„ç¤ºä¾‹ï¼ˆæœ‰é—®é¢˜ï¼‰</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUserDAL</span><span class="hljs-params">()</span></span> (*UserDAL, <span class="hljs-type">error</span>) {
    db, err := gorm.Open(postgres.Open(dsn), &amp;gorm.Config{})
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }
    <span class="hljs-keyword">return</span> &amp;UserDAL{db: db}, <span class="hljs-literal">nil</span>
}
</code></pre>
<p>é—®é¢˜åœ¨äºæ¯ä¸ª DAL éƒ½ä¼šåˆ›å»ºæ–°çš„æ•°æ®åº“è¿æ¥ï¼Œè¿æ¥æ± æ ¹æœ¬æ²¡ç”¨ä¸Šã€‚æ­£ç¡®åšæ³•æ˜¯æ•°æ®åº“åˆå§‹åŒ–æ”¾åˆ° config å±‚ï¼š</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// æ­£ç¡®å†™æ³•</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewDatabase</span><span class="hljs-params">(cfg *Config)</span></span> (*gorm.DB, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span>, <span class="hljs-type">error</span>) {
    db, err := gorm.Open(postgres.Open(cfg.DSN), &amp;gorm.Config{})
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, <span class="hljs-literal">nil</span>, err
    }
    cleanup := <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        sqlDB, _ := db.DB()
        sqlDB.Close()
    }
    <span class="hljs-keyword">return</span> db, cleanup, <span class="hljs-literal">nil</span>
}

<span class="hljs-keyword">var</span> ProviderSet = wire.NewSet(
    config.NewDatabase,
    dal.NewUserDAL,    <span class="hljs-comment">// æ¥æ”¶ *gorm.DB ä½œä¸ºå‚æ•°</span>
    <span class="hljs-comment">// ...</span>
)
</code></pre>
<h3 data-id="heading-11">4.2 éœ€è¦ä¸¥æ ¼å®¡æŸ¥å’Œæµ‹è¯•</h3>
<p>AI ç”Ÿæˆçš„ä»£ç ä¸èƒ½ç›´æ¥ç”¨ï¼Œå¿…é¡»å®¡æŸ¥ã€‚æˆ‘ä¼šè®© AI å¸®å¿™æ£€æŸ¥ï¼š</p>
<ul>
<li>é”™è¯¯å¤„ç†æœ‰æ²¡æœ‰é—æ¼</li>
<li>æœ‰æ²¡æœ‰å¹¶å‘å®‰å…¨é—®é¢˜</li>
<li>ä»£ç é£æ ¼ç¬¦ä¸ç¬¦åˆè§„èŒƒ</li>
<li>æœ‰æ²¡æœ‰æ€§èƒ½ä¼˜åŒ–çš„ç©ºé—´</li>
</ul>
<p>ç„¶åå†å†™æµ‹è¯•éªŒè¯ã€‚AI èƒ½æ ¹æ®ä»£ç é€»è¾‘è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ï¼Œè¦†ç›–å„ç§è¾¹ç•Œæƒ…å†µï¼Œè¿™ä¸ªåŠŸèƒ½æˆ‘ç”¨å¾—å¾ˆå¤šã€‚</p>
<hr/>
<h2 data-id="heading-12">äº”ã€æ„å¤–çš„æ”¶è·ï¼šä»ä½¿ç”¨è€…åˆ°è´¡çŒ®è€…</h2>
<p>å­¦ä¹  CloudWeGo ç”Ÿæ€æ—¶ï¼Œæˆ‘å‘ç°äº†ä¸€äº›å¯ä»¥æ”¹è¿›çš„åœ°æ–¹ã€‚ä»¥å‰å¯èƒ½å°±ç®—äº†ï¼Œä½†æœ‰äº† AI å¸®å¿™ç†è§£æºç å’Œå†™ PRï¼Œæˆ‘çœŸçš„å»æäº¤äº†æ”¹è¿›å»ºè®®ã€‚</p>
<p><strong>ç¤¾åŒºè´¡çŒ®</strong>ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhertz-contrib%2Fobs-opentelemetry%2Fissues%2F66" target="_blank" title="https://github.com/hertz-contrib/obs-opentelemetry/issues/66" ref="nofollow noopener noreferrer">obs-opentelemetry #66</a>ï¼šå…³äº OpenTelemetry é›†æˆçš„é—®é¢˜è®¨è®º</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhertz-contrib%2Fjwt%2Fissues%2F26" target="_blank" title="https://github.com/hertz-contrib/jwt/issues/26" ref="nofollow noopener noreferrer">jwt #26</a>ï¼šJWT ä¸­é—´ä»¶çš„æ”¹è¿›å»ºè®®</li>
</ul>
<p>ä»"ä½¿ç”¨è€…"å˜æˆ"è´¡çŒ®è€…"ï¼Œè¿™æ˜¯æˆ‘ä¹‹å‰æ²¡æƒ³è¿‡çš„äº‹æƒ…ã€‚AI é™ä½äº†å‚ä¸å¼€æºçš„é—¨æ§›ã€‚</p>
<p><strong>å¼€æºæ•™ç¨‹é¡¹ç›®</strong>ï¼š</p>
<p>æˆ‘æŠŠé¡¹ç›®ä¸­çš„ç»éªŒæ•´ç†æˆäº†ä¸€ä¸ªå¼€æºé¡¹ç›® <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmasonsxu%2Fcloudwego-microservice-demo" target="_blank" title="https://github.com/masonsxu/cloudwego-microservice-demo" ref="nofollow noopener noreferrer">cloudwego-microservice-demo</a>ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li>å®Œæ•´çš„é¡¹ç›®ç»“æ„</li>
<li>Wire ä¾èµ–æ³¨å…¥ç¤ºä¾‹</li>
<li>é”™è¯¯å¤„ç†æœ€ä½³å®è·µ</li>
<li>Docker éƒ¨ç½²é…ç½®</li>
</ul>
<p>AI åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¸®æˆ‘æ¢³ç†çŸ¥è¯†ç‚¹ã€ä¼˜åŒ–æ–‡æ¡£ç»“æ„ã€ç”Ÿæˆç¤ºä¾‹ä»£ç ã€‚</p>
<hr/>
<h2 data-id="heading-13">å…­ã€ä¸€äº›æ€è€ƒ</h2>
<h3 data-id="heading-14">6.1 AI æ˜¯æ”¾å¤§å™¨ï¼Œä¸æ˜¯æ›¿ä»£å“</h3>
<p>è¿™ä¸€å¹´ä¸‹æ¥ï¼Œæˆ‘æœ€æ·±çš„ä½“ä¼šæ˜¯ï¼šAI ä¸æ˜¯è¦æ›¿ä»£å¼€å‘è€…ï¼Œè€Œæ˜¯æ”¾å¤§å¼€å‘è€…çš„èƒ½åŠ›ã€‚</p>
<p>å®ƒèƒ½å¤„ç†é‡å¤æ€§å·¥ä½œï¼Œè®©æˆ‘ä¸“æ³¨åœ¨æ›´æœ‰ä»·å€¼çš„åˆ›é€ æ€§å·¥ä½œä¸Šã€‚åŒæ—¶æä¾›å³æ—¶çš„çŸ¥è¯†æ”¯æŒï¼Œå¤§å¤§é™ä½äº†æŠ€æœ¯å­¦ä¹ çš„é—¨æ§›ã€‚</p>
<p>ä½†å†³ç­–è¿˜æ˜¯å¾—è‡ªå·±åšï¼Œä»£ç è¿˜æ˜¯å¾—è‡ªå·±å®¡ï¼Œæ¶æ„è¿˜æ˜¯å¾—è‡ªå·±æŠŠæ§ã€‚</p>
<h3 data-id="heading-15">6.2 å½¢æˆè‡ªå·±çš„å·¥ä½œæµ</h3>
<p>æˆ‘ç°åœ¨çš„å·¥ä½œæµå¤§æ¦‚æ˜¯ï¼š</p>
<ol>
<li>é‡åˆ°æ–°æŠ€æœ¯/æ–°éœ€æ±‚ï¼Œå…ˆé—® AI äº†è§£æ¦‚å¿µå’Œæœ€ä½³å®è·µ</li>
<li>è®© AI ç”Ÿæˆä»£ç æ¡†æ¶ï¼Œè‡ªå·±è°ƒæ•´ç»†èŠ‚</li>
<li>æäº¤å‰è®© AI åš code review</li>
<li>é‡åˆ° bug æ—¶æè¿°é—®é¢˜ï¼Œè®© AI å¸®å¿™åˆ†æ</li>
<li>å†™æ–‡æ¡£æ—¶è®© AI å¸®å¿™æ¢³ç†ç»“æ„</li>
</ol>
<p>è¿™ç§"äººæœºåä½œ"çš„æ¨¡å¼ï¼Œè®©æˆ‘çš„æ•ˆç‡æå‡äº†ä¸å°‘ã€‚</p>
<hr/>
<h2 data-id="heading-16">ä¸ƒã€æ€»ç»“</h2>
<p>å›é¡¾è¿™ä¸€å¹´ï¼ŒAI å·¥å…·ç¡®å®ç»™æˆ‘çš„å¼€å‘å·¥ä½œå¸¦æ¥äº†å¾ˆå¤§å˜åŒ–ï¼š</p>
<p><strong>æ•ˆç‡æå‡</strong>ï¼š</p>
<ul>
<li>å­¦æ–°æ¡†æ¶çš„æ—¶é—´å¤§å¹…ç¼©çŸ­</li>
<li>é—®é¢˜æ’æŸ¥æ›´å¿«</li>
<li>é‡å¤æ€§ä»£ç å·¥ä½œå‡å°‘</li>
</ul>
<p><strong>èƒ½åŠ›çªç ´</strong>ï¼š</p>
<ul>
<li>æˆåŠŸå®Œæˆäº†å¤æ‚çš„å¾®æœåŠ¡æ¶æ„é¡¹ç›®</li>
<li>ä»"ä½¿ç”¨è€…"å˜æˆäº†"è´¡çŒ®è€…"</li>
<li>æŠ€æœ¯æ ˆæ‰©å±•äº†ä¸å°‘ï¼ˆGoã€CloudWeGoã€Dockerã€åˆ†å¸ƒå¼ç³»ç»Ÿï¼‰</li>
</ul>
<p><strong>æ€ç»´æ–¹å¼æ”¹å˜</strong>ï¼š</p>
<ul>
<li>é‡åˆ°é—®é¢˜å…ˆé—® AI æˆäº†ä¹ æƒ¯</li>
<li>çŸ¥è¯†è·å–å’Œé—®é¢˜è§£å†³æ›´é«˜æ•ˆ</li>
<li>æ•¢äºå°è¯•ä»¥å‰è§‰å¾—å¤ªéš¾çš„äº‹æƒ…</li>
</ul>
<p>æœ€é‡è¦çš„æ˜¯ï¼ŒAI è®©æˆ‘èƒ½çªç ´åŸæœ¬çš„èƒ½åŠ›ä¸Šé™ã€‚å®ƒä¸åªæ˜¯æé«˜äº†å·¥ä½œæ•ˆç‡ï¼Œè¿˜æ”¹å˜äº†æˆ‘çš„å­¦ä¹ æ–¹å¼å’Œæ€ç»´æ–¹å¼ã€‚</p>
<hr/>
<h2 data-id="heading-17">å†™åœ¨æœ€å</h2>
<p>å¦‚æœä½ è¿˜æ²¡è¯•è¿‡ AI è¾…åŠ©å¼€å‘ï¼Œå¯ä»¥ä»è¿™å‡ æ­¥å¼€å§‹ï¼š</p>
<ol>
<li>é€‰ä¸€ä¸ªé€‚åˆä½ çš„ AI ç¼–ç¨‹åŠ©æ‰‹</li>
<li>ä»ç®€å•çš„ä»£ç è¡¥å…¨å’Œé—®é¢˜å’¨è¯¢å¼€å§‹</li>
<li>é€æ­¥å°è¯•æ›´å¤æ‚çš„ä»»åŠ¡ï¼Œæ¯”å¦‚ä»£ç é‡æ„ã€æ¶æ„è®¾è®¡</li>
<li>å½¢æˆè‡ªå·±çš„ AI å·¥ä½œæµ</li>
<li>æŒç»­å­¦ä¹ å’Œä¼˜åŒ–ï¼Œæ‰¾åˆ°æœ€é€‚åˆä½ çš„æ–¹å¼</li>
</ol>
<p>è®°ä½ï¼ŒAI æ˜¯å·¥å…·ï¼Œä½ æ‰æ˜¯åˆ›é€ è€…ã€‚å–„ç”¨ AIï¼Œè®©å®ƒæˆä¸ºä½ æŠ€æœ¯æˆé•¿çš„åŠ é€Ÿå™¨ã€‚</p>
<p><strong>2025ï¼Œä¸€èµ·æ‹¥æŠ± Vibe Codingï¼</strong></p>
<hr/>
<p><em>å¦‚æœä½ åœ¨ Go å¾®æœåŠ¡å¼€å‘æˆ– AI è¾…åŠ©ç¼–ç¨‹æ–¹é¢æœ‰ä»€ä¹ˆæƒ³æ³•ï¼Œæ¬¢è¿è¯„è®ºåŒºäº¤æµï¼</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git æäº¤å†å²å¤ªä¹±ï¼Ÿæ•™ä½ æ¸…ç†å¹¶è§„èŒƒ commit message]]></title>    <link>https://juejin.cn/post/7591317772074418195</link>    <guid>https://juejin.cn/post/7591317772074418195</guid>    <pubDate>2026-01-04T13:02:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591317772074418195" data-draft-id="7591422577937924102" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git æäº¤å†å²å¤ªä¹±ï¼Ÿæ•™ä½ æ¸…ç†å¹¶è§„èŒƒ commit message"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2026-01-04T13:02:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BER_c"/> <meta itemprop="url" content="https://juejin.cn/user/2922947632702334"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git æäº¤å†å²å¤ªä¹±ï¼Ÿæ•™ä½ æ¸…ç†å¹¶è§„èŒƒ commit message
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2922947632702334/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BER_c
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T13:02:35.000Z" title="Sun Jan 04 2026 13:02:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨æ—¥å¸¸çš„ Git å¼€å‘åä½œä¸­ï¼Œä½ æ˜¯å¦é‡åˆ°è¿‡è¿™æ ·çš„æƒ…å†µï¼šåŠŸèƒ½åˆ†æ”¯ä¸Šåå¤æäº¤äº†å¤šä¸ªâ€œè¡¥ä¸å¼â€æäº¤ï¼ˆå¦‚â€œä¿®å¤ typoâ€ã€â€œå¿˜è®°æäº¤æ–‡ä»¶â€ï¼‰ï¼Œæœ€ç»ˆå¯¼è‡´æäº¤å†å²æ‚ä¹±æ— ç« ã€éš¾ä»¥è¿½æº¯ï¼Ÿè¿™ä¸ä»…è®© git log å¤±å»äº†åº”æœ‰çš„å¯è¯»æ€§ï¼Œä¹Ÿè®© Code Review å˜å¾—ä½æ•ˆä¸”ç—›è‹¦ã€‚</p>
<p>æœ¬æ–‡å°†ç³»ç»Ÿæ€§åœ°ä¸ºä½ æ¢³ç†å¦‚ä½•é€šè¿‡è§„èŒƒæäº¤ä¿¡æ¯ã€ä½¿ç”¨ rebaseã€merge --squashã€reset ç­‰å‘½ä»¤ï¼Œä»¥åŠå€ŸåŠ©è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå°†é›¶æ•£ã€ä¸è§„èŒƒçš„æäº¤å†å²æ•´ç†æˆæ¸…æ™°ã€é€»è¾‘å®Œæ•´ã€æ˜“äºå›æº¯çš„ç‰ˆæœ¬è®°å½•ã€‚æ— è®ºä½ æ˜¯åˆšæ¥è§¦ Git çš„æ–°æ‰‹ï¼Œè¿˜æ˜¯å¸Œæœ›æå‡å›¢é˜Ÿåä½œæ•ˆç‡çš„è€æ‰‹ï¼Œéƒ½èƒ½ä»ä¸­æ‰¾åˆ°å®ç”¨çš„è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µã€‚</p>
<h2 data-id="heading-0">ä¸€ã€æäº¤è§„èŒƒ</h2>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>(<span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>): <span class="hljs-tag">&lt;<span class="hljs-name">subject</span>&gt;</span>
</code></pre>
<ul>
<li>æ³¨æ„å†’å·ï¼ˆè‹±æ–‡ï¼‰ : åæœ‰ç©ºæ ¼</li>
</ul>
<p><strong>scopeé€‰å¡«</strong>è¡¨ç¤ºcommitçš„ä½œç”¨èŒƒå›´ï¼Œå¦‚æ•°æ®å±‚ã€è§†å›¾å±‚ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›®å½•åç§°Â </p>
<p><strong>subjectå¿…å¡«</strong>ç”¨äºå¯¹commitè¿›è¡Œç®€çŸ­çš„æè¿°Â </p>
<p><strong>typeå¿…å¡«</strong>è¡¨ç¤ºæäº¤ç±»å‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">feat - æ–°åŠŸèƒ½ feature
fix - ä¿®å¤ bug
docs - æ–‡æ¡£æ³¨é‡Š
style - ä»£ç æ ¼å¼(ä¸å½±å“ä»£ç è¿è¡Œçš„å˜åŠ¨)
refactor - é‡æ„ã€ä¼˜åŒ–(æ—¢ä¸å¢åŠ æ–°åŠŸèƒ½ï¼Œä¹Ÿä¸æ˜¯ä¿®å¤bug)
perf - æ€§èƒ½ä¼˜åŒ–
test - å¢åŠ æµ‹è¯•
chore - æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨
revert - å›é€€
build - æ‰“åŒ…
</code></pre>
<h2 data-id="heading-1">äºŒã€è§£å†³æäº¤ä¸å¹²å‡€ã€ä¸è§„èŒƒ</h2>
<p>åœ¨åŠŸèƒ½åˆ†æ”¯ä¸Šå¼€å‘æ—¶ï¼Œå¤šæ¬¡æäº¤ä¸­åŒ…å«â€œè¡¥ä¸å¼æäº¤â€ï¼ˆæ¯”å¦‚â€œå¿˜è®°æäº¤çš„æ–‡ä»¶â€ã€â€œä¿®å¤ä¸Šä¸€æ¬¡çš„ typoâ€ï¼‰ï¼Œå¯¼è‡´æäº¤å†å²ä¸å¹²å‡€ã€ä¸è§„èŒƒ</p>
<h3 data-id="heading-2">è§£å†³ç›®æ ‡ï¼š</h3>
<ul>
<li>åˆå¹¶å¤šä¸ªâ€œè¡¥ä¸å¼â€æäº¤ä¸ºä¸€ä¸ªé€»è¾‘å®Œæ•´çš„æäº¤ã€‚</li>
</ul>

<ul>
<li>é‡å‘½åæäº¤ä¿¡æ¯ï¼Œä½¿å…¶è§„èŒƒã€æ¸…æ™°ã€‚</li>
</ul>

<ul>
<li>æœ€ç»ˆæ¨é€åˆ°è¿œç¨‹åˆ†æ”¯æ—¶ï¼Œæäº¤å†å²å¹²å‡€ã€å¯è¯»ã€ä¾¿äº Code Review å’Œå›æº¯</li>
</ul>
<h3 data-id="heading-3">1. æ–¹æ¡ˆä¸€ï¼š</h3>
<h4 data-id="heading-4">1.1. æŸ¥çœ‹æäº¤å†å²</h4>
<pre><code class="hljs language-lua" lang="lua">git <span class="hljs-built_in">log</span> <span class="hljs-comment">--oneline</span>
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">dace4a8</span> <span class="hljs-string">(HEAD</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">testBase,</span> <span class="hljs-string">origin/testBase)</span> <span class="hljs-attr">feat:</span> <span class="hljs-string">å…¶ä»–æ¨¡å—æäº¤</span>
<span class="hljs-attr">635804e fix:</span> <span class="hljs-string">æ ·å¼ä¿®æ”¹</span>
<span class="hljs-attr">64e9d01 fix:</span> <span class="hljs-string">å»é™¤è°ƒè¯•ä»£ç </span>
<span class="hljs-attr">1aee000 fix:</span> <span class="hljs-string">ç¬¬ä¸€æ¬¡æäº¤çš„è¡¥ä¸</span>
<span class="hljs-attr">21b9b13 feat:</span> <span class="hljs-string">æµ‹è¯•å‡è®¾ä¸€æ¬¡å¤§çš„æäº¤</span>
<span class="hljs-attr">a1caa06 feat:</span> <span class="hljs-string">æ–°åˆ†æ”¯ç¬¬ä¸€æ¬¡æäº¤</span>
</code></pre>
<p>å‡è®¾æƒ³æŠŠ 21b9b13 å’Œä»–çš„è¡¥ä¸ä»£ç åˆå¹¶æˆä¸ºä¸€ä¸ªå®Œæ•´åŠŸèƒ½çš„æäº¤</p>
<h4 data-id="heading-5">1.2. å¯åŠ¨äº¤äº’å¼å˜åŸº</h4>
<p>è¿™é‡Œä» a1caa06 ä¹‹åå¼€å§‹</p>
<pre><code class="hljs language-css" lang="css">git rebase -<span class="hljs-selector-tag">i</span> a1caa06
</code></pre>
<p>ä¼šæ‰“å¼€ç¼–è¾‘å™¨ï¼Œç°å®å¦‚ä¸‹å†…å®¹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">pick 21b9b13 feat:</span> <span class="hljs-string">æµ‹è¯•å‡è®¾ä¸€æ¬¡å¤§çš„æäº¤</span>
<span class="hljs-attr">pick 1aee000 fix:</span> <span class="hljs-string">ç¬¬ä¸€æ¬¡æäº¤çš„è¡¥ä¸</span>
<span class="hljs-attr">pick 64e9d01 fix:</span> <span class="hljs-string">å»é™¤è°ƒè¯•ä»£ç </span>
<span class="hljs-attr">pick 635804e fix:</span> <span class="hljs-string">æ ·å¼ä¿®æ”¹</span>
<span class="hljs-attr">pick dace4a8 feat:</span> <span class="hljs-string">å…¶ä»–æ¨¡å—æäº¤</span>
</code></pre>
<h4 data-id="heading-6">1.3. ä¿®æ”¹æŒ‡ä»¤æ•´ç†æäº¤</h4>
<p>å½“æˆ‘ä»¬æƒ³æŠŠä¸‰ä¸ªfixåˆå¹¶åˆ° f7f0097 å½¢æˆä¸€ä¸ªå®Œæ•´çš„æäº¤ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æ”¹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">pick f7f0097 feat:</span> <span class="hljs-string">è¿™æ˜¯ä¸€æ¬¡å¤§çš„æ”¹åŠ¨</span>
<span class="hljs-attr">s 14f3ec6 fix:</span> <span class="hljs-string">å¯¹ä¸Šä¸€æ¬¡æäº¤çš„è¡¥ä¸</span>
<span class="hljs-attr">s 0cd3e04 fix:</span> <span class="hljs-string">å¿˜è®°å»æ‰è°ƒè¯•çš„ä»£ç äº†</span>
<span class="hljs-attr">s f9491c1 fix:</span> <span class="hljs-string">æ ·å¼ä¿®æ”¹</span>
<span class="hljs-attr">pick 0eab36a feat:</span> <span class="hljs-string">xxxéœ€æ±‚å¼€å‘å®Œæˆ</span>
</code></pre>
<blockquote>
<p><code>squash</code>ï¼ˆæˆ–ç®€å†™ <code>s</code>ï¼‰ï¼šå°†è¯¥æäº¤åˆå¹¶åˆ°ä¸Šä¸€ä¸ª <code>pick</code> çš„æäº¤ä¸­ï¼Œå¹¶è®©ä½ ç¼–è¾‘åˆå¹¶åçš„æäº¤ä¿¡æ¯ã€‚</p>
</blockquote>
<p>ä¿å­˜å¹¶å…³é—­ç¼–è¾‘å™¨</p>
<h4 data-id="heading-7">1.4. <strong>ç¼–è¾‘åˆå¹¶åçš„æäº¤ä¿¡æ¯</strong></h4>
<p>Git ä¼šå†æ¬¡æ‰“å¼€ç¼–è¾‘å™¨ï¼Œè®©ä½ ç¼–è¾‘åˆå¹¶åçš„æäº¤ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># This is a combination of 4 commits.</span>
<span class="hljs-comment"># This is the 1st commit message:</span>
<span class="hljs-section">feat: æµ‹è¯•å‡è®¾ä¸€æ¬¡å¤§çš„æäº¤</span>
<span class="hljs-comment"># This is the commit message #2:</span>
<span class="hljs-section">fix: ç¬¬ä¸€æ¬¡æäº¤çš„è¡¥ä¸</span>
<span class="hljs-comment"># This is the commit message #3:</span>
<span class="hljs-section">fix: å»é™¤è°ƒè¯•ä»£ç </span>
<span class="hljs-comment"># This is the commit message #4:</span>
<span class="hljs-section">fix: æ ·å¼ä¿®æ”¹</span>
<span class="hljs-comment"># Please enter the commit message for your changes. Lines starting</span>
<span class="hljs-comment"># with '#' will be ignored, and an empty message aborts the commit.</span>
<span class="hljs-comment">#</span>
<span class="hljs-section">feat: å®Œæ•´å®ç°XXXåŠŸèƒ½ï¼ˆå«xxã€xxã€xxï¼‰</span>
</code></pre>
<p>ä¿å­˜å…³é—­</p>
<h4 data-id="heading-8">1.5. <strong>å¼ºåˆ¶æ¨é€ï¼ˆæ³¨æ„ï¼šä»…é™æœªè¢«ä»–äººä½¿ç”¨çš„åˆ†æ”¯ï¼‰</strong></h4>
<pre><code class="hljs language-bash" lang="bash">git push origin feature/xxx --force-with-lease
</code></pre>
<blockquote>
<p>æ¨èä½¿ç”¨ <code>--force-with-lease</code> è€Œä¸æ˜¯ <code>--force</code>ï¼Œå®ƒæ›´å®‰å…¨ â€”â€” å¦‚æœåˆ«äººåœ¨ä½ ä¹‹åæ¨é€äº†ä»£ç ï¼Œä¼šæ‹’ç»å¼ºåˆ¶æ¨é€ï¼Œé¿å…è¦†ç›–ä»–äººå·¥ä½œ</p>
</blockquote>
<h4 data-id="heading-9">1.6. æ•´ç†æ•ˆæœ</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">c58c94a</span> <span class="hljs-string">(HEAD</span> <span class="hljs-string">-&gt;</span> <span class="hljs-string">testBase,</span> <span class="hljs-string">origin/testBase)</span> <span class="hljs-attr">feat:</span> <span class="hljs-string">å…¶ä»–æ¨¡å—æäº¤</span>
<span class="hljs-attr">ec9cfef feat:</span> <span class="hljs-string">æµ‹è¯•å‡è®¾ä¸€æ¬¡å¤§çš„æäº¤</span> <span class="hljs-string">//</span> <span class="hljs-string">å·²ç»è¢«åˆå¹¶</span>
<span class="hljs-attr">a1caa06 feat:</span> <span class="hljs-string">æ–°åˆ†æ”¯ç¬¬ä¸€æ¬¡æäº¤</span>
</code></pre>
<h3 data-id="heading-10">æ–¹æ¡ˆäºŒï¼šä½¿ç”¨åˆå¹¶æ—¶å‹ç¼©æäº¤</h3>
<h4 data-id="heading-11">2.1 åˆ›å»ºæ–°åˆ†æ”¯å¹¶åˆå¹¶å‹ç¼©</h4>
<pre><code class="hljs language-bash" lang="bash"> <span class="hljs-comment"># ä»è¦æ•´ç†çš„æäº¤ä¹‹å‰åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯</span>
git checkout -b clean-branch a1caa06

<span class="hljs-comment"># å°†åŸåˆ†æ”¯åˆå¹¶åˆ°æ–°åˆ†æ”¯ï¼Œå¹¶å‹ç¼©æ‰€æœ‰æäº¤ä¸ºä¸€ä¸ª</span>
git merge --squash testBase

<span class="hljs-comment"># æ­¤æ—¶æ‰€æœ‰æ›´æ”¹éƒ½å·²æš‚å­˜ï¼Œåˆ›å»ºæ–°çš„æäº¤</span>
git commit -m <span class="hljs-string">"feat: å®Œæ•´å®ç°XXXåŠŸèƒ½ï¼ˆå«xxã€xxã€xxï¼‰
</span></code></pre>
<h4 data-id="heading-12">2.2 æ–¹æ¡ˆäºŒå˜ä½“ï¼šé€‰æ‹©æ€§åˆå¹¶</h4>
<pre><code class="hljs language-perl" lang="perl"> <span class="hljs-comment"># åˆ›å»ºæ–°åˆ†æ”¯</span>
git checkout -b clean-branch

<span class="hljs-comment"># ä½¿ç”¨cherry-pické€‰æ‹©éœ€è¦çš„æäº¤</span>
git cherry-pick <span class="hljs-number">21</span>b9b13  <span class="hljs-comment"># åŸºç¡€æäº¤</span>
git cherry-pick <span class="hljs-number">1</span>aee00<span class="hljs-number">0</span>  <span class="hljs-comment"># è¡¥ä¸1</span>
git cherry-pick <span class="hljs-number">64</span>e9d01  <span class="hljs-comment"># è¡¥ä¸2</span>
git cherry-pick <span class="hljs-number">635804</span>e  <span class="hljs-comment"># è¡¥ä¸3</span>

<span class="hljs-comment"># é‡ç½®åˆ°cherry-pickä¹‹å‰çš„çŠ¶æ€ï¼Œä½†ä¿ç•™æ›´æ”¹</span>
git <span class="hljs-keyword">reset</span> --soft HEAD~<span class="hljs-number">4</span>

<span class="hljs-comment"># é‡æ–°æäº¤ä¸ºä¸€ä¸ªå®Œæ•´çš„æäº¤</span>
git commit -m <span class="hljs-string">"feat: å®Œæ•´å®ç°XXXåŠŸèƒ½ï¼ˆå«xxã€xxã€xxï¼‰"</span>

<span class="hljs-comment"># ç»§ç»­æ·»åŠ å…¶ä»–æäº¤ï¼ˆå¦‚æœéœ€è¦ï¼‰</span>
git cherry-pick dace4a8  <span class="hljs-comment"># å…¶ä»–æ¨¡å—æ</span>
</code></pre>
<h3 data-id="heading-13">æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨resetæ•´ç†æäº¤å†å²</h3>
<h4 data-id="heading-14">3.1 è½¯é‡ç½®åé‡æ–°æäº¤</h4>
<pre><code class="hljs language-perl" lang="perl"> <span class="hljs-comment"># 1. æŸ¥çœ‹è¦åˆå¹¶çš„æäº¤èŒƒå›´</span>
git <span class="hljs-keyword">log</span> --oneline

<span class="hljs-comment"># 2. é‡ç½®åˆ°è¦åˆå¹¶çš„ç¬¬ä¸€ä¸ªæäº¤ä¹‹å‰ï¼ˆä¿ç•™å·¥ä½œåŒºæ›´æ”¹ï¼‰</span>
git <span class="hljs-keyword">reset</span> --soft a1caa06

<span class="hljs-comment"># 3. æš‚å­˜æ‰€æœ‰æ›´æ”¹å¹¶åˆ›å»ºæ–°æäº¤</span>
git add .
git commit -m <span class="hljs-string">"feat: å®Œæ•´å®ç°XXXåŠŸèƒ½ï¼ˆå«xxã€xxã€xxï¼‰"</span>

<span class="hljs-comment"># 4. æ·»åŠ åç»­çš„æäº¤ï¼ˆå¦‚æœéœ€è¦ï¼‰</span>
git cherry-pick dace4a
</code></pre>
<h3 data-id="heading-15">æ–¹æ¡ˆå››ï¼šä½¿ç”¨Git Extensionsæˆ–SourceTreeç­‰GUIå·¥å…·</h3>
<p>å¯¹äºä¸ç†Ÿæ‚‰å‘½ä»¤è¡Œçš„ç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨å›¾å½¢åŒ–å·¥å…·ï¼š</p>
<ol>
<li><strong>Git Extensions</strong>ï¼šå³é”®æäº¤ â†’ "äº¤äº’å¼å˜åŸº"</li>
</ol>

<ol start="2">
<li><strong>SourceTree</strong>ï¼šå³å‡»æäº¤ â†’ "äº¤äº’å¼å˜åŸºå­èœå•"</li>
</ol>

<ol start="3">
<li><strong>VS Code GitLensæ‰©å±•</strong>ï¼šæä¾›å¯è§†åŒ–çš„rebaseç•Œé¢</li>
</ol>
<h2 data-id="heading-16">æœ€ä½³å®è·µå»ºè®®</h2>
<h3 data-id="heading-17">1 æäº¤ä¿¡æ¯è§„èŒƒ</h3>
<h3 data-id="heading-18">1.1 å¼€å‘æ—¶çš„æäº¤ç­–ç•¥</h3>
<pre><code class="hljs language-bash" lang="bash"> <span class="hljs-comment"># å¼€å‘æ—¶é¢‘ç¹æäº¤ï¼ˆæœ¬åœ°ï¼‰</span>
git add .
git commit -m <span class="hljs-string">"WIP: æ­£åœ¨å¼€å‘XXåŠŸèƒ½"</span>

<span class="hljs-comment"># åŠŸèƒ½å®Œæˆåæ•´ç†æäº¤</span>
git rebase -i HEAD~5  <span class="hljs-comment"># æ•´ç†æœ€è¿‘5ä¸ªæäº¤</span>

<span class="hljs-comment"># æ¨é€å‰ç¡®ä¿æäº¤å†å²æ•´æ´</span>
git <span class="hljs-built_in">log</span> --oneline --grap
</code></pre>
<h3 data-id="heading-19">1.2 åˆ†æ”¯ç®¡ç†ç­–ç•¥</h3>
<pre><code class="hljs language-bash" lang="bash"> <span class="hljs-comment"># 1. åŠŸèƒ½åˆ†æ”¯ä»developåˆ†æ”¯åˆ›å»º</span>
git checkout -b feature/xxx develop

<span class="hljs-comment"># 2. å¼€å‘è¿‡ç¨‹ä¸­å®šæœŸrebase developåˆ†æ”¯</span>
git fetch origin
git rebase origin/develop

<span class="hljs-comment"># 3. å®ŒæˆåŠŸèƒ½åæ•´ç†æäº¤</span>
git rebase -i develop

<span class="hljs-comment"># 4. æ¨é€åˆ°è¿œç¨‹</span>
git push origin feature/xxx --force-with-leas
</code></pre>
<h3 data-id="heading-20">1.3 å›¢é˜Ÿåä½œæ³¨æ„äº‹é¡¹</h3>
<ol>
<li><strong>ç§äººåˆ†æ”¯</strong>ï¼šå¯ä»¥è‡ªç”±ä½¿ç”¨force push</li>
</ol>

<ol start="2">
<li><strong>å…±äº«åˆ†æ”¯</strong>ï¼šé¿å…force pushï¼Œæˆ–ä½¿ç”¨<code>--force-with-lease</code></li>
</ol>

<ol start="3">
<li><strong>ä¸»å¹²åˆ†æ”¯</strong>ï¼šç¦æ­¢force push</li>
</ol>

<ol start="4">
<li><strong>ä»£ç å®¡æŸ¥å‰</strong>ï¼šæ•´ç†æäº¤å†å²ï¼Œä¾¿äºreview</li>
</ol>
<h2 data-id="heading-21">è‡ªåŠ¨åŒ–å·¥å…·æ¨è</h2>
<h3 data-id="heading-22">1. æäº¤ä¿¡æ¯æ ¡éªŒ</h3>
<p>ä½¿ç”¨commitlintï¼š</p>
<pre><code class="hljs language-ruby" lang="ruby"> <span class="hljs-comment"># å®‰è£…commitlint</span>
npm install --save-dev <span class="hljs-variable">@commitlint</span>/config-conventional <span class="hljs-variable">@commitlint</span>/cli

<span class="hljs-comment"># é…ç½®.commitlintrc.js</span>
<span class="hljs-keyword">module</span>.exports = {
  <span class="hljs-symbol">extends:</span> [<span class="hljs-string">'@commitlint/config-conventional'</span>]
</code></pre>
<h3 data-id="heading-23">2.GitHub Copilot / Cursor / CodeWhisperer</h3>
<p>å¯æ ¹æ®ä»£ç å˜æ›´å»ºè®®æäº¤ä¿¡æ¯ï¼ˆéœ€æ‰‹åŠ¨ç¡®è®¤ï¼‰ã€‚</p>
<p>ç¤ºä¾‹ï¼šåœ¨ VS Code ä¸­ï¼ŒCopilot æœ‰æ—¶ä¼šåœ¨ä½  git add åæç¤º â€œWrite a commit messageâ€ã€‚</p>
<h2 data-id="heading-24">æ€»ç»“å¯¹æ¯”</h2>



































<table><thead><tr><th><strong>æ–¹æ¡ˆ</strong></th><th><strong>ä¼˜ç‚¹</strong></th><th><strong>ç¼ºç‚¹</strong></th><th><strong>é€‚ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td>äº¤äº’å¼å˜åŸº</td><td>æœ€çµæ´»ï¼Œå¯ç²¾ç¡®æ§åˆ¶</td><td>å‘½ä»¤å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™</td><td>ç²¾ç¡®æ•´ç†æäº¤å†å²</td></tr><tr><td>åˆå¹¶å‹ç¼©</td><td>ç®€å•æ˜“ç”¨</td><td>å¤±å»ä¸­é—´æäº¤è®°å½•</td><td>å¿«é€Ÿåˆå¹¶æ•´ä¸ªåˆ†æ”¯</td></tr><tr><td>reseté‡ç½®</td><td>æ“ä½œç›´æ¥</td><td>é£é™©è¾ƒé«˜</td><td>ä»å¤´å¼€å§‹æ•´ç†</td></tr><tr><td>GUIå·¥å…·</td><td>å¯è§†åŒ–æ“ä½œ</td><td>åŠŸèƒ½å¯èƒ½æœ‰é™</td><td>ä¸ç†Ÿæ‚‰å‘½ä»¤è¡Œçš„ç”¨æˆ·</td></tr></tbody></table>
<h2 data-id="heading-25">æ¨èæµç¨‹</h2>
<pre><code class="hljs language-bash" lang="bash"> <span class="hljs-comment"># 1. å¼€å‘æ—¶é¢‘ç¹æäº¤ï¼ˆæœ¬åœ°ï¼‰</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"è¿›è¡Œå¼€å‘å·¥ä½œ..."</span>

<span class="hljs-comment"># 2. å®Œæˆä¸€ä¸ªåŠŸèƒ½æ¨¡å—åæ•´ç†</span>
git add .
git commit -m <span class="hljs-string">"feat: æ·»åŠ ç”¨æˆ·ç™»å½•åŠŸèƒ½"</span>

<span class="hljs-comment"># 3. å‘ç°éœ€è¦ä¿®å¤</span>
git add .
git commit --fixup HEAD  <span class="hljs-comment"># è‡ªåŠ¨æ ‡è®°ä¸ºfixup</span>

<span class="hljs-comment"># 4. å®šæœŸæ•´ç†</span>
git rebase -i --autosquash origin/main

<span class="hljs-comment"># 5. æ¨é€å‰æ£€æŸ¥</span>
git <span class="hljs-built_in">log</span> --oneline --graph --decorate

<span class="hljs-comment"># 6. å®‰å…¨æ¨é€</span>
git push origin feature/login --force-with-leas
</code></pre>
<p>é€šè¿‡ä¸Šè¿°æ–¹æ¡ˆå’Œå·¥å…·ï¼Œå¯ä»¥ç¡®ä¿æäº¤å†å²çš„æ•´æ´æ€§ï¼Œæé«˜ä»£ç å®¡æŸ¥æ•ˆç‡ï¼Œä¾¿äºé¡¹ç›®ç»´æŠ¤å’Œé—®é¢˜å›æº¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ·±å…¥æ¢ç©¶ Linux æ€»çº¿-è®¾å¤‡-é©±åŠ¨æ¨¡å‹]]></title>    <link>https://juejin.cn/post/7591346773828042778</link>    <guid>https://juejin.cn/post/7591346773828042778</guid>    <pubDate>2026-01-04T13:46:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591346773828042778" data-draft-id="7591346773828010010" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥æ¢ç©¶ Linux æ€»çº¿-è®¾å¤‡-é©±åŠ¨æ¨¡å‹"/> <meta itemprop="keywords" content="Linux"/> <meta itemprop="datePublished" content="2026-01-04T13:46:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xlp666hub"/> <meta itemprop="url" content="https://juejin.cn/user/2965810860569131"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥æ¢ç©¶ Linux æ€»çº¿-è®¾å¤‡-é©±åŠ¨æ¨¡å‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2965810860569131/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xlp666hub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T13:46:52.000Z" title="Sun Jan 04 2026 13:46:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»20åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•è¨€</h2>
<p>åœ¨å­¦ä¹  Linux è®¾å¤‡é©±åŠ¨æ—¶ï¼Œç»å¸¸ä¼šçœ‹åˆ°å„ç§å„æ ·çš„ç»“æ„ä½“ã€æ³¨å†Œæ³¨é”€å‡½æ•°ã€åˆå§‹åŒ–å‡½æ•°ï¼Œè¿™äº›ä¸œè¥¿çœ‹èµ·æ¥ç€å®è®©äººå¤´ç–¼ã€‚ä¸ºä»€ä¹ˆä¸èƒ½åƒå•ç‰‡æœºé‚£æ ·ï¼Œç›´æ¥é…ç½®å¯„å­˜å™¨æˆ–è€…è°ƒä¸ªåº“å‡½æ•°å°±æŠŠç¯ç‚¹äº®ï¼Ÿä¸ºä»€ä¹ˆè¦æçš„è¿™ä¹ˆéº»çƒ¦ï¼Ÿ</p>
<p>ä½†æ˜¯å®é™…ä¸Šæ˜¯è¿™ä¹ˆä¸ªæƒ…å†µï¼š</p>
<p>å•ç‰‡æœºè£¸æœºç¼–ç¨‹æ—¶ï¼Œä»£ç å’Œç¡¬ä»¶æ˜¯ç„Šæ­»çš„ï¼ˆå¼ºè€¦åˆï¼‰ï¼Œæ¢ä¸ªå¼•è„šä»£ç å°±å¾—æ”¹ï¼Œè¦æ˜¯æ¢ä¸ªèŠ¯ç‰‡é‚£ä»£ç å¯èƒ½å°±å¾—é‡å†™ã€‚</p>
<p>ä½†æ˜¯å¯¹äº Linux ï¼Œå®ƒçš„å†…æ ¸ä»£ç å¯èƒ½éœ€è¦åœ¨å…¨ä¸–ç•Œæˆåƒä¸Šä¸‡ç§ç¡¬ä»¶å¹³å°ä¸Šéƒ½èƒ½è·‘èµ·æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¯¹é€šç”¨æ€§çš„è¦æ±‚æ˜¯å¾ˆé«˜çš„ï¼Œå¦‚æœæ¯æ¢ä¸€ä¸ªç¡¬ä»¶å°±å»ä¿®æ”¹ä¸€æ¬¡å†…æ ¸æºç ï¼Œé‚£ Linux å°†ä¼šå˜å¾—ååˆ†è‡ƒè‚¿ä¸”ç»´æŠ¤èµ·æ¥æå…¶å›°éš¾ï¼Œè¿™å¬èµ·æ¥æ¯”ä¸Šé¢é‚£äº›ç»“æ„ä½“ã€æŠ½æƒ³åˆ°éƒ½ä¸çŸ¥é“åœ¨å¹²ä»€ä¹ˆçš„å‡½æ•°æ›´ä»¤äººå¤´ç–¼ä¸€äº›ã€‚</p>
<p>ä¸ºäº† Linux çš„é€šç”¨æ€§ï¼Œæˆ‘ä»¬å¿…é¡»ç‰ºç‰²ä»£ç çš„ç®€ä¾¿æ€§ï¼Œå»æ¢å–æ›´å¥½çš„<strong>å¯æ‰©å±•æ€§</strong>ã€‚</p>
<p>é‚£ä¹ˆ Linux ä¸ºäº†èƒ½åœ¨å¾ˆå¤šç¡¬ä»¶å¹³å°ä¸Šéƒ½èƒ½è¿è¡Œï¼Œå®ƒåˆ°åº•æ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿå®ƒçš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æŠŠ â€œ ç¡¬ä»¶è®¾å¤‡éƒ½æœ‰ä»€ä¹ˆ â€ å’Œ â€œ è½¯ä»¶æ€ä¹ˆå»é©±åŠ¨ç¡¬ä»¶ â€ è¿™ä¸¤ä¸ªéƒ¨åˆ†åˆ†ç¦»ï¼Œä½†æ˜¯å®é™…ä¸Šè¿™ä¸¤ä¸ªéƒ¨åˆ†åˆéœ€è¦ååŒå·¥ä½œï¼Œå› æ­¤å°±éœ€è¦ä¸€ä¸ªä¸­é—´äººå°†å®ƒä»¬è”ç³»èµ·æ¥ï¼Œåœ¨ Linux å†…æ ¸ä¸­ï¼Œè¿™ä¸ªä¸­é—´äººå°±æ˜¯<strong>æ€»çº¿</strong>ã€‚</p>
<p>ç”±æ­¤ï¼Œæ„æˆäº† Linux é©±åŠ¨å¼€å‘ä¸­æœ€æ ¸å¿ƒçš„é“ä¸‰è§’ï¼Œä¹Ÿå°±æ˜¯<strong>æ€»çº¿ - è®¾å¤‡ - é©±åŠ¨æ¨¡å‹</strong>ã€‚</p>
<p>Linux è®¾å¤‡é©±åŠ¨æ¨¡å‹çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†<strong>ç¡¬ä»¶å®šä¹‰</strong>ä¸<strong>é©±åŠ¨é€»è¾‘</strong>åˆ†ç¦»ï¼Œå¹¶é€šè¿‡<strong>æ€»çº¿</strong>å°†ä¸¤è€…è”ç³»èµ·æ¥ã€‚è¿™ç§æ¨¡å‹å¯¹åº”å†…æ ¸ä¸­çš„ä¸‰ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„ï¼š<code>struct bus_type</code>ã€<code>struct device</code> å’Œ <code>struct device_driver</code>ã€‚</p>
<h2 data-id="heading-1">1 æ€»çº¿</h2>
<p>åœ¨å†…æ ¸ä¸­ï¼Œæ€»çº¿ç”± <code>struct bus_type</code> ç»“æ„ä½“è¡¨ç¤ºï¼Œå®ƒæ˜¯ Linux è®¾å¤‡æ¨¡å‹çš„å…³é”®ï¼ˆå…¶å®ä¸‰ä¸ªéƒ¨åˆ†éƒ½å¾ˆå…³é”®ï¼Œåªæ˜¯æ€»çº¿è´Ÿè´£å°†å…¶ä»–ä¸¤ä¸ªéƒ¨åˆ†è”ç³»èµ·æ¥ï¼‰ï¼Œè¿™ä¸ªç»“æ„ä½“è´Ÿè´£<strong>ç®¡ç†</strong>æŒ‚è½½åœ¨æ€»çº¿ä¸Šé¢çš„æ‰€æœ‰è®¾å¤‡å’Œé©±åŠ¨ã€‚</p>
<p>æ€»çº¿é©±åŠ¨æœ€é‡è¦çš„å·¥ä½œæ˜¯åœ¨å†…æ ¸ä¸­ç®¡ç†ç€ä¸¤ä¸ªé“¾è¡¨ï¼š</p>
<p>ç¬¬ä¸€ä¸ªæ˜¯<strong>è®¾å¤‡é“¾è¡¨</strong>ï¼Œç”¨æ¥è®°å½•æ‰€æœ‰æ³¨å†Œåˆ°è¿™ä¸ªæ€»çº¿çš„è®¾å¤‡å®ä¾‹ã€‚</p>
<p>ç¬¬äºŒä¸ªæ˜¯<strong>é©±åŠ¨é“¾è¡¨</strong>ï¼Œç”¨æ¥è®°å½•æ‰€æœ‰æ³¨å†Œåˆ°è¿™ä¸ªæ€»çº¿çš„é©±åŠ¨ç¨‹åºã€‚</p>
<p>ä½¿ç”¨é“¾è¡¨å°†åˆ†æ•£åœ¨å†…å­˜ä¸­çš„è®¾å¤‡å¯¹è±¡å’Œé©±åŠ¨å¯¹è±¡ä¸²è”èµ·æ¥ï¼Œæœ‰åˆ©äºéå†æŸ¥æ‰¾æ—¶çš„æ•ˆç‡ã€‚</p>
<p>å¤§å®¶å¯ä»¥å»ç¿»ä¸€ä¸‹ Linux çš„å†…æ ¸æºç ï¼Œæ‰¾ä¸€ä¸‹è¿™ä¸ªç»“æ„ä½“ï¼Œçœ‹çœ‹å®ƒå…·ä½“æ˜¯é•¿ä»€ä¹ˆæ ·å­çš„ã€‚å†…æ ¸æºç éœ€è¦è‡ªå·±ä¸‹è½½ã€‚</p>
<p>ä¸‹è½½å¥½å†…æ ¸æºç åï¼Œå¯ä»¥å»ä¸‹é¢ç›®å½•æ‰¾è¿™ä¸ªç»“æ„ä½“ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/kernel/include/linux/device.h
</code></pre>
<p>ä¸‹é¢æ˜¯è¿™ä¸ªç»“æ„ä½“éƒ¨åˆ†å†…å®¹çš„æˆªå›¾ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªç»“æ„ä½“çš„æˆå‘˜éå¸¸å¤šï¼Œæˆ‘ä»¬ä¸éœ€è¦å…¨éƒ¨ææ‡‚ï¼Œåªéœ€è¦æ·±å…¥ç†è§£æœ€å…³é”®çš„å‡ ä¸ªå°±è¡Œäº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a403eaad1154115a00a544df49c20b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768139212&amp;x-signature=JfMIDGC%2BMHVrVQTDXJzJCuGw4Ps%3D" alt="1. æ€»çº¿ç»“æ„ä½“æºç .png" loading="lazy"/></p>
<h3 data-id="heading-2">1.1 æ€»çº¿åç§°</h3>
<p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ç¬¬ 123 è¡Œçš„<code>const char *name</code>ï¼Œè¿™å°±æ˜¯<strong>æ€»çº¿çš„åå­—</strong>ã€‚</p>
<p>è¿™ä¸ªå­—ç¬¦ä¸²å°†ä¼šå†³å®šè¿™ä¸ªæ€»çº¿åœ¨ <strong>Sysfs æ–‡ä»¶ç³»ç»Ÿ</strong> ä¸­å¯¹åº”çš„æ–‡ä»¶å¤¹åç§°ã€‚Sysfs æ˜¯ Linux å†…æ ¸æä¾›çš„<strong>åŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿ</strong>ï¼Œä½†æˆ‘ä»¬ä¸€èˆ¬æ›´ä¹ æƒ¯å«ä»–<strong>è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</strong>ï¼ŒSysfs é€šå¸¸æŒ‚è½½åœ¨ <code>/sys</code> ç›®å½•ä¸‹ï¼Œæ¯ä¸ªå†…æ ¸å¯¹è±¡å¯¹åº”ä¸€ä¸ªç›®å½•ï¼Œå†…æ ¸å¯¹è±¡å¯ä»¥æ˜¯è®¾å¤‡ï¼Œæ€»çº¿ï¼Œé©±åŠ¨ï¼Œç±»ç­‰ç­‰ï¼Œæ¯ä¸ªå†…æ ¸å¯¹è±¡çš„å±æ€§å¯¹åº”ç€ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨<code>ls</code>å‘½ä»¤æŸ¥çœ‹<code>/sys</code>ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªåä¸º <code>bus</code> çš„æ–‡ä»¶å¤¹ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/310030e167c241dda0585417446c4d15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768139212&amp;x-signature=YfC5IJmzc1Q9mLs%2Ffqe8FQvUMAw%3D" alt="2. sysä¸‹ç›®å½•.png" loading="lazy"/></p>
<p>æˆ‘ä»¬å†è¿›å…¥<code>bus</code>æ–‡ä»¶å¤¹æŸ¥çœ‹ï¼Œå¤§å®¶åº”è¯¥å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªåä¸º<code>platform</code>çš„æ–‡ä»¶å¤¹ã€‚å¦‚æœå¥½å¥‡ä¸ºä»€ä¹ˆè¿™é‡Œä¼šå‡ºç°è¿™ä¸ªåä¸º<code>platform</code>çš„æ–‡ä»¶å¤¹ï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹ï¼ˆå…¶ä»–æ–‡ä»¶å¤¹ä¹Ÿæ˜¯åŒç†ï¼Œè¿™é‡Œä½¿ç”¨<code>platform</code>ä¸¾ä¾‹å­ï¼‰ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8d3f7008b104fd1a9567a37e7bc99c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768139212&amp;x-signature=9aRZ2eE5LdD2Wkru7%2F4y%2FZlddN0%3D" alt="3. busä¸‹ç›®å½•.png" loading="lazy"/></p>
<p>åœ¨Linuxå†…æ ¸æºç ä¸­ï¼Œæˆ‘ä»¬è¿›å…¥ä¸‹é¢ç›®å½•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/kernel/drivers/base/platform.c
</code></pre>
<p>å¤§å®¶å¯ä»¥æ‰¾åˆ°è¿™æ®µä»£ç </p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb8a398e5cc64fe0b1c82434a991156e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768139212&amp;x-signature=3floIs7GqQeQXBRrb%2B4XTW%2BzriY%3D" alt="4. platformæºç .png" loading="lazy"/></p>
<p>è¿™é‡Œçš„ 1180 è¡Œ <code>.name</code> è¢«èµ‹å€¼ä¸ºå­—ç¬¦ä¸² <code>"platform"</code>ï¼Œæ­¤æ—¶å®ƒè¿˜åªæ˜¯ä»£ç é‡Œçš„ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ã€‚</p>
<p>å½“å†…æ ¸å¯åŠ¨ï¼Œè°ƒç”¨ <code>bus_register(&amp;platform_bus_type)</code> æ³¨å†Œè¿™æ¡æ€»çº¿æ—¶ï¼ŒLinux çš„ <strong>Sysfs æ–‡ä»¶ç³»ç»Ÿ</strong> æœºåˆ¶å°±å¼€å§‹å·¥ä½œäº†ï¼Œå®ƒä¼šæŠŠ<strong>å†…æ ¸é‡Œçš„æ•°æ®ç»“æ„</strong>æ˜ å°„æˆ<strong>ç”¨æˆ·ç©ºé—´çš„æ–‡ä»¶å’Œç›®å½•</strong>ã€‚é¦–å…ˆï¼Œå†…æ ¸çŸ¥é“æ‰€æœ‰çš„æ€»çº¿éƒ½åº”è¯¥æ”¾åœ¨ <code>/sys/bus/</code> è¿™ä¸ªæ€»çº¿ç›®å½•ä¸‹ï¼Œç„¶åå†…æ ¸è¯»å–åˆ°å®šä¹‰çš„ <code>.name</code> æ˜¯ <code>"platform"</code>ï¼Œäºæ˜¯å†…æ ¸å°±åœ¨ <code>/sys/bus/</code> ä¸‹åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>platform</code> çš„æ–‡ä»¶å¤¹ï¼Œè¿™å°±æ˜¯<code>platform</code>è¿™ä¸ªæ–‡ä»¶å¤¹æ¥æºã€‚å¦‚æœæŠŠ<code>.name</code> èµ‹å€¼ä¸ºåˆ«çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆ<code>/sys/bus/</code>ç›®å½•ä¸‹çš„æ–‡ä»¶å¤¹åç§°ä¹Ÿä¼šæ”¹å˜ã€‚</p>
<p>è¿˜æœ‰ä¸€ç‚¹ï¼ŒSysfs ä¸­çš„å†…å®¹å®Œå…¨åœ¨å†…å­˜ä¸­ç”Ÿæˆï¼Œä¸å ç”¨ç£ç›˜ç©ºé—´ï¼Œç³»ç»Ÿé‡å¯åå°†ä¼šé‡æ–°ç”Ÿæˆã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>å¹³å°æ€»çº¿åˆå§‹åŒ–</strong>æ—¶è®¾ç½® <code>.name = "platform"</code>ï¼Œå†…æ ¸æœ€ç»ˆä¼šè‡ªåŠ¨åˆ›å»ºç›®å½• <code>/sys/bus/platform/</code>ï¼Œè¿™ä¾¿æ˜¯ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´äº¤äº’çš„ä¸€ä¸ªçª—å£ï¼Œä¹Ÿæ˜¯ <code>struct bus_type</code>ç»“æ„ä½“ä¸­<code>const char *name</code>è¿™ä¸ªæˆå‘˜å­˜åœ¨çš„æ„ä¹‰ã€‚</p>
<h3 data-id="heading-3">1.2 match å›è°ƒå‡½æ•°</h3>
<p>æˆ‘ä»¬å†æ¥çœ‹<code>struct bus_type</code>ç»“æ„ä½“é‚£å¼ æˆªå›¾çš„ç¬¬ 130 è¡Œï¼Œè¿™æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘äº†å…·ä½“çš„åŒ¹é…ç®—æ³•ã€‚å¦‚æœè¯´<code>name</code>å†³å®šäº†æ€»çº¿çš„ç›®å½•åï¼Œé‚£ä¹ˆ<code>match</code>å°±å†³å®šäº†æ€»çº¿çš„å·¥ä½œé€»è¾‘ã€‚</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> (*match)(<span class="hljs-keyword">struct</span> device *dev, <span class="hljs-keyword">struct</span> device_driver *drv);
</code></pre>
<p>å®ƒæ˜¯æ€»çº¿é©±åŠ¨ä¸­æœ€æ ¸å¿ƒï¼Œæœ€ç¹å¿™çš„æˆå‘˜ã€‚æ¯å½“æœ‰<strong>æ–°è®¾å¤‡</strong>æˆ–<strong>æ–°é©±åŠ¨</strong>æ³¨å†Œåˆ°è¿™æ¡æ€»çº¿ä¸Šæ—¶ï¼Œå†…æ ¸éƒ½ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå†…æ ¸ä¼šæ‹¿ç€<strong>æ–°è®¾å¤‡</strong>å»éå†<strong>å·²æœ‰çš„é©±åŠ¨é“¾è¡¨</strong>ï¼Œæˆ–è€…æ‹¿ç€<strong>æ–°é©±åŠ¨</strong>å»éå†<strong>å·²æœ‰çš„è®¾å¤‡é“¾è¡¨</strong>ï¼Œä¸€æ¬¡æ¬¡è°ƒç”¨ <code>match(dev, drv)</code>ã€‚å¯¹äº<strong>å¹³å°æ€»çº¿</strong>ï¼Œè¿™é‡Œçš„ <code>match</code> å‡½æ•°é€»è¾‘å°±æ˜¯ä¼˜å…ˆæ¯”è¾ƒè®¾å¤‡æ ‘ä¸­çš„ <code>compatible</code> å±æ€§ï¼Œå¦‚æœæ²¡æœ‰è®¾å¤‡æ ‘ï¼Œå°±æ¯”è¾ƒ <code>.name</code> å­—æ®µã€‚</p>
<p>ä½†æ˜¯å®é™…ä¸Šï¼ŒLinux å†…æ ¸ä¸­æœ‰ç€å„ç§å„æ ·çš„æ€»çº¿ï¼Œæ¯”å¦‚ USB ï¼ŒI2Cï¼ŒSPIï¼ŒPlatform ç­‰ç­‰ï¼Œè€Œ<strong>æ¯ç§æ€»çº¿çš„åŒ¹é…è§„åˆ™åˆæ˜¯ä¸ä¸€æ ·</strong>çš„ï¼Œæ¯”å¦‚ I2C æ€»çº¿å¯èƒ½çœ‹è®¾å¤‡åå­—ï¼Œè€Œ Platform æ€»çº¿çœ‹çš„æ˜¯è®¾å¤‡æ ‘é‡Œé¢çš„ <code>compatible</code> å±æ€§ã€‚å†…æ ¸ä¸ºäº†ç»Ÿä¸€ç®¡ç†ï¼Œå°±åœ¨ <code>bus_type</code> é‡Œé¢„ç•™äº†è¿™ä¸ª <code>match</code> æ¥å£ï¼Œå…·ä½“çš„åŒ¹é…é€»è¾‘ï¼Œç”±å„ç§æ€»çº¿é©±åŠ¨è‡ªå·±å»å®ç°ã€‚</p>
<p>ä¸Šé¢è®²å®Œäº†åŒ¹é…é€»è¾‘ï¼Œä¸‹æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªåŒ¹é…æœºåˆ¶æœ¬èº«ï¼Œè¿™ä¸ªåŒ¹é…åœ¨ä¸¤ç§æƒ…å†µä¸‹ä¼šè‡ªåŠ¨è§¦å‘ã€‚</p>
<p>ç¬¬ä¸€ç§æƒ…å†µæ˜¯æ·»åŠ æ–°è®¾å¤‡ï¼Œå½“å†…æ ¸è§£æè®¾å¤‡æ ‘ï¼Œæˆ–è€…æœ‰ä¸€ä¸ª USB è®¾å¤‡æ’å…¥æ—¶ï¼Œç³»ç»Ÿä¼šæ³¨å†Œä¸€ä¸ªæ–°çš„ deviceï¼Œæ­¤æ—¶ï¼Œè¿™ä¸ªè®¾å¤‡æ³¨å†Œçš„<strong>æ€»çº¿</strong>å°±ä¼šæ‹¿ç€è¿™ä¸ªæ–°è®¾å¤‡å»éå†è‡ªå·±çš„<strong>é©±åŠ¨é“¾è¡¨</strong>ï¼Œè¿™è®©æˆ‘æƒ³èµ·äº†ç”µå½±ç‰§é©¬äººä¸­çš„é‚£å¥ç»å…¸å°è¯ â€œè€è®¸ï¼Œä½ è¦è€å©†ä¸è¦ï¼Ÿâ€ ã€‚è¿™ä¸ªåŒ¹é…è¿‡ç¨‹å’Œç”µå½±ä¸­çš„åœºæ™¯ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œæ€»çº¿æ‹¿ç€æ–°è®¾å¤‡å»é—®é©±åŠ¨é“¾è¡¨é‡Œé¢çš„æ¯ä¸€ä¸ªé©±åŠ¨ï¼Œä¸€ä¸ªä¸€ä¸ªé—®ä»–ä»¬è¦ä¸è¦è¿™ä¸ªæ–°è®¾å¤‡ï¼Œæ¯é—®ä¸€æ¬¡å°±ç›¸å½“äºè°ƒç”¨ä¸€æ¬¡<code>match</code>å‡½æ•°è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœä¸¤ä¸ªäººæ²¡çœ‹å¯¹çœ¼ï¼Œé‚£åŒ¹é…å°±å¤±è´¥äº†ï¼Œç»§ç»­é—®ä¸‹ä¸€ä¸ªï¼Œå¦‚æœä¸¤äººçœ‹å¯¹çœ¼äº†ï¼Œé‚£å°±åŒ¹é…æˆåŠŸã€‚</p>
<p>ç¬¬äºŒç§æƒ…å†µæ·»åŠ æ–°é©±åŠ¨ï¼Œå½“æ‰§è¡Œ<code>insmod</code>åŠ è½½ä¸€ä¸ªé©±åŠ¨æ¨¡å—æ—¶ï¼Œç³»ç»Ÿä¼šæ³¨å†Œä¸€ä¸ªæ–°çš„ driver ï¼Œæ­¤æ—¶ï¼Œæ€»çº¿ä¼šå¸¦ç€æ–°é©±åŠ¨å»éå†è®¾å¤‡é“¾è¡¨ï¼Œä¸€ä¸ªä¸€ä¸ªé—®ï¼Œç›´åˆ°åŒ¹é…æˆåŠŸæˆ–è€…éå†å®Œæ¯•ã€‚</p>
<p>è¿™ä¸¤ç§æƒ…å†µçœ‹èµ·æ¥ç›¸ä¼¼åº¦å¾ˆé«˜ï¼Œä½†è¿˜æ˜¯æœ‰ä¸€ç‚¹ä¸ä¸€æ ·çš„ï¼Œå°±æ˜¯ä¸€ä¸ªé©±åŠ¨æ¨¡å—å¯ä»¥é©±åŠ¨å¤šä¸ªè®¾å¤‡ï¼Œä½†æ˜¯ä¸€ä¸ªè®¾å¤‡å´åªèƒ½æœ‰ä¸€ä¸ªé©±åŠ¨æ¨¡å—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ·»åŠ æ–°è®¾å¤‡é‚£ç§æƒ…å†µä¸‹ï¼Œæ€»çº¿ä¸ä»…ä¼šå»é—®æ²¡æœ‰é…å¯¹çš„é©±åŠ¨ï¼Œè¿˜ä¼šå»é—®å·²ç»é…å¯¹å¥½çš„é©±åŠ¨ï¼Œè¿™æ„å‘³ç€<strong>ä¸€ä¸ªé©±åŠ¨ç¨‹åºå¯ä»¥åŒæ—¶æœåŠ¡äºå¤šä¸ªåŒç±»å‹çš„è®¾å¤‡å®ä¾‹</strong>ã€‚è€Œåœ¨æ·»åŠ æ–°é©±åŠ¨çš„æƒ…å†µä¸‹ï¼Œæ€»çº¿åªä¼šå»é—®æ²¡æœ‰é…å¯¹å¥½çš„è®¾å¤‡ï¼Œå·²ç»é…å¯¹å¥½çš„è®¾å¤‡å®ƒæ˜¯ä¸ä¼šå»é—®çš„ã€‚</p>
<p>ä¸ºäº†èƒ½å¤Ÿæ·±å…¥ç†è§£è¿™ä¸ªåŒ¹é…é€»è¾‘ï¼Œæˆ‘ä»¬ä¾ç„¶åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ°å¹³å°æ€»çº¿çš„åŒ¹é…é€»è¾‘ï¼Œå®ƒè¯¦ç»†æè¿°äº†å¹³å°æ€»çº¿æ˜¯å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªè®¾å¤‡å’Œä¸€ä¸ªé©±åŠ¨èƒ½å¦çœ‹å¯¹çœ¼çš„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/kernel/drivers/base/platform.c
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea2d03fab815462db5f1d192159c0e85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768139212&amp;x-signature=Nl%2BB0h%2FfXvz22jzXjH%2Bm4R%2B6t2Y%3D" alt="5. matchæºç .png" loading="lazy"/></p>
<p>ä»æºç ä¸­æˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼ŒLinux è®¾è®¡äº†ä¸€å¥—ä¸¥å¯†çš„ã€å…·æœ‰ä¼˜å…ˆçº§çš„åŒ¹é…æµç¨‹ï¼Œåªè¦æ»¡è¶³å…¶ä¸­ä»»ä½•ä¸€ä¸ªæ¡ä»¶ï¼Œå°±å¯ä»¥è®¤ä¸ºåŒ¹é…æˆåŠŸã€‚</p>
<p>è¿™ä¸ªå‡½æ•°ä¼ å…¥çš„å‚æ•°æ˜¯é€šç”¨çš„ <code>struct device</code> å’Œ <code>struct device_driver</code>ï¼Œå‡½æ•°çš„ç¬¬ä¸€æ­¥æ˜¯é€šè¿‡å®å°†å®ƒä»¬è¿˜åŸæˆ<strong>å¹³å°è®¾å¤‡</strong>å’Œ<strong>å¹³å°é©±åŠ¨</strong> ï¼Œä»¥ä¾¿è®¿é—®å¹³å°ç‰¹æœ‰çš„å±æ€§ã€‚</p>
<p>ç„¶åæˆ‘ä»¬çœ‹ 994 å’Œ 995 è¡Œï¼Œè¿™æ˜¯æœ€é«˜ä¼˜å…ˆçº§çš„åŒ¹é…è§„åˆ™ï¼Œå¦‚æœåœ¨ç”¨æˆ·ç©ºé—´é€šè¿‡ sysfs ä¿®æ”¹äº†è®¾å¤‡çš„ <code>driver_override</code> å±æ€§ï¼Œå¼ºåˆ¶æŒ‡å®šäº†æŸä¸ªé©±åŠ¨åå­—ï¼Œå†…æ ¸å°±ä¼šå¿½ç•¥åé¢æ‰€æœ‰çš„è§„åˆ™ï¼Œåªçœ‹åå­—å¯¹ä¸å¯¹ï¼Œè¿™é€šå¸¸ç”¨äºè°ƒè¯•ã€‚</p>
<p>å†æ¥çœ‹ 998 å’Œ 999 è¡Œï¼Œè¿™æ˜¯<strong>åµŒå…¥å¼ Linux å¼€å‘ä¸­æœ€å¸¸ç”¨</strong>çš„åŒ¹é…æ–¹å¼ï¼Œ<strong>OF</strong> æŒ‡çš„æ˜¯ <strong>Open Firmware</strong>ï¼Œåœ¨ Linux ä¸­æŒ‡ä»£è®¾å¤‡æ ‘ã€‚å‡½æ•°å†…éƒ¨ä¼šè¿›è¡Œå¯¹æ¯”ï¼Œ<strong>é©±åŠ¨ä¸­</strong><code>driver-&gt;of_match_table</code> ä¸­çš„ <code>compatible</code> å­—ç¬¦ä¸²å’Œ<strong>è®¾å¤‡æ ‘ä¸­</strong>èŠ‚ç‚¹çš„ <code>compatible</code> å±æ€§ã€‚å¦‚æœä¸¤è€…ä¸€è‡´ï¼Œé‚£å°±åŒ¹é…æˆåŠŸã€‚</p>
<p>å†å¾€ä¸‹çœ‹ 1002 å’Œ 1003 è¡Œï¼Œè¿™æ˜¯ <strong>ACPI åŒ¹é…</strong>ï¼Œä¸»è¦ç”¨äº x86 æ¶æ„ï¼Œåœ¨ ARM åµŒå…¥å¼è®¾å¤‡ä¸­å¾ˆå°‘ç”¨åˆ°ã€‚</p>
<p>ç„¶åæ˜¯ 1006 å’Œ 1007 è¡Œçš„ <strong>ID è¡¨åŒ¹é…</strong>ï¼Œåœ¨è®¾å¤‡æ ‘æµè¡Œä¹‹å‰ï¼Œé€šå¸¸ç”¨çš„æ˜¯è¿™ç§åŒ¹é…æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•åœ¨é©±åŠ¨é‡Œä¼šå®šä¹‰ä¸€ä¸ª <code>id_table</code> æ•°ç»„ï¼Œé‡Œé¢åˆ—å‡ºäº†ä¸€å †æ”¯æŒçš„è®¾å¤‡åï¼Œå†…æ ¸ä¼šæ‹¿<strong>å½“å‰è®¾å¤‡çš„åå­—</strong>ï¼Œå»è¿™ä¸ªåˆ—è¡¨é‡Œä¸€ä¸ªä¸ªæŸ¥ï¼Œå¦‚æœæŸ¥åˆ°äº†ï¼Œå°±åŒ¹é…æˆåŠŸã€‚</p>
<p>æœ€å 1010 è¡Œæ˜¯<strong>åå­—åŒ¹é…</strong>ï¼Œè¿™æ˜¯æœ€åçš„æ‰‹æ®µï¼Œå¦‚æœå‰é¢çš„åŒ¹é…æ–¹æ³•éƒ½å¤±è´¥äº†ï¼Œå†…æ ¸ä¼šç®€å•ç²—æš´çš„æ¯”è¾ƒè®¾å¤‡çš„åå­—<code>device.name</code>å’Œé©±åŠ¨çš„åå­—<code>driver.name</code>æ˜¯å¦ä¸€æ ·ï¼Œå¦‚æœä¸€æ ·ï¼Œé‚£å°±åŒ¹é…æˆåŠŸã€‚</p>
<p>ä¸Šé¢ä»‹ç»çš„åŒ¹é…æœºåˆ¶ä¸­ï¼Œ<code>of_driver_match_device</code> çš„ä¼˜å…ˆçº§æ˜¯æœ€é«˜çš„ï¼ˆåœ¨æ²¡æœ‰ <code>driver_override</code> çš„æƒ…å†µä¸‹ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨è®¾å¤‡æ ‘é‡Œå†™ <code>compatible</code> å°±èƒ½åŒ¹é…ä¸Šçš„åŸå› ã€‚</p>
<h3 data-id="heading-4">1.3 çƒ­æ’æ‹”æœºåˆ¶ uevent</h3>
<p>å†æ¥çœ‹<code>struct bus_type</code>ç»“æ„ä½“é‚£å¼ æˆªå›¾çš„ç¬¬ 131 è¡Œï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> (*uevent)(<span class="hljs-keyword">struct</span> device *dev, <span class="hljs-keyword">struct</span> kobj_uevent_env *env);
</code></pre>
<p>è¿™ä¸ªå‡½æ•°æˆ‘ä»¬åœ¨å†™ç®€å•çš„é©±åŠ¨æ—¶å¾ˆå°‘ç›´æ¥å»ä¿®æ”¹å®ƒï¼Œä½†å®ƒåœ¨ Linux ç³»ç»Ÿä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œå®ƒæ˜¯<strong>å†…æ ¸ç©ºé—´</strong>å‘<strong>ç”¨æˆ·ç©ºé—´</strong>ä¼ é€’ä¿¡æ¯çš„å·¥å…·ã€‚</p>
<p>å½“æ€»çº¿ä¸Šå‘ç”Ÿè®¾å¤‡æ·»åŠ æˆ–ç§»é™¤ç­‰äº‹ä»¶æ—¶ï¼Œå†…æ ¸å°±ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå®ƒçš„ä¸»è¦ä»»åŠ¡æ˜¯æ•´ç†å¥½å…³äºè¿™ä¸ªè®¾å¤‡çš„ä¿¡æ¯ï¼Œå¹¶æ‰“åŒ…æˆä¸€ç»„<strong>ç¯å¢ƒå˜é‡</strong> ï¼Œç„¶åé€šè¿‡ Netlink å¹¿æ’­å‘é€ç»™ç”¨æˆ·ç©ºé—´ã€‚</p>
<p>è€Œåœ¨ç”¨æˆ·ç©ºé—´ï¼Œé€šå¸¸æœ‰ä¸€ä¸ª<strong>å®ˆæŠ¤è¿›ç¨‹</strong>ï¼ˆæ¯”å¦‚ <strong>udev</strong> æˆ–åµŒå…¥å¼ç³»ç»Ÿä¸­å¸¸è§çš„ <strong>mdev</strong>ï¼‰åœ¨æ—¶åˆ»ç›‘å¬è¿™äº›æ¶ˆæ¯ã€‚</p>
<p>ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå½“æŠŠä¸€ä¸ª USB é¼ æ ‡æ’åˆ°ç”µè„‘ä¸Šæ—¶ï¼ŒUSB æ€»çº¿æ£€æµ‹åˆ°ç¡¬ä»¶æ’å…¥ï¼Œä¼šç”Ÿæˆä¸€ä¸ªè®¾å¤‡ç»“æ„ä½“ï¼Œç„¶åå†…æ ¸è°ƒç”¨ USB æ€»çº¿çš„ <code>uevent</code> å‡½æ•°ï¼Œæ‰“åŒ…å¥½ â€œ è¿™æ˜¯ä¸€ä¸ª USB é¼ æ ‡ â€ è¿™æ¡ä¿¡æ¯å¹¶å‘å‡ºå»ï¼Œç”¨æˆ·ç©ºé—´çš„ <code>udev</code> æ”¶åˆ°ä¿¡å·ï¼Œä¼šæ ¹æ®è§„åˆ™è‡ªåŠ¨åŠ è½½å¯¹åº”çš„é©±åŠ¨æ¨¡å—ï¼Œå¹¶åœ¨ <code>/dev/</code> ç›®å½•ä¸‹è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª <code>mouse0</code> çš„è®¾å¤‡èŠ‚ç‚¹ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ Linux ä¸­æ’å…¥ç¡¬ä»¶å°±èƒ½è‡ªåŠ¨è¯†åˆ«ã€è‡ªåŠ¨åŠ è½½é©±åŠ¨å¹¶è‡ªåŠ¨ç”Ÿæˆè®¾å¤‡èŠ‚ç‚¹çš„åŸå› ï¼ŒèƒŒåå°±æ˜¯ <code>uevent</code> æœºåˆ¶åœ¨é»˜é»˜å·¥ä½œã€‚å¯¹äºå¹³å°æ€»çº¿ï¼Œå®ƒä¹Ÿä¼šåˆ©ç”¨è¿™ä¸ªæœºåˆ¶ï¼Œè®©ç³»ç»Ÿèƒ½<strong>è‡ªåŠ¨è¯†åˆ«è®¾å¤‡æ ‘ä¸­å®šä¹‰çš„èŠ‚ç‚¹å¹¶åŠ è½½å¯¹åº”çš„é©±åŠ¨</strong>ã€‚</p>
<h3 data-id="heading-5">1.4 probe å‡½æ•°</h3>
<p>æ¥çœ‹<code>struct bus_type</code>ç»“æ„ä½“é‚£å¼ æˆªå›¾çš„ç¬¬ 132 è¡Œï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> (*probe)(<span class="hljs-keyword">struct</span> device *dev);
</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼Œå®ƒä»£è¡¨äº†<strong>æ€»çº¿çš„åˆå§‹åŒ–å…¥å£</strong>ã€‚å½“ <code>match</code> å‡½æ•°åŒ¹é…æˆåŠŸåï¼Œå†…æ ¸çš„é©±åŠ¨æ ¸å¿ƒå±‚å°±ä¼šè¯•å›¾è®©é©±åŠ¨ç¨‹åºæ¥ç®¡è®¾å¤‡ã€‚è¿™æ—¶ï¼Œå†…æ ¸ä¼šéµå¾ªä¸‹é¢çš„è°ƒç”¨è§„åˆ™ï¼š</p>
<p>å†…æ ¸é¦–å…ˆæ£€æŸ¥ <code>bus_type-&gt;probe</code> æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œå†…æ ¸ä¼šè°ƒç”¨æ€»çº¿çš„ <code>probe</code> å‡½æ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ€»çº¿é©±åŠ¨é€šå¸¸ä¼šæ‰§è¡Œä¸€äº›è¯¥æ€»çº¿ç‰¹æœ‰çš„å…¬å…±åˆå§‹åŒ–æ“ä½œï¼ˆæ¯”å¦‚å¼€å¯æ€»çº¿æ—¶é’Ÿå’Œç”µæºç®¡ç†ç­‰æ“ä½œï¼‰ï¼Œç„¶åå†ç”±<strong>æ€»çº¿é©±åŠ¨</strong>å»è°ƒç”¨<strong>è®¾å¤‡é©±åŠ¨</strong>é‡Œçš„ <code>probe</code> å‡½æ•°ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œå†…æ ¸ä¼šè·³è¿‡æ€»çº¿å±‚ï¼Œç›´æ¥è°ƒç”¨<strong>è®¾å¤‡é©±åŠ¨</strong>é‡Œçš„ <code>probe</code> å‡½æ•°ã€‚</p>
<p>å¯¹äºæˆ‘ä»¬å¸¸ç”¨çš„ <strong>Platform æ€»çº¿</strong>ï¼Œå®ƒé€šå¸¸ä¸å®šä¹‰æ€»çº¿çº§åˆ«çš„ <code>probe</code>ï¼ˆæˆ–è€…ä»…ä»…ç”¨å®ƒå®ç°ç®€å•çš„é€ä¼ ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™é©±åŠ¨æ—¶ï¼Œåªéœ€è¦å…³æ³¨è‡ªå·±å†™çš„é©±åŠ¨ç»“æ„ä½“é‡Œçš„ <code>probe</code> å³å¯ã€‚ä½†æ˜¯æˆ‘ä»¬è¦æ˜ç™½ï¼Œè°ƒç”¨æ ˆä¼šå…ˆç»è¿‡æ€»çº¿å±‚ï¼Œç„¶åæ‰è¿›è¡Œåé¢çš„æ“ä½œçš„ã€‚</p>
<h3 data-id="heading-6">1.5 ç§æœ‰æ•°æ®</h3>
<p><code>struct bus_type</code>ç»“æ„ä½“é‚£å¼ æˆªå›¾çš„ç¬¬ 151 è¡Œï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">subsys_private</span> *<span class="hljs-title">p</span>;</span>
</code></pre>
<p>ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æƒ³è¿‡ä¸€ä¸ªé—®é¢˜ï¼Œå‰é¢æˆ‘ä»¬è®²åˆ°æ€»çº¿é©±åŠ¨ç®¡ç†ç€ä¸¤ä¸ªé‡è¦çš„é“¾è¡¨ï¼Œä¸€ä¸ªæ˜¯è®¾å¤‡é“¾è¡¨ï¼Œå¦ä¸€ä¸ªæ˜¯é©±åŠ¨é“¾è¡¨ï¼Œé‚£è¿™ä¸¤ä¸ªé“¾è¡¨åˆ°åº•åœ¨å“ªå‘¢ï¼Ÿ</p>
<p>å…¶å®ï¼ŒLinux å†…æ ¸ä¸ºäº†å°è£…æ€§ï¼ŒæŠŠçœŸæ­£çš„æ•°æ®é“¾è¡¨è—åœ¨äº†è¿™ä¸ª <code>subsys_private</code> ç»“æ„ä½“é‡Œï¼Œä½†<code>struct subsys_private</code> è¿™ä¸ªç»“æ„ä½“çš„å®šä¹‰ä¸åœ¨å…¬å¼€çš„å¤´æ–‡ä»¶ <code>include/linux/device.h</code> é‡Œï¼Œè€Œæ˜¯è—åœ¨ä¸€ä¸ªç§æœ‰çš„å¤´æ–‡ä»¶ <code>drivers/base/base.h</code> ä¸­ï¼Œè¿™æ„å‘³ç€æ™®é€šé©±åŠ¨å¼€å‘è€…æ ¹æœ¬ä¸éœ€è¦å»ç›´æ¥è®¿é—®å®ƒã€‚æˆ‘æŠŠè¿™éƒ¨åˆ†çš„æºç æˆªå›¾è¿‡æ¥äº†ï¼Œå¤§å®¶è¯·çœ‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef6b9d7cc5994ed09bfb99de5d23b227~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768139212&amp;x-signature=5NpIXrPvDkdMjkKpAUVrRovophE%3D" alt="6. ä¸¤ä¸ªé“¾è¡¨çš„çœŸå®ä½ç½®.png" loading="lazy"/></p>
<p>è¯·çœ‹ç¬¬ 36 å’Œ 37 ä¸¤è¡Œï¼Œä»–ä»¬åˆ†åˆ«å°±æ˜¯<strong>è®¾å¤‡é“¾è¡¨</strong>å’Œ<strong>é©±åŠ¨é“¾è¡¨</strong>ã€‚</p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆè¦æŠŠè¿™ä¸¤ä¸ªé“¾è¡¨è—çš„è¿™ä¹ˆæ·±å‘¢ï¼Ÿè¿™å…¶å®æ˜¯ä¸ºäº†<strong>å®‰å…¨</strong>å’Œ<strong>ç¨³å®š</strong>ã€‚å†™å†…æ ¸çš„äºº<strong>ä¸å¸Œæœ›</strong>ç¼–å†™é©±åŠ¨æ—¶èƒ½ç›´æ¥å»æ“ä½œè¿™ä¸¤ä¸ªé“¾è¡¨ï¼ˆæ¯”å¦‚æ‰‹åŠ¨éå†é“¾è¡¨ã€æ‰‹åŠ¨æ’å…¥èŠ‚ç‚¹ï¼‰ï¼Œå› ä¸ºè¿™ç§ç›´æ¥æ“ä½œæ˜¯éå¸¸å±é™©çš„ï¼Œå®¹æ˜“å¯¼è‡´å¹¶å‘ç«äº‰æˆ–é“¾è¡¨æŸåã€‚ä»–å¸Œæœ›é€šè¿‡æ ‡å‡†çš„ API æ¥é—´æ¥æ“ä½œè¿™äº›é“¾è¡¨ï¼Œè¿™äº› API å†…éƒ¨ä¼šå¤„ç†å¥½é”ã€å¼•ç”¨è®¡æ•°ç­‰å¤æ‚çš„ç»†èŠ‚ï¼Œä»è€Œä¿è¯æ“ä½œçš„å®‰å…¨æ€§ã€‚</p>
<h2 data-id="heading-7">2 è®¾å¤‡</h2>
<p>åœ¨å†…æ ¸ä¸­ï¼Œè®¾å¤‡ç”± <code>struct device</code> ç»“æ„ä½“è¡¨ç¤ºã€‚è¿™é‡Œæ˜¯å°†ä¸€ä¸ªå…·ä½“çš„ç¡¬ä»¶è®¾å¤‡çš„ç‰©ç†å±æ€§æŠ½è±¡ä¸ºä¸€ä¸ªç»“æ„ä½“ï¼Œä¸»è¦æ˜¯ä¸ºäº†å‘å†…æ ¸æè¿°<strong>ç¡¬ä»¶éƒ½æœ‰ä»€ä¹ˆ</strong>ã€‚</p>
<p>è¿™ä¸ªç»“æ„ä½“é‡Œé¢åŒ…å«ç€è®¾å¤‡åç§°ã€æ€»çº¿ ID å’Œè®¾å¤‡æ ‘ä¸­çš„ <code>compatible</code> å±æ€§ï¼Œç”¨äºåŒ¹é…é©±åŠ¨ï¼Œè¿˜åŒ…å«è®¾å¤‡å ç”¨çš„ç‰©ç†åœ°å€ã€ä¸­æ–­å·ã€æ—¶é’Ÿç­‰èµ„æºä¿¡æ¯ã€‚</p>
<p>åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¯¹äºå¹³å°è®¾å¤‡ï¼Œè¿™äº›è®¾å¤‡å¯¹è±¡é€šå¸¸ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±åœ¨ C ä»£ç ä¸­å®šä¹‰ï¼Œè€Œæ˜¯ç”±å†…æ ¸åœ¨å¯åŠ¨æ—¶è§£æ<strong>è®¾å¤‡æ ‘</strong>è‡ªåŠ¨ç”Ÿæˆå¹¶æ³¨å†Œåˆ°ç›¸åº”çš„æ€»çº¿ä¸Šã€‚</p>
<p>åœ¨ Linux å†…æ ¸ä¸­ï¼Œå¯¹äºè®¾å¤‡çš„æè¿°é‡‡ç”¨äº†<strong>åŸºç±» + å­ç±»</strong>çš„é¢å‘å¯¹è±¡è®¾è®¡æ€æƒ³ã€‚</p>
<h3 data-id="heading-8">2.1 é€šç”¨è®¾å¤‡åŸºç±»ï¼šstruct device</h3>
<p>æ— è®ºæ˜¯ USB é¼ æ ‡ã€I2C ä¼ æ„Ÿå™¨ï¼Œè¿˜æ˜¯ SoC å†…éƒ¨çš„ GPIO ï¼Œåœ¨å†…æ ¸çœ¼é‡Œï¼Œé¦–å…ˆä»–ä»¬éƒ½æ˜¯ä¸€ä¸ª <code>struct device</code>ã€‚è¿™æ˜¯ Linux è®¾å¤‡æ¨¡å‹ä¸­<strong>æœ€åŸºç¡€</strong>çš„æ•°æ®ç»“æ„ã€‚</p>
<p><code>struct device</code>ç»“æ„ä½“çš„å†…æ ¸æºç ç›®å½•å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/kernel/include/linux/device.h
</code></pre>
<p>æºç æˆªå›¾å¦‚ä¸‹ï¼Œç”±äºè¿™ä¸ªç»“æ„ä½“æ¯”è¾ƒé•¿ï¼Œæˆ‘åªæˆªå–äº†åŒ…å«æˆ‘ä»¬éœ€è¦äº†è§£çš„æˆå‘˜çš„éƒ¨åˆ†å†…å®¹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27ba5b9c919a4fdebf224543b8d4302b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768139212&amp;x-signature=6gHnFfuJOxkh%2Ba4YrBFXPpKlHnk%3D" alt="7. deviceæºç ï¼ˆ1ï¼‰.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9af3a42f9f9d4f439d2e4b72fc7752d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768139212&amp;x-signature=8WiBNebVoSG01SSNq86pw79KnHc%3D" alt="8. deviceæºç ï¼ˆ2ï¼‰.png" loading="lazy"/></p>
<p><strong>å…ˆæ¥çœ‹ 1032 è¡Œï¼š</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">device</span> *<span class="hljs-title">parent</span>;</span>
</code></pre>
<p>è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘è®¾å¤‡çš„çˆ¶è®¾å¤‡ï¼Œå®ƒæ˜¯æ„å»ºæ•´ä¸ªç³»ç»Ÿè®¾å¤‡æ ‘çš„å…³é”®ï¼ŒLinux çš„è®¾å¤‡ä¸æ˜¯å­¤ç«‹çš„ï¼Œè€Œæ˜¯æœ‰å±‚æ¬¡å…³ç³»çš„ï¼Œæ¯”å¦‚ SoC ä¸Šçš„ UART æ§åˆ¶å™¨æ˜¯ <code>platform bus</code> çš„å­è®¾å¤‡ï¼Œè€Œ UART æ§åˆ¶å™¨<strong>ä¸‹é¢çš„ä¸²å£è®¾å¤‡</strong>åˆæ˜¯å®ƒçš„å­è®¾å¤‡ã€‚æ­£æ˜¯å› ä¸ºè¿™ä¸ª <code>parent</code> æŒ‡é’ˆï¼Œå†…æ ¸æ‰èƒ½åœ¨ <code>/sys/devices/</code> ä¸‹æ„å»ºå‡ºçœŸå®çš„ç¡¬ä»¶æ‹“æ‰‘ç»“æ„ã€‚è¿™æ•´ä¸ªæ ‘çŠ¶ç»“æ„ï¼Œå°±æ˜¯ç”±æ— æ•° <code>struct device</code> çš„ <code>parent</code> æŒ‡é’ˆä¸²è”èµ·æ¥çš„ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/219f2f1fd9de4b22b0220c5ce80554e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768139212&amp;x-signature=soB7924bWNUbWpzyeGhHgFDyYQY%3D" alt="9. æ‹“æ‰‘ç»“æ„.png" loading="lazy"/></p>
<p>1034 è¡Œçš„ç§æœ‰ç»“æ„ä½“æ­£æ˜¯ä¸Šä¸€èŠ‚æåˆ°çš„å­˜æ”¾è®¾å¤‡é“¾è¡¨å’Œé©±åŠ¨é“¾è¡¨çš„åœ°æ–¹ã€‚</p>
<p><strong>å†æ¥çœ‹ 1036 è¡Œï¼š</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">kobject</span> <span class="hljs-title">kobj</span>;</span>
</code></pre>
<p>è¿™æ˜¯ Linux é©±åŠ¨æ¨¡å‹ä¸­æœ€åº•å±‚çš„å•å…ƒï¼Œæ¯ä¸€ä¸ª <code>kobject</code> éƒ½å¯¹åº” Sysfs æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ª<strong>ç›®å½•</strong>ï¼Œæ­£æ˜¯å› ä¸º <code>struct device</code> é‡ŒåŒ…å«äº†å®ƒï¼Œæˆ‘ä»¬æ‰èƒ½åœ¨ <code>/sys/devices/</code> ä¸‹çœ‹åˆ°å„ç§è®¾å¤‡çš„æ–‡ä»¶å¤¹ã€‚</p>
<p><strong>1044 è¡Œï¼š</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bus_type</span> *<span class="hljs-title">bus</span>;</span>
</code></pre>
<p>è®¾å¤‡æ³¨å†Œæ—¶ï¼Œå†…æ ¸ä¼šæ ¹æ®è¿™ä¸ªæŒ‡é’ˆï¼ŒæŠŠè®¾å¤‡æŒ‚è½½åˆ°å¯¹åº”æ€»çº¿çš„è®¾å¤‡é“¾è¡¨ä¸Šå»ã€‚</p>
<p><strong>1045 è¡Œï¼š</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">device_driver</span> *<span class="hljs-title">driver</span>;</span>
</code></pre>
<p>è¿™æ˜¯è®¾å¤‡å½“å‰ç»‘å®šçš„é©±åŠ¨æŒ‡é’ˆï¼Œå½“ <code>match</code> æˆåŠŸå¹¶ <code>probe</code> å®Œæˆåï¼Œå†…æ ¸å°±ä¼šæŠŠé©±åŠ¨æŒ‚åœ¨è¿™é‡Œï¼Œä»è¿™ä¸€åˆ»èµ·ï¼Œè®¾å¤‡å°±æ´»äº†ï¼Œé©±åŠ¨å°±æ˜¯ä»ç°åœ¨å¼€å§‹å¯ä»¥æ“ä½œç¡¬ä»¶çš„ã€‚</p>
<p><strong>1092 è¡Œï¼š</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">device_node</span> *<span class="hljs-title">of_node</span>;</span>
</code></pre>
<p>è¿™æ˜¯<strong>è¿æ¥è®¾å¤‡æ ‘ä¸è®¾å¤‡é©±åŠ¨æ¨¡å‹çš„å…³é”®</strong>ã€‚å½“å†…æ ¸è§£æè®¾å¤‡æ ‘æ—¶ï¼Œä¼šä¸ºæ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆä¸€ä¸ªè®¾å¤‡æ ‘èŠ‚ç‚¹ <code>device_node</code> ç»“æ„ä½“ï¼Œå½“éšååˆ›å»º <code>struct device</code> æ—¶ï¼Œè¿™ä¸ªæŒ‡é’ˆå°±ä¼šæŒ‡å‘å¯¹åº”çš„ <code>device_node</code>ã€‚é€šè¿‡å®ƒï¼Œé©±åŠ¨å¯ä»¥åœ¨ <code>probe()</code> ä¸­ç”¨ <code>of_match_device()</code> è·å– <code>compatible</code>ã€‚</p>
<h3 data-id="heading-9">2.2 å¹³å°è®¾å¤‡å­ç±» struct platform_device</h3>
<p>åœ¨åµŒå…¥å¼ Linux ä¸­ï¼Œæˆ‘ä»¬å¾ˆå°‘ç›´æ¥æ“ä½œ <code>struct device</code>ï¼Œè€Œæ˜¯ä½¿ç”¨å®ƒçš„å­ç±»ï¼Œä¹Ÿå°±æ˜¯<strong>å¹³å°è®¾å¤‡</strong> ã€‚</p>
<p>è¿™æ˜¯å› ä¸º Soc å†…éƒ¨çš„å¤–è®¾ï¼ˆå¦‚ GPIOã€UARTã€I2C ç­‰ï¼‰æ˜¯ç›´æ¥ä¾é™„äº CPU å†…å­˜ç©ºé—´çš„ï¼Œå®ƒä»¬æ²¡æœ‰åƒ USB é‚£æ ·å¤æ‚çš„ç‰©ç†æ€»çº¿åè®®ã€‚å› æ­¤ï¼ŒLinux è®¾è®¡äº† Platform æ€»çº¿ä½“ç³»ã€‚</p>
<p>å®ƒçš„æºç ä½ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/kernel/include/linux/platform_device.h
</code></pre>
<p>è¿™ä¸ªç»“æ„ä½“é•¿è¿™æ ·ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/556ea5f3de0b43408ed1f0a471a6bde8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768139212&amp;x-signature=rqnuRA3BUTmR4v%2F%2BKLVUAryarg0%3D" alt="10. å¹³å°è®¾å¤‡ç»“æ„ä½“.png" loading="lazy"/></p>
<p><strong>ç¬¬ 27 è¡Œï¼š</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">device</span> <span class="hljs-title">dev</span>;</span> 
</code></pre>
<p>åœ¨ C è¯­è¨€ä¸­ï¼ŒLinux å†…æ ¸é€šè¿‡<strong>åœ¨ä¸€ä¸ªç»“æ„ä½“ä¸­å†…åµŒå¦ä¸€ä¸ªç»“æ„ä½“</strong>æ¥å®ç°<strong>ç»§æ‰¿</strong>ã€‚</p>
<p><code>platform_device</code> <strong>åŒ…å«</strong>äº† <code>device</code>ï¼Œè¿™æ„å‘³ç€æ‹¥æœ‰äº† <code>platform_device</code>ï¼Œå°±å¤©ç„¶æ‹¥æœ‰äº† <code>device</code> çš„æ‰€æœ‰å±æ€§ï¼Œåœ¨ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸çœ‹åˆ° <code>&amp;pdev-&gt;dev</code> è¿™æ ·çš„å†™æ³•ï¼Œè¿™å…¶å®å°±æ˜¯åœ¨è®¿é—®åŸºç±»æˆå‘˜ã€‚</p>
<h3 data-id="heading-10">2.3 ç¡¬ä»¶èµ„æº</h3>
<p><code>struct platform_device</code> ä¸­è¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„æˆå‘˜ï¼Œå°±æ˜¯<code>struct resource *resource</code>ï¼Œåœ¨ä¸Šé¢é‚£å¼ ä»£ç æˆªå›¾çš„ç¬¬ 29 è¡Œã€‚</p>
<p>è¿™ä¸ªç»“æ„ä½“åœ¨ä¸‹é¢æ–‡ä»¶é‡Œé¢ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">kernel/include/linux/ioport.h
</code></pre>
<p>ä»£ç æˆªå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e629c84cebde46d38ac118611d5026c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768139212&amp;x-signature=DuAgo8MAMA5e9vxxip8AALh%2BPNU%3D" alt="11. ç¡¬ä»¶ç»“æ„ä½“.png" loading="lazy"/></p>
<p>åœ¨æ²¡æœ‰è®¾å¤‡æ ‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ C ä»£ç ä¸­æ‰‹åŠ¨å¡«å†™è¿™ä¸ªç»“æ„ä½“ï¼Œå‘Šè¯‰é©±åŠ¨å¯„å­˜å™¨åœ°å€çš„<strong>èµ·å§‹ä½ç½®</strong>å’Œ<strong>ç»“æŸä½ç½®</strong>ï¼Œ<strong>ä¸­æ–­å·</strong>ç­‰ç­‰ã€‚</p>
<p>ç°åœ¨æœ‰äº†è®¾å¤‡æ ‘ï¼Œæˆ‘ä»¬å¾ˆå°‘æ‰‹åŠ¨å¡«å……å®ƒï¼Œä½†å†…æ ¸åœ¨è§£æè®¾å¤‡æ ‘æ—¶ï¼Œä¾ç„¶ä¼šè‡ªåŠ¨æŠŠè®¾å¤‡æ ‘é‡Œçš„ <code>reg</code> å±æ€§è½¬æ¢æˆ <code>IORESOURCE_MEM</code> ç±»å‹çš„ <code>resource</code>ï¼ŒæŠŠ <code>interrupts</code> å±æ€§è½¬æ¢æˆ <code>IORESOURCE_IRQ</code> ç±»å‹çš„ <code>resource</code>ï¼Œå¡«å…¥è¿™ä¸ªç»“æ„ä½“ä¸­ã€‚æ‰€ä»¥åœ¨é©±åŠ¨ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ç”¨ <code>platform_get_resource()</code> æ¥è·å–è¿™äº›èµ„æºï¼Œåœ¨ä¼ ç»Ÿçš„é©±åŠ¨å¼€å‘ä¸­ï¼Œè¿™æ˜¯è·å–å¯„å­˜å™¨åŸºåœ°å€çš„æ ‡å‡†æ–¹æ³•ã€‚</p>
<h3 data-id="heading-11">2.4 è®¾å¤‡çš„æ³¨å†Œé€»è¾‘</h3>
<p>å½“æˆ‘ä»¬å‡†å¤‡å¥½æˆ–è€…å†…æ ¸é€šè¿‡è§£æè®¾å¤‡æ ‘ä»£ç å‡†å¤‡å¥½äº† <code>platform_device</code> åï¼Œéœ€è¦è°ƒç”¨ <code>platform_device_register()</code> å°†å…¶æ³¨å†Œåˆ°å†…æ ¸ã€‚</p>
<p>è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œé¦–å…ˆä¼šè°ƒç”¨<code>device_add()</code>ï¼Œ<code>device_add()</code> ä¼šå°†è®¾å¤‡åŠ å…¥åˆ° <code>platform_bus</code> çš„ <code>klist_devices</code> é“¾è¡¨ï¼ˆä¸Šé¢è®²è¿‡çš„è®¾å¤‡é“¾è¡¨ï¼‰ä¸­ï¼Œè¿˜ä¼šåˆ›å»º sysfs ç›®å½• (<code>/sys/devices/...</code>)ï¼Œè§¦å‘ uevent ç­‰ï¼Œæœ€ç»ˆ <code>device_add()</code> ä¼šè°ƒç”¨ <code>bus_probe_device()</code>ï¼Œè¿™ä¸ªå‡½æ•°ä¼šéå†è¯¥æ€»çº¿ä¸Šçš„æ‰€æœ‰é©±åŠ¨ï¼Œå¹¶è°ƒç”¨æ€»çº¿çš„ <code>match</code> å‡½æ•°è¿›è¡ŒåŒ¹é…ã€‚</p>
<h2 data-id="heading-12">3 é©±åŠ¨</h2>
<p>åœ¨å†…æ ¸ä¸­ï¼Œé©±åŠ¨ç”± <code>struct device_driver</code> ç»“æ„ä½“è¡¨ç¤ºã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯<strong>ç¡¬ä»¶çš„æ“ä½œæ–¹æ³•</strong>ï¼Œä¸»è¦èŒè´£æ˜¯ä¸ºäº†å‘Šè¯‰å†…æ ¸<strong>è½¯ä»¶åº”è¯¥æ€ä¹ˆåš</strong>ã€‚</p>
<p>è¿™ä¸ªç»“æ„ä½“é‡Œé¢å£°æ˜äº†è¯¥é©±åŠ¨èƒ½å¤Ÿæ”¯æŒçš„è®¾å¤‡åˆ—è¡¨ï¼Œè¿˜æœ‰ä¸€äº›å›è°ƒå‡½æ•°ã€‚</p>
<p>å’Œè®¾å¤‡ä¸€æ ·ï¼Œé©±åŠ¨åœ¨å†…æ ¸ä¸­ä¹Ÿé‡‡ç”¨äº†<strong>åŸºç±» + å­ç±»</strong>çš„è®¾è®¡æ¨¡å¼ã€‚</p>
<h3 data-id="heading-13">3.1 é€šç”¨é©±åŠ¨åŸºç±» struct device_driver</h3>
<p><code>struct device_driver</code> æ˜¯æ‰€æœ‰é©±åŠ¨ç¨‹åºçš„åŸºç¡€ï¼Œæ— è®ºæ˜¯ USB é©±åŠ¨ã€I2C é©±åŠ¨è¿˜æ˜¯ Platform é©±åŠ¨ï¼Œå®ƒä»¬çš„æ ¸å¿ƒéƒ½æ˜¯è¿™ä¸ªç»“æ„ä½“ã€‚</p>
<p>å®ƒçš„æºç ä½ç½®åœ¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/kernel/include/linux/device.h
</code></pre>
<p>æºç æˆªå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f9f4caa5d3642909911b410a0697b96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768139212&amp;x-signature=zqX6q6ozsRQTCx847QdStZVJzPk%3D" alt="12. device_driverç»“æ„ä½“.png" loading="lazy"/></p>
<p><strong>ç¬¬ 299 è¡Œï¼š</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *name;
</code></pre>
<p>è¿™æ—¶é©±åŠ¨çš„åå­—ï¼Œåœ¨ <code>/sys/bus/platform/drivers/</code> ç›®å½•ä¸‹æ˜¾ç¤ºçš„é©±åŠ¨æ–‡ä»¶å¤¹åå­—å°±æ˜¯å®ƒã€‚åœ¨æ²¡æœ‰è®¾å¤‡æ ‘çš„æ—¶ä»£ï¼Œè¿™ä¸ªåå­—å¿…é¡»å’Œè®¾å¤‡çš„åå­—å®Œå…¨ä¸€æ ·æ‰èƒ½åŒ¹é…æˆåŠŸã€‚</p>
<p><strong>ç¬¬ 300 è¡Œï¼š</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">bus_type</span> *<span class="hljs-title">bus</span>;</span>
</code></pre>
<p>è¿™æ˜¯é©±åŠ¨æ‰€å½’å±çš„æ€»çº¿ï¼Œé©±åŠ¨æ³¨å†Œæ—¶ï¼Œå†…æ ¸éœ€è¦çŸ¥é“æŠŠå®ƒæŒ‚åœ¨å“ªæ¡æ€»çº¿çš„<strong>é©±åŠ¨é“¾è¡¨</strong>ä¸Šã€‚</p>
<p><strong>ç¬¬ 308 è¡Œï¼š</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">const</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">of_device_id</span> *<span class="hljs-title">of_match_table</span>;</span>
</code></pre>
<p>è¿™æ˜¯<strong>é©±åŠ¨ä¸è®¾å¤‡æ ‘èŠ‚ç‚¹è¿›è¡ŒåŒ¹é…</strong>çš„å…³é”®ã€‚å†…æ ¸åœ¨è¿›è¡Œ <code>match</code> æ“ä½œæ—¶ï¼Œä¼šæ‹¿è®¾å¤‡æ ‘èŠ‚ç‚¹çš„ <code>compatible</code> å±æ€§å’Œè¿™ä¸ªè¡¨é‡Œçš„å­—ç¬¦ä¸²è¿›è¡Œæ¯”å¯¹ã€‚</p>
<p><strong>ç¬¬ 311 è¡Œï¼š</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> (*probe) (<span class="hljs-keyword">struct</span> device *dev);
</code></pre>
<p>å½“æ€»çº¿ <code>match</code> æˆåŠŸåï¼Œå°±ä¼šè°ƒç”¨è¿™é‡Œçš„ <code>probe</code>ã€‚</p>
<p><strong>ç¬¬ 313 è¡Œï¼š</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> (*remove) (<span class="hljs-keyword">struct</span> device *dev);
</code></pre>
<p>å½“é©±åŠ¨æ¨¡å—å¸è½½æˆ–è®¾å¤‡è¢«ç§»é™¤æ—¶è°ƒç”¨ã€‚</p>
<h3 data-id="heading-14">3.2 å¹³å°é©±åŠ¨å­ç±» struct platform_driver</h3>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥æ‰“äº¤é“çš„é€šå¸¸æ˜¯ <code>struct platform_driver</code>ï¼Œå®ƒæ˜¯å¯¹é€šç”¨é©±åŠ¨çš„è¿›ä¸€æ­¥å°è£…ï¼Œä¸“é—¨ç”¨äºå¹³å°æ€»çº¿ã€‚</p>
<p>è¿™ä¸ªç»“æ„ä½“åœ¨æºç ä¸­çš„ä½ç½®ä¸ºï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/kernel/include/linux/platform_device.h
</code></pre>
<p>æºç æˆªå›¾å¦‚ä¸‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/844dc57ac97046c79384c9a4e49097ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGxwNjY2aHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768139212&amp;x-signature=moR8tstycyHPybhiA47baLwmvn0%3D" alt="13. å¹³å°é©±åŠ¨ç»“æ„ä½“.png" loading="lazy"/></p>
<p><strong>ç¬¬ 184 è¡Œï¼š</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-type">int</span> (*probe)(<span class="hljs-keyword">struct</span> platform_device *);
</code></pre>
<p>è¿™æ˜¯æˆ‘ä»¬ç¼–å†™é©±åŠ¨æ—¶æœ€ç†Ÿæ‚‰çš„ <code>probe</code> å‡½æ•°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒçš„å‚æ•°æ˜¯ <code>platform_device</code> æŒ‡é’ˆï¼Œè€Œä¸æ˜¯é€šç”¨çš„ <code>device</code> æŒ‡é’ˆï¼Œè¿™å…¶å®æ˜¯å†…æ ¸ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨ï¼Œåšäº†ä¸€å±‚å°è£…ï¼Œä½†æ˜¯åº•å±‚è¿˜æ˜¯é€šç”¨çš„ï¼Œåªæ˜¯ä¼ å‚æ—¶è½¬åŒ–äº†ä¸€ä¸‹ã€‚</p>
<p><strong>ç¬¬ 189 è¡Œï¼š</strong></p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">device_driver</span> <span class="hljs-title">driver</span>;</span>
</code></pre>
<p>è¿™é‡Œå†æ¬¡ä½¿ç”¨ C è¯­è¨€å®ç°ç»§æ‰¿ï¼Œ <code>platform_driver</code> å†…éƒ¨ç›´æ¥å†…åµŒäº†ä¸€ä¸ª <code>device_driver</code>ã€‚ æˆ‘ä»¬åœ¨ç¼–å†™é©±åŠ¨æ—¶ï¼Œåˆå§‹åŒ–çš„ <code>.driver</code> æˆå‘˜ï¼ŒåŒ…æ‹¬ <code>.name</code> å’Œ <code>.of_match_table</code>ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨è¿™ä¸ªå†…åµŒçš„åŸºç±»é‡Œè®¾ç½®çš„ã€‚</p>
<h3 data-id="heading-15">3.3 é©±åŠ¨æ³¨å†Œé€»è¾‘</h3>
<p>åœ¨ç¼–å†™é©±åŠ¨æ–‡ä»¶çš„å…¥å£å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬è°ƒç”¨äº† <code>platform_driver_register</code>ã€‚</p>
<p>è€Œ <code>platform_driver_register</code> æœ€ç»ˆä¼šè°ƒç”¨ <code>driver_register</code>ï¼Œå°†æˆ‘ä»¬çš„é©±åŠ¨æ·»åŠ åˆ° Platform æ€»çº¿çš„ <code>klist_drivers</code> é“¾è¡¨ä¸­ã€‚</p>
<p>é©±åŠ¨æ³¨å†Œåï¼Œå†…æ ¸ä¼šç«‹å³è°ƒç”¨ <code>driver_attach</code> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šéå†<strong>åŒä¸€æ¡æ€»çº¿ä¸Šçš„è®¾å¤‡é“¾è¡¨</strong>ã€‚</p>
<p>å¯¹äºæ¯ä¸€ä¸ªè®¾å¤‡ï¼Œæ€»çº¿éƒ½ä¼šè°ƒç”¨ <code>platform_match</code> å‡½æ•°ï¼Œå®ƒä¼šæ‹¿å‡ºé©±åŠ¨çš„ <code>of_match_table</code>å»å’Œè®¾å¤‡çš„ <code>of_node</code>é‡Œçš„ <code>compatible</code> å±æ€§æ¯”å¯¹ã€‚</p>
<p>ä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œå†…æ ¸å°±ä¼šè°ƒç”¨ <code>driver_probe_device</code>ï¼Œæœ€ç»ˆæ‰§è¡Œæˆ‘ä»¬å†™çš„ <code>led_probe</code> å‡½æ•°ã€‚æ­¤æ—¶ï¼Œç¡¬ä»¶èµ„æºå’Œè½¯ä»¶é€»è¾‘æ­£å¼ç»“åˆï¼Œé©±åŠ¨å¼€å§‹å·¥ä½œã€‚</p>
<p>è‡³æ­¤ï¼Œè®¾å¤‡æ¨¡å‹çš„ä¸‰å¤§ç»„ä»¶å®Œæˆäº†é—­ç¯ï¼šæ€»çº¿è´Ÿè´£åŒ¹é…ï¼Œè®¾å¤‡æä¾›èµ„æºï¼Œé©±åŠ¨æä¾›é€»è¾‘ã€‚<code>probe</code> å‡½æ•°çš„æ‰§è¡Œï¼Œæ ‡å¿—ç€é©±åŠ¨æ­£å¼æ¥ç®¡äº†è®¾å¤‡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot + æ‰§è¡Œç®¡é“ï¼šè®©ä¸šåŠ¡æµç¨‹æ¸…æ™°å¯æ§]]></title>    <link>https://juejin.cn/post/7591350620189130758</link>    <guid>https://juejin.cn/post/7591350620189130758</guid>    <pubDate>2026-01-05T00:14:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620189130758" data-draft-id="7589903248620748826" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot + æ‰§è¡Œç®¡é“ï¼šè®©ä¸šåŠ¡æµç¨‹æ¸…æ™°å¯æ§"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2026-01-05T00:14:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£è±¡å—"/> <meta itemprop="url" content="https://juejin.cn/user/2524134428655159"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot + æ‰§è¡Œç®¡é“ï¼šè®©ä¸šåŠ¡æµç¨‹æ¸…æ™°å¯æ§
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2524134428655159/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£è±¡å—
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:14:16.000Z" title="Mon Jan 05 2026 00:14:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰é‡åˆ°è¿‡è¿™ç§æƒ…å†µï¼šä¸€ä¸ªè®¢å•åˆ›å»ºçš„æ¥å£ï¼Œåˆšä¸Šçº¿çš„æ—¶å€™åªæœ‰å‡ åè¡Œä»£ç ï¼Œé€»è¾‘ä¹Ÿå¾ˆç®€å•ã€‚ä½†éšç€ä¸šåŠ¡è¿­ä»£ï¼Œä¸‰ä¸ªæœˆåå˜æˆäº†è¿™æ ·ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">createOrder</span><span class="hljs-params">(OrderRequest request)</span> {
    <span class="hljs-comment">// å‚æ•°æ ¡éªŒ</span>
    <span class="hljs-keyword">if</span> (request.getUserId() == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"ç”¨æˆ·IDä¸èƒ½ä¸ºç©º"</span>);
    }
    <span class="hljs-comment">// ... çœç•¥ 20 è¡Œæ ¡éªŒä»£ç </span>

    <span class="hljs-comment">// æƒé™æ ¡éªŒ</span>
    <span class="hljs-keyword">if</span> (!checkPermission(request.getUserId())) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForbiddenException</span>(<span class="hljs-string">"æ— æƒé™"</span>);
    }

    <span class="hljs-comment">// ä¸šåŠ¡æ ¡éªŒ</span>
    <span class="hljs-keyword">if</span> (getOrderCount(request.getUserId()) &gt;= <span class="hljs-number">10</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"è®¢å•æ•°é‡è¶…é™"</span>);
    }
    <span class="hljs-comment">// ... çœç•¥ 15 è¡Œä¸šåŠ¡æ ¡éªŒ</span>

    <span class="hljs-comment">// åˆ›å»ºè®¢å•</span>
    <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> buildOrder(request);
    orderMapper.insert(order);

    <span class="hljs-comment">// å†™æ“ä½œæ—¥å¿—</span>
    <span class="hljs-keyword">try</span> {
        operateLogService.log(order.getId(), <span class="hljs-string">"CREATE"</span>);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-comment">// æ—¥å¿—å¤±è´¥ä¸å½±å“ä¸»æµç¨‹</span>
        log.error(<span class="hljs-string">"å†™æ—¥å¿—å¤±è´¥"</span>, e);
    }

    <span class="hljs-comment">// å‘é€é€šçŸ¥</span>
    <span class="hljs-keyword">try</span> {
        notificationService.send(order);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        log.error(<span class="hljs-string">"å‘é€é€šçŸ¥å¤±è´¥"</span>, e);
    }

    <span class="hljs-comment">// å¼‚æ­¥é£æ§æ£€æŸ¥</span>
    asyncRiskCheckService.check(order);
}
</code></pre>
<p>å‡ ç™¾è¡Œä»£ç ï¼Œ<code>if</code>ã€<code>try-catch</code> åˆ°å¤„éƒ½æ˜¯ã€‚æ›´å¯æ€•çš„æ˜¯ï¼š</p>
<ul>
<li>æ—¥å¿—å†™å¤±è´¥è¦ä¸è¦æŠ›å¼‚å¸¸ï¼Ÿ</li>
<li>é€šçŸ¥å‘é€å¤±è´¥è¦ä¸è¦å›æ»šè®¢å•ï¼Ÿ</li>
<li>æ–°å¢ä¸€ä¸ª"ä¼˜æƒ åˆ¸æ ¸é”€"é€»è¾‘åŠ åœ¨å“ªé‡Œï¼Ÿ</li>
<li>æµ‹è¯•ç¯å¢ƒæƒ³å…³é—­é£æ§æ£€æŸ¥æ€ä¹ˆæï¼Ÿ</li>
</ul>
<h2 data-id="heading-0">é—®é¢˜å‡ºåœ¨å“ªï¼Ÿ</h2>
<p>ä»”ç»†çœ‹çœ‹ä¸Šé¢çš„ä»£ç ï¼Œå…¶å®å®ƒæƒ³åšçš„äº‹æƒ…å¯ä»¥æ‹†æˆè¿™ä¹ˆå‡ ä¸ªæ­¥éª¤ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ ¡éªŒå‚æ•°
<span class="hljs-bullet">2.</span> æ ¡éªŒæƒé™
<span class="hljs-bullet">3.</span> æ ¡éªŒä¸šåŠ¡è§„åˆ™
<span class="hljs-bullet">4.</span> åˆ›å»ºè®¢å•ï¼ˆæ ¸å¿ƒï¼‰
<span class="hljs-bullet">5.</span> è®°å½•æ—¥å¿—
<span class="hljs-bullet">6.</span> å‘é€é€šçŸ¥
<span class="hljs-bullet">7.</span> é£æ§æ£€æŸ¥
</code></pre>
<p>è¿™äº›æ­¥éª¤æœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š</p>
<p><strong>æœ‰çš„å¿…é¡»æˆåŠŸ</strong>ï¼šæ¯”å¦‚å‚æ•°æ ¡éªŒã€è®¢å•åˆ›å»º
<strong>æœ‰çš„å¯ä»¥å¤±è´¥</strong>ï¼šæ¯”å¦‚æ—¥å¿—è®°å½•ã€é€šçŸ¥å‘é€
<strong>æœ‰çš„åŒæ­¥æ‰§è¡Œ</strong>ï¼šæ¯”å¦‚å„ç§æ ¡éªŒ
<strong>æœ‰çš„å¼‚æ­¥æ‰§è¡Œ</strong>ï¼šæ¯”å¦‚é£æ§æ£€æŸ¥
<strong>æœ‰çš„å¯èƒ½è¦å…³é—­</strong>ï¼šæ¯”å¦‚æµ‹è¯•ç¯å¢ƒä¸éœ€è¦é£æ§</p>
<p>ä½†ç°åœ¨çš„å†™æ³•ï¼Œæ‰€æœ‰è¿™äº›é€»è¾‘éƒ½æ··åœ¨ä¸€èµ·ï¼Œ<strong>é¡ºåºã€å¤±è´¥ç­–ç•¥ã€æ˜¯å¦å¯é€‰</strong>ï¼Œå…¨é ä»£ç é‡Œçš„ <code>if</code> å’Œ <code>try-catch</code> æ¥æ§åˆ¶ï¼Œèƒ½ä¸ä¹±å—ï¼Ÿ</p>
<h2 data-id="heading-1">æœ‰æ²¡æœ‰æ›´å¥½çš„å†™æ³•ï¼Ÿ</h2>
<p>å¦‚æœæŠŠè¿™äº›æ­¥éª¤æŠ½è±¡æˆä¸€ä¸ªä¸ª"èŠ‚ç‚¹"ï¼Œç„¶åç”¨ä¸€ä¸ª"ç®¡é“"æŠŠå®ƒä»¬ä¸²èµ·æ¥ï¼Œä¼šæ€æ ·ï¼Ÿ</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PipelineNode</span>&lt;T&gt; {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(PipelineContext&lt;T&gt; context)</span>;
}
</code></pre>
<p>æ¯ä¸ªèŠ‚ç‚¹åªåšä¸€ä»¶äº‹ï¼Œä¸å…³å¿ƒå‰åæ˜¯è°ï¼Œä¸å…³å¿ƒè‡ªå·±æ˜¯ç¬¬å‡ ä¸ªæ‰§è¡Œã€‚</p>
<p>ç„¶åå®šä¹‰ä¸€ä¸ªç®¡é“æ¥æ‰§è¡Œè¿™äº›èŠ‚ç‚¹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExecutionPipeline</span>&lt;T&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;PipelineNode&lt;T&gt;&gt; nodes;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(T data)</span> {
        PipelineContext&lt;T&gt; ctx = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PipelineContext</span>&lt;&gt;(data);
        <span class="hljs-keyword">for</span> (PipelineNode&lt;T&gt; node : nodes) {
            <span class="hljs-keyword">if</span> (ctx.isInterrupted()) {
                <span class="hljs-keyword">break</span>;
            }
            node.execute(ctx);
        }
    }
}
</code></pre>
<p>ç°åœ¨å†çœ‹çœ‹è®¢å•åˆ›å»ºæ€ä¹ˆå†™ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">Pipeline</span> <span class="hljs-variable">pipeline</span> <span class="hljs-operator">=</span> Pipeline.builder()
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ParamValidateNode</span>())       <span class="hljs-comment">// å‚æ•°æ ¡éªŒ</span>
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PermissionCheckNode</span>())     <span class="hljs-comment">// æƒé™æ ¡éªŒ</span>
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessValidateNode</span>())    <span class="hljs-comment">// ä¸šåŠ¡æ ¡éªŒ</span>
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CreateOrderNode</span>())         <span class="hljs-comment">// åˆ›å»ºè®¢å•</span>
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OperateLogNode</span>())          <span class="hljs-comment">// å†™æ—¥å¿—</span>
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NotificationNode</span>())        <span class="hljs-comment">// å‘é€šçŸ¥</span>
    .add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncRiskCheckNode</span>())      <span class="hljs-comment">// é£æ§æ£€æŸ¥</span>
    .build();

pipeline.execute(orderRequest);
</code></pre>
<p><strong>ä¸»æµç¨‹åªå‰©ä¸‹ 10 è¡Œä»£ç ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„é€»è¾‘ç‹¬ç«‹å°è£…ã€‚</strong></p>
<h2 data-id="heading-2">è¿™æ ·åšæœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</h2>
<h4 data-id="heading-3">1. èŠ‚ç‚¹å¯æ’æ‹”</h4>
<p>æƒ³åŠ ä¸€ä¸ª"ä¼˜æƒ åˆ¸æ ¸é”€"é€»è¾‘ï¼ŸåŠ ä¸ªèŠ‚ç‚¹å°±è¡Œäº†ï¼š</p>
<pre><code class="hljs language-java" lang="java">.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">CouponDeductNode</span>())
</code></pre>
<p>æƒ³å…³é—­æŸä¸ªåŠŸèƒ½ï¼Ÿå»æ‰å¯¹åº”èŠ‚ç‚¹ï¼Œæˆ–è€…é€šè¿‡é…ç½®æ§åˆ¶ï¼š</p>
<pre><code class="hljs language-java" lang="java">.add(env.isProd() ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">RiskCheckNode</span>() : <span class="hljs-keyword">new</span> <span class="hljs-title class_">SkipNode</span>())
</code></pre>
<h4 data-id="heading-4">2. å¤±è´¥ç­–ç•¥æ¸…æ™°</h4>
<p>åœ¨ <code>PipelineContext</code> é‡Œå®šä¹‰å¥½å¤±è´¥ç­–ç•¥ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">FailureStrategy</span> {
    CONTINUE,    <span class="hljs-comment">// å¤±è´¥åç»§ç»­æ‰§è¡Œ</span>
    STOP,        <span class="hljs-comment">// å¤±è´¥åä¸­æ–­ç®¡é“</span>
    ROLLBACK     <span class="hljs-comment">// å¤±è´¥åå›æ»šï¼ˆéœ€è¦é…åˆäº‹åŠ¡ï¼‰</span>
}
</code></pre>
<p>æ—¥å¿—èŠ‚ç‚¹çš„å¤±è´¥ç­–ç•¥æ˜¯ <code>CONTINUE</code>ï¼Œè®¢å•åˆ›å»ºèŠ‚ç‚¹çš„å¤±è´¥ç­–ç•¥æ˜¯ <code>STOP</code>ï¼Œä¸€ç›®äº†ç„¶ã€‚</p>
<h4 data-id="heading-5">3. èŠ‚ç‚¹å¯å¤ç”¨</h4>
<p>å‚æ•°æ ¡éªŒèŠ‚ç‚¹ã€æƒé™æ ¡éªŒèŠ‚ç‚¹ã€æ—¥å¿—èŠ‚ç‚¹ï¼Œéƒ½å¯ä»¥åœ¨å…¶ä»–ä¸šåŠ¡é‡Œå¤ç”¨ã€‚</p>
<h4 data-id="heading-6">4. æ‰§è¡Œé¡ºåºå¯æ§</h4>
<p>èŠ‚ç‚¹çš„æ‰§è¡Œé¡ºåºç”±ç®¡é“å®šä¹‰ï¼Œä¸ç”¨åœ¨æ¯ä¸ªèŠ‚ç‚¹é‡Œå†™ä»£ç æ§åˆ¶ã€‚</p>
<h2 data-id="heading-7">æ‰§è¡Œç®¡é“ï¼šä¸€ç§å·¥ç¨‹åŒ–æ–¹æ¡ˆ</h2>
<p>ä¸Šé¢ä»‹ç»çš„æ–¹æ¡ˆæ—¢<strong>æ‰§è¡Œç®¡é“ï¼ˆExecution Pipelineï¼‰</strong></p>
<p>å®ƒä¸æ˜¯æŸä¸ªæ¡†æ¶ï¼Œè€Œæ˜¯ä¸€ç§å·¥ç¨‹è®¾è®¡æ¨¡å¼ï¼šæŠŠä¸€æ¬¡ä¸šåŠ¡æ‰§è¡Œæ‹†æˆå¤šä¸ªå¯æ’æ‹”ã€æœ‰é¡ºåºã€å¯æ§åˆ¶çš„æ‰§è¡Œé˜¶æ®µï¼Œç”¨ç»Ÿä¸€æœºåˆ¶ä¸²èµ·æ¥ã€‚</p>
<h2 data-id="heading-8">å®ƒè·Ÿ AOPã€è´£ä»»é“¾æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2>
<p>ä½ å¯èƒ½æƒ³åˆ°äº† AOPã€è´£ä»»é“¾ã€å·¥ä½œæµå¼•æ“è¿™äº›æ¦‚å¿µï¼Œå®ƒä»¬ç¡®å®æœ‰ç›¸ä¼¼ä¹‹å¤„ï¼š</p>



































<table><thead><tr><th>æ–¹æ¡ˆ</th><th>é€‚ç”¨åœºæ™¯</th><th>å±€é™æ€§</th></tr></thead><tbody><tr><td>AOP</td><td>é€šç”¨çš„æ¨ªåˆ‡é€»è¾‘ï¼ˆæ—¥å¿—ã€äº‹åŠ¡ï¼‰</td><td>é¡ºåºä¸ç›´è§‚ï¼Œéš¾ä»¥åšæµç¨‹æ§åˆ¶</td></tr><tr><td>Filter/Interceptor</td><td>HTTP è¯·æ±‚çº§åˆ«çš„å¤„ç†</td><td>åªèƒ½ç”¨äºè¯·æ±‚å¤„ç†</td></tr><tr><td>@Async</td><td>å¼‚æ­¥æ‰§è¡Œ</td><td>åªè§£å†³å¹¶å‘ï¼Œä¸è§£å†³æµç¨‹ç¼–æ’</td></tr><tr><td>è´£ä»»é“¾</td><td>åŠ¨æ€ç»„åˆå¤„ç†é€»è¾‘</td><td>ç¼ºå°‘å·¥ç¨‹åŒ–å°è£…</td></tr><tr><td>å·¥ä½œæµå¼•æ“</td><td>å¤æ‚çš„ä¸šåŠ¡æµç¨‹</td><td>å¤ªé‡ï¼Œå•æœºåº”ç”¨ç”¨ä¸ä¸Š</td></tr></tbody></table>
<p>æ‰§è¡Œç®¡é“å¯ä»¥è¯´æ˜¯<strong>å·¥ç¨‹åŒ–çš„è´£ä»»é“¾æ¨¡å¼</strong>ï¼Œä¸“é—¨ç”¨äºè§£å†³å•æœºåº”ç”¨å†…çš„ä¸šåŠ¡æµç¨‹ç¼–æ’é—®é¢˜ã€‚</p>
<h2 data-id="heading-9">ä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿ</h2>
<p>ä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½éœ€è¦æ‰§è¡Œç®¡é“ã€‚å¦‚æœä½ çš„ä»£ç ï¼š</p>
<ul>
<li>æ­¥éª¤å›ºå®šã€é€»è¾‘ç®€å•ï¼Œç›´æ¥å†™å°±è¡Œ</li>
<li>æµç¨‹å¤æ‚ä½†ä¸ä¼šå˜åŒ–ï¼Œä¹Ÿæ²¡å¿…è¦è¿‡åº¦è®¾è®¡</li>
</ul>
<p>ä½†å½“å‡ºç°è¿™äº›ä¿¡å·æ—¶ï¼Œå¯ä»¥è€ƒè™‘ï¼š</p>
<ul>
<li>ä¸€ä¸ªæ–¹æ³•è¿‡é•¿ï¼Œä¸åˆ©äºé˜…è¯»ç»´æŠ¤</li>
<li>æœ‰å¤šä¸ª"å¯é€‰"æˆ–"å¼‚æ­¥"çš„æ‰§è¡Œæ­¥éª¤</li>
<li>ç»å¸¸éœ€è¦æ’å…¥æ–°çš„æ‰§è¡Œé€»è¾‘</li>
<li>ä¸åŒç¯å¢ƒéœ€è¦ä¸åŒçš„æ‰§è¡Œæµç¨‹</li>
</ul>
<p>æ‰§è¡Œç®¡é“ç‰¹åˆ«é€‚åˆ<strong>å•æœºåº”ç”¨å†…çš„å¤æ‚ä¸šåŠ¡æµç¨‹</strong>ï¼Œæ¯”å¦‚è®¢å•åˆ›å»ºã€ç”¨æˆ·æ³¨å†Œã€æ•°æ®å¯¼å…¥ç­‰åœºæ™¯ã€‚</p>
<h2 data-id="heading-10">å†™åœ¨æœ€å</h2>
<p>å¥½çš„ä»£ç ä¸æ˜¯ä¸€æ¬¡å†™æˆçš„ï¼Œè€Œæ˜¯åœ¨ä¸æ–­é‡æ„ä¸­è¿›åŒ–å‡ºæ¥çš„ã€‚</p>
<p>å¦‚æœä½ çš„é¡¹ç›®é‡Œå·²ç»æœ‰äº†é‚£ç§"å·¨æ— éœ¸"æ–¹æ³•ï¼Œä¸ç”¨æ€¥ç€å…¨éƒ¨æ¨å€’é‡æ¥ã€‚å…ˆè¯•ç€æŠŠå…¶ä¸­ä¸€ä¸ªç‹¬ç«‹çš„é€»è¾‘æŠ½æˆèŠ‚ç‚¹ï¼Œç„¶åé€æ­¥è¿ç§»ï¼Œä»£ç ä¼šè¶Šæ¥è¶Šæ¸…æ™°ã€‚</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/yuboon</span><span class="hljs-regexp">/java-examples/tree</span><span class="hljs-regexp">/master/springboot</span>-pipeline
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PHP é«˜æ•ˆçš„æ ‡å‡†åº“ SPL å…¨é¢æŒ‡å—]]></title>    <link>https://juejin.cn/post/7591350620189147142</link>    <guid>https://juejin.cn/post/7591350620189147142</guid>    <pubDate>2026-01-05T00:14:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620189147142" data-draft-id="7591334602427482175" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PHP é«˜æ•ˆçš„æ ‡å‡†åº“ SPL å…¨é¢æŒ‡å—"/> <meta itemprop="keywords" content="åç«¯,PHP"/> <meta itemprop="datePublished" content="2026-01-05T00:14:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="BingoGo"/> <meta itemprop="url" content="https://juejin.cn/user/993614242266077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PHP é«˜æ•ˆçš„æ ‡å‡†åº“ SPL å…¨é¢æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/993614242266077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    BingoGo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:14:50.000Z" title="Mon Jan 05 2026 00:14:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">PHP é«˜æ•ˆçš„æ ‡å‡†åº“ SPL å…¨é¢æŒ‡å—</h2>
<p>å¦‚æœä½ æ˜¯ä¸€å PHP å¼€å‘è€…ï¼Œæ— è®ºæ˜¯åœ¨ç¼–å†™ç®€å•è„šæœ¬ï¼Œè¿˜æ˜¯ä½¿ç”¨ Laravel ç­‰æ¡†æ¶æ„å»ºå¤æ‚åº”ç”¨ï¼ŒSPL éƒ½æ˜¯ä¸€å¥—<strong>ç»å¸¸è¢«å¿½è§†å´éå¸¸å¼ºå¤§</strong>çš„å·¥å…·é›†ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ SPL æ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆå€¼å¾—ä½¿ç”¨ã€å®ƒçš„ä¼˜ç¼ºç‚¹ã€åœ¨ä»£ç ä¸­å¼•å…¥ SPL ä¼šå¸¦æ¥å“ªäº›å½±å“ã€é€‚åˆä½¿ç”¨ SPL çš„åœºæ™¯ï¼Œä»¥åŠå¦‚ä½•åœ¨ Laravel ç¯å¢ƒä¸­é«˜æ•ˆåœ°ä½¿ç”¨å®ƒã€‚åŒæ—¶ï¼Œæˆ‘ä¼šç»“åˆ<strong>çœŸå®ä¸šåŠ¡åœºæ™¯</strong>ç»™å‡ºè¯¦ç»†ç¤ºä¾‹ï¼Œå¸®åŠ©ä½ ç†è§£ SPL çš„å®é™…ä»·å€¼ã€‚</p>
<p>è¯»å®Œæœ¬æ–‡ï¼Œä½ å°†å¯¹ SPL æœ‰ä¸€ä¸ªç³»ç»Ÿã€æ¸…æ™°çš„è®¤è¯†ï¼Œå¹¶èƒ½å¤Ÿåœ¨å®é™…é¡¹ç›®ä¸­è‡ªå¦‚åœ°è¿ç”¨å®ƒã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcatchadmin.com%2Fpost%2F2026-01%2Funderstanding-the-standard-php-library-spl-a-comprehensive-guide" target="_blank" title="https://catchadmin.com/post/2026-01/understanding-the-standard-php-library-spl-a-comprehensive-guide" ref="nofollow noopener noreferrer">åŸæ–‡ PHP é«˜æ•ˆçš„æ ‡å‡†åº“ SPL å…¨é¢æŒ‡å—</a></p>
<hr/>
<h3 data-id="heading-1">ä»€ä¹ˆæ˜¯æ ‡å‡† PHP åº“ï¼ˆSPLï¼‰ï¼Ÿ</h3>
<p>æ ‡å‡† PHP åº“ï¼ˆSPLï¼‰æ˜¯ä¸€ç»„è‡ª PHP 5.0 èµ·å†…ç½®äº PHP æ ¸å¿ƒä¸­çš„ç±»å’Œæ¥å£ï¼Œæ—¨åœ¨ä»¥<strong>æ ‡å‡†åŒ–ã€é«˜æ•ˆ</strong>çš„æ–¹å¼è§£å†³å¸¸è§ç¼–ç¨‹é—®é¢˜ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸º PHP è‡ªå¸¦çš„â€œç‘å£«å†›åˆ€â€ï¼Œä¸“é—¨ç”¨äºå¤„ç†æ•°æ®ç»“æ„ã€è¿­ä»£å™¨ã€å¼‚å¸¸ç­‰å¸¸è§éœ€æ±‚ã€‚</p>
<p>ä¸ç¬¬ä¸‰æ–¹åº“ä¸åŒï¼ŒSPL æ˜¯ PHP æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ï¼Œä¸éœ€è¦é€šè¿‡ Composer å®‰è£…ï¼Œ<strong>å¼€ç®±å³ç”¨</strong>ã€‚</p>
<p>ä»æ•´ä½“ä¸Šçœ‹ï¼ŒSPL ä¸»è¦æä¾›äº†ä»¥ä¸‹èƒ½åŠ›ï¼š</p>
<ul>
<li><strong>æ•°æ®ç»“æ„</strong>
å¦‚ <code>SplStack</code>ã€<code>SplQueue</code>ã€<code>SplHeap</code>ã€<code>SplDoublyLinkedList</code>ã€<code>SplFixedArray</code> ç­‰ï¼Œç”¨äºæ›´é«˜æ•ˆåœ°ç®¡ç†æ•°æ®é›†åˆã€‚</li>
<li><strong>è¿­ä»£å™¨</strong>
ç”¨äºç»Ÿä¸€éå†æ•°æ®ç»“æ„çš„æ¥å£å’Œå®ç°ï¼Œä¾‹å¦‚ç”¨äºæ–‡ä»¶å¤„ç†çš„ <code>SplFileObject</code>ï¼Œæˆ–ç”¨äºåµŒå¥—ç»“æ„çš„ <code>RecursiveIteratorIterator</code>ã€‚</li>
<li><strong>å¼‚å¸¸ä½“ç³»</strong>
åŒ…å« <code>LogicException</code>ã€<code>RuntimeException</code> ä»¥åŠå®ƒä»¬çš„å­ç±»ï¼ˆå¦‚ <code>InvalidArgumentException</code>ï¼‰ï¼Œç”¨äºæ›´æ¸…æ™°çš„é”™è¯¯å¤„ç†ã€‚</li>
<li><strong>å…¶ä»–å·¥å…·</strong>
åŒ…æ‹¬é€šè¿‡ <code>spl_autoload_register()</code> å®ç°çš„è‡ªåŠ¨åŠ è½½ï¼Œä»¥åŠå¯¹è±¡åå°„ä¸è‡ªçœç›¸å…³å·¥å…·ã€‚</li>
</ul>
<p>SPL å¹¶ä¸æ˜¯ä¸€ä¸ªâ€œæ–°æ½®â€çš„ç‰¹æ€§ï¼Œä½†å®ƒçš„æˆç†Ÿåº¦å’Œé€šç”¨æ€§ï¼Œä½¿å…¶åœ¨ç¼–å†™<strong>å¹²å‡€ã€é«˜æ€§èƒ½ä»£ç </strong>æ—¶éå¸¸æœ‰ä»·å€¼ã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ SPLï¼Ÿ</h3>
<p>åœ¨å½“ä»Š Composer åŒ…å’Œæ¡†æ¶ç››è¡Œçš„æ—¶ä»£ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å…³æ³¨ SPLï¼Ÿæ ¸å¿ƒåŸå› åªæœ‰ä¸¤ä¸ªå­—ï¼š<strong>ç®€å•</strong> å’Œ <strong>æ€§èƒ½</strong>ã€‚</p>
<p>SPL æ˜¯ PHP åŸç”Ÿçš„ä¸€éƒ¨åˆ†ï¼Œå¤©ç„¶é›†æˆï¼Œæ— éœ€é¢å¤–ä¾èµ–ã€‚å®ƒé¼“åŠ±é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰ï¼Œè®©ä»£ç æ›´æ¨¡å—åŒ–ã€æ›´å¯å¤ç”¨ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ éœ€è¦å¤„ç†å¤§è§„æ¨¡æ•°æ®ï¼Œæˆ–è€…å®ç°è‡ªå®šä¹‰çš„éå†é€»è¾‘ï¼ŒSPL æä¾›çš„è¿­ä»£å™¨å¯ä»¥è®©ä½ é¿å…ä½¿ç”¨å¤æ‚çš„æ•°ç»„æ“ä½œå’ŒåµŒå¥—å¾ªç¯ã€‚</p>
<p>ä½œä¸º Laravel å¼€å‘è€…ï¼Œä½ å¯èƒ½å·²ç»ä¹ æƒ¯ä½¿ç”¨ Eloquent å¤„ç†æ•°æ®åº“æ•°æ®ï¼Œä½†åœ¨<strong>è‡ªå®šä¹‰æ•°æ®å¤„ç†ã€æ–‡ä»¶è¯»å†™ã€ä»»åŠ¡è°ƒåº¦</strong>ç­‰åœºæ™¯ä¸­ï¼ŒSPL å¾€å¾€æ¯”æ¡†æ¶è‡ªå¸¦å·¥å…·æ›´è½»é‡ã€æ›´ç›´æ¥ã€‚</p>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<blockquote>
<p>å½“ä½ éœ€è¦<strong>è½»é‡çº§ã€æ— ä¾èµ–ã€ç¬¦åˆ PHP OOP è®¾è®¡ç†å¿µçš„å·¥å…·</strong>æ—¶ï¼ŒSPL éå¸¸å€¼å¾—ä½¿ç”¨ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-3">ä½¿ç”¨ SPL çš„å¥½å¤„</h3>
<p>SPL åœ¨å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½æ–¹é¢æœ‰ä¸å°‘ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>æ•ˆç‡ä¸æ€§èƒ½</strong>
SPL æ˜¯ç¼–è¯‘è¿› PHP å†…æ ¸çš„ã€‚ä¾‹å¦‚ï¼Œ<code>SplFixedArray</code> åœ¨å›ºå®šå¤§å°é›†åˆçš„åœºæ™¯ä¸‹æ¯”æ™®é€šæ•°ç»„æ›´çœå†…å­˜ï¼Œå¹¶ä¸”è®¿é—®å¤æ‚åº¦ä¸º O(1)ã€‚</li>
<li><strong>æ ‡å‡†åŒ–</strong>
è¿­ä»£å™¨æ¥å£è®©æ•°ç»„ã€å¯¹è±¡ã€æ–‡ä»¶éƒ½å¯ä»¥ç”¨ <code>foreach</code> ç»Ÿä¸€éå†ï¼Œå‡å°‘é‡å¤ä»£ç ã€‚</li>
<li><strong>å¯æ‰©å±•æ€§</strong>
SPL ç±»å¯ä»¥è¢«ç»§æ‰¿ï¼Œæ–¹ä¾¿æ„å»ºå¯å¤ç”¨ç»„ä»¶ï¼Œéå¸¸é€‚åˆä¸­å¤§å‹é¡¹ç›®ã€‚</li>
<li><strong>æ›´æ¸…æ™°çš„é”™è¯¯å¤„ç†</strong>
é€šè¿‡å¼‚å¸¸å±‚çº§ç»“æ„ï¼Œå¯ä»¥æŠ›å‡ºè¯­ä¹‰æ˜ç¡®çš„å¼‚å¸¸ï¼Œå¦‚ <code>BadMethodCallException</code>ï¼Œè€Œä¸æ˜¯æ¨¡ç³Šçš„é”™è¯¯ä¿¡æ¯ã€‚</li>
<li><strong>æ— éœ€é¢å¤–ä¾èµ–</strong>
åœ¨ Laravel é¡¹ç›®ä¸­ï¼Œå‡å°‘ Composer ä¾èµ–æ„å‘³ç€æ›´å¹²å‡€çš„ <code>composer.json</code>ã€‚</li>
<li><strong>è¯­ä¹‰æ›´æ¸…æ™°çš„ä»£ç </strong>
<code>SplQueue</code> æ˜ç¡®è¡¨ç¤º FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ï¼Œæ¯”ç›´æ¥ç”¨æ•°ç»„æ›´å®¹æ˜“è®©äººç†è§£ä»£ç æ„å›¾ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-4">ä½¿ç”¨ SPL çš„ä¸è¶³ä¹‹å¤„</h3>
<p>SPL ä¹Ÿå¹¶éå®Œç¾æ— ç¼ºï¼š</p>
<ul>
<li><strong>å­¦ä¹ æˆæœ¬</strong>
å¯¹äºä¹ æƒ¯è¿‡ç¨‹å¼ PHP çš„å¼€å‘è€…æ¥è¯´ï¼ŒSPL çš„æ¥å£å’ŒæŠ½è±¡ç±»å¯èƒ½ä¸å¤ªç›´è§‚ã€‚</li>
<li><strong>åŠŸèƒ½è¦†ç›–æœ‰é™</strong>
å¯¹äºå›¾ç»“æ„ã€å¹³è¡¡æ ‘ç­‰é«˜çº§æ•°æ®ç»“æ„ï¼Œä»ç„¶éœ€è¦ç¬¬ä¸‰æ–¹åº“æˆ– PECL æ‰©å±•ã€‚</li>
<li><strong>ä¸ç°ä»£ PHP ç‰¹æ€§å­˜åœ¨ä»£æ²Ÿ</strong>
éƒ¨åˆ† SPL ç»„ä»¶åœ¨è®¾è®¡ä¸Šç•¥æ˜¾é™ˆæ—§ï¼Œä¸ PHP 8+ çš„æšä¸¾ã€å±æ€§ç­‰ç‰¹æ€§ç»“åˆåº¦ä¸é«˜ã€‚</li>
<li><strong>è°ƒè¯•å¤æ‚åº¦</strong>
ç»§æ‰¿ SPL ç±»å¯èƒ½ä¼šå½¢æˆè¾ƒæ·±çš„ç»§æ‰¿é“¾ï¼Œåœ¨ Laravel è¿™ç§å¤šå±‚æ¶æ„ä¸­è°ƒè¯•ä¼šæ›´å¤æ‚ã€‚</li>
<li><strong>æŸäº›åœºæ™¯ä¸‹çš„æ€§èƒ½å¼€é”€</strong>
åœ¨æå¤§æ•°æ®é‡ä¸‹ï¼Œè¿­ä»£å™¨å¯èƒ½æ¯”åŸç”Ÿ <code>for</code> å¾ªç¯ç¨æ…¢ã€‚</li>
</ul>
<p>æ€»ä½“æ¥è¯´ï¼Œåªè¦<strong>åˆç†ä½¿ç”¨</strong>ï¼Œè¿™äº›ç¼ºç‚¹å¹¶ä¸ä¼šæˆä¸ºè‡´å‘½é—®é¢˜ã€‚</p>
<hr/>
<h3 data-id="heading-5">ä½¿ç”¨ SPL ä¼šå¸¦æ¥ä»€ä¹ˆå½±å“ï¼Ÿ</h3>
<p>åœ¨é¡¹ç›®ä¸­å¼•å…¥ SPLï¼Œé€šå¸¸ä¼šäº§ç”Ÿä»¥ä¸‹å˜åŒ–ï¼š</p>
<ul>
<li><strong>ä»£ç é£æ ¼è½¬å˜</strong>
æ›´åå‘ OOPï¼Œæœ‰åˆ©äºé•¿æœŸç»´æŠ¤ï¼Œä½†å¯èƒ½éœ€è¦é‡æ„æ—§ä»£ç ã€‚</li>
<li><strong>ä¾èµ–ç®¡ç†æ›´è½»é‡</strong>
å‡å°‘å¯¹å¤–éƒ¨åŒ…çš„ä¾èµ–ï¼Œæå‡å¯ç§»æ¤æ€§ã€‚</li>
<li><strong>å¼‚å¸¸æ›´æ—©æš´éœ²</strong>
æ›´ä¸¥æ ¼çš„å¼‚å¸¸ä½“ç³»å¯èƒ½ä¼šæš´éœ²æ—§ä»£ç ä¸­çš„æ½œåœ¨é—®é¢˜ã€‚</li>
<li><strong>å›¢é˜Ÿåä½œå½±å“</strong>
å›¢é˜ŸåˆæœŸå¯èƒ½éœ€è¦é€‚åº” SPLï¼Œä½†ä¸€æ—¦ç»Ÿä¸€è§„èŒƒï¼Œæ•´ä½“ä»£ç è´¨é‡ä¼šæ›´é«˜ã€‚</li>
<li><strong>è¿è¡Œæ—¶è¡¨ç°å˜åŒ–</strong>
ä¸åŒ SPL æ•°æ®ç»“æ„çš„å†…å­˜ä½¿ç”¨æ–¹å¼ä¸åŒï¼Œéœ€è¦é…åˆæ€§èƒ½åˆ†æå·¥å…·è¯„ä¼°ã€‚</li>
</ul>
<p>ç®€è€Œè¨€ä¹‹ï¼šSPL èƒ½è®©ä»£ç æ›´ç°ä»£ï¼Œä½†éœ€è¦<strong>æœ‰æ„è¯†åœ°å¼•å…¥</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-6">é€‚åˆä½¿ç”¨ SPL çš„åœºæ™¯</h3>
<p>SPL ç‰¹åˆ«é€‚åˆä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li><strong>æ•°æ®å¤„ç†ç®¡é“</strong>
ä¾‹å¦‚æ‰¹é‡å¤„ç†ä»»åŠ¡ã€é˜Ÿåˆ—ã€æ ˆç»“æ„ã€‚</li>
<li><strong>æ–‡ä»¶å’Œç›®å½•æ“ä½œ</strong>
é€’å½’éå†ç›®å½•ã€é€è¡Œè¯»å–å¤§æ–‡ä»¶ã€‚</li>
<li><strong>è‡ªå®šä¹‰é›†åˆç»“æ„</strong>
å›ºå®šå¤§å°æ•°ç»„ã€ä¼˜å…ˆçº§æ’åºã€‚</li>
<li><strong>åº“æˆ–ç»„ä»¶å¼€å‘</strong>
éœ€è¦ç²¾ç»†åŒ–å¼‚å¸¸ç®¡ç†ã€‚</li>
<li><strong>æ€§èƒ½æ•æ„Ÿæ¨¡å—</strong>
é«˜å¹¶å‘ã€é«˜é¢‘è®¿é—®çš„æ ¸å¿ƒé€»è¾‘ã€‚</li>
</ul>
<p>ä¸å»ºè®®åœ¨ç®€å•æ•°ç»„æ“ä½œä¸­æ»¥ç”¨ SPLï¼ŒLaravel çš„ <code>Collection</code> åœ¨å¤šæ•°åœºæ™¯ä¸‹æ›´å‹å¥½ã€‚</p>
<hr/>
<h3 data-id="heading-7">Laravel å¼€å‘è€…å¦‚ä½•ä½¿ç”¨ SPLï¼Ÿ</h3>
<p>Laravel ä¸ SPL å®Œå…¨å…¼å®¹ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç›´æ¥ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-8">1. è‡ªåŠ¨åŠ è½½</h4>
<p>SPL é»˜è®¤å¯ç”¨ï¼Œå¦‚æœ‰éœ€è¦å¯åœ¨ <code>AppServiceProvider</code> ä¸­ä½¿ç”¨ <code>spl_autoload_register()</code>ã€‚</p>
<h4 data-id="heading-9">2. åœ¨ Service æˆ– Controller ä¸­ä½¿ç”¨</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">SplQueue</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskService</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processTasks</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$tasks</span></span>)
    </span>{
        <span class="hljs-variable">$queue</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplQueue</span>();

        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$tasks</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$task</span>) {
            <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">enqueue</span>(<span class="hljs-variable">$task</span>);
        }

        <span class="hljs-keyword">while</span> (!<span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">isEmpty</span>()) {
            <span class="hljs-variable">$current</span> = <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">dequeue</span>();
            <span class="hljs-comment">// å¤„ç†ä»»åŠ¡</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-10">3. ç»“åˆ Eloquent</h4>
<p>ä¾‹å¦‚ä½¿ç”¨ <code>SplFileObject</code> å¯¼å…¥ CSV æ•°æ®ã€‚</p>
<h4 data-id="heading-11">4. åœ¨ Job ä¸­ä½¿ç”¨</h4>
<p>å½“ Laravel é˜Ÿåˆ—ä¸æ»¡è¶³éœ€æ±‚æ—¶ï¼Œå¯ä½¿ç”¨ <code>SplStack</code> å®ç° LIFO å¤„ç†ã€‚</p>
<h4 data-id="heading-12">5. æµ‹è¯•</h4>
<p>Laravel çš„æµ‹è¯•ä½“ç³»å¯ç›´æ¥é…åˆ SPL ä½¿ç”¨ï¼Œå¿…è¦æ—¶è¿›è¡Œ Mockã€‚</p>
<hr/>
<h3 data-id="heading-13">çœŸå®æ¡ˆä¾‹è¯¦è§£</h3>
<h4 data-id="heading-14">ç¤ºä¾‹ä¸€ï¼šé¡¹ç›®ç®¡ç†ç³»ç»Ÿä¸­çš„ä¼˜å…ˆçº§ä»»åŠ¡é˜Ÿåˆ—</h4>
<p>åœ¨ä¸€ä¸ªç±»ä¼¼ Trello çš„ Laravel é¡¹ç›®ä¸­ï¼Œä»»åŠ¡æœ‰é«˜ã€ä¸­ã€ä½ä¼˜å…ˆçº§ï¼Œéœ€è¦æŒ‰ä¼˜å…ˆçº§å¤„ç†ã€‚</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Task</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">SplPriorityQueue</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processHighPriorityTasks</span>(<span class="hljs-params"/>)
</span>{
    <span class="hljs-variable">$tasks</span> = <span class="hljs-title class_">Task</span>::<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">'status'</span>, <span class="hljs-string">'pending'</span>)-&gt;<span class="hljs-title function_ invoke__">get</span>();
    <span class="hljs-variable">$queue</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplPriorityQueue</span>();

    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$tasks</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$task</span>) {
        <span class="hljs-variable">$priority</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getPriorityValue</span>(<span class="hljs-variable">$task</span>-&gt;priority);
        <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">insert</span>(<span class="hljs-variable">$task</span>, <span class="hljs-variable">$priority</span>);
    }

    <span class="hljs-keyword">while</span> (!<span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">isEmpty</span>()) {
        <span class="hljs-variable">$currentTask</span> = <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">extract</span>();
        <span class="hljs-variable">$currentTask</span>-&gt;<span class="hljs-title function_ invoke__">update</span>([<span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'processed'</span>]);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">'message'</span> =&gt; <span class="hljs-string">'Tasks processed'</span>]);
}

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPriorityValue</span>(<span class="hljs-params"><span class="hljs-variable">$priority</span></span>)
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">match</span> (<span class="hljs-variable">$priority</span>) {
        <span class="hljs-string">'high'</span> =&gt; <span class="hljs-number">3</span>,
        <span class="hljs-string">'medium'</span> =&gt; <span class="hljs-number">2</span>,
        <span class="hljs-keyword">default</span> =&gt; <span class="hljs-number">1</span>,
    };
}
</code></pre>
<p><strong>æ•ˆæœè¯´æ˜ï¼š</strong>
åœ¨ä¸€ä¸‡æ¡ä»»åŠ¡çš„çœŸå®åœºæ™¯ä¸‹ï¼Œç›¸æ¯”æ•°ç»„æ’åºï¼Œå¤„ç†æ—¶é—´é™ä½çº¦ 20%ã€‚</p>
<hr/>
<h4 data-id="heading-15">ç¤ºä¾‹äºŒï¼šç”µå•†ç³»ç»Ÿä¸­çš„å›¾ç‰‡æ¸…ç†ä»»åŠ¡</h4>
<p>ä½¿ç”¨ SPL é€’å½’éå†ç›®å½•ï¼Œæ¸…ç†æœªè¢«æ•°æ®åº“å¼•ç”¨çš„å›¾ç‰‡ã€‚</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Console</span>\<span class="hljs-title">Command</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">RecursiveDirectoryIterator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">RecursiveIteratorIterator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">SplFileInfo</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CleanupUploads</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Command</span>
</span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$signature</span> = <span class="hljs-string">'uploads:cleanup'</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"/>)
    </span>{
        <span class="hljs-variable">$directory</span> = <span class="hljs-title function_ invoke__">storage_path</span>(<span class="hljs-string">'app/public/uploads'</span>);
        <span class="hljs-variable">$iterator</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RecursiveIteratorIterator</span>(
            <span class="hljs-keyword">new</span> <span class="hljs-built_in">RecursiveDirectoryIterator</span>(<span class="hljs-variable">$directory</span>)
        );

        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$iterator</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">SplFileInfo</span> &amp;&amp; <span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">isFile</span>()) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">isFileUsedInDatabase</span>(<span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">getFilename</span>())) {
                    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">getPathname</span>());
                }
            }
        }
    }
}
</code></pre>
<p><strong>æ•ˆæœè¯´æ˜ï¼š</strong>
åœ¨ä¸€ä¸ªåŒ…å« 5 ä¸‡å¼ å›¾ç‰‡çš„ç”µå•†é¡¹ç›®ä¸­ï¼Œè¯¥ä»»åŠ¡æ¯å‘¨è¿è¡Œä¸€æ¬¡ï¼Œå¯é‡Šæ”¾çº¦ 30% çš„å­˜å‚¨ç©ºé—´ã€‚</p>
<hr/>
<h3 data-id="heading-16">æ€»ç»“</h3>
<p>æ ‡å‡† PHP åº“ï¼ˆSPLï¼‰æ˜¯ PHP ç”Ÿæ€ä¸­è¢«ä½ä¼°çš„ä¸€å—åŸºçŸ³ã€‚å®ƒä¸ºæ•°æ®ç»“æ„ã€è¿­ä»£ã€å¼‚å¸¸å¤„ç†æä¾›äº†é«˜æ•ˆã€æ ‡å‡†åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>å¯¹äº Laravel å¼€å‘è€…è€Œè¨€ï¼ŒSPL å¹¶ä¸æ˜¯ç”¨æ¥å–ä»£æ¡†æ¶èƒ½åŠ›ï¼Œè€Œæ˜¯åœ¨<strong>æ€§èƒ½æ•æ„Ÿæˆ–ååº•å±‚çš„é€»è¾‘ä¸­æä¾›æ›´åˆé€‚çš„å·¥å…·é€‰æ‹©</strong>ã€‚ä¸å¦¨ä»ä¸€ä¸ª <code>SplQueue</code>ã€ä¸€ä¸ªæ–‡ä»¶è¿­ä»£å™¨å¼€å§‹ï¼Œé€æ­¥å°† SPL çº³å…¥ä½ çš„æŠ€æœ¯æ ˆã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›å†™å‡º<strong>æ›´æ¸…æ™°ã€æ›´é«˜æ•ˆã€æ›´ä¸“ä¸šçš„ PHP ä»£ç </strong>ï¼ŒSPL å€¼å¾—ä½ è®¤çœŸå¯¹å¾…ã€‚</p>
<h2 data-id="heading-17">ç†è§£æ ‡å‡† PHP åº“ï¼ˆSPLï¼‰ï¼šä¸€ç¯‡å…¨é¢æŒ‡å—</h2>
<p>æ¬¢è¿é˜…è¯»è¿™ç¯‡å…³äºæ ‡å‡† PHP åº“ï¼ˆStandard PHP Libraryï¼Œç®€ç§° SPLï¼‰çš„æ·±åº¦åšå®¢ã€‚å¦‚æœä½ æ˜¯ä¸€å PHP å¼€å‘è€…ï¼Œæ— è®ºæ˜¯åœ¨ç¼–å†™ç®€å•è„šæœ¬ï¼Œè¿˜æ˜¯ä½¿ç”¨ Laravel ç­‰æ¡†æ¶æ„å»ºå¤æ‚åº”ç”¨ï¼ŒSPL éƒ½æ˜¯ä¸€å¥—<strong>ç»å¸¸è¢«å¿½è§†å´éå¸¸å¼ºå¤§</strong>çš„å·¥å…·é›†ã€‚</p>
<p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨ SPL æ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆå€¼å¾—ä½¿ç”¨ã€å®ƒçš„ä¼˜ç¼ºç‚¹ã€åœ¨ä»£ç ä¸­å¼•å…¥ SPL ä¼šå¸¦æ¥å“ªäº›å½±å“ã€é€‚åˆä½¿ç”¨ SPL çš„åœºæ™¯ï¼Œä»¥åŠå¦‚ä½•åœ¨ Laravel ç¯å¢ƒä¸­é«˜æ•ˆåœ°ä½¿ç”¨å®ƒã€‚åŒæ—¶ï¼Œæˆ‘ä¼šç»“åˆ<strong>çœŸå®ä¸šåŠ¡åœºæ™¯</strong>ç»™å‡ºè¯¦ç»†ç¤ºä¾‹ï¼Œå¸®åŠ©ä½ ç†è§£ SPL çš„å®é™…ä»·å€¼ã€‚</p>
<p>è¯»å®Œæœ¬æ–‡ï¼Œä½ å°†å¯¹ SPL æœ‰ä¸€ä¸ªç³»ç»Ÿã€æ¸…æ™°çš„è®¤è¯†ï¼Œå¹¶èƒ½å¤Ÿåœ¨å®é™…é¡¹ç›®ä¸­è‡ªå¦‚åœ°è¿ç”¨å®ƒã€‚</p>
<hr/>
<h3 data-id="heading-18">ä»€ä¹ˆæ˜¯æ ‡å‡† PHP åº“ï¼ˆSPLï¼‰ï¼Ÿ</h3>
<p>æ ‡å‡† PHP åº“ï¼ˆSPLï¼‰æ˜¯ä¸€ç»„è‡ª PHP 5.0 èµ·å†…ç½®äº PHP æ ¸å¿ƒä¸­çš„ç±»å’Œæ¥å£ï¼Œæ—¨åœ¨ä»¥<strong>æ ‡å‡†åŒ–ã€é«˜æ•ˆ</strong>çš„æ–¹å¼è§£å†³å¸¸è§ç¼–ç¨‹é—®é¢˜ã€‚ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸º PHP è‡ªå¸¦çš„â€œç‘å£«å†›åˆ€â€ï¼Œä¸“é—¨ç”¨äºå¤„ç†æ•°æ®ç»“æ„ã€è¿­ä»£å™¨ã€å¼‚å¸¸ç­‰å¸¸è§éœ€æ±‚ã€‚</p>
<p>ä¸ç¬¬ä¸‰æ–¹åº“ä¸åŒï¼ŒSPL æ˜¯ PHP æ ¸å¿ƒçš„ä¸€éƒ¨åˆ†ï¼Œä¸éœ€è¦é€šè¿‡ Composer å®‰è£…ï¼Œ<strong>å¼€ç®±å³ç”¨</strong>ã€‚</p>
<p>ä»æ•´ä½“ä¸Šçœ‹ï¼ŒSPL ä¸»è¦æä¾›äº†ä»¥ä¸‹èƒ½åŠ›ï¼š</p>
<ul>
<li><strong>æ•°æ®ç»“æ„</strong>
å¦‚ <code>SplStack</code>ã€<code>SplQueue</code>ã€<code>SplHeap</code>ã€<code>SplDoublyLinkedList</code>ã€<code>SplFixedArray</code> ç­‰ï¼Œç”¨äºæ›´é«˜æ•ˆåœ°ç®¡ç†æ•°æ®é›†åˆã€‚</li>
<li><strong>è¿­ä»£å™¨</strong>
ç”¨äºç»Ÿä¸€éå†æ•°æ®ç»“æ„çš„æ¥å£å’Œå®ç°ï¼Œä¾‹å¦‚ç”¨äºæ–‡ä»¶å¤„ç†çš„ <code>SplFileObject</code>ï¼Œæˆ–ç”¨äºåµŒå¥—ç»“æ„çš„ <code>RecursiveIteratorIterator</code>ã€‚</li>
<li><strong>å¼‚å¸¸ä½“ç³»</strong>
åŒ…å« <code>LogicException</code>ã€<code>RuntimeException</code> ä»¥åŠå®ƒä»¬çš„å­ç±»ï¼ˆå¦‚ <code>InvalidArgumentException</code>ï¼‰ï¼Œç”¨äºæ›´æ¸…æ™°çš„é”™è¯¯å¤„ç†ã€‚</li>
<li><strong>å…¶ä»–å·¥å…·</strong>
åŒ…æ‹¬é€šè¿‡ <code>spl_autoload_register()</code> å®ç°çš„è‡ªåŠ¨åŠ è½½ï¼Œä»¥åŠå¯¹è±¡åå°„ä¸è‡ªçœç›¸å…³å·¥å…·ã€‚</li>
</ul>
<p>SPL å¹¶ä¸æ˜¯ä¸€ä¸ªâ€œæ–°æ½®â€çš„ç‰¹æ€§ï¼Œä½†å®ƒçš„æˆç†Ÿåº¦å’Œé€šç”¨æ€§ï¼Œä½¿å…¶åœ¨ç¼–å†™<strong>å¹²å‡€ã€é«˜æ€§èƒ½ä»£ç </strong>æ—¶éå¸¸æœ‰ä»·å€¼ã€‚</p>
<hr/>
<h3 data-id="heading-19">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ SPLï¼Ÿ</h3>
<p>åœ¨å½“ä»Š Composer åŒ…å’Œæ¡†æ¶ç››è¡Œçš„æ—¶ä»£ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å…³æ³¨ SPLï¼Ÿæ ¸å¿ƒåŸå› åªæœ‰ä¸¤ä¸ªå­—ï¼š<strong>ç®€å•</strong> å’Œ <strong>æ€§èƒ½</strong>ã€‚</p>
<p>SPL æ˜¯ PHP åŸç”Ÿçš„ä¸€éƒ¨åˆ†ï¼Œå¤©ç„¶é›†æˆï¼Œæ— éœ€é¢å¤–ä¾èµ–ã€‚å®ƒé¼“åŠ±é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰ï¼Œè®©ä»£ç æ›´æ¨¡å—åŒ–ã€æ›´å¯å¤ç”¨ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ éœ€è¦å¤„ç†å¤§è§„æ¨¡æ•°æ®ï¼Œæˆ–è€…å®ç°è‡ªå®šä¹‰çš„éå†é€»è¾‘ï¼ŒSPL æä¾›çš„è¿­ä»£å™¨å¯ä»¥è®©ä½ é¿å…ä½¿ç”¨å¤æ‚çš„æ•°ç»„æ“ä½œå’ŒåµŒå¥—å¾ªç¯ã€‚</p>
<p>ä½œä¸º Laravel å¼€å‘è€…ï¼Œä½ å¯èƒ½å·²ç»ä¹ æƒ¯ä½¿ç”¨ Eloquent å¤„ç†æ•°æ®åº“æ•°æ®ï¼Œä½†åœ¨<strong>è‡ªå®šä¹‰æ•°æ®å¤„ç†ã€æ–‡ä»¶è¯»å†™ã€ä»»åŠ¡è°ƒåº¦</strong>ç­‰åœºæ™¯ä¸­ï¼ŒSPL å¾€å¾€æ¯”æ¡†æ¶è‡ªå¸¦å·¥å…·æ›´è½»é‡ã€æ›´ç›´æ¥ã€‚</p>
<p>ä¸€å¥è¯æ€»ç»“ï¼š</p>
<blockquote>
<p>å½“ä½ éœ€è¦<strong>è½»é‡çº§ã€æ— ä¾èµ–ã€ç¬¦åˆ PHP OOP è®¾è®¡ç†å¿µçš„å·¥å…·</strong>æ—¶ï¼ŒSPL éå¸¸å€¼å¾—ä½¿ç”¨ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-20">ä½¿ç”¨ SPL çš„å¥½å¤„</h3>
<p>SPL åœ¨å¯ç»´æŠ¤æ€§å’Œæ€§èƒ½æ–¹é¢æœ‰ä¸å°‘ä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>æ•ˆç‡ä¸æ€§èƒ½</strong>
SPL æ˜¯ç¼–è¯‘è¿› PHP å†…æ ¸çš„ã€‚ä¾‹å¦‚ï¼Œ<code>SplFixedArray</code> åœ¨å›ºå®šå¤§å°é›†åˆçš„åœºæ™¯ä¸‹æ¯”æ™®é€šæ•°ç»„æ›´çœå†…å­˜ï¼Œå¹¶ä¸”è®¿é—®å¤æ‚åº¦ä¸º O(1)ã€‚</li>
<li><strong>æ ‡å‡†åŒ–</strong>
è¿­ä»£å™¨æ¥å£è®©æ•°ç»„ã€å¯¹è±¡ã€æ–‡ä»¶éƒ½å¯ä»¥ç”¨ <code>foreach</code> ç»Ÿä¸€éå†ï¼Œå‡å°‘é‡å¤ä»£ç ã€‚</li>
<li><strong>å¯æ‰©å±•æ€§</strong>
SPL ç±»å¯ä»¥è¢«ç»§æ‰¿ï¼Œæ–¹ä¾¿æ„å»ºå¯å¤ç”¨ç»„ä»¶ï¼Œéå¸¸é€‚åˆä¸­å¤§å‹é¡¹ç›®ã€‚</li>
<li><strong>æ›´æ¸…æ™°çš„é”™è¯¯å¤„ç†</strong>
é€šè¿‡å¼‚å¸¸å±‚çº§ç»“æ„ï¼Œå¯ä»¥æŠ›å‡ºè¯­ä¹‰æ˜ç¡®çš„å¼‚å¸¸ï¼Œå¦‚ <code>BadMethodCallException</code>ï¼Œè€Œä¸æ˜¯æ¨¡ç³Šçš„é”™è¯¯ä¿¡æ¯ã€‚</li>
<li><strong>æ— éœ€é¢å¤–ä¾èµ–</strong>
åœ¨ Laravel é¡¹ç›®ä¸­ï¼Œå‡å°‘ Composer ä¾èµ–æ„å‘³ç€æ›´å¹²å‡€çš„ <code>composer.json</code>ã€‚</li>
<li><strong>è¯­ä¹‰æ›´æ¸…æ™°çš„ä»£ç </strong>
<code>SplQueue</code> æ˜ç¡®è¡¨ç¤º FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ï¼Œæ¯”ç›´æ¥ç”¨æ•°ç»„æ›´å®¹æ˜“è®©äººç†è§£ä»£ç æ„å›¾ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-21">ä½¿ç”¨ SPL çš„ä¸è¶³ä¹‹å¤„</h3>
<p>SPL ä¹Ÿå¹¶éå®Œç¾æ— ç¼ºï¼š</p>
<ul>
<li><strong>å­¦ä¹ æˆæœ¬</strong>
å¯¹äºä¹ æƒ¯è¿‡ç¨‹å¼ PHP çš„å¼€å‘è€…æ¥è¯´ï¼ŒSPL çš„æ¥å£å’ŒæŠ½è±¡ç±»å¯èƒ½ä¸å¤ªç›´è§‚ã€‚</li>
<li><strong>åŠŸèƒ½è¦†ç›–æœ‰é™</strong>
å¯¹äºå›¾ç»“æ„ã€å¹³è¡¡æ ‘ç­‰é«˜çº§æ•°æ®ç»“æ„ï¼Œä»ç„¶éœ€è¦ç¬¬ä¸‰æ–¹åº“æˆ– PECL æ‰©å±•ã€‚</li>
<li><strong>ä¸ç°ä»£ PHP ç‰¹æ€§å­˜åœ¨ä»£æ²Ÿ</strong>
éƒ¨åˆ† SPL ç»„ä»¶åœ¨è®¾è®¡ä¸Šç•¥æ˜¾é™ˆæ—§ï¼Œä¸ PHP 8+ çš„æšä¸¾ã€å±æ€§ç­‰ç‰¹æ€§ç»“åˆåº¦ä¸é«˜ã€‚</li>
<li><strong>è°ƒè¯•å¤æ‚åº¦</strong>
ç»§æ‰¿ SPL ç±»å¯èƒ½ä¼šå½¢æˆè¾ƒæ·±çš„ç»§æ‰¿é“¾ï¼Œåœ¨ Laravel è¿™ç§å¤šå±‚æ¶æ„ä¸­è°ƒè¯•ä¼šæ›´å¤æ‚ã€‚</li>
<li><strong>æŸäº›åœºæ™¯ä¸‹çš„æ€§èƒ½å¼€é”€</strong>
åœ¨æå¤§æ•°æ®é‡ä¸‹ï¼Œè¿­ä»£å™¨å¯èƒ½æ¯”åŸç”Ÿ <code>for</code> å¾ªç¯ç¨æ…¢ã€‚</li>
</ul>
<p>æ€»ä½“æ¥è¯´ï¼Œåªè¦<strong>åˆç†ä½¿ç”¨</strong>ï¼Œè¿™äº›ç¼ºç‚¹å¹¶ä¸ä¼šæˆä¸ºè‡´å‘½é—®é¢˜ã€‚</p>
<hr/>
<h3 data-id="heading-22">ä½¿ç”¨ SPL ä¼šå¸¦æ¥ä»€ä¹ˆå½±å“ï¼Ÿ</h3>
<p>åœ¨é¡¹ç›®ä¸­å¼•å…¥ SPLï¼Œé€šå¸¸ä¼šäº§ç”Ÿä»¥ä¸‹å˜åŒ–ï¼š</p>
<ul>
<li><strong>ä»£ç é£æ ¼è½¬å˜</strong>
æ›´åå‘ OOPï¼Œæœ‰åˆ©äºé•¿æœŸç»´æŠ¤ï¼Œä½†å¯èƒ½éœ€è¦é‡æ„æ—§ä»£ç ã€‚</li>
<li><strong>ä¾èµ–ç®¡ç†æ›´è½»é‡</strong>
å‡å°‘å¯¹å¤–éƒ¨åŒ…çš„ä¾èµ–ï¼Œæå‡å¯ç§»æ¤æ€§ã€‚</li>
<li><strong>å¼‚å¸¸æ›´æ—©æš´éœ²</strong>
æ›´ä¸¥æ ¼çš„å¼‚å¸¸ä½“ç³»å¯èƒ½ä¼šæš´éœ²æ—§ä»£ç ä¸­çš„æ½œåœ¨é—®é¢˜ã€‚</li>
<li><strong>å›¢é˜Ÿåä½œå½±å“</strong>
å›¢é˜ŸåˆæœŸå¯èƒ½éœ€è¦é€‚åº” SPLï¼Œä½†ä¸€æ—¦ç»Ÿä¸€è§„èŒƒï¼Œæ•´ä½“ä»£ç è´¨é‡ä¼šæ›´é«˜ã€‚</li>
<li><strong>è¿è¡Œæ—¶è¡¨ç°å˜åŒ–</strong>
ä¸åŒ SPL æ•°æ®ç»“æ„çš„å†…å­˜ä½¿ç”¨æ–¹å¼ä¸åŒï¼Œéœ€è¦é…åˆæ€§èƒ½åˆ†æå·¥å…·è¯„ä¼°ã€‚</li>
</ul>
<p>ç®€è€Œè¨€ä¹‹ï¼šSPL èƒ½è®©ä»£ç æ›´ç°ä»£ï¼Œä½†éœ€è¦<strong>æœ‰æ„è¯†åœ°å¼•å…¥</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-23">é€‚åˆä½¿ç”¨ SPL çš„åœºæ™¯</h3>
<p>SPL ç‰¹åˆ«é€‚åˆä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li><strong>æ•°æ®å¤„ç†ç®¡é“</strong>
ä¾‹å¦‚æ‰¹é‡å¤„ç†ä»»åŠ¡ã€é˜Ÿåˆ—ã€æ ˆç»“æ„ã€‚</li>
<li><strong>æ–‡ä»¶å’Œç›®å½•æ“ä½œ</strong>
é€’å½’éå†ç›®å½•ã€é€è¡Œè¯»å–å¤§æ–‡ä»¶ã€‚</li>
<li><strong>è‡ªå®šä¹‰é›†åˆç»“æ„</strong>
å›ºå®šå¤§å°æ•°ç»„ã€ä¼˜å…ˆçº§æ’åºã€‚</li>
<li><strong>åº“æˆ–ç»„ä»¶å¼€å‘</strong>
éœ€è¦ç²¾ç»†åŒ–å¼‚å¸¸ç®¡ç†ã€‚</li>
<li><strong>æ€§èƒ½æ•æ„Ÿæ¨¡å—</strong>
é«˜å¹¶å‘ã€é«˜é¢‘è®¿é—®çš„æ ¸å¿ƒé€»è¾‘ã€‚</li>
</ul>
<p>ä¸å»ºè®®åœ¨ç®€å•æ•°ç»„æ“ä½œä¸­æ»¥ç”¨ SPLï¼ŒLaravel çš„ <code>Collection</code> åœ¨å¤šæ•°åœºæ™¯ä¸‹æ›´å‹å¥½ã€‚</p>
<hr/>
<h3 data-id="heading-24">Laravel å¼€å‘è€…å¦‚ä½•ä½¿ç”¨ SPLï¼Ÿ</h3>
<p>Laravel ä¸ SPL å®Œå…¨å…¼å®¹ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç›´æ¥ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-25">1. è‡ªåŠ¨åŠ è½½</h4>
<p>SPL é»˜è®¤å¯ç”¨ï¼Œå¦‚æœ‰éœ€è¦å¯åœ¨ <code>AppServiceProvider</code> ä¸­ä½¿ç”¨ <code>spl_autoload_register()</code>ã€‚</p>
<h4 data-id="heading-26">2. åœ¨ Service æˆ– Controller ä¸­ä½¿ç”¨</h4>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">SplQueue</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TaskService</span>
</span>{
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processTasks</span>(<span class="hljs-params"><span class="hljs-keyword">array</span> <span class="hljs-variable">$tasks</span></span>)
    </span>{
        <span class="hljs-variable">$queue</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplQueue</span>();

        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$tasks</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$task</span>) {
            <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">enqueue</span>(<span class="hljs-variable">$task</span>);
        }

        <span class="hljs-keyword">while</span> (!<span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">isEmpty</span>()) {
            <span class="hljs-variable">$current</span> = <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">dequeue</span>();
            <span class="hljs-comment">// å¤„ç†ä»»åŠ¡</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-27">3. ç»“åˆ Eloquent</h4>
<p>ä¾‹å¦‚ä½¿ç”¨ <code>SplFileObject</code> å¯¼å…¥ CSV æ•°æ®ã€‚</p>
<h4 data-id="heading-28">4. åœ¨ Job ä¸­ä½¿ç”¨</h4>
<p>å½“ Laravel é˜Ÿåˆ—ä¸æ»¡è¶³éœ€æ±‚æ—¶ï¼Œå¯ä½¿ç”¨ <code>SplStack</code> å®ç° LIFO å¤„ç†ã€‚</p>
<h4 data-id="heading-29">5. æµ‹è¯•</h4>
<p>Laravel çš„æµ‹è¯•ä½“ç³»å¯ç›´æ¥é…åˆ SPL ä½¿ç”¨ï¼Œå¿…è¦æ—¶è¿›è¡Œ Mockã€‚</p>
<hr/>
<h3 data-id="heading-30">çœŸå®æ¡ˆä¾‹è¯¦è§£</h3>
<h4 data-id="heading-31">ç¤ºä¾‹ä¸€ï¼šé¡¹ç›®ç®¡ç†ç³»ç»Ÿä¸­çš„ä¼˜å…ˆçº§ä»»åŠ¡é˜Ÿåˆ—</h4>
<p>åœ¨ä¸€ä¸ªç±»ä¼¼ Trello çš„ Laravel é¡¹ç›®ä¸­ï¼Œä»»åŠ¡æœ‰é«˜ã€ä¸­ã€ä½ä¼˜å…ˆçº§ï¼Œéœ€è¦æŒ‰ä¼˜å…ˆçº§å¤„ç†ã€‚</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Models</span>\<span class="hljs-title">Task</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">SplPriorityQueue</span>;

<span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processHighPriorityTasks</span>(<span class="hljs-params"/>)
</span>{
    <span class="hljs-variable">$tasks</span> = <span class="hljs-title class_">Task</span>::<span class="hljs-title function_ invoke__">where</span>(<span class="hljs-string">'status'</span>, <span class="hljs-string">'pending'</span>)-&gt;<span class="hljs-title function_ invoke__">get</span>();
    <span class="hljs-variable">$queue</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">SplPriorityQueue</span>();

    <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$tasks</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$task</span>) {
        <span class="hljs-variable">$priority</span> = <span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">getPriorityValue</span>(<span class="hljs-variable">$task</span>-&gt;priority);
        <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">insert</span>(<span class="hljs-variable">$task</span>, <span class="hljs-variable">$priority</span>);
    }

    <span class="hljs-keyword">while</span> (!<span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">isEmpty</span>()) {
        <span class="hljs-variable">$currentTask</span> = <span class="hljs-variable">$queue</span>-&gt;<span class="hljs-title function_ invoke__">extract</span>();
        <span class="hljs-variable">$currentTask</span>-&gt;<span class="hljs-title function_ invoke__">update</span>([<span class="hljs-string">'status'</span> =&gt; <span class="hljs-string">'processed'</span>]);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">response</span>()-&gt;<span class="hljs-title function_ invoke__">json</span>([<span class="hljs-string">'message'</span> =&gt; <span class="hljs-string">'Tasks processed'</span>]);
}

<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPriorityValue</span>(<span class="hljs-params"><span class="hljs-variable">$priority</span></span>)
</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">match</span> (<span class="hljs-variable">$priority</span>) {
        <span class="hljs-string">'high'</span> =&gt; <span class="hljs-number">3</span>,
        <span class="hljs-string">'medium'</span> =&gt; <span class="hljs-number">2</span>,
        <span class="hljs-keyword">default</span> =&gt; <span class="hljs-number">1</span>,
    };
}
</code></pre>
<p><strong>æ•ˆæœè¯´æ˜ï¼š</strong>
åœ¨ä¸€ä¸‡æ¡ä»»åŠ¡çš„çœŸå®åœºæ™¯ä¸‹ï¼Œç›¸æ¯”æ•°ç»„æ’åºï¼Œå¤„ç†æ—¶é—´é™ä½çº¦ 20%ã€‚</p>
<hr/>
<h4 data-id="heading-32">ç¤ºä¾‹äºŒï¼šç”µå•†ç³»ç»Ÿä¸­çš„å›¾ç‰‡æ¸…ç†ä»»åŠ¡</h4>
<p>ä½¿ç”¨ SPL é€’å½’éå†ç›®å½•ï¼Œæ¸…ç†æœªè¢«æ•°æ®åº“å¼•ç”¨çš„å›¾ç‰‡ã€‚</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">use</span> <span class="hljs-title">Illuminate</span>\<span class="hljs-title">Console</span>\<span class="hljs-title">Command</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">RecursiveDirectoryIterator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">RecursiveIteratorIterator</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">SplFileInfo</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CleanupUploads</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Command</span>
</span>{
    <span class="hljs-keyword">protected</span> <span class="hljs-variable">$signature</span> = <span class="hljs-string">'uploads:cleanup'</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params"/>)
    </span>{
        <span class="hljs-variable">$directory</span> = <span class="hljs-title function_ invoke__">storage_path</span>(<span class="hljs-string">'app/public/uploads'</span>);
        <span class="hljs-variable">$iterator</span> = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RecursiveIteratorIterator</span>(
            <span class="hljs-keyword">new</span> <span class="hljs-built_in">RecursiveDirectoryIterator</span>(<span class="hljs-variable">$directory</span>)
        );

        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$iterator</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$file</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-variable">$file</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">SplFileInfo</span> &amp;&amp; <span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">isFile</span>()) {
                <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">$this</span>-&gt;<span class="hljs-title function_ invoke__">isFileUsedInDatabase</span>(<span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">getFilename</span>())) {
                    <span class="hljs-title function_ invoke__">unlink</span>(<span class="hljs-variable">$file</span>-&gt;<span class="hljs-title function_ invoke__">getPathname</span>());
                }
            }
        }
    }
}
</code></pre>
<p><strong>æ•ˆæœè¯´æ˜ï¼š</strong>
åœ¨ä¸€ä¸ªåŒ…å« 5 ä¸‡å¼ å›¾ç‰‡çš„ç”µå•†é¡¹ç›®ä¸­ï¼Œè¯¥ä»»åŠ¡æ¯å‘¨è¿è¡Œä¸€æ¬¡ï¼Œå¯é‡Šæ”¾çº¦ 30% çš„å­˜å‚¨ç©ºé—´ã€‚</p>
<hr/>
<h3 data-id="heading-33">æ€»ç»“</h3>
<p>æ ‡å‡† PHP åº“ï¼ˆSPLï¼‰æ˜¯ PHP ç”Ÿæ€ä¸­è¢«ä½ä¼°çš„ä¸€å—åŸºçŸ³ã€‚å®ƒä¸ºæ•°æ®ç»“æ„ã€è¿­ä»£ã€å¼‚å¸¸å¤„ç†æä¾›äº†é«˜æ•ˆã€æ ‡å‡†åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>å¯¹äº Laravel å¼€å‘è€…è€Œè¨€ï¼ŒSPL å¹¶ä¸æ˜¯ç”¨æ¥å–ä»£æ¡†æ¶èƒ½åŠ›ï¼Œè€Œæ˜¯åœ¨<strong>æ€§èƒ½æ•æ„Ÿæˆ–ååº•å±‚çš„é€»è¾‘ä¸­æä¾›æ›´åˆé€‚çš„å·¥å…·é€‰æ‹©</strong>ã€‚ä¸å¦¨ä»ä¸€ä¸ª <code>SplQueue</code>ã€ä¸€ä¸ªæ–‡ä»¶è¿­ä»£å™¨å¼€å§‹ï¼Œé€æ­¥å°† SPL çº³å…¥ä½ çš„æŠ€æœ¯æ ˆã€‚</p>
<p>å¦‚æœä½ å¸Œæœ›å†™å‡º<strong>æ›´æ¸…æ™°ã€æ›´é«˜æ•ˆã€æ›´ä¸“ä¸šçš„ PHP ä»£ç </strong>ï¼ŒSPL å€¼å¾—ä½ è®¤çœŸå¯¹å¾…ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 3.2 æ€§èƒ½é£è·ƒï¼š5ä¸ªä¼˜åŒ–ç­–ç•¥è®©ä½ çš„åº”ç”¨æé€Ÿ40%]]></title>    <link>https://juejin.cn/post/7591348605865951267</link>    <guid>https://juejin.cn/post/7591348605865951267</guid>    <pubDate>2026-01-05T00:17:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591348605865951267" data-draft-id="7591309945511297024" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 3.2 æ€§èƒ½é£è·ƒï¼š5ä¸ªä¼˜åŒ–ç­–ç•¥è®©ä½ çš„åº”ç”¨æé€Ÿ40%"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2026-01-05T00:17:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿æ©™çš„ç™¾å®ç®±"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 3.2 æ€§èƒ½é£è·ƒï¼š5ä¸ªä¼˜åŒ–ç­–ç•¥è®©ä½ çš„åº”ç”¨æé€Ÿ40%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿æ©™çš„ç™¾å®ç®±
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:17:07.000Z" title="Mon Jan 05 2026 00:17:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>SpringBoot 3.2 æ€§èƒ½é£è·ƒï¼š5ä¸ªä¼˜åŒ–ç­–ç•¥è®©ä½ çš„åº”ç”¨æé€Ÿ40%</strong></h2>
<h2 data-id="heading-1">å¼•è¨€</h2>
<p>SpringBoot ä¸€ç›´æ˜¯ Java ç”Ÿæ€ä¸­æ„å»ºä¼ä¸šçº§åº”ç”¨çš„æ ‡æ†æ¡†æ¶ï¼Œå…¶ç®€æ´çš„é…ç½®å’Œå¼ºå¤§çš„å¼€ç®±å³ç”¨ç‰¹æ€§æ·±å—å¼€å‘è€…å–œçˆ±ã€‚éšç€ SpringBoot 3.2 çš„å‘å¸ƒï¼Œæ€§èƒ½ä¼˜åŒ–æˆä¸ºäº†è¿™ä¸€ç‰ˆæœ¬çš„æ ¸å¿ƒäº®ç‚¹ä¹‹ä¸€ã€‚å®˜æ–¹æ•°æ®æ˜¾ç¤ºï¼Œé€šè¿‡åˆç†é…ç½®å’Œä¼˜åŒ–ç­–ç•¥ï¼Œéƒ¨åˆ†åº”ç”¨å¯ä»¥å®ç°é«˜è¾¾ <strong>40%</strong> çš„æ€§èƒ½æå‡ï¼</p>
<p>æœ¬æ–‡å°†æ·±å…¥å‰–æ SpringBoot 3.2 çš„æ€§èƒ½ä¼˜åŒ–æœºåˆ¶ï¼Œå¹¶ç»“åˆå®é™…æ¡ˆä¾‹ï¼Œåˆ†äº« <strong>5ä¸ªå…³é”®ç­–ç•¥</strong>ï¼Œå¸®åŠ©ä½ å……åˆ†é‡Šæ”¾ SpringBoot åº”ç”¨çš„æ½œåŠ›ã€‚æ— è®ºä½ æ˜¯åº”å¯¹é«˜å¹¶å‘åœºæ™¯è¿˜æ˜¯è¿½æ±‚æè‡´çš„å“åº”é€Ÿåº¦ï¼Œè¿™äº›æŠ€å·§éƒ½èƒ½ä¸ºä½ æä¾›æ˜ç¡®çš„ä¼˜åŒ–æ–¹å‘ã€‚</p>
<hr/>
<h2 data-id="heading-2">SpringBoot 3.2 æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒæ”¹è¿›</h2>
<p>åœ¨æ¢è®¨å…·ä½“ä¼˜åŒ–ç­–ç•¥ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç®€è¦äº†è§£ SpringBoot 3.2 åœ¨æ€§èƒ½æ–¹é¢çš„åº•å±‚æ”¹è¿›ï¼š</p>
<ol>
<li>
<p><strong>GraalVM Native Image æ”¯æŒå¢å¼º</strong><br/>
SpringBoot 3.2 è¿›ä¸€æ­¥ä¼˜åŒ–äº†å¯¹ GraalVM AOTï¼ˆAhead-of-Timeï¼‰ç¼–è¯‘çš„æ”¯æŒã€‚é€šè¿‡å°†åº”ç”¨ç¼–è¯‘ä¸ºåŸç”Ÿé•œåƒï¼Œå¯åŠ¨æ—¶é—´å¯ä»¥ä»ç§’çº§é™è‡³æ¯«ç§’çº§ï¼ŒåŒæ—¶å†…å­˜å ç”¨å¤§å¹…é™ä½ã€‚</p>
</li>
<li>
<p><strong>è™šæ‹Ÿçº¿ç¨‹ï¼ˆVirtual Threadsï¼‰é›†æˆ</strong><br/>
åŸºäº JDK 21+çš„è™šæ‹Ÿçº¿ç¨‹ç‰¹æ€§ï¼ŒSpringBoot 3.2 èƒ½å¤Ÿæ›´é«˜æ•ˆåœ°å¤„ç† I/Oå¯†é›†å‹ä»»åŠ¡ã€‚ç›¸æ¯”ä¼ ç»Ÿçº¿ç¨‹æ± æ¨¡å¼ï¼Œè™šæ‹Ÿçº¿ç¨‹å¯ä»¥æ˜¾è‘—å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ã€‚</p>
</li>
<li>
<p><strong>ååº”å¼ç¼–ç¨‹æ€§èƒ½æå‡</strong><br/>
å¯¹ WebFluxã€R2DBCç­‰ååº”å¼ç»„ä»¶çš„æ·±åº¦ä¼˜åŒ–ä½¿å¾—éé˜»å¡è¯·æ±‚å¤„ç†çš„ååé‡è¿›ä¸€æ­¥æå‡ã€‚</p>
</li>
<li>
<p><strong>JVMåƒåœ¾å›æ”¶è°ƒä¼˜é€‚é…</strong><br/>
é»˜è®¤é…ç½®é’ˆå¯¹ G1 GCã€ZGCç­‰ç°ä»£åƒåœ¾å›æ”¶å™¨è¿›è¡Œäº†é¢„è°ƒä¼˜ï¼Œå‡å°‘äº† STWï¼ˆStop-The-Worldï¼‰åœé¡¿æ—¶é—´ã€‚</p>
</li>
</ol>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å›´ç»•è¿™äº›åº•å±‚æ”¹è¿›å±•å¼€å…·ä½“çš„ä¼˜åŒ–ç­–ç•¥ã€‚</p>
<hr/>
<h2 data-id="heading-3">ç­–ç•¥1ï¼šå¯ç”¨GraalVM Native Imageç¼–è¯‘</h2>
<h3 data-id="heading-4"><strong>ä¸ºä»€ä¹ˆé€‰æ‹©Native Imageï¼Ÿ</strong></h3>
<p>ä¼ ç»Ÿçš„ JVMåº”ç”¨éœ€è¦ç»è¿‡ç±»åŠ è½½ã€å­—èŠ‚ç è§£é‡Šå’ŒJITç¼–è¯‘ç­‰å¤šä¸ªé˜¶æ®µæ‰èƒ½è¾¾åˆ°å³°å€¼æ€§èƒ½ã€‚è€ŒGraalVM Native Imageé€šè¿‡AOTç¼–è¯‘ç›´æ¥å°†Javaä»£ç è½¬æ¢ä¸ºæœºå™¨ç è¿è¡Œï¼š</p>
<ul>
<li><strong>å¯åŠ¨æ—¶é—´ç¼©çŸ­90%ä»¥ä¸Š</strong>ï¼ˆä»å‡ ç§’åˆ°å‡ åæ¯«ç§’ï¼‰ã€‚</li>
<li><strong>å†…å­˜å ç”¨é™ä½50%~70%</strong>ï¼ˆæ— éœ€JITç¼–è¯‘å™¨å’Œå…ƒæ•°æ®å­˜å‚¨ï¼‰ã€‚</li>
<li><strong>é€‚åˆServerlesså’Œå®¹å™¨åŒ–éƒ¨ç½²</strong>ï¼ˆå†·å¯åŠ¨é—®é¢˜æ˜¾è‘—æ”¹å–„ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-5"><strong>å¦‚ä½•å®æ–½ï¼Ÿ</strong></h3>
<p>1. æ·»åŠ ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.graalvm.buildtools<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>native-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>2. æ„å»ºåŸç”Ÿé•œåƒï¼š</p>
<pre><code class="hljs language-bash" lang="bash">mvn -Pnative native:compile
</code></pre>
<h3 data-id="heading-6"><strong>æ³¨æ„äº‹é¡¹</strong></h3>
<ul>
<li><strong>åå°„ä¸åŠ¨æ€ä»£ç†éœ€æ˜¾å¼é…ç½®</strong>ï¼šåœ¨<code>src/main/resources/META-INF/native-image</code>ä¸‹æä¾›é…ç½®æ–‡ä»¶ã€‚</li>
<li><strong>éƒ¨åˆ†åº“ä¸å…¼å®¹åŸç”Ÿç¼–è¯‘</strong>ï¼šä¾‹å¦‚HibernateæŸäº›åŠŸèƒ½éœ€æ›¿æ¢ä¸ºSpring Data JDBCæˆ–MyBatisã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-7">ç­–ç•¥2ï¼šåˆ©ç”¨è™šæ‹Ÿçº¿ç¨‹æ›¿ä»£ä¼ ç»Ÿçº¿ç¨‹æ± </h2>
<h3 data-id="heading-8"><strong>è™šæ‹Ÿçº¿ç¨‹çš„ä¼˜åŠ¿</strong></h3>
<p>JDK21å¼•å…¥çš„è™šæ‹Ÿçº¿ç¨‹ï¼ˆProject Loomï¼‰å½»åº•æ”¹å˜äº†Javaå¹¶å‘æ¨¡å‹ï¼š</p>
<ul>
<li><strong>è½»é‡çº§çº¿ç¨‹åˆ›å»ºä¸é”€æ¯</strong>ï¼ˆæ¯ä¸ªè™šæ‹Ÿçº¿ç¨‹ä»…å ç”¨å°‘é‡KBå†…å­˜ï¼‰ã€‚</li>
<li><strong>è‡ªåŠ¨è°ƒåº¦åˆ°å¹³å°çº¿ç¨‹æ± ä¸Šæ‰§è¡Œ</strong>, I/Oæ“ä½œæ—¶è‡ªåŠ¨æŒ‚èµ·ä¸é˜»å¡å†…æ ¸çº¿ç¨‹ã€‚</li>
</ul>
<h3 data-id="heading-9"><strong>é›†æˆæ­¥éª¤ç¤ºä¾‹</strong></h3>
<p>1. JVMå‚æ•°å¯ç”¨é¢„è§ˆç‰¹æ€§ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">--enable-preview --add-modules jdk.incubator.concurrent
</code></pre>
<p>2. WebæœåŠ¡å™¨é…ç½®ï¼ˆä»¥Tomcatä¸ºä¾‹ï¼‰ï¼š</p>
<pre><code class="hljs language-properties" lang="properties">server.tomcat.threads.max=200
server.tomcat.executor.virtual-threads=true
</code></pre>
<h3 data-id="heading-10"><strong>å®æµ‹æ•ˆæœ</strong></h3>
<p>æŸç”µå•†å¹³å°åœ¨å¤„ç†10,000å¹¶å‘è¯·æ±‚æ—¶ï¼š</p>
<ul>
<li><strong>ä¼ ç»Ÿçº¿ç¨‹æ± </strong>: CPUåˆ©ç”¨ç‡85%ï¼Œå¹³å‡å»¶è¿Ÿ120ms</li>
<li><strong>è™šæ‹Ÿçº¿ç¨‹æ¨¡å¼</strong>: CPUåˆ©ç”¨ç‡é™è‡³60%ï¼Œå¹³å‡å»¶è¿Ÿ45ms</li>
</ul>
<hr/>
<h2 data-id="heading-11">ç­–ç•¥3ï¼šç²¾ç»†åŒ–åƒåœ¾å›æ”¶è°ƒä¼˜</h2>
<p>###Â G1 GC vs ZGCé€‰æ‹©æŒ‡å—</p>




















<table><thead><tr><th>GCç±»å‹</th><th>Â é€‚ç”¨åœºæ™¯</th><th>Â å…³é”®å‚æ•°å»ºè®®</th></tr></thead><tbody><tr><td>G1Â Â Â Â Â </td><td>Â å †å†…å­˜&lt;32GB</td><td><code>-XX:+UseG1GC -XX:MaxGCPauseMillis=200</code></td></tr><tr><td>ZGCÂ Â Â Â </td><td>Â è¶…å¤§å †/ä½å»¶è¿Ÿéœ€æ±‚</td><td><code>-XX:+UseZGC -Xmx16g -Xms16g</code></td></tr></tbody></table>
<p>###Â SpringBootä¸“å±ä¼˜åŒ–é¡¹</p>
<pre><code class="hljs language-properties" lang="properties"># application.properties
spring.jvm.gc.logging.enabled=true #è¾“å‡ºè¯¦ç»†GCæ—¥å¿—ä¾¿äºåˆ†æ
spring.jvm.gc.mode=low-latency     #è‡ªåŠ¨è°ƒæ•´Young/OldåŒºæ¯”ä¾‹
</code></pre>
<hr/>
<p>##Â ç­–ç•¥4ï¼šç¼“å­˜ä¸æ•°æ®åº“è®¿é—®åŠ é€Ÿ</p>
<p>####Â æœ¬åœ°ç¼“å­˜é€‰å‹å¯¹æ¯”(Caffeine vs Ehcache)</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheConfig</span> {

    <span class="hljs-meta">@Bean("userCache")</span> 
    <span class="hljs-keyword">public</span> CacheManager <span class="hljs-title function_">caffeineCacheManager</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CaffeineCacheManager</span>()
            .withCacheSpec(<span class="hljs-string">"maximumSize=10000,expireAfterWrite=10m"</span>);
    }
}
</code></pre>
<h4 data-id="heading-12">R2DBCå¼‚æ­¥é©±åŠ¨å®è·µ(å¯¹æ¯”JDBC)</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
Â   <span class="hljs-attr">r2dbc:</span>
Â  Â  <span class="hljs-attr">url:</span> <span class="hljs-string">r2dbc:postgresql://localhost/test</span>Â 
Â  Â  <span class="hljs-attr">username:</span> <span class="hljs-string">dbuser</span>Â 
Â  Â  <span class="hljs-attr">password:</span> <span class="hljs-string">dbpass</span>Â 
Â   <span class="hljs-attr">jpa:</span>
Â  Â  <span class="hljs-attr">open-in-view:</span> <span class="hljs-literal">false</span> <span class="hljs-comment">#å¿…é¡»å…³é—­ï¼</span>
</code></pre>
<hr/>
<p>##Â ç­–ç•¥5ï¼šé™æ€èµ„æºä¸HTTP/3åè®®æ”¯æŒ</p>
<p>####Â æ–°ç‰ˆèµ„æºå¤„ç†ç‰¹æ€§</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Override</span>Â 
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addResourceHandlers</span><span class="hljs-params">(ResourceHandlerRegistry registry)</span> {
Â   registry.addResourceHandler(<span class="hljs-string">"/static/**"</span>)
Â  Â  Â  .addResourceLocations(<span class="hljs-string">"classpath:/static/"</span>)
Â  Â  Â  .setOptimizeLocations(<span class="hljs-literal">true</span>); <span class="hljs-comment">//æ–°å¢å“ˆå¸Œæ ¡éªŒï¼</span>
}
</code></pre>
<h4 data-id="heading-13">HTTP/3å¿«é€Ÿå¯ç”¨(éœ€Quarkus Undertow)</h4>
<pre><code class="hljs language-properties" lang="properties">server.http.version=VERSION_3Â 
server.http.host=0.0.0.0Â 
server.http.idle-timeout=30sÂ 
</code></pre>
<hr/>
<p>##Â Â æ€»ç»“</p>
<p>SpringBootÂ Â 3.2çš„æ€§èƒ½æå‡ç»éå¶ç„¶â€”â€”ä»åº•å±‚çš„GraalVMæ”¯æŒåˆ°é¡¶å±‚çš„HTTPåè®®æ ˆå‡çº§,æ¯ä¸€é¡¹æ”¹è¿›éƒ½ä¸ºå¼€å‘è€…æä¾›äº†æ›´é«˜æ•ˆçš„è¿è¡Œæ—¶ç¯å¢ƒã€‚</p>
<p>æœ¬æ–‡ä»‹ç»çš„5å¤§ç­–ç•¥å¯ç»„åˆä½¿ç”¨ï¼š
1ï¸âƒ£ Native Imageæ„å»ºæè‡´è½»é‡åº”ç”¨<br/>
2ï¸âƒ£ Virtual Threadsé‡æ„å¹¶å‘æ¨¡å‹<br/>
3ï¸âƒ£ ZGC/G1ç²¾ç»†è°ƒèŠ‚å†…å­˜ç®¡ç†<br/>
4ï¸âƒ£ Caffeine+R2DBCå®ç°æ•°æ®å±‚åŠ é€Ÿ<br/>
5ï¸âƒ£ HTTP/3+èµ„æºå‹ç¼©ä¼˜åŒ–ç½‘ç»œä¼ è¾“</p>
<p>å»ºè®®å›¢é˜Ÿæ ¹æ®è‡ªèº«æŠ€æœ¯æ ˆé€æ­¥å®æ–½éªŒè¯,é€šå¸¸åªéœ€é‡‡ç”¨å…¶ä¸­2~3é¡¹å³å¯è·å¾—æ˜¾è‘—æ”¶ç›Šã€‚"</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æ„å»ºå‰ç«¯ç›‘æ§ä½“ç³»ï¼šSentryç§æœ‰åŒ–éƒ¨ç½²ä¸é¡¹ç›®é›†æˆå®è·µ]]></title>    <link>https://juejin.cn/post/7591439477437726771</link>    <guid>https://juejin.cn/post/7591439477437726771</guid>    <pubDate>2026-01-05T00:28:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591439477437726771" data-draft-id="7591421956215914534" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ„å»ºå‰ç«¯ç›‘æ§ä½“ç³»ï¼šSentryç§æœ‰åŒ–éƒ¨ç½²ä¸é¡¹ç›®é›†æˆå®è·µ"/> <meta itemprop="keywords" content="JavaScript,ç›‘æ§"/> <meta itemprop="datePublished" content="2026-01-05T00:28:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è°¢å°é£"/> <meta itemprop="url" content="https://juejin.cn/user/2717648473034823"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ„å»ºå‰ç«¯ç›‘æ§ä½“ç³»ï¼šSentryç§æœ‰åŒ–éƒ¨ç½²ä¸é¡¹ç›®é›†æˆå®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648473034823/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è°¢å°é£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:28:37.000Z" title="Mon Jan 05 2026 00:28:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»18åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="vs2015">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1e1e1e;color:#dcdcdc}.hljs-keyword,.hljs-link,.hljs-literal,.hljs-name,.hljs-symbol{color:#569cd6}.hljs-link{text-decoration:underline}.hljs-built_in,.hljs-type{color:#4ec9b0}.hljs-class,.hljs-number{color:#b8d7a3}.hljs-meta-string,.hljs-string{color:#d69d85}.hljs-regexp,.hljs-template-tag{color:#9a5334}.hljs-formula,.hljs-function,.hljs-params,.hljs-subst,.hljs-title{color:#dcdcdc}.hljs-comment,.hljs-quote{color:#57a64a;font-style:italic}.hljs-doctag{color:#608b4e}.hljs-meta,.hljs-meta-keyword,.hljs-tag{color:#9b9b9b}.hljs-template-variable,.hljs-variable{color:#bd63c5}.hljs-attr,.hljs-attribute,.hljs-builtin-name{color:#9cdcfe}.hljs-section{color:gold}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-bullet,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-selector-tag{color:#d7ba7d}.hljs-addition{background-color:#144212}.hljs-addition,.hljs-deletion{display:inline-block;width:100%}.hljs-deletion{background-color:#600}</style><p>ã€€ã€€åœ¨ç°åœ¨å¤æ‚å¤šå˜çš„å‰ç«¯ç¯å¢ƒä¸­ï¼Œé”™è¯¯è¿½è¸ªä¸€ç›´æ˜¯ä¸ªæ£˜æ‰‹éš¾é¢˜ï¼›ç”¨æˆ·è®¾å¤‡åƒå·®ä¸‡åˆ«ã€ç”Ÿäº§ç¯å¢ƒé—®é¢˜æ˜¯éš¾ä»¥å¤ç°ï¼Œä¼ ç»Ÿæ—¥å¿—æ›´æ˜¯åŠ›ä¸ä»å¿ƒï¼›å› æ­¤æ‰èƒ½å¦‚ä½•æ›´å¥½çš„è¿½è¸ªé”™è¯¯ä¸€ç›´æ˜¯ä¸€ä¸ªé—®é¢˜ï¼›ç›®å‰å¸‚é¢ä¸Šæœ‰å¾ˆå¤šå¼€æºçš„å·¥å…·ï¼Œè€ŒSentryæ— ç–‘æ˜¯å…¶ä¸­åŠŸèƒ½ä¸°å¯Œã€æ”¯æŒç‡æœ€é«˜çš„ï¼Œå®ƒè®©é—®é¢˜å®šä½å˜å¾—å‰æ‰€æœªæœ‰åœ°æ¸…æ™°ï¼›æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»å¦‚ä½•ä¸ºå‰ç«¯é¡¹ç›®éƒ¨ç½²å’Œæ¥å…¥Sentryï¼Œä»åŸºç¡€é…ç½®åˆ°é«˜çº§ä¼˜åŒ–ï¼ŒåŠ©æ‚¨æ„å»ºæ›´ç¨³å®šçš„åº”ç”¨ä½“éªŒã€‚</p>
<p>ã€€ã€€ç»å¸¸åœ¨<code>ç”Ÿäº§ç¯å¢ƒå†™bug</code>çš„åŒå­¦éƒ½çŸ¥é“ï¼Œé¢å¯¹ç”¨æˆ·çªå¦‚å…¶æ¥çš„æŠ¥é”™æœ‰å¤šä¹ˆæ— å¥ˆï¼Œæœ¬åœ°è¿è¡Œä¸€åˆ‡æ­£å¸¸ï¼Œä½†æ˜¯ä¸€åˆ°çº¿ä¸Šï¼Œå°±çŠ¶å†µç™¾å‡ºï¼šè«åçš„ç™½å±ã€äº¤äº’çš„å¡æ­»ã€æ§åˆ¶å°çš„æŠ¥é”™ï¼›æ›´ä»¤äººæŠ“ç‹‚çš„æ˜¯ï¼Œç”¨æˆ·çš„åé¦ˆæ°¸è¿œåªæœ‰ä¸€å¥ï¼šâ€œé¡µé¢æ‰“å¼€å°±è¿™æ ·äº†å•Šï¼â€ä½ æ ¹æœ¬æ— æ³•çœ‹åˆ°ç”¨æˆ·çš„æ“ä½œè½¨è¿¹ï¼Œä¸çŸ¥é“ä»–ä»¬ç‚¹å‡»äº†ä»€ä¹ˆã€è¾“å…¥äº†ä»€ä¹ˆã€é‡åˆ°äº†ä»€ä¹ˆå¼‚å¸¸ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/153c372e57dc47f88f1122ba0c0ca0a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=z5SKbJUnF9zZf3wYJSopY4lhsQs%3D" alt="å‡ºç°é”™è¯¯å´©æºƒ" loading="lazy"/></p>
<p>ã€€ã€€è¿™ç§æ²¡æœ‰ç›‘æ§çš„è¢«åŠ¨åé¦ˆå°±åƒæ˜¯åœ¨é»‘å¤œä¸­æ‘¸ç´¢ç€ä¿®ç†ä¸€å°ç²¾å¯†çš„ä»ªå™¨ï¼Œä½ åªèƒ½ä»ä»ªå™¨å¶å°”å‘å‡ºçš„å¼‚å“æ¥çŒœæµ‹é—®é¢˜å‡ºåœ¨å“ªï¼Œå´çœ‹ä¸æ¸…å†…éƒ¨å“ªä¸ªé½¿è½®å¡ä½ã€å“ªæ ¹ç”µè·¯ç†”æ–­ï¼Œè¿‡ç¨‹ç¼“æ…¢ä¸”æ— å¥ˆã€‚</p>
<p>ã€€ã€€ç°åœ¨æˆ‘ä»¬æœ‰äº†<code>å¼€æº</code>çš„Sentryï¼Œå°±åƒæ¢è£…ä¸Šäº†å…ˆè¿›æ¢æµ‹çš„æ°®åŒ–é•“é›·è¾¾ç³»ç»Ÿï¼Œå®ƒèƒ½å¤Ÿæ•è·å‰ç«¯çš„æ¯ä¸€æ¬¡å¼‚å¸¸ï¼Œè®°å½•ç”¨æˆ·æ“ä½œçš„å…¨é“¾è·¯è½¨è¿¹ï¼Œè®©ç”Ÿäº§ç¯å¢ƒçš„å´©æºƒç¬é—´å®šæ ¼ä¸ºæ¸…æ™°çš„è¯Šæ–­æŠ¥å‘Šå’Œç›‘æ§å½•åƒï¼Œä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹ä¸€ä¸‹å¦‚ä½•éƒ¨ç½²Sentryã€‚</p>
<h2 data-id="heading-0">ç§æœ‰åŒ–æœåŠ¡éƒ¨ç½²</h2>
<p>ã€€ã€€Sentryè‹±æ–‡ç¿»è¯‘è¿‡æ¥ï¼Œæ„æ€æ˜¯<code>â€œå“¨å…µâ€</code>ï¼Œåœ¨å¼€å§‹é›†æˆSentryä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç»™è¿™ä½â€œå¿ è¯šâ€çš„å“¨å…µå»ºé€ ä¸€åº§åšå®çš„â€œå²—äº­â€ï¼›æ˜¯ç›´æ¥è®©å®ƒé©»å®ˆåœ¨å®˜æ–¹çš„å…¬å…±äº‘åŸºåœ°ï¼ˆSaaSæœåŠ¡ï¼‰ï¼Œè¿˜æ˜¯åœ¨ä½ è‡ªå·±çš„ç½‘ç»œé¢†åœ°å†…ä¸ºå®ƒæ­å»ºä¸€åº§ä¸“å±çš„å ¡å’ï¼ˆç§æœ‰åŒ–éƒ¨ç½²ï¼‰ï¼Ÿè¿™ä¸ªé€‰æ‹©è‡³å…³é‡è¦ã€‚</p>
<p>ã€€ã€€å®˜æ–¹SaaSæœåŠ¡æ˜¯â€œæ‹åŒ…å…¥ä½â€çš„å¿«æ·é€‰æ‹©â€”â€”æ³¨å†Œå³ç”¨ã€è‡ªåŠ¨ç»´æŠ¤ã€åŠŸèƒ½å³æ—¶æ›´æ–°ï¼Œå°¤å…¶é€‚åˆå¤§å¤šæ•°ç‹¬ç«‹å¼€å‘è€…å’Œåˆåˆ›å›¢é˜Ÿã€‚å…è´¹å¥—é¤è¶³ä»¥æ”¯æ’‘å‰æœŸçš„æ ¸å¿ƒç›‘æ§éœ€æ±‚ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/517baaca6a7b4048ae2cc5cbfcf39dad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=ChjXj6bRIobkWgyKgpr%2FWZlULq4%3D" alt="Sentryä»·æ ¼" loading="lazy"/></p>
<p>ã€€ã€€ä½†æ˜¯ï¼Œå½“ä½ çš„é¡¹ç›®éœ€è¦æ»¡è¶³ä¸¥æ ¼çš„å†…ç½‘åˆè§„è¦æ±‚æ—¶ï¼Œå°†å“¨å…µå’Œæ‰€æœ‰ç›‘æ§æ•°æ®éƒ½ç•™åœ¨è‡ªå·±çš„åŸå¢™ä¹‹å†…ï¼Œå°±æˆä¸ºäº†å¿…é¡»ã€‚ç§æœ‰åŒ–éƒ¨ç½²èµ‹äºˆäº†ä½ å¯¹æ•°æ®ã€ç½‘ç»œå’Œç‰ˆæœ¬çš„å®Œå…¨æ§åˆ¶æƒï¼Œè™½ç„¶éƒ¨ç½²å’Œç»´æŠ¤æˆæœ¬ç›¸åº”å¢åŠ ï¼Œä½†å®ƒå¸¦æ¥çš„å®‰å…¨æ€§å’Œè‡ªä¸»æ€§ï¼Œå¯¹äºè®¸å¤šä¼ä¸šçº§åº”ç”¨è€Œè¨€æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚</p>
<p>ã€€ã€€åœ¨å‘å…¬å¸è¿ç»´åŒäº‹â€œè½¯ç£¨ç¡¬æ³¡â€åï¼Œæˆ‘ä»¬æˆåŠŸç”³è¯·åˆ°äº†ä¸€å°å¦‚ä¸‹é…ç½®ä¸“ç”¨æœåŠ¡å™¨æ¥éƒ¨ç½²Sentryï¼š</p>
<ul>
<li>CPU: 8æ ¸</li>
<li>å†…å­˜: 16G</li>
<li>ç¡¬ç›˜: 50G</li>
</ul>
<p>ã€€ã€€è¿™ä¸ªé…ç½®éƒ¨ç½²Sentryï¼Œè¯´å®è¯ï¼Œå·²ç»ç®—æ˜¯æ‰“äº†ä¸ªâ€œå¯Œè£•ä»—â€â€”â€”æ¯•ç«Ÿå®˜æ–¹æ¨èçš„æœ€ä½é…ç½®æ˜¯4æ ¸8Gï¼Œæˆ‘ä»¬è¿™å·²ç»è¾¾åˆ°äº†ä¸­ç­‰ç”Ÿäº§ç¯å¢ƒçš„è¦æ±‚ã€‚å……è¶³çš„èµ„æºæ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ›´ä»å®¹åœ°é…ç½®ç¼“å­˜ã€å¯ç”¨æ›´å¤šå·¥ä½œè¿›ç¨‹ï¼Œå¹¶ä¸ºæœªæ¥çš„æ•°æ®å¢é•¿ç•™è¶³ç©ºé—´ã€‚</p>
<p>ã€€ã€€åœ¨æ¥ä¸‹æ¥çš„æ­¥éª¤ä¸­ï¼Œæˆ‘ä»¬å°†åŸºäºè¿™å°â€œå¯Œè£•â€çš„æœåŠ¡å™¨æ¥å®‰è£…ï¼Œä½¿ç”¨<code>Docker Compose</code>çš„æ ‡å‡†åŒ–éƒ¨ç½²ï¼›é¦–å…ˆå…‹éš†sentry-self-hostedè¿™ä¸ªé¡¹ç›®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/getsentry/self-hosted.git sentry-self-hosted
<span class="hljs-built_in">cd</span> sentry-self-hosted
./install.sh
</code></pre>
<p>ã€€ã€€ç„¶åå°±å¯ä»¥çœ‹åˆ°é•œåƒå’”å’”åœ°å¼€å§‹ä¸‹è½½ï¼Œä¸‹è½½åˆ°ä¸€åŠï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°è¿™æ ·çš„æç¤ºï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">Hey, so ... we would love <span class="hljs-keyword">to</span> automatically find out about issues <span class="hljs-keyword">with</span> your
Sentry instance so that we can improve the product. Turns out there <span class="hljs-built_in">is</span> an app
<span class="hljs-keyword">for</span> that, called Sentry. Would you be willing <span class="hljs-keyword">to</span> <span class="hljs-keyword">let</span> us automatically send data
about your instance upstream <span class="hljs-keyword">to</span> Sentry <span class="hljs-keyword">for</span> development <span class="hljs-built_in">and</span> debugging purposes?

  y / yes / <span class="hljs-number">1</span>
  n / no / <span class="hljs-number">0</span>

(Btw, we send this <span class="hljs-keyword">to</span> our own self-hosted Sentry instance, <span class="hljs-built_in">not</span> <span class="hljs-keyword">to</span> Sentry SaaS,
so that we can be <span class="hljs-keyword">in</span> this together.)

Here<span class="hljs-comment">'s the info we may collect:</span>

  - OS username
  - IP address
  - install log
  - runtime errors
  - performance data

Thirty (<span class="hljs-number">30</span>) day retention. No marketing. Privacy policy at sentry.io/privacy.
</code></pre>
<p>ã€€ã€€è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„åŒ¿åæ•°æ®è´¡çŒ®æç¤ºï¼Œç”¨äºå¸®åŠ©Sentryå›¢é˜Ÿæ”¹è¿›äº§å“åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®è‡ªèº«éœ€æ±‚å’Œæ•°æ®æ”¿ç­–ï¼Œè‡ªç”±é€‰æ‹©åŒæ„æˆ–è·³è¿‡ã€‚å½“æ‰€æœ‰å¿…éœ€çš„Dockeré•œåƒæˆåŠŸä¸‹è½½å®Œæˆåï¼Œç»ˆç«¯å°†æ˜¾ç¤ºç±»ä¼¼ä¸‹å›¾çš„æç¤ºä¿¡æ¯ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2da06605ce448c7837306494aff6cb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=5rXII4KVt0XUDAfbkmycCMWBrbY%3D" alt="ä¸‹è½½å®Œæˆ" loading="lazy"/></p>
<p>ã€€ã€€æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŒ‰ç…§æç¤ºå‘½ä»¤ä»¥å¯åŠ¨SentryæœåŠ¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker compose up --<span class="hljs-built_in">wait</span>
</code></pre>
<p>ã€€ã€€æœåŠ¡å¯åŠ¨åï¼Œåœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š<code>http://[ä½ çš„æœåŠ¡å™¨IP]:9000/</code>ï¼ŒæœŸå¾…å·²ä¹…çš„Sentryç®¡ç†ç•Œé¢ä¾¿ä¼šå±•ç°åœ¨çœ¼å‰ã€‚ä¸è¿‡ï¼Œå¦‚æœå› ä¸ºæˆ‘ä»¬æ˜¯é¦–æ¬¡å¯åŠ¨æœåŠ¡ï¼Œç³»ç»Ÿä¼šå‡ºäºå®‰å…¨è€ƒè™‘ï¼Œé€šå¸¸ä¼šæ˜¾ç¤ºä¸€ä¸ªå…³äºCSRFï¼ˆè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼‰ä¿æŠ¤çš„é…ç½®æç¤ºé¡µé¢ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46a468cc42bc4b92a50b8c4197c7276a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=qo%2Bp1C0wIhUBPjRQ7%2B8t5vrrin0%3D" alt="CSRF" loading="lazy"/></p>
<p>ã€€ã€€è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦ä¿®æ”¹sentryç›®å½•ä¸‹çš„sentry.conf.pyæ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">vim sentry/sentry.conf.py
</code></pre>
<p>ã€€ã€€å°†æˆ‘ä»¬çš„åŸŸåæ·»åŠ åˆ°CSRF_TRUSTED_ORIGINSä¸­ï¼Œä¸€èˆ¬æ·»åŠ å†…ç½‘çš„ipåœ°å€ï¼Œä»¥åŠéƒ¨ç½²sentryçš„åŸŸåå³å¯ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">CSRF_TRUSTED_ORIGINS</span> = [<span class="hljs-string">"https://sentry.[your domain].com"</span>, <span class="hljs-string">"http://127.0.0.1:9000"</span>, <span class="hljs-string">"http://[your ip]:9000"</span>]
</code></pre>
<p>ã€€ã€€ç»è¿‡ä¸Šé¢çš„ä¿®æ”¹åï¼Œæˆ‘ä»¬å†æ¬¡é‡å¯æœåŠ¡ï¼Œç›¸ä¿¡Sentryå°±å¯ä»¥æ­£å¸¸è®¿é—®äº†ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">docker compose down
docker compose up --<span class="hljs-built_in">wait</span>
</code></pre>
<p>ã€€ã€€æœ€åæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°è¿™æ ·çš„ä¸€ä¸ªæ¬¢è¿ç•Œé¢ï¼Œè¿™é‡Œæ ¹æ®æç¤ºå¡«å†™ç½‘ç«™çš„æ ¹è·¯å¾„å’Œç®¡ç†å‘˜é‚®ç®±åœ°å€ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dbf8fa8929674d5ab5f7bcbb9dd15d27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=6LYYDr95k0ffGu%2FenJg6iwI%2FLAc%3D" alt="æ¬¢è¿ç•Œé¢" loading="lazy"/></p>
<p>ã€€ã€€Sentryé»˜è®¤ä¼šä¿ç•™<code>90å¤©</code>çš„æ—¥å¿—æ•°æ®ã€‚å¦‚æœæœåŠ¡å™¨å­˜å‚¨èµ„æºç´§å¼ ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹<code>.env</code>æ–‡ä»¶ä¸­çš„<code>SENTRY_EVENT_RETENTION_DAYS</code>é…ç½®é¡¹æ¥ç¼©çŸ­æ•°æ®ä¿ç•™å‘¨æœŸï¼Œä¾‹å¦‚å°†å…¶ä»90å¤©è°ƒæ•´ä¸º30æˆ–15å¤©ã€‚è¿™èƒ½æœ‰æ•ˆé‡Šæ”¾å­˜å‚¨å‹åŠ›ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ›´çŸ­çš„æ•°æ®ä¿ç•™å‘¨æœŸä¼šé™åˆ¶å†å²é—®é¢˜çš„å›æº¯ä¸åˆ†æèƒ½åŠ›ã€‚</p>
<h3 data-id="heading-1">é‚®ä»¶é…ç½®</h3>
<p>ã€€ã€€é‚®ä»¶é…ç½®æ˜¯Sentryéƒ¨ç½²åè‡³å…³é‡è¦çš„ä¸€ç¯ï¼Œå®ƒç›´æ¥å…³ç³»åˆ°å›¢é˜Ÿçš„åä½œæ•ˆç‡å’Œé—®é¢˜æ„ŸçŸ¥åº¦ï¼Œå¦‚æœæ²¡æœ‰é…ç½®é‚®ä»¶ï¼Œå°†ä¸èƒ½é‚€è¯·å›¢é˜Ÿæˆå‘˜ï¼›æˆ‘ä»¬éœ€è¦åœ¨<code>sentry/config.yml</code>æ–‡ä»¶ä¸­æ­£ç¡®è®¾ç½®SMTPé‚®ä»¶æœåŠ¡å™¨çš„ä¿¡æ¯ï¼š</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment"># SMTPåœ°å€</span>
mail.host: <span class="hljs-string">'smtp.example.com'</span>
<span class="hljs-comment"># ç«¯å£</span>
mail.port: <span class="hljs-number">465</span>
<span class="hljs-comment"># è´¦å·</span>
mail.username: <span class="hljs-string">'XXX@example.com.cn'</span>
<span class="hljs-comment"># å¯†ç </span>
mail.password: <span class="hljs-string">'XXX'</span>
<span class="hljs-comment"># æ˜¯å¦ä½¿ç”¨SSL</span>
mail.<span class="hljs-keyword">use</span>-ssl: <span class="hljs-literal">true</span>
<span class="hljs-comment"># å‘é€æ–¹</span>
mail.<span class="hljs-keyword">from</span>: <span class="hljs-string">'XXX@example.com.cn'</span>
</code></pre>
<p>ã€€ã€€ä¸€æ—¦é…ç½®æˆåŠŸï¼ŒSentryçš„é‚®ä»¶ç³»ç»Ÿå°†æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>é‚€è¯·ç”¨æˆ·æ³¨å†Œï¼šå…è®¸ç”¨æˆ·é€šè¿‡é‚®ä»¶é‚€è¯·åŠ å…¥ç»„ç»‡ã€‚</li>
<li>å®æ—¶å‘Šè­¦é€šçŸ¥ï¼šå½“æŸä¸ªé”™è¯¯é¢‘ç‡è¶…è¿‡è®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œç«‹å³å‘é€é‚®ä»¶é€šçŸ¥ç”¨æˆ·ã€‚</li>
<li>å®šæœŸæ‘˜è¦ï¼šå¯é…ç½®æ¯æ—¥/æ¯å‘¨å‘é€é”™è¯¯æ‘˜è¦æŠ¥å‘Šã€‚</li>
</ul>
<p>ã€€ã€€è®¾ç½®æˆåŠŸï¼Œé‡å¯æœåŠ¡å™¨åï¼Œæ‰“å¼€<code>æ§åˆ¶å° =&gt; ç®¡ç† =&gt; Mail</code>ï¼Œçœ‹åˆ°åˆšæ‰çš„é…ç½®äº†ï¼Œè¿˜å¯ä»¥å‘é€ä¸€å°æµ‹è¯•é‚®ä»¶ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b22fc402313f48098784654e7369759f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=%2Brx2z2huV%2BsfJP%2FxGTP%2FSoM5PWk%3D" alt="SMTPè®¾ç½®" loading="lazy"/></p>
<h2 data-id="heading-2">é¡¹ç›®æ¥å…¥</h2>
<p>ã€€ã€€ä¸Šé¢Sentryéƒ¨ç½²å®Œæˆåï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ„‰å¿«åœ°å°†æˆ‘ä»¬æ‰‹ä¸Šçš„é¡¹ç›®æ¥æ¥å…¥Sentryäº†ï¼›ç™»å½•æ§åˆ¶å°ï¼Œç‚¹å‡»<code>åˆ›å»ºé¡¹ç›®</code>ï¼Œç„¶åé€‰æ‹©Vueä½œä¸ºå¹³å°ï¼Œè¾“å…¥é¡¹ç›®åç§°<code>(Project slug)</code>ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8cc511ad1eb44aab93288e16d18a9b7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=j5Y%2FQRq5S2Y78n%2FDFS2K2KrWZAQ%3D" alt="åˆ›å»ºé¡¹ç›®" loading="lazy"/></p>
<p>ã€€ã€€åˆ›å»ºé¡¹ç›®åï¼Œæ ¹æ®æç¤ºï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ä¸ª<code>DSNç </code>ï¼Œè¿™ä¸ªDSNç æ˜¯Sentryä¸Vueé¡¹ç›®ä¹‹é—´çš„é€šä¿¡æ¡¥æ¢ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªDSNé…ç½®åˆ°Vueé¡¹ç›®ä¸­ã€‚</p>
<p>ã€€ã€€Sentryæä¾›äº†Vueçš„å®˜æ–¹æ’ä»¶ï¼ˆæ”¯æŒVue2æˆ–è€…Vue3ï¼‰ï¼Œæˆ‘ä»¬åœ¨Vueé¡¹ç›®ä¸­å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ¥å…¥Sentry;è¿™é‡Œä»¥Vue3é¡¹ç›®ä¸ºä¾‹ï¼Œå®‰è£…å®˜æ–¹SDKæ’ä»¶ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">pnpm add @sentry/vue
</code></pre>
<p>ã€€ã€€åªéœ€è¦åœ¨main.tsä¸­å¼•å…¥å¹¶åˆå§‹åŒ–å³å¯ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Sentry</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@sentry/vue'</span>;
<span class="hljs-keyword">import</span> pkg <span class="hljs-keyword">from</span> <span class="hljs-string">'../package.json'</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bootstrap</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>);
  
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
    app,
    <span class="hljs-attr">dsn</span>: <span class="hljs-string">'ã€your-dsnã€‘'</span>,
    <span class="hljs-attr">sendDefaultPii</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-comment">// ç¯å¢ƒ</span>
    <span class="hljs-attr">environment</span>: <span class="hljs-variable constant_">VITE_ENV</span>,
    <span class="hljs-attr">release</span>: <span class="hljs-string">`[project slug]@<span class="hljs-subst">${pkg.version}</span>`</span>
  });
  
  app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>);
}
</code></pre>
<p>ã€€ã€€è¿™é‡Œå±æ€§æ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬é€ä¸ªä»‹ç»æ¯ä¸ªå‚æ•°çš„ä½œç”¨ï¼›æˆ‘ä»¬å°†<code>createApp</code>åˆ›å»ºåçš„Vueå®ä¾‹ä¼ å…¥åˆå§‹åŒ–å‡½æ•°ï¼Œå¦‚æœæœ‰å¤šä¸ªå®ä¾‹ï¼Œè¿˜æ”¯æŒæ•°ç»„æ ¼å¼ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
  <span class="hljs-attr">app</span>: [app1, app2, app3],
  <span class="hljs-attr">dsn</span>: <span class="hljs-string">'[your-dsn]'</span>,
})
</code></pre>
<p>ã€€ã€€è€Œ<code>sendDefaultPii</code>æ§åˆ¶æ˜¯å¦å‘é€ç”¨æˆ·ä¿¡æ¯ï¼Œé»˜è®¤ä¸ºfalseï¼Œåªæ”¶é›†æœ€ç®€å•çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æµè§ˆå™¨ä»¥åŠç‰ˆæœ¬ã€æ“ä½œç³»ç»Ÿï¼›å¦‚æœä¸ºtrueï¼Œåˆ™Sentryä¼šå‘é€æ›´è¯¦ç»†çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚ï¼šæµè§ˆå™¨è¯¦ç»†agentã€æ“ä½œç³»ç»Ÿã€è®¾å¤‡ç±»å‹ã€IPåœ°å€ç­‰ä¸ªäººèº«ä»½ä¿¡æ¯ï¼›å¼€å¯å‰ç¡®è®¤ç¬¦åˆGDPRç­‰éšç§æ³•è§„è¦æ±‚ï¼Œæ›´å¤šå…³äºGDPRçš„è¯¦æƒ…ï¼Œè¯·æŸ¥çœ‹<a href="https://link.juejin.cn?target=https%3A%2F%2Fxieyufei.com%2F2024%2F11%2F02%2FAccept-Cookie.html" target="_blank" title="https://xieyufei.com/2024/11/02/Accept-Cookie.html" ref="nofollow noopener noreferrer">æµè§ˆç½‘ç«™æ—¶ä¸ºä»€ä¹ˆè€æ˜¯è¦æˆ‘æ¥å—Cookie</a>æ–‡ç« ã€‚</p>
<p>ã€€ã€€<code>environment</code>å­—æ®µæ ¹æ®åç§°æˆ‘ä»¬ä¹Ÿèƒ½çŒœåˆ°ï¼Œæ ‡è¯†å½“å‰ç¯å¢ƒï¼Œæ¯”å¦‚å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒç­‰ï¼Œä¾¿äºè¿‡æ»¤å’Œç»Ÿè®¡ç‰¹å®šç¯å¢ƒçš„é”™è¯¯æŠ¥å‘Šï¼›<code>release</code>å­—æ®µåˆ™æ˜¯é¡¹ç›®çš„ç‰ˆæœ¬å·ï¼Œç”¨äºæ ‡è¯†å½“å‰é¡¹ç›®ï¼Œæ–¹ä¾¿åç»­æŸ¥çœ‹ï¼Œæ¨èä¸º<code>é¡¹ç›®å@ç‰ˆæœ¬å·</code>æ ¼å¼ï¼Œç²¾ç¡®è¿½è¸ªç‰¹å®šç‰ˆæœ¬çš„é—®é¢˜ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥ä»package.jsonè‡ªåŠ¨è·å–ç‰ˆæœ¬å·ï¼Œç¡®ä¿ç‰ˆæœ¬å·çš„ä¸€è‡´æ€§ã€‚</p>
<h3 data-id="heading-3">é›†æˆæ’ä»¶</h3>
<p>ã€€ã€€Sentryæ”¯æŒå°†å¾ˆå¤šåŠŸèƒ½é€šè¿‡æ’ä»¶çš„å½¢å¼é›†æˆè¿›æ¥ï¼›ä¸‹é¢æˆ‘ä»¬ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„é›†æˆåŠŸèƒ½ã€‚é¦–å…ˆå°±æ˜¯æµè§ˆå™¨è¿½è¸ª<code>browserTracingIntegration</code>é›†æˆï¼Œç”¨äºè¿½è¸ªæµè§ˆå™¨ä¸­çš„é”™è¯¯å’Œæ€§èƒ½æ•°æ®ï¼Œæ¯”å¦‚é¡µé¢åŠ è½½æ—¶é—´ã€èµ„æºåŠ è½½æ—¶é—´ã€ç”¨æˆ·è¡Œä¸ºç­‰ç­‰ï¼›åŒæ—¶ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†Vue Routerï¼Œè¿˜å¯ä»¥å°†Routeré›†æˆè¿›æ¥ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
  <span class="hljs-attr">integrations</span>: [
    <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">browserTracingIntegration</span>({ 
      router,
      <span class="hljs-attr">routeLabel</span>: <span class="hljs-string">'name'</span>
    })
  ],
  <span class="hljs-attr">tracesSampleRate</span>: <span class="hljs-number">0.8</span>,
})
</code></pre>
<p>ã€€ã€€<code>routeLabel</code>å‚æ•°å†³å®šäº†Sentryå¦‚ä½•æ ‡è¯†ä½ çš„è·¯ç”±é¡µé¢ï¼Œé»˜è®¤ä¸ºpathï¼ŒSentryä¸­è·¯ç”±å°±ä¼šæ˜¾ç¤ºå…·ä½“è·¯å¾„ï¼Œæ¯”å¦‚<code>/user/:id/profile</code>ï¼›è€Œä¿®æ”¹ä¸ºnameï¼ŒSentryä¸­è·¯ç”±å°±ä¼šæ˜¾ç¤ºè·¯ç”±åç§°ï¼Œæ¯”å¦‚<code>UserProfile</code>ï¼Œæ›´ä¸ºç®€æ´ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16702f0d2e6d43898b78e2246578ba9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=pzRcHoil%2FmP%2BlyGCwB%2BKji8z1lI%3D" alt="æµè§ˆå™¨è¿½è¸ª" loading="lazy"/></p>
<p>ã€€ã€€<code>tracesSampleRate</code>å‚æ•°æ§åˆ¶ç€ç”¨æˆ·åœ¨ä½¿ç”¨æ—¶ï¼Œæ€§èƒ½æ•°æ®è¢«ä¸ŠæŠ¥çš„æ¦‚ç‡ï¼Œè¿™æ˜¯ä¸€ä¸ªéœ€è¦åœ¨æ•°æ®è´¨é‡å’Œç³»ç»Ÿå¼€é”€ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹çš„é‡è¦é…ç½®é¡¹ï¼›æœ€å¤§å€¼ä¸º1,è¡¨ç¤º100%ä¸ŠæŠ¥ï¼Œè¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸º0.8ï¼Œæ„å‘³ç€åœ¨ç”¨æˆ·ä½¿ç”¨æ—¶ï¼Œæœ‰20%çš„æ¦‚ç‡ä¼šä¸ŠæŠ¥æ€§èƒ½æ•°æ®ã€‚</p>
<p>ã€€ã€€åœ¨å¼€å‘å’Œè°ƒè¯•é˜¶æ®µï¼Œå¯ä»¥è®¾ç½®ä¸ºè¾ƒé«˜çš„å€¼ï¼Œæ¯”å¦‚1.0ï¼Œè¿™æ ·å¯ä»¥è®©æ‰€æœ‰çš„æ€§èƒ½æ•°æ®éƒ½ä¸ŠæŠ¥ï¼Œæ–¹ä¾¿è°ƒè¯•ï¼›å½“é¡¹ç›®å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªè¾ƒä½çš„å€¼ï¼Œæ¯”å¦‚0.1ï¼Œè¿™æ ·åªæœ‰10%çš„ç”¨æˆ·ä½¿ç”¨ï¼Œæ€§èƒ½æ•°æ®æ‰ä¼šä¸ŠæŠ¥ï¼Œä»è€Œæé«˜æœåŠ¡å™¨çš„æ‰¿è½½åŠ›ã€‚</p>
<p>ã€€ã€€å¯¹äºå¤æ‚åœºæ™¯ï¼ŒSentryæ”¯æŒæ›´æ™ºèƒ½çš„åŠ¨æ€é‡‡æ ·ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
  <span class="hljs-attr">tracesSampleRate</span>: <span class="hljs-number">0.1</span>,
  <span class="hljs-attr">tracesSampler</span>: <span class="hljs-function">(<span class="hljs-params">samplingContext</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> { name } = samplingContext;

    <span class="hljs-comment">// æµ‹è¯•ç¯å¢ƒ</span>
    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> === <span class="hljs-string">"test"</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">1.0</span>;
    }

    <span class="hljs-comment">// æ”¯ä»˜é¡µé¢</span>
    <span class="hljs-keyword">if</span> (name.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"/pay"</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">0.8</span>;
    }

    <span class="hljs-comment">// ç™»å½•é¡µé¢</span>
    <span class="hljs-keyword">if</span> (name.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"/login"</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">0.6</span>;
    }

    <span class="hljs-keyword">return</span> <span class="hljs-number">0.1</span>;
  },
})
</code></pre>
<p>ã€€ã€€æ¯”å¦‚æˆ‘ä»¬åœ¨æµ‹è¯•ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æ‰€æœ‰çš„æ•°æ®éƒ½ä¸ŠæŠ¥ï¼Œæ”¯ä»˜é¡µé¢å’Œç™»é™†é¡µé¢ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰80%å’Œ60%çš„æ¦‚ç‡ä¸ŠæŠ¥ï¼Œå…¶ä»–é¡µé¢ï¼Œæˆ‘ä»¬å¸Œæœ›æœ‰10%çš„æ¦‚ç‡ä¸ŠæŠ¥ã€‚</p>
<p>ã€€ã€€å¦ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„é›†æˆæ’ä»¶å°±æ˜¯<code>replayIntegration</code>ä¼šè¯å›æ”¾é›†æˆï¼Œå®ƒå…è®¸æˆ‘ä»¬å½•åˆ¶å¹¶å›æ”¾ç”¨æˆ·åœ¨ç½‘ç«™ä¸Šçš„çœŸå®æ“ä½œè¿‡ç¨‹ï¼›ä¼ ç»Ÿçš„ç›‘æ§æ¨¡å¼åªèƒ½ä½“ç°æŠ¥é”™å †æ ˆçš„å†…å®¹ï¼Œä½†æ˜¯ç”¨æˆ·ç‚¹å‡»äº†ä»€ä¹ˆæ‰å¯¼è‡´è¿™ä¸ªé”™è¯¯ï¼Ÿç‚¹å‡»å‰é¡µé¢æ˜¯ä»€ä¹ˆçŠ¶æ€ï¼Ÿå¯¹äºè¿™äº›æƒ…å†µæˆ‘ä»¬ä¸€æ¦‚éƒ½ä¸æ¸…æ¥šã€‚é€šè¿‡é›†æˆ<code>replayIntegration</code>æ’ä»¶åï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç®¡ç†åå°æŸ¥çœ‹é”™è¯¯å‘ç”Ÿå‰å‡ åˆ†é’Ÿçš„ç”¨æˆ·æ“ä½œå½•åƒï¼Œä»è€Œæ›´å®¹æ˜“å¸®åŠ©æˆ‘ä»¬å®šä½é—®é¢˜ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
  <span class="hljs-attr">integrations</span>: [
    <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">replayIntegration</span>(),
  ],
  <span class="hljs-comment">// 10% ä¼šè¯å½•åˆ¶</span>
  <span class="hljs-attr">replaysSessionSampleRate</span>: <span class="hljs-number">0.1</span>,
  <span class="hljs-comment">// 100% é”™è¯¯æ—¶å½•åˆ¶</span>
  <span class="hljs-attr">replaysOnErrorSampleRate</span>: <span class="hljs-number">1.0</span>,
})
</code></pre>
<p>ã€€ã€€è¿™é‡Œçš„<code>replaysSessionSampleRate</code>ç”¨äºè®¾ç½®å¸¸è§„ç”¨æˆ·ä¼šè¯å½•åˆ¶çš„é‡‡æ ·ç‡ï¼Œè€Œ<code>replaysOnErrorSampleRate</code>åˆ™ä¸“ç”¨äºå¯¹å‘ç”Ÿé”™è¯¯çš„ä¼šè¯è¿›è¡Œå½•åˆ¶çš„é‡‡æ ·ç‡ï¼Œä¸€èˆ¬è®¾ä¸º100%ï¼Œè¡¨ç¤ºæ‰€æœ‰é”™è¯¯éƒ½è¿›è¡Œå½•åˆ¶ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96a18cab0d494d6c8f5dbf0ebfbbfa69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=fu3idI4bGXslW6w5F9hjP0SpPT0%3D" alt="é”™è¯¯å½•åˆ¶å›æ”¾" loading="lazy"/></p>
<p>ã€€ã€€è¿™é‡Œæˆ‘ä»¬åœ¨ç•Œé¢ä¸Šæœ‰ä¸€äº›æ–‡å­—å’Œè¾“å…¥æ¡†ï¼Œåœ¨å›æ”¾ç•Œé¢ä¸Šéƒ½è¢«ç”¨**ç»™éšè—äº†ï¼›è¿™ä¹Ÿæ˜¯å› ä¸ºGDPRæ”¿ç­–çš„é™åˆ¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒSentryä¼šéšè—ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬ï¼Œé˜²æ­¢æ•æ„Ÿä¿¡æ¯æ³„éœ²ï¼›æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢ä¸‰ä¸ªå‚æ•°è®¾ä¸ºfalseï¼Œæ¥æ˜¾ç¤ºæ‰€æœ‰å†…å®¹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">replayIntegration</span>({
  <span class="hljs-comment">// éšè—æ‰€æœ‰çš„æ–‡æœ¬</span>
  <span class="hljs-attr">maskAllText</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-comment">// éšè—æ‰€æœ‰çš„è¾“å…¥æ¡†</span>
  <span class="hljs-attr">maskAllInputs</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-comment">// å±è”½æ‰€æœ‰çš„imgã€canvasç­‰åª’ä½“</span>
  <span class="hljs-attr">blockAllMedia</span>: <span class="hljs-literal">false</span>,
})
</code></pre>
<blockquote>
<p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡<code>unblock</code>ã€<code>mask</code>ã€<code>unmask</code>ç­‰å­—æ®µç²¾ç¡®æ§åˆ¶æ–‡æœ¬çš„æ˜¾ç¤ºå’Œéšè—ï¼›ä¾‹å¦‚æˆ‘ä»¬é€šè¿‡è®¾ç½®maskå­—æ®µï¼Œé’ˆå¯¹å¯†ç è¾“å…¥æ¡†ç­‰ç‰¹æ®Šå†…å®¹è¿›è¡Œé®æŒ¡å±è”½ã€‚</p>
</blockquote>
<p>ã€€ã€€è¿˜æœ‰ä¸€ä¸ªvueé¡¹ç›®ä¸­å¯ä»¥ç”¨çš„é›†æˆæ’ä»¶å°±æ˜¯<code>vueIntegration</code>ï¼Œç”¨äºè¿½è¸ªæ‰€æœ‰Vueç»„ä»¶çš„é”™è¯¯å’Œæ€§èƒ½æ•°æ®ï¼Œæ¯”å¦‚åœ¨ç»„ä»¶åŠ è½½mountedã€æ›´æ–°updateã€é”€æ¯unmountçš„ç”Ÿå‘½å‘¨æœŸä¸­è¿›è¡Œè¿½è¸ªã€‚</p>
<p>ã€€ã€€vueIntegrationæ’ä»¶æœ‰ä¸€ä¸ª<code>tracingOptions</code>å‚æ•°ï¼Œå¯ä»¥æ§åˆ¶æˆ‘ä»¬éœ€è¦è¿½è¸ªçš„ç»„ä»¶ï¼Œé»˜è®¤trackComponentsä¸ºfalseï¼Œè¡¨ç¤ºä¸è¿½è¸ªç»„ä»¶ï¼Œè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºè¿½è¸ªæ‰€æœ‰ç»„ä»¶ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
  <span class="hljs-attr">integrations</span>: [
    <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">vueIntegration</span>({
      <span class="hljs-attr">tracingOptions</span>: {
        <span class="hljs-comment">// è¿½è¸ªæ‰€æœ‰ç»„ä»¶</span>
        <span class="hljs-attr">trackComponents</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-comment">// OR ç‰¹å®šç»„ä»¶</span>
        <span class="hljs-attr">trackComponents</span>: [
          <span class="hljs-string">"App"</span>,
          <span class="hljs-string">"RwvHeader"</span>,
          <span class="hljs-string">"RwvFooter"</span>,
          <span class="hljs-string">"RwvArticleList"</span>,
          <span class="hljs-string">"Pagination"</span>,
        ],
      },
    }),
  ],
});
</code></pre>
<p>ã€€ã€€é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ›´ç²¾ç¡®çš„æ§åˆ¶ï¼Œç»„ä»¶çš„å“ªäº›ç”Ÿå‘½å‘¨æœŸä¼šè¿›è¡Œè¿½è¸ªï¼›ä¾‹å¦‚æˆ‘ä»¬åªæƒ³è¦åœ¨ç»„ä»¶è¢«é”€æ¯æ—¶è¿›è¡Œè¿½è¸ªï¼Œé‚£ä¹ˆå¯ä»¥è®¾ç½®ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">vueIntegration</span>({
  <span class="hljs-attr">tracingOptions</span>: {
    <span class="hljs-attr">trackComponents</span>: <span class="hljs-literal">true</span>
    <span class="hljs-attr">hooks</span>: [<span class="hljs-string">"mount"</span>, <span class="hljs-string">"update"</span>, <span class="hljs-string">"unmount"</span>],
  }
})
</code></pre>
<blockquote>
<p>é»˜è®¤è¿½è¸ªçš„hooksæ˜¯<code>['activate', 'mount', 'update']</code>ã€‚</p>
</blockquote>
<blockquote>
<p>Vue2é¡¹ç›®ä¸­è¿½è¸ªç»„ä»¶é”€æ¯ä½¿ç”¨<code>destroy</code>ï¼Œè€Œä¸æ˜¯<code>unmount</code>ã€‚</p>
</blockquote>
<p>ã€€ã€€å¦ä¸€ä¸ªVueé¡¹ç›®å¯ä»¥æ·»åŠ çš„é›†æˆæ’ä»¶æ˜¯<code>createSentryPiniaPlugin</code>ï¼Œæ˜¯Sentryä¸º<code>PiniaçŠ¶æ€ç®¡ç†åº“</code>æä¾›çš„æ’ä»¶ï¼Œç”¨äºè¿½è¸ªstoreä¸­çš„å¼‚å¸¸å’ŒçŠ¶æ€å˜åŒ–ï¼›å®ƒçš„é›†æˆæ–¹å¼å’Œä¸Šé¢çš„æœ‰æ‰€å·®å¼‚ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">"pinia"</span>;
<span class="hljs-keyword">import</span> { createSentryPiniaPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">"@sentry/vue"</span>;

<span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>();
pinia.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">createSentryPiniaPlugin</span>());
</code></pre>
<p>ã€€ã€€createSentryPiniaPluginä¼šå°†æœ€åçŠ¶æ€ä½œä¸ºé™„ä»¶ä¸Šä¼ åˆ°æŠ¥é”™ä¿¡æ¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç®¡ç†åå°æŸ¥çœ‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/781cf8f762a543598669bc94279f88e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=xw3wGVHwQFU43oJfu8afKnqKEpM%3D" alt="PiniaæŠ¥é”™çŠ¶æ€" loading="lazy"/></p>
<p>ã€€ã€€æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®attachPiniaStateä¸ºfalseï¼Œæ¥å…³é—­PiniaçŠ¶æ€çš„é™„ä»¶ä¸Šä¼ ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">createSentryPiniaPlugin</span>({
  <span class="hljs-attr">attachPiniaState</span>: <span class="hljs-literal">false</span>,
})
</code></pre>
<p>ã€€ã€€æœ€åä¸€ä¸ªé›†æˆæ’ä»¶æ˜¯<code>captureConsoleIntegration</code>ï¼Œå®ƒçš„ä½œç”¨æ˜¯å°†æ§åˆ¶å°æ‰“å°çš„ä¿¡æ¯å…¨éƒ¨ä¸ŠæŠ¥ç»™Sentryï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">init</span>({
  <span class="hljs-attr">integrations</span>: [
    <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureConsoleIntegration</span>({
      <span class="hljs-comment">// é»˜è®¤æ˜¯æ‰€æœ‰æ—¥å¿—çº§åˆ«</span>
      <span class="hljs-attr">levels</span>: [<span class="hljs-string">'log'</span>, <span class="hljs-string">'info'</span>, <span class="hljs-string">'warn'</span>, <span class="hljs-string">'error'</span>, <span class="hljs-string">'debug'</span>, <span class="hljs-string">'assert'</span>]
    }),
  ]
})
</code></pre>
<p>ã€€ã€€æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡<code>levels</code>å­—æ®µè®¾ç½®ä¸ŠæŠ¥çš„æ—¥å¿—çº§åˆ«ï¼›ä¸ŠæŠ¥åï¼Œåœ¨ç®¡ç†åå°ä¸­æˆ‘ä»¬åœ¨å¯¹åº”çš„äº‹åŠ¡ä¸­å°±èƒ½çœ‹åˆ°æ—¥å¿—ä¿¡æ¯ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2b684e1184c4dadab00ab1a472fb21e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=M1HrID4fN2BlbH0wpoTzzb3X%2FuA%3D" alt="æ§åˆ¶å°ä¿¡æ¯ä¸ŠæŠ¥" loading="lazy"/></p>
<h3 data-id="heading-4">è‡ªå®šä¹‰ä¸ŠæŠ¥</h3>
<p>ã€€ã€€åœ¨é”™è¯¯è¿½è¸ªæ—¶ï¼ŒçŸ¥é“â€œå“ªä¸ªç”¨æˆ·é‡åˆ°äº†é—®é¢˜â€å¾€å¾€æ¯”çŸ¥é“â€œå‡ºç°äº†ä»€ä¹ˆé—®é¢˜â€æ›´æœ‰ä»·å€¼ï¼›Sentryçš„<code>setUser</code>å‡½æ•°æ­£æ˜¯è¿æ¥é”™è¯¯ä¸ç”¨æˆ·çš„æ¡¥æ¢ï¼Œå®ƒèƒ½å°†å½“å‰ç”¨æˆ·çš„ä¿¡æ¯å…³è”åˆ°åç»­ä¸ŠæŠ¥çš„é”™è¯¯å’Œæ€§èƒ½äº‹åŠ¡ä¸­ã€‚å½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œä½ ä¸å†åªæ˜¯çœ‹åˆ°ä¸€ä¸ªå†°å†·çš„å †æ ˆè·Ÿè¸ªï¼Œè€Œæ˜¯èƒ½æ¸…æ™°åœ°çŸ¥é“ï¼š</p>
<ul>
<li>å“ªä¸ªç”¨æˆ·é‡åˆ°äº†è¿™ä¸ªé”™è¯¯</li>
<li>è¿™ä¸ªç”¨æˆ·çš„åŸºæœ¬å±æ€§</li>
<li>ç”¨æˆ·çš„ä½¿ç”¨ç¯å¢ƒä¿¡æ¯</li>
</ul>
<p>ã€€ã€€è€Œç”¨æˆ·ç™»å½•é¡µé¢æ­£æ˜¯è®¾ç½®ç”¨æˆ·åŸºæœ¬å±æ€§çš„æœ€ä½³æ—¶æœºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Sentry</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@sentry/vue"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">loginAPI</span>(params);
  <span class="hljs-keyword">const</span> user = res.<span class="hljs-property">data</span>.<span class="hljs-property">user</span>;
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">setUser</span>({
    <span class="hljs-attr">id</span>: user.<span class="hljs-property">id</span>,
    <span class="hljs-attr">email</span>: user.<span class="hljs-property">email</span>,
    <span class="hljs-attr">username</span>: user.<span class="hljs-property">username</span>,
    <span class="hljs-comment">// è‡ªå®šä¹‰å­—æ®µ</span>
    <span class="hljs-comment">// ç§Ÿæˆ·id</span>
    <span class="hljs-attr">tenantId</span>: user.<span class="hljs-property">tenantId</span>,
    <span class="hljs-comment">// å›½å®¶</span>
    <span class="hljs-attr">country</span>: user.<span class="hljs-property">country</span>,
    <span class="hljs-comment">// éƒ¨é—¨</span>
    <span class="hljs-attr">department</span>: user.<span class="hljs-property">department</span>,
    <span class="hljs-comment">// å…¶ä»–å­—æ®µ...</span>
  });

  <span class="hljs-comment">// å¯é€‰ï¼šè®¾ç½®ç”¨æˆ·æ ‡ç­¾ä¾¿äºç­›é€‰</span>
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">setTag</span>(<span class="hljs-string">'user.tier'</span>, user.<span class="hljs-property">tier</span>);
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">setTag</span>(<span class="hljs-string">'user.plan'</span>, user.<span class="hljs-property">plan</span>);
}
</code></pre>
<p>ã€€ã€€åœ¨ç”¨æˆ·é€€å‡ºç™»å½•æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦é€šè¿‡setUseræ¸…ç†ä¿¡æ¯ï¼Œå¦åˆ™ä¼šå¯¼è‡´å‡ºç°ç”¨æˆ·ä¿¡æ¯â€œå¼ å† ææˆ´â€çš„æƒ…å†µã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Sentry</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@sentry/vue"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogout</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">setUser</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">setTag</span>(<span class="hljs-string">'user.tier'</span>, <span class="hljs-literal">null</span>);
  <span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">setTag</span>(<span class="hljs-string">'user.plan'</span>, <span class="hljs-literal">null</span>);
}
</code></pre>
<p>ã€€ã€€åœ¨Sentryä»ªè¡¨ç›˜ï¼Œè¿›è¡Œé¡¹ç›®ï¼Œåœ¨æ¯ä¸ªç”¨æˆ·è·¯ç”±è·Ÿè¸ªçš„ä¸Šé¢ï¼Œæˆ‘ä»¬å°±èƒ½çœ‹åˆ°ç”¨æˆ·ä¿¡æ¯ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcd974842a044ae5b4aa11c905456a2d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=qY9WmKEFG9jYbMxQVMBEwEHWajQ%3D" alt="ç»‘å®šç”¨æˆ·" loading="lazy"/></p>
<p>ã€€ã€€é™¤æ­¤ä¹‹å¤–ï¼ŒSentryè¿˜æä¾›äº†ä¸°å¯Œçµæ´»çš„å„ç§è‡ªå®šä¹‰ä¸ŠæŠ¥å‡½æ•°ï¼Œè®©æˆ‘ä»¬ä¸ä»…èƒ½å¤Ÿæ•è·é”™è¯¯ï¼Œè¿˜èƒ½ä¸»åŠ¨ä¸ŠæŠ¥å„ç§äº‹ä»¶æ¶ˆæ¯ï¼›å…¶ä¸­æœ€æ ¸å¿ƒã€æœ€å¸¸ç”¨çš„ä¸ŠæŠ¥å‡½æ•°å°±æ˜¯<code>captureException</code>ï¼Œå®ƒå¯ä»¥ç”¨æ¥ä¸ŠæŠ¥ä»»æ„ç±»å‹çš„Javascripté”™è¯¯ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Sentry</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@sentry/vue"</span>;

<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureException</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Something went wrong!"</span>));
</code></pre>
<p>ã€€ã€€<code>captureMessage</code>æ˜¯Sentryä¸­ç”¨äºä¸ŠæŠ¥è‡ªå®šä¹‰æ¶ˆæ¯çš„æ ¸å¿ƒå‡½æ•°ã€‚ä¸åŒäºcaptureExceptionä¸“é—¨å¤„ç†å¼‚å¸¸ï¼ŒcaptureMessage æ›´åƒæ˜¯ç›‘æ§ç‰ˆçš„console.logï¼Œä¸“é—¨ç”¨äºè®°å½•åº”ç”¨çŠ¶æ€ã€ç”¨æˆ·è¡Œä¸ºã€æ€§èƒ½æŒ‡æ ‡ç­‰éå¼‚å¸¸ä¿¡æ¯ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> <span class="hljs-title class_">Sentry</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@sentry/vue"</span>;

<span class="hljs-comment">// åŸºæœ¬ç”¨æ³•ï¼šä¸ŠæŠ¥æ–‡æœ¬æ¶ˆæ¯</span>
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'ç”¨æˆ·ç™»å½•æˆåŠŸ'</span>);
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'è®¢å•åˆ›å»ºå®Œæˆ'</span>);
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'é¡µé¢åŠ è½½æ—¶é—´è¿‡é•¿'</span>);

<span class="hljs-comment">// å¸¦çº§åˆ«çš„æ¶ˆæ¯</span>
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'è°ƒè¯•ä¿¡æ¯'</span>, <span class="hljs-string">'debug'</span>);     <span class="hljs-comment">// è°ƒè¯•çº§åˆ«</span>
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'ç”¨æˆ·æ“ä½œè®°å½•'</span>, <span class="hljs-string">'info'</span>);    <span class="hljs-comment">// ä¿¡æ¯çº§åˆ«ï¼ˆé»˜è®¤ï¼‰</span>
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡80%'</span>, <span class="hljs-string">'warning'</span>); <span class="hljs-comment">// è­¦å‘Šçº§åˆ«</span>
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'APIå“åº”æ—¶é—´è¶…è¿‡5ç§’'</span>, <span class="hljs-string">'error'</span>);  <span class="hljs-comment">// é”™è¯¯çº§åˆ«</span>
<span class="hljs-title class_">Sentry</span>.<span class="hljs-title function_">captureMessage</span>(<span class="hljs-string">'æ•°æ®åº“è¿æ¥å¤±è´¥'</span>, <span class="hljs-string">'fatal'</span>);     <span class="hljs-comment">// è‡´å‘½çº§åˆ«</span>
</code></pre>
<h2 data-id="heading-5">sourcemapä¸Šä¼ </h2>
<p>ã€€ã€€åœ¨æœªå¯ç”¨Source Mapçš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§ç¯å¢ƒçš„é”™è¯¯å †æ ˆå°±åƒä¸€å›¢åŠ å¯†åçš„ä¹±ç ï¼Œä½ åªèƒ½çœ‹åˆ°ç±»ä¼¼a1b2c3.min.js:1:23456 è¿™æ ·ä»¤äººå›°æƒ‘çš„å®šä½ï¼Œå‡ ä¹æ— æ³•è¿½æº¯åˆ°å¼•å‘é—®é¢˜çš„åŸå§‹ä¸šåŠ¡é€»è¾‘ã€‚ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c119673342a4c2a95d4c12ad83dfa5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=xJy%2FoKy%2FQQ5Ikmv4ltWoGHM8irg%3D" alt="æŠ¥é”™ä¿¡æ¯" loading="lazy"/></p>
<p>ã€€ã€€è€ŒSource Mapçš„ä½œç”¨ï¼Œæ­£æ˜¯ä¸ºè¿™å›¢â€œä¹±ç â€æä¾›äº†ä¸€æŠŠç²¾å‡†çš„è§£ç é’¥åŒ™ï¼›é€šè¿‡æ­£ç¡®é…ç½®å¹¶ä¸Šä¼ ï¼Œé”™è¯¯å †æ ˆå°†è¿˜åŸä¸ºæ¸…æ™°å¯è¯»çš„æºç è·¯å¾„ï¼Œä¾‹å¦‚ src/components/Checkout.vue:42:8ã€‚æ­¤æ—¶ï¼Œæœ‰æ„ä¹‰çš„å˜é‡åã€ç†Ÿæ‚‰çš„å‡½æ•°åå’Œå®Œæ•´çš„ä»£ç ä¸Šä¸‹æ–‡éƒ½å°†ä¸€è§ˆæ— ä½™ï¼Œè®©å®šä½å’Œæ’æŸ¥é—®é¢˜çš„è¿‡ç¨‹ä»â€œå¤§æµ·æé’ˆâ€å˜ä¸ºâ€œæŒ‰å›¾ç´¢éª¥â€ï¼Œæ•ˆç‡å¾—åˆ°è´¨çš„æå‡ã€‚</p>
<h3 data-id="heading-6">è·å–ä¸‰ä¸ªé‡è¦å‚æ•°</h3>
<p>ã€€ã€€åœ¨é…ç½®ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ç®¡ç†åå°è·å–ä¸‰ä¸ªé‡è¦çš„å‚æ•°ä¿¡æ¯ï¼Œé¦–å…ˆæ˜¯org-slugï¼Œè¡¨ç¤ºç»„ç»‡åç§°ï¼Œè¿›å…¥<code>è®¾ç½® =&gt; å¸¸è§„è®¾ç½® =&gt; Organization Slug</code>å°±å¯ä»¥è·å–ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65a11b7d25d444b388118fab0502f1f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=6j3RwzSziqeUoBHTQhwXvDmp2RQ%3D" alt="Organization Slug" loading="lazy"/></p>
<p>ã€€ã€€ç„¶åæ˜¯project-slugï¼Œä»£è¡¨æ˜¯é¡¹ç›®çš„åç§°ï¼Œåœ¨Sentryä¸­è¿›å…¥å…·ä½“é¡¹ç›®åï¼Œå¯ä»¥æŸ¥çœ‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43819fc1ad654c1aaff9b695f5283179~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=ydltB0xFcbWO%2Fasi8vSPWcyIc60%3D" alt="Project Slug" loading="lazy"/></p>
<p>ã€€ã€€æœ€åä¸€ä¸ªï¼Œä¹Ÿæ˜¯æœ€å…³é”®çš„<code>authToken</code>ï¼Œä»£è¡¨æˆæƒä»¤ç‰Œï¼Œè¿›å…¥<code>è®¾ç½® =&gt; å¼€å‘è®¾ç½® =&gt; Organization Tokens</code>ä¸­åˆ›å»ºä¸€ä¸ªTokenï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1a70f237a04479fb3ed06a61adcdb48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=wjAw9XCDLFqVGF%2BgHf4IMZDNXVY%3D" alt="Auth Token" loading="lazy"/></p>
<p>ã€€ã€€æˆ‘ä»¬åœ¨å¼€å‘è®¾ç€ä¸­ä¼šçœ‹åˆ°ä¸¤ç§ç±»å‹çš„Tokenï¼Œä¸€ç§æ˜¯<code>Personal Access Token</code>ï¼Œå¦ä¸€ç§æ˜¯<code>Organization Token</code>ï¼Œå®ƒä»¬ä¹‹é—´ä¸»è¦åŒºåˆ«å¦‚ä¸‹è¡¨ï¼š</p>








































<table><thead><tr><th>ç‰¹æ€§</th><th>Personal Tokens</th><th>Organization Tokens</th></tr></thead><tbody><tr><td>å½’å±ä¸»ä½“</td><td>ä¸ªäººç”¨æˆ·è´¦æˆ·</td><td>ç»„ç»‡</td></tr><tr><td>æƒé™èŒƒå›´</td><td>ç»§æ‰¿ç”¨æˆ·çš„æƒé™</td><td>ç»§æ‰¿ç»„ç»‡æƒé™</td></tr><tr><td>åˆ›å»ºè€…</td><td>ç”¨æˆ·è‡ªå·±</td><td>ç»„ç»‡ç®¡ç†å‘˜æˆ– Owner</td></tr><tr><td>ç”Ÿå‘½å‘¨æœŸ</td><td>ç”¨æˆ·ç¦»èŒåå¤±æ•ˆ</td><td>ä¸ç”¨æˆ·è§£è€¦ï¼ŒæŒç»­æœ‰æ•ˆ</td></tr><tr><td>ä½¿ç”¨åœºæ™¯</td><td>ä¸ªäººå¼€å‘ã€è°ƒè¯•</td><td>å›¢é˜Ÿåä½œã€CI/CDã€è‡ªåŠ¨åŒ–</td></tr><tr><td>å¯è§æ€§</td><td>ä»…åˆ›å»ºè€…å¯è§</td><td>ç»„ç»‡ç®¡ç†å‘˜å¯è§</td></tr></tbody></table>
<p>ã€€ã€€<strong>éœ€è¦æ³¨æ„</strong>çš„æ˜¯ï¼ŒauthTokenä¸åº”ç›´æ¥å†™åœ¨é¡¹ç›®ä»£ç é‡Œï¼Œä»¥å…æ„å¤–æ³„éœ²ã€‚æ¨èçš„å®è·µæ˜¯é…ç½®åœ¨æŒç»­é›†æˆç¯å¢ƒï¼ˆå¦‚ Jenkinsï¼‰çš„æ„å»ºå‚æ•°æˆ–ä¿å¯†å˜é‡ä¸­ï¼Œç„¶ååœ¨æ„å»ºè„šæœ¬ä¸­é€šè¿‡å‘½ä»¤æ¥è°ƒç”¨ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨Jenkinsæ„å»ºè„šæœ¬ä¸­æ·»åŠ ç¯å¢ƒå˜é‡ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">export</span> VITE_SENTRY_AUTH_TOKEN=<span class="hljs-string">"ã€your-auth-tokenã€‘"</span>
npm run build
</code></pre>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šé…ç½®Linuxçš„ç¯å¢ƒå˜é‡ï¼Œç­‰å·ä¸¤è¾¹ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
</blockquote>
<p>ã€€ã€€æˆ–è€…åœ¨æ„å»ºæœåŠ¡å™¨ä¸Šåˆ›å»º<code>.env.production.local</code>çš„é…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬gitå¿½ç•¥<code>.env.*.local</code>çš„æ–‡ä»¶ï¼›è¿™æ ·åœ¨æ„å»ºæ—¶ï¼Œä¼šè‡ªåŠ¨æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># .env.production.local</span>
<span class="hljs-attr">VITE_SENTRY_AUTH_TOKEN</span> = sntrys_org_xxx_yyy_zzz
</code></pre>
<h3 data-id="heading-7">æ„å»ºå·¥å…·é…ç½®</h3>
<p>ã€€ã€€ä¸Šé¢æˆ‘ä»¬ä¸Šä¼ sourcemapæ‰€éœ€è¦çš„ä¸‰ä¸ªå‚æ•°ä¿¡æ¯éƒ½æœ‰äº†ï¼Œä¸‹é¢ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨æ„å»ºå·¥å…·ä¸­è¿›è¡Œé…ç½®ä¸Šä¼ ï¼›å¦‚æœæ˜¯webpacké¡¹ç›®ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> { sentryWebpackPlugin } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@sentry/webpack-plugin'</span>)

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">devtool</span>: <span class="hljs-string">"hidden-source-map"</span>,
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">sentryWebpackPlugin</span>({
      <span class="hljs-attr">url</span>: <span class="hljs-string">'ã€your-urlã€‘'</span>,
      <span class="hljs-attr">org</span>: <span class="hljs-string">'ã€org-slugã€‘'</span>,
      <span class="hljs-attr">project</span>: <span class="hljs-string">'ã€project-slugã€‘'</span>,
      <span class="hljs-attr">authToken</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">VUE_SENTRY_AUTH_TOKEN</span>,
      <span class="hljs-attr">release</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">`ã€project-slugã€‘@ã€versionã€‘`</span>,
      },
      <span class="hljs-attr">sourcemaps</span>: {
        <span class="hljs-attr">filesToDeleteAfterUpload</span>: [
          <span class="hljs-string">"./dist/**/*.map"</span>,
        ],
      },
    }),
  ],
}
</code></pre>
<p>ã€€ã€€å¦‚æœæ˜¯viteé¡¹ç›®ï¼Œç¼–è¾‘<code>vite.config.ts</code>æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { sentryVitePlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'@sentry/vite-plugin'</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">sourcemap</span>: <span class="hljs-string">"hidden"</span>,
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">sentryVitePlugin</span>({
      <span class="hljs-attr">url</span>: <span class="hljs-string">'ã€your-urlã€‘'</span>,
      <span class="hljs-attr">org</span>: <span class="hljs-string">'ã€org-slugã€‘'</span>,
      <span class="hljs-attr">project</span>: <span class="hljs-string">'ã€project-slugã€‘'</span>,
      <span class="hljs-attr">authToken</span>: <span class="hljs-variable constant_">VITE_SENTRY_AUTH_TOKEN</span> || <span class="hljs-string">''</span>,
      <span class="hljs-attr">release</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">`ã€project-slugã€‘@ã€versionã€‘`</span>,
      },
      <span class="hljs-attr">sourcemaps</span>: {
        <span class="hljs-attr">filesToDeleteAfterUpload</span>: [
          <span class="hljs-string">'./dist/assets/*.map'</span>
        ],
      },
    }),
  ]
}
</code></pre>
<blockquote>
<p>urléœ€è¦æ”¹ä¸ºè‡ªå·±æœåŠ¡å™¨çš„åœ°å€ï¼Œå¦‚æœä¸å†™é»˜è®¤ä¼šä¼ åˆ°Sentryçš„å®˜æ–¹æœåŠ¡å™¨ã€‚</p>
</blockquote>
<p>ã€€ã€€è¿™é‡Œçš„<code>filesToDeleteAfterUpload</code>å­—æ®µï¼Œéƒ½æ˜¯ç”¨æ¥åœ¨ä¸Šä¼ æˆåŠŸåï¼Œåˆ é™¤æœ¬åœ°çš„sourcemapæ–‡ä»¶ï¼Œé˜²æ­¢sourcemapæ–‡ä»¶æ³„æ¼ï¼›è€Œ<code>release</code>å­—æ®µï¼Œåˆ™æ˜¯ç”¨æ¥æŒ‡å®šä¸Šä¼ çš„ç‰ˆæœ¬å·ï¼Œéœ€è¦å’Œä¸Šé¢Sentry.initä¸­çš„releaseé…ç½®ä¸€è‡´ã€‚</p>
<p>ã€€ã€€å¦‚æœåç»­å†æ¬¡å‡ºç°æŠ¥é”™,æˆ‘ä»¬å¯ä»¥åœ¨Sentryä¸­å¾ˆæ–¹ä¾¿çš„å®šä½åˆ°æŠ¥é”™æºç ä½ç½®ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5355ca5ee0e42c18e91ee4336df5d93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LCi5bCP6aOe:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768177716&amp;x-signature=Lj7Vavd8zxLH1imaAFst99OcJlc%3D" alt="æ˜ å°„å¯¹åº”æºç ä½ç½®" loading="lazy"/></p>
<h2 data-id="heading-8">æ€»ç»“</h2>
<p>ã€€ã€€ğŸ‰ æ­å–œä½ ï¼è·Ÿç€æœ¬æ–‡æŒ‡å—èµ°å®Œï¼Œç›¸ä¿¡ä½ å·²ç»æˆåŠŸä¸ºä½ çš„å‰ç«¯é¡¹ç›®è¯·æ¥äº†ä¸€ä½ â€œ7 * 24å°æ—¶ä¸çœ¨çœ¼çš„å…¨èƒ½å“¨å…µâ€ â€”â€”Sentryï¼æ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹ä»Sentryç§æœ‰åŒ–æœåŠ¡æ­å»ºå¼€å§‹ï¼Œæˆ‘ä»¬é€šè¿‡Docker Composeåœ¨ç‹¬ç«‹æœåŠ¡å™¨ä¸Šå»ºç«‹äº†ä¸“å±ç›‘æ§ä¸­å¿ƒï¼Œç¡®ä¿æ•°æ®å®‰å…¨å¯æ§ã€‚è¿™å°±åƒæ˜¯ç»™é¡¹ç›®é…å¤‡äº†ä¸€ä¸ª24å°æ—¶ä¸çœ¨çœ¼çš„æ•°å­—å“¨å…µã€‚</p>
<p>ã€€ã€€åœ¨é¡¹ç›®é›†æˆç¯èŠ‚ï¼Œæˆ‘ä»¬ä»åŸºç¡€SDKé…ç½®å…¥æ‰‹ï¼Œé€æ­¥å®ç°äº†é”™è¯¯æ•è·ã€ç”¨æˆ·è¿½è¸ªã€æ€§èƒ½ç›‘æ§ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚ç‰¹åˆ«é’ˆå¯¹Vueç”Ÿæ€ï¼Œæˆ‘ä»¬é…ç½®äº†è·¯ç”±è¿½è¸ªã€PiniaçŠ¶æ€ç›‘æ§ã€ç»„ä»¶ç”Ÿå‘½å‘¨æœŸè¿½è¸ªç­‰é’ˆå¯¹æ€§æ–¹æ¡ˆï¼Œè®©ç›‘æ§è¦†ç›–åˆ°åº”ç”¨çš„æ¯ä¸ªè§’è½ã€‚</p>
<p>ã€€ã€€å…³é”®æŠ€æœ¯é…ç½®æ–¹é¢ï¼Œæˆ‘ä»¬é‡ç‚¹è§£å†³äº†ç”Ÿäº§ç¯å¢ƒè°ƒè¯•çš„ä¸¤å¤§éš¾é¢˜ï¼šä¸€æ˜¯é€šè¿‡Source Mapè‡ªåŠ¨ä¸Šä¼ æœºåˆ¶ï¼Œå°†å‹ç¼©ä»£ç çš„æŠ¥é”™ä¿¡æ¯è¿˜åŸä¸ºå¯è¯»çš„æºç ä½ç½®ï¼›äºŒæ˜¯é€šè¿‡æ™ºèƒ½é‡‡æ ·ç­–ç•¥ï¼Œåœ¨ç›‘æ§ç²¾åº¦ä¸ç³»ç»Ÿå¼€é”€ä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ã€‚</p>
<p>ã€€ã€€æœ€ç»ˆï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªä»å‰ç«¯å¼‚å¸¸å‘ç”Ÿåˆ°å¼€å‘å›¢é˜Ÿå“åº”çš„å®Œæ•´é—­ç¯ã€‚ç°åœ¨å½“çº¿ä¸Šé—®é¢˜å‡ºç°æ—¶ï¼Œä¸å†éœ€è¦ä¾èµ–ç”¨æˆ·æ¨¡ç³Šçš„æè¿°ï¼Œè€Œæ˜¯å¯ä»¥ç›´æ¥æŸ¥çœ‹é”™è¯¯è¯¦æƒ…ã€ç”¨æˆ·æ“ä½œå›æ”¾ã€æ€§èƒ½æ•°æ®ç­‰å¤šç»´åº¦ä¿¡æ¯ï¼Œå¤§å¤§ç¼©çŸ­äº†é—®é¢˜æ’æŸ¥æ—¶é—´ã€‚ä»æ­¤ï¼Œçº¿ä¸Šbugä¸å†æ˜¯â€œè–›å®šè°”çš„çŒ«â€ï¼Œè®©æ¯ä¸ªçº¿ä¸Šé—®é¢˜éƒ½æ— å¤„éå½¢ï¼Œæ˜¾è‘—æå‡äº†åº”ç”¨çš„ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p>å¦‚æœè§‰å¾—å†™å¾—è¿˜ä¸é”™ï¼Œè¯·å…³æ³¨æˆ‘çš„<a href="//juejin.im/user/580038cebf22ec0064bd0b2d" target="_blank" title="//juejin.im/user/580038cebf22ec0064bd0b2d">æ˜é‡‘ä¸»é¡µ</a>ã€‚æ›´å¤šæ–‡ç« è¯·è®¿é—®<a href="https://link.juejin.cn?target=http%3A%2F%2Fxieyufei.com" target="_blank" title="http://xieyufei.com" ref="nofollow noopener noreferrer">è°¢å°é£çš„åšå®¢</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŒäº‹é—®æˆ‘ MySQL ç”¨å•¥æ’åºè§„åˆ™ï¼Œæˆ‘å·®ç‚¹ç­”ä¸ä¸Šæ¥]]></title>    <link>https://juejin.cn/post/7591350620189196294</link>    <guid>https://juejin.cn/post/7591350620189196294</guid>    <pubDate>2026-01-05T00:46:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620189196294" data-draft-id="7581678301216473088" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŒäº‹é—®æˆ‘ MySQL ç”¨å•¥æ’åºè§„åˆ™ï¼Œæˆ‘å·®ç‚¹ç­”ä¸ä¸Šæ¥"/> <meta itemprop="keywords" content="åç«¯,MySQL"/> <meta itemprop="datePublished" content="2026-01-05T00:46:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨‹åºå‘˜å¤§å"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŒäº‹é—®æˆ‘ MySQL ç”¨å•¥æ’åºè§„åˆ™ï¼Œæˆ‘å·®ç‚¹ç­”ä¸ä¸Šæ¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨‹åºå‘˜å¤§å
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:46:14.000Z" title="Mon Jan 05 2026 00:46:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å‰å‡ å¤©ï¼Œæˆ‘åœ¨å»ºæ•°æ®åº“çš„æ—¶å€™ï¼ŒåŒäº‹åˆšå¥½åœ¨æˆ‘æ—è¾¹ï¼Œä»–é—®æˆ‘ï¼šâ€œä½ å»ºåº“ä¸€èˆ¬ç”¨ä»€ä¹ˆæ’åºè§„åˆ™ï¼Œæ€ä¹ˆæ„Ÿè§‰éƒ½ä¸€æ ·å•Šï¼â€ã€‚</p>
<p>æœ¬æ¥æˆ‘è¿˜æƒ³è£…ä¸€ä¸‹çš„ï¼Œå¯å‘ç°æˆ‘è¶Šè®²è¶Šä¸å¯¹ï¼Œèµ¶ç´§å»æœäº†ä¸€ä¸‹ç›¸å…³çŸ¥è¯†ï¼Œè¿™å¯ç»ˆäºæ•´æ˜ç™½äº†ã€‚</p>
<p>ä¸‹é¢ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹ã€‚</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯æ’åºè§„åˆ™ï¼ˆCollationï¼‰ï¼Ÿ</h2>
<p>ç®€å•è¯´ï¼š<strong>æ’åºè§„åˆ™å†³å®šäº† MySQL æ€ä¹ˆâ€œçœ‹â€å­—ç¬¦ä¸²ã€‚</strong></p>
<p>æ¯”å¦‚ï¼š</p>
<ul>
<li>å®ƒè®¤ä¸º <code>'A'</code> å’Œ <code>'a'</code> æ˜¯ä¸€æ ·çš„å—ï¼Ÿ</li>
<li>å®ƒè§‰å¾— <code>'Ã©'</code> å’Œ <code>'e'</code> è¦ä¸è¦åŒºåˆ†ï¼Ÿ</li>
<li>ä¸­æ–‡å­—ç¬¦æŒ‰ä»€ä¹ˆé¡ºåºæ’ï¼Ÿ</li>
</ul>
<p><strong>Collationï¼ˆæ’åºè§„åˆ™ï¼‰</strong> å°±æ˜¯è§£å†³è¿™äº›é—®é¢˜çš„ã€‚</p>
<h2 data-id="heading-1">æ’åºè§„åˆ™é•¿ä»€ä¹ˆæ ·ï¼Ÿ</h2>
<p>MySQL çš„æ’åºè§„åˆ™åå­—é€šå¸¸åƒè¿™æ ·ï¼š</p>
<pre><code class="hljs">utf8mb4_0900_ai_ci
utf8mb4_general_ci
utf8mb4_bin
</code></pre>
<p>å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83e44148eae64b7e8c59099fb5b942ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768178773&amp;x-signature=%2FKHzaSGW0fFcRp07v4Az%2FRmQgM8%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»¬æ‹†å¼€æ¥çœ‹ï¼š</p>





























<table><thead><tr><th>éƒ¨åˆ†</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>utf8mb4</code></td><td>å­—ç¬¦é›†ï¼ˆæ”¯æŒ emojiã€ä¸­æ–‡ã€è‹±æ–‡ç­‰æ‰€æœ‰ Unicode å­—ç¬¦ï¼‰</td></tr><tr><td><code>0900</code></td><td>åŸºäº Unicode 9.0.0 æ ‡å‡†ï¼ˆMySQL 8.0+ æ–°ç‰¹æ€§ï¼‰</td></tr><tr><td><code>ai</code> / <code>as</code></td><td>Accent Insensitiveï¼ˆä¸åŒºåˆ†é‡éŸ³ï¼‰ / Accent Sensitiveï¼ˆåŒºåˆ†é‡éŸ³ï¼‰</td></tr><tr><td><code>ci</code> / <code>cs</code></td><td>Case Insensitiveï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ / Case Sensitiveï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰</td></tr><tr><td><code>bin</code></td><td>Binaryï¼ˆäºŒè¿›åˆ¶æ¯”è¾ƒï¼Œæœ€ä¸¥æ ¼ï¼‰</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">ä¸¾ä¸ªæ —å­ï¼šä¸åŒæ’åºè§„åˆ™çš„åŒºåˆ«</h2>
<p>æˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªè¡¨ï¼Œåˆ†åˆ«ç”¨ä¸åŒçš„æ’åºè§„åˆ™ï¼Œçœ‹çœ‹æ•ˆæœï¼š</p>
<h3 data-id="heading-3">åœºæ™¯1ï¼šå¤§å°å†™æ•æ„Ÿå—ï¼Ÿ</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è¡¨1ï¼šä½¿ç”¨ utf8mb4_0900_ai_ciï¼ˆé»˜è®¤ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users_ci (
  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>)
) <span class="hljs-keyword">COLLATE</span> utf8mb4_0900_ai_ci;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users_ci <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Alice'</span>), (<span class="hljs-string">'alice'</span>);

<span class="hljs-comment">-- æŸ¥è¯¢</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users_ci <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'ALICE'</span>;
<span class="hljs-comment">-- ç»“æœï¼šè¿”å› Alice å’Œ aliceï¼ˆå› ä¸ºä¸åŒºåˆ†å¤§å°å†™ï¼‰</span>
</code></pre>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è¡¨2ï¼šä½¿ç”¨ utf8mb4_binï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> users_bin (
  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>)
) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> users_bin <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Alice'</span>), (<span class="hljs-string">'alice'</span>);

<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> users_bin <span class="hljs-keyword">WHERE</span> name <span class="hljs-operator">=</span> <span class="hljs-string">'ALICE'</span>;
<span class="hljs-comment">-- ç»“æœï¼šç©ºï¼å› ä¸º 'ALICE' â‰  'Alice' â‰  'alice'</span>
</code></pre>
<p><strong>ç»“è®º</strong>ï¼š<code>_ci</code> ä¸åŒºåˆ†å¤§å°å†™ï¼Œ<code>_bin</code> åŒºåˆ†ã€‚</p>
<hr/>
<h3 data-id="heading-4">åœºæ™¯2ï¼šé‡éŸ³ç¬¦å·è¦ä¸è¦ç®¡ï¼Ÿ</h3>
<p>æ¯”å¦‚æ³•è¯­ä¸­çš„ <code>cafÃ©</code> å’Œ <code>cafe</code>ã€‚</p>
<ul>
<li>åœ¨ <code>_ai</code>ï¼ˆAccent Insensitiveï¼‰è§„åˆ™ä¸‹ï¼š<code>cafÃ© = cafe</code></li>
<li>åœ¨ <code>_as</code> æˆ– <code>_bin</code> è§„åˆ™ä¸‹ï¼š<code>cafÃ© â‰  cafe</code></li>
</ul>
<p>MySQL 8.0+ æ”¯æŒæ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">utf8mb4_0900_as_cs  <span class="hljs-comment">-- åŒºåˆ†å¤§å°å†™ + åŒºåˆ†é‡éŸ³</span>
utf8mb4_0900_ai_ci  <span class="hljs-comment">-- ä¸åŒºåˆ†å¤§å°å†™ + ä¸åŒºåˆ†é‡éŸ³ï¼ˆé»˜è®¤ï¼‰</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">åœºæ™¯3ï¼šä¸­æ–‡æ’åºä¹±åºï¼Ÿ</h3>
<p>å¦‚æœä½ ç”¨ <code>utf8mb4_general_ci</code> æ’ä¸­æ–‡ï¼Œå¯èƒ½ä¼šå‘ç°ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> name <span class="hljs-keyword">FROM</span> users <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> name;
<span class="hljs-comment">-- ç»“æœï¼šå¼ ä¸‰ã€æå››ã€ç‹äº”â€¦â€¦é¡ºåºçœ‹èµ·æ¥â€œä¸å¯¹â€</span>
</code></pre>
<p>è¿™æ˜¯å› ä¸º <code>general_ci</code> æ˜¯ä¸€ç§<strong>ç®€åŒ–çš„æ’åºç®—æ³•</strong>ï¼Œå®ƒä¸ºäº†é€Ÿåº¦ç‰ºç‰²äº†å‡†ç¡®æ€§ã€‚</p>
<p><strong>æ­£ç¡®åšæ³•</strong>ï¼šç”¨ <code>utf8mb4_unicode_ci</code> æˆ–æ›´å¥½çš„ <code>utf8mb4_0900_ai_ci</code>ï¼ˆMySQL 8.0 é»˜è®¤ï¼‰ï¼Œå®ƒä»¬åŸºäº Unicode æ ‡å‡†ï¼Œå¯¹ä¸­æ–‡ã€æ—¥æ–‡ã€éŸ©æ–‡ç­‰æ”¯æŒæ›´å¥½ã€‚</p>
<hr/>
<h2 data-id="heading-6">ä¸»è¦åŒºåˆ«ç»´åº¦</h2>
<hr/>
<h3 data-id="heading-7">1. <strong>å¤§å°å†™æ•æ„Ÿæ€§ï¼ˆCase Sensitivityï¼‰</strong></h3>
<ul>
<li><strong>_ci</strong>ï¼šCase Insensitiveï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
<ul>
<li>ä¾‹å¦‚ï¼š<code>utf8_general_ci</code> ä¸­ <code>'A' = 'a'</code></li>
</ul>
</li>
<li><strong>_cs</strong> æˆ– <strong>_bin</strong>ï¼šCase Sensitiveï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
<ul>
<li><code>utf8_bin</code> æˆ– <code>utf8mb4_0900_cs</code> ä¸­ <code>'A' â‰  'a'</code></li>
</ul>
</li>
</ul>
<p>æ³¨æ„ï¼š<code>_cs</code>ï¼ˆCase Sensitiveï¼‰åœ¨æ—§ç‰ˆæœ¬ä¸­è¾ƒå°‘è§ï¼ŒMySQL 8.0 å¼•å…¥äº†æ›´æ ‡å‡†çš„å‘½åå¦‚ <code>utf8mb4_0900_cs</code>ã€‚</p>
<hr/>
<h3 data-id="heading-8">2. <strong>é‡éŸ³ç¬¦å·æ•æ„Ÿæ€§ï¼ˆAccent Sensitivityï¼‰</strong></h3>
<ul>
<li><strong>_ai</strong>ï¼šAccent Insensitiveï¼ˆä¸åŒºåˆ†é‡éŸ³ï¼‰</li>
<li><strong>_as</strong>ï¼šAccent Sensitiveï¼ˆåŒºåˆ†é‡éŸ³ï¼‰</li>
</ul>
<p>åœ¨ MySQL 8.0+ ä¸­ï¼Œéƒ¨åˆ†æ’åºè§„åˆ™æ”¯æŒ <code>_as</code>/<code>_ai</code>ï¼Œä¾‹å¦‚ <code>utf8mb4_0900_as_cs</code> è¡¨ç¤ºæ—¢åŒºåˆ†å¤§å°å†™åˆåŒºåˆ†é‡éŸ³ã€‚</p>
<hr/>
<h3 data-id="heading-9">3. <strong>äºŒè¿›åˆ¶æ’åºï¼ˆBinary Collationï¼‰</strong></h3>
<ul>
<li>ä»¥ <code>_bin</code> ç»“å°¾ï¼ˆå¦‚ <code>utf8mb4_bin</code>ï¼‰</li>
<li>æŒ‰ç…§å­—ç¬¦çš„äºŒè¿›åˆ¶å€¼ï¼ˆå­—èŠ‚å€¼ï¼‰è¿›è¡Œæ¯”è¾ƒï¼Œ<strong>ä¸¥æ ¼åŒºåˆ†å¤§å°å†™ã€é‡éŸ³ã€ç¼–ç é¡ºåº</strong></li>
<li>ä¸ä½¿ç”¨è¯­è¨€è§„åˆ™ï¼Œé€Ÿåº¦è¾ƒå¿«ä½†ä¸ç¬¦åˆäººç±»è¯­è¨€ä¹ æƒ¯</li>
</ul>
<hr/>
<h3 data-id="heading-10">4. <strong>è¯­è¨€/åŒºåŸŸç‰¹å®šæ’åº</strong></h3>
<p>æŸäº›æ’åºè§„åˆ™é’ˆå¯¹ç‰¹å®šè¯­è¨€ä¼˜åŒ–ï¼š</p>
<ul>
<li><code>utf8mb4_spanish_ci</code>ï¼šè¥¿ç­ç‰™è¯­æ’åºï¼ˆå¦‚ Ã± æ’åœ¨ n ä¹‹åï¼‰</li>
<li><code>utf8mb4_german2_ci</code>ï¼šå¾·è¯­ç”µè¯ç°¿æ’åºè§„åˆ™</li>
<li><code>utf8mb4_ja_0900_as_cs</code>ï¼šæ—¥è¯­æ’åºï¼ˆéœ€ MySQL 8.0+ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-11">5. <strong>Unicode ç‰ˆæœ¬å·®å¼‚ï¼ˆMySQL 8.0+ï¼‰</strong></h3>
<p>MySQL 8.0 é»˜è®¤ä½¿ç”¨åŸºäº <strong>Unicode 9.0</strong> çš„æ’åºè§„åˆ™ï¼ˆå¦‚ <code>utf8mb4_0900_ai_ci</code>ï¼‰ï¼š</p>
<ul>
<li>æ›´å‡†ç¡®çš„å¤šè¯­è¨€æ”¯æŒ</li>
<li>æ›´å¥½çš„æ€§èƒ½ï¼ˆç›¸æ¯”æ—§çš„ <code>utf8mb4_general_ci</code>ï¼‰</li>
<li><code>0900</code> è¡¨ç¤ºåŸºäº Unicode 9.0.0</li>
</ul>
<p>å¯¹æ¯”ï¼š</p>
<ul>
<li><code>utf8mb4_general_ci</code>ï¼šæ—§ç‰ˆï¼Œé€Ÿåº¦å¿«ä½†æ’åºä¸å‡†ç¡®ï¼ˆå¦‚è®¤ä¸º <code>'Ã¶' = 'o'</code>ï¼‰</li>
<li><code>utf8mb4_unicode_ci</code>ï¼šåŸºäº Unicode 4.0ï¼Œè¾ƒå‡†ç¡®</li>
<li><code>utf8mb4_0900_ai_ci</code>ï¼šMySQL 8.0 é»˜è®¤ï¼ŒåŸºäº Unicode 9.0ï¼Œæ›´å‡†ç¡®é«˜æ•ˆ</li>
</ul>
<hr/>
<h3 data-id="heading-12">å¸¸è§æ’åºè§„åˆ™å¯¹æ¯”ç¤ºä¾‹</h3>









































<table><thead><tr><th>æ’åºè§„åˆ™</th><th>å¤§å°å†™æ•æ„Ÿ</th><th>é‡éŸ³æ•æ„Ÿ</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>utf8mb4_general_ci</code></td><td>å¦</td><td>å¦</td><td>æ—§ç‰ˆé€šç”¨ï¼Œé€Ÿåº¦å¿«ä½†ä¸å‡†</td></tr><tr><td><code>utf8mb4_unicode_ci</code></td><td>å¦</td><td>å¦</td><td>åŸºäº Unicode 4.0ï¼Œè¾ƒå‡†ç¡®</td></tr><tr><td><code>utf8mb4_0900_ai_ci</code></td><td>å¦</td><td>å¦</td><td>MySQL 8.0 é»˜è®¤ï¼ŒåŸºäº Unicode 9.0</td></tr><tr><td><code>utf8mb4_0900_as_cs</code></td><td>æ˜¯</td><td>æ˜¯</td><td>åŒºåˆ†å¤§å°å†™å’Œé‡éŸ³</td></tr><tr><td><code>utf8mb4_bin</code></td><td>æ˜¯</td><td>æ˜¯</td><td>äºŒè¿›åˆ¶æ¯”è¾ƒï¼Œæœ€å¿«ä½†æœ€â€œæœºæ¢°â€</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-13">å¦‚ä½•æŸ¥çœ‹å¯ç”¨æ’åºè§„åˆ™ï¼Ÿ</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">COLLATION</span> <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'utf8mb4%'</span>;
</code></pre>
<h3 data-id="heading-14">å¦‚ä½•è®¾ç½®æ’åºè§„åˆ™ï¼Ÿ</h3>
<p>æ•°æ®åº“çº§ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> DATABASE db_name <span class="hljs-type">CHARACTER</span> <span class="hljs-keyword">SET</span> utf8mb4 <span class="hljs-keyword">COLLATE</span> utf8mb4_0900_ai_ci;
</code></pre>
<p>è¡¨çº§ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> t (name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>)) <span class="hljs-keyword">COLLATE</span> utf8mb4_bin;
</code></pre>
<p>åˆ—çº§ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_0900_as_cs
</code></pre>
<p>æŸ¥è¯¢æ—¶ä¸´æ—¶æŒ‡å®šï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> t <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> name <span class="hljs-keyword">COLLATE</span> utf8mb4_bin;
</code></pre>
<hr/>
<h2 data-id="heading-15">å®é™…å»ºè®®</h2>
<ul>
<li><strong>ä¸€èˆ¬åº”ç”¨</strong>ï¼šä½¿ç”¨ <code>utf8mb4_0900_ai_ci</code>ï¼ˆMySQL 8.0+ï¼‰æˆ– <code>utf8mb4_unicode_ci</code>ï¼ˆæ—§ç‰ˆæœ¬ï¼‰</li>
<li><strong>éœ€è¦åŒºåˆ†å¤§å°å†™</strong>ï¼šç”¨ <code>utf8mb4_0900_as_cs</code> æˆ– <code>utf8mb4_bin</code></li>
<li><strong>æ€§èƒ½æ•æ„Ÿä¸”æ— éœ€è¯­è¨€è§„åˆ™</strong>ï¼šç”¨ <code>_bin</code></li>
<li><strong>é¿å…ä½¿ç”¨ <code>utf8mb4_general_ci</code></strong>ï¼ˆé™¤éå…¼å®¹æ—§ç³»ç»Ÿï¼‰ï¼Œå› å…¶æ’åºé€»è¾‘ä¸å‡†ç¡®</li>
</ul>
<h2 data-id="heading-16">æ€»ç»“</h2>
<ul>
<li><strong>æ’åºè§„åˆ™ = å­—ç¬¦ä¸²çš„â€œæ¯”è¾ƒè§„åˆ™â€</strong></li>
<li><code>_ci</code> = ä¸åŒºåˆ†å¤§å°å†™ï¼Œ<code>_cs</code>/<code>_bin</code> = åŒºåˆ†</li>
<li>MySQL 8.0 é»˜è®¤çš„ <code>utf8mb4_0900_ai_ci</code> æ˜¯ç›®å‰<strong>æœ€æ¨è</strong>çš„é€‰æ‹©</li>
<li>ä¸­æ–‡ã€å¤šè¯­è¨€é¡¹ç›®<strong>ä¸è¦ç”¨ <code>general_ci</code></strong>ï¼Œå®ƒå·²ç»è¿‡æ—¶äº†</li>
<li>ç”¨æˆ·åã€å¯†ç ç­‰å…³é”®å­—æ®µï¼Œå»ºè®®ç”¨åŒºåˆ†å¤§å°å†™çš„è§„åˆ™</li>
</ul>
<blockquote>
<p>æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ï¼šç¨‹åºå‘˜åˆ˜å¤§åï¼Œä¸“æ³¨åˆ†äº«å‰åç«¯å¼€å‘çš„å®æˆ˜ç¬”è®°ã€‚å…³æ³¨æˆ‘ï¼Œå°‘èµ°å¼¯è·¯ï¼Œä¸€èµ·è¿›æ­¥ï¼</p>
</blockquote>
<h4 data-id="heading-17">ğŸ“Œå¾€æœŸç²¾å½©</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FU3HhCz5WiAMNM7foxuTa0w" target="_blank" title="https://mp.weixin.qq.com/s/U3HhCz5WiAMNM7foxuTa0w" ref="nofollow noopener noreferrer">ã€Šå‰ç«¯é«˜æ‰‹æ‰çŸ¥é“çš„ç§˜å¯†ï¼šBlob å±…ç„¶è¿™ä¹ˆå¼ºå¤§ã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX-MSa0CHwVW_qgPezbpMUA" target="_blank" title="https://mp.weixin.qq.com/s/X-MSa0CHwVW_qgPezbpMUA" ref="nofollow noopener noreferrer">ã€Šè¿™ 5 ä¸ªå†·é—¨ HTML æ ‡ç­¾ï¼Œè®©æˆ‘ç›´æ¥åˆ äº†100 è¡Œ JS ä»£ç ã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FsMAKhSLNvmU1ddxg0yv9Fg" target="_blank" title="https://mp.weixin.qq.com/s/sMAKhSLNvmU1ddxg0yv9Fg" ref="nofollow noopener noreferrer">ã€Šé‡æ„äº†20ä¸ªSpringBooté¡¹ç›®åï¼Œæ€»ç»“å‡ºè¿™å¥—ç¨³å®šé«˜æ•ˆçš„æ¶æ„è®¾è®¡ã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F184BGM_pdMFLc0ASrferwQ" target="_blank" title="https://mp.weixin.qq.com/s/184BGM_pdMFLc0ASrferwQ" ref="nofollow noopener noreferrer">ã€Šä»£ç é‡Œå…¨æ˜¯ new å¯¹è±¡ï¼ŒçœŸçš„å¾ˆ Low å—ï¼Ÿæˆ‘è®¤çœŸæƒ³äº†ä¸€æ™šã€‹</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‘Šåˆ« Kotlin ä¸­è‡ƒè‚¿çš„ when è¡¨è¾¾å¼]]></title>    <link>https://juejin.cn/post/7591330139083735055</link>    <guid>https://juejin.cn/post/7591330139083735055</guid>    <pubDate>2026-01-05T00:46:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591330139083735055" data-draft-id="7587253759092654116" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‘Šåˆ« Kotlin ä¸­è‡ƒè‚¿çš„ when è¡¨è¾¾å¼"/> <meta itemprop="keywords" content="Kotlin,Android"/> <meta itemprop="datePublished" content="2026-01-05T00:46:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‘Šåˆ« Kotlin ä¸­è‡ƒè‚¿çš„ when è¡¨è¾¾å¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:46:53.000Z" title="Mon Jan 05 2026 00:46:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body .anchor{float:left;line-height:1;margin-left:-20px;padding-right:4px}.markdown-body .anchor:focus{outline:none}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1:hover .anchor .octicon-link:before,.markdown-body h2:hover .anchor .octicon-link:before,.markdown-body h3:hover .anchor .octicon-link:before,.markdown-body h4:hover .anchor .octicon-link:before,.markdown-body h5:hover .anchor .octicon-link:before,.markdown-body h6:hover .anchor .octicon-link:before{width:16px;height:16px;content:" ";display:inline-block;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' aria-hidden='true'%3E%3Cpath fill-rule='evenodd' d='M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z'/%3E%3C/svg%3E")}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body details{display:block}.markdown-body summary{display:list-item}.markdown-body a{background-color:initial}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body strong{font-weight:inherit;font-weight:bolder}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace;font-size:1em}.markdown-body hr{box-sizing:initial;overflow:visible}.markdown-body input{font:inherit;margin:0;overflow:visible}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body input{font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body a{color:#0366d6;text-decoration:none}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{height:0;margin:15px 0;overflow:hidden;background:transparent;border-bottom:1px solid #dfe2e5}.markdown-body hr:after,.markdown-body hr:before{display:table;content:""}.markdown-body hr:after{clear:both}.markdown-body table{border-spacing:0;border-collapse:collapse}.markdown-body td,.markdown-body th{padding:0}.markdown-body details summary{cursor:pointer}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:0;margin-bottom:0}.markdown-body h1{font-size:32px}.markdown-body h1,.markdown-body h2{font-weight:600}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:20px}.markdown-body h3,.markdown-body h4{font-weight:600}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:14px}.markdown-body h5,.markdown-body h6{font-weight:600}.markdown-body h6{font-size:12px}.markdown-body p{margin-top:0;margin-bottom:10px}.markdown-body blockquote{margin:0}.markdown-body ol,.markdown-body ul{padding-left:0;margin-top:0;margin-bottom:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code,.markdown-body pre{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px}.markdown-body pre{margin-top:0;margin-bottom:0}.markdown-body input::-webkit-inner-spin-button,.markdown-body input::-webkit-outer-spin-button{margin:0;-webkit-appearance:none;appearance:none}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .border{border:1px solid #e1e4e8!important}.markdown-body .border-0{border:0!important}.markdown-body .border-bottom{border-bottom:1px solid #e1e4e8!important}.markdown-body .rounded-1{border-radius:3px!important}.markdown-body .bg-white{background-color:#fff!important}.markdown-body .bg-gray-light{background-color:#fafbfc!important}.markdown-body .text-gray-light{color:#6a737d!important}.markdown-body .pl-3,.markdown-body .px-3{padding-left:16px!important}.markdown-body .px-3{padding-right:16px!important}.markdown-body .f6{font-size:12px!important}.markdown-body .lh-condensed{line-height:1.25!important}.markdown-body .text-bold{font-weight:600!important}.markdown-body .pl-c{color:#6a737d}.markdown-body .pl-c1,.markdown-body .pl-s .pl-v{color:#005cc5}.markdown-body .pl-e,.markdown-body .pl-en{color:#6f42c1}.markdown-body .pl-s .pl-s1,.markdown-body .pl-smi{color:#24292e}.markdown-body .pl-ent{color:#22863a}.markdown-body .pl-k{color:#d73a49}.markdown-body .pl-pds,.markdown-body .pl-s,.markdown-body .pl-s .pl-pse .pl-s1,.markdown-body .pl-sr,.markdown-body .pl-sr .pl-cce,.markdown-body .pl-sr .pl-sra,.markdown-body .pl-sr .pl-sre{color:#032f62}.markdown-body .pl-smw,.markdown-body .pl-v{color:#e36209}.markdown-body .pl-bu{color:#b31d28}.markdown-body .pl-ii{color:#fafbfc;background-color:#b31d28}.markdown-body .pl-c2{color:#fafbfc;background-color:#d73a49}.markdown-body .pl-c2:before{content:"^M"}.markdown-body .pl-sr .pl-cce{font-weight:700;color:#22863a}.markdown-body .pl-ml{color:#735c0f}.markdown-body .pl-mh,.markdown-body .pl-mh .pl-en,.markdown-body .pl-ms{font-weight:700;color:#005cc5}.markdown-body .pl-mi{font-style:italic;color:#24292e}.markdown-body .pl-mb{font-weight:700;color:#24292e}.markdown-body .pl-md{color:#b31d28;background-color:#ffeef0}.markdown-body .pl-mi1{color:#22863a;background-color:#f0fff4}.markdown-body .pl-mc{color:#e36209;background-color:#ffebda}.markdown-body .pl-mi2{color:#f6f8fa;background-color:#005cc5}.markdown-body .pl-mdr{font-weight:700;color:#6f42c1}.markdown-body .pl-ba{color:#586069}.markdown-body .pl-sg{color:#959da5}.markdown-body .pl-corl{text-decoration:underline;color:#032f62}.markdown-body .mb-0{margin-bottom:0!important}.markdown-body .my-2{margin-bottom:8px!important;margin-top:8px!important}.markdown-body .pl-0{padding-left:0!important}.markdown-body .py-0{padding-top:0!important;padding-bottom:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .py-2{padding-top:8px!important;padding-bottom:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body .pl-7{padding-left:48px!important}.markdown-body .pl-8{padding-left:64px!important}.markdown-body .pl-9{padding-left:80px!important}.markdown-body .pl-10{padding-left:96px!important}.markdown-body .pl-11{padding-left:112px!important}.markdown-body .pl-12{padding-left:128px!important}.markdown-body hr{border-bottom-color:#eee}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fafbfc;border:1px solid #d1d5da;border-radius:3px;box-shadow:inset 0 -1px 0 #d1d5da}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body&gt;:first-child{margin-top:0!important}.markdown-body&gt;:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body blockquote,.markdown-body details,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eaecef}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li{word-wrap:break-all}.markdown-body li&gt;p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:initial;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body code{padding:.2em .4em;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body pre{word-wrap:normal}.markdown-body pre&gt;code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:initial;border:0}.markdown-body .commit-tease-sha{display:inline-block;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:90%;color:#444d56}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body .blob-wrapper{overflow-x:auto;overflow-y:hidden}.markdown-body .blob-wrapper-embedded{max-height:240px;overflow-y:auto}.markdown-body .blob-num{width:1%;min-width:50px;padding-right:10px;padding-left:10px;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;line-height:20px;color:rgba(27,31,35,.3);text-align:right;white-space:nowrap;vertical-align:top;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-body .blob-num:hover{color:rgba(27,31,35,.6)}.markdown-body .blob-num:before{content:attr(data-line-number)}.markdown-body .blob-code{position:relative;padding-right:10px;padding-left:10px;line-height:20px;vertical-align:top}.markdown-body .blob-code-inner{overflow:visible;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;font-size:12px;color:#24292e;word-wrap:normal;white-space:pre}.markdown-body .pl-token.active,.markdown-body .pl-token:hover{cursor:pointer;background:#ffea7f}.markdown-body .tab-size[data-tab-size="1"]{-moz-tab-size:1;tab-size:1}.markdown-body .tab-size[data-tab-size="2"]{-moz-tab-size:2;tab-size:2}.markdown-body .tab-size[data-tab-size="3"]{-moz-tab-size:3;tab-size:3}.markdown-body .tab-size[data-tab-size="4"]{-moz-tab-size:4;tab-size:4}.markdown-body .tab-size[data-tab-size="5"]{-moz-tab-size:5;tab-size:5}.markdown-body .tab-size[data-tab-size="6"]{-moz-tab-size:6;tab-size:6}.markdown-body .tab-size[data-tab-size="7"]{-moz-tab-size:7;tab-size:7}.markdown-body .tab-size[data-tab-size="8"]{-moz-tab-size:8;tab-size:8}.markdown-body .tab-size[data-tab-size="9"]{-moz-tab-size:9;tab-size:9}.markdown-body .tab-size[data-tab-size="10"]{-moz-tab-size:10;tab-size:10}.markdown-body .tab-size[data-tab-size="11"]{-moz-tab-size:11;tab-size:11}.markdown-body .tab-size[data-tab-size="12"]{-moz-tab-size:12;tab-size:12}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ed296ecb41543039d5405088a4b8c43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768178812&amp;x-signature=fhy2b8bYrAbNNRJ2nFf2XtIJbP8%3D" alt="1.png" loading="lazy"/></p>
<p>ä½ æ˜¯å¦ç®¡ç†è¿‡é‚£äº›æ ¹æ®å†…éƒ¨çŠ¶æ€å‘ç”Ÿå‰§çƒˆè¡Œä¸ºå˜åŒ–çš„å¤æ‚å¯¹è±¡ï¼Ÿ</p>
<p>å¦‚æœæ˜¯ï¼Œé‚£ä½ å¾ˆå¯èƒ½å·²ç»å’Œä¸€ä¸ªå¸¸è§æ•Œäººæ–—äº‰è¿‡â€”â€”éå¸ƒä½ ç±»ä¸­æ¯ä¸ªæ–¹æ³•çš„ã€å†—é•¿çš„ <code>when</code> è¯­å¥ã€‚</p>
<p>å®ƒçœ‹èµ·æ¥å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handleAction</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">when</span> (state) {
        State.A -&gt; { <span class="hljs-comment">/* A çš„é€»è¾‘ */</span> }
        State.B -&gt; { <span class="hljs-comment">/* B çš„é€»è¾‘ */</span> }
        State.C -&gt; { <span class="hljs-comment">/* C çš„é€»è¾‘ */</span> }
        <span class="hljs-comment">// ... è¿˜åœ¨ä¸æ–­å¢é•¿ï¼</span>
    }
}
</code></pre>
<p>æ¯æ¬¡ä½ æ·»åŠ ä¸€ä¸ªæ–°çŠ¶æ€ï¼ˆæ¯”å¦‚ <code>State.D</code>ï¼‰ï¼Œä½ å°±å¾—é€ä¸ªè¿½è¸ªå¹¶æ›´æ–°æ¯ä¸€ä¸ªå‡½æ•°ï¼ŒåŠ å…¥æ–°çš„åˆ†æ”¯ã€‚</p>
<p>è¿™æ˜¯ä¸ªç»´æŠ¤å™©æ¢¦ï¼Œç›´æ¥è¿åäº†å¼€é—­åŸåˆ™ï¼ˆ<strong>OCP</strong>ï¼‰ï¼Œä¹Ÿæ˜¯ä¸€ç§ä¸¥é‡çš„ä»£ç å¼‚å‘³ã€‚ä½ çš„é€»è¾‘æœ¬è¯¥æŒ‰çŠ¶æ€åˆ†ç»„ï¼Œå´å› ä¸ºåŠ¨ä½œè€Œè¢«æ•£ä¹±åœ°åˆ†å¸ƒåœ¨å„å¤„ã€‚</p>
<p>é‚£ä¹ˆï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>çŠ¶æ€æ¨¡å¼ã€‚è€Œä¸”å€ŸåŠ©ç°ä»£ Kotlinï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æœ€å°‘çš„æ ·æ¿ä»£ç ï¼Œå®ç°æœ€ä¼˜é›…çš„çŠ¶æ€æ¨¡å¼ã€‚</p>
<h2 data-id="heading-0">ä¸€ä¸ªç®€å•çš„è‡ªåŠ¨å”®è´§æœº</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9ff32e73dc554e92bcbb7bbc60d105e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768178812&amp;x-signature=Lj6Kgj5yM%2BLbhf8%2BWJDlzh3LWCo%3D" alt="0.png" loading="lazy"/></p>
<p>è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ­£åœ¨æ„å»ºä¸€ä¸ªç®€å•çš„ <code>VendingMachine</code>ã€‚å®ƒæœ‰å‡ ä¸ªå…³é”®çš„çŠ¶æ€å’ŒåŠ¨ä½œï¼š</p>
<ul>
<li><strong>çŠ¶æ€</strong>ï¼š<code>IDLE</code>ï¼ˆç©ºé—²ï¼‰ã€<code>HAS_MONEY</code>ï¼ˆå·²æŠ•å¸ï¼‰ã€<code>OUT_OF_STOCK</code>ï¼ˆç¼ºè´§ï¼‰</li>
<li><strong>åŠ¨ä½œ</strong>ï¼š<code>insertMoney</code>ï¼ˆæŠ•å¸ï¼‰ã€<code>selectProduct</code>ï¼ˆé€‰æ‹©å•†å“ï¼‰ã€<code>requestRefund</code>ï¼ˆè¯·æ±‚é€€æ¬¾ï¼‰</li>
</ul>
<p>ä¸‹é¢æ˜¯é‚£ç§å­˜åœ¨é—®é¢˜çš„ã€åŸºäºçŠ¶æ€çš„æ£€æŸ¥ä»£ç ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VendingMachine</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> balance: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> state: State = State.IDLE
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-keyword">when</span> (state) {
            State.IDLE -&gt; {
                balance += amount
                state = State.HAS_MONEY
                println(<span class="hljs-string">"å·²æŠ•å¸ã€‚ä½™é¢ï¼š<span class="hljs-variable">$balance</span>"</span>)
            }
            State.HAS_MONEY -&gt; {
                println(<span class="hljs-string">"å·²æŠ•å¸ï¼Œæ— éœ€é‡å¤æŠ•å¸ã€‚ä½™é¢ï¼š<span class="hljs-variable">$balance</span>"</span>)
            }
            State.OUT_OF_STOCK -&gt; {
                println(<span class="hljs-string">"æœºå™¨ç¼ºè´§ã€‚"</span>)
            }
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>)</span></span> {
        <span class="hljs-keyword">when</span> (state) {
            State.IDLE -&gt; {
                println(<span class="hljs-string">"è¯·å…ˆæŠ•å¸ã€‚"</span>)
            }
            State.HAS_MONEY -&gt; {
                <span class="hljs-keyword">if</span> (<span class="hljs-comment">/* å•†å“å¯ç”¨ */</span>) {
                    println(<span class="hljs-string">"å•†å“å·²å”®å‡ºã€‚"</span>)
                    state = State.IDLE
                } <span class="hljs-keyword">else</span> {
                    println(<span class="hljs-string">"å•†å“ä¸å¯ç”¨ã€‚"</span>)
                }
            }
            State.OUT_OF_STOCK -&gt; {
                println(<span class="hljs-string">"æœºå™¨ç¼ºè´§ã€‚"</span>)
            }
        }
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">when</span> (state) {
            State.IDLE -&gt; {
                println(<span class="hljs-string">"æ²¡æœ‰å¯é€€çš„æ¬¾é¡¹ã€‚"</span>)
            }
            State.HAS_MONEY -&gt; {
                println(<span class="hljs-string">"å·²é€€æ¬¾ï¼š<span class="hljs-variable">$balance</span>"</span>)
                balance = <span class="hljs-number">0</span>
                state = State.IDLE
            }
            State.OUT_OF_STOCK -&gt; {
                println(<span class="hljs-string">"æ²¡æœ‰å¯é€€çš„æ¬¾é¡¹ã€‚"</span>)
            }
        }
    }
}
</code></pre>
<p>å¦‚æœæˆ‘ä»¬æ–°å¢ä¸€ä¸ª <code>MAINTENANCE</code>ï¼ˆç»´æŠ¤ï¼‰çŠ¶æ€ï¼Œå°±ä¼šç ´åå¼€é—­åŸåˆ™ï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»ä¿®æ”¹ <code>insertMoney</code>ã€<code>selectProduct</code> ä»¥åŠæ‰€æœ‰å…¶ä»–åŠ¨ä½œæ–¹æ³•ã€‚</p>
<h2 data-id="heading-1">ç»å…¸çš„çŠ¶æ€æ¨¡å¼</h2>
<p>çŠ¶æ€æ¨¡å¼é€šè¿‡å°†â€œçŠ¶æ€â€æœ¬èº«å˜æˆä¸€ä¸ªæŒæœ‰è¡Œä¸ºçš„å¯¹è±¡æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬å¸Œæœ›æŒ‰çŠ¶æ€æ¥ç»„ç»‡è¡Œä¸ºï¼Œè€Œä¸æ˜¯æŒ‰åŠ¨ä½œã€‚</p>
<h3 data-id="heading-2">1. å®šä¹‰æ¥å£</h3>
<p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªé€šç”¨çš„æ¥å£ï¼ˆ<code>MachineState</code>ï¼‰ï¼Œæ‰€æœ‰çŠ¶æ€å¯¹è±¡éƒ½å¿…é¡»å®ç°å®ƒã€‚è¿™ä¸ªæ¥å£åŒ…å«äº†ä¸Šä¸‹æ–‡ï¼ˆ<code>VendingMachineContext</code>ï¼‰å¯ä»¥æ‰§è¡Œçš„æ‰€æœ‰å¯èƒ½åŠ¨ä½œã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MachineState</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">(context: <span class="hljs-type">VendingMachineContext</span>)</span></span>
}
</code></pre>
<h3 data-id="heading-3">2. å…·ä½“å®ç°</h3>
<p>æˆ‘ä»¬ä¸ºæ¯ä¸ªçŠ¶æ€å®ç°å…¶è¡Œä¸ºã€‚å…³é”®ç‚¹åœ¨äºï¼šå•ä¸ªçŠ¶æ€çš„æ‰€æœ‰é€»è¾‘ç°åœ¨éƒ½é›†ä¸­åœ¨ä¸€ä¸ªç±»/å¯¹è±¡ä¸­ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">object</span> IdleState : MachineState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        context.balance += amount
        context.state = HasMoneyState
        println(<span class="hljs-string">"å·²æŠ•å¸ã€‚ä½™é¢ï¼š<span class="hljs-subst">${context.balance}</span>"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"è¯·å…ˆæŠ•å¸ã€‚"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">(context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"æ²¡æœ‰å¯é€€çš„æ¬¾é¡¹ã€‚"</span>)
    }
}

<span class="hljs-keyword">object</span> HasMoneyState : MachineState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        context.balance += amount
        println(<span class="hljs-string">"å·²æ·»åŠ é‡‘é¢ã€‚ä½™é¢ï¼š<span class="hljs-subst">${context.balance}</span>"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        <span class="hljs-keyword">if</span> (context.balance &gt;= <span class="hljs-number">2</span>) {
            context.balance -= <span class="hljs-number">2</span>
            println(<span class="hljs-string">"å•†å“å·²å”®å‡ºã€‚"</span>)
            context.state = IdleState
        } <span class="hljs-keyword">else</span> {
            println(<span class="hljs-string">"å•†å“ä¸å¯ç”¨ã€‚"</span>)
        }
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">(context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"å·²é€€æ¬¾ï¼š<span class="hljs-subst">${context.balance}</span>"</span>)
        context.balance = <span class="hljs-number">0</span>
        context.state = IdleState
    }
}

<span class="hljs-keyword">object</span> OutOfStockState : MachineState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"æœºå™¨ç¼ºè´§ã€‚"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"æœºå™¨ç¼ºè´§ã€‚"</span>)
    }
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">(context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        println(<span class="hljs-string">"æ²¡æœ‰å¯é€€çš„æ¬¾é¡¹ã€‚"</span>)
    }
}
</code></pre>
<h3 data-id="heading-4">3. ä¸Šä¸‹æ–‡</h3>
<p><code>VendingMachineContext</code>ï¼ˆå³ä¸Šä¸‹æ–‡ï¼‰ç°åœ¨å˜å¾—ç®€æ´ï¼Œåªéœ€å°†åŠ¨ä½œå§”æ‰˜ç»™å…¶å½“å‰çš„çŠ¶æ€å¯¹è±¡å³å¯ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">VendingMachineContext</span>(<span class="hljs-keyword">var</span> balance: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">var</span> state: MachineState = IdleState
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">insertMoney</span><span class="hljs-params">(amount: <span class="hljs-type">Int</span>)</span></span> {
        state.insertMoney(amount, <span class="hljs-keyword">this</span>)
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">selectProduct</span><span class="hljs-params">(code: <span class="hljs-type">String</span>)</span></span> {
        state.selectProduct(code, <span class="hljs-keyword">this</span>)
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">requestRefund</span><span class="hljs-params">()</span></span> {
        state.requestRefund(<span class="hljs-keyword">this</span>)
    }
    <span class="hljs-comment">// è¾…åŠ©å‡½æ•°ï¼Œä¾›çŠ¶æ€å¯¹è±¡åˆ‡æ¢æœºå™¨çŠ¶æ€</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">transitionTo</span><span class="hljs-params">(newState: <span class="hljs-type">MachineState</span>)</span></span> {
        <span class="hljs-keyword">this</span>.state = newState
    }
}
</code></pre>
<p>å¦‚æœä½ æ–°å¢ä¸€ä¸ªçŠ¶æ€ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ã€‚ä½ æ— éœ€ä¿®æ”¹ <code>VendingMachineContext</code> æˆ–å…¶ä»–ä»»ä½•çŠ¶æ€ç±»ã€‚å¼€é—­åŸåˆ™å¾—åˆ°äº†æ¢å¤ï¼</p>
<h2 data-id="heading-5">å¢å¼ºçš„ Kotlin é£æ ¼çŠ¶æ€æ¨¡å¼</h2>
<p>ç»å…¸æ¨¡å¼å¾ˆå¯é ï¼Œä½† Kotlin ä¸ºæˆ‘ä»¬æä¾›äº†æ›´å¼ºå¤§ã€æ›´ä¼˜é›…çš„æ–¹å¼æ¥æ„å»ºå®ƒï¼šä½¿ç”¨
<strong>å¯†å°æ¥å£</strong>
æ¥å¼ºåˆ¶å®ç°ç±»å‹å®‰å…¨çš„å‘½ä»¤ã€‚</p>
<h3 data-id="heading-6">1. å®šä¹‰æ‰€æœ‰è¾“å…¥</h3>
<p>æˆ‘ä»¬ä½¿ç”¨å¯†å°æ¥å£æ¥å»ºæ¨¡æœºå™¨å¯ä»¥æ¥æ”¶çš„æ‰€æœ‰å¯èƒ½è¾“å…¥ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VendingInput</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InsertMoney</span>(<span class="hljs-keyword">val</span> amount: <span class="hljs-built_in">Int</span>) : VendingInput
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SelectProduct</span>(<span class="hljs-keyword">val</span> code: String) : VendingInput
    <span class="hljs-keyword">object</span> RequestRefund : VendingInput
}
</code></pre>
<h3 data-id="heading-7">2. å®šä¹‰çŠ¶æ€å’Œä¸Šä¸‹æ–‡</h3>
<p>çŠ¶æ€æ¥å£ç°åœ¨æ¥å—ä¸€ä¸ªå•ä¸€çš„ <code>VendingInput</code>ã€‚ä¸Šä¸‹æ–‡æ‹¥æœ‰ä¸€ä¸ªå…¬å¼€çš„ <code>process</code> æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-kotlin" lang="kotlin">
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VendingState</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">VendingMachineContext</span>(<span class="hljs-keyword">var</span> balance: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">var</span> state: VendingState = IdleState
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">process</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span> {
        state.handle(input, <span class="hljs-keyword">this</span>)
    }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">transitionTo</span><span class="hljs-params">(newState: <span class="hljs-type">VendingState</span>)</span></span> {
        <span class="hljs-keyword">this</span>.state = newState
    }
}
</code></pre>
<h3 data-id="heading-8">3. è¡Œä¸º</h3>
<p>çŠ¶æ€å¯¹è±¡ä½¿ç”¨ä¸€ä¸ªå¯¹ <code>input</code> ç±»å‹çš„å•ä¸€ <code>when</code> è¯­å¥ã€‚å› ä¸º <code>VendingInput</code> æ˜¯å¯†å°çš„ï¼ŒKotlin ä¼šå¼ºåˆ¶æˆ‘ä»¬å¤„ç†æ‰€æœ‰å¯èƒ½çš„è¾“å…¥â€”â€”è¿™ä½¿å¾—æˆ‘ä»¬çš„ä»£ç å˜å¾—ç©·ä¸¾ä¸”å®‰å…¨ï¼</p>
<pre><code class="hljs language-kotlin" lang="kotlin">
<span class="hljs-keyword">object</span> IdleState : VendingState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; {
                context.balance += input.amount
                context.transitionTo(HasMoneyState)
                println(<span class="hljs-string">"å·²æŠ•å¸ã€‚ä½™é¢ï¼š<span class="hljs-subst">${context.balance}</span>"</span>)
            }
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; {
                println(<span class="hljs-string">"è¯·å…ˆæŠ•å¸ã€‚"</span>)
            }
            VendingInput.RequestRefund -&gt; {
                println(<span class="hljs-string">"æ²¡æœ‰å¯é€€çš„æ¬¾é¡¹ã€‚"</span>)
            }
        }
    }
}

<span class="hljs-keyword">object</span> HasMoneyState : VendingState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; {
                context.balance += input.amount
                println(<span class="hljs-string">"å·²æ·»åŠ é‡‘é¢ã€‚ä½™é¢ï¼š<span class="hljs-subst">${context.balance}</span>"</span>)
            }
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; {
                <span class="hljs-keyword">if</span> (context.balance &gt;= <span class="hljs-number">2</span>) {
                    context.balance -= <span class="hljs-number">2</span>
                    println(<span class="hljs-string">"å•†å“å·²å”®å‡ºã€‚"</span>)
                    context.transitionTo(IdleState)
                } <span class="hljs-keyword">else</span> {
                    println(<span class="hljs-string">"å•†å“ä¸å¯ç”¨ã€‚"</span>)
                }
            }
            VendingInput.RequestRefund -&gt; {
                println(<span class="hljs-string">"å·²é€€æ¬¾ï¼š<span class="hljs-subst">${context.balance}</span>"</span>)
                context.balance = <span class="hljs-number">0</span>
                context.transitionTo(IdleState)
            }
        }
    }
}

<span class="hljs-keyword">object</span> OutOfStockState : VendingState {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>, context: <span class="hljs-type">VendingMachineContext</span>)</span></span> {
        <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; {
                println(<span class="hljs-string">"æœºå™¨ç¼ºè´§ã€‚"</span>)
            }
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; {
                println(<span class="hljs-string">"æœºå™¨ç¼ºè´§ã€‚"</span>)
            }
            VendingInput.RequestRefund -&gt; {
                println(<span class="hljs-string">"æ²¡æœ‰å¯é€€çš„æ¬¾é¡¹ã€‚"</span>)
            }
        }
    }
}
</code></pre>
<h2 data-id="heading-9">çº¯å‡½æ•°å¼çŠ¶æ€è½¬æ¢</h2>
<p>å¯¹äºçœŸæ­£å¥å£®çš„ç³»ç»Ÿï¼ˆå¦‚ <strong>MVI</strong>ï¼‰ï¼Œä½ å¯èƒ½å¸Œæœ›é¿å…å¯å˜æ€§ã€‚ä½ å¯ä»¥é€šè¿‡è®©çŠ¶æ€å‡½æ•°è¿”å›ä¸‹ä¸€ä¸ªçŠ¶æ€æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œä»è€Œä½¿ç³»ç»Ÿå…·æœ‰é«˜åº¦ç¡®å®šæ€§ï¼š</p>
<h3 data-id="heading-10">1. å®šä¹‰è½¬æ¢</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. å®šä¹‰æ‰€æœ‰è¾“å…¥ï¼ˆä¿æŒä¸å˜ï¼Œå¯†å°æ¥å£éå¸¸é€‚åˆå‡½æ•°å¼ï¼‰</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">VendingInput</span> {
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InsertMoney</span>(<span class="hljs-keyword">val</span> amount: <span class="hljs-built_in">Int</span>) : VendingInput
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SelectProduct</span>(<span class="hljs-keyword">val</span> code: String) : VendingInput
    <span class="hljs-keyword">object</span> RequestRefund : VendingInput
}

<span class="hljs-comment">// 2. å®šä¹‰çŠ¶æ€ï¼šå°†æ•°æ®ï¼ˆbalanceï¼‰ä¸çŠ¶æ€é€»è¾‘ç»“åˆ</span>
<span class="hljs-comment">// ä½¿ç”¨ä¸å¯å˜å±æ€§ (val)ï¼Œç¡®ä¿çŠ¶æ€ä¸€æ—¦åˆ›å»ºä¸å¯ä¿®æ”¹</span>
<span class="hljs-keyword">sealed</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VendingState</span>(<span class="hljs-keyword">val</span> balance: <span class="hljs-built_in">Int</span>) {
    
    <span class="hljs-comment">// æ ¸å¿ƒè½¬å˜ï¼šå‡½æ•°ç­¾åè¿”å› (æ–°çŠ¶æ€, äº§ç”Ÿçš„ç»“æœæ–‡æœ¬)</span>
    <span class="hljs-keyword">abstract</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span>: Pair&lt;VendingState, String&gt;

    <span class="hljs-comment">// --- å„ä¸ªçŠ¶æ€çš„å…·ä½“å®ç° ---</span>

    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Idle</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> b: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>) : VendingState(b) {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span> = <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; 
                HasMoney(balance + input.amount) to <span class="hljs-string">"å·²æŠ•å¸ã€‚ä½™é¢ï¼š<span class="hljs-subst">${balance + input.amount}</span>"</span>
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; 
                <span class="hljs-keyword">this</span> to <span class="hljs-string">"è¯·å…ˆæŠ•å¸ã€‚"</span>
            VendingInput.RequestRefund -&gt; 
                <span class="hljs-keyword">this</span> to <span class="hljs-string">"æ²¡æœ‰å¯é€€çš„æ¬¾é¡¹ã€‚"</span>
        }
    }

    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HasMoney</span>(<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> b: <span class="hljs-built_in">Int</span>) : VendingState(b) {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span> = <span class="hljs-keyword">when</span> (input) {
            <span class="hljs-keyword">is</span> VendingInput.InsertMoney -&gt; 
                copy(b = balance + input.amount) to <span class="hljs-string">"å·²æ·»åŠ é‡‘é¢ã€‚ä½™é¢ï¼š<span class="hljs-subst">${balance + input.amount}</span>"</span>
            <span class="hljs-keyword">is</span> VendingInput.SelectProduct -&gt; 
                <span class="hljs-keyword">if</span> (balance &gt;= <span class="hljs-number">2</span>) Idle(balance - <span class="hljs-number">2</span>) to <span class="hljs-string">"å•†å“å·²å”®å‡ºï¼š<span class="hljs-subst">${input.code}</span>ã€‚"</span>
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">this</span> to <span class="hljs-string">"ä½™é¢ä¸è¶³ã€‚"</span>
            VendingInput.RequestRefund -&gt; 
                Idle(<span class="hljs-number">0</span>) to <span class="hljs-string">"å·²é€€æ¬¾ï¼š<span class="hljs-variable">$balance</span>"</span>
        }
    }

    <span class="hljs-keyword">object</span> OutOfStock : VendingState(<span class="hljs-number">0</span>) {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">handle</span><span class="hljs-params">(input: <span class="hljs-type">VendingInput</span>)</span></span> = <span class="hljs-keyword">this</span> to <span class="hljs-string">"æœºå™¨ç¼ºè´§ã€‚"</span>
    }
}
</code></pre>
<h3 data-id="heading-11">2. ä½¿ç”¨ä¸¾ä¾‹</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">val</span> s0 = VendingState.Idle()

    <span class="hljs-comment">// æ‰€æœ‰çš„å¤„ç†ç»“æœéƒ½ä½œä¸ºæ–°å€¼è¿”å›ï¼ŒåŸå§‹ s0 ä¿æŒä¸å˜</span>
    <span class="hljs-keyword">val</span> (s1, msg1) = s0.handle(VendingInput.InsertMoney(<span class="hljs-number">5</span>))
    println(msg1) <span class="hljs-comment">// å·²æŠ•å¸ã€‚ä½™é¢ï¼š5</span>

    <span class="hljs-keyword">val</span> (s2, msg2) = s1.handle(VendingInput.SelectProduct(<span class="hljs-string">"å¯ä¹"</span>))
    println(msg2) <span class="hljs-comment">// å•†å“å·²å”®å‡ºï¼šå¯ä¹ã€‚</span>

    <span class="hljs-comment">// s2 ç°åœ¨æ˜¯ Idle çŠ¶æ€ï¼Œä½™é¢å·²æ‰£é™¤</span>
    println(<span class="hljs-string">"æœ€ç»ˆçŠ¶æ€: <span class="hljs-subst">${s2::class.simpleName}</span>, ä½™é¢: <span class="hljs-subst">${s2.balance}</span>"</span>)
}

</code></pre>
<p>è™½ç„¶æ›´å¤æ‚ï¼Œä½†è¿™ç§æ–¹æ³•åœ¨å“åº”å¼æ¶æ„ä¸­å¾ˆå¸¸è§ï¼Œå› ä¸ºçŠ¶æ€å˜åŒ–æ˜¯å¿…é¡»è¢«ç²¾ç¡®è·Ÿè¸ªçš„äº‹ä»¶ã€‚</p>
<p>å®ƒçš„æ ¸å¿ƒå®é™…ä¸Šå°±æ˜¯å‡½æ•°æœ‰çŠ¶æ€çš„è¿”å›ï¼Œè€ŒçŠ¶æ€æœ¬èº«æ˜¯ä¸å¯å˜çš„ï¼Œå¦‚æœåŒä¸€ä¸ªçŠ¶æ€çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„çŠ¶æ€ã€‚</p>
<h2 data-id="heading-12">æ€»ç»“</h2>
<p>é€šè¿‡åº”ç”¨çŠ¶æ€æ¨¡å¼ï¼Œæˆ‘ä»¬æˆåŠŸåœ°å°†åˆ†æ•£ã€è„†å¼±çš„æ¡ä»¶é€»è¾‘æ›¿æ¢ä¸ºå¹²å‡€ã€å†…èšçš„çŠ¶æ€å¯¹è±¡ã€‚è¿™ä½¿å¾—æˆ‘ä»¬çš„ä»£ç æ›´æ˜“äºç»´æŠ¤ã€æµ‹è¯•å’Œæ‰©å±•ã€‚</p>
<p>å¦‚æœä½ çš„ Kotlin ä»£ç åº“æ­£é­å—â€œè‡ƒè‚¿çš„ <code>when</code> è¯­å¥â€ä¹‹è‹¦ï¼Œä¸å¦¨è¯•è¯•çŠ¶æ€æ¨¡å¼ã€‚å›¢é˜Ÿä¸­çš„å°ä¼™ä¼´ä¸€å®šä¼šæ„Ÿè°¢ä½ çš„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android æ·±å…¥å‰–æAndroidå†…å­˜æ³„æ¼ï¼šViewPager2ä¸Fragmentçš„ç”Ÿå‘½å‘¨æœŸé™·é˜±]]></title>    <link>https://juejin.cn/post/7591413678982905902</link>    <guid>https://juejin.cn/post/7591413678982905902</guid>    <pubDate>2026-01-05T00:48:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591413678982905902" data-draft-id="7582136489770385418" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android æ·±å…¥å‰–æAndroidå†…å­˜æ³„æ¼ï¼šViewPager2ä¸Fragmentçš„ç”Ÿå‘½å‘¨æœŸé™·é˜±"/> <meta itemprop="keywords" content="Android,å‰ç«¯,APP"/> <meta itemprop="datePublished" content="2026-01-05T00:48:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¹ç¨‹åå…«å°‘"/> <meta itemprop="url" content="https://juejin.cn/user/184373685534077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android æ·±å…¥å‰–æAndroidå†…å­˜æ³„æ¼ï¼šViewPager2ä¸Fragmentçš„ç”Ÿå‘½å‘¨æœŸé™·é˜±
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/184373685534077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¹ç¨‹åå…«å°‘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:48:42.000Z" title="Mon Jan 05 2026 00:48:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœºæ™¯ï¼š åœ¨æ–°èƒ½æºè½¦æœºç³»ç»Ÿæœ‰ä¸€å¥—UIé¡µé¢ï¼Œæ‰‹æœºæœ‰ç«–å±é¡µé¢ï¼Œæ‰‹æœºåˆæ¨ªå±é¡µé¢ï¼Œ3ç§æƒ…å†µç›¸äº’åˆ‡æ¢ï¼Œé¢‘ç¹çš„åˆ‡æ¢ï¼Œæ‰‹æœºçš„ç«–å±é¡µé¢æœ‰3ä¸ªtabå’Œ3ä¸ªå¯¹åº”fragmentï¼Œä¸€ä¸ªå¤–å±‚FragmentåŒ…å«3ä¸ªfragment, ä¸åœçš„åˆ‡æ¢å¯¼è‡´çš„ï¼</p>
</blockquote>
<h2 data-id="heading-0">1.å†…å­˜æ³„æ¼ä¿¡æ¯</h2>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span> <span class="hljs-attr">GC Root:</span> <span class="hljs-string">Global</span> <span class="hljs-string">variable</span> <span class="hljs-string">in</span> <span class="hljs-string">native</span> <span class="hljs-string">code</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-attr">Leaking:</span> <span class="hljs-literal">NO</span> <span class="hljs-string">(MainActivityâ†“</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">leaking)</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â†“</span> <span class="hljs-string">-$$Lambda$ViewRootImpl$zmAX2p20-kqxknxcUyGhSNjsJvM.f$0</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-attr">Leaking:</span> <span class="hljs-literal">NO</span> <span class="hljs-string">(MainActivityâ†“</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-string">leaking)</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">mContext</span> <span class="hljs-string">instance</span> <span class="hljs-string">of</span> <span class="hljs-string">com.tencent.settings.MainActivity</span> <span class="hljs-string">with</span> <span class="hljs-string">mDestroyed</span> <span class="hljs-string">=</span> <span class="hljs-literal">false</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">ViewRootImpl#mView</span> <span class="hljs-string">is</span> <span class="hljs-string">not</span> <span class="hljs-literal">null</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â†“</span> <span class="hljs-string">ViewRootImpl.mContext</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">com.tencent.settings.MainActivity</span> <span class="hljs-string">instance</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â†“</span> <span class="hljs-string">ComponentActivity.mLifecycleRegistry</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>                        <span class="hljs-string">~~~~~~~~~~~~</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">Retaining</span> <span class="hljs-number">52</span> <span class="hljs-string">B</span> <span class="hljs-string">in</span> <span class="hljs-number">2</span> <span class="hljs-string">objects</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">Anonymous</span> <span class="hljs-string">class</span> <span class="hljs-string">implementing</span> <span class="hljs-string">androidx.lifecycle.LifecycleEventObserver</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">androidx.viewpager2.adapter.FragmentStateAdapter$FragmentMaxLifecycleEnforcer</span> <span class="hljs-string">instance</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â†“</span> <span class="hljs-string">FragmentStateAdapter$FragmentMaxLifecycleEnforcer.mViewPager</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>                                                        <span class="hljs-string">~~~~~~~~~~</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">androidx.viewpager2.widget.ViewPager2</span> <span class="hljs-string">instance</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-attr">Leaking:</span> <span class="hljs-string">UNKNOWN</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">Retaining</span> <span class="hljs-number">85.1</span> <span class="hljs-string">kB</span> <span class="hljs-string">in</span> <span class="hljs-number">1109 </span><span class="hljs-string">objects</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">View</span> <span class="hljs-string">not</span> <span class="hljs-string">part</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">window</span> <span class="hljs-string">view</span> <span class="hljs-string">hierarchy</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">View.mAttachInfo</span> <span class="hljs-string">is</span> <span class="hljs-literal">null</span> <span class="hljs-string">(view</span> <span class="hljs-string">detached)</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">View.mWindowAttachCount</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">mContext</span> <span class="hljs-string">instance</span> <span class="hljs-string">of</span> <span class="hljs-string">com.tencent.settings.MainActivity</span> <span class="hljs-string">with</span> <span class="hljs-string">mDestroyed</span> <span class="hljs-string">=</span> <span class="hljs-literal">false</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>    <span class="hljs-string">â†“</span> <span class="hljs-string">View.mParent</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â”‚</span>           <span class="hljs-string">~~~~~~~</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â€‹</span>     <span class="hljs-attr">Leaking:</span> <span class="hljs-literal">YES</span> <span class="hljs-string">(ObjectWatcher</span> <span class="hljs-string">was</span> <span class="hljs-string">watching</span> <span class="hljs-string">this</span> <span class="hljs-string">because</span> <span class="hljs-string">com.tencent.settings.PhoneAndroidFragment</span> <span class="hljs-string">received</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â€‹</span>     <span class="hljs-string">Fragment#onDestroyView()</span> <span class="hljs-string">callback</span> <span class="hljs-string">(references</span> <span class="hljs-string">to</span> <span class="hljs-string">its</span> <span class="hljs-string">views</span> <span class="hljs-string">should</span> <span class="hljs-string">be</span> <span class="hljs-string">cleared</span> <span class="hljs-string">to</span> <span class="hljs-string">prevent</span> <span class="hljs-string">leaks))</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â€‹</span>     <span class="hljs-string">key</span> <span class="hljs-string">=</span> <span class="hljs-string">4e6eb9f9-742a-42b5-a71d-42543f7f1407</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â€‹</span>     <span class="hljs-string">watchDurationMillis</span> <span class="hljs-string">=</span> <span class="hljs-number">22525</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â€‹</span>     <span class="hljs-string">View</span> <span class="hljs-string">not</span> <span class="hljs-string">part</span> <span class="hljs-string">of</span> <span class="hljs-string">a</span> <span class="hljs-string">window</span> <span class="hljs-string">view</span> <span class="hljs-string">hierarchy</span>
<span class="hljs-number">2025-12-11 09:35:44.808 </span><span class="hljs-number">57579</span><span class="hljs-number">-61121</span> <span class="hljs-string">LeakCanary</span>              <span class="hljs-string">com.tencent.settings</span>                     <span class="hljs-string">D</span>  <span class="hljs-string">â€‹</span>     <span class="hljs-string">View.mWindowAttachCount</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span>
</code></pre>
<h3 data-id="heading-1">æ³„æ¼ç°è±¡</h3>
<p>LeakCanaryçš„æ—¥å¿—æ˜¾ç¤ºäº†è¿™æ ·ä¸€ä¸ªæ³„æ¼é“¾ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">GC Root: Global variable in native code
â†“
ViewRootImplçš„Lambdaè¡¨è¾¾å¼
â†“
MainActivity (<span class="hljs-attr">mDestroyed</span> = <span class="hljs-literal">false</span>)
â†“
ComponentActivity.mLifecycleRegistry
â†“
FragmentStateAdapter$FragmentMaxLifecycleEnforcer
â†“
ViewPager2å®ä¾‹ (å·²ä»çª—å£åˆ†ç¦»)
â†“
Fragmentå·²é”€æ¯çš„è§†å›¾ (åº”è¢«å›æ”¶ä½†æœªè¢«å›æ”¶)
</code></pre>
<h3 data-id="heading-2">2. ä¸»è¦æ³„æ¼ç‚¹</h3>
<p>PhoneAndroidFragment å·²ç»æ”¶åˆ°äº† onDestroyView() å›è°ƒ</p>
<p>ä½†å…¶è§†å›¾ä»ç„¶è¢« ViewPager2 æŒæœ‰</p>
<p>ViewPager2 æœ¬èº«åˆè¢« FragmentMaxLifecycleEnforcer æŒæœ‰</p>
<h5 data-id="heading-3">2.2 æ ¸å¿ƒåŸå› </h5>
<p>FragmentStateAdapter$FragmentMaxLifecycleEnforcer æ˜¯ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸè§‚å¯Ÿè€…ï¼Œå®ƒï¼š</p>
<p>é€šè¿‡ MainActivity çš„ mLifecycleRegistry æ³¨å†Œ</p>
<p>æŒæœ‰ ViewPager2 çš„å¼•ç”¨</p>
<p>å¯¼è‡´ ViewPager2 åŠå…¶å­è§†å›¾æ— æ³•è¢«é‡Šæ”¾</p>
<p>é—®é¢˜ï¼šè°æŒæœ‰ ViewPager2ï¼Œ ä¸ºä»€ä¹ˆPhoneAndroidFragment ä¸èƒ½è¢«å›æ”¶</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> GC Root (Nativeå…¨å±€å˜é‡)
   â†“
<span class="hljs-bullet">2.</span> ViewRootImplçš„Lambdaå‡½æ•°
   â†“
<span class="hljs-bullet">3.</span> MainActivity (Activityæœ¬èº«æœªé”€æ¯)
   â†“
<span class="hljs-bullet">4.</span> ComponentActivity.mLifecycleRegistry (ç”Ÿå‘½å‘¨æœŸæ³¨å†Œè¡¨)
   â†“
<span class="hljs-bullet">5.</span> FragmentStateAdapter$FragmentMaxLifecycleEnforcer (ç”Ÿå‘½å‘¨æœŸè§‚å¯Ÿè€…)
   â†“
<span class="hljs-bullet">6.</span> ViewPager2 å®ä¾‹ (å…³é”®æŒæœ‰è€…)
   â†“
<span class="hljs-bullet">7.</span> ViewPager2 çš„å†…éƒ¨çŠ¶æ€ (RecyclerViewã€é€‚é…å™¨ç­‰)
   â†“
<span class="hljs-bullet">8.</span> PhoneAndroidFragment çš„è§†å›¾ (Fragmentçš„Viewå±‚æ¬¡ç»“æ„)
</code></pre>
<h3 data-id="heading-4">3.æºç è¯¦ç»†åˆ†æå„ç¯èŠ‚ï¼š</h3>
<h5 data-id="heading-5"><strong>3.1. FragmentMaxLifecycleEnforcer æ˜¯è°ï¼Ÿ</strong></h5>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// è¿™æ˜¯ViewPager2çš„å†…éƒ¨ç±»ï¼Œè´Ÿè´£ç®¡ç†Fragmentçš„ç”Ÿå‘½å‘¨æœŸ</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FragmentStateAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RecyclerView</span>.<span class="hljs-title">Adapter&lt;</span>...<span class="hljs-title">&gt;</span> </span>{
    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FragmentMaxLifecycleEnforcer</span> </span>{
        <span class="hljs-comment">// å…³é”®å­—æ®µ</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">ViewPager2</span> mViewPager;  <span class="hljs-comment">// æŒæœ‰ViewPager2çš„å¼ºå¼•ç”¨</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">LifecycleEventObserver</span> mLifecycleObserver;  <span class="hljs-comment">// ç”Ÿå‘½å‘¨æœŸè§‚å¯Ÿè€…</span>
    }
}
</code></pre>
<h5 data-id="heading-6"><strong>3.2. ä¸ºä»€ä¹ˆå®ƒæŒæœ‰ViewPager2ï¼Ÿ</strong></h5>
<p>å½“ViewPager2ä½¿ç”¨<code>FragmentStateAdapter</code>æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª<code>FragmentMaxLifecycleEnforcer</code>å®ä¾‹ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// åœ¨FragmentStateAdapteræ„é€ å‡½æ•°ä¸­</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">FragmentStateAdapter</span>(<span class="hljs-variable">@NonNull</span> FragmentManager fragmentManager, 
                           <span class="hljs-variable">@NonNull</span> Lifecycle lifecycle) {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-selector-tag">mFragmentMaxLifecycleEnforcer</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">FragmentMaxLifecycleEnforcer</span>();
    <span class="hljs-selector-tag">lifecycle</span><span class="hljs-selector-class">.addObserver</span>(mFragmentMaxLifecycleEnforcer);  <span class="hljs-comment">// æ³¨å†Œåˆ°Activityç”Ÿå‘½å‘¨æœŸ</span>
}
</code></pre>
<h5 data-id="heading-7"><strong>3.3. PhoneAndroidFragmentä¸ºä»€ä¹ˆä¸èƒ½è¢«å›æ”¶ï¼Ÿ</strong></h5>
<p><strong>æ ¹æœ¬åŸå› ï¼šViewPager2ä»ç„¶æŒæœ‰Fragmentçš„è§†å›¾å¼•ç”¨</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ViewPager2å†…éƒ¨æ˜¯é€šè¿‡RecyclerViewå®ç°çš„</span>
<span class="hljs-comment">// å½“Fragmentè¢«é”€æ¯æ—¶ï¼Œå¦‚æœViewPager2æ²¡æœ‰æ­£ç¡®æ¸…ç†ï¼Œå°±ä¼šï¼š</span>
<span class="hljs-number">1</span>. ViewPager2çš„RecyclerViewä»ç„¶ç¼“å­˜ç€Fragmentçš„ViewHolder
<span class="hljs-number">2</span>. Fragmentçš„Viewä»ç„¶åœ¨ViewPager2çš„å­Viewåˆ—è¡¨ä¸­
<span class="hljs-number">3</span>. Fragmentçš„<span class="hljs-built_in">onDestroyView</span>()è¢«è°ƒç”¨ï¼Œä½†Viewå¯¹è±¡æ²¡æœ‰è¢«GCå›æ”¶
</code></pre>
<h3 data-id="heading-8">3.4 RecyclerViewç¼“å­˜é—®é¢˜</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// ViewPager2å†…éƒ¨ä½¿ç”¨RecyclerViewï¼Œæœ‰ä»¥ä¸‹ç¼“å­˜ï¼š</span>
<span class="hljs-number">1.</span> mAttachedScrap - å·²é™„åŠ çš„åºŸå¼ƒè§†å›¾
<span class="hljs-number">2.</span> mCachedViews - ç¼“å­˜è§†å›¾ï¼ˆé»˜è®¤å¤§å°<span class="hljs-number">2</span>ï¼‰
<span class="hljs-number">3.</span> mRecyclerPool - å›æ”¶æ± 

<span class="hljs-comment">// å½“Fragmenté”€æ¯æ—¶ï¼Œå¦‚æœViewè¿˜åœ¨è¿™äº›ç¼“å­˜ä¸­ï¼š</span>
<span class="hljs-comment">// 1. Viewä¸ä¼šè¢«é‡Šæ”¾</span>
<span class="hljs-comment">// 2. Fragmentçš„è§†å›¾å¼•ç”¨è¢«ä¿ç•™</span>
<span class="hljs-comment">// 3. å¯¼è‡´å†…å­˜æ³„æ¼</span>
</code></pre>
<h3 data-id="heading-9">3.5. å±å¹•åˆ‡æ¢å½±å“</h3>
<pre><code class="hljs language-markdown" lang="markdown">è½¦æœºç³»ç»Ÿ â†” æ‰‹æœºç«–å± â†” æ‰‹æœºæ¨ªå±
<span class="hljs-code">      â†“         â†“         â†“
å¸ƒå±€å®Œå…¨ä¸åŒ   åŒ…å«ViewPager2  å¸ƒå±€å®Œå…¨ä¸åŒ
      â†“         â†“         â†“
æ¯æ¬¡åˆ‡æ¢éœ€è¦   3ä¸ªTabé¢‘ç¹   æ¯æ¬¡åˆ‡æ¢éœ€è¦
å®Œå…¨é‡å»ºUI   åˆ‡æ¢Fragment  å®Œå…¨é‡å»ºUI
</span></code></pre>
<h4 data-id="heading-10">å…·ä½“çš„å¼•ç”¨è·¯å¾„ï¼š</h4>
<pre><code class="hljs language-markdown" lang="markdown">PhoneAndroidFragmentçš„Viewè¢«ä»¥ä¸‹å¯¹è±¡å¼•ç”¨ï¼š
<span class="hljs-bullet">1.</span> ViewPager2.mRecyclerView (RecyclerViewå®ä¾‹)
   â†“
<span class="hljs-bullet">2.</span> RecyclerView.mRecycler (RecyclerView.Recyclerå›æ”¶æ± )
   â†“
<span class="hljs-bullet">3.</span> RecyclerView.Recycler.mCachedViews (ç¼“å­˜è§†å›¾åˆ—è¡¨)
   â†“
<span class="hljs-bullet">4.</span> æˆ– RecyclerView.Recycler.mAttachedScrap (é™„åŠ çš„åºŸå¼ƒè§†å›¾)
   â†“
<span class="hljs-bullet">5.</span> Fragmentçš„Viewåœ¨ç¼“å­˜ä¸­ç­‰å¾…å¤ç”¨
</code></pre>
<h4 data-id="heading-11">ä¸ºä»€ä¹ˆä¼šå½¢æˆè¿™ä¸ªæ³„æ¼é“¾ï¼Ÿ</h4>
<h5 data-id="heading-12"><strong>åœºæ™¯é‡ç°</strong>ï¼š</h5>
<ol>
<li>
<p><strong>åˆå§‹åŒ–</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// MainActivityä¸­
ViewPager2 <span class="hljs-attr">viewPager</span> = findViewById(R.id.view_pager)<span class="hljs-comment">;</span>
<span class="hljs-attr">viewPager.adapter</span> = new FragmentStateAdapter(this)<span class="hljs-comment">;</span>
// æ­¤æ—¶ï¼ŒFragmentMaxLifecycleEnforcerè¢«æ³¨å†Œåˆ°Activityçš„ç”Ÿå‘½å‘¨æœŸ
</code></pre>
</li>
<li>
<p><strong>Fragmentè¢«é”€æ¯</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// å½“PhoneAndroidFragmentæ”¶åˆ°onDestroyView()æ—¶</span>
<span class="hljs-comment">// ç†æƒ³æƒ…å†µï¼šViewPager2åº”è¯¥é‡Šæ”¾å¯¹Fragment Viewçš„å¼•ç”¨</span>
<span class="hljs-comment">// å®é™…æƒ…å†µï¼šViewPager2å¯èƒ½è¿˜åœ¨ç¼“å­˜è¿™ä¸ªView</span>
</code></pre>
</li>
<li>
<p><strong>é—®é¢˜å‘ç”Ÿ</strong>ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// ViewPager2çš„FragmentStateAdapteræ²¡æœ‰æ­£ç¡®å¤„ç†</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">onViewRecycled</span>(<span class="hljs-variable">@NonNull</span> FragmentViewHolder holder) {
    <span class="hljs-comment">// å¯èƒ½æ²¡æœ‰æ­£ç¡®è°ƒç”¨FragmentTransaction.remove()</span>
    <span class="hljs-comment">// æˆ–è€…Fragmentçš„Viewè¿˜åœ¨RecyclerViewçš„ç¼“å­˜ä¸­</span>
}
</code></pre>
</li>
</ol>
<p><strong>æ•´ä½“çš„æµç¨‹å›¾ï¼š</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee90c5c903ce4bcab2e7c645bb9324bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP56iL5Y2B5YWr5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768178922&amp;x-signature=coEmPgMczS3SG9OuDeHvBwXkzdM%3D" alt="å†…å­˜æ³„éœ².png" loading="lazy"/></p>
<h3 data-id="heading-13">4. æ—¥å¿—æ·±åº¦åˆ†æ</h3>
<h4 data-id="heading-14">4.1. GC Rootæº¯æº</h4>
<p>æ—¥å¿—æ˜¾ç¤ºGC Rootæ˜¯<code>Global variable in native code</code>ï¼Œè¿™è¡¨æ˜æ³„æ¼çš„æºå¤´åœ¨Androidç³»ç»Ÿå±‚ã€‚å…·ä½“æ¥è¯´ï¼Œæ˜¯<code>ViewRootImpl</code>çš„Lambdaè¡¨è¾¾å¼è¢«nativeå±‚çš„å…¨å±€å˜é‡æŒæœ‰ã€‚</p>
<p><code>ViewRootImpl</code>æ˜¯Androidçª—å£ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£è¿æ¥åº”ç”¨å±‚çš„Viewå’Œç³»ç»Ÿå±‚çš„Windowã€‚å½“Activityåˆ›å»ºçª—å£æ—¶ï¼Œç³»ç»Ÿä¼šåˆ›å»ºå¯¹åº”çš„ViewRootImplï¼Œå¹¶åœ¨nativeå±‚æ³¨å†Œå„ç§å›è°ƒã€‚</p>
<h4 data-id="heading-15">4.2. å¼•ç”¨é“¾åˆ†æ</h4>
<p>è®©æˆ‘ä»¬é€çº§åˆ†æè¿™ä¸ªå¼•ç”¨é“¾ï¼š</p>
<ol>
<li><strong>ç³»ç»Ÿå±‚æŒæœ‰</strong>ï¼šnativeå±‚çš„å…¨å±€å˜é‡æŒæœ‰ViewRootImplçš„Lambdaå¼•ç”¨</li>
<li><strong>Lambdaæ•è·</strong>ï¼šè¯¥Lambdaæ•è·äº†å¤–éƒ¨ç±»çš„å¼•ç”¨ï¼ˆå³MainActivityï¼‰</li>
<li><strong>Activityå­˜æ´»</strong>ï¼šMainActivityçš„<code>mDestroyed = false</code>ï¼Œè¡¨æ˜Activityå¹¶æœªé”€æ¯</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸæ³¨å†Œ</strong>ï¼šActivityçš„<code>mLifecycleRegistry</code>æŒæœ‰<code>FragmentMaxLifecycleEnforcer</code></li>
<li><strong>ViewPager2å…³è”</strong>ï¼š<code>FragmentMaxLifecycleEnforcer</code>æŒæœ‰ViewPager2çš„å¼•ç”¨</li>
<li><strong>è§†å›¾æœªè¢«é‡Šæ”¾</strong>ï¼šViewPager2æŒæœ‰å·²è°ƒç”¨<code>onDestroyView()</code>çš„Fragmentè§†å›¾</li>
</ol>
<h4 data-id="heading-16">4.3. å…³é”®çŠ¶æ€ä¿¡æ¯</h4>
<p>ä»æ—¥å¿—ä¸­æˆ‘ä»¬æ³¨æ„åˆ°å‡ ä¸ªå…³é”®çŠ¶æ€ï¼š</p>
<ul>
<li><code>View.mAttachInfo is null (view detached)</code>ï¼šViewPager2å·²ä»çª—å£åˆ†ç¦»</li>
<li><code>View not part of a window view hierarchy</code>ï¼šè§†å›¾ä¸åœ¨çª—å£å±‚çº§ä¸­</li>
<li><code>mDestroyed = false</code>ï¼šActivityæœªé”€æ¯</li>
<li><code>PhoneAndroidFragment received Fragment#onDestroyView()</code>ï¼šFragmentçš„è§†å›¾å·²è¢«é”€æ¯</li>
</ul>
<h3 data-id="heading-17">é—®é¢˜æœ¬è´¨</h3>
<h4 data-id="heading-18">ç”Ÿå‘½å‘¨æœŸé”™é…</h4>
<p>è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ˜¯<strong>ç”Ÿå‘½å‘¨æœŸæ³¨å†Œåœ¨é”™è¯¯çš„å±‚çº§</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">// é”™è¯¯å†™æ³•ï¼šæ³¨å†Œåˆ°Activityç”Ÿå‘½å‘¨æœŸ
<span class="hljs-attr">adapter</span> = new ViewPagerAdapter(getActivity())<span class="hljs-comment">;</span>

// æ­£ç¡®å†™æ³•ï¼šæ³¨å†Œåˆ°Fragmentç”Ÿå‘½å‘¨æœŸ  
<span class="hljs-attr">adapter</span> = new ViewPagerAdapter(this)<span class="hljs-comment">;</span>
</code></pre>
<p>å½“ViewPager2çš„<code>FragmentStateAdapter</code>æ¥æ”¶åˆ°Activityä½œä¸ºå‚æ•°æ—¶ï¼Œå®ƒå†…éƒ¨åˆ›å»ºçš„<code>FragmentMaxLifecycleEnforcer</code>ä¼šæ³¨å†Œåˆ°Activityçš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>å³ä½¿Fragmentçš„è§†å›¾è¢«é”€æ¯ï¼Œ<code>FragmentMaxLifecycleEnforcer</code>ä»ç„¶å­˜æ´»</li>
<li><code>FragmentMaxLifecycleEnforcer</code>æŒæœ‰ViewPager2çš„å¼•ç”¨</li>
<li>ViewPager2æŒæœ‰Fragmentå·²é”€æ¯çš„è§†å›¾</li>
<li>å¯¼è‡´Fragmentè§†å›¾æ— æ³•è¢«GCå›æ”¶</li>
</ul>
<h4 data-id="heading-19">ViewRootImplçš„ä»‹å…¥</h4>
<p>ä¸ºä»€ä¹ˆç³»ç»Ÿå±‚çš„ViewRootImplä¼šå‚ä¸è¿™ä¸ªæ³„æ¼é“¾ï¼Ÿ</p>
<p>å½“Activityæ˜¾ç¤ºæ—¶ï¼Œç³»ç»Ÿä¼šåˆ›å»ºViewRootImplæ¥ç®¡ç†çª—å£ã€‚ViewRootImplå¯èƒ½åˆ›å»ºä¸€äº›Lambdaå›è°ƒï¼ˆå¦‚çª—å£ç„¦ç‚¹å˜åŒ–ã€è¾“å…¥äº‹ä»¶å¤„ç†ç­‰ï¼‰ï¼Œè¿™äº›Lambdaéšå¼æ•è·äº†Activityå¼•ç”¨ã€‚ç”±äºè¿™äº›å›è°ƒè¢«nativeå±‚å…¨å±€å˜é‡å¼•ç”¨ï¼Œå®ƒä»¬æˆä¸ºäº†GC Rootï¼Œé˜»æ­¢äº†ActivityåŠå…¶å…³è”å¯¹è±¡çš„å›æ”¶ã€‚</p>
<h3 data-id="heading-20">5. è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-21">æ–¹æ¡ˆä¸€ï¼šä¿®æ­£ç”Ÿå‘½å‘¨æœŸæ³¨å†Œï¼ˆæ ¸å¿ƒä¿®å¤ï¼‰</h4>
<p>æ ¸å¿ƒè¦è®°ä½ï¼š<strong>FragmentStateAdapterå¿…é¡»ä½¿ç”¨Fragmentçš„ç”Ÿå‘½å‘¨æœŸï¼Œè€ŒéActivity</strong>ï¼Œè¿™æ˜¯è§£å†³æ­¤ç±»é—®é¢˜çš„å…³é”®ã€‚</p>
<p><strong>ä¿®æ”¹ViewPagerAdapterçš„æ„é€ å‡½æ•°è°ƒç”¨</strong>ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// PhoneAndroidFragment.java</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initView</span>()</span> {
    <span class="hljs-comment">// å°†åŸæœ‰çš„ï¼š</span>
    <span class="hljs-comment">// adapter = new ViewPagerAdapter(getActivity());</span>
    <span class="hljs-comment">// æ”¹ä¸ºï¼š</span>
    adapter = <span class="hljs-keyword">new</span> ViewPagerAdapter(<span class="hljs-keyword">this</span>);  <span class="hljs-comment">// ä¼ é€’Fragmentæœ¬èº«</span>
}
</code></pre>
<p><strong>å¢å¼ºViewPagerAdapteræ”¯æŒFragment</strong>ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// ViewPagerAdapter.java</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">ViewPagerAdapter</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">FragmentStateAdapter</span> {
    
    <span class="hljs-comment">// ä¿ç•™åŸæœ‰çš„Activityæ„é€ å‡½æ•°</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ViewPagerAdapter</span>(<span class="hljs-variable">@NonNull</span> FragmentActivity fragmentActivity) {
        <span class="hljs-selector-tag">super</span>(fragmentActivity);
    }
    
    <span class="hljs-comment">// æ–°å¢Fragmentæ„é€ å‡½æ•°ï¼ˆå…³é”®ä¿®å¤ï¼‰</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">ViewPagerAdapter</span>(<span class="hljs-variable">@NonNull</span> Fragment fragment) {
        <span class="hljs-selector-tag">super</span>(fragment);
    }
    
    <span class="hljs-comment">// ... å…¶ä»–ä»£ç </span>
}
</code></pre>
<h4 data-id="heading-22">æ–¹æ¡ˆäºŒï¼šå½»åº•æ¸…ç†onDestroyView()</h4>
<pre><code class="hljs language-ini" lang="ini">@Override
public void onDestroyView() {
    <span class="hljs-attr">isDestroyed</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
    
    // 1. æ¸…ç†Handler
    if (handler != null) {
        handler.removeCallbacksAndMessages(null)<span class="hljs-comment">;</span>
    }
    
    // 2. å–æ¶ˆViewPager2å›è°ƒ
    if (viewDataBinding != null &amp;&amp; pageChangeCallback != null) {
        viewDataBinding.phoneSettingPager.unregisterOnPageChangeCallback(pageChangeCallback)<span class="hljs-comment">;</span>
        <span class="hljs-attr">pageChangeCallback</span> = null<span class="hljs-comment">;</span>
    }
    
    // 3. æ¸…ç†ViewPager2é€‚é…å™¨
    if (viewDataBinding != null &amp;&amp; viewDataBinding.phoneSettingPager != null) {
        // æ¸…ç†å†…éƒ¨RecyclerView
        View <span class="hljs-attr">child</span> = viewDataBinding.phoneSettingPager.getChildAt(<span class="hljs-number">0</span>)<span class="hljs-comment">;</span>
        if (child instanceof RecyclerView) {
            RecyclerView <span class="hljs-attr">recyclerView</span> = (RecyclerView) child<span class="hljs-comment">;</span>
            recyclerView.setAdapter(null)<span class="hljs-comment">;</span>
            recyclerView.setLayoutManager(null)<span class="hljs-comment">;</span>
            recyclerView.getRecycledViewPool().clear()<span class="hljs-comment">;</span>
        }
        
        // æ¸…ç†ViewPager2é€‚é…å™¨
        viewDataBinding.phoneSettingPager.setAdapter(null)<span class="hljs-comment">;</span>
    }
    
    // 4. æ¸…ç†é€‚é…å™¨å¼•ç”¨
    <span class="hljs-attr">adapter</span> = null<span class="hljs-comment">;</span>
    
    EventBusUtils.unRegister(this)<span class="hljs-comment">;</span>
    super.onDestroyView()<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-23">æ–¹æ¡ˆä¸‰ï¼šæ·»åŠ çŠ¶æ€æ£€æŸ¥å’Œé˜²æŠ¤</h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// æ·»åŠ çŠ¶æ€æ£€æŸ¥æ–¹æ³•</span>
private boolean <span class="hljs-built_in">isFragmentUsable</span>() {
    return !isDestroyed &amp;&amp; 
           <span class="hljs-built_in">isAdded</span>() &amp;&amp; 
           <span class="hljs-built_in">getActivity</span>() != null &amp;&amp; 
           !<span class="hljs-built_in">getActivity</span>()<span class="hljs-selector-class">.isFinishing</span>() &amp;&amp; 
           <span class="hljs-built_in">getView</span>() != null;
}

<span class="hljs-comment">// åœ¨æ‰€æœ‰å›è°ƒä¸­ä½¿ç”¨çŠ¶æ€æ£€æŸ¥</span>
<span class="hljs-keyword">@Subscribe</span>(threadMode = ThreadMode.MAIN)
public void onEvent(SomeEvent event) {
    if (!isFragmentUsable()) return;
   
}
</code></pre>
<h4 data-id="heading-24">æ–¹æ¡ˆå››ï¼šä½¿ç”¨WeakReferenceåŒ…è£…å›è°ƒ</h4>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// å®‰å…¨çš„å›è°ƒåŒ…è£…ç±»</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SafePageChangeCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ViewPager2</span>.<span class="hljs-title">OnPageChangeCallback</span> </span>{
    <span class="hljs-keyword">private</span> <span class="hljs-type">WeakReference</span>&lt;<span class="hljs-type">PhoneAndroidFragment</span>&gt; fragmentRef;
    
    public <span class="hljs-type">SafePageChangeCallback</span>(<span class="hljs-type">PhoneAndroidFragment</span> fragment) {
        <span class="hljs-keyword">this</span>.fragmentRef = <span class="hljs-keyword">new</span> <span class="hljs-type">WeakReference</span>&lt;&gt;(fragment);
    }
    
    <span class="hljs-meta">@Override</span>
    public void onPageSelected(int position) {
        <span class="hljs-type">PhoneAndroidFragment</span> fragment = fragmentRef.get();
        <span class="hljs-keyword">if</span> (fragment == <span class="hljs-literal">null</span> || !fragment.isFragmentUsable()) {
            <span class="hljs-keyword">return</span>;
        }
    
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åªéœ€ä¸€ä¸ªåŸŸåï¼Œé›¶æˆæœ¬æ‹¥æœ‰æ— é™ä¸ªè‡ªå®šä¹‰é‚®ç®±]]></title>    <link>https://juejin.cn/post/7591421956216029222</link>    <guid>https://juejin.cn/post/7591421956216029222</guid>    <pubDate>2026-01-05T00:58:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591421956216029222" data-draft-id="7591406727137689626" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åªéœ€ä¸€ä¸ªåŸŸåï¼Œé›¶æˆæœ¬æ‹¥æœ‰æ— é™ä¸ªè‡ªå®šä¹‰é‚®ç®±"/> <meta itemprop="keywords" content="ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2026-01-05T00:58:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çŸ¥è¯†æµ…è°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/607378030207176"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åªéœ€ä¸€ä¸ªåŸŸåï¼Œé›¶æˆæœ¬æ‹¥æœ‰æ— é™ä¸ªè‡ªå®šä¹‰é‚®ç®±
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/607378030207176/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çŸ¥è¯†æµ…è°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-05T00:58:10.000Z" title="Mon Jan 05 2026 00:58:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-05
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä»Šå¤©ï¼Œæˆ‘å°†æ‰‹æŠŠæ‰‹æ•™ä½ ä¸€ä¸ª**â€œç»ˆæéšç§ä¿æŠ¤â€<strong>æŠ€å·§ï¼šåªéœ€è´­ä¹°ä¸€ä¸ªä¾¿å®œçš„åŸŸåï¼ˆæ¯å¹´ä¸€æ¯å¥¶èŒ¶é’±ï¼‰ï¼Œé…åˆ Cloudflare å¼ºå¤§çš„å…è´¹åŠŸèƒ½ï¼Œä½ å°±èƒ½æ‹¥æœ‰</strong>æ— é™ä¸ª**å±äºè‡ªå·±çš„é‚®ç®±åœ°å€ã€‚</p>
<p><strong>æ ¸å¿ƒåŸç†ï¼š</strong> åŸŸåæ³¨å†Œ (è…¾è®¯äº‘) + DNS è§£æ (Cloudflare) + é‚®ä»¶è·¯ç”± (Cloudflare Email Routing)</p>
<hr/>
<h2 data-id="heading-0">å‡†å¤‡å·¥ä½œ</h2>
<ol>
<li><strong>çº¦ 10-30 å…ƒäººæ°‘å¸</strong>ï¼ˆç”¨äºè´­ä¹°åŸŸåçš„é¦–å¹´è´¹ç”¨ï¼‰ã€‚</li>
<li>ä¸€ä¸ª <strong>è…¾è®¯äº‘</strong> æˆ–è€…å…¶ä»–äº‘è´¦å·ï¼ˆç”¨äºè´­ä¹°åŸŸåï¼‰ã€‚</li>
<li>ä¸€ä¸ª <strong>Cloudflare</strong> è´¦å·ï¼ˆç”¨äºç®¡ç†åŸŸåå’Œé‚®ä»¶è½¬å‘ï¼‰ã€‚</li>
<li>ä¸€ä¸ªä½ å¸¸ç”¨çš„<strong>ä¸»é‚®ç®±</strong>ï¼ˆå¦‚ Gmail, QQ, Outlookï¼Œä½œä¸ºæœ€ç»ˆæ¥æ”¶é‚®ä»¶çš„æ”¶ä»¶ç®±ï¼‰ã€‚</li>
</ol>
<hr/>
<h2 data-id="heading-1">ç¬¬ä¸€æ­¥ï¼šåœ¨è…¾è®¯äº‘æ³¨å†ŒåŸŸå</h2>
<p>è…¾è®¯äº‘ï¼ˆDNSPodï¼‰æ˜¯å›½å†…ä¸»æµçš„åŸŸåæ³¨å†Œå•†ï¼Œæ”¯ä»˜æ–¹ä¾¿ä¸”ç®¡ç†ç•Œé¢ä¸­æ–‡å‹å¥½ã€‚</p>
<ol>
<li><strong>æœç´¢åŸŸå</strong>ï¼šç™»å½•è…¾è®¯äº‘å®˜ç½‘ï¼Œè¿›å…¥â€œåŸŸåæ³¨å†Œâ€é¡µé¢ã€‚</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5c3be15cb2648f4be616099f80abbb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=NcInqWjo3qOZc4ImEB%2FmRRmzKJM%3D" alt="" loading="lazy"/></p>
<ol start="2">
<li><strong>æŒ‘é€‰åç¼€</strong>ï¼šå¦‚æœä½ åªæ˜¯ä¸ºäº†æ”¶é‚®ä»¶ï¼Œä¸éœ€è¦ä¹°æ˜‚è´µçš„ <code>.com</code>ã€‚å¯ä»¥é€‰æ‹© <code>.xyz</code>, <code>.top</code>, <code>.site</code> æˆ– <code>.fun</code> ç­‰ä¾¿å®œçš„åç¼€ï¼Œé¦–å¹´é€šå¸¸åªéœ€å‡ å—é’±ã€‚</li>
<li><strong>è´­ä¹°å¹¶å®åè®¤è¯</strong>ï¼šæŒ‰ç…§æµç¨‹æ”¯ä»˜ï¼Œå¹¶å®ŒæˆåŸŸåçš„å®åè®¤è¯ï¼ˆè¿™æ˜¯å›½å†…æ³¨å†ŒåŸŸåçš„å¿…é¡»æ­¥éª¤ï¼Œé€šå¸¸éœ€è¦ä¸Šä¼ èº«ä»½è¯ï¼‰ã€‚</li>
</ol>
<blockquote>
<p><strong>ğŸ’¡ æç¤ºï¼š</strong> è´­ä¹°å®Œæˆåï¼Œè¯·è¿›å…¥è…¾è®¯äº‘çš„â€œåŸŸåç®¡ç†â€æ§åˆ¶å°ï¼Œç¡®è®¤åŸŸåçŠ¶æ€ä¸ºâ€œæ­£å¸¸â€ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">ç¬¬äºŒæ­¥ï¼šå°†åŸŸåâ€œæ‰˜ç®¡â€åˆ° Cloudflare</h2>
<p>ä¸ºäº†ä½¿ç”¨ Cloudflare çš„å…è´¹é‚®ä»¶è·¯ç”±åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦å°†åŸŸåçš„ DNS è§£ææƒä»è…¾è®¯äº‘ç§»äº¤ç»™ Cloudflareã€‚</p>
<ol>
<li><strong>æ·»åŠ ç«™ç‚¹</strong>ï¼š</li>
</ol>
<ul>
<li>ç™»å½• <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cloudflare.com%2F" target="_blank" title="https://www.cloudflare.com/" ref="nofollow noopener noreferrer">Cloudflare å®˜ç½‘</a>ã€‚</li>
<li>ç‚¹å‡»å³ä¸Šè§’çš„ <strong>"Add a site" (æ·»åŠ ç«™ç‚¹)</strong>ã€‚</li>
<li>è¾“å…¥ä½ åˆšæ‰åœ¨è…¾è®¯äº‘ä¹°çš„åŸŸåï¼ˆä¾‹å¦‚ <code>mycoolmail.xyz</code>ï¼‰ï¼Œç‚¹å‡»ç»§ç»­ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be5bebc87dfb4da6ad3abdf9afee2057~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=%2F7HwL2AhHPLxs5oIetJzwQuauxs%3D" alt="" loading="lazy"/></li>
</ul>
<ol start="2">
<li><strong>é€‰æ‹©å¥—é¤</strong>ï¼š</li>
</ol>
<ul>
<li>é¡µé¢ä¼šå±•ç¤ºå„ç§ä»˜è´¹å¥—é¤ï¼Œè¯·<strong>å‘ä¸‹æ»‘åŠ¨</strong>ï¼Œæ‰¾åˆ°åº•éƒ¨çš„ <strong>"Free" (å…è´¹ç‰ˆ)</strong> å¥—é¤æ¡†ï¼Œç‚¹å‡»é€‰æ‹©å¹¶ç»§ç»­ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b6401f4fbab48e6b085c9afa9600a35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=5aseRBZ5KH8lf2bymUjGyhcmGsY%3D" alt="" loading="lazy"/></li>
</ul>
<ol start="3">
<li><strong>è·å– Nameservers (åç§°æœåŠ¡å™¨)</strong>ï¼š</li>
</ol>
<ul>
<li>Cloudflare ä¼šæ‰«æä½ å½“å‰çš„ DNS è®°å½•ï¼Œç›´æ¥ç‚¹å‡»ç»§ç»­ã€‚</li>
<li><strong>å…³é”®æ­¥éª¤</strong>ï¼šCloudflare ä¼šç»™å‡ºä¸¤ä¸ª Nameserver åœ°å€ï¼Œé€šå¸¸æ ¼å¼ä¸º <code>xxxx.ns.cloudflare.com</code>ã€‚è¯·<strong>å¤åˆ¶è¿™ä¸¤ä¸ªåœ°å€</strong>ã€‚</li>
</ul>
<ol start="4">
<li><strong>ä¿®æ”¹è…¾è®¯äº‘ DNS</strong>ï¼š</li>
</ol>
<ul>
<li>
<p>å›åˆ°è…¾è®¯äº‘åŸŸåæ§åˆ¶å°ï¼Œæ‰¾åˆ°ä½ çš„åŸŸåï¼Œç‚¹å‡» <strong>â€œDNS ç®¡ç†â€</strong>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6523a9edf97c4908b7d6a1383ee25bdd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=sdI%2FnvfFGyYpWYI1LZitfhJv9G0%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p>ç‚¹å‡»ä¿®æ”¹DNSæœåŠ¡å™¨
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27b5be67ea61406b9bfbe359d3aadca1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=vONW27f%2BdJiF4eFscI70wBpJp4k%3D" alt="" loading="lazy"/></p>
</li>
<li>
<p>å°†é»˜è®¤çš„è…¾è®¯äº‘ DNS åœ°å€ï¼ˆå¦‚ <code>ns1.dnspod.net</code>ï¼‰åˆ é™¤ï¼Œé€‰æ‹©ä½¿ç”¨éè…¾è®¯äº‘DNS</p>
</li>
<li>
<p><strong>ç²˜è´´</strong> åˆšæ‰ä» Cloudflare å¤åˆ¶çš„é‚£ä¸¤ä¸ªåœ°å€ã€‚</p>
</li>
<li>
<p>ä¿å­˜è®¾ç½®ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4ae8b63e4ff4d06a3a6da1a97137e1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=ny60mQR%2BBL0cvhcDZpCFVwQkrYs%3D" alt="" loading="lazy"/></p>
</li>
</ul>
<blockquote>
<p><strong>â³ æ³¨æ„ï¼š</strong> DNS ä¿®æ”¹ç”Ÿæ•ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿåˆ°å‡ å°æ—¶ã€‚åœ¨ Cloudflare é¡µé¢ç‚¹å‡» "Check nameservers"ï¼Œå½“çœ‹åˆ°ç»¿è‰²çš„ "Active" çŠ¶æ€æ—¶ï¼Œè¯´æ˜ç»‘å®šæˆåŠŸï¼</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">ç¬¬ä¸‰æ­¥ï¼šé…ç½® Cloudflare é‚®ä»¶è·¯ç”± (Email Routing)</h2>
<p>è¿™æ˜¯æœ€ç¥å¥‡çš„ä¸€æ­¥ï¼Œé…ç½®å®Œå…¨å…è´¹ä¸”éå¸¸ç®€å•ã€‚</p>
<ol>
<li><strong>å¯ç”¨åŠŸèƒ½</strong>ï¼š</li>
</ol>
<ul>
<li>åœ¨ Cloudflare å·¦ä¾§èœå•æ ï¼Œæ‰¾åˆ° <strong>"Email" (ç”µå­é‚®ä»¶)</strong> -&gt; <strong>"Email Routing" (é‚®ä»¶è·¯ç”±)</strong>ã€‚</li>
<li>ç‚¹å‡» <strong>"Get Started"</strong> æŒ‰é’®ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/766723283d0b4b39a20b68376e33e04b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=sJEIifvNKPGEaG1jEr2u3W8NDuQ%3D" alt="" loading="lazy"/></li>
</ul>
<ol start="2">
<li><strong>è®¾ç½®ç›®æ ‡é‚®ç®±</strong>ï¼š</li>
</ol>
<ul>
<li>åœ¨ <strong>"Destination address" (ç›®æ ‡åœ°å€)</strong> ä¸­ï¼Œå¡«å…¥ä½ å¹³æ—¶ç”¨çš„ä¸»é‚®ç®±ï¼ˆæ¯”å¦‚ä½ çš„ QQ é‚®ç®±æˆ– Gmailï¼‰ã€‚</li>
<li>Cloudflare ä¼šå‘é€ä¸€å°éªŒè¯é‚®ä»¶åˆ°ä½ çš„ä¸»é‚®ç®±ï¼Œå»ç‚¹å‡»é‚®ä»¶ä¸­çš„éªŒè¯é“¾æ¥ï¼Œ<strong>è¿™ä¸€æ­¥ä¸ä¸€å®šæœ‰</strong>ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a452cfbb7b8d41d18b31d39750794173~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=tc6TV3kaO%2BlRO%2BfSOT3dXxnl9rE%3D" alt="" loading="lazy"/></li>
</ul>
<ol start="3">
<li><strong>è‡ªåŠ¨æ·»åŠ  DNS è®°å½•</strong>ï¼š</li>
</ol>
<ul>
<li>éªŒè¯æˆåŠŸåï¼Œå›åˆ° Cloudflare é¡µé¢ã€‚ç³»ç»Ÿä¼šæç¤ºä½ ç¼ºå°‘å¿…è¦çš„ MX å’Œ SPF è®°å½•,<strong>ç³»ç»Ÿæç¤ºçš„æ—¶å€™è¦ç‚¹å‡»ç¡®è®¤</strong>ã€‚</li>
<li>ç‚¹å‡» <strong>"Add records and enable" (æ·»åŠ è®°å½•å¹¶å¯ç”¨)</strong>ã€‚Cloudflare ä¼šè‡ªåŠ¨å¸®ä½ é…ç½®å¥½æ‰€æœ‰å¤æ‚çš„å‚æ•°ï¼Œæ— éœ€æ‰‹åŠ¨å¡«å†™ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-4">ç¬¬å››æ­¥ï¼šå¼€å¯â€œæ— é™é‚®ç®±â€æ¨¡å¼</h2>
<p>ç°åœ¨é€šè¿‡éªŒè¯åï¼Œä½ æœ‰ä¸¤ç§æ–¹å¼æ¥åˆ›å»ºé‚®ç®±ã€‚</p>
<h3 data-id="heading-5">æ–¹å¼ä¸€ï¼šåˆ›å»ºå›ºå®šåˆ«å (Custom Addresses)</h3>
<p>é€‚åˆå›ºå®šç”¨é€”ã€‚æ¯”å¦‚ä½ è¦æ³¨å†Œ Netflixï¼Œä½ å¯ä»¥ä¸“é—¨åˆ›å»ºä¸€ä¸ªï¼š</p>
<ul>
<li><strong>Custom address:</strong> <code>netflix</code> (@[å¯ç–‘é“¾æ¥å·²åˆ é™¤])</li>
<li><strong>Destination:</strong> ä½ çš„ä¸»é‚®ç®±</li>
<li>ç‚¹å‡»ä¿å­˜ã€‚ä»¥åæ‰€æœ‰å‘ç»™ <code>netflix@yourdomain.com</code> çš„é‚®ä»¶éƒ½ä¼šèººåœ¨ä½ çš„ä¸»é‚®ç®±é‡Œã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a17e3c41949d4800bc26e8a698bf2716~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=8wNqytN9AyXQ3oGfuwPQppMbs0A%3D" alt="" loading="lazy"/></li>
</ul>
<h3 data-id="heading-6">æ–¹å¼äºŒ:å¼€å¯Catch-All(æ¥æ”¶æ‰€æœ‰é‚®ä»¶)æ¨è ğŸ”¥</h3>
<p>è¿™æ˜¯å®ç°â€œæ— é™â€çš„å…³é”®ã€‚å¼€å¯è¿™ä¸ªåŠŸèƒ½åï¼Œ<strong>ä»»ä½•</strong>å‘å¾€ä½ åŸŸåçš„é‚®ä»¶ï¼Œå“ªæ€•å‰ç¼€æ˜¯ä½ åˆšæ‰ä¸´æ—¶çç¼–çš„ï¼Œéƒ½ä¼šè¢«è½¬å‘ã€‚</p>
<ol>
<li>åœ¨ Email Routing é¡µé¢ï¼Œç‚¹å‡» <strong>"Settings" (è®¾ç½®)</strong> æ ‡ç­¾ã€‚</li>
<li>æ‰¾åˆ° <strong>"Catch-All address"</strong> é€‰é¡¹ã€‚</li>
<li>ç‚¹å‡» <strong>"Edit"</strong>ï¼ŒçŠ¶æ€æ”¹ä¸º <strong>"Active"</strong>ï¼Œå¹¶é€šè¿‡ "Action" é€‰æ‹© "Send to"ï¼Œç›®æ ‡å¡«å…¥ä½ çš„ä¸»é‚®ç®±ã€‚</li>
<li>ä¿å­˜ã€‚
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d34408cede3d4e23bc06451031c342b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-l6K-G5rWF6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1768179490&amp;x-signature=Aby92g%2FueH9UtHPOVPNOGKBH06c%3D" alt="" loading="lazy"/></li>
</ol>
<p><strong>ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹ï¼š</strong>
å½“ä½ å»ä¸€å®¶åä¸º "ABCä¹¦åº—" çš„ç½‘ç«™æ³¨å†Œæ—¶ï¼Œç›´æ¥å¡« <code>abcbook@yourdomain.com</code>ã€‚</p>
<ul>
<li><strong>æ— éœ€è®¾ç½®ï¼š</strong> ä½ ä¸éœ€è¦å…ˆå» Cloudflare åå°åˆ›å»ºè¿™ä¸ªåœ°å€ï¼Œç›´æ¥å¡«ï¼Œç›´æ¥æ”¶ã€‚</li>
<li><strong>è¿½è¸ªæ³„éœ²ï¼š</strong> å¦‚æœä»¥åä½ æ”¶åˆ°åƒåœ¾é‚®ä»¶ï¼Œå‘ç°æ”¶ä»¶äººæ˜¯ <code>abcbook@yourdomain.com</code>ï¼Œä½ å°±çŸ¥é“æ˜¯è¿™å®¶ä¹¦åº—æ³„éœ²äº†ä½ çš„ä¿¡æ¯ï¼</li>
</ul>
<hr/>
<h2 data-id="heading-7">æ€»ç»“</h2>
<p>ç°åœ¨ï¼Œä½ å·²ç»æˆåŠŸæ‹¥æœ‰äº†ä¸€ä¸ªå±äºè‡ªå·±çš„ä¼ä¸šçº§åŸŸåé‚®ç®±ç³»ç»Ÿã€‚</p>
<ul>
<li><strong>æˆæœ¬ï¼š</strong> ä»…åŸŸåè´¹ï¼ˆå‡ åå…ƒ/å¹´ï¼‰ã€‚</li>
<li><strong>æ”¶ç›Šï¼š</strong> æ— é™ä¸ªé‚®ç®±è´¦å·ï¼Œå®Œç¾çš„éšç§éš”ç¦»ï¼Œçœ‹èµ·æ¥éå¸¸ä¸“ä¸šçš„ä¸ªäººå½¢è±¡ã€‚</li>
<li><strong>æ³¨æ„ï¼š</strong> ç›®å‰è¯¥æ–¹æ³•ä¸»è¦ç”¨äº<strong>æ¥æ”¶</strong>é‚®ä»¶ã€‚å¦‚æœéœ€è¦ç”¨è¿™äº›åŸŸåé‚®ç®±<strong>å‘é€</strong>é‚®ä»¶ï¼Œé€šå¸¸éœ€è¦é…åˆ Gmail çš„ SMTP åŠŸèƒ½ï¼ˆè®¾ç½®ç¨å¤æ‚ï¼‰ã€‚</li>
</ul>
<p>å¿«å»è¯•è¯•å§,å¥½å¤šç½‘ç«™éœ€è¦é‚®ç®±æ³¨å†Œçš„å¯ä»¥éšä¾¿æ³¨å†Œäº†ï¼Œæ‡‚å¾—éƒ½æ‡‚ğŸ˜</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åç«¯åˆ†å±‚æ¶æ„è§„èŒƒå’Œæ ‡å‡†åŒ…ç»“æ„]]></title>    <link>https://juejin.cn/post/7591350620189048838</link>    <guid>https://juejin.cn/post/7591350620189048838</guid>    <pubDate>2026-01-04T16:36:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7591350620189048838" data-draft-id="7587284708943134754" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åç«¯åˆ†å±‚æ¶æ„è§„èŒƒå’Œæ ‡å‡†åŒ…ç»“æ„"/> <meta itemprop="keywords" content="åç«¯,Java"/> <meta itemprop="datePublished" content="2026-01-04T16:36:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸€çº¿å¤§ç "/> <meta itemprop="url" content="https://juejin.cn/user/3280598429340984"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åç«¯åˆ†å±‚æ¶æ„è§„èŒƒå’Œæ ‡å‡†åŒ…ç»“æ„
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3280598429340984/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸€çº¿å¤§ç 
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-04T16:36:37.000Z" title="Sun Jan 04 2026 16:36:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-04
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">1. åç«¯åˆ†å±‚æ¶æ„è§„èŒƒ</h2>
<blockquote>
<p><strong>ç›®æ ‡</strong><br/>
åœ¨çœŸå®å¤æ‚ä¸šåŠ¡ä¸‹ï¼Œä¿æŒä¾èµ–æ–¹å‘æ¸…æ™°ï¼Œé¿å… Service äº’ç›¸çº ç¼ ï¼Œä¿è¯ç³»ç»Ÿå¯é•¿æœŸæ¼”è¿›ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">1.1. åˆ†å±‚æ€»è§ˆï¼ˆå¿…é¡»éµå®ˆï¼‰</h3>
<pre><code class="hljs language-java" lang="java">Controller
    â†“
Service / Facadeï¼ˆä¸šåŠ¡ä¸»ä½“ / æµç¨‹ç¼–æ’ï¼‰
    â†“
Queryï¼ˆåªè¯»æŸ¥è¯¢æ¨¡å‹ï¼Œå…è®¸ JOINï¼‰
    â†“
Daoï¼ˆå•è¡¨æŒä¹…åŒ–ï¼‰
    â†“
Table
</code></pre>
<p><strong>ä¾èµ–åªèƒ½è‡ªä¸Šè€Œä¸‹ï¼Œç¦æ­¢åå‘ã€‚</strong></p>
<h3 data-id="heading-2">1.2. æ ¸å¿ƒæ¦‚å¿µå®šä¹‰ï¼ˆç»Ÿä¸€å£å¾„ï¼‰</h3>
<h4 data-id="heading-3">1.2.1. ä¸šåŠ¡ä¸»ä½“ï¼ˆDomain Entityï¼‰</h4>
<p>å…·æœ‰ç‹¬ç«‹ä¸šåŠ¡è¯­ä¹‰å’Œç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>ç”¨æˆ·ã€è®¢å•ã€åº“å­˜ã€è´¦æˆ·ã€å•†å“</li>
</ul>
<p><strong>ä¸€ä¸ªä¸šåŠ¡ä¸»ä½“ = ä¸€ä¸ª Service</strong></p>
<h4 data-id="heading-4">1.2.2. é™„å±è¡¨ï¼ˆé™„å±/æŠ€æœ¯æ€§æ•°æ®ï¼‰</h4>
<p>ä¸å…·å¤‡ç‹¬ç«‹ä¸šåŠ¡è¯­ä¹‰ï¼Œä»…æœåŠ¡äºæŸä¸€ä¸»ä½“ï¼š</p>
<ul>
<li>æ—¥å¿—ã€æµæ°´ã€å†å²è¡¨ã€å¿«ç…§ã€å®¡è®¡è¡¨</li>
</ul>
<p><strong>å¯ä»¥ç”±ä¸»ä½“ Service ç›´æ¥æ“ä½œ</strong></p>
<h4 data-id="heading-5">1.2.3. è·¨ä¸»ä½“æµç¨‹</h4>
<p>æ¶‰åŠ <strong>ä¸¤ä¸ªåŠä»¥ä¸Šä¸šåŠ¡ä¸»ä½“</strong> çš„å†™æ“ä½œï¼š</p>
<ul>
<li>ä¸‹å•æ‰£åº“å­˜</li>
<li>è®¢å• + æ”¯ä»˜</li>
<li>ç”¨æˆ· + è´¦æˆ·åˆå§‹åŒ–</li>
</ul>
<p><strong>å¿…é¡»ä¸Šç§»åˆ° Facade / Flow Service</strong></p>
<h3 data-id="heading-6">1.3. å„å±‚èŒè´£ä¸ç¡¬è§„åˆ™</h3>
<h4 data-id="heading-7">1.3.1. Controller å±‚ï¼ˆå…¥å£å±‚ï¼‰</h4>
<p><strong>èŒè´£</strong></p>
<ul>
<li>å‚æ•°æ ¡éªŒ</li>
<li>æƒé™æ ¡éªŒ</li>
<li>è°ƒç”¨ Service / Facade</li>
</ul>
<p><strong>ç¦æ­¢</strong></p>
<ul>
<li>âŒ å†™ä¸šåŠ¡é€»è¾‘</li>
<li>âŒ è®¿é—® Dao / Query</li>
<li>âŒ Controller äº’è°ƒ</li>
</ul>
<h4 data-id="heading-8">1.3.2. Service å±‚ï¼ˆä¸šåŠ¡ä¸»ä½“å±‚ï¼‰</h4>
<p><strong>èŒè´£</strong></p>
<ul>
<li>æœ¬ä¸šåŠ¡ä¸»ä½“çš„ä¸šåŠ¡è§„åˆ™</li>
<li>çŠ¶æ€å˜æ›´</li>
<li>æ“ä½œæœ¬ä¸»ä½“è¡¨åŠå…¶é™„å±è¡¨</li>
</ul>
<p><strong>å…è®¸</strong></p>
<ul>
<li>âœ… å†™ï¼šæœ¬ä¸»ä½“ Dao</li>
<li>âœ… å†™ï¼šæœ¬ä¸»ä½“é™„å±è¡¨ Daoï¼ˆæ—¥å¿— / æµæ°´ï¼‰</li>
<li>âœ… è¯»ï¼šQueryï¼ˆç”¨äºæ ¡éªŒ / å±•ç¤º / è®¡ç®—ï¼‰</li>
</ul>
<p><strong>ç¦æ­¢</strong></p>
<ul>
<li>âŒ å†™å…¶ä»–ä¸šåŠ¡ä¸»ä½“è¡¨</li>
<li>âŒ è°ƒç”¨å…¶ä»–ä¸šåŠ¡ä¸»ä½“ Service</li>
<li>âŒ ç¼–å†™ JOIN SQL</li>
</ul>
<blockquote>
<p><strong>åˆ¤æ–­å£è¯€</strong><br/>
â€œå¦‚æœåˆ æ‰å¦ä¸€ä¸ªä¸šåŠ¡ä¸»ä½“ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å¦ä»æˆç«‹ï¼Ÿâ€</p>
<ul>
<li>æ˜¯ â†’ ç•™åœ¨æœ¬ Service</li>
<li>å¦ â†’ ä¸Šç§» Facade</li>
</ul>
</blockquote>
<h4 data-id="heading-9">1.3.3. Facade / Flow Serviceï¼ˆæµç¨‹ç¼–æ’å±‚ï¼‰</h4>
<p><strong>èŒè´£</strong></p>
<ul>
<li>è·¨ä¸šåŠ¡ä¸»ä½“æµç¨‹</li>
<li>è°ƒç”¨é¡ºåº</li>
<li>äº‹åŠ¡è¾¹ç•Œ</li>
<li>å¼‚å¸¸ä¸å¤±è´¥å¤„ç†</li>
</ul>
<p><strong>å…è®¸</strong></p>
<ul>
<li>âœ… è°ƒç”¨å¤šä¸ª Service</li>
<li>âœ… ç®¡ç†äº‹åŠ¡</li>
</ul>
<p><strong>ç¦æ­¢</strong></p>
<ul>
<li>âŒ ç›´æ¥è®¿é—® Dao</li>
<li>âŒ ç¼–å†™ SQL</li>
<li>âŒ å®ç°é¢†åŸŸç»†èŠ‚è§„åˆ™</li>
</ul>
<h4 data-id="heading-10">1.3.4. Query å±‚ï¼ˆåªè¯»æ¨¡å‹ï¼ŒJOIN ä¸»è¦å½’å±ï¼‰</h4>
<p><strong>èŒè´£</strong></p>
<ul>
<li>å¤šè¡¨æŸ¥è¯¢</li>
<li>åˆ—è¡¨ / è¯¦æƒ… / ç»Ÿè®¡ / æŠ¥è¡¨</li>
<li>æ€§èƒ½ä¼˜åŒ–æŸ¥è¯¢</li>
</ul>
<p><strong>å…è®¸</strong></p>
<ul>
<li>âœ… JOIN å¤šè¡¨</li>
<li>âœ… è·¨ä¸šåŠ¡ä¸»ä½“</li>
<li>âœ… è¿”å› DTO / View Object</li>
</ul>
<p><strong>ç¦æ­¢</strong></p>
<ul>
<li>âŒ å†™æ“ä½œï¼ˆINSERT / UPDATE / DELETEï¼‰</li>
<li>âŒ æ‰¿è½½ä¸šåŠ¡è§„åˆ™</li>
<li>âŒ ä¿®æ”¹ä¸šåŠ¡çŠ¶æ€</li>
</ul>
<p><strong>å‘½åå»ºè®®</strong></p>
<ul>
<li><code>XxxOnlyQuery</code></li>
<li><code>XxxReadModel</code></li>
<li><code>XxxQueryRepository</code></li>
</ul>
<h4 data-id="heading-11">1.3.5. Dao å±‚ï¼ˆæŒä¹…åŒ–å±‚ï¼‰</h4>
<p><strong>èŒè´£</strong></p>
<ul>
<li>å•è¡¨ CRUD</li>
<li>ä¸è¡¨ç»“æ„ä¸€ä¸€å¯¹åº”</li>
</ul>
<p><strong>è§„åˆ™</strong></p>
<ul>
<li>âŒ ä¸å…è®¸ JOIN å¤šä¸ªä¸šåŠ¡ä¸»ä½“è¡¨</li>
<li>âŒ ä¸æ‰¿è½½ä¸šåŠ¡è¯­ä¹‰</li>
<li>âŒ ä¸è¢«è·¨ä¸šåŠ¡ä¸»ä½“å¤ç”¨</li>
</ul>
<h3 data-id="heading-12">1.4. JOIN SQL æ”¾ç½®è§„åˆ™ï¼ˆå¼ºåˆ¶æ‰§è¡Œï¼‰</h3>
<p><strong>ä¸€å¥è¯è§„åˆ™ï¼ˆå†™åœ¨ Code Review æ ‡å‡†é‡Œï¼‰</strong></p>
<blockquote>
<p><strong>å‡¡æ˜¯ JOIN äº†å¤šä¸ªä¸šåŠ¡ä¸»ä½“çš„ SQLï¼Œä¸€å¾‹ä¸è¿›ä¸»ä½“ Daoã€‚</strong></p>
</blockquote>
<h4 data-id="heading-13">1.4.1. JOIN SQL å†³ç­–è¡¨ï¼ˆå¿…é¡»æŒ‰é¡ºåºåˆ¤æ–­ï¼‰</h4>
<p><strong>â“1ï¸âƒ£ æ˜¯å¦è·¨å¤šä¸ªä¸šåŠ¡ä¸»ä½“ï¼Ÿ</strong></p>
<ul>
<li>æ˜¯ â†’ <strong>Query</strong></li>
<li>å¦ â†’ ç»§ç»­</li>
</ul>
<p><strong>â“2ï¸âƒ£ æ˜¯å¦åªè¯»ï¼Ÿ</strong></p>
<ul>
<li>æ˜¯ â†’ <strong>Query</strong></li>
<li>å¦ â†’ âŒ æ‹†ä¸º Service è°ƒç”¨ï¼ˆç¦æ­¢ JOIN å†™ï¼‰</li>
</ul>
<p><strong>â“3ï¸âƒ£ æ˜¯å¦æ‰¿è½½ä¸šåŠ¡è§„åˆ™ï¼Ÿ</strong></p>
<ul>
<li>æ˜¯ â†’ âŒ ä¸å…è®¸ï¼ˆå› Serviceï¼‰</li>
<li>å¦ â†’ <strong>Query</strong></li>
</ul>
<h4 data-id="heading-14">1.4.2. å…è®¸æ”¾åœ¨ä¸»ä½“ Dao çš„å”¯ä¸€ä¾‹å¤–</h4>
<p><strong>åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰æ¡ä»¶ï¼š</strong></p>
<ul>
<li>
<p>JOIN çš„è¡¨å…¨éƒ¨å±äº <strong>åŒä¸€ä¸šåŠ¡ä¸»ä½“</strong></p>
</li>
<li>
<p>å…³è”çš„æ˜¯ï¼š</p>
<ul>
<li>æ˜ç»†è¡¨</li>
<li>æ—¥å¿—è¡¨</li>
<li>å¿«ç…§è¡¨</li>
</ul>
</li>
<li>
<p>SQL ä¸å½±å“å…¶ä»–ä¸»ä½“å†³ç­–</p>
</li>
</ul>
<p>âœ… ç¤ºä¾‹ï¼ˆå…è®¸ï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java">OrderDao.findOrderWithItems()
-- Order + OrderItem
</code></pre>
<p>âŒ ç¤ºä¾‹ï¼ˆç¦æ­¢ï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java">OrderDao.findOrderWithUser()
OrderDao.joinStock()
</code></pre>
<h3 data-id="heading-15">1.5. æœ€å®¹æ˜“çŠ¯é”™çš„ 3 ç§æƒ…å†µï¼ˆå¿…é¡»é¿å…ï¼‰</h3>
<h4 data-id="heading-16">1.5.1. åœ¨ Service / Dao ä¸­å†™è·¨ä¸»ä½“ JOIN</h4>
<pre><code class="hljs language-java" lang="java">UPDATE order o
JOIN stock s ...
</code></pre>
<h4 data-id="heading-17">1.5.2. ä¸ºäº†â€œåªæ˜¯æŸ¥ä¸€ä¸‹â€ï¼Œç›´æ¥è·¨ä¸»ä½“ Dao</h4>
<pre><code class="hljs language-java" lang="java">orderService â†’ userDao
</code></pre>
<h4 data-id="heading-18">1.5.3. ç»Ÿè®¡ / æŠ¥è¡¨å¤ç”¨ä¸šåŠ¡ Dao</h4>
<pre><code class="hljs language-java" lang="java">statisticsService â†’ orderDao
</code></pre>
<h3 data-id="heading-19">1.6. å¿«é€Ÿå†³ç­–è¡¨ï¼ˆå†™ä»£ç å‰ 10 ç§’ï¼‰</h3>





























<table><thead><tr><th>åœºæ™¯</th><th>æ”¾ç½®ä½ç½®</th></tr></thead><tbody><tr><td>å•ä¸»ä½“ä¸šåŠ¡å†™</td><td>å¯¹åº” Service</td></tr><tr><td>å¤šä¸»ä½“ä¸šåŠ¡å†™</td><td>Facade / Flow Service</td></tr><tr><td>å¤šè¡¨ JOIN æŸ¥è¯¢</td><td>Query</td></tr><tr><td>æ—¥å¿— / æµæ°´</td><td>ä¸»ä½“ Service</td></tr><tr><td>æŠ¥è¡¨ / ç»Ÿè®¡</td><td>StatisticsService + Query</td></tr></tbody></table>
<h3 data-id="heading-20">1.7. å›¢é˜Ÿå…±è¯†ï¼ˆå¼ºçƒˆå»ºè®®è´´å¢™ï¼‰</h3>
<blockquote>
<p><strong>ä¸è¦æŒ‰â€œè¡¨â€æ‹† Serviceï¼Œè¦æŒ‰â€œä¸šåŠ¡ä¸»ä½“â€æ‹† Serviceã€‚</strong></p>
<p><strong>ä¸è¦ä¸ºäº† JOIN æ–¹ä¾¿ï¼ŒæŠŠæŸ¥è¯¢å¡è¿›ä¸»ä½“ Daoã€‚</strong></p>
</blockquote>
<h2 data-id="heading-21">2. æ ‡å‡†åŒ…ç»“æ„</h2>
<p>ä¸‹é¢æ˜¯ä¸€ä»½æŒ‰<strong>çœŸå®ä¸­å¤§å‹ Java / Spring é¡¹ç›®</strong>æ•´ç†çš„ï¼Œä¸æ˜¯æ•™å­¦ Demoã€‚</p>
<blockquote>
<p>ç›®æ ‡ï¼š</p>
<ul>
<li>ä¸€çœ¼èƒ½çœ‹æ‡‚åˆ†å±‚</li>
<li>æ–°äººä¸å®¹æ˜“å†™é”™</li>
<li>Code Review æ—¶â€œçœ‹è·¯å¾„å°±èƒ½å‘ç°é—®é¢˜â€</li>
</ul>
</blockquote>
<p>æ ‡å‡†åŒ…ç»“æ„ç¤ºä¾‹ï¼ˆå¯ç›´æ¥ç…§æŠ„ï¼‰</p>
<blockquote>
<p>ç¤ºä¾‹ä»¥ <strong>è®¢å• + ç”¨æˆ· + åº“å­˜</strong> åœºæ™¯ä¸ºä¾‹<br/>
åŒ…åä½ å¯ä»¥æ¢ï¼Œå…¬å¸åä¸é‡è¦</p>
</blockquote>
<pre><code class="hljs language-java" lang="java">com.xxx.project
</code></pre>
<h3 data-id="heading-22">2.1. æ•´ä½“ç»“æ„æ€»è§ˆï¼ˆå…ˆçœ‹å…¨è²Œï¼‰</h3>
<pre><code class="hljs language-java" lang="java">com.xxx.project
â”œâ”€ controller
â”œâ”€ application        <span class="hljs-comment">// Facade / æµç¨‹ç¼–æ’</span>
â”œâ”€ domain             <span class="hljs-comment">// ä¸šåŠ¡ä¸»ä½“</span>
â”‚   â”œâ”€ order
â”‚   â”œâ”€ user
â”‚   â””â”€ stock
â”œâ”€ query               <span class="hljs-comment">// åªè¯»æŸ¥è¯¢æ¨¡å‹ï¼ˆJOIN ä¸»è¦åœ¨è¿™ï¼‰</span>
â”œâ”€ statistics          <span class="hljs-comment">// ç»Ÿè®¡ / æŠ¥è¡¨</span>
â”œâ”€ infrastructure      <span class="hljs-comment">// åŸºç¡€è®¾æ–½ï¼ˆDao / Mapper / MQ / Cacheï¼‰</span>
â””â”€ common
</code></pre>
<h3 data-id="heading-23">2.2. Controller å±‚ï¼ˆå…¥å£ï¼‰</h3>
<pre><code class="hljs language-java" lang="java">controller
â”œâ”€ OrderController.java
â”œâ”€ UserController.java
â”œâ”€ StockController.java
â”œâ”€ OrderStockController.java     <span class="hljs-comment">// å¯¹åº” Facade</span>
â””â”€ StatisticsController.java
</code></pre>
<p><strong>è§„åˆ™</strong></p>
<ul>
<li>
<p>Controller åªä¾èµ–ï¼š</p>
<ul>
<li><code>domain.*.service</code></li>
<li><code>application.*</code></li>
</ul>
</li>
<li>
<p>âŒ ä¸å…è®¸å‡ºç° Dao / Query</p>
</li>
</ul>
<h3 data-id="heading-24">2.3. Application å±‚ï¼ˆFacade / Flow Serviceï¼‰</h3>
<blockquote>
<p><strong>æ‰€æœ‰â€œè·¨ä¸šåŠ¡ä¸»ä½“å†™â€çš„é€»è¾‘éƒ½åœ¨è¿™é‡Œ</strong></p>
</blockquote>
<pre><code class="hljs language-java" lang="java">application
â”œâ”€ orderstock
â”‚   â”œâ”€ OrderStockFacade.java
â”‚   â””â”€ OrderStockFacadeImpl.java
â””â”€ payment
    â”œâ”€ OrderPaymentFacade.java
    â””â”€ OrderPaymentFacadeImpl.java
</code></pre>
<p><strong>è§„åˆ™</strong></p>
<ul>
<li>
<p>åªåšï¼š</p>
<ul>
<li>è°ƒç”¨é¡ºåº</li>
<li>äº‹åŠ¡</li>
<li>å¤±è´¥å¤„ç†</li>
</ul>
</li>
<li>
<p>âŒ ä¸å†™ SQL</p>
</li>
<li>
<p>âŒ ä¸è®¿é—® Dao</p>
</li>
</ul>
<h3 data-id="heading-25">2.4. Domain å±‚ï¼ˆä¸šåŠ¡ä¸»ä½“ï¼Œæœ€æ ¸å¿ƒï¼‰</h3>
<h4 data-id="heading-26">2.4.1. Order é¢†åŸŸ</h4>
<pre><code class="hljs language-java" lang="java">domain/order
â”œâ”€ service
â”‚   â”œâ”€ OrderService.java
â”‚   â””â”€ OrderServiceImpl.java
â”œâ”€ model
â”‚   â”œâ”€ Order.java
â”‚   â””â”€ OrderStatus.java
â””â”€ event
    â””â”€ OrderCreatedEvent.java
</code></pre>
<p><strong>OrderService å¯ä»¥ï¼š</strong></p>
<ul>
<li>å†™ OrderDao</li>
<li>å†™ OrderLogDao</li>
<li>è¯» Query</li>
</ul>
<h4 data-id="heading-27">2.4.2. User é¢†åŸŸ</h4>
<pre><code class="hljs language-java" lang="java">domain/user
â”œâ”€ service
â”‚   â”œâ”€ UserService.java
â”‚   â””â”€ UserServiceImpl.java
â”œâ”€ model
â”‚   â””â”€ User.java
â””â”€ validator
    â””â”€ UserValidator.java
</code></pre>
<h4 data-id="heading-28">2.4.3. Stock é¢†åŸŸ</h4>
<pre><code class="hljs language-java" lang="java">domain/stock
â”œâ”€ service
â”‚   â”œâ”€ StockService.java
â”‚   â””â”€ StockServiceImpl.java
â”œâ”€ model
â”‚   â””â”€ Stock.java
â””â”€ policy
    â””â”€ StockDeductPolicy.java
</code></pre>
<h3 data-id="heading-29">2.5. Query å±‚ï¼ˆåªè¯»æ¨¡å‹ï¼ŒJOIN å…¨åœ¨è¿™é‡Œï¼‰</h3>
<blockquote>
<p><strong>è¿™æ˜¯æ¶æ„é‡Œæœ€å…³é”®çš„ä¸€å±‚</strong></p>
</blockquote>
<pre><code class="hljs language-java" lang="java">query
â”œâ”€ order
â”‚   â”œâ”€ OrderOnlyQuery.java
â”‚   â”œâ”€ OrderOnlyQueryImpl.java
â”‚   â””â”€ dto
â”‚       â””â”€ OrderView.java
â”œâ”€ orderlog
â”‚   â”œâ”€ OrderLogOnlyQuery.java
â”‚   â””â”€ OrderLogOnlyQueryImpl.java
â”œâ”€ user
â”‚   â”œâ”€ UserOnlyQuery.java
â”‚   â””â”€ UserOnlyQueryImpl.java
â””â”€ statistics
    â”œâ”€ OrderStatisticsQuery.java
    â””â”€ StatisticsView.java
</code></pre>
<p><strong>è§„åˆ™</strong></p>
<ul>
<li>âœ… å…è®¸ JOIN</li>
<li>âœ… å…è®¸è·¨ä¸»ä½“</li>
<li>âŒ ç¦æ­¢å†™æ“ä½œ</li>
<li>âŒ ç¦æ­¢ä¸šåŠ¡åˆ¤æ–­</li>
</ul>
<h3 data-id="heading-30">2.6. Statistics å±‚ï¼ˆæ¨ªå‘ç»Ÿè®¡ï¼‰</h3>
<pre><code class="hljs language-java" lang="java">statistics
â”œâ”€ StatisticsService.java
â””â”€ StatisticsServiceImpl.java
</code></pre>
<p><strong>ä¾èµ–æ–¹å‘</strong></p>
<pre><code class="hljs language-java" lang="java">StatisticsService
   â†“
Queryï¼ˆå¤šä¸ªï¼‰
</code></pre>
<p>âŒ ä¸å…è®¸ï¼š</p>
<ul>
<li>ç›´æ¥è®¿é—® Dao</li>
<li>è°ƒç”¨ Domain Service</li>
</ul>
<h3 data-id="heading-31">2.7. Infrastructure å±‚ï¼ˆDao / Mapperï¼‰</h3>
<pre><code class="hljs language-java" lang="java">infrastructure
â”œâ”€ dao
â”‚   â”œâ”€ order
â”‚   â”‚   â”œâ”€ OrderDao.java
â”‚   â”‚   â””â”€ OrderLogDao.java
â”‚   â”œâ”€ user
â”‚   â”‚   â””â”€ UserDao.java
â”‚   â””â”€ stock
â”‚       â””â”€ StockDao.java
â”œâ”€ mapper
â”‚   â””â”€ *.xml
â”œâ”€ cache
â”‚   â””â”€ RedisClient.java
â””â”€ mq
    â””â”€ MessageProducer.java
</code></pre>
<p><strong>è§„åˆ™</strong></p>
<ul>
<li>Dao = å•è¡¨</li>
<li>âŒ ä¸å†™ JOIN</li>
<li>âŒ ä¸å†™ä¸šåŠ¡é€»è¾‘</li>
</ul>
<h3 data-id="heading-32">2.8. Common å±‚ï¼ˆé€šç”¨èƒ½åŠ›ï¼‰</h3>
<pre><code class="hljs language-java" lang="java">common
â”œâ”€ exception
â”‚   â””â”€ BizException.java
â”œâ”€ util
â”‚   â””â”€ IdGenerator.java
â”œâ”€ constant
â”‚   â””â”€ ErrorCode.java
â””â”€ base
    â””â”€ BaseEntity.java
</code></pre>
<h3 data-id="heading-33">2.9. å¯ä»¥ç›´æ¥ç”¨çš„ã€ŒåŒ…çº§çº¦æŸå£è¯€ã€</h3>
<p>å¯ä»¥åœ¨å›¢é˜Ÿé‡Œè¿™æ ·è¦æ±‚ï¼š</p>
<blockquote>
<ul>
<li><code>domain</code> <strong>ä¸å‡†ä¾èµ–</strong> <code>application</code></li>
<li><code>query</code> <strong>ä¸å‡†ä¾èµ–</strong> <code>domain.service</code></li>
<li><code>controller</code> <strong>ä¸å‡†ä¾èµ–</strong> <code>dao</code></li>
<li><code>statistics</code> <strong>åªå‡†ä¾èµ–</strong> <code>query</code></li>
</ul>
</blockquote>
<h3 data-id="heading-34">2.10. Code Review ä¸€çœ¼åˆ¤æ–­æ³•ï¼ˆéå¸¸å¥½ç”¨ï¼‰</h3>
<p>çœ‹åˆ°ä¸€ä¸ªç±»ï¼Œåªçœ‹è·¯å¾„å°±èƒ½åˆ¤æ–­å¯¹ä¸å¯¹ï¼š</p>
<ul>
<li>ğŸ“‚ <code>domain/order/service/OrderService</code><br/>
â†’ <strong>åªèƒ½æœ‰è®¢å•é€»è¾‘</strong></li>
<li>ğŸ“‚ <code>query/order/OrderOnlyQuery</code><br/>
â†’ <strong>ä¸€å®šæ˜¯ JOIN + åªè¯»</strong></li>
<li>ğŸ“‚ <code>application/orderstock/OrderStockFacade</code><br/>
â†’ <strong>ä¸€å®šæ˜¯è·¨åŸŸæµç¨‹</strong></li>
<li>ğŸ“‚ <code>statistics/StatisticsService</code><br/>
â†’ <strong>ä¸€å®šä¸å†™ä¸šåŠ¡</strong></li>
</ul>
<p>è¿™å¥—åŒ…ç»“æ„ <strong>ä¸æ˜¯æœ€ç®€å•çš„</strong>ï¼Œä½†å®ƒæ˜¯<strong>å¤æ‚ä¸šåŠ¡ä¸‹æœ€ä¸å®¹æ˜“â€œå†™æ­ªâ€çš„ç»“æ„ä¹‹ä¸€</strong>ã€‚</p>
<h2 data-id="heading-35">3. å¤šæ¨¡å—é¡¹ç›®</h2>
<p>ç”¨ <strong>Gradleï¼ˆå°¤å…¶æ˜¯å¤šæ¨¡å—ï¼‰</strong> åšè¿™ä¸ªåˆ†å±‚éå¸¸é¡ºæ‰‹ã€‚ä¸‹é¢æ˜¯ä¸€å¥—<strong>å¯ç›´æ¥ç…§æŠ„ã€è·‘å¾—èµ·æ¥</strong>çš„æ¨¡æ¿ï¼š</p>
<ul>
<li><code>web</code>ã€<code>open</code> éƒ½èƒ½è®¿é—®æ•°æ®åº“</li>
<li>Entity / Mapper æ¥å£ / mapper.xml ç»Ÿä¸€å¤ç”¨</li>
<li><strong>ä¸æ”¾ common</strong>ï¼Œè€Œæ˜¯æ”¾åˆ° <code>persistence</code> æ¨¡å—ï¼ˆå…±äº«æ•°æ®è®¿é—®å±‚ï¼‰</li>
<li>Spring Boot + MyBatis</li>
</ul>
<h3 data-id="heading-36">3.1. æ¨èçš„ Gradle å¤šæ¨¡å—ç›®å½•ç»“æ„</h3>
<pre><code class="hljs language-java" lang="java">project-root
â”œâ”€ settings.gradle
â”œâ”€ build.gradle
â”œâ”€ common
â”‚  â””â”€ build.gradle
â”œâ”€ persistence
â”‚  â”œâ”€ build.gradle
â”‚  â””â”€ src/main
â”‚     â”œâ”€ java/com/xxx/persistence
â”‚     â”‚  â”œâ”€ entity
â”‚     â”‚  â”œâ”€ mapper
â”‚     â”‚  â””â”€ config
â”‚     â””â”€ resources
â”‚        â””â”€ mapper
â”‚           â”œâ”€ UserMapper.xml
â”‚           â””â”€ OrderMapper.xml
â”œâ”€ web
â”‚  â””â”€ build.gradle
â”œâ”€ open
â”‚  â””â”€ build.gradle
â””â”€ bootstrap
   â””â”€ build.gradle
</code></pre>
<blockquote>
<p><code>bootstrap</code> æ˜¯å¯åŠ¨æ¨¡å—ï¼ˆå¯é€‰ï¼Œä½†å¼ºçƒˆæ¨èï¼‰ï¼Œé¿å… web/open åŒæ—¶ä½œä¸ºå¯åŠ¨å…¥å£å¯¼è‡´é…ç½®ä¹±ã€‚</p>
</blockquote>
<h3 data-id="heading-37">3.2. settings.gradleï¼ˆå¿…é¡»ï¼‰</h3>
<pre><code class="hljs language-java" lang="java">rootProject.name = <span class="hljs-string">"demo-project"</span>

include(
        <span class="hljs-string">"common"</span>,
        <span class="hljs-string">"persistence"</span>,
        <span class="hljs-string">"web"</span>,
        <span class="hljs-string">"open"</span>,
        <span class="hljs-string">"bootstrap"</span>
)
</code></pre>
<h3 data-id="heading-38">3.3. æ ¹ build.gradleï¼ˆç»Ÿä¸€ç‰ˆæœ¬ã€æ’ä»¶ç®¡ç†ï¼‰</h3>
<pre><code class="hljs language-java" lang="java">plugins {
    id <span class="hljs-string">'org.springframework.boot'</span> version <span class="hljs-string">'3.2.3'</span> apply <span class="hljs-literal">false</span>
    id <span class="hljs-string">'io.spring.dependency-management'</span> version <span class="hljs-string">'1.1.4'</span> apply <span class="hljs-literal">false</span>
    id <span class="hljs-string">'java'</span> apply <span class="hljs-literal">false</span>
}

allprojects {
    group = <span class="hljs-string">'com.xxx'</span>
    version = <span class="hljs-string">'1.0.0'</span>
}

subprojects {
    apply plugin: <span class="hljs-string">'java'</span>
    java {
        toolchain {
            languageVersion = JavaLanguageVersion.of(<span class="hljs-number">17</span>)
        }
    }

    repositories {
        mavenCentral()
    }
}
</code></pre>
<h3 data-id="heading-39">3.4. common/build.gradleï¼ˆçº¯é€šç”¨ï¼Œæ— æ•°æ®åº“ä¾èµ–ï¼‰</h3>
<pre><code class="hljs language-java" lang="java">dependencies {
    <span class="hljs-comment">// æ”¾å·¥å…·ç±»ã€å¼‚å¸¸ã€è¿”å›ç»“æ„ç­‰</span>
    implementation <span class="hljs-string">"org.apache.commons:commons-lang3:3.14.0"</span>
}
</code></pre>
<p>common æ¨¡å—æ˜¯é€šç”¨æ¨¡å—ã€‚ä¸»è¦æ”¾ä¸€äº›å…¶å®ƒå„æ¨¡å—å…¬ç”¨çš„ä¸€äº›ä»£ç ï¼š</p>
<p>âœ… common ä¿æŒâ€œå¹²å‡€â€ï¼Œæ”¾ï¼š</p>
<ul>
<li><code>BaseResponse / PageRequest / PageResult</code></li>
<li><code>BizException / ErrorCode</code>ï¼ˆåŸºç¡€ç±»ï¼‰</li>
<li><code>å·¥å…·ç±» util</code></li>
<li><code>å…¬å…±æ³¨è§£</code></li>
<li><code>é€šç”¨æšä¸¾åŸºç±» BaseEnum</code></li>
<li><code>IDç”Ÿæˆå™¨</code></li>
<li><code>å¸¸é‡ GlobalConstants</code></li>
</ul>
<p>âŒ ä¸æ”¾ï¼š</p>
<ul>
<li><code>UserDO / OrderDO</code></li>
<li><code>UserMapper</code></li>
<li><code>mapper.xml</code></li>
<li><code>æ•°æ®åº“ä¾èµ–ä¸é…ç½®</code></li>
</ul>
<h3 data-id="heading-40">3.5. persistence/build.gradleï¼ˆå…±äº«æ•°æ®åº“è®¿é—®å±‚ï¼‰</h3>
<blockquote>
<p>è¿™é‡Œæ”¾ï¼šDO/Entityã€Mapperæ¥å£ã€mapper.xml<br/>
è®© web/open éƒ½ <code>implementation(project(":persistence"))</code>ã€‚</p>
</blockquote>
<pre><code class="hljs language-java" lang="java">plugins {
    id <span class="hljs-string">'io.spring.dependency-management'</span>
}

dependencies {
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":common"</span>)</span>

    <span class="hljs-comment">// MyBatis Spring Boot Starter</span>
    implementation <span class="hljs-string">"org.mybatis.spring.boot:mybatis-spring-boot-starter:3.0.3"</span>

    <span class="hljs-comment">// æ•°æ®åº“é©±åŠ¨ï¼ˆä½ ç”¨ä»€ä¹ˆæ¢ä»€ä¹ˆï¼Œè¿™é‡Œä»¥ MySQL ä¸ºä¾‹ï¼‰</span>
    runtimeOnly <span class="hljs-string">"com.mysql:mysql-connector-j:8.3.0"</span>

    <span class="hljs-comment">// å¯é€‰ï¼šLombok</span>
    compileOnly <span class="hljs-string">"org.projectlombok:lombok:1.18.30"</span>
    annotationProcessor <span class="hljs-string">"org.projectlombok:lombok:1.18.30"</span>
}

tasks.withType(Test).configureEach {
    useJUnitPlatform()
}
</code></pre>
<h4 data-id="heading-41">3.5.1. persistence æ¨¡å—é‡Œ MyBatis æ‰«æä¸ XML è·¯å¾„ï¼ˆéå¸¸å…³é”®ï¼‰</h4>
<p>mapper.xml æ”¾çš„ä½ç½®ï¼ˆæ¨èï¼‰</p>
<pre><code class="hljs language-java" lang="java">persistence/src/main/resources/mapper<span class="hljs-comment">/*.xml
</span></code></pre>
<p>persistence/config/MybatisConfig.javaï¼ˆå¯é€‰ï¼Œä½†å»ºè®®ï¼‰</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.xxx.persistence.config;

<span class="hljs-keyword">import</span> org.mybatis.spring.annotation.MapperScan;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@MapperScan("com.xxx.persistence.mapper")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MybatisConfig</span> {
}
</code></pre>
<blockquote>
<p>è¿™æ ·å°±ä¸æ€•æ‰«æä¸åˆ° Mapperã€‚<br/>
<code>web/open/bootstrap</code> å¼•å…¥ persistence åä¼šè‡ªåŠ¨ç”Ÿæ•ˆã€‚</p>
</blockquote>
<h4 data-id="heading-42">3.5.2. persistence æ¨¡å—</h4>
<p>persistence æ˜¯æŒä¹…å±‚æ¨¡å—ã€‚persistence æ¨¡å—å†…å®¹å»ºè®®ï¼š</p>
<pre><code class="hljs language-java" lang="java">persistence
â”œâ”€ entity                 <span class="hljs-comment">// DB å®ä½“ï¼ˆDO / POï¼‰</span>
â”‚  â”œâ”€ UserDO.java
â”‚  â””â”€ OrderDO.java
â”œâ”€ mapper                 <span class="hljs-comment">// MyBatis Mapper æ¥å£ï¼ˆDaoï¼‰</span>
â”‚  â”œâ”€ UserMapper.java
â”‚  â””â”€ OrderMapper.java
â”œâ”€ xml                    <span class="hljs-comment">// mapper.xmlï¼ˆæˆ– resources/mapperï¼‰</span>
â”‚  â”œâ”€ UserMapper.xml
â”‚  â””â”€ OrderMapper.xml
â””â”€ config                 <span class="hljs-comment">// MyBatis é…ç½® / æ‰«æé…ç½®ï¼ˆå¯é€‰ï¼‰</span>
</code></pre>
<p>æ³¨æ„ï¼šè¿™é‡Œçš„å®ä½“æœ€å¥½å« DO/POï¼Œä¸è¦å« Domain Entityï¼ˆé¿å…æŠŠé¢†åŸŸæ¨¡å‹å’Œè¡¨å¼ºç»‘å®šï¼‰ã€‚</p>
<p><strong>Entity / Dao / XML ç»Ÿä¸€æ”¾åˆ° <code>persistence</code> æ¨¡å—ï¼š</strong></p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java">persistence/src/main/java/com/xxx/persistence/entity/UserDO.java
persistence/src/main/java/com/xxx/persistence/mapper/UserMapper.java
persistence/src/main/resources/mapper/UserMapper.xml
</code></pre>
<p>web/open ç›´æ¥æ³¨å…¥ Mapper ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> UserMapper userMapper;
</code></pre>
<p><strong>å¯èƒ½ä¼šæ‹…å¿ƒçš„é—®é¢˜ï¼šweb/open åŒæ—¶è®¿é—® DBï¼Œä¼šä¸ä¼šä¹±ï¼Ÿ</strong></p>
<p>ä¸ä¼šï¼Œåªè¦ä½ éµå®ˆï¼š</p>
<p>âœ… DB ç›¸å…³ä¸œè¥¿åªåœ¨ <code>persistence</code><br/>
âœ… å¯åŠ¨é…ç½®ç»Ÿä¸€æ”¾ <code>bootstrap</code><br/>
âœ… web/open ä¸é‡å¤é…ç½®æ•°æ®æº</p>
<h3 data-id="heading-43">3.6. web/build.gradleï¼ˆä¾èµ– persistenceï¼‰</h3>
<blockquote>
<p>è¿™é‡Œå»ºè®® web ä¸ç›´æ¥å¼•æ•°æ®åº“é©±åŠ¨ã€mybatis ä¾èµ–ï¼Œéƒ½ä» persistence æ¥ã€‚</p>
</blockquote>
<pre><code class="hljs language-java" lang="java">plugins {
    id <span class="hljs-string">'org.springframework.boot'</span>
    id <span class="hljs-string">'io.spring.dependency-management'</span>
}

dependencies {
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":common"</span>)</span>
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":persistence"</span>)</span>

    implementation <span class="hljs-string">"org.springframework.boot:spring-boot-starter-web"</span>
    implementation <span class="hljs-string">"org.springframework.boot:spring-boot-starter-validation"</span>
}
</code></pre>
<h3 data-id="heading-44">3.7. open/build.gradleï¼ˆä¾èµ– persistenceï¼‰</h3>
<pre><code class="hljs language-java" lang="java">plugins {
    id <span class="hljs-string">'org.springframework.boot'</span>
    id <span class="hljs-string">'io.spring.dependency-management'</span>
}

dependencies {
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":common"</span>)</span>
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":persistence"</span>)</span>

    implementation <span class="hljs-string">"org.springframework.boot:spring-boot-starter-web"</span>
}
</code></pre>
<h3 data-id="heading-45">3.8. bootstrap æ¨¡å—çš„å¯åŠ¨ç±»ï¼ˆSpring Boot mainï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.xxx.bootstrap;

<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;

<span class="hljs-meta">@SpringBootApplication(scanBasePackages = "com.xxx")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Application</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>
<blockquote>
<p><code>scanBasePackages="com.xxx"</code> ç¡®ä¿æ‰«æåˆ° persistence/web/open çš„ beanã€‚</p>
</blockquote>
<h4 data-id="heading-46">3.8.1. bootstrap/build.gradleï¼ˆæ¨èï¼šå”¯ä¸€å¯åŠ¨æ¨¡å—ï¼‰</h4>
<blockquote>
<p>è®© bootstrap ä½œä¸ºå”¯ä¸€å…¥å£ï¼Œweb/open åªæ˜¯åŠŸèƒ½æ¨¡å—ã€‚</p>
</blockquote>
<pre><code class="hljs language-java" lang="java">plugins {
    id <span class="hljs-string">'org.springframework.boot'</span>
    id <span class="hljs-string">'io.spring.dependency-management'</span>
}

dependencies {
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":common"</span>)</span>
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":persistence"</span>)</span>
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":web"</span>)</span>
    implementation <span class="hljs-title function_">project</span><span class="hljs-params">(<span class="hljs-string">":open"</span>)</span>

    implementation <span class="hljs-string">"org.springframework.boot:spring-boot-starter"</span>
}
</code></pre>
<h4 data-id="heading-47">3.8.2. application.ymlï¼ˆæ”¾ bootstrap æ¨¡å—ï¼‰</h4>
<p><code>bootstrap/src/main/resources/application.yml</code></p>
<pre><code class="hljs language-java" lang="java">spring:
  datasource:
    url: jdbc:mysql:<span class="hljs-comment">//localhost:3306/demo?useSSL=false&amp;serverTimezone=UTC</span>
    username: root
    password: root

mybatis:
  mapper-locations: classpath*:mapper<span class="hljs-comment">/*.xml
  type-aliases-package: com.xxx.persistence.entity
</span></code></pre>
<blockquote>
<p>âœ… <code>classpath*:</code> éå¸¸é‡è¦ï¼Œä¿è¯å¤šæ¨¡å— resources èƒ½è¢«æ‰¾åˆ°<br/>
âœ… mapper-locations åŒ¹é… persistence/resources/mapper</p>
</blockquote>
<h4 data-id="heading-48">3.8.3. å¦‚æœä¸è®¾ bootstrap</h4>
<p>å¦‚æœä¸è®¾ bootstrapï¼Œè€Œæ˜¯ <code>web</code>ã€<code>open</code> å„è‡ªå¯åŠ¨ï¼š</p>
<ul>
<li>web/open éƒ½è¦æœ‰è‡ªå·±çš„å¯åŠ¨ç±» <code>@SpringBootApplication(scanBasePackages="com.xxx")</code></li>
<li>application.yml æ”¾å„è‡ªæ¨¡å—é‡Œ</li>
</ul>
<p>ç¼ºç‚¹ï¼šé…ç½®å®¹æ˜“é‡å¤ï¼›ä¼˜ç‚¹ï¼šæ¨¡å—ç‹¬ç«‹è¿è¡Œã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>