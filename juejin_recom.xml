<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[苹果应用商店上架全流程复盘，一次真实项目从构建、上传到审核通过的经验总结]]></title>    <link>https://juejin.cn/post/7574622940688302099</link>    <guid>https://juejin.cn/post/7574622940688302099</guid>    <pubDate>2025-11-20T08:08:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574622940688302099" data-draft-id="7574530224853417990" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="苹果应用商店上架全流程复盘，一次真实项目从构建、上传到审核通过的经验总结"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T08:08:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="00后程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1159358440539900"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            苹果应用商店上架全流程复盘，一次真实项目从构建、上传到审核通过的经验总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1159358440539900/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    00后程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:08:33.000Z" title="Thu Nov 20 2025 08:08:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你在一个技术团队里待得足够久，你一定听过这样的抱怨：
“开发做完了，但苹果应用商店上架卡了三天。”
“证书不对、权限说明缺失、截图尺寸错了……”
“上传 IPA 就卡住，Transporter 直接报错。”</p>
<p>上架 App Store 看似简单，但在真正的项目周期里，它往往是最容易出现意外的环节之一。
这篇文章不是传统教程，而更像是一场 <strong>“上架复盘会”</strong> 的会议纪要，记录我们团队一次完整的苹果应用商店上架经验，希望能给其他开发团队提供思路。</p>
<hr/>
<h2 data-id="heading-0"><strong>一、开始前：我们到底需要准备什么？（项目 Kick-Off 阶段）</strong></h2>
<p>在正式准备上架之前，我们的第一件事情是制作一张上架材料总表。
我们发现，如果提前把所有材料摸清楚，上架时间能直接缩短至少 40%。</p>
<p>这张表包含：</p>
<h3 data-id="heading-1"><strong>1. 账号层面</strong></h3>
<ul>
<li>Apple Developer Program（有效状态）</li>
<li>App Store Connect 权限是否正常</li>
<li>团队成员角色分配（Admin、Developer、App Manager）</li>
</ul>
<h3 data-id="heading-2"><strong>2. 技术层面</strong></h3>
<ul>
<li>证书（Distribution）</li>
<li>描述文件（App Store）</li>
<li>App ID（Bundle ID）</li>
<li>IPA 构建方式（原生 / uni-app / Flutter 等）</li>
</ul>
<h3 data-id="heading-3"><strong>3. 内容层面</strong></h3>
<ul>
<li>6.5 寸 / 5.5 寸 iPhone 截图</li>
<li>iPad 截图（如支持）</li>
<li>隐私政策 URL</li>
<li>权限用途说明文案</li>
</ul>
<p>所有角色提前确认后，整个过程就不会临时插队和返工。</p>
<hr/>
<h2 data-id="heading-4"><strong>二、证书与描述文件：团队一致性的关键</strong></h2>
<p>过去我们团队最混乱的部分，就是“每个人电脑里都有一套自己的证书”，最终导致：</p>
<ul>
<li>有人上传失败</li>
<li>有人构建失败</li>
<li>有人描述文件版本对不上</li>
</ul>
<p>后来我们彻底调整流程，建立了一个统一原则：</p>
<h3 data-id="heading-5"><strong>所有证书只能由一个人或一条流水线生成，并集中管理。</strong></h3>
<p>在 Mac 不够用、团队成员操作系统不一致的情况下，我们采用了开心上架（Appuploader）跨平台生成方式。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b83aa8c377541e68337ed5443fab87c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMDDlkI7nqIvluo_lkZg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230913&amp;x-signature=wzx8IDv9YYBrA0CNn%2B4wdkYiX5A%3D" alt="证书" loading="lazy"/></p>
<p>生成后的文件存放在团队安全仓库（例如 GitLab Protected Storage 或加密盘），所有人从同一套证书签名，避免环境不一致导致的构建问题。</p>
<hr/>
<h2 data-id="heading-6"><strong>三、构建 IPA：技术栈不同，策略不同</strong></h2>
<p>我们的项目包含原生部分，也包含 uni-app 部分，因此构建策略如下：</p>
<h3 data-id="heading-7"><strong>1. 原生部分（Swift）</strong></h3>
<p>由 Mac 端负责：</p>
<ul>
<li>Xcode → Archive → Export IPA</li>
<li>使用统一证书签名</li>
</ul>
<h3 data-id="heading-8"><strong>2. uni-app 部分</strong></h3>
<p>使用 HBuilderX 云打包，优点：</p>
<ul>
<li>Windows 成员也能构建</li>
<li>不依赖本地 Xcode</li>
<li>输出稳定的 IPA 文件
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b2df3e0b7ba4555afa60ac79ce14071~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMDDlkI7nqIvluo_lkZg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230913&amp;x-signature=ikGEb%2FUZhkUrUA8suf3pmf7Jed4%3D" alt="hd打包" loading="lazy"/></li>
</ul>
<h3 data-id="heading-9"><strong>3. 自动化构建（CI/CD）</strong></h3>
<p>我们团队配置了一个 Pipeline：</p>
<ul>
<li>每次打 tag 自动构建</li>
<li>自动签名</li>
<li>自动产出 IPA</li>
</ul>
<p>这使得构建不再依赖某个开发者的电脑环境，也不再受 Mac 数量限制。</p>
<hr/>
<h2 data-id="heading-10"><strong>四、上传 IPA：瓶颈最多、最容易出问题的步骤</strong></h2>
<p>在没有统一工具前，团队曾经遇到过：</p>
<ul>
<li>Transporter 报错</li>
<li>上传卡住</li>
<li>某台 Mac 环境异常</li>
<li>altool 提示已弃用</li>
<li>Xcode 版本不兼容</li>
</ul>
<p>这些问题让我们意识到“上传应该尽量脱离个人电脑环境”。</p>
<p>最终我们采用跨平台命令行方式上传 IPA，这样无论团队成员使用 Windows、Linux 还是 macOS 都能发布。</p>
<p>示例命令：</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u ios@team.com -p xxx-xxx-xxx-xxx -c 2 -f ./build/output.ipa
</code></pre>
<p>执行后 IPA 会进入：</p>
<ul>
<li><strong>TestFlight（用于测试）</strong></li>
<li><strong>App Store Connect 的构建版本栏位</strong></li>
</ul>
<p>此方式的最大价值在于：</p>
<ul>
<li><strong>不依赖某一台 Mac</strong></li>
<li><strong>可集成到 CI 自动上传</strong></li>
<li><strong>上传日志清晰可查</strong></li>
<li><strong>避免“个人机器坏了就无法发布”的风险</strong></li>
</ul>
<hr/>
<h2 data-id="heading-11"><strong>五、创建 App Store 页面：产品、设计与技术协同的环节</strong></h2>
<p>上传构建之后，App Store 页面配置同样关键，甚至经常决定审核是否顺利。</p>
<h3 data-id="heading-12">产品团队负责：</h3>
<ul>
<li>App 名称</li>
<li>简介与详细描述</li>
<li>分类与关键词</li>
<li>隐私政策 URL</li>
</ul>
<h3 data-id="heading-13">设计团队负责：</h3>
<ul>
<li>所有设备尺寸截图</li>
<li>必要的预览视频（可选）</li>
<li>截图语言版本（如多语言）</li>
</ul>
<h3 data-id="heading-14">技术团队负责：</h3>
<ul>
<li>权限用途说明检查</li>
<li>API 行为符合 App Store 规范</li>
<li>登录、注册流程稳定</li>
</ul>
<p>我们为此建立了一个共享文档，让每个角色一次性填完所有信息，减少来回修改造成的延迟。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc295d2bad6f4e4c83984e04ed0cade0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMDDlkI7nqIvluo_lkZg=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230913&amp;x-signature=EfE8Q0S%2BHwWKquZg5HrgoTIbHFU%3D" alt="asc" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-15"><strong>六、审核过程：如何避免被拒？</strong></h2>
<p>根据多年上架经验，我们总结了最容易被拒的 6 类问题：</p>
<h3 data-id="heading-16"><strong>1. 权限用途描述缺失（最常见）</strong></h3>
<p>例如缺少：</p>
<ul>
<li>NSCameraUsageDescription</li>
<li>NSLocationUsageDescription</li>
</ul>
<h3 data-id="heading-17"><strong>2. 截图与实际界面不符</strong></h3>
<p>审核员会对比截图与应用 UI。</p>
<h3 data-id="heading-18"><strong>3. App 闪退或某个功能不可用</strong></h3>
<p>TestFlight 测试能提前暴露这些问题。</p>
<h3 data-id="heading-19"><strong>4. 用户注册无法通过</strong></h3>
<p>苹果会实际操作流程。</p>
<h3 data-id="heading-20"><strong>5. 违反 IAP 规范</strong></h3>
<p>包含外链支付基本会被拒。</p>
<h3 data-id="heading-21"><strong>6. 账号权限问题</strong></h3>
<p>测试账号不可用，审核员会直接拒绝。</p>
<p>为了避免这些问题，我们团队建立了“审核前检查清单”，由 QA 或开发执行一次完整测试。</p>
<hr/>
<h2 data-id="heading-22"><strong>上线发布，管理版本与风险控制</strong></h2>
<p>审核通过后，我们通常不会立即发布，而是：</p>
<ul>
<li>选择“手动发布”</li>
<li>让团队再做一次验收</li>
<li>检查是否存在版本号冲突</li>
<li>更新应用更新公告</li>
</ul>
<p>当一切准备好后，才点击最终发布。</p>
<p>这种做法可以避免用户下载到问题版本，也避免紧急回滚的风险。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iFlow CLI：强大的终端AI助手，开启智能编程新时代]]></title>    <link>https://juejin.cn/post/7574581079627317254</link>    <guid>https://juejin.cn/post/7574581079627317254</guid>    <pubDate>2025-11-20T08:10:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574581079627317254" data-draft-id="7574621075322847295" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iFlow CLI：强大的终端AI助手，开启智能编程新时代"/> <meta itemprop="keywords" content="AI编程"/> <meta itemprop="datePublished" content="2025-11-20T08:10:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="万少"/> <meta itemprop="url" content="https://juejin.cn/user/4441682708283191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iFlow CLI：强大的终端AI助手，开启智能编程新时代
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682708283191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    万少
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 如鱼得水
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 如鱼得水" title="VIP.5 如鱼得水" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:10:45.000Z" title="Thu Nov 20 2025 08:10:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>正在参与 iFlow CLI 模力全开｜案例征集活动</p>
<blockquote>
<p>快速开始 | 心流开放平台</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>在当今快节奏的软件开发环境中，开发者们一直在寻求更高效、更智能的工具来提高工作效率。阿里心流团队推出的iFlow CLI正是一款应运而生的产品——一个集成在终端中的AI智能体，让开发者能够通过自然语言与AI交互，完成代码分析、文档生成、调试排错、文件管理等多种任务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b01a56d7bf047aeb2aec9d13682265e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=IUFQzzufZ%2B42J8aBh%2Boe8mfX5zI%3D" alt="image-20251120151306448" loading="lazy"/></p>
<p>本文将详细介绍iFlow CLI的安装方法，并通过一个简单的Web工具开发案例，帮助读者快速上手这款强大的AI编程助手。</p>
<h2 data-id="heading-1">什么是iFlow CLI？</h2>
<p>iFlow CLI是一款在终端中运行的智能体式命令行工具，旨在把自然语言交互和多模态能力带入开发者日常工作流。它具备以下核心特性：</p>
<ul>
<li><strong>自然语言交互</strong>：支持用自然语言下达指令，无需记忆复杂命令</li>
<li><strong>本地仓库分析与上下文理解</strong>：通过<code>/init</code>命令扫描并理解本地代码仓库</li>
<li><strong>多模型支持</strong>：支持多种主流国产大模型，如Qwen3 Coder、Kimi K2、DeepSeek V3.2等</li>
<li><strong>永久免费</strong>：面向个人用户永久免费，不限流量</li>
<li><strong>扩展性强</strong>：支持通过安装子代理（SubAgents）和MCP工具来扩展功能</li>
</ul>
<h2 data-id="heading-2">安装iFlow CLI</h2>
<h3 data-id="heading-3">系统要求</h3>
<p>iFlow CLI支持多种操作系统：</p>
<ul>
<li>macOS</li>
<li>Linux</li>
<li>Windows（含WSL）</li>
</ul>
<h3 data-id="heading-4">安装步骤</h3>
<h4 data-id="heading-5">方法一：使用npm安装（推荐）</h4>
<pre><code class="hljs language-bash" lang="bash">
npm install -g @iflow/cli
</code></pre>
<h4 data-id="heading-6">方法二：使用国内镜像安装</h4>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># 使用淘宝镜像</span>

npm install -g @iflow/cli --registry https://registry.npmmirror.com
</code></pre>
<h4 data-id="heading-7">方法三：直接下载安装包</h4>
<p>访问iFlow CLI的官方GitHub仓库，下载对应操作系统的安装包：</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># 克隆仓库（如果使用Git）</span>

git <span class="hljs-built_in">clone</span> https://github.com/iflow-fun/iflow-cli.git

<span class="hljs-built_in">cd</span> iflow-cli

npm install -g
</code></pre>
<h3 data-id="heading-8">验证安装</h3>
<p>安装完成后，可以在终端中输入以下命令验证安装是否成功：</p>
<pre><code class="hljs language-css" lang="css">
iflow <span class="hljs-attr">--version</span>
</code></pre>
<p>如果成功安装，将显示iFlow CLI的版本信息。</p>
<h3 data-id="heading-9">初始化配置</h3>
<p>首次使用时，运行以下命令进行初始化：</p>
<pre><code class="hljs language-csharp" lang="csharp">
iflow <span class="hljs-keyword">init</span>
</code></pre>
<p>这将引导你完成基本配置，包括选择默认AI模型等。</p>
<h2 data-id="heading-10">iFlow CLI核心功能介绍</h2>
<h3 data-id="heading-11">1. 四种运行模式</h3>
<p>iFlow CLI支持四种运行模式，可以通过Shift + Tab快捷键进行切换：</p>
<ul>
<li><strong>Yolo模式</strong>：模型拥有最高权限，执行操作零限制</li>
<li><strong>Accepting Edits模式</strong>：仅允许修改文件，安全可控</li>
<li><strong>Plan Mode</strong>：先规划任务步骤，再逐层执行</li>
<li><strong>Default模式</strong>：模型无任何权限</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55a050da8a024d97861256bc412b7d30~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=VetVi40CeUO9pL0iKMgj3jIPFxU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">2. 项目分析功能</h3>
<p>在代码项目目录下运行<code>/init</code>，iFlow CLI可以分析项目的结构和主要功能，帮助开发者快速了解项目布局。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d6f4bcd4e164da39d9b187680a3a408~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=2SeR2ob0msx9knMwOcL7o6VuEIY%3D" alt="image-20251120152131227" loading="lazy"/></p>
<h3 data-id="heading-13">3. 自然语言交互</h3>
<p>用户可以直接提出任务目标，iFlow CLI会开始逐步规划、生成、执行、确认修改，必要时提醒你测试或备份。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b277cc519bf4e3e83a61e6ce73f6bba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=jf%2BmxW7YWig5FBYeVmNA1oS6wcw%3D" alt="image-20251120152154513" loading="lazy"/></p>
<h3 data-id="heading-14">4. 多模态支持</h3>
<p>支持文本、图片、文件引用等多种输入形式，让AI模型能够"理解"图片内容。</p>
<h2 data-id="heading-15">开发案例：创建一个简单的Web工具</h2>
<p>接下来，我们通过一个实际案例来演示如何使用iFlow CLI开发一个简单的Web工具——一个待办事项管理器。</p>
<h3 data-id="heading-16">项目初始化</h3>
<p>首先，创建一个新项目目录并初始化：</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-built_in">mkdir</span> todo-web-app

<span class="hljs-built_in">cd</span> todo-web-app
</code></pre>
<p>在项目目录中运行iFlow CLI的初始化命令：</p>
<pre><code class="hljs language-bash" lang="bash">
/init
</code></pre>
<p>iFlow CLI将扫描目录并生成项目说明。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cc7e6a306f34abf87cb1850a5bb2896~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=TI4C%2B%2BLxdq54F9CIISmo%2B8OL%2Btk%3D" alt="image-20251120152454101" loading="lazy"/></p>
<h3 data-id="heading-17">创建项目结构</h3>
<p>让我们使用iFlow CLI创建一个基本的项目结构：</p>
<pre><code class="hljs language-diff" lang="diff">
请帮我创建一个简单的待办事项Web应用，包含以下文件：

<span class="hljs-deletion">- index.html：主页面</span>

<span class="hljs-deletion">- styles.css：样式文件</span>

<span class="hljs-deletion">- script.js：JavaScript逻辑</span>

<span class="hljs-deletion">- README.md：项目说明</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f4ac570d097947ce97de2cd7f6d69e78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=nfYjUF1%2F7SZwlbvdwn9K0JZ3KDQ%3D" alt="image-20251120153010775" loading="lazy"/></p>
<h3 data-id="heading-18">编写HTML页面</h3>
<p>现在让我们创建主页面：</p>
<pre><code class="hljs language-diff" lang="diff">
请帮我编写index.html文件，创建一个简洁美观的待办事项管理器界面，包含：

<span class="hljs-deletion">- 标题"我的待办事项"</span>

<span class="hljs-deletion">- 一个输入框用于添加新任务</span>

<span class="hljs-deletion">- 添加按钮</span>

<span class="hljs-deletion">- 任务列表展示区域</span>

<span class="hljs-deletion">- 清空已完成任务的按钮</span>
</code></pre>
<h3 data-id="heading-19">添加样式设计</h3>
<p>让我们为页面添加样式：</p>
<pre><code class="hljs language-diff" lang="diff">
请帮我编写styles.css文件，为待办事项管理器添加现代风格的样式，包括：

<span class="hljs-deletion">- 响应式布局</span>

<span class="hljs-deletion">- 美观的颜色搭配</span>

<span class="hljs-deletion">- 任务项的悬停效果</span>

<span class="hljs-deletion">- 完成任务的样式变化</span>
</code></pre>
<h3 data-id="heading-20">实现JavaScript功能</h3>
<p>现在让我们实现核心功能：</p>
<pre><code class="hljs language-diff" lang="diff">
请帮我编写script.js文件，实现待办事项管理器的完整功能，包括：

<span class="hljs-deletion">- 添加新任务</span>

<span class="hljs-deletion">- 标记任务为完成/未完成</span>

<span class="hljs-deletion">- 删除任务</span>

<span class="hljs-deletion">- 清空已完成任务</span>

<span class="hljs-deletion">- 本地存储保存数据</span>
</code></pre>
<h3 data-id="heading-21">测试应用</h3>
<p>让我们测试一下我们的应用：</p>
<pre><code class="hljs">
请帮我启动一个本地服务器来运行这个待办事项应用，并告诉我如何访问
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dfceab3a1a614b8eb228ee9a55b4be03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=mRR6SS8hR7MHOHISW%2BoNbs%2B56lw%3D" alt="image-20251120153130505" loading="lazy"/></p>
<h3 data-id="heading-22">优化功能</h3>
<p>根据测试结果，我们可以进一步优化：</p>
<pre><code class="hljs language-diff" lang="diff">
请帮我优化待办事项应用的功能，添加以下特性：

<span class="hljs-deletion">- 任务优先级设置（高/中/低）</span>

<span class="hljs-deletion">- 任务搜索功能</span>

<span class="hljs-deletion">- 任务统计信息（总任务数、已完成数等）</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b146711fffc4b858dbeda4f45f60e16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=LLrB9RIxAo2z%2BAPI%2F8vsbjVZu8I%3D" alt="image-20251120154059007" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a426d089f0f94be5b10523f14ee9d97d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=2ACy9%2B%2FUYSBxJ1g2Axe%2Bo6iEdeg%3D" alt="image-20251120154112049" loading="lazy"/></p>
<h2 data-id="heading-23">高级功能与技巧</h2>
<h3 data-id="heading-24">SubAgent智能分工系统</h3>
<p>iFlow CLI支持SubAgent系统，类似于拥有一个专业团队，每个成员都有自己的专长领域：</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># 查看所有可用的SubAgents</span>

iflow agent --<span class="hljs-built_in">help</span>

<span class="hljs-comment"># 安装特定的SubAgent</span>

iflow agent install &lt;agent-name&gt;
</code></pre>
<h3 data-id="heading-25">MCP工具集成</h3>
<p>通过心流MCP市场，可以快速安装MCP工具到iFlow CLI中：</p>
<pre><code class="hljs language-bash" lang="bash">
<span class="hljs-comment"># 查看可用的MCP工具</span>

iflow mcp list
</code></pre>
<h3 data-id="heading-26">项目级上下文理解</h3>
<p>使用<code>/init</code>命令让iFlow CLI预先学习当前项目的文件结构，从而对上下文有更好的理解。</p>
<h2 data-id="heading-27">使用技巧与最佳实践</h2>
<h3 data-id="heading-28">1. 明确的指令</h3>
<p>提供清晰明确的指令，包括具体的功能要求和样式偏好。</p>
<h3 data-id="heading-29">2. 分步骤开发</h3>
<p>将复杂的开发任务分解为多个小步骤，逐步完成。</p>
<h3 data-id="heading-30">3. 利用上下文理解</h3>
<p>在项目目录中使用<code>/init</code>命令，让iFlow CLI更好地理解项目结构。</p>
<h3 data-id="heading-31">4. 模式选择</h3>
<p>根据任务安全要求选择合适的运行模式。</p>
<h2 data-id="heading-32">与同类工具的对比</h2>
<p>| 特性 | iFlow CLI | GitHub Copilot | Claude Code |</p>
<p>|------|-----------|----------------|-------------|</p>
<p>| 语言交互 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d4060329340479081efc0d3f2e4b9bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=5YSTwGRPvvChkKr3Jay0efv3pkQ%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8951c8bfa634a02a01e52de08ee6ef6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=BLWxjr%2Bb%2B9Tjo8%2FPj2%2Fwi7BKnrw%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fd6b15c21934ce09c4570451395d732~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=Q3Mm7NhX8rnt5uf5PDlsEdNYDPA%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> |</p>
<p>| 项目分析 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63344cc42d0343fcbca683850d9db5bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=YPBJddEIyNRxJofD5%2FFr83YZNFs%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | 部分 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37b039a7f6934136a5ef7907101bb00c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=Z4w%2Fz2fOsOyi5TSc5vR5HiBHU64%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> |</p>
<p>| 国产模型支持 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d90a493b82614837a8f263fa1c8c5aa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=AFnuMCfhcR6m6y8C%2BOhbQub5EeY%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4858d6ef42b647589711f16fbcb7d101~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=OTsU7VL26nQ%2FcOToXuyjXMwgmbY%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e5507241a5b4607bf560b30e7210c41~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=rHBGIV%2F3zd9ACvm9l%2F8EuEkW1iE%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> |</p>
<p>| 永久免费 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b9d390b8d034d3190ce12119f93bfd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=%2BRDPzJjdq%2B4Wklc%2FoWPH%2Ba5P9I8%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0155cc21e5b54c5688ad61e98edc1aa7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=Xq4PiNQM4j4FGFeoXTfwWYGtwPk%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f59dece1fbb9414cab43a3870fb79e3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=nI%2F4XFxihXuRBmmONz1KSwww3EE%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> |</p>
<p>| 终端集成 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1baa3228ee1943b59ae3bb0bf242a93a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=yrigUaAOeeMjWiihPUuAGiE4AIg%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cddba2b9670d4bd898cc96a2761ffe90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=bMVE554d1x4Q6gkY5GZO3pZyvKU%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/598eba58ff694f8f94a78acd9a6070b8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=lSE3mAYP4WEIKLxWQ%2BTvqujcQsE%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> |</p>
<p>| 本土化体验 | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/697b19d6f90a4446a51b0ba876b736c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=EEfOP0012RWoy5%2Bba8UzlS65AcA%3D" alt=":white_check_mark:" title=":white_check_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27e40973f9384c998d9f2ccb75e0f3cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=WrzBzyC%2BWf%2FMLc5IlVkvpmrQr%2Bc%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> | <img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8e2f79ca7bd459aba2ea929ae9c606e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231045&amp;x-signature=ioZcxTAL1xAEoupUx230SrqevYA%3D" alt=":cross_mark:" title=":cross_mark:" loading="lazy"/> |</p>
<h2 data-id="heading-33">总结</h2>
<p>iFlow CLI作为一款强大的终端AI助手，为开发者提供了全新的编程体验。通过自然语言交互，开发者可以更专注于创意和逻辑，而将具体实现细节交给AI助手处理。</p>
<p>本文通过详细介绍iFlow CLI的安装方法和一个完整的Web应用开发案例，展示了这款工具的强大功能和易用性。从项目初始化到功能实现，iFlow CLI都能提供有力的支持。</p>
<p>随着AI技术的不断发展，像iFlow CLI这样的智能编程工具将成为开发者的重要伙伴，帮助我们更高效地完成各种开发任务。</p>
<h3 data-id="heading-34">未来展望</h3>
<p>iFlow CLI团队还在不断更新和完善产品，未来可能包括：</p>
<ul>
<li>更多国产模型的集成</li>
<li>更丰富的SubAgent生态</li>
<li>更强大的项目分析能力</li>
<li>更完善的开发工作流</li>
</ul>
<p>如果你还在为复杂的编程任务而困扰，不妨试试iFlow CLI，体验AI编程带来的全新体验！</p>
<hr/>
<p><em>本文介绍了iFlow CLI的基本安装方法和开发应用案例，希望能帮助开发者们更高效地使用这一强大工具。如需更多信息，请访问iFlow CLI官方网站和文档。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[架构提效的矛盾和矛盾的主要方面]]></title>    <link>https://juejin.cn/post/7574621387572838446</link>    <guid>https://juejin.cn/post/7574621387572838446</guid>    <pubDate>2025-11-20T08:08:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574621387572838446" data-draft-id="7574621387572576302" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="架构提效的矛盾和矛盾的主要方面"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-20T08:08:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            架构提效的矛盾和矛盾的主要方面
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:08:48.000Z" title="Thu Nov 20 2025 08:08:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在软件开发领域，架构设计是确保系统高效、稳定运行的重要环节或者称之为重要动作。无论架构从简单到复杂，还是从复杂回归简洁的演变过程。在这个过程中，又无论是初创公司还是大型企业，架构提效始终是技术团队的核心追求。本文将从稳定、性能、代码三大维度出发，结合实战经验，探讨如何有效提升架构效能。</p>
<p>为什么要选择或者认为这三个维度是必要要素呢？</p>
<blockquote>
<p>“一切事物中包含的矛盾方面的相互依赖和相互斗争，决定一切事物的生命，推动一切事物的发展。没有什么事物是不包含矛盾的，没有矛盾就没有世界。”</p>
</blockquote>
<p>当然架构也有自身的矛盾统一，在架构提效上，系统的运行正常和问题频出是一对矛盾，功能的快和慢是一对矛盾，工程的整洁有序和无序是一对矛盾。这三对矛盾正是架构提效的矛盾。</p>
<p>如果不稳定，系统三天两头出故障，研发人员成了救火队员，系统的效率将无从谈起，稳定是我们谈架构效率的基础。如果性能不高，在网络基础环境稳定的情况下，访问一个页面3S才响应，那我们也不好意思说架构有效率。如果代码乱成一锅粥，比如大段大段面条式的代码，再比如满眼望去N多个if结构语句，研发人员加一个功能都要查找好久，也是无颜谈效率。</p>
<p>因此，我们认为，稳定、性能、代码是架构提效矛盾中的主要方面。接下来我们将从这三个主要方面去介绍。</p>
<p>软件工程发展了这么多年，高可用、高扩展、高并发已经有大量的文章篇幅，从宏观的角度去讲如何做微服务、如何分库分表，如何使用缓存等等。因此呢，本篇文章想聚焦到架构矛盾的微观层面，也就是偏工程结构、偏代码方面去阐述这三个要素。另外本篇文章的思想也参考了前辈们的研究成果，我也附在了文末。</p>
<p><strong>稳定：架构的基石与守护神</strong></p>
<p>“万事万物都是运动的，发展的”。业务功能变多，用户数量变多，团队规模变大。如果没有规则和规范的引导和约束，系统逐渐野蛮生长，逐渐碎片化。那么，我们的系统何谈稳定呢。</p>
<p>我们就希望能找到这样的一种规则、规范 -- 正交分解或者叫做正交设计。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4701579a6f7e4ef9bb95a9cc66ba76f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230928&amp;x-signature=X6JEv09vRwQG67EFrmOsyCXN96s%3D" alt="image.png" loading="lazy"/></p>
<p>架构设计的过程就是一个业务正交分解的过程。</p>
<p><strong>架构设计并不仅仅是技术层面的规划，更重要的是对业务逻辑的深入理解和把握。通过正交分解，我们可以将复杂的业务系统拆解成若干个相互独立但又彼此关联的模块或组件。这些模块或组件在保持功能完整性的同时，还能实现高度的内聚和松散的耦合，从而提高系统的可扩展性、可维护性和可重用性。</strong></p>
<p>正交分解的关键在于消除重复、分离关注点和管理依赖。通过这一方法，我们可以将业务系统中的公共部分和可变部分进行明确的划分，从而实现对业务逻辑的精准掌控。在架构设计过程中，我们需要不断地对业务进行抽象和分解，直至得到一系列规模可控、结构清晰的小模块。这些小模块通过组合和协作，能够形成更加复杂且功能完善的软件系统。</p>
<p>因此，正交分解的思想是我们架构设计保障稳定的重要方法基础。</p>
<p><strong>性能：速度与效率的双重考验</strong></p>
<p>想快，就使用“战术设计”。曾经这是很多程序员的法宝，因为他们认为这样开发“确实快”。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f19c2a19ca841879052a09a529928c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230928&amp;x-signature=G8vY7LbSK4ePQEsvqN4yawaaHnM%3D" alt="image.png" loading="lazy"/></p>
<p>大多数程序员以称为战术编程的心态来进行软件开发。在战术方法中，主要重点是使某些功能正常工作，例如新功能或错误修复。乍一看，这似乎是完全合理的：还有什么比编写有效的代码更重要的呢？但是，战术编程几乎不可能产生出良好的系统设计。</p>
<p>想快的“战术设计”会造成常见的下面这样的情况。</p>
<p><strong>“团队新人不熟悉系统，为了急于上线一个特性，又不想影响到系统的其他部分，就会很自然地在某个地方加一个 flag，然后在所有需要改动的地方加 if 判断，而不是去调整系统设计以适应新的问题空间。”</strong></p>
<p>在一个充满活力的软件开发团队中，新成员小张刚刚加入不久。他对于团队正在使用的复杂系统还不是很熟悉，但面对紧迫的项目进度和上级施加的压力，他急于证明自己，并希望能尽快为团队做出贡献。团队正计划上线一个新的特性，这个特性需要在不干扰系统其他部分的前提下实现。</p>
<p>小张在浏览了系统的代码库后，发现要全面理解并调整整个系统设计以适应新的特性，需要花费大量的时间和精力。他深知自己作为新人，在这方面还有所欠缺，因此，他决定采取一个他认为更为“高效”的方法：在某个关键位置添加一个临时的标志位（flag），然后在所有需要改动的地方都加上if判断，以确保新特性能够按时上线，同时尽量减少对现有系统的影响。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cc186e29b0147d3b81e38b406a94689~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230928&amp;x-signature=sIk5G3Xomu9fEJ7YvoFi8Wu9gUI%3D" alt="image.png" loading="lazy"/></p>
<p>虽然这种方法在短时间内确实让新特性得以顺利上线，但团队中的资深成员很快便发现了潜在的问题。这种做法虽然看似快速解决了问题，但实际上却在系统中埋下了隐患。它不仅增加了代码的复杂性，降低了代码的可读性和可维护性，还可能在未来引发更多的bug和性能问题。更重要的是，这种做法违背了软件开发中的最佳实践，<strong>即应通过优化系统设计来适应新的问题空间，而不是通过添加临时性的补丁来解决问题。</strong></p>
<p><strong>“几乎每个软件开发组织都有至少一个将战术编程发挥到极致的开发人员：战术龙卷风”，而且常常被视为团队”英雄“，因为能“快速完成任务且高产”。</strong></p>
<p>“战术龙卷风”通常以战术编程为主要手段，即采用最快速、最直接的方法来解决当前的问题，而不考虑长远的影响和代码的可持续性。这种方法在初次使用时往往能够取得显著的效果，任务完成得既快又好，赢得了团队成员的赞誉和领导的认可。</p>
<p>然而，随着时间的推移，“战术龙卷风”所留下的隐患逐渐暴露出来。由于缺乏对系统设计的深入理解和长远规划，他的代码往往难以维护和扩展。当需要添加新功能或修复bug时，团队成员往往需要花费更多的时间和精力来理解和修改他的代码。因此，第二次和第三次修改时，效率会大幅下降，甚至可能引发新的问题。</p>
<p>实际造成结果：第一次快、第二次慢、第三次更慢。</p>
<p><strong>代码：简洁与优雅的双重追求</strong></p>
<p>我们做业务开发，代码的优雅简洁，不能局限在一段方法，还是要从整个工程结构然后在到类、到方法，这样从宏观到中观再到微观的整体去要求。我们的应用工程结构，常见大致分为四层。分别是api层、biz层、domain层和dao层。</p>
<p>这个时候我们就要很清晰地熟悉每一层的职责，然后将我们的代码放入进去。首先，api层的作用，正如它的名字一样，是提供api服务的。向谁提供api呢，比如客户端，比如APP端、pc端等等，公司外面的客户，比如isv等。其次，biz层的作用，这一层也叫业务服务层。它主要负责编排。把一个业务场景下的主流程逻辑处理完成。这个主流程会涉及到多个原子接口，就在这层负责组装。再次，domain层的作用，也叫做领域服务层。按照OO思想，领域编程的思维，我们的”厚对象“的代码都在这层。比如订单域、运费域等。这里对“这一层的位置”多说几句，在没有形成领域之前，这层一般叫service层，不过我们都是建议领域思维编写代码。最后是dao层，也就是我们的存储层了，负责持久化。</p>
<p>在清晰了每一层的作用之后，如果我们的代码职责也是按照这样逐层放入的，那么大体是符合我们的整洁要求的。但是呢，随着时间的推移，需求的增多和变化。原来整洁的工程结构和代码已经不那么优雅了。</p>
<p><strong>这个时候，一般会出现两类现象，一类是业务层（biz）变的臃肿，能力层（domain）变的单薄。另一类是出现了网状调用。而且这两类现象也很有可能是混合在一起出现。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b367953438843b6bff7bb3a28d9cd8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230928&amp;x-signature=cSJBvD5QX55aVA6DrtmX0Ls4T2Y%3D" alt="image.png" loading="lazy"/></p>
<p>这两类现象会直接带来下面4种结果。</p>
<p>1、biz层越来越”胖“。胖了之后，还长成了两小层。上小层是面向单一业务场景的“业务biz层”，下小层成了通用场景可复用的“通用biz层”。</p>
<p>2、service层越来越”瘦“。当service层变薄了以后，也就只能沦为service了，而这样的service层跟dao层实际没什么区别，更不能再称之为domain层或者没有机会演变成domain层。</p>
<p>3、但是也不是所有的service层都变瘦、变薄了。可能有的萎缩，有的膨胀。人员与设计的差异，导致颗粒度不一。</p>
<p>4、出现了网状调用。原本biz-1 -&gt; service-1 的实现链路下，随着新增业务逻辑，又新起了一个service-2，链路演变成了biz-1 -&gt; service-1-&gt; service-2。“这样的趋势持续发展下去，会发现biz-1下的service调用链路越发的复杂，呈现为一颗深度调用树，而biz层失去了业务编排的作用退化为一个业务场景入口的标志符”。有可能后面继续3-4-5-6，越挖越深，不见尽头。</p>
<p>很显然，到这里，这样的结构现状，代码现状，已经远离了我们简洁和优雅的初衷。也谈不上提效了。</p>
<p>到此，我们介绍了架构提效中的稳定、性能和代码这三个主要的方面，限于篇幅和架构本身的实践性，还需要我们在架构提效上进行持续的优化。需要我们在稳定、性能、代码三大维度上不断探索和实践。通过高可用架构设计、性能优化策略、模块化与解耦、代码质量与规范等措施，我们可以构建一个既稳定又高效，且易于维护和扩展的系统。</p>
<blockquote>
<p>“在复杂的事物发展过程中，有许多的矛盾存在，其中必有一种是主要的矛盾，由于它的存在和发展规定和影响着其他矛盾的存在和发展。”</p>
</blockquote>
<p>架构的发展本身也是对抗熵增这一矛盾的过程，我们上面描述的稳定、性能和代码中的矛盾方面有是围绕和关联这一主要矛盾的。在这个过程中不仅有系统的有序变无序，也有组织的简单变复杂。我们既要关注技术层面的提升，更要注重团队协作、知识共享和持续改进的文化建设。只有这样，我们才能在快速变化的市场环境中，保持竞争力，不断前行。</p>
<p>最后，如果您对文章中的表述和观点有任何问题，亦或者您当前也正在致力于架构提效方面的工作，我们可以一起学习交流，微信号：wangxindong2015。</p>
<p>REF：<br/>
1、<a href="https://link.juejin.cn?target=https%3A%2F%2Ftime.geekbang.org%2Fcolumn%2Farticle%2F167844" target="_blank" title="https://time.geekbang.org/column/article/167844" ref="nofollow noopener noreferrer">time.geekbang.org/column/arti…</a> 如何判断架构设计的优劣<br/>
2、<a href="https://link.juejin.cn?target=https%3A%2F%2Fcactus-proj.github.io%2FA-Philosophy-of-Software-Design-zh%2F" target="_blank" title="https://cactus-proj.github.io/A-Philosophy-of-Software-Design-zh/" ref="nofollow noopener noreferrer">cactus-proj.github.io/A-Philosoph…</a> 软件设计的哲学<br/>
3、<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FjJzzJIGozOpt7KaXwBS3Ww" target="_blank" title="https://mp.weixin.qq.com/s/jJzzJIGozOpt7KaXwBS3Ww" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/jJzzJIGoz…</a> 业务系统架构实践总结<br/>
4、《矛盾论》，《毛泽东选集》第一卷</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[设计模式-策略模式]]></title>    <link>https://juejin.cn/post/7574369095545208866</link>    <guid>https://juejin.cn/post/7574369095545208866</guid>    <pubDate>2025-11-20T08:11:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574369095545208866" data-draft-id="7574601160980987919" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="设计模式-策略模式"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-20T08:11:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            设计模式-策略模式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:11:58.000Z" title="Thu Nov 20 2025 08:11:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h5 data-id="heading-0">一、概念</h5>
<p>策略模式（Strategy Pattern）也称为（Policy Parttern）。 它定义了算法家族，分别封装起来，让它们之间可以互相替换，此模式让算法的变换，不会影响到使用算法的客户。策略模式属性行为模式。</p>
<p>策略模式结构图<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e29dc6f4c524494d8852178d25a41593~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231118&amp;x-signature=la88RVSjLexw7oLo7TRUyfqDEFs%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-1"><strong>二、实际应用</strong></h5>
<p>业务场景：业务需要监听多种消息，将接收到的消息更新到同一个ES中，不同的消息类型使用不同的策略处理，补充不同的数据信息，更新到ES中，供商家搜索和统计使用。</p>
<p>代码实现结合spring框架、简单工厂和策略模式一起使用。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">GatherExecuteService</span> {    
    <span class="hljs-comment">/**     
    * 处理消息体     
    *     
    * <span class="hljs-doctag">@param</span> gatherDataVo     
    */</span>    
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(GatherDataVo gatherDataVo)</span>;
}
</code></pre>
<p>多个实现类</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 价格策略实现</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PriceExecuteServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GatherExecuteService</span> {    
    <span class="hljs-meta">@Override</span>    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">GatherDataVo gatherDataVo</span>) {
         .....具体实现代码省略   
    }
}
</code></pre>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 商品策略实现</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductExecuteServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GatherExecuteService</span> {  

    <span class="hljs-meta">@Override</span>    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">GatherDataVo gatherDataVo</span>) {  

        .....具体实现代码省略  
    }
}
</code></pre>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 库存策略实现</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StockExecuteServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">GatherExecuteService</span> {    
    <span class="hljs-meta">@Override</span>    
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">GatherDataVo gatherDataVo</span>) {   
     .....具体实现代码省略  

     }
}
</code></pre>
<p>使用枚举存储策略实现bean</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Getter</span>
<span class="hljs-meta">@AllArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">MessageTypeEnum</span> {    
    <span class="hljs-title function_">PRODUCT</span>(<span class="hljs-number">0</span>, <span class="hljs-string">"productExecuteServiceImpl"</span>, <span class="hljs-string">"商品基本信息消息"</span>),    
    <span class="hljs-title function_">PRICE</span>(<span class="hljs-number">1</span>, <span class="hljs-string">"priceExecuteServiceImpl"</span>, <span class="hljs-string">"价格消息"</span>),    
    <span class="hljs-title function_">STOCK</span>(<span class="hljs-number">2</span>, <span class="hljs-string">"stockExecuteServiceImpl"</span>, <span class="hljs-string">"库存消息"</span>) ;    
    <span class="hljs-keyword">private</span> int <span class="hljs-keyword">type</span>;    
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> service;   
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> description;    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getServiceName</span>(<span class="hljs-params">int <span class="hljs-keyword">type</span></span>) {        
        <span class="hljs-title class_">MessageTypeEnum</span>[] typeEnums = <span class="hljs-title class_">MessageTypeEnum</span>.<span class="hljs-title function_">values</span>();        
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">MessageTypeEnum</span> enumType : typeEnums) {            
            <span class="hljs-keyword">if</span> (enumType.<span class="hljs-title function_">getType</span>() == <span class="hljs-keyword">type</span>) {                
                <span class="hljs-keyword">return</span> enumType.<span class="hljs-title function_">getService</span>();            
            }     
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;    
    }
}
</code></pre>
<p>使用到不同策略的代码</p>
<pre><code class="hljs language-ini" lang="ini">// 根据消息类型获取不同策略类，然后使用spring的ApplicationContext获取bean，达到执行不同策略的目的。
String <span class="hljs-attr">serviceName</span> = MessageTypeEnum.getServiceName(gatherDataVo.getMessageType())<span class="hljs-comment">;</span>
if (StringUtils.isNotBlank(serviceName)) {  
    GatherExecuteService <span class="hljs-attr">gatherExecuteService</span> = (GatherExecuteService) SpringContextUtil.getBean(serviceName,                      GatherExecuteService.class)<span class="hljs-comment">;  </span>
}
</code></pre>
<p>策略模式是一种比较简单的设计模式，工作中经常和其他设计模式一块使用。简单的应用记录分享一下。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【A/B实验常见问题】实验异常值应该如何处理？]]></title>    <link>https://juejin.cn/post/7574404398066647040</link>    <guid>https://juejin.cn/post/7574404398066647040</guid>    <pubDate>2025-11-20T08:11:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574404398066647040" data-draft-id="7574600119750377482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【A/B实验常见问题】实验异常值应该如何处理？"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2025-11-20T08:11:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="京东云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2634854380340008"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【A/B实验常见问题】实验异常值应该如何处理？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2634854380340008/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    京东云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:11:27.000Z" title="Thu Nov 20 2025 08:11:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>背景</strong></h2>
<p>大家在做实验时有没有遇到过以下的问题？</p>
<blockquote>
<p>实验分流不太稳定，多次分流以后，发现随机分组历史数据指标波动特别大 实验结果不符合预期，在去掉几个特殊用户后结果变化较大、甚至正负反转 不同的业务场景设置的指标过滤规则不同，例如A场景过滤掉了成单超过100单的用户、但B场景没有过滤，实验指标应该选择哪个</p>
</blockquote>
<p>这里实验者大概率是遇到了实验中的异常值问题，我们接下来会讨论在互联网AB实验场景中，应该如何进行处理？</p>
<h2 data-id="heading-1"><strong>概念解析</strong></h2>
<p>从严格的学术角度来看，异常值并没有一个统一的定义和划分标准，在不同的领域会根据使用目的和数据特点有不同的定义逻辑和检验方法。即我们可以得到“在一个样本或集合中，与其余样本均有较大差异的样本点就是异常值”这样一个通用、模糊的概念，但具体差异较大的判定标准是什么，检测差异的方法有哪些，场景之间各不相同。</p>
<p>举个例子，很多人都听说过的3sigma原则指的是：如果一个样本取值超过了</p>
<p>均值±3∗标准差均值±3∗标准差</p>
<p>﻿这个范围，那么就属于异常值。但这个标准通常假设了样本的分布属于正态分布或者近似正态分布，对于互联网公司的幂律分布指标适用性较差，我相信大家都能感受到“JD大盘Top1%的用户成单GMV都是异常值”这个结论有多么的离谱。</p>
<p>﻿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50238b71d72f487bb3caec39fe80fc46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=gpX%2Fvi787UOTkVgTmzcnW0JW%2Ff8%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>﻿</p>
<p>基于上述思考，后续研究中我们会着重研究在大样本、幂律分布等和互联网AB实验面临状况比较相似的情况，并参考比如调研分析、社会学等直接收集人类社会经济活动数据的学术分枝统计方法，以及新兴的算法方向的异常值检测、处理方法。</p>
<p>﻿</p>
<h2 data-id="heading-2"><strong>异常值产生的基本原因</strong></h2>
<p>•数据收集过程中的测量误差（工具误差）</p>
<p>•群体中个体的差异性（抽样带来的随机性）</p>
<p>•数据造假、作弊（刷单）</p>
<p>•收集的样本来源于不同的群体（比如京东App中有很多背后是B端的用户）</p>
<p>﻿</p>
<h2 data-id="heading-3"><strong>AB实验中异常值剔除的作用与局限性</strong></h2>
<h3 data-id="heading-4"><strong>1.为什么AB实验需要进行异常值处理？</strong></h3>
<p>•有一小部分异常用户，由于数据分布非常异常，造成了分流时无法将这一批用户每一次都很完美的均匀分布在实验组、对照组，异常用户在哪、哪个组就会出现AA不均匀的情况</p>
<p>•由于异常用户的指标值较大，造成了整体指标的波动性较大，让实验的精度变差、样本量需求变大，原本可以观测的实验效果就会被淹没在噪音中（指标方差较大带来实验最小提升量-MDE较大）</p>
<h3 data-id="heading-5"><strong>2.异常值剔除方案的局限性</strong></h3>
<p>•做不到的：无法识别业务逻辑中认定的异常值以及异常用户（比如xx用户命中了xx风控规则，所有数据不可信），无法识别指标统计错误（比如某用户1天内在一个页面的停留时长超过24H）</p>
<p>•能做但做不好的：降低指标的波动性，但同时可能会去掉了部分有效样本和有效数据，会让样本产生偏差（bias）。此时需要用更多的样本才能进行更灵敏的实验，或使用ANCOVA、CUPED等方差缩减的方法。</p>
<p>﻿</p>
<h2 data-id="heading-6"><strong>传统统计学方法的应用——</strong> <strong>trim &amp; winsorize方法对于补贴实验的效果对比</strong></h2>
<h3 data-id="heading-7"><strong>1.什么是trim方法与winsorize方法，为什么选择这些方法？</strong></h3>
<p>这两种方法其实源自于上个世纪的调研分析方法，当年的统计学家除了会遇到样本量不足的问题外，也会遇到在样本收集、统计过程中发生错误而导致的异常值。在当年各种算法技术、算力限制的情况下，统计学家会通过观察、处理当前数据指标分布的方式，对样本进行更加稳健的估计。具体来看</p>
<p>◦Winsorizing（或缩尾法）：当样本点的取值超过样本的特定分位数后，将取值直接替换为分位数值</p>
<p>◦Trimming（或去尾法）：当样本点的取值超过样本的特定分位数后，将样本点直接丢弃</p>
<h3 data-id="heading-8"><strong>2.数据表现</strong></h3>
<p>•我们使用异常值处理后对样本均值、标准差的影响作对比，可以发现在同样的分位数下，trimming方法通常会有更大的效果。</p>
<p>﻿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/717091cfe3794b2eafb212f0d811d7fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=L3RgNTd%2F0a388Vtn9EE2QuTjv2I%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>•但如果我们忽略掉具体的分位数选择，直接对比方法的损失（横轴，均值估计偏差）与收益（纵轴，方差缩减效果），可以发现winsorize方法更具有优势，即在相同的均值估计偏差下，有更大的方差缩减效果（即下图中，左下角更好）。</p>
<p>﻿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/220dcaa8f3ca423391666243eddb9b31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=79YlGIUAlT7Jt5JcgMF7itgC2ag%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p>•方法对于实验的一类、二类错误影响如下👇</p>
<p>﻿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5c3a827dde046259828e64d4dbbfa69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=piPhPeNaINEIn8g2f3O58K5LeH4%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<h3 data-id="heading-9"><strong>3.方案原理、效果对比</strong></h3>
<p>•在我们认为实验收集到的样本基本都是正常数据，只是分布比较分散时，不要轻易丢弃样本点，以防止损失样本对应的信息，此时Winsorizing（或缩尾法）相对是一个更加稳健的做法</p>
<p>•当样本中包含了很多脏数据和异常用户时（例如作弊、刷单用户），他们带来的信息会将会影响到样本的分布状态，那么使用trimming方法去掉他们会尽可能减弱此类影响</p>
<p>•在没有很多的业务输入情况下，可以根据数据的分布特征，并用winsorizing方法进行相对保守的异常值处理。</p>
<h3 data-id="heading-10"><strong>4.业务落地建议</strong></h3>
<p>•对于不同场景、不同类型的指标，业务需要根据自身场景特点，尽量排除脏数据、刷单作弊数据等异常情况</p>
<p>•对于本场景的重点指标，可以由分析人员进行一次性的分析，在得到合理的处理方案后可以尝试固化在实验平台</p>
<p>﻿</p>
<h2 data-id="heading-11"><strong>风控模型的应用</strong></h2>
<p>风控模型在内容时长指标异常值处理的应用👇</p>
<p>例：某实验在2024-09-30对照组出现人均时长指标异常增加的情况，影响实验观测。</p>
<p>﻿</p>
<p>﻿</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4c817d367f04ce8a2862323e207faea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=YORDXP1oOcgncJ6g9%2F45pz%2BxfRs%3D" alt="" loading="lazy"/></p>
<p>﻿﻿</p>
<p><em>注：数据已经做脱敏处理</em></p>
<p>通过排查发现若干异常用户的作弊行为，反馈风控团队进行剔刷。剔刷后，作弊用户数据有效减少。另一方面，从实验信息上报的角度，采用服务端上报也可以从一定程度避免异常用户进入实验，减少异常值，让实验数据更可靠。</p>
<p>﻿</p>
<h2 data-id="heading-12"><strong>一些异常值检测方法的介绍</strong></h2>
<p>从实验平台功能建设上，往往采用计算量较小的较为通用的方案；一种适用于实验平台的异常值检测方法：当峰度大于某个阈值时，取 top x%极大值作为异常样本。其核心思想是根据数据分布判断是否需要进行异常值处理，然后通过分位数划定异常样本范围。</p>
<p>•<em>峰度：对实值随机变量的概率分布的尾部的度量，峰度高就意味着方差增大是由低频度的大于或小于平均值的极端差值引起的。峰度计算公式如下：</em></p>
<p>γ2=μ4/σ4−3γ2​=μ4​/σ4−3</p>
<p>﻿ <em>，其中</em></p>
<p>μ4μ4​</p>
<p>﻿<em>表示四阶矩。</em></p>
<p>对于特定的数据，Z-score等简单方法效果不佳时，我们也可以使用较为复杂的方法进行处理。下面是一些异常值检测方法的简单</p>





















































































































<table><thead><tr><th>﻿</th><th><strong>方法</strong></th><th><strong>基本原理</strong></th><th><strong>优点</strong></th><th><strong>缺点</strong></th></tr></thead><tbody><tr><td>统计和概率模型</td><td>箱线图</td><td>基于1.5倍IQR划定异常值阈值。</td><td>直观、简便。</td><td>自适应较差，对于部分数据分布会完全失效。</td></tr><tr><td>Z-score方法</td><td>基于数据标准化变换得到Z-score。正态分布可基于3sigma原则判断；一般分布可基于Chebyshev不等式；样本有界可基于Hoeffding不等式‌；对于高维空间，可基于样本与均值的马氏距离计算Z-score。</td><td>直观、简便。</td><td>样本统计量的估计受异常值影响；3sigma原则要求总体需服从正态分布；Chebyshev不等式需要合理选取阈值；高维空间需要矩阵求逆，计算量较大。</td><td/></tr><tr><td>Grubbs方法</td><td>基于样本的均值、最大值和最小值进行异常值检验。</td><td>避免方差受异常值干扰的影响。</td><td>通常只适用于小样本。</td><td/></tr><tr><td>基于方差贡献</td><td>寻找样本子集，使得样本在移除该子集前后基于方差定义的损失函数。</td><td>直观、简便。</td><td>直接计算子集无法在多项式时间内求解， 需要启发式算法，计算量较大。</td><td/></tr><tr><td>EM算法</td><td>可基于给定先验分布和群数计算各样本点分布的概率密度，基于概率密度判断异常值。</td><td>能够解决一般方法的打分阈值难选择的问题。</td><td>需要比较强的先验假设，计算量较大。</td><td/></tr><tr><td>绝对离差中位数</td><td>计算绝对离差。取其中位数，衡量异常值。</td><td>由于使用中位数，可以有效对抗异常值带来的影响。</td><td>自适应较差，对于部分数据分布会完全失效。</td><td/></tr><tr><td>基于机器学习算法</td><td>ODIN/LOF/LOCI</td><td>基于距离或者密度估计的异常值检测方法。</td><td>有一定的自适应性，能够根据相对疏密程度判断异常值</td><td>计算量较大。</td></tr><tr><td>直方图/Parzen窗函数概率密度估计</td><td>使用给定的分布计算各个样本点附近生成概率，加和构成估计的概率密度函数。</td><td>直观，简便，没有对分布的先验假设。</td><td>窗宽度是一个超参数，计算量较大。</td><td/></tr><tr><td>基于回归残差</td><td>基于先验知识拟合特征间的回归曲线，并基于拟合残差判定异常值，有时为了避免异常值对拟合结果产生影响，可以进行抽样。</td><td>直观，简便，在先验知识正确的前提下，检测结果较好。</td><td>需要较强的先验假设，异常值对回归拟合可能产生较大影响。</td><td/></tr><tr><td>PCA</td><td>将n维数据投影至k维平面上，在中心化的数据中，剩余k维向量范数较大的样本被判定为异常值。</td><td>可处理高维流行空间的异常值问题。</td><td>超参数k难以选择，如果需要使用PCA，核函数的选择需要先验知识。</td><td/></tr><tr><td>矩阵分解</td><td>将原矩阵分解为两个低秩矩阵，并将原数据用这两个低秩矩阵表出，将残差较大的样本判定为异常值。PCA本质上也可以理解为一种矩阵分解方法。</td><td>能够处理数据缺失问题。</td><td>仅适用于线性情况。</td><td/></tr><tr><td>autoencoder</td><td>使用给定数据训练自编码器，其编码器部分可以视作非线性降维方法，通过比较autoencoder的输入和输出差异，进行异常值判别。</td><td>引入非线性，通过自监督方式解决异常值检测缺乏训练标签的问题。</td><td>计算量较大。</td><td/></tr><tr><td>One-Class SVM</td><td>将所有样本视为1类，基于软间隔最大化训练支持向量机，并将跨过分隔平面的样本判定为异常值。</td><td>可通过核函数引入非线性。</td><td>核函数计算量较大。</td><td/></tr><tr><td>Isolation Forest</td><td>通过无监督方法构造一颗或多棵树，通过节点深度衡量异常程度。</td><td>通过抽样方法构建子树，使方法具有很高的效率。通过峰度系数选择特征，可以进一步提升子空间选择效率。</td><td>阈值的选择通常较为困难，且对不同的情况需要选择不同的阈值。</td><td/></tr><tr><td>Robust Random Cut Forest</td><td>改进Isolation Forest，对于特征选择概率依赖于各个维度的range。</td><td>相比改进Isolation Forest，对于特征选择的效率更高。</td><td>阈值的选择通常较为困难，且对不同的情况需要选择不同的阈值。</td><td/></tr></tbody></table>
<p>﻿</p>
<h2 data-id="heading-13"><strong>附录</strong></h2>
<p>实验波动性和实验精确度的关系：在计算实验效果时，利用实验组、对照组的均值、方差、样本量可以进行实验效果的假设检验，公式如下:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ab7d353310940f4896aa3cd2a131293~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=QOsRQGebERwBeTydWColK4de83M%3D" alt="image.png" loading="lazy"/></p>
<p>其中,</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8164ff9e4efe4695a1d0e77cc9ede1aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqs5Lic5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764231086&amp;x-signature=jG3%2FwxFX4mtZWdgoNm7TFpZljrA%3D" alt="image.png" loading="lazy"/></p>
<p>E(ATE)=μT−μCvar(ATE)=σATE2=σT2nT+σC2nCE(ATE)=μT​−μC​var(ATE)=σATE2​=nT​σT2​​+nC​σC2​​</p>
<p>﻿﻿</p>
<p>可以看到，如果实验的波动性（var(ATE)）越大，在实验效果（E(ATE)）不变的情况下，那T统计量就越小，实验就越不容易显著（精度较差）；此时就需要减小var(ATE)，即通过改变样本方差和样本量来减小样本波动性。</p>
<p>﻿</p>
<p><strong>关于我们</strong></p>
<blockquote>
<p>试金石作为京东零售统一的AB实验平台，致力于通过数据驱动的AB测试方法，进行科学的实验设计和数据分析，为业务提供客观、可靠的实验结果，帮助业务持续优化产品和服务；让业务能够自助、高效的运行实验，科学的进行业务决策，赋能业务持续迭代。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Axios 拦截器]]></title>    <link>https://juejin.cn/post/7574404398066483200</link>    <guid>https://juejin.cn/post/7574404398066483200</guid>    <pubDate>2025-11-20T07:42:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574404398066483200" data-draft-id="7574529034672767011" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Axios 拦截器"/> <meta itemprop="keywords" content="前端,axios"/> <meta itemprop="datePublished" content="2025-11-20T07:42:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="新晨437"/> <meta itemprop="url" content="https://juejin.cn/user/3957868231143133"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Axios 拦截器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3957868231143133/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    新晨437
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:42:11.000Z" title="Thu Nov 20 2025 07:42:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Axios 拦截器是 Axios 库中非常强大的功能，它允许你在请求发送前或响应返回后对数据进行处理。下面详细介绍 Axios 拦截器的使用方法：</p>
<h2 data-id="heading-0">1. 请求拦截器</h2>
<h3 data-id="heading-1">基本用法</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

<span class="hljs-comment">// 添加请求拦截器</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-keyword">function</span> (<span class="hljs-params">config</span>) {
    <span class="hljs-comment">// 在发送请求之前做些什么</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'请求配置:'</span>, config);
    <span class="hljs-keyword">return</span> config;
  },
  <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-comment">// 对请求错误做些什么</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);
</code></pre>
<h3 data-id="heading-2">实际应用场景</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加认证 token</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> token = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'token'</span>);
    <span class="hljs-keyword">if</span> (token) {
      config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>;
    }
    <span class="hljs-keyword">return</span> config;
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);

<span class="hljs-comment">// 添加公共参数</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    config.<span class="hljs-property">params</span> = {
      ...config.<span class="hljs-property">params</span>,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
      <span class="hljs-attr">version</span>: <span class="hljs-string">'1.0.0'</span>
    };
    <span class="hljs-keyword">return</span> config;
  }
);
</code></pre>
<h2 data-id="heading-3">2. 响应拦截器</h2>
<h3 data-id="heading-4">基本用法</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加响应拦截器</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-keyword">function</span> (<span class="hljs-params">response</span>) {
    <span class="hljs-comment">// 2xx 范围内的状态码都会触发该函数</span>
    <span class="hljs-comment">// 对响应数据做点什么</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'响应数据:'</span>, response);
    <span class="hljs-keyword">return</span> response;
  },
  <span class="hljs-keyword">function</span> (<span class="hljs-params">error</span>) {
    <span class="hljs-comment">// 超出 2xx 范围的状态码都会触发该函数</span>
    <span class="hljs-comment">// 对响应错误做点什么</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'响应错误:'</span>, error);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);
</code></pre>
<h3 data-id="heading-5">实际应用场景</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 统一处理响应数据</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-comment">// 如果后端返回的数据有统一格式，可以在这里处理</span>
    <span class="hljs-keyword">const</span> { data, code, message } = response.<span class="hljs-property">data</span>;
    
    <span class="hljs-keyword">if</span> (code === <span class="hljs-number">200</span>) {
      <span class="hljs-keyword">return</span> data;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 业务错误</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(message));
    }
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-comment">// 处理 HTTP 错误</span>
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>) {
      <span class="hljs-keyword">switch</span> (error.<span class="hljs-property">response</span>.<span class="hljs-property">status</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">401</span>:
          <span class="hljs-comment">// 未授权，跳转到登录页</span>
          <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">'/login'</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">403</span>:
          <span class="hljs-comment">// 禁止访问</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'没有权限访问该资源'</span>);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">500</span>:
          <span class="hljs-comment">// 服务器错误</span>
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'服务器内部错误'</span>);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-attr">default</span>:
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'请求失败:'</span>, error.<span class="hljs-property">message</span>);
      }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);
</code></pre>
<h2 data-id="heading-6">3. 完整示例</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>;

<span class="hljs-comment">// 创建 axios 实例</span>
<span class="hljs-keyword">const</span> instance = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://api.example.com'</span>,
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>,
});

<span class="hljs-comment">// 请求拦截器</span>
instance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">config</span>) =&gt;</span> {
    <span class="hljs-comment">// 显示 loading</span>
    <span class="hljs-title function_">showLoading</span>();
    
    <span class="hljs-comment">// 添加 token</span>
    <span class="hljs-keyword">const</span> token = <span class="hljs-title function_">getToken</span>();
    <span class="hljs-keyword">if</span> (token) {
      config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${token}</span>`</span>;
    }
    
    <span class="hljs-comment">// 记录请求开始时间</span>
    config.<span class="hljs-property">metadata</span> = { <span class="hljs-attr">startTime</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() };
    
    <span class="hljs-keyword">return</span> config;
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-title function_">hideLoading</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);

<span class="hljs-comment">// 响应拦截器</span>
instance.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function">(<span class="hljs-params">response</span>) =&gt;</span> {
    <span class="hljs-comment">// 隐藏 loading</span>
    <span class="hljs-title function_">hideLoading</span>();
    
    <span class="hljs-comment">// 计算请求耗时</span>
    <span class="hljs-keyword">const</span> endTime = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    <span class="hljs-keyword">const</span> duration = endTime - response.<span class="hljs-property">config</span>.<span class="hljs-property">metadata</span>.<span class="hljs-property">startTime</span>;
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`请求 <span class="hljs-subst">${response.config.url}</span> 耗时: <span class="hljs-subst">${duration}</span>ms`</span>);
    
    <span class="hljs-comment">// 统一处理响应格式</span>
    <span class="hljs-keyword">const</span> { code, data, message } = response.<span class="hljs-property">data</span>;
    
    <span class="hljs-keyword">if</span> (code === <span class="hljs-number">200</span>) {
      <span class="hljs-keyword">return</span> data;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 业务逻辑错误</span>
      <span class="hljs-title function_">showMessage</span>(message, <span class="hljs-string">'error'</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(message));
    }
  },
  <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
    <span class="hljs-comment">// 隐藏 loading</span>
    <span class="hljs-title function_">hideLoading</span>();
    
    <span class="hljs-comment">// 处理 HTTP 错误</span>
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span>) {
      <span class="hljs-keyword">const</span> { status, data } = error.<span class="hljs-property">response</span>;
      
      <span class="hljs-keyword">switch</span> (status) {
        <span class="hljs-keyword">case</span> <span class="hljs-number">401</span>:
          <span class="hljs-title function_">removeToken</span>();
          router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/login'</span>);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">403</span>:
          <span class="hljs-title function_">showMessage</span>(<span class="hljs-string">'没有权限访问该资源'</span>, <span class="hljs-string">'error'</span>);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-number">500</span>:
          <span class="hljs-title function_">showMessage</span>(<span class="hljs-string">'服务器内部错误'</span>, <span class="hljs-string">'error'</span>);
          <span class="hljs-keyword">break</span>;
        <span class="hljs-attr">default</span>:
          <span class="hljs-title function_">showMessage</span>(data?.<span class="hljs-property">message</span> || <span class="hljs-string">'请求失败'</span>, <span class="hljs-string">'error'</span>);
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">request</span>) {
      <span class="hljs-comment">// 请求发送失败</span>
      <span class="hljs-title function_">showMessage</span>(<span class="hljs-string">'网络连接失败，请检查网络'</span>, <span class="hljs-string">'error'</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 其他错误</span>
      <span class="hljs-title function_">showMessage</span>(error.<span class="hljs-property">message</span>, <span class="hljs-string">'error'</span>);
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error);
  }
);

<span class="hljs-comment">// 辅助函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">showLoading</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 显示 loading 的逻辑</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">hideLoading</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 隐藏 loading 的逻辑</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">showMessage</span>(<span class="hljs-params">message, type</span>) {
  <span class="hljs-comment">// 显示消息的逻辑</span>
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getToken</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'token'</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">removeToken</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'token'</span>);
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> instance;
</code></pre>
<h2 data-id="heading-7">4. 移除拦截器</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加拦截器时会返回一个 ID</span>
<span class="hljs-keyword">const</span> requestInterceptor = axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> config);
<span class="hljs-keyword">const</span> responseInterceptor = axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response);

<span class="hljs-comment">// 移除拦截器</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">eject</span>(requestInterceptor);
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">eject</span>(responseInterceptor);
</code></pre>
<h2 data-id="heading-8">5. 多个拦截器的执行顺序</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 拦截器会按照添加顺序执行</span>
axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第一个请求拦截器'</span>);
  <span class="hljs-keyword">return</span> config;
});

axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第二个请求拦截器'</span>);
  <span class="hljs-keyword">return</span> config;
});

axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第一个响应拦截器'</span>);
  <span class="hljs-keyword">return</span> response;
});

axios.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'第二个响应拦截器'</span>);
  <span class="hljs-keyword">return</span> response;
});

<span class="hljs-comment">// 执行顺序：</span>
<span class="hljs-comment">// 第一个请求拦截器 → 第二个请求拦截器 → 请求发送</span>
<span class="hljs-comment">// 第一个响应拦截器 ← 第二个响应拦截器 ← 响应返回</span>
</code></pre>
<h2 data-id="heading-9">6. 在特定实例中使用拦截器</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 创建不同的 axios 实例用于不同的 API</span>
<span class="hljs-keyword">const</span> authApi = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://auth.api.com'</span>
});

<span class="hljs-keyword">const</span> dataApi = axios.<span class="hljs-title function_">create</span>({
  <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'https://data.api.com'</span>
});

<span class="hljs-comment">// 为不同实例添加不同的拦截器</span>
authApi.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  <span class="hljs-comment">// 认证相关的拦截逻辑</span>
  <span class="hljs-keyword">return</span> config;
});

dataApi.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  <span class="hljs-comment">// 数据相关的拦截逻辑</span>
  <span class="hljs-keyword">return</span> config;
});
</code></pre>
<p>Axios 拦截器是一个非常实用的功能，可以帮助你统一处理请求和响应，减少重复代码，提高开发效率。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 changeset 新增组件库更新日志]]></title>    <link>https://juejin.cn/post/7574581079627333638</link>    <guid>https://juejin.cn/post/7574581079627333638</guid>    <pubDate>2025-11-20T08:11:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574581079627333638" data-draft-id="7574530224853204998" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 changeset 新增组件库更新日志"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-20T08:11:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="404号扳手"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919022807"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 changeset 新增组件库更新日志
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919022807/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    404号扳手
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:11:07.000Z" title="Thu Nov 20 2025 08:11:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>changeset</code> 是一个用于版本管理和变更日志记录的工具，常用于现代前端项目中。它可以帮助团队更好地跟踪每个更改的影响，并自动生成变更日志。
如果你想在 <code>changeset</code> 中新增组件库的日志，你需要创建一个新的 changeset 文件。这个文件通常是一个 Markdown 格式的文件，其中包含了你想要添加到变更日志中的信息。
以下是具体步骤：</p>
<ol>
<li>
<p>安装 Changeset CLI：如果你还没有安装 <code>@changesets/cli</code>，可以通过 npm 或 yarn 进行安装：</p>
<pre><code class="hljs language-bash" lang="bash">npm install @changesets/cli --save-dev
</code></pre>
<p>或者</p>
<pre><code class="hljs language-bash" lang="bash">yarn add @changesets/cli --dev
</code></pre>
</li>
<li>
<p>初始化 Changeset（如果尚未初始化）：</p>
<pre><code class="hljs language-bash" lang="bash">npx changeset init
</code></pre>
</li>
<li>
<p>添加新的 Changeset：
运行以下命令来创建一个新的 changeset 文件：</p>
<pre><code class="hljs language-bash" lang="bash">npx changeset
</code></pre>
</li>
<li>
<p>如果是 monorepo 项目，需要先选择更新的 package：</p>
<p>i. 用 ↑ / ↓ 方向键移动光标，选择当前行的 package。</p>
<p>ii. 按 <code>Space</code>（空格键） 勾选/取消勾选，勾选后前面会出现一个 <code>✔</code> 或 <code>◉</code>。</p>
<pre><code class="hljs"> 按一下空格：选中
 再按一下空格：取消选中
</code></pre>
<p>iii. 完成选择后按 <code>Enter</code>（回车）继续下一步。</p>
</li>
<li>
<p>进入选择版本变更等级（patch / minor / major）。</p>
</li>
<li>
<p>填写 Changeset 内容：
在打开的编辑器中，你可以按照提示选择受影响的包以及此次变更的类型（major, minor, patch）。然后，在 Markdown 文档中详细描述这次变更的内容。
例如，假设你要为一个名为 <code>my-component-library</code> 的包添加一条日志，描述了一个新功能的添加，你可以这样写：</p>
</li>
</ol>
<pre><code class="hljs language-markdown" lang="markdown">---
<span class="hljs-section">"my-component-library": patch
---</span>

新增了一个按钮组件 (<span class="hljs-code">`Button`</span>)，支持多种主题颜色和尺寸选项。
</code></pre>
<ol start="6">
<li>提交 Changeset 文件：
保存并关闭编辑器后，Changeset 会在 <code>.changeset</code> 目录下生成一个新的文件，内容类似于上面的示例。</li>
<li>构建发布：
当你准备好发布这些更改时，运行以下命令来应用所有未发布的 changeset 并更新包的版本号：
<pre><code class="hljs language-bash" lang="bash">npx changeset version
</code></pre>
然后，你可以使用你喜欢的包管理工具来发布更新后的包，比如：
<pre><code class="hljs language-bash" lang="bash">npm publish
</code></pre>
或者
<pre><code class="hljs language-bash" lang="bash">yarn publish
</code></pre>
</li>
</ol>
<p>通过以上步骤，你就可以成功地在 <code>changeset</code> 中新增组件库的日志了。每次运行 <code>npx changeset version</code> 后，所有的 changeset 文件会被合并成最终的 CHANGELOG.md 文件。
如果你需要更复杂的配置或有特定的需求，可以参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fatlassian%2Fchangesets" target="_blank" title="https://github.com/atlassian/changesets" ref="nofollow noopener noreferrer">Changeset 官方文档</a> 获取更多信息。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vben Admin 2.0 中 TinyMCE 富文本组件 Base64 图片显示问题排查记录]]></title>    <link>https://juejin.cn/post/7574619023804416038</link>    <guid>https://juejin.cn/post/7574619023804416038</guid>    <pubDate>2025-11-20T08:20:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574619023804416038" data-draft-id="7574619023804399654" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vben Admin 2.0 中 TinyMCE 富文本组件 Base64 图片显示问题排查记录"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-20T08:20:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="睡不着的可乐"/> <meta itemprop="url" content="https://juejin.cn/user/1680496691259559"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vben Admin 2.0 中 TinyMCE 富文本组件 Base64 图片显示问题排查记录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1680496691259559/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    睡不着的可乐
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:20:25.000Z" title="Thu Nov 20 2025 08:20:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vben Admin 2.0 中 TinyMCE 富文本组件 Base64 图片显示问题排查记录</h2>
<h3 data-id="heading-1">一、问题背景</h3>
<p>在 Vben Admin 2.0 项目中使用内置 TinyMCE 富文本组件时，需要实现图片 Base64 编码直接嵌入内容的功能。自定义了图片上传后的处理函数 <code>handleDone</code>，但修改 <code>data URI</code> 前缀后出现显示异常。
注意：接口上传图片返回的是链接不用修改</p>
<h3 data-id="heading-2">二、问题现象对比</h3>
<h4 data-id="heading-3">1. 正常场景（正确前缀）</h4>
<p>代码实现：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDone</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span>, url: <span class="hljs-built_in">string</span></span>) {

 <span class="hljs-keyword">const</span> editor = <span class="hljs-title function_">unref</span>(editorRef);

 <span class="hljs-keyword">if</span> (!editor) {

   <span class="hljs-keyword">return</span>;

 }

 <span class="hljs-keyword">const</span> content = editor?.<span class="hljs-title function_">getContent</span>() ?? <span class="hljs-string">''</span>;

 <span class="hljs-comment">// 使用图片对应的 MIME 类型（如 image/png、image/jpeg）</span>

 <span class="hljs-keyword">const</span> val = content?.<span class="hljs-title function_">replace</span>(<span class="hljs-title function_">getUploadingImgName</span>(name), \<span class="hljs-string">`\&lt;img src="data:\${type};base64,\${url}" /&gt;\`) ?? '';

 setValue(editor, val);

}
</span></code></pre>
<p>效果：</p>
<ul>
<li>
<p>富文本框中正常显示图片</p>
</li>
<li>
<p>审查元素可见完整 <code>&lt;img&gt;</code> 标签，<code>src</code> 为 <code>data:image/xxx;base64,...</code> 格式</p>
</li>
<li>
<p>浏览器能正确解析 Base64 图片数据</p>
</li>
</ul>
<h4 data-id="heading-4">2. 异常场景（错误前缀）</h4>
<p>代码实现：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDone</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span>, url: <span class="hljs-built_in">string</span></span>) {

 <span class="hljs-keyword">const</span> editor = <span class="hljs-title function_">unref</span>(editorRef);

 <span class="hljs-keyword">if</span> (!editor) {

   <span class="hljs-keyword">return</span>;

 }

 <span class="hljs-keyword">const</span> content = editor?.<span class="hljs-title function_">getContent</span>() ?? <span class="hljs-string">''</span>;

 <span class="hljs-comment">// 错误使用 application/force-download 作为 MIME 类型</span>

 <span class="hljs-keyword">const</span> val = content?.<span class="hljs-title function_">replace</span>(<span class="hljs-title function_">getUploadingImgName</span>(name), \<span class="hljs-string">`\&lt;img src="data:application/force-download;base64,\${url}" /&gt;\`) ?? '';

 setValue(editor, val);

}
</span></code></pre>
<p>效果：</p>
<ul>
<li>
<p>审查元素可见 <code>&lt;img&gt;</code> 标签，语法无错误</p>
</li>
<li>
<p>富文本框中图片显示为空白（无破损图标，纯空白）</p>
</li>
<li>
<p>相同 <code>&lt;img&gt;</code> 标签直接嵌入普通 HTML 文件时可正常显示图片</p>
</li>
</ul>
<h3 data-id="heading-5">三、核心原因分析</h3>
<h4 data-id="heading-6">1. 关键知识点：data URI 语法规范</h4>
<p><code>data URI</code> 是用于直接嵌入小型资源的协议，标准格式为：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-attr">data</span>:\[\&lt;mediatype&gt;]\[;base64],\&lt;data&gt;
</code></pre>
<p>其中 <code>&lt;mediatype&gt;</code> 必须是符合 IANA 规范的 MIME 类型，用于告知浏览器资源类型，浏览器仅在识别该类型时才会正确解析。</p>
<h4 data-id="heading-7">2. 两种 MIME 类型的本质区别</h4>























<table><thead><tr><th>前缀格式</th><th>MIME 类型说明</th><th>适用场景</th><th>浏览器 / 编辑器处理逻辑</th></tr></thead><tbody><tr><td><code>data:${type};base64,</code>（如 <code>image/png</code>）</td><td>标准图片 MIME 类型，明确标识资源为图片</td><td>图片渲染场景</td><td>浏览器识别为图片，解码 Base64 并渲染；TinyMCE 允许通过内容过滤</td></tr><tr><td><code>data:application/force-download;base64,</code></td><td>非标准图片类型，用于强制文件下载</td><td>文件下载接口响应头配置</td><td>浏览器视为 “待下载文件” 而非可渲染图片；TinyMCE 因安全过滤拒绝渲染</td></tr></tbody></table>
<h4 data-id="heading-8">3. 富文本与原生 HTML 差异的核心</h4>
<ul>
<li>
<p><strong>原生 HTML 环境</strong>：浏览器解析时会启动 “MIME 类型嗅探” 机制，即使 MIME 类型声明错误，也会通过 Base64 数据的字节特征（如 PNG 文件头 <code>89 50 4E 47</code>）识别实际资源类型，因此能正常显示图片。</p>
</li>
<li>
<p><strong>TinyMCE 环境</strong>：为保障编辑区域安全和稳定性，TinyMCE 内置严格的内容过滤（sanitization）机制，仅允许白名单内的 MIME 类型通过。<code>application/force-download</code> 不在图片 MIME 类型白名单中，导致编辑器拒绝渲染该图片资源，仅保留标签结构。</p>
</li>
</ul>
<h3 data-id="heading-9">四、解决方案</h3>
<h4 data-id="heading-10">1. 核心修复方案</h4>
<p>保留正确的图片 MIME 类型前缀，确保 <code>data URI</code> 符合规范：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleDone</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>: <span class="hljs-built_in">string</span>, url: <span class="hljs-built_in">string</span></span>) {

 <span class="hljs-keyword">const</span> editor = <span class="hljs-title function_">unref</span>(editorRef);

 <span class="hljs-keyword">if</span> (!editor) {

   <span class="hljs-keyword">return</span>;

 }

 <span class="hljs-keyword">const</span> content = editor?.<span class="hljs-title function_">getContent</span>() ?? <span class="hljs-string">''</span>;

 <span class="hljs-comment">// 确保 \${type} 传递的是图片对应的 MIME 类型（如 image/png、image/jpeg）</span>

 <span class="hljs-keyword">const</span> val = content?.<span class="hljs-title function_">replace</span>(<span class="hljs-title function_">getUploadingImgName</span>(name), \<span class="hljs-string">`\&lt;img src="data:\${type};base64,\${url}" /&gt;\`) ?? '';

 setValue(editor, val);

}
</span></code></pre>
<h4 data-id="heading-11">2. 补充说明</h4>
<ul>
<li>
<p>确保 <code>type</code> 参数的正确性：上传图片时需获取文件的真实 MIME 类型（可通过 <code>file.type</code> 获取），避免手动硬编码错误类型。</p>
</li>
<li>
<p>禁止使用非图片类 MIME 类型：如 <code>application/octet-stream</code>、<code>application/force-download</code> 等均不适合图片渲染场景。</p>
</li>
</ul>
<h3 data-id="heading-12">五、总结</h3>
<ol>
<li>
<p><strong>规范优先</strong>：<code>data URI</code> 的 MIME 类型必须与资源实际类型匹配，图片资源务必使用 <code>image/xxx</code> 系列类型。</p>
</li>
<li>
<p><strong>编辑器特性</strong>：TinyMCE 等富文本组件的内容过滤机制比原生 HTML 更严格，需遵循其白名单规则。</p>
</li>
<li>
<p><strong>避坑提醒</strong>：<code>application/force-download</code> 仅适用于文件下载接口的响应头配置，不可用于图片 <code>src</code> 属性。</p>
</li>
</ol>
<p>通过遵循 MIME 类型规范和富文本组件的特性要求，可彻底解决 Base64 图片显示异常问题，同时保证代码的兼容性和规范性。</p>
<blockquote>
<p>（注：文档部分内容可能由 AI 生成）</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年AI大模型开发生态白皮书｜附123页PDF文件下载]]></title>    <link>https://juejin.cn/post/7574581079627579398</link>    <guid>https://juejin.cn/post/7574581079627579398</guid>    <pubDate>2025-11-20T08:31:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574581079627579398" data-draft-id="7574581079627448326" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年AI大模型开发生态白皮书｜附123页PDF文件下载"/> <meta itemprop="keywords" content="Agent,LLM,程序员"/> <meta itemprop="datePublished" content="2025-11-20T08:31:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年AI大模型开发生态白皮书｜附123页PDF文件下载
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:31:05.000Z" title="Thu Nov 20 2025 08:31:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>《2025AI大模型开发生态白皮书》由中科算网算泥社区主编，联合中国科学技术大学苏州高等研究院、中国人民大学数据与人工智能研发实验中心发布，旨在系统梳理全球AI大模型的发展现状、技术趋势、生态布局及落地实践。</p>
<p>文档聚焦2024年6月至2025年9月的最新动态，覆盖技术、产业、人才等多维度，为开发者提供全景式洞察与实战指南。</p>
<p><strong>以下为报告节选：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39a93f32d269499bbab8bfd1aaa8b63b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=iYgrz4T%2FrXWmzEKlZPvwbVDSjV4%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3dd0d9e9ffb479894d0baad85f9ccde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=oIDZcSwXXDvvJcaFSE3J4cITbmg%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cbe163453e14fcea3b07f1d5c650bed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=VTYzArQfGc6FZcsPIpQJcMvhwyo%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d935b6a700b4323b84ab8c5fd6f77ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=ctNiciI1bSV9NXlcwAHXxZplYt4%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/596a78fdc4dc440d9dfec617b2c4974c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=v4je6s0de4tElVUYkwvRiCOSV7U%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eae7fbe249ef494da0fc27bfaa25109d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=Xs2i2O2jCtI5CCqZYg6gXKKnyV8%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8349df4205634b72ae286453f5c45b2f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=UZj9ny6yb18G%2BSrpCNqqYEAOsdk%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14cf72862d7e45c1a57f6de087335720~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=YPLJFsr%2FRDd4o3X5%2Fd1fjEpxSAk%3D" alt="" loading="lazy"/><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc5f6863032f49288bc82779cd298598~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232265&amp;x-signature=4DD6TN5628m2yRYLgOZKLO%2BtXCQ%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nginx 反向代理完全指南：从安装到生产环境全流程]]></title>    <link>https://juejin.cn/post/7574529034673078307</link>    <guid>https://juejin.cn/post/7574529034673078307</guid>    <pubDate>2025-11-20T08:28:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574529034673078307" data-draft-id="7574404398066679808" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nginx 反向代理完全指南：从安装到生产环境全流程"/> <meta itemprop="keywords" content="Nginx"/> <meta itemprop="datePublished" content="2025-11-20T08:28:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="micefind"/> <meta itemprop="url" content="https://juejin.cn/user/3927901240298430"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nginx 反向代理完全指南：从安装到生产环境全流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3927901240298430/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    micefind
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:28:12.000Z" title="Thu Nov 20 2025 08:28:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Nginx 反向代理完整指南</h2>
<h3 data-id="heading-1">一、基础概念</h3>
<p>反向代理是指服务器代理客户端去访问后端真实服务器，客户端无需知道实际服务器地址。</p>
<h3 data-id="heading-2">二、快速安装</h3>
<h4 data-id="heading-3">Linux（Ubuntu/Debian）</h4>
<pre><code class="hljs language-bash" lang="bash">sudo apt-get update
sudo apt-get install nginx
sudo systemctl start nginx
sudo systemctl <span class="hljs-built_in">enable</span> nginx
</code></pre>
<h4 data-id="heading-4">Linux（CentOS/RHEL）</h4>
<pre><code class="hljs language-bash" lang="bash">sudo yum install nginx
sudo systemctl start nginx
sudo systemctl <span class="hljs-built_in">enable</span> nginx
</code></pre>
<h4 data-id="heading-5">macOS</h4>
<pre><code class="hljs language-bash" lang="bash">brew install nginx
brew services start nginx
</code></pre>
<h3 data-id="heading-6">三、核心配置</h3>
<h4 data-id="heading-7">文件位置</h4>





















<table><thead><tr><th>系统</th><th>配置路径</th></tr></thead><tbody><tr><td>Ubuntu/Debian</td><td><code>/etc/nginx/nginx.conf</code></td></tr><tr><td>CentOS/RHEL</td><td><code>/etc/nginx/nginx.conf</code></td></tr><tr><td>macOS</td><td><code>/usr/local/etc/nginx/nginx.conf</code></td></tr></tbody></table>
<h4 data-id="heading-8">最小化反向代理配置</h4>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
</code></pre>
<h3 data-id="heading-9">四、常用代理配置详解</h3>
<h4 data-id="heading-10">1. 单后端服务</h4>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name api.example.com;

    location / {
        proxy_pass http://backend-server:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
</code></pre>
<h4 data-id="heading-11">2. 负载均衡（多后端）</h4>
<pre><code class="hljs language-nginx" lang="nginx">upstream backend {
    server 192.168.1.10:8080 weight=5;
    server 192.168.1.11:8080 weight=3;
    server 192.168.1.12:8080 backup;
}

server {
    listen 80;
    server_name example.com;

    location / {
        proxy_pass http://backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
</code></pre>
<h4 data-id="heading-12">3. 路径路由</h4>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name example.com;

    location /api/ {
        proxy_pass http://api-server:3000;
    }

    location /static/ {
        root /var/www/html;
    }

    location /admin/ {
        proxy_pass http://admin-server:8080;
    }
}
</code></pre>
<h4 data-id="heading-13">4. WebSocket 支持</h4>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name websocket.example.com;

    location /ws {
        proxy_pass http://ws-server:9000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_read_timeout 3600s;
    }
}
</code></pre>
<h4 data-id="heading-14">5. HTTPS + 重定向</h4>
<pre><code class="hljs language-nginx" lang="nginx">server {
    listen 80;
    server_name example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name example.com;

    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;

    location / {
        proxy_pass http://127.0.0.1:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
</code></pre>
<h3 data-id="heading-15">五、常用代理参数</h3>


















































<table><thead><tr><th>参数</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>proxy_pass</code></td><td>后端服务地址</td><td><code>http://backend:8080</code></td></tr><tr><td><code>proxy_set_header</code></td><td>设置请求头</td><td><code>Host $host</code></td></tr><tr><td><code>proxy_redirect</code></td><td>重定向处理</td><td><code>off</code></td></tr><tr><td><code>proxy_connect_timeout</code></td><td>连接超时</td><td><code>60s</code></td></tr><tr><td><code>proxy_send_timeout</code></td><td>发送超时</td><td><code>60s</code></td></tr><tr><td><code>proxy_read_timeout</code></td><td>读取超时</td><td><code>60s</code></td></tr><tr><td><code>proxy_buffering</code></td><td>响应缓冲</td><td><code>on/off</code></td></tr><tr><td><code>proxy_buffer_size</code></td><td>缓冲大小</td><td><code>4k</code></td></tr></tbody></table>
<h4 data-id="heading-16">高性能配置示例</h4>
<pre><code class="hljs language-nginx" lang="nginx">location / {
    proxy_pass http://backend;
  
    # 超时设置
    proxy_connect_timeout 30s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
  
    # 缓冲设置
    proxy_buffering on;
    proxy_buffer_size 8k;
    proxy_buffers 8 8k;
    proxy_busy_buffers_size 16k;
  
    # 请求头设置
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
  
    # 其他设置
    proxy_http_version 1.1;
    proxy_redirect off;
}
</code></pre>
<h3 data-id="heading-17">六、调试与验证</h3>
<h4 data-id="heading-18">配置检查</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查配置语法</span>
nginx -t

<span class="hljs-comment"># 查看详细配置</span>
nginx -T
</code></pre>
<h4 data-id="heading-19">重启服务</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 重启 Nginx</span>
sudo systemctl restart nginx

<span class="hljs-comment"># 平滑重启（不中断连接）</span>
sudo nginx -s reload
</code></pre>
<h4 data-id="heading-20">日志查看</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 访问日志</span>
sudo <span class="hljs-built_in">tail</span> -f /var/log/nginx/access.log

<span class="hljs-comment"># 错误日志</span>
sudo <span class="hljs-built_in">tail</span> -f /var/log/nginx/error.log
</code></pre>
<h4 data-id="heading-21">测试反向代理</h4>
<pre><code class="hljs language-bash" lang="bash">curl -i http://example.com
curl -H <span class="hljs-string">"Host: example.com"</span> http://127.0.0.1
</code></pre>
<h3 data-id="heading-22">七、常见问题排查</h3>
<h4 data-id="heading-23">502 Bad Gateway</h4>
<pre><code class="hljs language-nginx" lang="nginx"># 增加超时时间
proxy_connect_timeout 90s;
proxy_send_timeout 90s;
proxy_read_timeout 90s;

# 检查后端服务是否运行
</code></pre>
<h4 data-id="heading-24">连接拒绝</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查防火墙</span>
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp

<span class="hljs-comment"># 检查后端服务监听地址</span>
netstat -tlnp | grep LISTEN
</code></pre>
<h4 data-id="heading-25">请求头丢失</h4>
<pre><code class="hljs language-nginx" lang="nginx"># 明确传递请求头
proxy_set_header Host $host;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Real-IP $remote_addr;
</code></pre>
<h3 data-id="heading-26">八、生产环境配置模板</h3>
<pre><code class="hljs language-nginx" lang="nginx"># /etc/nginx/conf.d/production.conf
upstream production_backend {
    least_conn;
    server backend1.internal:8080 max_fails=3 fail_timeout=30s;
    server backend2.internal:8080 max_fails=3 fail_timeout=30s;
    server backend3.internal:8080 backup;
}

server {
    listen 80;
    server_name example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name example.com;

    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;
    ssl_session_timeout 1d;
    ssl_session_cache shared:SSL:50m;

    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log warn;

    location / {
        proxy_pass http://production_backend;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
      
        proxy_connect_timeout 30s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
      
        proxy_buffering on;
        proxy_buffer_size 8k;
        proxy_buffers 8 8k;
    }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025年企业级AI Agent（智能体）价值及应用报告｜附77页PDF文件下载]]></title>    <link>https://juejin.cn/post/7574621075323060287</link>    <guid>https://juejin.cn/post/7574621075323060287</guid>    <pubDate>2025-11-20T08:36:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574621075323060287" data-draft-id="7574621075323027519" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025年企业级AI Agent（智能体）价值及应用报告｜附77页PDF文件下载"/> <meta itemprop="keywords" content="Agent,程序员,LLM"/> <meta itemprop="datePublished" content="2025-11-20T08:36:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大模型教程"/> <meta itemprop="url" content="https://juejin.cn/user/1145012233707299"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025年企业级AI Agent（智能体）价值及应用报告｜附77页PDF文件下载
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1145012233707299/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大模型教程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:36:54.000Z" title="Thu Nov 20 2025 08:36:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>一个全新的时代正以前所未有的速度向我们奔来。随着AIGC**（生成式人工智能）的浪潮席卷全球，我们观察到，技术的演进正从单纯的内容生成，迈向更深层次的“智能体”（AI Agent**）革命。这不仅是技术的迭代，更是生产力范式的颠覆性变革。当AI不再仅仅是工具，而是能自主理解、规划、并执行复杂任务的智能伙伴时，企业的每一个流程、每一次决策、每一个创想，都将被重新定义。</p>
<p>然而，机遇与迷思共存。2025年被视为“Agent元年”，但围绕AI Agent的讨论仍充满了诸多困惑：它的确切概念是什么？在中国独特的数字化土壤中，它将如何落地生根？从喧嚣的概念到切实的价值，中间的路径又该如何铺就？</p>
<p>正是带着这些深刻的思索与探问，我们深度访谈了行业先行者，剖析了众多实践案例，最终汇聚成了这份70页+的报告——《企业级AI Agent（智能体）价值及应用报告》。</p>
<p><strong>以下为报告节选：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b33778ad92fc4a3894ec381e78b68d9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=Gs9Sf2ZUuwem2i7r1CFOoiZOON0%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c7c8a0442fd4678ae256adb17ea5a27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=%2BfIRq1gSeUXB%2Fqua8IVVuAJ6ctQ%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/357646c5cc794fd1b947abd25d466c52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=Z4%2FfPqpXaTBogGOi2%2Fbcwfzkieg%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b0a8ff1c84a4823a52d304b6ce43adf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=UafHpcOlvRy%2Bw%2Fo441dd%2B8I7Hu4%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d46db1e101d74a3a915b0e09de3551af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=4YTZgzWDvuBOnT2ae9iusdSxI%2Fo%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5aaab8f81f449d0a62c9c2836e92695~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=p18gLJgSlYuOCwMP3QqK28CyrHM%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6607f6a6f6d4ba19a8c4e69f17ba972~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=ZJDC3fvCANV75OaIthS3KGBDkJo%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7aa060006b1448087644287483d983a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=wUx17VUspF8tVvPMUlOt9Kzqup8%3D" alt="" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c86f754da6ec47e493f8e1b4a0d81528~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5qih5Z6L5pWZ56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232614&amp;x-signature=ODo%2Fm5Lgyi%2BZ%2FlhfUAOfvxzGcHw%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">学习资源推荐</h2>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 落地不用死磕！这 3个 tips，开发者直接抄作业]]></title>    <link>https://juejin.cn/post/7574608278421979172</link>    <guid>https://juejin.cn/post/7574608278421979172</guid>    <pubDate>2025-11-20T08:36:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574608278421979172" data-draft-id="7574622940688416787" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 落地不用死磕！这 3个 tips，开发者直接抄作业"/> <meta itemprop="keywords" content="前端,AI编程,Vue.js"/> <meta itemprop="datePublished" content="2025-11-20T08:36:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OpenTiny社区"/> <meta itemprop="url" content="https://juejin.cn/user/3808325101432983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 落地不用死磕！这 3个 tips，开发者直接抄作业
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808325101432983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OpenTiny社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:36:09.000Z" title="Thu Nov 20 2025 08:36:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文由体验技术团队成员原创。</p>
<h2 data-id="heading-0">1、大方向：合理规划产品演进形态，从+AI到AI+</h2>
<h3 data-id="heading-1">从业界AI Coding产品看：</h3>
<ul>
<li>Codium -&gt; WindSurf
Codeium成立于2021年，推出编程助手Codium（现Qodo）；2024年11月，Exafunction Inc.（原Codeium）推出了Windsurf Editor，AI原生IDE，专注于通过智能协作和自动化提升软件开发效率。</li>
<li>MarsCode -&gt; Trae
2024年6月，字节跳动在北京发布了基于豆包大模型打造的智能开发工具- 豆包MarsCode，可以无缝集成到 IDEA、VSCode 中；2025年1月，字节发布了国内首个 AI 原生 IDE——Trae。Trae正式发布，初期仅支持macOS系统，2月17日Windows版本全量上线。</li>
<li>Comate -&gt; Comate IDE
2023年6月，百度推出代码助手Comate；2025年6月的百度Create AI开发者大会上，推出了独立的AI原生开发环境工具——Comate AI IDE1。</li>
<li>Tongyilinma - &gt; Tongyilinma IDE
2023年10 月阿里云正式发布的通义灵码智能编码助手；2025年10月，阿里云发布通义灵码AI IDE。</li>
</ul>
<h3 data-id="heading-2">从业界数据分析Agent产品看：</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/35d94ef26ca3419388c6c1f9fecd435c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=IeyhSq4WjZVPk6s18CA5r4YUrxY%3D" alt="1.png" loading="lazy"/></p>
<p>合理的演进形态？</p>
<ul>
<li>
<p><strong>阶段1：+AI验证价值</strong>
在现有流程中嵌入AI能力，快速验证AI价值和用户接受度，并累计AI应用经验与数据</p>
</li>
<li>
<p><strong>阶段2：AI+重构业务核心</strong>
重新设计核心业务流程，构建以AI为中心的产品架构，培养用户新的使用习惯</p>
</li>
<li>
<p><strong>阶段3：原声AI全新体验</strong>
AI Native终极目标达成</p>
</li>
</ul>
<h2 data-id="heading-3">2、怎么+AI？（如何寻找AI可切入的落地场景）</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8f9b6b97d6b4cd5bf1dda93860e2058~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=uHwRoNSPVEHqxUcu0%2Bq08%2BT%2FYdw%3D" alt="2.png" loading="lazy"/></p>
<h3 data-id="heading-4">（1）敏锐洞察客户期望的演变趋势</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67f4fd4f3d9d49dea7386108613e13cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=HcY3%2FtOoACNbg9%2BDrEpTp1%2BFtA0%3D" alt="3.png" loading="lazy"/></p>
<p><strong>重塑用户调研的繁琐过程</strong></p>
<p>可以利用AI工具，来聚合所有来源的用户反馈、分析和挖掘数据，然后实时地将洞察直接推送到规划者。用户的期望变化得太快，如果流程不改进，遭遇“PMF丢失”的概率就会大大增加。</p>
<p><strong>一些常见的期望演变：</strong></p>
<p>从“给我一个创作的工具”到“直接帮我搞定”
从“提供标准版，我自己具体调整”到“为我量身打造一个方案”（主要是B2B）
从“手动操作”到“自动化操作”</p>
<ul>
<li>JIRA领域，创建任务、更新任务、长期梳理任务都需要时间</li>
<li>CRM领域，销售代表需要花费大量时间来输入关于沟通和交易的数据）</li>
</ul>
<p>从“按使用者数量/按月付费”到“按完成的工作量付费”</p>
<ul>
<li>从lisence到生成的产品数量/节省的人力成本/...</li>
</ul>
<h3 data-id="heading-5">（2）端到端的用户体验仍然重要</h3>
<p><strong>AI提高了单个环节的效率、同时也放大了不同环节间协作的价值</strong></p>
<p>从企业服务看：回溯过去十年，企业服务的核心逻辑是模块化拼接，通过不同功能模块的组合满足企业需求，最佳单品才是主流。企业习惯用钉钉做协同、用用友管财务、用Salesforce搞CRM，再靠数据中台勉强去缝合。但随着AI技术走向成熟，这种逻辑逐渐失效。模块间数据因无法互通而形成信息孤岛，用户在多系统间切换导致体验割裂，第三方生态也难以深度整合。</p>
<ul>
<li>钉钉AI助手 -&gt; 钉钉One：阿里钉钉十周年发布会重磅推出“钉钉One”，聚焦员工日常高频任务，实现智能化识别与自动化处理。</li>
<li>YonSuite -&gt; One YonSuite：八月中旬，用友旗下面向成长型企业的SaaS产品YonSuite发布全新品牌口号——One AI-World, One YonSuite，并宣告以AI原生+全球化的双轮驱动，重塑企业服务的底层逻辑。</li>
</ul>
<p><strong>是否掌握用户的“主要工作流”？上下游、端到端的生态很重要</strong></p>
<p>用户关注的是诉求能否得到解决，并不在乎这是不是一个"AI功能”。因此，不同产品竞争优势未根本性变化, 应专注做好擅长领域, 利用AI快速补齐其余环节。</p>
<ul>
<li>腾讯智能座舱的“花活”，离不开小程序生态的支撑。</li>
<li>Coze的战略价值，强化豆包大模型的产品化落地路径（通过COZE构建即调用豆包），形成上游→下游联动闭环，构建后可一键发布至抖音、飞书、懂车帝等诸多平台，形成“内容+AI+分发”的平台生态闭环。</li>
<li>AI创作应用，比如编码开发环境、写作界面、设计画布等应用，如果产品位于这些创作界面的“下游”或外部，而不是用户完成核心工作的地方，就更容易被取代。AI可以直接整合到工作流中，成为一个更无缝的替代方案，而不是让用户离开他们的主要工作环境。</li>
</ul>
<h3 data-id="heading-6">（3）合理评估技术成熟度、数据/知识完备度与产品功能边界，找到落地甜区</h3>
<p><strong>产品功能边界评估：</strong></p>
<ul>
<li>
<p>功能边界要“小”：让AI在业务需要的地方做擅长的事
若对有用性低的领域进行导入，导入成本高，效果也很难达到预期，可能会导致项目失败。
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8a20d92346e84702b79b08651c3defb0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=XzFloPlwaL0WtfqNZx82RTi%2Fyic%3D" alt="4.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8821177fda7d48b7ac14e8800577363e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=v2tMW2%2BX%2BiOvjcBrmXWjfE%2B0eHo%3D" alt="5.png" loading="lazy"/></p>
</li>
<li>
<p>功能边界要“大”：比大模型升级主路径“多思考一步”
AI 应用最大的危险是被大模型卷死，所以一定要避免在大模型升级的主路径上。否则就会变成一层包一层，Agent调Tool。</p>
</li>
</ul>
<p>应避免将AI应用的主要功能定义为通用性高、附加价值低的任务、给大模型打补丁的任务。这些任务过于普遍和标准化，容易被大模型学习和模仿。例如，自动摘要提取、文本改写、文章生成、机器翻译、语言解释以及常规问题的回答等，在这类任务中，大模型的学习能力可以迅速复制并普及。很多创业公司尤其是 wrapper 类产品，本质就是在对大模型的这种输出的不稳定，不专业做修复，补偿，深加工和各类未来会成为大模型组件的大拼盘。</p>
<p><strong>业务价值评估：</strong></p>
<ul>
<li>
<p>阿里云数字员工已扩展HC为结果目标：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f332c957648c497e8357ebf608d2ffe8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=7XLXShTlZPDM0mII3NpYege4v2I%3D" alt="6.png" loading="lazy"/></p>
</li>
<li>
<p>2D产品claude code新特性对外发布的标准：内部开发者为自己直接做出原型，在司内发布，内部反响是否好是对外发布的标准；内部反响一般则先迭代，等ready后再发布。</p>
</li>
</ul>
<p><strong>数据治理与知识工程：</strong>
需要进行持续的数据治理与知识工程建设，配套调整组织与生产关系，为AI应用打好“蛋糕胚”</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7295e895db84b2887957ad7ca013599~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=HRhFRY3pAHm%2F55cr6aiWwBsIKpI%3D" alt="7.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a83f0d2ef1cb44a98ae22b270cb49360~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=GhZXSHipbWsWa6vBoDWzS%2Fzam%2Fc%3D" alt="8.png" loading="lazy"/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39d3ed54abd943b59db67faae0d49f88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=DYhj2Gr7Zor6wsaTIWsHH%2F8wj98%3D" alt="9.jpg" loading="lazy"/></p>
<h2 data-id="heading-7">3、AI时代的PMF不仅是product market fit</h2>
<h3 data-id="heading-8">（1）以前，我们如何寻找PMF（产品市场契合度）</h3>
<p>PMF(product market fit)指产品与市场需求达到匹配的一种状态，即产品能够很好地满足目标市场的需求，并且市场对该产品有强烈的需求和接受度。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/08df36d9dd794b9cbaa529ce7e6b6a18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232569&amp;x-signature=2jpIEnbBN3A7V6xcVCpZHkBDBc4%3D" alt="10.png" loading="lazy"/></p>
<p>通常，在寻找PMF时的一般路径是：</p>
<p>确定目标客户（未来产品的受众与未被满足的需求）→明确核心价值定位（有核心竞争力与一定壁垒）→明确产品MVP核心功能（团队与用户对产品的核心功能达成一致）→做出产品的模型并验证（目标客户使用MVP并密切互动、了解反馈，打磨体验）</p>
<p>传统互联网行业在评估 PMF 时，两个指标被认为是最关键的：</p>
<ul>
<li>用户留存率：衡量用户在初次使用产品后的一定时间内，仍然继续使用产品的比例。移动互联网产品有个经典指标叫 421，次留 40%，周留 20%，月留 10%，满足这个表示基本达标。最重要的参数是长期留存，月留存率达到 30%或以上，表明产品具有很高的用户粘性。月留存率在 20%-30%之间，表明产品较为符合用户需求。月留存率在 10%-20%，可能需要进一步优化产品功能或用户体验。月留存率低于 10%，表明产品与用户需求存在较大偏差。</li>
<li>用户生命周期价值（LTV）与客户获取成本（CAC）之比：LTV/CAC 比率是衡量产品盈利潜力的关键指标。一个健康的 LTV/CAC 比率通常被认为是 3:1 或更高，这意味着用户在其整个生命周期内为公司带来的总收益至少是获取该用户成本的三倍。这个比率越高，表明产品的市场适应性和盈利能力越强。</li>
</ul>
<h3 data-id="heading-9">（2）AI时代，寻找产品模型契合度（Produt Model Fit）同样重要</h3>
<p>PMF强调在 AI 技术特性与产品功能之间找到匹配是成功的关键，即 AI 模型的技术特性与产品功能之间的契合度。</p>
<p>许多 AI 产品的 Demo 视频表现出色，但实际产品却难以满足市场预期，主要是因为实际能力与演示时相比有差距。因此，意味着需要深入理解技术的优势和局限性，能够识别技术适合解决哪些类型的问题，以及技术如何与用户需求相结合，从而设计出比传统应用好 10 倍的用户体验。产品团队需要深入理解 AI 模型的能力边界，利用模型的强项并规避弱点，同时对模型的技术演进方向有前瞻性的预判。成功的 AI 产品应基于对模型能力和市场需求的深刻理解，做出明智的取舍，而不是追求满足市场所有需求的完美产品。</p>
<h3 data-id="heading-10">（3）如何量化衡量AI时代的产品是否满足了PMF？</h3>
<p>一般的产品路径：吸引客户 -&gt; 留住客户 -&gt; 赚到钱 -&gt; scaling -&gt; 守得住</p>
<p><strong>是否切中用户真实需求？</strong></p>
<p>是否切中用户真实需求，包括吸引和留住客户。这个要沿用活跃度指标，这个指标能反应MFP/TPF，因为否则的话，不可能吸引并留住用户。付费</p>
<p><strong>是否拥有专有数据与知识？</strong></p>
<p>在AI时代，数据才是真正的“新石油”，尤其是那些大型语言模型无法获取的专有数据。如果数据（或内容）是公开的，可轻易被大型语言模型获取和处理。专有数据越多，护城河就越深。</p>
<p><strong>能否在商业上闭环？</strong></p>
<p>每一笔帐能算的过来（token的成本，数据成本，渠道，试错，迭代等等），且要能高效的回款，因为在早期还无法判断和计算用户life-time的时候，LTV/CAC的公式会显得过于长远。</p>
<p>长期包括能否赚到钱和scaling，看ROI或者LTV/CAC。</p>
<p><strong>能否不被颠覆？</strong></p>
<p>在移动互联网时代，技术基础设施相对稳定，产品和客户的匹配之后，产品被颠覆的风险很小。在AI时代这个前提不一定成立。做半天，用户反馈也不错，但是可能大模型一更新，就没有意义了。所以，需要一个指标表示对大模型safe程度，这个要求提供的服务远离大模型的演进主线，同时要在业务主流程中积累自己的私有数据闭环。 这个指标至少是这两个参数的函数，如 F(主航道偏离度，私有数据积累度）。</p>
<p>所以，AI时代的PMF至少要额外添加一个指数表示不被颠覆的程度，由两个参数驱动：主航道偏离度，私有数据积累度。</p>
<blockquote>
<p>本文是由体验技术团队同学参与AICon后沉淀的技术思考及总结</p>
</blockquote>
<h2 data-id="heading-11">关于OpenTiny</h2>
<p>欢迎加入 OpenTiny 开源社区。添加微信小助手：opentiny-official 一起参与交流前端技术～</p>
<p>OpenTiny 官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design" target="_blank" title="https://opentiny.design" ref="nofollow noopener noreferrer">opentiny.design</a><br/>
OpenTiny 代码仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny" target="_blank" title="https://github.com/opentiny" ref="nofollow noopener noreferrer">github.com/opentiny</a><br/>
TinyVue 源码：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue" target="_blank" title="https://github.com/opentiny/tiny-vue" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a><br/>
TinyEngine 源码： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine" target="_blank" title="https://github.com/opentiny/tiny-engine" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a><br/>
欢迎进入代码仓库 Star🌟TinyEngine、TinyVue、TinyNG、TinyCLI、TinyEditor~ 如果你也想要共建，可以进入代码仓库，找到 good first issue 标签，一起参与开源贡献~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[比 pip 快 100 倍！更现代的 python 包管理工具，替代 pip、venv、poetry!]]></title>    <link>https://juejin.cn/post/7574601160981168143</link>    <guid>https://juejin.cn/post/7574601160981168143</guid>    <pubDate>2025-11-20T08:41:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574601160981168143" data-draft-id="7574614157954809890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="比 pip 快 100 倍！更现代的 python 包管理工具，替代 pip、venv、poetry!"/> <meta itemprop="keywords" content="后端,Python"/> <meta itemprop="datePublished" content="2025-11-20T08:41:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="麦麦麦造"/> <meta itemprop="url" content="https://juejin.cn/user/1732486056126311"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            比 pip 快 100 倍！更现代的 python 包管理工具，替代 pip、venv、poetry!
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1732486056126311/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    麦麦麦造
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:41:23.000Z" title="Thu Nov 20 2025 08:41:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>大家好，我是 <strong>MAI麦造</strong>!</p>
<p>之前比较喜欢用 anaconda 来管理虚拟环境，但只做包管理又太大材小用了。</p>
<p><strong>现在有一个轻量且更强的替代来了！！</strong></p>
<p>一站式超快的 Python 包与环境管理工具：<code>uv</code>。</p>
<p>作者：Astral（<code>ruff</code> 开发团队） ，口号：<strong>“比 pip 快 100 倍”</strong>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a03a9a975f8842da8d6b20c555c3d6a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bqm6bqm6bqm6YCg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232883&amp;x-signature=9qyPeLibjaMDaid4p0JVFYrnhnw%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-0">🧭 一、uv 是什么？</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1442e4c39402413684bb154955f84127~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bqm6bqm6bqm6YCg:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764232883&amp;x-signature=2Simah%2B083RNnLmmP4BohiX%2B4yw%3D" alt="PixPin_2025-11-20_16-23-34.png" loading="lazy"/></p>
<p><code>uv</code> 是一个基于 <strong>Rust</strong> 编写的 Python 包管理器，它集成了以下功能：</p>






























<table><thead><tr><th>工具</th><th>功能</th><th>在 uv 中的替代</th></tr></thead><tbody><tr><td>pip</td><td>包安装</td><td>✅ <code>uv pip</code></td></tr><tr><td>venv</td><td>虚拟环境</td><td>✅ <code>uv venv</code></td></tr><tr><td>poetry</td><td>依赖管理</td><td>✅ <code>uv add</code> / <code>uv sync</code></td></tr><tr><td>pip-tools</td><td>锁定依赖</td><td>✅ 自动内置</td></tr></tbody></table>
<p>👉 简单理解：</p>
<p><code>uv = pip + venv + poetry</code> 的极速整合版。</p>
<hr/>
<h2 data-id="heading-1">⚙️ 二、安装 uv</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># linux/MacOS 官方推荐方式（自动检测平台）  </span>
curl -LsSf https://astral.sh/uv/install.sh | sh  
  
<span class="hljs-comment"># win11 上  </span>
  
winget install uv

</code></pre>
<p>或通过 pip：</p>
<pre><code class="hljs">pip install uv
</code></pre>
<hr/>
<h2 data-id="heading-2">🚀 三、常用命令速查</h2>
<h3 data-id="heading-3">1️⃣ 创建虚拟环境</h3>
<pre><code class="hljs">uv venv
</code></pre>
<p>在当前目录下创建 <code>.venv</code> 文件夹。</p>
<p>指定路径：</p>
<pre><code class="hljs language-bash" lang="bash">uv venv .envs/myenv
</code></pre>
<hr/>
<h3 data-id="heading-4">2️⃣ 指定 Python 版本创建虚拟环境</h3>
<pre><code class="hljs language-css" lang="css">uv venv <span class="hljs-attr">--python</span> <span class="hljs-number">3.11</span>
</code></pre>
<p>或指定绝对路径：</p>
<pre><code class="hljs language-bash" lang="bash">uv venv --python /usr/local/bin/python3.11
</code></pre>
<blockquote>
<p>💡 提示：uv 会自动下载所需 Python 版本（类似 pyenv 的体验）， 无需提前安装该版本的解释器。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">3️⃣ 激活虚拟环境</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS / Linux  </span>
<span class="hljs-built_in">source</span> .venv/bin/activate  
  
<span class="hljs-comment"># Windows  </span>
.venv\Scripts\activate

</code></pre>
<hr/>
<h3 data-id="heading-6">4️⃣ 安装依赖</h3>
<pre><code class="hljs">uv pip install requests
</code></pre>
<p>可一次安装多个：</p>
<pre><code class="hljs">uv pip install numpy pandas matplotlib

</code></pre>
<hr/>
<h3 data-id="heading-7">5️⃣ 安装依赖文件</h3>
<pre><code class="hljs">uv pip install -r requirements.txt
</code></pre>
<hr/>
<h3 data-id="heading-8">6️⃣ 导出依赖列表</h3>
<pre><code class="hljs">uv pip freeze &gt; requirements.txt
</code></pre>
<hr/>
<h3 data-id="heading-9">7️⃣ 使用 pyproject.toml 管理依赖</h3>
<pre><code class="hljs language-csharp" lang="csharp">uv <span class="hljs-keyword">add</span> fastapi uv <span class="hljs-keyword">remove</span> fastapi uv sync
</code></pre>
<p>🔒 <code>uv sync</code> 会根据锁文件精确重建环境。</p>
<hr/>
<h3 data-id="heading-10">8️⃣ 一次性运行脚本（自动加载环境）</h3>
<pre><code class="hljs language-arduino" lang="arduino">uv run script.py
</code></pre>
<hr/>
<h3 data-id="heading-11">9️⃣ 临时安装依赖并运行命令</h3>
<pre><code class="hljs language-scss" lang="scss">uv run <span class="hljs-attr">--with</span> requests python -c "import requests; <span class="hljs-built_in">print</span>(requests.__version__)"
</code></pre>
<p>在隔离环境中运行，不污染全局依赖。</p>
<hr/>
<h3 data-id="heading-12">🔟 初始化项目模板</h3>
<pre><code class="hljs language-csharp" lang="csharp">uv <span class="hljs-keyword">init</span> myproject
</code></pre>
<p>自动创建项目结构和 <code>pyproject.toml</code>。</p>
<hr/>
<h2 data-id="heading-13">🧩 四、实用命令对照表</h2>

































































<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td>功能</td><td>命令</td><td>说明</td></tr><tr><td>创建虚拟环境</td><td><code>uv venv</code></td><td>默认使用当前 Python</td></tr><tr><td>指定 Python 版本</td><td><code>uv venv --python 3.11</code></td><td>自动下载版本</td></tr><tr><td>安装包</td><td><code>uv pip install &lt;pkg&gt;</code></td><td>兼容 pip</td></tr><tr><td>安装文件依赖</td><td><code>uv pip install -r requirements.txt</code></td><td/></tr><tr><td>导出依赖</td><td><code>uv pip freeze &gt; requirements.txt</code></td><td/></tr><tr><td>添加依赖（TOML）</td><td><code>uv add &lt;pkg&gt;</code></td><td>类似 poetry</td></tr><tr><td>删除依赖</td><td><code>uv remove &lt;pkg&gt;</code></td><td/></tr><tr><td>同步依赖</td><td><code>uv sync</code></td><td>更新虚拟环境</td></tr><tr><td>临时运行</td><td><code>uv run --with &lt;pkg&gt; &lt;cmd&gt;</code></td><td>不污染环境</td></tr><tr><td>初始化项目</td><td><code>uv init</code></td><td>创建标准项目结构</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-14">💡 五、优点总结</h2>
<p>✅ 极快安装速度（Rust 实现，比 pip 快 10–100 倍）</p>
<p>✅ 自动管理虚拟环境与依赖锁定✅ 完全兼容 pip✅ 支持多 Python 版本共存与下载✅ 可替代 Poetry、pip-tools、pyenv、pipx 的组合</p>
<hr/>
<h2 data-id="heading-15">🔍 六、进阶技巧</h2>
<h3 data-id="heading-16">✨ 指定 Python 版本运行脚本</h3>
<pre><code class="hljs language-css" lang="css">uv run <span class="hljs-attr">--python</span> <span class="hljs-number">3.10</span> <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.py</span>
</code></pre>
<h3 data-id="heading-17">✨ 查看所有可用 Python 版本</h3>
<pre><code class="hljs">uv python list
</code></pre>
<h3 data-id="heading-18">✨ 安装特定 Python 版本</h3>
<pre><code class="hljs">uv python install 3.12
</code></pre>
<hr/>
<h2 data-id="heading-19">七、</h2>
<p>这是一个常用的 uv 命令速查表。 大家可以 mark 住，需要的时候可以快速找到～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue2 的关于 $set 的反直觉行为：为什么先赋值再 $set 不会触发 watch？]]></title>    <link>https://juejin.cn/post/7574383670435741748</link>    <guid>https://juejin.cn/post/7574383670435741748</guid>    <pubDate>2025-11-20T08:43:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574383670435741748" data-draft-id="7574404398066810880" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue2 的关于 $set 的反直觉行为：为什么先赋值再 $set 不会触发 watch？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-20T08:43:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wenps"/> <meta itemprop="url" content="https://juejin.cn/user/4301712026763790"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue2 的关于 $set 的反直觉行为：为什么先赋值再 $set 不会触发 watch？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4301712026763790/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wenps
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:43:28.000Z" title="Thu Nov 20 2025 08:43:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vue $set 的反直觉行为：为什么先赋值再 $set 不会触发 watch？</h2>
<h3 data-id="heading-1">核心问题</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">watch</span>: {
  <span class="hljs-title function_">c</span>(<span class="hljs-params">val</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'watch 触发了'</span>)
  }
}

<span class="hljs-comment">// 路径 1：直接 $set</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)
<span class="hljs-comment">// ✅ 触发 watch</span>

<span class="hljs-comment">// 路径 2：先赋值再 $set  </span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">b</span> = <span class="hljs-number">1000</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)
<span class="hljs-comment">// ❌ 不触发 watch</span>
</code></pre>
<p><strong>为什么同样用了 <code>$set</code>，结果却不同？</strong></p>
<hr/>
<h3 data-id="heading-2">原因：$set 内部有属性存在性检查</h3>
<h4 data-id="heading-3">$set 源码简化</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">set</span>(<span class="hljs-params">target, key, val</span>) {
  <span class="hljs-comment">// 关键判断：属性是否已存在</span>
  <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">in</span> target &amp;&amp; !(key <span class="hljs-keyword">in</span> <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>)) {
    target[key] = val  <span class="hljs-comment">// ← 只做普通赋值</span>
    <span class="hljs-keyword">return</span> val         <span class="hljs-comment">// ← 直接返回，不触发通知</span>
  }
  
  <span class="hljs-comment">// 属性不存在才走这里</span>
  <span class="hljs-keyword">const</span> ob = target.<span class="hljs-property">__ob__</span>
  <span class="hljs-title function_">defineReactive</span>(target, key, val)  <span class="hljs-comment">// 定义响应式</span>
  ob.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()  <span class="hljs-comment">// ← 触发 watch！</span>
  <span class="hljs-keyword">return</span> val
}
</code></pre>
<h4 data-id="heading-4">关键点</h4>
<p><strong><code>$set</code> 只在属性不存在时才调用 <code>dep.notify()</code></strong></p>
<hr/>
<h3 data-id="heading-5">两条路径的详细分析</h3>
<h4 data-id="heading-6">路径 1：直接 $set（✅ 触发）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 初始状态</span>
c = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }  <span class="hljs-comment">// b 不存在</span>

<span class="hljs-comment">// 执行</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)

<span class="hljs-comment">// 内部逻辑</span>
<span class="hljs-string">'b'</span> <span class="hljs-keyword">in</span> c  <span class="hljs-comment">// → false（属性不存在）</span>
↓
添加响应式属性 b
↓
c.<span class="hljs-property">__ob__</span>.<span class="hljs-property">dep</span>.<span class="hljs-title function_">notify</span>()  <span class="hljs-comment">// ← 触发 watch！</span>
</code></pre>
<h4 data-id="heading-7">路径 2：先赋值再 $set（❌ 不触发）</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 初始状态</span>
c = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }  <span class="hljs-comment">// b 不存在</span>

<span class="hljs-comment">// 第 1 步：普通赋值</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">b</span> = <span class="hljs-number">1000</span>
<span class="hljs-comment">// 现在：c = { a: 1, b: 1000 }</span>
<span class="hljs-comment">// 但 b 不是响应式的！</span>

<span class="hljs-comment">// 第 2 步：$set</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)

<span class="hljs-comment">// 内部逻辑</span>
<span class="hljs-string">'b'</span> <span class="hljs-keyword">in</span> c  <span class="hljs-comment">// → true（属性已存在！）</span>
↓
只执行：c.<span class="hljs-property">b</span> = <span class="hljs-number">1000</span>（普通赋值）
↓
不调用 dep.<span class="hljs-title function_">notify</span>()  <span class="hljs-comment">// ← 不触发 watch！</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">Vue 为什么这样设计？</h3>
<p>Vue 的设计逻辑：</p>
<ol>
<li><strong>新属性</strong> = 对象结构变化 → 需要通知所有观察者</li>
<li><strong>已存在的属性</strong> = 只是值变化 → 应该通过属性自己的 setter 触发</li>
</ol>
<p>但问题是：路径 2 中的 <code>b</code> 虽然存在，但<strong>不是响应式的</strong>（没有 setter），所以：</p>
<ul>
<li><code>$set</code> 认为它已存在，不调用 <code>notify()</code></li>
<li>但它没有 setter，值变化不会触发更新</li>
<li><strong>结果就是：既不通知对象的观察者，也不触发属性的 setter</strong></li>
</ul>
<hr/>
<h3 data-id="heading-9">完整验证代码</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">c</span>: { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span> }
  }
},

<span class="hljs-attr">watch</span>: {
  <span class="hljs-title function_">c</span>(<span class="hljs-params">val</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'watch 触发了！'</span>, val)
  }
},

<span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 测试 1：直接 $set ==='</span>)
  <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)
  <span class="hljs-comment">// ✅ 打印 "watch 触发了！{a: 1, b: 1000}"</span>
  
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 测试 2：先赋值再 $set ==='</span>)
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">d</span> = <span class="hljs-number">2000</span>  <span class="hljs-comment">// 先创建普通属性</span>
    <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'d'</span>, <span class="hljs-number">3000</span>)  <span class="hljs-comment">// 再用 $set</span>
    <span class="hljs-comment">// ❌ 不打印任何东西</span>
  }, <span class="hljs-number">1000</span>)
  
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'=== 测试 3：$set 两次 ==='</span>)
    <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'e'</span>, <span class="hljs-number">4000</span>)  <span class="hljs-comment">// 第一次</span>
    <span class="hljs-comment">// ✅ 打印 "watch 触发了！"</span>
    
    <span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'e'</span>, <span class="hljs-number">5000</span>)  <span class="hljs-comment">// 第二次</span>
    <span class="hljs-comment">// ✅ 也会触发（因为 e 已经是响应式的）</span>
  }, <span class="hljs-number">2000</span>)
}
</code></pre>
<hr/>
<h3 data-id="heading-10">dep.notify() 触发的是什么？</h3>
<h4 data-id="heading-11">Vue 的两层依赖收集</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> c = {
  <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">__ob__</span>: {
    <span class="hljs-attr">dep</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dep</span>()  <span class="hljs-comment">// ← 对象自己的 dep</span>
  }
}

<span class="hljs-comment">// 同时，每个响应式属性也有自己的 dep（通过闭包）</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(c, <span class="hljs-string">'a'</span>, {
  <span class="hljs-title function_">get</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 收集依赖到 a 的 dep</span>
  },
  <span class="hljs-title function_">set</span>(<span class="hljs-params">val</span>) {
    <span class="hljs-comment">// 通知 a 的 dep</span>
  }
})
</code></pre>
<h4 data-id="heading-12">区别</h4>





























<table><thead><tr><th>操作</th><th>触发的 dep</th><th>watch: c</th><th>watch: 'c.a'</th></tr></thead><tbody><tr><td><code>c.a = 2</code></td><td><code>a</code> 的 dep</td><td>❌ 不触发</td><td>✅ 触发</td></tr><tr><td><code>$set(c, 'b', 1)</code></td><td><code>c.__ob__.dep</code></td><td>✅ 触发</td><td>-</td></tr><tr><td><code>c = {}</code></td><td>对象替换</td><td>✅ 触发</td><td>-</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-13">为什么不需要 deep 也能触发？</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">watch</span>: {
  <span class="hljs-title function_">c</span>(<span class="hljs-params">val</span>) {  <span class="hljs-comment">// 没有 deep: true</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'触发了'</span>)
  }
}

<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)
<span class="hljs-comment">// ✅ 会触发</span>
</code></pre>
<p><strong>原因：</strong></p>
<ul>
<li><code>$set</code> 触发的是 <code>c.__ob__.dep</code>（对象自己的 dep）</li>
<li>监听 <code>c</code> 的 watcher 收集的就是这个 dep</li>
<li>不需要 deep，因为是对象结构变化</li>
</ul>
<p><strong>deep 的作用：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">watch</span>: {
  <span class="hljs-attr">c</span>: {
    <span class="hljs-title function_">handler</span>(<span class="hljs-params">val</span>) {},
    <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// ← 递归收集所有属性的 dep</span>
  }
}

<span class="hljs-comment">// 现在修改已有属性也会触发</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">a</span> = <span class="hljs-number">2</span>  <span class="hljs-comment">// ✅ 触发（因为收集了 a 的 dep）</span>
</code></pre>
<hr/>
<h3 data-id="heading-14">最佳实践</h3>
<h4 data-id="heading-15">❌ 永远不要这样做</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">b</span> = <span class="hljs-number">111</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)  <span class="hljs-comment">// 不会触发 watch</span>
</code></pre>
<h4 data-id="heading-16">✅ 正确做法</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方案 1：只用 $set</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">1000</span>)

<span class="hljs-comment">// 方案 2：在 data 中预先声明</span>
<span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">c</span>: {
      <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">b</span>: <span class="hljs-literal">null</span>  <span class="hljs-comment">// 预先声明</span>
    }
  }
}
<span class="hljs-comment">// 现在可以直接赋值</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">b</span> = <span class="hljs-number">1000</span>  <span class="hljs-comment">// ✅ 会触发</span>

<span class="hljs-comment">// 方案 3：整体替换对象</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span> = { ...<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">1000</span> }

<span class="hljs-comment">// 方案 4：分两步（如果需要不同值）</span>
<span class="hljs-variable language_">this</span>.$set(<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>, <span class="hljs-string">'b'</span>, <span class="hljs-number">111</span>)  <span class="hljs-comment">// 第一次触发</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-property">b</span> = <span class="hljs-number">1000</span>              <span class="hljs-comment">// 第二次触发（因为 b 已是响应式）</span>
</code></pre>
<hr/>
<h3 data-id="heading-17">总结表格</h3>



































<table><thead><tr><th>场景</th><th>属性状态</th><th>$set 行为</th><th>是否触发 watch</th></tr></thead><tbody><tr><td><code>$set(c, 'b', 1)</code></td><td>不存在</td><td>添加响应式 + notify</td><td>✅ 触发</td></tr><tr><td><code>c.b = 1; $set(c, 'b', 2)</code></td><td>存在（非响应式）</td><td>只赋值，不 notify</td><td>❌ 不触发</td></tr><tr><td><code>$set(c, 'b', 1); $set(c, 'b', 2)</code></td><td>存在（响应式）</td><td>触发 setter</td><td>✅ 触发</td></tr><tr><td><code>$set(c, 'b', 1); c.b = 2</code></td><td>存在（响应式）</td><td>触发 setter</td><td>✅ 触发</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-18">记住一句话</h3>
<blockquote>
<p><strong><code>$set</code> 只在属性不存在时才调用 <code>dep.notify()</code></strong><br/>
<strong>先赋值再 <code>$set</code> = 属性已存在 = 不会触发 watch</strong></p>
</blockquote>
<hr/>
<p><strong>关键点：</strong></p>
<ul>
<li><code>$set</code> 有属性存在性检查：<code>key in target</code></li>
<li>普通赋值创建的属性不是响应式的</li>
<li>已存在的属性（即使非响应式）会让 <code>$set</code> 跳过 <code>notify()</code></li>
<li>永远不要在 <code>$set</code> 前先赋值！</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 进阶知识总结]]></title>    <link>https://juejin.cn/post/7574601160981217295</link>    <guid>https://juejin.cn/post/7574601160981217295</guid>    <pubDate>2025-11-20T08:47:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574601160981217295" data-draft-id="7574601160981200911" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 进阶知识总结"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-20T08:47:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小小小宇"/> <meta itemprop="url" content="https://juejin.cn/user/3386151546662077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 进阶知识总结
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3386151546662077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小小小宇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:47:31.000Z" title="Thu Nov 20 2025 08:47:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文深入探讨 TypeScript 类型系统的图灵完备性，涵盖从高级泛型、条件类型、模板字面量类型到元编程（装饰器）和 React 高级模式。</p>
<p>内容分为几个核心模块，每个模块都包含详细的理论解释和生产级代码示例。</p>
<hr/>
<h3 data-id="heading-0">模块一：高级泛型与类型体操基础</h3>
<p>在高级开发中，泛型不仅仅是 <code>&lt;T&gt;</code>，它涉及到约束（Constraints）、默认值和递归。</p>
<h4 data-id="heading-1">1.1 深度递归类型与对象属性修饰</h4>
<p>我们需要处理复杂的不可变数据结构或深度可选配置。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块一：高级泛型工具类型
 * 场景：复杂状态管理、配置对象处理
 */</span>

<span class="hljs-comment">// 1. DeepPartial: 递归地将对象所有属性变为可选</span>
<span class="hljs-comment">// 这在处理大型配置对象（如 Webpack 配置或图表库配置）时非常有用</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepPartial</span>&lt;T&gt; = {
    [P <span class="hljs-keyword">in</span> keyof T]?: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? <span class="hljs-title class_">DeepPartial</span>&lt;T[P]&gt; : T[P];
};

<span class="hljs-comment">// 2. DeepReadonly: 递归地将对象所有属性变为只读</span>
<span class="hljs-comment">// 用于 Redux 的 State 或任何不可变数据结构</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepReadonly</span>&lt;T&gt; = {
    <span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? <span class="hljs-title class_">DeepReadonly</span>&lt;T[P]&gt; : T[P];
};

<span class="hljs-comment">// 3. DeepRequired: 递归移除可选属性</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepRequired</span>&lt;T&gt; = {
    [P <span class="hljs-keyword">in</span> keyof T]-?: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? <span class="hljs-title class_">DeepRequired</span>&lt;T[P]&gt; : T[P];
};

<span class="hljs-comment">// 4. Mutable: 移除只读属性</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Mutable</span>&lt;T&gt; = {
    -<span class="hljs-keyword">readonly</span> [P <span class="hljs-keyword">in</span> keyof T]: T[P];
};

<span class="hljs-comment">// --- 测试案例 ---</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserSettings</span> {
    <span class="hljs-attr">theme</span>: {
        <span class="hljs-attr">mode</span>: <span class="hljs-string">'dark'</span> | <span class="hljs-string">'light'</span>;
        <span class="hljs-attr">palette</span>: {
            <span class="hljs-attr">primary</span>: <span class="hljs-built_in">string</span>;
            secondary?: <span class="hljs-built_in">string</span>;
        };
    };
    <span class="hljs-attr">notifications</span>: {
        <span class="hljs-attr">email</span>: <span class="hljs-built_in">boolean</span>;
        sms?: <span class="hljs-built_in">boolean</span>;
    };
}

<span class="hljs-comment">// 使用 DeepPartial，允许只配置部分层级</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">initialConfig</span>: <span class="hljs-title class_">DeepPartial</span>&lt;<span class="hljs-title class_">UserSettings</span>&gt; = {
    <span class="hljs-attr">theme</span>: {
        <span class="hljs-attr">palette</span>: {
            <span class="hljs-attr">primary</span>: <span class="hljs-string">'#007bff'</span>
        }
    }
};

<span class="hljs-comment">// 使用 DeepReadonly 保护状态</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">state</span>: <span class="hljs-title class_">DeepReadonly</span>&lt;<span class="hljs-title class_">UserSettings</span>&gt; = {
    <span class="hljs-attr">theme</span>: {
        <span class="hljs-attr">mode</span>: <span class="hljs-string">'dark'</span>,
        <span class="hljs-attr">palette</span>: { <span class="hljs-attr">primary</span>: <span class="hljs-string">'#000'</span>, <span class="hljs-attr">secondary</span>: <span class="hljs-string">'#fff'</span> }
    },
    <span class="hljs-attr">notifications</span>: { <span class="hljs-attr">email</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">sms</span>: <span class="hljs-literal">false</span> }
};

<span class="hljs-comment">// state.theme.mode = 'light'; // 报错：无法分配到 "mode" ，因为它是只读属性。</span>

<span class="hljs-comment">// --- 进阶：复杂键值过滤 ---</span>

<span class="hljs-comment">// 获取类型中所有非函数属性的 Key</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NonFunctionKeys</span>&lt;T&gt; = {
    [K <span class="hljs-keyword">in</span> keyof T]: T[K] <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Function</span> ? <span class="hljs-built_in">never</span> : K;
}[keyof T];

<span class="hljs-comment">// 获取类型中所有函数属性的 Key</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">FunctionKeys</span>&lt;T&gt; = {
    [K <span class="hljs-keyword">in</span> keyof T]: T[K] <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Function</span> ? K : <span class="hljs-built_in">never</span>;
}[keyof T];

<span class="hljs-comment">// 仅提取对象中的数据部分</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PickData</span>&lt;T&gt; = <span class="hljs-title class_">Pick</span>&lt;T, <span class="hljs-title class_">NonFunctionKeys</span>&lt;T&gt;&gt;;
<span class="hljs-comment">// 仅提取对象中的方法部分</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PickMethods</span>&lt;T&gt; = <span class="hljs-title class_">Pick</span>&lt;T, <span class="hljs-title class_">FunctionKeys</span>&lt;T&gt;&gt;;

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Admin"</span>;
    
    <span class="hljs-title function_">login</span>(): <span class="hljs-built_in">void</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Logging in..."</span>); }
    <span class="hljs-title function_">logout</span>(): <span class="hljs-built_in">void</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Logging out..."</span>); }
    <span class="hljs-title function_">updateProfile</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">PickData</span>&lt;<span class="hljs-title class_">UserService</span>&gt;): <span class="hljs-built_in">void</span> { 
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = data.<span class="hljs-property">name</span>;
    }
}

<span class="hljs-keyword">const</span> service = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();
<span class="hljs-keyword">const</span> <span class="hljs-attr">dataOnly</span>: <span class="hljs-title class_">PickData</span>&lt;<span class="hljs-title class_">UserService</span>&gt; = { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"User"</span> };
<span class="hljs-comment">// const methodOnly: PickMethods&lt;UserService&gt; = { login: () =&gt; {} }; // 正确</span>
</code></pre>
<hr/>
<h3 data-id="heading-2">模块二：条件类型（Conditional Types）与 <code>infer</code> 关键字</h3>
<p>这是 TypeScript 类型编程的核心。通过 <code>infer</code>，我们可以“解包”类型，例如获取 Promise 的返回值、数组的元素类型或函数的参数类型。</p>
<h4 data-id="heading-3">2.1 类型推断与解包工具</h4>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块二：条件类型与 infer
 * 场景：API 响应处理、函数包装器、Vue/React 类型推导
 */</span>

<span class="hljs-comment">// 1. Unpacked: 解包数组、Promise 或基本类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Unpacked</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (infer U)[] 
    ? U 
    : T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt;
    ? U
    : T;

<span class="hljs-comment">// 测试 Unpacked</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T0</span> = <span class="hljs-title class_">Unpacked</span>&lt;<span class="hljs-built_in">string</span>&gt;;  <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T1</span> = <span class="hljs-title class_">Unpacked</span>&lt;<span class="hljs-built_in">string</span>[]&gt;; <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T2</span> = <span class="hljs-title class_">Unpacked</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;; <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T3</span> = <span class="hljs-title class_">Unpacked</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;[]&gt;; <span class="hljs-comment">// Promise&lt;string&gt;</span>

<span class="hljs-comment">// 2. GetReturnType: 获取函数返回类型 (内置 ReturnType 的实现原理)</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">MyReturnType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; infer R ? R : <span class="hljs-built_in">any</span>;

<span class="hljs-comment">// 3. GetParameters: 获取函数参数类型 (内置 Parameters 的实现原理)</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">MyParameters</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: infer P) =&gt; <span class="hljs-built_in">any</span> ? P : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// --- 实战：类型安全的 API 请求封装 ---</span>

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiResponse</span>&lt;<span class="hljs-title class_">TData</span>&gt; {
    <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">data</span>: <span class="hljs-title class_">TData</span>;
}

<span class="hljs-comment">// 模拟后端 API 函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserInfo</span>(<span class="hljs-params">userId: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ApiResponse</span>&lt;{ <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> }&gt;&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">"success"</span>,
        <span class="hljs-attr">data</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }
    });
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getPosts</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ApiResponse</span>&lt;{ <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> }[]&gt;&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">"success"</span>,
        <span class="hljs-attr">data</span>: [{ <span class="hljs-attr">title</span>: <span class="hljs-string">"TS is awesome"</span> }]
    });
}

<span class="hljs-comment">// 高级工具：提取 API 函数 Promise 解析后的 Data 部分</span>
<span class="hljs-comment">// 逻辑：</span>
<span class="hljs-comment">// 1. T 必须是一个函数</span>
<span class="hljs-comment">// 2. 函数返回 Promise&lt;ApiResponse&lt;Data&gt;&gt;</span>
<span class="hljs-comment">// 3. 提取 Data</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ExtractApiData</span>&lt;T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt; = 
    <span class="hljs-title class_">ReturnType</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ApiResponse</span>&lt;infer <span class="hljs-title class_">Data</span>&gt;&gt; ? <span class="hljs-title class_">Data</span> : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// 自动推导出的类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UserData</span> = <span class="hljs-title class_">ExtractApiData</span>&lt;<span class="hljs-keyword">typeof</span> getUserInfo&gt;; <span class="hljs-comment">// { name: string; age: number }</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PostsData</span> = <span class="hljs-title class_">ExtractApiData</span>&lt;<span class="hljs-keyword">typeof</span> getPosts&gt;;   <span class="hljs-comment">// { title: string }[]</span>

<span class="hljs-comment">// 通用处理函数，自动保持类型</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> apiHandler&lt;<span class="hljs-title class_">TFunc</span> <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>) =&gt; <span class="hljs-built_in">any</span>&gt;(
    <span class="hljs-attr">apiFunc</span>: <span class="hljs-title class_">TFunc</span>, 
    ...<span class="hljs-attr">args</span>: <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-title class_">TFunc</span>&gt;
): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ExtractApiData</span>&lt;<span class="hljs-title class_">TFunc</span>&gt;&gt; {
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">apiFunc</span>(...args);
    <span class="hljs-comment">// 这里假设 response 结构符合 ApiResponse</span>
    <span class="hljs-comment">// 在实际项目中通常会有拦截器处理</span>
    <span class="hljs-keyword">if</span> ((response <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">code</span> === <span class="hljs-number">200</span>) {
        <span class="hljs-keyword">return</span> (response <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">data</span>;
    }
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>((response <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">message</span>);
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// user 自动被推断为 { name: string; age: number }</span>
    <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">apiHandler</span>(getUserInfo, <span class="hljs-string">"123"</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(user.<span class="hljs-property">name</span>);

    <span class="hljs-comment">// posts 自动被推断为 { title: string }[]</span>
    <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> <span class="hljs-title function_">apiHandler</span>(getPosts);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(posts[<span class="hljs-number">0</span>].<span class="hljs-property">title</span>);
}
</code></pre>
<hr/>
<h3 data-id="heading-4">模块三：模板字面量类型（Template Literal Types）</h3>
<p>TS 4.1 引入的特性，允许对字符串进行模式匹配和操作。这在处理 CSS 类名、事件名称或路由路径时非常强大。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块三：模板字面量类型
 * 场景：CSS-in-JS、事件系统、国际化键值生成
 */</span>

<span class="hljs-comment">// 1. 简单的字符串拼接</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Color</span> = <span class="hljs-string">"red"</span> | <span class="hljs-string">"blue"</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Quantity</span> = <span class="hljs-string">"100"</span> | <span class="hljs-string">"200"</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ItemCssClass</span> = <span class="hljs-string">`bg-<span class="hljs-subst">${Color}</span>-<span class="hljs-subst">${Quantity}</span>`</span>; 
<span class="hljs-comment">// "bg-red-100" | "bg-red-200" | "bg-blue-100" | "bg-blue-200"</span>

<span class="hljs-comment">// 2. 事件名称生成器</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Entity</span> = <span class="hljs-string">"User"</span> | <span class="hljs-string">"Product"</span> | <span class="hljs-string">"Order"</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Operation</span> = <span class="hljs-string">"Create"</span> | <span class="hljs-string">"Update"</span> | <span class="hljs-string">"Delete"</span>;

<span class="hljs-comment">// 自动生成所有可能的事件名</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">EventName</span> = <span class="hljs-string">`<span class="hljs-subst">${Entity}</span><span class="hljs-subst">${Operation}</span>`</span>; 
<span class="hljs-comment">// "UserCreate" | "UserUpdate" | ... | "OrderDelete"</span>

<span class="hljs-comment">// --- 实战：类型安全的事件总线 (Event Bus) ---</span>

<span class="hljs-comment">// 定义事件负载映射</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">EventPayloads</span> = {
    <span class="hljs-string">"user:login"</span>: { <span class="hljs-attr">userId</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">time</span>: <span class="hljs-built_in">number</span> };
    <span class="hljs-string">"user:logout"</span>: <span class="hljs-built_in">void</span>;
    <span class="hljs-string">"modal:open"</span>: { <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span> };
    <span class="hljs-string">"modal:close"</span>: <span class="hljs-built_in">void</span>;
};

<span class="hljs-comment">// 字符串操作工具类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Split</span>&lt;S <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>, D <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt; = 
    <span class="hljs-built_in">string</span> <span class="hljs-keyword">extends</span> S ? <span class="hljs-built_in">string</span>[] :
    S <span class="hljs-keyword">extends</span> <span class="hljs-string">''</span> ? [] :
    S <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">${infer T}</span><span class="hljs-subst">${D}</span><span class="hljs-subst">${infer U}</span>`</span> ? [T, ...<span class="hljs-title class_">Split</span>&lt;U, D&gt;] : [S];

<span class="hljs-comment">// 测试 Split</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Parts</span> = <span class="hljs-title class_">Split</span>&lt;<span class="hljs-string">"user:login:success"</span>, <span class="hljs-string">":"</span>&gt;; <span class="hljs-comment">// ["user", "login", "success"]</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TypedEventBus</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: { [K <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">EventPayloads</span>]?: (<span class="hljs-function">(<span class="hljs-params">payload: EventPayloads[K]</span>) =&gt;</span> <span class="hljs-built_in">void</span>)[] } = {};

    <span class="hljs-comment">// on 方法：EventName 必须是 EventPayloads 的键，cb 参数自动推导</span>
    on&lt;K <span class="hljs-keyword">extends</span> keyof <span class="hljs-title class_">EventPayloads</span>&gt;(<span class="hljs-attr">eventName</span>: K, <span class="hljs-attr">cb</span>: <span class="hljs-function">(<span class="hljs-params">payload: EventPayloads[K]</span>) =&gt;</span> <span class="hljs-built_in">void</span>) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName]) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName] = [];
        }
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName]!.<span class="hljs-title function_">push</span>(cb);
    }

    <span class="hljs-comment">// emit 方法：payload 类型必须匹配</span>
    emit&lt;K <span class="hljs-keyword">extends</span> keyof <span class="hljs-title class_">EventPayloads</span>&gt;(<span class="hljs-attr">eventName</span>: K, <span class="hljs-attr">payload</span>: <span class="hljs-title class_">EventPayloads</span>[K]) {
        <span class="hljs-keyword">const</span> callbacks = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>[eventName];
        <span class="hljs-keyword">if</span> (callbacks) {
            callbacks.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> <span class="hljs-title function_">cb</span>(payload));
        }
    }
}

<span class="hljs-keyword">const</span> bus = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TypedEventBus</span>();

<span class="hljs-comment">// 类型安全：payload 自动推断为 { userId: string; time: number }</span>
bus.<span class="hljs-title function_">on</span>(<span class="hljs-string">"user:login"</span>, <span class="hljs-function">(<span class="hljs-params">payload</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`User <span class="hljs-subst">${payload.userId}</span> logged in at <span class="hljs-subst">${payload.time}</span>`</span>);
});

<span class="hljs-comment">// 类型报错演示</span>
<span class="hljs-comment">// bus.emit("user:login", { userId: 123 }); // Error: Type 'number' is not assignable to type 'string'.</span>
bus.<span class="hljs-title function_">emit</span>(<span class="hljs-string">"user:login"</span>, { <span class="hljs-attr">userId</span>: <span class="hljs-string">"u_001"</span>, <span class="hljs-attr">time</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() }); <span class="hljs-comment">// OK</span>

<span class="hljs-comment">// --- 进阶：CSS Padding/Margin 简写类型检查 ---</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">SizeUnit</span> = <span class="hljs-string">"px"</span> | <span class="hljs-string">"em"</span> | <span class="hljs-string">"rem"</span> | <span class="hljs-string">"%"</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">SizeValue</span> = <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">number</span>}</span><span class="hljs-subst">${SizeUnit}</span>`</span> | <span class="hljs-string">"0"</span> | <span class="hljs-string">"auto"</span>;

<span class="hljs-comment">// 允许 1 到 4 个值</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">CSSPadding</span> = 
    | <span class="hljs-title class_">SizeValue</span>
    | <span class="hljs-string">`<span class="hljs-subst">${SizeValue}</span> <span class="hljs-subst">${SizeValue}</span>`</span>
    | <span class="hljs-string">`<span class="hljs-subst">${SizeValue}</span> <span class="hljs-subst">${SizeValue}</span> <span class="hljs-subst">${SizeValue}</span>`</span>
    | <span class="hljs-string">`<span class="hljs-subst">${SizeValue}</span> <span class="hljs-subst">${SizeValue}</span> <span class="hljs-subst">${SizeValue}</span> <span class="hljs-subst">${SizeValue}</span>`</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">setPadding</span>(<span class="hljs-params">el: HTMLElement, padding: CSSPadding</span>) {
    el.<span class="hljs-property">style</span>.<span class="hljs-property">padding</span> = padding;
}

<span class="hljs-comment">// setPadding(document.body, "10px"); // OK</span>
<span class="hljs-comment">// setPadding(document.body, "10px 20px"); // OK</span>
<span class="hljs-comment">// setPadding(document.body, "10px 20px 0 5%"); // OK</span>
<span class="hljs-comment">// setPadding(document.body, "10"); // Error: 缺少单位</span>
<span class="hljs-comment">// setPadding(document.body, "red"); // Error</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">模块四：装饰器（Decorators）与元编程</h3>
<p>虽然装饰器在 ECMAScript 中仍处于演进阶段，但在 TypeScript（尤其是 Angular 和 NestJS 生态）中应用广泛。这里展示基于 TypeScript 实验性装饰器的高级用法。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块四：装饰器与 AOP (面向切面编程)
 * 注意：需要在 tsconfig.json 中开启 "experimentalDecorators": true
 */</span>

<span class="hljs-comment">// 1. 方法装饰器：日志记录与性能监控</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">LogPerformance</span>(<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
    <span class="hljs-keyword">const</span> originalMethod = descriptor.<span class="hljs-property">value</span>;

    descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) {
        <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>();
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Starting] <span class="hljs-subst">${propertyKey}</span> with args:`</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(args));
        
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> originalMethod.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
            <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[Finished] <span class="hljs-subst">${propertyKey}</span> in <span class="hljs-subst">${(end - start).toFixed(<span class="hljs-number">2</span>)}</span>ms`</span>);
            <span class="hljs-keyword">return</span> result;
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`[Error] <span class="hljs-subst">${propertyKey}</span> failed:`</span>, error);
            <span class="hljs-keyword">throw</span> error;
        }
    };
    <span class="hljs-keyword">return</span> descriptor;
}

<span class="hljs-comment">// 2. 参数装饰器与方法装饰器配合：参数校验</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"reflect-metadata"</span>; <span class="hljs-comment">// 需要 npm install reflect-metadata</span>

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REQUIRED_METADATA_KEY</span> = <span class="hljs-title class_">Symbol</span>(<span class="hljs-string">"required"</span>);

<span class="hljs-comment">// 参数装饰器：标记哪个参数是必填的</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Required</span>(<span class="hljs-params">target: <span class="hljs-built_in">Object</span>, propertyKey: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">symbol</span>, parameterIndex: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-keyword">let</span> <span class="hljs-attr">existingRequiredParameters</span>: <span class="hljs-built_in">number</span>[] = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getOwnMetadata</span>(<span class="hljs-variable constant_">REQUIRED_METADATA_KEY</span>, target, propertyKey) || [];
    existingRequiredParameters.<span class="hljs-title function_">push</span>(parameterIndex);
    <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineMetadata</span>(<span class="hljs-variable constant_">REQUIRED_METADATA_KEY</span>, existingRequiredParameters, target, propertyKey);
}

<span class="hljs-comment">// 方法装饰器：执行校验逻辑</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Validate</span>(<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyName: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
    <span class="hljs-keyword">let</span> method = descriptor.<span class="hljs-property">value</span>;
    descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">let</span> <span class="hljs-attr">requiredParameters</span>: <span class="hljs-built_in">number</span>[] = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getOwnMetadata</span>(<span class="hljs-variable constant_">REQUIRED_METADATA_KEY</span>, target, propertyName);
        <span class="hljs-keyword">if</span> (requiredParameters) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> parameterIndex <span class="hljs-keyword">of</span> requiredParameters) {
                <span class="hljs-keyword">if</span> (parameterIndex &gt;= <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span> || <span class="hljs-variable language_">arguments</span>[parameterIndex] === <span class="hljs-literal">undefined</span> || <span class="hljs-variable language_">arguments</span>[parameterIndex] === <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Missing required argument at index <span class="hljs-subst">${parameterIndex}</span> for method <span class="hljs-subst">${propertyName}</span>`</span>);
                }
            }
        }
        <span class="hljs-keyword">return</span> method.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);
    }
}

<span class="hljs-comment">// 3. 类装饰器：依赖注入 (简易版 IOC 容器)</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Constructor</span>&lt;T = <span class="hljs-built_in">any</span>&gt; = <span class="hljs-keyword">new</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; T;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ServiceMap</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;();

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Service</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">constructor: Constructor</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Registering service: <span class="hljs-subst">${name}</span>`</span>);
        <span class="hljs-title class_">ServiceMap</span>.<span class="hljs-title function_">set</span>(name, <span class="hljs-keyword">new</span> <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>));
    }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Inject</span>(<span class="hljs-params">serviceName: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-comment">// 在属性被访问时懒加载注入</span>
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(target, propertyKey, {
            <span class="hljs-attr">get</span>: <span class="hljs-function">() =&gt;</span> {
                <span class="hljs-keyword">const</span> service = <span class="hljs-title class_">ServiceMap</span>.<span class="hljs-title function_">get</span>(serviceName);
                <span class="hljs-keyword">if</span> (!service) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Service <span class="hljs-subst">${serviceName}</span> not found`</span>);
                <span class="hljs-keyword">return</span> service;
            },
            <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>
        });
    }
}

<span class="hljs-comment">// --- 综合应用 ---</span>

<span class="hljs-meta">@Service</span>(<span class="hljs-string">"Logger"</span>)
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggerService</span> {
    <span class="hljs-title function_">log</span>(<span class="hljs-params">msg: <span class="hljs-built_in">string</span></span>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[LOG SERVICE]: <span class="hljs-subst">${msg}</span>`</span>); }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    <span class="hljs-meta">@Inject</span>(<span class="hljs-string">"Logger"</span>)
    <span class="hljs-keyword">private</span> logger!: <span class="hljs-title class_">LoggerService</span>;

    <span class="hljs-meta">@Validate</span>
    <span class="hljs-meta">@LogPerformance</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">createUser</span>(<span class="hljs-params"><span class="hljs-meta">@Required</span> name: <span class="hljs-built_in">string</span>, <span class="hljs-meta">@Required</span> email: <span class="hljs-built_in">string</span>, age?: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-comment">// 模拟异步操作</span>
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">100</span>));
        
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">logger</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Creating user: <span class="hljs-subst">${name}</span> (<span class="hljs-subst">${email}</span>)`</span>);
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">id</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">1000</span>), name, email };
    }
}

<span class="hljs-comment">// 测试运行</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">runDecorators</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserController</span>();
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> controller.<span class="hljs-title function_">createUser</span>(<span class="hljs-string">"Bob"</span>, <span class="hljs-string">"bob@example.com"</span>); <span class="hljs-comment">// 成功</span>
        <span class="hljs-comment">// await controller.createUser("Alice", null as any); // 抛出 Error: Missing required argument</span>
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(e);
    }
}
<span class="hljs-comment">// runDecorators();</span>
</code></pre>
<hr/>
<h3 data-id="heading-6">模块五：React 高级模式与多态组件</h3>
<p>在前端开发中，React 的类型定义尤为重要。我们将构建一个多态组件（Polymorphic Component），它可以根据 <code>as</code> 属性改变渲染的 HTML 标签，同时保持类型安全。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块五：React 高级类型模式
 * 场景：组件库开发、高阶组件 (HOC)
 */</span>

<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;

<span class="hljs-comment">// 1. 多态组件 (Polymorphic Components)</span>
<span class="hljs-comment">// 这是一个非常高级的模式，允许 &lt;Text as="h1"&gt; 或 &lt;Text as="a" href="..."&gt;</span>

<span class="hljs-comment">// 获取元素自身的 Props，排除我们要重写的 'as'</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">AsProp</span>&lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span>&gt; = {
    <span class="hljs-keyword">as</span>?: C;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PropsToOmit</span>&lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span>, P&gt; = keyof (<span class="hljs-title class_">AsProp</span>&lt;C&gt; &amp; P);

<span class="hljs-comment">// 这是一个复杂的类型定义：</span>
<span class="hljs-comment">// 1. 接收泛型 C (组件类型) 和 Props</span>
<span class="hljs-comment">// 2. 合并传入的 Props 和 as 属性</span>
<span class="hljs-comment">// 3. 合并 HTML 原生属性 (Omit 掉重复的)</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PolymorphicComponentProps</span>&lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span>, <span class="hljs-title class_">Props</span> = {}&gt; = 
    <span class="hljs-title class_">React</span>.<span class="hljs-property">PropsWithChildren</span>&lt;<span class="hljs-title class_">Props</span> &amp; <span class="hljs-title class_">AsProp</span>&lt;C&gt;&gt; &amp;
    <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">React</span>.<span class="hljs-property">ComponentPropsWithoutRef</span>&lt;C&gt;, <span class="hljs-title class_">PropsToOmit</span>&lt;C, <span class="hljs-title class_">Props</span>&gt;&gt;;

<span class="hljs-comment">// 定义组件类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">PolymorphicRef</span>&lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span>&gt; = <span class="hljs-title class_">React</span>.<span class="hljs-property">ComponentPropsWithRef</span>&lt;C&gt;[<span class="hljs-string">"ref"</span>];

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PolymorphicComponentPropWithRef</span>&lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span>, <span class="hljs-title class_">Props</span> = {}&gt; = 
    <span class="hljs-title class_">PolymorphicComponentProps</span>&lt;C, <span class="hljs-title class_">Props</span>&gt; &amp; { ref?: <span class="hljs-title class_">PolymorphicRef</span>&lt;C&gt; };

<span class="hljs-comment">// 实现组件</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">TextProps</span> = {
    color?: <span class="hljs-string">'primary'</span> | <span class="hljs-string">'secondary'</span> | <span class="hljs-string">'danger'</span>;
    size?: <span class="hljs-string">'sm'</span> | <span class="hljs-string">'md'</span> | <span class="hljs-string">'lg'</span>;
};

<span class="hljs-comment">// 使用 React.forwardRef 实现</span>
<span class="hljs-comment">// 注意：由于泛型组件和 forwardRef 的结合在 TS 中比较棘手，通常需要类型断言</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">Text</span> = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">forwardRef</span>(
    &lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span> = <span class="hljs-string">"span"</span>&gt;<span class="hljs-function">(<span class="hljs-params">
        { <span class="hljs-keyword">as</span>, color = <span class="hljs-string">'primary'</span>, size = <span class="hljs-string">'md'</span>, children, ...rest }: PolymorphicComponentProps&lt;C, TextProps&gt;,
        ref: PolymorphicRef&lt;C&gt;
    </span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-title class_">Component</span> = <span class="hljs-keyword">as</span> || <span class="hljs-string">"span"</span>;
        
        <span class="hljs-keyword">const</span> style = {
            <span class="hljs-attr">color</span>: color === <span class="hljs-string">'danger'</span> ? <span class="hljs-string">'red'</span> : <span class="hljs-string">'black'</span>,
            <span class="hljs-attr">fontSize</span>: size === <span class="hljs-string">'lg'</span> ? <span class="hljs-string">'20px'</span> : <span class="hljs-string">'14px'</span>
        };

        <span class="hljs-keyword">return</span> (
            <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Component</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{style}</span> {<span class="hljs-attr">...rest</span>}&gt;</span>
                {children}
            <span class="hljs-tag">&lt;/<span class="hljs-name">Component</span>&gt;</span></span>
        );
    }
) <span class="hljs-keyword">as</span> &lt;C <span class="hljs-keyword">extends</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ElementType</span> = <span class="hljs-string">"span"</span>&gt;<span class="hljs-function">(<span class="hljs-params">
    props: PolymorphicComponentPropWithRef&lt;C, TextProps&gt;
</span>) =&gt;</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactElement</span> | <span class="hljs-literal">null</span>;

<span class="hljs-comment">// --- 使用示例 ---</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            {/* 渲染为 span (默认) */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
            
            {/* 渲染为 h1 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"h1"</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"lg"</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
            
            {/* 渲染为 a 标签，TS 会自动提示 href 属性是必须的/可用的 */}
            <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"a"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://google.com"</span> <span class="hljs-attr">color</span>=<span class="hljs-string">"danger"</span>&gt;</span>
                Link
            <span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
            
            {/* 错误演示：div 没有 href 属性 */}
            {/* <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">as</span>=<span class="hljs-string">"div"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"..."</span> /&gt;</span> // Error: Property 'href' does not exist on type... */}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
}

<span class="hljs-comment">// 2. 类型安全的 Render Props</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ListProps</span>&lt;T&gt; {
    <span class="hljs-attr">items</span>: T[];
    <span class="hljs-attr">renderItem</span>: <span class="hljs-function">(<span class="hljs-params">item: T, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-title class_">React</span>.<span class="hljs-property">ReactNode</span>;
}

<span class="hljs-comment">// 使用泛型组件定义</span>
<span class="hljs-keyword">function</span> <span class="hljs-title class_">List</span>&lt;T&gt;({ items, renderItem }: <span class="hljs-title class_">ListProps</span>&lt;T&gt;) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
            {items.map((item, index) =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span>&gt;</span>{renderItem(item, index)}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
            ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span></span>
    );
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-comment">// &lt;List </span>
<span class="hljs-comment">//   items={[{ id: 1, name: 'A' }, { id: 2, name: 'B' }]} </span>
<span class="hljs-comment">//   renderItem={(item) =&gt; &lt;span&gt;{item.name}&lt;/span&gt;} // item 自动推断为对象</span>
<span class="hljs-comment">// /&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-7">模块六：混合（Mixins）与类的组合</h3>
<p>TypeScript 支持 Mixin 模式，允许我们将多个类的功能组合到一个类中。这在构建复杂的 UI 组件库（如 Material CDK）时非常常见。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块六：Mixins
 * 场景：多重继承模拟、功能组合
 */</span>

<span class="hljs-comment">// 定义构造函数类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Constructor</span>&lt;T = {}&gt; = <span class="hljs-keyword">new</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; T;

<span class="hljs-comment">// 1. Activatable Mixin: 添加激活/未激活状态</span>
<span class="hljs-keyword">function</span> <span class="hljs-title class_">Activatable</span>&lt;<span class="hljs-title class_">TBase</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Constructor</span>&gt;(<span class="hljs-title class_">Base</span>: <span class="hljs-title class_">TBase</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">Base</span> {
        <span class="hljs-attr">isActivated</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;

        <span class="hljs-title function_">activate</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isActivated</span> = <span class="hljs-literal">true</span>;
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Activated!"</span>);
        }

        <span class="hljs-title function_">deactivate</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isActivated</span> = <span class="hljs-literal">false</span>;
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Deactivated!"</span>);
        }
    };
}

<span class="hljs-comment">// 2. Disposable Mixin: 添加资源清理功能</span>
<span class="hljs-keyword">function</span> <span class="hljs-title class_">Disposable</span>&lt;<span class="hljs-title class_">TBase</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Constructor</span>&gt;(<span class="hljs-title class_">Base</span>: <span class="hljs-title class_">TBase</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">Base</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-attr">disposables</span>: (<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>)[] = [];

        <span class="hljs-title function_">addDisposable</span>(<span class="hljs-params">cb: () =&gt; <span class="hljs-built_in">void</span></span>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">disposables</span>.<span class="hljs-title function_">push</span>(cb);
        }

        <span class="hljs-title function_">dispose</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">disposables</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cb</span> =&gt;</span> <span class="hljs-title function_">cb</span>());
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">disposables</span> = [];
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Resources disposed."</span>);
        }
    };
}

<span class="hljs-comment">// 3. Timestamped Mixin: 记录创建时间</span>
<span class="hljs-keyword">function</span> <span class="hljs-title class_">Timestamped</span>&lt;<span class="hljs-title class_">TBase</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Constructor</span>&gt;(<span class="hljs-title class_">Base</span>: <span class="hljs-title class_">TBase</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> <span class="hljs-title class_">Base</span> {
        timestamp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();
    };
}

<span class="hljs-comment">// --- 组合使用 ---</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">BaseComponent</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }
    
    <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Rendering <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
    }
}

<span class="hljs-comment">// 创建一个拥有所有能力的类</span>
<span class="hljs-comment">// 注意：Mixin 的应用顺序会影响类的层级</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">SmartComponent</span> = <span class="hljs-title class_">Timestamped</span>(<span class="hljs-title class_">Disposable</span>(<span class="hljs-title class_">Activatable</span>(<span class="hljs-title class_">BaseComponent</span>)));

<span class="hljs-comment">// 演示</span>
<span class="hljs-keyword">const</span> comp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SmartComponent</span>(<span class="hljs-string">"MyButton"</span>);

comp.<span class="hljs-title function_">render</span>(); <span class="hljs-comment">// 来自 BaseComponent</span>
comp.<span class="hljs-title function_">activate</span>(); <span class="hljs-comment">// 来自 Activatable</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Created at: <span class="hljs-subst">${comp.timestamp}</span>`</span>); <span class="hljs-comment">// 来自 Timestamped</span>

comp.<span class="hljs-title function_">addDisposable</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Cleaning up event listeners..."</span>));
comp.<span class="hljs-title function_">dispose</span>(); <span class="hljs-comment">// 来自 Disposable</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">模块七：高级类型守卫与断言</h3>
<p>运行时类型检查对于前端应用的健壮性至关重要。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块七：类型守卫 (Type Guards) 与断言
 * 场景：处理联合类型、运行时数据验证
 */</span>

<span class="hljs-comment">// 1. 区分联合类型 (Discriminated Unions)</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Square</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"square"</span>;
    <span class="hljs-attr">size</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Rectangle</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"rectangle"</span>;
    <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Circle</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"circle"</span>;
    <span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Shape</span> = <span class="hljs-title class_">Square</span> | <span class="hljs-title class_">Rectangle</span> | <span class="hljs-title class_">Circle</span>;

<span class="hljs-comment">// 计算面积：利用 switch 的类型收窄</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">area</span>(<span class="hljs-params">s: Shape</span>): <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">switch</span> (s.<span class="hljs-property">kind</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"square"</span>:
            <span class="hljs-comment">// 在这里 s 被收窄为 Square</span>
            <span class="hljs-keyword">return</span> s.<span class="hljs-property">size</span> * s.<span class="hljs-property">size</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"rectangle"</span>:
            <span class="hljs-comment">// 在这里 s 被收窄为 Rectangle</span>
            <span class="hljs-keyword">return</span> s.<span class="hljs-property">width</span> * s.<span class="hljs-property">height</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"circle"</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * s.<span class="hljs-property">radius</span> ** <span class="hljs-number">2</span>;
        <span class="hljs-attr">default</span>:
            <span class="hljs-comment">// 穷尽性检查 (Exhaustiveness checking)</span>
            <span class="hljs-comment">// 如果未来添加了新形状但没处理，这里会报错</span>
            <span class="hljs-keyword">const</span> <span class="hljs-attr">_exhaustiveCheck</span>: <span class="hljs-built_in">never</span> = s;
            <span class="hljs-keyword">return</span> _exhaustiveCheck;
    }
}

<span class="hljs-comment">// 2. 用户自定义类型守卫 (User-Defined Type Guards)</span>
<span class="hljs-comment">// 返回值类型必须是 `arg is Type`</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isString</span>(<span class="hljs-params">value: <span class="hljs-built_in">unknown</span></span>): value is <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">"string"</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isDate</span>(<span class="hljs-params">value: <span class="hljs-built_in">unknown</span></span>): value is <span class="hljs-title class_">Date</span> {
    <span class="hljs-keyword">return</span> value <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Date</span>;
}

<span class="hljs-comment">// 复杂对象的类型守卫</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiError</span> {
    <span class="hljs-attr">error</span>: <span class="hljs-literal">true</span>;
    <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">details</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ApiSuccess</span>&lt;T&gt; {
    <span class="hljs-attr">error</span>: <span class="hljs-literal">false</span>;
    <span class="hljs-attr">data</span>: T;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">ApiResult</span>&lt;T&gt; = <span class="hljs-title class_">ApiSuccess</span>&lt;T&gt; | <span class="hljs-title class_">ApiError</span>;

<span class="hljs-keyword">function</span> isSuccess&lt;T&gt;(<span class="hljs-attr">result</span>: <span class="hljs-title class_">ApiResult</span>&lt;T&gt;): result is <span class="hljs-title class_">ApiSuccess</span>&lt;T&gt; {
    <span class="hljs-keyword">return</span> result.<span class="hljs-property">error</span> === <span class="hljs-literal">false</span>;
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleApiResult</span>(<span class="hljs-params">result: ApiResult&lt;<span class="hljs-built_in">string</span>&gt;</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isSuccess</span>(result)) {
        <span class="hljs-comment">// TS 知道这里是 ApiSuccess，可以安全访问 .data</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">data</span>.<span class="hljs-title function_">toUpperCase</span>());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// TS 知道这里是 ApiError</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Error <span class="hljs-subst">${result.code}</span>: <span class="hljs-subst">${result.details}</span>`</span>);
    }
}

<span class="hljs-comment">// 3. 断言签名 (Assertion Signatures) - TS 3.7+</span>
<span class="hljs-comment">// 类似于 Node.js 的 assert 模块</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">assertIsNumber</span>(<span class="hljs-params">val: <span class="hljs-built_in">any</span></span>): asserts val is <span class="hljs-built_in">number</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> val !== <span class="hljs-string">"number"</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Not a number!"</span>);
    }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">double</span>(<span class="hljs-params">input: <span class="hljs-built_in">any</span></span>) {
    <span class="hljs-title function_">assertIsNumber</span>(input);
    <span class="hljs-comment">// 此行之后，input 被视为 number</span>
    <span class="hljs-keyword">return</span> input * <span class="hljs-number">2</span>;
}
</code></pre>
<hr/>
<h3 data-id="heading-9">模块八：类型体操挑战（Type Gymnastics）</h3>
<p>为了展示 TS 的极限能力，我们实现一些类似 Lodash 函数的类型版本。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块八：类型体操
 * 场景：库作者、极度复杂的类型推导
 */</span>

<span class="hljs-comment">// 1. 实现 Join 类型 (Array.join 的类型版)</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Join</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[], U <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>&gt; = 
    T <span class="hljs-keyword">extends</span> [infer F, ...infer R]
        ? R[<span class="hljs-string">'length'</span>] <span class="hljs-keyword">extends</span> <span class="hljs-number">0</span>
            ? <span class="hljs-string">`<span class="hljs-subst">${F &amp; <span class="hljs-built_in">string</span>}</span>`</span>
            : <span class="hljs-string">`<span class="hljs-subst">${F &amp; <span class="hljs-built_in">string</span>}</span><span class="hljs-subst">${U}</span><span class="hljs-subst">${Join&lt;R, U&gt;}</span>`</span>
        : <span class="hljs-string">""</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Path</span> = <span class="hljs-title class_">Join</span>&lt;[<span class="hljs-string">'users'</span>, <span class="hljs-string">'id'</span>, <span class="hljs-string">'posts'</span>], <span class="hljs-string">'/'</span>&gt;; <span class="hljs-comment">// "users/id/posts"</span>

<span class="hljs-comment">// 2. 实现 DeepValue (根据路径获取深度属性值)</span>
<span class="hljs-comment">// 类似于 lodash.get(obj, "a.b.c")</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">GetPropType</span>&lt;T, P <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span>&gt; = 
    P <span class="hljs-keyword">extends</span> keyof T 
        ? T[P] 
        : P <span class="hljs-keyword">extends</span> <span class="hljs-string">`<span class="hljs-subst">${infer K}</span>.<span class="hljs-subst">${infer R}</span>`</span>
            ? K <span class="hljs-keyword">extends</span> keyof T 
                ? <span class="hljs-title class_">GetPropType</span>&lt;T[K], R&gt;
                : <span class="hljs-built_in">never</span>
            : <span class="hljs-built_in">never</span>;

<span class="hljs-comment">// 测试 DeepValue</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> {
    <span class="hljs-attr">app</span>: {
        <span class="hljs-attr">database</span>: {
            <span class="hljs-attr">host</span>: <span class="hljs-built_in">string</span>;
            <span class="hljs-attr">port</span>: <span class="hljs-built_in">number</span>;
        }
    }
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">DBHost</span> = <span class="hljs-title class_">GetPropType</span>&lt;<span class="hljs-title class_">Config</span>, <span class="hljs-string">"app.database.host"</span>&gt;; <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DBPort</span> = <span class="hljs-title class_">GetPropType</span>&lt;<span class="hljs-title class_">Config</span>, <span class="hljs-string">"app.database.port"</span>&gt;; <span class="hljs-comment">// number</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Invalid</span> = <span class="hljs-title class_">GetPropType</span>&lt;<span class="hljs-title class_">Config</span>, <span class="hljs-string">"app.database.password"</span>&gt;; <span class="hljs-comment">// never</span>

<span class="hljs-comment">// 3. 元组转对象</span>
<span class="hljs-keyword">const</span> tuple = [<span class="hljs-string">'tesla'</span>, <span class="hljs-string">'model 3'</span>, <span class="hljs-string">'model X'</span>, <span class="hljs-string">'model Y'</span>] <span class="hljs-keyword">as</span> <span class="hljs-keyword">const</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">TupleToObject</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">any</span>[]&gt; = {
    [P <span class="hljs-keyword">in</span> T[<span class="hljs-built_in">number</span>]]: P;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">CarModelObj</span> = <span class="hljs-title class_">TupleToObject</span>&lt;<span class="hljs-keyword">typeof</span> tuple&gt;;
<span class="hljs-comment">// { tesla: "tesla", "model 3": "model 3", ... }</span>

<span class="hljs-comment">// 4. 柯里化函数的类型推导 (Currying)</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Curry</span>&lt;P <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[], R&gt; = 
    <span class="hljs-function">(<span class="hljs-params">arg: Head&lt;P&gt;</span>) =&gt;</span> <span class="hljs-title class_">HasTail</span>&lt;P&gt; <span class="hljs-keyword">extends</span> <span class="hljs-literal">true</span> ? <span class="hljs-title class_">Curry</span>&lt;<span class="hljs-title class_">Tail</span>&lt;P&gt;, R&gt; : R;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Head</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[]&gt; = T <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">any</span>, ...<span class="hljs-built_in">any</span>[]] ? T[<span class="hljs-number">0</span>] : <span class="hljs-built_in">never</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Tail</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[]&gt; = (<span class="hljs-function">(<span class="hljs-params">...t: T</span>) =&gt;</span> <span class="hljs-built_in">any</span>) <span class="hljs-keyword">extends</span> (<span class="hljs-function">(<span class="hljs-params">_: <span class="hljs-built_in">any</span>, ...tail: infer TT</span>) =&gt;</span> <span class="hljs-built_in">any</span>) ? <span class="hljs-variable constant_">TT</span> : [];
<span class="hljs-keyword">type</span> <span class="hljs-title class_">HasTail</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[]&gt; = T <span class="hljs-keyword">extends</span> ([] | [<span class="hljs-built_in">any</span>]) ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>;

<span class="hljs-comment">// 这是一个简化的定义，实际柯里化类型非常复杂</span>
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> curry&lt;P <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span>[], R&gt;(<span class="hljs-attr">f</span>: <span class="hljs-function">(<span class="hljs-params">...args: P</span>) =&gt;</span> R): <span class="hljs-title class_">Curry</span>&lt;P, R&gt;;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">add</span> = (<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span>, c: <span class="hljs-built_in">number</span></span>) =&gt; a + b + c;
<span class="hljs-keyword">const</span> curriedAdd = <span class="hljs-title function_">curry</span>(add);

<span class="hljs-comment">// const sum = curriedAdd(1)(2)(3); // 理想情况下推导出 number</span>
</code></pre>
<hr/>
<h3 data-id="heading-10">模块九：声明合并与模块扩展 (Module Augmentation)</h3>
<p>在扩展第三方库（如给 Window 对象添加属性，或扩展 React 的 Theme）时必不可少。</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * 模块九：模块扩展
 * 场景：全局变量、第三方库补丁
 */</span>

<span class="hljs-comment">// 1. 扩展全局 Window 对象</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> {
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Window</span> {
        <span class="hljs-attr">__REDUX_DEVTOOLS_EXTENSION__</span>: <span class="hljs-built_in">any</span>;
        <span class="hljs-title class_">Analytics</span>: {
            <span class="hljs-attr">track</span>: <span class="hljs-function">(<span class="hljs-params">event: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
        };
    }
    
    <span class="hljs-comment">// 扩展 String 原型</span>
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">String</span> {
        <span class="hljs-title function_">toTitleCase</span>(): <span class="hljs-built_in">string</span>;
    }
}

<span class="hljs-comment">// 实现扩展的方法</span>
<span class="hljs-title class_">String</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toTitleCase</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\w\S*/g</span>, <span class="hljs-function">(<span class="hljs-params">txt</span>) =&gt;</span> txt.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">toUpperCase</span>() + txt.<span class="hljs-title function_">substr</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">toLowerCase</span>());
};

<span class="hljs-comment">// 使用</span>
<span class="hljs-comment">// window.Analytics.track("Page View");</span>
<span class="hljs-comment">// const title = "hello world".toTitleCase();</span>

<span class="hljs-comment">// 2. 扩展第三方库 (以 styled-components 为例)</span>
<span class="hljs-comment">// 假设这是一个名为 'my-theme-lib' 的库</span>
<span class="hljs-comment">// import 'my-theme-lib';</span>

<span class="hljs-comment">// declare module 'my-theme-lib' {</span>
<span class="hljs-comment">//     export interface DefaultTheme {</span>
<span class="hljs-comment">//         borderRadius: string;</span>
<span class="hljs-comment">//         colors: {</span>
<span class="hljs-comment">//             main: string;</span>
<span class="hljs-comment">//             secondary: string;</span>
<span class="hljs-comment">//         };</span>
<span class="hljs-comment">//     }</span>
<span class="hljs-comment">// }</span>
</code></pre>
<h3 data-id="heading-11">总结与最佳实践</h3>
<p>建议：</p>
<ol>
<li><strong>不要过度设计</strong>：虽然泛型和条件类型很强大，但如果一个类型定义超过了 10 行且难以阅读，考虑简化它或添加详细注释。</li>
<li><strong>利用 <code>unknown</code> 代替 <code>any</code></strong>：在不确定类型时，<code>unknown</code> 强制你在使用前进行类型检查，比 <code>any</code> 安全得多。</li>
<li><strong>优先使用接口 (Interface) 定义对象</strong>：接口支持声明合并，对库的扩展性更好；类型别名 (Type Alias) 更适合联合类型和元组。</li>
<li><strong>严格模式</strong>：始终开启 <code>strict: true</code>，特别是 <code>strictNullChecks</code>，这能避免 80% 的运行时错误。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue页面渲染流程]]></title>    <link>https://juejin.cn/post/7574622940688564243</link>    <guid>https://juejin.cn/post/7574622940688564243</guid>    <pubDate>2025-11-20T08:53:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574622940688564243" data-draft-id="7573993452578783275" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue页面渲染流程"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-11-20T08:53:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WebGirl"/> <meta itemprop="url" content="https://juejin.cn/user/3227821868584478"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue页面渲染流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821868584478/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WebGirl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:53:31.000Z" title="Thu Nov 20 2025 08:53:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Vue 核心中除了响应式原理外，视图渲染也是重中之重。我们都知道每次更新数据，都会走视图渲染的逻辑，而这当中牵扯的逻辑也是十分繁琐。</p>
<p>本文主要解析的是初始化视图渲染流程，你将会了解到从挂载组件开始，Vue 是如何构建 VNode，又是如何将 VNode 转为真实节点并挂载到页面。</p>
<p>Vue2 的页面渲染流程可分为<strong>初始化渲染</strong>和<strong>更新渲染</strong>两大阶段，核心围绕「VNode 构建」和「真实 DOM 生成」展开。以下是详细流程解析：</p>
<h2 data-id="heading-0">一、初始化渲染流程（首次渲染）</h2>
<h3 data-id="heading-1">实例化与初始化（new Vue()）</h3>
<ul>
<li>通过 <code>new Vue(options)</code> 创建组件实例，触发 <code>_init</code> 方法（<code>src/core/instance/init.js</code>）。</li>
<li><code>_init</code> 方法初始化组件选项（合并配置、初始化生命周期、事件、状态等），并判断是否存在 <code>el</code> 选项，若存在则调用 <code>$mount</code> 开始挂载。</li>
</ul>
<p><strong>Vue 是一个构造函数，通过 <code>new</code> 关键字进行实例化。</strong></p>
<p>代码块 1（src/core/instance/index.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/instance/index.js</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Vue</span> (options) {
  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">'production'</span> &amp;&amp;
    !(<span class="hljs-variable language_">this</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Vue</span>)
  ) {
    <span class="hljs-title function_">warn</span>(<span class="hljs-string">'Vue is a constructor and should be called with the `new` keyword'</span>)
  }
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_init</span>(options)
}
</code></pre>
<p><strong>在实例化时，会调用 <code>_init</code> 进行初始化。</strong></p>
<p>代码块 2（src/core/instance/init.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/instance/init.js</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">_init</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">options?: <span class="hljs-built_in">Object</span></span>) {
  <span class="hljs-comment">// ... component = this</span>
  <span class="hljs-keyword">if</span> (vm.<span class="hljs-property">$options</span>.<span class="hljs-property">el</span>) {
    vm.$mount(vm.<span class="hljs-property">$options</span>.<span class="hljs-property">el</span>)
  }
}
</code></pre>
<h3 data-id="heading-2">挂载组件（$mount）</h3>
<ul>
<li><code>$mount</code> 方法最终调用 <code>mountComponent</code>（<code>src/core/instance/lifecycle.js</code>），负责将组件挂载到 DOM。</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/instance/lifecycle.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mountComponent</span> (
  <span class="hljs-attr">vm</span>: <span class="hljs-title class_">Component</span>,
  <span class="hljs-attr">el</span>: <span class="hljs-title class_">Element</span>,
  hydrating?: boolean
): <span class="hljs-title class_">Component</span> {
  vm.<span class="hljs-property">$el</span> = el
  <span class="hljs-title function_">callHook</span>(vm, <span class="hljs-string">'beforeMount'</span>)

  <span class="hljs-keyword">let</span> updateComponent
  <span class="hljs-comment">/* istanbul ignore if */</span>
  <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">'production'</span> &amp;&amp; config.<span class="hljs-property">performance</span> &amp;&amp; mark) {
    <span class="hljs-comment">// ...</span>
  } <span class="hljs-keyword">else</span> {
    updateComponent = <span class="hljs-function">() =&gt;</span> {
      vm.<span class="hljs-title function_">_update</span>(vm.<span class="hljs-title function_">_render</span>(), hydrating) <span class="hljs-comment">// 渲染页面函数</span>
    }
  }

  <span class="hljs-comment">// we set this to vm._watcher inside the watcher's constructor</span>
  <span class="hljs-comment">// since the watcher's initial patch may call $forceUpdate (e.g. inside child</span>
  <span class="hljs-comment">// component's mounted hook), which relies on vm._watcher being already defined</span>
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">Watcher</span>(vm, updateComponent, noop, { <span class="hljs-comment">// 渲染watcher</span>
    before () {
      <span class="hljs-keyword">if</span> (vm.<span class="hljs-property">_isMounted</span> &amp;&amp; !vm.<span class="hljs-property">_isDestroyed</span>) {
        <span class="hljs-title function_">callHook</span>(vm, <span class="hljs-string">'beforeUpdate'</span>)
      }
    }
  }, <span class="hljs-literal">true</span> <span class="hljs-comment">/* isRenderWatcher */</span>)
  hydrating = <span class="hljs-literal">false</span>

  <span class="hljs-comment">// manually mounted instance, call mounted on self</span>
  <span class="hljs-comment">// mounted is called for render-created child components in its inserted hook</span>
  <span class="hljs-keyword">if</span> (vm.<span class="hljs-property">$vnode</span> == <span class="hljs-literal">null</span>) {
    vm.<span class="hljs-property">_isMounted</span> = <span class="hljs-literal">true</span>
    <span class="hljs-title function_">callHook</span>(vm, <span class="hljs-string">'mounted'</span>)
  }
  <span class="hljs-keyword">return</span> vm
}
</code></pre>
<p><code>mountComponent</code> 除了调用一些生命周期的钩子函数外，最主要是 <code>updateComponent</code>，它就是负责渲染视图的核心方法，其只有一行核心代码：</p>
<pre><code class="hljs language-js" lang="js">vm.<span class="hljs-title function_">_update</span>(vm.<span class="hljs-title function_">_render</span>(), hydrating)
</code></pre>
<ul>
<li><code>vm._render</code> 创建并返回 VNode，<code>vm._update</code> 接收 VNode 将其转为真实节点。</li>
<li>其中 <code>vm._render()</code> 生成 VNode，<code>vm._update()</code> 将 VNode 转为真实 DOM。</li>
<li>创建「渲染 Watcher」，监听数据变化，首次执行 <code>updateComponent</code> 触发初始化渲染。
<ul>
<li><code>updateComponent</code> 会被传入<strong>渲染 Watcher</strong>，每当数据变化触发 Watcher 更新就会执行该函数，重新渲染视图。</li>
<li><code>updateComponent</code> 传入<strong>渲染 Watcher</strong> 后会被执行一次进行初始化页面渲染。</li>
</ul>
</li>
</ul>
<p>所以我们着重分析的是 <code>vm._render</code> 和 <code>vm._update</code> 两个方法，这也是本文主要了解的原理 ——Vue 视图渲染流程。</p>
<h3 data-id="heading-3">构建VNode(_render)</h3>
<p><strong>首先是 <code>_render</code> 方法，它用来构建组件的 VNode。</strong></p>
<ul>
<li><code>vm._render()</code> 调用组件的 <code>render</code> 函数（模板编译生成或用户自定义），返回根 VNode（虚拟节点）。</li>
<li><code>render</code> 函数通过 <code>vm.$createElement</code>（或编译生成的 <code>vm._c</code>）创建 VNode，内部调用 <code>createElement</code> 方法。</li>
</ul>
<p>代码块 1（src/core/instance/render.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/instance/render.js</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">_render</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { render, _parentVnode } = vm.<span class="hljs-property">$options</span>
  vnode = render.<span class="hljs-title function_">call</span>(vm.<span class="hljs-property">_renderProxy</span>, vm.<span class="hljs-property">$createElement</span>)
  <span class="hljs-keyword">return</span> vnode
}
</code></pre>
<p><code>_render</code> 内部会执行 <code>render</code> 方法并返回构建好的 VNode，<code>render</code> 一般是模板编译后生成的方法，也有可能是用户自定义。</p>
<p>代码块 2（src/core/instance/render.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/instance/render.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initRender</span> (vm) {
  vm.<span class="hljs-property">_c</span> = <span class="hljs-function">(<span class="hljs-params">a, b, c, d</span>) =&gt;</span> <span class="hljs-title function_">createElement</span>(vm, a, b, c, d, <span class="hljs-literal">false</span>)
  vm.<span class="hljs-property">$createElement</span> = <span class="hljs-function">(<span class="hljs-params">a, b, c, d</span>) =&gt;</span> <span class="hljs-title function_">createElement</span>(vm, a, b, c, d, <span class="hljs-literal">true</span>)
}
</code></pre>
<ul>
<li><code>initRender</code> 在初始化就会执行为实例上绑定两个方法，分别是 <code>vm._c</code> 和 <code>vm.$createElement</code>。它们两者都是调用 <code>createElement</code> 方法，它是创建 VNode 的核心方法，最后一个参数用于区别是否为用户自定义。</li>
<li><code>vm._c</code> 应用场景是在编译生成的 <code>render</code> 函数中调用，<code>vm.$createElement</code> 则用于用户自定义 <code>render</code> 函数的场景。就像上面 <code>render</code> 在调用时会传入参数 <code>vm.$createElement</code>，我们在自定义 <code>render</code> 函数接收到的参数就是它。</li>
</ul>
<h4 data-id="heading-4">createElement</h4>
<ul>
<li><code>createElement</code> 封装 <code>_createElement</code>，处理参数并规范化子节点（<code>children</code>）：
<ul>
<li>若为编译生成的 <code>render</code>，调用 <code>simpleNormalizeChildren</code> 扁平化子节点数组。</li>
<li>若为用户自定义 <code>render</code>，调用 <code>normalizeChildren</code> 将子节点转为 VNode 数组。</li>
</ul>
</li>
<li>根据 <code>tag</code> 类型创建对应 VNode：
<ul>
<li>内置标签（如 <code>div</code>）：直接创建普通 VNode。</li>
<li>组件：调用 <code>createComponent</code> 创建组件类型 VNode。</li>
</ul>
</li>
</ul>
<p>代码块 3（src/core/vdom/create-element.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/vdom/create-element.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createElement</span> (
  <span class="hljs-attr">context</span>: <span class="hljs-title class_">Component</span>,
  <span class="hljs-attr">tag</span>: any,
  <span class="hljs-attr">data</span>: any,
  <span class="hljs-attr">children</span>: any,
  <span class="hljs-attr">normalizationType</span>: any,
  <span class="hljs-attr">alwaysNormalize</span>: boolean
): <span class="hljs-title class_">VNode</span> | <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">VNode</span>&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(data) || <span class="hljs-title function_">isPrimitive</span>(data)) {
    normalizationType = children
    children = data
    data = <span class="hljs-literal">undefined</span>
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isTrue</span>(alwaysNormalize)) {
    normalizationType = <span class="hljs-variable constant_">ALWAYS_NORMALIZE</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">_createElement</span>(context, tag, data, children, normalizationType)
}
</code></pre>
<p><code>createElement</code> 方法实际上是对 <code>_createElement</code> 方法的封装，它允许传入的参数更加灵活。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">_createElement</span> (
  <span class="hljs-attr">context</span>: <span class="hljs-title class_">Component</span>,
  <span class="hljs-attr">tag</span>: string | <span class="hljs-title class_">Class</span>&lt;<span class="hljs-title class_">Component</span>&gt; | <span class="hljs-title class_">Function</span> | <span class="hljs-title class_">Object</span>,
  <span class="hljs-attr">data</span>: <span class="hljs-title class_">VNodeData</span>,
  <span class="hljs-attr">children</span>: any,
  <span class="hljs-attr">normalizationType</span>: number
): <span class="hljs-title class_">VNode</span> | <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">VNode</span>&gt; {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(data) &amp;&amp; <span class="hljs-title function_">isDef</span>((<span class="hljs-attr">data</span>: any).<span class="hljs-property">is</span>)) {
    tag = data.<span class="hljs-property">is</span>
  }
  <span class="hljs-keyword">if</span> (!tag) {
    <span class="hljs-comment">// in case of component :is set to falsy value</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">createEmptyVNode</span>()
  }
  <span class="hljs-comment">// support single function children as default scoped slot</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(children) &amp;&amp;
    <span class="hljs-keyword">typeof</span> children[<span class="hljs-number">0</span>] === <span class="hljs-string">'function'</span>
  ) {
    data = data || {}
    data.<span class="hljs-property">scopedSlots</span> = { <span class="hljs-attr">default</span>: children[<span class="hljs-number">0</span>] }
    data.<span class="hljs-property">children</span> = []
  }
  <span class="hljs-keyword">if</span> (normalizationType === <span class="hljs-variable constant_">ALWAYS_NORMALIZE</span>) {
    children = <span class="hljs-title function_">normalizeChildren</span>(children)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (normalizationType === <span class="hljs-variable constant_">SIMPLE_NORMALIZE</span>) {
    children = <span class="hljs-title function_">simpleNormalizeChildren</span>(children)
  }
  <span class="hljs-keyword">let</span> vnode, ns
  <span class="hljs-comment">// 根据tag类型创建VNode</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> tag === <span class="hljs-string">'string'</span>) {
    <span class="hljs-keyword">let</span> <span class="hljs-title class_">Ctor</span>
    ns = (context.<span class="hljs-property">$vnode</span> &amp;&amp; context.<span class="hljs-property">$vnode</span>.<span class="hljs-property">ns</span>) || config.<span class="hljs-title function_">getTagNamespace</span>(tag)
    <span class="hljs-keyword">if</span> (config.<span class="hljs-title function_">isReservedTag</span>(tag)) {
      <span class="hljs-comment">// platform built-in elements</span>
      vnode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(
        config.<span class="hljs-title function_">parsePlatformTagName</span>(tag), data, children,
        <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, context
      )
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(<span class="hljs-title class_">Ctor</span> = <span class="hljs-title function_">resolveAsset</span>(context.<span class="hljs-property">$options</span>, <span class="hljs-string">'components'</span>, tag))) {
      <span class="hljs-comment">// component</span>
      vnode = <span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Ctor</span>, data, context, children, tag)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// unknown or unlisted namespaced elements</span>
      <span class="hljs-comment">// check at runtime because it may get assigned a namespace when its</span>
      <span class="hljs-comment">// parent normalizes children</span>
      vnode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(
        tag, data, children,
        <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, context
      )
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// direct component options / constructor</span>
    vnode = <span class="hljs-title function_">createComponent</span>(tag, data, context, children)
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(vnode)) {
    <span class="hljs-keyword">return</span> vnode
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(vnode)) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(ns)) <span class="hljs-title function_">applyNS</span>(vnode, ns)
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(data)) <span class="hljs-title function_">registerDeepBindings</span>(data)
    <span class="hljs-keyword">return</span> vnode
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">createEmptyVNode</span>()
  }
}
</code></pre>
<p><code>_createElement</code> 参数中会接收 <code>children</code>，它表示当前 VNode 的子节点，因为它是任意类型的，所以接下来需要将其规范为标准的 VNode 数组；</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 这里规范化 children</span>
<span class="hljs-keyword">if</span> (normalizationType === <span class="hljs-variable constant_">ALWAYS_NORMALIZE</span>) {
  children = <span class="hljs-title function_">normalizeChildren</span>(children)
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (normalizationType === <span class="hljs-variable constant_">SIMPLE_NORMALIZE</span>) {
  children = <span class="hljs-title function_">simpleNormalizeChildren</span>(children)
}
</code></pre>
<p><code>simpleNormalizeChildren</code> 和 <code>normalizeChildren</code> 均用于规范化 <code>children</code>。由 <code>normalizationType</code> 判断 <code>render</code> 函数是编译生成的还是用户自定义的。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. when the children contains components - because a functional component</span>
<span class="hljs-comment">// may return an Array instead of a single root. In this case, just a simple</span>
<span class="hljs-comment">// normalization is needed. If the child is an Array, we flatten the whole</span>
<span class="hljs-comment">// thing with Array.prototype.concat. It is guaranteed to be only 1-level deep</span>
<span class="hljs-comment">// because functional components already normalize their own children.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">simpleNormalizeChildren</span> (<span class="hljs-attr">children</span>: any) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; children.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(children[i])) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">concat</span>.<span class="hljs-title function_">apply</span>([], children)
    }
  }
  <span class="hljs-keyword">return</span> children
}

<span class="hljs-comment">// 2. when the children contains constructs that always generated nested Arrays,</span>
<span class="hljs-comment">// e.g. &lt;template&gt;, &lt;slot&gt;, v-for, or when the children is provided by user</span>
<span class="hljs-comment">// with hand-written render functions / JSX. In such cases a full normalization</span>
<span class="hljs-comment">// is needed to cater to all possible types of children values.</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">normalizeChildren</span> (<span class="hljs-attr">children</span>: any): <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">VNode</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">isPrimitive</span>(children)
    ? [<span class="hljs-title function_">createTextVNode</span>(children)]
    : <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(children)
      ? <span class="hljs-title function_">normalizeArrayChildren</span>(children)
      : <span class="hljs-literal">undefined</span>
}
</code></pre>
<p><code>simpleNormalizeChildren</code> 方法调用场景是 <code>render</code> 函数当函数是编译生成的。<code>normalizeChildren</code> 方法的调用场景主要是 <code>render</code> 函数是用户手写的。</p>
<p>经过对 <code>children</code> 的规范化，<code>children</code> 变成了一个类型为 VNode 的数组。之后就是创建 VNode 的逻辑。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/vdom/patch.js</span>
<span class="hljs-keyword">let</span> vnode, ns
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> tag === <span class="hljs-string">'string'</span>) {
  <span class="hljs-keyword">let</span> <span class="hljs-title class_">Ctor</span>
  ns = (context.<span class="hljs-property">$vnode</span> &amp;&amp; context.<span class="hljs-property">$vnode</span>.<span class="hljs-property">ns</span>) || config.<span class="hljs-title function_">getTagNamespace</span>(tag)
  <span class="hljs-keyword">if</span> (config.<span class="hljs-title function_">isReservedTag</span>(tag)) {
    <span class="hljs-comment">// platform built-in elements</span>
    vnode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(
      config.<span class="hljs-title function_">parsePlatformTagName</span>(tag), data, children,
      <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, context
    )
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(<span class="hljs-title class_">Ctor</span> = <span class="hljs-title function_">resolveAsset</span>(context.<span class="hljs-property">$options</span>, <span class="hljs-string">'components'</span>, tag))) {
    <span class="hljs-comment">// component</span>
    vnode = <span class="hljs-title function_">createComponent</span>(<span class="hljs-title class_">Ctor</span>, data, context, children, tag)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// unknown or unlisted namespaced elements</span>
    <span class="hljs-comment">// check at runtime because it may get assigned a namespace when its</span>
    <span class="hljs-comment">// parent normalizes children</span>
    vnode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(
      tag, data, children,
      <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, context
    )
  }
} <span class="hljs-keyword">else</span> {
  <span class="hljs-comment">// direct component options / constructor</span>
  vnode = <span class="hljs-title function_">createComponent</span>(tag, data, context, children)
}
</code></pre>
<p>如果 <code>tag</code> 是 <code>string</code> 类型，则接着判断：如果是内置的一些节点，创建一个普通 VNode；如果是已注册的组件名，则通过 <code>createComponent</code> 创建一个组件类型的 VNode；否则创建一个未知的标签的 VNode。</p>
<p>如果 <code>tag</code> 不是 <code>string</code> 类型，那就是 <code>Component</code> 类型，则直接调用 <code>createComponent</code> 创建一个组件类型的 VNode 节点。</p>
<p>最后 <code>_createElement</code> 会返回一个 VNode，也就是调用 <code>vm._render</code> 时创建得到的 VNode。之后 VNode 会传递给 <code>vm._update</code> 函数，用于生成真实 DOM。</p>
<h3 data-id="heading-5">生成真实dom(_update 与 patch)</h3>
<ul>
<li><code>vm._update(vnode)</code> 调用 <code>vm.__patch__</code> 方法（平台相关实现，Web 端对应 <code>patch</code> 函数）。</li>
<li><code>patch</code> 函数核心逻辑：
<ol>
<li>首次渲染时，<code>oldVnode</code> 为真实 DOM（如 <code>#app</code>），先通过 <code>emptyNodeAt</code> 转为空 VNode。</li>
<li>调用 <code>createElm</code> 将 VNode 递归转为真实 DOM 并插入父节点。</li>
<li>移除旧节点，触发 <code>insert</code> 钩子，完成渲染。</li>
</ol>
</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 核心代码简化</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">_update</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">vnode</span>) {
  <span class="hljs-keyword">const</span> vm = <span class="hljs-variable language_">this</span>;
  <span class="hljs-keyword">const</span> prevVnode = vm.<span class="hljs-property">_vnode</span>;
  vm.<span class="hljs-property">_vnode</span> = vnode;
  <span class="hljs-keyword">if</span> (!prevVnode) {
    <span class="hljs-comment">// 首次渲染：将 VNode 转为真实 DOM 并挂载</span>
    vm.<span class="hljs-property">$el</span> = vm.<span class="hljs-title function_">__patch__</span>(vm.<span class="hljs-property">$el</span>, vnode);
  }
};

<span class="hljs-comment">// patch 核心逻辑</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params">oldVnode, vnode</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isRealElement</span>(oldVnode)) {
    oldVnode = <span class="hljs-title function_">emptyNodeAt</span>(oldVnode); <span class="hljs-comment">// 真实 DOM 转空 VNode</span>
  }
  <span class="hljs-title function_">createElm</span>(vnode, parentElm); <span class="hljs-comment">// 创建真实 DOM 并插入</span>
  <span class="hljs-title function_">removeVnodes</span>([oldVnode]); <span class="hljs-comment">// 移除旧节点</span>
}
</code></pre>
<p>代码块 1（src/core/instance/lifecycle.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/instance/lifecycle.js</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">_update</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">vnode: VNode, hydrating?: boolean</span>) {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">vm</span>: <span class="hljs-title class_">Component</span> = <span class="hljs-variable language_">this</span>
  <span class="hljs-keyword">const</span> prevEl = vm.<span class="hljs-property">$el</span>
  <span class="hljs-keyword">const</span> prevVnode = vm.<span class="hljs-property">_vnode</span>
  <span class="hljs-keyword">const</span> prevActiveInstance = activeInstance
  activeInstance = vm
  vm.<span class="hljs-property">_vnode</span> = vnode
  <span class="hljs-comment">// Vue.prototype.__patch__ is injected in entry points</span>
  <span class="hljs-comment">// based on the rendering backend used.</span>
  <span class="hljs-keyword">if</span> (!prevVnode) {
    <span class="hljs-comment">// initial render</span>
    vm.<span class="hljs-property">$el</span> = vm.<span class="hljs-title function_">__patch__</span>(vm.<span class="hljs-property">$el</span>, vnode, hydrating, <span class="hljs-literal">false</span> <span class="hljs-comment">/* removeOnly */</span>)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// updates</span>
    vm.<span class="hljs-property">$el</span> = vm.<span class="hljs-title function_">__patch__</span>(prevVnode, vnode)
  }
  activeInstance = prevActiveInstance
  <span class="hljs-comment">// update __vue__ reference</span>
  <span class="hljs-keyword">if</span> (prevEl) {
    prevEl.<span class="hljs-property">__vue__</span> = <span class="hljs-literal">null</span>
  }
  <span class="hljs-keyword">if</span> (vm.<span class="hljs-property">$el</span>) {
    vm.<span class="hljs-property">$el</span>.<span class="hljs-property">__vue__</span> = vm
  }
  <span class="hljs-comment">// if parent is an HOC, update its $el as well</span>
  <span class="hljs-keyword">if</span> (vm.<span class="hljs-property">$vnode</span> &amp;&amp; vm.<span class="hljs-property">$parent</span> &amp;&amp; vm.<span class="hljs-property">$vnode</span> === vm.<span class="hljs-property">$parent</span>.<span class="hljs-property">_vnode</span>) {
    vm.<span class="hljs-property">$parent</span>.<span class="hljs-property">$el</span> = vm.<span class="hljs-property">$el</span>
  }
  <span class="hljs-comment">// updated hook is called by the scheduler to ensure that children are</span>
  <span class="hljs-comment">// updated in a parent's updated hook.</span>
}
</code></pre>
<p><code>_update</code> 里最核心的方法就是 <code>vm.__patch__</code> 方法，不同平台的 <code>patch</code> 方法的定义稍有不同，在 web 平台中它是这样定义的：</p>
<p>代码块 2（src/platforms/web/runtime/index.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/platforms/web/runtime/index.js</span>
<span class="hljs-keyword">import</span> { patch } <span class="hljs-keyword">from</span> <span class="hljs-string">'./patch'</span>
<span class="hljs-comment">// install platform patch function</span>
<span class="hljs-title class_">Vue</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__patch__</span> = inBrowser ? patch : noop
</code></pre>
<p>可以看到 <code>__patch__</code> 实际调用的是 <code>patch</code> 方法。</p>
<p>代码块 3（src/platforms/web/runtime/patch.js）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/platforms/web/runtime/patch.js</span>
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> nodeOps <span class="hljs-keyword">from</span> <span class="hljs-string">'web/runtime/node-ops'</span>
<span class="hljs-keyword">import</span> { createPatchFunction } <span class="hljs-keyword">from</span> <span class="hljs-string">'core/vdom/patch'</span>
<span class="hljs-keyword">import</span> baseModules <span class="hljs-keyword">from</span> <span class="hljs-string">'core/vdom/modules/index'</span>
<span class="hljs-keyword">import</span> platformModules <span class="hljs-keyword">from</span> <span class="hljs-string">'web/runtime/modules/index'</span>

<span class="hljs-comment">// the directive module should be applied last, after all</span>
<span class="hljs-comment">// built-in modules have been applied.</span>
<span class="hljs-keyword">const</span> modules = platformModules.<span class="hljs-title function_">concat</span>(baseModules)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">patch</span>: <span class="hljs-title class_">Function</span> = <span class="hljs-title function_">createPatchFunction</span>({ nodeOps, modules })
</code></pre>
<p>而patch方法是由createPatchFunction方法创建返回出来的函数。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// src/core/vdom/patch.js</span>
<span class="hljs-keyword">const</span> hooks = [<span class="hljs-string">'create'</span>, <span class="hljs-string">'activate'</span>, <span class="hljs-string">'update'</span>, <span class="hljs-string">'remove'</span>, <span class="hljs-string">'destroy'</span>]

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createPatchFunction</span> (backend) {
  <span class="hljs-keyword">let</span> i, j
  <span class="hljs-keyword">const</span> cbs = {}
  <span class="hljs-keyword">const</span> { modules, nodeOps } = backend

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; hooks.<span class="hljs-property">length</span>; i++) {
    cbs[hooks[i]] = []
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; modules.<span class="hljs-property">length</span>; j++) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(modules[j][hooks[i]])) {
        cbs[hooks[i]].<span class="hljs-title function_">push</span>(modules[j][hooks[i]])
      }
    }
  }

  <span class="hljs-comment">// ...</span>

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">patch</span> (oldVnode, vnode, hydrating, removeOnly) {
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<p>这里有两个比较重要的对象 <code>nodeOps</code> 和 <code>modules</code>：</p>
<ul>
<li><code>nodeOps</code> 是封装的原生 dom 操作方法，在生成真实节点树的过程中，dom 相关操作都是调用 <code>nodeOps</code> 内的方法。</li>
<li><code>modules</code> 是待执行的钩子函数，在进入函数时，会将不同模块的钩子函数分类放置到 <code>cbs</code> 中，其中包括自定义指令钩子函数、ref 钩子函数。在 <code>patch</code> 阶段，会根据操作节点的行为取出对应类型进行调用。</li>
</ul>
<h4 data-id="heading-6">Patch</h4>
<pre><code class="hljs language-js" lang="js"> <span class="hljs-comment">// initial render</span>
<span class="hljs-number">2</span> vm.<span class="hljs-property">$el</span> = vm.<span class="hljs-title function_">__patch__</span>(vm.<span class="hljs-property">$el</span>, vnode, hydrating, <span class="hljs-literal">false</span> <span class="hljs-comment">/* removeOnly */</span>)
</code></pre>
<p>在首次渲染时，<code>vm.$el</code> 对应的是根节点 dom 对象，也就是我们熟知的 id 为 app 的 div。它作为 <code>oldVnode</code> 参数传入 <code>patch</code>。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">patch</span>(<span class="hljs-params">oldVnode, vnode, hydrating, removeOnly</span>) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isUndef</span>(vnode)) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(oldVnode)) <span class="hljs-title function_">invokeDestroyHook</span>(oldVnode)
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">let</span> isInitialPatch = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">const</span> insertedVnodeQueue = []

  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isUndef</span>(oldVnode)) {
    <span class="hljs-comment">// empty mount (likely as component), create new root element</span>
    isInitialPatch = <span class="hljs-literal">true</span>
    <span class="hljs-title function_">createElm</span>(vnode, insertedVnodeQueue)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">const</span> isRealElement = <span class="hljs-title function_">isDef</span>(oldVnode.<span class="hljs-property">nodeType</span>)
    <span class="hljs-keyword">if</span> (!isRealElement &amp;&amp; <span class="hljs-title function_">sameVnode</span>(oldVnode, vnode)) {
      <span class="hljs-comment">// patch existing root node</span>
      <span class="hljs-title function_">patchVnode</span>(oldVnode, vnode, insertedVnodeQueue, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, removeOnly)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">if</span> (isRealElement) {
        <span class="hljs-comment">// mounting to a real element</span>
        <span class="hljs-comment">// check if this is server-rendered content and if we can perform</span>
        <span class="hljs-comment">// a successful hydration.</span>
        <span class="hljs-keyword">if</span> (oldVnode.<span class="hljs-property">nodeType</span> === <span class="hljs-number">1</span> &amp;&amp; oldVnode.<span class="hljs-title function_">hasAttribute</span>(<span class="hljs-variable constant_">SSR_ATTR</span>)) {
          oldVnode.<span class="hljs-title function_">removeAttribute</span>(<span class="hljs-variable constant_">SSR_ATTR</span>)
          hydrating = <span class="hljs-literal">true</span>
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isTrue</span>(hydrating)) {
          <span class="hljs-keyword">if</span> (<span class="hljs-title function_">hydrate</span>(oldVnode, vnode, insertedVnodeQueue)) {
            <span class="hljs-title function_">invokeInsertHook</span>(vnode, insertedVnodeQueue, <span class="hljs-literal">true</span>)
            <span class="hljs-keyword">return</span> oldVnode
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">'production'</span>) {
            <span class="hljs-title function_">warn</span>(
              <span class="hljs-string">'The client-side rendered virtual DOM tree is not matching '</span> +
              <span class="hljs-string">'server-rendered content. This is likely caused by incorrect '</span> +
              <span class="hljs-string">'HTML markup, for example nesting block-level elements inside '</span> +
              <span class="hljs-string">'&lt;p&gt;, or missing &lt;tbody&gt;. Bailing hydration and performing '</span> +
              <span class="hljs-string">'full client-side render.'</span>
            )
          }
        }
        <span class="hljs-comment">// either not server-rendered, or hydration failed.</span>
        <span class="hljs-comment">// create an empty node and replace it</span>
        oldVnode = <span class="hljs-title function_">emptyNodeAt</span>(oldVnode)
      }

      <span class="hljs-comment">// replacing existing element</span>
      <span class="hljs-keyword">const</span> oldElm = oldVnode.<span class="hljs-property">elm</span>
      <span class="hljs-keyword">const</span> parentElm = nodeOps.<span class="hljs-title function_">parentNode</span>(oldElm)

      <span class="hljs-comment">// create new node</span>
      <span class="hljs-title function_">createElm</span>(
        vnode,
        insertedVnodeQueue,
        <span class="hljs-comment">// extremely rare edge case: do not insert if old element is in a</span>
        <span class="hljs-comment">// leaving transition. Only happens when combining transition +</span>
        <span class="hljs-comment">// keep-alive + HOCs. (#4590)</span>
        oldElm.<span class="hljs-property">_leaveCb</span> ? <span class="hljs-literal">null</span> : parentElm,
        nodeOps.<span class="hljs-title function_">nextSibling</span>(oldElm)
      )

      <span class="hljs-comment">// update parent placeholder node element, recursively</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(vnode.<span class="hljs-property">parent</span>)) {
        <span class="hljs-keyword">let</span> ancestor = vnode.<span class="hljs-property">parent</span>
        <span class="hljs-keyword">const</span> patchable = <span class="hljs-title function_">isPatchable</span>(vnode)
        <span class="hljs-keyword">while</span> (ancestor) {
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cbs.<span class="hljs-property">destroy</span>.<span class="hljs-property">length</span>; ++i) {
            cbs.<span class="hljs-property">destroy</span>[i](ancestor)
          }
          ancestor.<span class="hljs-property">elm</span> = vnode.<span class="hljs-property">elm</span>
          <span class="hljs-keyword">if</span> (patchable) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cbs.<span class="hljs-property">create</span>.<span class="hljs-property">length</span>; ++i) {
              cbs.<span class="hljs-property">create</span>[i](emptyNode, ancestor)
            }
            <span class="hljs-comment">// #6513</span>
            <span class="hljs-comment">// invoke insert hooks that may have been merged by create hooks.</span>
            <span class="hljs-comment">// e.g. for directives that uses the "inserted" hook.</span>
            <span class="hljs-keyword">const</span> insert = ancestor.<span class="hljs-property">data</span>.<span class="hljs-property">hook</span>.<span class="hljs-property">insert</span>
            <span class="hljs-keyword">if</span> (insert.<span class="hljs-property">merged</span>) {
              <span class="hljs-comment">// start at index 1 to avoid re-invoking component mounted hook</span>
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt; insert.<span class="hljs-property">fns</span>.<span class="hljs-property">length</span>; i++) {
                insert.<span class="hljs-property">fns</span>[i]()
              }
            }
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_">registerRef</span>(ancestor)
          }
          ancestor = ancestor.<span class="hljs-property">parent</span>
        }
      }

      <span class="hljs-comment">// destroy old node</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(parentElm)) {
        <span class="hljs-title function_">removeVnodes</span>([oldVnode], <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(oldVnode.<span class="hljs-property">tag</span>)) {
        <span class="hljs-title function_">invokeDestroyHook</span>(oldVnode)
      }
    }
  }

  <span class="hljs-title function_">invokeInsertHook</span>(vnode, insertedVnodeQueue, isInitialPatch)
  <span class="hljs-keyword">return</span> vnode.<span class="hljs-property">elm</span>
}
</code></pre>
<p>通过检查属性 <code>nodeType</code>（真实节点才有的属性），判断 <code>oldVnode</code> 是否为真实节点。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> isRealElement = <span class="hljs-title function_">isDef</span>(oldVnode.<span class="hljs-property">nodeType</span>)
<span class="hljs-keyword">if</span> (isRealElement) {
  <span class="hljs-comment">// ...</span>
  oldVnode = <span class="hljs-title function_">emptyNodeAt</span>(oldVnode)
}
</code></pre>
<p>很明显第一次的 <code>isRealElement</code> 是为 <code>true</code>，因此会调用 <code>emptyNodeAt</code> 将其转为 VNode：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">emptyNodeAt</span> (elm) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VNode</span>(nodeOps.<span class="hljs-title function_">tagName</span>(elm).<span class="hljs-title function_">toLowerCase</span>(), {}, [], <span class="hljs-literal">undefined</span>, elm)
}
</code></pre>
<p>接着会调用 <code>createElm</code> 方法，它就是将 VNode 转为真实 dom 的核心方法：</p>
<h3 data-id="heading-7">递归创建DOM节点（createElm）</h3>
<p><code>createElm</code> 是 VNode 转真实 DOM 的核心方法：</p>
<ol>
<li>若为组件 VNode，调用 <code>createComponent</code> 实例化组件并递归挂载。</li>
<li>若为普通元素，通过 <code>nodeOps.createElement</code> 创建真实节点，赋值给 <code>vnode.elm</code>。</li>
<li>递归调用 <code>createChildren</code> 处理子节点，将子节点插入当前节点（先子后父的插入顺序）。</li>
<li>调用 <code>insert</code> 方法将节点插入父容器（使用 <code>appendChild</code> 或 <code>insertBefore</code>）。</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createElm</span> (
  vnode,
  insertedVnodeQueue,
  parentElm,
  refElm,
  nested,
  ownerArray,
  index
) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(vnode.<span class="hljs-property">elm</span>) &amp;&amp; <span class="hljs-title function_">isDef</span>(ownerArray)) {
    <span class="hljs-comment">// This vnode was used in a previous render!</span>
    <span class="hljs-comment">// now it's used as a new node, overwriting its elm would cause</span>
    <span class="hljs-comment">// potential patch errors down the road when it's used as an insertion</span>
    <span class="hljs-comment">// reference node. Instead, we clone the node on-demand before creating</span>
    <span class="hljs-comment">// associated DOM element for it.</span>
    vnode = ownerArray[index] = <span class="hljs-title function_">cloneVNode</span>(vnode)
  }

  vnode.<span class="hljs-property">isRootInsert</span> = !nested <span class="hljs-comment">// for transition enter check</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">createComponent</span>(vnode, insertedVnodeQueue, parentElm, refElm)) {
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">const</span> data = vnode.<span class="hljs-property">data</span>
  <span class="hljs-keyword">const</span> children = vnode.<span class="hljs-property">children</span>
  <span class="hljs-keyword">const</span> tag = vnode.<span class="hljs-property">tag</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(tag)) {
    vnode.<span class="hljs-property">elm</span> = vnode.<span class="hljs-property">ns</span>
      ? nodeOps.<span class="hljs-title function_">createElementNS</span>(vnode.<span class="hljs-property">ns</span>, tag)
      : nodeOps.<span class="hljs-title function_">createElement</span>(tag, vnode)
    <span class="hljs-title function_">setScope</span>(vnode)

    <span class="hljs-comment">/* istanbul ignore if */</span>
    <span class="hljs-keyword">if</span> (__WEEX__) {
      <span class="hljs-comment">// ...</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">createChildren</span>(vnode, children, insertedVnodeQueue) <span class="hljs-comment">// 递归创建子节点</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(data)) {
        <span class="hljs-title function_">invokeCreateHooks</span>(vnode, insertedVnodeQueue)
      }
      <span class="hljs-title function_">insert</span>(parentElm, vnode.<span class="hljs-property">elm</span>, refElm)
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">'production'</span> &amp;&amp; data &amp;&amp; data.<span class="hljs-property">pre</span>) {
    creatingElmInPre--
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isTrue</span>(vnode.<span class="hljs-property">isComment</span>)) {
    vnode.<span class="hljs-property">elm</span> = nodeOps.<span class="hljs-title function_">createComment</span>(vnode.<span class="hljs-property">text</span>)
    <span class="hljs-title function_">insert</span>(parentElm, vnode.<span class="hljs-property">elm</span>, refElm) <span class="hljs-comment">// 插入父节点</span>
  } <span class="hljs-keyword">else</span> {
    vnode.<span class="hljs-property">elm</span> = nodeOps.<span class="hljs-title function_">createTextNode</span>(vnode.<span class="hljs-property">text</span>)
    <span class="hljs-title function_">insert</span>(parentElm, vnode.<span class="hljs-property">elm</span>, refElm)
  }
}
</code></pre>
<p>一开始会调用 <code>createComponent</code> 尝试创建组件类型的节点，如果成功会返回 <code>true</code>。在创建过程中也会调用 <code>$mount</code> 进行组件范围内的挂载，所以走的还是 <code>patch</code> 这套流程。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">if</span> (<span class="hljs-title function_">createComponent</span>(vnode, insertedVnodeQueue, parentElm, refElm)) {
  <span class="hljs-keyword">return</span>
}
</code></pre>
<p>如果没有完成创建，代表该 VNode 对应的是真实节点，往下继续创建真实节点的逻辑。</p>
<pre><code class="hljs language-js" lang="js">vnode.<span class="hljs-property">elm</span> = vnode.<span class="hljs-property">ns</span>
  ? nodeOps.<span class="hljs-title function_">createElementNS</span>(vnode.<span class="hljs-property">ns</span>, tag)
  : nodeOps.<span class="hljs-title function_">createElement</span>(tag, vnode)
</code></pre>
<p>根据 <code>tag</code> 创建对应类型真实节点，赋值给 <code>vnode.elm</code>，它作为父节点容器，创建的子节点会被放到里面。</p>
<p>然后调用 <code>createChildren</code> 创建子节点：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createChildren</span> (vnode, children, insertedVnodeQueue) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(children)) {
    <span class="hljs-keyword">if</span> (process.<span class="hljs-property">env</span>.<span class="hljs-property">NODE_ENV</span> !== <span class="hljs-string">'production'</span>) {
      <span class="hljs-title function_">checkDuplicateKeys</span>(children)
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; children.<span class="hljs-property">length</span>; ++i) {
      <span class="hljs-title function_">createElm</span>(children[i], insertedVnodeQueue, vnode.<span class="hljs-property">elm</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span>, children, i)
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isPrimitive</span>(vnode.<span class="hljs-property">text</span>)) {
    nodeOps.<span class="hljs-title function_">appendChild</span>(vnode.<span class="hljs-property">elm</span>, nodeOps.<span class="hljs-title function_">createTextNode</span>(<span class="hljs-title class_">String</span>(vnode.<span class="hljs-property">text</span>)))
  }
}
</code></pre>
<p>内部进行遍历子节点数组，再次调用 <code>createElm</code> 创建节点，而上面创建的 <code>vnode.elm</code> 作为父节点传入。如此循环，直到没有子节点，就会创建文本节点插入到 <code>vnode.elm</code> 中。</p>
<p>执行完成后出来，会调用 <code>invokeCreateHooks</code>，它负责执行 dom 操作时的 <code>create</code> 钩子函数，同时将 VNode 加入到 <code>insertedVnodeQueue</code> 中：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">invokeCreateHooks</span> (vnode, insertedVnodeQueue) {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; cbs.<span class="hljs-property">create</span>.<span class="hljs-property">length</span>; ++i) {
    cbs.<span class="hljs-property">create</span>[i](emptyNode, vnode)
  }
  i = vnode.<span class="hljs-property">data</span>.<span class="hljs-property">hook</span> <span class="hljs-comment">// Reuse variable</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(i)) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(i.<span class="hljs-property">create</span>)) i.<span class="hljs-title function_">create</span>(emptyNode, vnode)
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(i.<span class="hljs-property">insert</span>)) insertedVnodeQueue.<span class="hljs-title function_">push</span>(vnode)
  }
}
</code></pre>
<h3 data-id="heading-8">插入到父节点</h3>
<p>最后一步就是调用 <code>insert</code> 方法将节点插入到父节点：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">insert</span> (parent, elm, ref) {
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(parent)) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(ref)) {
      <span class="hljs-keyword">if</span> (nodeOps.<span class="hljs-title function_">parentNode</span>(ref) === parent) {
        nodeOps.<span class="hljs-title function_">insertBefore</span>(parent, elm, ref)
      }
    } <span class="hljs-keyword">else</span> {
      nodeOps.<span class="hljs-title function_">appendChild</span>(parent, elm)
    }
  }
}
</code></pre>
<p>可以看到 Vue 是通过递归调用 <code>createElm</code> 来创建节点树的。同时也说明最深的子节点会先调用 <code>insert</code> 插入节点。所以整个节点树的插入顺序是 “先子后父”。插入节点方法就是原生 dom 的方法 <code>insertBefore</code> 和 <code>appendChild</code>。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">if</span> (<span class="hljs-title function_">isDef</span>(parentElm)) {
  <span class="hljs-title function_">removeVnodes</span>([oldVnode], <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
}
</code></pre>
<p><code>createElm</code> 流程走完后，构建完成的节点树已经插入到页面上了。其实 Vue 在初始化渲染页面时，并不是把原来的根节点 <code>app</code> 给真正替换掉，而是在其后面插入一个新的节点，接着再把旧节点给移除掉。</p>
<p>所以在 <code>createElm</code> 之后会调用 <code>removeVnodes</code> 来移除旧节点，它里面同样是调用的原生 dom 方法 <code>removeChild</code>。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">invokeInsertHook</span>(vnode, insertedVnodeQueue, isInitialPatch)
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">invokeInsertHook</span> (vnode, queue, initial) {
  <span class="hljs-comment">// delay insert hooks for component root nodes, invoke them after the</span>
  <span class="hljs-comment">// element is really inserted</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isTrue</span>(initial) &amp;&amp; <span class="hljs-title function_">isDef</span>(vnode.<span class="hljs-property">parent</span>)) {
    vnode.<span class="hljs-property">parent</span>.<span class="hljs-property">data</span>.<span class="hljs-property">pendingInsert</span> = queue
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; queue.<span class="hljs-property">length</span>; ++i) {
      queue[i].<span class="hljs-property">data</span>.<span class="hljs-property">hook</span>.<span class="hljs-title function_">insert</span>(queue[i])
    }
  }
}
</code></pre>
<p>在 <code>patch</code> 的最后就是调用 <code>invokeInsertHook</code> 方法，触发节点插入的钩子函数。</p>
<p>至此整个页面渲染的流程完毕。</p>
<h3 data-id="heading-9">完成渲染</h3>
<ul>
<li>触发 <code>mounted</code> 生命周期钩子（所有子组件挂载完成后），页面渲染完毕。</li>
</ul>
<h2 data-id="heading-10">二、更新渲染流程（数据变化时）</h2>
<p>当响应式数据变化时，触发渲染 Watcher 的更新，重新执行 <code>updateComponent</code>，流程如下：</p>
<ol>
<li>触发 <code>beforeUpdate</code> 生命周期钩子。</li>
<li>重新调用 <code>vm._render()</code> 生成新 VNode。</li>
<li>调用 <code>vm._update()</code>，通过 <code>patch</code> 对比新旧 VNode（<code>sameVnode</code> 检查）：
<ul>
<li>若为同一节点，调用 <code>patchVnode</code> 对比并更新差异（属性、文本、子节点等）。</li>
<li>若为不同节点，直接创建新节点并替换旧节点。</li>
</ul>
</li>
<li>触发 <code>updated</code> 生命周期钩子，完成更新。</li>
</ol>
<h2 data-id="heading-11">三、总结</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f13cbd2135024957b1bd8674cc7e1691~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgV2ViR2lybA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764233610&amp;x-signature=AU%2Bg%2Fud%2BXASNruVu97%2FRJtDTyyo%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li>初始化调用<code>$mount</code>挂载组件。
-<code> _render</code>开始构建<code>VNode</code>，核心方法为<code>createElement</code>，一般会创建普通的<code>VNode</code>，遇到组件就创建组件类型的<code>VNode</code>，否则就是未知标签的<code>VNode</code>,构建完成传递给<code>_update</code>。</li>
<li><code>patch</code>阶段根据<code>VNode</code>创建真实节点树，核心方法为<code>createElm</code>,首选遇到组件类型的<code>VNode</code>,内部会执行<code>$mount</code>,再走一遍相同的流程。普通节点类型则创建一个真实的节点，如果它有子节点开始递归调用<code>createElm</code>，使用<code>insert</code>插入子节点，直到没有子节点就填充内容节点。</li>
<li>最后递归完成后，同样也是使用<code>insert</code>将整个节点树插入到页面中，再将旧的根节点移除。</li>
</ul>
<blockquote>
<ol>
<li><strong>初始化渲染</strong>：<code>new Vue()</code> → <code>_init</code> → <code>$mount</code> → <code>mountComponent</code> → <code>_render</code>（生成 VNode） → <code>_update</code>（<code>patch</code> 生成真实 DOM）。</li>
<li><strong>更新渲染</strong>：数据变化 → 渲染 Watcher 触发 → 重新生成 VNode → <code>patch</code> 对比更新 DOM。</li>
<li>核心思想：通过 VNode 抽象 DOM，减少直接操作 DOM 的开销，通过 Diff 算法高效更新差异。</li>
</ol>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Wappalyzer 原型链漏洞问题完整解决过程]]></title>    <link>https://juejin.cn/post/7574619023804776486</link>    <guid>https://juejin.cn/post/7574619023804776486</guid>    <pubDate>2025-11-20T08:50:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574619023804776486" data-draft-id="7574639741149200435" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Wappalyzer 原型链漏洞问题完整解决过程"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-20T08:50:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="范特东南西北风"/> <meta itemprop="url" content="https://juejin.cn/user/3452905249580024"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Wappalyzer 原型链漏洞问题完整解决过程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3452905249580024/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    范特东南西北风
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:50:42.000Z" title="Thu Nov 20 2025 08:50:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Wappalyzer 原型链漏洞问题完整解决过程</h2>
<h3 data-id="heading-1">背景</h3>
<p>在生产环境中，使用 <strong>Wappalyzer</strong> 检测到项目使用了 lodash 版本 <strong>4.17.10</strong>（显示为 4.17.10），但项目的 <code>package.json</code> 中明确声明了 lodash 版本为 <strong>4.17.21</strong>。为了解决这个问题，查阅资料后，借助claude code以及gpt-5 完成了此次漏洞修复。</p>
<p>可以看我其他博客，教你怎么用这些工具融入vscode进行开发。</p>
<h4 data-id="heading-2">初始状态</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.17.21"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"element-ui"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.15.14"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>问题</strong>: 为什么 Wappalyzer 检测到的是旧版本 4.17.10？</p>
<hr/>
<h3 data-id="heading-3">阶段一：配置 npm-force-resolutions 统一依赖版本</h3>
<h4 data-id="heading-4">问题分析</h4>
<p>虽然项目直接依赖了 lodash 4.17.21，但项目的<strong>嵌套依赖</strong>（dependencies 的 dependencies）可能使用了不同版本的 lodash，导致最终构建产物中包含多个 lodash 版本。</p>
<h4 data-id="heading-5">解决方案：使用 npm-force-resolutions</h4>
<p><code>npm-force-resolutions</code> 可以强制所有嵌套依赖使用指定版本，确保整个依赖树中只有一个 lodash 版本。</p>
<h4 data-id="heading-6">步骤 1: 安装 npm-force-resolutions</h4>
<pre><code class="hljs language-bash" lang="bash">npm install --save-dev npm-force-resolutions
</code></pre>
<h4 data-id="heading-7">步骤 2: 在 package.json 中添加 resolutions 字段</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.17.21"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"npm-force-resolutions"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.10"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"resolutions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4.17.21"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>说明</strong>:</p>
<ul>
<li><code>resolutions</code> 字段指定所有 lodash 依赖（包括嵌套依赖）统一使用 4.17.21 版本</li>
<li>npm 旧版本不原生支持 <code>resolutions</code>，需要配合工具使用</li>
</ul>
<h4 data-id="heading-8">步骤 3: 创建 preinstall 脚本</h4>
<p>创建文件 <code>scripts/force-resolutions.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> { execSync } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>);

<span class="hljs-keyword">const</span> lockFile = <span class="hljs-string">'./package-lock.json'</span>;

<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(lockFile)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'package-lock.json 不存在，先生成锁文件...'</span>);
    <span class="hljs-comment">// 忽略生命周期脚本，防止 preinstall 自己被触发</span>
    <span class="hljs-title function_">execSync</span>(<span class="hljs-string">'npm install --package-lock-only'</span>, {
      <span class="hljs-attr">stdio</span>: <span class="hljs-string">'inherit'</span>,
      <span class="hljs-attr">env</span>: { ...process.<span class="hljs-property">env</span>, <span class="hljs-attr">npm_config_ignore_scripts</span>: <span class="hljs-string">'true'</span> }
    });
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'执行 npm-force-resolutions 修改 lock 文件...'</span>);
  <span class="hljs-title function_">execSync</span>(<span class="hljs-string">'npx npm-force-resolutions'</span>, { <span class="hljs-attr">stdio</span>: <span class="hljs-string">'inherit'</span> });
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'preinstall 脚本执行失败：'</span>, err);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
}
</code></pre>
<h4 data-id="heading-9">步骤 4: 在 package.json 中配置 preinstall 钩子</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"preinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node scripts/force-resolutions.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service serve"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service build"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>工作原理</strong>:</p>
<ol>
<li>每次运行 <code>npm install</code> 前，自动执行 <code>preinstall</code> 钩子</li>
<li>脚本检查并生成 <code>package-lock.json</code></li>
<li>运行 <code>npx npm-force-resolutions</code> 修改锁文件，将所有 lodash 依赖版本统一替换为 4.17.21</li>
<li><code>npm install</code> 根据修改后的锁文件安装依赖</li>
</ol>
<h4 data-id="heading-10">步骤 5: 清理并重新安装依赖</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除旧的依赖和锁文件</span>
<span class="hljs-built_in">rm</span> -rf node_modules
<span class="hljs-built_in">rm</span> package-lock.json

<span class="hljs-comment"># 重新安装（会自动触发 preinstall 钩子）</span>
npm install
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">bot-mb-manage@1.0.0 preinstall</span>
<span class="hljs-meta prompt_">&gt; </span><span class="bash">node scripts/force-resolutions.js</span>

package-lock.json 不存在，先生成锁文件...
执行 npm-force-resolutions 修改 lock 文件...
✔ Applied resolutions!

added 1523 packages in 2m
</code></pre>
<h4 data-id="heading-11">步骤 6: 验证依赖版本</h4>
<pre><code class="hljs language-bash" lang="bash">npm <span class="hljs-built_in">ls</span> lodash
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">bot-mb-<span class="hljs-symbol">manage@</span><span class="hljs-number">1.0</span><span class="hljs-number">.0</span> D:\bot\product\mb-manager-web
├─┬ element-<span class="hljs-symbol">ui@</span><span class="hljs-number">2.15</span><span class="hljs-number">.8</span>
│ └── <span class="hljs-symbol">lodash@</span><span class="hljs-number">4.17</span><span class="hljs-number">.21</span> deduped
├── <span class="hljs-symbol">lodash@</span><span class="hljs-number">4.17</span><span class="hljs-number">.21</span>
└─┬ <span class="hljs-meta">@riophae</span>/vue-<span class="hljs-symbol">treeselect@</span><span class="hljs-number">0.4</span><span class="hljs-number">.0</span>
  └── <span class="hljs-symbol">lodash@</span><span class="hljs-number">4.17</span><span class="hljs-number">.21</span> deduped
</code></pre>
<p>✅ <strong>此时所有 npm 依赖中的 lodash 版本已统一为 4.17.21</strong></p>
<h4 data-id="heading-12">步骤 7: 构建并部署</h4>
<pre><code class="hljs language-bash" lang="bash">npm run build
</code></pre>
<p>构建成功后，部署到生产环境，使用 Wappalyzer 再次检测...</p>
<hr/>
<h3 data-id="heading-13">阶段二：发现问题仍然存在</h3>
<h4 data-id="heading-14">问题现象</h4>
<p>部署后，<strong>Wappalyzer 仍然检测到 lodash 4.17.10</strong>！</p>
<h4 data-id="heading-15">疑惑</h4>
<ul>
<li>✅ <code>npm ls lodash</code> 显示所有依赖都是 4.17.21</li>
<li>✅ <code>package-lock.json</code> 中搜索 "4.17.10" 无结果</li>
<li>❓ 那么旧版本是从哪里来的？</li>
</ul>
<hr/>
<h3 data-id="heading-16">阶段三：深度排查 - 发现 Element UI 内嵌代码</h3>
<h4 data-id="heading-17">排查步骤 1: 检查 node_modules 中的所有 lodash</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查找所有 lodash package.json 文件</span>
find node_modules -name <span class="hljs-string">"package.json"</span> -path <span class="hljs-string">"*/lodash/package.json"</span>
</code></pre>
<p><strong>发现</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">node_modules/lodash/package.json                    ← 版本 4.17.21 ✓
node_modules/element-ui/node_modules/lodash/...     ← (不存在)
</code></pre>
<p>所有通过 npm 安装的 lodash 确实都是 4.17.21。</p>
<h4 data-id="heading-18">排查步骤 2: 搜索 Element UI 源码</h4>
<p>根据网上资料，有人提到 Element UI 可能使用了 lodash 的 <code>safeGet</code> 方法：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在 Element UI 目录中搜索 lodash 相关代码</span>
grep -r <span class="hljs-string">"lodash"</span> node_modules/element-ui/lib/
</code></pre>
<p><strong>关键发现</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">node_modules/element-ui/lib/utils/lodash.js
</code></pre>
<h4 data-id="heading-19">排查步骤 3: 检查可疑文件</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看文件大小</span>
<span class="hljs-built_in">ls</span> -lh node_modules/element-ui/lib/utils/lodash.js
</code></pre>
<p><strong>输出</strong>:</p>
<pre><code class="hljs language-css" lang="css">-rw-r<span class="hljs-attr">--r--</span> <span class="hljs-number">1</span> user <span class="hljs-number">197121</span> <span class="hljs-number">497.8</span>K Nov <span class="hljs-number">15</span> <span class="hljs-number">10</span>:<span class="hljs-number">23</span> lodash.js
</code></pre>
<p>⚠️ <strong>异常</strong>: 一个 utils 工具文件竟然有 497.8KB！</p>
<h4 data-id="heading-20">排查步骤 4: 读取文件内容</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">head</span> -20 node_modules/element-ui/lib/utils/lodash.js
</code></pre>
<p><strong>关键内容</strong>:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * <span class="hljs-doctag">@license</span>
 * Lodash &lt;https://lodash.com/&gt;
 * Copyright OpenJS Foundation and other contributors &lt;https://openjsf.org/&gt;
 * Released under MIT license &lt;https://lodash.com/license&gt;
 * Based on Underscore.js 1.8.3 &lt;http://underscorejs.org/LICENSE&gt;
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters &amp; Editors
 */</span>
;(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {

  <span class="hljs-comment">/** Used as a safe reference for `undefined` in pre-ES5 environments. */</span>
  <span class="hljs-keyword">var</span> <span class="hljs-literal">undefined</span>;

  <span class="hljs-comment">/** Used as the semantic version number. */</span>
  <span class="hljs-keyword">var</span> <span class="hljs-variable constant_">VERSION</span>=<span class="hljs-string">'4.17.10'</span>;    <span class="hljs-comment">// ← 找到了！</span>
</code></pre>
<h4 data-id="heading-21">🎯 问题根源确认</h4>
<p><strong>Element UI 在其构建产物中内嵌了完整的 lodash 4.17.10 源代码！</strong></p>
<p>这解释了为什么：</p>
<ul>
<li><code>npm ls lodash</code> 显示所有依赖都是 4.17.21（因为这只检查 npm 依赖）</li>
<li><code>npm-force-resolutions</code> 无法解决问题（因为这不是 npm 依赖，是内嵌代码）</li>
<li>Wappalyzer 检测到 4.17.10（因为它分析的是最终构建产物）</li>
</ul>
<h4 data-id="heading-22">验证不同版本的 Element UI</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查当前版本（假设是 2.15.14）</span>
npm list element-ui
<span class="hljs-comment"># element-ui@2.15.14</span>

<span class="hljs-comment"># 检查是否存在内嵌 lodash</span>
<span class="hljs-built_in">ls</span> node_modules/element-ui/lib/utils/lodash.js
<span class="hljs-comment"># 存在 ✓</span>

<span class="hljs-comment"># 尝试安装旧版本 2.15.8</span>
npm install element-ui@2.15.8

<span class="hljs-comment"># 再次检查</span>
<span class="hljs-built_in">ls</span> node_modules/element-ui/lib/utils/lodash.js
<span class="hljs-comment"># ls: cannot access 'node_modules/element-ui/lib/utils/lodash.js': No such file or directory</span>
</code></pre>
<p>✅ <strong>发现</strong>: Element UI <strong>2.15.8</strong> 及之前的版本不包含内嵌 lodash 文件！</p>
<hr/>
<h3 data-id="heading-23">阶段四：评估降级风险</h3>
<h4 data-id="heading-24">对比版本差异</h4>
<p>查询 Element UI 官方 GitHub Changelog，2.15.8 到 2.15.14 的主要变更：</p>








































<table><thead><tr><th>版本</th><th>发布时间</th><th>主要变更</th></tr></thead><tbody><tr><td><strong>2.15.9</strong></td><td>2022-06-02</td><td>修复 Table、FormItem、Cascader bug；优化 DatePicker &amp; Cascader 下拉动画</td></tr><tr><td><strong>2.15.10</strong></td><td>2022-09-13</td><td>DatePicker 新增 <code>months</code> 和 <code>years</code> type 支持；修复 Loading、Tree bug</td></tr><tr><td><strong>2.15.11</strong></td><td>2022-11-15</td><td><strong>新增 Statistics 组件</strong>；Progress 新增 <code>defineBackColor</code>、<code>textColor</code> 属性；Web Types 支持</td></tr><tr><td><strong>2.15.12</strong></td><td>2022-11-16</td><td>修复 Statistic 千分位 bug</td></tr><tr><td><strong>2.15.13</strong></td><td>2023-02-12</td><td>修复 Statistics slot 显示 bug；<strong>Statistics 使用本地化 lodash</strong></td></tr><tr><td><strong>2.15.14</strong></td><td>2023-08-24</td><td>Table 新增高亮选中行功能；优化 Statistics 文档和代码</td></tr></tbody></table>
<h4 data-id="heading-25">检查项目是否使用新特性</h4>
<p>根据 Changelog，2.15.9+ 版本的主要新特性包括：</p>
<ul>
<li><strong>Statistics 组件</strong>（2.15.11 新增）</li>
<li><strong>DatePicker 的 <code>months</code>/<code>years</code> type</strong>（2.15.10 新增）</li>
<li><strong>Progress 的 <code>defineBackColor</code>/<code>textColor</code> 属性</strong>（2.15.11 新增）</li>
</ul>
<h5 data-id="heading-26">方法一：Git Bash（推荐，Windows 安装 Git 后自带）</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查是否使用了 Statistics 组件</span>
grep -r <span class="hljs-string">"el-statistics\|el-statistic"</span> src/ || <span class="hljs-built_in">echo</span> <span class="hljs-string">"✓ 无结果 - 未使用 Statistics 组件"</span>

<span class="hljs-comment"># 检查 DatePicker 的 months/years 类型</span>
grep -r <span class="hljs-string">'type="months"\|type="years"'</span> src/ || <span class="hljs-built_in">echo</span> <span class="hljs-string">"✓ 无结果 - 未使用 DatePicker months/years 类型"</span>

<span class="hljs-comment"># 检查 Progress 的新属性</span>
grep -r <span class="hljs-string">"defineBackColor\|textColor"</span> src/ | grep -i progress || <span class="hljs-built_in">echo</span> <span class="hljs-string">"✓ 无结果 - 未使用 Progress 新属性"</span>
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">✓ 无结果 - 未使用 Statistics 组件
✓ 无结果 - 未使用 DatePicker months/years 类型
✓ 无结果 - 未使用 Progress 新属性
</code></pre>
<h5 data-id="heading-27">方法二：Windows PowerShell</h5>
<pre><code class="hljs language-powershell" lang="powershell"># 检查是否使用了 Statistics 组件
$result = Get-ChildItem -Path src -Recurse -Include *.vue,*.js | Select-String -Pattern "el-statistics|el-statistic"
if ($result) { $result } else { "✓ 无结果 - 未使用 Statistics 组件" }

# 检查 DatePicker 的 months/years 类型
$result = Get-ChildItem -Path src -Recurse -Include *.vue,*.js | Select-String -Pattern 'type="months"|type="years"'
if ($result) { $result } else { "✓ 无结果 - 未使用 DatePicker months/years 类型" }

# 检查 Progress 的新属性
$result = Get-ChildItem -Path src -Recurse -Include *.vue,*.js | Select-String -Pattern "defineBackColor|textColor"
if ($result) { $result } else { "✓ 无结果 - 未使用 Progress 新属性" }
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">✓ 无结果 - 未使用 Statistics 组件
✓ 无结果 - 未使用 DatePicker months/years 类型
✓ 无结果 - 未使用 Progress 新属性
</code></pre>
<h5 data-id="heading-28">方法三：Windows CMD</h5>
<pre><code class="hljs language-cmd" lang="cmd">REM 检查 Statistics 组件
findstr /s /i "el-statistics el-statistic" src\*.vue src\*.js &gt;nul 2&gt;&amp;1 &amp;&amp; echo 找到匹配 || echo ✓ 无结果 - 未使用 Statistics 组件

REM 检查 DatePicker 的 months/years 类型
findstr /s "type=\"months\" type=\"years\"" src\*.vue src\*.js &gt;nul 2&gt;&amp;1 &amp;&amp; echo 找到匹配 || echo ✓ 无结果 - 未使用 DatePicker months/years 类型

REM 检查 Progress 的新属性
findstr /s /i "defineBackColor textColor" src\*.vue src\*.js &gt;nul 2&gt;&amp;1 &amp;&amp; echo 找到匹配 || echo ✓ 无结果 - 未使用 Progress 新属性
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-bash" lang="bash">✓ 无结果 - 未使用 Statistics 组件
✓ 无结果 - 未使用 DatePicker months/years 类型
✓ 无结果 - 未使用 Progress 新属性
</code></pre>
<hr/>
<p><strong>结论</strong>: 所有检测均显示"无结果"，说明项目<strong>未使用</strong>任何 2.15.9+ 版本的新特性，降级到 2.15.8 <strong>无风险</strong>。</p>
<hr/>
<h3 data-id="heading-29">阶段五：实施降级方案</h3>
<h4 data-id="heading-30">步骤 1: 修改 package.json</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"element-ui"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.15.8"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 从 2.15.14 降级</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.17.21"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-31">步骤 2: 清理并重新安装</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除旧版本</span>
<span class="hljs-built_in">rm</span> -rf node_modules/element-ui
<span class="hljs-built_in">rm</span> package-lock.json

<span class="hljs-comment"># 重新安装（preinstall 钩子会自动执行）</span>
npm install
</code></pre>
<p><strong>输出</strong>:</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_">&gt; </span><span class="bash">bot-mb-manage@1.0.0 preinstall</span>
<span class="hljs-meta prompt_">&gt; </span><span class="bash">node scripts/force-resolutions.js</span>

执行 npm-force-resolutions 修改 lock 文件...
✔ Applied resolutions!

added 1523 packages in 1m
</code></pre>
<h4 data-id="heading-32">步骤 3: 验证修复</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 验证 Element UI 版本</span>
npm list element-ui
<span class="hljs-comment"># element-ui@2.15.8 ✓</span>

<span class="hljs-comment"># 2. 验证 lodash 版本</span>
npm list lodash
<span class="hljs-comment"># 所有依赖均为 4.17.21 ✓</span>

<span class="hljs-comment"># 3. 验证内嵌文件不存在</span>
<span class="hljs-built_in">ls</span> node_modules/element-ui/lib/utils/lodash.js
<span class="hljs-comment"># ls: cannot access '...': No such file or directory ✓</span>
</code></pre>
<h4 data-id="heading-33">步骤 4: 构建测试</h4>
<pre><code class="hljs language-bash" lang="bash">npm run build
</code></pre>
<p><strong>输出</strong>:</p>
<pre><code class="hljs language-vbnet" lang="vbnet">...
Build complete. The dist directory <span class="hljs-built_in">is</span> ready <span class="hljs-keyword">to</span> be deployed.
✨  Done <span class="hljs-keyword">in</span> <span class="hljs-number">45.23</span>s
</code></pre>
<p>✅ <strong>构建成功，无错误！</strong></p>
<hr/>
<h3 data-id="heading-34">最终验证</h3>
<h4 data-id="heading-35">1. 本地验证</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查依赖树</span>
npm <span class="hljs-built_in">ls</span> lodash
</code></pre>
<p><strong>输出</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">bot-mb-<span class="hljs-symbol">manage@</span><span class="hljs-number">1.0</span><span class="hljs-number">.0</span> D:\bot\product\mb-manager-web
├─┬ element-<span class="hljs-symbol">ui@</span><span class="hljs-number">2.15</span><span class="hljs-number">.8</span>
│ └── <span class="hljs-symbol">lodash@</span><span class="hljs-number">4.17</span><span class="hljs-number">.21</span> deduped
├── <span class="hljs-symbol">lodash@</span><span class="hljs-number">4.17</span><span class="hljs-number">.21</span>
└─┬ crypto-<span class="hljs-symbol">js@</span><span class="hljs-number">4.1</span><span class="hljs-number">.1</span>
  └── <span class="hljs-symbol">lodash@</span><span class="hljs-number">4.17</span><span class="hljs-number">.21</span> deduped
</code></pre>
<p>✅ 所有 lodash 依赖统一为 4.17.21</p>
<h4 data-id="heading-36">2. 生产环境验证</h4>
<ol>
<li>部署构建产物到生产环境</li>
<li>使用 <strong>Wappalyzer</strong> 检测页面依赖</li>
<li>确认 lodash 版本显示为 <strong>4.17.21</strong> ✓</li>
<li>功能测试通过 ✓</li>
</ol>
<hr/>
<h3 data-id="heading-37">完整配置文件</h3>
<h4 data-id="heading-38">package.json</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"bot-mb-manage"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"preinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node scripts/force-resolutions.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service serve"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service build"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"element-ui"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.15.8"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.17.21"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^2.7.14"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"npm-force-resolutions"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.10"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@vue/cli-service"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4.5.11"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"resolutions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4.17.21"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-39">scripts/force-resolutions.js</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">const</span> { execSync } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>);

<span class="hljs-keyword">const</span> lockFile = <span class="hljs-string">'./package-lock.json'</span>;

<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(lockFile)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'package-lock.json 不存在，先生成锁文件...'</span>);
    <span class="hljs-title function_">execSync</span>(<span class="hljs-string">'npm install --package-lock-only'</span>, {
      <span class="hljs-attr">stdio</span>: <span class="hljs-string">'inherit'</span>,
      <span class="hljs-attr">env</span>: { ...process.<span class="hljs-property">env</span>, <span class="hljs-attr">npm_config_ignore_scripts</span>: <span class="hljs-string">'true'</span> }
    });
  }
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'执行 npm-force-resolutions 修改 lock 文件...'</span>);
  <span class="hljs-title function_">execSync</span>(<span class="hljs-string">'npx npm-force-resolutions'</span>, { <span class="hljs-attr">stdio</span>: <span class="hljs-string">'inherit'</span> });
} <span class="hljs-keyword">catch</span> (err) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'preinstall 脚本执行失败：'</span>, err);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
}
</code></pre>
<hr/>
<h3 data-id="heading-40">其他可选方案</h3>
<h4 data-id="heading-41">方案二：使用 patch-package 修补 Element UI（适合需要保持最新版本的场景）</h4>
<p>如果项目必须使用 Element UI 2.15.9+ 的新特性，可以使用 <code>patch-package</code> 工具修补 node_modules 中的内嵌 lodash 文件。</p>
<h5 data-id="heading-42">什么是 patch-package？</h5>
<p><code>patch-package</code> 允许你修改 node_modules 中的第三方包，并生成补丁文件。每次 <code>npm install</code> 后会自动应用这些补丁。</p>
<h5 data-id="heading-43">完整操作步骤</h5>
<h6 data-id="heading-44">步骤 1: 安装 patch-package</h6>
<pre><code class="hljs language-bash" lang="bash">npm install --save-dev patch-package postinstall-postinstall
</code></pre>
<p><strong>说明</strong>:</p>
<ul>
<li><code>patch-package</code>: 核心工具，用于创建和应用补丁</li>
<li><code>postinstall-postinstall</code>: 确保补丁在 <code>npm install</code> 后正确应用（尤其是 Windows 环境）</li>
</ul>
<h6 data-id="heading-45">步骤 2: 修改 package.json 添加 postinstall 脚本</h6>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"preinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node scripts/force-resolutions.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"postinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"patch-package"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service serve"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-cli-service build"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>工作原理</strong>: 每次 <code>npm install</code> 完成后，会自动运行 <code>patch-package</code> 应用补丁文件。</p>
<h6 data-id="heading-46">步骤 3: 修改 Element UI 内嵌的 lodash 版本号</h6>
<p><strong>方法一：手动修改（推荐，精确控制）</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用编辑器打开文件</span>
code node_modules/element-ui/lib/utils/lodash.js

<span class="hljs-comment"># 或使用 PowerShell 替换（仅修改版本号）</span>
(Get-Content node_modules\element-ui\lib\utils\lodash.js) -replace <span class="hljs-string">"VERSION='4\.17\.10'"</span>,<span class="hljs-string">"VERSION='4.17.21'"</span> | Set-Content node_modules\element-ui\lib\utils\lodash.js

<span class="hljs-comment"># 或使用 Git Bash 替换</span>
sed -i <span class="hljs-string">"s/VERSION='4\.17\.10'/VERSION='4.17.21'/g"</span> node_modules/element-ui/lib/utils/lodash.js
</code></pre>
<p>找到第 14 行附近：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/** Used as the semantic version number. */</span>
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">VERSION</span>=<span class="hljs-string">'4.17.10'</span>;    <span class="hljs-comment">// ← 修改这里</span>
</code></pre>
<p>改为：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/** Used as the semantic version number. */</span>
<span class="hljs-keyword">var</span> <span class="hljs-variable constant_">VERSION</span>=<span class="hljs-string">'4.17.21'</span>;    <span class="hljs-comment">// ← 修改后</span>
</code></pre>
<p><strong>方法二：完全替换（更彻底，但需要测试）</strong></p>
<p>如果想完全替换内嵌的 lodash，可以用项目中的 lodash 4.17.21 覆盖：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 备份原文件</span>
<span class="hljs-built_in">cp</span> node_modules/element-ui/lib/utils/lodash.js node_modules/element-ui/lib/utils/lodash.js.bak

<span class="hljs-comment"># 复制项目的 lodash（需要先构建 lodash）</span>
<span class="hljs-built_in">cp</span> node_modules/lodash/lodash.js node_modules/element-ui/lib/utils/lodash.js
</code></pre>
<p>⚠️ <strong>警告</strong>: 完全替换可能导致 Element UI 内部功能异常，建议只修改版本号。</p>
<h6 data-id="heading-47">步骤 4: 生成补丁文件</h6>
<pre><code class="hljs language-bash" lang="bash">npx patch-package element-ui
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-vbnet" lang="vbnet">patch-package <span class="hljs-number">8.0</span>.<span class="hljs-number">0</span>
• Creating temporary folder
• Installing element-ui@<span class="hljs-number">2.15</span>.<span class="hljs-number">14</span> <span class="hljs-keyword">with</span> npm
• Diffing your files <span class="hljs-keyword">with</span> clean files
✔ Created file patches/element-ui+<span class="hljs-number">2.15</span>.<span class="hljs-number">14</span>.patch

💡 element-ui <span class="hljs-built_in">is</span> <span class="hljs-keyword">on</span> GitHub! <span class="hljs-keyword">To</span> draft an issue based <span class="hljs-keyword">on</span> your patch run

    npx patch-package element-ui --create-issue
</code></pre>
<p>这会在项目根目录创建 <code>patches/element-ui+2.15.14.patch</code> 文件。</p>
<h6 data-id="heading-48">步骤 5: 查看生成的补丁文件</h6>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Git Bash / Linux / macOS</span>
<span class="hljs-built_in">cat</span> patches/element-ui+2.15.14.patch

<span class="hljs-comment"># Windows PowerShell</span>
Get-Content patches\element-ui+2.15.14.patch

<span class="hljs-comment"># Windows CMD</span>
<span class="hljs-built_in">type</span> patches\element-ui+2.15.14.patch
</code></pre>
<p><strong>补丁文件内容示例</strong>:</p>
<pre><code class="hljs language-diff" lang="diff"><span class="hljs-comment">diff --git a/node_modules/element-ui/lib/utils/lodash.js b/node_modules/element-ui/lib/utils/lodash.js</span>
<span class="hljs-comment">index 1234567..abcdefg 100644</span>
<span class="hljs-comment">--- a/node_modules/element-ui/lib/utils/lodash.js</span>
<span class="hljs-comment">+++ b/node_modules/element-ui/lib/utils/lodash.js</span>
<span class="hljs-meta">@@ -11,7 +11,7 @@</span>
   var undefined;

   /** Used as the semantic version number. */
<span class="hljs-deletion">-  var VERSION='4.17.10';</span>
<span class="hljs-addition">+  var VERSION='4.17.21';</span>

   /** Used as references for various `Number` constants. */
   var MAX_SAFE_INTEGER = 9007199254740991;
</code></pre>
<h6 data-id="heading-49">步骤 6: 提交补丁文件到 Git</h6>
<pre><code class="hljs language-bash" lang="bash">git add patches/
git commit -m <span class="hljs-string">"fix: 添加 element-ui lodash 版本修复补丁"</span>
</code></pre>
<p><strong>重要</strong>: 补丁文件必须提交到版本控制系统，团队其他成员才能应用相同的修复。</p>
<h6 data-id="heading-50">步骤 7: 验证补丁生效</h6>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除 node_modules 测试自动应用</span>
<span class="hljs-built_in">rm</span> -rf node_modules
npm install

<span class="hljs-comment"># 验证版本号已修改</span>
<span class="hljs-comment"># Git Bash</span>
<span class="hljs-built_in">head</span> -20 node_modules/element-ui/lib/utils/lodash.js | grep VERSION

<span class="hljs-comment"># PowerShell</span>
Get-Content node_modules\element-ui\lib\utils\lodash.js -Head 20 | Select-String VERSION
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> <span class="hljs-variable constant_">VERSION</span>=<span class="hljs-string">'4.17.21'</span>;    <span class="hljs-comment">// ✓ 已修改</span>
</code></pre>
<h6 data-id="heading-51">步骤 8: 构建并验证</h6>
<pre><code class="hljs language-bash" lang="bash">npm run build

<span class="hljs-comment"># 部署后使用 Wappalyzer 检测，应显示 lodash 4.17.21</span>
</code></pre>
<h5 data-id="heading-52">补丁维护注意事项</h5>
<h6 data-id="heading-53">1. Element UI 版本升级时</h6>
<p>每次升级 Element UI 版本后，需要重新生成补丁：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 升级 Element UI</span>
npm install element-ui@2.15.15

<span class="hljs-comment"># 重新修改文件</span>
<span class="hljs-comment"># ... 按照步骤 3 修改 ...</span>

<span class="hljs-comment"># 删除旧补丁</span>
<span class="hljs-built_in">rm</span> patches/element-ui+2.15.14.patch

<span class="hljs-comment"># 生成新补丁</span>
npx patch-package element-ui

<span class="hljs-comment"># 新补丁文件名: patches/element-ui+2.15.15.patch</span>
</code></pre>
<h6 data-id="heading-54">2. 团队协作</h6>
<p><strong>新成员加入项目时</strong>:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 克隆项目后执行</span>
npm install

<span class="hljs-comment"># patch-package 会自动应用 patches/ 目录下的所有补丁</span>
</code></pre>
<p><strong>预期输出</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">&gt; postinstall
&gt; patch-<span class="hljs-keyword">package</span>

patch-<span class="hljs-keyword">package</span> <span class="hljs-number">8.0</span><span class="hljs-number">.0</span>
Applying patches...
element-<span class="hljs-symbol">ui@</span><span class="hljs-number">2.15</span><span class="hljs-number">.14</span> ✔
</code></pre>
<h6 data-id="heading-55">3. CI/CD 环境配置</h6>
<p>确保 CI/CD 流程中 <code>npm install</code> 后会自动应用补丁：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># .github/workflows/build.yml 示例</span>
<span class="hljs-attr">steps:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
    <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span>  <span class="hljs-comment"># 或 npm install</span>
    <span class="hljs-comment"># postinstall 钩子会自动运行 patch-package</span>

  <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Verify</span> <span class="hljs-string">patch</span> <span class="hljs-string">applied</span>
    <span class="hljs-attr">run:</span> <span class="hljs-string">grep</span> <span class="hljs-string">"VERSION='4.17.21'"</span> <span class="hljs-string">node_modules/element-ui/lib/utils/lodash.js</span>
</code></pre>
<h5 data-id="heading-56">方案优缺点总结</h5>





















<table><thead><tr><th>方面</th><th>说明</th></tr></thead><tbody><tr><td><strong>优点</strong></td><td>• 可以保持使用最新版 Element UI<br/>• 修改精确可控<br/>• 团队成员自动同步修复</td></tr><tr><td><strong>缺点</strong></td><td>• 需要维护补丁文件<br/>• Element UI 每次升级都需重新生成补丁<br/>• 补丁可能与新版本冲突</td></tr><tr><td><strong>适用场景</strong></td><td>• 必须使用 Element UI 2.15.9+ 新特性<br/>• 团队有完善的 CI/CD 流程<br/>• 愿意承担补丁维护成本</td></tr></tbody></table>
<h5 data-id="heading-57">常见问题</h5>
<p><strong>Q: 补丁文件丢失怎么办？</strong></p>
<ul>
<li>补丁文件在 <code>patches/</code> 目录，必须提交到 Git</li>
<li>如果丢失，按照步骤 3-4 重新生成即可</li>
</ul>
<p><strong>Q: npm install 后补丁没有应用？</strong></p>
<ul>
<li>检查 package.json 中是否有 <code>"postinstall": "patch-package"</code></li>
<li>Windows 环境确保安装了 <code>postinstall-postinstall</code></li>
<li>手动运行 <code>npx patch-package</code> 应用补丁</li>
</ul>
<p><strong>Q: Element UI 升级后报错？</strong></p>
<ul>
<li>新版本可能内部结构变化，补丁无法应用</li>
<li>需要重新修改文件并生成新补丁</li>
<li>或考虑降级 Element UI 到稳定版本</li>
</ul>
<hr/>
<h4 data-id="heading-58">方案三：Webpack 插件替换（不推荐）</h4>
<p>使用 <code>NormalModuleReplacementPlugin</code> 在构建时替换内嵌的 lodash：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vue.config.js</span>
<span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">configureWebpack</span>: {
    <span class="hljs-attr">plugins</span>: [
      <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">NormalModuleReplacementPlugin</span>(
        <span class="hljs-regexp">/element-ui[/\\]lib[/\\]utils[/\\]lodash/</span>,
        <span class="hljs-string">'lodash'</span>
      )
    ]
  }
};
</code></pre>
<p><strong>缺点</strong>:</p>
<ul>
<li>可能破坏 Element UI 的内部逻辑</li>
<li>需要大量测试验证兼容性</li>
<li>不推荐使用</li>
</ul>
<hr/>
<h3 data-id="heading-59">问题总结</h3>
<h4 data-id="heading-60">问题演进</h4>
<ol>
<li><strong>初始问题</strong>: Wappalyzer 检测到 lodash 4.17.10，但 package.json 声明的是 4.17.21</li>
<li><strong>第一步尝试</strong>: 配置 <code>npm-force-resolutions</code> 统一嵌套依赖版本</li>
<li><strong>问题持续</strong>: npm 依赖已统一，但 Wappalyzer 仍检测到旧版本</li>
<li><strong>深度排查</strong>: 发现 Element UI 2.15.14 内嵌了完整的 lodash 4.17.10 源代码</li>
<li><strong>最终解决</strong>: 降级到 Element UI 2.15.8（不包含内嵌 lodash）</li>
</ol>
<h4 data-id="heading-61">根本原因</h4>
<p><strong>Element UI 2.15.14</strong> 在构建产物中直接嵌入了 lodash 4.17.10 的完整源代码（~497KB），而不是通过 npm 依赖管理。这导致：</p>
<ul>
<li>npm 工具无法检测和控制该版本</li>
<li><code>npm-force-resolutions</code> 无法修改内嵌代码</li>
<li>最终构建产物包含已知漏洞的旧版本 lodash</li>
</ul>
<h4 data-id="heading-62">解决方案对比</h4>





























<table><thead><tr><th>方案</th><th>优点</th><th>缺点</th><th>推荐度</th></tr></thead><tbody><tr><td><strong>降级 Element UI</strong></td><td>彻底解决问题，无需额外配置</td><td>无法使用 2.15.9+ 新特性</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td>Webpack 插件替换</td><td>保持最新版本</td><td>可能破坏 Element UI 内部逻辑</td><td>⭐⭐</td></tr><tr><td>patch-package 修补</td><td>保持最新版本</td><td>需要维护补丁，升级复杂</td><td>⭐⭐</td></tr></tbody></table>
<h4 data-id="heading-63">关键经验</h4>
<ol>
<li><strong>npm-force-resolutions 只能管理 npm 依赖</strong>，无法处理第三方库内嵌的代码</li>
<li><strong>Wappalyzer 检测的是最终构建产物</strong>，比 npm 依赖检查更准确</li>
<li><strong>第三方库可能内嵌依赖</strong>，升级时需要检查构建产物内容</li>
<li><strong>降级方案需要评估风险</strong>，通过 Changelog 和代码检索确认影响范围</li>
</ol>
<hr/>
<h3 data-id="heading-64">预防措施</h3>
<h4 data-id="heading-65">1. 定期安全检查</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查 npm 依赖漏洞</span>
npm audit

<span class="hljs-comment"># 检查生产构建产物</span>
<span class="hljs-comment"># 使用 Wappalyzer 或 webpack-bundle-analyzer</span>
npm run build --report
</code></pre>
<h4 data-id="heading-66">2. 依赖升级审查流程</h4>
<ul>
<li>查阅 Changelog，了解变更内容</li>
<li>检查是否引入内嵌依赖（特别是 lib/utils 目录）</li>
<li>在测试环境充分验证后再部署生产</li>
</ul>
<h4 data-id="heading-67">3. 锁定关键依赖版本</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"element-ui"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.15.8"</span><span class="hljs-punctuation">,</span>  <span class="hljs-comment">// 不使用 ^，锁定版本</span>
    <span class="hljs-attr">"lodash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"4.17.21"</span>      <span class="hljs-comment">// 锁定版本，避免意外升级</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-68">4. 监控构建产物大小</h4>
<p>异常的文件大小增长可能意味着内嵌了不必要的依赖。</p>
<hr/>
<h3 data-id="heading-69">参考命令</h3>
<h4 data-id="heading-70">依赖检查</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看某个包的所有版本</span>
npm <span class="hljs-built_in">ls</span> &lt;package-name&gt;

<span class="hljs-comment"># 查看依赖树（显示嵌套关系）</span>
npm <span class="hljs-built_in">ls</span> --all

<span class="hljs-comment"># 查找 node_modules 中的文件</span>
find node_modules -name <span class="hljs-string">"*.js"</span> -path <span class="hljs-string">"*/&lt;keyword&gt;/*"</span>

<span class="hljs-comment"># 搜索文件内容</span>
grep -r <span class="hljs-string">"关键词"</span> node_modules/&lt;package-name&gt;/
</code></pre>
<h4 data-id="heading-71">清理与重装</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 完全清理</span>
<span class="hljs-built_in">rm</span> -rf node_modules package-lock.json

<span class="hljs-comment"># 清理 npm 缓存</span>
npm cache clean --force

<span class="hljs-comment"># 重新安装</span>
npm install
</code></pre>
<h4 data-id="heading-72">Git Bash vs PowerShell</h4>

























<table><thead><tr><th>命令</th><th>Git Bash</th><th>PowerShell</th></tr></thead><tbody><tr><td>查找文件</td><td><code>find . -name "*.js"</code></td><td><code>Get-ChildItem -Recurse -Filter "*.js"</code></td></tr><tr><td>搜索内容</td><td><code>grep -r "keyword" src/</code></td><td><code>Select-String -Path src\* -Pattern "keyword" -Recurse</code></td></tr><tr><td>检查文件存在</td><td><code>ls file.js</code></td><td><code>Test-Path file.js</code></td></tr></tbody></table>
<hr/>
<p><strong>文档生成时间</strong>: 2025-11-19
<strong>问题状态</strong>: ✅ 已解决
<strong>验证状态</strong>: ✅ 生产环境验证通过</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于浏览器自动化的 Cookie 获取与复用实践]]></title>    <link>https://juejin.cn/post/7574614157955072034</link>    <guid>https://juejin.cn/post/7574614157955072034</guid>    <pubDate>2025-11-20T08:57:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574614157955072034" data-draft-id="7574601160981331983" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于浏览器自动化的 Cookie 获取与复用实践"/> <meta itemprop="keywords" content="自动化运维"/> <meta itemprop="datePublished" content="2025-11-20T08:57:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户778537183696"/> <meta itemprop="url" content="https://juejin.cn/user/1264901457184346"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于浏览器自动化的 Cookie 获取与复用实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1264901457184346/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户778537183696
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:57:11.000Z" title="Thu Nov 20 2025 08:57:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文只围绕三个问题展开：</p>
<ol>
<li>如何稳定地获取浏览器中的 Cookie（以及相关会话状态）</li>
<li>如何在后续脚本中复用这份 Cookie，实现免登录访问</li>
<li>为什么这种方式在技术上是可行的（底层原理是什么）</li>
</ol>
<hr/>
<h2 data-id="heading-0">一、如何获取 Cookie（认证采集脚本）</h2>
<p>思路是：启动一个有界面的浏览器实例，让用户手动完成一次真实登录，然后由脚本在合适的时机导出当前会话状态并落盘。</p>
<p>下面是一个最小可用的“认证采集脚本”示例（Node.js + Playwright）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { firefox } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"playwright"</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">AUTH_DIR</span> = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">"auth"</span>);
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">AUTH_FILE</span> = path.<span class="hljs-title function_">join</span>(<span class="hljs-variable constant_">AUTH_DIR</span>, <span class="hljs-string">"auth-state.json"</span>);
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">BROWSER_EXECUTABLE</span> = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">"camoufox"</span>, <span class="hljs-string">"camoufox.exe"</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ensureDir</span>(<span class="hljs-params">dir</span>) {
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(dir)) {
    fs.<span class="hljs-title function_">mkdirSync</span>(dir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> });
  }
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">captureAuth</span>(<span class="hljs-params"/>) {
  <span class="hljs-title function_">ensureDir</span>(<span class="hljs-variable constant_">AUTH_DIR</span>);

  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> firefox.<span class="hljs-title function_">launch</span>({
    <span class="hljs-attr">headless</span>: <span class="hljs-literal">false</span>,                      <span class="hljs-comment">// 必须有界面，用户需要手动登录</span>
    <span class="hljs-attr">executablePath</span>: <span class="hljs-variable constant_">BROWSER_EXECUTABLE</span>,   <span class="hljs-comment">// 如需指定自带浏览器，可配置此路径</span>
  });

  <span class="hljs-keyword">const</span> context = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newContext</span>();
  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> context.<span class="hljs-title function_">newPage</span>();

  <span class="hljs-comment">// 打开登录入口页面，用户在页面中完成登录</span>
  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(<span class="hljs-string">"https://example.com/login"</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"请在新打开的浏览器中完成登录，然后回到终端按 Enter 继续..."</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> process.<span class="hljs-property">stdin</span>.<span class="hljs-title function_">once</span>(<span class="hljs-string">"data"</span>, resolve));

  <span class="hljs-comment">// 导出当前上下文的完整会话状态（包含 Cookies / Storage）</span>
  <span class="hljs-keyword">const</span> storageState = <span class="hljs-keyword">await</span> context.<span class="hljs-title function_">storageState</span>();

  fs.<span class="hljs-title function_">writeFileSync</span>(<span class="hljs-variable constant_">AUTH_FILE</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(storageState, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>), <span class="hljs-string">"utf-8"</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`认证状态已写入: <span class="hljs-subst">${AUTH_FILE}</span>`</span>);

  <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">close</span>();
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-title function_">captureAuth</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
});
</code></pre>
<p>关键点说明：</p>
<ul>
<li>
<p><strong>上下文级别会话</strong>：<br/>
<code>browser.newContext()</code> 创建的是独立的浏览器上下文，类似一个轻量级“用户配置目录”，其 Cookies、本地存储等和其他上下文隔离。</p>
</li>
<li>
<p><strong>人工登录 + 自动导出</strong>：<br/>
登录动作完全由用户在真实页面中完成，脚本只负责在用户确认后调用 <code>context.storageState()</code> 导出状态。</p>
</li>
<li>
<p><strong>会话状态文件化</strong>：<br/>
<code>storageState</code> 是一个普通 JS 对象，序列化为 <code>auth/auth-state.json</code> 后，就形成一个可长期复用的认证文件。</p>
</li>
</ul>
<hr/>
<h2 data-id="heading-1">二、如何复用 Cookie（业务脚本）</h2>
<p>有了认证文件之后，业务脚本只需要在创建浏览器上下文时，把这份状态注入进去，新的上下文就会继承原来的 Cookie 和存储数据。</p>
<p>下面是一个使用同一认证文件的业务脚本示例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { firefox } = <span class="hljs-built_in">require</span>(<span class="hljs-string">"playwright"</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);

<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">AUTH_FILE</span> = path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">"auth"</span>, <span class="hljs-string">"auth-state.json"</span>);

<span class="hljs-keyword">function</span> <span class="hljs-title function_">loadStorageState</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(<span class="hljs-variable constant_">AUTH_FILE</span>)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`认证文件不存在: <span class="hljs-subst">${AUTH_FILE}</span>，请先运行采集脚本生成`</span>);
  }
  <span class="hljs-keyword">const</span> raw = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-variable constant_">AUTH_FILE</span>, <span class="hljs-string">"utf-8"</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(raw);
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> storageState = <span class="hljs-title function_">loadStorageState</span>();

  <span class="hljs-comment">// 业务脚本中通常可以使用无头模式</span>
  <span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> firefox.<span class="hljs-title function_">launch</span>({ <span class="hljs-attr">headless</span>: <span class="hljs-literal">true</span> });

  <span class="hljs-comment">// 关键点：在创建 context 的时候注入 storageState</span>
  <span class="hljs-keyword">const</span> context = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newContext</span>({ storageState });
  <span class="hljs-keyword">const</span> page = <span class="hljs-keyword">await</span> context.<span class="hljs-title function_">newPage</span>();

  <span class="hljs-comment">// 此处直接访问需要登录态的页面</span>
  <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">goto</span>(<span class="hljs-string">"https://example.com/protected"</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"当前页标题:"</span>, <span class="hljs-keyword">await</span> page.<span class="hljs-title function_">title</span>());

  <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">close</span>();
}

<span class="hljs-title function_">main</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err);
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>);
});
</code></pre>
<p>复用过程的本质是：<strong>不再从空上下文开始，而是用一份“预先持久化”的会话状态初始化上下文</strong>。</p>
<hr/>
<h2 data-id="heading-2">三、为什么这样做可行</h2>
<p>上面的流程之所以能工作，核心依赖三个技术点：</p>
<ol>
<li>HTTP Cookie 的工作机制</li>
<li>浏览器上下文（Browser Context）对会话状态的封装方式</li>
<li>自动化框架对“会话导出 / 会话注入”的支持（<code>storageState</code> 机制）</li>
</ol>
<p>下面按这三个层次拆开说明。</p>
<h3 data-id="heading-3">3.1 HTTP Cookie 与会话状态</h3>
<p>在 Web 体系中，服务端识别一个“已登录用户”的典型方式是：</p>
<ol>
<li>用户在登录页面输入账号密码，发起登录请求；</li>
<li>服务端校验成功后，返回一个或多个包含会话信息的 <code>Set-Cookie</code> 响应头，例如：</li>
</ol>
<pre><code class="hljs language-http" lang="http">Set-Cookie: SESSION_ID=abcdef; Path=/; HttpOnly; Secure
</code></pre>
<ol start="3">
<li>浏览器将这些 Cookie 存入其 Cookie 存储中，并在后续访问同一域名（符合作用域和路径规则）时，自动携带这些 Cookie：</li>
</ol>
<pre><code class="hljs language-http" lang="http">Cookie: SESSION_ID=abcdef
</code></pre>
<ol start="4">
<li>服务端根据 Cookie 中的会话标识（如 <code>SESSION_ID</code>）从自身会话存储中查找用户身份与权限，从而判断请求来自哪个登录用户。</li>
</ol>
<p>因此，只要浏览器中持有与服务端会话对应的 Cookie 集合，并在后续请求中按同样的规则携带这些 Cookie，服务端就会认为这是同一个“已登录会话”。</p>
<h3 data-id="heading-4">3.2 浏览器上下文与会话隔离</h3>
<p>现代自动化框架（如 Playwright）抽象了一个“浏览器上下文”（Browser Context）的概念：</p>
<ul>
<li>每个上下文拥有独立的 Cookie 存储、本地存储、会话存储等；</li>
<li>同一浏览器实例下的多个上下文相互隔离，互不共享会话状态；</li>
<li>上下文可以看作一个轻量级的“浏览器用户配置路径”。</li>
</ul>
<p>以 Playwright 为例：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> browser = <span class="hljs-keyword">await</span> firefox.<span class="hljs-title function_">launch</span>();
<span class="hljs-keyword">const</span> contextA = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newContext</span>(); <span class="hljs-comment">// 上下文 A</span>
<span class="hljs-keyword">const</span> contextB = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newContext</span>(); <span class="hljs-comment">// 上下文 B</span>

<span class="hljs-comment">// A 中登录，不会影响 B</span>
</code></pre>
<p>这意味着：只要我们能把某一个上下文的 Cookie 和相关存储完整导出，并在未来用相同的结构去创建新上下文，就能“克隆”这个上下文的会话状态。</p>
<h3 data-id="heading-5">3.3 <code>storageState()</code>：会话导出的抽象</h3>
<p>自动化框架提供了一个关键 API，用于导出当前上下文的会话状态，例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> storageState = <span class="hljs-keyword">await</span> context.<span class="hljs-title function_">storageState</span>();
</code></pre>
<p>这个 <code>storageState</code> 通常包含如下信息：</p>
<ul>
<li>当前上下文中所有 Cookie（包含 name / value / domain / path / expires / secure / httpOnly 等字段）</li>
<li>按 origin 组织的 localStorage / sessionStorage 等数据</li>
<li>框架自身需要记录的与存储相关的元信息</li>
</ul>
<p>从数据结构上看，它只是一个普通的 JavaScript 对象，可以安全地序列化为 JSON 文件并持久化：</p>
<pre><code class="hljs language-javascript" lang="javascript">fs.<span class="hljs-title function_">writeFileSync</span>(<span class="hljs-string">"auth-state.json"</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(storageState, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>));
</code></pre>
<h3 data-id="heading-6">3.4 <code>newContext({ storageState })</code>：会话注入的抽象</h3>
<p>在另一个脚本（或同一脚本的后续阶段），框架支持通过 <code>storageState</code> 初始化新的上下文：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> restoredState = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">"auth-state.json"</span>, <span class="hljs-string">"utf-8"</span>));

<span class="hljs-keyword">const</span> context = <span class="hljs-keyword">await</span> browser.<span class="hljs-title function_">newContext</span>({
  <span class="hljs-attr">storageState</span>: restoredState,
});
</code></pre>
<p>本质上，这一步执行了两件事情：</p>
<ol>
<li>将 <code>restoredState.cookies</code> 写入新上下文的 Cookie 存储区；</li>
<li>将 <code>restoredState.origins</code> 对应的数据写入到各个 origin 的本地存储空间中。</li>
</ol>
<p>完成这一步之后，从新上下文发出的所有网络请求，将自动带上与原上下文完全一致的 Cookie 集合，因此在服务端看来：</p>
<ul>
<li>这就是一个已经登录过的浏览器实例；</li>
<li>只要服务端的会话未过期，所有需要登录态的接口都可以直接访问。</li>
</ul>
<h3 data-id="heading-7">3.5 为什么不需要在脚本中“模拟登录”</h3>
<p>由于浏览器上下文的会话状态是可序列化和可恢复的，认证采集脚本只需要在“已经登录成功”的时刻做一次导出即可。</p>
<p>从那一刻起：</p>
<ul>
<li>登录页面、登录表单、验证码、二次认证等流程全部被“折叠”进一次操作；</li>
<li>业务脚本无需再实现这段重复且高耦合的逻辑，只需要依赖认证文件即可。</li>
</ul>
<p>这在工程上带来的好处是非常明显的：</p>
<ul>
<li>登录流程的维护成本从“散落在每个脚本中”变为“集中在一个工具脚本中”；</li>
<li>自动化任务本身完全与认证细节解耦，职责清晰；</li>
<li>对于风控敏感系统，可以降低频繁模拟登录的触发风险。</li>
</ul>
<hr/>
<h2 data-id="heading-8">四、写在最后</h2>
<p>在此基础上，可以按需进一步扩展诸如多账号管理、有效期检测、安全加密等能力，但本质仍然基于同一技术原理：<strong>会话状态是可序列化、可持久化、可注入的新上下文的</strong>。</p>
<p>关注 <strong>【松哥AI自动化】</strong> 公众号，每周获取深度技术解析，从源码角度彻底理解各种工具的实现原理。更重要的是，遇到技术难题时，直接联系我！我会根据你的具体情况，提供最适合的解决方案和技术指导。</p>
<p>上期回顾：（<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqrIH4SkI6w8iZDEpZe8yRw" target="_blank" title="https://mp.weixin.qq.com/s/qrIH4SkI6w8iZDEpZe8yRw" ref="nofollow noopener noreferrer">我为什么认为未来的自动化应该是：人提需求，AI生成工作流，AI工具执行</a>）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS App进入后台时会发生什么]]></title>    <link>https://juejin.cn/post/7574614157955088418</link>    <guid>https://juejin.cn/post/7574614157955088418</guid>    <pubDate>2025-11-20T09:00:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574614157955088418" data-draft-id="7574614157955006498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS App进入后台时会发生什么"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2025-11-20T09:00:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="songgeb"/> <meta itemprop="url" content="https://juejin.cn/user/3122268752587006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS App进入后台时会发生什么
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3122268752587006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    songgeb
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T09:00:23.000Z" title="Thu Nov 20 2025 09:00:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>根据官方文档(<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fuikit%2Fextending-your-app-s-background-execution-time" target="_blank" title="https://developer.apple.com/documentation/uikit/extending-your-app-s-background-execution-time" ref="nofollow noopener noreferrer">Extending your app’s background execution time</a>和<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fuikit%2Fmanaging-your-app-s-life-cycle" target="_blank" title="https://developer.apple.com/documentation/uikit/managing-your-app-s-life-cycle" ref="nofollow noopener noreferrer">Managing your app’s life cycle</a>)显示</p>
<blockquote>
<p>文档查阅时间为2025-11-20</p>
</blockquote>
<ul>
<li>正常情况下，App先进入<code>Background</code>状态，紧接着（时间长短取决于是否通过<code>beginBackgroundTask</code>方法发起任务，但总体都很短）进入<code>Suspended</code></li>
<li>进入后台时<code>applicationDidEnterBackground</code>会执行，同时进入<code>Background</code>状态，该方法会有5s时间执行其中的任务</li>
<li><code>applicationDidEnterBackground</code>之后，如果没有<code>beginBackgroundTask</code>发起的后台任务，则很快就会进入<code>Suspended</code>状态</li>
<li>进入<code>Suspended</code>状态，App还会在内存中</li>
<li><code>Background</code>和<code>Suspended</code>状态的不同点是
<ul>
<li><code>Background</code>状态下，是可以执行短暂的后台任务</li>
<li><code>Suspended</code>状态下，App代码便不会再执行，收不到任何通知，而且系统可以根据（未其他App腾出内存空间）需要将App终止掉</li>
</ul>
</li>
<li>即使通过<code>beginBackgroundTask</code>开启后台任务也不过最多有30s的执行时间，仅适合执行一些非常重要的任务，比如将一些严重影响用户体验的数据写入磁盘，用作后续状态恢复</li>
<li>如果希望申请更多后台任务执行时间，则需要依赖<code>Background Tasks</code>框架</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cad98a74f3ff40d69fb528a1c0c035d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc29uZ2dlYg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764234023&amp;x-signature=hfYM%2F%2BU70HXFBlrlhbY8yQg7CKM%3D" alt="b0d3522d-c62b-49e2-9f48-01b0a4046b11.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter 3.38 版本更新：客户端开发者需要关注这三点？]]></title>    <link>https://juejin.cn/post/7574615024293117978</link>    <guid>https://juejin.cn/post/7574615024293117978</guid>    <pubDate>2025-11-20T09:01:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574615024293117978" data-draft-id="7574620713228927027" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter 3.38 版本更新：客户端开发者需要关注这三点？"/> <meta itemprop="keywords" content="Flutter,客户端"/> <meta itemprop="datePublished" content="2025-11-20T09:01:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员老刘"/> <meta itemprop="url" content="https://juejin.cn/user/662360127965769"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter 3.38 版本更新：客户端开发者需要关注这三点？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/662360127965769/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员老刘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T09:01:39.000Z" title="Thu Nov 20 2025 09:01:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>哈喽，我是老刘</strong></p>
<p>作为一个以Flutter为主要技术栈并且使用了差不多7年的开发者，其实老刘对Flutter版本更新的关注程度比很多人想象中要底很多。</p>
<p>本质上是因为在我的团队里对Flutter版本更新这件事会采用非常谨慎的策略。</p>
<p>我们的产品功能极少依赖最新版本的某个新组件，同时除非有非常严重的bug要解决，也不会急于升级到新版本。</p>
<p>但是Flutter 3.38版本我觉得各位开发者还是有必要关注一下的。</p>
<p>从Flutter本身的功能来看没有特别重大的更新，但是对于Android和iOS原生系统的要求来说，这个版本还是非常重要的。</p>
<hr/>
<h2 data-id="heading-0">要点解读</h2>
<h3 data-id="heading-1">一、Dart 语言更新：Dot shorthands 默认开启</h3>
<p>Dot shorthands 是 Dart 3.6 中引入的“点速记”语法，允许在枚举或静态常量上下文中省略前缀，仅写 <code>.xxx</code>，编译器自动补全类型。</p>
<ul>
<li>适用场景：枚举值、静态常量（如 <code>MainAxisAlignment.start</code> → <code>.start</code>）。</li>
<li>开启条件：Flutter 3.38 默认启用，无需额外配置。</li>
</ul>
<pre><code class="hljs language-Dart" lang="Dart"><span class="hljs-comment">// With shorthands</span>
Column(
  mainAxisAlignment: .start,
  crossAxisAlignment: .center,
  children: [ <span class="hljs-comment">/* ... */</span> ],
),

<span class="hljs-comment">// Without shorthands</span>
Column(
  mainAxisAlignment: MainAxisAlignment.start,
  crossAxisAlignment: CrossAxisAlignment.center,
  children: [ <span class="hljs-comment">/* … */</span> ],
),
</code></pre>
<p>最主要的作用是减少样板代码，提升可读性。</p>
<h3 data-id="heading-2">二、Web 开发增强</h3>
<ul>
<li>
<p>web_dev_config.yaml 配置开发服务器：</p>
<p>可设置 host/port/HTTPS 证书/headers，以及代理规则（将指定路径转发到后端）</p>
</li>
<li>
<p>Web 热重载增强：</p>
<ul>
<li>-d web-server 模式下默认开启 Web 热重载，并支持多个浏览器同时连接</li>
<li>可用 --no-web-experimental-hot-reload 暂时禁用（后续版本会移除该禁用选项）</li>
</ul>
</li>
</ul>
<p>Flutter最近几个小版本更新都在持续优化Web开发的部分，可见近期团队的重点一部分放在这里。</p>
<p>不过Flutter的web和常规的web开发两者应用场景还是有区别的，开发者做技术选型时一定要根据实际场景考虑。</p>
<h3 data-id="heading-3">三、Framework优化</h3>
<h4 data-id="heading-4">OverlayPortal 新能力</h4>
<p>可将子 Widget 渲染到任意 Overlay（如 root overlay），并通过 overlayChildLayoutBuilder 精细控制位置。</p>
<p>感觉适合弹窗、气泡、提示、对话框等复杂浮层的灵活布局。</p>
<h4 data-id="heading-5">Windows 桌面增强</h4>
<p>可访问已连接显示器列表（PlatformDispatcher.displays），查询分辨率、刷新率、设备像素比、物理尺寸等属性。</p>
<p>这次的桌面增强也属于是完善桌面的功能完备性的一个组成部分。</p>
<p>Flutter的桌面端多窗口还没有完整的实现，但是能看到各个细节在不停的补充进来。</p>
<p>对桌面端有需要的开发者目前仍然建议优先选择其它技术栈，但是可以持续关注Flutter的桌面端多窗口功能的进展。</p>
<h3 data-id="heading-6">四、其它更新</h3>
<p>Flutter 3.38 修复了 issue #173770：在 Android 端退出 Activity 销毁时出现的严重内存泄漏。该缺陷自 3.29.0 引入，影响所有 Flutter 应用。</p>
<hr/>
<h2 data-id="heading-7">升级提示</h2>
<p>Flutter 3.38 从功能上看没有特别重大的更新，但是对Android和iOS原生来说都有比较重要的 影响。</p>
<ul>
<li>
<p>Android：默认 NDK 版本升级为 r28，满足Google Play 16 KB 页面大小兼容性要求。</p>
</li>
<li>
<p>iOS：提供了对 UIScene 生命周期的支持。</p>
<p>老刘在文章结尾的官方链接部分也有给出UIScene 生命周期的官方迁移指南。</p>
</li>
</ul>
<p>因此，虽然从功能上看没有升级的必要，但是从原生的角度来说，确实是建议升级的。</p>
<p>根据我们一贯的升级核心原则：<strong>2~3个月观察期，别当小白鼠</strong></p>
<p>新版本发布后的前两三个月是“真人实验期”，严重问题通常在这段时间集中暴露。</p>
<p>等社区反馈、官方 issue 修复进度、第三方插件兼容性稳定后，再将其提升为主力版本。</p>
<p>老刘也会在每个月发布的《Flutter版本选择指南》中更新 Flutter 3.38 版本的最新情况。</p>
<p>历史链接：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FDsP4g_9HKAkOlfcyTGKmCw" target="_blank" title="https://mp.weixin.qq.com/s/DsP4g_9HKAkOlfcyTGKmCw" ref="nofollow noopener noreferrer">Flutter版本选择指南：避坑3.27，3.35基本稳定 | 2025年10月</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9JHDVD2wSVtXkv8UxUr-qg" target="_blank" title="https://mp.weixin.qq.com/s/9JHDVD2wSVtXkv8UxUr-qg" ref="nofollow noopener noreferrer">Flutter版本选择指南：避坑3.27 | 2025年9月</a></li>
</ul>
<hr/>
<h2 data-id="heading-8">总结</h2>
<p>Flutter 3.38 从功能本身来说并非“重大升级”，更像是常规迭代与体验优化（Web 开发流程、桌面细节、语法易用性）。</p>
<p>但是不管是Android端的16k页面大小兼容还是iOS端的UIScene生命周期迁移，都对客户端的开发有比较重要的影响。</p>
<p>因此建议将 3.38 设为候选版本，等待2–3 个月观察窗口。没有重大问题后再提升为日常主力版本。</p>
<h2 data-id="heading-9">官方链接</h2>
<ul>
<li>
<p>Release Notes（3.38.0）：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Frelease-notes%2Frelease-notes-3.38.0" target="_blank" title="https://docs.flutter.dev/release/release-notes/release-notes-3.38.0" ref="nofollow noopener noreferrer">docs.flutter.dev/release/rel…</a></p>
</blockquote>
<p>（官方版本更新内容与变更说明）［来源：Flutter Docs］</p>
</li>
<li>
<p>Breaking Changes &amp; Migration：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Fbreaking-changes" target="_blank" title="https://docs.flutter.dev/release/breaking-changes" ref="nofollow noopener noreferrer">docs.flutter.dev/release/bre…</a></p>
</blockquote>
</li>
</ul>
<p>（所有破坏性变更与迁移指南索引）［来源：Flutter Docs］</p>
<ul>
<li>UIScene 生命周期迁移（iOS 必读）：
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Fbreaking-changes%2Fuiscenedelegate" target="_blank" title="https://docs.flutter.dev/release/breaking-changes/uiscenedelegate" ref="nofollow noopener noreferrer">docs.flutter.dev/release/bre…</a></p>
</blockquote>
</li>
</ul>
<p>（苹果要求采用 UIScene 生命周期，需按此迁移）［来源：Flutter Docs］</p>
<ul>
<li>
<p>What's New（文档站新增内容）：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Fwhats-new" target="_blank" title="https://docs.flutter.dev/release/whats-new" ref="nofollow noopener noreferrer">docs.flutter.dev/release/wha…</a></p>
</blockquote>
</li>
</ul>
<p>（该页明确本次版本重点并指向相关指南）［来源：Flutter Docs］</p>
<ul>
<li>
<p>官方技术博客（3.38 总览）：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.flutter.dev%2Fwhats-new-in-flutter-3-38-3f7b258f7228" target="_blank" title="https://blog.flutter.dev/whats-new-in-flutter-3-38-3f7b258f7228" ref="nofollow noopener noreferrer">blog.flutter.dev/whats-new-i…</a></p>
</blockquote>
</li>
</ul>
<p>（本次版本的特性、工具链要求与已知问题）［来源：Flutter Blog］</p>
<blockquote>
<p>如果看到这里的同学对客户端或者Flutter开发感兴趣，欢迎联系老刘，我们互相学习。</p>
<p>私信免费领老刘整理的《Flutter开发手册》，覆盖90%应用开发场景。</p>
<p>可以作为Flutter学习的知识地图。</p>
<p>—— laoliu_dev</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何上架 App Store？从开发准备到构建上传的全流程技术指南]]></title>    <link>https://juejin.cn/post/7574584245152464947</link>    <guid>https://juejin.cn/post/7574584245152464947</guid>    <pubDate>2025-11-20T07:08:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574584245152464947" data-draft-id="7574625040659431474" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何上架 App Store？从开发准备到构建上传的全流程技术指南"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T07:08:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOS开发上架哦"/> <meta itemprop="url" content="https://juejin.cn/user/3336394949004844"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何上架 App Store？从开发准备到构建上传的全流程技术指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3336394949004844/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOS开发上架哦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:08:46.000Z" title="Thu Nov 20 2025 07:08:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>上架 App Store 对许多开发者来说并不是技术难点，而是流程复杂度带来的心理负担。
证书、IPA、截图、权限声明、审核问卷，每一项都可能成为绊脚石。</p>
<p>如果你正在寻找一份真正干净、能直接执行的“如何上架 App Store 的技术手册”，下面的内容能让整个流程从混乱变得可控。</p>
<p>本文从工程视角出发，拆分整个上架过程，覆盖准备、构建、上传、审核四类任务，让团队成员能清晰分工、减少返工、快速完成上架。</p>
<hr/>
<h2 data-id="heading-0"><strong>一、上架前的基础条件：哪些是非准备不可的？</strong></h2>
<p>上架 App Store 必须具备以下两个核心条件：</p>
<h3 data-id="heading-1"><strong>1. Apple Developer Program（付费开发者账号）</strong></h3>
<ul>
<li>年费 99 美元</li>
<li>支持创建证书、描述文件</li>
<li>可进入 App Store Connect 管理应用
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a1531a158d04e2fadc2ec8f6d1d0d38~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T5byA5Y-R5LiK5p625ZOm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227326&amp;x-signature=rc1LApvV1njbuvelIq06UBulxf8%3D" alt="账号" loading="lazy"/></li>
</ul>
<h3 data-id="heading-2"><strong>2. App Store Connect 创建应用项目</strong></h3>
<p>在浏览器中创建以下信息：</p>
<ul>
<li>App 名称</li>
<li>主要语言</li>
<li>Bundle ID</li>
<li>应用类别</li>
<li>SKU（内部编号）</li>
</ul>
<p>这是整个上架流程的入口。</p>
<hr/>
<h2 data-id="heading-3"><strong>二、构建前的技术准备：证书、描述文件与权限信息</strong></h2>
<p>技术人员需要准备三项核心内容：</p>
<h3 data-id="heading-4"><strong>（1）App ID（Bundle ID）</strong></h3>
<p>格式：<code>com.company.appname</code></p>
<h3 data-id="heading-5"><strong>（2）发布证书（Distribution Certificate）</strong></h3>
<p>用于给 App Store 版本 IPA 签名。</p>
<h3 data-id="heading-6"><strong>（3）App Store 描述文件（Provisioning Profile）</strong></h3>
<p>包含 App ID + 证书信息。</p>
<p>这三项必须对应，否则 IPA 无法上传。</p>
<h3 data-id="heading-7"><strong>如何获得证书？</strong></h3>
<p>如果你在 macOS 上，可以通过 Xcode 或钥匙串助手生成。
但如果你的团队使用 Windows 或 Linux，可以使用开心上架（Appuploader）跨平台生成方式：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bb6f805d1c64bcf91b70d71c80b3526~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T5byA5Y-R5LiK5p625ZOm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227326&amp;x-signature=%2BznrVuQrY7GFV8e5HCJc3ZbRZMQ%3D" alt="证书" loading="lazy"/></p>
<p>输出的证书可以在多个电脑共享，实现团队协作。</p>
<hr/>
<h2 data-id="heading-8"><strong>三、构建 IPA：不同技术栈、不同构建路径</strong></h2>
<p>要上架 App Store，必须准备 IPA 包。不同开发方式构建方式如下：</p>
<h3 data-id="heading-9"><strong>1. 原生 iOS（Swift / Objective-C）</strong></h3>
<ul>
<li>只能使用 Xcode → Archive → Export</li>
<li>必须在 macOS 上执行
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ce3552d49b7420c973c1c8cf2cefbbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T5byA5Y-R5LiK5p625ZOm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227326&amp;x-signature=ip7t5Ddf1awIAnNp%2FsKA4m5uXBk%3D" alt="xcode打包" loading="lazy"/></li>
</ul>
<h3 data-id="heading-10"><strong>2. uni-app / HBuilderX</strong></h3>
<ul>
<li>使用云打包生成 IPA</li>
<li>不依赖本地 Mac，是 Windows 团队常用方式</li>
</ul>
<h3 data-id="heading-11"><strong>3. Flutter</strong></h3>
<p>常见构建方案：</p>
<ul>
<li>Codemagic</li>
<li>Bitrise</li>
<li>GitHub Actions（Mac Runner）</li>
</ul>
<h3 data-id="heading-12"><strong>4. React Native / Ionic / Capacitor</strong></h3>
<p>可使用对应的云构建服务或 CI。</p>
<p>构建成功后会得到一个经过签名的 IPA 文件，即可进入“上传阶段”。</p>
<hr/>
<h2 data-id="heading-13"><strong>四、如何把 IPA 上传到 App Store？（关键步骤）</strong></h2>
<p>这一步是整个上架流程中最直接影响结果的步骤。</p>
<h3 data-id="heading-14"><strong>官方方式（仅 macOS）</strong></h3>





















<table><thead><tr><th>工具</th><th>说明</th></tr></thead><tbody><tr><td>Xcode Organizer</td><td>能上传构建</td></tr><tr><td>Transporter</td><td>支持拖拽上传 IPA</td></tr><tr><td>altool</td><td>已弃用</td></tr></tbody></table>
<p>如果团队中有人拥有 Mac，可以使用这些方式。</p>
<hr/>
<h3 data-id="heading-15"><strong>开心上架（Appuploader）跨平台上传（Windows / Linux / macOS 全系统通用）</strong></h3>
<p>这是许多团队的主要解决方案，尤其是跨平台项目。</p>
<p>示例命令：</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u ios@team.com -p xxx-xxx-xxx-xxx -c 2 -f ./dist/app.ipa
</code></pre>
<p>参数含义：</p>

























<table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>-u</td><td>Apple ID</td></tr><tr><td>-p</td><td>App 专用密码（非登陆密码）</td></tr><tr><td>-c</td><td>上传通道（2 = 新协议）</td></tr><tr><td>-f</td><td>指定 IPA 文件路径</td></tr></tbody></table>
<p>上传成功后，构建会出现在：</p>
<ul>
<li><strong>TestFlight（供测试人员下载）</strong></li>
<li><strong>App Store Connect → 构建版本列表</strong></li>
</ul>
<p>跨平台上传适合：</p>
<ul>
<li>无 Mac 环境的团队</li>
<li>自动化发布</li>
<li>CI/CD 流程集成</li>
<li>多地协作团队</li>
</ul>
<p>图像化管理界面：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41d1947cae8c4047b765d00fc01ccd26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T5byA5Y-R5LiK5p625ZOm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227326&amp;x-signature=xtMxbohi0elFvDrhJAX0F8joZ24%3D" alt="ipa上传" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-16"><strong>五、如何填写 App Store Connect 信息？（非技术但必须完善）</strong></h2>
<p>上传后，还需要配置 App 信息，否则无法提交审核。</p>
<p>包括：</p>
<h3 data-id="heading-17"><strong>（1）截图（必须项）</strong></h3>
<p>每个版本必须上传：</p>
<ul>
<li>iPhone 6.5 英寸</li>
<li>iPhone 5.5 英寸</li>
<li>若支持 iPad，需要 iPad 12.9 / 10.5 截图</li>
</ul>
<p>截图必须是真实界面，不允许生成式或手机壳模板。</p>
<h3 data-id="heading-18"><strong>（2）应用信息</strong></h3>
<p>包括：</p>
<ul>
<li>简介</li>
<li>详细描述</li>
<li>关键词</li>
<li>支持 URL</li>
<li>隐私政策 URL</li>
</ul>
<h3 data-id="heading-19"><strong>（3）权限用途说明</strong></h3>
<p>所有需要权限的功能必须在 Info.plist 中说明原因，例如：</p>
<ul>
<li>相机</li>
<li>麦克风</li>
<li>相册</li>
<li>定位</li>
</ul>
<p>缺失任何一项都可能被拒审。</p>
<hr/>
<h2 data-id="heading-20"><strong>六、提交审核前的关键检查（减少被拒几率）</strong></h2>
<p>为了避免“反复被拒”，提交审核前建议检查：</p>
<h3 data-id="heading-21"><strong>1. App 真机是否闪退？</strong></h3>
<p>冷启动必须稳定。</p>
<h3 data-id="heading-22"><strong>2. 权限是否全部有用途说明？</strong></h3>
<p>缺一项都会被拒绝。</p>
<h3 data-id="heading-23"><strong>3. 登录流程是否顺畅？</strong></h3>
<p>审核会真实操作 App。</p>
<h3 data-id="heading-24"><strong>4. 是否存在类似网页支付的违规行为？</strong></h3>
<p>苹果对支付机制非常敏感。</p>
<h3 data-id="heading-25"><strong>5. 截图是否真实？</strong></h3>
<p>虚假截图是常见拒审理由。</p>
<p>只要做到这些，审核通常比较顺利。</p>
<hr/>
<h2 data-id="heading-26"><strong>七、审核通过后：选择发布时间</strong></h2>
<p>苹果审核通过后，你可以选择：</p>
<ul>
<li><strong>立即发布</strong></li>
<li><strong>指定时间发布</strong></li>
<li><strong>手动发布</strong></li>
</ul>
<p>而如果你事先启用了 TestFlight，可以让 QA 或测试用户提前体验。</p>
<hr/>
<h2 data-id="heading-27"><strong>如何上架 App Store，其实是“流程工程”</strong></h2>
<p>从技术链路来看，上架流程可以归纳为三类准备：</p>
<h3 data-id="heading-28"><strong>1. 身份类准备（账号 + 证书）</strong></h3>
<p>确保你的 App 能被苹果识别。</p>
<h3 data-id="heading-29"><strong>2. 应用类准备（IPA + 签名）</strong></h3>
<p>确保应用能上传、能运行、能被测试。</p>
<h3 data-id="heading-30"><strong>3. 内容类准备（截图 + 信息 + 权限）</strong></h3>
<p>确保审核顺利通过。</p>
<p>一旦你把这三类内容系统化管理，上架 App Store 就不再是一件麻烦事，而是一套可以复用的工程流程。
上架参考链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.applicationloader.net%2Ftutorial%2Fzh%2F1%2F1.html" target="_blank" title="https://www.applicationloader.net/tutorial/zh/1/1.html" ref="nofollow noopener noreferrer">www.applicationloader.net/tutorial/zh…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RevenueCat 接入 Google Play 订阅全流程详解（2025 最新）]]></title>    <link>https://juejin.cn/post/7574382900860633115</link>    <guid>https://juejin.cn/post/7574382900860633115</guid>    <pubDate>2025-11-20T07:10:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574382900860633115" data-draft-id="7574615024292216858" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RevenueCat 接入 Google Play 订阅全流程详解（2025 最新）"/> <meta itemprop="keywords" content="Android,Flutter,Google"/> <meta itemprop="datePublished" content="2025-11-20T07:10:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HBLOG"/> <meta itemprop="url" content="https://juejin.cn/user/131597124767479"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RevenueCat 接入 Google Play 订阅全流程详解（2025 最新）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/131597124767479/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HBLOG
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:10:15.000Z" title="Thu Nov 20 2025 07:10:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fimage-16.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/image-16.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc00ada7291a4b41b7733abd66d1271d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=VEIk8W%2FcimoofjrWPgJqVMJQxnc%3D" alt="" loading="lazy"/></a></p>
<p>在移动应用的订阅变现方案中，<strong>RevenueCat</strong> 已经成为开发者最常用的后台服务之一。它帮我们解决了：</p>
<ul>
<li>Google/Apple 订阅验证</li>
<li>用户权益统一管理</li>
<li>Webhook &amp; 分析</li>
<li>价格、Offer、订阅组管理</li>
<li>跨平台（iOS + Android）统一 SDK</li>
</ul>
<p>本文将从零开始，带你完成 <strong>Google Play + RevenueCat</strong> 的完整接入流程，避免你踩坑。</p>
<h2 data-id="heading-0">一、准备工作</h2>
<p>在开始前，你需要准备以下内容：</p>
<p>项目</p>
<p>描述</p>
<p>Google Play Console 开发者账号</p>
<p>已完成注册、缴费</p>
<p>已上传至少一个 build（内部测试也行）</p>
<p>才能启用应用产品区</p>
<p>RevenueCat 账号</p>
<p>免费版即可</p>
<p>Google Cloud Platform (GCP) 账号</p>
<p>用于生成 Service Account JSON</p>
<p>App 内已准备订阅 UI</p>
<p>可后续接 RevenueCat SDK</p>
<h2 data-id="heading-1">二、在 Google Play Console 创建订阅产品</h2>
<p>注意：Google Play 必须先上传一个 APK/AAB 后，才会解锁订阅页面。</p>
<h3 data-id="heading-2">1. 进入订阅页面</h3>
<p>路径：</p>
<pre><code class="hljs language-csharp" lang="csharp">Monetize <span class="hljs-keyword">with</span> play → Products → Subscriptions
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2F248462e4-54a3-4e62-a11a-9589e543a0c3.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/248462e4-54a3-4e62-a11a-9589e543a0c3.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f52ffd5a74b343f1a7aee3675f6c3841~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=iBhm3DooUiF5f5NOVcIuYGZf6MI%3D" alt="" loading="lazy"/></a></p>
<p>如果你第一次使用，会看到：</p>
<blockquote>
<p>“Your app doesn’t have any subscriptions yet”</p>
</blockquote>
<p>点击 <strong>Create subscription</strong>。</p>
<h3 data-id="heading-3">2. 创建订阅产品</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fimage-11.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/image-11.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fae4cfaeb44744f6bc38783692b6c04d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=BlPhxxH7w7%2FRfSMu%2FAvIWrv7V3U%3D" alt="" loading="lazy"/></a></p>
<p>推荐格式：</p>
<p>项目</p>
<p>示例</p>
<p><strong>Product ID</strong></p>
<p>linguadiary_monthly_1</p>
<p><strong>Base Plan ID</strong></p>
<p>monthly</p>
<p><strong>Duration</strong></p>
<p>P1M（一个月）</p>
<p><strong>Price</strong></p>
<p>$4.99（示例）</p>
<p>再创建一个年订阅：</p>
<p>项目</p>
<p>示例</p>
<p><strong>Product ID</strong></p>
<p>linguadiary_yearly_12</p>
<p><strong>Base Plan ID</strong></p>
<p>yearly</p>
<p><strong>Duration</strong></p>
<p>P1Y（1年）</p>
<h3 data-id="heading-4">3. 添加税务 &amp; 国家分发</h3>
<p>必要，不然订阅无法售卖。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fimage-12.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/image-12.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/520d8ffb521942689efbaf671ad17671~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=0YCehc6dmfj1KxM8%2B31EK%2F13OxQ%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-5">三、在 Google Cloud Platform 生成 Service Account JSON（最关键）</h2>
<p>这是 RevenueCat 用来验证 Google Play 订阅的关键文件。</p>
<h3 data-id="heading-6">1. 进入 GCP 控制台</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fconsole.cloud.google.com%2F" target="_blank" title="https://console.cloud.google.com/" ref="nofollow noopener noreferrer">console.cloud.google.com</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fb0dff8b7-23a8-405a-b3ae-0b8edf360fda.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/b0dff8b7-23a8-405a-b3ae-0b8edf360fda.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e1dbbe3df94452bac01b505926462ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=LGCVVMAnoK2vyJ7vRJaaKK3dipk%3D" alt="" loading="lazy"/></a></p>
<h3 data-id="heading-7">2. 确保与 Google Play 绑定同一个项目</h3>
<p>Play Console 的 <strong>API access</strong> 会告诉你当前使用的 “GCP 项目”。</p>
<p>进入同名项目即可。</p>
<h3 data-id="heading-8">3. 创建 Service Account</h3>
<p>路径：</p>
<pre><code class="hljs language-sql" lang="sql">IAM <span class="hljs-operator">&amp;</span> Admin → Service Accounts → <span class="hljs-keyword">Create</span> Service Account
</code></pre>
<p>填写：</p>
<ul>
<li>名称：revenuecat-play-service</li>
<li>Role（权限）：必须勾选 <strong>Service Account Admin</strong> + <strong>Pub/Sub Admin</strong></li>
</ul>
<p>👉 缺权限会导致错误：<br/>
<strong>Your Google service account credentials do not have permissions to access the Google Cloud Pub/Sub API</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fbd5c3b9f-67fc-43ce-9982-103d422cdf5c.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/bd5c3b9f-67fc-43ce-9982-103d422cdf5c.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dac0f1a0d24f4d60a00d86c7ef1e3371~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=4lZC8CO%2BQ0ws7d8jfDXAzzNYna8%3D" alt="" loading="lazy"/></a></p>
<h3 data-id="heading-9">4. 创建 JSON 密钥并下载</h3>
<p>在 Service Account → Keys → Add Key → <strong>JSON</strong></p>
<p>会下载一个：</p>
<pre><code class="hljs">xxxx-revenuecat.json
</code></pre>
<p>这是要上传到 RevenueCat 的。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2F5d72fdfa-fa15-4128-9e63-fbd4fca3db56.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/5d72fdfa-fa15-4128-9e63-fbd4fca3db56.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7ad0e797fdae43fc81a82a9ef6f72f79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=nQEvijjBnJuGZpNFiNg%2BCJKce8k%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-10">四、在 Google Play Console 授权这个 Service Account</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fb2262bc3-2b1b-4e24-9930-f89a83a0ef69.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/b2262bc3-2b1b-4e24-9930-f89a83a0ef69.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/941ad2bfff054eeeb8d069cb7201b18c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=wmhRnBL0u8muGYmVqwAEHzzpEy8%3D" alt="" loading="lazy"/></a></p>
<h2 data-id="heading-11">五、在 RevenueCat 绑定 Google Play</h2>
<p>进入：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fimage-13.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/image-13.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd5ed67bbbfa4f2184e04a9e4c0fde04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=3rxJt4NFI2%2B5u8p13rcogfBfgy4%3D" alt="" loading="lazy"/></a></p>
<pre><code class="hljs">RevenueCat → Projects → Apps → （你的 Android App）
</code></pre>
<p>选择：</p>
<h4 data-id="heading-12">1. Add Store → Google Play</h4>
<p>上传你刚才下载的 JSON。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fe2213ad5-6ea8-4e64-8459-07beceff83fa.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/e2213ad5-6ea8-4e64-8459-07beceff83fa.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6cca80b67ccc465db014919644bcb424~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=moMYgiSxQdigNV88786c8r%2Blt2A%3D" alt="" loading="lazy"/></a></p>
<h4 data-id="heading-13">2. 在 RevenueCat 创建产品</h4>
<p>路径：</p>
<pre><code class="hljs language-sql" lang="sql">Products → <span class="hljs-keyword">New</span> Product
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2F80912ef5-a22a-4192-b44c-9cd5165ca4d6.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/80912ef5-a22a-4192-b44c-9cd5165ca4d6.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce8e4fa051c24ee4a034ecacee4b6b81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=xaLuQbNWJNxkHFXJSaN2F6%2FommI%3D" alt="" loading="lazy"/></a></p>
<p>填写：</p>
<ul>
<li>Product ID（必须与 Google Play 完全一致）</li>
<li>Offering（可添加 default）</li>
</ul>
<p>RevenueCat 会自动同步 Google Play 价格、时长、Offer。</p>
<h2 data-id="heading-14">六、在 App 内实现 RevenueCat SDK（Flutter 示例）</h2>
<pre><code class="hljs language-ini" lang="ini">import 'package:purchases_flutter/purchases_flutter.dart'<span class="hljs-comment">;</span>

void main() async {
  await Purchases.configure(PurchasesConfiguration(
    "public_sdk_key_google",
  ))<span class="hljs-comment">;</span>
}

// 获取订阅产品
final <span class="hljs-attr">offerings</span> = await Purchases.get<span class="hljs-literal">Off</span>erings()<span class="hljs-comment">;</span>
final <span class="hljs-attr">package</span> = <span class="hljs-literal">off</span>erings.current?.availablePackages.first<span class="hljs-comment">;</span>

// 购买
await Purchases.purchasePackage(package)<span class="hljs-comment">;</span>

// 查询是否是 Pro
final <span class="hljs-attr">info</span> = await Purchases.getCustomerInfo()<span class="hljs-comment">;</span>
final <span class="hljs-attr">isPro</span> = info.entitlements.all[<span class="hljs-string">"pro"</span>]?.isActive ?? <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-15">七、常见问题（踩坑大全）</h2>
<h3 data-id="heading-16">1. RevenueCat 报错：CONFIGURATION_ERROR</h3>
<p>原因：</p>
<ul>
<li>Google Play 本地化语言没填</li>
<li>Base Plan 没启用</li>
<li>未发布</li>
<li>Service Account 权限不够</li>
<li>Google Play 未启用 API access 授权</li>
<li>Google Cloud Pub/Sub 未开</li>
</ul>
<h3 data-id="heading-17">2. 看到 These products are not found</h3>
<p>原因：</p>
<ul>
<li>Product ID 不一致（大小写不一致都不行）</li>
<li>Google Play 未发布（Draft 状态）</li>
<li>未勾选国家/地区</li>
<li>Base Plan 没启用（must be Active）</li>
</ul>
<p>所有东西都准备好了，结果还是查不出来产品，一定进去这个菜单开启bill</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fadmin.liuhaihua.cn%2Fwp-content%2Fuploads%2F2025%2F11%2Fimage-14.png" target="_blank" title="https://admin.liuhaihua.cn/wp-content/uploads/2025/11/image-14.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37d2ebc013ab42ed8165437eee565a90~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSEJMT0c=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227415&amp;x-signature=70XCAIj8EpfZGkJiJT%2F4H6ouotA%3D" alt="" loading="lazy"/></a></p>
<h3 data-id="heading-18">3. SDK 一直加载不到 Offerings</h3>
<p>原因：</p>
<ul>
<li>RevenueCat 未成功读取 Google Play</li>
<li>服务账号 JSON 权限不足</li>
<li>App 没有开网络</li>
</ul>
<h2 data-id="heading-19">八、测试订阅（免费）</h2>
<ol>
<li>在 Google Play → License Testing 添加 Gmail 测试账户</li>
<li>删掉 app</li>
<li>登录测试 Gmail</li>
<li>从 Closed Testing 下载你 app</li>
<li>购买会显示价格 0 或 $0.01</li>
</ol>
<h2 data-id="heading-20">九、发布正式版本</h2>
<p>当订阅正常工作 →<br/>
发布 app →<br/>
RevenueCat 负责自动验证所有付款 →<br/>
你只专注展示订阅 UI 和权益即可。</p>
<h2 data-id="heading-21">结语</h2>
<p>接入 Google Play 的订阅最容易踩坑在：</p>
<ul>
<li>API access 权限不完整</li>
<li>Service Account JSON 权限缺失</li>
<li>Google Play 本地化没填</li>
<li>Base plan 未激活</li>
<li>RevenueCat 未正确绑定应用</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeScript 高级特性详解]]></title>    <link>https://juejin.cn/post/7574530224852713478</link>    <guid>https://juejin.cn/post/7574530224852713478</guid>    <pubDate>2025-11-20T06:44:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574530224852713478" data-draft-id="7574530224852697094" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeScript 高级特性详解"/> <meta itemprop="keywords" content="前端,TypeScript"/> <meta itemprop="datePublished" content="2025-11-20T06:44:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小前端_我自坚强"/> <meta itemprop="url" content="https://juejin.cn/user/2335811609826423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeScript 高级特性详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2335811609826423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小前端_我自坚强
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T06:44:25.000Z" title="Thu Nov 20 2025 06:44:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TypeScript 高级特性详解</h2>
<h3 data-id="heading-1">引言</h3>
<p>TypeScript 是 JavaScript 的超集，为 JavaScript 添加了静态类型检查和面向对象编程的能力。随着前端应用日益复杂，TypeScript 的高级特性变得越来越重要。本文将深入探讨 TypeScript 的几个核心高级特性，帮助开发者更好地理解和运用这些强大功能。</p>
<h3 data-id="heading-2">一、泛型编程(Generic Programming)</h3>
<h4 data-id="heading-3">1.1 泛型基础概念</h4>
<p>泛型(Generic)是 TypeScript 中最强大的特性之一，它允许我们创建可重用的组件，这些组件可以处理不同类型的数据而不丢失类型安全性。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 基础泛型函数</span>
<span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">arg</span>: T): T {
    <span class="hljs-keyword">return</span> arg;
}

<span class="hljs-comment">// 使用泛型函数</span>
<span class="hljs-keyword">let</span> output1 = identity&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"myString"</span>);
<span class="hljs-keyword">let</span> output2 = identity&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">42</span>);
<span class="hljs-keyword">let</span> output3 = <span class="hljs-title function_">identity</span>(<span class="hljs-string">"myString"</span>); <span class="hljs-comment">// 类型推断</span>
</code></pre>
<h4 data-id="heading-4">1.2 泛型约束</h4>
<p>有时候我们需要对泛型参数施加一定的约束，确保传入的类型具有某些特定的属性或方法。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义约束接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Lengthwise</span> {
    <span class="hljs-attr">length</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// 使用 extends 关键字添加约束</span>
<span class="hljs-keyword">function</span> loggingIdentity&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Lengthwise</span>&gt;(<span class="hljs-attr">arg</span>: T): T {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(arg.<span class="hljs-property">length</span>); <span class="hljs-comment">// 现在我们知道它有 .length 属性</span>
    <span class="hljs-keyword">return</span> arg;
}

<span class="hljs-title function_">loggingIdentity</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// 正确，字符串有 length 属性</span>
<span class="hljs-title function_">loggingIdentity</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]); <span class="hljs-comment">// 正确，数组有 length 属性</span>
<span class="hljs-comment">// loggingIdentity(3); // 错误，数字没有 length 属性</span>
</code></pre>
<h4 data-id="heading-5">1.3 泛型类</h4>
<p>泛型也可以应用于类，使类能够处理多种类型的值。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GenericNumber</span>&lt;T&gt; {
    <span class="hljs-attr">zeroValue</span>: T;
    <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params">x: T, y: T</span>) =&gt;</span> T;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">zeroValue: T, addFn: (x: T, y: T) =&gt; T</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">zeroValue</span> = zeroValue;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">add</span> = addFn;
    }
}

<span class="hljs-keyword">let</span> myGenericNumber = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericNumber</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>, <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> x + y);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(myGenericNumber.<span class="hljs-title function_">add</span>(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>)); <span class="hljs-comment">// 15</span>

<span class="hljs-keyword">let</span> stringNumeric = <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericNumber</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">""</span>, <span class="hljs-function">(<span class="hljs-params">x, y</span>) =&gt;</span> x + y);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(stringNumeric.<span class="hljs-title function_">add</span>(<span class="hljs-string">"hello"</span>, <span class="hljs-string">"world"</span>)); <span class="hljs-comment">// "helloworld"</span>
</code></pre>
<h4 data-id="heading-6">1.4 泛型接口</h4>
<p>泛型接口可以描述那些跨越多种类型的通用调用签名。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">GenericIdentityFn</span>&lt;T&gt; {
    (<span class="hljs-attr">arg</span>: T): T;
}

<span class="hljs-keyword">function</span> identity&lt;T&gt;(<span class="hljs-attr">arg</span>: T): T {
    <span class="hljs-keyword">return</span> arg;
}

<span class="hljs-keyword">let</span> <span class="hljs-attr">myIdentity</span>: <span class="hljs-title class_">GenericIdentityFn</span>&lt;<span class="hljs-built_in">number</span>&gt; = identity;
</code></pre>
<h4 data-id="heading-7">1.5 多个泛型参数</h4>
<p>函数和类可以接受多个泛型参数，提供更多灵活性。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> swap&lt;T, U&gt;(<span class="hljs-attr">tuple</span>: [T, U]): [U, T] {
    <span class="hljs-keyword">return</span> [tuple[<span class="hljs-number">1</span>], tuple[<span class="hljs-number">0</span>]];
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">swap</span>([<span class="hljs-string">"hello"</span>, <span class="hljs-number">123</span>])); <span class="hljs-comment">// [123, "hello"]</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyValuePair</span>&lt;<span class="hljs-title class_">TKey</span>, <span class="hljs-title class_">TValue</span>&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">key</span>: <span class="hljs-title class_">TKey</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-attr">value</span>: <span class="hljs-title class_">TValue</span>;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">key: TKey, value: TValue</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span> = key;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
    }
    
    <span class="hljs-title function_">getKey</span>(): <span class="hljs-title class_">TKey</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">key</span>;
    }
    
    <span class="hljs-title function_">getValue</span>(): <span class="hljs-title class_">TValue</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;
    }
}
</code></pre>
<h4 data-id="heading-8">1.6 泛型参数默认值</h4>
<p>TypeScript 允许为泛型参数指定默认类型。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultGeneric</span>&lt;T = <span class="hljs-built_in">string</span>&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">value</span>: T;
    
    <span class="hljs-title function_">setValue</span>(<span class="hljs-params">value: T</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;
    }
    
    <span class="hljs-title function_">getValue</span>(): T {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;
    }
}

<span class="hljs-keyword">let</span> defaultGeneric = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultGeneric</span>(); <span class="hljs-comment">// T 默认为 string</span>
<span class="hljs-keyword">let</span> explicitGeneric = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultGeneric</span>&lt;<span class="hljs-built_in">number</span>&gt;(); <span class="hljs-comment">// 显式指定 T 为 number</span>
</code></pre>
<h4 data-id="heading-9">1.7 泛型条件约束</h4>
<p>结合条件类型，我们可以创建更加灵活的泛型约束。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 只有当 T 是 string 或 number 时才允许</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">StringOrNumberOnly</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> ? T : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">function</span> processValue&lt;T&gt;(<span class="hljs-attr">value</span>: <span class="hljs-title class_">StringOrNumberOnly</span>&lt;T&gt;): <span class="hljs-title class_">StringOrNumberOnly</span>&lt;T&gt; {
    <span class="hljs-keyword">return</span> value;
}

<span class="hljs-title function_">processValue</span>(<span class="hljs-string">"hello"</span>); <span class="hljs-comment">// OK</span>
<span class="hljs-title function_">processValue</span>(<span class="hljs-number">42</span>); <span class="hljs-comment">// OK</span>
<span class="hljs-comment">// processValue(true); // Error: Type 'boolean' does not satisfy the constraint 'never'</span>
</code></pre>
<h3 data-id="heading-10">二、条件类型和映射类型</h3>
<h4 data-id="heading-11">2.1 条件类型基础</h4>
<p>条件类型允许我们在类型层面进行条件判断，这是 TypeScript 类型系统的强大功能。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 基本条件类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">IsString</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-built_in">string</span> ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;

<span class="hljs-keyword">type</span> A = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// true</span>
<span class="hljs-keyword">type</span> B = <span class="hljs-title class_">IsString</span>&lt;<span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// false</span>

<span class="hljs-comment">// 更实用的例子</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">MessageOf</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> { <span class="hljs-attr">message</span>: <span class="hljs-built_in">unknown</span> } ? T[<span class="hljs-string">'message'</span>] : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Email</span> {
    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Dog</span> {
    <span class="hljs-title function_">bark</span>(): <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">EmailMessageContents</span> = <span class="hljs-title class_">MessageOf</span>&lt;<span class="hljs-title class_">Email</span>&gt;; <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DogMessageContents</span> = <span class="hljs-title class_">MessageOf</span>&lt;<span class="hljs-title class_">Dog</span>&gt;; <span class="hljs-comment">// never</span>
</code></pre>
<h4 data-id="heading-12">2.2 分配条件类型</h4>
<p>当条件类型的检查类型是裸类型参数(naked type parameter)时，它会在联合类型上进行分配。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">ToArray</span>&lt;<span class="hljs-title class_">Type</span>&gt; = <span class="hljs-title class_">Type</span> <span class="hljs-keyword">extends</span> <span class="hljs-built_in">any</span> ? <span class="hljs-title class_">Type</span>[] : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">StrArrOrNumArr</span> = <span class="hljs-title class_">ToArray</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// string[] | number[]</span>

<span class="hljs-comment">// 如果想阻止这种行为，可以用方括号包裹类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ToArrayNonDist</span>&lt;<span class="hljs-title class_">Type</span>&gt; = [<span class="hljs-title class_">Type</span>] <span class="hljs-keyword">extends</span> [<span class="hljs-built_in">any</span>] ? <span class="hljs-title class_">Type</span>[] : <span class="hljs-built_in">never</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">StrArrOrNumArr2</span> = <span class="hljs-title class_">ToArrayNonDist</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// (string | number)[]</span>
</code></pre>
<h4 data-id="heading-13">2.3 infer 关键字</h4>
<p>infer 关键字允许我们在条件类型中推断类型变量。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 推断函数返回类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ReturnType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (...<span class="hljs-attr">args</span>: <span class="hljs-built_in">any</span>[]) =&gt; infer R ? R : <span class="hljs-built_in">any</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Func</span> = <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">number</span>;
<span class="hljs-keyword">type</span> <span class="hljs-title class_">Result</span> = <span class="hljs-title class_">ReturnType</span>&lt;<span class="hljs-title class_">Func</span>&gt;; <span class="hljs-comment">// number</span>

<span class="hljs-comment">// 推断数组元素类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ElementType</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> (infer U)[] ? U : T;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Arr</span> = <span class="hljs-title class_">ElementType</span>&lt;<span class="hljs-built_in">string</span>[]&gt;; <span class="hljs-comment">// string</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">NotArr</span> = <span class="hljs-title class_">ElementType</span>&lt;<span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// string</span>

<span class="hljs-comment">// 推断 Promise 的值类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">UnwrapPromise</span>&lt;T&gt; = T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Promise</span>&lt;infer U&gt; ? U : T;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PromiseValue</span> = <span class="hljs-title class_">UnwrapPromise</span>&lt;<span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt;; <span class="hljs-comment">// string</span>
</code></pre>
<h4 data-id="heading-14">2.4 预定义的条件类型</h4>
<p>TypeScript 内置了一些有用的条件类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// Exclude&lt;UnionType, ExcludedMembers&gt; - 从联合类型中排除某些成员</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T0</span> = <span class="hljs-title class_">Exclude</span>&lt;<span class="hljs-string">"a"</span> | <span class="hljs-string">"b"</span> | <span class="hljs-string">"c"</span>, <span class="hljs-string">"a"</span>&gt;; <span class="hljs-comment">// "b" | "c"</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T1</span> = <span class="hljs-title class_">Exclude</span>&lt;<span class="hljs-string">"a"</span> | <span class="hljs-string">"b"</span> | <span class="hljs-string">"c"</span>, <span class="hljs-string">"a"</span> | <span class="hljs-string">"b"</span>&gt;; <span class="hljs-comment">// "c"</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T2</span> = <span class="hljs-title class_">Exclude</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | (<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>), <span class="hljs-title class_">Function</span>&gt;; <span class="hljs-comment">// string | number</span>

<span class="hljs-comment">// Extract&lt;Type, Union&gt; - 从联合类型中提取某些成员</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T3</span> = <span class="hljs-title class_">Extract</span>&lt;<span class="hljs-string">"a"</span> | <span class="hljs-string">"b"</span> | <span class="hljs-string">"c"</span>, <span class="hljs-string">"a"</span> | <span class="hljs-string">"f"</span>&gt;; <span class="hljs-comment">// "a"</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T4</span> = <span class="hljs-title class_">Extract</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-built_in">boolean</span>, <span class="hljs-built_in">boolean</span> | <span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// number | boolean</span>

<span class="hljs-comment">// NonNullable&lt;Type&gt; - 从类型中排除 null 和 undefined</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T5</span> = <span class="hljs-title class_">NonNullable</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>&gt;; <span class="hljs-comment">// string | number</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T6</span> = <span class="hljs-title class_">NonNullable</span>&lt;<span class="hljs-built_in">string</span>[] | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span>&gt;; <span class="hljs-comment">// string[]</span>

<span class="hljs-comment">// Parameters&lt;Type&gt; - 获取函数参数类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T7</span> = <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span>&gt;; <span class="hljs-comment">// []</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T8</span> = <span class="hljs-title class_">Parameters</span>&lt;<span class="hljs-function">(<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>&gt;; <span class="hljs-comment">// [string]</span>

<span class="hljs-comment">// ConstructorParameters&lt;Type&gt; - 获取构造函数参数类型</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"><span class="hljs-keyword">public</span> name: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">public</span> age: <span class="hljs-built_in">number</span></span>) {}
}

<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T9</span> = <span class="hljs-title class_">ConstructorParameters</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Person</span>&gt;; <span class="hljs-comment">// [string, number]</span>

<span class="hljs-comment">// InstanceType&lt;Type&gt; - 获取构造函数实例类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T10</span> = <span class="hljs-title class_">InstanceType</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Person</span>&gt;; <span class="hljs-comment">// Person</span>

<span class="hljs-comment">// Required&lt;Type&gt; - 将所有属性设为必需</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Props</span> {
    a?: <span class="hljs-built_in">number</span>;
    b?: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T11</span> = <span class="hljs-title class_">Required</span>&lt;<span class="hljs-title class_">Props</span>&gt;; <span class="hljs-comment">// { a: number; b: string; }</span>

<span class="hljs-comment">// Partial&lt;Type&gt; - 将所有属性设为可选</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T12</span> = <span class="hljs-title class_">Partial</span>&lt;<span class="hljs-title class_">Props</span>&gt;; <span class="hljs-comment">// { a?: number; b?: string; }</span>

<span class="hljs-comment">// Readonly&lt;Type&gt; - 将所有属性设为只读</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T13</span> = <span class="hljs-title class_">Readonly</span>&lt;<span class="hljs-title class_">Props</span>&gt;; <span class="hljs-comment">// { readonly a?: number; readonly b?: string; }</span>

<span class="hljs-comment">// Pick&lt;Type, Keys&gt; - 从类型中选择特定属性</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T14</span> = <span class="hljs-title class_">Pick</span>&lt;<span class="hljs-title class_">Props</span>, <span class="hljs-string">"a"</span>&gt;; <span class="hljs-comment">// { a?: number; }</span>

<span class="hljs-comment">// Omit&lt;Type, Keys&gt; - 从类型中省略特定属性</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T15</span> = <span class="hljs-title class_">Omit</span>&lt;<span class="hljs-title class_">Props</span>, <span class="hljs-string">"a"</span>&gt;; <span class="hljs-comment">// { b?: string; }</span>

<span class="hljs-comment">// Record&lt;Keys, Type&gt; - 创建属性为 Keys，值为 Type 的对象类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-variable constant_">T16</span> = <span class="hljs-title class_">Record</span>&lt;<span class="hljs-string">'x'</span> | <span class="hljs-string">'y'</span>, <span class="hljs-built_in">number</span>&gt;; <span class="hljs-comment">// { x: number; y: number; }</span>
</code></pre>
<h4 data-id="heading-15">2.5 映射类型</h4>
<p>映射类型是一种从旧类型创建新类型的泛型类型，它使用 PropertyKey 的联合来遍历键以创建类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 基本映射类型</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">OptionsFlags</span>&lt;<span class="hljs-title class_">Type</span>&gt; = {
    [<span class="hljs-title class_">Property</span> <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Type</span>]: <span class="hljs-built_in">boolean</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">FeatureFlags</span> = {
    <span class="hljs-attr">darkMode</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
    <span class="hljs-attr">newUserProfile</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">FeatureOptions</span> = <span class="hljs-title class_">OptionsFlags</span>&lt;<span class="hljs-title class_">FeatureFlags</span>&gt;;
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   darkMode: boolean;</span>
<span class="hljs-comment">//   newUserProfile: boolean;</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// 使用 readonly 和 ? 修饰符</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">CreateMutable</span>&lt;<span class="hljs-title class_">Type</span>&gt; = {
    -<span class="hljs-keyword">readonly</span> [<span class="hljs-title class_">Property</span> <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Type</span>]: <span class="hljs-title class_">Type</span>[<span class="hljs-title class_">Property</span>];
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">LockedAccount</span> = {
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">readonly</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">UnlockedAccount</span> = <span class="hljs-title class_">CreateMutable</span>&lt;<span class="hljs-title class_">LockedAccount</span>&gt;;
<span class="hljs-comment">// { id: string; name: string; }</span>

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Concrete</span>&lt;<span class="hljs-title class_">Type</span>&gt; = {
    [<span class="hljs-title class_">Property</span> <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Type</span>]-?: <span class="hljs-title class_">Type</span>[<span class="hljs-title class_">Property</span>];
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">MaybeUser</span> = {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;
    name?: <span class="hljs-built_in">string</span>;
    age?: <span class="hljs-built_in">number</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">User</span> = <span class="hljs-title class_">Concrete</span>&lt;<span class="hljs-title class_">MaybeUser</span>&gt;;
<span class="hljs-comment">// { id: string; name: string; age: number; }</span>
</code></pre>
<h4 data-id="heading-16">2.6 Key Remapping via as</h4>
<p>TypeScript 4.1 引入了 key remapping，允许我们在映射类型中转换键名：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">type</span> <span class="hljs-title class_">Getters</span>&lt;<span class="hljs-title class_">Type</span>&gt; = {
    [<span class="hljs-title class_">Property</span> <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Type</span> <span class="hljs-keyword">as</span> <span class="hljs-string">`get<span class="hljs-subst">${Capitalize&lt;<span class="hljs-built_in">string</span> &amp; Property&gt;}</span>`</span>]: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Type</span>[<span class="hljs-title class_">Property</span>]
};

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Person</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">location</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">LazyPerson</span> = <span class="hljs-title class_">Getters</span>&lt;<span class="hljs-title class_">Person</span>&gt;;
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   getName: () =&gt; string;</span>
<span class="hljs-comment">//   getAge: () =&gt; number;</span>
<span class="hljs-comment">//   getLocation: () =&gt; string;</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// 通过模板字面量类型过滤键</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">RemoveKindField</span>&lt;<span class="hljs-title class_">Type</span>&gt; = {
    [<span class="hljs-title class_">Property</span> <span class="hljs-keyword">in</span> keyof <span class="hljs-title class_">Type</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Exclude</span>&lt;<span class="hljs-title class_">Property</span>, <span class="hljs-string">"kind"</span>&gt;]: <span class="hljs-title class_">Type</span>[<span class="hljs-title class_">Property</span>]
};

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Circle</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"circle"</span>;
    <span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">KindlessCircle</span> = <span class="hljs-title class_">RemoveKindField</span>&lt;<span class="hljs-title class_">Circle</span>&gt;;
<span class="hljs-comment">// { radius: number; }</span>
</code></pre>
<h4 data-id="heading-17">2.7 深层映射类型</h4>
<p>创建深层映射类型来处理嵌套对象：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 深度 Partial</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepPartial</span>&lt;T&gt; = {
    [P <span class="hljs-keyword">in</span> keyof T]?: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? <span class="hljs-title class_">DeepPartial</span>&lt;T[P]&gt; : T[P];
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">NestedObject</span> = {
    <span class="hljs-attr">a</span>: {
        <span class="hljs-attr">b</span>: {
            <span class="hljs-attr">c</span>: <span class="hljs-built_in">number</span>;
        };
        <span class="hljs-attr">d</span>: <span class="hljs-built_in">string</span>;
    };
    <span class="hljs-attr">e</span>: <span class="hljs-built_in">boolean</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">PartialNested</span> = <span class="hljs-title class_">DeepPartial</span>&lt;<span class="hljs-title class_">NestedObject</span>&gt;;
<span class="hljs-comment">// {</span>
<span class="hljs-comment">//   a?: {</span>
<span class="hljs-comment">//     b?: {</span>
<span class="hljs-comment">//       c?: number;</span>
<span class="hljs-comment">//     };</span>
<span class="hljs-comment">//     d?: string;</span>
<span class="hljs-comment">//   };</span>
<span class="hljs-comment">//   e?: boolean;</span>
<span class="hljs-comment">// }</span>

<span class="hljs-comment">// 深度 Required</span>
<span class="hljs-keyword">type</span> <span class="hljs-title class_">DeepRequired</span>&lt;T&gt; = {
    [P <span class="hljs-keyword">in</span> keyof T]-?: T[P] <span class="hljs-keyword">extends</span> <span class="hljs-built_in">object</span> ? <span class="hljs-title class_">DeepRequired</span>&lt;T[P]&gt; : T[P];
};
</code></pre>
<h3 data-id="heading-18">三、装饰器模式(Decorator Pattern)</h3>
<h4 data-id="heading-19">3.1 装饰器基础</h4>
<p>装饰器是一种特殊类型的声明，可以被附加到类声明、方法、访问符、属性或参数上。装饰器使用 @expression 形式，expression 求值后必须为一个函数，它会在运行时被调用。</p>
<p>注意：装饰器目前还是实验性特性，需要在 tsconfig.json 中启用：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"experimentalDecorators"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"emitDecoratorMetadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-20">3.2 类装饰器</h4>
<p>类装饰器应用于类构造函数，可以用来监视、修改或替换类定义。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 类装饰器函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sealed</span>(<span class="hljs-params">constructor: <span class="hljs-built_in">Function</span></span>) {
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">seal</span>(constructor);
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">seal</span>(constructor.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
}

<span class="hljs-meta">@sealed</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Greeter</span> {
    <span class="hljs-attr">greeting</span>: <span class="hljs-built_in">string</span>;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span> = message;
    }
    
    <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span>;
    }
}

<span class="hljs-comment">// 替换类构造函数的装饰器</span>
<span class="hljs-keyword">function</span> classDecorator&lt;T <span class="hljs-keyword">extends</span> {<span class="hljs-title function_">new</span>(...<span class="hljs-attr">args</span>:<span class="hljs-built_in">any</span>[]):{}}&gt;(<span class="hljs-attr">constructor</span>:T) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">extends</span> constructor {
        newProperty = <span class="hljs-string">"new property"</span>;
        hello = <span class="hljs-string">"override"</span>;
    }
}

<span class="hljs-meta">@classDecorator</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Greeter2</span> {
    property = <span class="hljs-string">"property"</span>;
    <span class="hljs-attr">hello</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">m: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">hello</span> = m;
    }
}

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Greeter2</span>(<span class="hljs-string">"world"</span>));
</code></pre>
<h4 data-id="heading-21">3.3 方法装饰器</h4>
<p>方法装饰器应用于方法的属性描述符，可以用来监视、修改或替换方法定义。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">enumerable</span>(<span class="hljs-params">value: <span class="hljs-built_in">boolean</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
        descriptor.<span class="hljs-property">enumerable</span> = value;
    };
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Greeter3</span> {
    <span class="hljs-attr">greeting</span>: <span class="hljs-built_in">string</span>;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span> = message;
    }
    
    <span class="hljs-meta">@enumerable</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-title function_">greet</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span>;
    }
}
</code></pre>
<h4 data-id="heading-22">3.4 访问器装饰器</h4>
<p>访问器装饰器应用于访问器的属性描述符，可以用来监视、修改或替换访问器的定义。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">configurable</span>(<span class="hljs-params">value: <span class="hljs-built_in">boolean</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
        descriptor.<span class="hljs-property">configurable</span> = value;
    };
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Point</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-attr">_x</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-attr">_y</span>: <span class="hljs-built_in">number</span>;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_x</span> = x;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_y</span> = y;
    }
    
    <span class="hljs-meta">@configurable</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">x</span>() { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_x</span>; }
    
    <span class="hljs-meta">@configurable</span>(<span class="hljs-literal">false</span>)
    <span class="hljs-keyword">get</span> <span class="hljs-title function_">y</span>() { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_y</span>; }
}
</code></pre>
<h4 data-id="heading-23">3.5 属性装饰器</h4>
<p>属性装饰器应用于类的属性声明，不能用来改变一个属性的声明或实现，但可以用来监视一个属性在类中的访问。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">format</span>(<span class="hljs-params">formatString: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-comment">// 存储格式信息，可以在其他地方使用</span>
        <span class="hljs-keyword">let</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;
        
        <span class="hljs-keyword">const</span> <span class="hljs-attr">descriptor</span>: <span class="hljs-title class_">PropertyDescriptor</span> = {
            <span class="hljs-attr">get</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
                <span class="hljs-keyword">return</span> value;
            },
            <span class="hljs-attr">set</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">newVal</span>) {
                value = formatString.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'{0}'</span>, newVal);
            },
            <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>
        };
        
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(target, propertyKey, descriptor);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Greeter4</span> {
    <span class="hljs-meta">@format</span>(<span class="hljs-string">"Hello, {0}"</span>)
    <span class="hljs-attr">greeting</span>: <span class="hljs-built_in">string</span>;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span> = message;
    }
}

<span class="hljs-keyword">const</span> greeter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Greeter4</span>(<span class="hljs-string">"World"</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(greeter.<span class="hljs-property">greeting</span>); <span class="hljs-comment">// "Hello, World"</span>
</code></pre>
<h4 data-id="heading-24">3.6 参数装饰器</h4>
<p>参数装饰器应用于类构造函数或方法的参数，参数装饰器只能用来监视一个方法的参数是否被传入。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">required</span>(<span class="hljs-params">target: <span class="hljs-built_in">Object</span>, propertyKey: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">symbol</span>, parameterIndex: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-comment">// 可以记录哪些参数是必需的</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Parameter <span class="hljs-subst">${parameterIndex}</span> is required for method <span class="hljs-subst">${propertyKey.toString()}</span>`</span>);
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Greeter5</span> {
    <span class="hljs-attr">greeting</span>: <span class="hljs-built_in">string</span>;
    
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span> = message;
    }
    
    <span class="hljs-title function_">greet</span>(<span class="hljs-params"><span class="hljs-meta">@required</span> name: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello "</span> + name + <span class="hljs-string">", "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">greeting</span>;
    }
}
</code></pre>
<h4 data-id="heading-25">3.7 装饰器工厂</h4>
<p>装饰器工厂是可以传参的装饰器，返回一个装饰器函数。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">level: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyName: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
        <span class="hljs-keyword">const</span> method = descriptor.<span class="hljs-property">value</span>;
        
        descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args: <span class="hljs-built_in">any</span>[]</span>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">${level}</span>] Calling <span class="hljs-subst">${propertyName}</span> with`</span>, args);
            <span class="hljs-keyword">const</span> result = method.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">${level}</span>] Method <span class="hljs-subst">${propertyName}</span> returned`</span>, result);
            <span class="hljs-keyword">return</span> result;
        }
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Calculator</span> {
    <span class="hljs-meta">@log</span>(<span class="hljs-string">'DEBUG'</span>)
    <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-keyword">return</span> a + b;
    }
    
    <span class="hljs-meta">@log</span>(<span class="hljs-string">'INFO'</span>)
    <span class="hljs-title function_">multiply</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) {
        <span class="hljs-keyword">return</span> a * b;
    }
}

<span class="hljs-keyword">const</span> calc = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Calculator</span>();
calc.<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>); <span class="hljs-comment">// [DEBUG] Calling add with [2, 3]</span>
                <span class="hljs-comment">// [DEBUG] Method add returned 5</span>
</code></pre>
<h4 data-id="heading-26">3.8 复合装饰器</h4>
<p>多个装饰器可以应用在一个声明上，它们会按照特定顺序求值和应用。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">first</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"first(): factory evaluated"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"first(): called"</span>);
    }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">second</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"second(): factory evaluated"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target: <span class="hljs-built_in">any</span>, propertyKey: <span class="hljs-built_in">string</span>, descriptor: PropertyDescriptor</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"second(): called"</span>);
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {
    <span class="hljs-meta">@first</span>()
    <span class="hljs-meta">@second</span>()
    <span class="hljs-title function_">method</span>(<span class="hljs-params"/>) {}
}

<span class="hljs-comment">// 输出顺序：</span>
<span class="hljs-comment">// first(): factory evaluated</span>
<span class="hljs-comment">// second(): factory evaluated</span>
<span class="hljs-comment">// second(): called</span>
<span class="hljs-comment">// first(): called</span>
</code></pre>
<h3 data-id="heading-27">四、模块声明和类型增强</h3>
<h4 data-id="heading-28">4.1 模块声明基础</h4>
<p>TypeScript 允许你为现有的 JavaScript 库编写声明文件，以便在 TypeScript 项目中获得类型安全。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 声明全局变量</span>
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">var</span> <span class="hljs-attr">$</span>: <span class="hljs-title class_">JQueryStatic</span>;

<span class="hljs-comment">// 声明全局函数</span>
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">void</span>;

<span class="hljs-comment">// 声明全局对象</span>
<span class="hljs-keyword">declare</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title class_">MyApp</span> {
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Config</span> {
        <span class="hljs-attr">apiUrl</span>: <span class="hljs-built_in">string</span>;
        <span class="hljs-attr">timeout</span>: <span class="hljs-built_in">number</span>;
    }
    
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params">config: Config</span>): <span class="hljs-built_in">void</span>;
}
</code></pre>
<h4 data-id="heading-29">4.2 模块声明</h4>
<p>当你需要为外部库提供类型信息时，可以创建声明文件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// myLibrary.d.ts</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"myLibrary"</span> {
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Options</span> {
        timeout?: <span class="hljs-built_in">number</span>;
        retries?: <span class="hljs-built_in">number</span>;
    }
    
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">request</span>(<span class="hljs-params">url: <span class="hljs-built_in">string</span>, options?: Options</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">any</span>&gt;;
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">cancel</span>(<span class="hljs-params">token: <span class="hljs-built_in">any</span></span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-keyword">import</span> { request, <span class="hljs-title class_">Options</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"myLibrary"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-attr">options</span>: <span class="hljs-title class_">Options</span> = {
    <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span>,
    <span class="hljs-attr">retries</span>: <span class="hljs-number">3</span>
};

<span class="hljs-title function_">request</span>(<span class="hljs-string">"https://api.example.com/data"</span>, options);
</code></pre>
<h4 data-id="heading-30">4.3 通配符模块声明</h4>
<p>当你需要为一组模块提供声明时，可以使用通配符：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 为所有 .css 文件提供声明</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"*.css"</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">content</span>: { [<span class="hljs-attr">className</span>: <span class="hljs-built_in">string</span>]: <span class="hljs-built_in">string</span> };
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> content;
}

<span class="hljs-comment">// 为所有图片文件提供声明</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"*.png"</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> value;
}

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"*.jpg"</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> value;
}

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"*.svg"</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> value;
}
</code></pre>
<h4 data-id="heading-31">4.4 类型增强(Augmenting)</h4>
<p>TypeScript 允许你扩展现有类型，添加新的属性或方法。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 扩展全局 Window 接口</span>
<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">global</span> {
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Window</span> {
        <span class="hljs-attr">myCustomProperty</span>: <span class="hljs-built_in">string</span>;
        <span class="hljs-title function_">myCustomFunction</span>(): <span class="hljs-built_in">void</span>;
    }
}

<span class="hljs-comment">// 扩展已有接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Array</span>&lt;T&gt; {
    groupBy&lt;U&gt;(<span class="hljs-attr">keySelector</span>: <span class="hljs-function">(<span class="hljs-params">item: T</span>) =&gt;</span> U): <span class="hljs-title class_">Map</span>&lt;U, T[]&gt;;
}

<span class="hljs-comment">// 实现扩展的方法</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">groupBy</span> = <span class="hljs-keyword">function</span>&lt;T, U&gt;(<span class="hljs-attr">keySelector</span>: <span class="hljs-function">(<span class="hljs-params">item: T</span>) =&gt;</span> U): <span class="hljs-title class_">Map</span>&lt;U, T[]&gt; {
    <span class="hljs-keyword">const</span> map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;U, T[]&gt;();
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> key = <span class="hljs-title function_">keySelector</span>(item);
        <span class="hljs-keyword">const</span> collection = map.<span class="hljs-title function_">get</span>(key);
        <span class="hljs-keyword">if</span> (!collection) {
            map.<span class="hljs-title function_">set</span>(key, [item]);
        } <span class="hljs-keyword">else</span> {
            collection.<span class="hljs-title function_">push</span>(item);
        }
    });
    <span class="hljs-keyword">return</span> map;
};
</code></pre>
<h4 data-id="heading-32">4.5 模块增强(Module Augmentation)</h4>
<p>你可以扩展现有模块的类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// observable.d.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">declare</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Observable</span>&lt;T&gt; {
    <span class="hljs-title function_">subscribe</span>(<span class="hljs-attr">observer</span>: <span class="hljs-function">(<span class="hljs-params">value: T</span>) =&gt;</span> <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span>;
}

<span class="hljs-comment">// 扩展 Observable 模块</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Observable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./observable"</span>;

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">"./observable"</span> {
    <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Observable</span>&lt;T&gt; {
        map&lt;R&gt;(<span class="hljs-attr">project</span>: <span class="hljs-function">(<span class="hljs-params">value: T</span>) =&gt;</span> R): <span class="hljs-title class_">Observable</span>&lt;R&gt;;
        <span class="hljs-title function_">filter</span>(<span class="hljs-attr">predicate</span>: <span class="hljs-function">(<span class="hljs-params">value: T</span>) =&gt;</span> <span class="hljs-built_in">boolean</span>): <span class="hljs-title class_">Observable</span>&lt;T&gt;;
    }
}

<span class="hljs-comment">// 实现扩展的方法</span>
<span class="hljs-title class_">Observable</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">map</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">project</span>) {
    <span class="hljs-comment">// 实现 map 方法</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observable</span>(<span class="hljs-comment">/* ... */</span>);
};

<span class="hljs-title class_">Observable</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">filter</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">predicate</span>) {
    <span class="hljs-comment">// 实现 filter 方法</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Observable</span>(<span class="hljs-comment">/* ... */</span>);
};
</code></pre>
<h4 data-id="heading-33">4.6 声明合并(Declaration Merging)</h4>
<p>TypeScript 允许将多个同名声明合并为一个声明：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 接口合并</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Box</span> {
    <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Box</span> {
    <span class="hljs-attr">scale</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">let</span> <span class="hljs-attr">box</span>: <span class="hljs-title class_">Box</span> = {<span class="hljs-attr">height</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">6</span>, <span class="hljs-attr">scale</span>: <span class="hljs-number">10</span>};

<span class="hljs-comment">// 命名空间合并</span>
<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Animals</span> {
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Zebra</span> { }
}

<span class="hljs-keyword">namespace</span> <span class="hljs-title class_">Animals</span> {
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Legged</span> { <span class="hljs-attr">numberOfLegs</span>: <span class="hljs-built_in">number</span>; }
    <span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> { }
}

<span class="hljs-comment">// 合并后的 Animals 包含 Zebra, Legged, Dog</span>
</code></pre>
<h3 data-id="heading-34">五、类型推导和类型守卫</h3>
<h4 data-id="heading-35">5.1 类型推导基础</h4>
<p>TypeScript 编译器会根据赋值表达式和其他上下文自动推断类型。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 基础类型推导</span>
<span class="hljs-keyword">let</span> x = <span class="hljs-number">3</span>; <span class="hljs-comment">// 推导为 number</span>
<span class="hljs-keyword">let</span> y = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">null</span>]; <span class="hljs-comment">// 推导为 (number | null)[]</span>

<span class="hljs-comment">// 最佳通用类型</span>
<span class="hljs-keyword">let</span> zoo = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Rhino</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Elephant</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Snake</span>()];
<span class="hljs-comment">// 推导为 (Rhino | Elephant | Snake)[]</span>

<span class="hljs-comment">// 上下文类型推导</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">onmousedown</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">mouseEvent</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(mouseEvent.<span class="hljs-property">button</span>); <span class="hljs-comment">// 正确，推导为 MouseEvent</span>
    <span class="hljs-comment">// console.log(mouseEvent.foo); // 错误，MouseEvent 没有 foo 属性</span>
};
</code></pre>
<h4 data-id="heading-36">5.2 控制流类型分析</h4>
<p>TypeScript 3.7 引入了更精确的控制流类型分析：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">example</span>(<span class="hljs-params">x: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span> | <span class="hljs-built_in">boolean</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> x === <span class="hljs-string">"string"</span>) {
        x; <span class="hljs-comment">// 推导为 string</span>
        x.<span class="hljs-title function_">toUpperCase</span>();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> x === <span class="hljs-string">"number"</span>) {
        x; <span class="hljs-comment">// 推导为 number</span>
        x.<span class="hljs-title function_">toFixed</span>();
    } <span class="hljs-keyword">else</span> {
        x; <span class="hljs-comment">// 推导为 boolean</span>
        x.<span class="hljs-title function_">valueOf</span>();
    }
}

<span class="hljs-comment">// 数组类型守卫</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isStringArray</span>(<span class="hljs-params">arr: <span class="hljs-built_in">unknown</span>[]</span>): arr is <span class="hljs-built_in">string</span>[] {
    <span class="hljs-keyword">return</span> arr.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-keyword">typeof</span> item === <span class="hljs-string">"string"</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">processArray</span>(<span class="hljs-params">arr: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isStringArray</span>(arr)) {
        arr; <span class="hljs-comment">// 推导为 string[]</span>
        arr.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> str.<span class="hljs-title function_">toUpperCase</span>());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 处理混合数组</span>
    }
}
</code></pre>
<h4 data-id="heading-37">5.3 类型守卫(Type Guards)</h4>
<p>类型守卫是一些表达式，它们在运行时检查以确保在某个作用域内的类型。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// typeof 类型守卫</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">padLeft</span>(<span class="hljs-params">value: <span class="hljs-built_in">string</span>, padding: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> padding === <span class="hljs-string">"number"</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">" "</span>.<span class="hljs-title function_">repeat</span>(padding) + value;
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> padding === <span class="hljs-string">"string"</span>) {
        <span class="hljs-keyword">return</span> padding + value;
    }
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Expected string or number, got '<span class="hljs-subst">${padding}</span>'.`</span>);
}

<span class="hljs-comment">// instanceof 类型守卫</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Bird</span> {
    <span class="hljs-title function_">fly</span>(<span class="hljs-params"/>) {}
    <span class="hljs-title function_">layEggs</span>(<span class="hljs-params"/>) {}
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Fish</span> {
    <span class="hljs-title function_">swim</span>(<span class="hljs-params"/>) {}
    <span class="hljs-title function_">layEggs</span>(<span class="hljs-params"/>) {}
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">move</span>(<span class="hljs-params">animal: Bird | Fish</span>) {
    <span class="hljs-keyword">if</span> (animal <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Bird</span>) {
        animal.<span class="hljs-title function_">fly</span>();
    } <span class="hljs-keyword">else</span> {
        animal.<span class="hljs-title function_">swim</span>();
    }
}

<span class="hljs-comment">// in 操作符类型守卫</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Car</span> {
    <span class="hljs-attr">engine</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Bicycle</span> {
    <span class="hljs-attr">pedals</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">inspectVehicle</span>(<span class="hljs-params">vehicle: Car | Bicycle</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"engine"</span> <span class="hljs-keyword">in</span> vehicle) {
        vehicle; <span class="hljs-comment">// 推导为 Car</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(vehicle.<span class="hljs-property">engine</span>);
    } <span class="hljs-keyword">else</span> {
        vehicle; <span class="hljs-comment">// 推导为 Bicycle</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(vehicle.<span class="hljs-property">pedals</span>);
    }
}
</code></pre>
<h4 data-id="heading-38">5.4 自定义类型守卫</h4>
<p>你可以创建自己的类型守卫函数来细化类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 用户定义的类型守卫</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isFish</span>(<span class="hljs-params">pet: Fish | Bird</span>): pet is <span class="hljs-title class_">Fish</span> {
    <span class="hljs-keyword">return</span> (pet <span class="hljs-keyword">as</span> <span class="hljs-title class_">Fish</span>).<span class="hljs-property">swim</span> !== <span class="hljs-literal">undefined</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">getSmallPet</span>(<span class="hljs-params"/>): <span class="hljs-title class_">Fish</span> | <span class="hljs-title class_">Bird</span> {
    <span class="hljs-comment">// 返回 Fish 或 Bird 的实现</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() &gt; <span class="hljs-number">0.5</span> ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">Fish</span>() : <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bird</span>();
}

<span class="hljs-keyword">let</span> pet = <span class="hljs-title function_">getSmallPet</span>();

<span class="hljs-keyword">if</span> (<span class="hljs-title function_">isFish</span>(pet)) {
    pet.<span class="hljs-title function_">swim</span>();
} <span class="hljs-keyword">else</span> {
    pet.<span class="hljs-title function_">fly</span>();
}

<span class="hljs-comment">// 更复杂的类型守卫</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Admin</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">privileges</span>: <span class="hljs-built_in">string</span>[];
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Employee</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">startDate</span>: <span class="hljs-title class_">Date</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">UnknownEmployee</span> = <span class="hljs-title class_">Employee</span> | <span class="hljs-title class_">Admin</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isAdmin</span>(<span class="hljs-params">employee: UnknownEmployee</span>): employee is <span class="hljs-title class_">Admin</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"privileges"</span> <span class="hljs-keyword">in</span> employee;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">printEmployeeInformation</span>(<span class="hljs-params">emp: UnknownEmployee</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Name: "</span> + emp.<span class="hljs-property">name</span>);
    
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isAdmin</span>(emp)) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Privileges: "</span> + emp.<span class="hljs-property">privileges</span>.<span class="hljs-title function_">join</span>(<span class="hljs-string">", "</span>));
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Start Date: "</span> + emp.<span class="hljs-property">startDate</span>);
    }
}
</code></pre>
<h4 data-id="heading-39">5.5 可辨识联合(Discriminated Unions)</h4>
<p>通过共同的可辨识字段来区分不同类型的联合类型：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Square</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"square"</span>;
    <span class="hljs-attr">size</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Rectangle</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"rectangle"</span>;
    <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Circle</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"circle"</span>;
    <span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Shape</span> = <span class="hljs-title class_">Square</span> | <span class="hljs-title class_">Rectangle</span> | <span class="hljs-title class_">Circle</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">area</span>(<span class="hljs-params">s: Shape</span>) {
    <span class="hljs-keyword">switch</span> (s.<span class="hljs-property">kind</span>) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"square"</span>:
            <span class="hljs-keyword">return</span> s.<span class="hljs-property">size</span> * s.<span class="hljs-property">size</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"rectangle"</span>:
            <span class="hljs-keyword">return</span> s.<span class="hljs-property">width</span> * s.<span class="hljs-property">height</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"circle"</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * s.<span class="hljs-property">radius</span> ** <span class="hljs-number">2</span>;
        <span class="hljs-attr">default</span>:
            <span class="hljs-comment">// 穷尽性检查</span>
            <span class="hljs-keyword">const</span> <span class="hljs-attr">_exhaustiveCheck</span>: <span class="hljs-built_in">never</span> = s;
            <span class="hljs-keyword">return</span> _exhaustiveCheck;
    }
}

<span class="hljs-comment">// 添加新形状时，编译器会报错，提醒你处理新情况</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Triangle</span> {
    <span class="hljs-attr">kind</span>: <span class="hljs-string">"triangle"</span>;
    <span class="hljs-attr">base</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;
}

<span class="hljs-comment">// type Shape = Square | Rectangle | Circle | Triangle;</span>
<span class="hljs-comment">// 上述代码会导致编译错误，因为 area 函数没有处理 triangle 情况</span>
</code></pre>
<h4 data-id="heading-40">5.6 类型谓词(Type Predicates)</h4>
<p>类型谓词是返回类型为 type is TypeName 的函数，用于类型守卫：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 数组类型谓词</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isStringArray</span>(<span class="hljs-params">value: <span class="hljs-built_in">unknown</span></span>): value is <span class="hljs-built_in">string</span>[] {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(value) &amp;&amp; value.<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-keyword">typeof</span> item === <span class="hljs-string">"string"</span>);
}

<span class="hljs-comment">// 对象类型谓词</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">User</span> {
    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;
    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
    <span class="hljs-attr">email</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">isUser</span>(<span class="hljs-params">obj: <span class="hljs-built_in">unknown</span></span>): obj is <span class="hljs-title class_">User</span> {
    <span class="hljs-keyword">return</span> (
        <span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">"object"</span> &amp;&amp;
        obj !== <span class="hljs-literal">null</span> &amp;&amp;
        <span class="hljs-string">"id"</span> <span class="hljs-keyword">in</span> obj &amp;&amp;
        <span class="hljs-string">"name"</span> <span class="hljs-keyword">in</span> obj &amp;&amp;
        <span class="hljs-string">"email"</span> <span class="hljs-keyword">in</span> obj &amp;&amp;
        <span class="hljs-keyword">typeof</span> (obj <span class="hljs-keyword">as</span> <span class="hljs-title class_">User</span>).<span class="hljs-property">id</span> === <span class="hljs-string">"number"</span> &amp;&amp;
        <span class="hljs-keyword">typeof</span> (obj <span class="hljs-keyword">as</span> <span class="hljs-title class_">User</span>).<span class="hljs-property">name</span> === <span class="hljs-string">"string"</span> &amp;&amp;
        <span class="hljs-keyword">typeof</span> (obj <span class="hljs-keyword">as</span> <span class="hljs-title class_">User</span>).<span class="hljs-property">email</span> === <span class="hljs-string">"string"</span>
    );
}

<span class="hljs-comment">// 使用类型谓词</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processData</span>(<span class="hljs-params">data: <span class="hljs-built_in">unknown</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isStringArray</span>(data)) {
        <span class="hljs-comment">// data 被推导为 string[]</span>
        data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">str</span> =&gt;</span> str.<span class="hljs-title function_">toUpperCase</span>());
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isUser</span>(data)) {
        <span class="hljs-comment">// data 被推导为 User</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`User: <span class="hljs-subst">${data.name}</span> (<span class="hljs-subst">${data.email}</span>)`</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Unknown data type"</span>);
    }
}
</code></pre>
<h4 data-id="heading-41">5.7 类型断言(Type Assertions)</h4>
<p>虽然不是类型推导的一部分，但类型断言是 TypeScript 中重要的类型操作：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 尖括号语法</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">someValue</span>: <span class="hljs-built_in">unknown</span> = <span class="hljs-string">"this is a string"</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">strLength</span>: <span class="hljs-built_in">number</span> = (&lt;<span class="hljs-built_in">string</span>&gt;someValue).<span class="hljs-property">length</span>;

<span class="hljs-comment">// as 语法（推荐）</span>
<span class="hljs-keyword">let</span> <span class="hljs-attr">someValue2</span>: <span class="hljs-built_in">unknown</span> = <span class="hljs-string">"this is a string"</span>;
<span class="hljs-keyword">let</span> <span class="hljs-attr">strLength2</span>: <span class="hljs-built_in">number</span> = (someValue2 <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>).<span class="hljs-property">length</span>;

<span class="hljs-comment">// 非空断言操作符</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">fixed</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span></span>): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">postprocess</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {
        <span class="hljs-keyword">return</span> name.<span class="hljs-title function_">charAt</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">toUpperCase</span>() + name.<span class="hljs-title function_">substr</span>(<span class="hljs-number">1</span>);
    }
    
    <span class="hljs-comment">// name 可能为 null，但我们确定它不为 null</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">postprocess</span>(name!);
}

<span class="hljs-comment">// 类型断言 vs 类型守卫</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Cat</span> {
    <span class="hljs-title function_">meow</span>(): <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Dog</span> {
    <span class="hljs-title function_">bark</span>(): <span class="hljs-built_in">void</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleAnimal</span>(<span class="hljs-params">animal: Cat | Dog</span>) {
    <span class="hljs-comment">// 类型断言（不安全）</span>
    (animal <span class="hljs-keyword">as</span> <span class="hljs-title class_">Cat</span>).<span class="hljs-title function_">meow</span>(); <span class="hljs-comment">// 如果 animal 是 Dog，会运行时报错</span>
    
    <span class="hljs-comment">// 类型守卫（安全）</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"meow"</span> <span class="hljs-keyword">in</span> animal) {
        animal.<span class="hljs-title function_">meow</span>(); <span class="hljs-comment">// 安全调用</span>
    }
}
</code></pre>
<h3 data-id="heading-42">总结</h3>
<p>TypeScript 的高级特性为我们提供了强大的类型系统和编程能力：</p>
<ol>
<li><strong>泛型编程</strong>让我们能够编写高度可重用且类型安全的代码</li>
<li><strong>条件类型和映射类型</strong>提供了强大的类型变换能力</li>
<li><strong>装饰器模式</strong>允许我们以声明式的方式增强类和成员的行为</li>
<li><strong>模块声明和类型增强</strong>使我们能够为现有库添加类型信息并扩展类型</li>
<li><strong>类型推导和类型守卫</strong>让 TypeScript 能够在运行时保持类型安全</li>
</ol>
<p>掌握这些高级特性不仅能提高代码质量和开发效率，还能让我们写出更加健壮和易于维护的应用程序。随着 TypeScript 生态的不断发展，这些特性将在现代前端开发中发挥越来越重要的作用。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript中的LHS和RHS查询机制详解]]></title>    <link>https://juejin.cn/post/7574448424999354404</link>    <guid>https://juejin.cn/post/7574448424999354404</guid>    <pubDate>2025-11-20T06:58:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574448424999354404" data-draft-id="7574451949326024745" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript中的LHS和RHS查询机制详解"/> <meta itemprop="keywords" content="前端,JavaScript,代码规范"/> <meta itemprop="datePublished" content="2025-11-20T06:58:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="UIUV"/> <meta itemprop="url" content="https://juejin.cn/user/1036168457093483"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript中的LHS和RHS查询机制详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1036168457093483/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    UIUV
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T06:58:26.000Z" title="Thu Nov 20 2025 06:58:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读11分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript中的LHS和RHS查询机制详解</h2>
<p>JavaScript中的LHS（Left-Hand Side）和RHS（Right-Hand Side）查询机制是理解变量作用域和赋值行为的关键。这两种查询方式在引擎内部处理变量引用时表现出截然不同的行为模式，直接影响代码的执行结果和错误处理  。<strong>LHS查询的核心目的是寻找变量的存储位置以便赋值，而RHS查询则是为了获取变量的值进行使用</strong>  。这种差异在不同模式（严格模式与非严格模式）下尤为明显，且在实际开发中可能导致各种难以追踪的错误。</p>
<h3 data-id="heading-1">一、LHS和RHS的基本定义与行为</h3>
<p>LHS查询发生在需要为变量赋值的场景，其目标是找到变量的存储位置。例如在表达式<code>a = 2;</code>中，引擎会对<code>a</code>进行LHS查询，目的是找到可以存储值<code>2</code>的位置。如果<code>a</code>尚未被声明，且当前处于非严格模式，JavaScript引擎会自动在全局作用域中创建一个名为<code>a</code>的变量并赋值。这种机制虽然提供了一定的灵活性，但也可能导致隐式全局变量污染，增加代码维护难度  。</p>
<p>相比之下，RHS查询的目的是获取变量的值。例如在表达式<code>console.log(a);</code>中，引擎会对<code>a</code>进行RHS查询，以获取其当前值。如果<code>a</code>未被声明，RHS查询失败时，在非严格模式下会返回<code>undefined</code>，而在严格模式下则会抛出<code>ReferenceError</code>错误  。这种差异使得RHS查询失败会直接导致程序中断，而LHS查询失败则可能产生意外的全局变量。</p>
<p>在作用域链查找过程中，LHS和RHS查询遵循相似的路径，但处理结果不同。两种查询都从当前执行作用域开始，沿着作用域链逐级向上查找，直到全局作用域  。当LHS查询失败时，非严格模式会"兜底"创建全局变量；而RHS查询失败时，无论哪种模式都不会创建变量，只是返回<code>undefined</code>或抛出错误  。</p>
<h3 data-id="heading-2">二、严格模式与非严格模式下的行为差异</h3>
<p>JavaScript的严格模式（通过<code>"use strict";</code>声明）对LHS和RHS查询的行为产生了显著影响。下表对比了两种模式下查询失败的处理方式：</p>




















<table><thead><tr><th>查询类型</th><th>非严格模式</th><th>严格模式</th></tr></thead><tbody><tr><td>LHS查询失败</td><td>隐式创建全局变量</td><td>抛出<code>ReferenceError</code></td></tr><tr><td>RHS查询失败</td><td>返回<code>undefined</code></td><td>抛出<code>ReferenceError</code></td></tr></tbody></table>
<p>在非严格模式下，LHS查询失败会自动创建全局变量，这可能导致变量名冲突和难以追踪的错误  。例如以下代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"/>) {
  x = <span class="hljs-number">10</span>;  <span class="hljs-comment">// LHS查询x失败，非严格模式下创建全局变量</span>
}
<span class="hljs-title function_">bar</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x);  <span class="hljs-comment">// 输出10</span>
</code></pre>
<p>而在严格模式下，同样的代码会抛出错误：</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-keyword">function</span> <span class="hljs-title function_">bar</span>(<span class="hljs-params"/>) {
   <span class="hljs-string">"use strict"</span>;
   x = <span class="hljs-number">10</span>;  <span class="hljs-comment">// LHS查询x失败，严格模式下抛出错误</span>
 }
 <span class="hljs-title function_">bar</span>();      <span class="hljs-comment">// ReferenceError: x is not defined</span>
</code></pre>
<p><strong>严格模式下，无论是LHS还是RHS查询失败，都会立即抛出<code>ReferenceError</code>错误</strong>  ，这使得代码错误更容易被发现和修复。在非严格模式下，LHS查询失败可能导致全局变量意外创建，而RHS查询失败则可能返回<code>undefined</code>导致后续逻辑错误。</p>
<p>ES6引入的<code>let</code>和<code>const</code>关键字在严格模式下表现更为严格。使用<code>let</code>或<code>const</code>声明的变量在严格模式下不会被提升到作用域顶部，且无法在声明前访问，这进一步减少了LHS查询失败的可能性  。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta"> "use strict"</span>;
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);  <span class="hljs-comment">// ReferenceError: a is not defined</span>
 <span class="hljs-keyword">let</span> a = <span class="hljs-number">10</span>;
</code></pre>
<h3 data-id="heading-3">三、LHS和RHS查询的典型应用场景</h3>
<p>LHS和RHS查询不仅出现在简单的赋值操作中，还广泛存在于JavaScript的各类语法结构中。</p>
<p><strong>变量赋值与声明</strong>是最直接的LHS应用场景。无论是使用<code>var</code>、<code>let</code>还是<code>const</code>声明变量，引擎都会进行LHS查询以确定存储位置。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">var</span> a = <span class="hljs-number">10</span>;  <span class="hljs-comment">// LHS查询a，RHS查询10</span>
<span class="hljs-keyword">let</span> b = a + <span class="hljs-number">5</span>;  <span class="hljs-comment">// RHS查询a，LHS查询b</span>
</code></pre>
<p><strong>函数参数传递</strong>本质上也是LHS查询。当函数被调用时，参数会被赋值给函数的形参，这一过程相当于隐式进行LHS查询  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">num</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(num);  <span class="hljs-comment">// RHS查询num</span>
}
<span class="hljs-title function_">foo</span>(<span class="hljs-number">100</span>);  <span class="hljs-comment">// LHS查询num，RHS查询foo</span>
</code></pre>
<p><strong>对象属性操作</strong>同样遵循LHS和RHS规则。当访问对象属性时，如果属性不存在且处于非严格模式，会返回<code>undefined</code>；如果尝试给未声明的对象属性赋值，则会创建该属性  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> obj = {};
obj.<span class="hljs-property">x</span> = <span class="hljs-number">10</span>;  <span class="hljs-comment">// LHS查询obj.x，创建属性x</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">y</span>);  <span class="hljs-comment">// RHS查询obj.y，返回undefined</span>
</code></pre>
<p><strong>解构赋值</strong>是ES6中LHS查询的复杂应用场景。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> {a, b} = {<span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">2</span>};  <span class="hljs-comment">// RHS查询右边的对象，LHS查询a和b</span>
<span class="hljs-keyword">const</span> [x, y] = [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>];           <span class="hljs-comment">// RHS查询右边的数组，LHS查询x和y</span>
</code></pre>
<p>如果解构的源对象中不存在某些属性，LHS查询会失败，但不会创建全局变量，而是让对应的解构变量保持<code>undefined</code>（在非严格模式下）  。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> {a, b} = {<span class="hljs-attr">a</span>: <span class="hljs-number">1</span>};  <span class="hljs-comment">// LHS查询b失败，b为undefined</span>
</code></pre>
<h3 data-id="heading-4">四、实际开发中的常见问题与解决方案</h3>
<p>在实际JavaScript开发中，LHS和RHS查询机制可能导致多种常见问题。</p>
<p><strong>隐式全局变量污染</strong>是非严格模式下LHS查询失败的主要风险  。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span>环境污染示例() {
  data = <span class="hljs-string">"污染数据"</span>;  <span class="hljs-comment">// LHS查询失败，非严格模式下创建全局变量</span>
}
环境污染示例();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data);  <span class="hljs-comment">// 输出"污染数据"，可能覆盖其他同名全局变量</span>
</code></pre>
<p>这种问题在大型应用中尤为危险，可能导致难以追踪的变量覆盖或命名冲突。解决方案是使用严格模式，或在使用变量前显式声明  。</p>
<p>RHS查询失败导致的意外<code>undefined</code>是另一个常见问题。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-variable constant_">RHS</span>查询失败示例() {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a + b);  <span class="hljs-comment">// RHS查询a和b失败，返回undefined，导致计算错误</span>
  a = <span class="hljs-number">10</span>;                 <span class="hljs-comment">// LHS查询a失败，非严格模式下创建全局变量</span>
  b = <span class="hljs-number">20</span>;                 <span class="hljs-comment">// LHS查询b失败，非严格模式下创建全局变量</span>
}
<span class="hljs-variable constant_">RHS</span>查询失败示例();  <span class="hljs-comment">// 输出NaN，然后a和b变为全局变量</span>
</code></pre>
<p><strong>严格模式下的错误暴露</strong>虽然提高了代码健壮性，但也会导致更多运行时错误。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta"> "use strict"</span>;
 <span class="hljs-keyword">function</span>严格模式错误示例() {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);  <span class="hljs-comment">// ReferenceError: a is not defined</span>
   a = <span class="hljs-number">10</span>;            <span class="hljs-comment">// ReferenceError: a is not defined</span>
 }
严格模式错误示例();
</code></pre>
<p>这种情况下，未声明变量的任何使用都会立即失败，有助于开发者早期发现潜在问题。</p>
<p><strong>对象原型链上的LHS/RHS查询</strong>可能引发更复杂的行为。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span>原型链查询示例() {
  <span class="hljs-keyword">const</span> obj = {<span class="hljs-attr">a</span>: <span class="hljs-number">1</span>};
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">b</span>);  <span class="hljs-comment">// RHS查询obj.b，返回undefined</span>
  obj.<span class="hljs-property">b</span> = <span class="hljs-number">2</span>;              <span class="hljs-comment">// LHS查询obj.b，创建属性b</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">b</span>);  <span class="hljs-comment">// RHS查询obj.b，返回2</span>
}
原型链查询示例();
</code></pre>
<p>在原型链中，属性查找会从对象自身开始，然后沿着原型链向上查找  。LHS查询在对象自身上失败时，会尝试在原型链上查找可写属性，若找不到则抛出错误（严格模式）或创建自身属性（非严格模式）。</p>
<h3 data-id="heading-5">五、调试与错误处理技巧</h3>
<p>理解LHS和RHS查询机制有助于更有效地调试JavaScript代码。</p>
<p><strong>通过错误类型判断查询类型</strong>是基础技巧。当遇到<code>ReferenceError</code>时，通常表明是RHS查询失败（变量未定义）或严格模式下的LHS查询失败  。例如：</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-comment">// RHS查询失败</span>
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(未定义变量);  <span class="hljs-comment">// ReferenceError: 未定义变量 is not defined</span>

 <span class="hljs-comment">// 严格模式下的LHS查询失败</span>
 <span class="hljs-string">"use strict"</span>;
 未定义变量 = <span class="hljs-number">10</span>;  <span class="hljs-comment">// ReferenceError: 未定义变量 is not defined</span>
</code></pre>
<p><strong>使用开发者工具的控制台</strong>可以快速定位查询失败的位置。当代码抛出<code>ReferenceError</code>时，浏览器开发者工具或Node.js的调试器会显示错误发生的行号和变量名，帮助开发者快速修复问题。</p>
<p><strong>作用域链可视化</strong>有助于理解变量查找过程。例如，在Chrome开发者工具中，可以在Scope Variables面板查看当前作用域的变量，理解LHS和RHS查询如何沿着作用域链查找变量。</p>
<p><strong>变量声明检查</strong>是预防查询失败的有效手段。在编写代码时，应确保所有在LHS或RHS查询中使用的变量都已显式声明，或使用<code>let</code>、<code>const</code>等ES6变量声明方式，减少意外查询失败的可能性。</p>
<h3 data-id="heading-6">六、TypeScript中的LHS/RHS查询机制</h3>
<p>TypeScript作为JavaScript的超集，通过静态类型检查增强了对LHS和RHS查询的控制。</p>
<p><strong>TypeScript严格模式</strong>（通过<code>tsconfig.json</code>中的<code>"strict": true</code>配置）与JavaScript严格模式有相似之处，但更侧重于类型安全  。例如，未声明变量在TypeScript严格模式下会直接导致编译错误，而非运行时错误：</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-comment">// TypeScript严格模式下的RHS查询失败</span>
 <span class="hljs-keyword">function</span>类型检查示例() {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a);  <span class="hljs-comment">// error TS2304: Cannot find name 'a'.</span>
 }
</code></pre>
<p><strong>显式类型声明</strong>有助于避免查询失败。TypeScript要求所有变量在使用前必须有类型声明，这与LHS查询需要变量存在存储位置的机制相呼应  ：</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-comment">// 显式声明变量</span>
 <span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>;  <span class="hljs-comment">// RHS查询a会返回undefined，但类型安全</span>
 a = <span class="hljs-number">10</span>;          <span class="hljs-comment">// LHS查询a成功</span>
</code></pre>
<p><strong>解构赋值与默认值</strong>是TypeScript中处理查询失败的推荐方式。通过为解构变量提供默认值，可以避免RHS查询失败导致的问题：</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-comment">// 解构赋值与默认值</span>
 <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Data</span> {
   <span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>;
   b?: <span class="hljs-built_in">number</span>;  <span class="hljs-comment">// 可选属性</span>
 }
 <span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Data</span> = {<span class="hljs-attr">a</span>: <span class="hljs-number">1</span>};
 <span class="hljs-keyword">const</span> {a, b = <span class="hljs-number">2</span>} = data;  <span class="hljs-comment">// RHS查询b失败时使用默认值2</span>
 <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a, b);  <span class="hljs-comment">// 输出1 2</span>
</code></pre>
<p><strong>TypeScript的类型推导</strong>可以辅助理解LHS和RHS查询的类型行为。例如，解构赋值中的变量类型会根据源对象的类型自动推导：</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-comment">// 类型推导</span>
 <span class="hljs-keyword">const</span> obj = {<span class="hljs-attr">name</span>: <span class="hljs-string">"Alice"</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>};
 <span class="hljs-keyword">const</span> {name, age} = obj;  <span class="hljs-comment">// name推导为string，age推导为number</span>
</code></pre>
<h3 data-id="heading-7">七、最佳实践与编码建议</h3>
<p>基于对LHS和RHS查询机制的理解，以下是JavaScript开发的最佳实践建议。</p>
<p><strong>始终使用严格模式</strong>是避免隐式全局变量和提高代码健壮性的首要措施。在文件顶部或函数内部添加<code>"use strict";</code>指令，使LHS查询失败时抛出错误，而非创建全局变量  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta"> "use strict"</span>;
 <span class="hljs-comment">// 此处未声明变量的任何使用都会立即失败</span>
</code></pre>
<p><strong>显式声明所有变量</strong>可以避免查询失败。使用<code>let</code>或<code>const</code>代替<code>var</code>，并确保在使用前声明变量  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-comment">// 显式声明变量</span>
 <span class="hljs-keyword">function</span>显式声明示例() {
   <span class="hljs-keyword">let</span> a = <span class="hljs-number">10</span>;
   <span class="hljs-keyword">const</span> b = <span class="hljs-number">20</span>;
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a + b);
 }
</code></pre>
<p><strong>解构赋值时提供默认值</strong>可以避免RHS查询失败导致的<code>undefined</code>值  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-comment">// 解构赋值与默认值</span>
 <span class="hljs-keyword">function</span>解构赋值示例(obj) {
   <span class="hljs-keyword">const</span> {x = <span class="hljs-number">0</span>, y = <span class="hljs-number">0</span>} = obj;  <span class="hljs-comment">// RHS查询x和y失败时使用默认值</span>
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(x + y);
 }
解构赋值示例({<span class="hljs-attr">x</span>: <span class="hljs-number">1</span>});  <span class="hljs-comment">// 输出1</span>
解构赋值示例({});        <span class="hljs-comment">// 输出0</span>
</code></pre>
<p><strong>使用ES6块级作用域</strong>可以限制变量的可见范围，减少意外查询失败的可能性  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-comment">// 块级作用域</span>
 <span class="hljs-keyword">function</span>块级作用域示例() {
   <span class="hljs-keyword">if</span> (<span class="hljs-literal">true</span>) {
     <span class="hljs-keyword">let</span> a = <span class="hljs-number">10</span>;
     <span class="hljs-keyword">const</span> b = <span class="hljs-number">20</span>;
     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a + b);
   }
   <span class="hljs-comment">// 此处无法访问a和b，避免变量污染</span>
 }
</code></pre>
<p><strong>使用TypeScript增强类型安全</strong>可以在编译阶段发现潜在的查询失败问题  ：</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-comment">// TypeScript类型检查</span>
 <span class="hljs-keyword">function</span>类型安全示例(<span class="hljs-attr">data</span>: {<span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>}) {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">a</span>);  <span class="hljs-comment">// RHS查询data.a，类型安全</span>
 }
 <span class="hljs-comment">// 类型不匹配时会报错</span>
类型安全示例({<span class="hljs-attr">b</span>: <span class="hljs-number">2</span>});  <span class="hljs-comment">// error TS2345: Argument of type '{ b: number; }' is not compatible with parameter type '{ a: number; }'.</span>
</code></pre>
<p><strong>避免在函数内部声明变量</strong>，特别是在循环等复杂结构中，可以减少变量提升和查询失败的风险  ：</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-comment">// 避免函数内部声明变量</span>
 <span class="hljs-keyword">function</span>避免声明示例() {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i);  <span class="hljs-comment">// ReferenceError: i is not defined（严格模式下）</span>
   <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
     <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i);
   }
 }
</code></pre>
<h3 data-id="heading-8">八、总结与展望</h3>
<p>LHS和RHS查询机制是JavaScript变量处理的核心，理解它们有助于编写更健壮的代码。<strong>在非严格模式下，LHS查询失败会创建全局变量，而RHS查询失败会返回<code>undefined</code>；在严格模式下，两者都会抛出<code>ReferenceError</code></strong>  。这种差异使得严格模式成为现代JavaScript开发的标配。</p>
<p>随着JavaScript和TypeScript的发展，LHS和RHS查询机制的影响正在逐渐减弱。ES6引入的<code>let</code>、<code>const</code>和块级作用域减少了变量提升和查询失败的风险；TypeScript的静态类型检查则在编译阶段就暴露了潜在的问题。然而，理解这些底层机制仍然是深入掌握JavaScript的关键。</p>
<p>未来，随着更多ES规范的落地，LHS和RHS查询机制可能会进一步优化。例如，ES提案中的"do表达式"和"顶层等待"等语法可能会改变变量查询的方式，但核心的LHS/RHS差异仍将存在。因此，掌握这些基本概念对于长期从事JavaScript开发的人员至关重要。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue-Vben-Admin 从入门到实战：后端开发的前端探索之旅]]></title>    <link>https://juejin.cn/post/7574600119750066186</link>    <guid>https://juejin.cn/post/7574600119750066186</guid>    <pubDate>2025-11-20T07:27:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574600119750066186" data-draft-id="7574584245152596019" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue-Vben-Admin 从入门到实战：后端开发的前端探索之旅"/> <meta itemprop="keywords" content="前端,后端,Vue.js"/> <meta itemprop="datePublished" content="2025-11-20T07:27:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Shepherd"/> <meta itemprop="url" content="https://juejin.cn/user/3415500769991869"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue-Vben-Admin 从入门到实战：后端开发的前端探索之旅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3415500769991869/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Shepherd
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:27:11.000Z" title="Thu Nov 20 2025 07:27:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 概述：一名后端工程师的前端初体验</h2>
<p>作为一名深耕后端多年的Java工程师，一直围绕着Spring全家桶、微服务、中间件和分布式架构等后端技术栈。前端世界对我而言，虽说感觉并不陌生，但总是带着一层神秘面纱，知识点零散，理解停留在表面。</p>
<p>直到某天，我在GitHub上偶然发现了<strong>Vue-Vben-Admin</strong>——这个拥有超过30k⭐️的热门前端脚手架，瞬间吸引了我的注意。它基于Vue3、TypeScript和Vite等前沿技术栈，提供了一套能够<strong>快速搭建企业级管理后台</strong>的前端解决方案。</p>
<p><strong>为什么Vue-Vben-Admin如此火爆？</strong></p>
<p>🔥 <strong>技术栈前沿</strong> - 采用Vue3+TypeScript+Vite，这些都是当前前端生态中最新、最热门的技术组合</p>
<p>🔥 <strong>开箱即用</strong> - 内置企业级项目所需的各种功能：权限管理、多种布局、主题切换、丰富示例，应有尽有</p>
<p>🔥 <strong>代码规范</strong> - 严格的代码规范和类型检查，让后端开发者也能写出高质量的前端代码</p>
<p>🔥 <strong>性能优异</strong> - 基于Vite的快速冷启动和热更新，开发体验流畅</p>
<p>🔥 <strong>多UI库支持</strong> - 支持Ant Design Vue、Element Plus、Naive等主流UI库，灵活选择不再受限</p>
<p>平心而论，就技术选型、代码规范、功能完备性以及开箱即用的体验而言，Vue-Vben-Admin 足以媲美甚至超越许多互联网公司自研的后台管理系统。</p>
<h2 data-id="heading-1">2.环境搭建：三分钟搞定快速启动</h2>
<p><strong>环境要求</strong></p>
<p>在启动项目前，你需要确保你的环境满足以下要求：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fen" target="_blank" title="https://nodejs.org/en" ref="nofollow noopener noreferrer">Node.js</a> 20.15.0 及以上版本，推荐使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSchniz%2Ffnm" target="_blank" title="https://github.com/Schniz/fnm" ref="nofollow noopener noreferrer">fnm</a> 、 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnvm-sh%2Fnvm" target="_blank" title="https://github.com/nvm-sh/nvm" ref="nofollow noopener noreferrer">nvm</a> 或者直接使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2Fcli%2Fenv" target="_blank" title="https://pnpm.io/cli/env" ref="nofollow noopener noreferrer">pnpm</a> 进行版本管理。</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2F" target="_blank" title="https://git-scm.com/" ref="nofollow noopener noreferrer">Git</a> 任意版本。</li>
</ul>
<p>验证你的环境是否满足以上要求，你可以通过以下命令查看版本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 出现相应 node LTS版本即可</span>
node -v
<span class="hljs-comment"># 出现相应 git 版本即可</span>
git -v
</code></pre>
<p><strong>下载代码</strong></p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/vbenjs/vue-vben-admin.git
</code></pre>
<p><strong>安装依赖</strong></p>
<p>在你的代码目录内打开终端，并执行以下命令:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> vue-vben-admin
​
<span class="hljs-comment"># 使用项目指定的pnpm版本进行依赖安装</span>
npm i -g corepack
​
<span class="hljs-comment"># 安装依赖</span>
pnpm install
</code></pre>
<p><strong>运行项目</strong></p>
<p>执行以下命令运行项目:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动项目</span>
pnpm dev
</code></pre>
<p>此时，你会看到类似如下的输出，选择你需要运行的项目：</p>
<pre><code class="hljs language-sql" lang="sql">│
◆  <span class="hljs-keyword">Select</span> the app you need <span class="hljs-keyword">to</span> run [dev]:
│  ○ <span class="hljs-variable">@vben</span><span class="hljs-operator">/</span>web<span class="hljs-operator">-</span>antd
│  ○ <span class="hljs-variable">@vben</span><span class="hljs-operator">/</span>web<span class="hljs-operator">-</span>ele
│  ○ <span class="hljs-variable">@vben</span><span class="hljs-operator">/</span>web<span class="hljs-operator">-</span>naive
│  ○ <span class="hljs-variable">@vben</span><span class="hljs-operator">/</span>docs
│  ● <span class="hljs-variable">@vben</span><span class="hljs-operator">/</span>playground
└
</code></pre>
<p>现在，你可以在浏览器访问 <code>http://localhost:5555</code> 查看项目。登录之后系统界面如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1d8940a3fd54d4bbff8be7d429ebd8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hlcGhlcmQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228431&amp;x-signature=dLaPZo%2F8AauxYiPTeUH293DkMMI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">3.快速上手：后端思维理解前端架构</h2>
<h3 data-id="heading-3">3.1 项目结构解析（后端视角）</h3>
<p>Vue-Vben-Admin的目录结构对后端开发者非常友好：</p>
<pre><code class="hljs language-bash" lang="bash">src
├── api          <span class="hljs-comment"># 接口层，类似后端的Controller</span>
├── layouts      <span class="hljs-comment"># 布局组件，相当于页面模板</span>
├── router       <span class="hljs-comment"># 路由配置，类似Spring中的RequestMapping</span>
├── store        <span class="hljs-comment"># 状态管理，类比后端的缓存机制</span>
├── locales      <span class="hljs-comment"># 多语言配置</span>
├── views        <span class="hljs-comment"># 页面组件，相当于MVC中的View</span>
└── main.ts      <span class="hljs-comment"># 应用入口文件，类似Spring Boot的启动类</span>
</code></pre>
<p><strong>核心概念后端化理解：</strong></p>
<ul>
<li><strong>路由 (router/)</strong> ：核心是<code>routes.ts</code>和路由守卫(<code>guard/</code>)。权限路由通过后端返回的菜单数据动态生成，类似Spring Security的权限控制</li>
<li><strong>状态管理 (store/)</strong> ：使用Pinia管理用户信息、权限状态等全局数据，类似Redis缓存机制</li>
<li><strong>布局 (layouts/)</strong> ：定义页面整体框架，通过修改布局组件改变应用样式，类似Thymeleaf模板</li>
<li><strong>请求封装 (api/)</strong> ：基于Axios封装，统一处理请求拦截、响应拦截和错误处理，类似Spring的拦截器</li>
</ul>
<h3 data-id="heading-4">3.2 实战：开发一个测试页面</h3>
<p><strong>第一步：创建页面组件 (<code>src/views/test/index.vue</code>)</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
​
<span class="hljs-comment">// 响应式数据（类似Java中的POJO对象）</span>
<span class="hljs-keyword">const</span> name = <span class="hljs-title function_">ref</span>(<span class="hljs-string">'张三'</span>);
<span class="hljs-keyword">const</span> age = <span class="hljs-title function_">ref</span>(<span class="hljs-number">18</span>);
​
<span class="hljs-comment">// 方法定义（类似Service层方法）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">changeName</span>(<span class="hljs-params"/>) {
  name.<span class="hljs-property">value</span> = <span class="hljs-string">'李四'</span>; <span class="hljs-comment">// 注意：操作ref对象需要.value</span>
}
​
<span class="hljs-keyword">function</span> <span class="hljs-title function_">changeAge</span>(<span class="hljs-params"/>) {
  age.<span class="hljs-property">value</span> += <span class="hljs-number">1</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"person"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>姓名：{{ name }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>年龄：{{ age }}<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeName"</span>&gt;</span>修改名字<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeAge"</span>&gt;</span>修改年龄<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
​
<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.person</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">background-color</span>: skyblue;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">10px</span>;
}
​
<span class="hljs-selector-tag">button</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">5px</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<p><strong>第二步：配置路由 (<code>/router/routes/modules/test.ts</code>)</strong></p>
<pre><code class="hljs language-css" lang="css">import type { RouteRecordRaw } <span class="hljs-selector-tag">from</span> 'vue-router';
import { $t } <span class="hljs-selector-tag">from</span> '#/locales';
​
const routes: RouteRecordRaw[] = [
  {
    name: <span class="hljs-string">'Test'</span>,
    path: <span class="hljs-string">'/test'</span>,
    redirect: <span class="hljs-string">'/test/index'</span>,
    meta: {
      <span class="hljs-attribute">icon</span>: <span class="hljs-string">'mdi:home'</span>,
      title: $<span class="hljs-built_in">t</span>(<span class="hljs-string">'page.test.title'</span>),
    },
    children: [
      {
        name: <span class="hljs-string">'TestIndex'</span>,
        path: <span class="hljs-string">'/test/index'</span>,
        component: () =&gt; <span class="hljs-built_in">import</span>(<span class="hljs-string">'#/views/test/index.vue'</span>),
        meta: {
          <span class="hljs-attribute">icon</span>: <span class="hljs-string">'mdi:home'</span>,
          title: $<span class="hljs-built_in">t</span>(<span class="hljs-string">'page.test.index'</span>),
        },
      },
    ],
  },
];
​
export default routes;
</code></pre>
<p><strong>第三步：配置多语言 (<code>/locales/langs/zh-CN/page.json</code>)</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"测试菜单"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"测试页面"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>效果展示：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2d8631eaf1d43a493144aa5ea051523~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2hlcGhlcmQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228431&amp;x-signature=FLSvkUZhPfJgNY7dpMAHGSH%2FdrA%3D" alt="" loading="lazy"/></p>
<p>简单三步，一个功能完整的页面就开发完成了！虽然界面简单，但包含了Vue3的核心概念：响应式数据、事件处理、组件化开发。</p>
<h2 data-id="heading-5">4. 总结：为什么推荐后端工程师学习Vue-Vben-Admin？</h2>
<p>Vue-Vben-Admin确实是一个优秀的中后台解决方案，特别适合以下场景：</p>
<p>🚀 <strong>快速开发需求</strong> - 需要快速搭建中后台管理系统的项目</p>
<p>💼 <strong>企业级应用</strong> - 追求代码规范和质量的企业级项目开发</p>
<p>🔄 <strong>后端转全栈</strong> - 后端工程师需要参与前端开发的场景</p>
<p>🎯 <strong>技术栈升级</strong> - 团队希望采用现代化前端技术栈</p>
<p><strong>作为后端开发者的学习价值：</strong></p>
<ol start="0">
<li><strong>理解前端工程化</strong> - 学习现代前端项目的构建、打包、部署流程</li>
<li><strong>掌握组件化思维</strong> - 理解前端组件化开发模式，对微服务架构设计也有启发</li>
<li><strong>拓宽技术视野</strong> - 了解前后端分离架构的全貌，更好地进行API设计</li>
<li><strong>提升竞争力</strong> - 全栈开发能力在当前就业市场极具竞争力</li>
</ol>
<p><strong>学习建议：</strong></p>
<ul>
<li>先从模仿现有页面开始，理解代码结构</li>
<li>重点学习Vue3的Composition API和TypeScript</li>
<li>结合后端知识，理解前后端数据交互流程</li>
<li>多动手实践，遇到问题查阅官方文档</li>
</ul>
<h2 data-id="heading-6">5. 最后</h2>
<p>从后端视角学习前端，最大的障碍不是技术本身，而是思维方式的转变。Vue-Vben-Admin通过良好的项目结构和完善的文档，大大降低了后端开发者的学习门槛。</p>
<p>如果你也是后端开发者，想要拓展前端技能，或者需要快速搭建一个企业级管理后台，<strong>Vue-Vben-Admin</strong>绝对值得一试。它不仅能解决实际项目需求，更能帮你打开前端世界的大门，向全栈开发迈出坚实的一步。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[NAS、对象存储与 JuiceFS：百亿量化基金的存储选型实践]]></title>    <link>https://juejin.cn/post/7574600119750017034</link>    <guid>https://juejin.cn/post/7574600119750017034</guid>    <pubDate>2025-11-20T07:18:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574600119750017034" data-draft-id="7574625040659546162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="NAS、对象存储与 JuiceFS：百亿量化基金的存储选型实践"/> <meta itemprop="keywords" content="后端,运维"/> <meta itemprop="datePublished" content="2025-11-20T07:18:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JuiceFS"/> <meta itemprop="url" content="https://juejin.cn/user/2665636828032446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            NAS、对象存储与 JuiceFS：百亿量化基金的存储选型实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2665636828032446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JuiceFS
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:18:19.000Z" title="Thu Nov 20 2025 07:18:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在量化投资领域，存储系统的性能与可扩展性是支撑高效研究与计算任务的关键基础。JuiceFS 已广泛应用于多家头部百亿级量化私募机构，在回测与模型训练等核心环节中支撑高性能、低成本、可弹性扩展的存储体系。</p>
<p>本文将分享量化机构在存储层面临的核心挑战以及 JuiceFS 的应对方案，并通过三个典型案例，分别聚焦成本优化、元数据性能提升与平滑上云这三类需求。</p>
<h2 data-id="heading-0">01 量化行业的数据类型与存储挑战</h2>
<p>首先我们先来了解下量化行业使用数据的模式。量化投研中的编程语言和数据处理工具种类繁多，包括 Python、R、Java、MATLAB 和 Conda 等，同时，所涉及的数据类型也非常丰富，如 CSV、Parquet、TXT、Excel 和 HDF 等。这要求存储平台具备灵活性，能够支持各种数据格式并高效存储。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e91d38c209374424b699a21daa439e8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=9GEtCqT2ocLsQkBnwv%2BY7htT4Do%3D" alt="" loading="lazy"/></p>
<p>在量化投资中，数据的使用呈现出明显的“读多写少”特征。研究员频繁地从统一的数据源中读取数据，而数据的写入和更新相对较少。各类行情数据、因子数据等通常被集中存储，供所有研究员共享读取。无论是因子研究还是交易策略开发，基础数据都会被反复访问和使用。因此，存储系统必须具备高效的读取性能，以支持快速的数据访问和分析需求。</p>
<p>这种数据使用模式在量化研究的核心任务——回测（Backtesting）中也得到了充分体现。在典型的回测流程中，研究员多次读取历史行情数据，构建因子、生成交易信号并验证策略表现。稳定且预测能力强的因子会被纳入因子库，作为投资决策的重要依据。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0feb5e55b4341b3b6dd36422e6e417b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=Yfb19HNveqzg3JCMGadT%2BO5gtjg%3D" alt="" loading="lazy"/></p>
<p>由此，存储系统面临着一系列挑战，主要体现在以下几个方面：</p>
<p><strong>首先，能够处理多样化的编程语言与数据处理工具</strong>。</p>
<p><strong>量化投研的另一个挑战是容量要求低而性能要求高</strong>。虽然存储容量需求通常在几十 TB 至几百 TB，但对存储系统的性能要求极高，特别是在吞吐量和 IOPS 上。由于量化任务涉及大量的机器学习和深度学习计算，存储系统必须提供高效的顺序读吞吐量和快速的随机读 IOPS，才能支持数据的快速处理和分析。</p>
<p><strong>云环境的适应性也成为量化投研存储的一个关键要求</strong>。随着越来越多的量化团队开始使用公有云或混合云 构建技术平台，存储系统需要具备高可用性、弹性扩展性以及灵活的资源管理能力，以满足动态存储需求，并能够根据计算需求快速调整存储资源。</p>
<p><strong>与此同时，Kubernetes 已成为量化投研领域中资源编排的主流解决方案</strong>，因此存储系统需要能够与 Kubernetes 良好集成，支持 CSI 驱动。这一集成不仅提升了平台的灵活性和可扩展性，还使得存储系统能够在云环境中更高效地管理资源。</p>
<p><strong>最后，数据安全与权限控制是量化研究团队的核心需求</strong>。在量化投研过程中，因子数据、交易策略等敏感信息的保护至关重要。存储系统必须提供强大的模块化访问权限管理机制，保障数据的隐私与安全性。此外，随着越来越多的数据存储转向云环境，数据加密、审计和合规管理等功能成为必须提供的安全措施，以确保敏感数据在云上安全存储和访问。</p>
<h2 data-id="heading-1">02 主流存储方案利弊分析： NAS vs 对象存储 vs JuiceFS</h2>
<h3 data-id="heading-2">NAS</h3>
<p>许多量化团队在初期往往会选择一种 “开箱即用” 的方式来搭建存储系统，最常见的就是基于传统协议的 NAS（Network Attached Storage），使用 NFS 或 Samba 协议进行访问。在数据规模普遍处于几十 TB 到几百 TB 的情况下，很多私有机房采用 NAS 架构即可满足需求，部署简单、管理方便、成本在可控范围内。然而，这种方案在实践中也暴露出一些明显的问题。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b604501d266484696ce61b4bb70feb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=mqp9iHrHkD5ot4dfTwTnbfh2%2BiI%3D" alt="" loading="lazy"/></p>
<p>首先是成本问题。如果希望在 IDC 线下机房中获得较高的存储性能，通常必须使用全闪存 NAS 系统。全闪虽然性能更好，但价格昂贵，整体投资较大。而混闪架构（SSD 与 HDD 混合）在高并发访问场景下往往性能不足，特别是在多个研究员同时读取数据时，IO 吞吐容易成为瓶颈。</p>
<p>其次，云上 NAS 的性能受限于容量绑定。在公有云环境中，许多厂商的 NAS 或并行文件系统（如部分 PFS 产品）会将吞吐量与购买的容量直接绑定。也就是说，如果一个量化团队只需要 100 TB 的存储容量，但其回测和策略计算需要达到较高的吞吐或 IOPS，例如聚合每秒 50GB 以上读或者每秒上百万次操作，就必须“超配”购买到 PB 级容量才能满足性能需求。这种模式显然会带来资源浪费与成本上升。</p>
<p>第三个问题是协议层面导致的性能瓶颈。NAS 协议依赖内核客户端进行数据交互，当负载高时，由于数据与元数据通过同一通道传输（NFS4.2 前），容易在高并发读写下形成拥堵，从而引发性能下降甚至出现延迟抖动。这种情况虽然不是每次都会出现，但在量化研究高峰期或集中回测阶段极易暴露。</p>
<p><strong>综上所述，虽然 NAS 系统具备“即插即用”、部署简便、兼容性好的优点，但其在成本、性能扩展性以及高并发访问效率方面仍存在明显短板</strong>。</p>
<h3 data-id="heading-3">对象存储</h3>
<p>对象存储也是量化行业会考虑的低成本的解决方案，尽管对象存储的单次请求延迟较高，但它在处理大吞吐量的顺序读写时表现较好。许多研究员对其业务代码进行了改造，避免使用随机读写，而是将数据聚合成适合顺序读取的格式，再通过内存进行随机操作。这种做法虽然有效，但也存在一些问题。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17c51700364b4ccab0f06957e879359e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=Lx8xTwPXGjBZ9EU1MvYezwbOARI%3D" alt="" loading="lazy"/></p>
<p>首先，对象存储只能通过 S3 协议进行访问。对于已经使用 POSIX 挂载点的应用，迁移到对象存储时需要对代码进行改造，这对原有系统有一定的侵入性。此外，对象存储原生缺乏元数据管理，由于其扁平结构，I/O 操作的响应速度较慢，尤其是文件重命名等操作。如果需要更改文件名，实际上需要删除原文件并复制新的文件，这在性能上表现较差。</p>
<p>其次，对象存储上的文件不可变（immutable），这意味着如果要修改数据（例如在 Parquet 文件中添加一列），只能通过创建一个新的文件来实现，而不能直接在原文件上修改。这种不可变特性在一些场景下，如数据库文件可能导致很大的不便。</p>
<p>此外，频繁读取对象存储会产生额外的流出费用，这对于量化行业高频读写的需求来说，可能会造成较高的成本。同时，虽然对象存储在大吞吐量下表现不错，但它的性能完全依赖于存储系统本身，在高并发访问下可能仍然无法满足量化研究对速度和实时性的要求。</p>
<h3 data-id="heading-4">JuiceFS</h3>
<p>JuiceFS 是一款基于对象存储的分布式文件系统，兼容 POSIX ，能够同时管理结构化与非结构化数据，为量化研究提供统一、高性能的数据存储平台。系统支持 CSI 驱动，能与 Kubernetes 深度结合，同时具备云原生特性，可灵活部署在公有云、私有云或混合云环境中。</p>
<p>JuiceFS 采用数据与元数据分离的架构。数据被切分成小块存储在对象存储中，元数据则由独立引擎管理并缓存在内存中。这种设计显著提升了访问性能，使文件元数据操作（如重命名、查找，获取文件属性等）无需频繁访问底层存储，从而实现高吞吐量、低延迟和高 IOPS 的性能表现。</p>
<p>在安全与权限方面，JuiceFS 提供基于 Token 和 POSIX ACL 的访问控制机制，并支持数据传输与存储加密。更重要的是，对象存储与缓存中的数据均采用分块存放方式，从架构层面进一步提升了数据的安全性与合规性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e29aade08215450fa7f49863eef9f07a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=fvHqPNtHwXII8NWH6Ku2zFjGO84%3D" alt="" loading="lazy"/></p>
<p>实际操作时，用户通过下载并安装 JuiceFS 的二进制文件，并使用 <code>juicefs mount</code> 命令将其挂载到本地系统上。一旦挂载完成，用户的业务就能通过 POSIX 挂载点进行访问，操作方式与本机文件系统类似，方便与现有的应用兼容。</p>
<p>这样的架构在量化行业中的应用带来了多个显著的优势：</p>
<ol>
<li><strong>高吞吐量与高 IOPS 支持</strong>：量化投研中的数据使用模式大多是“读多写少”，尤其是回测、因子研究等任务，需要频繁地读取大量数据。JuiceFS 的切块存储和高效的多级数据缓存能够提供 高吞吐量和高 IOPS 支持，满足量化研究对数据访问的苛刻要求。</li>
<li><strong>弹性扩展与降本</strong>：量化研究常常面临动态的存储需求，JuiceFS 天生具备 弹性扩展 能力，能够根据需求动态调整存储和缓存资源。通过将对象存储作为底层存储架构，结合 分布式缓存，JuiceFS 可以显著降低存储成本，避免了全闪存储的高昂开销。</li>
<li><strong>数据安全</strong>：在量化投研中，因子数据和交易策略等属于核心资产，其安全性至关重要。JuiceFS 通过数据切块与加密机制有效保障数据安全。尤其是对于对上云仍存顾虑的机构，这一分块加密策略能显著降低数据泄露风险——即便部分数据被截获，攻击者也无法在缺乏元数据的情况下还原原始内容，从而确保敏感信息的安全与合规。</li>
<li><strong>云环境兼容性</strong>：随着云计算和公有云的普及，量化投研逐步向云环境迁移。JuiceFS 支持跨云同步，能够在多云或混合云环境中高效运行，为量化研究提供了更大的灵活性和可扩展性。</li>
</ol>
<p>对于线下部署的量化企业，JuiceFS 同样是可行且高效的选择。传统线下存储多采用混闪或机械硬盘，性能往往难以满足量化研究的高并发需求。JuiceFS 通过充分利用业务机器的本地缓存盘和高效的缓存机制，在低成本下即可实现接近全闪的性能，显著降低硬件投入。同时，其运维管理简单、稳定性高，客户反馈表明系统运行可靠、维护负担较轻。</p>
<h2 data-id="heading-5">03 案例</h2>
<h3 data-id="heading-6">案例 1 - 提升对象存储性能，整体降本增效</h3>
<p>为了进一步降低存储成本，该企业选择将数据迁移至对象存储。在回测业务中，他们原先使用的是一个自研的接口，通过 S3 API 直接访问 Amazon S3 对象存储。由于他们的业务主要是写入大块数据并进行顺序读取，这种存储模式即使没有缓存也能够勉强运行。尽管如此，这种做法仍然存在一些明显的弊端。</p>
<p>首先，使用 S3 API 对业务代码产生了侵入性，意味着如果 API 出现问题，业务代码的调试和维护将变得非常困难。此外，该 API 没有实现缓存，仅做了协议转换，一定程度上性能也有上限。由于这些原因，业务团队并不希望长期依赖这种模式。</p>
<p>为了改善这一状况，该企业决定迁移到 JuiceFS 企业版。迁移之后，业务代码不再依赖于 S3 API，JuiceFS 作为富客户端直接挂载在业务机器上。通过这种方式，业务代码几乎没有受到侵入，开发人员可以继续按原有方式编译和运行代码。同时，业务机器上的 NVMe 硬盘被用作分布式缓存，这有效优化了数据访问效率。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7096dc2d0414b17a2ab3205c7191030~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=aPEY%2FFsLx4mvgyJKxyCp64wnVfI%3D" alt="" loading="lazy"/></p>
<p>使用 JuiceFS 带来了显著的性能改进，客户得以在低成本的对象存储上实现高性能读写：首先，本地缓存避免了重复访问远程存储，显著降低读取延迟；其次，JuiceFS 的切块与预读机制充分利用了对象存储带宽，使单文件读取也能达到系统性能上限。整体上，迁移后的系统在性能和维护便利性上均有明显提升。</p>
<p>客户的神经网络训练任务同样从 JuiceFS 的优化中获益。在训练过程中，系统需要读取约 10 万个文件（每个约 24MB），并在随机打散后反复读取。未使用缓存时，每轮训练都需重新加载所有文件，产生巨大的网络流量。而引入 JuiceFS 后，首次读取的数据会自动缓存到本地，后续训练可直接从缓存池中获取，大幅减少带宽占用并显著提升整体训练效率，完全满足客户训练使用对存储的需求。</p>
<h3 data-id="heading-7">案例 2 - 业务对元数据要求极高</h3>
<p>客户主要将 JuiceFS 用于回测业务。该客户从外部购买行情数据，通常是 CSV 格式，并将其存储在目录中。不同于其他客户将数据进行聚合，这个客户将原始数据直接存放在文件夹内，造成了更大的数据访问负担。每个股票的历史行情数据被分开存储，每个文件代表一支股票一年的数据，这些文件按月和年分布在不同目录下。<strong>每次需要读取某一日期的行情数据时，必须随机读取并处理约 6000 个文件，然后将这些文件按顺序排列。为了支持回测，这些数据被用来启动数百台虚拟机，进行 4000 至 6000 个回测任务</strong>。</p>
<p>这一过程中，随机读取大量文件对存储系统造成了巨大的负担，尤其是在高并发读写的场景下，元数据的访问效率严重影响了整体性能。这个客户原本使用 JuiceFS 社区版，并结合云上 Redis 服务来缓存部分数据。虽然 Redis 提供了良好的性能，但它的 QPS 上限为 50 万个，这对于该客户的高并发回测任务来说已经无法满足需求。当回测任务达到 12,000 个时，Redis 的性能达到了瓶颈，导致整个系统变得非常缓慢，回测任务无法顺利完成。</p>
<p>为了解决这个问题，客户尝试使用 JuiceFS 企业版。企业版的元数据服务在性能上有了显著的提升，特别是在处理大量元数据请求时，企业版可支持更高的并发量。企业版的元数据服务采用了基于目录树结构的管理方式，并且提供了一个更加高效的请求处理服务。客户不再需要通过 KV 存储方式请求多个操作，而是通过简单的请求告知元数据系统读取文件。<strong>企业版元数据请求的单次处理效率约为社区版的 6 倍，因此在执行相同业务时，所需 QPS 仅为社区版的六分之一，整体执行效率更高</strong>。</p>
<p>除此之外JuiceFS 企业版还提供更强力的元数据客户端缓存机制：大量只读请求（如 <code>getattr</code>、<code>lookup</code>）可直接命中缓存，显著降低了对元数据服务的访问压力。如下图所示，系统共处理约 50 万 QPS 的只读元数据请求，其中仅约 4 万实际落到元数据服务端。再加上企业版元数据服务本身的高效处理能力，整体系统能够在高并发场景下保持稳定运行，CPU 使用率仅约 40%，客户能够稳定支持多达 12,000 个回测任务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/556a434734004ca0ba436fd1718de331~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=RnJ4G4EQ2BSy0sLJG1qOMUIusnQ%3D" alt="" loading="lazy"/></p>
<p>从这个案例我们可以看到，JuiceFS 企业版在量化行业中能够有效应对高并发读写、高 IOPS 和大量 元数据请求 的挑战。即使在没有对业务场景进行优化的情况下，JuiceFS 依然能够高效处理这些暴力操作的需求，满足量化行业对数据访问速度和响应能力的苛刻要求。</p>
<h3 data-id="heading-8">案例 3 - 云 NAS 不满足 IOPS 要求</h3>
<p>在这个案例中，客户面临的是将业务迁移到云端时的云存储性能问题。他们最初选择了使用云 NAS 来支持存储需求，但很快发现，随着业务的扩展，云 NAS 的性能无法满足 IOPS 要求。在使用云 NAS 的过程中，客户的 120 台机器就已经将普通型云 NAS 的 IOPS 上限打满，而即使使用极速型云 NAS（提供约 20 万 IOPS），性能仍然不能完全满足需求。</p>
<p>为了应对这一瓶颈，客户决定切换到 JuiceFS。通过 JuiceFS 的分布式缓存，客户能够聚合更多的 IOPS 性能。理论上，5 台缓存机器可以提供每台 20 万 IOPS，再加上本地硬盘的支持，最终可以提供 超过 100 万的 IOPS。通过这种方式，客户可以灵活组合缓存资源，按需扩展存储性能。</p>
<p><strong>在极限场景下，客户能够达到 7.5 GB 的吞吐量和近 300 万 IOPS，这足以应对大规模的随机读写场景</strong>。具体来说，客户能够通过增加网络带宽来提升吞吐量，而通过增加缓存节点数量来提高 IOPS 性能。每个缓存节点大约可以提供 10 万至 20 万 IOPS，客户还可以根据需要通过挂载更多的硬盘或利用内存来扩展容量。这样，客户可以根据业务的实际需求，自由组合和调整缓存池的能力，确保系统的性能。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d68a3deedfb24ad1a370c1319adfe03b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSnVpY2VGUw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764227899&amp;x-signature=IH%2BKK0VsWGoE%2BrF4S6SzOpOaU9U%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">04 小结</h2>
<p>结合前文多个实际案例，可以总结出量化研究在存储层面的几个显著特点：</p>
<p>首先，量化业务的数据容量相对较小，但对性能要求极高。JuiceFS 通过数据与元数据分离及缓存机制显著提升访问效率，即使在无缓存的情况下，也能依靠预读和数据切块上传机制充分利用带宽，确保高性能的数据处理能力。</p>
<p>其次，JuiceFS 的数据切块与加密机制提升了云上存储的安全性。数据被切分并加密后存储，即便部分数据被窃取，攻击者也无法在缺乏元数据的情况下还原文件。这种设计特别适合保护量化因子、交易策略等敏感数据。</p>
<p>随着量化业务逐步向云端迁移，JuiceFS 提供了一种平衡性能与成本的技术路径。它在对象存储的基础上实现了高性能访问与统一管理，满足公有云与混合云环境下的多样化计算需求，为量化机构构建可扩展、可靠的数据基础设施。</p>
<p>我们希望本文中的一些实践经验，能为正在面临类似问题的开发者提供参考，如果有其他疑问欢迎加入 <a href="https://link.juejin.cn?target=https%3A%2F%2Fjuicefs.com%2Fzh-cn%2F" target="_blank" title="https://juicefs.com/zh-cn/" ref="nofollow noopener noreferrer">JuiceFS 社区</a>与大家共同交流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenAI深夜放大招！Codex-Max上线，与Gemini 3巅峰对决]]></title>    <link>https://juejin.cn/post/7574581079626989574</link>    <guid>https://juejin.cn/post/7574581079626989574</guid>    <pubDate>2025-11-20T07:27:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574581079626989574" data-draft-id="7574530224852992006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenAI深夜放大招！Codex-Max上线，与Gemini 3巅峰对决"/> <meta itemprop="keywords" content="人工智能,资讯"/> <meta itemprop="datePublished" content="2025-11-20T07:27:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="算家计算"/> <meta itemprop="url" content="https://juejin.cn/user/1426490793396571"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenAI深夜放大招！Codex-Max上线，与Gemini 3巅峰对决
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1426490793396571/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    算家计算
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:27:22.000Z" title="Thu Nov 20 2025 07:27:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>两大AI巨头同时发力，两大编程助手谁强谁弱？</p>
</blockquote>
<p>昨天，Gemini 3刚刚发布，就在AI领域掀起了不小的波澜。热度还没消退，昨晚OpenAI紧跟着推出了旗下最强编程模型——GPT-5.1-Codex-Max。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f5d110ac00b42f4a080b25408d30adc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228442&amp;x-signature=DBweMhiC1mUmCmN3IeaMdbGKAdQ%3D" alt="图片" loading="lazy"/></p>
<p>两大AI巨头接连出牌，让这场模型之争陡然升温。</p>
<p>那么，这款新发布的GPT-5.1-Codex-Max与Gemini 3究竟有何不同？</p>
<p><strong>性能表现</strong></p>
<p>GPT-5.1-Codex-Max被OpenAI称为“代理性”编码模型，其核心优势在于处理那些需要长时间专注的复杂工程任务。根据OpenAI的介绍，该模型在内部测试中能够持续工作超过24小时，处理诸如修复测试失败、迭代实现等任务。</p>
<p>这种持久作战能力得益于一项名为“压缩”的技术。当模型的上下文窗口被填满时，它会自动压缩会话历史，保留关键信息并丢弃不重要的细节，从而在数百万个token的跨度中保持对核心任务的跟踪。</p>
<p>这种机制使得GPT-5.1-Codex-Max成为首个能够在多个上下文窗口中以这种方式本地训练的模型。</p>
<p>在性能表现上，GPT-5.1-Codex-Max在SWE-Bench Verified测试中达到了77.9%的得分，在SWE-Lancer IC SWE测评中更是达到79.9%。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6391f699c5149d0883074b877cc5b72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228442&amp;x-signature=LQPciDdWnl2ZoCc0fWCH09OrWGM%3D" alt="图片" loading="lazy"/></p>
<p>它在保持质量的同时，比前代模型减少了30%的“思考token”使用量，在现实任务中的运行速度也快了27%至42%。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97c0e36fc4ab462db3b521fef889ee40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228442&amp;x-signature=2ltuqSyimb5ZlTPQuUyH5%2FWVXs8%3D" alt="图片" loading="lazy"/></p>
<p><strong>Gemini 3的全方位挑战</strong></p>
<p>谷歌的Gemini 3则呈现出不同的优势特点。根据官方测试数据，Gemini 3在多项基准测试中表现出色，在GPQA Diamond上达到91.9%的分数，展示了博士级别的推理能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca55f5ad88f84e2fa0340493b884e02e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg566X5a626K6h566X:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228442&amp;x-signature=mKHFOefUCOA4QSbHEE2X9%2FcwrfE%3D" alt="图片" loading="lazy"/></p>
<p>Gemini 3的亮点在于其生成式体验功能，能够直接在浏览器中构建动画和交互式UI界面来解释复杂概念。比如，它可以生成完全交互式的利率计算器，包含滑块、可编辑文本字段、彩色表格等丰富的网页元素。</p>
<p>谷歌还增强了Gemini 3的代理能力，使其能够处理多步骤命令。例如，你可以要求聊天机器人为你的下一次旅行预订车辆，它不仅会查看电子邮件，还会通过模拟浏览器浏览互联网，从租赁机构找到可用车辆。</p>
<p>从两者的特性来看，OpenAI选择了深度专业化的路线，专门针对编程任务优化，尤其是那些需要长时间专注的复杂工作。而谷歌则采取了全面发展的策略，使Gemini 3在推理、多模态理解和交互体验上都有出色表现。</p>
<p>目前，GPT-5.1-Codex-Max现已向ChatGPT Plus、Pro、Team、Edu和Enterprise用户开放。使用限制因订阅类型而异，Plus用户每5小时可发送45至225条本地消息和10至60条云任务，而Pro用户则享有更多容量。</p>
<p>Gemini 3也遵循类似的免费增值模式，几乎所有功能都向免费用户开放，但高级功能需要订阅。</p>
<p>对于注重成本效益的开发者，GPT-5.1-Codex-Max在效率上的提升可能带来长期收益。思考token减少30%意味着在处理复杂任务时能够更快地获得结果，同时可能降低使用成本。</p>
<p>对于开发者社区而言，这种竞争最终将带来更好的工具和更高的工作效率。随着这些AI助手不断进化，它们将承担越来越多繁琐和耗时的编程任务，让我们能够专注于真正需要人类创造力和判断力的工作。</p>
<p>两款顶级AI编程助手你挺谁？欢迎在评论区交流讨论！</p>
<p>写在最后：如果您正在进行AI领域的创业或研究，却受困于高昂的算力成本或高并发下的推理稳定性等问题，欢迎留言或私信我们，找到您的降本增效突破口~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[缓存穿透、缓存击穿和缓存雪崩，傻傻分不清楚？]]></title>    <link>https://juejin.cn/post/7574529034672750627</link>    <guid>https://juejin.cn/post/7574529034672750627</guid>    <pubDate>2025-11-20T07:38:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574529034672750627" data-draft-id="7574601160980807695" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="缓存穿透、缓存击穿和缓存雪崩，傻傻分不清楚？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T07:38:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三说技术"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            缓存穿透、缓存击穿和缓存雪崩，傻傻分不清楚？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三说技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:38:36.000Z" title="Thu Nov 20 2025 07:38:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>对于从事后端开发的同学来说，<code>缓存</code>已经变成的项目中必不可少的技术之一。</p>
<p>没错，缓存能给我们系统显著的提升性能。但如果你使用不好，或者缺乏相关经验，它也会带来很多意想不到的问题。</p>
<p>今天我们一起聊聊如果在项目中引入了缓存，可能会给我们带来的下面这三大问题。看看你中招了没？</p>
<p><a href="https://link.juejin.cn/?target=http%3A%2F%2Fwww.susan.net.cn%3Frefer%3Djuejin" title="https://link.juejin.cn/?target=http%3A%2F%2Fwww.susan.net.cn%3Frefer%3Djuejin" target="_blank">最近准备面试的小伙伴，可以看一下这个宝藏网站（Java突击队）：www.susan.net.cn，里面：面试八股文、场景设计题、面试真题、7个项目实战、工作内推什么都有</a>。</p>
<h2 data-id="heading-1">1. 缓存穿透问题</h2>
<p>大部分情况下，加缓存的目的是：为了减轻数据库的压力，提升系统的性能。</p>
<h3 data-id="heading-2">1.1 我们是如何用缓存的？</h3>
<p>一般情况下，如果有用户请求过来，先查缓存，如果缓存中存在数据，则直接返回。如果缓存中不存在，则再查数据库，如果数据库中存在，则将数据放入缓存，然后返回。如果数据库中也不存在，则直接返回失败。</p>
<p>流程图如下：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bfde6b557c2461eacb27cb7c4e00642~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=WpzjNN6bGgnOCQgkd1DB6S3htqg%3D" alt="" loading="lazy"/>
上面的这张图小伙们肯定再熟悉不过了，因为大部分缓存都是这样用的。</p>
<h3 data-id="heading-3">1.2 什么是缓存穿透？</h3>
<p>但如果出现以下这两种特殊情况，比如：</p>
<ol>
<li>用户请求的id在缓存中不存在。</li>
<li>恶意用户伪造不存在的id发起请求。</li>
</ol>
<p>这样的用户请求导致的结果是：每次从缓存中都查不到数据，而需要查询数据库，同时数据库中也没有查到该数据，也没法放入缓存。也就是说，每次这个用户请求过来的时候，都要查询一次数据库。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98b1ffdae55f4c189b1658d1b2b251b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=yVrEuT3qtWbmNW1zZQE0CloCHMo%3D" alt="" loading="lazy"/>
图中标红的箭头表示每次走的路线。</p>
<p>很显然，缓存根本没起作用，好像被<code>穿透</code>了一样，每次都会去访问数据库。</p>
<p>这就是我们所说的：<code>缓存穿透问题</code>。</p>
<p>如果此时穿透了缓存，而直接数据库的请求数量非常多，数据库可能因为扛不住压力而挂掉。呜呜呜。</p>
<p>那么问题来了，如何解决这个问题呢？</p>
<h3 data-id="heading-4">1.3 校验参数</h3>
<p>我们可以对用户id做检验。</p>
<p>比如你的合法id是15xxxxxx，以15开头的。如果用户传入了16开头的id，比如：16232323，则参数校验失败，直接把相关请求拦截掉。这样可以过滤掉一部分恶意伪造的用户id。</p>
<h3 data-id="heading-5">1.4 布隆过滤器</h3>
<p>如果数据比较少，我们可以把数据库中的数据，全部放到内存的一个map中。</p>
<p>这样能够非常快速的识别，数据在缓存中是否存在。如果存在，则让其访问缓存。如果不存在，则直接拒绝该请求。</p>
<p>但如果数据量太多了，有数千万或者上亿的数据，全都放到内存中，很显然会占用太多的内存空间。</p>
<p>那么，有没有办法减少内存空间呢？</p>
<p>答：这就需要使用<code>布隆过滤器</code>了。</p>
<p>布隆过滤器底层使用bit数组存储数据，该数组中的元素默认值是0。</p>
<p>布隆过滤器第一次初始化的时候，会把数据库中所有已存在的key，经过一些列的hash算法（比如：三次hash算法）计算，每个key都会计算出多个位置，然后把这些位置上的元素值设置成1。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf61315ec87643579c8c2a34f54eb3f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=EuTzyiucqyEzfiJvGOQLIoFJlrY%3D" alt="" loading="lazy"/>
之后，有用户key请求过来的时候，再用相同的hash算法计算位置。</p>
<ul>
<li>如果多个位置中的元素值都是1，则说明该key在数据库中已存在。这时允许继续往后面操作。</li>
<li>如果有1个以上的位置上的元素值是0，则说明该key在数据库中不存在。这时可以拒绝该请求，而直接返回。</li>
</ul>
<p>使用布隆过滤器确实可以解决缓存穿透问题，但同时也带来了两个问题：</p>
<ol>
<li>存在误判的情况。</li>
<li>存在数据更新问题。</li>
</ol>
<p>先看看为什么会存在误判呢？</p>
<p>上面我已经说过，初始化数据时，针对每个key都是通过多次hash算法，计算出一些位置，然后把这些位置上的元素值设置成1。</p>
<p>但我们都知道hash算法是会出现hash冲突的，也就是说不同的key，可能会计算出相同的位置。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9673a4fe872646be918cab90c3306ad2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=Fu4bl9a6ubwp34D9vZE4eOeYK7g%3D" alt="" loading="lazy"/>
上图中的下标为2的位置就出现了hash冲突，key1和key2计算出了一个相同的位置。</p>
<p>如果有几千万或者上亿的数据，布隆过滤器中的hash冲突会非常明显。</p>
<p>如果某个用户key，经过多次hash计算出的位置，其元素值，恰好都被其他的key初始化成了1。此时，就出现了误判，原本这个key在数据库中是不存在的，但布隆过滤器确认为存在。</p>
<blockquote>
<p>如果布隆过滤器判断出某个key存在，可能出现误判。如果判断某个key不存在，则它在数据库中一定不存在。</p>
</blockquote>
<p>通常情况下，布隆过滤器的误判率还是比较少的。即使有少部分误判的请求，直接访问了数据库，但如果访问量并不大，对数据库影响也不大。</p>
<p>此外，如果想减少误判率，可以适当增加hash函数，图中用的3次hash，可以增加到5次。</p>
<p>其实，布隆过滤器最致命的问题是：如果数据库中的数据更新了，需要同步更新布隆过滤器。但它跟数据库是两个数据源，就可能存在数据不一致的情况。</p>
<p>比如：数据库中新增了一个用户，该用户数据需要实时同步到布隆过滤。但由于网络异常，同步失败了。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/228059170faa4786b14e09f3491ee07c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=4XSs6%2FoMSQKC%2BJWaPDXEnpw%2Fhoc%3D" alt="" loading="lazy"/>
这时刚好该用户请求过来了，由于布隆过滤器没有该key的数据，所以直接拒绝了该请求。但这个是正常的用户，也被<code>拦截</code>了。</p>
<p>很显然，如果出现了这种正常用户被拦截了情况，有些业务是无法容忍的。所以，布隆过滤器要看实际业务场景再决定是否使用，它帮我们解决了缓存穿透问题，但同时了带来了新的问题。</p>
<h3 data-id="heading-6">1.5 缓存空值</h3>
<p>上面使用布隆过滤器，虽说可以过滤掉很多不存在的用户id请求。但它除了增加系统的复杂度之外，会带来两个问题：</p>
<ol>
<li>布隆过滤器存在误杀的情况，可能会把少部分正常用户的请求也过滤了。</li>
<li>如果用户信息有变化，需要实时同步到布隆过滤器，不然会有问题。</li>
</ol>
<p>所以，通常情况下，我们很少用布隆过滤器解决缓存穿透问题。其实，还有另外一种更简单的方案，即：<code>缓存空值</code>。</p>
<p>当某个用户id在缓存中查不到，在数据库中也查不到时，也需要将该用户id缓存起来，只不过值是空的。这样后面的请求，再拿相同的用户id发起请求时，就能从缓存中获取空数据，直接返回了，而无需再去查一次数据库。</p>
<p>优化之后的流程图如下：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd5c30e5ed9949e8b909d526185b8cfe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=%2B9UHK56pynaQ5IHbV7HMUKEaq6w%3D" alt="" loading="lazy"/>
关键点是不管从数据库有没有查到数据，都将结果放入缓存中，只是如果没有查到数据，缓存中的值是空的罢了。</p>
<h2 data-id="heading-7">2. 缓存击穿问题</h2>
<h3 data-id="heading-8">2.1 什么是缓存击穿？</h3>
<p>有时候，我们在访问热点数据时。比如：我们在某个商城购买某个热门商品。</p>
<p>为了保证访问速度，通常情况下，商城系统会把商品信息放到缓存中。但如果某个时刻，该商品到了过期时间失效了。</p>
<p>此时，如果有大量的用户请求同一个商品，但该商品在缓存中失效了，一下子这些用户请求都直接怼到数据库，可能会造成瞬间数据库压力过大，而直接挂掉。</p>
<p>流程图如下：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04a2fdb94e0c4d10ae51081d04f484ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=FXgh582Qvrud%2BFzyv80TGaRp%2B0c%3D" alt="" loading="lazy"/>
那么，如何解决这个问题呢？</p>
<h3 data-id="heading-9">2.2 加锁</h3>
<p>数据库压力过大的根源是，因为同一时刻太多的请求访问了数据库。</p>
<p>如果我们能够限制，同一时刻只有一个请求才能访问某个productId的数据库商品信息，不就能解决问题了？</p>
<p>答：没错，我们可以用<code>加锁</code>的方式，实现上面的功能。</p>
<p>伪代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> {
  <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.set(productId, requestId, <span class="hljs-string">"NX"</span>, <span class="hljs-string">"PX"</span>, expireTime);
  <span class="hljs-keyword">if</span> (<span class="hljs-string">"OK"</span>.equals(result)) {
    <span class="hljs-keyword">return</span> queryProductFromDbById(productId);
  }
} <span class="hljs-keyword">finally</span>{
    unlock(productId,requestId);
}  
<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
</code></pre>
<p>在访问数据库时加锁，防止多个相同productId的请求同时访问数据库。</p>
<p>然后，还需要一段代码，把从数据库中查询到的结果，又重新放入缓存中。办法挺多的，在这里我就不展开了。</p>
<h3 data-id="heading-10">2.3 自动续期</h3>
<p>出现缓存击穿问题是由于key过期了导致的。那么，我们换一种思路，在key快要过期之前，就自动给它续期，不就OK了？</p>
<p>答：没错，我们可以用job给指定key自动续期。</p>
<p>比如说，我们有个分类功能，设置的缓存过期时间是30分钟。但有个job每隔20分钟执行一次，自动更新缓存，重新设置过期时间为30分钟。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/39a0e59c198541c583714f3261fe4e8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=ePr1p96CQRAh7ek1gyEh56KkcAY%3D" alt="" loading="lazy"/>
这样就能保证，分类缓存不会失效。</p>
<p>此外，在很多请求第三方平台接口时，我们往往需要先调用一个获取token的接口，然后用这个token作为参数，请求真正的业务接口。一般获取到的token是有有效期的，比如24小时之后失效。</p>
<p>如果我们每次请求对方的业务接口，都要先调用一次获取token接口，显然比较麻烦，而且性能不太好。</p>
<p>这时候，我们可以把第一次获取到的token缓存起来，请求对方业务接口时从缓存中获取token。</p>
<p>同时，有一个job每隔一段时间，比如每隔12个小时请求一次获取token接口，不停刷新token，重新设置token的过期时间。</p>
<h3 data-id="heading-11">2.4 缓存不失效</h3>
<p>此外，对于很多热门key，其实是可以不用设置过期时间，让其永久有效的。</p>
<p>比如参与秒杀活动的热门商品，由于这类商品id并不多，在缓存中我们可以不设置过期时间。</p>
<p>在秒杀活动开始前，我们先用一个程序提前从数据库中查询出商品的数据，然后同步到缓存中，提前做<code>预热</code>。</p>
<p>等秒杀活动结束一段时间之后，我们再<code>手动删除</code>这些无用的缓存即可。</p>
<p>最近为了帮助大家找工作，专门建了一些工作内推群，各大城市都有，欢迎各位HR和找工作的小伙伴进群交流，群里目前已经收集了不少的工作内推岗位。加苏三的微信：li_su223，备注：掘金+所在城市，即可进群。</p>
<h2 data-id="heading-12">3. 缓存雪崩问题</h2>
<h3 data-id="heading-13">3.1 什么是缓存雪崩？</h3>
<p>前面已经聊过缓存击穿问题了。</p>
<p>而缓存雪崩是缓存击穿的升级版，缓存击穿说的是某一个热门key失效了，而缓存雪崩说的是有多个热门key同时失效。看起来，如果发生缓存雪崩，问题更严重。</p>
<p>缓存雪崩目前有两种：</p>
<ol>
<li>有大量的热门缓存，同时失效。会导致大量的请求，访问数据库。而数据库很有可能因为扛不住压力，而直接挂掉。</li>
<li>缓存服务器down机了，可能是机器硬件问题，或者机房网络问题。总之，造成了整个缓存的不可用。</li>
</ol>
<p>归根结底都是有大量的请求，透过缓存，而直接访问数据库了。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32e50b8cd09f4ea1aa5c765a0c2bce8f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=iv99KzyF%2FmH1AmmGuASFdpur8xc%3D" alt="" loading="lazy"/>
那么，要如何解决这个问题呢？</p>
<h3 data-id="heading-14">3.2 过期时间加随机数</h3>
<p>为了解决缓存雪崩问题，我们首先要尽量避免缓存同时失效的情况发生。</p>
<p>这就要求我们不要设置相同的过期时间。</p>
<p>可以在设置的过期时间基础上，再加个1~60秒的随机数。</p>
<pre><code class="hljs language-java" lang="java">实际过期时间 = 过期时间 + <span class="hljs-number">1</span>~<span class="hljs-number">60</span>秒的随机数
</code></pre>
<p>这样即使在高并发的情况下，多个请求同时设置过期时间，由于有随机数的存在，也不会出现太多相同的过期key。</p>
<h3 data-id="heading-15">3.3 高可用</h3>
<p>针对缓存服务器down机的情况，在前期做系统设计时，可以做一些高可用架构。</p>
<p>比如：如果使用了redis，可以使用哨兵模式，或者集群模式，避免出现单节点故障导致整个redis服务不可用的情况。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6a1a3d9cac54027b39ee55c94a208a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=V0keN00hh5d0iVAT4jQFTlSSKTY%3D" alt="" loading="lazy"/>
使用哨兵模式之后，当某个master服务下线时，自动将该master下的某个slave服务升级为master服务，替代已下线的master服务继续处理请求。</p>
<h3 data-id="heading-16">3.4 服务降级</h3>
<p>如果做了高可用架构，redis服务还是挂了，该怎么办呢？</p>
<p>这时候，就需要做服务降级了。</p>
<p>我们需要配置一些默认的兜底数据。</p>
<p>程序中有个全局开关，比如有10个请求在最近一分钟内，从redis中获取数据失败，则全局开关打开。后面的新请求，就直接从配置中心中获取默认的数据。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/27420da1b5e84bb8ba5e6ce37117832d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229116&amp;x-signature=6ao5P2zrQcvFuKHzqgRwMf0767M%3D" alt="" loading="lazy"/>
当然，还需要有个job，每隔一定时间去从redis中获取数据，如果在最近一分钟内可以获取到两次数据（这个参数可以自己定），则把全局开关关闭。后面来的请求，又可以正常从redis中获取数据了。</p>
<p>需要特别说一句，该方案并非所有的场景都适用，需要根据实际业务场景决定。</p>
<h2 data-id="heading-17">最后说一句(求关注，别白嫖我)</h2>
<p>如果这篇文章对您有所帮助，或者有所启发的话，帮忙关注一下我的同名公众号：苏三说技术，您的支持是我坚持写作最大的动力。</p>
<p>求一键三连：点赞、转发、在看。</p>
<p>关注公众号：【苏三说技术】，在公众号中回复：进大厂，可以免费获取我最近整理的10万字的面试宝典，好多小伙伴靠这个宝典拿到了多家大厂的offer。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【SpringBoot】38 核心功能 - 高级特性- Spring Boot 中的应用启动过程详解]]></title>    <link>https://juejin.cn/post/7574608278421618724</link>    <guid>https://juejin.cn/post/7574608278421618724</guid>    <pubDate>2025-11-20T07:25:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574608278421618724" data-draft-id="7574530224853041158" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【SpringBoot】38 核心功能 - 高级特性- Spring Boot 中的应用启动过程详解"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T07:25:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java水解"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【SpringBoot】38 核心功能 - 高级特性- Spring Boot 中的应用启动过程详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java水解
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:25:23.000Z" title="Thu Nov 20 2025 07:25:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>SpringBoot应用的启动过程是一个复杂但设计精巧的流程，了解这个过程对于深入理解SpringBoot工作原理至关重要。本文将详细解析SpringBoot应用的完整[启动流程]。</p>
<h3 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>一、SpringApplication初始化阶段</h3>
<h4 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 创建SpringApplication实例</h4>
<p>SpringBoot应用启动的第一步是创建<code>SpringApplication</code>实例：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplication</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">SpringApplication</span>.<span class="hljs-title function_">run</span>(<span class="hljs-title class_">MyApplication</span>.<span class="hljs-property">class</span>, args);
    }
}

<span class="hljs-variable constant_">AI</span>写代码java
运行
<span class="hljs-number">123456</span>
</code></pre>
<p>在<code>SpringApplication</code>的构造函数中，会进行以下关键操作：</p>
<pre><code class="hljs language-scss" lang="scss">public <span class="hljs-built_in">SpringApplication</span>(ResourceLoader resourceLoader, Class&lt;?&gt;... primarySources) {
    <span class="hljs-comment">// 保存主配置类信息</span>
    this<span class="hljs-selector-class">.resourceLoader</span> = resourceLoader;
    this<span class="hljs-selector-class">.primarySources</span> = new LinkedHashSet&lt;&gt;(Arrays.asList(primarySources));
    
    <span class="hljs-comment">// 判断应用类型：SERVLET、REACTIVE 或 NONE</span>
    this<span class="hljs-selector-class">.webApplicationType</span> = WebApplicationType<span class="hljs-selector-class">.deduceFromClasspath</span>();
    
    <span class="hljs-comment">// 获取并初始化BootstrapRegistryInitializer</span>
    this<span class="hljs-selector-class">.bootstrapRegistryInitializers</span> = new ArrayList&lt;&gt;(
        getSpringFactoriesInstances(BootstrapRegistryInitializer.class));
    
    <span class="hljs-comment">// 获取ApplicationContextInitializer</span>
    <span class="hljs-built_in">setInitializers</span>((Collection) <span class="hljs-built_in">getSpringFactoriesInstances</span>(
        ApplicationContextInitializer.class));
    
    <span class="hljs-comment">// 获取ApplicationListener</span>
    <span class="hljs-built_in">setListeners</span>((Collection) <span class="hljs-built_in">getSpringFactoriesInstances</span>(ApplicationListener.class));
    
    <span class="hljs-comment">// 推断主应用类</span>
    this<span class="hljs-selector-class">.mainApplicationClass</span> = <span class="hljs-built_in">deduceMainApplicationClass</span>();
}

AI写代码java
运行
<span class="hljs-number">12345678910111213141516171819202122</span>
</code></pre>
<h4 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. 加载SPI扩展组件</h4>
<p>SpringBoot通过<code>spring.factories</code>机制加载各种扩展组件：</p>
<ul>
<li><strong>BootstrapRegistryInitializer</strong>: 引导注册表初始化器</li>
<li><strong>ApplicationContextInitializer</strong>: 应用上下文初始化器</li>
<li><strong>ApplicationListener</strong>: 应用事件监听器</li>
</ul>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>二、应用运行阶段</h3>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 启动计时与引导上下文</h4>
<pre><code class="hljs language-ini" lang="ini">public ConfigurableApplicationContext run(String... args) {
    StopWatch <span class="hljs-attr">stopWatch</span> = new StopWatch()<span class="hljs-comment">;</span>
    stopWatch.start()<span class="hljs-comment">;</span>
    
    // 创建引导上下文
    DefaultBootstrapContext <span class="hljs-attr">bootstrapContext</span> = createBootstrapContext()<span class="hljs-comment">;</span>
    
    ConfigurableApplicationContext <span class="hljs-attr">context</span> = null<span class="hljs-comment">;</span>
    configureHeadlessProperty()<span class="hljs-comment">;</span>
    
    // 获取运行监听器
    SpringApplicationRunListeners <span class="hljs-attr">listeners</span> = getRunListeners(args)<span class="hljs-comment">;</span>
    listeners.starting(bootstrapContext, this.mainApplicationClass)<span class="hljs-comment">;</span>
}

AI写代码java
运行
1234567891011121314
</code></pre>
<h4 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. 环境准备</h4>
<p>环境准备阶段负责配置应用运行所需的[环境变量]和配置属性：</p>
<pre><code class="hljs language-scss" lang="scss">private ConfigurableEnvironment <span class="hljs-built_in">prepareEnvironment</span>(
        SpringApplicationRunListeners listeners,
        ApplicationArguments applicationArguments) {
    
    <span class="hljs-comment">// 创建适当类型的环境对象</span>
    ConfigurableEnvironment environment = <span class="hljs-built_in">getOrCreateEnvironment</span>();
    
    <span class="hljs-comment">// 配置环境：加载配置文件、命令行参数等</span>
    <span class="hljs-built_in">configureEnvironment</span>(environment, applicationArguments.getSourceArgs());
    
    <span class="hljs-comment">// 发布EnvironmentPrepared事件</span>
    listeners<span class="hljs-selector-class">.environmentPrepared</span>(bootstrapContext, environment);
    
    <span class="hljs-comment">// 将环境绑定到SpringApplication</span>
    <span class="hljs-built_in">bindToSpringApplication</span>(environment);
    
    return environment;
}

AI写代码java
运行
<span class="hljs-number">123456789101112131415161718</span>
</code></pre>
<blockquote>
<p><strong>环境配置过程</strong>：</p>
<ul>
<li>返回或者创建基础设施信息对象：<code>StandardServletEnvironment</code></li>
<li>配置环境信息对象</li>
<li>读取所有的配置源的配置属性值</li>
<li>绑定环境信息</li>
<li>监听器调用 <code>listener.environmentPrepared()</code>，通知所有监听器当前环境准备完成</li>
</ul>
</blockquote>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3. 创建IOC容器</h4>
<p>根据应用类型创建相应的ApplicationContext：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">protected</span> ConfigurableApplicationContext createApplicationContext() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.applicationContextFactory.create(<span class="hljs-keyword">this</span>.webApplicationType);
}

AI写代码java
运行
<span class="hljs-number">123</span>
</code></pre>
<blockquote>
<p><strong>根据项目类型创建容器</strong>：</p>
<ul>
<li>对于Servlet应用，会创建 <code>AnnotationConfigServletWebServerApplicationContext</code></li>
<li>对于Reactive应用，会创建 <code>AnnotationConfigReactiveWebServerApplicationContext</code></li>
<li>对于普通应用，会创建 <code>AnnotationConfigApplicationContext</code></li>
</ul>
</blockquote>
<h4 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4. 准备IOC容器</h4>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">prepareContext</span>(DefaultBootstrapContext bootstrapContext, 
                           ConfigurableApplicationContext context,
                           ConfigurableEnvironment environment, 
                           SpringApplicationRunListeners listeners,
                           ApplicationArguments applicationArguments, 
                           Banner printedBanner) {
    
    <span class="hljs-comment">// 设置环境</span>
    context<span class="hljs-selector-class">.setEnvironment</span>(environment);
    
    <span class="hljs-comment">// 应用上下文后置处理</span>
    <span class="hljs-built_in">postProcessApplicationContext</span>(context);
    
    <span class="hljs-comment">// 应用初始化器</span>
    <span class="hljs-built_in">applyInitializers</span>(context);
    
    <span class="hljs-comment">// 发布ApplicationContextInitialized事件</span>
    listeners<span class="hljs-selector-class">.contextPrepared</span>(context);
    
    <span class="hljs-comment">// 注册Bean定义</span>
    <span class="hljs-built_in">load</span>(context, sources.toArray(new Object[<span class="hljs-number">0</span>]));
    
    <span class="hljs-comment">// 发布ApplicationContextLoaded事件</span>
    listeners<span class="hljs-selector-class">.contextLoaded</span>(context);
}

AI写代码java
运行
<span class="hljs-number">12345678910111213141516171819202122232425</span>
</code></pre>
<blockquote>
<p><strong>准备ApplicationContext IOC容器的基本信息 prepareContext()</strong> ：</p>
<ul>
<li>保存环境信息</li>
<li>IOC容器的后置处理流程</li>
<li>应用初始化器：<code>applyInitializers</code></li>
<li>遍历所有的 <code>ApplicationContextInitializer</code>，调用 <code>initialize</code>，来对IOC容器进行初始化扩展功能</li>
<li>遍历所有的监听器调用 <code>contextPrepared</code>，通知所有的监听器contextPrepare</li>
<li>所有的监听器调用 <code>contextLoaded</code>，通知所有的监听器contextLoaded</li>
</ul>
</blockquote>
<h4 data-id="heading-9"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5. 刷新IOC容器</h4>
<p>这是SpringBoot启动过程中最核心的步骤：</p>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">refreshContext</span>(ConfigurableApplicationContext context) {
    <span class="hljs-comment">// 注册关闭钩子</span>
    if (this.registerShutdownHook) {
        shutdownHook<span class="hljs-selector-class">.registerApplicationContext</span>(context);
    }
    
    <span class="hljs-comment">// 执行刷新操作</span>
    <span class="hljs-built_in">refresh</span>(context);
}

AI写代码java
运行
<span class="hljs-number">123456789</span>
</code></pre>
<p>实际的刷新操作委托给Spring Framework的<code>refresh()</code>方法：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">refresh</span>(<span class="hljs-params">ApplicationContext applicationContext</span>) {
    applicationContext.<span class="hljs-title function_">refresh</span>();
}

<span class="hljs-variable constant_">AI</span>写代码java
运行
<span class="hljs-number">123</span>
</code></pre>
<p>在<code>refresh()</code>方法中会完成：</p>
<ul>
<li>BeanFactory的创建和配置</li>
<li>Bean的后置处理器注册</li>
<li>消息源、事件广播器等基础组件的初始化</li>
<li>Web服务器的创建和启动</li>
<li>单例Bean的实例化</li>
</ul>
<blockquote>
<p><strong>刷新IOC容器，refreshContext</strong>：</p>
<ul>
<li>创建容器中的所有组件（Spring注解）</li>
<li>启动内嵌的Web服务器（如Tomcat）</li>
<li>完成所有Bean的创建和依赖注入</li>
</ul>
</blockquote>
<h4 data-id="heading-10"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>6. 容器刷新后处理</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">protected</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">afterRefresh</span>(<span class="hljs-params">ConfigurableApplicationContext context,
                           ApplicationArguments args</span>) {
    <span class="hljs-comment">// 调用ApplicationRunner和CommandLineRunner</span>
}

<span class="hljs-variable constant_">AI</span>写代码java
运行
<span class="hljs-number">1234</span>
</code></pre>
<h4 data-id="heading-11"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>7. 调用Runners</h4>
<pre><code class="hljs language-scss" lang="scss">private void <span class="hljs-built_in">callRunners</span>(ApplicationContext context, ApplicationArguments args) {
    List&lt;<span class="hljs-selector-tag">Object</span>&gt; runners = new ArrayList&lt;&gt;();
    
    <span class="hljs-comment">// 获取容器中的ApplicationRunner</span>
    runners<span class="hljs-selector-class">.addAll</span>(context.getBeansOfType(ApplicationRunner.class)<span class="hljs-selector-class">.values</span>());
    
    <span class="hljs-comment">// 获取容器中的CommandLineRunner  </span>
    runners<span class="hljs-selector-class">.addAll</span>(context.getBeansOfType(CommandLineRunner.class)<span class="hljs-selector-class">.values</span>());
    
    <span class="hljs-comment">// 合并所有runner并且按照@Order进行排序</span>
    AnnotationAwareOrderComparator<span class="hljs-selector-class">.sort</span>(runners);
    
    <span class="hljs-comment">// 遍历所有的runner，调用run方法</span>
    for (Object runner : new LinkedHashSet&lt;&gt;(runners)) {
        if (runner instanceof ApplicationRunner) {
            <span class="hljs-built_in">callRunner</span>((ApplicationRunner) runner, args);
        }
        if (runner instanceof CommandLineRunner) {
            <span class="hljs-built_in">callRunner</span>((CommandLineRunner) runner, args);
        }
    }
}

AI写代码java
运行
<span class="hljs-number">12345678910111213141516171819202122</span>
</code></pre>
<blockquote>
<p><strong>调用所有runners</strong>：</p>
<ul>
<li>获取容器中的 <code>ApplicationRunner</code></li>
<li>获取容器中的 <code>CommandLineRunner</code></li>
<li>合并所有runner并且按照Order进行排序</li>
<li>遍历所有的runner，调用run方法</li>
</ul>
</blockquote>
<h4 data-id="heading-12"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>8. 启动完成事件发布</h4>
<pre><code class="hljs language-lua" lang="lua">// 所有监听器调用listeners.started(context)，通知所有的监听器started
listeners.started(context);

// 调用所有监听器的<span class="hljs-built_in">running</span>方法listeners.<span class="hljs-built_in">running</span>(context)，通知所有的监听器<span class="hljs-built_in">running</span>  
listeners.<span class="hljs-built_in">running</span>(context);

AI写代码java
运行
<span class="hljs-number">12345</span>
</code></pre>
<h4 data-id="heading-13"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>9. 异常处理</h4>
<p>在整个启动过程中，如果出现异常，会进行相应的处理：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 启动流程...</span>
} <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Throwable</span> ex) {
    <span class="hljs-comment">// 调用Listener的failed方法，通知所有的监听器启动失败</span>
    <span class="hljs-title function_ invoke__">handleRunFailure</span>(context, ex, listeners);
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(ex);
}

AI写代码java
运行
<span class="hljs-number">1234567</span>
</code></pre>
<blockquote>
<p><strong>异常处理机制</strong>：</p>
<ul>
<li>如果以上有异常，调用<code>Listener</code>的failed</li>
<li>调用所有监听器的running方法，如果running有问题，继续通知failed</li>
</ul>
</blockquote>
<h3 data-id="heading-14"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>三、关键组件详解</h3>
<h4 data-id="heading-15"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>1. 事件监听机制</h4>
<p>SpringBoot的启动过程通过事件监听机制实现了高度的扩展性：</p>
<ul>
<li><strong>ApplicationStartingEvent</strong>: 应用启动开始时发布</li>
<li><strong>ApplicationEnvironmentPreparedEvent</strong>: 环境准备完成后发布</li>
<li><strong>ApplicationContextInitializedEvent</strong>: 应用上下文初始化后发布</li>
<li><strong>ApplicationPreparedEvent</strong>: Bean定义加载完成后发布</li>
<li><strong>ApplicationStartedEvent</strong>: 应用启动完成后发布</li>
<li><strong>ApplicationReadyEvent</strong>: 应用准备就绪后发布</li>
<li><strong>ApplicationFailedEvent</strong>: 启动失败时发布</li>
</ul>
<h4 data-id="heading-16"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. Runner接口</h4>
<p><code>ApplicationRunner</code>和<code>CommandLineRunner</code>提供了在应用启动后执行特定代码的机制：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Order(1)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyApplicationRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ApplicationRunner</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(ApplicationArguments args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 应用启动后执行的逻辑</span>
        System.out.println(<span class="hljs-string">"ApplicationRunner执行完成"</span>);
    }
}

<span class="hljs-meta">@Component</span>  
<span class="hljs-meta">@Order(2)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCommandLineRunner</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommandLineRunner</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(String... args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 命令行参数处理逻辑</span>
        System.out.println(<span class="hljs-string">"CommandLineRunner执行完成"</span>);
    }
}

AI写代码java
运行
<span class="hljs-number">123456789101112131415161718192021</span>
</code></pre>
<h3 data-id="heading-17"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>总结</h3>
<p>SpringBoot的启动过程是一个精心设计的流程，通过模块化的设计和事件驱动机制，实现了高度的可扩展性和灵活性。理解这个启动过程对于深入掌握SpringBoot框架、进行自定义扩展和故障排查都具有重要意义。</p>
<p>整个启动过程从创建SpringApplication实例开始，经过环境准备、容器创建、Bean加载、后置处理等多个阶段，最终完成应用的启动并对外提供服务。每个阶段都提供了相应的扩展点，允许开发者在适当的时机介入并添加自定义逻辑。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose 实战：自定义自适应分段按钮 (Segmented Button)]]></title>    <link>https://juejin.cn/post/7574600119750230026</link>    <guid>https://juejin.cn/post/7574600119750230026</guid>    <pubDate>2025-11-20T07:49:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574600119750230026" data-draft-id="7574382925761576998" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose 实战：自定义自适应分段按钮 (Segmented Button)"/> <meta itemprop="keywords" content="Android,Android Jetpack"/> <meta itemprop="datePublished" content="2025-11-20T07:49:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雨白"/> <meta itemprop="url" content="https://juejin.cn/user/2549135752044601"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose 实战：自定义自适应分段按钮 (Segmented Button)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2549135752044601/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雨白
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:49:05.000Z" title="Thu Nov 20 2025 07:49:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>如果要从并排显示的选项中选择，我们可以使用<strong>分段按钮（Segmented Button）</strong>。</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65301f9e354c4377a1b2f84261da6b1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229744&amp;x-signature=z4uQwCvQRJbKnNrZi0JILpnEq6Y%3D" alt="image.png" width="100%" loading="lazy"/>
<p>图片来自：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fdevelop%2Fui%2Fcompose%2Fcomponents%2Fsegmented-button%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.com/develop/ui/compose/components/segmented-button?hl=zh-cn" ref="nofollow noopener noreferrer">分段按钮</a></p>
<p>分段按钮有两种类型：<strong>单选</strong>和<strong>多选</strong>，对应了 <code>SingleChoiceSegmentedButtonRow</code> 和 <code>MultiChoiceSegmentedButtonRow</code> 布局。</p>
<p>我这里只演示一下单选分段按钮。</p>
<h2 data-id="heading-1">单选分段按钮</h2>
<p>代码如下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Preview</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">SingleChoiceSegmentedButton</span><span class="hljs-params">()</span></span> {
    <span class="hljs-comment">// 当前选中按钮的索引</span>
    <span class="hljs-keyword">var</span> selectedIndex <span class="hljs-keyword">by</span> remember { mutableIntStateOf(<span class="hljs-number">0</span>) }
    <span class="hljs-keyword">val</span> options = listOf(<span class="hljs-string">"Sleep"</span>, <span class="hljs-string">"Work"</span>)

    SingleChoiceSegmentedButtonRow {
        options.forEachIndexed { index, label -&gt;
            SegmentedButton(
                <span class="hljs-comment">// 根据按钮索引和按钮总数获取按钮的形状</span>
                <span class="hljs-comment">// 只有一项时：全圆；</span>
                <span class="hljs-comment">// 第一项：起始端圆角（Start）；</span>
                <span class="hljs-comment">// 最后一项：末端圆角（End）；</span>
                <span class="hljs-comment">// 中间项：直角</span>
                shape = SegmentedButtonDefaults.itemShape(
                    index = index,
                    count = options.size
                ),
                onClick = { selectedIndex = index },
                selected = index == selectedIndex,
                label = { Text(label) }
            )
        }
    }
}
</code></pre>
<p>运行效果：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed832b3d31d448eaa24651d6dba05ab4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229744&amp;x-signature=48qN63ALlfBTwo5v6sdrIc8%2BJAM%3D" alt="image.png" width="50%" loading="lazy"/>
<p>上述代码逻辑并不难，我们只是提供了一个标签列表 <code>[ "Sleep", "Work" ]</code>，然后使用了 <code>SingleChoiceSegmentedButtonRow</code> 和 <code>SegmentedButton</code> 的组合，就实现了以上效果。</p>
<p>这个效果在大多时候都很不错，但有时按钮中的文本会显得有些拥挤，例如：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/519747d53d2043d3a47c9ef640f3e833~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229744&amp;x-signature=8DsRRg5F29iitr0%2B%2Fi%2BJU3GfURg%3D" alt="image.png" width="35%" loading="lazy"/>
<p>这时，我们就需要自定义组件，让被选中的按钮的大小动态变化。</p>
<h2 data-id="heading-2">自适应分段按钮</h2>
<p>分段按钮的 Material 3 规范：<a href="https://link.juejin.cn?target=https%3A%2F%2Fm3.material.io%2Fcomponents%2Fsegmented-buttons%2Foverview" target="_blank" title="https://m3.material.io/components/segmented-buttons/overview" ref="nofollow noopener noreferrer">Segmented buttons</a></p>
<p>首先定义出可选项的数据模型：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Immutable</span> <span class="hljs-comment">// 优化重组检查</span>
<span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OptionItem</span>&lt;<span class="hljs-type">T</span>&gt;(
    <span class="hljs-keyword">val</span> value: T,
    <span class="hljs-keyword">val</span> label: String,
    <span class="hljs-keyword">val</span> selected: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>
)
</code></pre>
<p>然后就来完成外面的布局和内部的每一项：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">LitheSegmentedButton</span><span class="hljs-params">(
    modifier: <span class="hljs-type">Modifier</span> = Modifier,
    items: <span class="hljs-type">List</span>&lt;<span class="hljs-type">OptionItem</span>&lt;<span class="hljs-type">T</span>&gt;&gt;,
    onClick: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>
)</span></span> {
    <span class="hljs-keyword">val</span> itemSize = items.size
    
    <span class="hljs-comment">// 外层容器：负责绘制整体的边框和圆角</span>
    Row(
        modifier = modifier
            .clip(CircleShape)
            .border(
                width = <span class="hljs-number">0.5</span>.dp,
                color = SegmentedButtonDefaults.colors().activeBorderColor,
                shape = CircleShape
            )
            .padding(<span class="hljs-number">0.5</span>.dp)
    ) {
        items.forEachIndexed { index, item -&gt;
            <span class="hljs-comment">// 缓存 Shape 对象，避免每次重组时都重新创建</span>
            <span class="hljs-keyword">val</span> shape = remember(index, itemSize) {
                itemShape(index, itemSize)
            }

            SingleSegmentedButton(
                item = item,
                shape = shape,
                onClick = { onClick(item.value) }
            )
        }
    }
}

<span class="hljs-meta">@Composable</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">SingleSegmentedButton</span><span class="hljs-params">(
    item: <span class="hljs-type">OptionItem</span>&lt;<span class="hljs-type">T</span>&gt;,
    shape: <span class="hljs-type">Shape</span>,
    colors: <span class="hljs-type">SegmentedButtonColors</span> = SegmentedButtonDefaults.colors()</span></span>,
    onClick: () -&gt; <span class="hljs-built_in">Unit</span>
) {
    Row(
        Modifier
            .height(<span class="hljs-number">40.</span>dp)
            .clip(shape)
            .clickable(onClick = onClick)
            .border(
                width = <span class="hljs-number">0.5</span>.dp,
                color = colors.activeBorderColor,
                shape = shape
            )
            .padding(<span class="hljs-number">0.5</span>.dp)
            .background( <span class="hljs-comment">// 选中状态下的背景色</span>
                <span class="hljs-keyword">if</span> (item.selected) colors.activeContainerColor
                <span class="hljs-keyword">else</span> Color.Transparent,
                shape = shape
            )
            .padding(horizontal = <span class="hljs-number">18.</span>dp),
        verticalAlignment = Alignment.CenterVertically
    ) {
        <span class="hljs-keyword">if</span> (item.selected) {
            Row {
                Icon(
                    imageVector = Icons.Default.Done,
                    contentDescription = <span class="hljs-literal">null</span>,
                    modifier = Modifier
                        .size(<span class="hljs-number">18.</span>dp),
                    tint = colors.activeContentColor
                )
                Spacer(modifier = Modifier.width(<span class="hljs-number">8.</span>dp))
            }
        }

        Text(
            text = item.label,
            style = MaterialTheme.typography.labelLarge.copy(
                color = <span class="hljs-keyword">if</span> (item.selected) colors.activeContentColor
                <span class="hljs-keyword">else</span> colors.inactiveContentColor
            )
        )
    }
}

<span class="hljs-comment">/**
 * 根据索引和总数计算按钮的形状
 */</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">itemShape</span><span class="hljs-params">(index: <span class="hljs-type">Int</span>, count: <span class="hljs-type">Int</span>)</span></span>: Shape {
    <span class="hljs-keyword">if</span> (count == <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> CircleShape
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">when</span> (index) {
        <span class="hljs-comment">// 第一个：起始端（左侧）圆角</span>
        <span class="hljs-number">0</span> -&gt; RoundedCornerShape(topStartPercent = <span class="hljs-number">50</span>, bottomStartPercent = <span class="hljs-number">50</span>)
        <span class="hljs-comment">// 最后一个：末端（右侧）圆角</span>
        count - <span class="hljs-number">1</span> -&gt; RoundedCornerShape(topEndPercent = <span class="hljs-number">50</span>, bottomEndPercent = <span class="hljs-number">50</span>)
        <span class="hljs-comment">// 中间：直角</span>
        <span class="hljs-keyword">else</span> -&gt; RoundedCornerShape(<span class="hljs-number">0</span>)
    }
}
</code></pre>
<p>预览一下：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Preview(showBackground = true)</span>
<span class="hljs-meta">@Composable</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">LitheSegmentedButtonPreview</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">var</span> selectedIndex <span class="hljs-keyword">by</span> remember { mutableIntStateOf(<span class="hljs-number">0</span>) }
    <span class="hljs-keyword">val</span> items = listOf(
        OptionItem(<span class="hljs-number">0</span>, <span class="hljs-string">"Day"</span>, selected = selectedIndex == <span class="hljs-number">0</span>),
        OptionItem(<span class="hljs-number">1</span>, <span class="hljs-string">"Month"</span>, selected = selectedIndex == <span class="hljs-number">1</span>),
        OptionItem(<span class="hljs-number">2</span>, <span class="hljs-string">"Week"</span>, selected = selectedIndex == <span class="hljs-number">2</span>),
    )
    Box(modifier = Modifier.fillMaxSize()) {
        LitheSegmentedButton(
            items = items,
            onClick = {
                selectedIndex = it
            },
            modifier = Modifier.align(Alignment.Center)
        )
    }
}
</code></pre>
<p>运行效果：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc7517525ff5485cbc92d9a6ef545ec4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229744&amp;x-signature=U42jfRcYhzVYz4mXRENdd2L6dOg%3D" alt="Screen_recording_20251120_144129.gif" width="50%" loading="lazy"/>
<p>最后一步就是加上动画，我们使用 <code>AnimatedVisibility</code> 来完成。</p>
<blockquote>
<p>具体内容可以看我的这篇博客：<a href="https://juejin.cn/post/7505357994622222374#heading-2" target="_blank" title="https://juejin.cn/post/7505357994622222374#heading-2">控制内容的显隐：AnimatedVisibility</a></p>
</blockquote>
<p>为了实现“推动”效果，我们使用了 <code>expandIn</code> 和 <code>shrinkOut</code>。并且为了让这个效果看起来更好，又加上淡入淡出、缩放以及滑动效果：</p>
<ul>
<li>出现时，是淡入、水平展开、缩放以及轻微的纵向滑入效果。</li>
<li>离开时，则是淡出、水平收缩、缩放以及纵向滑出的组合。</li>
</ul>
<pre><code class="hljs language-kotlin" lang="kotlin">AnimatedVisibility(
    visible = item.selected,
    enter = fadeIn() + expandHorizontally() + scaleIn() + slideInVertically(initialOffsetY = { it / <span class="hljs-number">2</span> }),
    exit = fadeOut() + shrinkHorizontally() + scaleOut() + slideOutVertically(targetOffsetY = { it / <span class="hljs-number">2</span> })
) {
    Row {
        Icon(
            imageVector = Icons.Default.Done,
            contentDescription = <span class="hljs-literal">null</span>,
            modifier = Modifier
                .size(<span class="hljs-number">18.</span>dp),
            tint = colors.activeContentColor
        )
        Spacer(modifier = Modifier.width(<span class="hljs-number">8.</span>dp))
    }
}
</code></pre>
<p>最终效果：</p>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6989a86ee1d43df94956d81bd157007~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zuo55m9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229744&amp;x-signature=Rnep0fU4Tr6Dd3SvblITGdb4t%2BY%3D" alt="Screen_recording_20251120_145947.gif" width="50%" loading="lazy"/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[秒杀库存扣减用redis原子自增的巨坑]]></title>    <link>https://juejin.cn/post/7574615024292479002</link>    <guid>https://juejin.cn/post/7574615024292479002</guid>    <pubDate>2025-11-20T07:48:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574615024292479002" data-draft-id="7574600119750131722" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="秒杀库存扣减用redis原子自增的巨坑"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T07:48:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ruokkk"/> <meta itemprop="url" content="https://juejin.cn/user/2060939282094124"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            秒杀库存扣减用redis原子自增的巨坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2060939282094124/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ruokkk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:48:34.000Z" title="Thu Nov 20 2025 07:48:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是一个非常经典的**“看似可行，实则巨坑”**的方案。</p>
<p>因为为了防止库存回补，所以你需要保证库存不能为负数，
所以，你在代码层面的逻辑是：</p>
<ol>
<li><code>redis.decr(key)</code></li>
<li><code>if (返回值 &lt; 0) { redis.incr(key); return "失败"; }</code></li>
</ol>
<p><strong>结论是：千万不要这样写。</strong></p>
<p>虽然逻辑上看起来“借了再还”最后是平的，但在生产环境（特别是高并发或不稳定网络环境）下，这会引发<strong>数据永久不一致</strong>和<strong>性能雪崩</strong>。</p>
<p>主要有以下 3 个致命缺陷：</p>
<h3 data-id="heading-0">1. 致命缺陷：网络中断或服务崩溃导致“只减不加”</h3>
<p>这是最大的风险点。因为 <code>DECR</code> 和 <code>INCR</code> 是<strong>两次独立的网络请求</strong>，它们之间没有原子性保护。</p>
<p><strong>场景推演：</strong></p>
<ol>
<li>当前库存为 0。</li>
<li>线程 A 发起 <code>DECR</code>，Redis 执行成功，库存变为 -1。</li>
<li>线程 A 收到返回值 -1，准备发起 <code>INCR</code> 进行补偿回滚。</li>
<li><strong>就在这毫秒之间，发生了意外：</strong>
<ul>
<li><strong>情况一：</strong> 线程 A 所在的服务器宕机/重启了（比如被 Kubernetes OOM Kill 了）。</li>
<li><strong>情况二：</strong> 网络抖动，线程 A 发出的 <code>INCR</code> 请求包丢了，或者 Redis 的响应包丢了导致超时异常。</li>
</ul>
</li>
<li><strong>结果：</strong> <code>INCR</code> 永远没有被执行。</li>
<li><strong>后果：</strong> Redis 里的库存<strong>永久停留在 -1</strong>。
<ul>
<li>接着有人退款（真正的回滚），库存变成了 0。</li>
<li>本来应该恢复成 1 个库存给别人抢，现在因为那个永久的 -1，这 1 个库存被“吞”了。</li>
<li><strong>这就是典型的“库存泄露”。</strong></li>
</ul>
</li>
</ol>
<h3 data-id="heading-1">2. 性能缺陷：Redis 写压力翻倍（写放大）</h3>
<p>Redis 的读性能极高，但写性能相对昂贵（涉及到 AOF 刷盘、主从同步）。</p>
<p><strong>场景推演：</strong>
假设库存 0，这时候来了 10,000 个并发请求。</p>
<ul>
<li>
<p><strong>使用 Lua 脚本：</strong></p>
<ul>
<li>10,000 个请求 -&gt; Redis 执行 Lua -&gt; 判断 <code>stock &lt;= 0</code> -&gt; 直接返回 0。</li>
<li><strong>Redis 实际发生的写操作：0 次</strong>（因为没有实际扣减）。</li>
<li>Redis 只是做了一次内存读取和逻辑判断，速度飞快，不产生 AOF 日志。</li>
</ul>
</li>
<li>
<p><strong>使用 DECR + INCR 补偿方案：</strong></p>
<ul>
<li>10,000 个请求 -&gt; 10,000 次 <code>DECR</code>（库存狂掉到 -10000）。</li>
<li>10,000 个请求发现小于 0 -&gt; 10,000 次 <code>INCR</code>（库存慢慢加回 0）。</li>
<li><strong>Redis 实际发生的写操作：20,000 次！</strong></li>
<li>这 2 万次操作全部要写 AOF 日志，全部要同步给从节点（Slave）。</li>
<li><strong>后果：</strong> 在没货的时候，反而把 Redis 的磁盘 IO 和网络带宽打满了，可能直接把 Redis 搞挂。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">3. 竞态与监控干扰</h3>
<ul>
<li><strong>监控报警失效：</strong> 正常运维中，我们通常会设置“库存 &lt; 0 报警”。如果你用这种方案，库存会频繁在负数跳动，报警系统会一直响，导致你无法区分是“真的出 Bug 了”还是“正常的补偿逻辑”。</li>
<li><strong>并发视觉干扰：</strong> 在高并发瞬间，你通过 Redis 客户端查看库存，可能会看到 <code>-500</code> 这种数字，很难排查问题。</li>
</ul>
<hr/>
<h3 data-id="heading-3">总结</h3>
<p><strong>Lua 脚本的本质不仅仅是逻辑判断，更是为了“原子性”和“减少无效写操作”。</strong></p>






























<table><thead><tr><th align="left">特性</th><th align="left">Lua 脚本方案</th><th align="left">DECR + INCR 补偿方案</th></tr></thead><tbody><tr><td align="left"><strong>原子性</strong></td><td align="left"><strong>完全原子</strong>（要么全做，要么不做）</td><td align="left"><strong>无原子性</strong>（两个独立步骤，中间可能断开）</td></tr><tr><td align="left"><strong>故障后果</strong></td><td align="left">即使服务崩了，库存依然准确</td><td align="left"><strong>服务崩了 = 库存永久变负</strong></td></tr><tr><td align="left"><strong>Redis 写压力</strong></td><td align="left">库存不足时，<strong>0 写操作</strong></td><td align="left">库存不足时，<strong>2倍 写操作</strong>（最致命）</td></tr><tr><td align="left"><strong>推荐指数</strong></td><td align="left">⭐⭐⭐⭐⭐</td><td align="left">☠️ (绝对禁止)</td></tr></tbody></table>
<p>所以，<strong>宁愿多写几行 Lua 脚本代码，也不要为了省事用 <code>DECR</code> 后再 <code>INCR</code>，风险成本太高了。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Array.isArray()性能测试]]></title>    <link>https://juejin.cn/post/7574404398066302976</link>    <guid>https://juejin.cn/post/7574404398066302976</guid>    <pubDate>2025-11-20T07:23:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574404398066302976" data-draft-id="7574601160980627471" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Array.isArray()性能测试"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-11-20T07:23:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="英俊潇洒的码农"/> <meta itemprop="url" content="https://juejin.cn/user/2488950053668439"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Array.isArray()性能测试
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2488950053668439/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    英俊潇洒的码农
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:23:44.000Z" title="Thu Nov 20 2025 07:23:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>要确定 <code>Object.prototype.toString.call(val).slice(8, -1).toLowerCase()==='array'</code> 与 <code>Array.isArray()</code> 之间的性能差异，可以通过基准测试来量化比较。以下是逐步验证过程：</p>
<hr/>
<h3 data-id="heading-0"><strong>1. 性能基准测试代码</strong></h3>
<p>使用 <code>console.time()</code> 进行简单测试（或专业工具如 <strong>Benchmark.js</strong>）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">const</span> iterations = <span class="hljs-number">1000000</span>;

<span class="hljs-comment">// 测试 Object.prototype.toString 方法</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'toString'</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; iterations; i++) {
  <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(arr).<span class="hljs-title function_">slice</span>(<span class="hljs-number">8</span>, -<span class="hljs-number">1</span>).<span class="hljs-title function_">toLowerCase</span>() === <span class="hljs-string">'array'</span>;
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'toString'</span>);

<span class="hljs-comment">// 测试 Array.isArray 方法</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'isArray'</span>);
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; iterations; i++) {
  <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(arr);
}
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'isArray'</span>);
</code></pre>
<hr/>
<h3 data-id="heading-1"><strong>2. 测试结果（Chrome 118 实测）</strong></h3>

















<table><thead><tr><th>方法</th><th>耗时（100万次迭代）</th></tr></thead><tbody><tr><td><code>Object.prototype.toString</code></td><td><strong>~480ms</strong></td></tr><tr><td><code>Array.isArray</code></td><td><strong>~5ms</strong></td></tr></tbody></table>
<p><strong><code>Array.isArray</code> 快约 95 倍</strong>，且代码更简洁。</p>
<hr/>
<h3 data-id="heading-2"><strong>3. 为什么 <code>Array.isArray</code> 更快？</strong></h3>
<ul>
<li><strong>原生优化</strong>：<code>Array.isArray</code> 是引擎内置的 <strong>原生函数</strong>（如 V8 的 <code>Builtin_IsArray</code>），直接检查对象的内部 [[Class]] 属性，无需字符串操作。</li>
<li><strong>避免中间步骤</strong>：<code>toString</code> 方法需要：
<ol>
<li>调用 <code>Object.prototype.toString</code> 生成字符串（如 <code>"[object Array]"</code>）。</li>
<li>执行 <code>.slice(8, -1)</code> 提取 <code>"Array"</code>。</li>
<li>调用 <code>.toLowerCase()</code> 转换为 <code>"array"</code>。
这些步骤涉及内存分配和字符串操作，而 <code>Array.isArray</code> 直接返回布尔值。</li>
</ol>
</li>
</ul>
<hr/>
<h3 data-id="heading-3"><strong>4. 结论</strong></h3>
<ul>
<li><strong>性能</strong>：<code>Array.isArray</code> 远超 <code>toString</code> 方法（差异可达两个数量级）。</li>
<li><strong>可靠性</strong>：两者结果一致，但 <code>Array.isArray</code> 是 <strong>ECMAScript 5+ 标准</strong>，所有现代环境均支持。</li>
<li><strong>最佳实践</strong>：<strong>永远优先使用 <code>Array.isArray</code></strong>，仅在需要兼容极旧环境（如 IE8 及以下）时退而求其次。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Element 面板 - 查看 Shadow DOM - 浏览器原生组件内部结构]]></title>    <link>https://juejin.cn/post/7574530224853139462</link>    <guid>https://juejin.cn/post/7574530224853139462</guid>    <pubDate>2025-11-20T07:32:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574530224853139462" data-draft-id="7574451949326270505" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Element 面板 - 查看 Shadow DOM - 浏览器原生组件内部结构"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-20T07:32:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="梨子同志"/> <meta itemprop="url" content="https://juejin.cn/user/2084329779627965"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Element 面板 - 查看 Shadow DOM - 浏览器原生组件内部结构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2084329779627965/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    梨子同志
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:32:24.000Z" title="Thu Nov 20 2025 07:32:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">功能说明</h3>
<p>浏览器原生组件（如 <code>&lt;input&gt;</code>、<code>&lt;video&gt;</code>、<code>&lt;select&gt;</code> 等）内部使用 <strong>Shadow DOM</strong> 封装结构和样式。Shadow DOM 是 Web Components 的核心技术，用于隔离组件内部代码，避免与外部冲突。</p>
<p><strong>关于样式前缀</strong>：自定义原生组件样式时常见 <code>-webkit-</code> 前缀（如 <code>::-webkit-scrollbar</code>），这是 WebKit/Blink 引擎特有的伪元素选择器。由于 Chrome、Safari、Edge (新版) 等主流浏览器均使用该引擎，<code>-webkit-</code> 已成为事实标准。Firefox 等浏览器也支持部分 <code>-webkit-</code> 伪元素以保持兼容性。</p>
<h3 data-id="heading-1">开启方法</h3>
<ol>
<li>打开开发者工具（F12）→ 设置 ⚙️（或按 F1）</li>
<li><strong>Preferences</strong> → <strong>Elements</strong> → 勾选 <strong>Show user agent shadow DOM</strong></li>
</ol>
<h3 data-id="heading-2">实际案例：查看 input[type="range"] 滑块的内部结构</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"range"</span> <span class="hljs-attr">min</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">max</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"50"</span>&gt;</span>
</code></pre>
<p><strong>开启 Shadow DOM 后</strong>，在 Elements 面板中可以看到：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"range"</span> <span class="hljs-attr">min</span>=<span class="hljs-string">"0"</span> <span class="hljs-attr">max</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"50"</span>&gt;</span>
  #shadow-root (user-agent)
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"track"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"thumb"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>自定义滑块样式</strong>：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 修改滑块按钮（拖动的圆点） */</span>
<span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"range"</span>]</span>::-webkit-slider-thumb {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#3498db</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
}

<span class="hljs-comment">/* 修改滑动轨道 */</span>
<span class="hljs-selector-tag">input</span><span class="hljs-selector-attr">[type=<span class="hljs-string">"range"</span>]</span>::-webkit-slider-runnable-track {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#ddd</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}
</code></pre>
<p>⚠️ <strong>兼容性提示</strong>：这些是非标准特性，主流浏览器使用 <code>-webkit-</code> 前缀即可</p>
<h3 data-id="heading-3">常用伪元素选择器</h3>













































<table><thead><tr><th>元素</th><th>伪元素选择器</th><th>说明</th></tr></thead><tbody><tr><td><code>&lt;input type="range"&gt;</code></td><td><code>::-webkit-slider-thumb</code></td><td>滑块按钮</td></tr><tr><td><code>&lt;input type="range"&gt;</code></td><td><code>::-webkit-slider-runnable-track</code></td><td>滑动轨道</td></tr><tr><td><code>&lt;input type="search"&gt;</code></td><td><code>::-webkit-search-cancel-button</code></td><td>清除按钮</td></tr><tr><td><code>&lt;input type="file"&gt;</code></td><td><code>::-webkit-file-upload-button</code></td><td>文件上传按钮</td></tr><tr><td><code>&lt;input type="date"&gt;</code></td><td><code>::-webkit-calendar-picker-indicator</code></td><td>日历图标</td></tr><tr><td><code>&lt;progress&gt;</code></td><td><code>::-webkit-progress-bar</code></td><td>进度条容器</td></tr><tr><td><code>&lt;progress&gt;</code></td><td><code>::-webkit-progress-value</code></td><td>进度条值</td></tr></tbody></table>
<h3 data-id="heading-4">总结</h3>
<ul>
<li>✅ 开启 <strong>Show user agent shadow DOM</strong> 可查看浏览器组件内部结构</li>
<li>✅ 使用 <code>-webkit-</code> 伪元素选择器自定义样式（非标准特性，注意兼容性）</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🧸 前端不是只会写管理后台，我用 400 行代码画了一个 LABUBU ！ | 掘金一周 11.20]]></title>    <link>https://juejin.cn/post/7574529034672832547</link>    <guid>https://juejin.cn/post/7574529034672832547</guid>    <pubDate>2025-11-20T07:52:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574529034672832547" data-draft-id="7574383670435201076" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🧸 前端不是只会写管理后台，我用 400 行代码画了一个 LABUBU ！ | 掘金一周 11.20"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-11-20T07:52:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="掘金一周"/> <meta itemprop="url" content="https://juejin.cn/user/53218623894222"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🧸 前端不是只会写管理后台，我用 400 行代码画了一个 LABUBU ！ | 掘金一周 11.20
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/53218623894222/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    掘金一周
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:52:42.000Z" title="Thu Nov 20 2025 07:52:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><em>本文字数1800+ ，阅读时间大约需要 5分钟。</em></p>
<blockquote>
<p>【掘金一周】本期亮点：</p>
</blockquote>
<ul>
<li>
<p><a href="https://juejin.cn/post/7570260758061891619" target="_blank" title="https://juejin.cn/post/7570260758061891619">Cursor Agents + Holopix AI | 轻松实现 "🐦坤坤" 自走棋小游戏</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7570630923710054452" target="_blank" title="https://juejin.cn/post/7570630923710054452">我用AI重构了一段500行的屎山代码，这是我的Prompt和思考过程</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7571355989133099023" target="_blank" title="https://juejin.cn/post/7571355989133099023">当上传不再只是 /upload，我们是怎么设计大文件上传的</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7571693273728696356" target="_blank" title="https://juejin.cn/post/7571693273728696356">Flutter 3.38 发布，快来看看有什么更新吧</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7571693273728942116" target="_blank" title="https://juejin.cn/post/7571693273728942116">Dart 3.10 发布，快来看有什么更新吧</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7571378103281549318" target="_blank" title="https://juejin.cn/post/7571378103281549318">AIGC时代的必备技能--Prompt工程</a></p>
</li>
<li>
<p><a href="https://juejin.cn/post/7571306072423448618" target="_blank" title="https://juejin.cn/post/7571306072423448618">来了解一下，为什么你的 Flutter WebView 在 iOS 26 上有点击问题？</a></p>
</li>
</ul>
<blockquote>
<p><strong>「上榜规则」</strong>：文章发布时间在本期「掘金一周」发布时间的前一周内；且符合各个栏目的内容定位和要求。 如发现文章有抄袭、洗稿等违反社区规则的行为，将取消当期及后续上榜资格。</p>
</blockquote>
<h2 data-id="heading-0">一周“金”选</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73d5bf990a124e3a87cffb06443ad9ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5LiA5ZGo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229962&amp;x-signature=Xt4B1Fq%2FNWuH%2Fpbkwp3x%2B4m%2FRGw%3D" alt="掘金一周 文章头图 1303x734.jpg" loading="lazy"/></p>
<p><em>内容评审们会在过去的一周内对社区深度技术好文进行挖掘和筛选，优质的技术文章有机会出现在下方榜单中，排名不分先后。</em></p>
<h3 data-id="heading-1">前端</h3>
<p><a href="https://juejin.cn/post/7570260758061891619" target="_blank" title="https://juejin.cn/post/7570260758061891619">Cursor Agents + Holopix AI | 轻松实现 "🐦坤坤" 自走棋小游戏</a> <a href="https://juejin.cn/user/4142615541321928/posts" target="_blank" title="https://juejin.cn/user/4142615541321928/posts">@coder_pig</a></p>
<blockquote>
<p>本文介绍了借助“Cursor Agents模式”与“Holopix AI”开发“🐦坤坤自走棋”小游戏的过程。先进行玩法设计与Demo开发，再用Holopix AI定制模型生成游戏素材，包括英雄、怪物、背景、神器等，最终实现单机小游戏。</p>
</blockquote>
<p><a href="https://juejin.cn/post/7570630923710054452" target="_blank" title="https://juejin.cn/post/7570630923710054452">我用AI重构了一段500行的屎山代码，这是我的Prompt和思考过程</a> <a href="https://juejin.cn/user/3878732754331096/posts" target="_blank" title="https://juejin.cn/user/3878732754331096/posts">@ErpanOmer</a></p>
<blockquote>
<p>作者所在团队维护的中后台项目里有个500行的 <code>handleOrderSubmit.js</code> 文件难以重构。作者采用五步重构法，让 AI 执行，自己决策，将代码拆解成模块，最终仅用5小时完成重构，还加入新功能，效率大幅提升。</p>
</blockquote>
<p><a href="https://juejin.cn/post/7571846248719581184" target="_blank" title="https://juejin.cn/post/7571846248719581184">🧸 前端不是只会写管理后台，我用 400 行代码画了一个 LABUBU ！</a> <a href="https://juejin.cn/user/3183831378302871/posts" target="_blank" title="https://juejin.cn/user/3183831378302871/posts">@xiaohe0601</a></p>
<blockquote>
<p>作者作为前端开发工程师，为夺回被“黄牛”占据的权益，用 400 行代码画了专属 LABUBU。借助 Leafer Vue，依次绘制脑袋、五官、耳朵、身体、小手和小脚，完整代码可在 leafer - labubu 仓库查看。</p>
</blockquote>
<p><a href="https://juejin.cn/post/7570268773333205019" target="_blank" title="https://juejin.cn/post/7570268773333205019">🏮一眼就会🗂️大文件分片上传，白送前后端全套功法</a> <a href="https://juejin.cn/user/2225067267199320/posts" target="_blank" title="https://juejin.cn/user/2225067267199320/posts"> @vilan_微澜</a></p>
<blockquote>
<p>本文介绍了大文件分片上传的前后端实现。前端用 Vue 3 + TS + Vite，借助 Web Worker 算文件哈希，实现秒传与断点续传；后端基于 Node.js + Express，用 formidable 处理分片。通过文件 hash 和索引标识分片，最终合并成完整文件。</p>
</blockquote>
<p><a href="https://juejin.cn/post/7570162686580523050" target="_blank" title="https://juejin.cn/post/7570162686580523050">几种虚拟列表技术方案调研</a> <a href="https://juejin.cn/user/4212984286819384/posts" target="_blank" title="https://juejin.cn/user/4212984286819384/posts"> @至简简</a></p>
<blockquote>
<p>本文围绕 Vue3 框架下的虚拟列表技术展开。介绍了虚拟列表概念、优势及 @vueuse/core 工具集。阐述四种实现方案特点、场景、代码及优缺点，给出性能对比、最佳实践、常见问题解决办法，还提供参考资源与项目搭建步骤。</p>
</blockquote>
<h3 data-id="heading-2">后端</h3>
<p><a href="https://juejin.cn/post/7571355989133099023" target="_blank" title="https://juejin.cn/post/7571355989133099023">当上传不再只是 /upload，我们是怎么设计大文件上传的</a>  <a href="https://juejin.cn/user/888839672963544/posts" target="_blank" title="https://juejin.cn/user/888839672963544/posts">@洛卡卡了</a></p>
<blockquote>
<p>文章聚焦大文件上传设计。传统SaaS上传方案不适用于政企私有化项目，前端已有成熟大文件上传模式。作者重新设计后端接口，搭配数据库表，实现状态追踪、断点续传，解决集群合并等问题，保障上传稳定可靠。</p>
</blockquote>
<p><a href="https://juejin.cn/post/7570405675432935424" target="_blank" title="https://juejin.cn/post/7570405675432935424">Cursor 无法跨项目读取源码怎么办？MCP Easy Code Reader 帮你解决！</a> <a href="https://juejin.cn/user/386633160473101/posts" target="_blank" title="https://juejin.cn/user/386633160473101/posts">@方圆想当图灵</a></p>
<blockquote>
<p>本文介绍 MCP Easy Code Reader，它可在编写代码时读取多项目或 Jar 包源码，提高 Code Agent 准确度与编码效率。阐述其最佳实践、环境要求、接入方法、常见问题及实现原理，还提及反编译器选择与缓存机制。</p>
</blockquote>
<p><a href="https://juejin.cn/post/7570187256105533446" target="_blank" title="https://juejin.cn/post/7570187256105533446">SpringBoot实现隐式参数注入</a>
<a href="https://juejin.cn/user/2524134428655159/posts" target="_blank" title="https://juejin.cn/user/2524134428655159/posts">@风象南</a></p>
<blockquote>
<p>文章围绕 Spring Boot 实现隐式参数注入展开。先指出传统方案缺陷，介绍 Spring MVC 的 HandlerMethodArgumentResolver 方案，包括设计思路、核心实现、示例及原理。还提及进阶用法，给出异常处理、集成 Spring Security、多租户场景的实战技巧。</p>
</blockquote>
<p><a href="https://juejin.cn/post/7571005077802369034" target="_blank" title="https://juejin.cn/post/7571005077802369034">得物TiDB升级实践</a> <a href="https://juejin.cn/user/2392954206960247/posts" target="_blank" title="https://juejin.cn/user/2392954206960247/posts">@得物技术</a></p>
<blockquote>
<p>得物DBA因业务增长对TiDB稳定性及性能带来挑战，决定将TiDB从5.3.3版本升级到7.5.x。升级采用迁移方式，虽遇查询问题，但升级后性能、稳定性显著提升，还带来多方面收益，未来会关注8.5.x版本进展。</p>
</blockquote>
<h3 data-id="heading-3">Android</h3>
<p><a href="https://juejin.cn/post/7571693273728696356" target="_blank" title="https://juejin.cn/post/7571693273728696356">Flutter 3.38 发布，快来看看有什么更新吧</a> <a href="https://juejin.cn/user/817692379985752/posts" target="_blank" title="https://juejin.cn/user/817692379985752/posts">@恋猫de小郭</a></p>
<blockquote>
<p>Flutter 3.38 于 11 月 13 日发布，更新丰富。涵盖 Dot shorthands、Web 支持增强、Framework 交互优化、Material 和 Cupertino 控件改进、可访问性提升。还适配 iOS 26、优化 Android 性能，DevTools 改进，有多方面弃用与变更。</p>
</blockquote>
<p><a href="https://juejin.cn/post/7571693273728942116" target="_blank" title="https://juejin.cn/post/7571693273728942116">Dart 3.10 发布，快来看有什么更新吧</a> <a href="https://juejin.cn/user/817692379985752/posts" target="_blank" title="https://juejin.cn/user/817692379985752/posts">@恋猫de小郭</a></p>
<blockquote>
<p>Dart 3.10 随 Flutter 3.38 一同更新，带来多项特性。引入 dot shorthands 简化代码，新增分析器插件系统，Build hooks 简化原生代码集成，有移除弃用项 lint 工具，新弃用注释更精确，pub.dev 管理和安全功能升级。</p>
</blockquote>
<p><a href="https://juejin.cn/post/7570299986530582555" target="_blank" title="https://juejin.cn/post/7570299986530582555">面试被问到Compose的副作用不会，只怪我没好好学</a> <a href="https://juejin.cn/user/2089524588718126/posts" target="_blank" title="https://juejin.cn/user/2089524588718126/posts">@Coffeeee</a></p>
<blockquote>
<p>本文围绕 Compose 副作用 API 展开。介绍了 DisposableEffect、SideEffect、LaunchedEffect 等多个 API 的作用与特性，如控制副作用执行阶段、处理协程及监听状态变化等，为开发者在 Compose 项目中运用副作用提供了指导。</p>
</blockquote>
<h3 data-id="heading-4">人工智能</h3>
<p><a href="https://juejin.cn/post/7571378103281549318" target="_blank" title="https://juejin.cn/post/7571378103281549318">AIGC时代的必备技能--Prompt工程</a> <a href="https://juejin.cn/user/3672799326256360/posts" target="_blank" title="https://juejin.cn/user/3672799326256360/posts">@离开地球表面_99</a></p>
<blockquote>
<p>本文围绕提示工程展开，介绍其是通过设计高质量提示词引导大模型精准输出的过程。阐述了LLM输出配置要点，如输出长度、采样控制等，还分享多种提示词技巧及最佳实践，帮助开发者提升大模型使用效果。</p>
</blockquote>
<p><a href="https://juejin.cn/post/7570902473433825280" target="_blank" title="https://juejin.cn/post/7570902473433825280">图解源码：万字解析 Spring AI 到底是怎么实现 MCP 的（源码部分）</a> <a href="https://juejin.cn/user/3653045848387931/posts" target="_blank" title="https://juejin.cn/user/3653045848387931/posts"> @小璐乱撞</a></p>
<blockquote>
<p>本文围绕 Spring AI 实现 MCP 展开，从客户端和服务端两方面详细解析。客户端含入口、运行、会话、传输层；服务端有入口、运行、会话管理、会话、传输层，各层介绍涉及类、方法及核心源码。</p>
</blockquote>
<h3 data-id="heading-5">IOS</h3>
<p><a href="https://juejin.cn/post/7571306072423448618" target="_blank" title="https://juejin.cn/post/7571306072423448618">来了解一下，为什么你的 Flutter WebView 在 iOS 26 上有点击问题？</a> <a href="https://juejin.cn/user/817692379985752/posts" target="_blank" title="https://juejin.cn/user/817692379985752/posts">@恋猫de小郭</a></p>
<blockquote>
<p>文章围绕 Flutter WebView 在 iOS 26 上的点击问题展开。该问题源于 WKWebView 与 Flutter 手势识别器冲突，iOS 18.2 临时方案在 iOS 26 引发新问题。目前可通过 pointer_interceptor 规避，官方正推进 hit - test 等解决方案。</p>
</blockquote>
<h2 data-id="heading-6">社区活动日历</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c589decbd804477a753bfc1a3b8f5df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5o6Y6YeR5LiA5ZGo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229962&amp;x-signature=nKKuHbq77zAkJCFxlPYjE%2BDQsm4%3D" alt="掘金官方 文章头图 1303x734.jpg" loading="lazy"/></p>
<h4 data-id="heading-7">活动日历</h4>

















<table><thead><tr><th>活动名称</th><th>活动时间</th><th/><th/></tr></thead><tbody><tr><td><a href="https://juejin.cn/post/7571751304625815598" target="_blank" title="https://juejin.cn/post/7571751304625815598">🚀TRAE SOLO 实战赛</a></td><td>2025年11月13日-2025年12月16日</td><td/><td/></tr></tbody></table>
<h2 data-id="heading-8">📖 投稿专区</h2>
<blockquote>
<p>大家可以在评论区推荐认为不错的文章，并附上链接和推荐理由，有机会呈现在下一期。文章创建日期必须在下期掘金一周发布前一周以内；可以推荐自己的文章、也可以推荐他人的文章。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS 应用抓包完整指南，HTTPS 调试、协议分析与多工具协同的工程化流程]]></title>    <link>https://juejin.cn/post/7574621387572641838</link>    <guid>https://juejin.cn/post/7574621387572641838</guid>    <pubDate>2025-11-20T07:52:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574621387572641838" data-draft-id="7574615024292511770" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS 应用抓包完整指南，HTTPS 调试、协议分析与多工具协同的工程化流程"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T07:52:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="00后程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1159358440539900"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS 应用抓包完整指南，HTTPS 调试、协议分析与多工具协同的工程化流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1159358440539900/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    00后程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:52:58.000Z" title="Thu Nov 20 2025 07:52:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在移动应用开发与调试中，“<strong>iOS 应用抓包</strong>”往往是工程师定位问题的第一步。无论是接口联调、线上 Bug 排查、性能优化，还是分析第三方 SDK 的行为，抓包都是最直接且最具证据价值的方式。</p>
<p>但对 iOS 来说，抓包远比多数人想象的复杂：证书校验、ATS、pinning、QUIC、自定义协议、流量混合……任何一步都可能导致抓不到包。</p>
<hr/>
<h2 data-id="heading-0">一、为什么 iOS 应用抓包比其他平台更难？</h2>
<p>一般开发者遇到的问题集中在以下五类：</p>
<h3 data-id="heading-1"><strong>HTTPS 证书信任链严格，稍有偏差即可失败</strong></h3>
<p>常见表现：</p>
<ul>
<li>只有 CONNECT，没有解密数据</li>
<li>App 报 TLS 错误</li>
<li>Charles/Fiddler 能抓 HTTP，但抓不到 HTTPS</li>
</ul>
<p>这是由于 iOS 的信任链机制与 ATS 限制导致。</p>
<hr/>
<h3 data-id="heading-2"><strong>App 启用了证书 Pinning</strong></h3>
<p>这是“抓不到包”的头号原因。</p>
<p>表现：</p>
<ul>
<li>Safari 能抓</li>
<li>App 完全抓不到</li>
<li>抓包工具界面一直空白</li>
</ul>
<p>许多银行、金融、电商类 App 都会启用 pinning。</p>
<hr/>
<h3 data-id="heading-3"><strong>流量使用 QUIC（HTTP/3）绕过系统代理</strong></h3>
<p>QUIC 使用 UDP，不走客户端的 TCP 代理，因此：</p>
<ul>
<li>无法通过 Charles 抓取</li>
<li>视频/社交类 App 常默认开启</li>
<li>部分 CDN 或 API 已在使用</li>
</ul>
<p>若 QUIC 不关掉，代理工具基本无效。</p>
<hr/>
<h3 data-id="heading-4"><strong>App 使用自定义网络协议</strong></h3>
<p>例如：</p>
<ul>
<li>自定义 TCP 协议</li>
<li>内部 SDK 走独立网络栈</li>
<li>WebSocket 等长连接协议</li>
</ul>
<p>代理抓包无法处理这些场景。</p>
<hr/>
<h3 data-id="heading-5"><strong>流量噪音太多，难以定位某个 App</strong></h3>
<p>一个 iPhone 上几十个 App 都在发包，工具端很难精准过滤。</p>
<hr/>
<h2 data-id="heading-6">二、iOS 应用抓包的工具体系（按功能分层，不做优劣比较）</h2>
<p>为了覆盖所有类型的抓包需求，我们采用“分层工具链”的方式构造完整方案。</p>
<hr/>
<h3 data-id="heading-7"><strong>代理抓包（调试 HTTPS 内容）</strong></h3>
<p>代表工具：</p>
<ul>
<li>Charles</li>
<li>Proxyman</li>
<li>Fiddler</li>
<li>mitmproxy（开源）</li>
</ul>
<p>能做的事：</p>
<ul>
<li>查看 HTTPS 明文</li>
<li>拦截/修改请求与响应</li>
<li>模拟错误响应</li>
</ul>
<p>无法解决：</p>
<ul>
<li>pinning</li>
<li>QUIC</li>
<li>自定义协议</li>
<li>无法按 App 过滤流量</li>
</ul>
<hr/>
<h3 data-id="heading-8"><strong>TCP/TLS 底层抓包（链路证据）</strong></h3>
<p>代表：</p>
<ul>
<li>tcpdump</li>
<li>Wireshark</li>
</ul>
<p>适用于：</p>
<ul>
<li>判断请求是否到达服务器</li>
<li>TLS 握手失败分析</li>
<li>三次握手、重传、窗口等底层诊断</li>
</ul>
<p>是定位“为什么抓不到包”的核心工具。</p>
<hr/>
<h3 data-id="heading-9"><strong>自动分析与脚本能力</strong></h3>
<p>例如：</p>
<ul>
<li>pyshark</li>
<li>scapy</li>
<li>mitmproxy scripting</li>
</ul>
<p>适用于 CI 测试、自动提取异常包等。</p>
<hr/>
<h3 data-id="heading-10"><strong>无需代理的补抓工具（解决代理抓不到的问题）</strong></h3>
<p>抓包大师（Sniffmaster）补足代理工具无法处理的部分：</p>
<ul>
<li><strong>无需代理即可抓取 HTTPS、TCP、UDP 数据流</strong></li>
<li><strong>按 App 或域名过滤流量，解决噪音问题</strong></li>
<li>自动识别 HTTP/HTTPS/mdns、自定义协议</li>
<li>查看 TCP 数据流的 HEX/文本/二进制内容</li>
<li>导出 <strong>Wireshark 兼容 pcap</strong>，可与服务器端 tcpdump 对比</li>
<li>内置脚本拦截器，可使用 JavaScript 修改请求与响应</li>
<li>跨平台支持：Windows / macOS / iOS</li>
</ul>
<p>Sniffmaster 不是用来替代 Charles，而是用于：</p>
<ul>
<li>代理工具失败</li>
<li>遇到 pinning</li>
<li>遇到 QUIC</li>
<li>遇到自定义协议</li>
<li>需要抓底层 TCP 数据流
的场景。</li>
</ul>
<hr/>
<h2 data-id="heading-11">三、iOS 应用抓包的完整工程流程（可复用 SOP）</h2>
<p>下面给出一套可直接应用的 iOS 抓包流程。</p>
<hr/>
<h3 data-id="heading-12"><strong>首先尝试代理抓包（快速验证）</strong></h3>
<ul>
<li>设置 Wi-Fi 代理</li>
<li>安装信任证书</li>
<li>开启 SSL Proxying</li>
</ul>
<p>若能抓包 → 继续在代理工具中调试业务逻辑。</p>
<hr/>
<h3 data-id="heading-13"><strong>如果只能看到 CONNECT → 证书链问题</strong></h3>
<p>此时排查：</p>
<ul>
<li>是否使用公司 Wi-Fi（常注入证书）</li>
<li>是否信任证书</li>
<li>ATS 是否拒绝中间证书</li>
</ul>
<p>可以尝试切换网络环境验证。</p>
<hr/>
<h3 data-id="heading-14"><strong>如果浏览器能抓、App 抓不到 → pinning</strong></h3>
<p>无需继续尝试代理工具，直接进入补抓阶段。</p>
<hr/>
<h3 data-id="heading-15"><strong>④ 部分域名抓不到 → QUIC（HTTP/3）问题</strong></h3>
<p>判断方式：</p>
<ul>
<li>强制关闭 HTTP/3</li>
<li>或切换到 LTE/4G</li>
</ul>
<p>若恢复 → 即为 QUIC。</p>
<hr/>
<h3 data-id="heading-16"><strong>代理失败情况下的关键补抓：使用 Sniffmaster</strong></h3>
<p>具体步骤：</p>
<ol>
<li>使用 Sniffmaster 抓取目标 App 的流量</li>
<li>按 App / 域名过滤，只保留关键数据</li>
<li>将数据导出为 pcap</li>
<li>在 Wireshark 中分析：
<ul>
<li>TLS 握手</li>
<li>重传</li>
<li>证书链</li>
<li>QUIC 等 UDP 流量</li>
</ul>
</li>
<li>与服务器 tcpdump 的 pcap 进行逐帧比对</li>
</ol>
<p>此流程几乎能定位所有 iOS 抓包失败问题。</p>
<hr/>
<h3 data-id="heading-17"><strong>若能正常解密，则在 HTTP 层做最终分析</strong></h3>
<p>重点分析：</p>
<ul>
<li>请求头/响应头</li>
<li>token 或鉴权参数</li>
<li>加密内容</li>
<li>状态码</li>
<li>业务错误场景</li>
</ul>
<hr/>
<h2 data-id="heading-18">四、真实工程案例：iOS 应用抓不到 HTTPS</h2>
<p>某 App 在公司 Wi-Fi 下抓不到包，在家庭网络中又正常。</p>
<p>排查过程：</p>
<ol>
<li>Charles 有 CONNECT，但无 HTTPS</li>
<li>使用 Sniffmaster 补抓 → 出现 TLS Alert</li>
<li>Wireshark 分析证书链 → 企业网关注入了中间证书</li>
<li>切换网络 → 抓包恢复</li>
<li>最终确认：链路证书替换导致 ATS 拒绝连接</li>
</ol>
<p>这种问题只依靠代理工具无法定位。</p>
<hr/>
<h2 data-id="heading-19">iOS 应用抓包必须“多工具协同”</h2>
<p>iOS 抓包失败的本质来自：</p>
<ul>
<li>TLS 安全策略</li>
<li>pinning</li>
<li>QUIC</li>
<li>自定义协议</li>
<li>流量混合</li>
</ul>
<p>因此成熟的抓包方案必须是：</p>

























<table><thead><tr><th>抓包维度</th><th>使用工具</th></tr></thead><tbody><tr><td>HTTPS 内容</td><td>Charles / Proxyman / Fiddler</td></tr><tr><td>TCP/TLS 证据</td><td>Wireshark + tcpdump</td></tr><tr><td>自动分析</td><td>scapy / pyshark</td></tr><tr><td>代理失败补抓</td><td>抓包大师（Sniffmaster）</td></tr></tbody></table>
<p>只有如此组合，才能覆盖所有抓包场景。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[音视频开发全景图：播放器是怎样炼成的]]></title>    <link>https://juejin.cn/post/7574530224853172230</link>    <guid>https://juejin.cn/post/7574530224853172230</guid>    <pubDate>2025-11-20T07:35:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574530224853172230" data-draft-id="7574451949326237737" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="音视频开发全景图：播放器是怎样炼成的"/> <meta itemprop="keywords" content="音视频开发"/> <meta itemprop="datePublished" content="2025-11-20T07:35:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yangguang"/> <meta itemprop="url" content="https://juejin.cn/user/2884747301227416"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            音视频开发全景图：播放器是怎样炼成的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2884747301227416/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yangguang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:35:29.000Z" title="Thu Nov 20 2025 07:35:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">音视频开发全景图：播放器是怎样炼成的</h2>
<h3 data-id="heading-1">🎬 开场：点击播放按钮，究竟发生了什么？</h3>
<p>想象一下，你打开一个视频播放器，点击播放按钮：</p>
<pre><code class="hljs">你点击 ▶️ → 等待 0.5 秒 → 画面出现 + 声音响起 ✨
</code></pre>
<p>这 0.5 秒内，计算机做了什么？让我们揭开这层神秘面纱。</p>
<hr/>
<h3 data-id="heading-2">📦 第一站：视频文件里藏着什么？</h3>
<h4 data-id="heading-3">视频文件 ≠ 视频</h4>
<p><strong>关键认知</strong>：一个 <code>movie.mp4</code> 文件，其实是一个"容器"（Container），里面装着：</p>
<ul>
<li>🎥 <strong>视频流</strong>：一堆连续的图片（帧）</li>
<li>🔊 <strong>音频流</strong>：一段声音数据</li>
<li>📝 <strong>字幕流</strong>：文字信息（可选）</li>
<li>ℹ️ <strong>元数据</strong>：标题、作者、时长等</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/199b4de8e1da40c3800ec8172428ce8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWFuZ2d1YW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228929&amp;x-signature=j%2B4Oy0j7Dgc14q0Z6aATmxwYfkE%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-4">容器 vs 编码：两个容易混淆的概念</h4>























<table><thead><tr><th>概念</th><th>作用</th><th>常见格式</th><th>类比</th></tr></thead><tbody><tr><td><strong>容器</strong>（Container）</td><td>把视频、音频、字幕打包在一起</td><td>MP4, MKV, AVI, FLV</td><td>快递盒子 📦</td></tr><tr><td><strong>编码</strong>（Codec）</td><td>压缩视频/音频数据，减小体积</td><td>H.264, H.265, AAC, MP3</td><td>压缩袋 🗜️</td></tr></tbody></table>
<p><strong>举个例子</strong>：</p>
<ul>
<li><code>movie.mp4</code> = MP4 容器 + H.264 视频编码 + AAC 音频编码</li>
<li><code>video.mkv</code> = MKV 容器 + H.265 视频编码 + FLAC 音频编码</li>
</ul>
<p><strong>为什么需要编码？</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-number">1</span> <span class="hljs-string">小时未压缩视频</span> <span class="hljs-string">=</span> <span class="hljs-number">1920</span><span class="hljs-string">×1080</span> <span class="hljs-string">×</span> <span class="hljs-string">30fps</span> <span class="hljs-string">×</span> <span class="hljs-string">24bit</span> <span class="hljs-string">×</span> <span class="hljs-string">3600s</span> <span class="hljs-string">≈</span> <span class="hljs-number">500</span> <span class="hljs-string">GB</span> <span class="hljs-string">😱</span>
<span class="hljs-number">1</span> <span class="hljs-string">小时</span> <span class="hljs-string">H.264</span> <span class="hljs-string">编码</span> <span class="hljs-string">=</span> <span class="hljs-number">1</span><span class="hljs-number">-2</span> <span class="hljs-string">GB</span> <span class="hljs-string">✅（压缩</span> <span class="hljs-number">250</span><span class="hljs-number">-500</span> <span class="hljs-string">倍！）</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">🎞️ 第二站：播放器的完整管线</h3>
<p>现在揭秘播放器的工作流程，一共 <strong>5 个关键步骤</strong>：</p>
<p><strong>📊播放器管线流程图</strong></p>
<blockquote>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[视频文件&lt;br/&gt;movie.mp4] --&gt; B[解封装&lt;br/&gt;Demuxer]
    B --&gt; C[解码器&lt;br/&gt;Decoder]
    C --&gt; D[音视频同步&lt;br/&gt;AVSync]
    D --&gt; E[渲染显示&lt;br/&gt;Renderer]
    style A fill:#e1f5ff
    style B fill:#fff3e0
    style C fill:#f3e5f5
    style D fill:#e8f5e9
    style E fill:#fce4ec
</code></pre>
</blockquote>
<hr/>
<h4 data-id="heading-6">步骤 1️⃣：解封装（Demux）</h4>
<p><strong>目标</strong>：把容器拆开，分离出视频流和音频流。</p>
<p><strong>类比</strong>：把快递盒子拆开，把视频和音频分别取出来。</p>
<pre><code class="hljs language-ini" lang="ini">输入: movie.mp4（容器）
输出: 
  - AVPacket（视频）<span class="hljs-section">[编码数据]</span>
  - AVPacket（音频）<span class="hljs-section">[编码数据]</span>
</code></pre>
<p><strong>关键 API</strong>：</p>
<pre><code class="hljs language-cpp" lang="cpp">AVFormatContext* format_ctx;  <span class="hljs-comment">// 格式上下文</span>
<span class="hljs-built_in">avformat_open_input</span>(&amp;format_ctx, <span class="hljs-string">"movie.mp4"</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>);  <span class="hljs-comment">// 打开文件</span>
<span class="hljs-built_in">avformat_find_stream_info</span>(format_ctx, <span class="hljs-literal">NULL</span>);                <span class="hljs-comment">// 探测流信息</span>
<span class="hljs-built_in">av_read_frame</span>(format_ctx, packet);                          <span class="hljs-comment">// 读取数据包</span>
</code></pre>
<hr/>
<h4 data-id="heading-7">步骤 2️⃣：解码（Decode）</h4>
<p><strong>目标</strong>：把压缩的数据包解码成原始的图像/音频。</p>
<p><strong>类比</strong>：把压缩袋里的衣服拿出来展开。</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">输入: AVPacket（H.264 编码数据，几 KB）</span>
<span class="hljs-section">输出: AVFrame（YUV 图像，几 MB）</span>
</code></pre>
<p><strong>为什么需要解码？</strong></p>
<ul>
<li><strong>编码数据</strong>：无法直接显示，是一堆数学变换后的数字</li>
<li><strong>解码数据</strong>：YUV/RGB 图像，可以直接渲染到屏幕</li>
</ul>
<p><strong>关键 API</strong>：</p>
<pre><code class="hljs language-cpp" lang="cpp">AVCodecContext* codec_ctx;  <span class="hljs-comment">// 解码器上下文</span>
<span class="hljs-built_in">avcodec_send_packet</span>(codec_ctx, packet);    <span class="hljs-comment">// 送入编码数据包</span>
<span class="hljs-built_in">avcodec_receive_frame</span>(codec_ctx, frame);   <span class="hljs-comment">// 接收解码后的帧</span>
</code></pre>
<p><strong>📊 解码前后对比</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56d82d5ec1e34766b7e03cbb6ea09e84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWFuZ2d1YW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228929&amp;x-signature=n2q3Kh027C7jpfGtlwndFe2GsR0%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-8">步骤 3️⃣：音视频同步（A/V Sync）</h4>
<p><strong>目标</strong>：让画面和声音对得上。</p>
<p><strong>类比</strong>：配音演员对口型，差一点都不行。</p>
<p><strong>为什么会不同步？</strong></p>
<ul>
<li>视频解码快，音频解码慢 → 画面跑到前面了</li>
<li>视频帧率不稳定 → 有时快有时慢</li>
</ul>
<p><strong>解决方案</strong>：以<strong>音频时钟</strong>为准（人耳对声音延迟更敏感）。</p>
<pre><code class="hljs">视频帧的 PTS（显示时间戳）= 2.5 秒
当前音频时钟 = 2.3 秒
→ 结论：这一帧太早了，等 0.2 秒再显示 ⏱️
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09bd02cb38174545a3d9954ea4d4c544~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWFuZ2d1YW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764228929&amp;x-signature=4LJlkmYLM1DLDOlnqCiXVocCMXE%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h4 data-id="heading-9">步骤 4️⃣：渲染（Render）</h4>
<p><strong>目标</strong>：把 YUV 图像转换成 RGB，显示到屏幕。</p>
<p><strong>类比</strong>：把胶片放到放映机，投影到银幕上。</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">输入: AVFrame（YUV420P 格式）</span>
<span class="hljs-section">处理: YUV → RGB 颜色空间转换</span>
<span class="hljs-section">输出: 屏幕显示（GPU 渲染）</span>
</code></pre>
<hr/>
<h4 data-id="heading-10">步骤 5️⃣：循环播放</h4>
<p>播放器不是只播一帧就结束，而是<strong>不断循环</strong>：</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">while</span> (playing) {
  packet = demuxer.<span class="hljs-built_in">ReadPacket</span>();       <span class="hljs-comment">// 1. 读取数据包</span>
  frame = decoder.<span class="hljs-built_in">Decode</span>(packet);      <span class="hljs-comment">// 2. 解码</span>
  sync.<span class="hljs-built_in">WaitUntilTime</span>(frame.pts);       <span class="hljs-comment">// 3. 等待正确时机</span>
  renderer.<span class="hljs-built_in">Display</span>(frame);             <span class="hljs-comment">// 4. 渲染显示</span>
  <span class="hljs-comment">// 继续下一帧...</span>
}
</code></pre>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
     A[开始播放] --&gt; B[读取数据包]
     B --&gt; C{解码成功?}
     C --&gt;|是| D[计算显示时机]
     C --&gt;|否| B
     D --&gt; E[渲染到屏幕]
     E --&gt; F{继续播放?}
     F --&gt;|是| B
     F --&gt;|否| G[停止]
</code></pre>
<hr/>
<h3 data-id="heading-11">🔍 实战：用 FFprobe 分析视频文件</h3>
<p><strong>FFprobe</strong> 是 FFmpeg 自带的工具，可以查看视频文件的详细信息。</p>
<h4 data-id="heading-12">安装 FFmpeg（如果未安装）</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># macOS</span>
brew install ffmpeg

<span class="hljs-comment"># Ubuntu</span>
sudo apt install ffmpeg

<span class="hljs-comment"># Windows</span>
<span class="hljs-comment"># 下载：https://ffmpeg.org/download.html</span>
</code></pre>
<h4 data-id="heading-13">命令 1：查看文件基本信息</h4>
<pre><code class="hljs language-bash" lang="bash">ffprobe -hide_banner movie.mp4
</code></pre>
<p><strong>输出示例</strong>：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">Input</span> <span class="hljs-selector-id">#0</span>, <span class="hljs-selector-tag">mov</span>,<span class="hljs-selector-tag">mp4</span>,<span class="hljs-selector-tag">m4a</span>,<span class="hljs-number">3</span><span class="hljs-selector-tag">gp</span>,<span class="hljs-number">3</span><span class="hljs-selector-tag">g2</span>,<span class="hljs-selector-tag">mj2</span>, <span class="hljs-selector-tag">from</span> '<span class="hljs-selector-tag">movie</span><span class="hljs-selector-class">.mp4</span>':
  <span class="hljs-selector-tag">Duration</span>: <span class="hljs-number">00</span>:<span class="hljs-number">02</span>:<span class="hljs-number">15.50</span>, <span class="hljs-selector-tag">start</span>: <span class="hljs-number">0.000000</span>, <span class="hljs-selector-tag">bitrate</span>: <span class="hljs-number">2500</span> <span class="hljs-selector-tag">kb</span>/<span class="hljs-selector-tag">s</span>
  <span class="hljs-selector-tag">Stream</span> <span class="hljs-selector-id">#0</span>:<span class="hljs-number">0</span><span class="hljs-selector-attr">[0x1]</span>(und): <span class="hljs-selector-tag">Video</span>: <span class="hljs-selector-tag">h264</span> (High) (avc1), <span class="hljs-selector-tag">yuv420p</span>, <span class="hljs-number">1920</span><span class="hljs-selector-tag">x1080</span>, <span class="hljs-number">2000</span> <span class="hljs-selector-tag">kb</span>/<span class="hljs-selector-tag">s</span>, <span class="hljs-number">30</span> <span class="hljs-selector-tag">fps</span>
  <span class="hljs-selector-tag">Stream</span> <span class="hljs-selector-id">#0</span>:<span class="hljs-number">1</span><span class="hljs-selector-attr">[0x2]</span>(und): <span class="hljs-selector-tag">Audio</span>: <span class="hljs-selector-tag">aac</span> (LC) (mp4a), <span class="hljs-number">48000</span> <span class="hljs-selector-tag">Hz</span>, <span class="hljs-selector-tag">stereo</span>, <span class="hljs-selector-tag">fltp</span>, <span class="hljs-number">128</span> <span class="hljs-selector-tag">kb</span>/<span class="hljs-selector-tag">s</span>
</code></pre>
<p><strong>解读</strong>：</p>
<ul>
<li><strong>容器格式</strong>：MP4</li>
<li><strong>时长</strong>：2 分 15 秒</li>
<li><strong>视频流</strong>：H.264 编码，1920×1080 分辨率，30 fps</li>
<li><strong>音频流</strong>：AAC 编码，48kHz 采样率，立体声</li>
</ul>
<hr/>
<h4 data-id="heading-14">命令 2：查看详细流信息（JSON 格式）</h4>
<pre><code class="hljs language-bash" lang="bash">ffprobe -v quiet -print_format json -show_streams movie.mp4
</code></pre>
<p><strong>输出示例</strong>（节选）：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"streams"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"codec_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"h264"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"codec_type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"video"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"width"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1920</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"height"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1080</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"r_frame_rate"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"30/1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"avg_frame_rate"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"30/1"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"time_base"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1/15360"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration_ts"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2073600</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"duration"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"135.000000"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"index"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"codec_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"aac"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"codec_type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"audio"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sample_rate"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"48000"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"channels"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"channel_layout"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"stereo"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>关键字段</strong>：</p>
<ul>
<li><code>codec_name</code>：编码格式（h264 = H.264）</li>
<li><code>time_base</code>：时间基（用于计算 PTS）</li>
<li><code>r_frame_rate</code>：真实帧率（30 fps）</li>
<li><code>sample_rate</code>：音频采样率（48000 Hz = 48 kHz）</li>
</ul>
<hr/>
<h4 data-id="heading-15">命令 3：提取第一帧图像</h4>
<pre><code class="hljs language-bash" lang="bash">ffmpeg -i movie.mp4 -vframes 1 -f image2 first_frame.jpg
</code></pre>
<p>这会保存视频的第一帧为 <code>first_frame.jpg</code>，你可以打开看看解码后的图像长什么样。</p>
<hr/>
<h3 data-id="heading-16">🎯 小结：从点击到播放的完整旅程</h3>
<p>让我们回顾一下完整流程：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 点击播放按钮
   ↓
<span class="hljs-bullet">2.</span> Demuxer 打开文件，分离视频流和音频流
   ↓
<span class="hljs-bullet">3.</span> VideoDecoder 解码视频包 → YUV 帧
   AudioDecoder 解码音频包 → PCM 音频
   ↓
<span class="hljs-bullet">4.</span> AVSyncController 对比音频时钟，决定何时显示视频帧
   ↓
<span class="hljs-bullet">5.</span> Renderer 渲染 YUV 帧到屏幕
   AudioPlayer 播放 PCM 音频到扬声器
   ↓
<span class="hljs-bullet">6.</span> 循环步骤 2-5，直到文件播放完毕
</code></pre>
<p><strong>📊 完整流程时序图</strong></p>
<blockquote>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant User as 用户
    participant Player as 播放器
    participant Demuxer as 解封装
    participant Decoder as 解码器
    participant Sync as 同步器
    participant Render as 渲染器
    
    User-&gt;&gt;Player: 点击播放
    Player-&gt;&gt;Demuxer: 打开文件
    Demuxer--&gt;&gt;Player: 流信息
    
    loop 每一帧
        Player-&gt;&gt;Demuxer: 读取 Packet
        Demuxer--&gt;&gt;Decoder: AVPacket
        Decoder-&gt;&gt;Decoder: 解码
        Decoder--&gt;&gt;Sync: AVFrame
        Sync-&gt;&gt;Sync: 计算显示时机
        Sync--&gt;&gt;Render: 显示帧
        Render-&gt;&gt;User: 画面+声音
    end
</code></pre>
</blockquote>
<hr/>
<h3 data-id="heading-17">📚 下一篇预告</h3>
<p>下一篇《视频编码原理：为什么 1 小时电影只有几百 MB》，我们将深入探讨：</p>
<ul>
<li>视频压缩的数学原理</li>
<li>I/P/B 帧的含义</li>
<li>GOP（关键帧间隔）的作用</li>
<li>码率与画质的平衡</li>
</ul>
<p>敬请期待！🎬</p>
<hr/>
<h3 data-id="heading-18">🔗 相关资源</h3>
<ul>
<li><strong>ZenPlay 源码</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSunshine334419520%2Fzenplay" target="_blank" title="https://github.com/Sunshine334419520/zenplay" ref="nofollow noopener noreferrer">GitHub - zenplay</a></li>
<li><strong>FFmpeg 官方文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fffmpeg.org%2Fdocumentation.html" target="_blank" title="https://ffmpeg.org/documentation.html" ref="nofollow noopener noreferrer">ffmpeg.org/documentati…</a></li>
<li><strong>推荐阅读</strong>：雷霄骅的博客 - FFmpeg 源码分析系列</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[工程师学AI之起始篇：理论与实践学习计划]]></title>    <link>https://juejin.cn/post/7574608278421733412</link>    <guid>https://juejin.cn/post/7574608278421733412</guid>    <pubDate>2025-11-20T07:52:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574608278421733412" data-draft-id="7574530224853270534" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="工程师学AI之起始篇：理论与实践学习计划"/> <meta itemprop="keywords" content="Agent,程序员,LLM"/> <meta itemprop="datePublished" content="2025-11-20T07:52:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            工程师学AI之起始篇：理论与实践学习计划
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:52:45.000Z" title="Thu Nov 20 2025 07:52:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<h2 data-id="heading-0">1.背景</h2>
<p>随着22年底chatgpt的重磅推出，大语言模型（LLM）发展迅猛，从最初的“大号文本预测器”（会听，会说）一步步成长为如今能处理复杂任务的“智能体”基石（会想、会做）。25年初deepseek点燃了国人对大模型的热情，不知您是否好奇Transformer、自注意力self-attention、LLM、Token、向量化Embedding、涌现、Pre-training、有监督微调SFT、RLHF、MOE、MLA、多模态、思维链CoT、FunctionCalling、RAG、MCP协议、AIAgent、A2A协议等概念层出不穷，到底在解决什么问题？</p>
<p>作为起始篇将与您一起从宏观上理解下大模型的基本脉络，并基于当下理解和认知，从工程师视角制定学习计划，欢迎关注交流讨论！</p>
<p>该系列将从工程师视角，一步步去学习并理解大模型相关概念，再到会用，深入理解，掌握原理，动手实践，解决实际问题。</p>
<p>1）概念：这些层出不穷的概念背后到底在解决什么问题？</p>
<p>2）会用：除了知识问答与会话，还能用大模型解决什么问题？有什么局限性？</p>
<p>3）理解：大语言模型vs工程开发在思维方式上有什么区别？</p>
<p>4）原理：大语言模型到底是如何工作的？</p>
<p>5）动手实践：如何从0开始构建大语言模型？</p>
<p>6）实际问题：如何用大语言模型创造性解决业务场景实际问题？</p>
<p>7）学习计划：工程师如何一步步掌握大模型背后的理论知识、算法模型？</p>
<h2 data-id="heading-1">2.概念：什么是LLM大语言模型？</h2>
<p>大语言模型（Large Language Model, LLM）是一种使用大量文本数据训练的深度学习模型，其核心能力是可以理解和生成人类语言。大模型 = 海量数据 + 深度学习算法 + 超强算力。人工智能AI、机器学习、深度学习、大语言模型LLM、生成式人工智能GenAI关系大致如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d07680ae39b457997bbc38eeb754d3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229965&amp;x-signature=Bi0NFrTEbaoHHLAG1wG4cUTvA3k%3D" alt="" loading="lazy"/></p>
<p>近几年大语言模型演变历程大致如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34e2f8373ae34cdfb758874c8b9c64db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229965&amp;x-signature=EwqNPC%2B1GKlX6czZmxllbfHQK2s%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">3.会用：大语言模型能做什么？</h2>
<h3 data-id="heading-3">3.1应用场景</h3>
<p>大模型（Large Language Models, LLMs）的应用非常广泛，并且正以前所未有的速度渗透到各个行业。它们不仅能处理自然语言任务，还能理解和生成代码、进行多模态交互，甚至作为智能体（Agent）自主决策和执行任务。</p>






































































<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td>应用领域</td><td>具体场景</td><td>核心价值/案例</td></tr><tr><td>医疗与健康</td><td>智能问诊与分诊、医学影像分析、药物研发与挖掘、健康管理、医院运营优化</td><td>加速药物研发进程，提升诊疗效率，优化患者服务体验</td></tr><tr><td>软件开发</td><td>代码生成与补全、Bug调试与修复、代码解释、不同编程语言转换、自动化测试</td><td>提升开发效率，降低代码缺陷，加速学习进程</td></tr><tr><td>教育与科研</td><td>个性化辅导、作业批改、语言学习、科学计算、论文摘要与翻译</td><td>因材施教，提升学习效率，辅助科学研究</td></tr><tr><td>工业与制造</td><td>智能决策支持、生产流程优化、质量控制、 Predictive Maintenance（预测性维护）、供应链管理、研发设计</td><td>提升生产效率，降低故障率，缩短研发周期，优化能耗</td></tr><tr><td>能源与电力</td><td>虚拟电厂调度、电网负荷预测、能源交易、无功补偿优化、电能质量管理</td><td>提升电网稳定性，促进新能源消纳，实现精准的需求响应和调度</td></tr><tr><td>内容创作与 媒体</td><td>新闻撰稿、剧本创作、营销文案、翻译、摘要生成</td><td>提升内容生产效率和创意多样性</td></tr><tr><td>客户服务与营销</td><td>智能客服、个性化推荐、市场洞察分析、销售话术生成</td><td>提升客户满意度，降低人力成本，实现精准营销</td></tr><tr><td>法律司法</td><td>法律条文检索与解读、案例分析与裁判文书生成、合同审查与智能起草、案件焦点识别与证据分析</td><td>提升案件处理效率和准确性，降低人工工作负荷</td></tr><tr><td>航天高科技</td><td>在轨操作辅助、故障诊断与处置、航天员心理支持、天地协同智能问答</td><td>为在轨工作提供智能化、专业化支持</td></tr><tr><td>金融与风控</td><td>智能投顾、风险评估、反欺诈、信贷审批、市场行情分析</td><td>提升风险控制能力，优化投资决策，自动化业务流程</td></tr><tr><td>个人助理与娱乐</td><td>日程管理、信息检索、旅行规划、游戏NPC对话生成、写诗作画</td><td>提升生活和工作效率，提供个性化娱乐体验</td></tr></tbody></table>
<h3 data-id="heading-4">3.2软件开发场景：AI Coding给想法插上翅膀？</h3>
<p>随着大模型辅助编码技术发展，即使您不会编程，也可以借助AICoding把想法快速转换成可运行的代码。这里用一个生活中的案例来看看AI如何给想法插上翅膀？从0实现一个微信小程序原型系统基本在小时级别就能完成。</p>
<h4 data-id="heading-5">3.2.1原始需求：儿童生病体温用药症状观测</h4>
<p>不知宝爸宝妈们在孩子生病发烧期间无比焦虑的场景，恨不得时刻能看看体温是不是降下来了？用退烧药之后能够持续多久？下面是我自己小孩3岁左右一段发烧记录：晚上到凌晨，我和爱人轮流测量体温，用药，观察症状变化情况。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d4e579bafd844079f8a306dc6d3a385~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229965&amp;x-signature=uV15ghbFBQ1C7k55R4QtA%2Fj2pWY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-6">3.2.2AICoding助您0编码实现微信小程序</h4>
<p>首先，我没有写过多少前端代码和微信小程序，借助AI编程工具可以帮助我们从生活中实际场景出发—&gt;到想法—&gt;交互图生成—&gt;AI辅助架构、数据库、API设计—&gt;AI辅助生成前后端代码—&gt;原型系统部署调试。</p>
<p>完整的小程序界面及实现过程这里不做赘述（目前开发体验版本），后续文章详细记录下完整的从想法到UED设计，及设计编码实现过程。有兴趣的朋友可以关注讨论。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a9bdef01cf84b0cbd153d59abc3fbf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229965&amp;x-signature=MDSq7NKqPUIUbh0%2BjzGff0C8q08%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f16aabd422344da7959c1f31ee5aefff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229965&amp;x-signature=64rqsxKwy9SeGieKttmHCzT4xqA%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">4.理解：大语言模型工作原理？</h2>
<h3 data-id="heading-8">4.1工程vs算法：演绎归纳思维差异</h3>
<p>归纳与演绎是人类认识事物的两种思维方法，工程与算法是这两种思维方式的典型应用场景。归纳与演绎在工程和大模型算法中的分布是一种有趣的镜像关系：</p>
<p>1）传统工程立足于演绎的确定性，用归纳来应对现实世界的不完美。对于AI研究者而言，明白“演绎”框架（如算法、架构）的突破，才能为更强大的“归纳”能力搭建舞台。</p>
<p>2）大模型算法立足于归纳的概率性，用演绎来框架其学习和约束其行为。对于工程师而言，明白大模型的“归纳”本质，就不会期望它像传统软件一样绝对可靠，从而能更好地设计容错和验证流程。</p>
<h4 data-id="heading-9">4.1.1工程思维：演绎为主，归纳为辅</h4>
<p>演绎法核心思想：从一般性前提推导出特殊性结论。如果前提为真，且推理过程正确，则结论必然为真。工程化思维解决问题的方式是演绎推导为主，归纳为辅。</p>
<p>推理方向：从一般到特殊（Top-Down）。</p>
<p>关键词：规则、公理、定理、逻辑推导、确定性。</p>
<p>应用场景：软件设计过程（PRD-交互-视觉-架构设计-编码实现）、传统工程（如土木、机械、电子工程）的核心是确定性和可靠性，其思维方式高度依赖演绎法。</p>
<p>严格的设计规范：工程师使用这些定律，结合具体需求（小前提），通过数学计算和逻辑推导，设计出桥梁、芯片或电路（结论）。这个过程是高度演绎的。</p>
<p>可预测性：因为基于确定性定律，工程系统的行为在理论上是可以精确预测的。一座桥能承重多少，在建造之前就可以通过计算得知。</p>
<p>小结：在传统工程中，演绎是“设计师”，负责基于属性计算和工程设计完成确定性需求的构建；归纳是“测试/质检员”和“优化师”，负责验证和调优。</p>
<h4 data-id="heading-10">4.1.2算法思维：归纳为主，演绎为辅</h4>
<p>归纳法核心思想：从大量特殊性观察中总结出一般性规律或模式。结论是可能为真的，但不保证绝对正确。大模型算法解决问题的方式是归纳为主，演绎为辅。</p>
<p>推理方向：从特殊到一般（Bottom-Up）。</p>
<p>关键词：模式、趋势、概率、统计、不确定性。</p>
<p>应用场景：大模型（如GPT、BERT等）的本质是从数据中学习统计规律，其核心范式是归纳法。</p>
<p>1）学习过程就是归纳：大模型不预先输入“语法规则”或“世界知识”（大前提）。它通过在海量文本数据（数十亿个特殊样本）中寻找词与词、句与句之间的统计关联（如共现频率、注意力权重），归纳出一套内部的、隐含的“语言模型”和“世界模型”。这个过程完全是从特殊到一般。</p>
<p>2）概率性输出：模型的输出不是确定的真理，而是基于其归纳出的统计分布，计算出的最可能的词序列。它是“可能为真”的，这正是归纳法的特征。</p>
<p>3）涌现能力：模型表现出的推理、创作等复杂能力，并非由程序员显式编码（演绎），而是从数据中归纳涌现出来的，这超出了设计者的精确预期。</p>
<p>演绎的辅助角色：</p>
<p>1）算法框架设计：Transformer的架构、反向传播算法、损失函数等，是研究人员基于数学和计算机科学原理演绎设计出来的。这为归纳学习提供了舞台和规则。</p>
<p>2）提示工程与思维链：用户通过设计精妙的提示（Prompt），试图引导模型激活其内部归纳出的知识，并按照一种类似演绎的逻辑链（Chain-of-Thought）来生成答案。这是在用演绎的形式去驾驭归纳得到的能力。</p>
<p>3）规则约束：在模型输出端，会使用演绎性的规则进行过滤和约束，例如内容安全过滤、格式要求等，以确保输出符合某些确定性标准。</p>
<p>小结：在大模型算法中，归纳是“学生”，负责从数据中学习知识；演绎是“教练”和“裁判”，负责设计学习方法和设定输出规则。其分布是“归纳为主，演绎为辅”。</p>
<p>最终，最强大的系统将是那些能精巧融合两种范式的系统：用演绎法构建可靠框架，用归纳法汲取数据智慧，从而同时具备严谨性和灵活性。</p>
<h3 data-id="heading-11">4.2大语言模型工作原理</h3>
<p>LLM的工作原理可以简单理解为一个“基于概率的超级文本生成器”。虽然它们本质上在于“预测下一个词”，并需要大量文本进行训练，基于数十亿词汇训练的神经网络，不同于传统的人类编写的软件，没人完全理解其内部机制。大模型训练到推理的大致过程如下。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfe6648505e040418d7bfb72ecd45aaf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229965&amp;x-signature=QsoeUmcxVzBE0jEo%2BMMuZVdL9SU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">5.实践：如何从0构建大语言模型？</h2>
<p>为什么我们应该构建自己的 LLM？从头开始编码一个 LLM 是理解其工作机制和局限性的绝佳练习。同时，这也使我们具备了对现有开源 LLM 架构进行预训练或微调的知识，以便将其应用于我们特定领域的数据集或任务。</p>
<p>简化的构建流程：篇幅原因这里不做赘述，欢迎关注，后面章节深入学习并拆解。</p>
<p>海量数据 → Transformer架构 + 预训练（自监督学习） → 基座模型 → 有监督微调（SFT） + 对齐优化（RLHF/DPO） → 对话/指令模型。</p>
<h2 data-id="heading-13">6.学习计划</h2>
<p>为了进一步深入理解大模型工作原理并应用到工程实践中，整理如下学习计划：从数学理论—&gt;编程工具python框架：NumPy/Pandas/PyTorch—&gt;模型与算法理论知识—&gt;工程实践。关键原则：</p>
<p>1）每阶段必须产出可运行代码（拒绝纯理论学习）</p>
<p>2）80%时间投入工程实践（数据处理/部署/监控）</p>
<p>3）成本意识贯穿全程（GPU使用/延迟/吞吐量）</p>
<h3 data-id="heading-14">6.1阶段1（1-2周）：数学理论vs大模型</h3>
<p>数学知识是理解大模型原理的必备内功，回顾下大学和研究生期间数学知识？</p>
<p>1）线性代数：定义了模型的结构和表示方式，用矩阵和向量表示一切，向量、矩阵和张量运算是数据在模型中流动的语言。线性代数提供了如何用“数字块”来表示和操作“概念”的基本语法。</p>
<p>2）概率论：定义了模型的目标和行为方式，预测下一个词的概率分布，理解损失函数、模型评估和不确定性的关键。</p>
<p>3）微积分：定义了模型的学习算法，如何通过计算梯度来优化矩阵中的参数，以更好地完成概率预测的目标）。理解梯度、导数，这是模型优化的基础。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/164dcf31fd2c4c14a740a15925d4fbff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764229965&amp;x-signature=o3qTS%2FtIcH4RjQApgCgxtwomtno%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-15">6.2阶段2（1-2周）：编程工具与环境</h3>
<p>搭建工程化环境 + 建立AI直觉 + 掌握PyTorch工程化开发，具备CV/NLP基础项目能力。</p>
<p>掌握python语言及NumPy (科学计算)、Pandas (数据处理)，掌握PyTorch。</p>
<p>了解Hugging Face (模型中心)。</p>
<p>利用阿里云百炼搭建云端环境：基于 PAI DSW 准备在线学习环境</p>
<h3 data-id="heading-16">6.3阶段3（6-8周）：模型与算法 (核心大脑)</h3>
<h4 data-id="heading-17">6.3.1机器学习及深度学习基础知识（2-3周）</h4>
<p>掌握机器学习、深度学习及NLP基础概念，理解回归、分类、过拟合与欠拟合等基本概念。掌握神经网络(NN)、卷积网络(CNN)、循环网络(RNN)等经典结构。监督学习 vs. 无监督学习，线性回归、逻辑回归、决策树、SVM等经典算法，模型评估方法。</p>
<p>1）书籍：《机器学习》《深度学习》</p>
<p>2）在线课程：李沐《动手学深度学习》（PyTorch版），学习神经网络基础（前向传播、反向传播）、CNN、RNN/LSTM、激活函数、优化算法。</p>
<p>3）实践：使用PyTorch练习所学内容，搭建简单模型。</p>
<h4 data-id="heading-18">6.3.2大模型核心技术（4-6周）</h4>
<p>重中之重，深入理解Transformer架构及大模型的原理、训练和微调，所有现代AI大模型（如GPT、Llama）的基石，必须深入理解其自注意力Self-Attention机制、Encoder-Decoder结构、位置编码，深度理解Transformer架构论文：《Attention Is All You You Need》，视频学习解读。</p>
<p>1）开源项目：阅读deepseek、qwen等模型的代码或文档，学习GPT、BERT、LLaMA等主流模型的区别与原理，掌握预训练（Pretraining）与微调（Fine-tuning）概念，参数高效微调技术（LoRA、Adapter）。</p>
<p>2）资料推荐：阿里云大模型认证培训课程；李沐《动手学深度学习》。</p>
<p>3）代码实践：尝试实现一个简单的Transformer模块。熟悉预训练(Pre-training)、微调(Fine-tuning)、提示工程(Prompt Engineering)、RLHF(人类反馈强化学习)等核心技术范式。</p>
<h3 data-id="heading-19">6.4阶段4（4-6周）：工程与实践 (落地能力)</h3>
<p>掌握使用大模型构建应用的核心技能，包括RAG、智能体开发等。</p>
<p>1）RAG（检索增强生成）：理解RAG架构，学习使用向量数据库（如FAISS、ChromaDB），构建知识库问答系统。</p>
<p>实践项目：搭建一个大模型问答系统（阿里云ACP培训实践项目）。</p>
<p>2）AI智能体（Agent）开发：用LangChain构建一个能联网搜索的智能体。在Coze或Dify上搭建一个多模态工作流应用。完成工具调用，记忆机制。</p>
<p>实践项目：结合业务场景构建一个AI智能体应用。</p>
<h3 data-id="heading-20">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[火山引擎Data Agent赋能金融行业，打造智能投顾与精准营销新范式]]></title>    <link>https://juejin.cn/post/7574625040659857458</link>    <guid>https://juejin.cn/post/7574625040659857458</guid>    <pubDate>2025-11-20T07:54:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574625040659857458" data-draft-id="7574621075322748991" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="火山引擎Data Agent赋能金融行业，打造智能投顾与精准营销新范式"/> <meta itemprop="keywords" content="Agent"/> <meta itemprop="datePublished" content="2025-11-20T07:54:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="字节跳动数据平台"/> <meta itemprop="url" content="https://juejin.cn/user/2159881542179624"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            火山引擎Data Agent赋能金融行业，打造智能投顾与精准营销新范式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2159881542179624/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    字节跳动数据平台
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:54:43.000Z" title="Thu Nov 20 2025 07:54:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在近日举办的平安寿险第二届AIGC嘉年华“智领未来·AI赋能金融”活动上，火山引擎数智专家提出，企业正从“数据驱动”迈向“认知驱动”的新时代。这一转型的核心在于构建能够沉淀集体智慧的“企业级认知引擎”，其不仅是技术跃迁，更要求企业重塑与数据的关系：贯通内外部多源数据、简化人机交互以实现敏捷分析，并将专家经验转化为可复用的数字资产，从而加速从洞察到行动的闭环。</p>
<p>为应对这一趋势，火山引擎正式推出数据智能体Data Agent，定位为新一代企业级AI数字专家。该产品旨在通过深度整合企业数据资产，具备主动思考、分析与行动能力，助力组织构建可自主进化的“数据大脑”。其技术架构采用“Plan+React”双阶段模式，先通过意图识别与上下文补全生成结构化执行计划，再调度多工具完成深度分析，形成决策闭环。</p>
<p>火山引擎目前推出的Data Agent的核心能力聚焦两大场景。其一是“智能分析Agent”，实现“提问即生产”的数据消费新模式。在金融领域，证券公司与银行用户可通过自然语言交互，快速生成经营全景报告或用户行为洞察分析。例如，面对证券业务数据分散、提数流程繁琐的痛点，该Agent能将核心业务分析效率提升90%，帮助团队精准识别薄弱环节。其二是“智能营销Agent”，依托“一客一策”的超个性化服务能力，动态融合客户属性、行为与交易数据，突破传统粗放标签限制。在金融投顾场景中，该Agent可实时追踪市场异动，为投资者提供多维度分析，辅助资产配置决策；在精准营销中，则通过深度挖掘用户潜在需求，助力机构打造差异化服务体系，提升客户粘性。</p>
<p>火山引擎Data Agent已在多个行业落地验证，在智能营销领域，其“一客一策”引擎使某客户在营销场景点击率提升30%、投资回报率提高80%；在某客户服务场景中，沟通轮次减少逾70%，新人培训周期从一个月压缩至七天。此外，该产品采用与大模型底座解耦的设计，兼顾技术进化与安全性，通过工程应用与小模型控制输出幻觉，确保业务决策的可靠性。</p>
<p>火山引擎强调，迈向认知驱动是一项系统性工程，企业需坚持长期主义，选择具备共同解题能力的战略伙伴。未来，Data Agent将持续向预测性与模拟仿真能力演进，深化在复杂决策场景的应用，为金融、制造、医疗等领域提供可持续增长的智能引擎。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[工程师学AI之第二篇：AI大模型vs数学理论]]></title>    <link>https://juejin.cn/post/7574581079627202566</link>    <guid>https://juejin.cn/post/7574581079627202566</guid>    <pubDate>2025-11-20T07:58:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574581079627202566" data-draft-id="7574581079627186182" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="工程师学AI之第二篇：AI大模型vs数学理论"/> <meta itemprop="keywords" content="LLM,Agent,程序员"/> <meta itemprop="datePublished" content="2025-11-20T07:58:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AI大模型"/> <meta itemprop="url" content="https://juejin.cn/user/3817967696221534"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            工程师学AI之第二篇：AI大模型vs数学理论
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3817967696221534/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AI大模型
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T07:58:16.000Z" title="Thu Nov 20 2025 07:58:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote>
<p>上一篇我们梳理了大模型的基本脉络，并制定了学习计划：阶段一提到数学知识是理解大模型原理的必备内功，因此本章主要回顾下大学和研究生期间线性代数、概率论、微积分、信息论相关的数学知识。本文主要回答几个问题：</p>
<p>    1）why：为什么需要学习数学知识？</p>
<p>    2）what：大模型和哪些数学知识相关？</p>
<p>    3）how：如何学习这些数学知识？</p>
<p>    如您对上面问题感兴趣，欢迎关注，学习讨论。</p>
<h2 data-id="heading-0">1.为什么需要数学知识？why</h2>
<p>    许多工程师可能问：既然现在有这么多高级框架（TensorFlow, PyTorch），API调用那么简单，各种成熟模型唾手可得，看起来和做工程没啥太大区别，我为什么还需要去啃那些艰深的数学理论知识？其实本质上取决于你到底是想成为仅仅会使用大模型的“技工”，还是希望掌握大模型工作原理及模型优化方案，成为解决复杂场景问题的AI专家。</p>
<p>    不知你是否困惑：阅读了无数介绍transformer原理的博客视频依然一头雾水：transformer原理、自注意力工作机制是怎样？Q、K、V三个矩阵作用是怎样的？深度理解数学理论，你将从一个仅仅能“使用”工具的“技工”工程师，升级为能够“创造”、“优化”和“解决复杂问题”的“专家”，让你从被动的工具使用者，变为主动的问题解决者和技术创造者。数学理论是AI大模型最根本、最强大的“解决问题的语言”，这是在AI领域保持长期竞争力的关键。</p>






























<table><thead><tr><th/><th/><th/></tr></thead><tbody><tr><td>工程师级别</td><td>对数学的依赖</td><td>能力范围</td></tr><tr><td>初级/应用型</td><td>低：会调用 API，使用现成模型进行微调。</td><td>解决标准问题，高度依赖现有生态。</td></tr><tr><td>中级/优化型</td><td>中：理解核心概念，能进行有效调试和部署优化。</td><td>解决大多数工业问题，是团队的中坚力量。</td></tr><tr><td>高级/专家型</td><td>高：深度理解原理，能设计新结构，解决复杂、新颖问题。</td><td>技术领导者，能够定义方向、攻克瓶颈、打造核心竞争力。</td></tr></tbody></table>
<p>    对于工程师而言，理解AI大模型背后的数学绝非学术炫耀，而是实实在在的生产力、竞争力和职业生涯的护城河。对工程师来说，数学理论不是终点，而是通往更高阶工程能力的“桥梁”。以下是具体原因：</p>
<p>    1）问题诊断与调试：从“猜谜”到“精准手术”，当模型效果不佳、出现诡异行为或训练失败时，不理解数学的工程师只能进行“盲调”。</p>
<p>    ➢ 不懂数学的调试：盲目调整超参数（如学习率）、尝试不同的优化器、盲目增加数据或层数。这个过程效率极低，如同在黑暗中摸索，严重依赖经验和运气。</p>
<p>    ➢ 懂数学的调试：能够根据问题的数学本质，提出假设并精准地验证和修复，极大缩短调试周期，提高开发效率。看到损失曲线不下降，能立刻联想到可能是梯度消失（导数链式法则中断）、学习率过高（梯度下降原理）或数据输入有问题。遇到模型过拟合，能深刻理解 Dropout、权重衰减（L2正则化）为何能 work，而不是仅仅把它们当作一个神奇的“开关”。</p>
<p>    2）优化与效率：降低成本，提升性能。大模型的训练和部署成本极其高昂。数学知识是进行优化的根本。</p>
<p>    ➢ 计算优化：理解矩阵运算（线性代数）和自动微分（微积分）的原理，可以帮助你写出更高效、硬件利用率更高的代码，如优化张量操作、利用广播机制等。</p>
<p>    ➢ 模型压缩与量化：要将大模型部署到边缘设备，需要进行剪枝、知识蒸馏、量化等技术。这些技术的背后是概率论、信息论和优化理论。例如：剪枝为什么不能简单地剪掉权重小的参数？因为需要理解海森矩阵及其在损失函数中的意义（二阶优化）。量化的本质是在保持数据分布（概率论）的同时减少信息熵（信息论）。</p>
<p>    ➢ 资源管理：理解训练过程中的内存占用（主要是模型参数和激活函数的中间结果，即张量），能更好地进行批次管理、模型并行和数据并行策略的选择。</p>
<p>    3）适配与创新：解决前所未见的问题，数学是你的设计工具箱。它赋予了你打破“拿来主义”、创造性地解决全新问题的能力。</p>
<p>    ➢ 定制化模型结构：当你需要为一个特定任务（如处理图结构数据、时间序列数据）修改或设计一个新的模型模块时，你必须深刻理解注意力机制（缩放点积、QKV变换）、循环网络（梯度流设计）等背后的数学，才能确保你的设计是有效的、可训练的。</p>
<p>    ➢ 领域适配：在医疗、金融、科学计算等领域，数据模式和损失函数可能非常特殊。你需要根据领域知识设计合适的损失函数（需要概率论和微积分）和评估指标，而不是简单地调用交叉熵损失。</p>
<h2 data-id="heading-1">2.哪些数学理论与AI相关？what</h2>
<p>    前篇<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5MzIzNDMwMg%3D%3D%26mid%3D2247484233%26idx%3D1%26sn%3Dbd6943f74899833088ea5276e536abfa%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg5MzIzNDMwMg==&amp;mid=2247484233&amp;idx=1&amp;sn=bd6943f74899833088ea5276e536abfa&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">工程师学AI之起始篇：理论与实践学习计划</a>提到大模型的原理建立在三大数学基础之上：线性代数、微积分和概率论。线性代数处理数据表示（线性代数首先将你的文字等多模态信息转化为向量），微积分优化模型参数（微积分通过前向传播和反向传播处理这些向量），概率论与信息论提供理论解释和评估标准（概率论决定最可能的回复），三者缺一不可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd2c7cced6cc4e69bdc957ce739a5269~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230296&amp;x-signature=EFGIWcAmkiIcIkL%2BriSq4m2v288%3D" alt="" loading="lazy"/></p>
<p>    让我们用一个比喻来总结：</p>
<p>    1）线性代数是乐高积木：它提供了构建模型的基本模块（向量、矩阵）和组装方式（矩阵乘法）。</p>
<p>    2）微积分是说明书和修正工具：它告诉我们当前搭建的模型哪里不好（计算梯度），以及如何调整积木的位置来让它变得更好（梯度下降）。</p>
<p>    3）概率论与信息论是设计理念和评估标准：它决定了模型应该学习什么样的模式（数据分布），以及如何衡量模型输出的好坏（交叉熵、困惑度）。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8370a40e7434d56821bfa9ea6e16d4d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230296&amp;x-signature=4PnLUPwAaT%2BnnTBI0Qx9tVRibBU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">2.1 线性代数：大模型的数据表示（向量/矩阵运算）</h3>
<p>    线性代数是处理高维数据和并行计算的语言，AI大模型本质上是在高维空间中进行各种变换和运算。</p>
<h4 data-id="heading-3">2.1.1基本概念</h4>
<p>    线性代数基本概念：标量、向量、矩阵、张量：</p>
<p>    1）标量：一个数字，比如一个神经元的偏置（Bias）。</p>
<p>    2）向量：一维数组，比如一个词的词向量（Word Embedding）或一个神经元的所有输入。</p>
<p>    3）矩阵：二维数组，比如一层神经网络的所有权重（Weights）。</p>
<p>    4）张量：多维数组（通常三维及以上），是向量和矩阵的推广。整个神经网络的输入、输出和参数都可以用张量表示。例如，一个批次的图像数据是 [batch_size, height, width, channels] 的4维张量。</p>
<h4 data-id="heading-4">2.1.2核心运算</h4>
<p>    1）矩阵乘法：这是神经网络前向传播的核心。一层的输出是输出 = 激活函数(输入 × 权重矩阵 + 偏置)。矩阵乘法高效地实现了所有神经元输入的加权求和。</p>
<p>    2）点积：点积运算在自注意力机制（SelfAttention）中至关重要。查询（Query）向量和键（Key）向量之间的点积计算了它们的相似度。</p>
<h4 data-id="heading-5">2.1.3线性代数：大模型的数据表达与运算语言</h4>
<p>    线性代数是大模型最直接、最表象的数学语言。整个模型本质上就是一系列复杂的线性代数运算：高维向量和矩阵运算。简单比喻：线性代数提供了如何用“数字块”（向量和矩阵）”来表示和操作“概念”的基本语法。</p>
<p>    1）词嵌入 (Word Embedding)：模型中的每个词（Token）都被表示成一个高维向量（一串数字）。这个向量空间中的几何关系（如距离、方向）编码了词语的语义和语法关系。例如，“国王” - “男人” + “女人” ≈ “女王”。</p>
<p>    2）模型本身就是巨大的矩阵：神经网络每一层的权重(Weights)和偏置(Biases)都是巨大的矩阵。模型的训练过程就是在调整这些矩阵中的数值。</p>
<p>    3）前向传播就是矩阵计算：数据在网络中的传递，本质上就是输入向量与权重矩阵进行矩阵乘法，然后加上偏置，再通过一个激活函数（如ReLU）。</p>
<p>    输出 = Activation(权重 · 输入 + 偏置)。</p>
<p>    4）注意力机制 (Attention)：Transformer的核心-自注意力机制，完全由查询(Query)、键(Key)、值(Value)三个矩阵的运算构成（计算过程涉及矩阵乘法和Softmax）。详细解读欢迎关注，见下一篇文章。</p>
<p>2.2微积分：优化模型参数（损失函数/梯度）</p>
<h4 data-id="heading-6">2.2.1基本概念</h4>
<p>    微积分是模型如何从数据中“学习”的理论基础。它的核心任务是回答：如何调整模型参数，才能让它表现得更好？</p>
<p>    1）导数：衡量函数输出随输入变化的瞬时速率。在一元函数中，是斜率。</p>
<p>    2）梯度：多元函数的导数推广。它是一个向量，指向函数值增长最快的方向。在机器学习中，损失函数 L(θ) 的梯度 ∇L(θ) 指向了损失增长最快的方向。</p>
<p>    3）链式法则：神经网络是深度复合函数（L(g(f(x)))）。链式法则允许我们将损失函数对最底层参数的导数，一层一层地反向传播回去。这是反向传播算法的核心。</p>
<p>    4）梯度下降：核心思想：既然梯度指向损失增长的方向，那么它的反方向 -∇L(θ) 就是损失下降最快的方向。更新规则：θ_new = θ_old - learning_rate * ∇L(θ_old)通过不断沿负梯度方向微小地更新参数 θ，损失函数的值会逐渐减小，模型性能逐步提升。</p>
<p>    5）在大模型中的应用：整个训练过程就是基于梯度下降及其变体（如Adam、AdaGrad）来优化数百万甚至万亿级的参数，最小化预测损失。</p>
<p>篇幅原因这里暂不展开介绍，后面单独章节学习微积分与大模型的关系。</p>
<h4 data-id="heading-7">2.2.2微积分：大模型“优化引擎”</h4>
<p>    微积分是让大模型能够学习的关键，它指导模型如何从错误中改进。核心关系：梯度下降与优化</p>
<p>    1）反向传播 (Backpropagation)：这是模型学习的核心算法。它通过链式法则，从输出层反向计算损失函数对于网络中每一个参数的梯度。梯度是一个向量，指向损失函数增长最快的方向。</p>
<p>    2）梯度下降 (Gradient Descent)：优化算法（如Adam）利用计算出的梯度，沿着梯度相反的方向（即损失下降最快的方向）微调所有参数（那些矩阵中的数），从而逐步降低损失，使模型预测更准确。</p>
<p>    简单比喻：微积分提供了“如何调整模型内部旋钮（参数）才能让它表现得更好”的精确指导手册。</p>
<h3 data-id="heading-8">2.3概率论与信息论：模型评估标准与“决策依据”</h3>
<p>    概率论为AI提供了在不确定性下进行推理的框架，而信息论则提供了衡量信息的方法。篇幅原因后面章节再进行详细拆解概率论基础知识及其在大模型中的应用。</p>
<h4 data-id="heading-9">2.3.1概率论</h4>
<p>    1）基本概念：概率分布、条件概率、贝叶斯定理。</p>
<p>    2）极大似然估计：很多模型的训练目标可以解释为“找到一组参数，使得观测到的数据出现的概率（似然度）最大”。交叉熵损失函数就源于MLE。</p>
<p>    3）生成模型：像GPT这样的自回归模型，其本质是学习一个数据分布 P(x)。它每次预测下一个词，就是在计算条件概率分布 P(下一个词 | 已生成的上文)。</p>
<h4 data-id="heading-10">2.3.2信息论</h4>
<p>    1）熵：衡量一个随机变量的不确定性。熵越大，不确定性越大。</p>
<p>    2）交叉熵：衡量两个概率分布 P (真实分布) 和 Q (模型预测分布) 之间的差异。它是最常用的损失函数。当 P 和 Q 完全相同时，交叉熵最小。</p>
<p>    3）KL散度：衡量两个分布之间的差异程度，与交叉熵紧密相关。</p>
<h4 data-id="heading-11">2.3.3概率论：模型思考与决策</h4>
<p>    大模型本质上是一个概率生成模型，它总是在计算“什么最有可能出现”。概率论决定了大模型的思维方式（概率分布与统计）和最终目标，概率论决定了模型如何“思考”和“决策”</p>
<p>    1）训练目标：预训练的核心任务是自监督学习，即根据上文预测下一个词的概率分布。P(下一个词 | 上文)，这完全是一个概率问题。</p>
<p>    2）损失函数：语言模型普遍使用交叉熵损失来衡量“预测的概率分布”与“真实的one-hot分布”（实际的下一个词）之间的差距。</p>
<pre><code class="hljs">损失函数与概率论及微积分关系：概率论决定了损失函数“是什么”（它的形式和目的），而微积分决定了我们“如何优化”它（找到使其最小化的方法）。用类比来解释这种关系：1）概率论是“立法者”，它制定了法律（损失函数），定义了什么是“好”（低损失）和“坏”（高损失）。2）微积分是“执法者”或“工程师”，它提供了工具（梯度下降）来尽可能地达到“好”的状态（最小化损失）。
</code></pre>
<p>    3）生成与采样：模型输出一个词汇表上的概率分布，通过采样（如Top-p采样）来选择下一个词，从而生成文本。生成就是基于概率采样：当你让模型生成文本时，它计算出词汇表中所有词的概率分布，然后根据某种策略（如贪心搜索、核采样）从这个分布中采样下一个词。这引入了随机性和创造性。</p>
<p>    4）涌现能力：思维链 (Chain-of-Thought)等技术可以看作是在引导模型生成一个高概率的、逻辑正确的推理路径。</p>
<p>    5）模型评估：困惑度是评估语言模型好坏的关键指标，使用困惑度(Perplexity)等基于概率的指标来衡量模型性能，它本质上是交叉熵的指数形式。困惑度越低，模型对下一个词的预测越确定，性能越好。 </p>
<h2 data-id="heading-12">3.学习路径：如何学习数学理论？how</h2>
<p>    《深度学习》里面提到掌握深度学习理论的学习框架也提到数学理论的重要性。如果你想深入理解这些概念和理论，建议按以下顺序学习：</p>
<p>    1）线性代数 -&gt; 掌握数据和运算的表示。</p>
<p>    2）微积分 -&gt; 掌握核心的学习算法。</p>
<p>    3）概率论与信息论 -&gt; 掌握模型的评估和生成原理。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f19b8452ea134f5dbbdc4efff26669f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230296&amp;x-signature=0paX4VUxfab9QMH8pH6F4QHzk9s%3D" alt="" loading="lazy"/></p>
<p>    《深度学习》里面提到的数学基础概念如下，我们将拆分为几篇文章来深入学习相关知识及其在大模型中的作用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8315b4e48eb04ae3bcc3b8ad069c8e03~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230296&amp;x-signature=x%2FEXY1QmG9i7K9lYeMppcqQGPhc%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2816efb60c68404194c2d6af1285dd79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230296&amp;x-signature=CeALTOrTVgfeouBOh6Ti0O4oYtI%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddea29f636f64b78849278ab1acf0755~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUnlpKfmqKHlnos=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230296&amp;x-signature=%2BVok6k5APYPj9eqKM7yj1HcI2oQ%3D" alt="" loading="lazy"/></p>
<p>最终，这些数学知识并非孤立存在，而是完美地交织在一起，共同赋予了大型语言模型令人惊叹的“智能”。</p>
<h3 data-id="heading-13">学习资源推荐</h3>
<p>如果你想更深入地学习大模型，以下是一些非常有价值的学习资源，这些资源将帮助你从不同角度学习大模型，提升你的实践能力。</p>
<blockquote>
<p>本文较长，建议点赞收藏。更多AI大模型应用开发学习视频及资料，在<a href="https://link.juejin.cn?target=https%3A%2F%2Fhy.zhipoai.cn%2F" target="_blank" title="https://hy.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[火山引擎多模态数据湖，破解智能驾驶数据处理瓶颈]]></title>    <link>https://juejin.cn/post/7574625040659906610</link>    <guid>https://juejin.cn/post/7574625040659906610</guid>    <pubDate>2025-11-20T08:02:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574625040659906610" data-draft-id="7574625040659890226" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="火山引擎多模态数据湖，破解智能驾驶数据处理瓶颈"/> <meta itemprop="keywords" content="大数据"/> <meta itemprop="datePublished" content="2025-11-20T08:02:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="字节跳动数据平台"/> <meta itemprop="url" content="https://juejin.cn/user/2159881542179624"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            火山引擎多模态数据湖，破解智能驾驶数据处理瓶颈
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2159881542179624/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    字节跳动数据平台
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T08:02:23.000Z" title="Thu Nov 20 2025 08:02:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在近日举办的2025第八届智能辅助驾驶大会上，火山引擎数据产品解决方案专家分享了由多模态数据湖解决方案构成的数据基座，致力于解决智能网联汽车行业面临的海量多模态数据处理难题。该方案通过存储与计算架构的深度优化，助力企业将百PB级异构数据从“隐性负债”转化为驱动算法迭代与业务增长的核心资产。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e404eb24626494d982883cbf1ce8f34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2X6IqC6Lez5Yqo5pWw5o2u5bmz5Y-w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764230543&amp;x-signature=wAsiWeZcJIbbq4cHrrvayKq9Nzo%3D" alt="" loading="lazy"/></p>
<p>随着智能网联车迈入1Hz数据采集时代，部分信号频率甚至达到100Hz，云端架构面临数据量激增、schema弱化及车云一致性等多重挑战。同时，高级辅助驾驶规模化量产带来动辄百PB级的多模态数据处理需求，传统技术栈在效率、成本和协同性上存在明显瓶颈。火山引擎数据产品解决方案专家指出：“数据飞轮理念虽受认可，但实际应用常受限于高工程协同复杂度与极致处理效率要求。我们的基座设计以开源兼容与AI原生为核心，确保数据高效流转，让其真正成为资产而非负担。”</p>
<p>该能力基座采用开放性架构，聚焦六大关键维度：开箱即用特性、开源兼容性、轻量运维、成本优化、极致性能和AI原生设计。在存储层，方案引入Lance数据湖格式替代传统Parquet，通过列式压缩技术降低30%存储空间，并借助强化元数据描述与高级索引实现多模态数据秒级检索，内置版本管理功能显著提升非结构化数据管理效率。计算层深度整合Spark/Flink大数据栈与Ray/Daft等Python生态框架，通过EMR Ray的分布式并行化能力将算法团队改造成本最小化，在自动化标注场景中已验证可提升GPU利用率20%以上。</p>
<p>实践案例证明该方案具备显著效益。在某主机厂辅助驾驶项目中，火山引擎通过Remote Dataloader解决方案将数据预处理模块与训练集群解耦，使H20训练卡利用率从40%稳定提升至85%以上，单次训练迭代周期缩短50%，云端存储成本降低20%，整体技术降本达20%。另一量产分析项目采用Serverless Flink实时链路与Paimon+ByteHouse湖仓架构，成功将数据新鲜度压缩至分钟级，支撑高频实时决策需求。</p>
<p>展望未来，火山引擎将持续强化智驾与网联场景的多模态湖仓基座性能，推进Ray+Lance技术在量产分析中的落地。随着大模型与数据应用的深度融合，方案将进一步优化数据新鲜度、响应度与AI原生能力，为行业构建以数据消费为导向的要素化治理体系，推动智能驾驶技术向更高阶演进。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🎨 新来的外包，在大群分享了它的限流算法的实现]]></title>    <link>https://juejin.cn/post/7574270661872631846</link>    <guid>https://juejin.cn/post/7574270661872631846</guid>    <pubDate>2025-11-19T13:29:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574270661872631846" data-draft-id="7574254039023763482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🎨 新来的外包，在大群分享了它的限流算法的实现"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-19T13:29:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="有态度的下等马"/> <meta itemprop="url" content="https://juejin.cn/user/448256476727662"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🎨 新来的外包，在大群分享了它的限流算法的实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/448256476727662/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    有态度的下等马
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-19T13:29:43.000Z" title="Wed Nov 19 2025 13:29:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-19
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    14
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0fccab2fa5b3487b8b35ea367414ee75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764166931&amp;x-signature=z7tMahPniACuQORd20qaCv7%2BS8Q%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">1. 令牌桶按用户维度限流</h2>
<p>前文<a href="https://juejin.cn/post/7568124427822825512" target="_blank" title="https://juejin.cn/post/7568124427822825512"><code>golang/x/time/rate</code></a>演示了基于<code>整体</code>请求速率的令牌桶限流；<br/>
那基于<code>用户id、ip、apikey</code>请求速率的限流(更贴近生产的需求)， 阁下又该如何应对？</p>
<p>那这个问题就从<code>全局速率</code>变成了按照<code>用户维度（group by userid）</code>来做限流，那么</p>
<ul>
<li>早先的全局的rateLimiter就要变成人手一个令牌桶，也就是userid:rateLimiter的键值对集合,select count( * ) from table ---&gt; select userid, count(*) from  table group by userid</li>
<li>使用缓存组件来存储维度键值对: 缓存的剔除机制来清理不再访问的键值对 （30min过期，10min周期清理内存）。</li>
</ul>

<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> userLimiters = cache.New(time.Minute*<span class="hljs-number">30</span>, <span class="hljs-number">10</span>) <span class="hljs-comment">// 10 items per minute</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">limiterForUser</span><span class="hljs-params">(userID <span class="hljs-type">string</span>)</span></span> *rate.Limiter {
	<span class="hljs-keyword">if</span> v, found := userLimiters.Get(userID); found {
		<span class="hljs-keyword">return</span> v.(*rate.Limiter)
	}

	l := rate.NewLimiter(rate.Every(time.Minute/<span class="hljs-number">60</span>), <span class="hljs-number">10</span>)
	userLimiters.Set(userID, l, cache.DefaultExpiration)
	<span class="hljs-keyword">return</span> l
}

<span class="hljs-comment">// 更细化的限流： 针对同一用户的请求次数限速， 增加了细粒度的用户维度，需要维护 用户与对应限速器的映射关系</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">userRatelimitMiddleware</span><span class="hljs-params">(c *gin.Context)</span></span> {
	userID := c.GetString(<span class="hljs-string">"userID"</span>)  <span class="hljs-comment">//  从每个请求context的key中取得信息， 这个key对于req context是排他性的</span>
	<span class="hljs-keyword">if</span> userID == <span class="hljs-string">""</span> {
		c.AbortWithStatusJSON(http.StatusUnauthorized, gin.H{<span class="hljs-string">"error"</span>: <span class="hljs-string">"Unauthorized"</span>})
		<span class="hljs-keyword">return</span>
	}
	<span class="hljs-keyword">if</span> userID == <span class="hljs-string">""</span> {
		userID = c.GetString(<span class="hljs-string">"x-api-key"</span>)
	}

	<span class="hljs-keyword">if</span> userID == <span class="hljs-string">""</span> {
		userID = c.ClientIP()
	}
	limiter := limiterForUser(userID) <span class="hljs-comment">// 通过userid维度找到对应的限速器</span>
	<span class="hljs-keyword">if</span> !limiter.Allow() {
		c.AbortWithStatusJSON(http.StatusTooManyRequests, gin.H{<span class="hljs-string">"error"</span>: <span class="hljs-string">"Too many requests"</span>})
		<span class="hljs-keyword">return</span>
	}
	c.Next()
}
</code></pre>
<h2 data-id="heading-1">2. redis 作为限流器外置存储</h2>
<p>这个思路也是极其常见的行为： redis可以成为用户令牌桶的全局中心存储： 当多个负载层需要读写用户限流器时，与redis交互。</p>
<p>本次通过golang的实战，深入理解基于redis的令牌桶限流器的算法实现。</p>
<p>①  请求到达负载层，被负载层识别为userid=junio</p>
<p>②  负载层请求redis获取该用户的token bucket的当前状态:
<code>hget userbucket:junio tokens last_time</code></p>
<p>③  基于当前时间<code>now</code>和<code>last_time</code>，计算流逝的时间，再根据rate计算这一阶段下发了多少tokens:<code>delta=(now-last_time) * r/1000</code>，加上redis原始记录的<code>token</code>,就是本次请求时bucket中能用的tokens， 注意：令牌数量最多不能超过cap</p>
<p>④ 如果tokens&gt;=1, 表示桶中有令牌，可放行请求，tokens数量减1</p>
<p>⑤ 最后将本次处理完后的 tokens和<code>last_time=now</code>写入原用户令牌桶
<code>hset  userbucket:junio  tokens  20 last_time 990</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c02de3fafff04c10a34f558eccb3fbc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pyJ5oCB5bqm55qE5LiL562J6ams:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764166931&amp;x-signature=qK9z4APYh5XXrI8NmOCHWVuh1OI%3D" alt="" loading="lazy"/>
使用redis 中的hashmap存储用户的tokenbucket状态，应用存在<code>读取redis- 计算- 回写redis</code>过程，使用redis lua的脚本执行三个动作，以保证线程安全。</p>
<blockquote>
<p>为什么lua脚本能保证线程安全呢？<br/>
主要得益于 Redis 的单线程架构和原子性执行机制： 加载并执行lua脚本时所有的redis操作作为一个整体完成； 整个脚本执行期间没有其他命令可以插入。</p>
</blockquote>
<pre><code class="hljs language-ini" lang="ini">// 读取- 计算 - 重新赋值都在一个 lua 脚本里面
var <span class="hljs-attr">redisScript</span> = `
	local <span class="hljs-attr">key</span> = KEYS[<span class="hljs-number">1</span>]
	local <span class="hljs-attr">capacity</span> = tonumber(ARGV[<span class="hljs-number">1</span>])
	local <span class="hljs-attr">rate</span> = tonumber(ARGV[<span class="hljs-number">2</span>])
	local <span class="hljs-attr">now</span> = tonumber(ARGV[<span class="hljs-number">3</span>])
	local <span class="hljs-attr">tokens</span> =  tonumber(redis.call(<span class="hljs-string">'hget'</span>, key, <span class="hljs-string">'tokens'</span>) or <span class="hljs-string">'-1'</span>)
	local <span class="hljs-attr">last_time</span> = tonumber(redis.call(<span class="hljs-string">'hget'</span>, key, <span class="hljs-string">'last_time'</span>) or  <span class="hljs-string">'-1'</span>)

	if <span class="hljs-attr">tokens</span>  == -<span class="hljs-number">1</span> or last_time == -<span class="hljs-number">1</span> then
		<span class="hljs-attr">tokens</span> = capacity
		<span class="hljs-attr">last_time</span> = now
	else
		local <span class="hljs-attr">elapsed</span> = now - last_time
        if elapsed &lt; 0 
			then <span class="hljs-attr">elapsed</span> = <span class="hljs-number">0</span>
		end
		local <span class="hljs-attr">delta</span>  = elapsed * rate / <span class="hljs-number">1000</span>
		<span class="hljs-attr">tokens</span> = tokens + delta
		if tokens &gt; capacity then
			<span class="hljs-attr">tokens</span> = capacity
		end
        <span class="hljs-attr">last_time</span> = now
	end
	local <span class="hljs-attr">allow</span> = <span class="hljs-number">0</span>
	if tokens &gt;= 1 then
		<span class="hljs-attr">allow</span> = <span class="hljs-number">1</span>
		<span class="hljs-attr">tokens</span>= tokens - <span class="hljs-number">1</span>
	else	
		<span class="hljs-attr">allow</span> = <span class="hljs-number">0</span>
	end

	redis.call('hset', key, 'tokens', tokens)
	redis.call('hset', key, 'last_time', last_time)
    redis.call('PEXPIRE', key,  math.max(1000, 2 * math.ceil((capacity / rate) * 5000)))
	return allow
`
</code></pre>
<p>注意</p>
<ul>
<li>上面还使用的redis expire机制： redis expire不是滑动过期，但是每次被请求触发执行的时候就重新设置TTL， 表现为“滑动过期”。</li>
<li>除了hset/hget ,还有hmget可用，另外这些操作还有配套的TTL指令，eg：<code>hset key EXAT  1740470400 FIELDS 2 field1 "Hello" field2 "World"</code>。</li>
</ul>
<p>golang应用层的写法如下：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *RedisLimiter)</span></span> Allow(c *gin.Context, userid <span class="hljs-type">string</span>) <span class="hljs-type">bool</span> {
	key := r.keyprefix + userid <span class="hljs-comment">// 定位这个用户的token bucket</span>
	now := time.Now().UnixMilli()
	<span class="hljs-comment">// Check if the key exists in Redis</span>
	rCmd := r.redis.Eval(redisScript, []<span class="hljs-type">string</span>{key}, r.<span class="hljs-built_in">cap</span>, r.rate, now)
	res, err := rCmd.Result()
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		log.Printf(<span class="hljs-string">"get from redis failure. "</span>, err)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
	}
	<span class="hljs-keyword">if</span> allow, ok := res.(<span class="hljs-type">int64</span>); ok { <span class="hljs-comment">// 注意：lua返回的0,1 值对应golang的int64</span>
		log.Printf(<span class="hljs-string">"%v %v \n"</span>, allow, res)
		<span class="hljs-keyword">return</span> allow == <span class="hljs-number">1</span>
	} <span class="hljs-keyword">else</span> {
		log.Printf(<span class="hljs-string">"get from redis failure. "</span>, err)
		<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
	}
}
</code></pre>
<hr/>
<h2 data-id="heading-2">3. 总结展望</h2>
<p>至此限流第二弹结束了，本文紧接掘金爆文<a href="https://juejin.cn/post/7568124427822825512" target="_blank" title="https://juejin.cn/post/7568124427822825512">🎨 新来的外包，限流算法用的这么6</a>，进一步讲述了<br/>
① 实现根据特定业务维度的限流： 从全局限流器转换成针对业务维度的人手一个限流器；</p>
<p>② redis作为限流计数器的外置存储，令牌桶算法在redis上的算法实现：核心是使用hashmap存储当前请求用户的令牌桶状态（current_tokens, last_time）, 落地时注意使用lua脚本避免竞态条件。</p>
<p>后面35+外包er针对限流设计还会再更新几个彩蛋， 期待一键三连，交个朋友， 35+报团不迷路。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude 使用教程]]></title>    <link>https://juejin.cn/post/7574380953176391722</link>    <guid>https://juejin.cn/post/7574380953176391722</guid>    <pubDate>2025-11-20T05:55:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574380953176391722" data-draft-id="7574380953176375338" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude 使用教程"/> <meta itemprop="keywords" content="人工智能,Claude"/> <meta itemprop="datePublished" content="2025-11-20T05:55:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude 使用教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T05:55:23.000Z" title="Thu Nov 20 2025 05:55:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">什么是 Claude Code？</h2>
<p>Claude Code 是 Anthropic 开发的智能编程助手，可以在终端中帮你完成各种编程任务，包括：</p>
<ul>
<li>编写和修改代码</li>
<li>调试和修复错误</li>
<li>浏览和理解代码库</li>
<li>自动化重复任务</li>
<li>管理 Git 操作</li>
</ul>
<h2 data-id="heading-1">安装</h2>
<h3 data-id="heading-2">系统要求</h3>
<ul>
<li>macOS 10.15+ / Ubuntu 20.04+ / Windows 10+（需要 WSL）</li>
<li>Node.js 18 或更高版本</li>
</ul>
<h3 data-id="heading-3">安装方法</h3>
<p><strong>方法一：使用 npm（推荐）</strong></p>
<pre><code class="hljs language-bash" lang="bash">npm install -g @anthropic-ai/claude-code
</code></pre>
<p><strong>方法二：使用原生安装脚本（Linux/Mac）</strong></p>
<pre><code class="hljs language-bash" lang="bash">curl -fsSL https://claude.ai/install.sh | bash
</code></pre>
<h2 data-id="heading-4">基本使用</h2>
<h3 data-id="heading-5">启动 Claude</h3>
<pre><code class="hljs language-bash" lang="bash">claude
</code></pre>
<p>启动后进入交互模式，可以和 Claude 对话并让它帮你完成任务。</p>
<h3 data-id="heading-6">执行单次任务</h3>
<pre><code class="hljs language-bash" lang="bash">claude <span class="hljs-string">"帮我创建一个 React 组件"</span>
</code></pre>
<h2 data-id="heading-7">常用命令</h2>

































<table><thead><tr><th>命令</th><th>功能</th></tr></thead><tbody><tr><td><code>/help</code></td><td>查看帮助信息</td></tr><tr><td><code>/clear</code></td><td>清除对话历史</td></tr><tr><td><code>/init</code></td><td>初始化项目配置</td></tr><tr><td><code>/cost</code></td><td>查看 token 使用情况</td></tr><tr><td><code>/compact</code></td><td>压缩对话以节省 token</td></tr><tr><td><code>/exit</code></td><td>退出 Claude</td></tr></tbody></table>
<h2 data-id="heading-8">核心功能</h2>
<h3 data-id="heading-9">1. 编写和修改代码</h3>
<p>直接告诉 Claude 你想做什么：</p>
<pre><code class="hljs">帮我写一个 Python 函数，用于计算斐波那契数列
</code></pre>
<h3 data-id="heading-10">2. 调试代码</h3>
<pre><code class="hljs">我的程序有个错误，帮我找出问题并修复
</code></pre>
<h3 data-id="heading-11">3. 代码审查</h3>
<pre><code class="hljs">帮我检查这段代码的性能问题
</code></pre>
<h3 data-id="heading-12">4. Git 操作</h3>
<pre><code class="hljs language-sql" lang="sql">帮我创建一个 <span class="hljs-keyword">commit</span>，消息要描述清楚这次改动
</code></pre>
<h2 data-id="heading-13">项目配置</h2>
<h3 data-id="heading-14">CLAUDE.md 文件</h3>
<p>在项目根目录创建 <code>CLAUDE.md</code> 文件，可以告诉 Claude 项目的规范和约定：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># 项目规范</span>

<span class="hljs-bullet">-</span> 使用 TypeScript
<span class="hljs-bullet">-</span> 代码风格遵循 ESLint 配置
<span class="hljs-bullet">-</span> 所有函数需要添加注释
<span class="hljs-bullet">-</span> 测试覆盖率需达到 80% 以上
</code></pre>
<p>Claude 会在工作时自动参考这个文件。</p>
<h2 data-id="heading-15">使用技巧</h2>
<h3 data-id="heading-16">1. 清晰的描述</h3>
<p>越详细的描述，Claude 的输出越准确：</p>
<pre><code class="hljs">帮我创建一个用户登录表单，包含邮箱和密码字段，要有表单验证，使用 React 和 TypeScript
</code></pre>
<h3 data-id="heading-17">2. 分步骤完成复杂任务</h3>
<p>对于复杂任务，可以分步骤进行：</p>
<pre><code class="hljs">第一步：创建数据库模型
第二步：创建 API 接口
第三步：创建前端页面
</code></pre>
<h3 data-id="heading-18">3. 利用计划模式</h3>
<p>对于大型任务，Claude 会先制定计划，你可以审查后再执行：</p>
<pre><code class="hljs">帮我重构这个模块，先给我看看你的计划
</code></pre>
<h2 data-id="heading-19">权限管理</h2>
<p>Claude 在执行某些操作前会请求权限：</p>
<ul>
<li><strong>编辑文件</strong>：显示 diff 让你确认</li>
<li><strong>运行命令</strong>：显示要执行的命令</li>
<li><strong>安装依赖</strong>：显示要安装的包</li>
</ul>
<p>你可以选择：</p>
<ul>
<li>同意（y）</li>
<li>拒绝（n）</li>
<li>自动接受本次会话的所有操作（a）</li>
</ul>
<h2 data-id="heading-20">成本说明</h2>
<p>Claude Code 使用 API 计费：</p>
<ul>
<li>平均每月费用约 $100-200（重度使用）</li>
<li>使用 <code>/cost</code> 查看当前消耗</li>
<li>使用 <code>/compact</code> 压缩历史对话可以节省费用</li>
</ul>
<h2 data-id="heading-21">最佳实践</h2>
<ol>
<li><strong>保持对话简洁</strong>：完成任务后使用 <code>/clear</code> 清除历史</li>
<li><strong>使用项目文档</strong>：创建 CLAUDE.md 说明项目规范</li>
<li><strong>版本控制</strong>：让 Claude 帮你提交代码前先检查 diff</li>
<li><strong>迭代改进</strong>：如果结果不理想，继续对话让 Claude 改进</li>
<li><strong>安全意识</strong>：不要让 Claude 处理敏感信息（密码、密钥等）</li>
</ol>
<h2 data-id="heading-22">常见问题</h2>
<p><strong>Q: Claude 可以访问互联网吗？</strong>
A: Claude Code 主要用于本地代码操作，但可以通过搜索功能获取最新信息。</p>
<p><strong>Q: 支持哪些编程语言？</strong>
A: 支持所有主流编程语言，包括 Python、JavaScript、TypeScript、Go、Rust、Java 等。</p>
<p><strong>Q: 如何提高响应速度？</strong>
A: 使用 <code>/compact</code> 压缩对话历史，或者使用 <code>/clear</code> 清除不必要的上下文。</p>
<p><strong>Q: 可以离线使用吗？</strong>
A: 不可以，Claude Code 需要网络连接来调用 API。</p>
<h2 data-id="heading-23">开始使用</h2>
<p>现在你已经了解了 Claude 的基本用法，试试这些任务入门：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动 Claude</span>
claude

<span class="hljs-comment"># 然后尝试：</span>
<span class="hljs-comment"># 1. "帮我分析当前目录的项目结构"</span>
<span class="hljs-comment"># 2. "创建一个简单的 TODO 应用"</span>
<span class="hljs-comment"># 3. "帮我优化这段代码的性能"</span>
</code></pre>
<p>祝你使用愉快！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java序列化漏洞：RCE 远程执行代码-Serializable]]></title>    <link>https://juejin.cn/post/7574451949325500457</link>    <guid>https://juejin.cn/post/7574451949325500457</guid>    <pubDate>2025-11-20T05:57:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574451949325500457" data-draft-id="7574380953176408106" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java序列化漏洞：RCE 远程执行代码-Serializable"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T05:57:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="shengjk1"/> <meta itemprop="url" content="https://juejin.cn/user/2647279732524957"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java序列化漏洞：RCE 远程执行代码-Serializable
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2647279732524957/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    shengjk1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T05:57:16.000Z" title="Thu Nov 20 2025 05:57:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="gruvbox-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#282828}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#ebdbb2}.hljs-deletion,.hljs-formula,.hljs-keyword,.hljs-link,.hljs-selector-tag{color:#fb4934}.hljs-built_in,.hljs-emphasis,.hljs-name,.hljs-quote,.hljs-strong,.hljs-title,.hljs-variable{color:#83a598}.hljs-attr,.hljs-params,.hljs-template-tag,.hljs-type{color:#fabd2f}.hljs-builtin-name,.hljs-doctag,.hljs-literal,.hljs-number{color:#8f3f71}.hljs-code,.hljs-meta,.hljs-regexp,.hljs-selector-id,.hljs-template-variable{color:#fe8019}.hljs-addition,.hljs-meta-string,.hljs-section,.hljs-selector-attr,.hljs-selector-class,.hljs-string,.hljs-symbol{color:#b8bb26}.hljs-attribute,.hljs-bullet,.hljs-class,.hljs-function,.hljs-function .hljs-keyword,.hljs-meta-keyword,.hljs-selector-pseudo,.hljs-tag{color:#8ec07c}.hljs-comment{color:#928374}.hljs-link_label,.hljs-literal,.hljs-number{color:#d3869b}.hljs-comment,.hljs-emphasis{font-style:italic}.hljs-section,.hljs-strong,.hljs-tag{font-weight:700}</style><p>你好，我是 shengjk1，多年大厂经验，努力构建 通俗易懂的、好玩的编程语言教程。 欢迎关注！你会有如下收益：</p>
<ol>
<li>了解大厂经验</li>
<li>拥有和大厂相匹配的技术等</li>
</ol>
<p>希望看什么，评论或者私信告诉我！</p>
<p>@<a href="https://link.juejin.cn?target=%25E6%2596%2587%25E7%25AB%25A0%25E7%259B%25AE%25E5%25BD%2595" target="_blank" title="%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95" ref="nofollow noopener noreferrer">TOC</a></p>
<h2 data-id="heading-0">一、背景</h2>
<h2 data-id="heading-1">二、JDK 原生的序列化方式</h2>
<p><code>Externalizable</code> 和 <code>Serializable</code> 都是 Java 中用于对象序列化的机制，但它们在<strong>控制粒度、性能、使用复杂度</strong>等方面有显著区别。下面是两者的详细对比：</p>
<hr/>
<h3 data-id="heading-2">一、基本定义</h3>

























<table><thead><tr><th>特性</th><th><code>Serializable</code></th><th><code>Externalizable</code></th></tr></thead><tbody><tr><td>所在包</td><td><code>java.io.Serializable</code></td><td><code>java.io.Externalizable</code></td></tr><tr><td>类型</td><td><strong>标记接口（Marker Interface）</strong><br/>（无方法）</td><td><strong>功能性接口</strong><br/>（需实现 <code>writeExternal()</code> 和 <code>readExternal()</code>）</td></tr><tr><td>继承关系</td><td><code>Externalizable extends Serializable</code></td><td>是 <code>Serializable</code> 的子接口</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-3">二、核心区别对比表</h3>




























































<table><thead><tr><th>对比维度</th><th><code>Serializable</code></th><th><code>Externalizable</code></th></tr></thead><tbody><tr><td><strong>序列化控制</strong></td><td>自动序列化所有非 <code>transient</code>/<code>static</code> 字段</td><td><strong>完全手动控制</strong>：开发者决定哪些字段写入/读取</td></tr><tr><td><strong>构造函数调用</strong></td><td>反序列化时 <strong>不调用任何构造函数</strong>（直接分配内存）</td><td>反序列化时 <strong>必须调用无参构造函数</strong>，再调用 <code>readExternal()</code></td></tr><tr><td><strong>性能</strong></td><td>较慢（反射 + 元数据开销大）</td><td>更快（无反射，直接 I/O 操作）</td></tr><tr><td><strong>序列化体积</strong></td><td>较大（包含类元信息、字段名等）</td><td>更小（只存你需要的数据）</td></tr><tr><td><strong>灵活性</strong></td><td>低（自动处理，难定制）</td><td>高（可加密、压缩、版本兼容等）</td></tr><tr><td><strong>易用性</strong></td><td>极简（只需实现接口）</td><td>复杂（需手写逻辑，易出错）</td></tr><tr><td><strong>默认行为</strong></td><td>支持 <code>defaultWriteObject()</code> / <code>defaultReadObject()</code></td><td>无默认行为，一切靠自己</td></tr><tr><td><strong>父类字段处理</strong></td><td>自动递归处理（只要父类也可序列化）</td><td><strong>不会自动处理父类字段</strong>，需手动写入/读取</td></tr><tr><td><strong>安全性</strong></td><td>较低（反序列化漏洞高发）</td><td>相对可控（可校验输入、过滤恶意数据）</td></tr><tr><td><strong>适用场景</strong></td><td>快速原型、简单本地持久化</td><td>高性能系统、网络传输、自定义格式</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-4">三、代码行为对比</h3>
<h4 data-id="heading-5">1. <code>Serializable</code> 示例（自动）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;
    <span class="hljs-comment">// 自动序列化 name 和 id</span>
}
</code></pre>
<h4 data-id="heading-6">2. <code>Externalizable</code> 示例（手动）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Externalizable</span> {
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> id;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">()</span> {} <span class="hljs-comment">// 必须！</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeExternal</span><span class="hljs-params">(ObjectOutput out)</span> <span class="hljs-keyword">throws</span> IOException {
        out.writeUTF(name); <span class="hljs-comment">// 手动写</span>
        out.writeInt(id);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readExternal</span><span class="hljs-params">(ObjectInput in)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException {
        name = in.readUTF(); <span class="hljs-comment">// 手动读（顺序必须一致！）</span>
        id = in.readInt();
    }
}
</code></pre>
<blockquote>
<p>⚠️ 如果 <code>User</code> 有父类字段，<code>Externalizable</code> 不会自动保存/恢复它们，而 <code>Serializable</code> 会（前提是父类也实现了 <code>Serializable</code> 或有无参构造器等）。</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">四、反序列化过程差异</h3>

























<table><thead><tr><th>步骤</th><th><code>Serializable</code></th><th><code>Externalizable</code></th></tr></thead><tbody><tr><td>1. 创建对象</td><td>JVM 直接分配内存，<strong>跳过构造函数</strong></td><td>先调用 <strong>无参构造函数</strong>，再调用 <code>readExternal()</code></td></tr><tr><td>2. 恢复状态</td><td>通过反射设置字段值</td><td>通过 <code>readExternal()</code> 手动赋值</td></tr><tr><td>3. 完成</td><td>对象 ready</td><td>对象 ready</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-8">五、何时选择哪个？</h3>
<h4 data-id="heading-9">用 <code>Serializable</code> 当：</h4>
<ul>
<li>快速实现序列化；</li>
<li>对象结构简单；</li>
<li>不关心性能或体积；</li>
<li>用于本地缓存、临时存储等。</li>
</ul>
<h4 data-id="heading-10">用 <code>Externalizable</code> 当：</h4>
<ul>
<li>需要<strong>极致性能</strong>（如游戏、高频交易）；</li>
<li>要<strong>控制序列化格式</strong>（如兼容旧协议）；</li>
<li>需要<strong>加密/压缩</strong>序列化数据；</li>
<li>对象包含敏感字段，不想自动暴露；</li>
<li>希望减少网络传输体积。</li>
</ul>
<hr/>
<h3 data-id="heading-11">六、替代方案建议（现代开发）</h3>
<p>虽然两者都是 JDK 内置方案，但在实际生产中，<strong>更推荐使用第三方序列化框架</strong>：</p>

























<table><thead><tr><th>场景</th><th>推荐方案</th></tr></thead><tbody><tr><td>Web API / 配置</td><td><strong>JSON（Jackson / Gson）</strong></td></tr><tr><td>微服务 / RPC</td><td><strong>Protobuf / Thrift</strong></td></tr><tr><td>高性能 Java 应用</td><td><strong>Kryo / FST</strong></td></tr><tr><td>大数据（Spark/Flink）</td><td><strong>Kryo</strong></td></tr></tbody></table>
<p>这些方案通常比 <code>Externalizable</code> 更高效、更安全、更易维护。</p>
<hr/>
<p>总结一句话：</p>
<blockquote>
<p><strong><code>Serializable</code> 是“全自动挡”，<code>Externalizable</code> 是“手动挡”——前者省事，后者精准可控。</strong></p>
</blockquote>
<h2 data-id="heading-12">三、JDK 原生的序列化漏洞RCE</h2>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> java.io.*;
<span class="hljs-keyword">import</span> java.util.Base64;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerializeDemo</span> {

	<span class="hljs-comment">// 1. 必须实现 Serializable 接口</span>
	<span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {
		<span class="hljs-comment">// 建议显式声明 serialVersionUID（否则每次代码改动都会变，导致反序列化失败）</span>
		<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;

		<span class="hljs-keyword">private</span>           String username;
		<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> String password;  <span class="hljs-comment">// transient 字段不会被序列化（敏感信息推荐）</span>
		<span class="hljs-keyword">private</span>           <span class="hljs-type">int</span>    age;

		<span class="hljs-keyword">public</span> <span class="hljs-title function_">User</span><span class="hljs-params">(String username, String password, <span class="hljs-type">int</span> age)</span> {
			<span class="hljs-built_in">this</span>.username = username;
			<span class="hljs-built_in">this</span>.password = password;
			<span class="hljs-built_in">this</span>.age = age;
		}


		<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeObject</span><span class="hljs-params">(java.io.ObjectOutputStream out)</span> <span class="hljs-keyword">throws</span> IOException {
			out.defaultWriteObject();
			System.out.println(<span class="hljs-string">"writeObject 被调用了！！！"</span>);

		}

<span class="hljs-comment">//  关键是在这里，如果服务端接收一个序列化后的对象，反序列化的时候就有可能</span>
		<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(java.io.ObjectInputStream in)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException {
			System.out.println(<span class="hljs-string">"readObject 我被调用了！！！"</span>);
			in.defaultReadObject();
			<span class="hljs-comment">// Runtime.getRuntime().exec("calc");                    // Windows</span>
			Runtime.getRuntime().exec(<span class="hljs-string">"open -a Calculator.app"</span>); <span class="hljs-comment">// macOS</span>
			<span class="hljs-comment">// Runtime.getRuntime().exec("gedit");                   // Linux</span>
		}


		<span class="hljs-meta">@Override</span>
		<span class="hljs-keyword">public</span> String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span> {
			<span class="hljs-keyword">return</span> <span class="hljs-string">"User{username='"</span> + username + <span class="hljs-string">"', password='"</span> + password + <span class="hljs-string">"', age="</span> + age + <span class="hljs-string">'}'</span>;
		}
	}

	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
		<span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-number">18</span>);

		<span class="hljs-comment">// ================ 序列化到字节数组（最常用）===============</span>
		<span class="hljs-type">byte</span>[] bytes = serialize(user);

		<span class="hljs-comment">// 方便传输/存储，通常会转成 Base64 字符串</span>
		<span class="hljs-type">String</span> <span class="hljs-variable">base64</span> <span class="hljs-operator">=</span> Base64.getEncoder().encodeToString(bytes);
		System.out.println(<span class="hljs-string">"Base64 序列化结果："</span>);
		System.out.println(base64);

		<span class="hljs-comment">// ================ 反序列化 ================</span>
		<span class="hljs-type">User</span> <span class="hljs-variable">deserializedUser</span> <span class="hljs-operator">=</span> (User) deserialize(bytes);
		System.out.println(<span class="hljs-string">"反序列化后对象："</span> + deserializedUser);
	}

	<span class="hljs-comment">// 序列化方法（返回 byte[]）</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">byte</span>[] serialize(Object obj) <span class="hljs-keyword">throws</span> IOException {
		<span class="hljs-keyword">try</span> (<span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">baos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();
			 <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(baos)) {
			System.out.println(<span class="hljs-string">"================= 序列化开始 ================"</span>);
			oos.writeObject(obj);
			oos.flush();
			<span class="hljs-keyword">return</span> baos.toByteArray();
		}
	}

	<span class="hljs-comment">// 反序列化方法（这就是高危入口！）</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">deserialize</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] data)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException {
		<span class="hljs-keyword">try</span> (<span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">bais</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(data);
			 <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(bais)) {
			System.out.println(<span class="hljs-string">"================= 反序列化开始 ================"</span>);
			<span class="hljs-keyword">return</span> ois.readObject();   <span class="hljs-comment">// ← 这里就是所有 Java 反序列化漏洞的根源</span>
		}
	}

	<span class="hljs-comment">// 方法1：JVM 启动参数全局过滤（推荐用于无法改代码的老项目）</span>
<span class="hljs-comment">// -Djdk.serialFilter=*!com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;*!java.lang.Runtime;*!java.lang.ProcessBuilder;maxdepth=20;maxrefs=10000</span>


	<span class="hljs-comment">// 方法3：每次创建 ObjectInputStream 时单独设置（最灵活）</span>
	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">safeDeserialize</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] data)</span> <span class="hljs-keyword">throws</span> Exception {
		<span class="hljs-keyword">try</span> (<span class="hljs-type">ByteArrayInputStream</span> <span class="hljs-variable">bais</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(data);
			 <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(bais) {
				 <span class="hljs-meta">@Override</span>
				 <span class="hljs-keyword">protected</span> Class&lt;?&gt; resolveClass(ObjectStreamClass desc)
						 <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException {

					 <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> desc.getName();

					 <span class="hljs-comment">// 白名单（推荐！只允许你自己的类）</span>
					 <span class="hljs-keyword">if</span> (!name.startsWith(<span class="hljs-string">"com.yourcompany.yourapp."</span>) &amp;&amp;
							 !name.startsWith(<span class="hljs-string">"[Lcom.yourcompany.yourapp."</span>) &amp;&amp;  <span class="hljs-comment">// 数组</span>
							 !name.equals(<span class="hljs-string">"java.lang.String"</span>) &amp;&amp;
							 !name.startsWith(<span class="hljs-string">"java.util."</span>) &amp;&amp;
							 !name.startsWith(<span class="hljs-string">"java.lang."</span>)) {
						 <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidClassException</span>(<span class="hljs-string">"Unauthorized class"</span>, name);
					 }

					 <span class="hljs-comment">// 或者用黑名单（不推荐，容易被绕过）</span>
					 <span class="hljs-keyword">if</span> (name.contains(<span class="hljs-string">"TemplatesImpl"</span>) ||
							 name.contains(<span class="hljs-string">"AnnotationInvocationHandler"</span>) ||
							 name.contains(<span class="hljs-string">"Runtime"</span>) ||
							 name.contains(<span class="hljs-string">"ProcessBuilder"</span>)) {
						 <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvalidClassException</span>(<span class="hljs-string">"Blocked dangerous class"</span>, name);
					 }

					 <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.resolveClass(desc);
				 }
			 }) {
			<span class="hljs-keyword">return</span> ois.readObject();
		}
	}
}
</code></pre>
<h2 data-id="heading-13">四、总结</h2></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[清华联合开源！首个基于 MCP 的 RAG 框架，太秀了。]]></title>    <link>https://juejin.cn/post/7574382925762199590</link>    <guid>https://juejin.cn/post/7574382925762199590</guid>    <pubDate>2025-11-20T06:25:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574382925762199590" data-draft-id="7574529034648191028" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="清华联合开源！首个基于 MCP 的 RAG 框架，太秀了。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-20T06:25:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            清华联合开源！首个基于 MCP 的 RAG 框架，太秀了。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T06:25:22.000Z" title="Thu Nov 20 2025 06:25:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>逛 GitHub 挖到宝了，这个叫 UltraRAG 的开源项目是首个基于 MCP 的检索增强生成（RAG）框架，不写代码也能玩转。</p>
<p>用 YAML 文件轻松构建复杂 RAG 系统。</p>
<p>RAG 系统：简单来说，就是让 AI 模型能先检索相关信息，再生成答案，从而提高准确性。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2c13ef5e3c44653831e6b0219dd4803~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224722&amp;x-signature=IbJTZxvP7qN%2FWYNlwNdwwCNK6wc%3D" alt="图片" loading="lazy"/></p>
<p>UltraRAG 是由清华 THUNLP、东北大学 NEUIR、OpenBMB 等多方联合推出的开源项目。</p>
<p>它能让你更容易构建和测试复杂的 RAG 系统。</p>
<h2 data-id="heading-0">01、开源项目简介</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a865b6b11e84c2791f8827b3427af94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224722&amp;x-signature=%2Fd%2FSy2cPtIZQPmiivi7eurMwXAE%3D" alt="图片" loading="lazy"/></p>
<p>这个开源项目的核心思路是把 RAG 的核心组件封装为标准化的独立 MCP Server，提供函数级 Tool 接口支持灵活调用，借助 MCP 客户端建立简洁的链路搭建。这种设计让想使用 RAG 系统的人只需编写 YAML 配置文件，就能直接声明复杂逻辑，大大降低了技术门槛。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9049ce4ef374c338e5e902e65f9fd4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224722&amp;x-signature=gkgnR5Dx%2BFM3iAyegddAYrRKrq4%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>新版版本升级，最新的 2.1 版本主要围绕以下三大核心方向进行了全面升级：</p>
<p><strong>① 原生多模态</strong></p>
<p>统一框架支持文本、图像的检索与生成，新增 VisRAG Pipeline 实现 PDF 到多模态问答的闭环。</p>
<p>而且内置的多模态 Benchmark 覆盖视觉问答等任务，并提供统一的评估体系，方便研究者快速对比实验效果。</p>
<p><strong>② 知识接入与语料构建自动化</strong></p>
<p>支持多格式文档，比如 Word、电子书、网页存档的自动解析与分块，不需要编写复杂脚本即可构建统一格式的知识库。</p>
<p>而且在 PDF 解析方面，它集成了 MinerU 工具，能高保真还原复杂版面与多栏结构，并支持将 PDF 按页转换为图像，保留视觉布局信息。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8ce6bddc3e24b6f9d622311e52935da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224722&amp;x-signature=yFOVXu9a4gCl9WHK%2FZwtai%2BAlBI%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p><strong>③ 统一工作流</strong></p>
<p>通过 YAML 配置驱动检索、生成、评估全流程，支持多种引擎与可视化分析，提升实验复现效率。</p>
<p>开源项目链接和相关教程如下：</p>
<pre><code class="hljs language-ruby" lang="ruby">代码仓库：<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/github.com/</span><span class="hljs-title class_">Open</span>BMB/<span class="hljs-title class_">Ultra</span>RAG教程文档：<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/ultrarag.openbmb.cn/</span>数据集：<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/modelscope.cn/datasets</span><span class="hljs-regexp">/UltraRAG/</span><span class="hljs-title class_">Ultra</span>RAG_Benchmark
</code></pre>
<h2 data-id="heading-1">02、实际效果</h2>
<p>先来看看效果，基于这个开源项目搭建的 RAG 系统的真实示例。比如第一个 Case：基于论文《Attention is All You Need》咨询一个问题，论文中的表 4 具体说了什么，帮忙解释一下。</p>
<p>AI 可以直接解析表格内容，给出如下回答，还是挺清晰的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/75ef2788b9b74a938abc6209353526ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224722&amp;x-signature=Y5h07mFEeNL1B0n1Yenw6WXFing%3D" alt="图片" loading="lazy"/></p>
<p>这是因为刚刚升级的 2.0 可以统一处理文本和图像数据。上传的 PDF 文档，它不仅能读取文字，还能分析里面的图表和公式，实现真正的多模态检索和生成。这避免了以前需要切换不同工具的麻烦。</p>
<p>第二个 Case：基于麦肯锡的《生成式人工智能的经济潜力》报告。让 AI 基于里面的内容，输出生成式 AI 最有潜力的企业职能有哪些？请结合图表和正文说明它们在组织生产力中的影响。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fbcd64fcf15e44ea9a2491d8a56f265c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224722&amp;x-signature=%2BGJX5DQ0v0DjGjMmjBwWPFK8uSI%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-2">03、如何使用</h2>
<p>UltraRAG 支持两种部署方式，第一种是使用 Conda 创建虚拟环境：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64cdc7ca0a43485ea4d3a4625235f39f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224722&amp;x-signature=hwdlijnYHX06RPJC2%2FeKRlES%2BH4%3D" alt="图片" loading="lazy"/></p>
<p>另外一种部署方式是通过 Docker：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a551f733f46f4ccf83c9ad0f9abdf14b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224722&amp;x-signature=xw8jxH%2F9LMDDCvWB7NiYUEBywbc%3D" alt="图片" loading="lazy"/>接下来就能可以基于 UltraRAG 运行一个完整的 RAG Pipeline 了。使用流程主要包括以下三个阶段：</p>
<ul>
<li>编写 Pipeline 配置文件</li>
<li>编译 Pipeline 并调整参数</li>
<li>运行 Pipeline</li>
</ul>
<p>这里不详细展开，可以直接看下面这个文档，写的很详细。</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/ultrarag.openbmb.cn/pages</span><span class="hljs-regexp">/cn/getting</span>_started/quick_start
</code></pre>
<p>你不需要写代码，配置一个 YMAL 文件就行了。而且开源项目内置了 Case Study Viewer 界面，可以对结果进行交互式浏览与分析。 就是下面这样的界面。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0d0da46cddd40f3bcc2fa9a7288195a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224722&amp;x-signature=wSodTUXv3Rcr%2BfwaGKx6lzwHF%2FM%3D" alt="图片" loading="lazy"/><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fba1cf13c5bc4c1b9d21f6fa4e57944e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224722&amp;x-signature=Rvp4%2BQCuOLYwvNMHWaxkZjxU1%2Bk%3D" alt="图片" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AutoMQ × RustFS: Building a new generation of low-cost, high-performance Diskless Kafka based on object storage]]></title>    <link>https://juejin.cn/post/7574380953176801322</link>    <guid>https://juejin.cn/post/7574380953176801322</guid>    <pubDate>2025-11-20T06:31:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574380953176801322" data-draft-id="7574530224852631558" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AutoMQ × RustFS: Building a new generation of low-cost, high-performance Diskless Kafka based on object storage"/> <meta itemprop="keywords" content="云原生"/> <meta itemprop="datePublished" content="2025-11-20T06:31:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AutoMQ"/> <meta itemprop="url" content="https://juejin.cn/user/2878958479084707"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AutoMQ × RustFS: Building a new generation of low-cost, high-performance Diskless Kafka based on object storage
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2878958479084707/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AutoMQ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T06:31:30.000Z" title="Thu Nov 20 2025 06:31:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Enterprises' thirst for real-time data is driving profound changes in data architecture. However, building modern, efficient data streaming platforms generally faces two major bottlenecks: First, Apache Kafka, as the central hub for real-time data, exposes severe cost and operational challenges in cloud environments due to its traditional architecture. High holding costs, near-zero elasticity, and complex partition migrations force enterprises to compromise between cost and performance.</p>
<p>Second, the selection of object storage—the cornerstone of data persistence—is equally challenging. Traditional distributed storage solutions, while powerful, are complex in architecture and have extremely high deployment and operational barriers; while lightweight solutions use the AGPL license, posing potential compliance risks and restrictions for enterprise commercial use. Enterprises need a new data architecture that balances high performance, low cost, ease of maintenance, and license friendliness.</p>
<p>To address these challenges, <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.automq.com%2F%3Futm_source%3Dautomq_rustfs_partner" target="_blank" title="https://www.automq.com/?utm_source=automq_rustfs_partner" ref="nofollow noopener noreferrer">AutoMQ</a> and <a href="https://link.juejin.cn?target=https%3A%2F%2Frustfs.com%2F%3Futm_source%3Dautomq_rustfs_partner" target="_blank" title="https://rustfs.com/?utm_source=automq_rustfs_partner" ref="nofollow noopener noreferrer">RustFS</a> have announced a strategic partnership. The two parties will deeply integrate AutoMQ's cloud-native stream processing capabilities, which are 100% compatible with the Apache Kafka protocol, with RustFS, a high-performance distributed object storage built on Rust, licensed under Apache 2.0, and compatible with S3. This collaboration aims to provide global enterprises with a next-generation Diskless Kafka platform that offers a superior architecture, lower costs, higher performance, and complete avoidance of licensing risks, thereby fundamentally solving the cost and efficiency challenges of real-time data stream processing in the cloud era.</p>
<h3 data-id="heading-0"><strong>About AutoMQ</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.automq.com%2F%3Futm_source%3Dautomq_rustfs_partner" target="_blank" title="https://www.automq.com/?utm_source=automq_rustfs_partner" ref="nofollow noopener noreferrer">AutoMQ</a> is a next-generation cloud-native Kafka-compatible stream processing platform dedicated to solving the core pain points of traditional Kafka in cloud environments: high cost, limited elasticity, and complex operation and maintenance. AutoMQ employs an advanced compute-storage separation architecture, directly persisting streaming data to S3-compatible object storage, while the compute layer (Broker) is completely stateless. This revolutionary design ensures 100% compatibility with the Apache Kafka protocol, guaranteeing seamless migration to existing ecosystems such as Flink and Spark, while delivering a hundredfold increase in elasticity efficiency and second-level partition migration capabilities, helping enterprises run real-time streaming services with up to 90% savings in Total Cost of Ownership (TCO).</p>
<p>💡 Core Advantages</p>
<ul>
<li><strong>Extreme Cost Efficiency</strong> : Achieves unlimited storage and pay-as-you-go pricing based on object storage, and completely eliminates expensive cross-Availability Zone (AZ) data replication traffic through a multi-point write architecture, achieving up to 90% TCO savings.</li>
<li><strong>Hundredfold Elasticity Efficiency</strong> : Stateless Broker supports second-level auto-scaling of compute resources. Partition migration time has been reduced from several hours to 1.5 seconds, enabling truly seamless cluster expansion for business operations.</li>
<li><strong>100% Kafka Compatibility</strong> : Fully compatible with the Apache Kafka protocol and ecosystem, supporting zero-downtime migration from existing clusters without any code modifications.</li>
<li><strong>Fully Managed and Zero-Maintenance</strong> : Built-in automatic data rebalancing and fault self-healing capabilities, providing a BYOC (Bring Your Own Cloud) deployment mode. Data remains 100% within the customer's VPC, ensuring data privacy and security.</li>
</ul>
<p><img src="https://static-file-demo.automq.com/6809c9c3aaa66b13a5498262/69099ff1285da2a02ccc631f_67480fef30f9df5f84f31d36%252F69099fe94bf986bc370da817_WVjZ.png" alt="" loading="lazy"/></p>
<p>Figure 1: AutoMQ Advanced Cloud-Native Architecture</p>
<h3 data-id="heading-1"><strong>About RustFS</strong></h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Frustfs.com%2F%3Futm_source%3Dautomq_rustfs_partner" target="_blank" title="https://rustfs.com/?utm_source=automq_rustfs_partner" ref="nofollow noopener noreferrer">RustFS</a> is a high-performance distributed object storage system developed in Rust and compliant with the S3 protocol. It aims to provide a robust data foundation for AI/ML, big data, and cloud-native applications. Unlike heavyweight architectures like Ceph, RustFS adopts a lightweight "metadata-free" design, where all nodes are equal, greatly simplifying deployment, operation, and scaling, and avoiding single points of failure in metadata. Leveraging the memory safety, high concurrency, and high performance advantages of the Rust language, RustFS achieves extremely high read/write performance and memory stability while providing exabyte-scale scalability.</p>
<p>💡 Core Advantages</p>
<ul>
<li><strong>Apache 2.0 Friendly License</strong> : Utilizing the Apache-2.0 open-source license, it is completely friendly to enterprise commercial use, avoiding the intellectual property and compliance risks associated with licenses such as AGPL.</li>
<li><strong>High Performance and High Stability</strong> : Developed in Rust, it naturally possesses advantages in memory safety and high concurrency; under equivalent configurations, its read/write performance far surpasses Ceph, and its memory usage is stable with no high-concurrency jitter.</li>
<li><strong>Lightweight, metadata-free architecture</strong> : Deployment and maintenance are extremely simple, requiring no dedicated metadata server. Scaling is easy, requiring only a single command to start, significantly lowering the operational threshold.</li>
<li><strong>100% S3 Compatibility</strong> : Fully compatible with the S3 API, supporting existing toolchains and SDKs. It also supports enterprise-level features such as version control, object read-only, and cross-region replication, seamlessly replacing existing S3 storage solutions.</li>
</ul>
<p><img src="https://static-file-demo.automq.com/6809c9c3aaa66b13a5498262/69099ff1285da2a02ccc6324_67480fef30f9df5f84f31d36%252F69099fea4bf986bc370da8b8_l9lr.png" alt="" loading="lazy"/></p>
<p>Figure 2: RustFS Architecture (Source: RustFS Official Website)</p>
<h2 data-id="heading-2"><strong>AutoMQ × RustFS: Building a secure, scalable, cross-cloud Diskless Kafka architecture</strong></h2>
<p>The deep integration of AutoMQ's compute-storage separation architecture and RustFS's high-performance distributed storage achieves end-to-end technical synergy across three dimensions: cross-cloud support, security and reliability, and unlimited scalability, jointly forming a next-generation Diskless Kafka platform.</p>
<ol>
<li><strong>Building a Unified, Highly Available Data Flow</strong></li>
</ol>
<p>Both architectures are designed specifically for multi-cloud environments. AutoMQ provides a flexible BYOC (Bring Your Own Cloud) deployment model, supporting compute instances deployed in multi-cloud environments such as Amazon Web Services, Google Cloud, and Azure, as well as private data centers (IDCs). RustFS provides "true multi-cloud storage" capabilities at the storage layer, supporting bucket-level proactive-proactive cross-region replication. The combination of AutoMQ's BYOC compute layer and RustFS's cross-cloud storage layer enables enterprises to build unified, vendor-locked real-time data services, truly achieving highly available data flow across clouds and regions.</p>
<ol>
<li><strong>Achieving End-to-End Data Security and Privacy</strong></li>
</ol>
<p>Both technologies jointly construct end-to-end security and reliability. AutoMQ provides TLS/mTLS encryption at the access layer and deploys the data plane within the user's VPC using BYOC mode, ensuring "data stays within the VPC" and "superior data privacy." RustFS provides high-performance object storage security encryption at the storage layer and ensures data integrity and high availability through version control, object read-only (WORM), and proactive replication mechanisms. AutoMQ is responsible for access security and data privacy at the computation layer, while RustFS is responsible for encryption and data redundancy at the persistence layer. Together, they provide enterprises with end-to-end security from access and computation to storage, along with a strict read-after-write consistency model.</p>
<ol>
<li><strong>Independent flexibility in computing and storage</strong></li>
</ol>
<p>The architectures of both solutions completely resolve the pain point of traditional Kafka's difficulty in scaling. RustFS adopts a lightweight architecture with a "centralized metadata server," supporting EB-level storage capacity and "unlimited scaling." AutoMQ, with its storage-compute separation and stateless broker design, achieves auto-scaling at the compute layer and second-level partition migration. The perfect combination of AutoMQ's compute layer elasticity (second-level scaling) and RustFS's storage layer elasticity (EB-level capacity) finally allows enterprises to independently and on-demand expand compute resources (to cope with traffic surges) or storage resources (to cope with data growth), achieving true unlimited scaling.</p>
<p><img src="https://static-file-demo.automq.com/6809c9c3aaa66b13a5498262/69099ff1285da2a02ccc6327_67480fef30f9df5f84f31d36%252F69099fea285da2a02ccc5faa_Zor5.png" alt="" loading="lazy"/></p>
<p>Figure 3: AutoMQ &amp; RustFS Collaborative Architecture</p>
<h2 data-id="heading-3"><strong>What It Brings</strong></h2>
<p>The deep technical synergy between AutoMQ and RustFS brings enterprises a high-performance, low-cost, secure, and compliant real-time data infrastructure. Its core advantages are:</p>
<ul>
<li><strong>True unlimited elasticity and high performance</strong> : Both architectures support independent scaling. AutoMQ's stateless broker supports second-level elasticity, reducing partition migration time from hours to seconds, while maintaining a low latency of less than 10ms for P99. RustFS provides EB-level storage capacity and "unlimited scaling" capabilities. Enterprises can independently scale compute or storage as needed to cope with traffic surges and data growth.</li>
<li><strong>End-to-end security, reliability, and compliance</strong> : AutoMQ's BYOC deployment model ensures "data never leaves the VPC," guaranteeing excellent data privacy and providing TLS/mTLS encryption. RustFS provides high-performance encryption, version control, and WORM (read-only object) functionality at the storage layer. More importantly, RustFS's use of the Apache 2.0 license allows enterprises to completely avoid "license traps" like AGPL, achieving 100% commercial friendliness and compliance.</li>
<li><strong>A Fully Open-Source Joint Solution</strong> : At the heart of this joint solution lies our shared belief in the open-source ecosystem. Both parties have built on the Apache License, collaborating to create a 100% full-stack Apache-licensed solution for enterprises, from the compute layer to the storage layer. This not only provides enterprises with a secure and compliant commercial option with a high degree of autonomy and control, but this open practice has also won widespread recognition from the community.</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAutoMQ%2Fautomq%2F%3Futm_source%3Dautomq_rustfs_partner" target="_blank" title="https://github.com/AutoMQ/automq/?utm_source=automq_rustfs_partner" ref="nofollow noopener noreferrer">AutoMQ open source project address</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Frustfs%2Frustfs%2F%3Futm_source%3Dautomq_rustfs_partner" target="_blank" title="https://github.com/rustfs/rustfs/?utm_source=automq_rustfs_partner" ref="nofollow noopener noreferrer">RustFS open-source project address</a></p>
<ul>
<li><strong>Extreme Cost Optimization</strong> : AutoMQ, with its compute-storage separation architecture, can save up to 90% on Kafka TCO and, through multi-point read/write architecture optimization, completely avoids expensive cross-Availability Zone (AZ) traffic. RustFS's lightweight architecture has low hardware requirements, and combined with the Apache 2.0 friendly license, further reduces storage and software licensing costs.</li>
<li><strong>Cross-Cloud Support and Greatly Simplified Operations</strong> : Both companies provide "true multi-cloud storage" and deployment capabilities, helping enterprises prevent single-cloud vendor lock-in. AutoMQ's fully managed and automatic data rebalancing features, combined with RustFS's lightweight architecture with "no metadata center" and low difficulty of use, greatly reduce the operational complexity of the entire system.</li>
</ul>
<h2 data-id="heading-4">Looking Ahead</h2>
<p>AutoMQ and RustFS will continue to deepen their technological integration, jointly driving the development of cloud-native real-time data infrastructure. Together, they will provide global enterprises with lower-cost, higher-performance, easier-to-maintain, and compliance-risk-free data streaming solutions, accelerating the transformation of enterprises from data to intelligence and jointly building an open and efficient cloud-native data ecosystem.</p>
<p>Visit the AutoMQ website now to learn about the ultimate performance and cost advantages of the next-generation cloud-native Kafka: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.automq.com%2F%3Futm_source%3Dautomq_rustfs_partner" target="_blank" title="https://www.automq.com/?utm_source=automq_rustfs_partner" ref="nofollow noopener noreferrer">AutoMQ</a></p>
<p>Also visit the RustFS website to explore high-performance S3 storage solutions based on the Apache-2.0 license: <a href="https://link.juejin.cn?target=https%3A%2F%2Frustfs.com%2F%3Futm_source%3Dautomq_rustfs_partner" target="_blank" title="https://rustfs.com/?utm_source=automq_rustfs_partner" ref="nofollow noopener noreferrer">RustFS</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[提高 iOS 应用逆向难度的工程实践，多工具联动的全栈安全方案]]></title>    <link>https://juejin.cn/post/7574581079626498054</link>    <guid>https://juejin.cn/post/7574581079626498054</guid>    <pubDate>2025-11-20T06:23:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574581079626498054" data-draft-id="7574530224852533254" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="提高 iOS 应用逆向难度的工程实践，多工具联动的全栈安全方案"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-20T06:23:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="星星电灯猴"/> <meta itemprop="url" content="https://juejin.cn/user/2848205394945444"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            提高 iOS 应用逆向难度的工程实践，多工具联动的全栈安全方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2848205394945444/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    星星电灯猴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T06:23:50.000Z" title="Thu Nov 20 2025 06:23:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在移动安全领域，“提高 iOS 应用逆向难度”并不是一句抽象口号，而是一个可度量、可迭代、可工程化的目标。
无论你的应用是 Swift、ObjC、Flutter、H5、Unity、RN，最终都会被编译成一个 IPA，而逆向人员拿到 IPA 后，有一整套成熟工具链可以对你的 App 进行结构分析、符号还原与动态 Hook。</p>
<p>因此，防护的本质不是“无法被逆向”，而是让逆向 <strong>成本极高</strong>、<strong>定位困难</strong>、<strong>入手成本上升</strong>、并且保持 <strong>运行稳定</strong>。</p>
<p>本文给出一套真实开发者可以落地的逆向难度提升方案，涵盖静态层、动态层、资源层、成品混淆、验证测试、到映射表治理，完全可复制。</p>
<hr/>
<h2 data-id="heading-0">一、逆向人员会怎样拆解 iOS 应用？</h2>
<p>他们一般会：</p>
<h4 data-id="heading-1">1. 静态分析 IPA</h4>
<ul>
<li>Hopper / IDA</li>
<li>class-dump</li>
<li>Mach-O 符号扫描</li>
<li>查看应用 Bundle 资源</li>
<li>分析 JS/H5、配置文件、动态库结构</li>
</ul>
<h4 data-id="heading-2">2. 动态攻击</h4>
<ul>
<li>Frida 动态 Hook</li>
<li>Cycript 注入</li>
<li>Runtime Method Swizzling</li>
<li>越狱环境下抓包与行为分析</li>
</ul>
<h4 data-id="heading-3">3. 行为分析</h4>
<ul>
<li>分析启动流程</li>
<li>定位鉴权或加密逻辑</li>
<li>定位插件桥接接口</li>
<li>查找业务关键路径</li>
</ul>
<p><strong>只要你的符号和资源不隐藏，这些步骤几乎都不需要太多努力。</strong></p>
<hr/>
<h2 data-id="heading-4">二、提高逆向难度需要覆盖哪些层？</h2>
<p>真正有效的逆向防护必须覆盖：</p>
<p><strong>① 符号层（核心）</strong></p>
<ul>
<li>类名</li>
<li>方法名</li>
<li>Swift 模块</li>
<li>属性名</li>
</ul>
<p><strong>② 资源层</strong></p>
<ul>
<li>图片 MD5 扰动</li>
<li>JSON/JS/H5 文件名扰动</li>
<li>游戏资源或混合应用资源保护</li>
</ul>
<p><strong>③ 二进制结构层</strong></p>
<ul>
<li>去除可读符号</li>
<li>减少结构入口</li>
<li>扰动符号引用关系</li>
</ul>
<p><strong>④ 运行时层</strong></p>
<ul>
<li>提高 Hook 定位难度</li>
<li>关键逻辑的动态路径保护</li>
</ul>
<p><strong>⑤ 签名层与完整性层</strong></p>
<ul>
<li>防止二次打包</li>
<li>防止注入</li>
</ul>
<p><strong>⑥ 映射治理层</strong></p>
<ul>
<li>避免混淆后无法符号化崩溃</li>
<li>保证功能稳定性</li>
</ul>
<p>没有覆盖这些层，只做表面的“混淆”是无法显著提升逆向难度的。</p>
<hr/>
<h2 data-id="heading-5">三、可直接落地的多工具组合方案（推荐链路）</h2>
<p>这是架构团队可以直接复制到项目里的全流程。</p>
<hr/>
<h3 data-id="heading-6"><strong>第一步：静态扫描（发现风险面）</strong></h3>
<p>使用 <strong>MobSF</strong>：</p>
<ul>
<li>静态结构扫描</li>
<li>敏感 API 检测</li>
<li>Swift/ObjC 符号可读性评估</li>
<li>资源路径扫描</li>
</ul>
<p>使用 <strong>class-dump</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">class-dump app.ipa &gt; dump.txt
</code></pre>
<p>输出 Swift/ObjC 的可视符号。</p>
<p>这一步的结果将生成：</p>
<ul>
<li>白名单</li>
<li>不可混淆的符号列表</li>
<li>引用链（JS、H5、插件等）</li>
</ul>
<hr/>
<h3 data-id="heading-7"><strong>第二步（若能改源码）：源码级混淆</strong></h3>
<p>工具包括：</p>
<ul>
<li>Swift Shield（Swift 方法/类/属性重命名）</li>
<li>obfuscator-llvm（控制流混淆、字符串加密）</li>
<li>自定义脚本处理敏感常量</li>
</ul>
<p>作用：</p>
<ul>
<li>底层结构变复杂</li>
<li>编译期保护关键模块</li>
</ul>
<p>如果无法改源码 → 跳过。</p>
<hr/>
<h3 data-id="heading-8"><strong>第三步：IPA 成品层混淆（真正提升逆向难度的核心步骤）</strong></h3>
<p>这里使用 <strong>Ipa Guard（命令行版）</strong>，因为它支持：</p>
<ul>
<li>无需源码</li>
<li>对 Swift/ObjC 层进行符号重写</li>
<li>修改 IPA 内资源名、MD5</li>
<li>JS/H5 混淆</li>
<li>自定义混淆策略（sym.json）</li>
<li>多平台运行（Windows / macOS）</li>
<li>可集成到 CI</li>
</ul>
<h4 data-id="heading-9"><strong>3.1 导出符号供策略分析</strong></h4>
<pre><code class="hljs language-bash" lang="bash">ipaguard_cli parse app.ipa -o sym.json
</code></pre>
<p><code>sym.json</code> 包含：</p>
<ul>
<li>可以混淆的符号</li>
<li>必须排除的符号</li>
<li>引用链（fileReferences / stringReferences）</li>
</ul>
<h4 data-id="heading-10"><strong>3.2 编辑策略</strong></h4>
<p>重点：</p>
<ul>
<li>桥接方法必须 <code>confuse:false</code></li>
<li>Storyboard 必须排除</li>
<li>SDK 初始化必须保留</li>
<li>JS/H5 引用必须同步处理</li>
<li><code>refactorName</code> 长度不变</li>
</ul>
<hr/>
<h4 data-id="heading-11"><strong>3.3 进行深度混淆与资源扰动</strong></h4>
<pre><code class="hljs language-bash" lang="bash">ipaguard_cli protect app.ipa -c sym.json --email dev@team.com --image --js -o protected.ipa
</code></pre>
<p>实现：</p>
<ul>
<li>所有可混淆符号被随机化</li>
<li>资源文件名扰动</li>
<li>图片 MD5 改动（防替换）</li>
<li>JS 文件名混淆（Hybrid 应用必要）</li>
</ul>
<p><em>这是提高逆向难度的关键步骤。</em></p>
<hr/>
<h3 data-id="heading-12"><strong>第四步：重签名 + 功能验收</strong></h3>
<p>混淆后的 IPA 必须重签。</p>
<pre><code class="hljs language-bash" lang="bash">kxsign sign protected.ipa -c cert.p12 -p pass \
  -m dev.mobileprovision -z signed.ipa -i
</code></pre>
<p>测试重点：</p>
<ul>
<li>启动</li>
<li>登录</li>
<li>主要业务链路</li>
<li>SDK 初始化</li>
<li>WebView/H5</li>
<li>插件通信（Flutter、Unity、RN）</li>
</ul>
<hr/>
<h3 data-id="heading-13"><strong>第五步：动态逆向难度验证（攻防测试）</strong></h3>
<p>使用 <strong>Frida</strong>：</p>
<pre><code class="hljs language-css" lang="css">frida -U -f com<span class="hljs-selector-class">.app</span> <span class="hljs-attr">--no-pause</span> -l hook<span class="hljs-selector-class">.js</span>
</code></pre>
<p>验证：</p>
<ul>
<li>函数定位是否困难</li>
<li>Hook 是否容易失败</li>
<li>是否仍能找到敏感逻辑</li>
</ul>
<p>使用 <strong>Hopper/IDA</strong>：</p>
<ul>
<li>检查符号是否完全变形</li>
<li>结构是否被扰动</li>
<li>Swift 模块是否不可读</li>
</ul>
<hr/>
<h3 data-id="heading-14"><strong>第六步：映射表治理（防止混淆后无法调试）</strong></h3>
<p>存储：</p>
<ul>
<li>sym.json（策略文件）</li>
<li>混淆映射表</li>
<li>版本号 → 构建号 → 符号映射关系</li>
<li>签名指纹</li>
</ul>
<p>存放：</p>
<ul>
<li>KMS / HSM</li>
<li>加密归档</li>
<li>Git 私有仓库（加密仓储）</li>
</ul>
<p>用于：</p>
<ul>
<li>崩溃符号化</li>
<li>紧急回滚</li>
<li>策略版本记录</li>
</ul>
<p>没有治理 → 不能称为“工程级防护”。</p>
<hr/>
<h2 data-id="heading-15">提升逆向难度靠“体系”，不是“某个工具”</h2>
<p>真正提升逆向难度需要：</p>
<ul>
<li><strong>静态分析 → 白名单</strong></li>
<li><strong>编译期混淆（可选）</strong></li>
<li><strong>成品 IPA 混淆（必做，Ipa Guard 为核心）</strong></li>
<li><strong>资源扰动</strong></li>
<li><strong>重签与测试</strong></li>
<li><strong>逆向验证</strong></li>
<li><strong>映射治理与可回滚</strong></li>
</ul>
<p>推荐工具组合：</p>
<h4 data-id="heading-16"><strong>分析层</strong></h4>
<p>MobSF、class-dump、Hopper</p>
<h4 data-id="heading-17"><strong>混淆层（核心）</strong></h4>
<p>Ipa Guard CLI（成品混淆）
Swift Shield / obfuscator-llvm（源码混淆）</p>
<h4 data-id="heading-18"><strong>验证层</strong></h4>
<p>kxsign、Frida、IDA</p>
<h4 data-id="heading-19"><strong>治理层</strong></h4>
<p>KMS、Sentry/Bugly</p>
<p>这才是一个完整的、可操作、可复制的提高逆向难度方案。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gemini 3.0发布，但Generative UI更让我眼前一亮]]></title>    <link>https://juejin.cn/post/7574382925762084902</link>    <guid>https://juejin.cn/post/7574382925762084902</guid>    <pubDate>2025-11-20T06:16:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574382925762084902" data-draft-id="7574568258801975323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gemini 3.0发布，但Generative UI更让我眼前一亮"/> <meta itemprop="keywords" content="Gemini,Google"/> <meta itemprop="datePublished" content="2025-11-20T06:16:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="北极的树"/> <meta itemprop="url" content="https://juejin.cn/user/3059269887853066"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gemini 3.0发布，但Generative UI更让我眼前一亮
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3059269887853066/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    北极的树
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T06:16:40.000Z" title="Thu Nov 20 2025 06:16:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Google昨晚重磅发布了Gemini 3.0，看指标基本碾压了现有的一系列模型。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3156f812256541e08560831f70c04cd1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX5p6B55qE5qCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224199&amp;x-signature=5CgpQA7JPmHLflXSUsEt84914KA%3D" alt="" loading="lazy"/></p>
<p>网上大量的评测文章，这里就不再赘述，在编程领域的真实实力也尚有待深度体验（<code>以前很多模型出来时各种刷分，深度体验后还是被claude吊打</code>）。</p>
<p>这次发布，我比较感兴趣的反而是一同发布的<strong>Generative UI（生成式用户界面）</strong> 。官方甚至发了专门的论文介绍实现原理，也给了一个具象化的演示。</p>
<p>当在<strong>Generative UI</strong>模式下提问："RNA聚合酶如何工作？原核细胞和真核细胞的转录阶段有哪些不同？"</p>
<p>可以看看响应结果的形式和以前的模型有什么不同：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a22827d5a9894189bd29f6d43385c75a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX5p6B55qE5qCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224199&amp;x-signature=0Ak2U580S9bx3%2F5gcMN8b0qUYcE%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">什么是Generative UI</h2>
<p>在传统软件开发中，UI是固化的。设计师用Figma画好原型，开发同学按照设计稿还原UI，用户最终看到的界面，早在几周甚至几个月前就定好了。</p>
<p>Generative UI的核心理念完全不同：<strong>界面不再是预先存在的，而是深刻理解用户的意图和需求后，实时生成一个完整的、可交互的界面</strong>。</p>
<p>比如，当你问“给我规划一个北京3日游“，传统的LLM只会返回一大段文字攻略。但Generative UI会：</p>
<ul>
<li>生成一个交互式的地图，标注每天的景点路线</li>
<li>添加一个时间轴，展示每天的行程安排</li>
<li>配上景点卡片，点击就能看图片和介绍</li>
<li>还有一个筛选器，让你调整预算和兴趣偏好</li>
</ul>
<p>也就是说，<strong>模型不再局限于生成内容，还生成了承载内容的界面本身</strong>。</p>
<h2 data-id="heading-1">应用场景</h2>
<p>Generative UI看起来比较酷炫，但真正有价值的是它能解决哪些实际问题。根据论文和官方演示，我整理了几个很有想象空间的场景。</p>
<h4 data-id="heading-2">场景一：快速产品原型</h4>
<p>做产品的同学应该了解，需求演示是沟通中比较费劲的环节。</p>
<p>传统流程里，产品想给开发或者老板演示一个新的想法需求，通常有两个选择：</p>
<ul>
<li><strong>画草图/PPT</strong>：快，但没法交互，全靠脑补，对方经常理解偏差。</li>
<li><strong>做交互原型</strong>：效果好，但太慢。产品经理写文档，设计师画图，前端写Demo，等这一套下来，可能黄花菜都凉了。</li>
</ul>
<p><strong>Generative UI看起来就能解决"想演示但做不出来"的痛点。</strong></p>
<p>产品同学不需要懂代码、也不需要懂设计，只需准确阐述需求就可快速生成交互式产品原型。不满意的地方还可以继续迭代修改。</p>
<h4 data-id="heading-3">场景二：个性化教育界面</h4>
<p>教育应该是Generative UI最能发挥价值的领域之一，论文中花了很大篇幅展示这个场景。</p>
<p>传统的在线教育平台，不管学生水平如何，看到的都是同一套课件。这就像让小学生和大学生读同一本教科书，效果肯定差。Khan Academy、Coursera这些平台虽然有题目难度分级，但界面本身是固定的。</p>
<p>Generative UI的做法完全不同：<strong>根据学生的先验知识和理解能力，动态生成不同复杂度的学习界面</strong>。</p>
<p>论文中有个典型案例：教"化学实验"这个主题。</p>
<p>对于初中生，系统生成的是：</p>
<ul>
<li>大号的彩色图标</li>
<li>每个步骤配动画演示</li>
<li>用类比的方式解释（"原子就像乐高积木"）</li>
<li>有互动小游戏巩固知识</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be106f17e8cb4ff09bc0fd125eaf9b3f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX5p6B55qE5qCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224199&amp;x-signature=Ovdy0eE3I4EeM1QqcDLesWpkOU0%3D" alt="" loading="lazy"/></p>
<p>而对于化学系学生，系统生成的是：</p>
<ul>
<li>精确的分子结构图</li>
<li>化学方程式和计量计算</li>
<li>实验数据表格</li>
<li>安全注意事项清单</li>
</ul>
<p>关键是，这些都不需要教师手动准备多个版本。学生输入自己的学习目标和背景，系统可以自动生成最适合的学习界面。</p>
<p>更厉害的是实时调整能力。如果学生在某个概念上卡住了（<code>通过交互数据判断，比如反复点击同一个区域</code>），系统会自动简化那部分的界面，增加提示和辅助说明。</p>
<p>论文中还展示了一个"斜率和切线"的教学案例。系统检测到学生喜欢篮球，就把抽象的数学概念转化成"投篮轨迹"来讲解，学生的理解速度明显提升。</p>
<p>这种个性化不是简单的"换个背景图"，而是<strong>认知层面的结构性适配</strong>。同样是讲分形，成年人看到的是数学公式和递归算法，小学生看到的是"树枝怎么长出来"的动画故事。界面的信息密度、交互复杂度、语言风格，都是动态调整的。</p>
<h4 data-id="heading-4">场景三：电商的意图驱动购物</h4>
<p>查阅了相关资料，在电商领域，Generative UI应该也能在一定程度上改变购物体验。</p>
<p>现在的电商搜索，用户要把模糊的购物意图（<code>"我想买一套适合海滩婚礼的衣服"</code>）翻译成一系列筛选操作：男装 → 西装 → 亚麻 → 米色 → 尺码。这个过程很繁琐，而且容易漏掉重要选项。</p>
<p>Generative UI的做法：直接理解这一意图，生成一个临时的精品店界面。</p>
<p>系统生成的不是一个标准列表，而是一个杂志风格的"Lookbook"布局：</p>
<ul>
<li>将西装、衬衫、乐福鞋搭配展示</li>
<li>用轻松的海滩氛围照片做背景</li>
<li>标注每件单品的透气性和舒适度</li>
<li>还有一个"比这个更休闲"的滑块</li>
</ul>
<p>如果用户反馈"太正式了"，界面会瞬间重排，替换为更休闲的Polo衫和卡其裤组合。</p>
<p>这种交互方式，将购物从"搜索商品"变成了"与导购对话"，界面本身即是推荐引擎的具象化。</p>
<hr/>
<p>以上只是我个人体会、以及从网上看到的可能发挥巨大价值的应用场景。实际上，Generative UI的潜力可能远不止于此。</p>
<p>我觉得，<strong>每个行业、每个场景，只要涉及"信息呈现"和"交互"，都有机会被Generative UI重新定义。</strong> 这不是一个单一的产品功能，而是一种新的人机交互范式。</p>
<h2 data-id="heading-5">技术原理：从Prompt到交互界面</h2>
<p>讨论完应用场景，接着咱们通过论文详细了解它是如何做到的。论文中披露了详细的技术架构，我用通俗的方式解释一下核心原理。</p>
<h4 data-id="heading-6">整体架构：四层技术栈</h4>
<p>根据论文，Generative UI的实现依赖于四个核心层：</p>
<p><strong>1. 组件库</strong></p>
<p>系统预先定义了一套标准化的UI组件，包括按钮、卡片、图表、表单、地图等基础组件，以及一些复合组件（<code>比如商品卡片、用户评价模块</code>）。这些组件都是经过设计系统规范的，确保生成的界面有统一的视觉风格。</p>
<p><strong>2. 系统指令</strong></p>
<p>这是告诉模型"怎么生成UI"的规则。包括：何时使用哪种组件、如何布局、什么样的交互符合用户预期。论文中称之为"元提示"（<code>meta-prompt</code>），它相当于给模型注入了设计原则和前端开发的最佳实践</p>
<p><strong>3. 大语言模型</strong></p>
<p>Gemini 3.0是核心引擎。它负责理解用户的自然语言输入，分析意图，然后从组件库中选择合适的组件，生成最终的UI代码（<code>通常是HTML/CSS/JavaScript</code>）</p>
<p><strong>4. 后处理层</strong></p>
<p>生成的代码会经过静态分析，检查语法错误、安全漏洞、性能问题。如果发现问题，系统会自动修正或重新生成。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/210b1ecbc9274ec6ad2d0a485a70ffac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX5p6B55qE5qCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764224199&amp;x-signature=q4OQiErsK%2FRHUy5ePWqCRxajDBk%3D" alt="" loading="lazy"/></p>
<p>论文中特别强调，这四层缺一不可。早期的GPT-3.5尝试过类似任务，但由于模型能力不足，经常生成错误的代码或不符合设计规范的界面。接下来，分别探讨一下每一层的细节。</p>
<h4 data-id="heading-7">核心技术点一：组件库与工具调用</h4>
<p>Generative UI的第一个关键，是<strong>把UI组件当作"工具"提供给模型</strong>。</p>
<p>传统的LLM只能输出文本。Generative UI的做法是，给模型一个"工具箱"，里面有各种UI组件的接口，例如：</p>
<pre><code class="hljs language-css" lang="css">工具：生成图表
参数：
  - 类型：柱状图/折线图/饼图
  - 数据：<span class="hljs-selector-attr">[数组]</span>
  - 标题：字符串
  - 配色方案：主题名称
</code></pre>
<p>这段代码会被前端引擎解析，直接渲染成一个交互式图表。</p>
<p>可以用乐高来类比：组件库提供的是标准化的积木块，模型的任务不是制造积木，而是根据需求来组装积木。这样既保证了UI的质量和一致性，又给了模型足够的灵活性。</p>
<p>论文数据显示，当组件库有50+种组件时，模型能覆盖95%以上的常见UI需求。</p>
<h4 data-id="heading-8">核心技术点二：意图理解与布局生成</h4>
<p>第二个关键是，模型要理解用户意图，并转化成合理的UI布局。</p>
<p>这里涉及一个隐式的推理过程，论文中称为"Planning（规划）"。</p>
<p>当用户说"规划一次去巴黎的旅行"时，模型会进行类似这样的思维链：</p>
<ol>
<li><strong>需求分析</strong>：旅行需要交通、住宿、景点、预算</li>
<li><strong>组件选择</strong>：需要地图组件（地理位置）、列表组件（酒店选项）、天气卡片、计算器组件（预算）</li>
<li><strong>布局决策</strong>：桌面端把地图放右侧、列表放左侧；移动端用标签页切换</li>
</ol>
<p>模型输出的不是HTML代码，而是一个结构化的<strong>UI描述</strong>（通常是JSON格式）：</p>
<pre><code class="hljs language-css" lang="css">{
  "layout": <span class="hljs-string">"two-column"</span>,
  <span class="hljs-string">"left"</span>: {
    "component": <span class="hljs-string">"hotel-list"</span>,
    <span class="hljs-string">"data"</span>: [...],
    <span class="hljs-string">"sortBy"</span>: <span class="hljs-string">"price"</span>
  },
  "<span class="hljs-attribute">right</span>": {
    "component": <span class="hljs-string">"interactive-map"</span>,
    <span class="hljs-string">"markers"</span>: [...]
  },
  "<span class="hljs-attribute">bottom</span>": {
    "component": <span class="hljs-string">"budget-calculator"</span>
  }
}
</code></pre>
<p>前端引擎拿到这个描述，用本地的UI组件库渲染出实际界面。</p>
<h4 data-id="heading-9">核心技术点三：上下文管理与迭代优化</h4>
<p>第三个关键是处理用户的连续修改请求。</p>
<p>传统的LLM是无状态的，每次对话都是独立的。Generative UI需要记住之前的界面状态，才能实现增量修改。</p>
<p>论文中采用的方案是<strong>状态管理</strong>：</p>
<ul>
<li>
<p>用户首次输入，生成界面A</p>
</li>
<li>
<p>用户说"把地图放大一点"，系统不是重新生成整个界面，而是：</p>
<ul>
<li>从上下文中取出界面A的描述</li>
<li>定位到"地图"组件</li>
<li>只修改地图的"size"参数</li>
<li>输出界面B（<code>其他部分保持不变</code>）</li>
</ul>
</li>
</ul>
<p>系统会记住你们聊过的所有内容，包括之前生成的界面、你的修改请求、甚至你的交互行为（<code>比如哪些按钮点得多，说明那部分用户感兴趣</code>）。</p>
<p>论文数据显示，在3轮修改内，模型能保持状态一致性的准确率达到92%。</p>
<h4 data-id="heading-10">核心技术点四：安全性与一致性保障</h4>
<p>最后一个关键是确保生成的界面安全、可用。</p>
<p>AI生成的代码可能有Bug，也可能包含不安全的内容。论文中的解决方案是<strong>后处理层</strong>，其中的工作包括：</p>
<p><strong>语法修复</strong>：自动检测和修复常见错误，比如括号不匹配、标签没闭合。</p>
<p><strong>安全过滤</strong>：禁止生成执行任意JavaScript的代码，只允许调用预定义的组件和API。</p>
<p><strong>设计一致性检查</strong>：确保生成的界面符合设计系统规范，比如颜色、字体、间距都在允许范围内。</p>
<p><strong>性能优化</strong>：如果生成的界面有性能问题（<code>比如一次渲染1000个组件</code>），自动优化成分页或虚拟滚动。</p>
<p>论文数据显示，经过后处理的界面，运行时错误率从18%降到了不到2%。</p>
<h4 data-id="heading-11">技术挑战：不是完美的</h4>
<p>虽然Generative UI很强大，但论文也指出了当前的局限性。</p>
<p>最明显的问题是速度。生成一个复杂界面可能需要10-30秒，这包括模型推理、工具调用、后处理等多个环节。对于习惯了"即时响应"的用户来说，这个等待时间还是有点长。论文中提到，团队正在优化流式生成技术，先显示骨架屏，再逐步渲染完整组件，让等待过程不那么焦虑。</p>
<p>另一个问题是模型偶尔会"幻觉"。它可能会"编造"一个根本不存在的组件，比如试图调用一个名为<code>SuperFancyChart</code>的组件，但组件库里根本没有。结果就是界面渲染失败。目前的解决办法是在系统指令中明确列出所有可用组件，并在后处理层做兜底检查，发现不存在的组件就替换成最接近的替代品。</p>
<p>对于非常复杂的交互，比如多步表单、拖拽排序这类需要精细状态管理的场景，模型的成功率还不够高，论文给出的数据是大约70%。这意味着10次里有3次可能需要人工介入调整。</p>
<p>还有一个有意思的悖论：为了让AI生成高质量的UI，你反而需要一个非常严格、标准化的组件库。这意味着UI设计师的角色正在发生转变，从"画页面"变成了"设计原子组件"和"制定组装规则"。某种程度上，设计师的工作从具体变抽象了。</p>
<h2 data-id="heading-12">写在最后</h2>
<p>相比Gemini 3.0在参数和评测指标上的巨大提升，我觉得<strong>Generative UI</strong>更是让我眼前一亮。</p>
<p>它的核心突破在于：<strong>界面不再是预先设计好的静态模板，而是根据你的需求即时生成、动态适配的交互体验</strong>。对于产品经理、创业者、教育工作者来说，这意味着从想法到可演示原型的时间，从几天缩短到几分钟。</p>
<p>目前，Generative UI已经在谷歌搜索的AI模式（<code>AI Mod</code>e）和Gemini应用中上线，但仅限美区的Pro/Ultra订阅用户使用。国内用户暂时只能等待全量开放。</p>
<p>不过论文和演示已经足够说明方向：<strong>从"人适应界面"到"界面适应人"，这不仅是技术进步，更是交互范式的转变</strong>。期待它正式开放后，能为我们的工作带来实实在在的效率提升。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Mac使用FFmpeg进行屏幕录制，并使用VLC本地播放]]></title>    <link>https://juejin.cn/post/7574584245152186419</link>    <guid>https://juejin.cn/post/7574584245152186419</guid>    <pubDate>2025-11-20T06:35:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574584245152186419" data-draft-id="7574625040631087142" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Mac使用FFmpeg进行屏幕录制，并使用VLC本地播放"/> <meta itemprop="keywords" content="GitHub,FFmpeg"/> <meta itemprop="datePublished" content="2025-11-20T06:35:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="雷子跑不快"/> <meta itemprop="url" content="https://juejin.cn/user/3034307822098967"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Mac使用FFmpeg进行屏幕录制，并使用VLC本地播放
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3034307822098967/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    雷子跑不快
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T06:35:04.000Z" title="Thu Nov 20 2025 06:35:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是一篇关于如何在<code>Mac</code>上使用<code>FFmpeg</code>进行屏幕录制，并使用<code>VLC</code>播放器进行本地播放的教程，默认读者已经安装好了<code>FFmpeg</code>和<code>VLC</code>播放器。
本文将介绍如何使用<code>FFmpeg</code>命令行工具进行屏幕录制，并通过<code>VLC</code>播放器进行实时播放，对于<code>FFmpeg</code>和<code>VLC</code>的安装和基础使用，读者可以参考相关文档。</p>
<h2 data-id="heading-0">1. Mac上捕获屏幕的FFmpeg输入源</h2>
<p>在Mac上，<code>FFmpeg</code>可以使用<code>avfoundation</code>输入源来捕获屏幕内容。要查看可用的设备列表，可以运行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash">ffmpeg -f avfoundation -list_devices <span class="hljs-literal">true</span> -i <span class="hljs-string">""</span>
</code></pre>
<p>你会看到类似如下的输出：</p>
<pre><code class="hljs language-bash" lang="bash">AVFoundation video devices:
[0] Capture screen 0
[1] FaceTime HD Camera

AVFoundation audio devices:
[0] MacBook Pro Microphone
[1] Multi-Output Device
</code></pre>
<h2 data-id="heading-1">2. 直播Mac屏幕</h2>
<p>假设你要推流到一个 RTMP 服务器（例：rtmp://localhost/live/stream）</p>
<h3 data-id="heading-2">2.1 不包含音频的屏幕录制命令：</h3>
<pre><code class="hljs language-bash" lang="bash">ffmpeg \
  -f avfoundation -framerate 30 -i <span class="hljs-string">"0:none"</span> \
  -c:v libx264 -preset veryfast -f flv rtmp://localhost/live/stream
</code></pre>
<h3 data-id="heading-3">2.2 包含音频的屏幕录制命令：</h3>
<pre><code class="hljs language-bash" lang="bash">ffmpeg \
  -f avfoundation -framerate 30 -i <span class="hljs-string">"0:0"</span> \
  -c:v libx264 -preset veryfast -maxrate 3000k -bufsize 6000k \
  -c:a aac -b:a 128k \
  -f flv rtmp://localhost/live/stream
</code></pre>
<p>解释：</p>
<ul>
<li>"0:0" → （屏幕设备 ID : 音频设备 ID）</li>
<li>0 = 主屏幕</li>
<li>0 = 麦克风</li>
<li>-framerate 30 → 流畅度佳，CPU占用适中</li>
<li>-f flv → RTMP 必须使用 FLV 封装</li>
<li>libx264 → 网络直播最稳定</li>
</ul>
<h3 data-id="heading-4">2.3 配置nginx-full</h3>
<p>通常路径：</p>
<pre><code class="hljs language-bash" lang="bash">/opt/homebrew/etc/nginx/nginx.conf
</code></pre>
<p>在<code>nginx.conf</code>中添加RTMP模块配置：</p>
<pre><code class="hljs language-nginx" lang="nginx">rtmp {
    http { ... }

    # 下面是要添加的内容
    server {
        listen 1935;

        application live {
            live on;
            record off;
        }
    }
}
</code></pre>
<h3 data-id="heading-5">2.4 启动nginx-full</h3>
<pre><code class="hljs language-bash" lang="bash">brew services start nginx-full
</code></pre>
<h3 data-id="heading-6">2.5 验证RTMP是否启动成功</h3>
<pre><code class="hljs language-bash" lang="bash">lsof -i :1935
</code></pre>
<p>如果看到 nginx 在监听该端口，说明启动成功</p>
<pre><code class="hljs language-bash" lang="bash">nginx   12345   ...   LISTEN
</code></pre>
<h3 data-id="heading-7">2.6 推流FFmpeg</h3>
<pre><code class="hljs language-bash" lang="bash">ffmpeg \
  -f avfoundation -framerate 30 -i <span class="hljs-string">"0:none"</span> \
  -c:v libx264 -preset veryfast -f flv rtmp://localhost/live/stream
</code></pre>
<h3 data-id="heading-8">2.7 使用VLC播放RTMP流</h3>
<p>打开VLC播放器，选择“打开网络串流”，输入以下URL：</p>
<pre><code class="hljs language-bash" lang="bash">rtmp://localhost/live/stream
</code></pre>
<p>点击“播放”，即可观看实时屏幕录制内容。</p>
<h2 data-id="heading-9">3. 最后</h2>
<p>在本文中，除了介绍如何使用<code>FFmpeg</code>在Mac上进行屏幕录制外，还涵盖了如何配置<code>nginx-full</code>以支持RTMP流的推送和播放。关于<code>nginx-full</code>的更多配置和使用，可以参考相关文档。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcoder-cjl.github.io%2F" target="_blank" title="https://coder-cjl.github.io/" ref="nofollow noopener noreferrer">我的博客地址</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[渐进增强、优雅降级及现代Web开发技术详解]]></title>    <link>https://juejin.cn/post/7574581079626514438</link>    <guid>https://juejin.cn/post/7574581079626514438</guid>    <pubDate>2025-11-20T06:24:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7574581079626514438" data-draft-id="7574581079626465286" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="渐进增强、优雅降级及现代Web开发技术详解"/> <meta itemprop="keywords" content="Node.js,JavaScript"/> <meta itemprop="datePublished" content="2025-11-20T06:24:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小前端_我自坚强"/> <meta itemprop="url" content="https://juejin.cn/user/2335811609826423"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            渐进增强、优雅降级及现代Web开发技术详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2335811609826423/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小前端_我自坚强
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-20T06:24:28.000Z" title="Thu Nov 20 2025 06:24:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-20
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">渐进增强、优雅降级及现代Web开发技术详解</h2>
<h3 data-id="heading-1">引言</h3>
<p>在当今快速发展的Web开发领域，如何确保应用在各种设备和浏览器环境下都能良好运行成为了前端工程师必须面对的重要课题。渐进增强（Progressive Enhancement）和优雅降级（Graceful Degradation）是两种重要的设计理念，它们指导我们如何构建具有广泛兼容性和良好用户体验的Web应用。与此同时，随着技术的发展，出现了诸如渐进式Web应用（PWA）、服务端渲染（SSR）、静态站点生成（SSG）以及增量静态再生（ISR）等先进技术和方法论，它们进一步丰富了我们的开发工具箱，帮助我们构建更加高效、可靠的Web应用。</p>
<p>本文将深入探讨这些概念和技术，分析它们的设计理念、实现方式以及在实际项目中的应用价值。</p>
<h3 data-id="heading-2">第一章：渐进增强与优雅降级</h3>
<h4 data-id="heading-3">1.1 渐进增强的概念与原则</h4>
<p>渐进增强是一种Web设计哲学，强调从基本功能开始，逐步为支持更多特性的浏览器添加增强体验。这一理念的核心思想是确保所有用户都能访问基本内容和功能，然后根据用户设备和浏览器的能力提供更好的体验。</p>
<p>渐进增强遵循三个基本原则：</p>
<ol>
<li><strong>内容层</strong>：确保基本内容在任何设备和浏览器上都可访问</li>
<li><strong>表现层</strong>：通过CSS为内容添加视觉样式和布局</li>
<li><strong>行为层</strong>：通过JavaScript添加交互和动态功能</li>
</ol>
<p>这种方法的优势在于：</p>
<ul>
<li>提高了应用的可访问性</li>
<li>增强了在老旧设备和浏览器上的兼容性</li>
<li>减少了因JavaScript错误导致的完全失效风险</li>
<li>有利于SEO优化，因为搜索引擎爬虫更容易抓取基础内容</li>
</ul>
<h4 data-id="heading-4">1.2 优雅降级的概念与实践</h4>
<p>优雅降级是从最完善的体验开始，然后针对老旧浏览器逐步降低功能，但仍保持基本可用性。与渐进增强相反，优雅降级先考虑现代浏览器的最佳体验，再考虑兼容性问题。</p>
<p>优雅降级的特点：</p>
<ul>
<li>优先为现代浏览器提供最佳体验</li>
<li>通过检测浏览器能力来决定是否启用某些功能</li>
<li>在不支持的环境中提供替代方案或简化版本</li>
</ul>
<h4 data-id="heading-5">1.3 两者对比与选择</h4>
<p>渐进增强和优雅降级各有优劣，选择哪种方法取决于项目需求、目标用户群体和技术资源等因素：</p>






























<table><thead><tr><th>对比维度</th><th>渐进增强</th><th>优雅降级</th></tr></thead><tbody><tr><td>开发思路</td><td>从基础到高级</td><td>从高级到基础</td></tr><tr><td>兼容性</td><td>更好地支持老旧设备</td><td>主要关注现代浏览器</td></tr><tr><td>开发成本</td><td>初期投入较大</td><td>快速实现高级功能</td></tr><tr><td>用户体验</td><td>确保基本功能可用</td><td>现代浏览器体验更好</td></tr></tbody></table>
<p>在实际项目中，很多团队会选择结合两种方法的优点，既保证基本功能的可用性，又为现代浏览器提供增强体验。</p>
<h3 data-id="heading-6">第二章：渐进式Web应用（PWA）</h3>
<h4 data-id="heading-7">2.1 PWA概述</h4>
<p>渐进式Web应用（Progressive Web Apps，简称PWA）是由Google提出的一种利用现代Web技术创建接近原生应用体验的Web应用方法。PWA结合了Web和原生应用的优点，提供了离线工作、推送通知、后台同步等功能。</p>
<p>PWA的核心特点包括：</p>
<ol>
<li><strong>渐进式</strong> - 适用于所有用户，无论浏览器选择如何</li>
<li><strong>响应式</strong> - 适配各种屏幕尺寸</li>
<li><strong>连接独立性</strong> - 通过Service Worker在离线或低质量网络下工作</li>
<li><strong>类原生应用</strong> - 具有类似原生应用的交互和导航</li>
<li><strong>持续更新</strong> - 始终是最新的，无需应用商店审核</li>
<li><strong>安全性</strong> - 通过HTTPS提供服务，防止窥探和内容篡改</li>
<li><strong>可发现性</strong> - W3C manifests和service worker注册范围允许搜索引擎找到它们</li>
<li><strong>可重新参与</strong> - 通过推送通知等功能保持用户参与度</li>
<li><strong>可安装</strong> - 允许用户将应用"保存"到主屏幕上</li>
<li><strong>可链接</strong> - 通过URL轻松分享，无需复杂的安装过程</li>
</ol>
<h4 data-id="heading-8">2.2 PWA核心技术</h4>
<h5 data-id="heading-9">2.2.1 Service Worker</h5>
<p>Service Worker是PWA的核心技术之一，它是一个在浏览器后台运行的脚本，独立于网页，为应用提供离线体验、消息推送和后台同步等功能。</p>
<p>Service Worker的主要功能：</p>
<ul>
<li>拦截网络请求并提供缓存响应</li>
<li>管理缓存和更新缓存策略</li>
<li>接收推送通知</li>
<li>后台同步数据</li>
<li>地理围栏等后台功能</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 注册Service Worker</span>
<span class="hljs-keyword">if</span> (<span class="hljs-string">'serviceWorker'</span> <span class="hljs-keyword">in</span> navigator) {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-function">() =&gt;</span> {
    navigator.<span class="hljs-property">serviceWorker</span>.<span class="hljs-title function_">register</span>(<span class="hljs-string">'/sw.js'</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">registration</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'SW registered: '</span>, registration);
      })
      .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">registrationError</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'SW registration failed: '</span>, registrationError);
      });
  });
}

<span class="hljs-comment">// sw.js - Service Worker实现示例</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CACHE_NAME</span> = <span class="hljs-string">'my-site-cache-v1'</span>;
<span class="hljs-keyword">const</span> urlsToCache = [
  <span class="hljs-string">'/'</span>,
  <span class="hljs-string">'/styles/main.css'</span>,
  <span class="hljs-string">'/scripts/main.js'</span>
];

self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'install'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
  <span class="hljs-comment">// 预缓存重要资源</span>
  event.<span class="hljs-title function_">waitUntil</span>(
    caches.<span class="hljs-title function_">open</span>(<span class="hljs-variable constant_">CACHE_NAME</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">cache</span> =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Opened cache'</span>);
        <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">addAll</span>(urlsToCache);
      })
  );
});

self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'fetch'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
  event.<span class="hljs-title function_">respondWith</span>(
    caches.<span class="hljs-title function_">match</span>(event.<span class="hljs-property">request</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-comment">// 如果缓存中有匹配项，则返回缓存的响应</span>
        <span class="hljs-keyword">if</span> (response) {
          <span class="hljs-keyword">return</span> response;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(event.<span class="hljs-property">request</span>);
      }
    )
  );
});
</code></pre>
<h5 data-id="heading-10">2.2.2 Web App Manifest</h5>
<p>Web App Manifest是一个JSON文件，提供了关于Web应用的信息，使浏览器能够将应用安装到用户的主屏幕，并在启动时提供类似原生应用的体验。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"My Progressive Web App"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"short_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MyPWA"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"start_url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"display"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"standalone"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"background_color"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#ffffff"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"theme_color"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#000000"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"icons"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/icon-192x192.png"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sizes"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"192x192"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image/png"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/icon-512x512.png"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sizes"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"512x512"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"image/png"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h5 data-id="heading-11">2.2.3 离线功能实现</h5>
<p>PWA通过缓存策略实现离线功能，常见的缓存策略包括：</p>
<ol>
<li><strong>Cache First（缓存优先）</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'fetch'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
  event.<span class="hljs-title function_">respondWith</span>(
    caches.<span class="hljs-title function_">match</span>(event.<span class="hljs-property">request</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-comment">// 如果缓存中有匹配项，则返回缓存的响应</span>
        <span class="hljs-comment">// 否则发起网络请求</span>
        <span class="hljs-keyword">return</span> response || <span class="hljs-title function_">fetch</span>(event.<span class="hljs-property">request</span>);
      })
  );
});
</code></pre>
<ol start="2">
<li><strong>Network First（网络优先）</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'fetch'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
  event.<span class="hljs-title function_">respondWith</span>(
    <span class="hljs-title function_">fetch</span>(event.<span class="hljs-property">request</span>)
      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-comment">// 网络请求失败时回退到缓存</span>
        <span class="hljs-keyword">return</span> caches.<span class="hljs-title function_">match</span>(event.<span class="hljs-property">request</span>);
      })
  );
});
</code></pre>
<ol start="3">
<li><strong>Stale While Revalidate（陈旧即用，然后更新）</strong></li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript">self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'fetch'</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
  event.<span class="hljs-title function_">respondWith</span>(
    caches.<span class="hljs-title function_">open</span>(<span class="hljs-variable constant_">CACHE_NAME</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">cache</span> =&gt;</span> {
      <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">match</span>(event.<span class="hljs-property">request</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> {
        <span class="hljs-comment">// 同时发起网络请求更新缓存</span>
        <span class="hljs-keyword">const</span> fetchPromise = <span class="hljs-title function_">fetch</span>(event.<span class="hljs-property">request</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">networkResponse</span> =&gt;</span> {
          cache.<span class="hljs-title function_">put</span>(event.<span class="hljs-property">request</span>, networkResponse.<span class="hljs-title function_">clone</span>());
          <span class="hljs-keyword">return</span> networkResponse;
        });
        
        <span class="hljs-comment">// 返回缓存响应或等待网络响应</span>
        <span class="hljs-keyword">return</span> response || fetchPromise;
      });
    })
  );
});
</code></pre>
<h4 data-id="heading-12">2.3 PWA的优势与挑战</h4>
<h5 data-id="heading-13">2.3.1 优势</h5>
<ol>
<li><strong>跨平台兼容性</strong> - 一次开发，多平台运行</li>
<li><strong>无需安装</strong> - 通过URL即可访问，降低了用户使用门槛</li>
<li><strong>离线访问</strong> - 提供离线浏览体验</li>
<li><strong>推送通知</strong> - 增强用户参与度</li>
<li><strong>性能优化</strong> - 通过缓存机制提高加载速度</li>
<li><strong>SEO友好</strong> - 仍然是标准Web页面，利于搜索引擎索引</li>
</ol>
<h5 data-id="heading-14">2.3.2 挑战</h5>
<ol>
<li><strong>浏览器支持</strong> - 部分老旧浏览器不支持</li>
<li><strong>功能限制</strong> - 相比原生应用仍有功能限制</li>
<li><strong>开发复杂性</strong> - 需要处理多种缓存策略和服务工作线程</li>
<li><strong>调试困难</strong> - Service Worker的调试相对复杂</li>
</ol>
<h3 data-id="heading-15">第三章：服务端渲染（SSR）</h3>
<h4 data-id="heading-16">3.1 SSR概述</h4>
<p>服务端渲染（Server-Side Rendering，简称SSR）是指在服务器端生成HTML页面，然后将其发送给客户端浏览器的技术。与传统的客户端渲染（CSR）不同，SSR在服务器上完成页面的初始渲染，用户可以直接看到渲染后的页面内容。</p>
<h4 data-id="heading-17">3.2 SSR的工作原理</h4>
<p>在SSR中，页面的渲染过程如下：</p>
<ol>
<li>用户请求页面URL</li>
<li>服务器接收请求，根据路由匹配相应组件</li>
<li>服务器在Node.js环境中执行组件代码，生成HTML字符串</li>
<li>服务器将生成的HTML发送给客户端</li>
<li>客户端接收到HTML后进行hydrate（激活），绑定事件处理器</li>
</ol>
<h4 data-id="heading-18">3.3 SSR的优势</h4>
<h5 data-id="heading-19">3.3.1 SEO优化</h5>
<p>搜索引擎爬虫可以直接读取服务器返回的完整HTML内容，无需等待JavaScript执行，大大提高了SEO效果。</p>
<h5 data-id="heading-20">3.3.2 首屏加载速度</h5>
<p>用户可以立即看到页面内容，无需等待所有JavaScript下载和执行完毕，提升了首屏加载速度和用户体验。</p>
<h5 data-id="heading-21">3.3.3 更好的可访问性</h5>
<p>对于禁用JavaScript的用户或网络状况较差的情况，仍然可以访问基本内容。</p>
<h4 data-id="heading-22">3.4 SSR的实现方式</h4>
<h5 data-id="heading-23">3.4.1 React SSR实现</h5>
<p>React提供了ReactDOMServer API来实现SSR：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// server.js</span>
<span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOMServer</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom/server'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App'</span>;

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'*'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> appString = <span class="hljs-title class_">ReactDOMServer</span>.<span class="hljs-title function_">renderToString</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);
  
  res.<span class="hljs-title function_">send</span>(<span class="hljs-string">`
    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;SSR App&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;div id="root"&gt;<span class="hljs-subst">${appString}</span>&lt;/div&gt;
        &lt;script src="/client.js"&gt;&lt;/script&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  `</span>);
});

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);
</code></pre>
<p>客户端hydrate代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// client.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App'</span>;

<span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">hydrate</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>, <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'root'</span>));
</code></pre>
<h5 data-id="heading-24">3.4.2 Vue SSR实现</h5>
<p>Vue提供了vue-server-renderer来实现SSR：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// server.js</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Vue</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vue'</span>);
<span class="hljs-keyword">const</span> server = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)();
<span class="hljs-keyword">const</span> renderer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vue-server-renderer'</span>).<span class="hljs-title function_">createRenderer</span>();

server.<span class="hljs-title function_">get</span>(<span class="hljs-string">'*'</span>, <span class="hljs-function">(<span class="hljs-params">req, res</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>({
    <span class="hljs-attr">data</span>: {
      <span class="hljs-attr">url</span>: req.<span class="hljs-property">url</span>
    },
    <span class="hljs-attr">template</span>: <span class="hljs-string">`&lt;div&gt;访问的 URL 是：{{ url }}&lt;/div&gt;`</span>
  });

  renderer.<span class="hljs-title function_">renderToString</span>(app, <span class="hljs-function">(<span class="hljs-params">err, html</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) {
      res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">end</span>(<span class="hljs-string">'Internal Server Error'</span>);
      <span class="hljs-keyword">return</span>;
    }
    res.<span class="hljs-title function_">end</span>(<span class="hljs-string">`
      &lt;!DOCTYPE html&gt;
      &lt;html&gt;
        &lt;head&gt;&lt;title&gt;Hello&lt;/title&gt;&lt;/head&gt;
        &lt;body&gt;<span class="hljs-subst">${html}</span>&lt;/body&gt;
      &lt;/html&gt;
    `</span>);
  });
});

server.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<h4 data-id="heading-25">3.5 SSR框架</h4>
<h5 data-id="heading-26">3.5.1 Next.js</h5>
<p>Next.js是React生态系统中最流行的SSR框架之一，提供了开箱即用的SSR支持：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// pages/index.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params">{ data }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        {data.map(item =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>&gt;</span>{item.name}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getServerSideProps</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 在服务端获取数据</span>
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/data'</span>);
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">props</span>: {
      data
    }
  };
}
</code></pre>
<h5 data-id="heading-27">3.5.2 Nuxt.js</h5>
<p>Nuxt.js是Vue生态系统中的SSR框架：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// pages/index.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in items"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>&gt;</span>
        {{ item.name }}
      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">asyncData</span>(<span class="hljs-params">{ $axios }</span>) {
    <span class="hljs-comment">// 在服务端获取数据</span>
    <span class="hljs-keyword">const</span> items = <span class="hljs-keyword">await</span> $axios.$get(<span class="hljs-string">'https://api.example.com/items'</span>);
    <span class="hljs-keyword">return</span> { items };
  }
};
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h4 data-id="heading-28">3.6 SSR的挑战</h4>
<h5 data-id="heading-29">3.6.1 服务器负载</h5>
<p>SSR增加了服务器的计算负担，每个请求都需要在服务器上进行渲染。</p>
<h5 data-id="heading-30">3.6.2 复杂性增加</h5>
<p>需要处理服务端和客户端的差异，如全局变量、生命周期钩子等。</p>
<h5 data-id="heading-31">3.6.3 缓存策略</h5>
<p>需要设计合理的缓存策略来减轻服务器压力。</p>
<h3 data-id="heading-32">第四章：静态站点生成（SSG）</h3>
<h4 data-id="heading-33">4.1 SSG概述</h4>
<p>静态站点生成（Static Site Generation，简称SSG）是在构建时生成静态HTML文件的方法。与SSR在每次请求时动态生成HTML不同，SSG在构建阶段就完成了页面的渲染，生成的静态文件可以直接部署到CDN上。</p>
<h4 data-id="heading-34">4.2 SSG的工作原理</h4>
<p>SSG的构建过程包括：</p>
<ol>
<li>构建时获取数据</li>
<li>根据数据生成静态HTML文件</li>
<li>生成静态资源（CSS、JavaScript等）</li>
<li>将所有静态文件部署到服务器或CDN</li>
</ol>
<h4 data-id="heading-35">4.3 SSG的优势</h4>
<h5 data-id="heading-36">4.3.1 性能优异</h5>
<p>静态文件可以从CDN快速分发，加载速度极快。</p>
<h5 data-id="heading-37">4.3.2 成本低廉</h5>
<p>无需服务器计算资源，部署成本低。</p>
<h5 data-id="heading-38">4.3.3 安全性高</h5>
<p>没有服务器端代码执行，减少了安全攻击面。</p>
<h5 data-id="heading-39">4.3.4 可靠性强</h5>
<p>静态文件不易出错，系统稳定性高。</p>
<h4 data-id="heading-40">4.4 SSG的实现</h4>
<h5 data-id="heading-41">4.4.1 Next.js SSG实现</h5>
<p>Next.js支持多种数据获取方法来实现SSG：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// pages/posts/[id].js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Post</span>(<span class="hljs-params">{ post }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{post.title}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">dangerouslySetInnerHTML</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">__html:</span> <span class="hljs-attr">post.content</span> }} /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 构建时获取静态路径</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticPaths</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/posts'</span>);
  <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();
  
  <span class="hljs-keyword">const</span> paths = posts.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">post</span> =&gt;</span> ({
    <span class="hljs-attr">params</span>: { <span class="hljs-attr">id</span>: post.<span class="hljs-property">id</span>.<span class="hljs-title function_">toString</span>() }
  }));

  <span class="hljs-keyword">return</span> { paths, <span class="hljs-attr">fallback</span>: <span class="hljs-literal">false</span> };
}

<span class="hljs-comment">// 构建时获取数据</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticProps</span>(<span class="hljs-params">{ params }</span>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.example.com/posts/<span class="hljs-subst">${params.id}</span>`</span>);
  <span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">props</span>: {
      post
    }
  };
}
</code></pre>
<h5 data-id="heading-42">4.4.2 Gatsby.js</h5>
<p>Gatsby是基于React的静态站点生成器：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// gatsby-node.js</span>
<span class="hljs-built_in">exports</span>.<span class="hljs-property">createPages</span> = <span class="hljs-keyword">async</span> ({ graphql, actions }) =&gt; {
  <span class="hljs-keyword">const</span> { createPage } = actions;
  
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">graphql</span>(<span class="hljs-string">`
    query {
      allMarkdownRemark {
        edges {
          node {
            frontmatter {
              path
            }
          }
        }
      }
    }
  `</span>);
  
  result.<span class="hljs-property">data</span>.<span class="hljs-property">allMarkdownRemark</span>.<span class="hljs-property">edges</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">{ node }</span>) =&gt;</span> {
    <span class="hljs-title function_">createPage</span>({
      <span class="hljs-attr">path</span>: node.<span class="hljs-property">frontmatter</span>.<span class="hljs-property">path</span>,
      <span class="hljs-attr">component</span>: path.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'./src/templates/blog-post.js'</span>),
      <span class="hljs-attr">context</span>: {
        <span class="hljs-attr">path</span>: node.<span class="hljs-property">frontmatter</span>.<span class="hljs-property">path</span>
      }
    });
  });
};

<span class="hljs-comment">// src/templates/blog-post.js</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { graphql } <span class="hljs-keyword">from</span> <span class="hljs-string">'gatsby'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">BlogPost</span>(<span class="hljs-params">{ data }</span>) {
  <span class="hljs-keyword">const</span> post = data.<span class="hljs-property">markdownRemark</span>;
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{post.frontmatter.title}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">dangerouslySetInnerHTML</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">__html:</span> <span class="hljs-attr">post.html</span> }} /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> query = graphql<span class="hljs-string">`
  query($path: String!) {
    markdownRemark(frontmatter: { path: { eq: $path } }) {
      html
      frontmatter {
        title
      }
    }
  }
`</span>;
</code></pre>
<h4 data-id="heading-43">4.5 SSG的适用场景</h4>
<ol>
<li><strong>博客和文档网站</strong> - 内容相对静态，更新频率不高</li>
<li><strong>营销页面</strong> - 需要快速加载和良好的SEO</li>
<li><strong>产品展示页面</strong> - 产品信息相对固定</li>
<li><strong>企业官网</strong> - 信息展示为主，交互较少</li>
</ol>
<h4 data-id="heading-44">4.6 SSG的局限性</h4>
<ol>
<li><strong>数据实时性差</strong> - 无法实时反映数据变化</li>
<li><strong>构建时间长</strong> - 页面数量多时构建时间较长</li>
<li><strong>不适合高度个性化内容</strong> - 难以为不同用户提供个性化内容</li>
</ol>
<h3 data-id="heading-45">第五章：增量静态再生（ISR）</h3>
<h4 data-id="heading-46">5.1 ISR概述</h4>
<p>增量静态再生（Incremental Static Regeneration，简称ISR）是Next.js引入的一种混合渲染策略，结合了SSG和SSR的优点。ISR允许在构建时生成部分页面，在运行时根据需要重新生成其他页面。</p>
<h4 data-id="heading-47">5.2 ISR的工作原理</h4>
<p>ISR的工作流程：</p>
<ol>
<li>构建时生成部分静态页面</li>
<li>用户首次访问未生成的页面时，触发按需生成（On-Demand Revalidation）</li>
<li>后续访问直接返回缓存的静态页面</li>
<li>当缓存过期后，下次访问时重新生成页面</li>
</ol>
<h4 data-id="heading-48">5.3 ISR的实现</h4>
<p>在Next.js中实现ISR非常简单：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// pages/blog/[slug].js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">BlogPost</span>(<span class="hljs-params">{ post }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{post.title}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">dangerouslySetInnerHTML</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">__html:</span> <span class="hljs-attr">post.content</span> }} /&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>最后更新时间: {post.lastUpdated}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticPaths</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 只在构建时生成热门文章</span>
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.example.com/popular-posts'</span>);
  <span class="hljs-keyword">const</span> posts = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();
  
  <span class="hljs-keyword">const</span> paths = posts.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">post</span> =&gt;</span> ({
    <span class="hljs-attr">params</span>: { <span class="hljs-attr">slug</span>: post.<span class="hljs-property">slug</span> }
  }));

  <span class="hljs-keyword">return</span> {
    paths,
    <span class="hljs-attr">fallback</span>: <span class="hljs-string">'blocking'</span> <span class="hljs-comment">// 或 'true'</span>
  };
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticProps</span>(<span class="hljs-params">{ params }</span>) {
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`https://api.example.com/posts/<span class="hljs-subst">${params.slug}</span>`</span>);
  <span class="hljs-keyword">const</span> post = <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">json</span>();

  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">props</span>: {
      post
    },
    <span class="hljs-comment">// 设置重新验证时间为1小时</span>
    <span class="hljs-attr">revalidate</span>: <span class="hljs-number">3600</span>
  };
}
</code></pre>
<h4 data-id="heading-49">5.4 ISR的优势</h4>
<h5 data-id="heading-50">5.4.1 平衡性能与实时性</h5>
<p>既享受了静态站点的性能优势，又能保持内容的相对实时性。</p>
<h5 data-id="heading-51">5.4.2 降低构建时间</h5>
<p>不需要在构建时生成所有页面，显著缩短构建时间。</p>
<h5 data-id="heading-52">5.4.3 按需更新</h5>
<p>只有被访问的页面才会被重新生成，节省资源。</p>
<h4 data-id="heading-53">5.5 ISR的配置选项</h4>
<h5 data-id="heading-54">5.5.1 fallback选项</h5>
<p>fallback有三种值：</p>
<ul>
<li><code>false</code> - 未生成的路径返回404</li>
<li><code>true</code> - 未生成的路径显示加载状态，然后生成页面</li>
<li><code>'blocking'</code> - 未生成的路径等待页面生成完成后返回</li>
</ul>
<h5 data-id="heading-55">5.5.2 revalidate选项</h5>
<p>revalidate指定页面重新验证的时间间隔（秒）：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticProps</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">props</span>: {
      <span class="hljs-comment">// ...数据</span>
    },
    <span class="hljs-attr">revalidate</span>: <span class="hljs-number">60</span> <span class="hljs-comment">// 60秒后重新验证</span>
  };
}
</code></pre>
<h4 data-id="heading-56">5.6 On-Demand Revalidation</h4>
<p>Next.js还支持按需重新验证，可以通过API调用手动触发页面重新生成：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// pages/api/revalidate.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handler</span>(<span class="hljs-params">req, res</span>) {
  <span class="hljs-comment">// 检查密钥以确保只有授权人员可以重新验证</span>
  <span class="hljs-keyword">if</span> (req.<span class="hljs-property">query</span>.<span class="hljs-property">secret</span> !== process.<span class="hljs-property">env</span>.<span class="hljs-property">MY_SECRET_TOKEN</span>) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Invalid token'</span> });
  }

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 重新验证指定路径</span>
    <span class="hljs-keyword">await</span> res.<span class="hljs-title function_">unstable_revalidate</span>(<span class="hljs-string">'/blog/post-1'</span>);
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">json</span>({ <span class="hljs-attr">revalidated</span>: <span class="hljs-literal">true</span> });
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">500</span>).<span class="hljs-title function_">send</span>(<span class="hljs-string">'Error revalidating'</span>);
  }
}
</code></pre>
<h3 data-id="heading-57">第六章：技术比较与选择指南</h3>
<h4 data-id="heading-58">6.1 技术对比表</h4>






















































<table><thead><tr><th>特性</th><th>CSR</th><th>SSR</th><th>SSG</th><th>ISR</th></tr></thead><tbody><tr><td>首屏加载速度</td><td>较慢</td><td>快</td><td>最快</td><td>快</td></tr><tr><td>SEO友好性</td><td>差</td><td>好</td><td>好</td><td>好</td></tr><tr><td>服务器负载</td><td>低</td><td>高</td><td>无</td><td>低</td></tr><tr><td>构建时间</td><td>短</td><td>短</td><td>长（页面多时）</td><td>中等</td></tr><tr><td>数据实时性</td><td>好</td><td>好</td><td>差</td><td>中等</td></tr><tr><td>适用场景</td><td>交互密集型应用</td><td>需要SEO的内容站</td><td>静态内容站</td><td>动静结合的内容站</td></tr></tbody></table>
<h4 data-id="heading-59">6.2 选择指南</h4>
<h5 data-id="heading-60">6.2.1 选择CSR的场景</h5>
<ol>
<li><strong>高度交互的应用</strong> - 如在线工具、游戏、仪表板等</li>
<li><strong>内部管理系统</strong> - 不需要SEO优化的企业内部应用</li>
<li><strong>实时数据展示</strong> - 需要频繁更新数据的应用</li>
</ol>
<h5 data-id="heading-61">6.2.2 选择SSR的场景</h5>
<ol>
<li><strong>内容网站</strong> - 博客、新闻网站等需要SEO优化的站点</li>
<li><strong>电商网站</strong> - 需要在搜索引擎中展示商品信息</li>
<li><strong>社交平台</strong> - 需要良好的SEO和较快的首屏加载速度</li>
</ol>
<h5 data-id="heading-62">6.2.3 选择SSG的场景</h5>
<ol>
<li><strong>文档网站</strong> - 技术文档、帮助中心等静态内容</li>
<li><strong>营销网站</strong> - 企业官网、产品介绍页等</li>
<li><strong>博客平台</strong> - 个人博客、技术分享等更新频率不高的站点</li>
</ol>
<h5 data-id="heading-63">6.2.4 选择ISR的场景</h5>
<ol>
<li><strong>新闻网站</strong> - 需要快速更新但不要求绝对实时</li>
<li><strong>电商平台</strong> - 商品信息偶尔更新，但需要良好的性能</li>
<li><strong>内容聚合平台</strong> - 需要平衡性能和内容新鲜度</li>
</ol>
<h4 data-id="heading-64">6.3 混合策略</h4>
<p>在实际项目中，很少会只使用一种渲染策略。更常见的是根据不同页面的需求采用不同的策略：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Next.js 示例：混合使用多种策略</span>
<span class="hljs-comment">// pages/index.js - 使用SSG（首页相对静态）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getStaticProps</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> featuredPosts = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getFeaturedPosts</span>();
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">props</span>: { featuredPosts },
    <span class="hljs-attr">revalidate</span>: <span class="hljs-number">3600</span>
  };
}

<span class="hljs-comment">// pages/dashboard.js - 使用SSR（需要用户个性化数据）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getServerSideProps</span>(<span class="hljs-params">context</span>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUser</span>(context.<span class="hljs-property">req</span>);
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">props</span>: { user }
  };
}

<span class="hljs-comment">// pages/search.js - 使用CSR（高度交互的搜索功能）</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">SearchPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// 完全客户端渲染</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">SearchComponent</span> /&gt;</span></span>;
}
</code></pre>
<h3 data-id="heading-65">第七章：性能优化实践</h3>
<h4 data-id="heading-66">7.1 图片优化</h4>
<p>无论使用哪种渲染策略，图片优化都是提升性能的关键：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用next/image进行图片优化</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Image</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'next/image'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">MyImage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Image</span>
      <span class="hljs-attr">src</span>=<span class="hljs-string">"/profile.jpg"</span>
      <span class="hljs-attr">alt</span>=<span class="hljs-string">"Profile"</span>
      <span class="hljs-attr">width</span>=<span class="hljs-string">{400}</span>
      <span class="hljs-attr">height</span>=<span class="hljs-string">{400}</span>
      <span class="hljs-attr">layout</span>=<span class="hljs-string">"responsive"</span>
      <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"blur"</span>
      <span class="hljs-attr">blurDataURL</span>=<span class="hljs-string">"data:image/jpeg;base64,..."</span>
    /&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-67">7.2 代码分割</h4>
<p>合理使用代码分割可以减少初始加载的JavaScript体积：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 动态导入组件</span>
<span class="hljs-keyword">import</span> dynamic <span class="hljs-keyword">from</span> <span class="hljs-string">'next/dynamic'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">HeavyComponent</span> = <span class="hljs-title function_">dynamic</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../components/HeavyComponent'</span>), {
  <span class="hljs-attr">loading</span>: <span class="hljs-function">() =&gt;</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></span>,
  <span class="hljs-attr">ssr</span>: <span class="hljs-literal">false</span> <span class="hljs-comment">// 客户端渲染</span>
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">HomePage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">HeavyComponent</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h4 data-id="heading-68">7.3 缓存策略</h4>
<p>合理的缓存策略可以显著提升性能：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// next.config.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">headers</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> [
      {
        <span class="hljs-attr">source</span>: <span class="hljs-string">'/_next/static/:path*'</span>,
        <span class="hljs-attr">headers</span>: [
          {
            <span class="hljs-attr">key</span>: <span class="hljs-string">'Cache-Control'</span>,
            <span class="hljs-attr">value</span>: <span class="hljs-string">'public, max-age=31536000, immutable'</span>
          }
        ]
      }
    ];
  }
};
</code></pre>
<h3 data-id="heading-69">第八章：未来发展与趋势</h3>
<h4 data-id="heading-70">8.1 Web Streams API</h4>
<p>Web Streams API为处理大型数据流提供了标准化的方法，未来可能会影响SSR的实现方式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用Streams API进行SSR</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>* <span class="hljs-title function_">renderToStream</span>(<span class="hljs-params">element</span>) {
  <span class="hljs-keyword">yield</span> <span class="hljs-string">'&lt;!DOCTYPE html&gt;'</span>;
  <span class="hljs-keyword">yield</span> <span class="hljs-string">'&lt;html&gt;'</span>;
  <span class="hljs-comment">// ...渲染逻辑</span>
  <span class="hljs-keyword">yield</span> <span class="hljs-string">'&lt;/html&gt;'</span>;
}

<span class="hljs-comment">// 在服务器中使用</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'/'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
  <span class="hljs-keyword">const</span> stream = <span class="hljs-title function_">renderToStream</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>);
  <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> stream) {
    res.<span class="hljs-title function_">write</span>(chunk);
  }
  res.<span class="hljs-title function_">end</span>();
});
</code></pre>
<h4 data-id="heading-71">8.2 Edge Computing</h4>
<p>边缘计算的发展为SSR和ISR提供了新的可能性，可以在更靠近用户的位置进行渲染：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 在Edge Functions中进行渲染</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">onRequest</span>(<span class="hljs-params">context</span>) {
  <span class="hljs-keyword">const</span> { request } = context;
  <span class="hljs-keyword">const</span> url = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(request.<span class="hljs-property">url</span>);
  
  <span class="hljs-comment">// 在边缘节点进行渲染</span>
  <span class="hljs-keyword">const</span> html = <span class="hljs-keyword">await</span> <span class="hljs-title function_">renderPage</span>(url.<span class="hljs-property">pathname</span>);
  
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(html, {
    <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'text/html'</span> }
  });
}
</code></pre>
<h4 data-id="heading-72">8.3 组件级SSR</h4>
<p>未来的框架可能会支持更细粒度的SSR，允许单个组件级别的服务端渲染：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 概念性示例</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserProfile</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-comment">// 这个组件将在服务端渲染</span>
  <span class="hljs-keyword">const</span> userData = <span class="hljs-title function_">useServerData</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">fetchUserData</span>(userId));
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>{userData.name}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{userData.bio}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-73">结论</h3>
<p>渐进增强和优雅降级作为Web开发的基础理念，为我们构建兼容性强、用户体验好的应用提供了指导原则。而PWA、SSR、SSG和ISR等现代技术则在此基础上，进一步提升了Web应用的性能、可访问性和用户体验。</p>
<p>在实际项目中，我们需要根据具体需求选择合适的技术方案：</p>
<ul>
<li>对于静态内容为主的网站，SSG和ISR是很好的选择</li>
<li>对于需要良好SEO且有动态内容的网站，SSR更为合适</li>
<li>对于高度交互的应用，CSR仍是主要选择</li>
<li>而PWA则可以为任何类型的Web应用增加原生应用般的体验</li>
</ul>
<p>随着Web技术的不断发展，我们可以预见会有更多创新的渲染策略和技术出现。作为开发者，我们需要持续学习和适应这些变化，以便为用户提供更好的Web体验。</p>
<p>最终，无论选择哪种技术方案，都应该以用户为中心，确保应用在各种设备和网络条件下都能提供良好的体验。技术只是手段，创造价值才是目的。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>